var FUe=Object.defineProperty;var $Ue=(t,e,i)=>e in t?FUe(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var Qx=(t,e,i)=>($Ue(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function i(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=i(r);fetch(r.href,a)}})();const Nr=function(){let t={},e={},i="gbr";t.define=({ioc:r,idiom:a})=>{e[r]=a},t.set=r=>{if(!r)return i;if(e[r])return i=r,e[r]},t.options=()=>Object.keys(e),t.current=()=>e[i];function n(r){if(!r)return"";let a=e[i],o=r.split(".");for(;o.length;){let s=o.shift();a=(a==null?void 0:a[s])||""}return a}return t.tr=r=>{if(!r)return"";if(n(r))return n(r);let a=e.default,o=r.split(".");for(;o.length;){let s=o.shift();a=(a==null?void 0:a[s])||""}return a},t.obj=r=>{var a;return r?(a=e==null?void 0:e[i])!=null&&a[r]?e[i][r]:e.default[r]?e.default[r]:{}:""},e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t}();function pt(t){return typeof t=="function"}function ru(t){return typeof t=="object"&&!Array.isArray(t)}function BUe(t,e=0){let i=e,n,r;const a=()=>{i-=new Date-r,window.clearTimeout(n)},o=()=>i=e,s=()=>{r=new Date,n=window.setTimeout(function(){i=e,t()},i)};return s(),{pause:a,resume:s,reset:o}}var VUe=Object.defineProperty,Gt=(t,e)=>{for(var i in e)VUe(t,i,{get:e[i],enumerable:!0})};function Yw(){return"2.0.29"}var aA={};Gt(aA,{competitionGovernor:()=>mV,drawsGovernor:()=>mj,entriesGovernor:()=>zH,eventGovernor:()=>KH,generationGovernor:()=>iz,matchUpFormatGovernor:()=>wp,matchUpGovernor:()=>az,mocksGovernor:()=>z_,participantGovernor:()=>Ez,policyGovernor:()=>hH,publishingGovernor:()=>X_,queryGovernor:()=>fH,reportGovernor:()=>Rz,scheduleGovernor:()=>Nz,scoreGovernor:()=>wv,tieFormatGovernor:()=>_z,tournamentGovernor:()=>Lz,venueGovernor:()=>$z});var mV={};Gt(mV,{getLinkedTournamentIds:()=>PD,getTournamentIds:()=>UD,linkTournaments:()=>Vee,mutate:()=>JJ,query:()=>Hee,unlinkTournament:()=>Gee,unlinkTournaments:()=>jee});var JJ={};Gt(JJ,{linkTournaments:()=>Vee,unlinkTournament:()=>Gee,unlinkTournaments:()=>jee});var oT={};Gt(oT,{addNotice:()=>ei,callListener:()=>VT,createInstanceState:()=>gee,cycleMutationStatus:()=>qV,deepCopyEnabled:()=>WV,deleteNotice:()=>ZV,deleteNotices:()=>Ny,disableNotifications:()=>yee,enableNotifications:()=>F1,getDevContext:()=>Hs,getMethods:()=>KV,getNotices:()=>YV,getProvider:()=>QF,getTopics:()=>Xs,getTournamentId:()=>Ay,getTournamentRecord:()=>XV,getTournamentRecords:()=>yf,globalLog:()=>Tee,handleCaughtError:()=>bA,removeTournamentRecord:()=>See,setDeepCopy:()=>BT,setDevContext:()=>$T,setGlobalLog:()=>vee,setGlobalMethods:()=>Iee,setGlobalSubscriptions:()=>ODe,setMethods:()=>bee,setStateMethods:()=>Uee,setStateProvider:()=>_De,setSubscriptions:()=>xDe,setTournamentId:()=>jT,setTournamentRecord:()=>wee,setTournamentRecords:()=>IA,timeKeeper:()=>kDe});function io(t){return typeof t=="function"}function Ga(t){return typeof t=="string"}function Zi(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function jUe(t,e){if(!Zi(t)||!Zi(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function QJ(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(Zi).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var GUe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function jF(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>jF(a))}:{[r]:e?n(t[r]):jF(t[r])}))}function GF(t){return Array.isArray(t)?t.length+t.map(GF).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>GF(t[e])).reduce((e,i)=>e+i,0):0}function HUe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=GF(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var ne={success:!0},zUe="error",eQ={SUCCESS:ne,ERROR:zUe},HF={message:"Chronological error; time violation.",code:"ANACHRONISM"},tQ={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},zF={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Pn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Re={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},pD={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},Rb={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},hv={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},et={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},iQ={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},$o={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Ey={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},gV={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},vV={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},Nb={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},nQ={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},rQ={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},WUe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},yV={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},hD={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},oA={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Zw={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Xw={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},IV={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},sA={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},bV={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},fD={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},xc={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},aQ={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},oQ={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},sQ={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},lQ={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},cQ={message:"Invalid action",code:"ERR_INVALID_ACTION"},WF={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},uQ={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},dQ={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},pQ={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},wV={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},hQ={message:"Existing round",code:"ERR_EXISTING_ROUND"},qUe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},gs={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},bn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},SV={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},mf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},fQ={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Vh={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Ai={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Bo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},mQ={message:"Event exists",code:"ERR_EXISTING_EVENT"},gQ={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},vQ={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},TV={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},UV={message:"Missing stage",code:"ERR_MISSING_STAGE"},og={message:"Invalid stage",code:"ERR_INVALID_STAGE"},yQ={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},IQ={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},bQ={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},qF={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},mD={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},O1={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},Ab={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Wd={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},DV={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},PV={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},wQ={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},gD={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},la={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Jw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},ya={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Md={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},To={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},oo={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},CV={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},lA={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},KUe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},SQ={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},EV={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},TQ={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},MV={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},YUe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},fv={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},ZUe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},RV={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},XUe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},cA={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},JUe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},QUe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},My={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},ut={message:"Missing value",code:"ERR_MISSING_VALUE"},UQ={message:"Missing date",code:"ERR_MISSING_DATE"},DQ={message:"No valid dates",code:"ERR_NO_VALID_DATES"},FM={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},x1={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},PQ={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ha={message:"Invalid Date",code:"ERR_INVALID_DATE"},cl={message:"Invalid time",code:"ERR_INVALID_TIME"},CQ={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},KF={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},EQ={message:"Invalid score",code:"ERR_INVALID_SCORE"},uA={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},eDe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},NV={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},MQ={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},dA={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},AV={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Qw={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},au={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},bl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},RQ={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Dc={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},NQ={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Ry={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},vD={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},mr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},jn={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},AQ={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},tDe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},_Q={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},gf={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},kQ={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},OQ={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},xQ={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},e0={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},pA={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},_V={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},YF={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},LQ={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},iDe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},nDe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},FQ={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},$Q={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},ZF={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},BQ={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},kV={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},VQ={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},OV={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},_b={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},jQ={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},yD={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},GQ={message:"Court exists",code:"ERR_EXISTING_COURT"},HQ={message:"Venue exists",code:"ERR_EXISTING_VENUE"},t0={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},vf={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},zQ={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},xV={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},WQ={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},qQ={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},rDe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},LV={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},KQ={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},FV={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},$V={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},hA={message:"Missing context",code:"ERR_MISSING_CONTEXT"},YQ={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},ID={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},ZQ={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},i0={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},XQ={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},fA={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},JQ={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},QQ={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Fp={message:"Invalid object",code:"ERR_INVALID_OBJECT"},L1={message:"Invalid gender",code:"ERR_INVALID_GENDER"},$M={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},ve={message:"Invalid values",code:"ERR_INVALID_VALUES"},eee={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},BV={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},tee={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},mA={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},VV={message:"Value unchanged",code:"ABORT_UNCHANGED"},Ia={message:"Not found",code:"ERR_NOT_FOUND"},gA={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},iee={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},jV={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},nee={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},ree={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},XF={message:"Existing stage",code:"ERR_EXISTING_STAGE"},GV={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},bD={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},aee={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},vA={message:"Scores present",code:"ERR_SCORES_PRESENT"},oee={ANACHRONISM:HF,CANNOT_CHANGE_WINNING_SIDE:AV,CANNOT_MODIFY_TIEFORMAT:NV,CANNOT_MODIFY_PARTICIPANT_TYPE:MQ,CANNOT_REMOVE_MAIN_STRUCTURE:tQ,CANNOT_REMOVE_PARTICIPANTS:dA,COURT_EXISTS:GQ,COURT_NOT_FOUND:yD,DRAW_DEFINITION_NOT_FOUND:$o,DRAW_ID_EXISTS:aQ,DRAW_POSITION_ACTIVE:oA,DRAW_POSITION_ASSIGNED:Nb,DRAW_POSITION_NOT_CLEARED:rQ,DRAW_POSITION_NOT_FOUND:WUe,DRAW_SIZE_MISMATCH:bV,DUPLICATE_VALUE:eee,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:$Q,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:FQ,EVENT_EXISTS:mQ,EVENT_NOT_FOUND:Bo,EXISTING_DRAW_DEFINITIONS:iQ,EXISTING_END_TIME:xV,EXISTING_FLIGHT:iee,EXISTING_MATCHUP_ID:ree,EXISTING_OUTCOME:nee,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:e0,EXISTING_PARTICIPANT:pA,EXISTING_POLICY_TYPE:MV,EXISTING_PROFILE:jV,EXISTING_ROUND:hQ,EXISTING_STAGE:XF,EXISTING_STRUCTURE:GV,INCOMPATIBLE_MATCHUP_STATUS:O1,INCOMPLETE_SOURCE_STRUCTURE:gV,INSUFFICIENT_DRAW_POSITIONS:kV,INVALID_ACTION:cQ,INVALID_ASSIGNMENT:WF,INVALID_BOOKINGS:FM,INVALID_CATEGORY:$M,INVALID_COLLECTION_DEFINITION:QQ,INVALID_CONFIGURATION:JQ,INVALID_DATE_AVAILABILITY:x1,INVALID_DATE:Ha,INVALID_DRAW_DEFINITION:hv,INVALID_DRAW_POSITION_FOR_SEEDING:vV,INVALID_DRAW_POSITION:Zw,INVALID_DRAW_SIZE:sA,INVALID_END_TIME:zQ,INVALID_ENTRIES:vQ,INVALID_EVENT_TYPE:Vh,INVALID_GAME_SCORES:KF,INVALID_GENDER:L1,INVALID_MATCHUP_FORMAT:DV,INVALID_MATCHUP_STATUS:Ab,INVALID_MATCHUP_STATUS_BYE:bQ,INVALID_MATCHUP:oo,INVALID_OBJECT:Fp,INVALID_PARTICIPANT_ID:au,INVALID_PARTICIPANT_IDS:bl,INVALID_PARTICIPANT_ROLE:RQ,INVALID_PARTICIPANT_SEEDING:oQ,INVALID_PARTICIPANT_TYPE:Dc,INVALID_PARTICIPANT:Qw,INVALID_POLICY_DEFINITION:TQ,INVALID_RECORDS:zF,INVALID_SCALE_ITEM:ID,INVALID_SEED_NUMBER:dQ,INVALID_SEED_POSITION:pQ,INVALID_SET_NUMBER:XUe,INVALID_SIDE_NUMBER:RV,INVALID_SCORE:EQ,INVALID_STAGE:og,INVALID_START_TIME:qQ,INVALID_STRUCTURE:Ey,INVALID_STOP_TIME:WQ,INVALID_TIE_FORMAT:Wd,INVALID_TIME:cl,INVALID_TIME_ITEM:LV,INVALID_TOURNAMENT_DATES:CQ,INVALID_TOURNAMENT_RECORD:pD,INVALID_VALUES:ve,INVALID_WINNING_SIDE:uA,MATCHUP_NOT_FOUND:ya,METHOD_NOT_FOUND:bD,MISSING_ASSIGNMENTS:TV,MISSING_ASYNC_STATE_PROVIDER:KQ,MISSING_AVOIDANCE_POLICY:SQ,MISSING_COLLECTION_DEFINITION:wQ,MISSING_COURT_ID:My,MISSING_COURTS_INFO:jQ,MISSING_DATE_AVAILABILITY:PQ,MISSING_DATE:UQ,MISSING_DRAW_DEFINITION:et,MISSING_DRAW_ID:xc,MISSING_DRAW_POSITION:Xw,MISSING_DRAW_POSITIONS:hD,MISSING_DRAW_SIZE:fD,MISSING_ENTRIES:gQ,MISSING_EVENT:Ai,MISSING_MATCHUP_FORMAT:PV,MISSING_MATCHUP_ID:la,MISSING_MATCHUP_IDS:Jw,MISSING_MATCHUP:To,MISSING_MATCHUPS:Md,MISSING_PARTICIPANT_COUNT:kQ,MISSING_PARTICIPANT_ID:mr,MISSING_PARTICIPANT_IDS:gf,MISSING_PARTICIPANT_ROLE:NQ,MISSING_PARTICIPANT:Ry,MISSING_PARTICIPANTS:vD,MISSING_PENALTY_ID:OV,MISSING_PENALTY_TYPE:VQ,MISSING_PERSON_DETAILS:xQ,MISSING_POLICY_ATTRIBUTES:EV,MISSING_POLICY_DEFINITION:lA,MISSING_POLICY_TYPE:CV,MISSING_POSITION_ASSIGNMENTS:IQ,MISSING_ROUND_NUMBER:qUe,MISSING_SCHEDULE:YQ,MISSING_SCORING_POLICY:ZUe,MISSING_SEED_ASSIGNMENTS:uQ,MISSING_SEEDCOUNT_THRESHOLDS:lQ,MISSING_SEEDING_POLICY:KUe,MISSING_SET_NUMBER:JUe,MISSING_SET_OBJECT:cA,MISSING_SIDE_NUMBER:QUe,MISSING_STAGE:UV,MISSING_STRUCTURE_ID:gs,MISSING_STRUCTURE:mf,MISSING_STRUCTURES:SV,MISSING_TARGET_LINK:wV,MISSING_TIE_FORMAT:gD,MISSING_TIME_ITEM:FV,MISSING_TIME_ITEMS:$V,MISSING_TOURNAMENT_ID:Rb,MISSING_TOURNAMENT_RECORD:Re,MISSING_TOURNAMENT_RECORDS:Pn,MISSING_VALUE:ut,MISSING_VENUE_ID:vf,MODIFICATIONS_FAILED:ZQ,NO_CANDIDATES:fA,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:BQ,NO_MODIFICATIONS_APPLIED:i0,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:ZF,NO_PARTICIPANT_REMOVED:_Q,NO_VALID_ACTIONS:tee,NO_VALID_ATTRIBUTES:mA,NO_VALID_DATES:DQ,NOT_FOUND:Ia,NOT_IMPLEMENTED:gA,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:_V,PARTICIPANT_ID_EXISTS:AQ,PARTICIPANT_NOT_CHECKED_IN:OQ,PARTICIPANT_NOT_FOUND:jn,PARTICIPANT_PAIR_EXISTS:tDe,PENALTY_NOT_FOUND:_b,POLICY_NOT_ATTACHED:YUe,POLICY_NOT_FOUND:fv,SCHEDULE_NOT_CLEARED:nQ,SCHEDULED_MATCHUPS:aee,SCORES_PRESENT:vA,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:sQ,STAGE_SEQUENCE_LIMIT:yQ,STRUCTURE_NOT_FOUND:bn,TEAM_NOT_FOUND:BV,UNABLE_TO_ASSIGN_COURT:XQ,UNLINKED_STRUCTURES:fQ,UNRECOGNIZED_DRAW_TYPE:yV,UNRECOGNIZED_MATCHUP_FORMAT:mD,UNRECOGNIZED_MATCHUP_STATUS:qF,VALUE_UNCHANGED:VV,VENUE_EXISTS:HQ},hn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},see={addNotice:gDe,callListener:wDe,cycleMutationStatus:mDe,deleteNotice:IDe,deleteNotices:yDe,disableNotifications:aDe,enableNotifications:oDe,getMethods:yA,getNotices:vDe,getTopics:bDe,getTournamentId:lee,getTournamentRecord:sDe,getTournamentRecords:lDe,removeTournamentRecord:pDe,setMethods:fDe,setSubscriptions:hDe,setTournamentId:uDe,setTournamentRecord:cDe,setTournamentRecords:dDe,handleCaughtError:SDe};function aDe(){hn.disableNotifications=!0}function oDe(){hn.disableNotifications=!1}function lee(){return hn.tournamentId}function sDe(t){return hn.tournamentRecords[t]}function lDe(){return hn.tournamentRecords}function cDe(t){let e=t==null?void 0:t.tournamentId;return e?(hn.tournamentRecords[e]=t,{success:!0}):{error:pD}}function uDe(t){return t?hn.tournamentRecords[t]?(hn.tournamentId=t,{success:!0}):{error:Re}:(hn.tournamentId=void 0,{success:!0})}function dDe(t){hn.tournamentRecords=t;let e=Object.keys(t);e.length===1?hn.tournamentId=e[0]:e.length||(hn.tournamentId=void 0)}function pDe(t){if(typeof t!="string")return{error:ve};if(!hn.tournamentRecords[t])return{error:Ia};delete hn.tournamentRecords[t];let e=Object.keys(hn.tournamentRecords);return e.length===1?hn.tournamentId=e[0]:e.length||(hn.tournamentId=void 0),{success:!0}}function hDe(t){return typeof t.subscriptions!="object"?{error:ve}:(Object.keys(t.subscriptions).forEach(e=>{hn.subscriptions[e]=t.subscriptions[e]}),{...ne})}function fDe(t){return typeof t!="object"?{error:ve}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(hn.methods[e]=t[e])}),{...ne})}function mDe(){let t=hn.modified;return hn.modified=!1,t}function gDe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(hn.disableNotifications||(hn.modified=!0),!(hn.disableNotifications||!hn.subscriptions[t]&&!n)))return i&&(hn.notices=hn.notices.filter(r=>!(r.topic===t&&r.key===i))),hn.notices.push({topic:t,payload:e,key:i}),{...ne}}function yA(){return hn.methods??{}}function vDe({topic:t}){return hn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function yDe(){hn.notices=[]}function IDe({topic:t,key:e}){hn.notices=hn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function bDe(){return{topics:Object.keys(hn.subscriptions)}}function wDe({topic:t,notices:e},i){let n=hn.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function SDe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:lee(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function ar(t,e){return(t??0)-(e??0)}function wt(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Pc(t){return isNaN(t)?!1:t&&(t&t-1)===0}function H7(t){if(!t.length)return;let e=[...t].sort(ar),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function TDe(t){if(!Pc(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function HV(t){return isNaN(t)?0:t%2&&t+1||t}function zV(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function En(t){return!isNaN(parseFloat(t))}function cee(t){let e=wt(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function n0(t){if(isNaN(t))return!1;for(;!Pc(t);)t++;return t}function Ds(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function Mt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function UDe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function DDe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function uee(t,e,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=uee(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=DDe(s,n)),parseFloat(s.toFixed(r))}function Ft(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function PDe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function La(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function kb(t){return Mt(t)?t:1/0}function Vo(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function CDe(t){return dee(Vo(t))}function dee(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function EDe(t,e,i){return i.indexOf(t)===e}function pee(t){return t.filter(EDe)}function Oo(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function _o(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Ze(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function Yc(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function kn(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function z7(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function za(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function MDe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function RDe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function Fr(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function hee(t,[e,...i]){return t.length?[t.slice(0,e),...hee(t.slice(e),[...i,e])]:[]}function NDe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function fee(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function mee(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function JF(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function ADe(t,e=1){if(!Array.isArray(t)||!t.every(Mt))return[];let i=Math.min(...t,e),n=Math.max(...t);return Ze(i,n+1).filter(r=>!t.includes(r))}var Fi={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},$r=see,W7=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function _De(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(kn(Object.keys(t),W7).length!==W7.length)throw new Error("Global state provider is missing required methods");return $r=t,{success:!0}}function gee(){if($r.createInstanceState){try{$r.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:KQ}}function Hs(t){return!t||typeof t!="object"?Fi.devContext??!1:typeof Fi.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=Fi.devContext)==null?void 0:i[e])===t[e]})&&Fi.devContext}function kDe(t="reset",e="default"){var n,r;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(Fi.timers).filter(a=>a!=="default"||Fi.timers[a].startTime).map(a=>{let o=Fi.timers[a],s=o.state==="stopped"?0:(i-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:Fi.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=Fi.timers[e].state==="stopped"?0:(i-(((n=Fi.timers[e])==null?void 0:n.startTime)??0))/1e3,o=Fi.timers[e].elapsedTime+a;return{state:Fi.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!Fi.timers[e]||t==="reset"){if(e==="allTimers")return Fi.timers={default:{elapsedTime:0}},!0;Fi.timers[e]={startTime:i,state:"active",elapsedTime:0}}return Fi.timers[e].elapsedTime||(Fi.timers[e].elapsedTime=0),t==="stop"&&Fi.timers[e].state!=="stopped"&&(Fi.timers[e].state="stopped")&&(Fi.timers[e].elapsedTime+=(i-(((r=Fi.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(Fi.timers[e].startTime=i)&&(Fi.timers[e].state="active"),Fi.timers[e]}function vee(t){io(t)?Fi.globalLog=t:delete Fi.globalLog}function $T(t){Fi.devContext=t}function yee(){$r.disableNotifications()}function F1(){$r.enableNotifications()}function BT(t,e){typeof t=="boolean"&&(Fi.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(Fi.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(Fi.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(Fi.deepCopyAttributes.stringify=e.stringify),e.threshold&&(Fi.deepCopyAttributes.threshold=e.threshold))}function WV(){return{enabled:Fi.deepCopy,...Fi.deepCopyAttributes}}function ODe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{Fi.globalSubscriptions[e]=t.subscriptions[e]}),{...ne}):{error:ut,info:"missing subscriptions"}}function xDe(t){return t!=null&&t.subscriptions?$r.setSubscriptions({subscriptions:t.subscriptions}):{error:ut,info:"missing subscriptions"}}function Iee(t){return t?typeof t!="object"?{error:ve}:(Object.keys(t).forEach(e=>{io(t[e])&&(Fi.globalMethods[e]=t[e])}),{...ne}):{error:ut,info:"missing method declarations"}}function bee(t){return t?typeof t!="object"?{error:ve}:$r.setMethods(t):{error:ut,info:"missing method declarations"}}function qV(){return $r.cycleMutationStatus()}function ei(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=Fi.globalSubscriptions[t.topic];return $r.addNotice(t,e)}function KV(){return{...Fi.globalMethods,...$r.getMethods()}}function YV(t){return $r.getNotices(t)}function ZV({key:t,topic:e}){return $r.deleteNotice({key:t,topic:e})}function Ny(){return $r.deleteNotices()}function Xs(){return $r.getTopics()}async function VT(t){return $r.callListener(t,Fi.globalSubscriptions)}function Ay(){return $r.getTournamentId()}function XV(t){return $r.getTournamentRecord(t)}function yf(){return $r.getTournamentRecords()}function wee(t){return $r.setTournamentRecord(t)}function IA(t){return $r.setTournamentRecords(t)}function jT(t){return $r.setTournamentId(t)}function See(t){return $r.removeTournamentRecord(t)}function QF(){return $r}function bA({engineName:t,methodName:e,params:i,err:n}){return(io($r.handleCaughtError)&&$r.handleCaughtError||see.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function Tee(t,e){if(Fi.globalLog)try{Fi.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),vee()}else console.log(e,t)}function Uee(t,e,i,n){if(!Zi(t))return{error:ve};En||(i=1);let r=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(c=>{io(s[c])?a[c]=s[c]:Zi(s[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&o(s[c],l+1)})};return o(t),n?Iee(a):bee(a),{methods:a}}function LDe(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function ht(t,e,i,n){var o;if(typeof t!="object"||t===null)return t;(o=WV())!=null&&o.enabled||(n=!0);let r=["",void 0,null];e&&r.push(!1);let a=LDe(t,r,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>ht(l))}:{[s]:n?t[s]:ht(t[s])}))}function ae({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,ht(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...ne}),e??{success:!0}}var ba="tournamentRecords",JV="policyDefinitions",Rd="tournamentRecord",Lc="drawDefinition",QV="matchUpFormat",od="participantId",Dee="scheduleDates",FDe="tournamentId",$De="scheduleDate",ej="structureId",tj="participant",wD="matchUpIds",BDe="policyType",Pee="structures",sg="matchUpId",ij="inContext",nj="structure",wA="courtIds",VDe="personId",SA="venueIds",Cee="matchUps",Eee="courtId",Mee="eventId",If="matchUp",Ree="drawId",mv="error",r0="event",SD="param",jDe="uuids",GDe="averageMatchUpMinutes",HDe="recoveryMinutes",zDe="periodLength",WDe="number",jd="object",No="array",uc="_validate",Nee="_message",sd="_invalid",bf="_ofType",rj="_anyOf",GT="_oneOf",qDe={[ba]:Pn,[Rd]:Re,[JV]:lA,[Lc]:et,[od]:mr,[QV]:PV,[FDe]:Rb,[ej]:gs,[wD]:Jw,[tj]:Ry,[Pee]:SV,[sg]:la,[nj]:mf,[Eee]:My,[Cee]:Md,[Mee]:Bo,[If]:To,[wA]:ut,[SA]:ut,[Ree]:xc,[r0]:Ai},KDe={[ba]:jd,[JV]:jd,[Rd]:jd,[Lc]:jd,[Dee]:No,[tj]:jd,[wD]:No,[Pee]:No,[nj]:jd,[wA]:No,[SA]:No,[Cee]:No,[If]:jd,[r0]:jd,[jDe]:No};function gi(t,e,i){if(!t&&!Zi(t))return{error:ve};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:ve};let{paramError:n,errorParam:r}=XDe(t,e);if(!n)return{valid:!0};let a=(t==null?void 0:t[r])===void 0?qDe[r]||ve:n[uc]&&n[sd]||ve,o=r??(n[GT]&&Object.keys(n[GT]).join(", "));return ae({info:{param:o,message:n[Nee]},result:{error:a},stack:i})}function Aee(t,e){let i=Object.keys(t),n=Object.keys(e);return kn(i,n)}function YDe(t,e){if(!e)return;let i=Aee(t,e);return i.length!==1?{error:ve}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function ZDe(t,e){if(!e)return;let i=Aee(t,e).filter(n=>t[n]);return i.length<1?{error:ve}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function XDe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:o,_validate:s,_info:l,...c})=>{let u=a&&YDe(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=o&&ZDe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=s&&!io(s),g=t[f]&&!s&&JDe(t,f,r),v=c[f]&&!t[f],y=m||g||v||s&&t[f]&&!QDe(t[f],s);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function JDe(t,e,i){return i=i||KDe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function QDe(t,e){return io(e)?e(t):!0}var _ee="DYNAMIC",jh="RANKING",wm="RATING",Gv="SCALE",qu="SEEDING",a0={RANKING:jh,RATING:wm,SCALE:Gv,SEEDING:qu};function o0(t){var r;let e=gi(t,[{[tj]:!0}]);if(e.error)return e;let i=(r=t.participant.timeItems)==null?void 0:r.filter(({itemType:a})=>(a==null?void 0:a.startsWith(Gv))&&[jh,wm,qu].includes(a.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let a=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),o=Ft(i.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===qu&&"seedings"||c===jh&&"rankings"||"ratings";n[f][u]||(n[f][u]=[]),n[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...ne,...n}}function Hv(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,o,s){if(!a||!o)return;let l=Object.keys(a),c=Object.keys(o),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=o[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let I={};return r(y,m,I)!==!1?I:void 0}).filter(Boolean);s[h]=v}else g&&(s[h]={},r(g,m,s[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(o[h]||p&&o[h]!==!1)&&(s[h]=v)}}}}var BM=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,kee=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,ld=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,vm=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function VM(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=xt(t.scheduledTime)),!e)return;let i=tn(t.scheduledTime),n=xt(e);return n&&i&&(n+=`T${i}`),n}function ePe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function s0(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||vm.test(_y(t,!0,!0)))}function ss(t){return Mm(t)||BM.test(t)}function tPe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return iPe(i,{displaySeconds:!1})}function iPe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(Ns).join(":")}var aj=t=>{let e=HT(t)||Mm(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Ns(n)}-${Ns(e.getUTCDate())}`};function nPe(t){let e=HT(t)||Mm(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Ic(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,o].join(e):i==="MDY"?[r,a,o].join(e):i==="YDM"?[o,a,r].join(e):i==="DYM"?[a,o,r].join(e):i==="MYD"?[r,o,a].join(e):[o,r,a].join(e)}function jM(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function rPe(t){return jM(t).getTime()}function HT(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function Ob(t,e){if(!ss(t)||!ss(e))return[];let i=xt(t)+"T00:00",n=xt(e)+"T00:00",r=new Date(i),a=new Date(n),o=HT(a)&&HT(r)&&c(r,a),s=[],l=0;if(o){let u=r,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>Ic(u));function c(u,d){return u<=d}}var aPe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Mm(t){return typeof t!="string"?!1:aPe.test(t)}function oj(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function ni(t){let e=tn(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function oPe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[Ns(e),Ns(i)].join(":")}function GM(t){return oj(t)?t.split(":").slice(0,2).map(Ns).join(":"):void 0}function tn(t){return Mm(t)&&t.indexOf("T")>0?GM(t.split("T").reverse()[0]):GM(t)}function xt(t){return Mm(t)||ld.test(t)?t.split("T")[0]:void 0}function HS(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),xt(i.toISOString())}function HM(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function sPe(t){let e=HM(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(Ns).join(":")}function lPe(t){var i;let e=HM(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function _y(t,e,i){let n=xt(t),r=tn(t),a=n?r:t;return t?e&&(n&&i&&t||sPe(a))||lPe(a):void 0}function Oee(t,e){let i=HM(t),n=HM(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function xee(t,e=7){let i=xt(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Ic(r)}function cPe(t){return xee(t)}function uPe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Ic(r,i)}function dPe(t,e,i){let n=new Date(t,0);return Ic(new Date(n.setDate(e)),i)}function Xn(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(Ns),r=jM(e).setHours(i,n,0,0);return jM(r)}function TD(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function wo(t,e){let i=tn(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return tn(sj(Xn(i),n).toISOString())}function sj(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function Ns(t){return t.toString()[1]?t:"0"+t}function cd(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var pPe={addDays:xee,addWeek:cPe,addMinutesToTimeString:wo,convertTime:_y,getIsoDateString:VM,getUTCdateString:aj,DateHHMM:tPe,extractDate:xt,extractTime:tn,formatDate:Ic,getDateByWeek:uPe,isISODateString:Mm,isDate:HT,isTimeString:oj,offsetDate:jM,offsetTime:rPe,sameDay:cd,timeStringMinutes:ni,timeToDate:Xn,timeUTC:nPe,validTimeValue:s0,validDateString:BM,timeValidation:vm,dateValidation:ld};function at(t,e,i,n,r=0){if(QF().makeDeepCopy)return QF().makeDeepCopy(t,e,i,n);let a=WV(),{stringify:o,toJSON:s,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||io(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||io(l)&&!l(h)),p=(h,f)=>{u[h]=io(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=io(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=lj(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(o)&&o.includes(h)?p(h,f):Array.isArray(s)&&s.includes(h)&&io(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:ePe(f)?u[h]=new Date(f).toISOString():u[h]=at(f,e,i,n,r+1)}return u}function lj(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var e$="voluntaryConsolation",Zd="competitiveBands",cj="roundRobinTally",dp="positionActions",_r="matchUpActions",$1="rankingPoints",xb="roundNaming",l0="participant",zT="progression",wf="scheduling",WT="avoidance",hPe="display",ud="scoring",hl="seeding",Lb="feedIn",fPe="audit",zM="draws",lg={POLICY_TYPE_VOLUNTARY_CONSOLATION:e$,POLICY_TYPE_COMPETITIVE_BANDS:Zd,POLICY_TYPE_ROUND_ROBIN_TALLY:cj,POLICY_TYPE_POSITION_ACTIONS:dp,POLICY_TYPE_MATCHUP_ACTIONS:_r,POLICY_TYPE_RANKING_POINTS:$1,POLICY_TYPE_ROUND_NAMING:xb,POLICY_TYPE_PARTICIPANT:l0,POLICY_TYPE_PROGRESSION:zT,POLICY_TYPE_SCHEDULING:wf,POLICY_TYPE_AVOIDANCE:WT,POLICY_TYPE_DISPLAY:hPe,POLICY_TYPE_FEED_IN:Lb,POLICY_TYPE_SCORING:ud,POLICY_TYPE_SEEDING:hl,POLICY_TYPE_AUDIT:fPe,POLICY_TYPE_DRAWS:zM};function Gh({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),s=at(o,!1,r);if(s){let l=e==null?void 0:e[l0];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=o0({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return Hv({template:l.participant,source:s})}return s}var uj="element required",mPe="missing name";function Ba(t){if(!t||typeof t!="object")return{error:ut};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:ve};if(!(t!=null&&t.name))return{error:ut,info:mPe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=Ba({element:i,name:t.name});if(n.error)return ae({result:n,stack:"removeExtension"})}return{...ne}}return{error:ut,info:uj}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...ne}):{...ne,info:Ia}}function ou({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function ci(t){if(typeof t!="object")return{error:ut};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ae({result:{error:ve},stack:e});if(!ou({extension:t.extension}))return ae({result:{error:ve,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=ci({extension:t.extension,element:n});if(r.error)return ae({result:r,stack:e})}return{...ne}}else return ae({result:{error:ut},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...ne}}function dj(t){return!t||typeof t!="object"?{error:ut}:t.tournamentRecord?ci({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Re}}function TA(t){return!t||typeof t!="object"?{error:ut}:t.drawDefinition?ci({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:$o}}function Sf(t){return!t||typeof t!="object"?{error:ut}:t.event?ci({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Bo}}function Lee(t){var n;if(!t||typeof t!="object")return{error:ut};if(!t.participantId)return{error:mr};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=Gh({participantId:t.participantId,tournamentParticipants:e});return i?ci({creationTime:t.creationTime,extension:t.extension,element:i}):{error:jn}}function pj(t){return!t||typeof t!="object"?{error:ut}:t.tournamentRecord?Ba({element:t.tournamentRecord,name:t.name}):{error:Re}}function Fee(t){return!t||typeof t!="object"?{error:ut}:t.drawDefinition?Ba({element:t.drawDefinition,name:t.name}):{error:$o}}function UA(t){return!t||typeof t!="object"?{error:ut}:t!=null&&t.event?Ba({element:t.event,name:t.name}):{error:Bo}}function $ee(t){var n;if(!t||typeof t!="object")return{error:ut};if(!t.participantId)return{error:mr};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=Gh({participantId:t.participantId,tournamentParticipants:e});return i?Ba({element:i,name:t.name}):{error:jn}}function UD({tournamentRecords:t}){return{tournamentIds:Zi(t)?Object.keys(t):[],...ne}}var gPe="extensionQueries";function Vt({discover:t,element:e,name:i,...n}){var a;if(!e||!i){if(t&&n){let o=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&n[o];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(a=s==null?void 0:s.extensions)==null?void 0:a.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:Ia}}return ae({result:{error:ut},stack:gPe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let r=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:r,info:r?void 0:Ia}}var vPe="activeSuspension",qT="appliedPolicies",WM="positionActions",Bee="context",DA="delegatedOutcome",bc="disabled",PA="disableLinks",Fb="disableAutoCalc",qM="drawDeletions",yPe="drawProfile",KM="entryProfile",IPe="eventProfile",bPe="eventWithdrawalRequests",wPe="factory",Ml="flightProfile",t$="groupingAttribute",pp="lineUps",zv="linkedTournamentsIds",CA="matchUpHistory",hj="participantRepresentatives",c0="personRequests",SPe="rankingPoints",Tu="roundTarget",DD="scheduleLimits",hp="scheduleTiming",Wv="schedulingProfile",TPe="statusDetail",$b="subOrder",Hh="tally",qv="tieFormatModification",fj={ACTIVE_SUSPENSION:vPe,APPLIED_POLICIES:qT,AUDIT_POSITION_ACTIONS:WM,CONTEXT:Bee,DELEGATED_OUTCOME:DA,DISABLED:bc,DISABLE_LINKS:PA,DISABLE_AUTO_CALC:Fb,DRAW_DELETIONS:qM,DRAW_PROFILE:yPe,ENTRY_PROFILE:KM,EVENT_PROFILE:IPe,EVENT_WITHDRAWAL_REQUESTS:bPe,FLIGHT_PROFILE:Ml,GROUPING_ATTRIBUTE:t$,LINEUPS:pp,LINKED_TOURNAMENTS:zv,MATCHUP_HISTORY:CA,PARTICIPANT_REPRESENTATIVES:hj,PERSON_REQUESTS:c0,RANKING_POINTS:SPe,ROUND_TARGET:Tu,SCHEDULE_LIMITS:DD,SCHEDULE_TIMING:hp,SCHEDULING_PROFILE:Wv,STATUS_DETAIL:TPe,SUB_ORDER:$b,TALLY:Hh,TIE_FORMAT_MODIFICATIONS:qv,FACTORY:wPe},q7=[DA,bc,PA,Ml,pp,CA,hj,c0,Tu,DD,hp,Wv,$b,Hh];function Vee({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Pn};let e=UD({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?ci({tournamentRecords:t,discover:!0,extension:{name:zv,value:{tournamentIds:i}}}):{...ne}}function jee({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Pn};let e=Ba({name:zv,tournamentRecords:t,discover:!0});return ae({result:e,stack:"unlinkTournaments"})}function Gee({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:ve};if(!e)return{error:Rb};let i=UD({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:Rb};let r;return n.every(a=>{var d;let o=t[a],{extension:s}=Vt({element:o,name:zv});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||a===e){let p=pj({name:zv,tournamentRecord:o});return p.error&&(r=p.error),p.success}let c=l.filter(p=>p!==e);s.value={tournamentIds:c};let u=dj({tournamentRecord:o,extension:s});return u.error&&(r=u.error),u.success}),r?{error:r}:{...ne}}var Hee={};Gt(Hee,{getLinkedTournamentIds:()=>PD,getTournamentIds:()=>UD});function PD({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Pn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var o;let i=t[e],n=i==null?void 0:i.tournamentId,{extension:r}=Vt({element:i,name:zv}),a=(((o=r==null?void 0:r.value)==null?void 0:o.tournamentIds)||[]).filter(s=>s!==n);return{[e]:a}}))}}var mj={};Gt(mj,{addAdHocMatchUps:()=>a_,addDrawDefinitionTimeItem:()=>CG,addFinishingRounds:()=>ND,addGoesTo:()=>Lm,addPlayoffStructures:()=>r_,addQualifyingStructure:()=>jie,addVoluntaryConsolationStage:()=>Bie,addVoluntaryConsolationStructure:()=>fG,allPlayoffPositionsFilled:()=>UG,alternateDrawPositionAssignment:()=>wie,assignDrawPosition:()=>mne,assignDrawPositionBye:()=>ys,attachConsolationStructures:()=>dne,attachPlayoffStructures:()=>LG,attachQualifyingStructure:()=>PG,attachStructures:()=>n_,autoSeeding:()=>ANe,automatedPlayoffPositioning:()=>iP,automatedPositioning:()=>tP,checkValidEntries:()=>c_,deleteAdHocMatchUps:()=>vne,drawMatic:()=>dH,findDrawDefinition:()=>jG,generateAdHocMatchUps:()=>u_,generateAdHocRounds:()=>uH,generateAndPopulatePlayoffStructures:()=>xG,generateDrawDefinition:()=>N_,generateDrawMaticRound:()=>tH,generateDrawStructuresAndLinks:()=>JG,generateDrawTypeAndModifyDrawDefinition:()=>QG,generateQualifyingStructure:()=>MG,generateVoluntaryConsolation:()=>Wne,getAssignedParticipantIds:()=>yg,getAvailableMatchUpsCount:()=>o_,getAvailablePlayoffProfiles:()=>rP,getDrawDefinitionTimeItem:()=>aG,getDrawParticipantRepresentativeIds:()=>BG,getDrawTypeCoercion:()=>hP,getEligibleVoluntaryConsolationParticipants:()=>$G,getMatchUpsMap:()=>ca,getParticipantIdFinishingPositions:()=>VG,getPositionAssignments:()=>oU,getPositionsPlayedOff:()=>S0,getSeedingThresholds:()=>yG,getSeedsCount:()=>fP,getStructureSeedAssignments:()=>zs,getTeamLineUp:()=>xm,getValidGroupSizes:()=>QD,isAdHoc:()=>Go,isCompletedStructure:()=>Yh,isValidForQualifying:()=>XG,luckyLoserDrawPositionAssignment:()=>bie,modifyDrawDefinition:()=>pne,modifyDrawName:()=>FG,modifySeedAssignment:()=>Rie,mutate:()=>zee,positionActions:()=>ZG,pruneDrawDefinition:()=>fne,qualifierDrawPositionAssignment:()=>Cie,query:()=>bne,removeDrawPositionAssignment:()=>nU,removeRoundMatchUps:()=>yne,removeSeededParticipant:()=>Vie,removeStructure:()=>Fie,renameStructures:()=>Lie,resetDrawDefinition:()=>hne,resetVoluntaryConsolationStructure:()=>cte,setDrawParticipantRepresentativeIds:()=>Wee,setPositionAssignments:()=>Die,setStructureOrder:()=>Oie,setSubOrder:()=>Ine,shiftAdHocRounds:()=>Uie,swapAdHocRounds:()=>Pie,swapDrawPositionAssignments:()=>Mie,updateTeamLineUp:()=>zy,withdrawParticipantAtDrawPosition:()=>pie});var zee={};Gt(zee,{addAdHocMatchUps:()=>a_,addDrawDefinitionTimeItem:()=>CG,addPlayoffStructures:()=>r_,addQualifyingStructure:()=>jie,addVoluntaryConsolationStage:()=>Bie,addVoluntaryConsolationStructure:()=>fG,alternateDrawPositionAssignment:()=>wie,assignDrawPosition:()=>mne,assignDrawPositionBye:()=>ys,attachConsolationStructures:()=>dne,attachPlayoffStructures:()=>LG,attachQualifyingStructure:()=>PG,attachStructures:()=>n_,automatedPlayoffPositioning:()=>iP,automatedPositioning:()=>tP,deleteAdHocMatchUps:()=>vne,luckyLoserDrawPositionAssignment:()=>bie,modifyDrawDefinition:()=>pne,modifyDrawName:()=>FG,modifySeedAssignment:()=>Rie,pruneDrawDefinition:()=>fne,qualifierDrawPositionAssignment:()=>Cie,removeDrawPositionAssignment:()=>nU,removeRoundMatchUps:()=>yne,removeSeededParticipant:()=>Vie,removeStructure:()=>Fie,renameStructures:()=>Lie,resetDrawDefinition:()=>hne,resetVoluntaryConsolationStructure:()=>cte,setDrawParticipantRepresentativeIds:()=>Wee,setPositionAssignments:()=>Die,setStructureOrder:()=>Oie,setSubOrder:()=>Ine,shiftAdHocRounds:()=>Uie,swapAdHocRounds:()=>Pie,swapDrawPositionAssignments:()=>Mie,updateTeamLineUp:()=>zy,withdrawParticipantAtDrawPosition:()=>pie});var gj=t=>e=>t[e],vj=(t=[])=>t.map(Pr).filter(Boolean),i$=(t=[])=>t.map(qt).filter(Boolean),qt=(t={})=>gj(t)("participantId"),Pr=(t={})=>gj(t)("matchUpId"),KT=(t={})=>gj(t)("drawId");function Wee({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:$o};if(!Array.isArray(t))return{error:ve};let i=i$((e==null?void 0:e.entries)||[]);return t.length&&kn(t,i).length<t.length?{error:ve}:TA({drawDefinition:e,extension:{name:hj,value:t}})}var cs="ABANDONED",ky="AWAITING_RESULT",bi="BYE",$p="CANCELLED",Wn="COMPLETED",u0="DEAD_RUBBER",fi="DEFAULTED",hr="DOUBLE_DEFAULT",Qn="DOUBLE_WALKOVER",Bl="IN_PROGRESS",su="INCOMPLETE",yj="NOT_PLAYED",Ra="RETIRED",Tf="SUSPENDED",On="TO_BE_PLAYED",Pi="WALKOVER",qee=[ky,Wn,fi,Bl,su,Ra,Tf],Ij=[ky,Wn,fi,Qn,hr,Bl,su,Ra,Tf,Pi],bj=[cs,ky,bi,$p,Wn,u0,fi,Qn,hr,Bl,su,yj,Ra,Tf,On,Pi],wj=[bi,Qn,hr,Wn,fi,Ra,Pi],Sj=[cs,ky,$p,u0,Bl,su,yj,Tf,On,void 0],gr=[$p,cs,Wn,u0,fi,Qn,hr,Ra,Pi],EA=[cs,Wn,fi,Qn,hr,Bl,Ra,Pi],Tj=[Bl,su,Tf,On],Uj={ABANDONED:cs,AWAITING_RESULT:ky,BYE:bi,CANCELLED:$p,COMPLETED:Wn,DEAD_RUBBER:u0,DEFAULTED:fi,DOUBLE_WALKOVER:Qn,DOUBLE_DEFAULT:hr,IN_PROGRESS:Bl,INCOMPLETE:su,NOT_PLAYED:yj,RETIRED:Ra,SUSPENDED:Tf,TO_BE_PLAYED:On,WALKOVER:Pi},it="MAIN",mt="QUALIFYING",ra="CONSOLATION",kr="VOLUNTARY_CONSOLATION",Rn="PLAY_OFF",Dj=[it,mt,ra,Rn,kr],Kv={[mt]:1,[it]:2,[Rn]:3,[ra]:3,[kr]:4},Kee="finishingPositions",Yee="aggregateEventStructures",Zee={[it]:1,[Rn]:2,[ra]:3,[mt]:4,[kr]:5},UPe={[Rn]:1,[it]:2,[ra]:3,[mt]:4,[kr]:5},MA="CLUSTER",DPe="SEPARATE",Rm="WATERFALL",RA="ITEM",Qa="CONTAINER",ml="DRAW",NA="RANDOM",gl="TOP_DOWN",Nm="BOTTOM_UP",fp="POSITION",mp="WINNER",dd="LOSER",pd="FIRST_MATCHUP",Rl="AD_HOC",PPe="AD_HOC",d0="FEED_IN",Bb="COMPASS",Vb="OLYMPIC",CPe="SINGLE_ELIMINATION",Zc="SINGLE_ELIMINATION",CD="DOUBLE_ELIMINATION",jb="FIRST_MATCH_LOSER_CONSOLATION",ED="FIRST_ROUND_LOSER_CONSOLATION",cg="LUCKY_DRAW",AA="CURTIS_CONSOLATION",EPe="CURTIS_CONSOLATION",Pj="FEED_IN_CHAMPIONSHIP_TO_SF",YT="FEED_IN_CHAMPIONSHIP_TO_SF",Cj="FEED_IN_CHAMPIONSHIP_TO_QF",ZT="FEED_IN_CHAMPIONSHIP_TO_QF",Ej="FEED_IN_CHAMPIONSHIP_TO_R16",XT="FEED_IN_CHAMPIONSHIP_TO_R16",Xee="MODIFIED_FEED_IN_CHAMPIONSHIP",JT="MODIFIED_FEED_IN_CHAMPIONSHIP",MD="FEED_IN_CHAMPIONSHIP",Nl="ROUND_ROBIN",hd="ROUND_ROBIN_WITH_PLAYOFF",Jee="DECIDER",Qee="BACKDRAW",Mj={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},Rj={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},p0="WIN_RATIO",Oy="ROUND_OUTCOME",ete=[Bb,AA,ZT,XT,YT,MD,Cj,Ej,Pj,jb,ED,cg,JT,Vb,Rn,hd],MPe=[Rl,Bb,AA,CD,ZT,XT,YT,MD,d0,jb,ED,cg,JT,Vb,Rn,Nl,hd,Zc],tr={MAIN:it,QUALIFYING:mt,CONSOLATION:ra,ITEM:RA,CONTAINER:Qa,FIRST_MATCHUP:pd,WINNER:mp,LOSER:dd,AD_HOC:Rl,FEED_IN:d0,FLEX_ROUNDS:PPe,COMPASS:Bb,PLAY_OFF:Rn,OLYMPIC:Vb,KNOCKOUT:CPe,SINGLE_ELIMINATION:Zc,DOUBLE_ELIMINATION:CD,CURTIS:AA,FICSF:Pj,FICQF:Cj,FICR16:Ej,MFIC:Xee,VOLUNTARY_CONSOLATION:kr,FIRST_MATCH_LOSER_CONSOLATION:jb,FIRST_ROUND_LOSER_CONSOLATION:ED,MODIFIED_FEED_IN_CHAMPIONSHIP:JT,FEED_IN_CHAMPIONSHIP_TO_R16:XT,FEED_IN_CHAMPIONSHIP_TO_QF:ZT,FEED_IN_CHAMPIONSHIP_TO_SF:YT,FEED_IN_CHAMPIONSHIP:MD,LUCKY_DRAW:cg,ROUND_ROBIN_WITH_PLAYOFF:hd,ROUND_ROBIN:Nl,DECIDER:Jee,BACKDRAW:Qee,COMPASS_ATTRIBUTES:Mj,OLYMPIC_ATTRIBUTES:Rj,DRAW:ml,RANDOM:NA,TOP_DOWN:gl,BOTTOM_UP:Nm,WATERFALL:Rm,WIN_RATIO:p0,ROUND_OUTCOME:Oy,MULTI_STRUCTURE_DRAWS:ete,generatedDrawTypes:MPe,stageOrder:Kv,finishOrder:Zee,AGGREGATE_EVENT_STRUCTURES:Yee,FINISHING_POSITIONS:Kee},RPe=tr;function xy(t,e,i){var d,p;let n=h=>{var f,m;return(m=(f=Vt({element:h,name:Tu}))==null?void 0:f.extension)==null?void 0:m.value},r=i==null?void 0:i.deprioritizeCompleted,a=(i==null?void 0:i.mode)===Yee&&UPe,o=(i==null?void 0:i.mode)===Kee&&Zee,s=o||a||Kv,l=h=>(h==null?void 0:h.stage)===it&&(h==null?void 0:h.stageSequence)===1,c=h=>l(h)?-1:s[h==null?void 0:h.stage],u=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>gr.includes(f)?1:-1);return r&&u(t)-u(e)||a&&c(t)-c(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(n(t)||0)-(n(e)||0)||!o&&!a&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(YM(t)||0)-(YM(e)||0)}function YM(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((a,o)=>a+o,0);return!e||n<e?n:e},void 0)}function Ut(t){let e=gi(t,[{[Lc]:!0,[ej]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=fd({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===n);if(!o)return{error:bn};let s=o.structureType===RA?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:o,containingStructure:s}}function fd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var f;let l=!e&&et||!(e!=null&&e.structures)&&SV||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=m=>{var v,y;let g=(y=(v=Vt({element:m,name:Tu}))==null?void 0:v.extension)==null?void 0:y.value;return!r||r===g},u=((f=e==null?void 0:e.structures)==null?void 0:f.filter(p).filter(h).filter(c).sort((m,g)=>xy(m,g,a)))??[],d=t?Object.assign({},...Dj.map(m=>{let g=u==null?void 0:u.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(m){return!s&&!Array.isArray(o)||s&&m.stage===s||Array.isArray(o)&&o.includes(m.stage)}function h(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function tte({drawDefinition:t}){if(!t)return{error:et};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Bi({structure:i}),a=(r==null?void 0:r.map(qt).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Bi({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:et};if({structure:i,error:n}=Ut({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Bi({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=IQ,{positionAssignments:r,error:n}}function Er({drawDefinition:t,structureId:e,structure:i}){var c;let n=((c=Bi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:c.positionAssignments)||[],r=n==null?void 0:n.filter(u=>u.participantId??u.bye??u.qualifier),a=n&&(n==null?void 0:n.length)===(r==null?void 0:r.length),o=n==null?void 0:n.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),s=n==null?void 0:n.filter(u=>!u.participantId&&u.bye),l=n==null?void 0:n.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:n,unassignedPositions:o,assignedPositions:r,qualifierPositions:l,byePositions:s}}var Nj="addDrawDefinition",_A="addMatchUps",zh="addParticipants",Aj="addScaleItems",_j="addVenue",Gb="audit",kj="deleteParticipants",Oj="deleteVenue",xj="deletedDrawIds",Lj="deletedMatchUpIds",Fj="modifyDrawDefinition",ite="modifyDrawEntries",nte="modifyEventEntries",$j="modifyMatchUp",aa="modifyParticipants",Bj="modifyPositionAssignments",Vj="modifySeedAssignments",rte="modifyTournamentDetail",ug="modifyVenue",QT="mutations",n$="publishEvent",ate="publishEventSeeding",ote="publishOrderOfPlay",jj="unPublishEvent",Gj="unPublishEventSeeding",Hj="unPublishOrderOfPlay",kA="updateInContextMatchUp",ste={ADD_DRAW_DEFINITION:Nj,ADD_MATCHUPS:_A,ADD_PARTICIPANTS:zh,ADD_SCALE_ITEMS:Aj,ADD_VENUE:_j,AUDIT:Gb,DELETE_PARTICIPANTS:kj,DELETE_VENUE:Oj,DELETED_DRAW_IDS:xj,DELETED_MATCHUP_IDS:Lj,MODIFY_DRAW_DEFINITION:Fj,MODIFY_DRAW_ENTRIES:ite,MODIFY_EVENT_ENTRIES:nte,MODIFY_MATCHUP:$j,MODIFY_PARTICIPANTS:aa,MODIFY_POSITION_ASSIGNMENTS:Bj,MODIFY_SEED_ASSIGNMENTS:Vj,MODIFY_TOURNAMENT_DETAIL:rte,MODIFY_VENUE:ug,MUTATIONS:QT,PUBLISH_EVENT_SEEDING:ate,PUBLISH_EVENT:n$,PUBLISH_ORDER_OF_PLAY:ote,UNPUBLISH_EVENT_SEEDING:Gj,UNPUBLISH_EVENT:jj,UNPUBLISH_ORDER_OF_PLAY:Hj,UPDATE_INCONTEXT_MATCHUP:kA};function OA(t,e){var a;if(!t)return{error:et};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let n=new Date(i).toISOString(),r=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(a=t.structures)==null||a.filter(Boolean).forEach(o=>{(!(r!=null&&r.length)||r!=null&&r.includes(o.structureId))&&(o.updatedAt=n)}),{...ne}}function Wh({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&OA(t),ei({payload:{matchUps:i,tournamentId:e,eventId:n},topic:_A}),{...ne}}function Bp({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&OA(t),ei({topic:Lj,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)ZV({key:a});return{...ne}}function oi({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Xi({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),ei({topic:$j,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...ne}):(console.log(To),{error:To})}function NPe({tournamentId:t,inContextMatchUp:e}){return e?(ei({payload:{inContextMatchUp:e,tournamentId:t},topic:kA,key:e.matchUpId}),{...ne}):{error:To}}function RD({tournamentId:t,eventId:e,drawDefinition:i}){return i?(OA(i),ei({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:Nj,key:i.drawId}),{...ne}):(console.log(et),{error:et})}function APe({tournamentId:t,eventId:e,drawId:i}){return ei({payload:{drawId:i,tournamentId:t,eventId:e},topic:xj,key:i}),ZV({key:i}),{...ne}}function Xi({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(OA(t,i),ei({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:Fj,key:t.drawId}),{...ne}):{error:et}}function lte({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:et};if(!i)return{error:mf};let r=i.seedAssignments,a=i.structureId,o=t.drawId;return ei({payload:{tournamentId:e,eventId:n,drawId:o,structureId:a,seedAssignments:r},topic:Vj,key:t.drawId}),Xi({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...ne}}function qh({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:et};if(!i)return{error:mf};let r=Bi({structure:i}),a=i.structureId,o=t.drawId,s=n==null?void 0:n.eventId;return ei({topic:Bj,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),Xi({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...ne}}function cte({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var o,s;if(!e)return{error:et};let r=(o=e.structures)==null?void 0:o.find(l=>l.stage===kr);if(!r)return{error:bn};let a=((s=r.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],Bp({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:a,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==kr)),Xi({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...ne}}function zj({drawPositions:t,structure:e}){var n;if([mt,it].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Bi({structure:e});(n=i==null?void 0:i.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||n.forEach(r=>{ci({element:r,extension:{name:PA,value:!0}})})}function xA({drawDefinition:t,positionAction:e}){var a;let{extension:i}=Vt({name:WM,element:t}),n=Array.isArray(i==null?void 0:i.value)?(i==null?void 0:i.value)??[]:[];if(!(n!=null&&n.length)){let o=t.structures.find(s=>s.stage===it);if(o){let s=(a=Bi({structure:o}).positionAssignments)==null?void 0:a.map(({drawPosition:l,participantId:c,bye:u,qualifier:d})=>({drawPosition:l,participantId:c,qualifier:d,bye:u}));n.push({name:"initialMainAssignments",initialAssignments:s})}}let r={name:WM,value:n.concat(e)};ci({element:t,extension:r})}function h0({tournamentRecord:t,drawDefinition:e,event:i}){var s;let n=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],r={},a={},o=n.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of o){let{structures:c,structureId:u}=l??{};c&&u&&(r[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:r,containerStructures:a}}var gv="SINGLES",Tn="SINGLES",Am="DOUBLES",Wi="DOUBLES",lu="TEAM",Ki="TEAM",ute={SINGLES_MATCHUP:gv,SINGLES:Tn,DOUBLES_MATCHUP:Am,DOUBLES:Wi,TEAM_MATCHUP:lu,TEAM:Ki};function LA(t){var a;let{sides:e,matchUpType:i}=t||{},n=(a=t.potentialParticipants)!=null&&a.length?t.potentialParticipants.flat().map(o=>i===Wi?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],r=(e||[]).map(o=>{var s;return i===Wi&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:r.concat(n).flat(),enteredIndividualParticipantIds:r,potentialIndividualParticipantIds:n}}function Uu(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}function FA(t){if(!Zi(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>Mt(a)||a===void 0||a===null);return n&&r}function Js(t){return Array.isArray(t)?t.every(FA):!1}function Wa({matchUps:t=[],interpolate:e}){var d;if(!Js(t))return{roundMatchUps:[],error:ve};let i=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?wt(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(ar).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===Ki)?h.filter(({matchUpType:g})=>g===Ki):h,m=g=>g.sort((v,y)=>ar(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?wt(h.roundNumber):h.roundNumber;return p[f]||(p[f]=ht({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),r=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(r).map(f=>wt(f)).filter(f=>!isNaN(f))),h=(d=r[p])==null?void 0:d.length;if(h>1&&Pc(h)){let f=p+1,m=f+h/2;Ze(f,m).forEach((g,v)=>{r[g]=Ze(0,h/(2+v*2)).map(()=>({}))})}}let a=0,o=Object.assign({},...Object.keys(r).map(p=>{var g,v,y;let h=(g=r[p])==null?void 0:g.length,f=(y=(v=r[p])==null?void 0:v.filter(I=>{var b;return!gr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:y.length,m=h&&h===f;return a=Math.max(a,h),{[p]:{matchUpsCount:h,inactiveCount:f,inactiveRound:m}}})),s=0,l=0,c=Object.keys(r).map(p=>wt(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,g,v,y,I;let h=r[p].sort((b,D)=>b.roundPosition-D.roundPosition),f=h.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(o[p].roundNumber=p,o[p].roundFactor=o[p].matchUpsCount?a/o[p].matchUpsCount:1,o[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,o[p].roundName=(g=n[p])==null?void 0:g.roundName,o[p].abbreviatedRoundName=(v=n[p])==null?void 0:v.abbreviatedRoundName,o[p].finishingPositionRange=(I=(y=r[p])==null?void 0:y[0])==null?void 0:I.finishingPositionRange,p===1||!o[p-1]){let b=f.sort(ar),D=Fr(b,2);o[p].drawPositions=b,o[p].pairedDrawPositions=D}else{let b=o[p-1],D=b.drawPositions,w=b.matchUpsCount/o[p].matchUpsCount,S=Fr(D,w),U=h.map(C=>{let{roundPosition:E}=C,P=[...C.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return P;let M=(P==null?void 0:P.filter(Boolean))||[];if(!(M!=null&&M.length))return[void 0,void 0];if(p<3&&(M==null?void 0:M.length)===2)return P==null?void 0:P.slice().sort(ar);let N=kn(D,M).length!==(M==null?void 0:M.length);if(M!=null&&M.length&&N)return(M==null?void 0:M.length)===1?[M[0],void 0]:P==null?void 0:P.slice().sort(ar);let R=(E-1)*2;return S.slice(R,R+2).map(A=>M==null?void 0:M.find(_=>A.includes(_)))});o[p].drawPositions=U==null?void 0:U.flat(),o[p].pairedDrawPositions=U}o[p+1]&&o[p+1].matchUpsCount===o[p].matchUpsCount&&(o[p+1].feedRound=!0,o[p+1].feedRoundIndex=l,o[p].preFeedRound=!0,l+=1),o[p]&&!o[p].feedRound&&(o[p].roundIndex=s,s+=1)});let u=!!Object.values(o).find(({matchUpsCount:p})=>!Pc(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:a,roundMatchUps:r,roundNumbers:c,roundProfile:o,...ne}}function vv({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=at(t),n=e.split("."),r=[],a;s({targetElement:i,attributes:n});let o={value:a};return r.length&&(o.values=r),o;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>s({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var dte=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=vv({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=vv({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&vv({element:e,accessor:t}))==null?void 0:i.value)},jo=dte;function ND({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var g;if(!Js(a))return[];let{roundProfile:l,roundNumbers:c=[]}=Wa({interpolate:!0,matchUps:a});n=n??Math.max(...c,0);let u=r?n-r:0,d=u&&((g=l==null?void 0:l[n-u])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(jo("matchUpsCount")),h=(v,y)=>{let I=Math.min(...v);d&&y&&I===1&&(I=d);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},f=l&&Object.assign({},...c.map(v=>{let y=(n??0)+1-v-u,I=l[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},D=p==null?void 0:p.slice(v-1).reduce((N,R)=>N+(R||0),0),w=s&&v!==1,S=1+t+(w?i??0:0),U=1,C=Ze(S,o?S+I*2:D+S+U),E=D+U-I,P=h(C.slice(E)),M=h(C.slice(0,E),!0);return b.finishingPositionRange={loser:P,winner:M},{[v]:b}})),m=Hs({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];m&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function ca({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:o,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=o;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function _m({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return n?s.map(c=>Object.assign(at(c,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}var AD="SIGN_IN_STATUS",pte="SIGNED_OUT",eU="SIGNED_IN",$s="TEAM",Kt="INDIVIDUAL",vs="GROUP",kt="PAIR",ji="TEAM",yb={TEAM_PARTICIPANT:$s,INDIVIDUAL:Kt,GROUP:vs,TEAM:ji,PAIR:kt},Ua={INDIVIDUAL:Kt,GROUP:vs,PAIR:kt,TEAM:ji,SIGN_IN_STATUS:AD,SIGNED_OUT:pte,SIGNED_IN:eU};function Wj({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?at(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===ji),o=r.filter(l=>l.participantType===vs),s=r.filter(l=>l.participantType===kt);return r.forEach(l=>{if(l.participantType===Kt){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function qj({drawDefinition:t,attributes:e}){let{extension:i}=Vt({element:t,name:KM}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:KM,value:n},TA({drawDefinition:t,extension:i}),{entryProfile:n}}function _D({drawDefinition:t}){let{extension:e}=Vt({element:t,name:KM});return{entryProfile:(e==null?void 0:e.value)||{}}}var wl="ALTERNATE",kD="CONFIRMED",us="DIRECT_ACCEPTANCE",OD="FEED_IN",xD="JUNIOR_EXEMPT",gp="LUCKY_LOSER",LD="ORGANISER_ACCEPTANCE",FD="QUALIFIER",_Pe="REGISTERED",$D="SPECIAL_EXEMPT",Vl="UNGROUPED",dg="UNPAIRED",Hb="WILDCARD",vp="WITHDRAWN",B1=[kD,us,xD,LD,$D],hte=[OD,gp,FD],pg=[kD,us,OD,xD,LD,$D,Hb],jl=[kD,us,xD,gp,FD,LD,$D,Hb],fte=[wl,kD,us,OD,xD,gp,LD,FD,_Pe,$D,Vl,dg,Hb,vp],Gl={ALTERNATE:wl,CONFIRMED:kD,DIRECT_ACCEPTANCE:us,DIRECT_ENTRY_STATUSES:pg,DRAW_SPECIFIC_STATUSES:hte,EQUIVALENT_ACCEPTANCE_STATUSES:B1,FEED_IN:OD,JUNIOR_EXEMPT:xD,LUCKY_LOSER:gp,ORGANISER_ACCEPTANCE:LD,QUALIFIER:FD,SPECIAL_EXEMPT:$D,STRUCTURE_SELECTED_STATUSES:jl,UNGROUPED:Vl,UNPAIRED:dg,VALID_ENTRY_STATUSES:fte,WILDCARD:Hb,WITHDRAWN:vp};function Kj({stage:t,drawDefinition:e}){let{entryProfile:i}=_D({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&Dj.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return qj({drawDefinition:e,attributes:r}),!0}return n}function kPe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=_D({drawDefinition:e});return((n=i[t])==null?void 0:n.alternates)||0}function OPe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=_D({drawDefinition:e});return((n=i[t])==null?void 0:n.wildcardsCount)||0}function r$({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function Ly({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var v,y;let h=(y=(v=Vt({name:Tu,element:p}))==null?void 0:v.extension)==null?void 0:y.value,f=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),m=!r||p.entryStatus&&r.includes(p.entryStatus),g=p.entryStageSequence??1;return f&&(!n||g===n)&&m&&(!o||!h||o===h)?d.concat(p):d},[]))??[];if(a&&l===Rn){let{playoffEntries:d,error:p}=xPe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(h=>!e||h.placementGroup===e)}return c}function xPe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===fp&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:o}=r.source,{structure:s}=Ut({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===Qa&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var y;let{participantId:g}=m,v=(y=Vt({element:m,name:Hh}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,D=[...a??[]].sort(ar).indexOf(b)+1;n.push({entryStage:Rn,entryStatus:OD,placementGroup:D,groupingValue:d,participantId:m,GEMscore:I})})})}return{playoffEntries:n}}function LPe({stage:t,drawDefinition:e}){return pg.reduce((i,n)=>(r$({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function zs({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var f;let a,o=[];r||({structure:r,error:a}=Ut({drawDefinition:i,structureId:n}));let s=Bi({structure:r}).positionAssignments;if(a||!r)return{seedAssignments:[],error:bn};n||(n=r.structureId);let{stage:l,stageSequence:c}=r,u=l===Rn&&i&&Ly({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:n,stage:l}),d=u?u.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?o=p:r.seedAssignments?o=r.seedAssignments:a=uQ;let h=r.seedLimit??((f=r==null?void 0:r.positionAssignments)==null?void 0:f.length);return{seedAssignments:o,stageSequence:c,seedLimit:h,stage:l,error:a}}var mte="WALKOVER",K7="RETIRED",Yj="COMPETITIVE",tU="ROUTINE",iU="DECISIVE",V1="winRatio",FPe=(t,e)=>(t||0)+(e||0);function gte(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&mte||i<=e[iU]&&iU||i<=e[tU]&&tU||Yj}function vte({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(FPe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function $Pe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function yte(t){return t.map($Pe).sort().map(e=>parseFloat(e.toFixed(2)))}function Ei({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:CV};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...ne};function s(l){var u,d;let c=(d=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===qT))==null?void 0:d.value;if(c)for(let p of Object.keys(c))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=at(c[p],!1,!0))}}function Vp({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:CV};let{appliedPolicies:a}=Ei({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:fv.message}}function hg({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:Re};let{appliedPolicies:a}=Ei({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:fv==null?void 0:fv.message}}var BPe={[Zd]:{policyName:"Competitive Bands Default",profileBands:{[iU]:20,[tU]:50}}},Zj=BPe;function BD({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:To};let{score:n,winningSide:r}=i;if(!r)return{error:ve};let a=!e&&t&&hg({policyType:Zd,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||Zj[Zd].profileBands,s=vte({score:n}),l=yte([s]),c=gte(l,o),u=Array.isArray(l)?l[0]:l;return{...ne,competitiveness:c,pctSpread:u}}function Ite({matchUp:t}){var o,s,l;if(!t)return{error:To};if(t&&!t.sides)return{error:oo};if(t&&!t.hasContext)return{error:hA};let e=(o=t.sides??[])==null?void 0:o.map(c=>c==null?void 0:c.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===Kt}).map(c=>c.participantId).filter(Boolean))??[],n=(((l=t.sides??[])==null?void 0:l.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),r=[...i,...n.flat()].filter(Boolean)??[],a=Ft(r.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:a,individualParticipantIds:r,sideParticipantIds:e,...ne}}var ZM="CHECK_IN",XM="CHECK_OUT",VPe="SCHEDULE",f0="SCHEDULE.ASSIGNMENT.VENUE",yp="SCHEDULE.ALLOCATION.COURTS",km="SCHEDULE.ASSIGNMENT.COURT",Xj="SCHEDULE.COURT.ORDER",m0="SCHEDULE.DATE",jPe="COMPLETED.DATE",bte="SCHEDULE.ASSIGN.OFFICIAL",g0="SCHEDULE.TIME.SCHEDULED",dc="SCHEDULE.TIME.START",rp="SCHEDULE.TIME.STOP",Ku="SCHEDULE.TIME.RESUME",Ip="SCHEDULE.TIME.END",Jj="SCHEDULE.TIME.MODIFIERS",wte="TO_BE_ANNOUNCED",Ste="NEXT_AVAILABLE",Tte="FOLLOWED_BY",Ute="AFTER_REST",Dte="RAIN_DELAY",GPe="NOT_BEFORE",a$=[wte,Ste,Tte,Ute,Dte],HPe="ELIGIBILITY",zPe="REGISTRATION",WPe="SUSPENSION",qPe="MEDICAL",KPe="PENALTY",Pte="SCALE",Cte="RATING",Ete="RANKING",Qj="SEEDING",fg="PUBLISH",Hl="PUBLIC",mg="STATUS",YPe="MODIFICATION",ZPe="RETRIEVAL",XPe="other",$A={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:a$,AFTER_REST:Ute,ALLOCATE_COURTS:yp,ASSIGN_COURT:km,ASSIGN_OFFICIAL:bte,ASSIGN_VENUE:f0,CHECK_IN:ZM,CHECK_OUT:XM,COMPLETED_DATE:jPe,COURT_ORDER:Xj,ELIGIBILITY:HPe,END_TIME:Ip,FOLLOWED_BY:Tte,MEDICAL:qPe,MODIFICATION:YPe,NEXT_AVAILABLE:Ste,NOT_BEFORE:GPe,OTHER:XPe,PENALTY:KPe,PUBLIC:Hl,PUBLISH:fg,RANKING:Ete,RATING:Cte,RAIN_DELAY:Dte,REGISTRATION:zPe,RESUME_TIME:Ku,RETRIEVAL:ZPe,SCALE:Pte,SCHEDULE:VPe,SCHEDULED_DATE:m0,SCHEDULED_TIME:g0,SEEDING:Qj,START_TIME:dc,STATUS:mg,STOP_TIME:rp,SUSPENSION:WPe,TIME_MODIFIERS:Jj,TO_BE_ANNOUNCED:wte};function Fy({matchUp:t}){if(!t)return{error:To};if(!t.hasContext)return{error:hA};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:oo};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Ite({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[ZM,XM].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===ZM);e==null||e.forEach((s,l)=>{let c=n==null?void 0:n[l],u=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),n==null||n.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let o=n==null?void 0:n.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...ne}}var Mte={[Tn]:[Tn,"S"],[Wi]:[Wi,"D"],[Ki]:[Ki,"T"],S:[Tn,"S"],D:[Wi,"D"],T:[Ki,"T"]},An=t=>e=>{let i=Zi(e)&&(e==null?void 0:e.matchUpType)||Ga(e)&&e;return i&&Mte[t].includes(i)};function sT(t){var a;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=(e==null?void 0:e.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===i)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],r=n.includes(i)?i:n[0];return(a=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>r===l))&&s))==null?void 0:a.averageTimes}function lT(t){var r;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:n}=t||{};return(r=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&i){let{greaterThan:l=0,lessThan:c=360}=o;if(i>l&&i<c)return!0}return(a==null?void 0:a.find(l=>l===n))&&s}))==null?void 0:r.recoveryTimes}function Rte({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function JPe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&lT({...e,averageMinutes:i,matchUpFormat:r}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&lT({...t,averageMinutes:i,matchUpFormat:r}),u=(s==null?void 0:s.matchUpRecoveryTimes)&&lT({...s,averageMinutes:i,matchUpFormat:r}),d=[l,c,u,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,n==null?void 0:n.recoveryTimes];return Rte({categoryName:a,categoryType:o,timesBlockArray:d})}function QPe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var d;let s=(a==null?void 0:a.matchUpAverageTimes)&&sT({...a,matchUpFormat:t}),l=(r==null?void 0:r.matchUpAverageTimes)&&sT({...r,matchUpFormat:t}),c=(o==null?void 0:o.matchUpAverageTimes)&&sT({...o,matchUpFormat:t}),u=[s,l,c,(d=o==null?void 0:o.defaultTimes)==null?void 0:d.averageTimes,n==null?void 0:n.averageTimes];return Rte({categoryName:e,categoryType:i,timesBlockArray:u})}function VD({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var s,l,c,u,d,p;e=e??((s=n==null?void 0:n.category)==null?void 0:s.categoryName)??((l=n==null?void 0:n.category)==null?void 0:l.ageCategoryCode),i=i??((c=n==null?void 0:n.category)==null?void 0:c.categoryType)??((u=n==null?void 0:n.category)==null?void 0:u.subType);let{policy:r}=hg({policyType:wf,tournamentRecord:t,event:n}),a=(d=t?Vt({element:t,name:hp}).extension:void 0)==null?void 0:d.value,o=(p=n&&Vt({name:hp,element:n}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:a,eventScheduling:o,categoryName:e,categoryType:i,policy:r}}}var Nte="DOUBLES_SINGLES",Ate="SINGLES_DOUBLES",Sl="total",o$="participantConflict",wh="matchUpConflict",_te="ISSUE_IDS",im="CONFLICT",nm="WARNING",s$="ERROR",l$="ISSUE",j1="STATE",kte={SINGLES_DOUBLES:Ate,DOUBLES_SINGLES:Nte,TOTAL:Sl,CONFLICT_MATCHUP_ORDER:wh,CONFLICT_PARTICIPANTS:o$,SCHEDULE_ISSUE_IDS:_te,SCHEDULE_CONFLICT:im,SCHEDULE_WARNING:nm,SCHEDULE_ERROR:s$,SCHEDULE_ISSUE:l$,SCHEDULE_STATE:j1},md="SINGLES",Yv="SINGLES",Al="DOUBLES",Kh="DOUBLES",Tr="TEAM",Ws="TEAM",eCe="AGE",tCe="RATING",iCe="BOTH",Xo={AGE:eCe,BOTH:iCe,DOUBLES:Al,DOUBLES_EVENT:Kh,RATING:tCe,SINGLES:md,SINGLES_EVENT:Yv,TEAM_EVENT:Ws,TEAM:Tr};function jD({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:Re};o=o??(s==null?void 0:s.eventType)??Yv;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=VD({tournamentRecord:i,categoryName:r,categoryType:a,event:s}),u={...c,matchUpFormat:n,categoryType:a,defaultTiming:l};return BA({eventType:o,timingDetails:u})}function BA({timingDetails:t,eventType:e}){let i=QPe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=JPe({...t,averageMinutes:r}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=An(Yv)(e)?Ate:Nte,c=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function xE(t){return t.createdAt?new Date(t.createdAt).getTime():0}function gg({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(a=>a&&a.itemType===i&&(!t||xE(a)<new Date(t).getTime())).sort((a,o)=>xE(a)-xE(o)).pop(),r=n&&xE(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function c$({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:g0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function Om({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:m0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function Ote({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:yp,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:at(r,!1,!0)}:i}function xte({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:km,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:r}:i}function Lte({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:f0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:r}:i}function eG({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Jj,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function zg(t){if(kee.test(t)){let e=aj();return new Date(`${e}T${t}`)}else return new Date(t)}function nCe({matchUp:t}){if(!t)return{error:To};if(!t.timeItems)return{error:$V};let e=t.timeItems.filter(n=>[dc,rp,Ku,Ip].includes(n==null?void 0:n.itemType)).sort((n,r)=>zg(n.itemValue).getTime()-zg(r.itemValue).getTime()),i=e.reduce((n,r)=>{var l,c;let a,o=(l=r==null?void 0:r.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((c=r==null?void 0:r.itemType)==null?void 0:c.startsWith("SCHEDULE.TIME"))&&o[2]}`;switch(s){case dc:a=0;break;case Ip:if(n.lastValue&&[dc,Ku].includes(n.lastType)){let u=zg(r.itemValue).getTime()-zg(n.lastValue).getTime();a=n.milliseconds+u}else a=n.milliseconds;break;case rp:if([dc,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=zg(r.itemValue).getTime()-zg(n.lastValue).getTime();a=n.milliseconds+u}else a=n.milliseconds;break;default:a=n.milliseconds;break}return{milliseconds:a,lastType:s,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([dc,Ku].includes(i.lastType)){let n=new Date().getTime()-zg(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:rCe(i.milliseconds),relevantTimeItems:e}}function rCe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function aCe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=gg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Xj,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function oCe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(n=e.reduce((r,a)=>{let o=a.itemType===dc&&a;return o&&(!r||i(o)<i(r))?o:r},void 0))==null?void 0:n.itemValue}}function sCe(t=1){return Ze(0,t).map(Oi)}function Oi(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function GD(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:ve};let r=Uu(t);i.venueId||(i.venueId=Oi());let a;for(let o of Object.values(r)){let s=lCe({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||ei({topic:_j,payload:{venue:i}}),ht({...ne,venue:a})}function lCe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=Oi()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:HQ}:(i&&ci({element:n,extension:{value:i,name:Bee}}),t.venues.push(n),e||ei({payload:{venue:n,tournamentId:t.tournamentId},topic:_j}),{...ne,venue:at(n)})):{error:ut,info:"missing venue"}:{error:Re}}function jp({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Re};if(!i)return{error:vf};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(PD({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let o=t[a],s=jp({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return GD({tournamentRecord:e,venue:s.venue}),{...ne,venue:n}}}return n?{...ne,venue:n}:{error:t0}}function tG({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=jp({tournamentRecords:i,tournamentRecord:n,venueId:r});return at(a,t,!0)}function $y({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Re};if(!i)return{error:My};let n="findCourt",r,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(r=s,a=o)})}),r)return{...ne,court:r,venue:a};if(t){let o=(PD({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],c=$y({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&GD({tournamentRecord:e,venue:c.venue}),{...ne,court:r,venue:a}}}return ae({result:{error:yD},stack:n})}function Fte(t){return at($y(t),!1,!0)}function VA({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Re};if(!i)return{error:My};let n=$y({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...ne,courtInfo:at(r,!1,e)}}function zb({tournamentRecord:t,venueId:e}){var o;if(!t)return{error:Re};if(!e)return{error:vf};let i=jp({tournamentRecord:t,venueId:e});if(i.error)return i;let n=(((o=i.venue)==null?void 0:o.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(VA({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),r=i.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(i.venue),a=r&&{...r,courtsInfo:n};return{...ne,venueData:at(a,!1,!0)}}function cCe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(n=e.reduce((r,a)=>{let o=a.itemType===Ip&&a;return o&&(!r||i(o)>i(r))?o:r},void 0))==null?void 0:n.itemValue}}function Bn({event:t,eventId:e}){var r,a;if(!t)return{error:Ai};let i=(r=Vt({name:Ml,element:t}))==null?void 0:r.extension,n=e?at(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((a=t.drawDefinitions)==null||a.forEach(o=>{var s;(s=n==null?void 0:n.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:n}}function so(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=s.find(d=>{var h,f,m;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(p)c=p,l=a[d.eventId].tournamentId;else{let g=(m=(f=d&&((h=Bn({event:d}))==null?void 0:h.flightProfile))==null?void 0:f.flights)==null?void 0:m.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...ae({result:{error:Bo},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...ae({result:{error:$o},context:{drawId:n,eventId:i},stack:r})}}function jA(t){var w,S,U,C,E,P,M,N,R;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:n,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:o,scheduleTiming:s,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:To};if(r&&!u.matchUpType&&!t.matchUpType&&(e||a)&&u.drawId){let A=(w=e==null?void 0:e.drawDefinitions)==null?void 0:w.find(O=>O.drawId===u.drawId);!A&&a&&({drawDefinition:A,event:e}=so({tournamentRecord:a,drawId:u.drawId}));let _=u.structureId&&((S=A==null?void 0:A.structures)==null?void 0:S.find(({structureId:O})=>O===u.structureId));i=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(e==null?void 0:e.eventType)!==Tr&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=nCe({matchUp:u}),{startTime:h}=oCe({matchUp:u}),{endTime:f}=cCe({matchUp:u}),m,{visibilityThreshold:g,eventIds:v,drawIds:y}=n??{};if((!v||v.includes(u.eventId))&&(!y||y.includes(u.drawId))){let A={matchUp:u,visibilityThreshold:g},{allocatedCourts:_}=Ote(A),{scheduledTime:O}=c$(A),{scheduledDate:x}=Om(A),{venueId:F}=Lte(A),{courtId:$}=xte(A),{courtOrder:V}=aCe(A),{timeModifiers:G}=eG(A),j,z,H,K,q,Y=u.matchUpType??i;if(s&&O&&r&&Y){let ee={matchUpFormat:u.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:H=0,typeChangeRecoveryMinutes:K=0}=BA({timingDetails:ee,eventType:Y})),(z||H)&&(j=f?wo(tn(f),H):wo(O,z+H)),K&&(q=f?wo(tn(f),K):wo(O,z+K))}!x&&O&&(x=xt(O));let Z=VM({scheduledDate:x,scheduledTime:O}),Q={},ie=((U=a&&F&&zb({tournamentRecord:a,venueId:F}))==null?void 0:U.venueData)||{};F&&(Q[F]=ie);let{venueName:ue,venueAbbreviation:J,courtsInfo:te}=ie,se=(C=$&&(te==null?void 0:te.find(ee=>ee.courtId===$)))==null?void 0:C.courtName;for(let ee of _||[]){if(!a)break;ee.venueId&&!Q[ee.venueid]&&(Q[ee.venueId]=(E=zb({venueId:ee.venueId,tournamentRecord:a}))==null?void 0:E.venueData);let ce=Q[ee.venueId];ee.venueName=ce==null?void 0:ce.venueName;let fe=(P=ce==null?void 0:ce.courtsInfo)==null?void 0:P.find(ge=>ge.courtId===ee.courtId);ee.courtName=fe==null?void 0:fe.courtName}m=ht({typeChangeTimeAfterRecovery:q,timeAfterRecovery:j,scheduledDate:x,scheduledTime:O,isoDateString:Z,allocatedCourts:_,timeModifiers:G,venueAbbreviation:J,venueName:ue,venueId:F,courtOrder:V,courtName:se,courtId:$,typeChangeRecoveryMinutes:K,recoveryMinutes:H,averageMinutes:z,milliseconds:d,startTime:h,endTime:f,time:p})}else m=ht({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:I}=Om({matchUp:u}),{scheduledTime:b}=c$({matchUp:u});if(o&&((M=c==null?void 0:c.displaySettings)!=null&&M.draws)){let A=c.displaySettings.draws,_=(N=(A==null?void 0:A[u.drawId])??(A==null?void 0:A.default))==null?void 0:N.scheduleDetails;if(_){let O=(R=_.find(x=>{var F;return I&&((F=x.dates)==null?void 0:F.includes(I))})??_.find(x=>{var F;return!((F=x.dates)!=null&&F.length)}))==null?void 0:R.attributes;if(O){let x=Object.assign({},...Object.keys(m).map(F=>({[F]:!0})),O);m=Hv({source:m,template:x})}}}let D=u.matchUpStatus&&gr.includes(u.matchUpStatus)&&(xt(f)||xt(I)||xt(b))||void 0;return{schedule:m,endDate:D}}function Dh(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function cT({item:t,drawDefinition:e,structure:i,event:n}){var r,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(l=>t.tieFormatId===l.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function Ca({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:cT({item:i,drawDefinition:t,structure:e,event:n})||cT({item:e,drawDefinition:t,structure:e,event:n})||Dh(t)||Dh(n)}}function uCe({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function $te({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Fr(t,t.length/e).map(r=>r.reduce((a,o)=>a+o)),n=i.slice().sort(ar);return i.map(r=>n.indexOf(r)+1)}function G1(t){if(!Array.isArray(t))return"";let e=t.filter(En);return e.length?Ft([Math.min(...e),Math.max(...e)]).join("-"):""}function dCe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:et};if(!e)return{error:gs};let{structure:n}=Ut({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==ra)return{error:og,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],s=Object.assign({},...o.map(d=>{let p=_m({structureId:d,matchUpsMap:i}),h=Wa({matchUps:p}).roundProfile;return{[d]:h}})),l=_m({matchUpsMap:i,structureId:e}),{roundProfile:c}=Wa({matchUps:l}),u={};return a==null||a.forEach(d=>{var M,N,R;let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=s[p],I=(M=y[1])==null?void 0:M.drawPositions,b=(N=y[h])==null?void 0:N.matchUpsCount;if(!b)return;let D=b?I.length/b:0,w=I.length/D,S=I.slice(),U=$te({roundPositionsCount:w,groupedOrder:m}),C=(U==null?void 0:U.length)||1;if(C<=w){let A=I.length/C,_=Fr(S,A);f===Nm&&_.forEach(O=>O.reverse()),S=(U==null?void 0:U.length)&&(U==null?void 0:U.map(O=>_[O-1]).flat())||S}let E=Fr(S,D);if(g){let A=Ze(0,g.interleave).map(()=>{}),_=Ze(0,g.offset).map(()=>{});E=E.map(x=>[x,...A]),E.unshift(_),E=E.flat(1);let O=E.length-g.offset;E=E.slice(0,O)}u[v]||(u[v]={});let P=(R=c==null?void 0:c[v])!=null&&R.feedRound?2:1;E.forEach((A,_)=>{let O=1+_*P;u[v][O]||(u[v][O]=G1(A))})}),{sourceDrawPositionRanges:u}}function Gp({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=Vp({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[Zd])??(o==null?void 0:o[Zd])??Zj[Zd];a.policies[Zd]=s}return a}function pCe({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let n=[void 0,void 0];if(mee(t))return{orderedDrawPositions:n,displayOrder:n};let r=e==null?void 0:e[i],a=((s=r==null?void 0:r.pairedDrawPositions)==null?void 0:s.find(l=>za(l||[],t.filter(Boolean))))??n,o=r==null?void 0:r.feedRound;if(fee(t)){let l=[...t].sort(ar);return{orderedDrawPositions:l.length===2?l:a,displayOrder:o?l:a}}if(o){let l=[t.find(c=>!isNaN(wt(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:a,displayOrder:a}}function JM({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function _l({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:Re};if(!Array.isArray(i)||i.length>2)return{error:bl};if(!i.length)return ae({result:{error:gf},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===kt&&kn(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=r[0];if(!a)return ae({result:{error:jn},stack:n});let o=at(r.slice(1),!1,!0);return{participant:at(a),duplicatedPairParticipants:o,...ne}}function xm({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:et};if(typeof e!="string")return{error:mr};let{extension:i}=Vt({element:t,name:pp});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function hCe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var g,v,y,I;let{assignedParticipantIds:f,substitutions:m}=JM({collectionPosition:i,collectionId:o,lineUp:p});if(l===Wi){if((f==null?void 0:f.length)<=2){let b=(v=(g=r==null?void 0:r[f[0]])==null?void 0:g.pairIdMap)==null?void 0:v[f[1]],D=(I=b&&((y=r[b])==null?void 0:y.participant)||_l({participantIds:f,tournamentParticipants:t}).participant)==null?void 0:I.participantId;return{[d]:{participantId:D,teamParticipant:h,substitutions:m}}}else if((f==null?void 0:f.length)>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let b=f==null?void 0:f[0];return b&&{[d]:{participantId:b,teamParticipant:h,substitutions:m}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||((g=xm({participantId:h.teamParticipantId,drawDefinition:a}))==null?void 0:g.lineUp);return c({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var g,v,y;let p=(g=e.find(I=>I.drawPosition===d))==null?void 0:g.participantId,h=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),f=(h==null?void 0:h.teamParticipant)||p&&((v=r==null?void 0:r[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:I})=>I===p)),m=(h==null?void 0:h.lineUp)||((y=xm({participantId:p,drawDefinition:a}))==null?void 0:y.lineUp);return c({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function Bte({drawDefinition:t}){if(typeof t!="object")return{error:hv};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(r)){let s=r[o].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){o[l]||(o[l]=[]),s==="0"&&[ra,Rn].includes(d)||o[l].push(s);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${s}-${f}`,structureId:g,exitProfiles:o,targetRound:m,aggregator:u,stage:v})}}}function fCe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var o;if(!t)return{error:et};if(!i)return{error:gs};if(!e){let s=_m({matchUpsMap:n,structureId:i});if({roundProfile:e}=Wa({matchUps:s}),!e)return{error:ut}}let r=(Math.min(...((o=e==null?void 0:e[1])==null?void 0:o.drawPositions)??[])||1)-1,a=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(a||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,c=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],u=Fr(c,c.length/l),d=u.map(G1),p=u.map(I=>I.map(b=>b-r)).map(G1),h=a.map(I=>{var D;if(I>s)return;let b=((D=e==null?void 0:e[I])==null?void 0:D.drawPositions)??[];return Fr(b,b.length/l)}).filter(Boolean),f=Ze(0,l).map(I=>h.map(b=>b[I]).flat().filter(Boolean).sort(ar)).map(I=>Ft(I)),m=f.map(I=>NDe(I).map(G1).join(", ")),g=Object.assign({},...Ze(0,l).map(I=>({[I+1]:{firstRoundDrawPositionsRange:d[I],firstRoundOffsetDrawPositionsRange:p[I],possibleDrawPositions:f[I],drawPositionsRange:m[I]}})));return{[s]:g}}))}}function iG({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var a;if(!i)return!1;n=n??i.matchUps??[],t=t??Wa({matchUps:n}).roundsNotPowerOf2;let r=!!((a=i.positionAssignments)!=null&&a.find(({drawPosition:o})=>o))||!!(n!=null&&n.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==cg)&&!(i!=null&&i.structures)&&t&&r}function Go({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==kr&&(!e.length||!i&&!n)}var nG={[xb]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[it]:"",[Rn]:"P",[mt]:"Q",[ra]:"C"}}},mCe=nG;function gCe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var M,N,R;let{roundProfile:r,roundMatchUps:a}=Wa({matchUps:n}),{structureAbbreviation:o,stage:s}=i,l=Go({structure:i}),c=iG({structure:i}),u=i.structures,d={},p=nG[xb],h=i.stage===mt,f=h?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===mt).map(({stageSequence:A})=>A??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(((M=t==null?void 0:t.affixes)==null?void 0:M.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},I=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,b=((R=t==null?void 0:t.affixes)==null?void 0:R.roundNumber)||p.affixes.roundNumber,D=((t==null?void 0:t.namingConventions)||p.namingConventions).round,w=s&&s!==it?s[0]:"",S=(t==null?void 0:t.stageConstants)||p.stageConstants,U=s&&(S==null?void 0:S[s])||w,C=`${g}${U}${m}`,E=r?Object.keys(r):[],P=h&&(S!=null&&S[mt])?`${S==null?void 0:S[mt]}-`:"";if(u||l||c)Object.assign(d,...E.map(A=>{let _=`${P}${D} ${A}`,O=`${b}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:O}}}));else{let A=h&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...E.map(_=>{if(!(r!=null&&r[_]))return;let{matchUpsCount:O,preFeedRound:x}=r[_],F=O*2,$=(A==null?void 0:A[r==null?void 0:r[_].finishingRound])||A&&`${b}${F}`||v[O]||`${b}${F}`,V=x?`-${I}`:"",G=`${$}${V}`,j=[C,o,G].filter(Boolean).join("-"),z=`${y[O]||`${b}${F}`}${V}`,H=[C,o,z].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:H,roundName:j}}}))}return{roundNamingProfile:d,roundProfile:r,roundMatchUps:a}}function GA(t){var r,a,o;let e=gi(t,[{[If]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,n=i==null?void 0:i.matchUpType;if(!n&&((r=i==null?void 0:i.sides)!=null&&r.length)){let s=(o=(a=i.sides.find(({participant:l})=>l))==null?void 0:a.participant)==null?void 0:o.participantType;n=s===Kt&&Tn||s===kt&&Wi||s===ji&&ji||void 0}return{matchUpType:n}}var vCe="normal",Y7="timed",yCe="final",rG="NOAD",H1="SET",ICe={S:vCe,F:yCe};function fo(t){if(typeof t=="string"){let e=t.startsWith("T")&&Y7||t.startsWith(H1)&&H1||"";if(e===Y7){let i=jte(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===H1)return bCe(t)}}function bCe(t){let e=t.split("-"),i=HD(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&Z7(e[1]),o=e&&Z7(e[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,c=!e[2]||o,u=a,d=ht({setFormat:a,exactly:r,bestOf:n});if(o&&(d.finalSetFormat=o),l&&u&&c)return d}function Z7(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=ICe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=X7(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return jte(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&Gte(r[2])||!1,o=!(r!=null&&r[2])||a,s=r?HD(r[1]):void 0,l=Vte(n),c=l!==!1,u=c&&l||s,d=X7(n.split("/")[1]),p=d!==!1,h={setTo:s};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,s&&o&&p&&c&&h||!1}}}function Vte(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?HD(i[1]):i[1])||!1}function X7(t){if(t)if(t.startsWith("TB")){let e=Vte(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&Gte(i[2]),a=!(i!=null&&i[2])||r,o=HD(n);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!Mt(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function jte(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),n=HD(i==null?void 0:i[1]);if(!n)return;let r={timed:!0,minutes:n},a=i==null?void 0:i[2],o=[void 0,"P","G"].includes(a);if(a&&!o){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(r.modifier=l,r):void 0}return a&&(r.based=i[2]),r}function Gte(t){return t&&t.indexOf(rG)>=0}function HD(t){return isNaN(Number(t))?0:Number(t)}function HA(t,e){return!Array.isArray(t)||!Ga(e)?!1:kn(t,Mte[e]).length}function ov(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:c,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:h,stageSequences:f,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:I,matchUpTypes:b,structureIds:D,readyToScore:w,courtIds:S,eventIds:U,venueIds:C,drawIds:E,stages:P,filterMatchUpIds:M=!0,filterMatchUpTypes:N=!0}=t,R=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],O=Array.isArray(P)?P.filter(Boolean):[],x=Array.isArray(f)?f.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],V=Array.isArray(d)?d.filter(Boolean):[],G=Array.isArray(s)?s.filter(Boolean):[],j=Array.isArray(p)&&M?p.filter(Boolean):[],z=Array.isArray(b)&&N?b.filter(Boolean):[],H=Array.isArray(S)?S.filter(Boolean):[],K=Array.isArray(C)?C.filter(Boolean):[],q=Array.isArray(o)&&o.filter(Boolean)||typeof l=="string"&&[l]||[],Y=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],Z=Array.isArray(I)?I.filter(Boolean):[],Q=Array.isArray(U)?U.filter(Boolean):[],ie=Array.isArray(E)?E.filter(Boolean):[],ue=Array.isArray(D)?D.filter(Boolean):[];return e.filter(J=>{var te;if(w&&!An(lu)(J)&&!J.readyToScore||J.winningSide&&a&&![1,2].includes(J.winningSide)||u!==void 0&&(u&&!J.tieMatchUps||!u&&J.tieMatchUps)||i!==void 0&&(i&&!J.collectionId||!i&&J.collectionId)||O.length&&!O.includes(J.stage)||x.length&&!x.includes(J.stageSequence)||F.length&&(!J.collectionId||!F.includes(J.collectionId))||$.length&&(!J.roundName||!$.includes(J.roundName))||V.length&&(!J.roundNumber||!V.includes(J.roundNumber))||G.length&&(!J.roundPosition||!G.includes(J.roundPosition))||A.length&&(!J.matchUpStatus||!A.includes(J.matchUpStatus))||_.length&&J.matchUpStatus&&_.includes(J.matchUpStatus)||j.length&&!j.includes(J.matchUpId)||z.length&&(!J.matchUpType||!HA(z,J.matchUpType))||q.length&&(!J.matchUpFormat||!q.includes(J.matchUpFormat)))return!1;if(Y!=null&&Y.length){let{scheduledTime:se}=c$({matchUp:J}),{scheduledDate:ee}=Om({matchUp:J}),ce=xt(se)||ee;if(!Y.find(fe=>cd(fe,ce)))return!1}if(H.length){let{courtId:se}=xte({matchUp:J}),{allocatedCourts:ee}=Ote({matchUp:J}),ce=ee==null?void 0:ee.map(({courtId:fe})=>fe);if(!H.filter(Boolean).includes(se)||ce!=null&&ce.includes(se))return!1}if(K.length){let{venueId:se}=Lte({matchUp:J});if(!K.filter(Boolean).includes(se))return!1}if(y){if(Z.length&&!Z.includes(J.tournamentId)||Q.length&&!Q.includes(J.eventId)||ie.length&&!ie.includes(J.drawId)||ue.length&&!ue.includes(J.structureId))return!1;if(R.length){let se=((te=J.sides)==null?void 0:te.map(({participantId:ee})=>ee).filter(Boolean))??[];if(!R.some(ee=>se.includes(ee)))return!1}}return!0})}function wCe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var h,f,m,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===a),c=a&&t,u=s&&e,d=c?(h=c[a])==null?void 0:h.participantId:l==null?void 0:l.participantId,p=l?SCe({displaySideNumber:n,seedAssignments:r,participantId:d,assignment:l,sideNumber:s}):{...u==null?void 0:u[s]};if(o&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),a&&c){let v=(f=c[a])==null?void 0:f.teamParticipant,y=(m=c[a])==null?void 0:m.participant,I=(g=c[a])==null?void 0:g.substitutions;y&&(p.participant=y),I&&(p.substitutions=I),v&&(p.teamParticipant=v)}return p}function SCe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let o=TCe({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function TCe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var cu="ANY",Hi="MALE",Lo="MIXED",sv="OTHER",fn="FEMALE",Du={ANY:cu,MALE:Hi,FEMALE:fn,MIXED:Lo,OTHER:sv};function Ti({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:h,contextProfile:f,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:I,structure:b,inContext:D,event:w}){var Ce,Fe,Je,xe,st;let S={},U={};if(n=n??(o==null?void 0:o.participants),!b)return{collectionPositionMatchUps:S,error:mf,roundMatchUps:U,matchUps:[]};let C=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],E=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],P=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],M=!(v!=null&&v.eventId)||!(C!=null&&C.length)&&!((Ce=c==null?void 0:c.eventIds)!=null&&Ce.filter(Boolean).length)||(C==null?void 0:C.includes(v.eventId))||((Fe=c==null?void 0:c.eventIds)==null?void 0:Fe.includes(v.eventId)),N=!(E!=null&&E.length)||E.includes(b.structureId),R=!m||!(P!=null&&P.length)||P.includes(m.drawId);if(!M||!N||!R)return{collectionPositionMatchUps:S,roundMatchUps:U,matchUps:[]};f&&!u&&(u=Gp({tournamentRecord:o,contextProfile:f,drawDefinition:m}));let{appliedPolicies:A}=Ei({drawDefinition:m}),_={...e,...A,...a},O=(Je=_==null?void 0:_.scoring)==null?void 0:Je.structures,x=b.stage&&(O==null?void 0:O.stage)&&(O==null?void 0:O.stage[b.stage]),F=b.stageSequence&&(x==null?void 0:x.stageSequence)&&x.stageSequence[b.stageSequence],$=((xe=_==null?void 0:_.scoring)==null?void 0:xe.requireAllPositionsAssigned)||(x==null?void 0:x.requireAllPositionsAssigned)||(F==null?void 0:F.requireAllPositionsAssigned);I||(I=ca({drawDefinition:m,structure:b}));let{positionAssignments:V,allPositionsAssigned:G}=Er({structure:b}),j=!$||G,{seedAssignments:z}=zs({provisionalPositioning:i,drawDefinition:m,structure:b});s=s??z;let{roundOffset:H,structureId:K,structureName:q,stage:Y,stageSequence:Z}=b,{drawId:Q,drawName:ie,drawType:ue}=m??{};y=y||m&&Bte({drawDefinition:m}).exitProfiles;let J=y==null?void 0:y[K],te=(J==null?void 0:J.length)&&(J[0].split("-").map(we=>parseInt(we)).reduce((we,Oe)=>we+Oe)||0),se=!!b.structures,ee=_m({matchUpsMap:I,structureId:K,inContext:D}),ce=_==null?void 0:_[xb],fe=gCe({roundNamingPolicy:ce,drawDefinition:m,structure:b,matchUps:ee}),{roundNamingProfile:ge,roundProfile:he}=fe;if(U=(fe==null?void 0:fe.roundMatchUps)??[],d&&(ee=ov({matchUps:ee,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),D){let{sourceDrawPositionRanges:we}=dCe({drawDefinition:m,matchUpsMap:I,structureId:K}),Oe=m?fCe({drawDefinition:m,roundProfile:he,matchUpsMap:I,structureId:K}).drawPositionsRanges:void 0;ee=ee.map(ye=>Se({scheduleVisibilityFilters:t,sourceDrawPositionRanges:we,drawPositionsRanges:Oe,roundNamingProfile:ge,initialRoundOfPlay:te,appliedPolicies:_,usePublishState:l,publishStatus:g,isRoundRobin:se,roundProfile:he,matchUp:ye,event:w})),(ee==null?void 0:ee.filter(ye=>Array.isArray(ye.tieMatchUps))).forEach(ye=>{let Be=ye.tieMatchUps;ee=ee.concat(...Be)}),c&&(ee=ov({processContext:!0,...c,matchUps:ee}))}else(ee==null?void 0:ee.filter(we=>Array.isArray(we.tieMatchUps))).forEach(we=>{let Oe=we.tieMatchUps;ee=ee.concat(...Oe)});return d&&(ee=ov({matchUps:ee,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(ee=ov({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ee})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||D)&&(U=Wa({matchUps:ee}).roundMatchUps??[]),(st=Ca({drawDefinition:m,structure:b,event:w}))!=null&&st.tieFormat&&({collectionPositionMatchUps:S}=uCe({matchUps:ee})),{collectionPositionMatchUps:S,roundMatchUps:U,isRoundRobin:se,roundProfile:he,matchUpsMap:I,matchUps:ee};function Se({scheduleVisibilityFilters:we,sourceDrawPositionRanges:Oe,drawPositionsRanges:ye,initialRoundOfPlay:Be,additionalContext:Ee,roundNamingProfile:qe,tieDrawPositions:Ge,appliedPolicies:me,isCollectionBye:Me,usePublishState:De,publishStatus:Ae,matchUpTieId:ze,isRoundRobin:de,roundProfile:pe,sideLineUps:ke,matchUp:Ue,event:Te}){var Hf,We,Xt,Yn,Da,ic,Au,sn,nr,dh,_u,sl,ln,yi,Ir;Ee=Ee??{};let rt=(Hf=Ca({drawDefinition:m,structure:b,matchUp:Ue,event:Te}))==null?void 0:Hf.tieFormat,je=rt==null?void 0:rt.collectionDefinitions,Le=Ue.collectionId&&(je==null?void 0:je.find(pi=>pi.collectionId===Ue.collectionId)),It=Ue.collectionId?Le==null?void 0:Le.matchUpFormat:Ue.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(Te==null?void 0:Te.matchUpFormat),zt=Ue.matchUpType||(Le==null?void 0:Le.matchUpType)||(b==null?void 0:b.matchUpType)||(m==null?void 0:m.matchUpType)||!An(Tr)(Te==null?void 0:Te.eventType)&&(Te==null?void 0:Te.eventType),Jt=Me?bi:Ue.matchUpStatus,{schedule:Yr,endDate:Eo}=jA({scheduleVisibilityFilters:we,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:De,scheduleTiming:h,matchUpFormat:It,publishStatus:Ae,matchUpType:zt,matchUp:Ue,event:Te}),Qt=Ge??Ue.drawPositions??[],{collectionPosition:yr,collectionId:Kn,roundPosition:yt}=Ue,cr=Ue.roundNumber??Ee.roundNumber,Jo=Kn?hCe({tournamentParticipants:n,positionAssignments:V,collectionPosition:yr,drawDefinition:m,participantMap:p,drawPositions:Qt,collectionId:Kn,sideLineUps:ke,matchUpType:zt}):void 0,Qo=((We=qe==null?void 0:qe[cr])==null?void 0:We.roundName)||Ee.roundName,vo=((Xt=qe==null?void 0:qe[cr])==null?void 0:Xt.abbreviatedRoundName)||Ee.abbreviatedRoundName,Od=(Yn=pe==null?void 0:pe[cr])==null?void 0:Yn.feedRound,Aa=(Da=pe==null?void 0:pe[cr])==null?void 0:Da.preFeedRound,es=(ic=pe==null?void 0:pe[cr])==null?void 0:ic.roundFactor,Ql=ye==null?void 0:ye[cr],Vg=yt?Ql==null?void 0:Ql[yt]:void 0,uh=Oe==null?void 0:Oe[cr],Ru=Le!=null&&Le.category?{...(v==null?void 0:v.category)||{},...Le.category}:(v==null?void 0:v.category)??(Te==null?void 0:Te.category),Nu=((Au=Ue.processCodes)==null?void 0:Au.length)&&Ue.processCodes||((sn=Le==null?void 0:Le.processCodes)==null?void 0:sn.length)&&(Le==null?void 0:Le.processCodes)||((nr=b==null?void 0:b.processCodes)==null?void 0:nr.length)&&(b==null?void 0:b.processCodes)||((dh=m==null?void 0:m.processCodes)==null?void 0:dh.length)&&(m==null?void 0:m.processCodes)||((_u=Te==null?void 0:Te.processCodes)==null?void 0:_u.length)&&(Te==null?void 0:Te.processCodes)||(o==null?void 0:o.processCodes),ec=(f==null?void 0:f.withCompetitiveness)&&BD({...u,matchUp:Ue}),tc=Ue.finishingPositionRange??Ee.finishingPositionRange,to=pi=>ht(pi,void 0,!0),di={...to(v),...to({matchUpFormat:Ue.matchUpType===Tr?void 0:It,tieFormat:Ue.matchUpType!==Tr?void 0:rt,gender:(Le==null?void 0:Le.gender)??(Te==null?void 0:Te.gender),roundOfPlay:Y!==mt&&Mt(Be)&&Be+(cr||0),endDate:Ue.endDate??Eo,discipline:Te==null?void 0:Te.discipline,category:Ru,finishingPositionRange:tc,abbreviatedRoundName:vo,drawPositionsRange:Vg,competitiveProfile:ec,structureName:q,stageSequence:Z,drawPositions:Qt,matchUpStatus:Jt,processCodes:Nu,isRoundRobin:de,matchUpTieId:ze,preFeedRound:Aa,matchUpType:zt,roundFactor:es,roundOffset:H,structureId:K,roundNumber:cr,feedRound:Od,roundName:Qo,drawName:ie,drawType:ue,schedule:Yr,drawId:Q,stage:Y}),...at(to(Ue),!0,!0)};if(It&&((sl=Ue.score)!=null&&sl.scoreStringSide1)){let pi=fo(It),{bestOf:br,finalSetFormat:lt,setFormat:_t}=pi??{};(lt!=null&&lt.tiebreakSet||_t!=null&&_t.tiebreakSet||_t!=null&&_t.timed)&&(di.score.sets=di.score.sets.sort((Ii,dn)=>Ii.setNumber-dn.setNumber).map((Ii,dn)=>(dn+1===br?(lt!=null&&lt.tiebreakSet||lt!=null&&lt.timed)&&(Ii.tiebreakSet=!0):(_t!=null&&_t.tiebreakSet||_t!=null&&_t.timed)&&(Ii.tiebreakSet=!0),Ii)))}if(Array.isArray(Qt)){let{orderedDrawPositions:pi,displayOrder:br}=pCe({drawPositions:Qt,roundProfile:pe,roundNumber:cr}),lt=(ln=pe==null?void 0:pe[cr])==null?void 0:ln.feedRound,_t=br[0]!==pi[0],Ii=pi.concat(void 0,void 0).slice(0,2).map((dn,Nt)=>{var Wf;let Ri=Nt+1,pa=_t?3-Ri:Ri,nc=wCe({...Jo,positionAssignments:V,displaySideNumber:pa,seedAssignments:s,drawPosition:dn,isFeedRound:lt,sideNumber:Ri}),rc=(Wf=Ue.sides)==null?void 0:Wf.find(qf=>qf.sideNumber===Ri),xd=yt?(yt-1)*2+Nt+1:void 0,zf=xd?uh==null?void 0:uh[xd]:void 0;return to({sourceDrawPositionRange:zf,...rc,...nc})});Object.assign(di,at({sides:Ii},!0,!0))}if(n&&di.sides){let pi=me==null?void 0:me[l0],br=lt=>{var Ii;let _t=(Ii=p==null?void 0:p[lt])==null?void 0:Ii.participant;return _t&&Hv({template:pi==null?void 0:pi.participant,source:_t})};if(di.sides.filter(Boolean).forEach(lt=>{var _t,Ii,dn;if(lt.participantId){let Nt=at(br(lt.participantId)||n&&Gh({policyDefinitions:me,participantId:lt.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(Nt){if(m!=null&&m.entries){let Ri=m.entries.find(pa=>pa.participantId===lt.participantId);Ri!=null&&Ri.entryStatus&&(Nt.entryStatus=Ri.entryStatus),Ri!=null&&Ri.entryStage&&(Nt.entryStage=Ri.entryStage)}Object.assign(lt,{participant:Nt})}}if((Ii=(_t=lt==null?void 0:lt.participant)==null?void 0:_t.individualParticipantIds)!=null&&Ii.length&&!((dn=lt.participant.individualParticipants)!=null&&dn.length)){let Nt=lt.participant.individualParticipantIds.map(Ri=>br(Ri)||n&&Gh({policyDefinitions:me,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:Ri}));Object.assign(lt.participant,{individualParticipants:Nt})}}),!di.matchUpType){let{matchUpType:lt}=GA({matchUp:di});lt&&Object.assign(di,{matchUpType:lt})}if(f!=null&&f.inferGender&&(!di.gender||di.gender===Lo)&&((yi=di.sides)==null?void 0:yi.length)===2&&di.matchUpType!==Tr){let lt=di.sides.map(_t=>{var Ii,dn,Nt,Ri;if(An(Tn)(di.matchUpType))return(dn=(Ii=_t.participant)==null?void 0:Ii.person)==null?void 0:dn.sex;if(((Ri=(Nt=_t.participant)==null?void 0:Nt.individualParticipants)==null?void 0:Ri.length)===2){let pa=Ft(_t.participant.individualParticipants.map(nc=>{var rc;return(rc=nc.person)==null?void 0:rc.sex})).filter(Boolean);if(pa.length===1)return pa[0]}});if(lt.filter(Boolean).length===2&&Ft(lt).length===1){let _t=lt[0];di.inferredGender=_t}}}if(di.tieMatchUps){let pi=di.matchUpStatus===bi,br=(Ir=di.sides)==null?void 0:Ir.map(({participant:lt,drawPosition:_t,sideNumber:Ii,lineUp:dn})=>{let Nt=(lt==null?void 0:lt.participantType)===Tr&&lt;return{teamParticipant:Nt&&ht({participantRoleResponsibilities:Nt.participantRoleResponsibilities,participantOtherName:Nt.participanOthertName,participantName:Nt.participantName,participantId:Nt.participantId,teamId:Nt.teamId}),drawPosition:_t,sideNumber:Ii,lineUp:dn}});di.tieMatchUps=di.tieMatchUps.map(lt=>{let _t=di.matchUpId,Ii={finishingPositionRange:di.finishingPositionRange,abbreviatedRoundName:vo,roundNumber:cr,roundName:Qo};return Se({tieDrawPositions:Qt,scheduleVisibilityFilters:we,sourceDrawPositionRanges:Oe,sideLineUps:br,drawPositionsRanges:ye,initialRoundOfPlay:Be,roundNamingProfile:qe,additionalContext:Ii,appliedPolicies:me,isCollectionBye:pi,usePublishState:De,publishStatus:Ae,matchUpTieId:_t,isRoundRobin:de,roundProfile:pe,matchUp:lt,event:Te})})}let jf=di.sides&&di.sides.filter(pi=>pi==null?void 0:pi.participantId).length===2,Gf=!di.winningSide;if(Object.assign(di,{readyToScore:j&&jf&&Gf,hasContext:!0}),jf){let{allParticipantsCheckedIn:pi,checkedInParticipantIds:br}=Fy({matchUp:di});Object.assign(di,{allParticipantsCheckedIn:pi,checkedInParticipantIds:br})}return Array.isArray(f==null?void 0:f.exclude)&&(f==null||f.exclude.forEach(pi=>delete di[pi])),di}}function Sm({matchUp:t}){return t?gr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function zA({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:I,structure:b,context:D,event:w}){!b&&y&&({structure:b}=Ut({drawDefinition:m,structureId:y}));let S=Ti({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:b,inContext:I,context:D,event:w}),U=[],C=[],E=[],P=[],M=[];if(S.error)return S;let{matchUps:N}=S,{assignedPositions:R}=Er({structure:b}),A=R==null?void 0:R.filter(O=>O.participantId).map(O=>O.drawPosition),_;return N.filter(O=>{var F;let x=((F=l==null?void 0:l.matchUpTypes)==null?void 0:F.length)===1&&l.matchUpTypes[0]===Ki;return!(O.matchUpType!==Ki&&x)}).forEach(O=>{var H,K,q,Y;if(O.matchUpStatus===cs){U.push(O);return}O.matchUpType===Ki&&(_=!0);let x=O.collectionId,F=x&&((H=O.sides)==null?void 0:H.every(Z=>Z.participantId)),$=!x&&((K=O.drawPositions)==null?void 0:K.filter(Boolean).length)===2,V=!x&&((q=O.drawPositions)==null?void 0:q.every(Z=>A==null?void 0:A.includes(Z))),G=R==null?void 0:R.filter(Z=>Z.bye).map(Z=>Z.drawPosition),j=!x&&((Y=O.drawPositions)==null?void 0:Y.find(Z=>G==null?void 0:G.includes(Z))),z=Tj.includes(O.matchUpStatus)&&(F||$&&(!t||V));return j?M.push(O):Sm({matchUp:O})?C.push(O):z?E.push(O):P.push(O)}),{includesTeamMatchUps:_,abandonedMatchUps:U,completedMatchUps:C,upcomingMatchUps:E,pendingMatchUps:P,byeMatchUps:M,structure:b}}function UCe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:et};if(!i)return{error:gs};let{links:n}=v0({drawDefinition:t,structureId:i}),r=n.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=n.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:r,target:a}}}function eL({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var a;let r=n.find(o=>{var l,c;let s=!((l=o.source)!=null&&l.finishingPositions)||!t||za(t,(c=o.source)==null?void 0:c.finishingPositions);return e===o.linkCondition&&s&&o.linkType===i});return[mp,dd].includes(r==null?void 0:r.linkType)&&!((a=r==null?void 0:r.source)!=null&&a.roundNumber)?ae({result:{error:ve},stack:"getTargetLink",context:r}):r}function v0({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,o;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((o=r.target)==null?void 0:o.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:gs}:{error:et}}function DCe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===r.length?o=a.find(s=>s.roundPosition===n):a.length===r.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:o}}return{message:"no progression found"}}function tL({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var C;if(!r)return{error:wV};let{target:{structureId:a,feedProfile:o,groupedOrder:s,roundNumber:l,positionInterleave:c}}=r,{structure:u}=Ut({drawDefinition:n,structureId:a}),{positionAssignments:d}=Bi({structure:u}),p=(e==null?void 0:e.filter(E=>E.structureId===(u==null?void 0:u.structureId))).filter(E=>E.roundNumber===l&&!E.matchUpTieId),h=p.length,f=Ze(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(c!=null&&c.interleave&&m!==.5){let E=c.offset+(i-1)*c.interleave,P=i+E;g=Math.ceil(P/2),v=1-P%2}let y=f,I=f[g-1],b=$te({roundPositionsCount:f.length,groupedOrder:s}),D=(b==null?void 0:b.length)||1;if(D<=f.length){let E=h/D,P=Fr(f,E);o===Nm&&P.forEach(M=>M.reverse()),y=(b==null?void 0:b.length)&&(b==null?void 0:b.map(M=>P[M-1]).flat())||y}o===gl?I=y[g-1]:o===Nm?((!(b!=null&&b.length)||D>f.length)&&(g=p.length+1-g),I=y[g-1]):o===NA&&Hs()&&console.log(gA,{feedProfile:o});let w=I&&p.reduce((E,P)=>P.roundPosition===I?P:E,void 0),S;w!=null&&w.feedRound?(v=0,S=Math.min(...(w.drawPositions||[]).filter(Boolean))):S=((C=w==null?void 0:w.drawPositions)==null?void 0:C.length)===2&&(w==null?void 0:w.drawPositions[v]);let U=d==null?void 0:d.find(({drawPosition:E})=>E===S);if(U){let{extension:E}=Vt({element:U,name:PA});if(E!=null&&E.value)return{disabledDrawPosition:S}}return{matchUp:w,targetDrawPosition:S,matchUpDrawPositionIndex:v}}function qa({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===r));let{structure:o}=Ut({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(o==null?void 0:o.finishingPosition)===Oy?PCe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:o,matchUp:a}):CCe({matchUp:a})}function PCe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var M,N,R;let{winnerMatchUpId:a,loserMatchUpId:o}=r,{links:s}=UCe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),l=s==null?void 0:s.source,c=eL({source:l,linkType:mp}),u=eL({linkCondition:pd,linkType:dd,source:l}),d=eL({source:l,linkType:dd}),p=u&&d;d||(d=u);let h=(M=c==null?void 0:c.target)==null?void 0:M.feedProfile,f=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,m=(R=u==null?void 0:u.target)==null?void 0:R.feedProfile,g,v,y,I,b,D,w,S,U,C;if(e&&(a||o)&&(w=a&&h!==ml&&t.find(({matchUpId:A})=>A===a),I=o&&f!==ml&&t.find(({matchUpId:A})=>A===o),w||I))return{matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:I,winnerMatchUp:w}};let{roundPosition:E}=r;C=C||t.filter(A=>A.structureId===n.structureId);let P=C.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return d&&!I&&f!==ml&&({matchUpDrawPositionIndex:D,targetDrawPosition:b,matchUp:I}=tL({targetLink:d,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==ml&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=tL({targetLink:u,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),c&&!w&&h!==ml&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:w}=tL({targetLink:c,sourceRoundMatchUpCount:P,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),w||(C=C||t.filter(A=>A.structureId===n.structureId),{matchUp:w}=DCe({structureMatchUps:C,matchUp:r})),ht({matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:U,loserMatchUpDrawPositionIndex:D,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:S,loserTargetDrawPosition:b,byeTargetDrawPosition:v,winnerMatchUp:w,loserMatchUp:I,byeMatchUp:g},targetMatchUpIds:!!(a||o)})}function CCe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function ECe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var l,c,u,d,p,h;let{matchUpId:r,structureId:a,drawPositions:o=[]}=n,{structure:s}=Ut({drawDefinition:t,structureId:a});if((s==null?void 0:s.finishingPosition)===p0){let{roundNumber:f}=n,m=f&&wt(f)+1,g=s.matchUps??[],{roundMatchUps:v}=Wa({matchUps:g});if(m&&(v!=null&&v[m])){let y=[...o].sort(ar).map((I,b)=>{let D=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(I)});return{matchUpId:D==null?void 0:D.matchUpId,roundNumber:m,schedule:D==null?void 0:D.schedule,sideNumber:b+1,structureName:s.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=qa({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:r}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=iL({upcomingMatchUp:m}),y=iL({upcomingMatchUp:g});if(n.matchUpStatus!==bi&&(g==null?void 0:g.matchUpStatus)===bi){let{matchUp:b}=Hte({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&iL({upcomingMatchUp:b})||y}let I=(l=n.schedule)==null?void 0:l.timeAfterRecovery;if(I&&((c=v==null?void 0:v.schedule)!=null&&c.scheduledTime&&ni(v.schedule.scheduledTime)<ni(I)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(u=y==null?void 0:y.schedule)!=null&&u.scheduledTime&&ni(y.schedule.scheduledTime)<ni(I)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(d=n.drawPositions)==null?void 0:d.filter(Boolean).length){let b=((h=(p=f.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:h.linkCondition)===pd,D=MCe(n);if(D.length){let w=i$(m==null?void 0:m.sides),S=i$(g==null?void 0:g.sides),U=D.find(({participantId:E})=>w.includes(E))?[]:D,C=D.find(({participantId:E})=>S.includes(E))?[]:D;g&&b&&C.length<2&&C.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),C!=null&&C.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(C))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function MCe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function Hte({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var o;let{matchUpId:n,matchUpStatus:r,structureId:a}=t||{};if(!t||!a||(t==null?void 0:t.matchUpStatus)===On)return{matchUp:t};if(r===bi){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((o=qa({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:o.targetMatchUps)||{},Hte({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function iL(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function sr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=y0(t);if(i.error)return ae({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function y0(t){if(!(t!=null&&t.drawDefinition))return{error:et};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:D,event:w}=t,S=[],U=[],C=[],E=[],P=[];v&&!i&&(i=Gp({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let M;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(b||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:M}=Wj({participants:e,participantsProfile:s})));let{structures:N}=fd({drawDefinition:y});if(!N)return{error:bn};n||(n=ca({drawDefinition:y}));let R=y&&Bte({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:x=[],pendingMatchUps:F=[],upcomingMatchUps:$=[],completedMatchUps:V=[],abandonedMatchUps:G=[]}=zA({matchUpFilters:I?void 0:h,contextFilters:I?void 0:p,inContext:b||I||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:R,matchUpsMap:n,structure:O,context:D,event:w});S=S.concat(...G),U=U.concat(...V),C=C.concat(...$),E=E.concat(...F),P=P.concat(...x)});let A=O=>(!h&&!I&&!p||(h&&(O=ov({matchUps:O,...h})),p&&(O=ov({matchUps:O,...p,processContext:!0}))),O),_={abandonedMatchUps:A(S),completedMatchUps:A(U),upcomingMatchUps:A(C),pendingMatchUps:A(E),byeMatchUps:A(P),matchUpsMap:n,...ne,groupInfo:M};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:x,completed:F,upcoming:$,pending:V,bye:G}=O,j=[].concat(...x&&S||[],...F&&U||[],...$&&C||[],...V&&E||[],...G&&P||[]);ECe({inContextDrawMatchUps:j,drawDefinition:y})}return _}function Lm({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:et};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=sr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];ND({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=qa({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=_m({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===o);if(h&&(d&&(n.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:n}}function zte(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function RCe(t){let e=Object.assign({},...kh.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return zte(e[t])}var kh=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Wte({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let c=kh.find(({iso:u})=>u===l);i&&(c!=null&&c.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&(c!=null&&c.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}a.forEach(o)}function NCe({participantMap:t,template:e}){var n;let i=Object.values(t);for(let r of i){let a=r.participant;if((n=a.individualParticipantIds)!=null&&n.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?Hv({template:e,source:s}):s)}}}}function vg(t){var r;let{tournamentRecord:e,participantId:i}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let a of Object.values(n)){let o=(r=a.participants)==null?void 0:r.find(s=>s.participantId===i);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:jn}}function Pu({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:n}){if(!n)return{error:ut,info:uj};if(e&&!Array.isArray(e))return{error:ve,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:$V};let r=n.timeItems.filter(o=>(o==null?void 0:o.itemType)===i).filter(o=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=o==null?void 0:o.itemSubTypes)==null?void 0:l.includes(s)})).sort((o,s)=>{let l=new Date(o.createdAt||void 0).getTime(),c=new Date(s.createdAt||void 0).getTime();return l-c}),a=r.pop();if(a){let o={timeItem:a,...ne};return t&&Object.assign(o,{previousItems:r}),o}else return{info:Ia}}function aG({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:xc};if(!e.timeItems)return{info:Ia};let{timeItem:r,previousItems:a,info:o}=Pu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function zD({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Ai};if(!n.timeItems)return{info:Ia};let{timeItem:r,previousItems:a,info:o}=Pu({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function WD({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Re};if(!e.timeItems)return{info:Ia};let{timeItem:r,previousItems:a,info:o}=Pu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function oG({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:Re};if(!i)return{error:mr};let a=vg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Ia};let{timeItem:s,previousItems:l,info:c}=Pu({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:c}}var ACe={[vs]:"groupParticipantIds",[kt]:"pairParticipantIds",[ji]:"teamParticipantIds"},_Ce={[vs]:"groups",[ji]:"teams"};function qte({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let c of i.participants??[]){let u=c==null?void 0:c.participantId;u&&xCe({participantMap:l,participantId:u})}for(let c of i.participants??[]){let u=at(c,e,a),{participantId:d,individualParticipantIds:p,participantType:h}=u;if(Object.assign(l[d].participant,u),p&&OCe({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:h,participantId:d}),n&&(l[d].participant.signedIn=kCe(u)),r){let{ratings:f,rankings:m,seedings:g}=o0({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=f}(s||o)&&Wte({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let c=Zi(t)?t:void 0;NCe({participantMap:l,template:c})}return{participantMap:l}}function kCe(t){let{timeItem:e}=Pu({itemType:AD,element:t});return(e==null?void 0:e.itemValue)===eU}function OCe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(let a of t){let o=i[a].participant;if(o[ACe[n]].push(r),[ji,vs].includes(n)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e,p=_Ce[n];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(n===kt){let s=t.find(l=>l!==a);i[a].pairIdMap[r]=s,i[a].pairIdMap[s]=r}}}function xCe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Tn]:{...i},[Wi]:{...i},[ji]:{...i},...i}}}function By({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var s;if(e)return{participantMap:(s=qte({...t,...n,tournamentRecord:i}))==null?void 0:s.participantMap};let a=at(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&a.forEach(l=>Wte({participant:l,...t}));let o;if((r||t!=null&&t.withGroupings)&&(a!=null&&a.length)&&({participantsWithGroupings:a,groupInfo:o}=Wj({participantsProfile:t,deepCopy:!1,participants:a})),(t==null?void 0:t.withScaleValues)&&(a==null?void 0:a.length))for(let l of a){let{ratings:c,rankings:u}=o0({participant:l});l.rankings=u,l.ratings=c}return{participants:a,groupInfo:o}}function Hp(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:h,nextMatchUps:f,inContext:m,context:g,event:v}=t;if(!v)return{error:Ai};let{eventId:y,eventName:I,endDate:b,eventType:D,category:w,gender:S,matchUpFormat:U}=v??{},C={...g,...ht({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:U,eventName:I,eventType:D,category:w,eventId:y,gender:S})};b&&(C.endDate=b),p&&!i&&(i=Gp({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let E;if(!(e!=null&&e.length)&&!n&&u){let N=By({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],E=N.groupInfo}let P=v.drawDefinitions??[],M=VD({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:P.flatMap(N=>{let{matchUps:R}=sr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:C,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:M,nextMatchUps:f,inContext:m,event:v});return R??[]}),groupInfo:E}}function Br(t){let e=gi(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:Re};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:h,nextMatchUps:f,context:m}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=By({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:y}=Ei({tournamentRecord:c}),I={...m,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},b=Gp({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(D=>{var w;return I.eventDrawsCount=((w=D.drawDefinitions)==null?void 0:w.length)??0,Hp({context:I,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,contextContent:b,contextFilters:h,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:f,participants:n,inContext:u,event:D}).matchUps??[]}).concat(...c.matchUps??[])}}function Cc({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){return typeof n!="object"||!Object.keys(n).length?{error:Pn}:{matchUps:Object.keys(n).map(c=>{let u=n[c];return Br({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:u,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function Vy(t,e){return LCe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function LCe(t,e){return(Kv[t==null?void 0:t.stage]||0)-(Kv[e==null?void 0:e.stage]||0)}function no(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:D,eventType:w,category:S,gender:U,matchUpFormat:C}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:C,eventType:w,eventName:b,category:S,eventId:I,endDate:D,gender:U},P;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:P}=By({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=Gp({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...sr({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function zl(t){var y;let e=Uu(t),i=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:r,tournamentRecord:a,drawDefinition:o}=t;if(!Array.isArray(i))return{error:Md};if(!Array.isArray(n))return{error:xc};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(I=>I.matchUpId);if(!Array.isArray(s))return{error:Jw};let l={},c={},u={},d={};a&&!Object.keys(e).length&&(e={[a.tournamentId]:a});let p=Object.values(e),h=p.reduce((I,b)=>I.concat(b.events??[]).map(D=>(D.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===fp),f=i;if(h.length){f=Cc({nextMatchUps:!0,tournamentRecords:e}).matchUps;let I=h.reduce((b,D)=>{var U,C;let w=(U=D.source)==null?void 0:U.structureId,S=(C=D.target)==null?void 0:C.structureId;return w&&S&&(u[S]=w),w&&!b.includes(w)&&b.push(w),b},[]);for(let b of I)l[b]=[];for(let b of f??[]){let D=b.containerStructureId||b.structureId;I.includes(D)&&l[D].push(b.matchUpId)}}let m=I=>{c[I]||(c[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[I]=[])},g=(I,b)=>{c[I].matchUpIds.forEach(D=>{c[b].matchUpIds.push(D)}),c[b].matchUpIds.push(I),c[I].dependentMatchUpIds.push(b),r&&c[I].participantIds.forEach(D=>c[b].participantIds.push(D))},v=I=>{let b=Object.keys(l).length;for(let D of I||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:U}=D;if(!s.length||s.includes(w)){if(m(w),r){let{individualParticipantIds:P}=LA(D);c[w].participantIds=P}S&&(m(S),g(w,S),d[S].push(w)),U&&(m(U),g(w,U),d[U].push(w)),c[w].sources.push(d[w]);let C=d[w].map(P=>c[P].sources[0]).flat(),E=d[w].map(P=>c[P].sources[1]).flat();if(c[w].sources.push(C,E),b){let P=D.containerStructureId||D.structureId,M=u[P];if(l[M])for(let N of l[M])m(N),g(N,w),d[N].push(w)}}}};if(o)Lm({drawDefinition:o}),f!=null&&f.length||(f=no({drawDefinition:o}).matchUps),v(f);else{if(f!=null&&f.length||(f=Cc({nextMatchUps:!0,tournamentRecords:e}).matchUps),!n.length){let I=p!=null&&p.length?p.map(({events:b=[]})=>b.map(({drawDefinitions:D=[]})=>D.map(({drawId:w})=>w))).flat(1/0):[];I&&(n=I)}for(let I of n){let b=f==null?void 0:f.filter(D=>D.drawId===I).sort(Vy);if(!(b!=null&&b.find(({roundPosition:D})=>!D))){let D=b==null?void 0:b.find(({tournamentId:S})=>S),{drawDefinition:w}=so({tournamentRecord:e[D==null?void 0:D.tournamentId],drawId:I});w&&Lm({drawDefinition:w})}v(b)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:f,...ne}}function Vr(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),n=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:r,side2Score:a,side1TiebreakScore:o,side2TiebreakScore:s,side1PointScore:l,side2PointScore:c}=n||{},u=r||a||o||s||l||c;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||u)}function qD({matchUpStatus:t}){return wj.includes(t)}function FCe({matchUpStatus:t}){return EA.includes(t)}function u$({matchUpStatus:t}){return Sj.includes(t)}function sG({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var s;let a=n==null?void 0:n.find(({participantId:l})=>l),o=(s=i==null?void 0:i.filter(sG))==null?void 0:s.length;return Vr({score:r})||o||e&&a||t&&FCe({matchUpStatus:t})&&![fi,Pi,Bl].includes(t)}function KD(t){var S;let{drawDefinition:e,findContainer:i,structureId:n,event:r}=t,a=t.structure,o={isCollectionMatchUp:!1},{containedStructures:s}=h0({drawDefinition:e}),l=n?s[n]||[]:[];if(!a){let U=Ut({drawDefinition:e,structureId:n});if(U.error)return U;a=i?U.containingStructure??U.structure:U.structure}if(Go({structure:a}))return{structure:a,isAdHoc:!0,error:Zw};let{matchUps:c}=sr({inContext:!0,matchUpFilters:o,drawDefinition:e,event:r}),u=c==null?void 0:c.filter(U=>U.structureId===n||l.includes(U.structureId)),{matchUpDependencies:d}=zl({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],h=[],f={},m=[];for(let U of c??[]){if(U.structureId===n||l.includes(U.structureId)){h.push(...U.drawPositions??[]);let C=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!f[E]||C&&f[E]>C)&&(f[E]=C)}sG(U)&&(m.push(U),p.push(U.matchUpId,...((S=d==null?void 0:d[U==null?void 0:U.matchUpId])==null?void 0:S.matchUpIds)||[]))}let g=Ft(h.filter(Boolean)).sort(ar),v=Ft(p),y=Ft(u==null?void 0:u.map(({matchUpId:U,drawPositions:C})=>v.includes(U)?C:[]).flat().filter(Boolean)).sort(ar),{positionAssignments:I}=Bi({drawDefinition:e,structure:a}),b=I==null?void 0:I.filter(U=>U.bye).map(U=>U.drawPosition),D=I==null?void 0:I.filter(U=>U.qualifier).map(U=>U.drawPosition),w=(g==null?void 0:g.filter(U=>!y.includes(U)))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:D,inactiveDrawPositions:w,positionAssignments:I,activeDrawPositions:y,byeDrawPositions:b,activeMatchUps:m,structure:a}}function Zv({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(ar)[0]}}var gh={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},QM=[];function Bs(t,e){typeof t=="string"&&(t={method:t}),(e||Hs())&&QM.push(t)}function $Ce(t){let e=QM.slice();return t&&(QM.length=0),e}function BCe(t){let e=$Ce(t).map(i=>{let{color:n,keyColors:r,method:a,newline:o}=i,s=Object.keys(gh).includes(n)?gh[n]:gh.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&gh[r[u]]?gh[r[u]]:gh.brightwhite;return`${gh.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,c,gh.white,l,gh.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function VCe(){QM.length=0}function ys({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var U,C,E;if(!n)return{error:et};if(s||({structure:s}=Ut({drawDefinition:n,structureId:o})),!s)return{error:bn};o||({structureId:o}=s);let c="assignDrawPositionBye";Bs({method:c,color:"cyan",drawPosition:r}),a||(a=ca({drawDefinition:n}));let{positionAssignments:u}=Bi({structure:s}),{activeDrawPositions:d}=KD({drawDefinition:n,structureId:o});if((U=u==null?void 0:u.find(P=>P.drawPosition===r))!=null&&U.bye)return{...ne};if(d!=null&&d.includes(r))return{error:oA};let p=u==null?void 0:u.find(P=>P.drawPosition===r);if(!p)return{error:Zw};let{filled:h,containsBye:f,assignedParticipantId:m}=jCe(p);if(f)return{...ne};if(h&&!f)return ae({result:{error:Nb},stack:c});let g=sr({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],v={isCollectionMatchUp:!1},{matchUps:y}=Ti({provisionalPositioning:t,drawDefinition:n,matchUpFilters:v,matchUpsMap:a,structure:s});if(u==null||u.forEach(P=>{P.drawPosition===r&&(P.bye=!0)}),s.structureType===Qa)return GCe({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:y}),qh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),J7({assignedParticipantId:m,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:c});let{roundProfile:I,roundMatchUps:b}=Wa({matchUps:y}),D=(C=I&&Object.keys(I).map(P=>parseInt(P)).reverse())==null?void 0:C.find(P=>{var M;return(M=I==null?void 0:I[P].drawPositions)==null?void 0:M.includes(r)}),w=D?b==null?void 0:b[D].find(({drawPositions:P})=>P==null?void 0:P.includes(r)):void 0;w&&Kte({tournamentRecord:i,drawDefinition:n,matchUp:w,event:l});let S=(E=w==null?void 0:w.drawPositions)==null?void 0:E.find(P=>P!==r);if(w&&S){let P=lG({sourceDrawPositions:w.drawPositions,matchUpId:w.matchUpId,inContextDrawMatchUps:g,drawPositionToAdvance:S,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(P.error)return P}return qh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),J7({assignedParticipantId:m,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:c})}function J7({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:n,structureId:r,stack:a}){return e&&xA({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:n,structureId:r,name:a}}),ae({result:{...ne},stack:a})}function jCe(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function Kte({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:bi,score:void 0,winningSide:void 0}),oi({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function GCe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&Kte({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function lG({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var I,b;Bs({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=a.drawMatchUps.find(D=>D.matchUpId===o),c=(I=e.find(D=>D.matchUpId===o))==null?void 0:I.structureId,{structure:u}=Ut({drawDefinition:r,structureId:c}),{positionAssignments:d}=Bi({structure:u}),p=d==null?void 0:d.filter(D=>D.bye).map(D=>D.drawPosition),h=(b=l==null?void 0:l.drawPositions)==null?void 0:b.find(D=>D!==t),f=h&&(p==null?void 0:p.includes(h)),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=qa({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o});if(v&&v.structureId===(u==null?void 0:u.structureId)&&HCe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:v,matchUpsMap:a,event:s}),g&&f&&g.structureId!==(u==null?void 0:u.structureId)){let{roundNumber:D}=g;if(D===1){let w=ys({structureId:m.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:s});if(w.error)return w}else Yte({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:m,drawDefinition:r,loserMatchUp:g,matchUpsMap:a,event:s})}return{...ne}}function HCe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var R,A,_,O,x,F;let l="advanceWinner",c=o.drawMatchUps.find($=>$.matchUpId===a.matchUpId),u=(R=e.find($=>$.matchUpId===a.matchUpId))==null?void 0:R.structureId,{structure:d}=Ut({drawDefinition:r,structureId:u}),{positionAssignments:p}=Bi({structure:d}),h=(A=p==null?void 0:p.find(({drawPosition:$})=>$===t))==null?void 0:A.bye,f=(_=c.drawPositions)==null?void 0:_.filter(Boolean),m=p==null?void 0:p.filter($=>f==null?void 0:f.includes($.drawPosition)),g=p==null?void 0:p.find(({drawPosition:$})=>$===t),v=i==null?void 0:i.find($=>$!==t),y=(O=v&&(m==null?void 0:m.find(({drawPosition:$})=>$===v)))==null?void 0:O.bye,I=h&&y;if(I&&console.log({isByeAdvancedBye:I}),(f==null?void 0:f.length)>1&&h&&!y)return ae({result:{error:Nb},stack:l});let b=f==null?void 0:f.find($=>$!==t),D=I,w=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),S=w.map($=>!$&&!D||$===t?(D=!0,t):$).sort(ar);if(!D)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),ae({result:{error:Nb},stack:l});let U=(x=p==null?void 0:p.find(({drawPosition:$})=>$===b))==null?void 0:x.bye,C=(F=p==null?void 0:p.find(({drawPosition:$})=>$===t))==null?void 0:F.bye;Object.assign(c,{matchUpStatus:C||U?bi:On,score:void 0,winningSide:void 0,drawPositions:S});let E=c.drawPositions.find($=>!w.includes($));Bs({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:U,drawPositionIsBye:C}),oi({tournamentId:n==null?void 0:n.tournamentId,matchUp:c,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:r});let{targetLinks:{loserTargetLink:P},targetMatchUps:{loserMatchUp:M,loserTargetDrawPosition:N}}=qa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(U||C){let $=U?t:b;if($)lG({drawPositionToAdvance:$,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(C&&P&&M)if(M.feedRound)Yte({loserTargetDrawPosition:N,tournamentRecord:n,loserTargetLink:P,drawDefinition:r,loserMatchUp:M,matchUpsMap:o});else{let V=1-a.roundPosition%2,G=M.drawPositions[V],j=ys({structureId:P.target.structureId,drawPosition:G,tournamentRecord:n,drawDefinition:r,event:s});if(j.error)return j}}}function Yte({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;Bs({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=Zv({drawPosition:t,matchUps:l});if(c===s){let u=ys({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:o});if(u.error)return u}}function Zte({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=Ti({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?bi:On}),oi({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function YD(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:c}=Ut({drawDefinition:a,structureId:o}),u=(Er({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:Xw};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=KD({drawDefinition:a,structureId:o});return d.includes(n)?{error:oA}:(e||({matchUps:e}=sr({inContext:!0,drawDefinition:a,matchUpsMap:s})),d$({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(qh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:c,event:l}),{...ne,participantId:i}):{error:rQ})}function d$({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var v,y;let{structure:s}=Ut({drawDefinition:i,structureId:a});if(!s)return{error:bn};let l=Er({drawDefinition:i,structure:s}).positionAssignments||[],c=l.some(I=>{if(I.drawPosition===n)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(s.structureType===Qa)return Zte({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:s}),{drawPositionCleared:c,...ne};let u={isCollectionMatchUp:!1},{matchUps:d}=Ti({drawDefinition:i,matchUpFilters:u,matchUpsMap:r,structure:s,event:o}),{roundProfile:p,roundMatchUps:h}=Wa({matchUps:d}),f=(v=p&&Object.keys(p))==null?void 0:v.map(I=>wt(I)),m=n,g=(y=f==null?void 0:f.map(I=>{var M,N,R,A;let b=(N=(M=p==null?void 0:p[I])==null?void 0:M.pairedDrawPositions)==null?void 0:N.find(_=>_.includes(m)),D=b==null?void 0:b.find(_=>_!==m),w=l.find(_=>_.drawPosition===D),S=p==null?void 0:p[I+1],U=w==null?void 0:w.bye,C=(R=S==null?void 0:S.pairedDrawPositions)==null?void 0:R.find(_=>_.includes(D)),E=U&&C&&S&&((A=S.drawPositions)==null?void 0:A.includes(D)),P=b&&{pairedDrawPositionByeAdvancedPair:!E&&C,pairedDrawPosition:D,targetDrawPosition:m,relevantPair:b,roundNumber:I};return E&&(m=D),P}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:y.reduce((I,b)=>{let{roundNumber:D,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:C}=b,E={roundNumber:D,targetDrawPosition:S,relevantPair:w},P=C&&{roundNumber:D+1,targetDrawPosition:U,relevantPair:C,subsequentRoundRemoval:!0},M=[E,P].filter(Boolean);return I.concat(...M)},[]);return g==null||g.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:D})=>{let w=h==null?void 0:h[I].find(S=>{var U;return za((U=S.drawPositions)==null?void 0:U.filter(Boolean),D.filter(Boolean))});w&&(zCe({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:r}),Xte({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:s,event:o}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function zCe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=Ut({drawDefinition:n,structureId:o});if(!s)return{error:bn};if(s.structureType===Qa)return;r=r||ca({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:c}=Zv({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=Bi({drawDefinition:n,structureId:o}).positionAssignments??[];return u==null||u.forEach(p=>Xte({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...ne}}function Xte({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var S,U,C,E,P,M;let c="removeDrawPosition",u=(S=r.drawPositions)==null?void 0:S.slice(),d=r.matchUpStatus,p=r.winningSide;o=o??ca({drawDefinition:n});let h=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=Zv({drawPosition:a,matchUps:h});if(r.roundNumber&&f&&r.roundNumber>f){let N=(r.drawPositions??[]).map(R=>R===a?void 0:R);r.drawPositions=N}if(r.matchUpType===Ki){let N=(((U=t==null?void 0:t.find(R=>R.matchUpId===r.matchUpId))==null?void 0:U.sides)??[]).reduce((R,A,_)=>A.drawPosition===a?_:R,void 0);N!==void 0&&((E=(C=r.sides)==null?void 0:C[N])!=null&&E.lineUp)&&((P=r.sides)==null||delete P[N].lineUp,oi({tournamentId:i==null?void 0:i.tournamentId,context:`${c}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let m=qa({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:I}}=m,b=e.filter(({drawPosition:N})=>{var R;return(R=r.drawPositions)==null?void 0:R.includes(N)}).filter(N=>N.bye).length,D=b&&bi||r.matchUpStatus&&[fi,Pi].includes(r.matchUpStatus)&&r.matcHUpStatus||((M=r.drawPositions)==null?void 0:M.length)===2&&On||void 0;r.matchUpStatus=D,r.matchUpStatus&&[Pi,fi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let w=u==null?void 0:u.find(N=>{var R;return!((R=r.drawPositions)!=null&&R.includes(N))});if(u!=null&&u.includes(a)&&d===r.matchUpStatus&&p===r.winningSide||(w&&Bs({method:c,color:"brightyellow",removedDrawPosition:w}),oi({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${c}-${a}`,drawDefinition:n})),v&&v.structureId!==m.matchUp.structureId&&!b){let{drawPositions:N,roundNumber:R}=v;if(R===1){let A=N[I];d$({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let A=Math.min(...N.filter(Boolean)),_=WCe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:v,matchUpsMap:o,event:l});if(_.error)return ae({result:_,stack:c});let O=((o==null?void 0:o.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:x}=Zv({drawPosition:A,matchUps:O});x===1&&(Bs({method:c,color:"brightyellow",loserMatchUpDrawPosition:A}),d$({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...ne}}function WCe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var c;let{structure:s}=Ut({structureId:r.structureId,drawDefinition:n}),{positionAssignments:l}=Bi({structure:s});if((c=l==null?void 0:l.find(u=>u.drawPosition===t))!=null&&c.bye){let u=YD({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(u.error)return u}return{...ne}}function yg({drawDefinition:t,stages:e}){if(!t)return{error:et};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Ft(i.map(r=>{let{positionAssignments:a}=Bi({structure:r});return a?a.map(qt):[]}).flat().filter(Boolean));return{...ne,assignedParticipantIds:n}}function wc(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:o}=r,s=`_${a||it}${o||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let o=a+1;return{...r,entryPosition:o}})).flat()}function sm(t){return[dg,Vl].includes(t)}function eR({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var C,E,P,M,N,R,A,_,O,x,F,$;if(!r||!Array.isArray(r))return{error:au,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Ai};if(a&&!fte.includes(a))return{error:YF};if(o&&!Dj.includes(o))return{error:og};let p="modifyEntriesStatus",h=[];if(!a&&!s)return ae({result:{error:ut},info:"Missing entryStatus",stack:p});if(s&&!ou({extension:s,requiredAttributes:["name"]}))return ae({result:{error:ve},info:"Invalid extension",context:{extension:s},stack:p});let f=[];(C=d==null?void 0:d.drawDefinitions)==null||C.forEach(V=>{let G=yg({stages:u&&[u],drawDefinition:V}).assignedParticipantIds??[];f.push(...G)});let m=(i==null?void 0:i.participants)??[];if(!r.every(V=>{var j;let G=(j=Gh({tournamentParticipants:m,participantId:V}))==null?void 0:j.participantType;return!(G&&[kt,$s].includes(G)&&sm(a))&&!(a&&(d!=null&&d.eventType)&&G===Kt&&[Al,Ws].includes(d.eventType)&&[wl,...B1].includes(a))}))return{error:YF};let g=d&&Bn({event:d}).flightProfile,v=(E=g==null?void 0:g.flights)==null?void 0:E.find(V=>V.drawId===c),y=V=>{let G=(V||[]).filter(z=>!u||!z.entryStage||u===z.entryStage).filter(({participantId:z})=>r.includes(z)),j=z=>a&&f.includes(z.participantId)&&!(B1.includes(z.entryStatus)&&B1.includes(a));return G.every(z=>j(z)&&!e?!1:(a&&(z.entryStatus=a,delete z.entryPosition),o&&(z.entryStage=o,delete z.entryPosition),s&&(s.value?ci({element:z,extension:s}):Ba({element:z,name:s.name})),!0))?{...ne}:{error:e0}},I=({flight:V,drawDefinition:G})=>{d&&(d.entries=wc({entries:d.entries??[]})),V&&(V.drawEntries=wc({entries:V.drawEntries})),G&&(G.entries=wc({entries:G.entries}))},b=V=>{let{flight:G,drawDefinition:j}=V,z="updateDrawEntries";if(G){let H=y(G.drawEntries);if(H.error)return ae({result:H,stack:z})}if(j){let H=y(j.entries);if(H.error)return ae({result:H,stack:z});h.includes(j.drawId)||h.push(j.drawId)}return{...ne}},D=((P=d==null?void 0:d.entries)==null?void 0:P.find(({entryPosition:V})=>V))??(((M=v==null?void 0:v.drawEntries)==null?void 0:M.find(({entryPosition:V})=>V))||((N=n==null?void 0:n.entries)==null?void 0:N.find(({entryPosition:V})=>V)));if(t&&!D&&I({flight:v,drawDefinition:n}),v||n){let V=b({flight:v,drawDefinition:n});if(V.error)return ae({result:V,stack:p})}let w=((R=d==null?void 0:d.drawDefinitions)==null?void 0:R.map(({drawId:V})=>V))??[],S=((A=g==null?void 0:g.flights)==null?void 0:A.filter(V=>!w.includes(V.drawId)))||[];for(let V of S){let G=V&&b({flight:V});if(G!=null&&G.error)return ae({result:G,stack:p})}let U=((_=g==null?void 0:g.flights)==null?void 0:_.length)===1&&(((O=d==null?void 0:d.drawDefinitions)==null?void 0:O.length)??0)<=((x=g==null?void 0:g.flights)==null?void 0:x.length);if(!v&&!n&&a&&hte.includes(a))return{error:$Q};if(!v&&!n||a===vp||l&&U){let V=y(d==null?void 0:d.entries);if(V!=null&&V.error)return ae({result:V,stack:p});let G;if(a===vp&&((F=g==null?void 0:g.flights)==null||F.every(j=>{let z=y(j.drawEntries);return z.error?(G=z.error,!1):(j.drawEntries=j.drawEntries.filter(({participantId:H})=>!r.includes(H)),!0)}),($=d==null?void 0:d.drawDefinitions)==null||$.every(j=>{var H;let z=y(j.entries);return z.error?(G=z.error,!1):(j.entries=(H=j.entries)==null?void 0:H.filter(({participantId:K})=>!r.includes(K)),!0)})),G)return ae({result:{error:G},stack:p})}t&&I({flight:v,drawDefinition:n});for(let V of(d==null?void 0:d.drawDefinitions)??[])h.length&&!h.includes(V.drawId)||Xi({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:V});return{...ne}}function Jte(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===bi||e[i].scheduleItems.push({...u,scheduledDate:xt(u==null?void 0:u.scheduledDate),scheduledTime:tn(u==null?void 0:u.scheduledTime),checkScoreHasValue:Vr({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function Yu({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:Ry};if(!Zi(e))return{error:ve};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,c=[Gv,o,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==Gv)return{error:ID};let m=((r=a&&vv({element:u.itemValue,accessor:a}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...ne,scaleItem:g}}}return{...ne,scaleItem:void 0}}function qCe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var u,d,p;let a={},o=h=>[Gv,qu,r.eventType,h].join("."),s=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===qu).map(({itemType:h,itemValue:f})=>({[h]:f}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(o),c=kn(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((u=t==null?void 0:t.drawIds)!=null&&u.length)||c.length)&&c.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=o(t.stageSeedingScaleNames[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);a.seedAssignments=f}else if(c){let h=c.map(f=>s[f]);a.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=o(i[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);a.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:qu,scaleName:v},I=Yu({scaleAttributes:y,participant:n});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;a.seedValue=v}}return a}function KCe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...lj(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:o,eventId:a});i.events[a]=ht(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function WA(t,e){return(t||"").localeCompare(e||"")}function YCe({tournamentRecord:t,status:e=Hl}){var n,r,a;let i=`${fg}.${mg}`;return(a=(r=(n=WD({tournamentRecord:t,itemType:i}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:a[e]}function ZCe(t){let{tournamentId:e}=t??{};return!!e}function Qs({event:t,status:e=Hl}){var n,r,a;let i=`${fg}.${mg}`;return(a=(r=(n=zD({itemType:i,event:t}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:a[e]}function cG({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function jy(t){var p,h,f,m,g,v,y;let{tournamentRecord:e,drawDefinition:i,eventIds:n,eventId:r,drawIds:a,drawId:o,event:s}=t??{};if(e&&!ZCe(e))return{error:ve};if(r&&!s)return{error:Bo};if(Array.isArray(n)&&(n!=null&&n.length)){let I={};for(let b of n){if(!Ga(b))return{error:ve};let D=(p=so({tournamentRecord:e,eventId:b}))==null?void 0:p.event;if(!D)return{error:Bo};let w=nL({event:D});I[b]=w}return{...ne,publishState:I}}if(s){let I=nL({event:s}),b={};if(o)return i?{publishState:{status:{published:!!((h=I.status.publishedDrawIds)!=null&&h.includes(o)),drawDetail:(f=I.status.drawDetails)==null?void 0:f[o]},...ne}}:{error:$o};if(Array.isArray(a)&&(a!=null&&a.length)){let D=((m=s.drawDefinitions)==null?void 0:m.map(KT))??[];for(let w of a){if(!Ga(w))return{error:ve};if(!D.includes(w))return{error:$o};b[w]={status:{published:!!I.status.publishedDrawIds.includes(w),drawDetail:(g=I.status.drawDetails)==null?void 0:g[w]}}}}else b=I;return{...ne,publishState:b}}let l=[],c=!1,u={},d=YCe({tournamentRecord:e});u.tournament=d??{};for(let I of(e==null?void 0:e.events)??[]){let b=nL({event:I});u[I.eventId]=b,b.status.published&&(l.push(I.eventId),c=!0);for(let{drawId:D}of I.drawDefinitions??[]){let w=(y=(v=b.status)==null?void 0:v.publishedDrawIds)==null?void 0:y.includes(D);w&&(u[D]={status:{published:w}})}}return e&&(u.tournament.status={published:c,publishedEventIds:l}),{...ne,publishState:u}}function nL({event:t}){var a;let e=Qs({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let n=e.drawDetails??{};for(let o of((a=t.drawDefinitions)==null?void 0:a.map(KT))||[])n[o]||(n[o]={publishingDetail:{published:!1}});let r=n&&Object.keys(n).length&&Object.keys(n).filter(o=>cG({drawDetails:n,drawId:o}))||e.drawIds;return{status:{published:r&&r.length>0,publishedDrawIds:r,publishedSeeding:i,drawDetails:n}}}function XCe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===Pi&&(f.walkoverWinCount+=1),r===fi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=s),i===1&&(f.participantWon=n))}function Q7(t){var A,_,O,x,F,$,V,G,j,z;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:n,participantMap:r,withOpponents:a,withMatchUps:o,withEvents:s,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:I,matchUpTieId:b,matchUpSides:D,collectionId:w,matchUpType:S,winningSide:U,matchUpId:C,schedule:E,eventId:P,drawId:M,sides:N}=t,R=a&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:H},K)=>{let q=N[1-K].participantId;return H&&{[H]:q}}).filter(Boolean));for(let H of N){let{participantId:K,sideNumber:q,bye:Y}=H;if(Y)continue;let Z=U===q,Q=J=>{var ce,fe;let te=(ce=r[J])==null?void 0:ce.participant,se=te==null?void 0:te.participantType,ee=[{participantId:J,participantType:se}];if(se!==$s)for(let ge of(te==null?void 0:te.individualParticipantIds)||[]){let he=(fe=r[ge])==null?void 0:fe.participant;ee.push({participantType:he==null?void 0:he.participantType,participantId:ge})}return ee},ie=(J,te)=>{if(o){if(r[J].matchUps[C]={participantWon:Z,matchUpType:S,structureId:f,sideNumber:q,matchUpId:C,eventId:P,drawId:M,stage:g},a){let se=Q(te);r[J].matchUps[C].opponentParticipantInfo=se}w&&(r[J].matchUps[C].collectionId=w)}a&&te&&(r[J].opponents[te]={participantId:te,matchUpId:C,eventId:P,drawId:M}),v&&XCe({finishingPositionRange:c,participantMap:r,participantWon:Z,finishingRound:u,matchUpStatus:d,participantId:J,stageSequence:p,roundNumber:h,structureId:f,matchUpId:C,drawId:M,stage:g}),(i||e)&&Jte({participantMap:r,participantId:J,matchUpStatus:d,roundPosition:I,matchUpType:S,roundNumber:h,structureId:f,matchUpId:C,schedule:E,drawId:M,score:m})},ue=({participant:J,partnerParticipantId:te})=>{var ee,ce,fe;let se=(ge,he)=>{ge&&(ge.partnerParticipantIds||(ge.partnerParticipantIds=[]),ge.partnerParticipantIds.includes(he)||ge.partnerParticipantIds.push(he))};l&&se((ee=J==null?void 0:J.draws)==null?void 0:ee[M],te),s&&se((ce=J==null?void 0:J.events)==null?void 0:ce[P],te),o&&se((fe=J==null?void 0:J.matchUps)==null?void 0:fe[C],te)};if(K&&r[K]){let J=R==null?void 0:R[q];ie(K,J);let te=((A=r[K])==null?void 0:A.participant.participantType)===kt,se=((_=r[K])==null?void 0:_.participant.individualParticipantIds)||[];if(b){if(n){let ee=ce=>r[ce].matchUps[b]={participantWon:y===q,matchUpId:b,matchUpType:Ki,sideNumber:q};ee(K),se.forEach(ee)}if(l&&!r[K].draws[M]){let ee=(x=(O=D.find(ge=>ge.sideNumber===q))==null?void 0:O.participant)==null?void 0:x.participantId,ce=(V=($=(F=r[ee])==null?void 0:F.draws)==null?void 0:$[M])==null?void 0:V.entryStatus,fe=ge=>r[ge].draws[M]={entryStatus:ce,eventId:P,drawId:M};fe(K),se.forEach(fe)}}if(te&&(se.forEach(ee=>r[ee]&&ie(ee,J)),se.forEach((ee,ce)=>{let fe=se[1-ce],ge=r[ee];ge&&ue({participant:ge,partnerParticipantId:fe})}),s&&D)){let ee=(j=(G=D.find(ce=>ce.sideNumber===q))==null?void 0:G.participant)==null?void 0:j.participantId;if(ee){let ce=(z=r[ee])==null?void 0:z.events[P];ce?(r[K].events[P]={...ce},se.forEach(fe=>r[fe].events[P]={...ce})):console.log("Missing teamEntry",{eventId:P,teamParticipantId:ee})}}if(U){let ee=ce=>{Z?(r[ce].counters[S].wins+=1,r[ce].counters.wins+=1,d===Pi&&(r[ce].counters[S].walkoverWins+=1,r[ce].counters.walkoverWins+=1),d===fi&&(r[ce].counters[S].defaultWins+=1,r[ce].counters.defaultWins+=1)):(r[ce].counters[S].losses+=1,r[ce].counters.losses+=1,d===Pi&&(r[ce].counters[S].walkovers+=1,r[ce].counters.walkovers+=1),d===fi&&(r[ce].counters[S].defaults+=1,r[ce].counters.defaults+=1))};ee(K),se.forEach(ee)}}}}function JCe(t){var N,R,A,_,O,x,F;let{participantFilters:e,convertExtensions:i,policyDefinitions:n,tournamentRecord:r,usePublishState:a,contextProfile:o,participantMap:s,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:h,withOpponents:f,withMatchUps:m,withSeeding:g,withEvents:v,withDraws:y}=t,I=e==null?void 0:e.participantIds,b=$=>{var G,j;let V=[$];return(j=(G=s[$])==null?void 0:G.participant.individualParticipantIds)==null||j.forEach(z=>V.push(z)),V.some(z=>!(I!=null&&I.length)||I.includes(z))?V:[]},D={withMatchUps:m||c,withEvents:v||c,withDraws:y||c,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:h,participantMap:s,withOpponents:f,withSeeding:g},w=[],S={},U=[],C={},E={},P={},M=({eventType:$,scaleNames:V,participantId:G})=>{var j,z,H,K;return(K=(H=(z=(j=s[G].participant)==null?void 0:j.rankings)==null?void 0:z[$])==null?void 0:H.find(q=>V.includes(q.scaleName)))==null?void 0:K.scaleValue};for(let $ of(r==null?void 0:r.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes($.eventId))continue;let{drawDefinitions:V=[],extensions:G=[],eventType:j,eventName:z,category:H,entries:K,eventId:q,gender:Y}=$,{flightProfile:Z}=Bn({event:$}),Q=(Z==null?void 0:Z.flights)??[],ie=jy({event:$}).publishState;ie&&(C[q]=ie);let ue=(N=ie==null?void 0:ie.status)==null?void 0:N.publishedSeeding;if(v||g||c){let te=i?Object.assign({},...lj(G??[])):{};E[q]={...te,eventName:z,eventType:j,category:H,eventId:q,gender:Y};let se=[H==null?void 0:H.categoryName,H==null?void 0:H.ageCategoryCode].filter(Boolean);for(let ee of K){let{participantId:ce}=ee;if(!ce||!s[ce])continue;let fe=M({eventType:j,scaleNames:se,participantId:ce}),ge,he;if(g){let Ce=s[ce].participant;({seedAssignments:ge,seedValue:he}=qCe({publishedSeeding:ue,usePublishState:a,withSeeding:g,participant:Ce,event:$}))}let Se=Ce=>{var Je,xe;if((xe=(Je=s[Ce])==null?void 0:Je.events)!=null&&xe[q])return;let Fe=s[Ce];KCe({convertExtensions:i,seedAssignments:ge,participant:Fe,withSeeding:g,seedValue:he,eventId:q,ranking:fe,entry:ee})};Se(ce),(s[ce].participant.individualParticipantIds||[]).forEach(Se)}}let J=(R=C==null?void 0:C[q])==null?void 0:R.publishedSeeding;if(y||c||g){let te=ee=>ee?Object.assign({},...ee.map(({participantId:ce,seedValue:fe,seedNumber:ge})=>({[ce]:{seedValue:fe,seedNumber:ge}}))):void 0,se=Ft([...V.map(KT),...Q.map(KT)]);for(let ee of se){let ce=V.find(de=>de.drawId===ee),fe=Q==null?void 0:Q.find(de=>de.drawId===ee),ge=(ce==null?void 0:ce.entries)||(fe==null?void 0:fe.drawEntries),{structures:he=[],drawOrder:Se,drawName:Ce,drawType:Fe}=ce??{},Je=fe==null?void 0:fe.flightNumber,xe=[H==null?void 0:H.categoryName,H==null?void 0:H.ageCategoryCode].filter(Boolean),st=((ce==null?void 0:ce.structures)||[]).sort((de,pe)=>xy(de,pe)).map(({structureId:de,structures:pe})=>[de,...(pe||[]).map(({structureId:ke})=>ke)]).flat(1/0),we,Oe,ye,Be,Ee=0,qe=he.filter(({stage:de,stageSequence:pe})=>de===it&&pe===1||de===mt).flatMap(de=>{let{seedAssignments:pe,stageSequence:ke,stage:Ue}=de,{positionAssignments:Te}=Bi({structure:de});return Ue===it?(Ee=(Te==null?void 0:Te.length)??0,ye=Te,Be=pe):ke===1&&(we=Te,Oe=pe),Te}).map(({participantId:de})=>de).filter(Boolean),Ge=te(Be),me=te(Oe),Me=ce?ge.filter(({participantId:de})=>qe.includes(de)):ge,De=!a||(J==null?void 0:J.published)&&(((A=J==null?void 0:J.drawIds)==null?void 0:A.length)===0||((_=J==null?void 0:J.drawIds)==null?void 0:_.includes(ee)));for(let de of Me){let{entryStatus:pe,entryStage:ke,entryPosition:Ue,participantId:Te}=de,rt=M({participantId:Te,scaleNames:xe,eventType:j}),je=Le=>{var Kn,yt,cr,Jo,Qo;if((Kn=s[Le].draws)!=null&&Kn[ee])return;let It=g&&De,zt=It?{}:void 0,Jt=It?((yt=Ge==null?void 0:Ge[Te])==null?void 0:yt.seedValue)||((cr=Ge==null?void 0:Ge[Te])==null?void 0:cr.seedNumber):void 0,Yr=Jt?Ge==null?void 0:Ge[Te]:void 0,Eo=It?((Jo=me==null?void 0:me[Te])==null?void 0:Jo.seedValue)||((Qo=me==null?void 0:me[Te])==null?void 0:Qo.seedNumber):void 0,Qt=Eo?me==null?void 0:me[Te]:void 0;zt&&Jt&&(zt[it]=Yr),zt&&Eo&&(zt[mt]=Qt);let yr=Jt||Eo;yr&&(s[Le].participant.seedings[j]||(s[Le].participant.seedings[j]=[]),Yr&&s[Le].participant.seedings[j].push({...Yr,scaleName:ee}),Qt&&s[Le].participant.seedings[j].push({...Qt,scaleName:ee}),zt&&(s[Le].events[q].seedAssignments||(s[Le].events[q].seedAssignments={}),Object.keys(zt).forEach(vo=>s[Le].events[q].seedAssignments[vo]=zt[vo]))),(y||c)&&(s[Le].draws[ee]=ht({seedAssignments:zt,entryPosition:Ue,entryStatus:pe,entryStage:ke,seedValue:yr,eventId:q,ranking:rt,drawId:ee},!1,!1,!0))};[Vl,dg].includes(pe)||(je(Te),(O=s[Te].participant.individualParticipantIds||[])==null||O.forEach(je))}let Ae=((ce==null?void 0:ce.structures)??[]).reduce((de,pe)=>(de.includes(pe.stage)||de.push(pe.stage),de),[]),ze=((ce==null?void 0:ce.links)??[]).length;P[ee]={qualifyingPositionAssignments:we,qualifyingSeedAssignments:Oe,mainPositionAssignments:ye,qualifyingSeedingMap:me,mainSeedAssignments:Be,orderedStructureIds:st,mainSeedingMap:Ge,flightNumber:Je,linksCount:ze,drawOrder:Se,drawName:Ce,drawType:Fe,drawSize:Ee,drawId:ee,stages:Ae}}}if(c||d||p||h||f||m||y){let te=!!d||l,se=((x=Hp({afterRecoveryTimes:!!d,policyDefinitions:n,tournamentRecord:r,inContext:!0,contextProfile:o,participantMap:s,nextMatchUps:te,event:$}))==null?void 0:x.matchUps)??[];for(let ee of se){let{finishingPositionRange:ce,potentialParticipants:fe,tieMatchUps:ge=[],sides:he=[],winningSide:Se,matchUpType:Ce,matchUpId:Fe,eventId:Je,drawId:xe,collectionId:st,stageSequence:we,finishingRound:Oe,matchUpStatus:ye,roundPosition:Be,roundNumber:Ee,structureId:qe,schedule:Ge,score:me,stage:Me}=ee;S[Fe]=ee;let De={finishingPositionRange:ce,finishingRound:Oe,stageSequence:we,roundPosition:Be,collectionId:st,roundNumber:Ee,structureId:qe,schedule:Ge,eventId:Je,drawId:xe,score:me,stage:Me};Q7({...De,...D,matchUpStatus:ye,winningSide:Se,matchUpType:Ce,matchUpId:Fe,sides:he});for(let Ae of ge){let{winningSide:ze,sides:de=[],matchUpId:pe,matchUpStatus:ke,matchUpType:Ue}=Ae;Q7({...De,...D,winningSide:ze,tieWinningSide:Se,matchUpTieId:Fe,matchUpId:pe,sides:de,matchUpSides:he,matchUpStatus:ke,matchUpType:Ue})}Array.isArray(fe)&&(te||d||u)&&((F=fe.flat().map(qt).filter(Boolean))==null||F.forEach(Ae=>{var ze;(ze=b(Ae))==null||ze.forEach(de=>{s[de]&&(s[de].potentialMatchUps[Fe]=ht({tournamentId:r==null?void 0:r.tournamentId,matchUpId:Fe,eventId:Je,drawId:xe}))}),(d||u)&&Jte({potential:!0,participantMap:s,participantId:Ae,matchUpStatus:ye,roundPosition:Be,structureId:qe,matchUpType:Ce,roundNumber:Ee,matchUpId:Fe,schedule:Ge,drawId:xe,score:me})}))}U.push(...se)}}if(h||c||d){let $=Object.values(s);for(let V of $){let{wins:G,losses:j,[Tn]:{wins:z,losses:H},[Wi]:{wins:K,losses:q}}=V.counters,Y=(Z,Q,ie)=>{let ue=Q+ie,J=Q,te=ue&&J/ue;V.statistics[Z]={denominator:ue,numerator:J,statValue:te,statCode:Z}};if(h&&(Y(V1,G,j),Y(`${V1}.${Tn}`,z,H),Y(`${V1}.${Wi}`,K,q)),c){let Z=(Q=[])=>Math.abs(Q[0]-Q[1]);for(let Q of Object.keys(V.draws)){let{orderedStructureIds:ie=[],flightNumber:ue}=P[Q]||{};if(V.structureParticipation&&ie.length){let J,te=0,se=ie.map(ee=>{let ce=V.structureParticipation[ee];if(!ce)return;J||(J=ce==null?void 0:ce.finishingPositionRange),Z(J)>Z(ce==null?void 0:ce.finishingPositionRange)&&(J=ce==null?void 0:ce.finishingPositionRange);let fe=ce.stage!==mt;return fe&&(te+=1),ht({...ce,participationOrder:fe?te:void 0,flightNumber:ue})}).filter(Boolean);V.draws[Q]&&(V.draws[Q].finishingPositionRange=J,V.draws[Q].structureParticipation=se)}}}if(d){let Z=Zi(d)?d.scheduledMinutesDifference:0,Q=V.scheduleItems||[],ie=V.potentialMatchUps||{},ue=Q.reduce((te,se)=>{let{scheduledDate:ee,scheduledTime:ce}=se;return te[ee]||(te[ee]=[]),ce&&te[ee].push(se),te},{});Object.values(ue).forEach(te=>te.sort(Oee));for(let te of Q){let{typeChangeTimeAfterRecovery:se,timeAfterRecovery:ee,scheduledDate:ce,scheduledTime:fe}=te,ge=ue[ce],he=ni(fe);for(let Se of ge){if(Se.matchUpId===te.matchUpId||[Pi,fi].includes(Se.matchUpStatus)&&!Se.checkScoreHasValue)continue;let Ce=te.matchUpType!==Se.matchUpType&&se||ee,Fe=te.drawId===Se.drawId,Je=ie[te.matchUpId]&&ie[Se.matchUpId],xe=ni(Se.scheduledTime),st=Math.abs(xe-he),we=xe>=he;if((Z&&!isNaN(Z)?st<=Z:we&&ni(Se.scheduledTime)<ni(Ce))&&!(Je&&Fe)&&we){let Oe=[te.matchUpId,Se.matchUpId].sort(WA).join("|");V.scheduleConflicts[Oe]={priorScheduledMatchUpId:te.matchUpId,matchUpIdWithConflict:Se.matchUpId}}}}let J=V.participant.participantId;Object.keys(V.scheduleConflicts).length&&w.push(J),s[J].scheduleConflicts=V.scheduleConflicts}}}return{participantIdsWithConflicts:w,eventsPublishStatuses:C,derivedEventInfo:E,derivedDrawInfo:P,mappedMatchUps:S,participantMap:s,matchUps:U}}function ZD({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var b;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:r,positionedParticipants:a,eventEntryStatuses:o,participantRoles:s,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=xu(h)&&((b=e==null?void 0:e.events)==null?void 0:b.filter(D=>h==null?void 0:h.includes(D.eventId)))||(e==null?void 0:e.events)||[],g=r&&QCe({drawEntryStatuses:r,tournamentEvents:m}),v=o&&eEe({eventEntryStatuses:o,tournamentEvents:m}),y=a!==void 0&&[!0,!1].includes(a)&&m.reduce((D,w)=>D.concat(...(w.drawDefinitions||[]).map(S=>tte({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),I=D=>n==null?void 0:n.reduce((w,S)=>{let{accessor:U,value:C}=S,{values:E}=vv({element:D,accessor:U});return w&&(E==null?void 0:E.includes(C))},!0);if(i=i==null?void 0:i.filter(D=>{var N,R;let w=(R=(N=Pu({element:D,itemType:AD}))==null?void 0:N.timeItem)==null?void 0:R.itemValue,{participantRoleResponsibilities:S,participantType:U,participantRole:C,participantId:E,person:P}=D,M=Array.isArray(f)&&(f==null?void 0:f.length)&&(P==null?void 0:P.sex)&&f.includes(P.sex);return p?f&&M||a&&y.includes(E)||a===!1&&!y.includes(E)||(g==null?void 0:g.includes(E))||(v==null?void 0:v.includes(E))||(u==null?void 0:u.includes(E))||d&&w===d||c&&U&&xu(c)&&c.includes(U)||s&&C&&xu(s)&&s.includes(C)||l&&xu(S)&&xu(l)&&l.find(A=>S==null?void 0:S.includes(A))||(n==null?void 0:n.length)&&xu(n)&&I(D):(!f||M)&&(a===void 0||a&&y.includes(E)||a===!1&&!y.includes(E))&&(!g||g.includes(E))&&(!v||v.includes(E))&&(!u||u.includes(E))&&(!d||w===d)&&(!c||U&&xu(c)&&c.includes(U))&&(!s||C&&xu(s)&&s.includes(C))&&(!l||xu(S)&&xu(l)&&l.find(A=>S==null?void 0:S.includes(A)))&&(!(n!=null&&n.length)||xu(n)&&I(D))}),m.length&&h){let D=m.filter(w=>h.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(C=>C.participantId);if(An(md)(w.eventType))return S;let U=((e==null?void 0:e.participants)??[]).filter(C=>S.includes(C.participantId)).map(C=>C.individualParticipantIds).flat(1);return S.concat(...U)}).flat(1);i=i==null?void 0:i.filter(w=>D.includes(w.participantId))}return i}function xu(t){return t&&Array.isArray(t)&&t.length}function QCe({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Ft(e.reduce((n,r)=>{var l,c;let{flightProfile:a}=Bn({event:r}),o=((l=a==null?void 0:a.flights)==null?void 0:l.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(qt):[]).flat())||[],s=((c=r.drawDefinitions)==null?void 0:c.map(({entries:u})=>u?u.filter(i).map(qt):[]))||[];return n.concat(...o,...s)},[]))}function eEe({eventEntryStatuses:t,tournamentEvents:e}){return Ft(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(qt);return i.concat(...r)},[]))}function xn(t){var j;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:a,policyDefinitions:o,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,contextProfile:f,withStatistics:m,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:I,withEvents:b,withDraws:D,withISO2:w,withIOC:S}=t;if(!l)return{error:Re};(v||r)&&zl({tournamentRecord:l});let{participantMap:U}=qte({convertExtensions:a,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:y,withISO2:w,withIOC:S}),C=JCe({withMatchUps:v??r,withEvents:b??r,withDraws:D??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:a,withScheduleItems:s,policyDefinitions:o,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:m,participantMap:U,withOpponents:g,contextProfile:f,withSeeding:I}),{participantIdsWithConflicts:E,eventsPublishStatuses:P,derivedEventInfo:M,derivedDrawInfo:N,mappedMatchUps:R}=C,A=C.matchUps;U=C.participantMap;let _=c??n,O=({potentialMatchUps:z,scheduleConflicts:H,scheduleItems:K,participant:q,statistics:Y,opponents:Z,matchUps:Q,events:ie,draws:ue})=>{let J=Object.values(ue),te=Object.values(Z);return g&&(J==null||J.forEach(se=>{se.opponents=te.filter(ee=>ee.drawId===se.drawId)})),ht({...q,scheduleConflicts:c?Object.values(H):void 0,draws:D||r?J:void 0,events:b||r?Object.values(ie):void 0,matchUps:v||r?Object.values(Q):void 0,opponents:g?te:void 0,potentialMatchUps:_?Object.values(z):void 0,statistics:m?Object.values(Y):void 0,scheduleItems:s?K:void 0},!1,!1,!0)},x=new Map;for(let z of Object.keys(U))x.set(z,O(U[z]));let F=[...x.values()],$=(j=o==null?void 0:o[l0])==null?void 0:j.participant,V=ZD({participants:F,participantFilters:i,tournamentRecord:l});if(e){let z=Zi(e)?e:void 0;for(let H of V)for(let K of H.individualParticipantIds??[]){H.individualParticipants||(H.individualParticipants=[]);let q=x.get(K);H.individualParticipants.push(z?Hv({template:z,source:q}):q)}}let G=$?V.map(z=>Hv({source:z,template:$})):V;return{participantIdsWithConflicts:E,eventsPublishStatuses:P,derivedEventInfo:M,derivedDrawInfo:N,mappedMatchUps:R,participantMap:U,participants:G,...ne,matchUps:A}}function yv({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var a;if(!e)return{error:et};let r=(a=e.entries)==null?void 0:a.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!n||n===o.entryStage));return t&&r}function I0(t){var h,f,m,g,v,y,I,b,D;let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,structureId:r,stage:a}=t;if(!i)return{error:et};let{entryProfile:o}=_D({drawDefinition:i}),s=a&&n&&((m=(f=(h=o==null?void 0:o[a])==null?void 0:h.stageSequence)==null?void 0:f[n])==null?void 0:m.qualifiersCount)||a&&((g=o==null?void 0:o[a])==null?void 0:g.qualifiersCount)||0,l={};if(!r)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:c}=Ut({drawDefinition:i,structureId:r}),u=(v=i.links)==null?void 0:v.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(c==null?void 0:c.structureId)}),d=0;if(u!=null&&u.length)for(let w of u){let S=(y=Ut({structureId:w.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((S==null?void 0:S.stage)===mt){let U=w.source.roundNumber,C=w.target.roundNumber,E=0;if(S.structureType===Qa){let P=((I=S.structures)==null?void 0:I.length)??0,M=((b=w.source.finishingPositions)==null?void 0:b.length)??0;E=P*M}else E=((D=Ti({matchUpFilters:{roundNumbers:[U]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:D.length)||0;l[C]||(l[C]=0),l[C]+=E,d+=E}}let p=Object.keys(l);if(p.length<=1){let w=p[0]||1;l[w]=Math.max(l[w]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function tR({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=_D({drawDefinition:e});return((n=i==null?void 0:i[t])==null?void 0:n.drawSize)||0}function tEe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=tR({stage:r,drawDefinition:i}),{qualifiersCount:o}=I0({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}function Qte({stage:t,drawDefinition:e}){return!!(t===kr||Kj({stage:t,drawDefinition:e})&&tR({stage:t,drawDefinition:e}))}function eie({entryStatus:t=us,drawDefinition:e,stageSequence:i,stage:n}){if(t===wl)return kPe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...ne}:{error:FQ};let r=tEe({drawDefinition:e,stageSequence:i,stage:n}),a=OPe({drawDefinition:e,stage:n}),o=r$({entryStatus:Hb,drawDefinition:e,stage:n}),s=r$({entryStatus:us,drawDefinition:e,stage:n}),l=o+s,c=l>=r,u=r-l;return n!==kr&&c?{error:ZF}:t===Hb?o<a?{...ne}:{error:ZF}:{positionsAvailable:u,...ne}}function tie(t){let{entryStatus:e=us,entryStageSequence:i,entryStage:n=it,ignoreStageSpace:r,drawDefinition:a,entryPosition:o,participant:s,roundTarget:l,extensions:c,extension:u,drawType:d}=t,p="addDrawEntry";if(!a)return{error:et};if(!n)return{error:UV};if(d!==Rl&&!Qte({stage:n,drawDefinition:a}))return ae({result:{error:og},stack:p});let h=eie({stageSequence:i,stage:n,drawDefinition:a,entryStatus:e});if(!r&&!h.success&&(!d||d!==Rl))return{error:h.error};if(u&&!ou({extension:u}))return ae({result:{error:ve},info:"Invalid extension",context:{extension:u},stack:p});let f=t.participantId||(s==null?void 0:s.participantId);if(!f)return ae({result:{error:mr},stack:p});let m=e===gp&&yv({participantId:f,drawDefinition:a,entryStatus:e}),g=n===kr&&yv({participantId:f,drawDefinition:a,entryStage:n}),v=e!==gp&&n!==kr&&yv({drawDefinition:a,participantId:f});if(v||m||g)return ae({context:{invalidEntry:v,invalidLuckyLoser:m,invalidVoluntaryConsolation:g},result:{error:pA},stack:p});let y=ht({entryStageSequence:i,participantId:f,entryPosition:o,entryStatus:e,entryStage:n,extensions:c});return u&&ci({element:y,extension:u}),l&&ci({extension:{name:"roundEntry",value:l},element:y}),a.entries||(a.entries=[]),a.entries.push(y),Xi({drawDefinition:a}),{...ne}}function iEe(t){let e="addDrawEntries",{entryStatus:i=us,stage:n=it,autoEntryPositions:r=!0,ignoreStageSpace:a,drawDefinition:o,participantIds:s,stageSequence:l,roundTarget:c,extension:u}=t;if(!n)return{error:UV};if(!o)return{error:et};if(!Array.isArray(s))return{error:bl};if(!Qte({stage:n,drawDefinition:o}))return{error:og};if(u&&!ou({extension:u}))return ae({result:{error:ve},info:"Invalid extension",context:{extension:u},stack:e});let d=eie({drawDefinition:o,stageSequence:l,entryStatus:i,stage:n});if(!a&&!d.success)return{error:d.error};let p=d.positionsAvailable??0;if(!a&&n!==kr&&p<s.length)return{error:_V};let h=s.reduce((f,m)=>{let g=i===gp&&yv({participantId:m,drawDefinition:o,entryStatus:i}),v=n===kr&&yv({entryStage:n,drawDefinition:o,participantId:m});return i!==gp&&n!==kr&&yv({drawDefinition:o,participantId:m})||g||v?f.concat(m):f},[]);return s.filter(f=>f&&!h.includes(f)).forEach(f=>{let m={entryStageSequence:l,entryStage:n,participantId:f,entryStatus:i};u&&ci({element:m,extension:u}),c&&ci({extension:{name:Tu,value:c},element:m}),o.entries||(o.entries=[]),o.entries.push(m)}),r&&(o.entries=wc({entries:o.entries})),Xi({drawDefinition:o}),h!=null&&h.length?{info:"some participantIds could not be added",participantIdsNotAdded:h,...ne}:{...ne}}function uG({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,entryStage:s,extension:l,drawId:c,event:u}){if(!(r!=null&&r.length))return{error:gf};if(!u)return{error:Bo};if(!c)return{error:xc};let d=(u.entries||[]).map(qt);if(r.filter(f=>!d.includes(f)).length)return{error:gQ};if(n){let f=iEe({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,extension:l});if(f.error)return f}let{flightProfile:p}=Bn({event:u}),h=p==null?void 0:p.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(r.forEach(f=>{let m=a===gp&&rL({participantId:f,entryStatus:a,flight:h}),g=s===kr&&rL({participantId:f,entryStage:s,flight:h});!(a!==gp&&s!==kr&&rL({flight:h,participantId:f}))&&!m&&!g&&h.drawEntries.push({participantId:f,entryStatus:a,entryStage:s})}),t&&(h.drawEntries=wc({entries:h.drawEntries}))),{...ne}}function rL({participantId:t,entryStatus:e,entryStage:i,flight:n}){var a;let r=(a=n.drawEntries)==null?void 0:a.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&r}function XD({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var d,p,h,f;let a="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Ai};if(!Array.isArray(e)||e.some(m=>!Ga(m)))return ae({result:{error:au},stack:a});let o=(r.drawDefinitions??[]).flatMap(m=>yg({drawDefinition:m}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=r.entries)==null?void 0:d.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(qt).filter(m=>!o.includes(m)),l=(n&&((p=r.entries)==null?void 0:p.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(qt).filter(m=>!o.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||s.includes(m))&&(!n||l.includes(m))):s.length&&l.length?e=kn(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&o.some(m=>e.includes(m)))return ae({result:{error:e0},stack:a});if(!(e!=null&&e.length))return{...ne,participantIdsRemoved:[]};let c=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||c.push(m.participantId),g}),t&&(r.entries=wc({entries:r.entries}));let{flightProfile:u}=Bn({event:r});return(h=u==null?void 0:u.flights)==null||h.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(f=r.drawDefinitions)==null||f.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...ne,participantIdsRemoved:c}}var iie={[_r]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},b0=iie;function Zu(t){var N,R;let{entryStatus:e=us,autoEntryPositions:i=!0,enforceGender:n=!0,participantIds:r=[],entryStageSequence:a,policyDefinitions:o,entryStage:s=it,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!m)return{error:Ai};if(!(r!=null&&r.length))return ae({result:{error:gf},stack:g});if(!(m!=null&&m.eventId))return{error:Bo};let v=Ei({tournamentRecord:l,event:m}).appliedPolicies??{},y=(o==null?void 0:o[_r])??(v==null?void 0:v[_r])??b0[_r],I=(n??((N=y==null?void 0:y.participants)==null?void 0:N.enforceGender))!==!1,b=[],D=[];if(p&&(!Array.isArray(p)||!p.every(A=>ou({extension:A})))||h&&!ou({extension:h}))return ae({context:ht({extension:h,extensions:p}),result:{error:ve},info:"Invalid extension(s)",stack:g});let w=!!l,S=[],U,C=((R=l==null?void 0:l.participants)==null?void 0:R.filter(A=>{var x,F,$;if(!r.includes(A.participantId))return!1;let _=An(Tn)(m.eventType)&&A.participantType===Kt&&!sm(e),O=m.eventType===Wi&&A.participantType===kt;return _&&(!m.gender||!I||[Lo,cu].includes(m.gender)||m.gender===((x=A.person)==null?void 0:x.sex))||O&&!sm(e)||m.eventType===Wi&&A.participantType===Kt&&sm(e)?!0:_&&m.gender&&I&&![Lo,cu].includes(m.gender)&&m.gender!==((F=A.person)==null?void 0:F.sex)?(S.push({participantId:A.participantId,sex:($=A.person)==null?void 0:$.sex}),!1):m.eventType===ji&&(A.participantType===ji||sm(e)&&A.participantType===Kt)}).map(A=>A.participantId))??[],E=r.filter(A=>!w||C.includes(A));m.entries||(m.entries=[]);let P=m.entries.map(A=>{var _;return A.participantId||((_=A.participant)==null?void 0:_.participantId)});if(E.forEach(A=>{var _;if(!P.includes(A)){let O=ht({participantId:A,entryStatus:e,entryStage:s,extensions:p});h&&ci({element:O,extension:h}),d&&ci({extension:{name:Tu,value:d},element:O}),a&&(O.entryStageSequence=a),b.push(O.participantId),(_=m.entries)==null||_.push(O)}}),f&&!sm(s)){let A=uG({participantIds:E,autoEntryPositions:i,entryStageSequence:a,ignoreStageSpace:c,drawDefinition:u,entryStatus:e,roundTarget:d,entryStage:s,extension:h,drawId:f,event:m});A.error&&(U=A.error)}if(m.eventType&&[Kh,Ws].includes(m.eventType)){let A=(m.entries||[]).map(F=>F.participantId),_=(m.entries||[]).filter(F=>sm(F.entryStatus)).map(F=>F.participantId),O=((l==null?void 0:l.participants)??[]).filter(F=>A.includes(F.participantId)&&F.participantType&&[kt,ji].includes(F.participantType)).map(F=>F.individualParticipantIds).flat(1/0),x=_.filter(F=>O.includes(F));x.length&&(D.push(...x),XD({participantIds:x,autoEntryPositions:!1,event:m}))}if(E.length!==r.length)return ae({context:{mismatchedGender:S,gender:m.gender},result:{error:bl},stack:g});i&&(m.entries=wc({entries:m.entries||[]}));let M=b.length-D.length;return ae({result:{...ne,addedEntriesCount:M},stack:g,info:U})}var nie="ADMINISTRATION",nEe="CAPTAIN",rEe="COACH",ga="COMPETITOR",rie="MEDIA",aie="MEDICAL",dG="OFFICIAL",oie="OTHER",sie="SECURITY",Uf={ADMINISTRATION:nie,CAPTAIN:nEe,COACH:rEe,COMPETITOR:ga,MEDIA:rie,MEDICAL:aie,OFFICIAL:dG,OTHER:oie,SECURITY:sie};function pG({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return ae({result:{error:Re},stack:a});if(!i||!e)return ae({result:{error:ut},stack:a});let o=(n.participants??[]).find(u=>u.participantId===i);if(!o)return ae({result:{error:jn},stack:a});if(![ji,vs].includes(o.participantType))return ae({result:{participantType:o.participantType,error:Dc},stack:a});let s=lie({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=s;if(c)return ae({result:s,stack:a});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));Zu({participantIds:p,entryStatus:Vl,tournamentRecord:n,event:u})}}return l&&ei({topic:aa,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...ne,...s}}function lie({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var p,h;let o=[];if(!e)return{removed:o};let s=[],l=[];a||({participants:a,mappedMatchUps:r}=xn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=(h=(p=a==null?void 0:a.find(({participantId:f})=>f===e.participantId))==null?void 0:p.events)==null?void 0:h.map(({eventId:f})=>f),u=(e.individualParticipantIds??[]).filter(f=>{var y;let m=t==null?void 0:t.includes(f),g=m&&((y=a==null?void 0:a.find(I=>I.participantId===f))==null?void 0:y.matchUps.filter(({eventId:I})=>c.includes(I)).map(({matchUpId:I})=>r==null?void 0:r[I]).filter(({winningSide:I,score:b})=>I||Vr({score:b}))),v=m&&!(g!=null&&g.length);if(m&&!v&&l.push(f),v){o.push(f);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:D}=Vt({element:b,name:pp}),w=D==null?void 0:D.value[e.participantId];D&&w&&(D.value[e.participantId]=w.filter(U=>U.participantId!==f),ci({element:b,extension:D}),RD({drawDefinition:b}));let S=no({drawDefinition:b,inContext:!1}).matchUps??[];for(let U of S){let C=U.sides??[];for(let E of C){let P=E.lineUp??[];P.find(M=>M.participantId===f)&&(E.lineUp=P.filter(M=>M.participantId!==f),oi({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:U}))}}}}else s.push(f);return!v});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:o};return l.length&&!n&&{...d,cannotRemove:l,error:dA}||d}function qA({participantRole:t=ga,individualParticipantIds:e=[],groupingTypes:i=[$s,vs],tournamentRecord:n}){if(!n)return{error:Re};let r=n.participants??[],{participants:a,mappedMatchUps:o}=xn({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=lie({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:o,participants:a});c&&s++}),s?ne:{error:_Q}}function Gy(t){var h,f,m;if(!(t!=null&&t.tournamentRecord))return{error:Re};if(!((h=t==null?void 0:t.participantIds)!=null&&h.length))return{error:gf};let{addIndividualParticipantsToEvents:e,tournamentRecord:i,participantIds:n}=t,r=((f=i.participants)==null?void 0:f.length)||0;if(!r)return{...ne};let a=(m=i.events||[])==null?void 0:m.filter(({eventType:g})=>g===Tr).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),o=xn({participantFilters:{participantIds:n},tournamentRecord:i,withDraws:!0}).participants??[],s=()=>{let g=(Br({matchUpFilters:{drawIds:a,matchUpTypes:[Wi]},tournamentRecord:i}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return kn(g,n)},l=(a==null?void 0:a.length)&&s(),c=o.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(a!=null&&a.length)||!(a!=null&&a.includes(y.drawId)))&&y.positionAssignments).length});if(l!=null&&l.length||c.length)return{error:e0};let u={},d={};for(let g of i.events||[]){let v=XD({participantIds:n,event:g});if(v.error)return v;u[g.eventId]=v.participantIdsRemoved}i.participants=i.participants.filter(g=>{let v=n.includes(g.participantId)||g.participantType===kt&&g.individualParticipantIds.some(y=>n.includes(y));if(!v&&g.participantType===Tr&&g.individualParticipantIds.some(y=>n.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!n.includes(y))),v&&e&&[kt,ji].includes(g.participantType))for(let y of g.individualParticipantIds||[])n.includes(y)||(d[g.participantId]||(d[g.participantId]=[]),d[g.participantId].push(y));return!v});let p=r-i.participants.length;if(qA({individualParticipantIds:n,tournamentRecord:i}),e)for(let g of i.events||[]){let v=u[g.eventId].map(y=>d[y]||[]).flat();Zu({participantIds:v,entryStatus:Vl,tournamentRecord:i,event:g})}return p&&ei({payload:{participantIds:n,tournamentId:i.tournamentId},topic:kj}),p?{...ne,participantsRemovedCount:p}:{error:dA}}function cie({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var l;let o=r.entries??[];if(n){let{flightProfile:c}=Bn({event:r}),u=(l=c==null?void 0:c.flights)==null?void 0:l.find(d=>d.drawId===n);u?o=u.drawEntries:e.entries&&(o=e==null?void 0:e.entries)}let s=o.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&jl.includes(c.entryStatus)));return{entries:o,stageEntries:s}}function uie({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var v;let s="destroyGroupEntry";if(!e)return{error:Re};if(!n)return ae({result:{error:mr},stack:s});if(!o)return{error:Ai};if(!o.eventType||![Kh,Ws].includes(o.eventType))return ae({result:{error:Vh},stack:s});let l=e.participants??[],c=l.find(y=>y.participantId===n);if(!c)return ae({result:{error:jn},stack:s});if(!c.participantType||![kt,$s].includes(c.participantType)||c.participantType===$s&&o.eventType!==Ws||c.participantType===kt&&o.eventType!==Kh)return{error:Dc};let u=(o.entries??[]).find(y=>y.participantId===n);if(!u)return{error:LQ};let{stageEntries:d}=cie({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),p=d.map(qt),h=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(v=c.individualParticipantIds)==null?void 0:v.filter(y=>Yc(y,h).length===1),m=XD({participantIds:[n],event:o});if(m.error||f!=null&&f.length&&(m=Zu({participantIds:f,entryStatus:Vl,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:o}),m.error))return m;let g;return t&&Gy({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...ne,participantRemoved:g}}function hG({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return uie({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function die(t){if(!t.tournamentRecord)return{error:Re};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let o=uie({participantId:a,...i});o.success&&(n+=1),o.error&&r.push(o.error)}return n?{destroyedCount:n,...ne}:{error:r}}function nU(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",c=YD(t);if(c.error)return ae({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t;if([wl,vp].includes(a)&&u){let{tournamentRecord:m}=t,{participant:g}=vg({tournamentRecord:m,participantId:u}),{participantType:v,individualParticipantIds:y}=g??{};if(r&&v===kt){let I=hG({tournamentRecord:m,drawDefinition:n,participantId:u,event:p});if(I.error)return ae({result:I,stack:l});y&&eR({participantIds:y,tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else eR({participantIds:[u],tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let m=ys({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:o,event:p});if(m.error)return ae({result:m,stack:l})}let{structure:f}=Ut({drawDefinition:n,structureId:h});return zj({structure:f,drawPositions:[d]}),xA({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function pie(t){return Object.assign(t,{entryStatus:vp}),nU(t)}function p$(t){return Ga(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function ta(t){return Ga(t)?p$(t.replace(/_/g," ")):""}var Oh=({finishingPosition:t=Oy,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??Oi(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:c};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Ft(I).sort((b,D)=>b-D).map(b=>({drawPosition:b}))),y},As=Oh;function fG({structureName:t=ta(kr),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:et};let a=As({stage:kr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Xi({drawDefinition:i,structureIds:[a.structureId]}),{...ne}}function mG({drawPositions:t}){if(!(t!=null&&t.length))return{error:hD};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=Ft(i.map(KA)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function KA(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(ar).join("|")}function hie({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],o[v]])});let h=a.shift(),f=a.pop(),m=o.shift();a=[h,m,...a].filter(Boolean),o=[...o,f].filter(Boolean)});let s=a.shift(),l=a.pop(),c=o.shift();a=[s,c,...a].filter(Boolean),o=[...o,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return KA(h)}))}function aEe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:ut}}var oEe={getRoundRobinGroupMatchUps:mG,determineRoundNumber:aEe,drawPositionsHash:KA,groupRounds:hie};function JD(t){var S;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:n=1,structureOptions:r,appliedPolicies:a,seedingProfile:o,stage:s=it,matchUpType:l,roundTarget:c,structureId:u,groupNames:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g=t.structureName??((S=i==null?void 0:i["0"])==null?void 0:S.name)??ta(it),{groupCount:v,groupSize:y}=sEe({structureOptions:r,appliedPolicies:a,drawSize:p}),I=p0,b,D=Ze(1,v+1).map(U=>{let C=lEe({groupSize:y,structureOrder:U,matchUpType:l,drawSize:p,idPrefix:h,isMock:f});b=Array.isArray(C)?Math.max(...C.map(({roundNumber:P})=>P??0)):0;let E=(d==null?void 0:d[U-1])??`${e} ${U}`;return Oh({structureId:m==null?void 0:m.pop(),structureType:RA,finishingPosition:I,structureOrder:U,structureName:E,matchUps:C})}),w=Oh({structureId:u??(m==null?void 0:m.pop()),structureType:Qa,finishingPosition:I,seedingProfile:o,structureName:g,stageSequence:n,structures:D,stage:s});return c&&ci({extension:{name:Tu,value:c},element:w}),{structures:[w],maxRoundNumber:b,groupCount:v,links:[],groupSize:y,...ne}}function sEe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=QD({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&(a!=null&&a.includes(n))||(n&&n>4||!(a!=null&&a.includes(4))?n=o:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function QD({drawSize:t,groupSizeLimit:e=10}){let i=Ze(3,e+1).filter(n=>{let r=Math.ceil(t/n),a=r*n-t,o=Math.ceil(t/r),s=Math.ceil(a/r);return(!a||a<n)&&o===n&&o>=3&&s<2});return{...ne,validGroupSizes:i}}function lEe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(t-1)*i,l=Ze(1+s,i+1+s),c=mG({drawPositions:l}).uniqueMatchUpGroupings??[],u=hie({groupSize:i,drawPositionOffset:s});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=KA(h),m=d(f),g=[1,n],v=cEe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:o}),y={matchUpStatus:m?On:bi,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function cEe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||Oi()}function gG(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!Mt(i))return{seedBlocks:void 0,...ae({result:{error:ve},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=n0(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Ze(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Ze(m,m+h);m+=h,f.push(g)}return{...ne,seedBlocks:f}}let a=Ze(1,r+1),o=[],s=r/2;for(;s>1;){let h=Fr(a,s),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,I=g%2===0,b=m[0],D=m[m.length-1];n&&f>4?f===8?v=y?D:b:v=I?b:D:v=y?b:D,za(m,o)||o.push(v)}),s=s/2}let l=a.filter(h=>!o.includes(h));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let c=Ze(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return Ze(0,u).forEach(h=>{p.push(o.slice(d,d+c[h])),d+=c[h]}),{...ne,seedBlocks:p}}function vG({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!Mt(e))return{seedGroups:void 0,...ae({result:{error:ve},context:{drawSize:e},stack:i})};if(t){if(!Mt(t))return{seedGroups:void 0,...ae({context:{roundRobinGroupsCount:t},result:{error:ve},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Ze(0,r).map(()=>{let a=Ze(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=gG({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function yG({roundRobinGroupsCount:t,participantsCount:e}){var r;if(t){let{validGroupSizes:a}=QD({drawSize:e});if(!((r=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&r.includes(t)))return ae({context:{roundRobinGroupsCount:t},result:{error:ve}})}let{seedGroups:i}=vG({drawSize:e,roundRobinGroupsCount:t}),n=(i==null?void 0:i.map(a=>Math.min(...a)))||[];return{...ne,seedingThresholds:n}}function Wb(t){if(!t)return 1/0;if(Mt(t))return wt(t);let e=t.split("-")[0];return Mt(e)?wt(e):1/0}function uEe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(ar),e.reverse(),e}function dEe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function pEe({positioning:t,size:e}){let i=uEe({size:e}),n=[],r=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,h)=>(t&&[MA,Rm].includes(t)&&h%2?o(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=s(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=s(p,h);if(!r.includes(f))return r.push(f),f},d=Ze(1,e+1);for(let p of i)if(p===1){let h=Fr(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=Fr(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function Hy({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var _;let s=[];if(!o)return{error:mf};let{matchUps:l,roundMatchUps:c}=Ti({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:u}=zs({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:o}),{positionAssignments:d}=Er({structure:o}),p=d==null?void 0:d.length,h=(u==null?void 0:u.length)??0,f=[],m=Object.keys(c).map(O=>parseInt(O)).sort((O,x)=>O-x).map(O=>{let x=c[O].map($=>$.drawPositions).flat(1/0).filter(Boolean),F=x.filter($=>!f.includes($));return f=f.concat(...x),F}).filter(O=>O.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;n=n??((_=i==null?void 0:i.seeding)==null?void 0:_.seedingProfile);let y=(g==null?void 0:g.length)||0,I=m.filter(O=>O.filter(x=>x<=h).length),{stage:b,structureType:D,roundLimit:w}=o,S=D===Qa,U=!S&&(m==null?void 0:m.length),C=!S&&b===mt&&w,E=I.flat(1/0),P=U?E==null?void 0:E.length:0,M=a?p:h,N=iG({drawDefinition:r,structure:o,matchUps:l}),R=N?0:!U&&M||M&&E.length<M&&M-E.length||0;if(C){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:F})=>F===o.roundLimit).length:0,x=g.length/O;if(!U){let F=eP(n),$=Fr(g,x),V=1,G=Ze(0,$[0].length).map(()=>{let j=Ze(V,V+$.length);return V+=$.length,j});({validSeedBlocks:s}=fie({drawPositionBlocks:$,nonRandom:n==null?void 0:n.nonRandom,positioning:F,seedGroups:G}))}}else S?{validSeedBlocks:s}=hEe({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:o}):U?s=I.map(O=>({seedNumbers:O,drawPositions:O})):N&&Fr(g,2).map((O,x)=>({drawPositions:[O[0]],seedNumbers:[x+1]})).forEach(O=>s.push(O));if(!S&&!N&&!C){let{blocks:O}=fEe({drawPositionOffset:v,seedNumberOffset:P,seedCountGoal:R,seedingProfile:n,baseDrawSize:y});O.forEach(x=>s.push(x))}let A=s.flatMap(O=>O.drawPositions).reduce((O,x)=>(g==null?void 0:g.includes(x))&&O,!0);return!N&&!U&&!S&&!A?{error:pQ,validSeedBlocks:[],isContainer:S,isFeedIn:U}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:S,isFeedIn:U}}function hEe({seedingProfile:t,structure:e,nonRandom:i}){var u;let n=e.structures||[],r=n.length,a=(u=Bi({structure:e}))==null?void 0:u.positionAssignments,o=eP(t),s=(a==null?void 0:a.length)??0,{seedGroups:l}=vG({roundRobinGroupsCount:r,drawSize:s}),c=n.map(d=>{var p;return(p=Bi({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return fie({drawPositionBlocks:c,positioning:o,seedGroups:l,nonRandom:i})}function fie({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=pEe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let c=dEe({blockPattern:a,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Rm?h=n?h:La(h):l%2&&h.reverse();let f=h.find(m=>!o.includes(m));f&&(o.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function fEe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:c}=gG({cluster:eP(r)===MA,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>a)break;let p=d.map(f=>f+e),h=u(s+1,d.length).map(f=>+f+n);s+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function iR({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var l,c,u,d,p,h;let{structure:o}=Ut({drawDefinition:e,structureId:r});t||(t=Ei({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&o&&(s=(l=Hy({appliedPolicies:t,drawDefinition:e,structure:o}))==null?void 0:l.validSeedBlocks),(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((h=s.find(f=>f.seedNumbers.includes(a)))==null?void 0:h.drawPositions)||[]).includes(n):[].concat(...s.map(f=>f.drawPositions)).includes(n)}function mie(t){var M,N,R;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:n,seedBlockInfo:r,structureId:a,randomize:o}=t,{structure:s}=Ut({drawDefinition:i,structureId:a}),{seedAssignments:l}=zs({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:c}=Er({structure:s}),u=(M=c==null?void 0:c.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:M.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:d}=Ei({drawDefinition:i}),p=((r==null?void 0:r.validSeedBlocks)||s&&((N=Hy({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:n,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(u!=null&&u.includes(_))).length)[0],h=l==null?void 0:l.map(A=>A.participantId).filter(Boolean),f=c==null?void 0:c.map(A=>A.participantId).filter(Boolean),m=h==null?void 0:h.filter(A=>f==null?void 0:f.includes(A)),g=h==null?void 0:h.filter(A=>!(f!=null&&f.includes(A))),v=l==null?void 0:l.filter(A=>g==null?void 0:g.includes(A.participantId)),y=l==null?void 0:l.filter(A=>!A.participantId),I=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(A=>!(u!=null&&u.includes(A))))||[],b=o?La(I):I,D=[],w=b.map(()=>{var _;let A=(_=P(v,D))==null?void 0:_.participantId;return A&&D.push(A),A}).filter(Boolean),S=l==null?void 0:l.filter(A=>m==null?void 0:m.includes(A.participantId)).map(A=>A.seedNumber),U=((p==null?void 0:p.seedNumbers)||[]).filter(A=>!(S!=null&&S.includes(A))),C=l==null?void 0:l.filter(A=>U.includes(A.seedNumber)).map(A=>A.participantId),E=(R=d==null?void 0:d.seeding)==null?void 0:R.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?w:C,unplacedSeedNumbers:U,unfilledPositions:b,unplacedSeedAssignments:v};function P(A,_){let O=A.filter($=>!_.includes($.participantId)),x=Math.min(...O.map($=>Wb($.seedValue))),F=O.filter($=>Wb($.seedValue)===x);return La(F).pop()}}function eP(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function w0({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:c,event:u}){var D,w,S;let d="assignSeed",{structure:p}=Ut({drawDefinition:i,structureId:o}),{positionAssignments:h}=Er({structure:p}),f=zs({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(U=>U.seedNumber),g=yv({drawDefinition:i,participantId:r});if(r&&!g)return ae({result:{error:au},context:{participantId:r},stack:d});let v=u?(w=(D=Bn({event:u}).flightProfile)==null?void 0:D.flights)==null?void 0:w.length:0,y=v&&v>1,I=(S=h==null?void 0:h.find(U=>U.participantId===r))==null?void 0:S.drawPosition;if(I&&!iR({drawPosition:I,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return ae({result:{error:vV},context:{assignedDrawPosition:I},info:"invalid seed position",stack:d});m.includes(s)||f.push({seedNumber:s,seedValue:l});let b;return f.forEach(U=>{U.participantId===r&&U.seedNumber!==s&&(U.participantId=void 0),U.seedNumber===s&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!y&&(U.seedValue=l??s),b=!0)}),b?(lte({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...ne}):ae({result:{error:dQ},stack:d})}function IG({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var p,h,f,m;let s=(h=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:h.sideNumber,l=s&&((f=a.sides)==null?void 0:f.find(g=>g.sideNumber===s)),{extension:c}=Vt({element:r,name:pp}),u=(c==null?void 0:c.value)||{},d=at(u[i],!1,!0);if(l)(m=a==null?void 0:a.sides)==null||m.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}oi({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a})}function gie(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=_m({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=s.find(({drawPositions:f,roundNumber:m})=>m===o&&(f==null?void 0:f.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=o&&s.find(({roundNumber:f,roundPosition:m})=>f===o&&m===u),p=d==null?void 0:d.matchUpStatus,h=[Qn,hr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function mEe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(ar).filter(Boolean),positionAdded:i,positionAssigned:n}}function vie({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:_m({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function yie({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=vie({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(u=>u.matchUpId===s),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=Ga(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function z1({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:r},void 0)}function qb({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:c}){var M,N,R,A;let u="assignMatchUpDrawPosition";s||(s=ca({drawDefinition:r})),t||(t=sr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let d=t.find(_=>_.matchUpId===l),p=d==null?void 0:d.structureId,h=(M=r==null?void 0:r.structures)==null?void 0:M.find(_=>_.structureId===p);if(!h)return{error:bn};let f=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(_=>_.matchUpId===l),m=(f==null?void 0:f.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=mEe({drawPosition:o,drawPositions:m}),{positionAssignments:I}=Bi({drawDefinition:r,structure:h}),b=(R=I==null?void 0:I.filter(_=>y.includes(_.drawPosition)))==null?void 0:R.find(({bye:_})=>_),D=(f==null?void 0:f.matchUpStatus)&&[Pi,fi].includes(f.matchUpStatus)&&y.filter(Boolean).length<2;if(a=b&&bi||a||D&&f.matchUpStatus||(f==null?void 0:f.matchUpStatus)&&[Qn,hr].includes(f.matchUpStatus)&&f.matchUpStatus||On,f&&g){t=sr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=D&&z1({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;f!=null&&f.matchUpStatusCodes&&yie({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:_,matchUpStatus:a}),oi({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:u,drawDefinition:r,matchUp:f})}let w=qa({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:S,loserMatchUp:U,loserTargetDrawPosition:C},targetLinks:{loserTargetLink:E}}=w,P=_m({structureId:h.structureId,matchUpsMap:s});if(v&&b){if(S)if([bi,Qn,hr].includes(a)){let _=qb({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=S;_!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(S&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=gie({targetMatchUp:f,drawPosition:o,matchUpsMap:s,structure:h});if(_){let O=qb({matchUpId:S.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((f==null?void 0:f.matchUpType)===Ki){let _=t==null?void 0:t.find(({matchUpId:F})=>F===f.matchUpId),O=((_==null?void 0:_.sides)??[]).reduce((F,$,V)=>$.drawPosition===o?V:F,void 0),x=(A=I==null?void 0:I.find(F=>F.drawPosition===o))==null?void 0:A.participantId;x&&O!==void 0&&IG({inContextTargetMatchUp:_,drawPositionSideIndex:O,teamParticipantId:x,tournamentRecord:i,drawDefinition:r,matchUp:f})}if((E==null?void 0:E.linkCondition)===pd&&y.filter(Boolean).length===2&&!b&&P.filter(({drawPositions:_,roundNumber:O})=>O===1&&za(_,y)).every(({matchUpStatus:_})=>[Wn,Ra].includes(_))&&U){let{structureId:_}=U,O=ys({drawPosition:C,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:c});if(O.error)return O}return v?{...ne}:ae({result:{error:Nb},context:{drawPosition:o},stack:u})}function Iie({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var u,d,p,h;let a=((p=(d=(u=h0({drawDefinition:e}))==null?void 0:u.containedStructures)==null?void 0:d[r.structureId])==null?void 0:p.map(({structureId:f})=>f))||[];a.push(r==null?void 0:r.structureId);let o=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],s=(t==null?void 0:t.filter(f=>a.includes(f.structureId)&&kn(f.drawPositions??[],o).length))??[],l=s.map(({matchUpId:f})=>f),c=((h=n==null?void 0:n.drawMatchUps)==null?void 0:h.filter(f=>l.includes(f.matchUpId)))??[];return{drawPositions:o,matchUps:c,targetMatchUps:s}}function bG({lineUp:t}){if(!Array.isArray(t))return;let e={};return Ft(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=JM({collectionPosition:a,collectionId:n,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function gd(t){return`${t} must be an array`}function YA({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(gd("lineUp")),{valid:!1,errors:i,error:ve};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(gd("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Ft(t.map(qt)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?ve:void 0}}function zy({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:et};if(typeof e!="string")return{error:mr};let r=YA({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=Vt({element:t,name:pp}),o=(a==null?void 0:a.value)||{};return o[e]=bG({lineUp:n}),ci({element:t,extension:{name:pp,value:o}}),RD({drawDefinition:t}),{...ne}}function wG({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:et};let{drawPositions:l,matchUps:c,targetMatchUps:u}=Iie({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:o});for(let d of u)d.matchUpType===lu&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&zy({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}oi({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...ne}}function uu({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var U,C,E;let h="assignDrawPosition";if(!s&&!i)return ae({result:{error:mr},stack:h});u=u??ca({drawDefinition:a}),e||({matchUps:e}=sr({inContext:!0,drawDefinition:a,matchUpsMap:u}));let f=Ut({drawDefinition:a,structureId:d});if(f.error)return ae({result:f,stack:h});let{structure:m}=f;if(!m)return{error:bn};if(Go({structure:m}))return ae({result:{error:oo},stack:h});let{seedAssignments:g}=zs({provisionalPositioning:t,drawDefinition:a,structure:m}),v=(U=g==null?void 0:g.find(P=>P.participantId===s))==null?void 0:U.seedNumber,{appliedPolicies:y}=Ei({tournamentRecord:r,drawDefinition:a,structure:m,event:p});if(v&&!iR({seedNumber:v,appliedPolicies:y,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return ae({result:{error:vV},context:{drawPosition:c},stack:h});let I=Er({structure:m}).positionAssignments||[],b=I==null?void 0:I.find(P=>P.drawPosition===c);if(!b)return ae({result:{error:Zw},context:{drawPosition:c},stack:h});if(I!=null&&I.map(qt).includes(s))return ae({result:{error:e0},context:{drawPosition:c},stack:h});let{containsParticipant:D,containsBye:w}=S(b);if(w){let P=YD({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(P.error)return ae({result:P,stack:h})}if(D&&b.participantId!==s){let{activeDrawPositions:P}=KD({drawDefinition:a,structureId:d});if(P.includes(c))return ae({result:{error:oA},stack:h});wG({assignments:[b],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:m})}if(b.participantId=s,i&&(b.qualifier=!0),((m==null?void 0:m.stageSequence)||0)>1||m.stage&&[ra,Rn].includes(m.stage)){let P=m.stage===mt?mt:it,M=(((E=(C=a.structures)==null?void 0:C.find(N=>(N==null?void 0:N.stage)===P&&(N==null?void 0:N.stageSequence)===1))==null?void 0:E.seedAssignments)??[]).find(N=>N.participantId===s);if(M!=null&&M.participantId){let{participantId:N,seedNumber:R,seedValue:A}=M;w0({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:R,seedValue:A,structureId:d,event:p})}}if(m.structureType!==Qa)gEe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:m,event:p});else{Zte({positionAssignments:I,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:m});let{drawPositions:P,matchUps:M,targetMatchUps:N}=Iie({assignments:[b],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:m});if(P&&(M==null?void 0:M.length)===1&&M[0].matchUpType===Ki){let R=((N==null?void 0:N[0].sides)??[]).reduce((A,_,O)=>P!=null&&P.includes(_.drawPosition)?O:A,void 0);IG({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:M[0],drawPositionSideIndex:R,tournamentRecord:r,drawDefinition:a})}}return qh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:m,event:p}),{positionAssignments:I,...ne};function S(P){let M=P.bye,N=P.qualifier,R=P.participantId;return{containsBye:M,containsQualifier:N,containsParticipant:R,filled:M||N||R}}}function gEe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=Ti({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Wa({matchUps:u}),{initialRoundNumber:p}=Zv({drawPosition:a,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)}));if(h){let f=qb({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(f.error)return ae({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...ne}}function SG(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:et};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=ca({drawDefinition:a}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=sr({inContext:!0,drawDefinition:a,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));let{positionAssignments:h}=Bi({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(I=>I.drawPosition===s);if(f!=null&&f.participantId){let I=f.participantId,b=uu({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return b.success?y({removedParticipantId:I}):ae({result:b,stack:u})}let m=YD({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(m.error)return ae({result:m,stack:u});let g=m.participantId,v=uu({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(!v.success)return ae({result:v,stack:u});return y({removedParticipantId:g});function y({removedParticipantId:I}){let{structure:b}=Ut({drawDefinition:a,structureId:l});zj({drawPositions:[s],structure:b});let D={[e]:o,name:n,drawPosition:s,structureId:l};return xA({drawDefinition:a,positionAction:D}),ae({context:{removedParticipantId:I},result:{...ne},stack:u})}}function vEe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return SG({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function bie(t){return vEe(t)}function yEe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return SG({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function wie(t){return yEe(t)}function Sie({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],oi({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function Tie(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=gi(t,i);if(n.error)return n;let r=Ut(t);if(r.error)return r;let a=r.structure;if(!Go({structure:a}))return ae({result:{error:Ey,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Wa({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Md}}function Uie(t){var u;let e=Tie(t,[{targetRoundNumber:!0,roundNumber:!0,[bf]:WDe}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e,{targetRoundNumber:a,roundNumber:o}=t;if(!(r!=null&&r.includes(o))||!(r!=null&&r.includes(a)))return ae({result:{error:ve},info:"roundNumbers must be valid rounds"});let s=a>o,l=s?Ze(o+1,a+1):Ze(a,o),c={};return l.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(s?1:-1)})),(u=n==null?void 0:n[o])==null||u.forEach(({matchUpId:d})=>c[d]=a),Sie({params:t,modMap:c,structure:i}),{...ne}}function Die({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var s;if(!n)return{error:et};if(!Array.isArray(t))return{error:ve};let a="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=Ut({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:bn};let h=(s=Bi({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(kn(h,f).length!==(h==null?void 0:h.length))return ae({result:{error:ve},info:"drawPositions do not match",stack:a});let m=ca({drawDefinition:n}),{matchUps:g}=sr({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:D}=v;if(b){let w=ys({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(w!=null&&w.error)return w}else if(D)u.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=uu({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:I,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(w!=null&&w.error)return w}}qh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let o=t.map(({structureId:l})=>l);return Xi({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:o}),{...ne}}function Pie(t){let e=Tie(t,[{roundNumbers:!0,[bf]:No,[uc]:o=>o.length===2&&o.every(En)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(o=>r==null?void 0:r.includes(o)))return ae({result:{error:ve,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((n==null?void 0:n[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),Sie({params:t,modMap:a,structure:i}),{...ne}}function IEe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return SG({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Cie(t){return IEe(t)}function bEe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:et};if(!n)return{error:gs};if((i==null?void 0:i.length)!==2)return{error:ve,drawPositions:i};let a=ca({drawDefinition:e}),{matchUps:o}=sr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=Ut({drawDefinition:e,structureId:n});if(!s)return{error:bn};let l;if(s.structureType===Qa?l=TEe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}):l=wEe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}),l.error)return l;if(zj({structure:s,drawPositions:i}),xA({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),qh({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===Ws){let c=Ti({matchUpFilters:{matchUpTypes:[lu]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(h=>i.includes(h))}),u=Ti({matchUpFilters:{matchUpTypes:[lu]},structure:s}).matchUps;c.forEach(d=>{(d.sides||[]).forEach(p=>{var f;let h=p==null?void 0:p.drawPosition;if(i.includes(h)){let m=p.participantId,g=u.find(({matchUpId:y})=>y===d.matchUpId),v=(f=d==null?void 0:d.sides)==null?void 0:f.reduce((y,I,b)=>I.drawPosition===h?b:y,void 0);IG({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return Xi({drawDefinition:e,structureIds:[n]}),{...ne}}function wEe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!s)return{error:ve,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...ne};if(s.filter(({qualifier:c})=>c).length===2)return{...ne};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?Eie({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):SEe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}function Eie({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=nU({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=nU({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(ys({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),h=uu({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:o}),h.error)?h:{...ne}}function SEe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),wG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...ne}}function TEe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var c;let s=(c=a.structures)==null?void 0:c.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(s.filter(({bye:u})=>u).length===2)return{...ne};if(s.filter(({qualifier:u})=>u).length===2)return{...ne};wG({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:s,structure:a,event:o});let l=s.some(({qualifier:u})=>u);if(s.some(({bye:u})=>u)&&!l)Eie({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o});else{let u=at(s,!1,!0);s.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...ne}}function Mie(t){return bEe(t)}function Rie({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:et};if(!r)return{error:gs};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:au};let{structure:l}=Ut({drawDefinition:i,structureId:r});if(!l)return{error:bn};if(!(!t||En(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>En(p)&&wt(p)>0)))return{error:ve};let{seedAssignments:c}=zs({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return lte({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...ne}}function Nie({drawDefinition:t,structureId:e}){if(!t)return{error:et};let{structure:i}=Ut({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function ZA({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:Ai};let s={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=fd({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function TG({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!e)return{error:Re};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=ZA({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:c,stage:o});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Yh(t){if(!(t!=null&&t.drawDefinition))return!1;let e=zA(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:o})=>o===Ki),r=r==null?void 0:r.filter(({matchUpType:o})=>o===Ki),a=a==null?void 0:a.filter(({matchUpType:o})=>o===Ki)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function UG(t){var o,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:et};let{playoffStructures:n}=Nie({drawDefinition:e,structureId:i});if(!(n!=null&&n.length))return!1;let r=((s=(o=e==null?void 0:e.entries)==null?void 0:o.filter(l=>(l==null?void 0:l.entryStatus)&&jl.includes(l.entryStatus)))==null?void 0:s.length)??0,a=0;return(n||[]).reduce((l,c)=>{var u;return!!((u=Bi({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&a++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!n.length)||a===r}function h$({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=h$({accessors:o,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],o.length){let s=h$({accessors:o,significantCharacters:t,value:i});n.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;n.push(s)}}return n}function UEe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:EV};if(!Array.isArray(n))return{error:vD};let r={};return t.forEach(a=>{let o=n.find(l=>l.participantId===a),{values:s}=Aie({policyAttributes:e,idCollections:i,participants:n,participant:o});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function Aie({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:EV};if(!n)return{error:Ry};let r=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");r.push(...h$({significantCharacters:c,value:n,accessors:u}))}else if(o){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var f;let h=i.find(m=>m.participantId===p);if((f=h==null?void 0:h.individualParticipantIds)!=null&&f.includes(n.participantId)){let m=h==null?void 0:h.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(n.participantId)&&r.push(u)})}),{values:Ft(r)}}function eK({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=r[a.participantId],{values:s}=Aie({participants:e,policyAttributes:i,idCollections:n,participant:o});return{...a,values:s}})}function _ie({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[r]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function DEe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=_ie(t);return i.map(a=>{let o=e.filter(c=>a.includes(c)),s=r(o),l=o.filter(c=>!s.includes(c)).filter(c=>{var d;let u=tK(c);return!((d=n[u])!=null&&d.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function r(a){return a.filter(s=>!o(s));function o(s){let l=tK(s);return!a.includes(l)}}}function PEe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=_ie(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),o=a.length===r.length?a:[],s=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function tK(t){return Number(t%2?t+1:t-1)}function CEe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function EEe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map(s=>a?PEe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):DEe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function kie({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function MEe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var c;let a=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),o=Object.keys(a).reduce((u,d)=>a[d].length>u?a[d].length:u,0),s=Object.keys(a).filter(u=>a[u].length===o),l=_o(i?s:Object.keys(a));return r=t&&((c=a[r])!=null&&c.length)?r:l,{participantId:r&&a[r]?_o(a[r]):_o(e),groupKey:r}}function REe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function NEe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l=r.reduce((U,C)=>C.length>U?C.length:U,0)<=2,c=kie({positionAssignments:t,participantIds:e}),u=REe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=MEe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),h=CEe({participantId:d,allGroups:o}),f=EEe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,D=a?I:y,w=(b==null?void 0:b.length)&&b||(D==null?void 0:D.length)&&D,S;if(w!=null&&w.length){let U=Oo(w);S=Oo(U)}else{let U=Oo(m[0]);S=Oo(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function nR({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),a=mG({drawPositions:r}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{za(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,a;za(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function AEe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(o!=null&&o.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=nR({isRoundRobin:r,groupedParticipants:[[s,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=nR({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function iK(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,h=at(e,!1,!0).filter(I=>!I.qualifier),f=e.filter(I=>!I.participantId&&(!I.bye||(r==null?void 0:r.includes(I.drawPosition)))).map(I=>I.drawPosition);Ze(0,n).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:D}=NEe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=I,h.forEach(w=>{w.drawPosition===D&&(w.participantId=b)})});let m=eK({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Fr(m,d),v=nR({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=AEe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=_Ee({candidatePositionAssignments:h,swapOptions:I});b.error&&console.log({result:b}),m=eK({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=Fr(m,d),v=nR({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(I=>{if(I.bye&&I.participantId){let b=WF;c.push(b)}if(I.qualifier&&I.participantId){let b=WF;c.push(b)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function _Ee({candidatePositionAssignments:t,swapOptions:e}){let i=Oo(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Oo(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===n),o=t.find(c=>c.drawPosition===r)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...ne}}function kEe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var V;if(!u)return{error:SQ};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:y}=Ut({drawDefinition:a,structureId:c}),{matchUps:I}=Ti({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&Pc(m)&&!g){let G=TDe(m)||0,j=I.reduce((z,H)=>H.roundNumber>z?H.roundNumber:z,0);g=j<G?1:j-G+1}let{positionAssignments:b}=Er({structure:y}),D=Wj({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=b==null?void 0:b.filter(G=>!G.participantId),S=b==null?void 0:b.map(G=>G.drawPosition),U=(y==null?void 0:y.structureType)===Qa,C=U?{structure:y,matchUps:I,allDrawPositions:S,roundsToSeparate:g}:{matchUps:I,allDrawPositions:S,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:P}=U?OEe(C):xEe(C),M={groupParticipants:s.filter(G=>G.participantType===vs).map(G=>G.participantId),teamParticipants:s.filter(G=>G.participantType===ji).map(G=>G.participantId),pairParticipants:s.filter(G=>G.participantType===kt).map(G=>G.participantId)},N=UEe({targetParticipantIds:e,policyAttributes:f,idCollections:M,participants:s});if(N.error)return ae({result:N,stack:v});let R=Object.assign({},...e.map(G=>{let j=Object.keys(N).filter(z=>(N[z]??[]).includes(G));return{[G]:j}})),A=kie({participantIds:e,positionAssignments:b});if(A.length>((w==null?void 0:w.length)||0))return{error:kV};let _,O=A.length,x=Ze(0,h).map(()=>iK({initialPositionAssignments:b,participantsWithGroupings:D,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:n,participantIdGroups:R,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:M,allGroups:N,drawSize:d}));if(_=x.reduce((G,j)=>!G||(j.conflicts||0)<(G.conflicts||0)?j:G,void 0),!_||_.conflicts){let G=Ze(0,h).map(()=>iK({initialPositionAssignments:b,participantsWithGroupings:D,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:n,participantIdGroups:R,drawPositionChunks:P,drawPositionGroups:E,policyAttributes:f,idCollections:M,allGroups:N,drawSize:d}));_=x.concat(...G).filter(j=>{var z;return!((z=j.errors)!=null&&z.length)}).reduce((j,z)=>!j||(z.conflicts||0)<(j.conflicts||0)?z:j,void 0)}if(!_)return{error:fA};let F=(((V=Bi({structure:y}))==null?void 0:V.positionAssignments)??[]).filter(G=>G.participantId).map(G=>G.participantId),$=_.positionAssignments.filter(G=>!F.includes(G.participantId));for(let G of $)if(G.bye){let j=ys({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...G});if(j.error)return ae({result:j,stack:v})}else if(G.participantId){let j=uu({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...G});if(j.error)return ae({result:j,stack:v,context:{assignment:G}})}return{...ne}}function OEe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function xEe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(ar),a=Math.max(...r),o=t.filter(u=>u>a),s=r.length,l=Ze(s===2?1:2,s).filter(u=>u===zV(u)),c=l.slice(0,e||l.length).reverse().map(u=>Fr(r,u));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:c}}function LEe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var C,E;let h="positionUnseededParticipants";u||({structure:u}=Ut({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:f}=Er({structure:u}),{seedAssignments:m}=zs({provisionalPositioning:t,drawDefinition:a,structure:u}),g=m==null?void 0:m.map(P=>P.participantId).filter(Boolean),{stage:v,stageSequence:y}=u,I=v===mt?(E=(C=Vt({element:u,name:Tu}))==null?void 0:C.extension)==null?void 0:E.value:void 0,b=Ly({provisionalPositioning:t,drawDefinition:a,stageSequence:y,entryStatuses:pg,structureId:c,roundTarget:I,stage:v}),D=b.filter(P=>!(g!=null&&g.includes(P.participantId))).map(P=>P.participantId),w=f==null?void 0:f.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!n&&D.length>((w==null?void 0:w.length)||0))return ae({result:{error:kV},context:{unseededParticipantsCount:D.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:h});let{appliedPolicies:S}=Ei({tournamentRecord:r,drawDefinition:a,event:p}),U=S==null?void 0:S[WT];if(u.stage===Rn){let P=b.reduce((M,N)=>(M[N.groupingValue]||(M[N.groupingValue]=[]),M[N.groupingValue].push(N.participantId),M),{});Object.keys(P).length&&(U||(U={policyName:"Playoff Avoidance"}),U.policyAttributes||(U.policyAttributes=[]),U.policyAttributes.push({groupings:P}))}return U&&s?kEe({provisionalPositioning:t,unseededParticipantIds:D,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:U,drawSize:d,entries:b}):FEe({provisionalPositioning:t,unseededParticipantIds:D,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function FEe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?La(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=uu({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return ae({result:m,stack:"randomUnseededDistribution"})}}return{...ne}}function $Ee(t){let e=t.structure??Ut(t).structure,i="positionQualifiers",n=[];if(e.stage===ra)return ae({result:{error:og},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=BEe(t);for(let s of Object.keys(r)){let l=a==null?void 0:a.filter(c=>o[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[s]>(l||0))return ae({result:{error:BQ},context:{unfilledDrawPositions:l},stack:i});Ze(0,r[s]).forEach(()=>{let c=Oo(l);n.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...ne,qualifierDrawPositions:n}}function BEe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=Ut({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=Er({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=I0({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>wt(m)),{matchUps:c}=Ti({structure:e}),{roundProfile:u}=Wa({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=o-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:o}}function nK({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=Ut({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=Ei({drawDefinition:a}).appliedPolicies),!r){let v=p&&Hy({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,Ze(0,c).forEach(()=>{if(g<(c||0)){let v=VEe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...ne,seedPositions:f}}function VEe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=mie({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:c}),{appliedPolicies:p}=Ei({drawDefinition:n}),{avoidance:h}=p??{};h&&o&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:Xw};f.push(g);let v=uu({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...ne,seedPositions:f}}function jEe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=Er({structure:i}),{seedAssignments:r}=zs({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return n==null?void 0:n.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function GEe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let o=f$(Fr(a.drawPositions,2)),s,l=t[n.length];for(;s=W1(o,l);)n.push(s),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?La(a):a).flat(1/0);return cee(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function W1(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return W1(e?r:t[Math.round(Math.random())],e)}return i<n?W1(t[1],e):W1(t[0],e)}function f$(t){let e=Math.floor(t.length/2);return t.length>2?[f$(t.slice(0,e)),f$(t.slice(e))]:t}function HEe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var b;a||(a=Hy({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=a,{validSeedBlocks:d}=a;(b=i==null?void 0:i.seeding)!=null&&b.containerByesIgnoreSeeding&&(d=[]);let p=jEe({provisionalPositioning:t,drawDefinition:n,structure:s})??[],h=Ft([].concat(...e.map(D=>D.drawPositions))),f=p.filter(D=>h.includes(D.drawPosition)),m=(D,w)=>Wb(D.seedValue)-Wb(w.seedValue),g=d.reduce((D,w)=>{let S=f.filter(U=>{var C;return(C=w.drawPositions)==null?void 0:C.includes(U.drawPosition)}).sort(m);return D.concat(...S)},[]).map(D=>D.drawPosition),v=GEe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:o}),y=rK({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,o),I=rK({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function rK({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function zEe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var A,_;let l=(A=n==null?void 0:n.seeding)==null?void 0:A.seedingProfile,c=o.stage===mt,{positionAssignments:u}=Er({structure:o}),d=u==null?void 0:u.filter(O=>O.participantId).map(O=>O.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=Ti({provisionalPositioning:t,matchUpFilters:p,structure:o}),m=(f==null?void 0:f[1])||[],g=o.structureType===Qa?h:m,v=Ft([].concat(...g.map(O=>O.drawPositions))),y=Math.min(...v)-1,I=d==null?void 0:d.filter(O=>v.includes(O)),b=O=>{let x=Math.ceil(O.length/2),F=[O.slice(0,x),O.slice(x)],$=F.map(Y=>[].concat(...Y.flat(1/0)).length),V=Math.min(...$.flat(1/0)),G=Math.max(...$.flat(1/0)),j=$.indexOf(G),z=V!==G,H=La(F),[K,q]=!V||z?[F[j],F[1-j]]:[H[0],H[1]];return{greaterHalf:K,lesserHalf:q}},D=O=>{let{greaterHalf:x,lesserHalf:F}=b(O),{greaterHalf:$,lesserHalf:V}=b(x),G=La($.flat(1/0)).pop(),j=$.flat().filter(z=>z!==G);return{newlyFilteredChunks:[...F,...V,j],drawPosition:G}},w=O=>!e.includes(O),S=O=>!(I!=null&&I.includes(O)),U=O=>{let x=Fr(O.sort(ar),Math.ceil(O.length/4)).map(V=>V.filter(S)),F=[].concat(...x.flat(1/0)).length,$=[];for(let V=0;V<F;V++){let{newlyFilteredChunks:G,drawPosition:j}=D(x);$.push(j),x=G}return $},{validSeedBlocks:C}=Hy({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),E=C==null?void 0:C.map(O=>{var x;return(x=O.drawPositions)==null?void 0:x.map(F=>F+y)}),P;if(s){let O=v.length,{seedBlocks:x}=gG({cluster:eP(l)===MA,participantsCount:O});P=x.map(F=>F.map($=>$+y)).map(U).filter(F=>F.length)}else c?P=E==null?void 0:E.map(O=>O.filter(S)):P=E==null?void 0:E.map(U).filter(O=>O.length);let M=g.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((x,F)=>x-F)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),N=O=>M.reduce((x,F)=>F.includes(O)?F.reduce(($,V)=>V!==O?V:$,void 0):x,void 0),R=P.map(O=>O.map(N)).flat(1/0).filter(S).filter(w).filter(Boolean);if(c&&!o.structures){let O=a%4,x=R.slice(0,O),F=(_=f[o.roundLimit])==null?void 0:_.length,$=Fr(R.slice(O),F).map(La).flat();R=x.concat($)}return{unseededByePositions:R}}function WEe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var E;let a={isCollectionMatchUp:!1},{matchUps:o,roundMatchUps:s}=Ti({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:a,matchUpsMap:i,structure:n,event:r}),l=(s==null?void 0:s[1])||[],c=(n==null?void 0:n.structureType)===Qa,u=c?o:l,d=c?((E=n==null?void 0:n.structures)==null?void 0:E.length)||0:o.length,{structureId:p,stage:h,stageSequence:f}=n,m=Ly({entryStatuses:jl,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=I0({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:I}=Er({structure:n}),b=I==null?void 0:I.map(P=>P.drawPosition),D=y==null?void 0:y.filter(P=>P.bye).length,w=y==null?void 0:y.filter(P=>P.bye).map(P=>P.drawPosition),S=u.map(P=>P.drawPositions).filter(P=>P==null?void 0:P.reduce((M,N)=>!(w!=null&&w.includes(N))&&M,!0)).flat(1/0).filter(P=>b==null?void 0:b.includes(P)),U=y==null?void 0:y.length,C=U?U-v:0;return C>d&&n.stageSequence===1&&n.stage!==ra&&(C=d),{placedByes:D,byesCount:C,relevantMatchUps:u,placedByePositions:w,roundMatchUps:s,positionsToAvoidDoubleBye:S}}function aK({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var M;l||({structure:l}=Ut({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===mt),{byesCount:h,placedByes:f,relevantMatchUps:m}=WEe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:o,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...ne};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:I,isFeedIn:b}=HEe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:g,structure:l}),D=(l==null?void 0:l.structureType)&&[Qa,RA].includes(l.structureType)&&((M=i==null?void 0:i.seeding)==null?void 0:M.containerByesIgnoreSeeding),w=p&&(y!=null&&y.length)?y:v,{unseededByePositions:S}=zEe({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:I,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:b}),U=N=>N%2,C=(N,R)=>(N||[]).every(A=>U(A)?R!==A+1:R!==A-1),E=[].concat(...w);if(!u)for(;S.length;){let N=S.find(R=>C(E,R));N?(E.push(N),S=S.filter(R=>R!==N)):(E.push(...S),S=[])}D&&(E=La(E),Hs({ignoreSeededByes:D})&&console.log({byePositions:E}));let P=E.slice(0,g);for(let N of P){let R=ys({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(R!=null&&R.error)return R}return{...ne,unseededByePositions:S,byeDrawPositions:P}}function tP(t){var A,_,O,x;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:n,multipleStructures:r,placeByes:a=!0,tournamentRecord:o,placementGroup:s,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(yee(),e=at(e,!1,!0));let g=F=>(i||F1(),ae({result:F,stack:"automatedPositioning"})),v=F=>(i||F1(),F),y=Ut({drawDefinition:e,structureId:c});if(y.error)return g(y);let I=y.structure;if(!I)return{error:bn};let b=t.appliedPolicies||((A=Ei({drawDefinition:e,structure:I,event:f}))==null?void 0:A.appliedPolicies),{qualifiersCount:D}=I0({stageSequence:I.stageSequence,provisionalPositioning:n,stage:I.stage,drawDefinition:e,structureId:c}),w=pg;if(!((_=Ly({stageSequence:I.stageSequence,provisionalPositioning:n,stage:I.stage,placementGroup:s,drawDefinition:e,entryStatuses:w,structureId:c}))!=null&&_.length)&&!D)return v({...ne});let S=t.matchUpsMap??ca({drawDefinition:e}),U=t.inContextDrawMatchUps??((O=sr({inContext:!0,drawDefinition:e,matchUpsMap:S}))==null?void 0:O.matchUps),C=[],E=Hy({provisionalPositioning:n,appliedPolicies:b,drawDefinition:e,seedingProfile:l,structure:I});if(E.error)return E;let{validSeedBlocks:P}=E;m.push({validSeedBlocks:P});let M=t.participants||(o?(x=xn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:o}))==null?void 0:x.participants:[]);if(eP(I.seedingProfile||l)===Rm){let F=a?aK({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:I,seedLimit:u,seedsOnly:d,event:f}):void 0;if(F!=null&&F.error)return g(F);C=F.unseededByePositions,m.push({action:"positionByes",unseededByePositions:C});let $=I.seedingProfile?{positioning:I.seedingProfile}:l;if(F=nK({seedingProfile:$,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:S,structure:I,event:f}),F.error)return g(F);m.push({seedPositions:F.seedPositions,action:"positionSeedBlocks"})}else{if(p!==cg){let $=I.seedingProfile?{positioning:I.seedingProfile}:l,V=nK({seedingProfile:$,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:S,structure:I,event:f});if(V.error)return g(V);m.push({action:"positionSeedBlocks",seedPositions:V.seedPositions})}let F=a?aK({provisionalPositioning:n,tournamentRecord:o,appliedPolicies:b,drawDefinition:e,seedBlockInfo:E,matchUpsMap:S,structure:I,seedLimit:u,seedsOnly:d,event:f}):void 0;if(F!=null&&F.error)return g(F);C=F==null?void 0:F.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:F==null?void 0:F.byeDrawPositions,unseededByePositions:C})}let N={};if(!d){let F=$Ee({inContextDrawMatchUps:U,tournamentRecord:o,appliedPolicies:b,validSeedBlocks:P,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:S,structure:I});if(F.error||(F.conflicts&&(N.qualifierConflicts=F.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:F.qualifierDrawPositions}),F=LEe({provisionalPositioning:n,inContextDrawMatchUps:U,unseededByePositions:C,multipleStructures:r,tournamentRecord:o,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:S,structureId:c,structure:I,drawSize:h,event:f}),F.error))return g(F);F.conflicts&&(N.unseededConflicts=F.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:R}=Bi({drawDefinition:e,structure:I});return Xi({drawDefinition:e,structureIds:[c]}),i||F1(),{positionAssignments:R,conflicts:N,...ne,positioningReport:m}}function iP(t){var h;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,placeByes:s,seedsOnly:l,event:c}=t;if(!c)return{error:Bo};if(!r)return{error:$o};if(!Yh({drawDefinition:r,structureId:o})&&!i)return{error:gV};let u=(h=Nie({drawDefinition:r,structureId:o}).playoffStructures)==null?void 0:h.sort((f,m)=>YM(f)-YM(m)),d=[],p=[];if(u)for(let f of u){let{structureId:m}=f,g=tP({structureId:m,provisionalPositioning:i,applyPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,placeByes:s,seedsOnly:l});if(g.error)return g;g.positionAssignments&&d.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&p.push(g.positioningReport)}return{...ne,structurePositionAssignments:d,positioningReports:p}}function Oie({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>Mt(i)))&&ae({result:{error:ve},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>kb(i.structureOrder)-kb(n.structureOrder)),{...ne}):{error:et}}function XA({drawDefinition:t}){var g,v,y,I,b,D,w;let e=t.structures??[],i=t.links??[],n=new Map,r=S=>{let U=n.get(S)||n.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&n.get(S);if(U&&!(U!=null&&U.stage)){let C=e.find(E=>E.structureId===S);U.stage=C==null?void 0:C.stage}return U},a={},o={},s=i.map(S=>{let U=S.source.structureId,C=S.target.structureId,E=r(U),P=r(C);return[Nm,gl,NA,Rm].includes(S.target.feedProfile)?(E==null||E.targets.push(C),P==null||P.sources.push(U)):S.target.feedProfile===ml&&(P==null||P.drawSources.push(U),E==null||E.drawTargets.push(C)),o[C]=o[C]||S.target.feedProfile===ml,a[C]=Ft([...a[C]||[],U]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of n.keys()){let U=n.get(S);if(U){let C=U.targets??[];for(;C.length;){let E=C.pop(),P=E&&n[E];(g=P==null?void 0:P.targets)!=null&&g.length?C.push(...P.targets):P&&(U.rootStage=P.stage)}if(U.rootStage||(U.rootStage=U.stage),!((v=U.targets)!=null&&v.length)){let E=U.sources??[];for(;E.length;){let P=E.pop(),M=P&&n[P];if((y=M==null?void 0:M.sources)!=null&&y.length){for(let N of M.sources)(I=U.progeny)!=null&&I.includes(N)||((b=U.progeny)==null||b.push(N));E.push(...M.sources)}}}}}let l=0;for(let S of n.keys()){let U=n.get(S);if(U&&U.rootStage===mt){let C=[(D=U.drawTargets)==null?void 0:D[0]],E=0;for(;C.length;){E+=1;let P=C.pop(),M=P?n.get(P):void 0;(w=M==null?void 0:M.drawTargets)!=null&&w.length&&C.push(M.drawTargets[0])}U.distanceFromMain=E,E>l&&(l=E)}}let c=s.length;Ze(0,Math.ceil(c/2)).forEach(()=>{s=Ze(0,c).map(S=>{let U=s[S],C=s.reduce((E,P)=>za(U,P)?E.concat(...P):E,[])||[];return Ft(U.concat(...C))})});let u=s[0],d=(S,U)=>kn(S,U).length===S.length,p=s.slice(1).reduce((S,U)=>S&&d(U,u),!0),h=[u].filter(Boolean),f=[u].filter(Boolean);e.forEach(S=>{let{structureId:U,stage:C}=S;h.find(E=>E.includes(U))||(h.push([U]),C!==kr&&f.push([U]))});let m=p&&f.length===1;return!(i!=null&&i.length)&&e.length===1&&r(e[0].structureId),{structureProfiles:Object.fromEntries(n),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:a,hasDrawFeedProfile:o,structureGroups:h}}function xie({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=XA({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...ne}}function Df(t){var l;let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r,element:a}=t;if(!r)return{error:FV};if(!a)return{error:ut,info:uj};let o=r&&Object.keys(r),s=["itemType","itemValue"];if(s.filter(c=>o.includes(c)).length!==s.length)return{error:LV};if(!a.timeItems)a.timeItems=[];else{let{itemType:c,itemSubTypes:u,itemValue:d}=r,p=c&&((l=Pu({itemSubTypes:u,itemType:c,element:a}))==null?void 0:l.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!e)return{...ne}}if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let c=new Date().toISOString();Object.assign(r,{createdAt:c})}return n&&(a.timeItems=a.timeItems.filter(({itemType:c})=>r.itemType!==c)),n&&!r.itemValue||a.timeItems.push(r),{...ne}}function DG({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:Re};if(!r)return{error:mr};let o=vg({tournamentRecord:i,participantId:r});return o.error?o:Df({element:o.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function Wy(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;return i?Df({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a}):{error:Re}}function qy(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?Df({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Bo}}function PG({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:Re};if(!e)return{error:et};let r=qEe({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});if(r.error)return r;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return Wy({tournamentRecord:t,timeItem:a}),r}function qEe({drawDefinition:t,tournamentId:e,structure:i,eventId:n,link:r}){var l;if(!t)return{error:et};if(!i)return{error:mf};if(!r)return{error:wV};let a=r.target.structureId,o=Ut({drawDefinition:t,structureId:a});if(o.error)return ae({stack:"attachQualifyingStructure",context:{targetStructureId:a},result:o});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(r),xie({drawDefinition:t});let s=((l=Ti({structure:i}))==null?void 0:l.matchUps)||[];return Wh({drawDefinition:t,tournamentId:e,matchUps:s,eventId:n}),Xi({drawDefinition:t,structureIds:[i.structureId]}),{...ne}}function Lie({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:ve};if(!t)return{error:et};let i=Object.assign({},...e.map(n=>{if(!Zi(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:ut};for(let n of t.structures||[]){let r=i[n.structureId];r&&(n.structureName=r)}return{...ne}}function CG({drawDefinition:t,timeItem:e}){if(!t)return{error:$o};if(!e)return{error:FV};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:LV};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),RD({drawDefinition:t}),{...ne}}function Fie(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:n,event:r}=t,a=gi(t,[{drawDefinition:!0,structureId:!0}]);if(a.error)return a;let o=i.structures??[],s=o.find(y=>y.structureId===n);if(!s)return{error:bn};let l=o.find(({stage:y,stageSequence:I})=>y===it&&I===1),c=n===(l==null?void 0:l.structureId),u=o.filter(({stage:y})=>y===mt).map(jo("structureId"));if(c&&!u.length)return{error:tQ};let d=u.includes(n),p=KEe({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=ZEe({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:n}),{removedMatchUpIds:m,removedStructureIds:g}=XEe({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:n});if(YEe({removedMatchUpIds:m,drawDefinition:i}),c){let y=(v=l.matchUps??[])==null?void 0:v.map(jo("matchUpId"));m.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&xie({drawDefinition:i}),Bp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,action:"removeStructure",eventId:r==null?void 0:r.eventId,drawDefinition:i}),Xi({drawDefinition:i,eventId:r==null?void 0:r.eventId}),{...ne,removedMatchUpIds:m,removedStructureIds:g}}function KEe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var l,c,u,d,p,h;let s=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(l=f(n))==null?void 0:l.source.structureId;for(;m;)s.push(m),m=(c=f(m))==null?void 0:c.source.structureId}if((u=sr({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&u.some(({score:f})=>Vr({score:f}))){let f=(d=Ei({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:d.appliedPolicies;if(!(o??((h=(p=f==null?void 0:f[ud])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:h.structures)))return{error:vA}}return{...ne}}function YEe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=sr({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function ZEe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(jo("structureId")),s=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return o.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function XEe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...e1e({idBeingRemoved:c,drawDefinition:r}));let u=QEe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:o});s.push(...u.removedStructureIds);let d=JEe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function JEe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function QEe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var o;let a=[];return n.links=((o=n.links)==null?void 0:o.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&a.push(i),s.structureId!==i))),{removedStructureIds:a}}function e1e({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=Ut({structureId:t,drawDefinition:e}),n=Ti({structure:i}).matchUps;return vj(n)}function rR({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:et};if(!Kj({drawDefinition:e,stage:n}))return{error:og};let r=LPe({drawDefinition:e,stage:n}),{qualifiersCount:a}=I0({drawDefinition:e,stageSequence:t,stage:n}),o=r+a;if(i<o)return{error:bV};let{entryProfile:s}=qj({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Xi({drawDefinition:e}),{...ne,entryProfile:s}}function $ie({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?Kj({drawDefinition:e,stage:i})?i!==it?{error:bV,info:"qualifiersCount can only be set for main stage"}:(qj({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Xi({drawDefinition:e}),{...ne}):{error:og}:{error:et}}function t1e({drawDefinition:t,drawSize:e}){if(!t)return{error:et};let i=rR({stage:kr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Xi({drawDefinition:t}),{...ne})}function Bie(t){return t1e(t)}function Vie({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var o;let r="removeSeededParticipant";if(!t)return{error:Re};if(!e)return{error:et};let a=(e.structures??[]).find(s=>s.structureId===n);return a?!a.stage||![it,mt].includes(a.stage)||a.stage===it&&a.stageSequence!==1?ae({result:{error:Ey},stack:r}):(o=a.seedAssignments)!=null&&o.find(s=>s.participantId===i)?{...ne}:ae({info:"participant not seeded",result:{error:Ia},context:{participantId:i}}):ae({result:{error:bn},stack:r})}function nP({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=mp}){return!n||!r?{error:gs}:{link:ht({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:ml,roundNumber:t,structureId:r}})}}function EG({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||Oi()}function aR({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let h=s==null?void 0:s[l],f=s==null?void 0:s[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=EG({roundPosition:u,roundNumber:i,idPrefix:r,uuids:o}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:On,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function du({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!Pc(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let u=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!Pc(s)&&!u)return{matchUps:[],roundsCount:0};let d=Ze(1,s+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=aR({matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=aR({nodes:p,matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=ND({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:s,matchUps:h,roundsCount:m,roundLimit:a}}function MG(t){var x,F,$,V,G,j;let e="generateQualifyingStructure";if(!t.drawDefinition)return ae({result:{error:et},stack:e});if(t.drawSize&&!Mt(t.drawSize)||t.participantsCount&&!Mt(t.participantsCount)||t.qualifyingPositions&&!Mt(t.qualifyingPositions))return ae({result:{error:ve},stack:e});let i=t.drawSize??HV(t.participantsCount),{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureOptions:o,appliedPolicies:s,drawDefinition:l,matchUpFormat:c,structureName:u,structureId:d,roundTarget:p,drawType:h,idPrefix:f,isMock:m,uuids:g}=t;if(!t.drawSize)return ae({result:{error:fD},context:{drawSize:i},stack:e});if(r&&r>=t.drawSize)return ae({result:{error:ve},context:{drawSize:i,qualifyingPositions:r},stack:e});let v,y,I,b,D=0,w,S=1,{structureProfiles:U}=XA({drawDefinition:l}),C=U[a];if(!C)return ae({result:{error:bn},context:{targetStructureId:a},stack:e});let E=l.matchUpType,P=p?`${p}-`:"",M=C.stage===mt,N=((F=(x=s==null?void 0:s[xb])==null?void 0:x.namingConventions)==null?void 0:F.pre)??((V=($=mCe[xb])==null?void 0:$.namingConventions)==null?void 0:V.pre),R=M&&N?`${N}-`:"",A=u??(P?`${R}${ta(mt)} ${P}`:`${R}${ta(mt)}`);if(h===Nl){let{maxRoundNumber:z,structures:H,groupCount:K}=JD({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),stage:mt,structureOptions:o,appliedPolicies:s,stageSequence:S,matchUpType:E,roundTarget:p,idPrefix:f,drawSize:i,isMock:m,uuids:g});D=K,v=z,I=H[0],w=[1]}else({drawSize:i,matchUps:b,roundLimit:v,roundsCount:y}=du({qualifyingRoundNumber:n,qualifyingPositions:r,matchUpType:E,idPrefix:f,drawSize:i,isMock:m,uuids:g})),v||(v=y),I=As({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:mt,matchUpFormat:c,stageSequence:S,matchUpType:E,roundLimit:v,matchUps:b}),p&&ci({extension:{name:Tu,value:p},element:I}),D=(G=b==null?void 0:b.filter(z=>z.roundNumber===v))==null?void 0:G.length;let _=h===Nl?fp:mp,O=I&&v&&((j=nP({sourceStructureId:I.structureId,sourceRoundNumber:v,targetStructureId:a,finishingPositions:w,linkType:_}))==null?void 0:j.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:D,...ne,structure:I,link:O}}function jie(t){let e=t.tournamentRecord;if(!e)return{error:Re};let i=i1e(t);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t,d={itemType:"addQualifyingStructures",itemValue:ht({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureName:s,matchUpType:l,drawSize:c,drawType:u})};return Wy({tournamentRecord:e,timeItem:d}),i}function i1e(t){if(!t.drawDefinition)return{error:et};if(!t.targetStructureId)return{error:gs};let e=MG(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:ve}:PG({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function n1e({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Ze(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let I=EG({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:On,roundNumber:i,matchUpId:I};t&&(b.matchUpType=n),o&&(b.isMock=!0),a.push(b);let D={children:[y,v]};h.push(D)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function Zh(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??R(e);let g=r1e({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,O)=>_+O,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,_)=>c&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let I=[...g,...i].sort((A,_)=>_-A),b=I.length,D=[...(l??[]).map(A=>A-1),...(o??[]).map(A=>b-A)].map(A=>I[A]).reduce((A,_)=>A+_,0);y=y-D;let w=0,S=[],U,C=1,E=Ze(0,a).map((A,_)=>({drawPosition:_+1+y})),P=y+1;for(let A of g){if({roundNodes:U,matchUps:S}=aR({matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,nodes:E,uuids:f}),C++,i.includes(A)){let _=Vo(i)[A],O=Ze(0,_),x=b+1-C,F=(o==null?void 0:o.includes(x))??(l==null?void 0:l.includes(C));O.forEach(()=>{({roundNodes:U,matchUps:S,drawPosition:P}=n1e({drawPosition:!F&&P||void 0,nodes:U,matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:w})),C++,w+=1})}E=U}b!==C-1&&console.log("ERROR");let M=a-y;S=ND({finishingPositionOffset:u?M:s,positionsFed:y,roundsCount:b,matchUps:S,fmlc:m});let N=U!=null&&U.length?U[0]:U;return N&&(N.roundNumber=C-1,N.matchUps=S),{draw:N,matchUps:S,roundsCount:b};function R(A){let _=zV(A);return _>A?_/2:_}}function r1e({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Ze(0,e).reverse().map(i=>Math.pow(2,i))}function Ib(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=it,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!c||o!=null&&o[l])||g<2||f&&s>f)return{};let b=[],D=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,C=e+g,E=`${U}-${C}`,P=o==null?void 0:o[l],M=n&&`${n} `||"",N=(o==null?void 0:o[E])??(r==null?void 0:r[E]),R=t.structureName||(N==null?void 0:N.name)||(P==null?void 0:P.name)&&(i?`${M}${P==null?void 0:P.name}`:P.name)||`${M}${E}`,A=(N==null?void 0:N.abbreviation)??(P==null?void 0:P.abbreviation),_=t.structureId??(P==null?void 0:P.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${R}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:I},{matchUps:x}=h?Zh(O):du(O),F=As({structureAbbreviation:A,stageSequence:s,structureName:R,matchUpType:S,roundOffset:d,structureId:_,matchUps:x,stage:m});b.push(...x),D.push(F);let $=Math.ceil(Math.log(g)/Math.log(2)),V=u?Math.min(u-d,$):!a||U<a?$:0;return g>2&&Ze(1,V+1).forEach(j=>G(j)),{structureId:F.structureId,matchUps:b,structureName:R,structures:D,links:w,...ne};function G(j){let z=g/Math.pow(2,j);if(z<2)return;let H=g/Math.pow(2,j)+e;if(a&&H+1>a)return;let{structures:K,structureId:q,matchUps:Y,links:Z}=Ib({finishingPositionOffset:H,exitProfile:`${l}-${j}`,roundOffset:d+j,stageSequence:s+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:I,stage:m});if(F.structureId&&q){let Q={linkType:dd,source:{roundNumber:j,structureId:F.structureId},target:{roundNumber:1,feedProfile:gl,structureId:q}};Z&&F&&Z.push(Q),Z!=null&&Z.length&&w.push(...Z)}return K!=null&&K.length&&D.push(...K),Y!=null&&Y.length&&b.push(...Y),{structureId:q,childLinks:Z,structures:D}}}function RG({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=Ut({drawDefinition:t,structureId:i});if(n.error)return ae({result:n});let{matchUps:r}=Ti({structure:n.structure,matchUpsMap:e});return{...Wa({matchUps:r}),matchUps:r,matchUpsMap:e}}function oK({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=RG({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((a,o)=>(Gie(n==null?void 0:n[o]).forEach(s=>{t.forEach(l=>{a1e({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function a1e({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Ze(i,(n||i)+1).includes(t)}function Gie(t){var e,i;return[Ft(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Ft(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function o1e(t){return Gie(t).map(e=>Ze(e[0],e[1]&&e[1]+1||e[0]+1))}function S0({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:ve,context:{structureIds:e}};if(!t)return{error:et};e=e??(t.structures??[]).filter(a=>a.stage!==mt).map(({structureId:a})=>a);let n=e.map(a=>{var s;let{roundProfile:o}=RG({drawDefinition:t,matchUpsMap:i,structureId:a});return(s=o&&Object.values(o))==null?void 0:s.map(o1e).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(ar).flat();return{positionsNotPlayedOff:Ft(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function Hie({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:et};if(!n)return{error:gs};if(!e)return{error:ut,info:"missing playoffPositions"};let r=S0({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=oK({finishingPositions:o,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>wt(v)).filter(v=>!t.includes(v)),c=oK({finishingPositions:a,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>wt(v)):[],p=l.filter(v=>!d.includes(v)).sort(ar),{roundProfile:h}=RG({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Ze(I,(b||I)+1)}).flat().sort(ar),{playoffRoundsRanges:m}=s1e({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function s1e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,o=Ze(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:o,roundNumber:i}})}}function rP({drawDefinition:t,structureId:e}){if(!t)return{error:et};let{matchUps:i,matchUpsMap:n}=no({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=S0({drawDefinition:t,matchUpsMap:n}),{structures:o}=fd({drawDefinition:t}),s=o.filter(c=>!e&&c.stage!==kr||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=l1e({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function l1e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var h,f,m,g,v,y,I,b,D;let r=i==null?void 0:i.structureId,{links:a}=v0({drawDefinition:e,structureId:r});if(i.structureType===Qa||i.structures){let w=(f=(h=Bi({structure:i}))==null?void 0:h.positionAssignments)==null?void 0:f.length,S=i.structures.length,U=(w??0)/S,C=((m=a.source)==null?void 0:m.flatMap(({source:F})=>(F==null?void 0:F.finishingPositions)||[]))||[],E=Ze(1,U+1).filter(F=>!C.includes(F)),P=((v=(g=n.find(F=>F.containerStructureId===r&&F.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],M=a==null?void 0:a.source.map(({target:F})=>F.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:R=[]}=S0({structureIds:M,drawDefinition:e}),A=[...N,...R],_=Ze(P[0],P[1]+1).filter(F=>!A.includes(F)),O=Fr(_,_.length/E.length),x=E.map((F,$)=>{let V=O[$],G=[Math.min(...V||[]),Math.max(...V||[])].join("-");return{finishingPosition:F,finishingPositions:V,finishingPositionRange:G}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:x,finishingPositionsAvailable:E,finishingPositionsPlayedOff:C,positionsPlayedOff:N,groupCount:S,groupSize:U}}let o=((y=a==null?void 0:a.source)==null?void 0:y.filter(w=>w.linkCondition!==pd).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],s=((I=a==null?void 0:a.source)==null?void 0:I.filter(w=>w.linkCondition===pd).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],l=Hie({excludeRoundNumbers:o,playoffPositions:t,drawDefinition:e,structureId:r}),c=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,u=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let w of s){let S=a==null?void 0:a.source.find(M=>M.source.roundNumber===w),U=S==null?void 0:S.target.roundNumber,C=S==null?void 0:S.target.structureId,E=n.filter(({roundNumber:M,structureId:N})=>N===C&&M===U),P=E.filter(({sides:M})=>M.find(N=>N.participantFed&&!N.participantId)).length;if(c&&P===E.length){c.push(w);let M=(D=(b=d==null?void 0:d[w])==null?void 0:b.finishingPositionRange)==null?void 0:D.loser;if(M){let N=Math.min(...M),R=N+P,A=Ze(N,R),_={finishingPositionRange:[N,R-1].join("-"),finishingPositions:A,roundNumber:w};u.push(_)}}}return c&&c.sort(ar),u.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function c1e({playoffGroups:t,drawDefinition:e,structureId:i}){var r,a;if(!e)return{error:et};if(typeof i!="string"||!Array.isArray(t))return{error:ve};let n=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(a=(r=rP({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(o=>n.includes(o.finishingPosition)))==null?void 0:a.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function zie(t){var y,I;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:n=1,staggeredEntry:r,structureName:a,stage:o=it,matchUpType:s,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:f}=r?Zh(h):du(h),m=As({structureName:a||((y=i==null?void 0:i["0"])==null?void 0:y.name)||ta(it),structureId:l||(p==null?void 0:p.pop()),stageSequence:n,matchUpType:s,matchUps:f,stage:o}),g=[m],v=[];if(u>2){let b=u/2,{matchUps:D}=du({finishingPositionOffset:e+b,idPrefix:c&&`${c}-c`,drawSize:b,matchUpType:s,isMock:d}),w=ta(ra),S=((I=i==null?void 0:i["0-1"])==null?void 0:I.name)??t.consolationStructureName??(a?`${a} ${w}`:w),U=As({structureName:S,matchUps:D,structureId:p==null?void 0:p.pop(),stage:ra,stageSequence:1,matchUpType:s});g.push(U);let C={linkType:dd,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:gl,structureId:U.structureId}};v.push(C)}return{...ne,structures:g,links:v}}function Wie({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Ze(1+e,n+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?gl:Nm,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:dd,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=s[c-1];return h&&(p.target.groupedOrder=h),Hs()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=pd,p.target.feedProfile=gl),o.includes(d)?p:void 0}).filter(Boolean)}function qie(t){var D,w;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:n=1,playoffAttributes:r,structureNameMap:a,staggeredEntry:o,stage:s=it,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=o?Zh(f):du(f),v=t.structureName??((D=r==null?void 0:r["0"])==null?void 0:D.name)??ta(it),y=Oh({structureId:c||(h==null?void 0:h.pop()),structureName:v,stageSequence:n,matchUpType:l,matchUps:m,stage:s}),I=[y],b=[];if(u>2){let S=[0,2].slice(0,u/16).map((U,C)=>{let E=C+1,{consolationStructure:P}=u1e({idPrefix:d&&`${d}-c${C}`,structureId:h==null?void 0:h.pop(),playoffStructureNameBase:e,playoffAttributes:r,structureNameMap:a,stageSequence:E,roundOffset:U,matchUpType:l,drawSize:u,isMock:p,index:C,uuids:h});I.push(P);let M=Wie({consolationStructure:P,roundsCount:2,mainStructure:y,roundOffset:U});return{consolationStructure:P,links:M}}).map(U=>U.links).flat();if(b.push(...S),u>=4&&u<=16||u>32){let{matchUps:U}=du({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),C=((w=r==null?void 0:r["3-4"])==null?void 0:w.name)??ta(Rn),E=(a==null?void 0:a[C])||C,P=e?`${e} ${E}`:E,M=Oh({structureId:h==null?void 0:h.pop(),matchUps:U,stageSequence:2,stage:Rn,structureName:P,matchUpType:l}),N={linkType:dd,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:M.structureId,feedProfile:gl,roundNumber:1}};I.push(M),b.push(N)}}return{structures:I,links:b,...ne}}function u1e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var y,I;let p=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:f}=Zh({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:c,uuids:d}),m=u===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||u===1&&((I=i==null?void 0:i["0-3"])==null?void 0:I.name)||`${ta(ra)} ${u+1}`,g=(n==null?void 0:n[m])||m,v=t?`${t} ${g}`:g;return{consolationStructure:Oh({matchUps:h,stage:ra,structureName:v,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:f}}function Qg(t){var E,P,M,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:n,feedsFromFinal:r,staggeredEntry:a,structureName:o,stage:s=it,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||((E=t.policyDefinitions)==null?void 0:E[Lb])||((P=t.appliedPolicies)==null?void 0:P[Lb]),y={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:I}=a?Zh(y):du(y),b=As({structureName:o||((M=n==null?void 0:n["0"])==null?void 0:M.name)||ta(it),structureId:l||(m==null?void 0:m.pop()),stageSequence:i,matchUpType:c,matchUps:I,stage:s}),D=[b],w=[],S=h/2,{matchUps:U,roundsCount:C}=Zh({finishingPositionOffset:S,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:r,baseDrawSize:S,matchUpType:c,feedRounds:d,skipRounds:u,isMock:f,uuids:m,fmlc:g});if(h>2){let R=((N=n==null?void 0:n["0-1"])==null?void 0:N.name)??ta(ra),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${R}`:R,_=As({matchUps:U,structureId:m==null?void 0:m.pop(),stage:ra,stageSequence:1,structureName:A,matchUpType:c});D.push(_);let O=Wie({consolationStructure:_,mainStructure:b,roundsCount:C,feedPolicy:v,fmlc:g});w.push(...O)}return{...ne,structures:D,links:w}}function Kie({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var D,w,S,U,C,E;c=c||(r==null?void 0:r[Lb]);let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:I,positionRangeMap:b}=c1e({structureId:n,drawDefinition:o,playoffGroups:s});if(I)return ae({result:{error:I},stack:f});if(!(!b||s!=null&&s.every(P=>{let{finishingPositions:M=[]}=P;if(!M.length)return!1;let N=[...M].sort(ar).map((R,A)=>(M[A+1]||R)-R).every(R=>R<2);return(!t||N)&&M.every(R=>b[R])})))return ae({context:{validFinishingPositions:Object.values(b)},result:{error:ve},stack:f});for(let P of s){let M=P.finishingPositions,N=b&&M.map(V=>{var G;return(G=b[V])==null?void 0:G.finishingPositions}).flat(),R=u*M.length,A=n0(R),_=A===2&&Zc||P.drawType||Zc;N&&(m=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,x=P.structureName||O&&((w=(D=P.playoffAttributes)==null?void 0:D[O])==null?void 0:w.name)||((U=(S=P.playoffAttributes)==null?void 0:S["0"])==null?void 0:U.name),F={addNameBaseToAttributeName:P.addNameBaseToAttributeName,playoffStructureNameBase:P.playoffStructureNameBase,finishingPositionNaming:P.finishingPositionNaming,finishingPositionLimit:P.finishingPositionLimit,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,structureNameMap:P.structureNameMap,sequenceLimit:P.sequenceLimit,structureName:x,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:m,stage:Rn,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},$=({playoffStructures:V,playoffLinks:G})=>{let[j]=V,z=LE({playoffStructureId:j.structureId,finishingPositions:M,sourceStructureId:n});y.push(z),y.push(...G),v.push(...V),g.push({structureId:j.structureId,finishingPositions:M}),m+=R};if(_===Zc){let{matchUps:V}=du({finishingPositionLimit:m+R,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:A,isMock:p,uuids:h}),G=As({structureId:P.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Rn,structureName:x,stageSequence:a,matchUps:V});v.push(G);let j=LE({playoffStructureId:G.structureId,finishingPositions:M,sourceStructureId:n});y.push(j),m+=R,g.push({structureId:G.structureId,finishingPositions:M})}else if([Bb,Vb,Rn].includes(_)){let V={playoffAttributes:P.playoffAttributes??i,playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:Rn,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};_===Bb?Object.assign(V,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??Mj,roundOffsetLimit:3}):_===Vb&&Object.assign(V,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??Rj,roundOffsetLimit:2});let G=Ib(V);if(G.error)return G;if((C=G.links)!=null&&C.length&&y.push(...G.links),(E=G.structures)!=null&&E.length&&v.push(...G.structures),v.sort(xy),G.structureId){let j=LE({playoffStructureId:G.structureId,finishingPositions:M,sourceStructureId:n});y.push(j),g.push({structureId:G.structureId,finishingPositions:M})}m+=R}else if([jb,MD,XT,ZT,YT,JT].includes(_)){let V=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],G={playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:V,stage:Rn,structureName:x,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},j={[jb]:{fmlc:!0,feedRounds:1},[JT]:{feedRounds:1},[XT]:{feedsFromFinal:3},[ZT]:{feedsFromFinal:2},[YT]:{feedsFromFinal:1}};Object.assign(G,j[_]||{});let{structures:z,links:H}=Qg(G),[K]=z,q=LE({playoffStructureId:K.structureId,finishingPositions:M,sourceStructureId:n});y.push(q),y.push(...H),v.push(...z),g.push({structureId:K.structureId,finishingPositions:M}),m+=R}else if([Nl].includes(_)){let{structures:V,links:G}=JD({...F,structureOptions:P.structureOptions||{groupSize:4}});$({playoffStructures:V,playoffLinks:G})}else if([ED].includes(_)){let{structures:V,links:G}=zie(F);$({playoffStructures:V,playoffLinks:G})}else if([EPe].includes(_)){let{structures:V,links:G}=qie(F);$({playoffStructures:V,playoffLinks:G})}else if([Rl].includes(_)){let V=As({structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,finishingPosition:V1,stage:Rn,stageSequence:a,matchUps:[]});$({playoffStructures:[V],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:b,structures:v,links:y}}function LE({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:fp,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:ml,roundNumber:1}}}function aP({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>oP({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function oP({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??o??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??Oi();let h=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return Ze(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:On,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:s,isMock:r}})}function d1e(t){var U,C,E;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return ae({result:{error:ut},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:n,tournamentRecord:r,drawDefinition:a,playoffGroups:o,groupCount:s,groupSize:l,event:c}=t,{structures:u=[],links:d=[],finishingPositionTargets:p,positionRangeMap:h,error:f}=Kie({requireSequential:n,sourceStructureId:i,playoffGroups:o,groupCount:s,groupSize:l,...t});if(f)return{error:f};let m=p==null?void 0:p.map(({finishingPositions:P})=>P).flat().map(P=>h[P].finishingPositions).flat();a.structures.push(...u),a.links.push(...d);let{matchUps:g,matchUpsMap:v}=sr({inContext:!0,drawDefinition:a}),y=u.map(({structureId:P})=>P),I=g==null?void 0:g.filter(({structureId:P})=>y.includes(P)).map(Pr),b=(U=v==null?void 0:v.drawMatchUps)==null?void 0:U.filter(({matchUpId:P})=>I==null?void 0:I.includes(P));if(b!=null&&b.length){let P=(C=Ca({drawDefinition:a,event:c}))==null?void 0:C.tieFormat;P&&b.forEach(M=>{let{tieMatchUps:N}=aP({isMock:t.isMock,tieFormat:P,matchUp:M});Object.assign(M,{tieMatchUps:N,matchUpType:lu})})}let{positionAssignments:D}=Bi({structureId:i,drawDefinition:a}),w={};D==null||D.forEach(P=>{var N,R,A;let M=(A=(R=(N=Vt({element:P,name:Hh}))==null?void 0:N.extension)==null?void 0:R.value)==null?void 0:A.groupOrder;M&&(w[M]||(w[M]=[]),w[M].push(P.participantId))});let S=iP({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:r,drawDefinition:a});return S.error&&((E=S.error)==null?void 0:E.code)!==gV.code?ae({result:S,stack:e}):{structures:u,links:d,positionsPlayedOff:m,drawDefinition:a,...ne}}var _s="SET3-S:6/TB7",p1e="SET3-S:6NOAD",Yie="SET3-S:6/TB7-F:TB10",h1e="SET3-S:4/TB7",f1e="SET3-S:4/TB5@3",m1e="SET1-S:T20",g1e="SET1-S:8/TB7",v1e="SET1-S:8/TB7@7",y1e={FORMAT_STANDARD:_s,FORMAT_STANDARD_NOAD:p1e,FORMAT_ATP_DOUBLES:Yie,FORMAT_SHORT_SETS:h1e,FORMAT_FAST4:f1e,FORMAT_PRO_SET:g1e,FORMAT_COLLEGE_PRO_SET:v1e,TIMED20:m1e};function NG({winningSide:t,matchUpFormat:e=_s,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=fo(e),c=AG((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===fi&&(n!=null&&n.setsCreditForDefaults)||i===Pi&&(n!=null&&n.setsCreditForWalkovers)))a[s]=c;else for(let u of o||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof s=="number"&&i===Ra&&(+a[1-s]===c&&(a[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(a[s]=c)),a}function Zie({matchUpFormat:t=_s,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var p,h;let{sets:a}=r||{};if(!a)return[0,0];let o=typeof e=="number"&&e-1,s=fo(t),l=(s==null?void 0:s.bestOf)??1,c=AG(l),u=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof o=="number"&&(i===fi&&(n!=null&&n.gamesCreditForDefaults)||i===Pi&&(n!=null&&n.gamesCreditForWalkovers))){let f=((h=s==null?void 0:s.setFormat)==null?void 0:h.setTo)||0,m=c*f;d[o].push(m)}else a.forEach((f,m)=>{var D;let g=(f.setNumber||m+1)>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(D=s==null?void 0:s[g])==null?void 0:D.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:I,side2Score:b}=f;sK(v)&&(d[0].push(wt(I||0)),d[1].push(wt(b||0))),y&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&d[f.winningSide-1].push(1)});if(i===Ra&&typeof o=="number"){let f=a.length>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",m=s==null?void 0:s[f];if(sK(m.based)){let g=(m==null?void 0:m.setTo)||0,v=I=>{if(!(!s||I===""))return+I===u-1||+I===u?wt(u||0)+1:+I<u?g:u},y=NG({winningSide:e,score:{sets:a},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(d.map(I=>I[o]<=I[1-o]).reduce((I,b)=>I+(b?1:0),0)>y[1-o]){let I=d[o].length,b=v(d[1-o][I-1]);b&&(d[o][I-1]=b)}c>d[o].length&&(n!=null&&n.gamesCreditForRetirements)&&d[o].push(g)}}return[d[0].reduce((f,m)=>f+m,0),d[1].reduce((f,m)=>f+m,0)]}function Xie({matchUpFormat:t,score:e}){var s;let i=t?fo(t):void 0,n=(i==null?void 0:i.bestOf)??1,r=AG(n),a=[0,0],o=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,c)=>{var p;let u=(l.setNumber||c+1)>r&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[u])==null?void 0:p.based;if(Jie(d)){let{side1Score:h,side2Score:f}=l;h&&(o[0]+=wt(h||0)),f&&(o[1]+=wt(f||0))}else l.side1TiebreakScore&&(o[0]+=wt(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(o[1]+=wt(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(a[l.winningSide-1]+=1)}),{pointsTally:o,tiebreaksTally:a}}function AG(t){return t&&Math.ceil(t/2)||1}function Jie(t){return t==="P"}function sK(t){return!Jie(t)}function I1e({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var c;let a=e&&fo(e)||{},o=a.bestOf,s=o&&Math.ceil(o/2)||1,l=(c=a.setFormat)==null?void 0:c.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(s||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let I=t[u].matchUpsWon,b=t[u].matchUpsLost,D=I+b,w=Math.round(I/D*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let S=t[u].gamesWon||0,U=t[u].gamesLost||0,C=(n||0)*(s||0)*(l||0),E=Math.max(C,S+U),P=Math.round(S/E*1e3)/1e3;(P===1/0||isNaN(P))&&(P=0);let M=Math.round(t[u].pointsWon/t[u].pointsLost*1e3)/1e3;(M===1/0||isNaN(M))&&(M=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=w,t[u].gamesWon=S,t[u].gamesLost=U,t[u].gamesPct=P,t[u].pointsPct=M,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function sP({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){var c,u,d,p,h,f,m;let a={},o=(i==null?void 0:i.excludeMatchUpStatuses)||[],s=r==null?void 0:r.filter(g=>(g.tieMatchUps||!o.includes(g.matchUpStatus))&&(!(t!=null&&t.length)||kn(t,[pb(g,0),pb(g,1)]).length===2)),l=(c=s==null?void 0:s.flatMap(({score:g,tieMatchUps:v})=>{var y;return v?v.filter(({matchUpStatus:I})=>!o.includes(I)).flatMap(({score:I})=>{var b;return((b=I==null?void 0:I.sets)==null?void 0:b.length)??0}):((y=g==null?void 0:g.sets)==null?void 0:y.length)??0}))==null?void 0:c.reduce((g,v)=>g+v,0);for(let g of s??[]){let{matchUpStatus:v,tieMatchUps:y,tieFormat:I,score:b,winningSide:D,sides:w}=g,S=I&&g._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:E})=>E),U=D&&b1e(g),C=D&&w1e(g);if(!U&&!C)if(v&&gr.includes(v)){let E=pb(g,0),P=pb(g,1);E&&(Sh(a,E),a[E].matchUpsCancelled+=1),P&&(Sh(a,P),a[P].matchUpsCancelled+=1)}else if(y!=null&&y.length){n=0;for(let E of y){if(E.winningSide){let P=(u=w==null?void 0:w.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:u.participantId,M=(d=w==null?void 0:w.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:d.participantId;P&&M&&(Sh(a,P),Sh(a,M),a[P].tieMatchUpsWon+=1,a[M].tieMatchUpsLost+=1,An(Tn)(E.matchUpType)?(a[P].tieSinglesWon+=1,a[M].tieSinglesLost+=1):An(Wi)(E.matchUpType)&&(a[P].tieDoublesWon+=1,a[M].tieDoublesLost+=1))}lK({score:E.score,manualGamesOverride:S,participantResults:a,sides:w})}}else lK({manualGamesOverride:S,participantResults:a,score:b,sides:w});else if(Sh(a,U),Sh(a,C),y==null?void 0:y.length){n=0;for(let E of y){let{matchUpType:P}=E,M=An(Wi)(P),N=An(Tn)(P);E.winningSide&&(E.winningSide===D?(U&&(a[U].tieMatchUpsWon+=1,N&&(a[U].tieSinglesWon+=1),M&&(a[U].tieDoublesWon+=1)),C&&(a[C].tieMatchUpsLost+=1,N&&(a[C].tieSinglesLost+=1),M&&(a[C].tieDoublesLost+=1))):E.winningSide!==D&&(C&&(a[C].tieMatchUpsWon+=1,N&&(a[C].tieSinglesWon+=1),M&&(a[C].tieDoublesWon+=1)),U&&(a[U].tieMatchUpsLost+=1,N&&(a[U].tieSinglesLost+=1),M&&(a[U].tieDoublesLost+=1)))),cK({matchUpFormat:E.matchUpFormat,matchUpStatus:E.matchUpStatus,score:E.score,winningParticipantId:U,losingParticipantId:C,participantResults:a,isTieMatchUp:!0,manualGamesOverride:S,tallyPolicy:i,winningSide:D})}Qie({winningParticipantId:U,losingParticipantId:C,participantResults:a,matchUpStatus:v})}else cK({matchUpFormat:g.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:U,manualGamesOverride:S,losingParticipantId:C,participantResults:a,matchUpStatus:v,tallyPolicy:i,winningSide:D,score:b});if(S){let E=(p=w==null?void 0:w.find(({sideNumber:R})=>R===1))==null?void 0:p.participantId,P=(h=w==null?void 0:w.find(({sideNumber:R})=>R===2))==null?void 0:h.participantId;Sh(a,E),Sh(a,P);let M=(f=b==null?void 0:b.sets)==null?void 0:f.reduce((R,A)=>R+((A==null?void 0:A.side1Score)??0),0),N=(m=b==null?void 0:b.sets)==null?void 0:m.reduce((R,A)=>R+(A.side2Score??0),0);E&&(a[E].gamesWon+=M,a[E].gamesLost+=N),P&&(a[P].gamesWon+=N,a[P].gamesLost+=M)}}return I1e({participantResults:a,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:l}),{participantResults:a}}function b1e(t){let e=t.winningSide-1;return pb(t,e)}function w1e(t){let e=1-(t.winningSide-1);return pb(t,e)}function pb(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Sh(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function lK({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(o[c-1]+=1),a[0].push(wt(u||0)),a[1].push(wt(d||0))}let s=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(Sh(e,u),e[u].setsWon+=o[c],e[u].setsLost+=o[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function cK({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:l,score:c}){let u=l&&l-1,d=1-u;o||Qie({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:a});let p=NG({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),h=Zie({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),{pointsTally:f}=Xie({score:c,matchUpFormat:r});t&&(i[t].setsWon+=p[u],i[t].setsLost+=p[d],n||(i[t].gamesWon+=h[u],i[t].gamesLost+=h[d]),i[t].pointsWon+=f[u],i[t].pointsLost+=f[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[u],n||(i[e].gamesWon+=h[d],i[e].gamesLost+=h[u]),i[e].pointsWon+=f[d],i[e].pointsLost+=f[u])}function Qie({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===Pi&&(i[e].walkovers+=1),n===fi&&(i[e].defaults+=1),n===Ra&&(i[e].retirements+=1),[fi,Ra,Pi].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function S1e({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(n[o.participantId]=o.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(I=>n[I]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${o+1}: ${u} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[o]} => resolved: ${!!s}`)}),r.join(`\r
`)}function ene({participantResults:t,participantIds:e,attribute:i}){return tne({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:o}=r,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(n[s]?n[s].push(a):n[s]=[a]),n},{})}function tne(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var T1e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],aL={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function uK(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!U1e(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=ene({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(f=>parseFloat(f)).sort((f,m)=>m-f).map(f=>s[f]).map(f=>{let m=ine({participantIds:f,...t});return a.push(...m.report??[]),m.order}).flat(1/0),c=1,u;l.forEach((f,m)=>{m&&(f.resolved||u&&!f.resolved)&&(c+=1),u=f.resolved,f.resolved?(f.position=m+1,c=f.position):f.position=c});let d=l.map(({position:f})=>f),p=Vo(d);return l.forEach(f=>{let{participantId:m,position:g}=f||{},v=i[m];f.GEMscore=h(v);let y=p[g];(f==null?void 0:f.position)!==void 0&&(y>1&&(f.ties=y,n&&(f.subOrder=n[m])),f.rankOrder=g,f.groupOrder=g+(f.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(f){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(aL).filter(m=>r.GEMscore.includes(m)):Object.keys(aL)).map(m=>(f[m]||0)*Math.pow(10,aL[m].toFixed(3))).reduce((m,g)=>m+g,0)}}function U1e({participantResults:t,participantsCount:e}){let i=tne({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function D1e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=sP({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=ene({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:s,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>s?p-h:h-p).map(p=>c[p]).map(p=>{let h=ine({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:o});return u.push(...h.report??[]),h.order}).flat(1/0)),{order:d,report:u}}function ine({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=P1e({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[u],headToHeadWinner:d,report:s}}}let c=((r==null?void 0:r.tallyDirectives)||T1e).filter(u=>{let d=!(En(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||o.push(u),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=D1e({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function P1e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function T0({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:a}){if(!(n!=null&&n.length)||!Js(n))return{error:Md};let o=Ft(n.map(({structureId:I})=>I));if(o.length!==1)return ae({result:{error:ve,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let s=n.filter(I=>I&&I.matchUpStatus!==bi),l=s.length&&Ft(s.map(({drawPositions:I})=>I).flat()).length,c=s.filter(I=>Sm({matchUp:I})).length===s.length;c||(a=0);let u=n.every(({matchUpType:I,tieMatchUps:b})=>I===Ki&&(b==null?void 0:b.every(D=>Sm({matchUp:D})))),d=t==null?void 0:t[cj],p=n.filter(I=>Sm({matchUp:I})||I.matchUpType===Ki),{participantResults:h}=sP({matchUps:p,matchUpFormat:i,tallyPolicy:d,perPlayer:a}),f,m,{groupOrder:g,report:v}=uK({matchUps:p,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r});if(c&&g)f=v,m=g,g.forEach(I=>{let{participantId:b,groupOrder:D,rankOrder:w,subOrder:S,ties:U,GEMscore:C}=I,E=h[b];Object.assign(E,{groupOrder:D,rankOrder:w,GEMscore:C,subOrder:S,ties:U})});else{let{groupOrder:I,report:b}=uK({requireCompletion:!1,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r,matchUps:n});f=b,m=I,I&&I.forEach(D=>{let{participantId:w,groupOrder:S,GEMscore:U}=D,C=h[w];Object.assign(C,{provisionalOrder:S,GEMscore:U})})}let y={completedTieMatchUps:u,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||u)&&(y.order=m),e||Hs({tally:!0})){let I=S1e({matchUps:n,report:f,order:m});Hs({tally:!0})&&console.log(I),y.readableReport=I}return y}function nne({positionAssignments:t}){let e=(t||[]).filter(jo(od)).map(r=>{let{extension:a}=Vt({element:r,name:$b}),o=wt(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=Vo(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function _G({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!Js(r))return{error:ve};if(!t)return{error:ve};let{policyDefinitions:o}=Vp({policyTypes:[cj],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=nne({positionAssignments:t}),l=r.length?T0({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:Hh};ci({element:h,extension:m}),c[f].ties||Ba({element:h,name:$b})}else Ba({element:h,name:Hh}),Ba({element:h,name:$b})}),Xi({drawDefinition:i}),{...ne,participantResults:c,bracketComplete:u,report:d}}function rne({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function nn({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:c}){if(!r)return{error:et};if(!o)return{error:la};if(typeof o!="string")return{error:ve};let{structures:u=[]}=fd({drawDefinition:r});n&&!i&&(i=Gp({contextProfile:n,drawDefinition:r}));for(let d of u){let{matchUps:p}=Ti({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:a,inContext:s,structure:d,context:l,event:c}),{matchUp:h}=rne({matchUps:p,matchUpId:o});if(h)return{matchUp:h,structure:d}}return{error:ya}}function JA(t){var e;return typeof t!="object"?{error:ut}:typeof t.element!="object"?{error:ve}:t.notes?typeof t.notes!="string"&&!((e=t.notes)!=null&&e.testing)?{error:ve}:(Object.assign(t.element,{notes:t.notes}),{...ne}):{error:ut}}function ane(t){return typeof t!="object"?{error:ut}:typeof t.element!="object"?{error:ve}:(t.element.notes&&delete t.element.notes,{...ne})}var QA={matchUpStatus:On,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Xc(t){var U,C,E,P,M,N,R,A;let e="modifyMatchUpScore",i=t.matchUpFormat,n=t.matchUp,r,{matchUpStatusCodes:a,removeWinningSide:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,removeScore:u,winningSide:d,matchUpId:p,event:h,notes:f,score:m}=t,g=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(U=Ei({policyTypes:[ud],tournamentRecord:s,drawDefinition:l,structure:r,event:h}))==null?void 0:U.appliedPolicies,v=n.matchUpType===Ki;if(v&&l){if(p&&n.matchUpId!==p){let _=nn({drawDefinition:l,matchUpId:p,event:h});if(!_.matchUp)return{error:ya};({matchUp:n,structure:r}=_)}}else n.matchUpId!==p&&console.log("!!!!!");c&&[Pi,Qn].includes(c)||u?Object.assign(n,{...QA}):m&&(n.score=m);let y=c&&(n==null?void 0:n.matchUpStatus)===fi&&c!==fi;c&&(n.matchUpStatus=c),i&&(n.matchUpFormat=i),a&&(n.matchUpStatusCodes=a),d&&(n.winningSide=d),o&&(n.winningSide=void 0),!r&&l&&({structure:r}=nn({drawDefinition:l,matchUpId:p,event:h})),c&&!n.winningSide&&Vr(n)&&!gr.includes(c)&&![ky,Tf].includes(c)&&(n.matchUpStatus=Bl);let I;if((y&&((C=n==null?void 0:n.processCodes)!=null&&C.length)||c===fi)&&(I=(P=(E=g==null?void 0:g[ud])==null?void 0:E.processCodes)==null?void 0:P.incompleteAssignmentsOnDefault),!n.collectionId){let _=(r==null?void 0:r.structureType)===Qa,O=Go({structure:r});if(iG({drawDefinition:l,structure:r})||O||_){let x=V=>{i=v?"SET1-S:T100":i??n.matchUpFormat??(V==null?void 0:V.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(h==null?void 0:h.matchUpFormat);let G=v?{matchUpTypes:[Ki]}:void 0,{matchUps:j}=Ti({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:G,drawDefinition:l,structure:V,event:h});return O&&(V.positionAssignments=Ft(j.flatMap(z=>(z.sides??[]).map(H=>H.participantId)).filter(Boolean)).map(z=>({participantId:z}))),_G({positionAssignments:V.positionAssignments,tournamentRecord:s,drawDefinition:l,matchUpFormat:i,matchUps:j,event:h})},F=_&&r.structures.find(V=>V==null?void 0:V.matchUps.find(G=>G.matchUpId===p)),$=x(F||r);if($.error)return ae({result:$,stack:e})}}if(f){let _=JA({element:n,notes:f});if(_.error)return ae({result:_,stack:e})}let b=s==null?void 0:s.tournamentId,D=Xs().topics.includes(kA),w=(D||I)&&ca({drawDefinition:l}),S=w&&((M=sr({matchUpFilters:{matchUpIds:[p]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:l,matchUpsMap:w}).matchUps)==null?void 0:M[0]);if(D&&S&&NPe({tournamentId:b,inContextMatchUp:S}),Array.isArray(I)&&S&&!((N=S.sides)!=null&&N.every(({participantId:_})=>_)))if(c===fi)n.processCodes=Ft([...n.processCodes??[],...I]);else for(let _ of I||[]){let O=_&&((R=n==null?void 0:n.processCodes)==null?void 0:R.lastIndexOf(_));(A=n==null?void 0:n.processCodes)==null||A.splice(O,1)}return oi({eventId:h==null?void 0:h.eventId,context:e,drawDefinition:l,tournamentId:b,matchUp:n}),{...ne}}function kG(t){let{dualWinningSideChange:e,matchUpStatusCodes:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=qD({matchUpStatus:n})||[$p,cs].includes(n)&&e,s="attemptToModifyScore",l=!!a.collectionId,c=Go({structure:r});if(!(l||c||C1e({structure:r,matchUp:a})))return{error:TV};let u=[Pi].includes(n),d=Xc({...t,matchUpStatusCodes:o&&i||[],matchUpStatus:o&&n||Wn,context:s,removeScore:u});return ae({result:d,stack:s})}function C1e({structure:t,matchUp:e}){var r;let{drawPositions:i}=e,{positionAssignments:n}=Er({structure:t});return((r=n==null?void 0:n.filter(a=>(i==null?void 0:i.includes(a.drawPosition))&&a.participantId))==null?void 0:r.length)===2}function one({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>Mt(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>wt(n));return{groupValueGroups:e,groupValueNumbers:i}}function E1e({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>gr.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),Mt(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):Mt(m)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(D=>{D.winningSide&&(o[D.winningSide-1]+=m)})}):Mt(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(D=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:U=0,side2Score:C=0}=D;(y.matchUpStatus===Wn||y.winningSide||D.winningSide)&&(U||C?(o[0]+=U,o[1]+=C):(w||S)&&D.winningSide&&(o[D.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=M1e({collectionDefinition:t,collectionPosition:I});Mt(b)&&(o[y.winningSide-1]+=b)}}),Mt(d)){let y;if(h!=null&&h.aggregateValue)l&&(Mt(p||m||f)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=o.reduce((I,b,D)=>b>=h.valueGoal?D+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,D,w)=>D>=I?w+1:b,0)}y&&(g?i[u].values[y-1]+=d:s[y-1]+=d)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):s.forEach((y,I)=>n[I]+=y||0)}function M1e({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function sne({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=r;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Ft(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...ne}}var R1e="MIXED events can not contain mixed singles or { gender: ANY } collections",N1e="events with { gender: ANY } can not contain MIXED singles collections";function e_(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[Hi,fn].includes(i)&&i!==r?ae({result:{valid:!1,error:L1},context:{gender:r},stack:e}):i===Lo&&(r===cu||r===Lo&&n!==Wi)?ae({result:{error:L1,valid:!1},info:R1e,stack:e}):i===cu&&r===Lo&&n!==Wi?ae({result:{error:L1,valid:!1},info:N1e,stack:e}):{valid:!0}}function t_(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return A1e(t,e)}function rU(t){return!isNaN(Number(t))&&Number(t)}function lne(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function A1e(t,e){var u;let i=rU(t.bestOf)||void 0,n=rU(t.exactly)||void 0,r=i||n;if((u=t.setFormat)!=null&&u.timed&&t.simplified&&r===1)return lne(t.setFormat);let a=r&&`${H1}${r}`||"",o=dK(t.setFormat,e),s=o&&`S:${o}`||"",l=dK(t.finalSetFormat,e),c=r&&r>1&&l&&o!==l&&`F:${l}`||"";if(a&&o)return[a,s,c].filter(d=>d).join("-")}function dK(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return lne(t);if(t.tiebreakSet)return pK(t.tiebreakSet);let i=rU(t.setTo);if(i){let n=t.NoAD&&rG||"",r=pK(t.tiebreakFormat),a=r&&`/${r}`||"",o=rU(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(r!==!1)return`${i}${n}${a}${s}`}}}function pK(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&rU(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?rG:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Ho({matchUpFormat:t}){if(typeof t!="string")return!1;let e=fo(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],c=o==null?void 0:o[3];return t_(e,!!(i&&r&&n===a||o&&l&&s===c))===t}var _1e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),k1e=t=>t.filter(Boolean).every(En);function lP(t){let e=t.category;if(typeof e!="object")return{error:$M};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!_1e([i,n,r,s],"string")||!k1e([a,o]))return{error:$M};let c=t.consideredDate??xt(new Date().toLocaleDateString("sv"));if(!ss(c))return{error:Ha};let[u]=c.split("-").slice(0,3).map(F=>parseInt(F)),d=HS(c,-1),[p,h]=d.split("-").slice(1,3).map(F=>parseInt(F)),f=`${Ns(p)}-${Ns(h)}`,m=HS(c,1),[g,v]=m.split("-").slice(1,3).map(F=>parseInt(F)),y=`${Ns(g)}-${Ns(v)}`,I=o&&HS(c,-1*365*o),b=a&&HS(c,-1*365*a),D=[],w=F=>!D.includes(F)&&D.push(F);i=i??s;let S=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,C=i==null?void 0:i.includes("-"),E=C&&(i==null?void 0:i.match(U)),P=i==null?void 0:i.match(S),M=(F,$)=>`${F}-${$}`,N=F=>{let $=u-F,V=M($,y);e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==F-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=F-1)},R=F=>{let $=u-F-1,V=M($,y);e.ageMin&&e.ageMin>F&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>F&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==F&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=F)},A=F=>{let $=u-F,V=M($,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==F+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=F+1)},_=F=>{let $=u-F-1,V=M($,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==F&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=F)},O=F=>{let[$,V,G]=(F.match(S)||[]).slice(1),j=parseInt(V);$==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(j)):$==="O"&&A(j),G==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(j)):G==="O"&&_(j),n=n??I,r=r??b};if(E){if(n=void 0,r=void 0,a=void 0,o=void 0,e.ageMin){let V=u-e.ageMin;n=M(V,f)}if(e.ageMax){let V=u-e.ageMax-1;r=M(V,y)}let[F,$]=((i==null?void 0:i.match(U))??[]).slice(1).map(V=>parseInt(V));F<=$?(o=F,a=$,l=!0):w(`Invalid combined age range ${i}`)}else C?i==null||i.split("-").forEach(O):P?O(i):(o&&A(o),a&&R(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let x=ht({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o});return D.length&&(x.errors=D),x}function oR({category:t}){if(!Zi(t))return{error:ve};let e=lP({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!En(i)?ae({result:{error:ve},context:{ratingMax:i}}):n&&!En(n)?ae({result:{error:ve},context:{ratingMin:n}}):{...e}}function i_({childCategory:t,withDetails:e,category:i}){let n=oR({category:i}),r=oR({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=ht({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!c&&!s&&!l&&!u&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function cP({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ae({result:{errors:l,error:Fp},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!HA([Tn,Wi],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(Mt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let D=sne({collectionValueProfiles:c,matchUpCount:h});D.errors&&l.push(...D.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Ho({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let D=e_({referenceGender:a,matchUpType:g,gender:b});if(D.error)return ae({context:{referenceGender:a,gender:b},result:D,stack:s})}if(t&&r&&I){let D=i_({category:r,childCategory:I});if(!D.valid)return ae({result:{error:$M},context:D,stack:s})}return l.length?ae({result:{errors:l,error:QQ},stack:s}):{valid:!0}}function Uo(t){var m,g,v,y;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),n=t==null?void 0:t.checkCollectionIds,r=t==null?void 0:t.tieFormat,a=t==null?void 0:t.event,o="validateTieFormat",s=[];if(!t||!r||typeof r!="object")return s.push("tieFormat must be an object"),ae({result:{error:Wd},context:{tieFormat:r,errors:s},stack:o});if(typeof r.winCriteria!="object")return s.push("tieFormat.winCriteria must be an object"),ae({result:{error:Wd},context:{tieFormat:r,errors:s},stack:o});if(!Array.isArray(r.collectionDefinitions))return s.push(gd("tieFormat.collectionDefinitions")),ae({result:{error:Wd},context:{tieFormat:r,errors:s},stack:o});let l,c=r.collectionDefinitions.every(I=>{let{setValue:b,scoreValue:D,collectionValue:w}=I;(b||D)&&!w&&(l=!0);let{valid:S,errors:U}=cP({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:I,checkCollectionIds:n,checkCategory:e,checkGender:i,event:a});return S?!0:(Array.isArray(U)&&s.push(...U),!1)}),u=typeof((m=r.winCriteria)==null?void 0:m.valueGoal)=="number"&&((g=r.winCriteria)==null?void 0:g.valueGoal)>0&&!l||((v=r.winCriteria)==null?void 0:v.aggregateValue);if(!(u||(y=r.winCriteria)!=null&&y.aggregateValue))return l?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ae({context:{tieFormat:r,errors:s,aggregateValueImperative:l},result:{error:Wd},stack:o});let d=r.collectionDefinitions.map(({collectionId:I})=>I),p=!n||d.length===Ft(d).length,h=c&&u&&p;return h?{valid:h,errors:s}:ae({result:{error:Wd},context:{tieFormat:r,errors:s},stack:o})}function uP(t){var b,D,w,S,U;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:n,matchUpsMap:r,structure:a,matchUp:o,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((C,E)=>C+E)))return{error:ve};if(!o)return{error:To};let l=((b=Ca({matchUp:o,drawDefinition:n,structure:a,event:s}))==null?void 0:b.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:gD};let c=Uo({tieFormat:l});if(c.error)return c;let u=(l==null?void 0:l.collectionDefinitions)||[],d=(o==null?void 0:o.tieMatchUps)??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=one(l);for(let C of u)E1e({collectionDefinition:C,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let C of f){let E=h[C],{allGroupMatchUpsCompleted:P,matchUpCount:M,winCriteria:N,groupValue:R,sideWins:A,values:_}=E,O;if(N!=null&&N.aggregateValue)P&&_[0]!==_[1]&&(O=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)O=_.reduce((x,F,$)=>F>=N.valueGoal?$+1:x,void 0);else{let x=Math.floor(M/2)+1;O=A.reduce((F,$,V)=>$>=x?V+1:F,void 0)}O&&(p[O-1]+=R||0)}let m=p.map((C,E)=>(C||0)+e[E]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),I;if(l!=null&&l.winCriteria){let{valueGoal:C,aggregateValue:E,tallyDirectives:P}=l.winCriteria;if(C?I=(D=m.map((M,N)=>({sideNumber:N+1,points:M})).find(({points:M})=>M>=C))==null?void 0:D.sideNumber:E&&d.every(M=>M.matchUpStatus&&gr.includes(M.matchUpStatus)||M.winningSide)&&m[0]!==m[1]&&(I=m[0]>m[1]?1:2),!I&&P){let M=o.matchUpId,N=o.hasContext?o:((w=r==null?void 0:r.drawMatchUps)==null?void 0:w[M])||n&&((S=nn({inContext:!0,drawDefinition:n,matchUpId:M}))==null?void 0:S.matchUp);if(N){let{completedTieMatchUps:R,order:A}=T0({matchUps:[N]});if(R&&(A!=null&&A.length)){let _=A[0].participantId;I=(U=N.sides.find(({participantId:O})=>O===_))==null?void 0:U.sideNumber}}}}return I&&(g.winningSide=I),{scoreStringSide1:v,scoreStringSide2:y,winningSide:I,set:g}}function dP({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){t||(t=(a=nn({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=Vt({element:e,name:pp}),l=at((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(u=>{var g;let d=u.participantId,p=d&&l[d]||void 0,{lineUp:h,...f}=((g=n.sides)==null?void 0:g.find(({sideNumber:v})=>v===u.sideNumber))??{},m=h!=null&&h.length?h:p;return{...c(u),...f,lineUp:m}}),oi({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function Xr(t){if(t)return at(t,!1,!0)}function OG(t){let e=gi(t,[{[ba]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:s})=>s),o=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function cne({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=OG({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function zp(t){var M,N,R,A;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:n,removeScore:r,matchUpsMap:a,matchUpId:o,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(M=t.tournamentRecord)==null?void 0:M.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&cne({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:Re};let d=nn({drawDefinition:i,event:s,matchUpId:o});if(d.error)return d;if(!d.matchUp)return{error:ya};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:oo};dP({tournamentId:u==null?void 0:u.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=Vt({name:Fb,element:p});if(f!=null&&f.value)if(r)Ba({element:p,name:Fb});else return{...ne,score:p.score};let m=(R=Ca({drawDefinition:i,structure:h,matchUp:p,event:s}))==null?void 0:R.tieFormat;p.tieFormat=Xr(m);let g=uP({drawDefinition:i,matchUpsMap:a,structure:h,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:I,scoreStringSide2:b}=g,D=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!D)return{...ne};let w={scoreStringSide1:I,scoreStringSide2:b,sets:y?[y]:[]},S=v&&[1,2].includes(v),U=S&&Wn||sG({matchUpStatus:n??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:w})&&Bl||On,C=!!(p.winningSide&&!S),E=p.tieMatchUps.find(({score:_,winningSide:O,matchUpStatus:x})=>{var F;return((F=_==null?void 0:_.sets)==null?void 0:F.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||x&&gr.includes(x)||O}),P;if(p.tieFormat&&!S&&!E){let _=(A=Ca({drawDefinition:i,structure:h,event:s}))==null?void 0:A.tieFormat;_&&JSON.stringify(m)===JSON.stringify(_)&&(p.tieFormatId=void 0,p.tieFormat=void 0,P=!0)}return Xc({appliedPolicies:t.appliedPolicies,matchUpStatus:U,score:w,removeWinningSide:C,tournamentRecord:u,drawDefinition:i,removeScore:r,winningSide:v,matchUpId:o,matchUp:p,event:s}),{...ne,score:w,removeWinningSide:C,tieFormatRemoved:P,winningSide:v}}function O1e({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var f,m,g,v,y;let h="directWinner";if(o){let I=c.drawPositions||[],b=I[t],D=o.source.structureId,w=Ut({structureId:D,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:U}=Er({structureId:D,drawDefinition:l}),C=(f=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:f.participantId,E=o.target.structureId,{positionAssignments:P}=Er({structureId:E,drawDefinition:l}),M=(m=P==null?void 0:P.find(A=>A.participantId===C))==null?void 0:m.drawPosition,N=P==null?void 0:P.filter(A=>{let _=I.includes(A.drawPosition),O=!A.participantId&&!A.bye&&!A.qualifier;return _&&O}).map(A=>A.drawPosition),R=N==null?void 0:N.includes(b);if(C&&o.target.roundNumber===1&&R)uu({drawPosition:b,participantId:C,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(C&&(N!=null&&N.length)){let A=N.pop();A&&uu({participantId:C,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(M){let A=qb({drawPosition:M,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return ae({result:A,stack:h})}else if((S==null?void 0:S.stage)!==mt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){let A=S.seedAssignments.find(({participantId:O})=>O===C),_=A==null?void 0:A.participantId;A&&_&&w0({eventId:c==null?void 0:c.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let I=qb({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(u&&i){let I=(g=u.sides)==null?void 0:g.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=u.roundPosition,D=c.roundPosition,w=b===D&&b!==1||Math.floor(b/2)===D?2:1,S=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:E})=>E===c.matchUpId),U=[1,2].map(E=>{var P;return{...((P=S.sides)==null?void 0:P.find(M=>M.sideNumber===E))||{},sideNumber:E}});S.sides=U;let C=S.sides.find(E=>E.sideNumber===w);if(C){let E=(y=I.lineUp)==null?void 0:y.filter(P=>P==null?void 0:P.participantId);C.lineUp=bG({lineUp:E}),oi({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:S,context:h,drawDefinition:l})}}}return{...ne}}function x1e(t){var $,V,G;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,sourceMatchUpStatus:r,loserDrawPosition:a,tournamentRecord:o,loserTargetLink:s,drawDefinition:l,loserMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}=t,h="directLoser",f=s.linkCondition,m=c.drawPositions||[],g=f===pd&&c.roundNumber===2&&Math.min(...m.filter(Boolean)),v=g||m[e],y=g||m[1-e],I=s.source.structureId,{structure:b}=Ut({structureId:I,drawDefinition:l}),{matchUps:D}=Ti({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:b,event:p}),w=D.filter(j=>{var z;return(z=j.drawPositions)==null?void 0:z.includes(a)}).filter(j=>{let z=j.sides.find(K=>K.drawPosition===a),H=j.matchUpStatus===Pi||j.matchUpStatus===fi&&!Vr(j);return(z==null?void 0:z.sideNumber)===j.winningSide&&!H}),S=f===pd&&w.length===0,{positionAssignments:U}=Er({structureId:I,drawDefinition:l}),C=($=U==null?void 0:U.find(j=>j.drawPosition===a))==null?void 0:$.participantId,E=s.target.structureId,{positionAssignments:P}=Er({structureId:E,drawDefinition:l}),M=P==null?void 0:P.filter(({drawPosition:j})=>m.includes(j));if(M!=null&&M.some(j=>j.participantId===C))return{...ne};let N=M==null?void 0:M.filter(j=>{let z=m.includes(j.drawPosition),H=!j.participantId&&!j.bye&&!j.qualifier;return z&&H}).map(j=>j.drawPosition),R=N==null?void 0:N.includes(v),A=s.target.roundNumber>1&&(N==null?void 0:N.length),_=s.target.roundNumber===1&&R;if(g){let j=O();if(j.error)return ae({result:j,stack:h})}else if(_){let j=F();if(j.error)return ae({result:j,stack:h})}else if(C&&A){N.sort(ar);let j=N[0],z=uu({participantId:C,structureId:E,drawPosition:j,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});if(z.error)return ae({result:z,stack:h})}else return ae({result:{error:Zw},context:{loserDrawPosition:a,loserTargetLink:s},stack:h});if(b!=null&&b.seedAssignments&&b.structureId!==E){let j=b.seedAssignments.find(({participantId:H})=>H===C),z=j==null?void 0:j.participantId;j&&z&&w0({eventId:c==null?void 0:c.eventId,structureId:E,...j,tournamentRecord:o,drawDefinition:l,participantId:z})}if(u&&n){let j=(V=u.sides)==null?void 0:V.find(z=>z.sideNumber===3-n);if(j!=null&&j.lineUp){let{roundNumber:z,eventId:H}=c,{roundPosition:K}=u,q=z===1?2-K%2:1,Y=(G=d==null?void 0:d.drawMatchUps)==null?void 0:G.find(({matchUpId:ie})=>ie===c.matchUpId),Z=[1,2].map(ie=>{var ue;return{...((ue=Y.sides)==null?void 0:ue.find(J=>J.sideNumber===ie))||{},sideNumber:ie}});Y.sides=Z;let Q=Y.sides.find(ie=>ie.sideNumber===q);Q&&(Q.lineUp=bG({lineUp:j.lineUp}),oi({tournamentId:o==null?void 0:o.tournamentId,matchUp:Y,context:h,drawDefinition:l,eventId:H}))}}return{...ne};function O(){let j="loserLinkFedFMLC";return ae(S?{result:F(),stack:j}:{result:x(),stack:j})}function x(){let j=ys({drawPosition:y,structureId:E,tournamentRecord:o,drawDefinition:l,event:p});return ae({result:j,stack:"assignLoserPositionBye"})}function F(){let j=C?uu({drawPosition:v,participantId:C,structureId:E,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p}):{error:mr};return ae({result:j,stack:"assignLoserDrawPosition"})}}function une(t){var w;let e=kG(t);if(e.error)return e;let i=qD({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:r,inContextDrawMatchUps:a,tournamentRecord:o,drawDefinition:s,matchUpStatus:l,dualMatchUp:c,matchUpsMap:u,winningSide:d,targetData:p,matchUpId:h,structure:f,matchUp:m,event:g}=t,v="directParticipants",y=!!m.collectionId,I=Go({structure:f}),b=m.drawPositions,D;if(y){let{matchUpTieId:S,matchUpsMap:U}=t,C=zp({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:o,drawDefinition:s,matchUpsMap:U,event:g});if(D=C&&{tieMatchUpResult:C},b=(w=a.find(({matchUpId:E})=>E===S))==null?void 0:w.drawPositions,!n)return ae({result:{...ne,...D},stack:v})}if(I)return ae({result:{...ne,...D},stack:v});if(b){let S=r?r-1:d-1,U=1-S,C=b[S],E=b[U],{targetLinks:{loserTargetLink:P,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:R,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:O,byeMatchUp:x}}=p;if(_){let F=O1e({sourceMatchUpStatus:i&&l||Wn,winnerMatchUpDrawPositionIndex:R,sourceMatchUpId:h,inContextDrawMatchUps:a,projectedWinningSide:r,winningDrawPosition:C,tournamentRecord:o,winnerTargetLink:M,drawDefinition:s,winnerMatchUp:_,dualMatchUp:c,matchUpsMap:u,event:g});if(F.error)return ae({result:F,stack:v})}if(O){let F=x1e({sourceMatchUpStatus:i&&l||Wn,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:a,projectedWinningSide:r,loserDrawPosition:E,tournamentRecord:o,loserTargetLink:P,drawDefinition:s,loserMatchUp:O,winningSide:d,matchUpsMap:u,dualMatchUp:c,event:g});if(F.error)return ae({result:F,stack:v})}if(x){let F=x.drawPositions||[],$=Math.min(...F.filter(Boolean)),V=N.target.structureId,G=ys({drawPosition:$,structureId:V,tournamentRecord:o,drawDefinition:s,event:g});if(G.error)return ae({result:G,stack:v})}}else return ae({result:{error:hD},stack:v});return ae({result:{...ne,...D},stack:v})}function xG(t){var q,Y,Z,Q;let e="genPlayoffStructure";if(!t.drawDefinition)return ae({result:{error:et},stack:e});let i=rP(t);if(i.error)return ae({result:i,stack:e});let{structureId:n,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionNaming:o,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,I=at(t.drawDefinition,!1,!0),{structure:b}=Ut({structureId:n,drawDefinition:I});if(!b)return ae({result:{error:bn},stack:e});if(b.structureType===Qa||b.structures)return d1e({sourceStructureId:b.structureId,...t,...i,drawDefinition:I});let{playoffRoundsRanges:D,playoffRounds:w}=i,{playoffPositionsReturned:S,error:U,playoffSourceRounds:C,playoffRoundsRanges:E}=Hie(t);if(U)return ae({result:{error:U},stack:e});let P=(h==null?void 0:h.length)&&Object.assign({},...h),M=f||typeof h=="object"&&h.map(ie=>Object.keys(ie)).flat(),N=Array.isArray(M)&&M.map(ie=>!isNaN(ie)&&wt(ie)).filter(Boolean);if(N){if(!Array.isArray(N))return ae({result:{error:ve},context:{validRoundNumbers:N},stack:e});N.forEach(ie=>{if(!(w!=null&&w.includes(ie)))return ae({result:{error:ve},context:{roundNumber:ie},stack:e})})}c&&c.forEach(ie=>{if(!(S!=null&&S.includes(ie)))return ae({result:{error:ve},context:{playoffPosition:ie},stack:e})});let R=N||C,A=N?D:E,_=[],O=[];for(let ie of R??[]){let ue=A==null?void 0:A.find(he=>he.roundNumber===ie);if(!ue)return ae({result:{error:ve},context:{roundNumber:ie},stack:e});let J=ue.finishingPositions.length,te=Math.min(...ue.finishingPositions)-1,se=2,ee=ie&&(P==null?void 0:P[ie])&&se+P[ie]-1,ce=Ib({exitProfile:`0-${ie}`,addNameBaseToAttributeName:r,playoffStructureNameBase:a,finishingPositionOffset:te,playoffAttributes:l,exitProfileLimit:p,stage:Rn,roundOffset:0,drawDefinition:I,sequenceLimit:ee,stageSequence:se,drawSize:J,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:o,finishingPositionLimit:s,roundOffsetLimit:u});if(ce.error)return ae({result:ce,stack:e});let{structures:fe,links:ge}=ce;if(fe!=null&&fe.length&&_.push(...fe),ge!=null&&ge.length&&O.push(...ge),ce.structureId&&ie){let he={linkType:dd,source:{structureId:n,roundNumber:ie},target:{structureId:ce.structureId,feedProfile:gl,roundNumber:1}};O.push(he)}}if(!_.length)return ae({result:{error:ve},info:"No structures generated",stack:e});I.structures.push(..._),I.links.push(...O);let{matchUps:x,matchUpsMap:F}=sr({inContext:!0,drawDefinition:I}),$=_.map(({structureId:ie})=>ie),V=x==null?void 0:x.filter(({structureId:ie})=>$.includes(ie)).map(Pr),G=(q=F==null?void 0:F.drawMatchUps)==null?void 0:q.filter(({matchUpId:ie})=>V==null?void 0:V.includes(ie));if(G!=null&&G.length){let ie=(Y=Ca({drawDefinition:I,event:v}))==null?void 0:Y.tieFormat;ie&&G.forEach(ue=>{let{tieMatchUps:J}=aP({matchUp:ue,tieFormat:ie,isMock:g});Object.assign(ue,{tieMatchUps:J,matchUpType:Ki})})}(Z=x==null?void 0:x.filter(ie=>Sm({matchUp:ie})&&ie.structureId===n))==null||Z.forEach(ie=>{let{matchUpId:ue,score:J,winningSide:te}=ie,se=qa({inContextDrawMatchUps:x,drawDefinition:I,matchUpId:ue}),ee=une({inContextDrawMatchUps:x,tournamentRecord:d,drawDefinition:I,matchUpsMap:F,winningSide:te,targetData:se,matchUpId:ue,structure:b,matchUp:ie,score:J,event:v});ee.error&&console.log(ee.error)}),(Q=x==null?void 0:x.filter(ie=>ie.matchUpStatus===bi&&ie.structureId===n))==null||Q.forEach(ie=>{let{matchUpId:ue}=ie,J=qa({inContextDrawMatchUps:x,drawDefinition:I,matchUpId:ue}),{targetLinks:{loserTargetLink:te},targetMatchUps:{loserMatchUpDrawPositionIndex:se,loserMatchUp:ee}}=J;if(te&&ee){let ce=te.target.structureId,fe=ee.drawPositions[se],ge=ys({drawPosition:fe,structureId:ce,tournamentRecord:d,drawDefinition:I,event:v});ge.error&&console.log(ge.error)}});let j=[],z=Lm({inContextDrawMatchUps:x,drawDefinition:I,matchUpsMap:F}).goesToMap,{structure:H}=Ut({drawDefinition:t.drawDefinition,structureId:n}),{matchUps:K}=Ti({structure:H});return K.forEach(ie=>{var te,se;let ue=z==null?void 0:z.loserMatchUpIds[ie.matchUpId];if(ue&&ie.loserMatchUpId!==ue){ie.loserMatchUpId=ue;let ee={tournamentId:d==null?void 0:d.tournamentId,eventId:(te=t.event)==null?void 0:te.eventId,context:e,matchUp:ie};j.push(ee)}let J=z==null?void 0:z.winnerMatchUpIds[ie.matchUpId];if(J&&ie.winnerMatchUpId!==J){ie.winnerMatchUpId=J;let ee={tournamentId:d==null?void 0:d.tournamentId,eventId:(se=t.event)==null?void 0:se.eventId,context:e,matchUp:ie};j.push(ee)}}),{structures:_,matchUpModifications:j,links:O,drawDefinition:I,...ne}}function dne(t){return n_({...t,itemType:"attachConsolationStructures"})}function LG(t){return n_({...t,itemType:"attachPlayoffStructures"})}function n_({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var g,v,y;let s="attachStructures";if(!n)return{error:et};if(!Array.isArray(r)||!Array.isArray(a))return ae({result:{error:ve},stack:s});let l=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},c=(g=n.links)==null?void 0:g.map(l);if(a.some(I=>{let b=l(I);return c==null?void 0:c.includes(b)}))return ae({result:{error:GV},info:"playoff structure exists",stack:s});a.length&&((v=n.links)==null||v.push(...a));let u=r.map(({structureId:I})=>I),d=(y=n.structures)==null?void 0:y.map(({structureId:I})=>I);n.structures=(n.structures??[]).map(I=>u.includes(I.structureId)?r.find(({structureId:b})=>b===I.structureId):I);let p=r==null?void 0:r.filter(({structureId:I})=>!(d!=null&&d.includes(I)));p.length&&n.structures.push(...p),Lm({drawDefinition:n});let h=r.map(I=>{var b;return((b=Ti({structure:I}))==null?void 0:b.matchUps)||[]}).flat();Wh({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUps:h});let f=r.map(({structureId:I})=>I);if(Xi({drawDefinition:n,structureIds:f}),e==null?void 0:e.length){let I={};e.forEach(D=>{var S;let w=(S=D.matchUp)==null?void 0:S.matchUpId;w&&(I[w]=D)});let b=D=>{D.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:S,...U}=I[w.matchUpId].matchUp;if(Object.assign(w,U),S==null?void 0:S.length){let C={};S.forEach(E=>I[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,C[E.matchUpId]))}I[w.matchUpId].matchUp=w,oi(I[w.matchUpId])}})};n.structures.forEach(D=>{if(d!=null&&d.includes(D.structureId))if(D.structures)for(let w of D.structures)b(w);else b(D)})}let m=p.map(jo("structureId"));if(i){let I={itemValue:{structureIds:f,drawId:n.drawId},itemType:t};Df({element:i,timeItem:I})}return{...ne,addedStructureIds:m}}function r_(t){var o,s;let{structures:e,links:i,matchUpModifications:n,error:r}=xG(t);if(r)return{error:r};let a=t.drawDefinition;return LG({tournamentId:(o=t.tournamentRecord)==null?void 0:o.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:n,drawDefinition:a,structures:e,links:i})}function Fm(t){let e=gi(t,[{_anyOf:{[ba]:!1,[Rd]:!1,[Lc]:!1,[r0]:!1},[JV]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=hK(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&Xi({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Re};for(let a of r){let o=t.tournamentRecords[a],s=hK(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:Re};return i.length?{...ne,applied:i}:{error:MV}}function hK(t,e){let i=Ei(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:lA};for(let a of r)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!Zi(o))return{error:ve};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!Ga(s))return{error:ve};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...ci({element:e,extension:{name:qT,value:i}}),applied:n}:{applied:n,error:MV}}function FG({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var s;if(!n||typeof n!="string")return ae({result:{error:ve},context:{drawName:n}});i||(i=Bn({event:a}).flightProfile);let o=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===r);if(o){o.drawName=n;let l={name:Ml,value:{...i,flights:i.flights}};Sf({event:a,extension:l})}return e&&(e.drawName=n,Xi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!o&&!e?{error:et}:{...ne,flight:o}}function pne({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var l;if(!Zi(i))return{error:ve};let a=Bn({event:r}).flightProfile,o=i.drawName&&FG({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:n,event:r});if(o!=null&&o.error)return o==null?void 0:o.error;let s=(o==null?void 0:o.flight)||((l=a==null?void 0:a.flights)==null?void 0:l.find(c=>c.drawId===n));if(!s&&!e)return{error:et};if(s){let c={name:Ml,value:{...a,flights:a.flights}};Sf({event:r,extension:c})}return e&&(i.policyDefinitions&&Fm({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Xi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...ne}}function hne({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var o,s;if(!i)return{error:et};let n=ca({drawDefinition:i}),r=l=>{var c;return(c=n==null?void 0:n.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![mt,it].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=Ti({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:n,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=r(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==bi&&Object.assign(y,QA),g&&g>1&&((o=y.drawPositions)==null?void 0:o.length)&&!h){let I=v==null?void 0:v.map(({drawPosition:D,participantFed:w})=>!w&&D).filter(Boolean),b=y.drawPositions.map(D=>I.includes(D)?void 0:D);y.drawPositions=b}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![yp,km,f0,bte,m0,g0].includes(I.itemType))),oi({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let a=(i.structures||[]).map(({structureId:l})=>l);return Xi({drawDefinition:i,structureIds:a}),{...ne}}function pP({tournamentRecord:t}){var n;if(!t)return{error:Re};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((n=t.events)==null?void 0:n.map(r=>{let a=r.eventId;return i[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:c}=XA({drawDefinition:r}),u=i[a],d=((r==null?void 0:r.structures)||[]).map(b=>{let{stage:D,stageSequence:w,structureId:S}=b,U=Kv[D],{inContextStructureMatchUps:C}=KD({drawDefinition:r,structure:b,event:u}),E=C==null?void 0:C.filter(({winningSide:j})=>j),P=E.filter(Boolean).length||0;s+=P,l+=C.length-s;let M=Math.max(E.filter(({roundNumber:j})=>j===1).map(({roundPosition:j})=>j)),{positionAssignments:N}=Bi({structure:b}),R=N==null?void 0:N.filter(({participantId:j})=>j);o+=(R==null?void 0:R.length)??0;let A=((N==null?void 0:N.length)??0)-((R==null?void 0:R.length)??0),{roundMatchUps:_,roundProfile:O,roundNumbers:x,maxMatchUpsCount:F}=Wa({matchUps:C}),$=O&&Object.keys(O).filter(j=>!O[j].inactiveRound).map(j=>parseInt(j)),V=O&&Object.keys(O).filter(j=>O[j].inactiveRound).map(j=>parseInt(j)),G=O&&Object.values(O).every(j=>j.inactiveRound);return{positionsAssignedCount:(R==null?void 0:R.length)??0,maxWinningSideFirstRoundPosition:M,unassignedPositionsCount:A,inactiveStructure:G,maxMatchUpsCount:F,inactiveRounds:V,roundMatchUps:_,activeRounds:$,roundNumbers:x,roundProfile:O,structureId:S,stageSequence:w,orderNumber:U,stage:D}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),h=d.filter(({inactiveStructure:b})=>!b).length,{links:f}=v0({structureId:p.structureId,drawDefinition:r}),m=wt(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;o&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),m&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};e.drawAnalysis[y]=I}),{...ne,drawsAnalysis:e}}function fne({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var o;if(!e)return{error:Re};if(!i)return{error:et};let r=[],{drawsAnalysis:a}=pP({tournamentRecord:e});if(a.canBePruned.includes(n)){let s=a.matchPlay.includes(n),l=a.drawAnalysis[n],{structures:[c]}=fd({stageSequence:1,drawDefinition:i,stage:it}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);r=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=r.map(Pr),h=d.map(Pr).filter(f=>!p.includes(f));if(s){let f=r.filter(({roundNumber:I})=>!u.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),m=f.map(Pr),g=p.filter(I=>!m.includes(I));h.push(...g);let v=f.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(f.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(o=c==null?void 0:c.positionAssignments)==null?void 0:o.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));c.positionAssignments=I}else c.positionAssignments=[];c.matchUps=f,r=f}Bp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),Xi({drawDefinition:i})}return{...ne,matchUps:r}}function mne({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!e)return{error:et};if(!n)return{error:Xw};if(!r)return{error:gs};if(s){let l=ys({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:o});if(l.error)return l}else{if(a)return{error:gA};{let l=uu({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:o});if(l.error)return l}}return{...ne}}function gne(t){var l,c,u,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,n=t.structureId??((c=(l=i==null?void 0:i.structures)==null?void 0:l.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>e.includes(m))}))==null?void 0:c.structureId)??((d=(u=i==null?void 0:i.structures)==null?void 0:u[0])==null?void 0:d.structureId);if(!n)return{error:bn};let r=(p=i.structures)==null?void 0:p.find(h=>h.structureId===n);if(!r)return{error:bn};let a=r==null?void 0:r.matchUps,o=a==null?void 0:a.find(h=>!!h.roundPosition);if(r.structures||o||r.finishingPosition===Oy)return{error:Ey};let s=a.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Pr);return e=e.filter(h=>!s.includes(h)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:a,matchUpIds:e,structureId:n,structure:r}}function vne(t){let e=gi(t,[{[Lc]:!0},{[GT]:{[wD]:!1,roundNumbers:!1},[sd]:ve,[bf]:No}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=gne(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!r)return!1;if(Vr({score:y})){if(!I&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map(Pr),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map(Pr)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:I})=>!m.includes(I)),Bp({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=Ft(c.matchUps.map(jo("roundNumber"))),y=ADe(v);if(y.length){y.reverse();for(let I of y)c.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,oi({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(h.length){c.positionAssignments=Ft(c.matchUps.flatMap(w=>(w.sides??[]).map(S=>S.participantId)).filter(Boolean)).map(w=>({participantId:w}));let I=(c==null?void 0:c.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:b}=Ti({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),D=_G({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:b,event:s});D.error&&console.log(D)}Xi({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!m.length&&p.length?{error:vA}:{...ne,deletedMatchUpsCount:[...m,...g].length}}function yne({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:Re};if(!i)return{error:et};if(!r)return ae({result:{error:ut},info:"roundNumber required"});let o=Ut({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:Ey}:Go({structure:s})?L1e({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...ne})}function L1e({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(r==null?void 0:r.matchUps)??[],s=[],l=[],c=!1;if(o.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(ar).includes(n)){let u=o.filter(d=>{let p=d.roundNumber===n&&(!gr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Pr))),!p});l.length&&(Bp({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,oi({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...ne}}function a_(t){var p,h,f,m,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:n,matchUps:r,event:a}=t;if(typeof n!="object")return{error:et};let o=t==null?void 0:t.structureId;if(!o&&((p=n.structures)==null?void 0:p.length)===1&&(o=(f=(h=n.structures)==null?void 0:h[0])==null?void 0:f.structureId),typeof o!="string")return{error:gs};if(!Js(r))return{error:ve,info:gd("matchUps")};let s=(m=n.structures)==null?void 0:m.find(y=>y.structureId===o);if(!s)return{error:bn};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===Oy)return{error:Ey};let c=((v=(g=Br({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Pr))??[],u=r.map(Pr);if(za(c,u))return{error:ree,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...r);let d=r.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(Wh({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...r],eventId:a==null?void 0:a.eventId,drawDefinition:n}),Xi({drawDefinition:n,structureIds:[o]})),{...ne}}function Ine({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var h;if(!e)return{error:et};if(!n)return{error:gs};if(!i)return{error:Xw};let{structure:o}=Ut({drawDefinition:e,structureId:n});if(!o)return{error:bn};let s=o;o.structures&&o.structureType===Qa&&(s=(h=o.structures)==null?void 0:h.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,c=l==null?void 0:l.find(f=>f.drawPosition===i);c&&ci({element:c,extension:{name:$b,value:r}});let u=((a==null?void 0:a.eventType)===Ki||e.matchUpType===Ki||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(o==null?void 0:o.tieFormat)))&&{matchUpTypes:[Ki]},{matchUps:d}=Ti({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:a}),p=(o==null?void 0:o.matchUpFormat)??e.matchUpFormat;return _G({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:a}),Xi({drawDefinition:e,structureIds:[n]}),{...ne}}var bne={};Gt(bne,{addGoesTo:()=>Lm,allPlayoffPositionsFilled:()=>UG,checkValidEntries:()=>c_,findDrawDefinition:()=>jG,getAssignedParticipantIds:()=>yg,getAvailableMatchUpsCount:()=>o_,getAvailablePlayoffProfiles:()=>rP,getDrawDefinitionTimeItem:()=>aG,getDrawParticipantRepresentativeIds:()=>BG,getDrawTypeCoercion:()=>hP,getEligibleVoluntaryConsolationParticipants:()=>$G,getMatchUpsMap:()=>ca,getParticipantIdFinishingPositions:()=>VG,getPositionAssignments:()=>oU,getPositionsPlayedOff:()=>S0,getSeedingThresholds:()=>yG,getSeedsCount:()=>fP,getStructureSeedAssignments:()=>zs,getTeamLineUp:()=>xm,getValidGroupSizes:()=>QD,isAdHoc:()=>Go,isCompletedStructure:()=>Yh,isValidForQualifying:()=>XG,positionActions:()=>ZG});function $G({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var O,x,F,$,V;if(!s)return{error:et};let f=[it,Rn];i&&f.push(mt);let m=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&h?((O=Hp({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:o,inContext:!0,event:h}))==null?void 0:O.matchUps)??[]:((x=no({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:x.matchUps)??[],y=Ly({stage:kr,drawDefinition:s}).map(({participantId:G})=>G),I={},b={},D={},w={};r||(r=Vp({policyTypes:[e$],tournamentRecord:o,drawDefinition:s,event:h}).policyDefinitions);let S=r==null?void 0:r[e$];t=t.length&&t||(S==null?void 0:S.excludedMatchUpStatuses)||[],e=e??(S==null?void 0:S.includeEventParticipants),d=d??(S==null?void 0:S.allEntries),n=n??(S==null?void 0:S.finishingRoundLimit),a=a??(S==null?void 0:S.roundNumberLimit),l=l??(S==null?void 0:S.matchUpsLimit),c===void 0&&(c=(S==null?void 0:S.requirePlay)!==void 0?S.requirePlay:!0),u===void 0&&(u=(S==null?void 0:S.requireLoss)!==void 0?S.requireLoss:!0),p=p??(S==null?void 0:S.winsLimit);for(let G of v){if(c&&G.winningSide&&![1,2].includes(G.winningSide)&&G.matchUpStatus!==Qn||G.finishingRound&&n&&G.finishingRound>=n||G.finishingRound&&a&&G.finishingRound<=a)continue;let j=(F=G.sides)==null?void 0:F.find(({sideNumber:H})=>G.winningSide&&H===3-G.winningSide),z=($=G.sides)==null?void 0:$.find(({sideNumber:H})=>G.winningSide&&H===G.winningSide);if((V=G.sides)==null||V.forEach(H=>{var q;let K=(q=H==null?void 0:H.participant)==null?void 0:q.participantId;K&&(D[K]=H.participant,G.matchUpStatus===Qn&&!c&&(b[K]=H.participant,I[K]||(I[K]=0),(!G.matchUpStatus||!t.includes(G.matchUpStatus))&&(I[K]+=1)))}),j==null?void 0:j.participant){let H=j.participant.participantId;b[H]=j.participant,I[H]||(I[H]=0),G.matchUpStatus&&!t.includes(G.matchUpStatus)&&(I[H]+=1)}if(z!=null&&z.participant){let H=z.participant.participantId;w[H]||(w[H]=0),w[H]+=1,I[H]||(I[H]=0),G.matchUpStatus&&!t.includes(G.matchUpStatus)&&(I[H]+=1)}}let U=(o==null?void 0:o.participants)&&!c&&!u&&d,C=U?((e&&h?h.entries:s.entries)??[]).filter(G=>![vp,Vl].includes(G.entryStatus)).map(({participantId:G})=>G):[],E=Object.keys(b),P=U?((o==null?void 0:o.participants)??[]).filter(({participantId:G})=>C.includes(G)):u&&Object.values(b)||Object.values(D),M=G=>!u||E.includes(G),N=G=>!c||(I[G]||0)>=0,R=G=>!p||(w[G]||0)<=p,A=G=>!l||I[G]<=l,_=G=>!y.includes(G);return{eligibleParticipants:P.filter(G=>M(G.participantId)&&N(G.participantId)&&R(G.participantId)&&A(G.participantId)&&_(G.participantId)).map(G=>{var j;return{...G,individualParticipants:(j=G.individualParticipantIds)==null?void 0:j.map(z=>{var H;return(H=o==null?void 0:o.participants)==null?void 0:H.find(K=>K.participantId===z)})}}),losingParticipantIds:E,...ne}}function o_(t){var f,m,g,v,y,I,b,D;let e=gi(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:n}=t,r=t.structureId??(((f=i.structures)==null?void 0:f.length)===1&&((g=(m=i.structures)==null?void 0:m[0])==null?void 0:g.structureId));if(typeof r!="string")return{error:gs};let a=(v=i.structures)==null?void 0:v.find(w=>w.structureId===r);if(!a)return{error:bn};let o,s=(y=a.matchUps??[])==null?void 0:y.reduce((w,S)=>(S.roundPosition&&(o=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(a.structures||o||a.finishingPosition===Oy)return{error:Ey};let l=((I=i==null?void 0:i.entries)==null?void 0:I.filter(w=>{let S=w.entryStatus;return jl.includes(S)}))??[],c=Math.floor((l==null?void 0:l.length)/2)||1,u=n??s??1,d=((D=(b=a.matchUps)==null?void 0:b.filter(w=>w.roundNumber===u))==null?void 0:D.length)??0,p=c-d,h=p>0?p:0;return{...ne,availableMatchUpsCount:h,lastRoundNumber:s,roundMatchUpsCount:c}}function BG({drawDefinition:t}){var i;let e=Vt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function F1e({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:et};let n=sr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=at(n.matchUps,!1,!0),a=Ft(r.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function VG({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:et};let{participantIds:n,participantIdMatchUps:r}=F1e({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(o=>{let s=r[o].filter(d=>[Wn,bi].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===o).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function Pf({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:Re};if(!n)return{error:xc};if(!e&&t){if(typeof i!="string"&&(i=cne({tournamentRecords:t,drawId:n}),!i))return{error:Rb};if(e=t[i],!e)return{error:Re}}let r=e&&so({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...ne}:ae({result:{error:$o},stack:"findDrawDefinition"})}function jG(t){let{drawDefinition:e,error:i}=Pf(t);return i?{error:i}:{drawDefinition:at(e)}}function m$({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=v0({drawDefinition:i,structureId:n})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=Ut({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}var $1e="qualifierDrawPositionAssignment",B1e="withdrawParticipantAtDrawPosition",V1e="alternateDrawPositionAssignment",j1e="luckyLoserDrawPositionAssignment",fK="removeDrawPositionAssignment",G1e="swapDrawPositionAssignments",H1e="modifyPairAssignment",z1e="modifyParticipantOtherName",mK="assignDrawPosition",W1e="removeSeededParticipant",q1e="assignDrawPositionBye",K1e="modifySeedAssignment",wne="addPenalty",GG="MODIFY_PAIR",s_="QUALIFIER",HG="ALTERNATE",zG="WITHDRAW",Xv="ASSIGN",g$="REMOVE",WG="LUCKY",uT="REMOVE_SEED",qG="SWAP",aU="NICKNAME",Iv="SEED_VALUE",Jv="PENALTY",sR="BYE",Ky={MODIFY_PAIR_ASSIGNMENT:GG,QUALIFYING_PARTICIPANT:s_,ALTERNATE_PARTICIPANT:HG,WITHDRAW_PARTICIPANT:zG,ASSIGN_PARTICIPANT:Xv,LUCKY_PARTICIPANT:WG,REMOVE_ASSIGNMENT:g$,SWAP_PARTICIPANTS:qG,ADD_NICKNAME:aU,REMOVE_SEED:uT,ADD_PENALTY:Jv,ASSIGN_BYE:sR,SEED_VALUE:Iv};function Y1e({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var s;let o=((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:l})=>[Vl,dg].includes(l)).map(({participantId:l})=>l))||[];if(o.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>o.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:ht({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:H1e,availableIndividualParticipantIds:o,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:GG},!1,!1,!0)}}return{}}function $m(t){var h,f;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:n,relevantLink:r}=t;if((r==null?void 0:r.linkCondition)===pd&&((h=i==null?void 0:i.matchUp)==null?void 0:h.matchUpStatus)===bi)return!1;let{targetMatchUps:{loserMatchUp:a,winnerMatchUp:o},targetLinks:s}=i,l=[fi,Pi].includes(a==null?void 0:a.matchUpStatus),c=((f=o==null?void 0:o.drawPositions)==null?void 0:f.filter(Boolean).length)||0;if(a!=null&&a.winningSide&&!l||o!=null&&o.winningSide&&c===2&&(!o.feedRound||![Pi,fi].includes(o==null?void 0:o.matchUpStatus)))return!0;let u=a&&qa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),d=o&&qa({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),p=u&&$m({relevantLink:s==null?void 0:s.loserTargetLink,targetData:u,inContextDrawMatchUps:e,drawDefinition:n});return!!(d&&$m({targetData:d,inContextDrawMatchUps:e,drawDefinition:n})||p)}var Sne={[dp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[mt,it],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[aU,Jv,s_,Iv],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},q1="positionAction",v$="matchUpAction";function Tne({actionType:t=q1,appliedPolicies:e,drawDefinition:i,structure:n}){var d,p;let r=t===q1&&dp||t===v$&&_r,a=t===q1&&Sne||t===v$&&iie,o=r&&((e==null?void 0:e[r])||(a==null?void 0:a[r])),s=((p=(d=i.links)==null?void 0:d.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:p.map(({target:h})=>h.feedProfile))??[],{enabledStructures:l,disabledStructures:c}=o||{},u=c==null?void 0:c.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:o}}function gK({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Une({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:n,stageSequence:r,structureType:a}=i||{},o=((l=(s=e.links)==null?void 0:s.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(n),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(r),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>o.includes(y));return m&&g&&v&&c&&f})}}function Io({action:t,policyActions:e}){var n;let i=!(e!=null&&e.enabledActions)||((n=e==null?void 0:e.disabledActions)==null?void 0:n.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var Dne="replaceTieMatchUpParticipantId",Pne="assignTieMatchUpParticipantId",y$="removeTieMatchUpParticipantId",vK="assignMatchUpSideParticipant",Z1e="removeMatchUpSideParticipant",Cne="substituteParticipant",I$="REMOVE_SUBSTITUTION",Ene="REPLACE_PARTICIPANT",KG="REMOVE_PARTICIPANT",b$="setMatchUpStatus",w$="SUBSTITUTION",Mne="SCHEDULE",X1e="PENALTY",S$="REFEREE",Rne="STATUS",T$="START",Nne="SCORE",U$="END",YG={REPLACE_TEAM_POSITION_METHOD:Dne,ASSIGN_TEAM_POSITION_METHOD:Pne,REMOVE_TEAM_POSITION_METHOD:y$,REPLACE_PARTICIPANT:Ene,SUBSTITUTION_METHOD:Cne,REMOVE_SUBSTITUTION:I$,REMOVE_PARTICIPANT:KG,SCHEDULE_METHOD:b$,SUBSTITUTION:w$,SCHEDULE:Mne,PENALTY:X1e,REFEREE:S$,STATUS:Rne,SCORE:Nne,START:T$,END:U$};function J1e({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var R,A,_,O,x,F,$,V,G,j,z,H,K,q,Y;let h=[],f=(R=r.sides)==null?void 0:R.find(Z=>Z.participant),m=r.gender===Lo&&r.sideNumber&&((A=r.sides)==null?void 0:A.filter(Z=>Z.particiapntId).length)===1&&((O=(_=f==null?void 0:f.participant)==null?void 0:_.person)==null?void 0:O.sex),g=r.matchUpType,v=(o??((x=n==null?void 0:n.participants)==null?void 0:x.enforceGender))!==!1?r.gender:void 0,y=($=(F=r.sides)==null?void 0:F.flatMap(Z=>{var Q;return((Q=Z.participant)==null?void 0:Q.individualParticipants)||Z.participant}).filter(Boolean))==null?void 0:$.map(qt),I=(V=r.sides)==null?void 0:V.filter(Z=>!l||Z.sideNumber===l).flatMap(Z=>{var Q;return((Q=Z.participant)==null?void 0:Q.individualParticipants)||Z.participant}).filter(Boolean),b=I==null?void 0:I.map(qt),D=(j=(G=e==null?void 0:e.find(Z=>Z.matchUpId===r.matchUpTieId))==null?void 0:G.sides)==null?void 0:j.map(Z=>{var Q;return(Q=Z.participant)==null?void 0:Q.individualParticipants.filter(({participantId:ie,person:ue})=>!(b!=null&&b.includes(ie))&&(!v||v===cu||ue.sex===v||v===Lo&&!m||m&&ue.sex!==m))}),w=l?D==null?void 0:D[l-1]:D==null?void 0:D.map((Z,Q)=>({participants:Z,sideNumber:Q+1})),S=l?(z=D==null?void 0:D[l-1])==null?void 0:z.map(qt):D==null?void 0:D.map((Z,Q)=>({participants:Z==null?void 0:Z.map(qt),sideNumber:Q+1})),U=l&&(An(gv)(g)&&!(b!=null&&b.length)||An(Am)(g)&&((b==null?void 0:b.length)??0)<2)||!l&&(An(gv)(g)&&((b==null?void 0:b.length)??0)<2||An(Am)(g)&&((b==null?void 0:b.length)??0)<4),C=S==null?void 0:S.filter(Z=>!(y!=null&&y.includes(Z))),E=w==null?void 0:w.filter(({participantId:Z})=>C.includes(Z));if(U&&(C!=null&&C.length)&&h.push({availableParticipantIds:C,method:Pne,availableParticipants:E,type:Xv,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),b!=null&&b.length&&(!Vr(u)||(H=p==null?void 0:p.substitutions)!=null&&H.length)&&h.push({method:y$,type:KG,existingParticipantIds:b,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),E!=null&&E.length&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&h.push({availableParticipantIds:C,method:Dne,availableParticipants:E,type:Ene,existingParticipantIds:b,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),Io({policyActions:a,action:I$})&&((K=p==null?void 0:p.substitutions)==null?void 0:K.length)){let Z=((q=p.participant)==null?void 0:q.participantType)===Kt&&[p.participantId]||((Y=p.participant)==null?void 0:Y.participantType)===kt&&p.participant.individualParticipantIds||[],Q=p.substitutions.map(ie=>ie.participantId).filter(ie=>Z.includes(ie));(!s||Q.includes(s))&&h.push({method:y$,type:I$,substitutedParticipantIds:Q,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let P=t==null?void 0:t[_r],M=P==null?void 0:P.substituteWithoutScore,N=P==null?void 0:P.substituteAfterCompleted;if(Io({policyActions:a,action:w$})&&i.length===2&&(!l&&(b!=null&&b.length)||l&&(p!=null&&p.participant))&&(M||Vr(u))&&(N||u.matchUpStatus&&!gr.includes(u.matchUpStatus))&&(I!=null&&I.length)&&w.length){let Z=I.map(qt);h.push({info:"list of team players available for substitution",method:Cne,availableParticipantIds:S,existingParticipantIds:Z,availableParticipants:w,existingParticipants:I,type:w$,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return h}function Q1e({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var S,U,C,E,P;if(i.includes(s))return{};let h=(S=l.find(M=>M.type===Xv))==null?void 0:S.availableParticipantIds,f=(U=a==null?void 0:a[dp])==null?void 0:U.otherFlightEntries,m=(C=a==null?void 0:a[dp])==null?void 0:C.restrictQualifyingAlternates,g=(o.entries??[]).filter(({entryStage:M})=>!m||(u.stage===mt?M===mt:M!==mt)).sort((M,N)=>(M.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:M})=>M).filter(Boolean),{allPositionedParticipantIds:v}=tte({drawDefinition:o}),y=n.map(M=>M.participantId).filter(Boolean),I=g.filter(M=>u.stage&&[mt,it,Rn].includes(u.stage)?!(v!=null&&v.includes(M)):!y.includes(M)),b=((p==null?void 0:p.entries)??[]).filter(M=>M.entryStatus===wl&&Ane({restrictQualifyingAlternates:m,structure:u,entry:M})&&(u.stage&&[mt,it,Rn].includes(u.stage)?!(v!=null&&v.includes(M.participantId)):!y.includes(M.participantId))).sort((M,N)=>(M.entryPosition??1/0)-(N.entryPosition??1/0)).map(M=>M.participantId),D=Ft(I.concat(b));if(f){let M=(P=(E=p?Bn({event:p}).flightProfile:void 0)==null?void 0:E.flights)==null?void 0:P.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(R=>R.participantId&&![vp,Vl,dg].includes(R.entryStatus)&&!g.includes(R.participantId)).map(({participantId:R})=>R)).flat().filter(Boolean);M!=null&&M.length&&D.push(...M)}h!=null&&h.length&&(D=D.filter(M=>!h.includes(M)));let w=r?t==null?void 0:t.filter(M=>D.includes(M.participantId)):void 0;return w==null||w.forEach(M=>{let N=(o.entries??[]).find(R=>R.participantId===M.participantId);M.entryPosition=N==null?void 0:N.entryPosition}),w==null||w.sort((M,N)=>(M.entryPosition||1/0)-(N.entryPosition||1/0)),D.length?{validAlternatesAction:ht({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:V1e,availableAlternatesParticipantIds:D,type:HG,availableAlternates:w})}:{}}function Ane({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===mt&&!t||i.entryStage===it&&n===ra)return!0}function eMe({eventEntries:t,structure:e}){let i=r=>r.entryStatus===wl&&Ane({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(qt)}function tMe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var w,S,U,C,E;let p=[],h=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:P})=>P===c.roundNumber),f=((w=r==null?void 0:r.entries)==null?void 0:w.filter(({entryStatus:P})=>P&&pg.includes(P)).map(qt))??[],m=h.map(P=>(P.sides??[]).flatMap(qt)).flat().filter(Boolean),g=f.filter(P=>!i.includes(P)&&(!t||!m.includes(P))),v=e==null?void 0:e.filter(P=>g==null?void 0:g.includes(P.participantId)).map(P=>at(P,void 0,!0));v==null||v.forEach(P=>{let M=(r.entries??[]).find(N=>N.participantId===P.participantId);P.entryPosition=M==null?void 0:M.entryPosition}),g.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:vK,type:Xv,availableParticipantIds:g,participantsAvailable:v});let y=(d==null?void 0:d.entries)??[],I=eMe({eventEntries:y,structure:l}),b=Ft(f.concat(I));if(n){let P=(U=(S=d?Bn({event:d}):void 0)==null?void 0:S.flights)==null?void 0:U.filter(M=>M.drawId!==u).flatMap(M=>M.drawEntries.filter(N=>N.participantId&&![vp,Vl,dg].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);P!=null&&P.length&&b.push(...P)}b=b.filter(P=>!i.includes(P)&&!g.includes(P)&&(!t||!m.includes(P)));let D=e==null?void 0:e.filter(P=>b.includes(P.participantId)).map(P=>at(P,void 0,!0));return D==null||D.forEach(P=>{let M=(r.entries??[]).find(N=>N.participantId===P.participantId);P.entryPosition=M==null?void 0:M.entryPosition}),D==null||D.sort((P,M)=>(P.entryPosition||1/0)-(M.entryPosition||1/0)),b.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:b,participantsAvailable:D,method:vK,type:wl}),!Vr(c)&&o&&((E=(C=c.sides)==null?void 0:C.find(P=>P.sideNumber===o))!=null&&E.participantId)&&p.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:Z1e,type:KG}),p}function l_(t){var Z,Q,ie,ue,J,te,se,ee,ce;if(!t)return{error:ve};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:n=!0,policyDefinitions:r,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&Ga(t.tournamentId)&&((Z=t.tournamentRecords)==null?void 0:Z[t.tournamentId]));if(!c)return{error:Re};if(!l||!Ga(l))return{error:la};if(s&&![1,2].includes(s))return ae({result:{error:ve},context:{sideNumber:s}});if(!e){let fe=(Br({tournamentRecord:c}).matchUps??[]).find(he=>he.matchUpId===l);i=((c==null?void 0:c.events)??[]).find(he=>he.eventId===(fe==null?void 0:fe.eventId));let ge=((i==null?void 0:i.drawDefinitions)??[]).find(he=>he.drawId===(fe==null?void 0:fe.drawId));ge&&(e=ge)}if(!e)return{error:et};let u=xn({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:h}=nn({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:ya};let f=Ei({tournamentRecord:c,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,r??{});let m=(Q=f==null?void 0:f[dp])==null?void 0:Q.otherFlightEntries,g=(f==null?void 0:f[_r])??b0[_r],{enabledStructures:v}=Tne({actionType:v$,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=Une({enabledStructures:v,drawDefinition:e,structure:h}),I=t.matchUpsMap??ca({drawDefinition:e}),b=t.inContextDrawMatchUps??sr({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:I,event:i}).matchUps,D=b==null?void 0:b.find(fe=>fe.matchUpId===l),w=s&&((ie=D==null?void 0:D.sides)==null?void 0:ie.find(fe=>fe.sideNumber===s)),S=((ue=D==null?void 0:D.sides)==null?void 0:ue.map(fe=>{var ge;return fe.participantId||((ge=fe.participant)==null?void 0:ge.participantid)}).filter(Boolean))??[],{assignedPositions:U,allPositionsAssigned:C}=Er({structure:h}),{structureId:E}=h??{},P=[];if(!E)return{validActions:P};let M=Go({structure:h}),N=p.collectionId;if(M&&!N){let fe=tMe({restrictAdHocRoundParticipants:n,tournamentParticipants:u,matchUpParticipantIds:S,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:s,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});P.push(...fe)}let R=Yh({drawDefinition:e,structure:h}),A=U==null?void 0:U.filter(fe=>fe.participantId).map(fe=>fe.drawPosition),_=U==null?void 0:U.filter(fe=>fe.bye).map(fe=>fe.drawPosition),O=p.matchUpStatus===bi||!N&&((J=p.drawPositions)==null?void 0:J.reduce((fe,ge)=>(_==null?void 0:_.includes(ge))||fe,!1));if(O)return{validActions:P,isByeMatchUp:O};Io({policyActions:y,action:S$})&&P.push({type:S$,payload:{matchUpId:l}});let x=!qD({matchUpStatus:p.matchUpStatus}),F=(te=f==null?void 0:f.scoring)==null?void 0:te.structures,$=(h==null?void 0:h.stage)&&(F==null?void 0:F.stage)&&(F==null?void 0:F.stage[h.stage]),V=(h==null?void 0:h.stageSequence)&&($==null?void 0:$.stageSequence)&&$.stageSequence[h.stageSequence],G=!((se=f==null?void 0:f.scoring)!=null&&se.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned||V!=null&&V.requireAllPositionsAssigned)||C,j=p.sides&&p.sides.filter(fe=>fe==null?void 0:fe.participantId).length===2,z=p.matchUpStatus&&[Qn,hr].includes(p.matchUpStatus),H=qa({inContextDrawMatchUps:b,drawDefinition:e,matchUpId:l}),K=$m({inContextDrawMatchUps:b,drawDefinition:e,targetData:H}),q=(((ee=D==null?void 0:D.drawPositions)==null?void 0:ee.length)===2&&D.drawPositions.every(fe=>A==null?void 0:A.includes(fe))&&((ce=D==null?void 0:D.sides)==null?void 0:ce.length)===2&&D.sides.every(({participantId:fe})=>fe)||j)&&!(z&&K),Y={method:wne,type:Jv,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(x&&P.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:b$,type:Mne}),Io({policyActions:y,action:Jv})&&(w!=null&&w.participant||!s&&(S!=null&&S.length))&&P.push(Y),x&&q&&P.push({type:Rne}),G&&q){let{matchUpId:fe,matchUpFormat:ge}=p,he={drawId:d,matchUpId:fe,matchUpFormat:ge,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};P.push({info:"set outcome and winningSide",method:b$,type:Nne,payload:he}),Io({policyActions:y,action:T$})&&P.push({type:T$}),Io({policyActions:y,action:U$})&&P.push({type:U$})}if(N&&D){let fe=J1e({specifiedPolicyDefinitions:r,inContextDrawMatchUps:b,matchUpParticipantIds:S,matchUpActionsPolicy:g,inContextMatchUp:D,policyActions:y,enforceGender:a,participantId:o,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:w});P.push(...fe)}return{structureIsComplete:R,validActions:P,isDoubleExit:z,...ne}}function iMe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var v,y,I,b,D,w,S;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=((v=o.links)==null?void 0:v.reduce((U,C)=>{var M,N;let E=(M=C.source)==null?void 0:M.structureId,P=(N=C.target)==null?void 0:N.structureId;return U.sourceStructureIds.includes(E)||U.sourceStructureIds.push(E),U.targetStructureIds.includes(P)||U.targetStructureIds.push(P),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},f=[],m=((y=o.links)==null?void 0:y.filter(U=>{var C;return((C=U.target)==null?void 0:C.structureId)===c.structureId}))??[];for(let U of m){let C=(I=U==null?void 0:U.source)==null?void 0:I.structureId,{structure:E}=Ut({structureId:C,drawDefinition:o}),P=(E==null?void 0:E.finishingPosition)===Oy&&((p==null?void 0:p.length)!==1||(h==null?void 0:h.length)!==1),M={};if(P){let{matchUps:A}=Ti({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:_}=Zv({drawPosition:s,matchUps:A}),O=(w=(D=(b=o.links)==null?void 0:b.find(x=>{var F;return((F=x.target)==null?void 0:F.structureId)===(c==null?void 0:c.structureId)&&x.target.roundNumber===_}))==null?void 0:D.source)==null?void 0:w.roundNumber;M.roundNumbers=[O]}let{completedMatchUps:N}=zA({structureId:C,inContext:!0,matchUpFilters:M,drawDefinition:o}),R=a.map(A=>A.participantId).filter(Boolean);(S=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==Tr||A===Tr)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(qt).filter(A=>A&&!R.includes(A)))==null||S.forEach(A=>{f.includes(A)||f.push(A)})}let g=t==null?void 0:t.filter(U=>f==null?void 0:f.includes(U.participantId));return g==null||g.forEach(U=>{let C=(o.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=C==null?void 0:C.entryPosition}),f!=null&&f.length?{validLuckyLosersAction:{type:WG,method:j1e,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function nMe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var D,w,S;let{drawId:m}=c,g=[],v,y,I=[],b=(w=(D=l==null?void 0:l[hl])==null?void 0:D.validSeedPositions)==null?void 0:w.ignore;if(b||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:I}=mie({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),I!=null&&I.length||(I=o.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:q1e,type:sR}),a&&b){let U=o.map(N=>N.participantId).filter(Boolean),C={structureIds:t},{completedMatchUps:E}=y0({inContext:!0,matchUpFilters:C,drawDefinition:c}),P=Ft((S=(E??[]).filter(({matchUpType:N})=>(f==null?void 0:f.eventType)!==Tr||N===Tr))==null?void 0:S.map(({sides:N})=>N==null?void 0:N.map(qt)).flat().filter(N=>N&&!U.includes(N))),M=s?r==null?void 0:r.filter(N=>P==null?void 0:P.includes(N.participantId)).map(N=>at(N,void 0,!0)):void 0;return M==null||M.forEach(N=>{let R=(c.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=R==null?void 0:R.entryPosition}),M!=null&&M.length&&g.push(ht({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:mK,type:Xv,availableParticipantIds:P,participantsAvailable:M})),{validAssignmentActions:g}}if(I.includes(p)||d){let U;if(y!=null&&y.length){let E=y.filter(P=>v==null?void 0:v.includes(P.participantId));E.sort(rMe),U=E.map(P=>P.participantId)}else U=e;let C=s?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>at(E,void 0,!0)):void 0;C!=null&&C.length&&g.push(ht({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:mK,type:Xv,availableParticipantIds:U,participantsAvailable:C}))}return{validAssignmentActions:g}}function rMe(t,e){return t.bye||Wb(t.seedValue)<Wb(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function aMe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var D,w,S;let c=[],u=[],d=[],p=[],h=i.map(U=>U.participantId).filter(Boolean),f=r==null?void 0:r[dp],m=!(f!=null&&f.disableRoundRestrictions)&&t[o],g=f==null?void 0:f.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=m$({targetRoundNumber:m,linkType:mp,drawDefinition:a,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:I,relevantLinks:b}=m$({targetRoundNumber:m,linkType:fp,drawDefinition:a,structureId:s})||{};I!=null&&I.length&&p.push(...I);for(let U of y){let C=(D=a.structures)==null?void 0:D.find(P=>P.structureId===U.source.structureId);if((C==null?void 0:C.stage)!==mt)continue;let E=Yh({structureId:U.source.structureId,drawDefinition:a});if(!g||E){let P=C.qualifyingRoundNumber,{matchUps:M}=Ti({matchUpFilters:{roundNumbers:[P],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:C});for(let N of M){let R=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===bi&&((w=N.sides)==null?void 0:w.find(({participantId:_})=>_));if(R||A){let{participantId:_,participant:O}=R||A||{};_&&!h.includes(_)&&(O&&n&&c.push(O),u.push(_))}}}}for(let U of b){let C=(S=a.structures)==null?void 0:S.find(P=>P.structureId===U.source.structureId);if((C==null?void 0:C.stage)!==mt)continue;let E=Yh({structureId:U.source.structureId,drawDefinition:a});if(!g||E){let{positionAssignments:P}=Bi({structure:C}),M=(P==null?void 0:P.map(N=>{var _;let R=N.participantId,A=(_=Vt({element:N,name:Hh}).extension)==null?void 0:_.value;return A?{participantId:R,groupOrder:A==null?void 0:A.groupOrder}:{}}).filter(({groupOrder:N,participantId:R})=>N===1&&!h.includes(R)).map(({participantId:N})=>N))??[];if(M&&u.push(...M),n){let N=e.filter(({participantId:R})=>M.includes(R));c.push(...N)}}}return u.length&&d.push(ht({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:$1e,type:s_,qualifyingParticipantIds:u,qualifyingParticipants:n?c:void 0})),{validAssignmentActions:d,sourceStructureIds:p}}function oMe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==u&&!(c&&s.includes(E))),v=(a==null?void 0:a.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:I}=Ti({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),b=I.filter(({drawPositions:E})=>za(E,y)),D=Object.assign({},...b.map(E=>{var P;return(P=E.sides)==null?void 0:P.filter(({sourceDrawPositionRange:M})=>M).map(({drawPosition:M,sourceDrawPositionRange:N})=>({[M]:N}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...S.map(E=>({[E.participantId]:E}))),C=v.map(E=>{let P=U==null?void 0:U[E.participantId],M=D[E.drawPosition];return ht({...E,participant:o?at(P,!1,!0):void 0,sourceDrawPositionRange:M})});return C.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:G1e,type:qG,availableAssignments:C}}:{}}function ZG(t){var q;let e=gi(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:n=!0,provisionalPositioning:r,tournamentRecord:a,drawDefinition:o,drawPosition:s,event:l}=t,c=t.tournamentParticipants??(a&&xn({withIndividualParticipants:!0,tournamentRecord:a}).participants)??[],u=Ut({structureId:t.structureId,drawDefinition:o});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:bn};let p=d.structureId;if(u=KD({drawDefinition:o,structureId:p}),s===void 0&&!u.isAdHoc)return{error:Xw};if(u.isAdHoc)return l_(t);if(u.error)return u;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=u,v=Ei({tournamentRecord:a,drawDefinition:o,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:I,actionsDisabled:b}=Tne({actionType:q1,appliedPolicies:v,drawDefinition:o,structure:d}),D=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:w}=m$({finishingPosition:p0,targetRoundNumber:1,linkType:fp,drawDefinition:o,structureId:p})||{},S;w!=null&&w.length&&(S=w.reduce((Y,Z)=>Yh({structureId:Z,drawDefinition:o})&&Y,!0));let U=w.length,C=w.length&&!S,{policyActions:E}=Une({enabledStructures:I,drawDefinition:o,structure:d}),P=![mt,it].includes(d.stage)||d.stageSequence!==1,{drawId:M}=o,N=[],{assignedPositions:R,positionAssignments:A}=Er({structure:d}),_=R==null?void 0:R.find(Y=>Y.drawPosition===s);if(!((q=A==null?void 0:A.map(Y=>Y.drawPosition))!=null&&q.includes(s)))return{error:Zw};let{stage:O,stageSequence:x}=d,F=[O];O===ra&&F.push(it),O===it&&F.push(ra);let $=Ly({entryStatuses:pg,provisionalPositioning:r,drawDefinition:o,stageSequence:x,structureId:p,stages:F}),V=yg({drawDefinition:o,stages:F}).assignedParticipantIds??[],G=$.filter(Y=>!V.includes(Y.participantId)).map(Y=>Y.participantId),j=g.includes(s),z=m.includes(s);if(b)return{hasPositionAssigned:!!_,info:"Actions Disabled for structure",isActiveDrawPosition:z,isDrawPosition:!0,validActions:[],isByePosition:j};if(Io({policyActions:E,action:Xv})&&!z&&A&&!C&&(!_||j)){let{validAssignmentActions:Y}=nMe({positionSourceStructureIds:w,unassignedParticipantIds:G,possiblyDisablingAction:P,isWinRatioFedStructure:U,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:o,isByePosition:j,drawPosition:s,structureId:p,event:l});Y==null||Y.forEach(Z=>N.push(Z))}if(Io({policyActions:E,action:s_})){let{validAssignmentActions:Y}=aMe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:o,drawPosition:s,structureId:p,drawId:M});Y==null||Y.forEach(Z=>N.push(Z))}let{participantId:H}=_||{},K=H&&c.find(Y=>Y.participantId===H);if(_){Io({policyActions:E,action:g$})&&!z&&(N.push({type:g$,method:fK,payload:{drawId:M,structureId:p,drawPosition:s},willDisableLinks:P}),j||N.push({type:zG,method:B1e,payload:{drawId:M,structureId:p,drawPosition:s},willDisableLinks:P}),Io({policyActions:E,action:sR})&&!j&&N.push({type:sR,method:fK,payload:{drawId:M,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:P}));let Y=d.stage===mt||d.stage===it&&d.stageSequence===1;if(!j&&gK({activePositionOverrides:D,activeDrawPositions:m,action:Iv})&&Io({policyActions:E,action:Iv})&&iR({drawDefinition:o,structureId:p,drawPosition:s})&&Y){let{seedAssignments:Z}=zs({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Q,seedValue:ie}=(Z==null?void 0:Z.find(ue=>ue.participantId===H))??{};N.push({type:Iv,method:K1e,participant:K,seedNumber:Q,payload:{drawId:M,structureId:p,participantId:H,seedValue:ie}})}if(!j&&gK({activePositionOverrides:D,activeDrawPositions:m,action:uT})&&Io({policyActions:E,action:uT})&&iR({drawDefinition:o,structureId:p,drawPosition:s})&&Y){let{seedAssignments:Z}=zs({returnAllProxies:!0,drawDefinition:o,structure:d}),{seedNumber:Q}=(Z==null?void 0:Z.find(ie=>ie.participantId===H))??{};N.push({method:W1e,type:uT,participant:K,seedNumber:Q,payload:{participantId:H,structureId:p,drawId:M}})}if(!j&&H){if(Io({policyActions:E,action:Jv})){let Z={type:Jv,method:wne,participant:K,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:M}};N.push(Z)}if(Io({policyActions:E,action:aU})){let Z={type:aU,method:z1e,participant:K,payload:{participantId:H,otherName:void 0}};N.push(Z)}}if(Io({policyActions:E,action:qG})){let{validSwapAction:Z}=oMe({possiblyDisablingAction:P,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:o,isByePosition:j,drawPosition:s,structureId:p,structure:d,drawId:M});Z&&N.push(Z)}}if(Io({policyActions:E,action:HG})&&!C){let{validAlternatesAction:Y}=Q1e({possiblyDisablingAction:P,tournamentParticipants:c,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:v,drawDefinition:o,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:M,event:l});Y&&N.push(Y)}if(Io({policyActions:E,action:WG})&&!C&&A){let{validLuckyLosersAction:Y}=iMe({sourceStructuresComplete:S,possiblyDisablingAction:P,isWinRatioFedStructure:U,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:A,drawDefinition:o,drawPosition:s,structureId:p,structure:d,drawId:M});Y&&N.push(Y)}if((K==null?void 0:K.participantType)===kt&&Io({policyActions:E,action:GG})){let{validModifyAssignedPairAction:Y}=Y1e({tournamentParticipants:c,returnParticipants:n,drawPosition:s,participant:K,drawId:M,event:l});Y&&N.push(Y)}return{hasPositionAssigned:!!_,isActiveDrawPosition:z,isDrawPosition:!0,isByePosition:j,validActions:N,...ne}}function hP({policyDefinitions:t,appliedPolicies:e,drawType:i}){var a,o;let n=(a=t==null?void 0:t[zM])==null?void 0:a.drawTypeCoercion,r=(o=e==null?void 0:e[zM])==null?void 0:o.drawTypeCoercion;return(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??!0}function oU({tournamentRecord:t,drawDefinition:e,stage:i=it,structureId:n,structure:r}){var s;if(!t)return{error:Re};if(!r&&!e)return{error:et};if(!r&&!n&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:gs};let{error:a,positionAssignments:o}=Bi({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:o??[],structureId:r==null?void 0:r.structureId,error:a}}function XG({structureId:t,drawDefinition:e}){if(!e)return{error:et};if(!Ga(t))return{error:ve};let i=v0({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!kn([Nm,gl,NA,Rm],n).length;return{...ne,valid:r}}function _ne({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:ve};let i=n0(t);return i?{drawSize:i}:ae({result:{error:ve},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function fP(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=Vp({tournamentRecord:a,drawDefinition:o,event:s});if(f.error)return ae({result:f,stack:l});i=f.policyDefinitions}let u=Mt(c);if(c&&!u)return ae({result:{error:ve},context:{participantsCount:c},stack:l});if(r&&!u)return ae({result:{error:kQ},stack:l});if(isNaN(n))if(c)({drawSize:n}=_ne({participantsCount:c}));else return ae({result:{error:fD},stack:l});let d=r&&c||n;if(d&&d>n)return{error:_V};let p=i==null?void 0:i[hl];if(!p)return{error:TQ};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:lQ}}function c_({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var v;if((!o||!r)&&i&&({participants:o,participantMap:r}=xn({tournamentRecord:i})),!o)return{error:vD};if(!Array.isArray(o))return{error:ve};if(!s)return{error:Ai};let l=(e==null?void 0:e[_r])??(n==null?void 0:n[_r])??b0[_r],c=(a??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:u,gender:d}=s,p=u===Kh,h=u===Ws&&ji||p&&kt||Kt,f=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),m=Object.keys(f),g=o.filter(y=>m.includes(y.participantId)).filter(y=>{let I=sMe({participant:y,participantType:h,eventType:u,entryStatusMap:f}),b=lMe({genderEnforced:c,participantMap:r,eventGender:d,participant:y,isDoubles:p,mismatch:I});return I||!b});if(g.length){let y=g.map(I=>I.participantId);return{error:vQ,invalidParticipantIds:y}}return{...ne,valid:!0}}function sMe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[Kh,Ws].includes(i)&&t.participantType===Kt&&(sm(r)||r===vp);return t.participantType!==e&&!a}function lMe(t){var d,p,h;let{participant:e,participantMap:i,eventGender:n,mismatch:r,isDoubles:a,genderEnforced:o}=t,s=!r&&a&&Ft(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(f=>{var m,g,v;return(v=(g=(m=i==null?void 0:i[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!n||!(s!=null&&s.length)||cu===n||[Hi,fn].includes(n)&&s[0]===n||Lo===n&&(s.length==1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),c=(h=e==null?void 0:e.person)==null?void 0:h.sex,u=!(e!=null&&e.person)||!n||[cu,Lo].includes(n)||[Hi,fn].includes(n)&&c===n;return!o||l&&u}function kne({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var m;let a="generateQualifyingSTructures",o=[],s=[],l=[],c=(g,v)=>g.stageSequence-v.stageSequence,u=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,h,f=1;for(let g of t.sort(u)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,I=0,b,D,w;for(let S of(v||[]).sort(c)){let U=HV(S.drawSize||S.participantsCount),{qualifyingRoundNumber:C,structureOptions:E,matchUpFormat:P,structureName:M,structureId:N,drawType:R}=S,A=S.matchUpType,_=S.qualifyingPositions||cMe({drawSize:U,qualifyingRoundNumber:C}),O,x,F;if(!Mt(U))return ae({result:{error:fD},stack:a});let $=t.length>1?`${f}-`:"",V=v.length>1||$?y:"",G=M||($||V?`${ta(mt)} ${$}${V}`:ta(mt));if(R===Nl){let{structures:j,groupCount:z,maxRoundNumber:H}=JD({structureName:S.structureName||G,structureId:N||(r==null?void 0:r.pop()),stage:mt,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:f,drawSize:U,idPrefix:i,isMock:n,uuids:r});I=z,O=H,x=j[0],h=[1]}else({drawSize:U,matchUps:F,roundLimit:O}=du({qualifyingRoundNumber:C,qualifyingPositions:_,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),x=As({structureName:S.structureName||G,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:O,stage:mt,matchUpFormat:P,stageSequence:y,matchUpType:A,roundLimit:O,matchUps:F}),f&&ci({extension:{name:Tu,value:f},element:x}),I=((m=F==null?void 0:F.filter(j=>j.roundNumber===O))==null?void 0:m.length)||0;if(y>1){let{link:j}=nP({sourceStructureId:D,sourceRoundNumber:b,targetStructureId:x.structureId,finishingPositions:w===fp?[1]:void 0,linkType:w});l.push(j),d+=(U||0)-I}else d+=U||0;w=R===Nl?fp:mp,D=x.structureId,b=O,s.push(x),y+=1}p+=I,o.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:D,finishingPositions:h,roundTarget:f,linkType:w}),f+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:o,structures:s,...ne,links:l}}function cMe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function One(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=wt(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&Zc||t.drawType||Zc,a=ete.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=Zc;else if(n<4&&i)return{...ae({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:sA},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function uMe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:ta(it),...t,stage:it},{structures:a,groupCount:o,groupSize:s}=JD(r);if(o<1)return{error:JQ};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:ta(Rn)}],[c]=a,{structures:u,links:d}=Kie({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return u&&a.push(...u),{...ne,structures:a,links:d}}function dMe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=n.map((c,u)=>{let d=n.indexOf(c)%2?gl:Nm,p=1+u;return{linkType:dd,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:mp,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:gl,roundNumber:r,structureId:t.structureId}},l=[{linkType:mp,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:gl,roundNumber:1,structureId:i.structureId}},{linkType:dd,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:gl,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function pMe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=Zh({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=Oh({structureName:t||ta(it),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:it,matchUpType:e,matchUps:s});o.push(l);let c=n/2,{matchUps:u}=Zh({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=Oh({structureName:ta(Qee),matchUps:u,structureId:a==null?void 0:a.pop(),stage:ra,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=du({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=Oh({structureName:ta(Jee),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Rn,matchUpType:e});o.push(h);let f=dMe({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:o,links:f,...ne}}function hMe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!Mt(o)||o<2)return{matchUps:[],roundsCount:0};if(Pc(o))return du(t);let c=fMe(o),u=c.shift(),d=Ze(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=aR({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=Ze(1,v+1);n&&v===n&&(f=h-1);let I=y.map(b=>{let D=EG({roundPosition:b,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:h,matchUpId:D}});p.push(...I),h++}let m=h-1;return p=ND({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function fMe(t){let e=wt(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function xne(t){var h,f;let{playoffAttributes:e,stageSequence:i=1,stage:n=it,matchUpType:r,drawSize:a,uuids:o}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(o==null?void 0:o.pop()),c=t.appliedPolicies??Ei(t),u=((h=t.policyDefinitions)==null?void 0:h[Lb])||(c==null?void 0:c[Lb]);t.skipRounds=t.skipRounds||a<=4&&(u!=null&&u.feedFromMainFinal?0:1)||0;let d=t.structureName??((f=e==null?void 0:e["0"])==null?void 0:f.name)??ta(it),p=()=>{let{matchUps:m}=du(t);return{structures:[As({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...ne}};return{generators:{[Rl]:()=>({structures:[As({finishingPosition:p0,stageSequence:i,structureName:d,matchUps:[],matchUpType:r,structureId:l,stage:n})],links:[],...ne}),[cg]:()=>{let{matchUps:m}=hMe(t);return{structures:[As({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...ne}},[Zc]:()=>p(),[CD]:()=>pMe(t),[Bb]:()=>Ib({...t,roundOffsetLimit:3,playoffAttributes:e??Mj}),[Vb]:()=>Ib({...t,roundOffsetLimit:2,playoffAttributes:e??Rj}),[Rn]:()=>Ib(t),[d0]:()=>{let{matchUps:m}=Zh({drawSize:a,uuids:o,matchUpType:r});return{structures:[As({stageSequence:i,structureName:d,matchUpType:r,structureId:l,stage:it,matchUps:m})],links:[],...ne}},[ED]:()=>zie(t),[jb]:()=>Qg({...t,feedRounds:1,fmlc:!0}),[Xee]:()=>Qg({...t,feedRounds:1}),[Pj]:()=>Qg({...t,feedsFromFinal:1}),[Cj]:()=>Qg({...t,feedsFromFinal:2}),[Ej]:()=>Qg({...t,feedsFromFinal:3}),[MD]:()=>Qg(t),[AA]:()=>qie(t),[Nl]:()=>JD(t),[hd]:()=>uMe(t)}}}function JG(t){var G,j,z,H,K;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:n,staggeredEntry:r,drawDefinition:a,tieFormat:o,isMock:s,uuids:l}=t||{},c=wt(t.drawSize),u=t.drawTypeCoercion??hP({appliedPolicies:n,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=One({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:u,drawSize:c});if(p.error)return p;let h=p.drawType,f=[],m=[],g=(t==null?void 0:t.matchUpType)??Tn,v=(G=a==null?void 0:a.structures)==null?void 0:G.filter(({stage:q})=>q===mt);v&&f.push(...v);let y=v==null?void 0:v.map(({structureId:q})=>q),I=(j=a==null?void 0:a.structures)==null?void 0:j.find(({stage:q,stageSequence:Y})=>q===it&&Y===1),b=(z=a==null?void 0:a.links)==null?void 0:z.filter(q=>q.target.structureId===(I==null?void 0:I.structureId)&&(y==null?void 0:y.includes(q.source.structureId))),D=(q,Y)=>{var Z;if(q.linkType===fp&&(Y!=null&&Y.structures)){let Q=q.source.finishingPositions||[];return Y.structures.length*Q.length}else if(q.linkType===mp&&((Z=Y==null?void 0:Y.matchUps)!=null&&Z.length)){let Q=q.source.roundNumber;return Y.matchUps.filter(({roundNumber:ie})=>ie===Q).length}},w=v==null?void 0:v.map(q=>{var J,te,se;let Y=b==null?void 0:b.find(ee=>ee.target.structureId===q.structureId),Z=((te=(J=Bi({structure:q}))==null?void 0:J.positionAssignments)==null?void 0:te.length)??0;if(!Y)return Z;let Q=Y==null?void 0:Y.source.structureId,ie=(se=a.structures)==null?void 0:se.find(ee=>ee.structureId===Q),ue=D(Y,ie)||0;return Z-ue}).filter(Boolean).reduce((q,Y)=>q+Y,0),S=b==null?void 0:b.map(q=>{let Y=q.source.structureId,Z=v==null?void 0:v.find(Q=>Q.structureId===Y);return D(q,Z)}).filter(Boolean).reduce((q,Y)=>q+Y,0),U=!!(I&&!((H=I==null?void 0:I.matchUps)!=null&&H.length));if(v!=null&&v.length&&!U)return{error:XF};let C=!(v!=null&&v.length)&&t.qualifyingProfiles,E=(C==null?void 0:C.length)&&kne({idPrefix:t.idPrefix,qualifyingProfiles:C,appliedPolicies:n,isMock:s,uuids:l});if(E!=null&&E.error)return E;let{qualifyingDrawPositionsCount:P,qualifyingDetails:M,qualifiersCount:N}=E||{qualifyingDrawPositionsCount:w,qualifiersCount:S};P&&(E!=null&&E.structures&&f.push(...E.structures),E!=null&&E.links&&m.push(...E.links)),Object.assign(t,ht({drawSize:c,matchUpType:g,tieFormat:o}));let R=h!==Rl&&(!c||c<2||!r&&![d0,cg].includes(h)&&([hd,Nl].includes(h)&&c<3||![Nl,hd].includes(h)&&!Pc(c)));if(R&&!P)return ae({context:{drawSize:c,invalidDrawSize:R},result:{error:sA},stack:d});let{generators:A,error:_}=xne(t);if(_)return{error:_};let O=A[h];if(!O)return{error:yV};let x=O==null?void 0:O();if(x.error)return x;let{structures:F,links:$}=x;if(F!=null&&F.length){let q=F.find(({stage:Y,stageSequence:Z})=>Y===it&&Z===1);if(I&&q){if(U){let Y=q.structureId;if(q.structureId=I.structureId,$==null?void 0:$.length)for(let Z of $)Z.source.structureId===Y&&(Z.source.structureId=I.structureId),Z.target.structureId===Y&&(Z.target.structureId=I.structureId)}else if(!i)return{error:XF}}f.push(...F)}f.sort(xy),$!=null&&$.length&&m.push(...$);let V=x.structures.find(({stage:q,stageSequence:Y})=>q===it&&Y===1);for(let q of M||[]){let{finalQualifyingRoundNumber:Y,finalQualifyingStructureId:Z,roundTarget:Q,finishingPositions:ie,linkType:ue}=q,J=V&&((K=nP({targetStructureId:V.structureId,sourceStructureId:Z,sourceRoundNumber:Y,finishingPositions:ie,targetEntryRound:Q,linkType:ue}))==null?void 0:K.link);if(J!=null&&J.error)return J;J&&m.push(J)}return b&&m.push(...b),{...ne,qualifyingResult:{qualifyingDrawPositionsCount:P,qualifiersCount:N},structures:f,links:m}}function QG(t){var I,b;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:n}=t||{},r="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ae({result:{error:et},stack:r});let a=e?t.drawDefinition:at(t.drawDefinition,!1,!0),{tieFormat:o,matchUpType:s}=t;if(o){let D=Uo({tieFormat:o});if(D.error)return D}o=Xr(o??((I=Ca({drawDefinition:a}))==null?void 0:I.tieFormat)),s=s??(a.matchUpType||Tn),t.tieFormat=o,t.matchUpType=s;let l=tR({drawDefinition:a,stage:it});t.drawSize=t.drawSize??l,!l&&t.drawSize&&rR({drawSize:t.drawSize,drawDefinition:a,stageSequence:i,stage:it});let c=ca({drawDefinition:a}).drawMatchUps.map(Pr),u=JG(t);if(u.error)return ae({result:u,stack:r});let{structures:d,links:p,qualifyingResult:h}=u;a.structures=d,a.links=p;let f=Math.max(t.qualifiersCount??0,(h==null?void 0:h.qualifiersCount)||0);if(h!=null&&h.qualifyingDrawPositionsCount&&!tR({stage:mt,drawDefinition:a})){let D=rR({drawSize:h.qualifyingDrawPositionsCount,stage:mt,drawDefinition:a});if(D.error)return D}if(f){let D=$ie({qualifiersCount:f,drawDefinition:a,stage:it});if(D.error)return D}let m=t.drawSize??l;Object.assign(t,ht({drawSize:m,matchUpType:s,tieFormat:o}));let{matchUps:g,matchUpsMap:v}=sr({drawDefinition:a});o&&(g==null||g.forEach(D=>{if(!c.includes(D.matchUpId)){let{tieMatchUps:w}=aP({tieFormat:o,matchUp:D,isMock:n});Object.assign(D,{tieMatchUps:w,matchUpType:s})}}));let{inContextDrawMatchUps:y}=Lm({drawDefinition:a,matchUpsMap:v});return Xi({tournamentId:(b=t.tournamentRecord)==null?void 0:b.tournamentId,drawDefinition:a}),{inContextDrawMatchUps:y,drawDefinition:a,matchUpsMap:v,...ne,structures:d,matchUps:g,links:p}}function Kb(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:mr};let{participant:a,tournamentId:o}=vg({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...Yu({participant:a,scaleAttributes:i}),tournamentId:o}:{error:jn}}function Yb(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,o;if(!Fne({scaleItem:r}))return{error:ID};if(n&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===n),o)){let s=$ne({removePriorValues:e,participant:o,scaleItem:r});if(s.error)return s;a=!s.valueChanged;let{topics:l}=Xs();l.includes(aa)&&ei({topic:aa,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...ne,info:VV,existingValue:r==null?void 0:r.scaleValue}||o&&{...ne,newValue:r==null?void 0:r.scaleValue}||{error:jn}}function Lne(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:n,auditData:r,context:a}=t;if(!n)return{error:Re};if(!n.participants)return{error:vD};let o=0,s={},l=[];for(let p of e){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if(Fne({scaleItem:f}))Array.isArray(s[h])||(s[h]=[]),s[h].push(f);else return{error:ID}}n.participants.forEach(p=>{let{participantId:h}=p||{};Array.isArray(s[h])&&s[h].forEach(f=>{$ne({participant:p,scaleItem:f,removePriorValues:i}),l.push(p),o++})});let c=o?void 0:i0,{topics:u}=Xs();if(u.includes(aa)&&o&&ei({topic:aa,payload:{tournamentId:n.tournamentId,participants:l}}),a){let{eventId:p,drawId:h,...f}=a,m=((d=f.scaleAttributes)==null?void 0:d.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:Aj,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=so({tournamentRecord:n,eventId:p,drawId:h});h&&CG({drawDefinition:v,timeItem:g}),p&&qy({event:y,timeItem:g})}else Wy({tournamentRecord:n,timeItem:g})}}return r&&u.includes(Gb)&&ei({topic:Gb,payload:r}),ht({...ne,modificationsApplied:o,info:c})}function Fne({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function $ne({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Ry};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:ID};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=Yu({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[Gv,c,u,d].join("."),h=ht({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...ne,valueChanged:l,newValue:i.scaleValue}}var fm="ELO",Bne="NTRP",mMe="TRN",Vne="UTR",eH="WTN",jne={ELO:fm,NTRP:Bne,TRN:mMe,UTR:Vne,WTN:eH},gMe={[fm]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[Bne]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[Vne]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[eH]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},ns=gMe,vMe=t=>250/Math.pow(t+5,.4),yMe=()=>1;function IMe(t=3,e=2){let i=t/e;return isNaN(i)?ib.kDefault():i}var ib={nSpread:400,diffThreshold:.125,kCalc:vMe,kMultiplier:IMe,kDefault:yMe};function Gne(t){let{winnerRating:e,loserRating:i,ratingRange:n}=t,{ratings:r=ns,winnerCountables:a=1,loserCountables:o=0,ratingType:s=fm,maxCountables:l,countables:c}=t||{},u=r==null?void 0:r[s];if(!u)return{error:ut};n=u.range||n,e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=n[0]>n[1],p=u.decimalsCount||0,h=d?n.slice().reverse():n,f=(O,x)=>parseFloat(x)>=Math.min(...O)&&parseFloat(x)<=Math.max(...O);(!f(n,e)||!f(n,i))&&(f(n,e)||(e=u.defaultInitialization),f(n,i)||(i=u.defaultInitialization));let m=({value:O,sourceRange:x,targetRange:F})=>(O-x[0])*(F[1]-F[0])/(x[1]-x[0])+F[0],g=m({targetRange:ns[fm].range,sourceRange:h,value:d?n[0]-e:e}),v=m({targetRange:ns[fm].range,sourceRange:h,value:d?n[0]-i:i}),y=(O,x)=>1/(1+Math.pow(10,(x-O)/ib.nSpread)),I=y(g,v),b=y(v,g),D=ib.kCalc(a),w=ib.kCalc(o),S=ib.kMultiplier(l,c),U=g+S*D*(1-I),C=v+S*w*(0-b),E=m({sourceRange:ns[fm].range,value:U,targetRange:h}),P=m({sourceRange:ns[fm].range,value:C,targetRange:h}),M=d?n[0]-E:E,N=parseFloat(parseFloat(M).toFixed(p)),R=d?n[0]-P:P,A=parseFloat(parseFloat(R).toFixed(p)),_=Math.max(...n)?Math.abs(e-i)/Math.max(...n):0;return(E>P&&_>ib.diffThreshold||N<0||A<0)&&(N=e,A=i),{newWinnerRating:N,newLoserRating:A}}var bMe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function Hne(t){var p,h;let{removePriorValues:e=!0,tournamentRecord:i,ratingType:n=fm,considerGames:r,matchUpIds:a,asDynamic:o}=t;if(!i)return{error:Re};if(!Array.isArray(a))return{error:Md};if(typeof n!="string")return{error:ve,ratingType:n};if(!ns[n])return{error:ve};let s=ns[n],{accessor:l}=s,c={},u=t.matchUps??Br({matchUpFilters:{matchUpIds:a,matchUpStatuses:gr},tournamentRecord:i,inContext:!0}).matchUps??[];u.sort(Vy);for(let f of u){let{endDate:m,matchUpFormat:g,score:v,sides:y,winningSide:I}=f,b=f.matchUpType,D={eventType:b,scaleName:n,scaleType:wm},w=`${n}.${_ee}`,S={scaleName:w,eventType:b,scaleType:wm},U=Object.assign({},...(y??[]).map(x=>{let{sideNumber:F,participant:$}=x;return F&&{[F]:[$==null?void 0:$.participantId,...($==null?void 0:$.individualParticipantIds)??[]].filter(Boolean).flat()}})),C=o?w:n,E=Object.assign({},...Object.values(U).flat().map(x=>{let{scaleItem:F}=Kb({scaleAttributes:S,tournamentRecord:i,participantId:x}),{scaleItem:$}=Kb({tournamentRecord:i,scaleAttributes:D,participantId:x}),V=l?{[l]:void 0}:void 0;return x&&{[x]:F??$??{scaleName:C,eventType:b,scaleDate:m,scaleType:wm,scaleValue:V}}})),P=g?fo(g):{},M=(P==null?void 0:P.bestOf)||1,N=(P==null?void 0:P.setsTo)||1,R=r?M&N:M,A=(v==null?void 0:v.sets)&&bMe(v.sets)||I===1&&[1,0]||[0,1],_=I?U[I]:[],O=I?U[3-I]:[];for(let x of _){let F=(p=E[x])==null?void 0:p.scaleValue,$=typeof F=="object"?F[l]:F;for(let V of O){let G=(h=E[V])==null?void 0:h.scaleValue,j=typeof G=="object"?G[l]:G,z=I?A[I]:[0,0],H=I?A[3-I]:[0,0],{newWinnerRating:K,newLoserRating:q}=Gne({winnerCountables:z,loserCountables:H,maxCountables:R,winnerRating:$,loserRating:j,ratingType:n}),Y=l?{...F,[l]:K}:K,Z=l?{...G,[l]:q}:q;E[x].scaleValue=Y,E[V].scaleValue=Z;let Q=Yb({participantId:x,removePriorValues:e,tournamentRecord:i,scaleItem:{...E[x],scaleName:C}});if(Q.error||(Q=Yb({participantId:V,removePriorValues:e,tournamentRecord:i,scaleItem:{...E[V],scaleName:C}}),Q.error))return Q}}Object.assign(c,E)}let d=u.map(({matchUpId:f})=>f);return{...ne,modifiedScaleValues:c,processedMatchUpIds:d}}function u_(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:n,newRound:r,isMock:a,event:o}=t;if(typeof i!="object")return{error:et};let{participantIdPairings:s,matchUpsCount:l}=t,c=o_(t);if(c.error)return ae({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)r?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return ae({result:{error:ve,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!Mt(l)||e&&!Array.isArray(e)||!s&&!l)return{error:ve,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:ve,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(u||0))return{error:ve,info:"roundNumber error"};let h=n??(r&&(u??0)+1||u||1);s=s??Ze(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=i.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${h}-${v}`},m=s==null?void 0:s.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,S)=>ht({sideNumber:S+1,participantId:w})),D=e[y]??f(y)??Oi();return{roundNumber:h,matchUpStatus:On,matchUpId:D,sides:b}});if(m!=null&&m.length){let v=(g=Ca({drawDefinition:i,event:o}))==null?void 0:g.tieFormat;v&&m.forEach(y=>{let{tieMatchUps:I}=aP({tieFormat:v,matchUp:y,isMock:a});Object.assign(y,{tieMatchUps:I,matchUpType:Ki})})}return{roundNumber:h,matchUpsCount:(m==null?void 0:m.length)??0,matchUps:m,...ne}}function wMe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=yK({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),c=[oL(l)];s.push(l);let u=l.value,d=l,p=0,h=0,f=o.length,m;do f-=1,m=o.length*i[o[0]].length;while(m>t&&f>5);let g=[];o.forEach(y=>{i[y].slice(0,f).forEach(I=>{h+=1;let b=bv(y,I.opponent);if(!g.includes(b)){let D=yK({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!c.includes(oL(D))){c.push(oL(D)),s.push(D);let{maxDelta:w,value:S}=D;w<d.maxDelta&&(d=D),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-u)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=Oo(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function oL(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function yK({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=bv(p,h),m=i[f];s.push({participantIds:d,value:m}),l+=i[f]}),Fr(t,a).map(d=>La(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>o.includes(f)||h,!1)){o.push(...p);let h=d.value;l+=h,s.push({participantIds:p,value:h})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=bv(h,f),g=n[m];return g>d?g:d},0),u=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=bv(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function bv(t,e){return[t,e].sort(WA).join("|")}function zne({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let o=bv(a,r);i.includes(o)||i.push(o)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function SMe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(qt);if(n.length===2){let[r,a]=n,o=bv(r,a);e.includes(o)||e.push(o)}}return{encounters:e}}function TMe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(o=>n(r,o));i[r]=a.sort((o,s)=>o.value-s.value)}function n(r,a){let o=bv(r,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var UMe=0;function DMe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var o;let a=((o=ns[n])==null?void 0:o.defaultInitialization)??UMe;return r.split("|").map(s=>{var l;if(i===Al){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||a):a*2}else return e[s]||a})}function PMe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s,scaleName:l,salted:c}){n.forEach(v=>{let y=DMe({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),I=typeof c=="number"&&c||.5,b=c&&(Math.round(Math.random())?I:I*-1)||0,D=Math.abs(y[0]-y[1])+b,w=Math.abs(y[0]-y[1]);a[v]=w,o[v]||(o[v]=0),o[v]+=D?Math.pow(D,2):0});let u=n.map(v=>({pairing:v,value:o[v]})).sort((v,y)=>v.value-y.value),{pairingValues:d}=TMe({possiblePairings:i,valueObjects:o}),{candidate:p,candidatesCount:h,deltaCandidate:f,iterations:m}=wMe({valueSortedPairings:u,maxIterations:r,pairingValues:d,deltaObjects:a,valueObjects:o}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:h,deltaCandidate:f,iterations:m,candidate:p}}var CMe=100,EMe=100,MMe=4e3;function tH({encounterValue:t=CMe,sameTeamValue:e=EMe,maxIterations:i=MMe,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:l,drawDefinition:c,adHocRatings:u,salted:d=.5,roundNumber:p,structureId:h,matchUpIds:f,eventType:m,structure:g,scaleName:v,idPrefix:y,isMock:I,event:b}){var V,G;if(!c)return{error:et};if(!g&&!h)return{error:bn};if(g||(g=Ut({drawDefinition:c,structureId:h}).structure),!Zi(g))return{error:mf};if(!(l!=null&&l.length))return{error:gf};let D=[...a??[],...(g==null?void 0:g.matchUps)??[]],{encounters:w}=SMe({matchUps:D}),S=(o==null?void 0:o.participants)??[];if(s){let j=Ft(g!=null&&g.matchUps?g.matchUps.map(({roundNumber:H})=>H):[]),z=Math.max(...j,0);if(z){let H=(V=g==null?void 0:g.matchUps)==null?void 0:V.filter(({roundNumber:K})=>K===z).map(({matchUpId:K})=>K);Hne({ratingType:v||((G=b==null?void 0:b.category)==null?void 0:G.ratingType),tournamentRecord:o,asDynamic:!0,matchUpIds:H})}}let{valueObjects:U}=RMe({tournamentParticipants:S,encounterValue:t,sameTeamValue:e,encounters:w}),{uniquePairings:C,possiblePairings:E,deltaObjects:P}=zne({participantIds:l}),M={tournamentParticipants:S,possiblePairings:E,drawDefinition:c,participantIds:l,uniquePairings:C,maxIterations:i,adHocRatings:u,deltaObjects:P,valueObjects:U,eventType:m,scaleName:v,structure:g,salted:d},{candidatesCount:N,participantIdPairings:R,iterations:A,candidate:_}=PMe(M);if(!N)return{error:fA};let O,x;if(n){let j=u_({structureId:g==null?void 0:g.structureId,ignoreLastRoundNumber:r,participantIdPairings:R,newRound:!0,drawDefinition:c,roundNumber:p,matchUpIds:f,idPrefix:y,isMock:I,event:b});if(j.error)return j;O=j.roundNumber,x=j.matchUps}let{maxDelta:F,maxDiff:$}=_;return{roundNumber:O,participantIdPairings:R,candidatesCount:N,...ne,iterations:A,matchUps:x,maxDelta:F,maxDiff:$}}function RMe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let o of t)r[o]||(r[o]=0),r[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===ji);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=zne({participantIds:s});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function Wne(t){var P,M,N,R;let{drawType:e=Zc,attachConsolation:i=!0,applyPositioning:n=!0,tournamentRecord:r,staggeredEntry:a,automated:o,placeByes:s,isMock:l,event:c}=t,u=t==null?void 0:t.drawDefinition;if(!u)return{error:et};let d=kr,p=Ly({stageSequence:1,drawDefinition:u,stage:d}),h=[Nl,CD,hd].includes(e)?p.length:n0(p.length);if(!a&&e===d0&&p.length<2||e===Nl&&p.length<3)return{error:sA};let{tieFormat:f,matchUpType:m}=t;if(f){let A=Uo({tieFormat:f});if(A.error)return A}f=Xr(f??((P=Ca({drawDefinition:u}))==null?void 0:P.tieFormat)),m=m??u.matchUpType??Tn;let{structures:g}=fd({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:yQ};if((N=(M=g==null?void 0:g[0])==null?void 0:M.matchUps)!=null&&N.length)return{error:GV};let v=(R=g==null?void 0:g[0])==null?void 0:R.structureId;Object.assign(t,ht({structureName:t.structureName??ta(kr),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=xne(t);if(y.error)return y;let I=y.generators[e];if(!I)return{error:yV};let b=I==null?void 0:I();if(b.error)return b;let{structures:D,links:w}=b,S=D.map(A=>Ti({structure:A}).matchUps).flat();f&&S.forEach(A=>{let{tieMatchUps:_}=aP({matchUp:A,tieFormat:f,isMock:l});Object.assign(A,{tieMatchUps:_,matchUpType:m})}),(!n||!i)&&(u=at(u,!1,!0)),u.links||(u.links=[]),w.length&&u.links.push(...w);let U=D.map(({structureId:A})=>A);u.structures||(u.structures=[]);let C=u.structures.map(({structureId:A})=>A);u.structures=u.structures.map(A=>U.includes(A.structureId)?D.find(({structureId:_})=>_===A.structureId):A);let E=D.filter(({structureId:A})=>!C.includes(A));return E.length&&u.structures.push(...E),o&&tP({seedingProfile:t.seedingProfile,applyPositioning:n,tournamentRecord:r,drawDefinition:u,structureId:v,placeByes:s,drawSize:h,event:c}),i&&Xi({drawDefinition:u}),{links:w,structures:D,...ne}}var wv={};Gt(wv,{addGame:()=>ere,addPoint:()=>Qne,addSet:()=>ire,addShot:()=>tre,analyzeSet:()=>lU,calculateHistoryScore:()=>Zne,checkScoreHasValue:()=>Vr,checkSetIsComplete:()=>h_,clearHistory:()=>Jne,generate:()=>qne,generateScoreString:()=>Xu,generateTieMatchUpScore:()=>uP,getSetComplement:()=>cH,getTiebreakComplement:()=>v_,helpers:()=>ore,isValidMatchUpFormat:()=>Ho,keyValueScore:()=>Nre,mutate:()=>Yne,parseMatchUpFormat:()=>fo,parseScoreString:()=>dR,query:()=>xre,redo:()=>nre,reverseScore:()=>Kne,setServingSide:()=>Xne,stringifyMatchUpFormat:()=>t_,tidyScore:()=>Ore,umo:()=>are,undo:()=>rre,validateScore:()=>lH,validateTieFormat:()=>Uo});var qne={};Gt(qne,{generateScoreString:()=>Xu,generateTieMatchUpScore:()=>uP,reverseScore:()=>Kne});function Xu(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:ut,info:"missing sets"};let c=a&&fo(a),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},h=n||!(!e||!s||s===1),f=i?NMe({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(AMe).map(g).filter(Boolean).join(" "))||"";if(!f)return m;if(s===2)return`${f} ${m}`;return`${m} ${f}`;function g(v){let y=u&&v.setNumber===u&&d?d:p,I=O=>En(O==null?void 0:O.side1Score)||En(O==null?void 0:O.side2Score),b=O=>En(O==null?void 0:O.side1TiebreakScore)||En(O==null?void 0:O.side2TiebreakScore),D=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:S,side1TiebreakScore:U,side2TiebreakScore:C}=v,E=U||(En(U)||o?0:""),P=C||(En(C)||o?0:"");if(D)return`[${(h?[P,E]:[E,P]).join("-")}]`;let M=Math.min(E,P),N=M?`(${M})`:"",R=w||(En(w)||o?0:""),A=S||(En(S)||o?0:""),_=h?`${[A,R].join("-")}${N}`:`${[R,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function NMe({matchUpStatus:t}){let e={[Ra]:"RET",[Pi]:"WO",[hr]:"DF/DF",[Qn]:"WO/WO",[Tf]:"SUS",[cs]:"ABN",[fi]:"DEF",[u0]:"DR"};return t&&e[t]||""}function AMe(t,e){return t.setNumber-e.setNumber}function Kne(t){if(!(t!=null&&t.score))return{error:ut};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=a;return ht({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:u,side2Score:c,setNumber:d})}),n=Xu({sets:i}),r=Xu({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...ne}}var Yne={};Gt(Yne,{addGame:()=>ere,addPoint:()=>Qne,addSet:()=>ire,addShot:()=>tre,calculateHistoryScore:()=>Zne,clearHistory:()=>Jne,redo:()=>nre,setServingSide:()=>Xne,umo:()=>are,undo:()=>rre});function Ig({matchUp:t}){let{extension:e}=Vt({name:CA,element:t});if(!e)return{error:Ia};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...ne}}function Zne(t){var E,P;if(!t)return{error:ut};let{matchUp:e,updateScore:i}=t;if(!e)return{error:To};let n=((E=Ig({matchUp:e}))==null?void 0:E.history)||[];if(!Array.isArray(n))return{error:ve,info:"history is not an array"};let{matchUpFormat:r}=e;if(!r)return{error:PV};if(!Ho({matchUpFormat:r}))return{error:DV};let a=fo(r),{bestOf:o,finalSetFormat:s,setFormat:l}=a,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=M=>[1,2].includes(M),I=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),b=()=>({winningSide:void 0,points:[]}),D=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),w=D(),S=b(),U=I(),C=0;for(let M of n){C+=1,g=u.sets.length+1===o;let N=g&&s?s:l,{tiebreakAt:R,setTo:A,NoAD:_,tiebbreakFormat:O}=N,x=U.side1Score===R&&U.side1Score===U.side2Score,F=!!N.tiebreakSet,$=F?N.tiebreakSet:O,{tiebreakTo:V,NoAD:G}=$||{},j=()=>{p=void 0,h=[0,0],f=3-f,U.side1TiebreakScore=0,U.side2TiebreakScore=0,U.side1PointScore="",U.side2PointScore="",v=0},z=q=>{U.winningSide=q;let{s:Y,...Z}=U;u.sets.push(Z),w=D(),S=b(),U=I(),j()},H=q=>{S.winningSide=q;let{g:Y,...Z}=S;U.games.push(Z),w=D(),S=b(),j();let Q=`side${q}Score`;U[Q]+=1},K=q=>{w.winningSide=q;let{p:Y,...Z}=w;S.points.push(Z),w=D(),v=0;let Q=()=>h.reduce((ue,J)=>ue+J)%4/4>.5?f:3-f,ie=q-1;if(x||F){h[ie]+=1,p=Q(),U[`side${q}TiebreakScore`]=h[ie],U[`side${3-q}TiebreakScore`]=h[1-ie];let ue=G?1:2;if(h[ie]>=V&&h[ie]>=h[1-ie]+ue)return H(q),{gameCompleted:!0}}else if(h[1-ie]===4&&h[ie]===3?h[1-ie]-=1:h[ie]+=1,U.side1PointScore=c[h[0]],U.side2PointScore=c[h[1]],h[ie]===5||h[ie]===4&&h[1-ie]<3||_&&h[ie]===4)return H(q),{gameCompleted:!0}};if(y(M.srv)&&(f=M.srv),["p","s","g","o"].includes(M.u)&&d.push(M.u),M.shotOutcome&&(w.shots.push(M),M.shotType==="SERVE"&&["OUT","NET"].includes(M.shotOutcome)&&(v+=1),v===2)){let q=3-f;K(q)}if(y(M.p)||Mt(M.pointNumber)){let q=M.winningSide||M.p;if((P=K(q))!=null&&P.gameCompleted)continue}if(y(M.g)||Mt(M.gameNumber)){let q=M.winningSide||M.g;S.winningSide=q;let Y=`side${q}Score`,Z=`side${3-q}Score`;if(d.length&&(d.includes("p"),d=[]),H(q),U[Y]===A&&U[Y]-U[Z]>=(_?1:2)&&(z(q),g))break}if(y(M.s)||Mt(M.setNumber)){let q=M.winningSide||M.s;if(z(q),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return C!==n.length&&console.log({error:"Match completed with excess history"}),(U.side1Score||U.side2Score||U.games.length||U.side1TiebreakScore||U.side2TiebreakScore)&&u.sets.push(U),u.scoreStringSide1=Xu({...u,matchUpFormat:r}),u.scoreStringSide2=Xu({...u,matchUpFormat:r,reversed:!0}),f=p||f,i&&(e.score=u),{...ne,servingSide:f,score:u}}function bg({undoHistory:t,history:e,matchUp:i}){return ci({element:i,extension:{value:{history:e,undoHistory:t},name:CA}})}function Xne({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:RV};let{history:i=[]}=Ig({matchUp:t});return i.push({srv:e}),bg({matchUp:t,history:i})}function Jne({matchUp:t}){return bg({matchUp:t})}function Qne({matchUp:t,point:e}){if(!e||!t)return{error:ut};if(typeof e!="object")return{error:ve,context:{point:e}};let{history:i=[]}=Ig({matchUp:t});return i.push(e),bg({matchUp:t,history:i})}function ere({matchUp:t,game:e}){if(typeof e!="object")return{error:ve,context:{game:e}};let{history:i=[]}=Ig({matchUp:t});return i.push(e),bg({matchUp:t,history:i})}function tre({matchUp:t,shot:e}){if(typeof e!="object")return{error:ut};let{history:i=[]}=Ig({matchUp:t});return i.push(e),bg({matchUp:t,history:i})}function ire({matchUp:t,set:e}){if(typeof e!="object")return{error:ut};let{history:i=[]}=Ig({matchUp:t});return i.push(e),bg({matchUp:t,history:i})}function nre({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ig({matchUp:t});return i.length&&e.push(i.pop()),bg({matchUp:t,history:e,undoHistory:i})}function rre({matchUp:t}){let{history:e=[],undoHistory:i=[]}=Ig({matchUp:t});return i.push(e.pop()),bg({matchUp:t,history:e,undoHistory:i})}var are={},ore={};Gt(ore,{keyValueScore:()=>Nre,parseMatchUpFormat:()=>fo,stringifyMatchUpFormat:()=>t_,tidyScore:()=>Ore});var Sv=" ",D$="DEF",_Me="COMPLETED",sre="WO",kMe="WO/WO",lre="ABN",cre="SUS",ure="RET",dre="INT",pre=[ure,D$,sre,kMe,lre,cre,dre],P$="DEFAULTED",hre="WALKOVER",fre="ABANDONED",mre="SUSPENDED",gre="RETIRED",vre="INTERRUPTED",OMe=[gre,P$,hre],xMe="Enter Score",Qv="()",Bm="[]",iH=["up","left","shift+tab"],nH=["enter","down","tab","right"],lR="backspace",yre="r",Ire="s",bre="a",wre="d",Sre="w",Tre="i",d_=[yre,wre,Sre,bre,Ire,Tre],p_="space",sL=["[","("],cR=[...iH,...nH,p_,"]"],Ure="-",LMe="/",Tv=Ure,Ju=Ure,Dre=[LMe],FMe=0,$Me=["=","+","num_1","num_2","shift+=","shift+-"],Fu=["0","1","2","3","4","5","6","7","8","9"].concat(d_),Pre=Fu.map(t=>`shift+${t}`),rH=[Tv,lR].concat(cR,Dre),Cre=[Fu,Pre,rH].join(","),BMe=[Cre,iH,nH,$Me].join(",");[].concat(...Fu,...Fu,...rH,...Fu,...Fu,...Fu,...Fu,...Fu,...Fu);var aH={OUTCOMEKEYS:d_,SIDE1KEYS:Fu,SIDE2KEYS:Pre,MODIFIERS:rH,PROMPT:xMe,MOVEUP:iH,MOVEDOWN:nH,HOTKEYS:BMe};function FI({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Ere({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==Sv?Sv:"";return t+n+i}else return i+Sv+t}function Ere({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of pre){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Sv:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function C$({analysis:t,scoreString:e,sets:i,lowSide:n}){var m,g,v;let r,a;if(!e)return{scoreString:e,sets:i};let{scoreString:o,removed:s}=Ere({scoreString:e});if(e=o,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:h}=bb({brackets:Bm,scoreString:e}),f=jMe(e);if(f>=0){r=e.slice(0,f);let{isTiebreakEntry:y}=bb({brackets:Qv,scoreString:r}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=bb({brackets:Bm,scoreString:r}),D=r&&r[r.length-1].trim(),w=r&&!isNaN(D),S=t.isIncompleteSetScore;if(h&&b){let U=r.slice(I+1).split(Ju),C=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,P=[C,E];if(E){let M=n===1?1:0;P[M]=((P==null?void 0:P[1-M])||0)+(p?1:2),(P[M]||0)<d&&(P[M]=d),r=e.slice(0,I+1),r+=P.join(Ju)}else C!==void 0?(r=e.slice(0,I+1),r+=C):(r=e.slice(0,I),S=!0);l.side1TiebreakScore=P[0]||0,l.side2TiebreakScore=P[1]||0}if(r.length||(r=void 0),S){let U=(m=l.side1Score)==null?void 0:m.toString();if(U){let C=U==null?void 0:U.slice(0,U.length-1);l.side1Score=!isNaN(C)&&parseInt(C)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(a=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let U=(g=l.side2Score)==null?void 0:g.toString(),C=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);l.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=C==null?void 0:C.slice(0,C.length-1);l.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?l.side1Score?(a=i||[],a[i.length-1]=l):a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i||[],a[i.length-1]=l),a[a.length-1]&&Object.assign(a[a.length-1],{winningSide:void 0})}else y?(a=i||[],Object.assign(a[a.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!b?a=(i==null?void 0:i.slice(0,i.length-1))||[]:(a=i,a[i.length-1]=l),h||(a[a.length-1].side2Score=0,a[a.length-1].winningSide=void 0));return{scoreString:r,sets:a}}return{scoreString:e,sets:i}}function bb({brackets:t=Qv,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...Yc(i,r)),o=Math.max(...Yc(n,r));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function VMe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=Bm.split(""),a=t.split(""),o=Math.max(...Yc(n,a)),s=Math.max(...Yc(r,a)),l=Math.max(...Yc(Ju,a));return i&&o>s&&l>o}function jMe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function Mre(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function IK({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var l;let r=fo(t),{bestOf:a}=r,o=Math.ceil(a/2),s=((l=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:l.indexOf(o))+1||void 0;return OMe.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function h_({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var y;if(!a)return{error:ut,info:"missing set"};e=e||i&&fo(i);let o=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:s,side2Score:l}=a,{setTo:c,tiebreakAt:u}=o,d=f_({set:a}),p=Math.abs(s-l),h=s>=c||l>=c,f=n||s>=c&&l>=c||u&&u<c&&(s===u||l===u),m=t||f&&(d===1&&a.side1TiebreakScore>a.side2TiebreakScore||d===2&&a.side2TiebreakScore>a.side1TiebreakScore),g=!f&&o.NoAD||f||n&&((y=o.tiebreakFormat)!=null&&y.NoAD)?1:2,v=p>=g;return!!((h&&(v||f)||n)&&(!f||m))}function f_({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function oH({analysis:t,set:e}){let i=f_({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return h_({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function GMe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=wt(n);let{validSide2Score:o,requiresTiebreak:s}=HMe({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;let l=oH({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let c=Qv.split("")[0];e+=c}else t.isDecidingSet||(e+=Sv)}return{sets:i,scoreString:e,updated:r}}function HMe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e,l,c;return r&&r<a?s===r?l=i<=a:l=i<=r:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?c=s===a&&i===r||s===r&&i===a:c=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function Rre({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return e===yre?n?(o=!0,n=FI({scoreString:n,lowSide:t,outcome:ure}),r=t===2?1:2,a=gre):(o=!0,n=FI({scoreString:n,lowSide:t,outcome:D$}),r=t===2?1:2,a=P$):e===wre?(o=!0,n=FI({scoreString:n,lowSide:t,outcome:D$}),r=t===2?1:2,a=P$):e===Sre?(o=!0,i=[],n=sre,r=t===2?1:2,a=hre):e===Ire&&n?(o=!0,n=FI({scoreString:n,lowSide:t,outcome:cre}),a=mre,r=void 0):e===bre?(o=!0,n=FI({scoreString:n,lowSide:t,outcome:lre}),a=fre,r=void 0):e===Tre&&n&&(o=!0,n=FI({scoreString:n,lowSide:t,outcome:dre}),a=vre,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function zMe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==lR&&(e=[{setNumber:1}]);let d=e.length-1;if(d_.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":o.finalSetIsComplete||r?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:c}=Rre({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===lR){if({scoreString:n,sets:e,outcomeRemoved:u}=C$({analysis:o,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,c=!0}else if(o.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===p_){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===Tv&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&o.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=wt((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=wt(h),p=e[d].side1Score.toString(),c=!0}else{let h=wt((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=wt(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:c}}function WMe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var d;let o,s,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=Bm.split("");if(t.isMatchTiebreakEntry||(n+=u),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=bb({brackets:Bm,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(Ju);if((((d=h[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>wt(v)),m=i===1?1:0;f[m]=f[1-m]+(c?1:2),f[m]<l&&(f[m]=l);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(Ju),o=!0}else{let f=[h[0]||0,h[1]||0].map(g=>wt(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,o=!0}}else{let p=Mre({lowValue:wt(a||0),tiebreakTo:l,NoAD:c}),h=[wt(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(Ju),o=!0}return{info:s,scoreString:n,sets:r,updated:o}}function qMe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=Qv.split("")[0],d=c.join(Tv)+(s?u:Sv);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=oH({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return s?n+1:n+1===r?n+(o?1:2):r}}function KMe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var F,$,V;let a=(((F=r==null?void 0:r.filter(G=>G==null?void 0:G.winningSide))==null?void 0:F.length)||0)+(i?0:1),o=fo(t),s=a===(o==null?void 0:o.bestOf),l=s&&(o==null?void 0:o.finalSetFormat)||(o==null?void 0:o.setFormat)||{},c=l==null?void 0:l.timed,u=s&&r[(o==null?void 0:o.bestOf)-1],d=u==null?void 0:u.winningSide,{isTiebreakEntry:p}=bb({brackets:Qv,scoreString:e}),{isTiebreakEntry:h}=bb({brackets:Bm,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=($=e==null?void 0:e[e.length-1])==null?void 0:$.trim(),v=e&&!isNaN(g),y=!f&&g===Tv,I=p&&sL.includes(g),b=h&&sL.includes(g),D=h&&g===Ju,w=e==null?void 0:e.split(""),[S]=Bm.split(""),U=w&&Math.max(...Yc(S,w)),C=w&&Math.max(...Yc(Ju,w)),E=w&&C>U,P=(V=r[r.length-1])==null?void 0:V.winningSide,M=(r==null?void 0:r.length)&&!P,N=pre.find(G=>(e==null?void 0:e.indexOf(G))>=0),R=!isNaN(n),A=n===p_,_=cR.includes(n),O=e==null?void 0:e.split("").find(G=>sL.includes(G)),x=_&&h&&!b&&(D||!VMe({scoreString:e}));return{isTiebreakSetValue:m&&R,matchUpScoringFormat:o,setNumber:a,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:M,isSpace:A,isCloser:_,isTiebreakCloser:_&&O&&f&&v,isDecidingSet:s,isTiebreakSet:m,isTimedSet:c,isNumericEnding:v,isNumericValue:R,hasOpener:O,hasOutcome:N,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:P,isInvalidSetTiebreakValue:A&&f&&I,isInvalidMatchTiebreakValue:x,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:I,isIncompleteMatchTiebreak:b,isPartialMatchTiebreakValue:D}}function Nre(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!Cre.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=IK({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=h;let f=KMe({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(Dre.includes(i)&&(i=Tv),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&wt(i)===0&&(f.isTiebreakCloser=!0),cR.includes(i)&&f.hasOpener&&(i=""),cR.includes(i)&&(i=p_),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:o,winningSide:a}=zMe({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(d_.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:u}=Rre({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===lR)u=!0,{scoreString:n,sets:r}=C$({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Tv&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=C$({analysis:f,scoreString:n,sets:r,lowSide:e}),o=void 0);else if(i===Ju&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=Ju);else if([Tv,Ju].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=GMe({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?Qv:Bm,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:I}=f.setFormat,{tiebreakTo:b,NoAD:D}=I||{},w=f_({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),C=Mre({lowValue:U,tiebreakTo:b,NoAD:D});w===1?(y.side1TiebreakScore=C,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=C)}n=(n||"")+g,f.isDecidingSet||(n+=Sv);let S=oH({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=WMe({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=Qv.split(""),g=Math.max(...Yc(m,n.split(""))),v=n.slice(g+1),y=v&&wt(v)===FMe,I=wt(v?v+i:i),{tiebreakFormat:b}=f.setFormat,{tiebreakTo:D,NoAD:w}=b||{};!y&&v.length<2?w&&I>D-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=qMe({analysis:f,lowSide:e,scoreString:n,value:wt(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=IK({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=m,m&&(!o||[On,su].includes(o))?(o=_Me,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):n&&!a&&![mre,fre,vre].includes(o)&&(o=void 0),{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}var m_="\\d+-\\d+",sU="\\d+-\\d+\\(\\d+\\)",sH="\\[\\d+-\\d+\\]",YMe="\\d+-\\d+\\(\\d+-\\d+\\)",ZMe=new RegExp(`(${m_}),`,"g"),XMe=new RegExp(`(${sU}),`,"g"),JMe=[m_,sU,sH,YMe],QMe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],eRe=QMe.map(t=>{let e=t.split("").map(i=>JMe[i]).join(" ");return new RegExp(`^${e}$`)});function bK(t){return!t||eRe.some(e=>e.test(t))}function tRe(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return a[c]+=1,o=c,l;if(!u&&c&&o&&c!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(h=>h!==o);if(d.includes(c))a[o]||(o="");else return a[c]||(o=""),p}return l}).join("");return t!==s?s:t}function K1(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function iRe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function Zb(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function uR(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function wK(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function nRe(t){return t.startsWith("(")&&t.endsWith(")")}function rRe({score:t,applied:e}){t=tRe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),U=S.replace(/ /g,"");t=t.replace(w,`(${U})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,U)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(S);U&&U.forEach(C=>t=t.replace(C,C.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,h,f,m,g,v=()=>{g=Vo(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(nRe)?t=w.map(S=>{let U=S.slice(1,S.length-1);return U.length>2?U:S}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let U of t.split("").reverse())U===")"&&(S?w.push("("):S+=1),U==="("&&(S-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let U of t.split(""))U==="("&&(S?w+=")":S+=1),U===")"&&(S-=1),w+=U;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let D=w=>{let S=w.indexOf("("),U=w.indexOf(")");return S>=0&&U>=0&&S<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);D(w)&&(t=w,v())}return{score:t,applied:e}}function g_(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Yc("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function aRe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[ZMe,XMe].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(g_).join(" "),{score:t,applied:e}}function oRe({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(K1),a=0,o="";for(let p of r){let h=Yc(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[f.join(" "),[m,p].join("")].join(" ");o+=I,a=h+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,D=[I,b].sort().reverse().join("-"),w=[f.join(" "),[D,p].join("")].join(" ");o+=w,a=h+1}}}}if(r.length&&o.length){let p=n.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>iRe(p)&&"bracket"||Zb(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,h="";return n.forEach((f,m)=>{s[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=s[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,I)=>+y-+I)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=Yc("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!Zb(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(sH).test(p)&&"super"||new RegExp(sU).test(p)&&"tiebreak"||new RegExp(m_).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function sRe({score:t,applied:e}){for(let U of[".",","," ","/"]){let C=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(C.test(t)){let E=t.match(C).slice(1).map(M=>parseInt(M)),P=Math.abs(E[0]-E[1]);P<=10&&P>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,C,E,P,M,N]=t.match(i).slice(1);t=t.replace(i,`${U}${C}-${E} ${P}-${M}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let o=g_(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[U,C,E]=t.match(s).slice(1),[P,M]=C.split("");t=`${U}-${P} ${M}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[U,C]=t.match(c).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${M} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[U,C]=t.match(u).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${M} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,C,E]=t.match(h).slice(1),P=C.split(""),M=`${U}-${P[0]} ${P[1]}-${E}`;t=t.replace(h,M),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(C=>{let E=C.match(U).slice(2)[0];t=t.replace(C,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let C=" "+U.slice(1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],C=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,C),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let U=t.match(I),C=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(P=>{let[M,N]=P.match(C).slice(1),R=`${M}-${N}`;E=E.replace(P,R)}),t=E,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[U,C,E]=t.match(b).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${C}${E}`,e.push("spaceSeparatedSuperPattern"))}let D=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(D)||[]){let[C,E,P,M]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,R]=E.split("-").map(A=>parseInt(A));Math.abs(N-R)===1&&(t=t.replace(U,`${C}${E}(${P})${M}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let C=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,P,M]=U.match(C).slice(1),[N,R]=E.split("-").map(A=>parseInt(A));Math.abs(N-R)===1&&(t=t.replace(U,`${E}(${P})${M}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let U of t.match(S)||[]){let C=/(^|\s)(\d \d)\(/,[E,P]=U.match(C).slice(1);t=t.replace(U,`${E}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function lRe({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(Zb(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let c=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(En(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=uR(c.split(""),u)}}t=t.replace(l,`(${c})`)}i=t==null?void 0:t.split(" ");let r=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),a=i.length-1;t=i.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==a;if(r.test(l)&&u){let[d,p,h]=Array.from(l.match(r)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1);return Zb(c)?`${c}(${u})`:c}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c]=l.match(r).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let o=/\((\d)+0 /;if(o.test(t)){let l=t.match(o)[1];t=t.replace(o,`(${l}) `)}return{score:t}}function cRe({score:t,attributes:e,identifier:i}){var u,d,p;if(typeof t!="string")return{score:t,identifier:i};let n=new RegExp(/\([\d,/ ]+\)/g),r=t.match(n);for(let h of r||[]){let f=(d=(u=h.match(/^\((.*)\)$/))==null?void 0:u.slice(1))==null?void 0:d[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=wK(f),v=g_(g);t=t.replace(h,`(${v})`).trim()}let a=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(a))==null||p.forEach(h=>{let f=wK(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let o=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&o.some(h=>t.endsWith(h))&&s.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),m=f.every(I=>I.includes(",")||K1(I)),g=f.every(I=>I.includes("/")||K1(I)),v=f.every(I=>I.includes("-")||K1(I)),y=m&&","||v&&"-"||g&&"/";if(y){let I;f.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(h+=" "),b.includes(y))h+=b.slice(1).split(y).map(D=>D.trim()).join("-"),I="set";else{let D=b.slice(1);h+=`(${D}) `,I="tiebreak"}else if(b.startsWith("[")){let D=b.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...D);I==="set"?h+=`(${w}) `:h+=`[${D.join("-")}] `,I="tiebreak"}}),t=h.trim()}}let l=Vo(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&Zb(t)&&En(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function Are({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let o=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=En(s)&&parseInt(s),c=n[0]!==void 0&&n[1]!==void 0;if(En(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,o())){i.push(a()),n=[void 0,void 0];continue}if(c&&e.length===1&&En(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(a()),n=[void 0,void 0]}c&&o()}}return{sets:i}}function E$(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=uR(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=uR(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function _re(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(s=>En(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let s=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(Are({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=E$(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Fr(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(D=>parseInt(D)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=Vo(c),p=c.map(g=>Math.abs(g)),h=Vo(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,D]=s,w=c.reduce((S,U,C)=>U<0?C:S,void 0);if(w===0){let S=Math.min(y,I);e=`${g}-${v}(${S}) ${b}-${D}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(b,D);e=`${g}-${v} ${y}-${I}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,D,w,S]=s;f||m?s[5]===1&&(f?e=`${g}-${v}(${y}) ${I}-${b} [${D}${w}-${S}]`:e=`${g}-${v} ${y}-${I}(${b}) [${D}${w}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function kre(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function uRe({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),o=a.length;t=a.map((u,d)=>{if(new RegExp(sU).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!Zb(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&En(u))return u.split("").join("-");u=g_(u);let p=new RegExp(`^${sH}$`).test(u)&&"super"||new RegExp(`^${sU}$`).test(u)&&"tiebreak"||new RegExp(`^${m_}$`).test(u)&&"standard"||"unknown";if(n.push(p),o>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let I=g.toString().split(""),b=I.find(D=>parseInt(D)>v||d&&parseInt(D)<=r)??I[0];b&&(u=y?[b,v].join("-"):[v,b].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=kre(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function dRe({score:t}){let{setsTied:e,winningSide:i}=kre(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>En(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{o=o.map(c=>parseInt(c));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(c=>+c>=10)){let c=o.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(o=c)}t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function pRe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function hRe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function fRe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=uR(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=_re({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function mRe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&E$(t)?{score:E$(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function gRe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function vRe({score:t,profile:e,applied:i}){var o;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let r=(o=e==null?void 0:e.matchUpStatuses)==null?void 0:o.retired,a=["rtd",...Array.isArray(r)?r:[r].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}}function yRe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function IRe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function bRe({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function wRe({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function SRe({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${o}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>En(i))&&e.length===4&&(t=e)}return{score:t}}function TRe({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var URe={handleTiebreakSlashSeparation:wRe,handleSetSlashSeparation:IRe,punctuationAdjustments:rRe,handleGameSeparation:bRe,joinFloatingTiebreak:oRe,handleBracketSpacing:aRe,handleSpaceSeparator:SRe,separateScoreBlocks:fRe,matchKnownPatterns:sRe,removeDanglingBits:yRe,removeErroneous:mRe,handleWalkover:gRe,properTiebreak:lRe,handleNumeric:_re,handleRetired:vRe,containedSets:cRe,sensibleSets:uRe,stringScore:pRe,superSquare:dRe,setBuilder:Are,excisions:TRe,replaceOh:hRe},lL={},DRe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],PRe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function Ore(t){if(!t.score)return{error:ve};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:o,profile:s}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=URe[v]({profile:s,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(DRe);let m=bK(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(PRe),m=bK(h),m||(h="")),u.forEach(g=>{lL[g]||(lL[g]=0),lL[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var xre={};Gt(xre,{analyzeSet:()=>lU,checkScoreHasValue:()=>Vr,checkSetIsComplete:()=>h_,getSetComplement:()=>cH,getTiebreakComplement:()=>v_,isValidMatchUpFormat:()=>Ho,parseScoreString:()=>dR,validateScore:()=>lH,validateTieFormat:()=>Uo});function CRe({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){let a=(r==null?void 0:r.sets)??[],o=((a==null?void 0:a.filter(b=>b==null?void 0:b.winningSide))||[]).reduce((b,D)=>{let{winningSide:w}=D;if(!w)return b;let S=w-1;return b[S]++,b},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&o[s],u=l!==void 0&&o[l],d=e?fo(e):void 0,p=Math.max(...o),h=Vo(o)[p],f=d==null?void 0:d.bestOf,m=f&&Math.ceil(f/2)||1,g=i??t,v=g&&[fi,Ra,Pi].includes(g),y=!d||!a.length||a.every((b,D)=>{let w=D+1,S=w===f,U=w===a.length,{side1Score:C,side2Score:E,side1TiebreakScore:P,side2TiebreakScore:M,winningSide:N}=b,R=Math.max(C??0,E??0),A=P??M,{finalSetFormat:_,setFormat:O}=d,x=S&&_||O;if(A){let{tiebreakTo:F,NoAD:$}=(x==null?void 0:x.tiebreakFormat)||{},V=Math.max(P??0,M??0);if($&&V>F||V<F&&N&&(U&&!v||!U))return!1}return x.setTo?!(!x.noTiebreak&&R>x.setTo+1):!0}),I=(!e||p===m)&&h===1&&o.indexOf(p)+1||void 0;return{valid:y&&(n&&c>u&&n===I||!n&&!I||v)}}function lH({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:ve};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:ve,info:l};if(s!==void 0&&typeof s!="string")return{error:ve,info:l};if(a!==void 0&&!Array.isArray(a))return{error:ve,info:gd("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==Ft(c).length)return{error:ve,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,h],[f,m],[g,v]].filter(b=>b.some(D=>D!==void 0)).every(b=>b.every(D=>Mt(D))))return{error:ve,info:"non-numeric values"};if(![I,y].filter(b=>b!==void 0).every(b=>Mt(b)))return{error:ve,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:ve,info:"winningSide must be 1 or 2"}}let{valid:u}=CRe({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:EQ,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var cH=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let o=wt(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&r<n&&o>r&&(o=r);let s;return a&&!r?(o>n&&(s=n),s=o<n?n:n-1):s=o+1<n&&n||r&&r<n&&o===r&&n||!r&&o+2||n+1,[e?o:s,e?s:o]},v_=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=ERe({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:o,e?o:a]};function ERe(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function dR({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),o=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!a&&o.split("-").map(m=>parseInt(m)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,u=(c&&v_({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[h,f]=a||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:h,side2TiebreakScore:f,winningSide:l,setNumber:r}}}function MRe({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=f_({set:n});return h_({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function lU(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:cA};let{setNumber:n}=e||{},{bestOf:r}=i||{},a=!!(n&&r&&n===r),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),c=!s&&!l,u=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],h=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=h.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=h==null?void 0:h.filter(_=>!isNaN(_)).length,{tiebreakAt:I}=o||{},b=I&&d.filter(_=>_>=I).length===2,D=b&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(y&&!v),S=!!(e!=null&&e.winningSide),{error:U,result:C}=RRe({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:h}),{error:E,result:P}=NRe({setObject:e,setFormat:o,sideTiebreakScores:h}),M=c&&!w&&C||s&&w&&P,N=u&&!(s&&!w)&&!(c&&w)&&(!S||M),R=MRe({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:b,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:M,leadingSide:D,setFormat:o,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:R};return(e==null?void 0:e.winningSide)!==void 0&&(w?(A.isValidTiebreakSetOutcome=P,P||(A.tiebreakSetError=E)):(A.isValidStandardSetOutcome=C,C||(A.standardSetError=U))),A}function RRe({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:cA};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:ve};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:KF};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(o&&(i!=null&&i.find(S=>S>=o))))return{result:!1,error:KF};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:uA};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],I=n==null?void 0:n[p],b=s&&i.filter(S=>S>=s).length===2;if(g){let{NoAD:S,tiebreakTo:U}=l;if(b){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&(n!=null&&n.find(N=>N>=U))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let C=s<o?o:o+1;if(h>C)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,P=y-I,M=I>=U-1;if(P&&M&&P<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let D=c?1:2,w=f>=o-1;return m&&w&&!b&&m<D?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>D&&h>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function NRe({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:cA};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:uA};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=s?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var Lre={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Fre={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},$re={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},Bre={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},Vre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},jre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},Gre={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},Hre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},zre={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},Wre={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},qre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},Kre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},Yre={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Zre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Xre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Jre={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Qre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},M$="COLLEGE_DEFAULT",R$="COLLEGE_JUCO",N$="COLLEGE_D3",eae="DOMINANT_DUO",tae="DOMINANT_DUO_MIXED",iae="LAVER_CUP",nae="TEAM_DOUBLES_3_AGGREGATION",rae="TIME_TENNIS_DUAL",aae="TIME_TENNIS_PRO_CIRCUIT",oae="USTA_BREWER_CUP",sae="USTA_OZAKI_CUP",lae="USTA_COLLEGE",cae="USTA_GOLD_TEAM_CHALLENGE",uae="USTA_LEVEL_1",dae="USTA_INTERSECTIONAL",pae="USTA_SECTION_BATTLE",hae="USTA_SOUTHERN_LEVEL_5",fae="USTA_TOC",mae="USTA_WTT_ITT",gae="USTA_ZONAL",vae={COLLEGE_D3:N$,COLLEGE_DEFAULT:M$,COLLEGE_JUCO:R$,DOMINANT_DUO:eae,DOMINANT_DUO_MIXED:tae,LAVER_CUP:iae,TEAM_DOUBLES_3_AGGREGATION:nae,TIME_TENNIS_DUAL:rae,TIME_TENNIS_PRO_CIRCUIT:aae,USTA_BREWER_CUP:oae,USTA_OZAKI_CUP:sae,USTA_COLLEGE:lae,USTA_GOLD_TEAM_CHALLENGE:cae,USTA_INTERSECTIONAL:dae,USTA_LEVEL_1:uae,USTA_SECTION_BATTLE:pae,USTA_SOUTHERN_LEVEL_5:hae,USTA_TOC:fae,USTA_WTT_ITT:mae,USTA_ZONAL:gae},yae="STANDARD",SK={[yae]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[N$]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:_s,matchUpCount:6,matchUpValue:1},tieFormatName:N$,valueGoal:5},[M$]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:_s},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:_s},tieFormatName:M$,valueGoal:4},[R$]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:_s},tieFormatName:R$,valueGoal:5},[iae]:Jre,[eae]:qre,[tae]:Gre,[nae]:Fre,[rae]:Hre,[aae]:jre,[oae]:zre,[sae]:Wre,[lae]:Kre,[cae]:Lre,[dae]:Vre,[uae]:Yre,[pae]:Bre,[hae]:$re,[mae]:Zre,[fae]:Qre,[gae]:Xre},ARe=t=>{let e=t!=null&&t.namedFormat&&Object.keys(SK).includes(t.namedFormat)?t.namedFormat:yae,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},o=at(SK[e],!1,!0),s=l=>{var u,d;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??Oi();let c=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${c}-COL-${l+1}`};return o.hydrate?(n={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Yie,collectionName:"Doubles",matchUpType:Wi,...o.doubles},{collectionId:s(1),matchUpFormat:_s,collectionName:"Singles",matchUpType:Tn,...o.singles}]},o.tieFormatName&&(n.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),n=o),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},ey=ARe;function _Re(t){var d,p,h;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:n,tieFormatName:r,matchUpType:a,eventType:o,isMock:s,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(a===Tr&&o===Tr){let f=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:m})=>m===it))==null?void 0:p.tieFormat;c=c||f||r&&((h=l==null?void 0:l.tieFormat)==null?void 0:h.tieFormatName)===r&&l.tieFormat||r&&ey({namedFormat:r,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||ey({event:l,isMock:s,hydrateCollections:i}),u=void 0}else u||(c=void 0,l!=null&&l.matchUpFormat||(u=_s));if(c){let f=Uo({gender:l==null?void 0:l.gender,enforceGender:n,tieFormat:c});if(f.error)return f}return{tieFormat:c,matchUpFormat:u}}function kRe(t){var y,I,b,D,w;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,drawEntries:n,appliedPolicies:r,structureId:a,idPrefix:o,isMock:s}=t,l=t.qualifyingProfiles,c=l!=null&&l.length?kne({uuids:t.uuids,qualifyingProfiles:l,appliedPolicies:r,idPrefix:o,isMock:s}):void 0;if(c!=null&&c.error)return c;e.structures=(y=e.structures)==null?void 0:y.filter(({structureId:S})=>S!==i),e.links=(I=e.links)==null?void 0:I.filter(({source:S})=>S.structureId!==i);let{qualifiersCount:u,qualifyingDrawPositionsCount:d,qualifyingDetails:p}=c??{};d&&(c!=null&&c.structures&&((b=e.structures)==null||b.push(...c.structures)),c!=null&&c.links&&((D=e.links)==null||D.push(...c.links)));let h=(w=e.structures)==null?void 0:w.find(({stage:S,stageSequence:U})=>S===it&&U===1),{qualifiersCount:f}=I0({stageSequence:1,drawDefinition:e,structureId:a,stage:it}),m=Math.max(u??0,f??0),g=$ie({qualifiersCount:m,drawDefinition:e,stage:it});if(g.error||(g=rR({drawSize:d,stage:mt,drawDefinition:e}),g.error))return g;ORe({drawDefinition:e,drawEntries:n});let v=xRe({mainStructure:h,qualifyingDetails:p,drawDefinition:e});return v.error?v:{drawDefinition:e,structureId:a}}function ORe({drawDefinition:t,drawEntries:e}){for(let i of(e??[]).filter(({entryStage:n})=>n===mt)){let n={...i,entryStage:i.entryStage??it,drawDefinition:t};tie(n)}}function xRe({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:c}=r,u=t&&((n=nP({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function Iae(t){var n,r;let{participantIds:e}=t,i=((r=(n=t.drawDefinition)==null?void 0:n.entries)==null?void 0:r.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||jl.includes(o)}).map(qt))??[];if(e){let a=e.filter(o=>!(i!=null&&i.includes(o)));if(a!=null&&a.length)return ae({result:{error:au},info:{invalidParticipantIds:a}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:ve,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:ve,info:"roundsCount must be less than 32"}:{participantIds:e}}function uH(t){var d;let e=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,c,u=Iae(t);if(u.error)return u;for(let p of Ze(1,i+1)){let h=u_({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:r,structureId:a,roundNumber:c,idPrefix:o,isMock:s,event:l});if(h.error)return ae({result:h,info:{iteration:p}});(d=h.matchUps)!=null&&d.length&&e.push(...h.matchUps),c=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:e}}function LRe(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:n,eventType:r,adHocRatings:a={}}=t,o=t.scaleAccessor??((l=ns[n])==null?void 0:l.accessor),s=e.participants??[];for(let c of i??[]){let u=s==null?void 0:s.find(p=>p.participantId===c),d=TK({scaleName:`${n}.${_ee}`,participant:u,eventType:r});!d&&n&&(d=TK({scaleAccessor:o,participant:u,scaleName:n,eventType:r})),d&&!a[c]&&(a[c]=d)}return a}function TK({scaleType:t=wm,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var o,s;let a=(s=(o=i&&Yu({scaleAttributes:{eventType:r??Yv,scaleType:t,scaleName:n},participant:i}))==null?void 0:o.scaleItem)==null?void 0:s.scaleValue;return e&&Zi(a)?a[e]:a}function dH(t){var u,d;let e=$Re(t);if(e!=null&&e.error)return e;let i=Iae(t);if(i.error)return i;let n=FRe(t);if(n.error)return n;let r=LRe(t),a=((u=t.tournamentRecord)==null?void 0:u.isMock)??t.isMock,o=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],c;for(let p of Ze(1,(t.roundsCount??1)+1)){let h=tH({...t,participantIds:i.participantIds,structure:n.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:r,roundNumber:c,eventType:o,isMock:a});if(h.error)return h;let{matchUps:f,...m}=h;l.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),c=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&s.push(...f)}return{...ne,matchUps:s,roundResults:l}}function FRe(t){var r,a,o;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(a=(r=e==null?void 0:e.structures)==null?void 0:r.filter(s=>s.stageSequence===1))==null?void 0:a.reduce((s,l)=>{let c=l.stage&&Kv[l.stage];return Go({structure:l})&&c>(Kv[s==null?void 0:s.stage]||1)?l:s},void 0),n=(o=e==null?void 0:e.structures)==null?void 0:o.find(s=>s.structureId===(i==null?void 0:i.structureId));return n?Go({structure:n})?{structure:n}:{error:hv}:{error:bn}}function $Re(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:ve,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Rl?{error:hv}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:ve,info:"Missing Entries"}:{error:void 0}}function BRe(t){var u,d;let{tournamentRecord:e,drawDefinition:i,structureId:n,idPrefix:r,isMock:a,event:o}=t,s=(u=o==null?void 0:o.entries)==null?void 0:u.filter(({entryStage:p,entryStatus:h})=>(!p||p===it)&&h&&jl.includes(h)),l=s==null?void 0:s.map(qt),c=s?Math.floor(s.length/2):0;if(t.automated)return VRe({...t,participantIds:l});{let p=uH({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:r,isMock:a,event:o});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&a_({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:n,event:o})}return{...ne}}function VRe(t){var l,c;let{restrictEntryStatus:e,generateMatchUps:i,structureId:n,matchUpIds:r,scaleName:a,scaleAccessor:o}=t.drawMatic??{},s=dH({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:o??t.scaleAccessor,scaleName:a??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:n,matchUpIds:r});return s.error?s:((c=s==null?void 0:s.matchUps)!=null&&c.length&&a_({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:n}),{...ne})}function jRe({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:c}){var y,I;n=n??r;let u=Ut({drawDefinition:o,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:bn};let{positionAssignments:p}=Er({structure:d}),h=(p==null?void 0:p.length)||0;if(c>h)return{error:sQ};let f=(y=d.structures)==null?void 0:y.length,m=Mt(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(I=vG({roundRobinGroupsCount:f,drawSize:h}))==null?void 0:I.seedGroups,{seedsCount:v}=fP({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:h});return v&&(a!=null&&a[hl])&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=Ze(1,c+1).map(b=>{let D=g==null?void 0:g.find(U=>U.includes(b)),w=D&&Math.min(...D),S=m&&b>=m?w:b;return{participantId:void 0,seedNumber:b,seedValue:S}}),Xi({drawDefinition:o,structureIds:[l]}),{...ne,seedLimit:c}}function Yy({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){if(!e)return{error:Re};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&jl.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=Kb({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function bae(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=fd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!a)return ae({result:{error:bn},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=ZRe({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&zRe({...t,seedsCount:s,structure:a,structureId:o});let u=t.automated!==!1&&t.drawType!==Rl&&!(t.qualifyingOnly&&t.stage!==mt),d=((n==null?void 0:n.length)||0)>1,p=u?HRe({...t,multipleStructures:d,seedLimit:c,structureId:o}):{};return p!=null&&p.error?ae({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function GRe({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var o,s;let a=(s=(o=Vt({name:Tu,element:r}))==null?void 0:o.extension)==null?void 0:s.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!a||a===n)&&pg.includes(r.entryStatus)})}function HRe(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=tP({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function zRe(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(qt);e?WRe({...t,enteredParticipantIds:a}):(r||i)&&qRe({...t,enteredParticipantIds:a})}function WRe(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?Hy({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;w0({provisionalPositioning:e,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function qRe(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=KRe({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&YRe({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:D}=v,w=(r==null?void 0:r[I])||D||I;w0({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:c,participantId:b,structureId:u,seedNumber:I,seedValue:w,event:d})})}function KRe(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},c=o==null?void 0:o.eventType,u={scaleName:i||s||l||o.eventId,scaleType:qu,eventType:c};return Yy({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function YRe(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return Yy({scaleAttributes:{scaleName:o||s,scaleType:jh,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function ZRe(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=GRe(t);e>i.length&&(e=i.length);let{seedLimit:n}=jRe({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function XRe(t){var I;let e=QG({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{ignoreStageSpace:n,appliedPolicies:r,qualifyingOnly:a,seedingProfile:o,participants:s,drawEntries:l,placeByes:c,drawSize:u,drawType:d,entries:p}=t,h=[],f=[],m=JRe({ignoreStageSpace:n,drawDefinition:i,drawEntries:l,drawType:d,entries:p});if(m.error)return m;let g=d===cg?0:wt(t.seedsCount??0),v=bae({...t,qualifyingOnly:!u||a,appliedPolicies:r,drawDefinition:i,seedingProfile:o,participants:s,stage:it,seedsCount:g,placeByes:c,drawSize:u,entries:p});if(v.error&&!v.conflicts)return v;(I=v.positioningReport)!=null&&I.length&&h.push({[it]:v.positioningReport});let y=v.structureId;return v.conflicts&&(f=v.conflicts),d===Rl&&t.roundsCount&&BRe({...t,drawDefinition:i,structureId:y}),{drawDefinition:i,positioningReports:h,conflicts:f,structureId:y}}function JRe(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let o of a){if(n&&o.entryStage&&o.entryStage!==it)continue;let s={...o,ignoreStageSpace:e??r===Rl,entryStage:o.entryStage??it,drawDefinition:i,drawType:r},l=tie(s);if(n&&l.error)return l}return{error:void 0}}var QRe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),eNe=QRe;function tNe(t){let{drawId:e=Oi(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=eNe();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function pH(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=t,l=gi(t,[{[Lc]:!0,[QV]:!0}]);if(l.error)return l;if(!Ho({matchUpFormat:r}))return{error:mD};let c="setMatchUpFormat";if(o){let u=nn({drawDefinition:n,matchUpId:o,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===Tr)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:oo};d&&(d.matchUpFormat=r,oi({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===Tr)return{error:Vh};for(let u of e){let d=Ut({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((s==null?void 0:s.eventType)===Tr)return{error:Vh};let u=Ut({drawDefinition:n,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Xi({drawDefinition:n,structureIds:e}),{...ne}}function iNe({tieFormat:t}){let e=Uo({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=Oi());return{tieFormat:t}}function nNe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let o=iNe({tieFormat:r});if(o.error)return o;e.tieFormat=o.tieFormat??r}else if(i){let o=pH({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(e.matchUpType=n)}return{error:void 0}}var hH={};Gt(hH,{attachPolicies:()=>Fm,findPolicy:()=>hg,getAppliedPolicies:()=>Ei,getPolicyDefinitions:()=>Vp,mutate:()=>wae,query:()=>Tae,removePolicy:()=>Sae});var wae={};Gt(wae,{attachPolicies:()=>Fm,removePolicy:()=>Sae});function Sae(t){let e=gi(t,[{[BDe]:!0,_anyOf:{[ba]:!1,[Rd]:!1,[Lc]:!1,[r0]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return UK(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Re};for(let a of r){let o=t.tournamentRecords[a],s=UK(t,o);if(s.error)return s;i=!0}}else return{error:Re};return i?{...ne}:{error:fv}}function UK(t,e){let i=Ei(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?ci({element:e,extension:{name:qT,value:i}}):Ba({element:e,name:qT}),{...ne}):{error:fv}}var Tae={};Gt(Tae,{findPolicy:()=>hg,getAppliedPolicies:()=>Ei,getPolicyDefinitions:()=>Vp});var Uae={[hl]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[hd]:{positioning:Rm},[Nl]:{positioning:Rm}},positioning:DPe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},A$=Uae;function rNe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return ae({info:"policyDefinitions must be an object",result:{error:ve},stack:n});let r={[WT]:t==null?void 0:t[WT]};return e?aNe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&Fm({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[hl])&&!(e!=null&&e[hl])&&(Fm({policyDefinitions:A$,drawDefinition:i}),t&&Object.assign(t,A$)),{error:void 0}}function aNe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(Fm({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function oNe(t){var v,y,I,b,D;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:n,policyDefinitions:r,matchUpType:a,tieFormat:o,drawType:s,stack:l,event:c}=t,u=t.drawId?(v=c==null?void 0:c.drawDefinitions)==null?void 0:v.find(w=>w.drawId===t.drawId):void 0;u&&s!==u.drawType&&(u.drawType=s);let d=u??tNe({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=nNe({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:a,tieFormat:o,event:c});if(p.error)return ae({result:p,stack:l});let h=rNe({appliedPolicies:n,policyDefinitions:r,drawDefinition:d,stack:l});if(h.error)return h;let f=(I=(y=u==null?void 0:u.structures)==null?void 0:y.find(w=>w.stage===it&&w.stageSequence===1))==null?void 0:I.structureId,m=u?(b=u.structures)==null?void 0:b.filter(w=>w.stage===mt):[],g=(m==null?void 0:m.length)===1&&!((D=m[0].matchUps)!=null&&D.length)&&m[0].structureId;return{drawDefinition:d,structureId:f,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:g}}function sNe(t){var u,d;let e="generateOrGetExisting",i=[],n=[],r=oNe(t);if(r.error)return ae({result:r,stack:e});let a=r.existingDrawDefinition,o=r.drawDefinition??{},s=r.structureId,l=t.drawEntries??t.eventEntries??[],c=r.existingQualifyingPlaceholderStructureId&&kRe({...t,...r})||XRe({...t,...r,entries:l});return c.error?ae({result:c,stack:e}):((u=c.positioningReports)!=null&&u.length&&i.push(...c.positioningReports??[]),(d=c.conflicts)!=null&&d.length&&n.push(...c.conflicts??[]),o=c.drawDefinition,s=c.structureId,{existingDrawDefinition:a,positioningReports:i,drawDefinition:o,structureId:s,conflicts:n,entries:l})}function lNe(t){var m,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:n,positioningReports:r,appliedPolicies:a,qualifyingOnly:o,drawDefinition:s,seedingProfile:l,participants:c,structureId:u,entries:d,stack:p}=t,h=e&&!(i!=null&&i.length)&&!n,f=[];if(i){let y=(w,S)=>w.stageSequence-S.stageSequence,I=(w,S)=>w.roundTarget-S.roundTarget,b=[],D=1;i.sort(I);for(let w of i){if(!Array.isArray(w.structureProfiles))return ae({info:gd("structureProfiles"),result:{error:ut},stack:p});D=w.roundTarget||D;let S=((m=w.structureProfiles)==null?void 0:m.sort(y))||[],U=1;for(let C of S){let{qualifyingRoundNumber:E,qualifyingPositions:P,seededParticipants:M,seedingScaleName:N,seedsCount:R=0,seedByRanking:A,placeByes:_,drawSize:O}=C,x=bae({...t,seedingProfile:C.seedingProfile??l,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:b,qualifyingPositions:P,seededParticipants:M,stage:mt,seedingScaleName:N,appliedPolicies:a,drawDefinition:s,qualifyingOnly:o,seedByRanking:A,participants:c,roundTarget:D,seedsCount:R,placeByes:_,drawSize:O,entries:d});if(x.error)return x;x.structureId&&b.push(x.structureId),U+=1,(g=x.conflicts)!=null&&g.length&&f.push(...x.conflicts),(v=x.positioningReport)!=null&&v.length&&r.push({[mt]:x.positioningReport})}D+=1}}else if(u&&h){let y=As({structureName:ta(mt),stage:mt}),{link:I}=nP({sourceStructureId:y.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:fp});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(I)}return{qualifyingConflicts:f,error:void 0}}var fH={};Gt(fH,{addGoesTo:()=>Lm,allCompetitionMatchUps:()=>Cc,allDrawMatchUps:()=>no,allEventMatchUps:()=>Hp,allPlayoffPositionsFilled:()=>UG,allTournamentMatchUps:()=>Br,analyzeDraws:()=>pP,analyzeMatchUp:()=>uU,analyzeTournament:()=>TH,bulkUpdatePublishedEventIds:()=>PH,calculateWinCriteria:()=>Xy,categoryCanContain:()=>i_,checkMatchUpIsComplete:()=>Sm,checkValidEntries:()=>c_,compareTieFormats:()=>bp,competitionScheduleMatchUps:()=>IP,credits:()=>cNe,drawMatchUps:()=>BH,eventMatchUps:()=>E_,filterParticipants:()=>ZD,findDrawDefinition:()=>jG,findExtension:()=>Vt,getAllDrawMatchUps:()=>sr,getAllEventData:()=>CH,getAllStructureMatchUps:()=>Ti,getAllowedDrawTypes:()=>y_,getAllowedMatchUpFormats:()=>bH,getAppliedPolicies:()=>Ei,getAssignedParticipantIds:()=>yg,getAvailableMatchUpsCount:()=>o_,getAvailablePlayoffProfiles:()=>rP,getCategoryAgeDetails:()=>lP,getCheckedInParticipantIds:()=>Fy,getCompetitionDateRange:()=>b_,getCompetitionMatchUps:()=>cU,getCompetitionParticipants:()=>mH,getCompetitionPenalties:()=>wH,getCompetitionVenues:()=>mP,getCourtInfo:()=>VA,getCourts:()=>VH,getDrawData:()=>w_,getDrawDefinitionTimeItem:()=>aG,getDrawParticipantRepresentativeIds:()=>BG,getDrawTypeCoercion:()=>hP,getEligibleVoluntaryConsolationParticipants:()=>$G,getEntriesAndSeedsCount:()=>P_,getEvent:()=>HH,getEventData:()=>S_,getEventMatchUpFormatTiming:()=>NH,getEventProperties:()=>jH,getEventPublishStatus:()=>Qs,getEventStructures:()=>ZA,getEventTimeItem:()=>zD,getEvents:()=>GH,getFlightProfile:()=>Bn,getLinkedTournamentIds:()=>PD,getMatchUpCompetitiveProfile:()=>BD,getMatchUpContextIds:()=>xH,getMatchUpDailyLimits:()=>R_,getMatchUpDailyLimitsUpdate:()=>AH,getMatchUpDependencies:()=>zl,getMatchUpFormat:()=>LH,getMatchUpFormatTiming:()=>jD,getMatchUpFormatTimingUpdate:()=>RH,getMatchUpScheduleDetails:()=>jA,getMatchUpType:()=>GA,getMatchUpsMap:()=>ca,getMatchUpsStats:()=>FH,getMaxEntryPosition:()=>MH,getModifiedMatchUpFormatTiming:()=>C_,getPairedParticipant:()=>_l,getParticipantEventDetails:()=>gH,getParticipantIdFinishingPositions:()=>VG,getParticipantMembership:()=>vH,getParticipantResults:()=>sP,getParticipantScaleItem:()=>Kb,getParticipantSchedules:()=>yH,getParticipantSignInStatus:()=>IH,getParticipantTimeItem:()=>oG,getParticipants:()=>xn,getPersonRequests:()=>wg,getPolicyDefinitions:()=>Vp,getPositionAssignments:()=>oU,getPositionsPlayedOff:()=>S0,getPredictiveAccuracy:()=>OH,getProfileRounds:()=>D_,getPublishState:()=>jy,getRoundMatchUps:()=>Wa,getRounds:()=>$H,getScaleValues:()=>o0,getScaledEntries:()=>Yy,getScheduledRoundsDetails:()=>gP,getSchedulingProfile:()=>qp,getSchedulingProfileIssues:()=>EH,getSeedingThresholds:()=>yG,getSeedsCount:()=>fP,getStructureSeedAssignments:()=>zs,getTeamLineUp:()=>xm,getTieFormat:()=>DH,getTimeItem:()=>Pu,getTournamentIds:()=>UD,getTournamentInfo:()=>Zy,getTournamentPenalties:()=>I_,getTournamentPersons:()=>SH,getTournamentStructures:()=>TG,getTournamentTimeItem:()=>WD,getValidGroupSizes:()=>QD,getVenueData:()=>zb,getVenuesAndCourts:()=>Wp,isAdHoc:()=>Go,isCompletedStructure:()=>Yh,isValidForQualifying:()=>XG,isValidMatchUpFormat:()=>Ho,matchUpActions:()=>l_,participantScaleItem:()=>Yu,participantScheduledMatchUps:()=>_H,positionActions:()=>ZG,publicFindVenue:()=>tG,tallyParticipantResults:()=>T0,tieFormatGenderValidityCheck:()=>e_,tournamentMatchUps:()=>M_,validMatchUp:()=>FA,validMatchUps:()=>Js,validateCollectionDefinition:()=>cP,validateLineUp:()=>YA});function cNe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Dae={};Gt(Dae,{filterParticipants:()=>ZD,getCompetitionParticipants:()=>mH,getPairedParticipant:()=>_l,getParticipantEventDetails:()=>gH,getParticipantMembership:()=>vH,getParticipantScaleItem:()=>Kb,getParticipantSchedules:()=>yH,getParticipantSignInStatus:()=>IH,getParticipantTimeItem:()=>oG,getParticipants:()=>xn,getScaleValues:()=>o0,participantScaleItem:()=>Yu,validateLineUp:()=>YA});function mH(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Pn};let i=[],n={},r={},a={},o=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=xn({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),o.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...ne,matchUps:o}}function gH({tournamentRecord:t,participantId:e}){if(!t)return{error:Re};if(!e)return{error:mr};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[ji,kt].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return za(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function vH({tournamentRecord:t,participantId:e}){if(!t)return{error:Re};if(!e)return{error:mr};let{participants:i}=xn({participantFilters:{participantTypes:[ji,kt,vs]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function yH({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Re};if(typeof t!="object")return{error:Fp,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Br({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),o=zl({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);o[l.matchUpId]&&!u&&(u=(o[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...ne}}function IH({tournamentRecord:t,participantId:e}){if(!t)return{error:Re};if(!e)return{error:mr};let{participant:i}=vg({tournamentRecord:t,participantId:e});if(!i)return{error:jn};let{timeItem:n}=Pu({itemType:AD,element:i});return n&&n.itemValue===eU&&eU}var Pae={};Gt(Pae,{analyzeDraws:()=>pP,analyzeTournament:()=>TH,getAllowedDrawTypes:()=>y_,getAllowedMatchUpFormats:()=>bH,getAppliedPolicies:()=>Ei,getCompetitionDateRange:()=>b_,getCompetitionPenalties:()=>wH,getPolicyDefinitions:()=>Vp,getTournamentInfo:()=>Zy,getTournamentPenalties:()=>I_,getTournamentPersons:()=>SH,getTournamentStructures:()=>TG,getTournamentTimeItem:()=>WD});function bH({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:Re};let{appliedPolicies:n}=Ei({tournamentRecord:t});return(((r=n==null?void 0:n[ud])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function y_({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:Re};let{appliedPolicies:n}=Ei({tournamentRecord:t});return(((r=n==null?void 0:n[zM])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function I_({tournamentRecord:t}){if(!t)return{error:Re};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(r):i[o]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function wH({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Pn};let e=[];for(let i of Object.values(t)){let{penalties:n}=I_({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function Cae({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var uNe={[l0]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},dNe=uNe;function Zy(t){var o,s,l,c;let{tournamentRecord:e}=t??{};if(!e)return{error:Re};let i=(({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:I,hostCountryCode:b,venues:D,notes:w,updatedAt:S})=>({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:I,hostCountryCode:b,venues:D,notes:w,updatedAt:S}))(e),n=xn({participantFilters:{participantRoles:[nie,dG,rie,aie,sie]},policyDefinitions:dNe,tournamentRecord:e}).participants;n&&(i.tournamentContacts=n);let r=((c=(l=(s=(o=jy({tournamentRecord:e}))==null?void 0:o.publishState)==null?void 0:s.tournament)==null?void 0:l.status)==null?void 0:c.publishedEventIds)||[],a=[];for(let u of e.events??[])if(!(t!=null&&t.usePublishState)||r.includes(u.eventId)){let d=Cae({event:u}).eventInfo;d&&a.push(d)}return i.eventInfo=a,{tournamentInfo:at(i,!1,!0),...ne}}function b_({tournamentRecords:t}){if(!Zi(t))return{error:Pn};let e=Object.keys(t??{}).reduce((r,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=Zy({tournamentRecord:o}),c=s&&new Date(xt(s));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(xt(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&xt(e.startDate.toISOString()),n=e.endDate&&xt(e.endDate.toISOString());return!i||!n?{error:UQ}:{startDate:i,endDate:n}}function SH({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Re};let i=t.participants||[];e&&(i=ZD({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:o}=a.person;n[o]?n[o].participantIds.push(a.participantId):n[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function pNe(t){var a,o,s,l,c,u,d;let e=((o=(a=t.participants)==null?void 0:a.filter(({participantType:p})=>p===ji))==null?void 0:o.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],n=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],r=((d=(u=((c=n==null?void 0:n.structures)==null?void 0:c.length)===1&&n.structures[0])==null?void 0:u.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&r)}function TH({tournamentRecord:t}){if(!t)return{error:Re};let{drawsAnalysis:e}=pP({tournamentRecord:t}),i={isDual:pNe(t),drawsAnalysis:e};return{...ne,analysis:i}}var Eae={};Gt(Eae,{compareTieFormats:()=>bp,getTieFormat:()=>DH,tieFormatGenderValidityCheck:()=>e_,validateCollectionDefinition:()=>cP});function pR(t){var r;if(!t)return{};let e=[],i=t.tieFormatName,n=(r=t.collectionDefinitions)==null?void 0:r.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=a;e.includes(s)||e.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,o===Am?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:n}}function bp({considerations:t={},descendant:e,ancestor:i}){var D,w;let n={},r={},{matchUpFormats:a,tieFormatDesc:o}=pR(e),{matchUpFormats:s,tieFormatDesc:l}=pR(i),c=Ft((a??[]).filter(S=>!(s??[]).includes(S)).concat((s??[]).filter(S=>!(a??[]).includes(S)))),u=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),h=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));n.collectionIds=z7(Object.keys(p),Object.keys(h)),r.collectionIds=z7(Object.keys(h),Object.keys(p)),n.collectionsValue=DK(p),r.collectionsValue=DK(h),n.groupsCount=((D=i==null?void 0:i.collectionGroups)==null?void 0:D.length)??(0-(((w=e==null?void 0:e.collectionGroups)==null?void 0:w.length)??0)||0),r.groupsCount=n.groupsCount?-1*n.groupsCount:0;let f=n.collectionsValue.totalValue-r.collectionsValue.totalValue,m=n.collectionsValue.totalMatchUps-r.collectionsValue.totalMatchUps,g=r.collectionsValue.assignmentValues.length!==n.collectionsValue.assignmentValues.length,v=r.collectionsValue.assignmentValues.some((S,U)=>{let C=n.collectionsValue.assignmentValues[U];return!C||S.valueKey!==C.valueKey||S.value!==C.value?!0:Array.isArray(S.value)?S.value.every((E,P)=>C.value[P]===E):!1}),y=u||d||l!==o||g||v||f!==0,I=[...r.collectionsValue.invalidValues,...n.collectionsValue.invalidValues],b=I.length&&I;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:n,ancestorDifferences:r,orderDifference:d,valueDifference:f,nameDifference:u,descendantDesc:o,ancestorDesc:l,...ne,different:y,invalid:b}}function DK(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(WA).reduce((r,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,h={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g]));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):h[m];i.push({valueKey:m,value:g})}return n+=c,s?r+s.reduce((g,v)=>g+v.value,0):c?Mt(u)?r+u*c:Mt(d)?r+d*c:Mt(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function UH(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Mae(t);return{matchUp:at(e,!0,!0),error:i}}function Mae({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var f;if(!i)return{error:Re};if(typeof s!="string")return{error:la};if(!a||!d){let m=(Br({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:ya};({eventId:c,drawId:u}=m),{event:d,drawDefinition:a}=so({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:$o};r&&!n&&(n=Gp({tournamentRecord:i,contextProfile:r}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:h=[]}=By({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let m=(no({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:ya};let g=(f=a==null?void 0:a.structures)==null?void 0:f.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=nn({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function DH({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var h,f,m,g,v;if(!t)return{error:Re};if(!o&&!s&&!i&&!n)return ae({result:{error:ut},stack:"getTieFormat"});a&&!s&&(s=(h=t.events)==null?void 0:h.find(y=>y.eventId===a));let l=UH({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:s});if(n&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),r=r??(l==null?void 0:l.structure),!r&&i&&!n){if(!e)return{error:xc};let y=Ut({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let c=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((f=Ca({structure:r,drawDefinition:e,event:s}))==null?void 0:f.tieFormat),u=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((m=Ca({drawDefinition:e,event:s}))==null?void 0:m.tieFormat),d=(g=Ca({event:s}))==null?void 0:g.tieFormat,p=(v=Ca({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:v.tieFormat;return{...ne,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:Xr(c),eventDefaultTieFormat:Xr(d),drawDefaultTieFormat:Xr(u),tieFormat:Xr(p),structure:r}}var Rae={};Gt(Rae,{bulkUpdatePublishedEventIds:()=>PH,getAllEventData:()=>CH,getCourtInfo:()=>VA,getDrawData:()=>w_,getEventData:()=>S_,getEventPublishStatus:()=>Qs,getPublishState:()=>jy,getVenueData:()=>zb});function PH({tournamentRecord:t,outcomes:e}){var r;if(!t)return{error:Re};if(!(e!=null&&e.length))return{error:ut,info:"Missing outcomes"};let i=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),n=Object.keys(i);return{publishedEventIds:((r=t.events)==null?void 0:r.filter(a=>n.includes(a.eventId))).filter(a=>{let o=Qs({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:c}=a;return i[c].filter(u=>{let d=s?Object.keys(o.drawDetails).filter(p=>cG({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:i}}function Nae({dates:t=[],extension:e}){var n;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=Zi(e.value)?(n=e.value)==null?void 0:n.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function Aae({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var o;let r={...at(n,t,!0),venueId:i.venueId},{extension:a}=Vt({name:bc,element:n});if(e&&a){let s=Zi(a.value)?(o=a.value)==null?void 0:o.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:r.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);r.dateAvailability=l}return{inContextCourt:r}}function Wp(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=Vt({name:bc,element:p});if(h!=null&&h.value)continue}o.includes(p.venueId)||(c.push(at(p,e,!0)),o.push(p.venueId));for(let h of p.courts??[])if(!s.includes(h.courtId)){if(i){let{extension:m}=Vt({name:bc,element:h});if(Nae({extension:m,dates:r}))continue}let{inContextCourt:f}=Aae({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),s.push(h.courtId)}}}),{courts:l,venues:c,...ne}}function hNe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:Pn};let r=at(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=Vt({name:bc,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=r.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=Vt({name:bc,element:c});return Nae({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=Aae({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?o.concat(l):o},[]);return{venues:r,courts:a}}function mP({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Pn}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:o}=hNe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function CH({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Re};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=Zy({tournamentRecord:t}),{venues:a}=Wp({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,c=Cae({event:s}).eventInfo,u=VD({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(h=>{let f=(({drawId:I,drawName:b,matchUpFormat:D,updatedAt:w})=>({matchUpFormat:D,updatedAt:w,drawName:b,drawId:I}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=y0({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:s});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=Qs({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:o}}}function _ae({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function w_(t){var C,E;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:a=!0,usePublishState:o,status:s=Hl,drawDefinition:l,noDeepCopy:c,sortConfig:u,context:d,event:p}=t;if(!l)return{error:et};let h=(({matchUpFormat:P,updatedAt:M,drawType:N,drawName:R,drawId:A})=>({matchUpFormat:P,updatedAt:M,drawName:R,drawType:N,drawId:A}))(l),f,m,{allStructuresLinked:g,sourceStructureIds:v,hasDrawFeedProfile:y,structureGroups:I}=XA({drawDefinition:l});if(!g)return{error:fQ};let b=(t==null?void 0:t.publishStatus)??Qs({event:p,status:s}),D=t.eventPublished??!!((E=(C=jy({event:p}).publishState)==null?void 0:C.status)!=null&&E.published),w=!1,S=!1,U=I.map(P=>{let M={},N=P.map(R=>{let{structure:A}=Ut({drawDefinition:l,structureId:R}),{seedAssignments:_}=zs({drawDefinition:l,structure:A});return(A==null?void 0:A.stage)===it&&A.stageSequence===1&&(f=_),(A==null?void 0:A.stage)===mt&&A.stageSequence===1&&(m=_),A}).sort((R,A)=>xy(R,A,u)).map(R=>{var z;if(!R)return;let A=R==null?void 0:R.structureId,_=[];R.stage&&[it,ra,Rn].includes(R.stage)&&(_=f),(R==null?void 0:R.stage)===mt&&(_=m);let{matchUps:O,roundMatchUps:x,roundProfile:F}=Ti({seedAssignments:(z=R==null?void 0:R.seedAssignments)!=null&&z.length?void 0:_,context:{drawId:h.drawId,...d},tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:o,publishStatus:b,drawDefinition:l,inContext:a,structure:R,event:p}),{positionAssignments:$}=Bi({structure:R}),V=$==null?void 0:$.filter(jo(od)).map(H=>{let{drawPosition:K,participantId:q}=H,{extension:Y}=Vt({element:H,name:Hh});return S=!0,{participantResult:Y==null?void 0:Y.value,participantId:q,drawPosition:K}});if(!(V!=null&&V.length)&&O.length&&t.allParticipantResults){let{subOrderMap:H}=nne({positionAssignments:$}),K=T0({matchUpFormat:R.matchUpFormat,policyDefinitions:n,subOrderMap:H,matchUps:O});V=$==null?void 0:$.filter(jo(od)).map(q=>{let{drawPosition:Y,participantId:Z}=q;return S=!0,{participantResult:Z&&K.participantResults[Z],participantId:Z,drawPosition:Y}})}let G=R?(({stageSequence:H,structureName:K,structureType:q,matchUpFormat:Y,stage:Z})=>({stageSequence:H,structureName:K,structureType:q,matchUpFormat:Y,stage:Z}))(R):{};G.sourceStructureIds=v[A],G.hasDrawFeedProfile=y[A],G.positionAssignments=$,G.structureActive=O.reduce((H,K)=>{var Y;let q=[Wn,$p,fi,Ra,Pi,Bl,hr,Qn].includes(K.matchUpStatus);return H||q||!!K.winningSide||!!((Y=K.score)!=null&&Y.scoreStringSide1)},!1);let j=O.reduce((H,K)=>H&&[bi,Wn,Ra,Pi,fi,cs].includes(K.matchUpStatus),!!O.length);return G.structureCompleted=j,M[A]=j,G.structureActive&&(w=!0),{...G,participantResults:V,seedAssignments:_,roundMatchUps:x,roundProfile:F,structureId:A}});return N.forEach(R=>{var A;i||delete R.positionAssignments,R.sourceStructuresComplete=(A=R.sourceStructureIds)==null?void 0:A.every(_=>M[_])}),N}).flat();return h.drawActive=w,h.participantPlacements=S,h.drawGenerated=U==null?void 0:U.reduce((P,M)=>P||!!(M!=null&&M.roundMatchUps),!1),h.drawCompleted=U==null?void 0:U.reduce((P,M)=>P&&M.structureCompleted,!0),h.drawPublished=o?D&&_ae({publishStatus:b,drawId:h.drawId}):void 0,{structures:!o||h.drawPublished?c?U:at(U,!1,!0):void 0,drawInfo:c?h:at(h,!1,!0),...ne}}function S_(t){var M,N;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:n,usePublishState:r,status:a=Hl,sortConfig:o}=t,s=gi(t,[{tournamentRecord:!0},{[rj]:{event:!1,eventId:!1}}]);if(s.error)return s;let l=at(t.tournamentRecord,!1,!0),c=t.event?void 0:so({tournamentRecord:l,eventId:t.eventId}).event,u=t.event?at(t.event,!1,!0):c&&at(c,!1,!0)||void 0;if(!u)return{error:Bo};let{eventId:d}=u,{tournamentId:p,endDate:h}=l,f=Qs({event:u,status:a}),m=jy({event:u}).publishState??{},g=!!((M=m==null?void 0:m.status)!=null&&M.published),{participants:v}=xn({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:n,...i,tournamentRecord:l}),y=({stage:R,drawId:A})=>{var O,x,F;if(!r)return!0;let _=(x=(O=f==null?void 0:f.drawDetails)==null?void 0:O[A])==null?void 0:x.stageDetails;return!_||!Object.keys(_).length?!0:(F=_[R])==null?void 0:F.published},I=({structureId:R,drawId:A})=>{var O,x,F;if(!r)return!0;let _=(x=(O=f==null?void 0:f.drawDetails)==null?void 0:O[A])==null?void 0:x.structureDetails;return!_||!Object.keys(_).length?!0:(F=_[R])==null?void 0:F.published},b=({drawId:R})=>r?_ae({publishStatus:f,drawId:R}):!0,D=({drawId:R,structure:A})=>{var O,x,F,$;if(!r)return A;let _=($=(F=(x=(O=f==null?void 0:f.drawDetails)==null?void 0:O[R])==null?void 0:x.structureDetails)==null?void 0:F[A.structureId])==null?void 0:$.roundLimit;if(Mt(_)){let V=Ze(1,_+1),G={},j={};for(let z of V)A.roundMatchUps[z]&&(G[z]=A.roundMatchUps[z],j[z]=A.roundProfile[z]);A.roundMatchUps=G,A.roundProfile=j}return A},w=u.drawDefinitions||[],S=!r||g?w.filter(b).map(R=>(({drawInfo:A,structures:_})=>({...A,structures:_}))(w_({allParticipantResults:t.allParticipantResults,context:{eventId:d,tournamentId:p,endDate:h},includePositionAssignments:e,tournamentParticipants:v,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:l,usePublishState:r,drawDefinition:R,publishStatus:f,sortConfig:o,event:u}))).map(({structures:R,...A})=>{let _=R==null?void 0:R.filter(({stage:O,structureId:x})=>I({structureId:x,drawId:A.drawId})&&y({stage:O,drawId:A.drawId})).map(O=>D({drawId:A.drawId,structure:O}));return{...A,structures:_}}).filter(R=>{var A;return(A=R.structures)==null?void 0:A.length}):void 0,{tournamentInfo:U}=Zy({tournamentRecord:l}),C=(l.venues||[]).map(R=>(({venueData:A})=>({...A}))(zb({tournamentRecord:l,venueId:R.venueId}))),E=(({eventId:R,eventName:A,eventType:_,eventLevel:O,surfaceCategory:x,matchUpFormat:F,category:$,gender:V,startDate:G,endDate:j,ballType:z,discipline:H})=>({eventId:R,eventName:A,eventType:_,eventLevel:O,surfaceCategory:x,matchUpFormat:F,category:$,gender:V,startDate:G,endDate:j,ballType:z,discipline:H}))(u),P={tournamentInfo:U,venuesData:C,eventInfo:E,drawsData:S};return P.eventInfo.publishState=m,P.eventInfo.published=(N=m==null?void 0:m.status)==null?void 0:N.published,{...ne,eventData:P,participants:v}}var kae={};Gt(kae,{getPersonRequests:()=>wg,getProfileRounds:()=>D_,getScheduledRoundsDetails:()=>gP,getSchedulingProfile:()=>qp,getSchedulingProfileIssues:()=>EH});function T_({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Ho({matchUpFormat:n}))return{error:mD};let c=Object.keys(i).filter(d=>!o||d===o),u;return c.forEach(d=>{var f;if(u)return;let p=i[d],h=l?(f=so({tournamentRecord:p,eventId:l}))==null?void 0:f.event:void 0;return u=jD({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:h}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function gP({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if(typeof i!="object")return{error:Pn};if(!Array.isArray(a))return{error:ut,info:gd("rounds")};let o={},s=[];a.sort((p,h)=>(p.sortOrder??0)-(h.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>h0({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=Cc({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var D;let h=p.periodLength||n,f=[];e!=null&&e[p.structureId]?f.push(...e[p.structureId]):f.push(p.structureId);let m=r?ov({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:f,matchUps:r}).sort(Vy):[],{segmentNumber:g,segmentsCount:v}=p.roundSegment||{};if(Mt(g)&&Pc(m==null?void 0:m.length)&&Pc(v)&&g>0&&g<=v&&v<(m==null?void 0:m.length)&&!((D=p.matchUpIds)!=null&&D.length)){let w=m.length/v,S=w*(g-1);m=m.slice(S,S+w)}let y=i[p.tournamentId],I=so({drawId:p.drawId,tournamentRecord:y}).event,b=[];for(let w of m){let S=w.matchUpFormat;S&&(o[S]||(o[S]=[],o[S].push(w)),b.push(S))}for(let w of b){let{eventType:S,category:U}=I??{},{categoryName:C,ageCategoryCode:E}=U??{},{typeChangeRecoveryMinutes:P,recoveryMinutes:M,averageMinutes:N,error:R}=T_({categoryName:C??E,categoryType:U==null?void 0:U.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:S});if(R)return{error:R,round:p};let A=m.filter(O=>(t||!gr.includes(O.matchUpStatus))&&O.matchUpStatus!==bi).map(Pr);A.forEach(O=>{d[O]={typeChangeRecoveryMinutes:P,recoveryMinutes:M,averageMinutes:N},c[O]=M,u[O]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${h}`;return{roundPeriodLength:h,recoveryMinutes:M,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...ne}}function Oae({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(s=>{let l=xt(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),o=r.length;return{updatedSchedulingProfile:a,modifications:o,issues:r}}function U_({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:ve};let{venueIds:i,tournamentsMap:n}=mNe({tournamentRecords:t}),r,a,o=e.every(s=>{let{scheduleDate:l,venues:c}=s;return ss(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var U,C,E,P;if(!h)return a="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:I}=h,b=(P=(E=(C=(U=n==null?void 0:n[m])==null?void 0:U[y])==null?void 0:C[I])==null?void 0:E[g])==null?void 0:P.includes(v);b||(a="Invalid rounds");let{segmentNumber:D,segmentsCount:w}=f||{},S=!f||Mt(D)&&Pc(w)&&D<=w;return S||(a="Invalid segment"),b&&S}):(r=t0,!1):(a="rounds should be an array",!1)}):!1});return!o&&!r&&(r=ve),{valid:!!o,error:r,info:a}}function fNe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;o.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;s.push(h),i[c][d][h]={};let{structures:f}=fd({drawDefinition:p});(f||[]).forEach(m=>{var b;let g=m.structureId,{matchUps:v}=Ti({structure:m}),{roundMatchUps:y}=Wa({matchUps:v}),I=y&&Object.keys(y).map(D=>parseInt(D));i[c][d][h][g]=I,a.push(g),(b=m.structures)!=null&&b.length&&m.structures.forEach(D=>{a.push(D.structureId),i[c][d][h][D.structureId]=I})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function mNe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=fNe({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}function qp({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Pn};let{extension:i}=Vt({element:e,name:Wv,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=mP({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=OG({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=Oae({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:o});if(l){n=s;let u=U0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function U0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=U_({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?ci({tournamentRecords:t,discover:!0,extension:{name:Wv,value:i}}):Ba({element:e,name:Wv,tournamentRecords:t,discover:!0})}function vP(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=qp({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=mP({tournamentRecords:i}),{eventIds:r,drawIds:a}=OG({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=Oae({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...U0({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...ne,modifications:s,issues:l}}function EH(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:pD};if(!Array.isArray(e))return{error:ve};if(!e.every(ss))return{error:Ha};let r=[],a=0,o={},{schedulingProfile:s}=qp({tournamentRecords:i});if(!s)return{issues:r,...ne};let{matchUps:l}=Cc({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=gP({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=zl({tournamentRecords:i,matchUps:l}),I=b=>{let D;return v==null||v.find((w,S)=>{let U=w.matchUpIds.includes(b);return U&&(D=S),U}),D};if(g==null||g.forEach((b,D)=>{var U;let w=g.slice(D+1),S=kn(w,((U=y==null?void 0:y[b])==null?void 0:U.matchUpIds)||[]);S.length&&m.push({matchUpId:b,shouldBeAfter:S})}),m.length){a+=m.length;let b=m.map(({matchUpId:D,shouldBeAfter:w})=>{let S=I(D),U=Ft(w.map(I));return o[d]||(o[d]={}),o[d][S]||(o[d][S]=[]),U.forEach(C=>{o[d][S].includes(C)||o[d][S].push(C)}),{matchUpId:D,matchUpRoundIndex:S,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...b)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:o,...ne}}function wg(t){let{tournamentRecords:e,requestType:i}=t,n=gi(t,[{[ba]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:o}=Vt({element:a,name:c0}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...ne}}function _$(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,c=n?e:o,u=[r,s,l,c,a].join("|");return ht({structureId:c,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:u})}function PK({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:c}=o||{},u=Vo(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=T_({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function gNe(t){return(t||[]).reduce((e,i)=>{var a,o;let n=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).reduce((s,l)=>s+l,0),r=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function CK(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||gr.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==bi).length||0,a=e-i,o=a===n,s=a-r,l=a-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:o,byeCount:i}}function D_({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:pD};t={[i.tournamentId]:i}}if(e){let a=U_({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=qp({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Ia};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var u;let c=_$(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(r[c.id]=c.roundSegment.segmentsCount),ht({id:n?c.id:void 0,scheduleDate:o,...c})}))).flat(1/0),segmentedRounds:r}}var xae={};Gt(xae,{getEntriesAndSeedsCount:()=>P_,getMaxEntryPosition:()=>MH});function P_({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:Ai};let{entries:o,stageEntries:s}=cie({drawDefinition:e,drawId:n,stage:a,event:r}),l=s.length,{drawSize:c}=_ne({participantsCount:l}),u=fP({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return ae({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:o,seedsCount:d,stageEntries:s}}function MH(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>wt(r||0)),0)}var Lae={};Gt(Lae,{allCompetitionMatchUps:()=>Cc,allDrawMatchUps:()=>no,allEventMatchUps:()=>Hp,allTournamentMatchUps:()=>Br,analyzeMatchUp:()=>uU,calculateWinCriteria:()=>Xy,checkMatchUpIsComplete:()=>Sm,competitionScheduleMatchUps:()=>IP,drawMatchUps:()=>BH,eventMatchUps:()=>E_,getAllDrawMatchUps:()=>sr,getAllStructureMatchUps:()=>Ti,getCheckedInParticipantIds:()=>Fy,getCompetitionMatchUps:()=>cU,getEventMatchUpFormatTiming:()=>NH,getMatchUpCompetitiveProfile:()=>BD,getMatchUpContextIds:()=>xH,getMatchUpDailyLimits:()=>R_,getMatchUpDailyLimitsUpdate:()=>AH,getMatchUpDependencies:()=>zl,getMatchUpFormat:()=>LH,getMatchUpFormatTiming:()=>jD,getMatchUpFormatTimingUpdate:()=>RH,getMatchUpScheduleDetails:()=>jA,getMatchUpType:()=>GA,getMatchUpsStats:()=>FH,getModifiedMatchUpFormatTiming:()=>C_,getParticipantResults:()=>sP,getPredictiveAccuracy:()=>OH,getRoundMatchUps:()=>Wa,getRounds:()=>$H,isValidMatchUpFormat:()=>Ho,matchUpActions:()=>l_,participantScheduledMatchUps:()=>_H,tallyParticipantResults:()=>T0,tournamentMatchUps:()=>M_,validMatchUp:()=>FA,validMatchUps:()=>Js});function Fae({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Pn};let i=[],n;for(let r of Object.values(t)){let{extension:a}=Vt({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let o=r.events??[];for(let s of o){let{eventId:l}=s,{extension:c}=Vt({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function RH({tournamentRecords:t}){return Fae({extensionName:hp,tournamentRecords:t})}var cL="ADULT",uL="JUNIOR",FE="WHEELCHAIR",$ae={[wf]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Wi]:30,default:60}}]},defaultDailyLimits:{[Tn]:2,[Wi]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[_s],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[FE],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[cL,FE],minutes:{default:60,[Wi]:30}},{categoryTypes:[uL],minutes:{default:60,[Wi]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[cL,FE],minutes:{default:30}},{categoryTypes:[uL],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[cL,uL],minutes:{default:30}},{categoryTypes:[FE],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},vNe=$ae;function NH({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Ai};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&Ho({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=hg({policyType:ud,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=Vt({name:hp,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=vNe[wf],r=Ft([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:Ai};let u=r.map(({matchUpFormat:d,description:p})=>{let h=jD({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:o,event:n});return{matchUpFormat:d,description:p,...h}});return ht({eventMatchUpFormatTiming:u,info:a})}function C_(t){let e=gi(t,[{[Rd]:!0},{[uc]:m=>Ho({matchUpFormat:m}),[sd]:mD,[QV]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=Vt({name:hp,element:r}),o=a==null?void 0:a.value,{extension:s}=Vt({element:i,name:hp}),l=s==null?void 0:s.value,c=(o==null?void 0:o.matchUpAverageTimes)&&sT({...o,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&sT({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(o==null?void 0:o.matchUpRecoveryTimes)&&lT({...o,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&lT({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function AH({tournamentRecords:t}){return Fae({extensionName:DD,tournamentRecords:t})}var yP=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function _H({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!Js(e))return{error:Md};if(!Array.isArray(t))return{error:ve};let i=e.filter(Boolean).filter(({schedule:n})=>yP({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,o=xt(a==null?void 0:a.scheduledDate),s=tn(a==null?void 0:a.scheduledTime);return o&&s&&(n[o]?n[o].push(r):n[o]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var o,s;return Oee(tn((o=r.schedule)==null?void 0:o.scheduledTime),tn((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...ne,scheduledMatchUps:i}}function yNe({tournamentRecords:t}){var n;let e=[],i={};for(let r of Object.values(t))for(let a of r.events??[]){let o=Qs({event:a}),s=o==null?void 0:o.drawDetails;Zi(s)?(Object.assign(i,s),e.push(...Object.keys(s).filter(l=>cG({drawId:l,drawDetails:s})))):(n=o==null?void 0:o.drawIds)!=null&&n.length&&e.push(...o.drawIds)}return{drawIds:e,detailsMap:i}}function hR({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&xt(l.scheduledDate)||l.scheduledTime&&xt(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&tn(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function kH({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:ve};let n=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>o?c:o},1),r=e?Math.max(e,n):n,a=Ze(0,r).map(o=>({matchUps:Ze(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:o+1,venueId:u,courtId:c}}})}));return i.forEach((o,s)=>{var l;for(let c of o.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}function E_(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:Ai};let{eventId:b,eventName:D,endDate:w,eventType:S,category:U,gender:C}=I??{},E={...y,...ht({surfaceCategory:I.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:D,eventType:S,category:U,eventId:b,gender:C})},P;!e&&u&&({participants:e,participantMap:n,groupInfo:P}=By({participantsProfile:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=Gp({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:I}));let M=Qs({event:I});return{...(I.drawDefinitions??[]).reduce((N,R)=>{var _;let A=y0({context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:M,contextProfile:f,drawDefinition:R,nextMatchUps:m,inContext:v,event:I});return(_=Object.keys(A))==null||_.forEach(O=>{Array.isArray(A[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(A[O]))}),N},{}),...ne,groupInfo:P}}function M_(t){if(!(t!=null&&t.tournamentRecord))return{error:Re};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:I}=By({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=Gp({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=Ei({tournamentRecord:s}),D=(u==null?void 0:u.eventIds)??[];return{...g.filter(w=>!D.includes(w.eventId)).map(w=>{var U,C,E;let S={eventDrawsCount:((C=(U=Bn({event:w}).flightProfile)==null?void 0:U.flights)==null?void 0:C.length)||((E=w.drawDefinitions)==null?void 0:E.length)||0,...f};return E_({context:S,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:h,inContext:l,event:w})}).reduce((w,S)=>{var U;return(U=S&&Object.keys(S).filter(C=>!["success","matchUpsMap"].includes(C)))==null||U.forEach(C=>{Array.isArray(S[C])&&(w[C]||(w[C]=[]),w[C]=w[C].concat(S[C]),w.matchUpsCount+=S[C].length)}),w},{matchUpsCount:0}),groupInfo:I}}function cU({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Pn};let c=Object.keys(i).map(d=>{let p=i[d];return M_({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(h=>{Array.isArray(p[h])&&(d[h]||(d[h]=[]),d[h]=d[h].concat(p[h])),h==="groupInfo"&&Object.assign(u,p[h])}),d),{}),groupInfo:u}}function IP(t){var P,M,N,R,A,_,O,x;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Pn};let{courts:e,venues:i}=Wp(t),n=qp(t).schedulingProfile,{sortDateMatchUps:r=!0,courtCompletedMatchUps:a,alwaysReturnCompleted:o,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=Hl,sortCourtsData:h}=t,f=d?(M=(P=WD({tournamentRecord:l[s??Ay()],itemType:`${fg}.${mg}`}).timeItem)==null?void 0:P.itemValue)==null?void 0:M[p]:void 0,m=o?cU({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[Wn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&(!f||!Object.keys(f).length))return{completedMatchUps:m,dateMatchUps:[],courtsData:[],venues:i};let g,v;d&&({drawIds:g,detailsMap:v}=yNe({tournamentRecords:l})),g!=null&&g.length&&(t.contextFilters||(t.contextFilters={}),(N=t.contextFilters)!=null&&N.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>g.includes(F)):t.contextFilters.drawIds=g),(R=f==null?void 0:f.eventIds)!=null&&R.length&&(t.matchUpFilters||(t.matchUpFilters={}),(A=t.matchUpFilters)!=null&&A.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>f.eventIds.includes(F)):t.matchUpFilters.eventIds=f.eventIds),(_=f==null?void 0:f.scheduledDates)!=null&&_.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>f.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=f.scheduledDates),o&&(t.matchUpFilters||(t.matchUpFilters={}),(x=(O=t.matchUpFilters)==null?void 0:O.excludeMatchUpStatuses)!=null&&x.length?t.matchUpFilters.excludeMatchUpStatuses.includes(Wn)||t.matchUpFilters.excludeMatchUpStatuses.push(Wn):t.matchUpFilters.excludeMatchUpStatuses=[Wn]);let{completedMatchUps:y,upcomingMatchUps:I,pendingMatchUps:b,groupInfo:D}=cU({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),w=[...I??[],...b??[]];v&&Object.keys(v).length&&(w=w.filter(F=>{let{drawId:$,structureId:V,stage:G}=F;if(!v[$])return!1;if(v[$].stageDetails){let j=Object.keys(v[$].stageDetails),z=j.filter(K=>!v[$].stageDetails[K].published),H=j.filter(K=>v[$].stageDetails[K].published);return z.length&&z.includes(G)?!1:H.length&&H.includes(G)?!0:z.length&&!z.includes(G)&&!H.length}if(v[$].structureDetails){let j=Object.keys(v[$].structureDetails),z=j.filter(K=>!v[$].structureDetails[K].published),H=j.filter(K=>v[$].structureDetails[K].published);return z.length&&z.includes(V)?!1:H.length&&H.includes(V)?!0:z.length&&!z.includes(V)&&!H.length}return!0}));let S=r?hR({matchUps:w,schedulingProfile:n}):w,U=e==null?void 0:e.map(F=>{let $=E(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:$,...F}}),C={completedMatchUps:o?m:y,dateMatchUps:S,courtsData:U,groupInfo:D,venues:i};if(c){let{rows:F,courtPrefix:$}=kH({minRowsCount:u,courtsData:U});C.courtPrefix=$,C.rows=F}return{...C,...ne};function E({courtId:F}){let $=(a?S.concat(y??[]):S).filter(V=>{var G,j,z;return((G=V.schedule)==null?void 0:G.courtId)===F||((z=(j=V.schedule)==null?void 0:j.allocatedCourts)==null?void 0:z.map(({courtId:H})=>H).includes(F))});return h?hR({matchUps:$,schedulingProfile:n}):$}}function R_({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Pn};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:o}=INe({tournamentRecord:a});n=o}),{matchUpDailyLimits:n}}function INe(t){var s;let e=gi(t,[{[Rd]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:n}=hg({policyType:wf,tournamentRecord:i}),{extension:r}=Vt({element:i,name:DD}),a=(s=r==null?void 0:r.value)==null?void 0:s.dailyLimits,o=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:a||o}}function OH(t){var R,A,_,O;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:n,drawDefinition:r,excludeMargin:a,exclusionRule:o,zoneDoubling:s,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:h}=t;if(!n&&!e)return{error:Re};if(l&&![Tn,Wi].includes(l))return{error:ve,info:{matchUpType:l}};if(e&&!Js(e))return{error:ve,context:{matchUps:e}};let f=ns[c],m=(f==null?void 0:f.ascending)??t.ascending??!1,g=(f==null?void 0:f.accessor)??t.valueAccessor,v=Array.isArray(f==null?void 0:f.range)?Math.abs(f.range[0]-f.range[1]):0,y=Mt(d)&&v?(d??0/100)*v:t.zoneMargin??v,I={withScaleValues:!0,withCompetitiveness:!0},b={matchUpTypes:l?[l]:[Tn,Wi]},D=n==null?void 0:n.participants;(R=e==null?void 0:e[0])!=null&&R.hasContext?p?e=e.filter(x=>x.drawId===p):u&&(e=e.filter(x=>x.eventId===u)):e===void 0&&(e=p&&!r&&[]||!p&&u&&!h&&[]||p&&((A=no({inContext:!0,drawDefinition:r,contextFilters:b,contextProfile:I,participants:D}))==null?void 0:A.matchUps)||!p&&u&&((_=Hp({inContext:!0,contextFilters:b,contextProfile:I,participants:D,event:h}))==null?void 0:_.matchUps)||((O=Br({tournamentRecord:n,contextFilters:b,contextProfile:I}))==null?void 0:O.matchUps)||[]),l&&(e=e.filter(x=>x.matchUpType===l));let w=e.filter(({winningSide:x,score:F,sides:$,matchUpStatus:V})=>![Ra,fi,Pi,u0,cs].includes(V??"")&&Vr({score:F})&&($==null?void 0:$.length)===2&&x),S=wNe({matchUps:w,excludeMargin:a,exclusionRule:o,valueAccessor:g,ascending:m,scaleName:c}),U=!s||An(Tn)(l)?y:(y||0)*2,C=y?w.map(({competitiveProfile:x,matchUpType:F,score:$,sides:V})=>{let G=Bae({singlesForDoubles:i,valueAccessor:g,matchUpType:F,scaleName:c,sides:V}),j=Math.abs(G[0].value-G[1].value);return{competitiveness:x==null?void 0:x.competitiveness,valuesGap:j,score:$}}).filter(({valuesGap:x})=>x<=U):[],E=bNe({zoneData:C}),P=E&&[].concat(Object.values(E)).flat().length,M=P&&Object.assign({},...Object.keys(E).map(x=>({[x]:Math.round(1e4*E[x].length/P)/100}))),N=w.length-((C==null?void 0:C.length)||0);return{...ne,relevantMatchUps:w,zoneDistribution:M,zoneData:C,accuracy:S,nonZone:N}}function bNe({zoneData:t}){let e={[Yj]:[],[tU]:[],[iU]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function Bae({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=o[0]&&c<=o[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=EK({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=EK({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=s(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function EK({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var c,u,d,p,h;let a=t?Tn:i,o=(u=(c=n==null?void 0:n.rankings)==null?void 0:c[a])==null?void 0:u.find(f=>f.scaleName===r),s=(h=((p=(d=n==null?void 0:n.ratings)==null?void 0:d[a])==null?void 0:p.find(f=>f.scaleName===r))||o)==null?void 0:h.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function wNe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:ut};let f=h-1,m=Bae({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let D=m.map(({exclusionValues:w})=>w).flat();if(D.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:D,winningSide:h,sideValues:m});continue}}if(m.filter(D=>![void 0,"",null].includes(D.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let I=n?g:g*-1,b=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:h,sideValues:m,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:h,sideValues:m,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function Xy({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=one({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=s&&n.includes(s);if(Mt(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&Mt(l))i+=l;else if(o!=null&&o.length)for(let f of o)i+=f.matchUpValue;else typeof u=="number"&&Mt(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...ne}:{valueGoal:Math.floor(i/2)+1,...ne}}function xH({matchUps:t,matchUpId:e}){if(!Js(t))return{error:ve};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}}function bP(t,e){if(!Zi(t))return{error:ve};if(!Array.isArray(e))return{error:ve};let i={};for(let{param:n,error:r,attr:a}of e){let o=SNe({params:t,param:n,attr:a,error:r});if(o!=null&&o.error)return o;i[n]=o}return i}function SNe({params:t,param:e,attr:i,error:n}){if(e===nj&&Zi(t.drawDefinition)&&Ga(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===If){let r=Mae({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Ia,info:{param:e}}}function LH(t){var p,h;let{structureId:e,matchUpId:i,event:n}=t,r=t.drawDefinition,a=gi(t,[{[Rd]:!0},{[rj]:{[ej]:!1,[sg]:!1,[Ree]:!1,[r0]:!1}}]);if(a[mv])return a;let o=(p=bP(t,[{[SD]:If,[mv]:ut}]))==null?void 0:p.matchUp;if(i&&(o!=null&&o.error))return o;!r&&(o!=null&&o.drawDefinition)&&(r=o==null?void 0:o.drawDefinition);let s=o==null?void 0:o.structure;if(!s&&e&&!i){if(!r)return{error:xc};let f=Ut({drawDefinition:r,structureId:e});if(f.error)return f;s=f.structure}let l=s==null?void 0:s.matchUpFormat,c=r==null?void 0:r.matchUpFormat,u=n==null?void 0:n.matchUpFormat,d=((h=o==null?void 0:o.matchUp)==null?void 0:h.matchUpFormat)||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function FH({profileBands:t,tournamentRecord:e,matchUps:i}){if(!Js(i))return{error:Md};let n=!t&&hg({policyType:Zd,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||Zj[Zd].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(vte),s=(p,h)=>{let f=gte(h,r);return p[f]+=1,p},l=yte(o).reduce((p,h)=>s(p,h),{[Yj]:0,[tU]:0,[iU]:0,[mte]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===K7).length;return u.push({[K7]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...ne}}var{stageOrder:MK}=RPe;function TNe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(MK[t==null?void 0:t.stage]||0)-(MK[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function $H({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var w;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:ve,inContextMatchUps:n};if(o&&!r){if(typeof o!="object")return{error:pD};r={[o.tournamentId]:o}}let h=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!a&&(t||i||a||s))&&h)return{error:Pn};let f=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S==null?void 0:S.map(({venueId:C})=>C)}))),m=Object.values(r??{}).map(({events:S=[],tournamentId:U,startDate:C,endDate:E})=>S.map(P=>({...P,validVenueIds:f[U],startDate:P.startDate??C,endDate:P.endDate??E}))).flat(),{segmentedRounds:g,profileRounds:v}=r&&(t||i||a||s)&&D_({tournamentRecords:r,schedulingProfile:a})||{},y=t&&Object.assign({},...v.map(S=>({[S.id]:S}))),I=n||r&&((w=Cc({tournamentRecords:r,matchUpFilters:l}))==null?void 0:w.matchUps)||[],b=[],D=I&&Object.values(I.reduce((S,U)=>{var q;let C=_$(U).id,E=g==null?void 0:g[C],P=[...((q=S[C])==null?void 0:q.matchUps)??[],U],{containerStructureId:M,stageSequence:N,structureName:R,tournamentId:A,isRoundRobin:_,matchUpType:O,roundNumber:x,roundOffset:F,structureId:$,eventName:V,roundName:G,drawName:j,eventId:z,drawId:H}=U,K=_?M:$;return{...S,[C]:{id:u?C:void 0,structureId:K,stageSequence:N,segmentsCount:E,structureName:R,tournamentId:A,matchUpType:O,roundNumber:x,roundOffset:F,eventName:V,roundName:G,drawName:j,matchUps:P,eventId:z,drawId:H}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:C}=gNe(S.matchUps),E=S.segmentsCount;if(E){let x=S.matchUps.length/E;return Fr(S.matchUps.sort((F,$)=>F.roundPosition-$.roundPosition),x).map((F,$)=>{let{unscheduledCount:V,incompleteCount:G,matchUpsCount:j,isScheduled:z,isComplete:H,byeCount:K}=CK(F),q=PK({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return ht({...S,...p,roundSegment:{segmentsCount:E,segmentNumber:$+1},winnerFinishingPositionRange:C,unscheduledCount:V,incompleteCount:G,minFinishingSum:U,matchUpsCount:j,isScheduled:z,roundTiming:q,isComplete:H,byeCount:K,matchUps:F})})}let{unscheduledCount:P,incompleteCount:M,matchUpsCount:N,isScheduled:R,isComplete:A,byeCount:_}=CK(S.matchUps),O=PK({matchUps:S.matchUps,tournamentRecords:r,events:m,round:S});return ht({...S,...p,winnerFinishingPositionRange:C,unscheduledCount:P,incompleteCount:M,minFinishingSum:U,matchUpsCount:N,isScheduled:R,roundTiming:O,isComplete:A,byeCount:_})}).flat().filter(S=>{if(t){let $=xt(t),V=u?S.id:_$(S).id;if($&&y[V]&&xt(y[V].scheduleDate)===$)return!1}let{isComplete:U,isScheduled:C}=S,E=!i||!U,P=!e||!C,M=d||c?m==null?void 0:m.find(({eventId:$})=>$===S.eventId):void 0,N=(M==null?void 0:M.startDate)??(o==null?void 0:o.startDate),R=(M==null?void 0:M.endDate)??(o==null?void 0:o.endDate),A=!c||!N||new Date(c)>=new Date(N),_=!c||!R||new Date(c)<=new Date(R),O=A&&_,x=!d||(M==null?void 0:M.validVenueIds.includes(d)),F=E&&P&&x&&O;return F||b.push(S),F}).sort(TNe)||[];return{...ne,rounds:D,excludedRounds:b}}function uU(t){var z;let{matchUp:e,sideNumber:i,setNumber:n,isTiebreakValue:r,isPointValue:a}=t||{},{matchUpFormat:o}=t||{};if(!e)return{error:To};o=o||(e==null?void 0:e.matchUpFormat);let s=fo(o),l=!!(e!=null&&e.winningSide),c=(z=e.score)==null?void 0:z.sets,u=c==null?void 0:c.length,d=n&&n-1,p=!!(c!=null&&c.find((H,K)=>H.setNumber===n&&K===d)),h=(c==null?void 0:c.filter(H=>H==null?void 0:H.winningSide))||[],f=(h==null?void 0:h.length)||0,m=n&&(c==null?void 0:c.slice(n))||[],g=!!(u&&n&&(m!=null&&m.reduce((H,K)=>(!K||!K.side1Score&&!K.side2Score&&!K.side1TiebreakScore&&!K.side2TiebreakScore&&!K.side1PointScore&&!K.side2PointScore)&&H,!0))),v=n<=u&&c.find(H=>H.setNumber===n),y=v&&lU({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:I,sideGameScores:b,sideTiebreakScores:D}=y||{},w=!!(v&&!I&&g||n&&n===u+1&&!l),S=[1,2].includes(i),U=S?i-1:0,C=v&&S&&(!r&&!a&&b[U]!==void 0&&b[U]||r&&D[U]!==void 0&&D[U]),E=!!C,P=h==null?void 0:h.map(H=>lU({setObject:H,matchUpScoringFormat:s}).isValidSetOutcome).reduce((H,K)=>H&&K,!0),M=h.reduce((H,K)=>{let{winningSide:q}=K,Y=q-1;return H[Y]++,H},[0,0]),N=e==null?void 0:e.winningSide,R=N&&N-1,A=1-R,_=M[R],O=M[A],x=Math.max(...M),F=Vo(M)[x],{bestOf:$}=s??{},V=$&&Math.ceil($/2)||1,G=x===V&&F===1&&M.indexOf(x)+1||void 0,j=_>O&&N===G;return{completedSetsHaveValidOutcomes:P,validMatchUpWinningSide:j,calculatedWinningSide:G,matchUpScoringFormat:s,validMatchUpOutcome:G&&P&&j,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:S,hasExistingValue:E,existingValue:C,isExistingSet:p,isActiveSet:w,...y}}function BH({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:D,eventName:w,endDate:S,eventType:U,category:C,gender:E}=b??{},P={...I,...ht({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:S??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:U,category:C,eventId:D,gender:E})},M;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:M}=By({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:y})),b&&f&&!u&&(u=Gp({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:m,event:b})),{...y0({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:b}),groupInfo:M}}var Vae={};Gt(Vae,{getCompetitionVenues:()=>mP,getCourts:()=>VH,getVenuesAndCourts:()=>Wp,publicFindVenue:()=>tG});function VH({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=at(n.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:r})),a}).flat()}:{error:Re}}var jae={};Gt(jae,{categoryCanContain:()=>i_,getCategoryAgeDetails:()=>lP,getEvent:()=>HH,getEventProperties:()=>jH,getEventStructures:()=>ZA,getEventTimeItem:()=>zD,getEvents:()=>GH,getFlightProfile:()=>Bn,getScaledEntries:()=>Yy});function jH({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:Re};if(!e)return{error:Ai};let i=e.entries||[],n=t.participants||[],r=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:a}=e,o=i.map(h=>h.participantId),s=n.filter(h=>o.includes(h.participantId)),l,c,u;return{entryScaleAttributes:s.map(h=>{var D,w,S,U,C,E;let{participantId:f,participantName:m,name:g}=h,v={scaleType:Qj,eventType:a,scaleName:r},y=(w=(D=Yu({participant:h,scaleAttributes:v}))==null?void 0:D.scaleItem)==null?void 0:w.scaleValue;v={scaleType:Ete,eventType:a,scaleName:r};let I=(U=(S=Yu({participant:h,scaleAttributes:v}))==null?void 0:S.scaleItem)==null?void 0:U.scaleValue;v={scaleType:Cte,eventType:a,scaleName:r};let b=(E=(C=Yu({participant:h,scaleAttributes:v}))==null?void 0:C.scaleItem)==null?void 0:E.scaleValue;return l=!!(l||y),c=!!(c||I),u=!!(u||b),{participantId:f,participantName:m||g,seed:y,ranking:I,rating:b}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function GH({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var u,d,p,h;if(!t)return{error:Re};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var v;let m=(v=f.drawDefinitions)==null?void 0:v.map(KT);if(a!=null&&a.length&&!kn(a,m).length)return;let g=at(f);return n&&Object.assign(g,{tournamentId:s}),o&&Object.assign(g,o),g}).filter(Boolean),c={};if(e){let f=xn({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;c[y]||(c[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:E})=>jl.includes(E)).map(qt),b=E=>{var P,M,N,R,A,_;if((P=E==null?void 0:E.ratings)!=null&&P[v])for(let O of((M=E==null?void 0:E.ratings)==null?void 0:M[v])??[]){let x=O.scaleName;c[y].ratings[x]||(c[y].ratings[x]=[]);let F=(N=ns[x])==null?void 0:N.accessor;if(F){let $=parseFloat((R=O.scaleValue)==null?void 0:R[F]);$&&c[y].ratings[x].push($)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let O of((_=E==null?void 0:E.rankings)==null?void 0:_[v])??[]){let x=O.scaleName;c[y].ranking[x]||(c[y].ranking[x]=[]),O.scaleValue&&c[y].ranking[x].push(O.scaleValue)}};for(let E of I){let P=(u=f==null?void 0:f[E])==null?void 0:u.participant;if((P==null?void 0:P.participantType)!==Kt)for(let M of(P==null?void 0:P.individualParticipantIds)??[]){let N=(d=f==null?void 0:f[M])==null?void 0:d.participant;b(N)}else b(P)}let D=c[y].ratings;for(let E of Object.keys(D)){let P=D[E];if(!P.length)continue;let M=(p=H7(P))==null?void 0:p.toFixed(2);c[y].ratingsStats[E]={avg:parseFloat((m(P)/P.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...P),min:Math.min(...P)}}let w=(E,P)=>{var N,R;let M=A=>{var _,O,x,F,$,V,G,j,z,H;if((_=c[y].draws)!=null&&_[E]&&((O=A==null?void 0:A.ratings)!=null&&O[v]))for(let K of((x=A==null?void 0:A.ratings)==null?void 0:x[v])??[]){let q=K.scaleName;(F=c[y].draws[E])!=null&&F.ratings[q]||(c[y].draws[E].ratings[q]=[]);let Y=($=ns[q])==null?void 0:$.accessor;if(Y){let Z=parseFloat((V=K.scaleValue)==null?void 0:V[Y]);Z&&c[y].draws[E].ratings[q].push(Z)}}if((G=c[y].draws)!=null&&G[E]&&((j=A==null?void 0:A.rankings)!=null&&j[v]))for(let K of((z=A==null?void 0:A.rankings)==null?void 0:z[v])??[]){let q=K.scaleName;(H=c[y].draws[E])!=null&&H.ranking[q]||(c[y].draws[E].ranking[q]=[]);let Y=K.scaleValue;Y&&c[y].draws[E].ranking[q].push(Y)}};for(let A of P.filter(Boolean)){let _=(N=f==null?void 0:f[A])==null?void 0:N.participant;if((_==null?void 0:_.participantType)!==Kt)for(let O of(_==null?void 0:_.individualParticipantIds)??[]){let x=(R=f==null?void 0:f[O])==null?void 0:R.participant;M(x)}else M(_)}},S=[],U=E=>(a==null?void 0:a.length)&&a.includes(E)||S.includes(E);for(let E of g.drawDefinitions??[]){let P=E.drawId;if(U(P))continue;let M=yg({drawDefinition:E}).assignedParticipantIds??[];c[y].draws[P]||(c[y].draws[P]={ratingsStats:{},ratings:{},ranking:{}}),S.push(P),w(P,M)}let C=Bn({event:g}).flightProfile;for(let E of(C==null?void 0:C.flights)??[]){let P=E.drawId;if(U(P))continue;let M=E.drawEntries.map(qt);w(P,M)}for(let E of S){let P=c[y].draws[E].ratings;for(let M of Object.keys(P)){let N=P[M];if(!N.length)continue;let R=(h=H7(N))==null?void 0:h.toFixed(2);c[y].draws[E].ratingsStats[M]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return ht({eventScaleValues:c,events:l,...ne})}function HH({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var o;if(!t)return{error:Re};if(!n)return{error:Ai};let r=at(n);i&&Object.assign(r,i);let a=e&&((o=r.drawDefinitions)==null?void 0:o.find(({drawId:s})=>e.drawId===s));return ht({drawDefinition:a,event:r})}function UNe(t){var h,f;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:n}=CNe(t),r=ENe({...t,policyDefinitions:n,appliedPolicies:i}),a=PNe(t),o=MNe({...t,consideredEntries:a,appliedPolicies:i});if(o!=null&&o.error)return ae({result:o,stack:e});let s=RNe({...t,consideredEntries:a}),l=DNe({...t,appliedPolicies:i,policyDefinitions:n,drawSize:s});if(l.error)return ae({result:l,stack:e});let c=l.drawType;if(isNaN(s)&&c!==Rl)return ae({result:{error:fD},stack:e});let u=(n==null?void 0:n[hl])??(i==null?void 0:i[hl]),d=t.seedingProfile??((f=(h=u==null?void 0:u.seedingProfile)==null?void 0:h.drawTypes)==null?void 0:f[c??""])??(u==null?void 0:u.seedingProfile);t.seedingProfile&&(n[hl]||(n[hl]={...A$[hl]}),n[hl].seedingProfile=d);let p=NNe({...t,drawType:c});return p!=null&&p.error?ae({result:p,stack:e}):{drawSize:s,drawType:c,enforceGender:r,seedingProfile:d,appliedPolicies:i,policyDefinitions:n}}function DNe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??hP({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=One({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}function Gae(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...jl,FD].includes(e.entryStatus))}function PNe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||Gae(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===it)}function CNe(t){let{tournamentRecord:e,event:i}=t,n=Ei({tournamentRecord:e,event:i}).appliedPolicies??{},r=at(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function ENe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,o;return t??((r=(n=e==null?void 0:e[_r])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((o=(a=i==null?void 0:i[_r])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function MNe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=t;return s&&o&&c_({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}function RNe(t){return!t.drawSize&&t.consideredEntries.length&&![Rl,CD,d0,Nl,hd].includes(t.drawType??"")&&n0(t.consideredEntries.length)||t.drawSize&&wt(t.drawSize)||!1}function NNe(t){var o,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:n,drawType:r}=t,a=!n&&e&&y_({tournamentRecord:e,categoryType:(o=i==null?void 0:i.category)==null?void 0:o.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return a!=null&&a.length&&!a.includes(r)?{error:IV}:{...ne}}function N_(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:o}=xn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=Gae(n==null?void 0:n.entries)??[],l=UNe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return ae({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=_Re({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return ae({result:v,stack:r});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return ae({result:{error:ve},stack:r});let b=sNe({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:n});if(b.error)return ae({result:b,stack:r});let{existingDrawDefinition:D,positioningReports:w,drawDefinition:S,structureId:U,conflicts:C,entries:E}=b;if(!S)return ae({result:{error:ve},stack:r});let P=lNe({...t,existingDrawDefinition:D,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:U,entries:E,params:t,stack:r});if(P.error)return P;let{qualifyingConflicts:M}=P;return S.drawName=t.drawName??(p&&ta(p)),d&&typeof e=="object"&&d>=4&&fG({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!D,qualifyingConflicts:M,positioningReports:w,drawDefinition:S,structureId:U,...ne,conflicts:C}}function Hae({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:ut,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:qu,scaleName:r,scaleDate:o}],participantId:s}))}}function ANe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=P_({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:ve};let m=Yy({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=Hae({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var zH={};Gt(zH,{addDrawEntries:()=>uG,addEventEntries:()=>Zu,addEventEntryPairs:()=>Yae,destroyPairEntries:()=>die,destroyPairEntry:()=>hG,getEntriesAndSeedsCount:()=>P_,getMaxEntryPosition:()=>MH,modifyEntriesStatus:()=>eR,modifyEventEntries:()=>Zae,mutate:()=>zae,promoteAlternate:()=>qae,promoteAlternates:()=>qH,query:()=>xae,removeDrawEntries:()=>Kae,removeEventEntries:()=>XD,setEntryPosition:()=>WH,setEntryPositions:()=>Wae});var zae={};Gt(zae,{addDrawEntries:()=>uG,addEventEntries:()=>Zu,addEventEntryPairs:()=>Yae,destroyPairEntries:()=>die,destroyPairEntry:()=>hG,modifyEntriesStatus:()=>eR,modifyEventEntries:()=>Zae,promoteAlternate:()=>qae,promoteAlternates:()=>qH,removeDrawEntries:()=>Kae,removeEventEntries:()=>XD,setEntryPosition:()=>WH,setEntryPositions:()=>Wae});function WH({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let o="setEntryPositions";if(!t)return{error:Re};if(!i)return ae({result:{error:mr},stack:o});if(n!==void 0&&!Number.isSafeInteger(n))return{error:ve,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(s(a),a.entries=wc({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=wc({entries:e.entries}))),{...ne}}function Wae({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:Re};if(!Array.isArray(e))return{error:ve};for(let r of e){let{participantId:a,entryPosition:o}=r,s=WH({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=wc({entries:n.entries})),i!=null&&i.entries&&(i.entries=wc({entries:i.entries})),{...ne}}function qae(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:ve,participantId:e}:qH({...t,participantIds:[e].filter(Boolean)})}function qH({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=it,eventId:a,event:o}){if(!t)return{error:Re};if(!Array.isArray(i))return{error:ve,participantIds:i};if(!o)return{error:Ai};let s="promoteAlternates";if(o){let l=RK({element:o,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=RK({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?ae({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...ne},stack:s}):l}return{...ne}}function RK({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===wl),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:LQ};let l=s.filter(({entryStatus:d})=>d!==wl);if(l.length)return{error:YF,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:iDe,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:nDe,invalidStageSequence:u};for(let d of s){d.entryStatus=us;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===wl&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===us&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>wt(f||0)),0);d.entryPosition=h||0}return{...ne}}function Kae({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var u;if(!a)return{error:Ai};if(!n)return{error:xc};if(!(e!=null&&e.length))return{error:gf};let o=yg({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(za(o,e))return{error:e0};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Bn({event:a}),c=(u=l==null?void 0:l.flights)==null?void 0:u.find(d=>d.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(s),t&&(c.drawEntries=wc({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=wc({entries:i.entries}))),{...ne}}function pu(t){var m,g,v,y,I;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:n,disableNotice:r,pairOverride:a,participant:o}=t,s=t.tournamentId?(m=t.tournamentRecords)==null?void 0:m[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:Re};if(!o)return ae({result:{error:Ry},stack:e});o.participantId||(o.participantId=Oi()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:c}=o;if(s.participants.reduce((b,D)=>D.participantId===l||b,!1))return{error:AQ};let{participantType:u,participantRole:d}=o;if(!u||!Object.keys(yb).includes(u))return{error:Dc,participantType:u};if(!d)return{error:NQ};let p=s.participants||[],h=p.filter(b=>b.participantType===Kt).map(b=>b.participantId);if(u!==Kt&&o.person)return{error:ve,person:o.person};if(c&&!Array.isArray(c))return{error:ve,individualParticipantIds:c};if(u===kt){if(o.person)return{error:ve,person:o.person};if(o.individualParticipantIds){if(o.individualParticipantIds.length!==2&&!a)return ae({info:"PAIR must be 2 individualParticipantIds",result:{error:bl},stack:e});{let w=p.filter(S=>S.participantType===Kt).map(S=>S.participantId);if(!Array.isArray(o.individualParticipantIds))return ae({result:{error:bl},stack:e});if(!o.individualParticipantIds.reduce((S,U)=>w.includes(U)&&S,!0))return ae({result:{error:bl},stack:e})}}else return ae({result:{error:gf},stack:e});let b=p.filter(w=>w.participantType===kt).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),D=o.participantType===kt&&b.find(w=>kn(w.individualParticipantIds,o.individualParticipantIds).length===2);if(D&&!i)return{...ne,existingParticipant:!0,participant:n&&at(D.participant)};if(!o.participantName){let w=p.filter(U=>{var C;return(C=o.individualParticipantIds)==null?void 0:C.includes(U.participantId)}),S=w.map(U=>{var C;return(C=U.person)==null?void 0:C.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),o.participantName=S}}else if(u===Kt){if(!((v=o.person)!=null&&v.standardFamilyName)||!((y=o.person)!=null&&y.standardGivenName))return{error:xQ};if(!o.participantName){let b=`${o.person.standardFamilyName.toUpperCase()}, ${o.person.standardGivenName}`;o.participantName=b}}else if(u&&[ji,vs].includes(u)){if(c||(o.individualParticipantIds=[]),(I=o.individualParticipantIds)==null?void 0:I.length)for(let b of o.individualParticipantIds){if(typeof b!="string")return ae({result:{participantId:b,error:ve},stack:e});if(!h.includes(b))return ae({result:{participantId:b,error:jn},stack:e})}}else return{error:Dc};s.participants.push(o),r||ei({payload:{tournamentId:s.tournamentId,participants:[o]},topic:zh});let f={participant:n&&at(o),...ne};return ht(f)}function Ec({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:Re};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=Oi())});let a=n.filter(d=>!r.includes(d.participantId)),o=n.filter(d=>r.includes(d.participantId)),s=a.filter(d=>d.participantType===Kt),l=a.filter(d=>d.participantType!==Kt),c=s.concat(...l),u=[];if(c.length){for(let p of c){let h=pu({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&ei({topic:zh,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&at(u),addedCount:u.length,...ne};return o.length&&Object.assign(d,{notAdded:o,info:pA}),ht(d)}else return{info:"No new participants to add",addedCount:0,...ne}}function Yae({allowDuplicateParticipantIdPairs:t,entryStage:e=it,entryStatus:i=wl,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:Re};if(!o)return{error:Ai};if(o.eventType!==Wi)return{error:Vh};let l=[],c=new Map;for(let y of r.participants??[]){let{participantType:I,participantId:b,person:D,individualParticipantIds:w}=y;I===Kt&&(D!=null&&D.sex)?c.set(b,D.sex):I===kt&&w&&l.push(w)}let u=n.filter(y=>{if(y.length!==2||!c.has(y[0])||!c.has(y[1]))return!0;if(!o.gender||o.gender===cu)return!1;let I=y.map(D=>c.get(D)),b=o.gender===Hi&&(I[0]!==Hi||I[1]!==Hi)||o.gender===fn&&(I[0]!==fn||I[1]!==fn);return o.gender===Lo&&(I.sort(WA),(I[0]!==fn||I[1]!==Hi)&&(b=!0)),b});if(u.length)return{error:bl,invalidParticipantIdPairs:u};let d=n.map(y=>({participantId:(s==null?void 0:s.pop())??Oi(),participantRole:ga,individualParticipantIds:y,participantType:kt})),p=t?d:d.filter(y=>!l.find(I=>kn(I,y.individualParticipantIds).length===2)),h,f=[];if(p){let y=Ec({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(y.error)return y;f=y.participants||[],h=y.info}let m=n.map(y=>{let I=f.find(D=>kn(D.individualParticipantIds,y).length===2);if(I)return I;let{participant:b}=_l({tournamentRecord:r,participantIds:y});return b}).map(y=>y.participantId),g=Zu({participantIds:m,tournamentRecord:r,drawDefinition:a,entryStatus:i,entryStage:e,event:o});p.length&&ei({payload:{participants:p},topic:zh});let v=p.map(qt);return{...g,info:h,newParticipantIds:v}}function Zae({entryStatus:t=us,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=it,tournamentRecord:r,event:a}){if(!r)return{error:Re};if(!a)return{error:Ai};let o=r.participants??[],s=o.filter(m=>m.participantType===Kt).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:bl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:bl,invalidParticipantIdPairs:c};let u=o.filter(m=>m.participantType===kt).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>kn(g,m).length===2)).map(m=>({participantType:kt,participantRole:ga,individualParticipantIds:m})),p=Ec({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=_l({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:Vl,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...ne}}var KH={};Gt(KH,{addDrawDefinition:()=>k_,addEvent:()=>wP,addFlight:()=>x_,assignSeedPositions:()=>soe,attachFlightProfile:()=>ez,categoryCanContain:()=>i_,deleteDrawDefinitions:()=>A_,deleteEvents:()=>coe,deleteFlightAndFlightDraw:()=>aoe,deleteFlightProfileAndFlightDraws:()=>toe,getCategoryAgeDetails:()=>lP,getEvent:()=>HH,getEventProperties:()=>jH,getEventStructures:()=>ZA,getEventTimeItem:()=>zD,getEvents:()=>GH,getFlightProfile:()=>Bn,getScaledEntries:()=>Yy,modifyEvent:()=>uoe,modifyEventMatchUpFormatTiming:()=>ioe,modifyPairAssignment:()=>ooe,mutate:()=>Xae,query:()=>jae,refreshEventDrawOrder:()=>QH,removeEventMatchUpFormatTiming:()=>__,removeScaleValues:()=>tz,removeSeeding:()=>loe,setEventDates:()=>noe,setEventDisplay:()=>O_,setEventEndDate:()=>XH,setEventStartDate:()=>ZH,updateDrawIdsOrder:()=>JH,validateCategory:()=>oR});var Xae={};Gt(Xae,{addDrawDefinition:()=>k_,addEvent:()=>wP,addFlight:()=>x_,assignSeedPositions:()=>soe,attachFlightProfile:()=>ez,deleteDrawDefinitions:()=>A_,deleteEvents:()=>coe,deleteFlightAndFlightDraw:()=>aoe,deleteFlightProfileAndFlightDraws:()=>toe,modifyEvent:()=>uoe,modifyEventMatchUpFormatTiming:()=>ioe,modifyPairAssignment:()=>ooe,refreshEventDrawOrder:()=>QH,removeEventMatchUpFormatTiming:()=>__,removeScaleValues:()=>tz,removeSeeding:()=>loe,setEventDates:()=>noe,setEventDisplay:()=>O_,setEventEndDate:()=>XH,setEventStartDate:()=>ZH,updateDrawIdsOrder:()=>JH,validateCategory:()=>oR});function D0({removePriorValues:t=!0,status:e=Hl,statusObject:i,event:n}){if(!Zi(i))return{error:ve};let r=Qs({event:n,status:e}),a=`${fg}.${mg}`,o={itemValue:{[e]:{...r,...i}},itemType:a};return qy({timeItem:o,removePriorValues:t,event:n})}function P0(t){var b,D,w,S,U,C,E;let{includePositionAssignments:e,removePriorValues:i,tournamentRecord:n,status:r=Hl,event:a,drawIdsToRemove:o,drawIdsToAdd:s}=t;if(!n)return{error:Re};if(!a)return{error:Ai};let{appliedPolicies:l}=Ei({tournamentRecord:n,event:a}),c={...l,...t.policyDefinitions},u=((b=a.drawDefinitions)==null?void 0:b.map(({drawId:P})=>P))??[],d=t.drawDetails?Object.keys(t.drawDetails):[],p=d.length?[]:t.drawIds,h=(s??[]).concat(...o??[],...p??[],...d),f=h.filter(P=>!u.includes(P));if(f.length)return ae({result:{error:$o},context:{invalidDrawIds:f}});let m=Qs({event:a,status:r}),g=Object.keys((m==null?void 0:m.drawDetails)||{}).filter(P=>u.includes(P)).reduce((P,M)=>(P[M]=m.drawDetails[M],P),{});for(let P of u)if((!h.length||h.includes(P))&&(o!=null&&o.includes(P)||p!=null&&p.length&&!p.includes(P)?g[P]={...g[P],publishingDetail:{published:!1}}:(s!=null&&s.includes(P)||p!=null&&p.includes(P)||!(p!=null&&p.length))&&(g[P]={...g[P],publishingDetail:{published:!0}})),(D=t.drawDetails)==null?void 0:D[P]){let M=t.drawDetails[P],N=M.structureDetails??g[P].structureDetails,R=M.stageDetails??g[P].stageDetails??{},{structureIdsToRemove:A=[],structureIdsToAdd:_=[],publishingDetail:O={},stagesToRemove:x=[],stagesToAdd:F=[]}=M;if((_||F)&&(O.published=!0),g[P]={publishingDetail:O,structureDetails:N,stageDetails:R},_.length||A.length){let V=(((S=(w=a.drawDefinitions)==null?void 0:w.find(j=>j.drawId===P))==null?void 0:S.structures)??[]).map(({structureId:j})=>j),G=(_??[]).concat(A??[]).filter(j=>!V.includes(j));if(G.length)return ae({result:{error:bn},context:{invalidStructureIds:G}});N=N??{};for(let j of V)A.includes(j)?N[j]={published:!1}:N[j]={published:!0};g[P].structureDetails=N}let $=(((C=(U=a.drawDefinitions)==null?void 0:U.find(V=>V.drawId===P))==null?void 0:C.structures)??[]).map(({stage:V})=>V);if(F.length){for(let V of F)R[V]={published:!0};for(let V of $)R[V]||(R[V]={published:!1})}if(F.length||x.length){for(let V of x)R[V]={published:!1};for(let V of $)R[V]||(R[V]={published:!0})}(F.length||x.length)&&(g[P].stageDetails=R)}D0({statusObject:{drawDetails:g},removePriorValues:i,status:r,event:a});let{topics:v}=Xs(),y=v.includes(n$),I=y||t.returnEventData?(E=S_({includePositionAssignments:e,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:a}))==null?void 0:E.eventData:void 0;return y&&ei({payload:{eventData:I,tournamentId:n.tournamentId},topic:n$}),{...ne,eventData:I}}var Jae="deleteDrawDefinitions",Qae="autoSchedulingAudit",k$="deleteEvents",eoe={AUTO_SCHEDULING_AUDIT:Qae,DELETE_EVENTS:k$,DELETE_DRAW_DEFINITIONS:Jae};function A_(t){var U,C,E;if(!t.tournamentRecord)return{error:Re};let e="deleteDrawDefinitions",i=t.drawIds??[],n=t.event,{autoPublish:r=!0,tournamentRecord:a,auditData:o,eventId:s,force:l}=t,{appliedPolicies:c}=Ei({tournamentRecord:a,event:n}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!n){let P=so({tournamentRecord:a,eventId:s,drawId:d});if(P.error)return P;n=P.event}let p=[],h=[],f=[];if(!(n!=null&&n.drawDefinitions))return ae({info:"event has no drawDefinition",result:{...ne},stack:e});let m=n.drawDefinitions.map(({drawId:P})=>P);if(i.length||(i=m),i=i.filter(P=>m.includes(P)),!i.length)return ae({info:"nothing to do; no matching drawIds in event.",result:{...ne},stack:e});let g=at(Bn({event:n}).flightProfile,!1,!0),v=({participantId:P,drawPosition:M,qualifier:N,bye:R})=>({bye:R,qualifier:N,drawPosition:M,participantId:P}),y=l??((C=(U=c==null?void 0:c[ud])==null?void 0:U.allowDeletionWithScoresPresent)==null?void 0:C.drawDefinitions),I=Qs({event:n})??{},b=I.drawIds??(I.drawDetails&&Object.keys(I.drawDetails))??[],D,w=[],S=n.drawDefinitions.filter(P=>{var M,N,R,A,_,O,x,F;if(i.includes(P.drawId)){let $=((M=no({event:n,drawDefinition:P}))==null?void 0:M.matchUps)??[];if($.some(({score:Q})=>Vr({score:Q}))&&!y)return w.push(P.drawId),!0;let{drawId:V,drawType:G,drawName:j}=P,z=(N=g==null?void 0:g.flights)==null?void 0:N.find(Q=>Q.drawId===P.drawId);z&&(z.drawEntries=(R=z.drawEntries)==null?void 0:R.filter(Q=>jl.includes(Q.entryStatus))),b.includes(V)&&(b=b.filter(Q=>Q!==V),D=!0);let H=(_=(A=fd({stageSequence:1,drawDefinition:P,stage:it}))==null?void 0:A.structures)==null?void 0:_[0],K=(x=(O=H?oU({structureId:H.structureId,tournamentRecord:a,drawDefinition:P}):void 0)==null?void 0:O.positionAssignments)==null?void 0:x.map(v),q=(F=fd({stage:mt,drawDefinition:P}))==null?void 0:F.structures,Y=q!=null&&q.length?q.map(Q=>{var ue;let ie=Q.stageSequence;return{positionAssignments:(ue=oU({structureId:Q.structureId,tournamentRecord:a,drawDefinition:P}))==null?void 0:ue.positionAssignments.map(v),stageSequence:ie}}):void 0,Z={action:Jae,payload:{drawDefinitions:[P],eventId:s??(n==null?void 0:n.eventId),auditData:o}};f.push(Z),p.push(ht({tournamentId:a.tournamentId,eventId:s??(n==null?void 0:n.eventId),qualifyingPositionAssignments:Y,positionAssignments:K,auditData:o,drawType:G,drawName:j,drawId:V})),$==null||$.forEach(({matchUpId:Q})=>h.push(Q))}return!i.includes(P.drawId)});if(w.length&&!l)return ae({context:{drawIdsWithScoresPresent:w},result:{error:vA},stack:e});if(n.drawDefinitions=S,g&&Sf({event:n,extension:{name:Ml,value:g}}),vP({tournamentRecord:a}),D){let P={};for(let N of b)P[N]=((E=I.drawDetails)==null?void 0:E[N])??{published:!0};let M=D0({statusObject:{drawDetails:P},event:n});if(M.error)return{error:M.error}}if(f.length&&ei({topic:Gb,payload:f}),h.length&&Bp({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:h}),i.forEach(P=>{APe({drawId:P})}),_Ne({event:n,deletedDrawsDetail:p,auditData:o}),r&&D){let P=P0({drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:a,event:n});if(P.error)return{...ne,info:P.error}}return{...ne}}function _Ne({event:t,deletedDrawsDetail:e,auditData:i}){let{extension:n}=Vt({name:qM,element:t}),r={...i,deletedDrawsDetail:e},a={name:qM,value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(r):[r]};ci({element:t,extension:a})}function toe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var o;if(!e)return{error:Re};if(!n)return{error:Ai};let{flightProfile:a}=Bn({event:n});if(a){let s=(o=a.flights)==null?void 0:o.map(({drawId:c})=>c).filter(Boolean),l=A_({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:UA({event:n,name:Ml})}return{...ne}}function YH(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Pn};let s=Object.keys(o).filter(c=>!r||r===c);if(r&&!s.includes(r))return{error:ve};let l;for(let c of s){let u=o[c],{event:d}=so({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=kNe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...ne}:{error:Bo}}function kNe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:Re};if(n&&!Array.isArray(n))return{error:ve};if(e&&!Array.isArray(e))return{error:ve};let a=hp;if(r){let{extension:o}=Vt({element:r,name:a}),s=(o==null?void 0:o.value)||{},l=NK({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});ci({element:r,extension:{name:a,value:l}})}else{let{extension:o}=Vt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=NK({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});ci({extension:{name:a,value:l},element:t})}return{...ne}}function NK(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function ioe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:Re};if(!Ho({matchUpFormat:r}))return{error:ve};if(!s)return{error:Ai};let{averageTimes:l=[],recoveryTimes:c=[]}=C_({tournamentRecord:e,matchUpFormat:r,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=I=>{var b,D;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((D=I.categoryNames)!=null&&D.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},m=n&&!isNaN(wt(n)),g=i&&!isNaN(wt(i)),v=l.map(f).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=c.map(f).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||Tn]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(s==null?void 0:s.eventType)||Tn]:i}),y.push(h)),!m&&!g?{error:ve}:YH({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:o,event:s})}function __(t){if(t.event)return AK({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=gi(t,[{[ba]:!0,[Mee]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=so({tournamentRecord:r,eventId:n});if(a)return AK({event:a})}}return{error:Bo}}function AK({event:t}){return UA({event:t,name:hp})}function ZH({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Re};if(!e)return{error:Ai};if(!ld.test(i))return{error:Ha};let n=roe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(xt(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ha};let s=e.endDate&&new Date(xt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...ne}}function XH({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:Re};if(!e)return{error:Ai};if(!ld.test(i))return{error:Ha};let n=roe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(xt(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ha};let s=e.startDate&&new Date(xt(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...ne}}function noe({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:Re};if(!e)return{error:Ai};if(!i&&!n)return{error:ut,info:"missing date"};if(i&&!ld.test(i))return{error:Ha};if(n&&!ld.test(n))return{error:Ha};if(i&&n){let r=new Date(xt(i)).getTime(),a=new Date(xt(n)).getTime();if(r>a)return{error:ve}}if(i){let r=ZH({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){let r=XH({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...ne}}function roe(t){let{startDate:e,endDate:i}=t;return!ld.test(e)||!ld.test(i)?ae({result:{error:CQ},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(xt(e)).getTime(),tournamentEndDate:new Date(xt(i)).getTime()}}function JH({event:t,orderedDrawIdsMap:e}){var r,a;if(typeof t!="object")return{error:Ai};if(!e)return{error:ut,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:ve,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(o=>!isNaN(o)))return{error:ve,info:"drawOrder must be numeric"};if(Ft(i).length!==i.length)return{error:ve,info:"drawOrder values must be unique"};if((r=t.drawDefinitions)!=null&&r.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&kn(o,s).length!==o.length)return{error:ve,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:n}=Bn({event:t});return(a=n==null?void 0:n.flights)==null||a.forEach(o=>{o.flightNumber=e[o.drawId]}),{...ne}}function QH({tournamentRecord:t,event:e}){var r;if(!t)return{error:Re};if(!e)return{error:Ai};let{flightProfile:i}=Bn({event:e}),n=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((r=e.drawDefinitions)==null?void 0:r.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return n?JH({event:e,orderedDrawIdsMap:n}):{...ne}}function aoe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var s,l;if(!e)return{error:Re};if(!n)return{error:xc};if(!r)return{error:Ai};let{flightProfile:o}=Bn({event:r});if(o&&((s=o.flights)!=null&&s.find(c=>c.drawId===n))){let c=o.flights.filter(d=>d.drawId!==n),u={name:Ml,value:{...o,flights:c}};Sf({event:r,extension:u})}if((l=r.drawDefinitions)!=null&&l.find(c=>c.drawId===n)){let c=A_({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(c.error)return c}return QH({tournamentRecord:e,event:r})}function ooe({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var f,m;if(!a)return{error:Ai};if((a==null?void 0:a.eventType)!==Al)return{error:Vh};if(o&&!Array.isArray(o))return{error:ve};if(!i)return{error:Re};if(![t,e,r].every(g=>typeof g=="string"))return{error:mr};if(!(((f=a==null?void 0:a.entries)==null?void 0:f.filter(({entryStatus:g})=>[Vl,dg].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:au};let s=(i.participants||[]).find(g=>g.participantId===r);if((s==null?void 0:s.participantType)!==kt)return{error:Qw,participant:s};let l=s.individualParticipantIds,c=[t,...l.filter(g=>g!==e)],{participant:u}=_l({participantIds:c,tournamentRecord:i}),d;if(u)d=u.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:ga,individualParticipantIds:c,participantType:kt},v=pu({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;d=v.participant.participantId}let{flightProfile:p}=Bn({event:a});if(n){let g=(m=p==null?void 0:p.flights)==null?void 0:m.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:d}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:d}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:d}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(I=>I.participantId===r?{...I,participantId:d}:I)}a.entries=a.entries.map(g=>g.participantId===r&&{...g,participantId:d}||g.participantId===t&&{...g,participantId:e}||g);let h=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>a.eventId===v?y.some(({drawId:I,entries:b})=>I===(n==null?void 0:n.drawId)?!1:b==null?void 0:b.find(D=>D.participantId===r)):g==null?void 0:g.find(I=>I.participantId===r));if(!h){let g=Gy({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...ne,participantOtherEntries:h,newPairParticipantId:d}}function k_(t){var M,N,R,A,_,O,x,F,$,V,G,j;let{flight:e,suppressNotifications:i,modifyEventEntries:n,existingDrawCount:r,allowReplacement:a,checkEntryStatus:o,tournamentRecord:s,drawDefinition:l,event:c}=t;if(!l)return{error:et};if(!c)return{error:Ai};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:h}=c,f=0;if(r!==void 0&&r!==c.drawDefinitions.length)return{error:ve,info:"drawDefintions count mismatch"};let{flightProfile:m}=Bn({event:c}),g=e&&((M=m==null?void 0:m.flights)==null?void 0:M.find(z=>z.flightNumber===e.flightNumber)),v=(A=(R=(N=m==null?void 0:m.links)==null?void 0:N.find(z=>{var H;return((H=z==null?void 0:z.target)==null?void 0:H.drawId)===u}))==null?void 0:R.source)==null?void 0:A.drawId;if(v&&!c.drawDefinitions.find(z=>z.drawId===v))return ae({result:{error:et},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return ae({result:{error:hv},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:z,entryStatus:H})=>{let K=g==null?void 0:g.drawEntries.find(q=>q.participantId===z);return!H||(K==null?void 0:K.entryStatus)===H}),I=!o||h&&(p==null?void 0:p.every(({participantId:z,entryStatus:H,entryStage:K})=>{var q;return((q=h.find(Y=>Y.participantId===z&&(!Y.entryStage||Y.entryStage===K)))==null?void 0:q.entryStatus)===H}));if(g&&!y)return ae({result:{error:hv},context:{drawEntriesPresentInFlight:y,matchingEventEntries:I,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(n&&(p==null||p.filter(Boolean).forEach(z=>{if(z!=null&&z.entryStatus&&jl.includes(z==null?void 0:z.entryStatus)){let H=h==null?void 0:h.filter(Boolean).find(K=>K.participantId===z.participantId);H&&z.entryStatus&&(H==null?void 0:H.entryStatus)!==z.entryStatus&&(H.entryStatus=z.entryStatus,f+=1)}})),h&&!I)return ae({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:I,eventEntries:h},error:hv}});let b=((O=(_=m==null?void 0:m.flights)==null?void 0:_.map(({flightNumber:z})=>!isNaN(z)&&wt(z)))==null?void 0:O.filter(Boolean))||[],D=((x=c.drawDefinitions.map(({drawOrder:z})=>z&&wt(z)))==null?void 0:x.filter(Boolean))||[],w=Math.max(0,...D,...b)+1,S=(F=m==null?void 0:m.flights)==null?void 0:F.find(z=>z.drawId===u),U;if(S){S.drawName=l.drawName,U={name:Ml,value:{...m,flights:m.flights}};let z=S.flightNumber;z&&!D.includes(z)?w=z:S.flightNumber=w}else{let z=(m==null?void 0:m.flights)||[];z.push({manuallyAdded:!0,flightNumber:w,drawEntries:p,drawName:d,drawId:u}),U={name:Ml,value:{...m||{},flights:z}}}Sf({event:c,extension:U}),Object.assign(l,{drawOrder:w});let C=c.drawDefinitions.find(z=>z.drawId===u),E=s==null?void 0:s.tournamentId,P=c.eventId;if(C){if(!a)return{error:aQ};let z=((V=($=no({drawDefinition:C}))==null?void 0:$.matchUps)==null?void 0:V.map(Pr))??[],H=(G=no({drawDefinition:l}))==null?void 0:G.matchUps;if(!i){z!=null&&z.length&&Bp({matchUpIds:z,action:"modifyDrawDefinition",tournamentId:E,eventId:P}),H!=null&&H.length&&Wh({matchUps:H,tournamentId:E,eventId:P}),c.drawDefinitions=c.drawDefinitions.map(q=>q.drawId===u?l:q);let K=(j=l.structures)==null?void 0:j.map(({structureId:q})=>q);Xi({drawDefinition:l,tournamentId:E,structureIds:K,eventId:P})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:z}=no({drawDefinition:l,event:c});z&&Wh({tournamentId:s==null?void 0:s.tournamentId,matchUps:z}),RD({drawDefinition:l,tournamentId:E,eventId:P})}return{...ne,modifiedEventEntryStatusCount:f}}function soe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:TV};if(!n)return{error:Re};if(!l)return{error:xc};let d=zs({provisionalPositioning:e,drawDefinition:r,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==pee(g).length)return{error:oQ};for(let v of m){let y=w0({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...ne,modifications:u}:{error:i0}}function ez({deleteExisting:t,event:e,flightProfile:i}){var a;let n="attachFlightProfile";if(!i)return ae({result:{error:ut},stack:n});if(!e)return ae({result:{error:Ai},stack:n});let{flightProfile:r}=Bn({event:e});return r&&!t?ae({result:{error:jV},stack:n}):(a=e.drawDefinitions)!=null&&a.length?ae({result:{error:iQ},stack:n}):(Sf({event:e,extension:{name:Ml,value:i}}),{flightProfile:at(i,!1,!0),...ne})}function ONe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:Re};if(!i)return{error:gf};if(!e)return{error:ut,info:"scaleAttributes required"};let{scaleType:n,eventType:r,scaleName:a}=e,o=[Pte,n,r,a].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==o))}),{...ne}}function tz({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var c;if(!a)return{error:Ai};if(n&&!Array.isArray(n))return ae({result:{error:ve},info:gd("entryStatus"),stack:"removeScaleValues"});let s=a.entries;if(r){let{flightProfile:u}=Bn({event:a}),d=(c=u==null?void 0:u.flights)==null?void 0:c.find(p=>p.drawId===r);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!n||n.includes(u.entryStatus))).map(qt);return ONe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function O_({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=Hl,event:r}){if(!e)return ae({result:{error:Re}});if(!r)return ae({result:{error:Ai}});if(!Zi(i))return ae({result:{error:ut}});if(Zi(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>jUe(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[o].scheduleDetails=l}}let a=D0({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...ne}}function loe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var l,c;if(!t)return{error:Re};if(!a)return{error:Ai};n=n||((l=a.category)==null?void 0:l.categoryName)||((c=a.category)==null?void 0:c.ageCategoryCode);let s={eventType:a.eventType,scaleType:qu,scaleName:n};return tz({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:o})}function coe({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:Re};if(!e.events)return{error:Bo};if(!Array.isArray(i))return{error:ut,info:gd("drawIds")};let n=[],r=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let u={action:k$,payload:{events:[s]}};n.push(u),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===Al?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Vl&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?o.push(...l):a.push(...l),!c}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return vP({tournamentRecord:e}),n.length&&(ei({topic:Gb,payload:n}),Wy({tournamentRecord:e,timeItem:{itemType:k$,itemValue:r}})),{...ne}}function uoe({tournamentRecord:t,eventUpdates:e,eventId:i,event:n}){var p;let r="modifyEvent";if(!t)return ae({result:{error:Re},stack:r});if(!Ga(i))return ae({result:{error:Ai},context:{eventId:i},stack:r});if(!Zi(e))return ae({result:{error:ve},context:{eventUpdates:e},stack:r});let a=((p=n==null?void 0:n.entries)==null?void 0:p.filter(({entryStatus:h})=>{let f=h;return[...jl,wl].includes(f)}).map(({participantId:h})=>h))??[],o=a?xn({participantFilters:{participantIds:a},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],s=[],l=o.reduce((h,f)=>{var g,v;let m=(g=f.person)!=null&&g.sex?[f.person.sex]:((v=f.individualParticpants)==null?void 0:v.map(y=>{var I;return(I=y.person)==null?void 0:I.sex}))||[];return s.push(...m),h.includes(f.participantType)?h:h.concat(f.participantType)},[]),c=Ft(s),u=!c.length||[Lo,cu].includes(e.gender??"")||c.length===1&&c[0]===e.gender;if(e.gender&&!u)return ae({context:{gender:e.gender,validGender:u},result:{error:ve},stack:r});let d=(l.includes(Tr)&&[Tr]||l.includes(Kt)&&[md]||l.includes(kt)&&[Al]||[Al,md,Tr]).includes(e.eventType??"");return e.eventType&&!d?ae({context:{participantType:e.eventType,validEventType:d},result:{error:ve},stack:r}):(e.eventType&&(n.eventType=e.eventType),e.eventName&&(n.eventName=e.eventName),e.gender&&(n.gender=e.gender),{...ne})}function x_({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var h,f,m;let o="addFlight";if(!r)return ae({result:{error:Ai},stack:o});if(!i)return ae({result:{error:ut},stack:o});if(e!=null&&e.length){let g=(r.entries??[]).map(qt),v=e.map(qt);if(kn(v,g).length!==v.length)return ae({result:{error:ve},stack:o})}let s=(h=Bn({event:r}))==null?void 0:h.flightProfile,l=((m=(f=s==null?void 0:s.flights)==null?void 0:f.map(({flightNumber:g})=>!isNaN(g)&&wt(g)))==null?void 0:m.filter(Boolean))||[],c=Math.max(0,...l)+1,u={drawId:n||Oi(),flightNumber:c,drawEntries:e,drawName:i};if(a&&(u.stage=a),t&&(u.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===u.drawId))return ae({result:{error:iee},stack:o});let d=((s==null?void 0:s.flights)||[]).concat(u),p={name:Ml,value:{...s||{},flights:d}};return Sf({event:r,extension:p})}var xNe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},LNe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},FNe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},doe={COLLEGE_D3:xNe,COLLEGE_DEFAULT:LNe,COLLEGE_JUCO:FNe,DOMINANT_DUO:qre,DOMINANT_DUO_MIXED:Gre,LAVER_CUP:Jre,TEAM_DOUBLES_3_AGGREGATION:Fre,TIME_TENNIS_DUAL:Hre,TIME_TENNIS_PRO_CIRCUIT:jre,USTA_BREWER_CUP:zre,USTA_OZAKI_CUP:Wre,USTA_COLLEGE:Kre,USTA_GOLD_TEAM_CHALLENGE:Lre,USTA_INTERSECTIONAL:Vre,USTA_LEVEL_1:Yre,USTA_SECTION_BATTLE:Bre,USTA_SOUTHERN_LEVEL_5:$re,USTA_TOC:Qre,USTA_WTT_ITT:Zre,USTA_ZONAL:Xre};function wP({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var s,l,c,u;if(!e)return{error:Re};if(e.events||(e.events=[]),!n)return{error:Ai};let{startDate:r,endDate:a}=e;if(!i&&((s=n.entries)!=null&&s.length||(l=n.drawDefinitions)!=null&&l.length)){let d=ht({drawDefinitions:!!((c=n.drawDefinitions)!=null&&c.length),entries:!!((u=n.entries)!=null&&u.length)});return{info:"entries/drawDefinitions cannot exist",error:ve,context:d}}let o={eventType:Yv,drawDefinitions:[],entries:[],startDate:r,endDate:a,...n};if(n.eventType===Ws){if(n.tieFormat){let d=Uo({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!doe[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:ve};let d=ey({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});o.tieFormat=d}}if(o.eventId||(o.eventId=Oi()),e.events.reduce((d,p)=>d||p.eventId===o.eventId,void 0))return{error:mQ};{let d=o;if(e.events.push(d),!t){let{topics:p}=Xs();if(p.includes(_A)){let h=Hp({event:n}).matchUps??[];Wh({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:h})}for(let h of n.drawDefinitions||[])RD({drawDefinition:h})}return{...ne,event:o}}}var iz={};Gt(iz,{drawMatic:()=>dH,garman:()=>yoe,generateAdHocMatchUps:()=>u_,generateAdHocRounds:()=>uH,generateAndPopulatePlayoffStructures:()=>xG,generateCourts:()=>nz,generateDrawDefinition:()=>N_,generateDrawMaticRound:()=>tH,generateDrawStructuresAndLinks:()=>JG,generateDrawTypeAndModifyDrawDefinition:()=>QG,generateFlightProfile:()=>BNe,generateLineUps:()=>voe,generateQualifyingStructure:()=>MG,generateSeedingScaleItems:()=>Hae,generateVoluntaryConsolation:()=>Wne,roundRobinGroups:()=>oEe});var $Ne="splitLevelBased",poe="splitWaterfall",hoe="splitShuttle",foe={SPLIT_LEVEL_BASED:$Ne,SPLIT_WATERFALL:poe,SPLIT_SHUTTLE:hoe};function BNe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Ai};let f=p.entries??[],{flightProfile:m}=Bn({event:p});if(m&&i&&!o)return{error:jV};let g=t.scaledEntries??Yy({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:h}).scaledEntries,v=g.map(qt),y=La(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||pg.includes(E.entryStatus)))),I=g.concat(...y),b=I.length,D=Math.ceil(b/c),w=Fr(I,D);u===poe?w=JF(I,c):u===hoe&&(w=JF(I,c,!0));function S(E){return(E||[]).map(({participantId:P,scaleValue:M})=>{let N=f.find(R=>R.participantId===P);return N!=null&&N.scaleValue&&M&&(N.scaleValue=M),N}).sort((P,M)=>P.scaleValue-M.scaleValue).map((P,M)=>(P.scaleValue&&(P.seedNumber=M+1),P))}let U=Ze(0,c).map(E=>{let P=E+1;return{flightNumber:P,drawId:(d==null?void 0:d.pop())??Oi(),drawEntries:S(w[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${P}`}}),C={scaleAttributes:r,splitMethod:u,flights:U};if(i){let E=ez({flightProfile:C,deleteExisting:o,event:p});return{splitEntries:Hs()&&w||void 0,...E}}else return{flightProfile:C,...ne}}var VNe="ASC",moe="ASC",jNe="DESC",O$="DESC",goe={ASC:VNe,ASCENDING:moe,DESC:jNe,DESCENDING:O$};function voe(t){var P,M,N,R,A;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:n,drawDefinition:r,scaleAccessor:a,singlesOnly:o,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==Ws)return{error:Vh};if(!n)return{error:Re};if(!e&&!r)return{error:$o};if(e=e??((P=Ca({drawDefinition:r,event:l}))==null?void 0:P.tieFormat),Uo({tieFormat:e}).error)return{error:Wd};if(typeof a!="object"&&!i)return{error:ve,context:{scaleAccessor:a}};let c={},u=((r==null?void 0:r.entries)??(l==null?void 0:l.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===us).map(qt),{participants:d=[]}=xn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:n}),p=d.filter(({participantId:_})=>u.includes(_)),h=_=>_===jh?"rankings":"ratings",f=((M=l==null?void 0:l.category)==null?void 0:M.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:m=f,scaleType:g=jh,sortOrder:v,accessor:y}=a||{},I=h(g),b=(_,O)=>{var F,$,V;let x=(F=_[I])==null?void 0:F[O];if(!x&&i&&(x=($=_[I])==null?void 0:$[gv]),Array.isArray(x)){let G=(V=x.find(j=>j.scaleName===m))==null?void 0:V.scaleValue;if(En(G))return G;if(y&&typeof G=="object")return G[y]}return 0},D=(_,O,x)=>{let F=v===O$?O:_,$=v===O$?_:O;return b(F,x)-b($,x)},w=(_,O)=>D(_,O,gv),S=(_,O)=>D(_,O,Am),U=[],C=(e==null?void 0:e.collectionDefinitions)??[];for(let _ of p){let O=((R=_.individualParticipants)==null?void 0:R.sort(w))??[],x=o?O:((A=_.individualParticipants)==null?void 0:A.sort(S))??[],F={};for(let V of C){let G=[],{collectionId:j,matchUpCount:z,matchUpType:H,gender:K}=V,q=An(gv)(H);Ze(0,z).forEach(Y=>{let Z=q?O:x??[],Q=Y+1,ie=[];Ze(0,q?1:2).forEach(ue=>{var te;let J=(te=Z==null?void 0:Z.find(se=>{var ce;let ee=K&&([Hi,fn].includes(K)&&K||K===Lo&&[Hi,fn][ue]);return(!ee||ee===((ce=se.person)==null?void 0:ce.sex))&&!G.includes(se.participantId)}))==null?void 0:te.participantId;J&&(ie.push(J),G.push(J),F[J]||(F[J]=[]),F[J].push({collectionPosition:Q,collectionId:j}))}),q||U.push(ie)})}let $=Object.keys(F).map(V=>({collectionAssignments:F[V],participantId:V}));c[_.participantId]=$}let E=[];for(let _ of U){let{participant:O}=_l({tournamentParticipants:d,participantIds:_});if(!O){let x={individualParticipantIds:_,participantRole:ga,participantType:kt};E.push(x)}}if(s){for(;E.length;)pu({participant:E.pop(),tournamentRecord:n});ci({element:r,extension:{name:pp,value:c}})}return{...ne,lineUps:c,participantsToAdd:E}}function nz(t){if(!t)return{error:ut};let e=gi(t,[{dates:!1,[uc]:o=>Array.isArray(o)&&o.every(ss)},{uuids:!1,[uc]:o=>Array.isArray(o)&&o.every(Ga)},{startTime:!1,endTime:!1,[uc]:oj},{idPrefix:!1,namePrefix:!1,[uc]:Ga},{count:!0,[uc]:En}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&Ob(i,n)||[],a=Ze(1,t.count+1).map(o=>{var s,l;return ht({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??Oi(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...ne,courts:a}}var yoe={};Gt(yoe,{default:()=>zNe,garman:()=>woe});function SP({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>cd(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function C0(t){let e=gi(t,[{courtDate:!0,_ofType:jd}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=Xn(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>GM(s.startTime).localeCompare(GM(l.startTime))).forEach(s=>{let l={startTime:tn(a.toISOString()),endTime:s.startTime};Xn(s.startTime)>a&&r.push(l),Xn(s.endTime)>a&&(a=Xn(s.endTime))});let o={startTime:tn(a.toISOString()),endTime:n.endTime};return Xn(n.endTime)>a&&r.push(o),{timeSlots:r}}function GNe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=o=>{var l;let{timeSlots:s}=C0({includeBookingTypes:e,courtDate:o});return!!((l=s==null?void 0:s.filter(a))!=null&&l.length)};function a(o){let s=Xn(o.startTime),l=Xn(o.endTime);return s>i||l<n?!1:TD(i,l)>=t}return{enoughTime:r}}function Ioe(t){let e=gi(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:No}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,o=t.courts,s=Xn(r),l=sj(s,i),{enoughTime:c}=GNe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=SP({date:a,court:u});return!!(d&&c(d))}))||[]).length,...ne}}function L_(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:a=[]}=t,{bookings:o=[]}=t;if(!Array.isArray(a)||!a.length)return{error:ve,courts:a};if(!Array.isArray(o))return{error:FM};if(!ss(r))return{error:Ha};i&&(Array.isArray(i)?i.includes(r)&&(o=[]):o=[]);let{courtBookings:s,unassignedBookings:l}=o.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),c=a.map((h,f)=>{let{courtId:m,courtName:g}=h,v=s[m]||[],y=SP({date:r,court:h})||{},{bookings:I=[],startTime:b,endTime:D,date:w}=y,S=[e[f]&&{startTime:b,endTime:e[f]},...at(I,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:b,endTime:D,date:w}}});l.sort((h,f)=>ni(h.startTime)-ni(f.startTime));let u=()=>c.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=C0({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),d=[];for(let h of l){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,I=ni(f),b=ni(m),D=u().reduce((w,{courtId:S,courtName:U,timeSlots:C})=>{let E;return C.find(({startTime:P,endTime:M})=>{E=ni(P)-I;let N=I>=ni(P);return b<=ni(M)&&w.startDifference!==0&&((E===0||E+n>=0)&&(w.startDifference===void 0||E<w.startDifference)||N)})?{courtName:U,courtId:S,startDifference:E}:w},{});if(D.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};d.push(w),(p=c.find(({courtId:S})=>S===D.courtId))==null||p.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:c.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:d}}function F_({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function boe(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Ze(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function Xb({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,o)=>{let s=SP({date:t,court:o}),l=r&&((s==null?void 0:s[r])||o[r]);return l&&(!a||e&&ni(l)<ni(a)||i&&ni(l)>ni(a))?l:a},void 0)}function HNe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||Xb({courts:n,scheduleDate:r,startTime:!0}),i=i||Xb({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let o=Xn(e),s=Xn(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=SP({court:l,date:r}),{timeSlots:u}=C0({courtDate:c});u==null||u.forEach(d=>{let p=Xn(d.startTime),h=Xn(d.endTime);if(p>s||p<o||h<o)return!1;if(TD(p,h)>=t){let f=tn(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function rz(t){let e=gi(t,[{courts:!0,_ofType:No}]);if(e.error)return e;let{date:i=aj(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||F_({averageMatchUpMinutes:c}),i=xt(i),n=tn(n),r=tn(r);let h=0,f=0,m=0,g=0,v=0;!o&&d&&(o=boe({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=L_({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=HNe({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});s&&I&&(n=I||n);let b=ni(n),D=ni(r)-b,w=Math.floor(D/a),S=Ze(0,w+1).map(U=>{let C=b+U*a,E=oPe(C),P=Ioe({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:M=0}=P,N=M>f?M-f:0;v+=U?M:0;let R=U?v/U:M,A=a*R/c,_=U?A*(U-1)+R:R,O=M?f&&_-h||N:0;h=_,f=M,m+=O;let x=wt(m)-g;return g+=x,{periodStart:E,add:x,availableToScheduleCount:M,newCourts:N,totalMatchUps:g}});return{scheduleTimes:S.reduce((U,C)=>{let E=Ze(0,C.add).map(()=>({scheduleTime:C.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var woe={getCourtsAvailableAtPeriodStart:Ioe,generateTimeSlots:C0,getScheduleTimes:rz,courtGenerator:boe},zNe=woe,wp={};Gt(wp,{isValid:()=>Ho,isValidMatchUpFormat:()=>Ho,parse:()=>fo,stringify:()=>t_});var az={};Gt(az,{allCompetitionMatchUps:()=>Cc,allDrawMatchUps:()=>no,allEventMatchUps:()=>Hp,allTournamentMatchUps:()=>Br,analyzeMatchUp:()=>uU,applyLineUps:()=>Goe,assignMatchUpSideParticipant:()=>Toe,assignTieMatchUpParticipantId:()=>fR,bulkMatchUpStatusUpdate:()=>$oe,calculateWinCriteria:()=>Xy,checkInParticipant:()=>sz,checkMatchUpIsComplete:()=>Sm,checkOutParticipant:()=>oz,competitionScheduleMatchUps:()=>IP,disableTieAutoCalc:()=>xoe,drawMatchUps:()=>BH,enableTieAutoCalc:()=>_oe,eventMatchUps:()=>E_,findMatchUp:()=>UH,getAllDrawMatchUps:()=>sr,getAllStructureMatchUps:()=>Ti,getCheckedInParticipantIds:()=>Fy,getCompetitionMatchUps:()=>cU,getEventMatchUpFormatTiming:()=>NH,getMatchUpCompetitiveProfile:()=>BD,getMatchUpContextIds:()=>xH,getMatchUpDailyLimits:()=>R_,getMatchUpDailyLimitsUpdate:()=>AH,getMatchUpDependencies:()=>zl,getMatchUpFormat:()=>LH,getMatchUpFormatTiming:()=>jD,getMatchUpFormatTimingUpdate:()=>RH,getMatchUpScheduleDetails:()=>jA,getMatchUpType:()=>GA,getMatchUpsStats:()=>FH,getModifiedMatchUpFormatTiming:()=>C_,getParticipantResults:()=>sP,getPredictiveAccuracy:()=>OH,getRoundMatchUps:()=>Wa,getRounds:()=>$H,isValidMatchUpFormat:()=>Ho,matchUpActions:()=>l_,mutate:()=>Soe,participantScheduledMatchUps:()=>_H,query:()=>Lae,removeDelegatedOutcome:()=>koe,removeMatchUpSideParticipant:()=>uz,removeTieMatchUpParticipantId:()=>Doe,replaceTieMatchUpParticipantId:()=>cz,resetAdHocMatchUps:()=>Voe,resetMatchUpLineUps:()=>gz,resetScorecard:()=>yz,resetTieFormat:()=>vz,setDelegatedOutcome:()=>Boe,setMatchUpFormat:()=>Loe,setMatchUpStatus:()=>UP,setOrderOfFinish:()=>joe,substituteParticipant:()=>Ooe,tallyParticipantResults:()=>T0,toggleParticipantCheckInState:()=>$_,tournamentMatchUps:()=>M_,updateTieMatchUpScore:()=>zp,validMatchUp:()=>FA,validMatchUps:()=>Js});var Soe={};Gt(Soe,{applyLineUps:()=>Goe,assignMatchUpSideParticipant:()=>Toe,assignTieMatchUpParticipantId:()=>fR,bulkMatchUpStatusUpdate:()=>$oe,checkInParticipant:()=>sz,checkOutParticipant:()=>oz,disableTieAutoCalc:()=>xoe,enableTieAutoCalc:()=>_oe,findMatchUp:()=>UH,removeDelegatedOutcome:()=>koe,removeMatchUpSideParticipant:()=>uz,removeTieMatchUpParticipantId:()=>Doe,replaceTieMatchUpParticipantId:()=>cz,resetAdHocMatchUps:()=>Voe,resetMatchUpLineUps:()=>gz,resetScorecard:()=>yz,resetTieFormat:()=>vz,setDelegatedOutcome:()=>Boe,setMatchUpFormat:()=>Loe,setMatchUpStatus:()=>UP,setOrderOfFinish:()=>joe,substituteParticipant:()=>Ooe,toggleParticipantCheckInState:()=>$_,updateTieMatchUpScore:()=>zp});function Toe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var c,u;if(i&&typeof i!="string")return{error:au};if(!e)return{error:et};if(!r)return{error:la};let o=n===void 0;if(o&&(n=1),![1,2].includes(n))return ae({result:{error:ve,context:{sideNumber:n}}});let{matchUp:s,structure:l}=nn({drawDefinition:e,matchUpId:r,event:a});if(!s)return{error:ya};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==Rl)&&!((c=l==null?void 0:l.matchUps)!=null&&c.find(({roundPosition:d})=>!!d))))return{error:IV};if(!i&&((u=s==null?void 0:s.score)!=null&&u.scoreStringSide1||gr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[Qn,hr].includes(s.matchUpStatus)))return{error:dA,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var h;let p=((h=s.sides)==null?void 0:h.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...p,participantId:i}:p}),o)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);oi({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...ne,sidesSwapped:o}}function ds({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=nn({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:ya};let c=Df({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return r||oi({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function oz(t){var y;let e=[{[Rd]:!0},{[Lc]:!0},{[od]:!0},{[sg]:!0}],i=gi(t,e);if(i.error)return i;let n=bP(t,[{[SD]:If,attr:{[ij]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=t,l=(y=n==null?void 0:n.matchUp)==null?void 0:y.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&EA.includes(c)||c&&gr.includes(c)||Vr({score:u}))return{error:cQ};let d=Fy({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!(h!=null&&h.includes(o)))return{error:au};if(!(p!=null&&p.includes(o)))return{error:OQ};let f=Ite({matchUp:l});if(f!=null&&f.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m==null?void 0:m.indexOf(o);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(I=>{ds({drawDefinition:a,matchUpId:s,timeItem:{itemType:XM,itemValue:I}})}),ds({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:XM}}),{...ne,checkedOut:!0}}function sz(t){var p;let e=[{[Rd]:!0},{[Lc]:!0},{[od]:!0},{[sg]:!0}],i=gi(t,e);if(i[mv])return i;let n=bP(t,[{[SD]:If,attr:{[ij]:!0}}]);if(n[mv])return n;let{tournamentRecord:r,drawDefinition:a,participantId:o,matchUpId:s}=t,l=Fy({matchUp:(p=n==null?void 0:n.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!(u!=null&&u.includes(o)))return{[mv]:au};let d={...ne,checkedIn:!0};return c!=null&&c.includes(o)||ds({tournamentRecord:r,drawDefinition:a,matchUpId:s,timeItem:{itemValue:o,itemType:ZM}}),d}function $_(t){var c,u;let e=gi(t,[{[od]:!0,[Lc]:!0,[sg]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,n=t.tournamentRecord??(i&&((c=t.tournamentRecords)==null?void 0:c[i]));if(!n)return{error:Re};let r=(u=bP(t,[{[SD]:If,attr:{[ij]:!0},[mv]:ya}]).matchUp)==null?void 0:u.matchUp;if(!r)return{error:ya};let{checkedInParticipantIds:a=[]}=Fy({matchUp:r}),{participantId:o,matchUpId:s,drawDefinition:l}=t;return o&&a.includes(o)?oz({tournamentRecord:n,drawDefinition:l,participantId:o,matchUpId:s,matchUp:r}):sz({tournamentRecord:n,drawDefinition:l,participantId:o,matchUpId:s,matchUp:r})}function lz({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var w,S;if(!t)return{error:Re};if(!e)return{error:xc};if(!n)return{error:Bo};let r=ca({drawDefinition:e}),{matchUp:a}=nn({matchUpId:i,drawDefinition:e,matchUpsMap:r});if(!a)return{error:ya};let{matchUp:o,structure:s}=nn({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!o)return{error:ya};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=o;if(p&&!HA([Tn,Wi],p))return{error:oo};let{positionAssignments:h}=Bi({structure:s}),f=h==null?void 0:h.filter(U=>c==null?void 0:c.includes(U.drawPosition)),{matchUp:m}=nn({matchUpId:d,drawDefinition:e,matchUpsMap:r}),g=((w=m==null?void 0:m.sides)==null?void 0:w.map(qt))??[],v=(f==null?void 0:f.map(qt))??[],y=[...g,...v],{participants:I}=xn({tournamentRecord:t,participantFilters:{participantTypes:[ji],participantIds:y}}),{matchUp:b}=nn({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:r}),D=(S=Ca({matchUp:m,drawDefinition:e,structure:s,event:n}))==null?void 0:S.tieFormat;return{inContextDualMatchUp:b,inContextTieMatchUp:o,relevantAssignments:f,collectionPosition:l,teamParticipants:I,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:a,tieFormat:D,structure:s,...ne}}function cz(t){var x,F,$,V,G,j,z,H,K,q,Y,Z,Q,ie,ue,J;let e=lz(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:n,tournamentRecord:r,newParticipantId:a,drawDefinition:o,substitution:s,event:l}=t;if(!n||!a)return ae({result:{error:mr},stack:i});if(n===a)return{...ne};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=u==null?void 0:u.matchUpType,v=(x=u==null?void 0:u.sides)==null?void 0:x.find(te=>{var se,ee,ce;return((se=te.participant)==null?void 0:se.participantId)===n||((ce=(ee=te.participant)==null?void 0:ee.individualParticipantIds)==null?void 0:ce.includes(n))});if(!v)return{error:jn};let y=((F=xn({tournamentRecord:r,participantFilters:{participantIds:[n,a]}}))==null?void 0:F.participants)??[];if(y.length!==2)return ae({result:{error:mr},stack:i});if(y[0].participantType!==y[1].participantType)return ae({result:{error:Dc},stack:i});let{appliedPolicies:I}=Ei({tournamentRecord:r,drawDefinition:o,event:l}),b=(($=t.policyDefinitions)==null?void 0:$[_r])??(I==null?void 0:I[_r])??b0[_r],D=y.find(({participantId:te})=>te===a);if((t.enforceGender??((V=b==null?void 0:b.participants)==null?void 0:V.enforceGender))!==!1&&[Hi,fn].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((G=D==null?void 0:D.person)==null?void 0:G.sex))return{error:Qw,info:"Gender mismatch"};let w=(j=b==null?void 0:b.processCodes)==null?void 0:j.substitution;dP({tournamentId:r.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:o,dualMatchUp:h});let S=(z=h==null?void 0:h.sides)==null?void 0:z.find(({sideNumber:te})=>te===v.sideNumber);if(!S)return ae({result:{sideNumber:v.sideNumber,existingParticipantId:n,error:Ia},stack:i});if((K=(H=u==null?void 0:u.sides)==null?void 0:H.flatMap(te=>{var se,ee;return((se=te.participant)==null?void 0:se.individualParticipantIds)||((ee=te.participant)==null?void 0:ee.participantId)||[]}))!=null&&K.includes(a))return ae({result:{error:pA},stack:i});let U=(Y=(q=c==null?void 0:c.sides)==null?void 0:q.find(({sideNumber:te})=>te===v.sideNumber))==null?void 0:Y.participantId,C=S.lineUp,E=C==null?void 0:C.find(({participantId:te})=>a===te),P=C==null?void 0:C.reduce((te,se)=>se.substitutionOrder>te?se.substitutionOrder:te,0),M=(C==null?void 0:C.map(te=>{var ee;let se=at(te,!1,!0);if(![n,a].includes(se.participantId))return se;if(!s&&[n,a].includes(se.participantId)&&(se.collectionAssignments=(ee=se.collectionAssignments)==null?void 0:ee.filter(ce=>!(ce.collectionPosition===d&&ce.collectionId===p))),s&&n===se.participantId&&(se.collectionAssignments=se.collectionAssignments.map(ce=>ce.collectionPosition===d&&ce.collectionId===p&&ce.substitutionOrder===void 0?{...ce,substitutionOrder:P}:ce)),se.participantId===a){se.collectionAssignments||(se.collectionAssignments=[]);let ce={collectionId:p,collectionPosition:d};s&&(ce.previousParticipantId=n,ce.substitutionOrder=(P??0)+1),se.collectionAssignments.push(ce)}return se}))??[];if(!E){let te={collectionId:p,collectionPosition:d};s&&(te.substitutionOrder=(P??0)+1,te.previousParticipantId=n);let se={collectionAssignments:[te],participantId:a};M.push(se)}let N=g===Wi,{assignedParticipantIds:R}=JM({lineUp:C,collectionPosition:d,collectionId:p}),{assignedParticipantIds:A}=JM({lineUp:M,collectionPosition:d,collectionId:p});if(S.lineUp=M,U&&m){let te=zy({participantId:U,lineUp:M,drawDefinition:o,tieFormat:m});if(te.error)return ae({result:te,stack:i})}else console.log("team participantId not found");let _,O;if(N){let{tournamentRecord:te}=t,se=_l({participantIds:A,tournamentRecord:te});if(!se.participant){let ce=pu({returnParticipant:!0,pairOverride:!0,tournamentRecord:te,participant:{participantRole:ga,individualParticipantIds:A,participantType:kt}});if(ce.error)return ae({result:ce,stack:i});_=(Z=ce.participant)==null?void 0:Z.participantId}se=_l({participantIds:R,tournamentRecord:te});let ee=(Q=se.participant)==null?void 0:Q.participantId;ee&&Gy({participantIds:[ee],tournamentRecord:te}).success&&(O=ee)}if(s||((ie=v.substitutions)==null?void 0:ie.length)===1){if(s)w&&f&&(f.processCodes=Ft([...(f==null?void 0:f.processCodes)??[],...w]));else for(let te of w||[]){let se=(ue=f==null?void 0:f.processCodes)==null?void 0:ue.lastIndexOf(te);se!==void 0&&((J=f==null?void 0:f.processCodes)==null||J.splice(se,1))}f&&oi({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,context:i,drawDefinition:o})}return h&&oi({tournamentId:r==null?void 0:r.tournamentId,matchUp:h,context:i,drawDefinition:o}),{...ne,modifiedLineUp:M,participantRemoved:O,participantAdded:_}}function Uoe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var c;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:ve};let o=(i==null?void 0:i.lineUp)||((c=xm({participantId:e,drawDefinition:n}))==null?void 0:c.lineUp),s=[],l=[];return{modifiedLineUp:(o==null?void 0:o.map(u=>{var p;if(!r.includes(u.participantId))return u;let d=(p=u.collectionAssignments)==null?void 0:p.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&s.push(h.previousParticipantId),l.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function WNe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var a,o;let n=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===Tr&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),r=s=>!t.includes(s.participantId);for(let s of n){s.entries=(s.entries||[]).filter(r);let{flightProfile:l}=Bn({event:s});(a=l==null?void 0:l.flights)==null||a.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(r)}),(o=s==null?void 0:s.drawDefinitions)==null||o.forEach(c=>{c.entries=(c.entries||[]).filter(r)})}return{...ne}}function B_({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return ae({result:{error:Re},stack:r});if(!e||!t)return ae({result:{error:ut},stack:r});let a=n.participants??[],o=a.find(d=>d.participantId===e);if(!o)return ae({result:{error:jn},stack:r});if(o!=null&&o.participantType&&![ji,vs].includes(o.participantType))return ae({context:{participantType:o.participantType},result:{error:Dc},stack:r});let s=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==Kt});if(s.length)return ae({result:{error:bl,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&qA({individualParticipantIds:c,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));let{topics:u}=Xs();if(u.includes(aa)){let d=a.find(({participantId:p})=>p===e);ei({topic:aa,payload:{participants:[d]}})}return WNe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:at(o,!1,!0),added:c.length,...ne}}function V_(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=t;if(!r)return{error:Re};if(!o)return{error:Ry};if(!o.participantId)return pu({tournamentRecord:r,participant:o});let{participant:s}=vg({participantId:o.participantId,tournamentRecord:r});if(!s)return pu({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=o;if(h&&s.participantType!==h)return{error:MQ};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),d&&typeof d=="string"&&(v.participantName=d),u&&typeof u=="string"&&(v.participantOtherName=u),Array.isArray(c)){let{participants:y}=xn({participantFilters:{participantTypes:[Kt]},tournamentRecord:r}),I=y==null?void 0:y.map(qt);if(I){let b=c.filter(D=>typeof D=="string"&&I.includes(D));([vs,Ki].includes(h||s.participantType)||h===kt&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===yb.PAIR&&e&&(v.participantName=qNe({individualParticipants:y,newValues:v}))}}return Object.keys(Uf).includes(p)&&(v.participantRole=p),Object.keys(yb).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===yb.INDIVIDUAL&&g&&KNe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,ht(v)),i&&B_({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),ei({topic:aa,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:at(s),...ne}}function qNe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function KNe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,sex:c}=n;c&&Object.keys(Du).includes(c)&&(r.sex=c);let u;if(l&&typeof l=="string"&&(r.personId=l),s&&typeof s=="string"&&(YNe(s)||s==="")&&(r.nationalityCode=s),a&&typeof a=="string"&&a.length>1&&(r.standardFamilyName=a,u=!0),o&&typeof o=="string"&&o.length>1&&(r.standardGivenName=o,u=!0),u&&t){let d=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=d}Object.assign(e.person,r)}function YNe(t){return kh.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function fR(t){var $,V,G,j,z,H,K,q,Y,Z,Q,ie,ue,J,te,se,ee,ce,fe,ge;let e=lz(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",n=t.teamParticipantId,{tournamentRecord:r,drawDefinition:a,participantId:o,event:s}=t;if(!o)return ae({result:{error:mr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ae({result:{error:RV},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if((V=($=c==null?void 0:c.sides)==null?void 0:$.flatMap(he=>{var Se,Ce;return((Se=he.participant)==null?void 0:Se.individualParticipantIds)||((Ce=he.participant)==null?void 0:Ce.participantId)||[]}))!=null&&V.includes(o))return ae({result:{...ne},stack:i});n=n??(t.sideNumber?(j=(G=l==null?void 0:l.sides)==null?void 0:G.find(he=>he.sideNumber===t.sideNumber))==null?void 0:j.participantId:void 0);let v=(H=(z=xn({participantFilters:{participantIds:[o]},tournamentRecord:r}))==null?void 0:z.participants)==null?void 0:H[0];if(!v)return ae({result:{error:jn},stack:i});let{appliedPolicies:y}=Ei({tournamentRecord:r,drawDefinition:a,event:s}),I=((K=t.policyDefinitions)==null?void 0:K[_r])??(y==null?void 0:y[_r])??b0[_r];if((t.enforceGender??((q=I==null?void 0:I.participants)==null?void 0:q.enforceGender))!==!1&&[Hi,fn].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((Y=v.person)==null?void 0:Y.sex))return{error:Qw,info:"Gender mismatch"};let{individualParticipantIds:b,participantType:D}=v;if(An(Tn)(f)&&D!==Kt)return{error:Dc};let w=D===Kt?[o]:b,S=n&&(p==null?void 0:p.find(({participantId:he})=>he===n))||(p==null?void 0:p.find(({individualParticipantIds:he})=>za(w,he)));if(!S)return{error:BV};if(n||(n=S.participantId),!n)return{error:jn};let U=(Z=u==null?void 0:u.find(he=>he.participantId===(S==null?void 0:S.participantId)))==null?void 0:Z.drawPosition,C=(ie=(Q=m==null?void 0:m.sides)==null?void 0:Q.find(he=>he.participantId===n))==null?void 0:ie.sideNumber,E=(J=(ue=c==null?void 0:c.sides)==null?void 0:ue.find(he=>U&&he.drawPosition===U))==null?void 0:J.sideNumber,P=C??E??t.sideNumber;if(!g)return{error:gD};if(!((te=g.collectionDefinitions)!=null&&te.find(he=>he.collectionId===h)))return{error:wQ};dP({tournamentId:r.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:a,dualMatchUp:m});let M=(se=m==null?void 0:m.sides)==null?void 0:se.find(he=>he.sideNumber===P),N=(ee=c==null?void 0:c.sides)==null?void 0:ee.find(he=>he.sideNumber===P),R=(ge=(fe=(M==null?void 0:M.lineUp)??((ce=xm({participantId:n,drawDefinition:a}))==null?void 0:ce.lineUp))==null?void 0:fe.filter(he=>{var Se;return(Se=he.collectionAssignments)==null?void 0:Se.find(Ce=>Ce.collectionPosition===d&&Ce.collectionId===h&&!Ce.previousParticipantId)}))==null?void 0:ge.map(he=>he==null?void 0:he.participantId),A=(R==null?void 0:R.length)>1&&R||(D===kt?v.individualParticipantIds:[o]),_=Uoe({collectionPosition:d,teamParticipantId:n,dualMatchUpSide:M,drawDefinition:a,participantIds:A,collectionId:h});if(_.error)return ae({result:_,stack:i});let{modifiedLineUp:O}=_,x;if(f===Wi){if(D!==kt){let he=dL({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:h,tieFormat:g});if(he!=null&&he.error)return ae({result:he,stack:i});if(he=F({side:N}),he.error)return he;x=he.deletedParticipantId,M&&(M.lineUp=O),m&&oi({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a})}else if(D===kt)for(let he of A)dL({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:O,participantId:he,collectionId:h,tieFormat:g})}else{let he=dL({collectionPosition:d,teamParticipantId:n,drawDefinition:a,modifiedLineUp:O,participantId:o,collectionId:h,tieFormat:g});if(he!=null&&he.error)return he}if(M&&(M.lineUp=O),m&&oi({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:a}),x){let{error:he}=Gy({participantIds:[x],tournamentRecord:r});he&&console.log("cleanup")}return{...ne,modifiedLineUp:O};function F({side:he}){let Se;if(he.participant){let Ce=he.participant.individualParticipantIds||[];if(Ce.filter(Boolean).length===1){let{participant:Fe}=_l({participantIds:Ce,tournamentRecord:r});Ce.push(o);let{participant:Je}=_l({participantIds:Ce,tournamentRecord:r});if(!Je&&Fe){Fe.individualParticipantIds=Ce;let xe=V_({pairOverride:!0,tournamentRecord:r,participant:Fe});if(xe.error)return xe}else Se=Fe==null?void 0:Fe.participantId}}else{let Ce=pu({participant:{individualParticipantIds:[o],participantRole:ga,participantType:kt},pairOverride:!0,tournamentRecord:r});if(Ce.error)return Ce}return{...ne,deletedParticipantId:Se}}}function dL({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var u,d;let s=(u=xm({participantId:e,drawDefinition:i}))==null?void 0:u.lineUp,l=(d=n||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===r),c={collectionId:a,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let p={collectionAssignments:[c],participantId:r};n.push(p)}return zy({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function Doe(t){var E,P,M,N,R,A,_,O,x,F,$,V,G,j,z,H,K,q,Y,Z,Q,ie;let{tournamentRecord:e,drawDefinition:i,participantId:n,event:r}=t,a="removeTieMatchUpParticiapantId";if(!n)return ae({result:{error:mr},stack:a});let o=lz(t);if(o.error)return o;let{appliedPolicies:s}=Ei({tournamentRecord:e,drawDefinition:i,event:r}),l=(M=(P=((E=t.policyDefinitions)==null?void 0:E[_r])??(s==null?void 0:s[_r])??b0[_r])==null?void 0:P.processCodes)==null?void 0:M.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=o;if(!g)return ae({result:{error:To},stack:a});let I=(N=u==null?void 0:u.sides)==null?void 0:N.find(ue=>{var J,te,se;return((J=ue.participant)==null?void 0:J.participantId)===n||((se=(te=ue.participant)==null?void 0:te.individualParticipantIds)==null?void 0:se.includes(n))});if(!I)return ae({result:{error:jn},stack:a});if(!((R=I.substitutions)!=null&&R.length)&&(Vr({score:u==null?void 0:u.score})||u!=null&&u.winningSide))return ae({result:{error:nee},stack:a});let b=(_=(A=c==null?void 0:c.sides)==null?void 0:A.find(({sideNumber:ue})=>ue===I.sideNumber))==null?void 0:_.participantId;if(!b)return ae({result:{error:jn},stack:a});let D=(x=(O=xn({participantFilters:{participantIds:[n]},tournamentRecord:e}))==null?void 0:O.participants)==null?void 0:x[0];if(!D)return ae({result:{error:jn},stack:a});if(m===Tn&&D.participantType===kt)return ae({result:{error:Qw},stack:a});let w=D.participantType===Kt?[n]:D.individualParticipantIds;dP({tournamentId:e.tournamentId,eventId:r.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let S=(F=g.sides)==null?void 0:F.find(({sideNumber:ue})=>ue===I.sideNumber);if(!S&&((($=g.sides)==null?void 0:$.filter(({lineUp:ue})=>!ue).length)||0)<2){let ue=h==null?void 0:h.map(({participantId:J})=>{var te;return{drawPosition:(te=d==null?void 0:d.find(se=>se.participantId===J))==null?void 0:te.drawPosition,teamParticipantId:J}});S=(V=g.sides)==null?void 0:V.find(J=>{var te;return((te=ue==null?void 0:ue.find(({drawPosition:se})=>se===J.drawPosition))==null?void 0:te.teamParticipantId)===b})}if(!S)return ae({result:{error:jn,context:{participantId:n}}});let{modifiedLineUp:U,previousParticipantIds:C}=Uoe({collectionPosition:p,teamParticipantId:b,dualMatchUpSide:S,participantIds:w,drawDefinition:i,collectionId:f});if(S.lineUp=U,b&&y&&zy({participantId:b,lineUp:U,drawDefinition:i,tieFormat:y}),m===Wi&&D.participantType===Kt){let ue=(G=u==null?void 0:u.sides)==null?void 0:G.find(se=>se.sideNumber===(S==null?void 0:S.sideNumber)),{participantId:J}=ue??{},te=J&&((z=(j=xn({participantFilters:{participantIds:[J]},tournamentRecord:e,withDraws:!0}))==null?void 0:j.participants)==null?void 0:z[0]);if(te){let se=((H=te==null?void 0:te.individualParticipantIds)==null?void 0:H.filter(ee=>ee!==n))??[];if(C&&se.push(...C),se.length>2)return ae({result:{error:bl},stack:a});if((K=te.draws)!=null&&K.length){if(se.length===1){let{participant:ee}=_l({participantIds:se,tournamentRecord:e});if(!ee){let ce=pu({participant:{participantRole:ga,individualParticipantIds:se,participantType:kt},pairOverride:!0,tournamentRecord:e});if(ce.error)return ae({result:ce,stack:a})}}}else if(se.length){te.individualParticipantIds=se;let ee=V_({participant:te,pairOverride:!0,tournamentRecord:e});if(ee.error)return ae({result:ee,stack:a})}else{let ee=Gy({participantIds:[J],tournamentRecord:e});ee.error&&console.log("cleanup",{result:ee})}}else return ae({result:{error:jn},stack:a})}if(((q=I.substitutions)==null?void 0:q.length)===1&&!((Q=(Z=(Y=u==null?void 0:u.sides)==null?void 0:Y.find(ue=>ue.sideNumber!==I.sideNumber))==null?void 0:Z.substitutions)!=null&&Q.length)&&((ie=v==null?void 0:v.processCodes)!=null&&ie.length)){for(let ue of l||[]){let J=v.processCodes.lastIndexOf(ue);v.processCodes.splice(J,1)}oi({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:a,drawDefinition:i})}return oi({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:a,drawDefinition:i}),{...ne,modifiedLineUp:U}}function uz(t){var l,c;let e=gi(t,[{[Rd]:!0,[Lc]:!0,[sg]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:n,matchUpId:r,event:a}=t;if(n&&![1,2].includes(n))return{error:ve,sideNumber:n};let{matchUp:o,structure:s}=nn({drawDefinition:i,matchUpId:r,event:a});return o?Go({structure:s})?((l=o.sides)==null||l.forEach(u=>{(!n||u.sideNumber===n)&&delete u.participantId}),oi({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:o}),{...ne}):{error:IV}:{error:ya}}function ZNe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:c}){var p;let u=at(r,void 0,!0);for(let h of(u==null?void 0:u.tieMatchUps)||[])h.matchUpId===s.matchUpId&&(h.winningSide=n,h.score=c,!Vr({score:c})&&!e?Object.assign(h,{...QA}):e&&(h.matchUpStatus=e));a=a??((p=Ca({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=uP({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:d}}function XNe({matchUpStatuses:t=[bi,Pi,fi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var u;let r=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),a=(u=r==null?void 0:r.drawPositions)==null?void 0:u.find(d=>d!==i),o=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(a)}).map(d=>d.matchUpStatus),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=za(o||[],t),c=za(s||[],t);return{sourceMatchUp:r,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:o,loserHadMatchUpStatus:c,loserMatchUpStatuses:s}}function JNe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=Ut({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===Qa)return{...ne};c=c??ca({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:h}=Zv({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Bi({drawDefinition:a,structureId:o});for(let g of f??[])QNe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...ne}}function QNe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var h,f,m;let d="removeSubsequentDrawPosition";if(s){let g=(f=(h=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:h.find(y=>y.drawPosition===n))==null?void 0:f.sideNumber,v=(m=c.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=p&&bi||[fi,Pi].includes(c.matchUpStatus)&&c.matchUpStatus||On,[Pi,fi].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&yie({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),oi({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${d}-${n}`,drawDefinition:o,matchUp:c}),{...ne}}function E0(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Go({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:hD};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:D}}=l,w=Xc({...t,matchUpStatus:a||On,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:O,matchUpsMap:x}=t;if(S=zp({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:n,drawDefinition:r,matchUpsMap:x,event:d}),!e&&!S.removeWinningSide)return{...ne}}if(h)return{...ne};let{matchUps:U}=Ti({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:u}),{positionAssignments:C}=Er({structure:u}),E=m-1,P=1-E,M=f[E],N=f[P],{winnerParticipantId:R,loserParticipantId:A}=(C==null?void 0:C.reduce((O,x)=>(x.drawPosition===N&&(O.loserParticipantId=x.participantId),x.drawPosition===M&&(O.winnerParticipantId=x.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=U.filter(O=>{var x;return(x=O.drawPositions)==null?void 0:x.includes(N)});if(b&&Poe({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:M,winnerParticipantId:R,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=XNe({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:U}),x=g.linkCondition===pd;if(O&&x){let $=Math.min(...I.drawPositions);x$({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:$,matchUpsMap:o,event:d})}let F=eAe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(F.error)return F}if(D){let O=Math.min(...D.drawPositions);x$({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:O,matchUpsMap:o,event:d})}return{...ne,...S&&{tieMatchUpResult:S}}}function Poe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var m,g;let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=Ut({drawDefinition:s,structureId:v});if(!y)return{error:bn};let{positionAssignments:I}=Er({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(C=>C.participantId!==n);let b=(m=I==null?void 0:I.find(C=>C.participantId===n))==null?void 0:m.drawPosition,{matchUps:D}=Ti({drawDefinition:s,structure:y,event:d}),w=D.map(C=>C.drawPositions).flat(1/0).filter(Boolean),S=Vo(w);if((b?S[b]:void 0)===1)I==null||I.forEach(C=>{C.participantId===n&&delete C.participantId});else{let C=D.filter(({drawPositions:E})=>E.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:C,winnerTargetLink:a})}let U=(g=c==null?void 0:c.drawMatchUps)==null?void 0:g.find(({matchUpId:C})=>C===l.matchUpId);U&&oi({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:f,drawDefinition:s})}return h&&JNe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:h,structureId:p}),{...ne}}function eAe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:c}){var m,g,v;let u="removeDirectedLoser",d=n.target.structureId,{structure:p}=Ut({drawDefinition:a,structureId:d});if(!p)return{error:bn};let{positionAssignments:h}=Er({structure:p}),f=(m=h==null?void 0:h.find(y=>y.participantId===e))==null?void 0:m.drawPosition;if(h==null||h.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((D,w,S)=>w.drawPosition===f?S:D,void 0),I=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:D})=>D===o.matchUpId),b=(v=I==null?void 0:I.sides)==null?void 0:v[y];b&&(delete b.lineUp,oi({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:I,context:u,drawDefinition:a}))}return{...ne}}function x$({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId;return YD({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:o}),{...ne}}function tAe(t){var l,c;let{matchUpFormat:e,score:i}=t,n=(l=i==null?void 0:i.sets)==null?void 0:l.length,r=e&&fo(e),{setFormat:a,finalSetFormat:o,bestOf:s}=r??{};return((c=s&&n===s&&o||a)==null?void 0:c.timed)||!1}function iAe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var s;let r="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return ae({result:{error:Ab},context:{matchUpStatus:bi},stack:r});let{positionAssignments:a}=Er({structure:i}),o=a==null?void 0:a.filter(l=>l.bye).map(l=>l.drawPosition);return(s=n.drawPositions)!=null&&s.some(l=>o==null?void 0:o.includes(l))?(n.matchUpStatus=bi,n.matchUpStatusCodes=[],oi({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:n}),{...ne}):ae({result:{error:bQ},info:"matchUp does not include BYE",stack:r})}function dT(t){var m;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,structure:o,event:s}=t,l="doubleExitAdvancement";if(o.structureType===Qa)return ae({result:{...ne},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=a,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=u;if(p&&p.matchUpStatus!==bi){let{loserTargetLink:g}=d;if((m=i==null?void 0:i.progression)!=null&&m.doubleExitPropagateBye){let v=Coe({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:g,drawDefinition:n,loserMatchUp:p,matchUpsMap:r,event:s});if(v.error)return ae({result:v,stack:l})}else{let{feedRound:v,drawPositions:y,matchUpId:I}=p,b=v?2:2-y.indexOf(f),D=_K({...t,targetMatchUp:p,walkoverWinningSide:b,tournamentRecord:e,sourceMatchUp:c,matchUpId:I});if(D.error)return ae({result:D,stack:l})}}if(h){let g=_K({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:c});if(g.error)return ae({result:g,stack:l})}return ae({result:{...ne},stack:l})}function _K(t){var H,K,q;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:o}=t,s=n.structures.find(({structureId:Y})=>Y===a.structureId),l=t.matchUpStatus===hr?hr:Qn,c=t.matchUpStatus===hr?fi:Pi,u="conditionallyAdvanceDrawPosition",d=o.drawMatchUps.find(Y=>Y.matchUpId===a.matchUpId);if(!d)return{error:To};let p=(r==null?void 0:r.drawPositions)||[],h=(H=d.drawPositions)==null?void 0:H.filter(Boolean),f=(r==null?void 0:r.structureId)===a.structureId;if(f&&za(p,h)&&(h=h.filter(Y=>!p.includes(Y))),f&&h.length>1)return ae({result:{error:Nb},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=gie(t),v=qa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:y,targetLinks:I}=v,{loserTargetDrawPosition:b,winnerMatchUp:D,loserMatchUp:w}=y;if(w){let{loserTargetLink:Y}=I,Z=Coe({loserTargetDrawPosition:b,loserMatchUp:w,tournamentRecord:i,loserTargetLink:Y,drawDefinition:n,matchUpsMap:o});if(Z.error)return ae({result:Z,stack:u})}let S=((K=d.drawPositions)==null?void 0:K.filter(Boolean))||[],U=S.length===1,C=t.walkoverWinningSide||U&&z1({drawPosition:S[0],matchUpId:a.matchUpId,inContextDrawMatchUps:e})||void 0,E=[Pi,fi].includes(d.matchUpStatus)&&!S.length,P=d.finishingRound===1,M=E&&!P?l:c,N=e.find(Y=>Y.matchUpId===g.matchUpId),R=[],A;r&&((r==null?void 0:r.structureId)===(N==null?void 0:N.structureId)?r.roundPosition<(g==null?void 0:g.roundPosition)?A=1:A=2:a.feedRound?r.structureId===a.structureId?A=2:A=1:C&&(A=3-C));let _=t.matchUpStatus,O=g==null?void 0:g.matchUpStatus;A===1?R=[{matchUpStatus:$E(_),previousMatchUpStatus:_,sideNumber:1},{matchUpStatus:$E(O),previousMatchUpStatus:O,sideNumber:2}]:A===2&&(R=[{matchUpStatus:$E(O),previousMatchUpStatus:O,sideNumber:1},{matchUpStatus:$E(_),previousMatchUpStatus:_,sideNumber:2}]),R.length&&(R=R.map(Y=>ht(Y)));let x=Xc({...t,winningSide:C,matchUp:d,matchUpStatusCodes:R,context:u,matchUpStatus:M});if(x.error)return ae({result:x,stack:u});if(E)return dT({...t,matchUpStatus:M,targetData:v});if(!D)return ae({result:{...ne},stack:u});let F=h.length===2?h[C-1]:h[0],{positionAssignments:$}=Bi({structure:s}),V=$==null?void 0:$.find(Y=>Y.drawPosition===F),G=o.drawMatchUps.find(Y=>Y.matchUpId===D.matchUpId),j=(q=G==null?void 0:G.drawPositions)==null?void 0:q.filter(Boolean),z=j.length===1;if(F){if(V!=null&&V.bye){let Y=qa({matchUpId:G.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(z){let Z=j.filter(Boolean)[0],Q=z1({drawPosition:Z,matchUpId:G.matchUpId,inContextDrawMatchUps:e}),ie=Xc({appliedPolicies:t.appliedPolicies,matchUpId:G.matchUpId,matchUp:G,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,winningSide:Q});return ie.error?ae({result:ie,stack:u}):lG({drawPositionToAdvance:Z,matchUpId:G.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:o})}else if([Pi,fi].includes(D.matchUpStatus)){let Z=dT({...t,matchUpId:G.matchUpId,matchUpStatus:M,targetData:Y});if(Z.error)return ae({result:Z,stack:u})}return ae({result:{...ne},stack:u})}return qb({matchUpId:D.matchUpId,drawPosition:F,inContextDrawMatchUps:e,drawDefinition:n})}else if(m){if(!G)return{error:To};if(z){let Q=j[0],ie=z1({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawPosition:Q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:ie})}let Y=[Pi,fi].includes(G.matchUpStatus)?c:l,Z=Xc({matchUpId:G.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:G,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,matchUpStatus:Y});if(Z.error)return ae({result:Z,stack:u});if(Y===l){let Q=dT({...t,matchUpId:a.matchUpId,matchUpStatus:Y,targetData:v});if(Q.error)return Q}}return ae({result:{...ne},stack:u})}function Coe(t){var c;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:a,event:o}=t,s=(c=n==null?void 0:n.target)==null?void 0:c.structureId,{structure:l}=Ut({drawDefinition:r,structureId:s});return l?ys({drawPosition:e,tournamentRecord:i,drawDefinition:r,structureId:s,matchUpsMap:a,event:o}):{error:mf}}function $E(t){return t===Qn?Pi:t===hr?fi:t}function nAe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===bi,c=a.winningSide,u=[Qn,hr].includes(n),d=qD({matchUpStatus:n}),p=u$({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>Xc({...t,removeScore:[$p,Pi].includes(n),matchUpStatus:n||On});return h&&{error:qF}||f&&L$(t)||m&&rAe(t)||c&&E0(t)||p&&g()||l&&iAe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:qF}||u&&aAe(t)||o&&L$(t)||ae({result:{error:Ab},stack:s})}function rAe(t){let e=E0(t);return e.error?e:dT(t)}function aAe(t){let e=L$({...t,removeScore:!0});return e.error?e:dT(t)}function L$(t){var r;let e="scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide){let a=E0(t);if(a.error)return ae({result:a,stack:e})}let i=!!t.matchUp.collectionId,n=Xc({...t,context:e});if(i){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=zp({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return ae({result:l,stack:e});Object.assign(n,{tieMatchUpResult:l})}return ae({result:n,stack:e})}function oAe({drawDefinition:t,structure:e,matchUp:i}){var l,c,u,d;let{drawPositions:n}=i,{positionAssignments:r}=Bi({drawDefinition:t,structure:e}),a=(l=r==null?void 0:r.filter(({drawPosition:p})=>n==null?void 0:n.includes(p)))==null?void 0:l.map(p=>{var f;let{extension:h}=Vt({element:p,name:Hh});return(f=h==null?void 0:h.value)==null?void 0:f.groupOrder}),{containerStructures:o}=h0({drawDefinition:t}),s=o[e.structureId];return{structureIds:(d=(u=(c=v0({drawDefinition:t,structureId:s}))==null?void 0:c.links)==null?void 0:u.source)==null?void 0:d.filter(p=>{var h;return za(a,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function Eoe({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===p0&&Yh({drawDefinition:t,structure:e})){let{structureIds:r}=oAe({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function sAe(t){var s,l,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===ml){let u=n.sides.find(({sideNumber:p})=>p!==a).participantId,d=i.find(p=>p.structureId===o.target.structureId&&p.roundNumber===o.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===On){let p=qa({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!$m({inContextDrawMatchUps:i,drawDefinition:r,targetData:p})){let{structure:h}=Ut({structureId:d.structureId,drawDefinition:r}),f=Bi({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=n.sides.find(({sideNumber:v})=>v===a).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(l=y.positionAssignments)==null||l.forEach(I=>I.participantId=v[I.drawPosition])}qh({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:r,structure:h}),e=!0}}}}return{...ne,qualifierReplaced:e}}function lAe(t){var s,l,c,u,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:a}=t,o=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(o.target.feedProfile===ml){let p=(l=n.sides.find(({sideNumber:m})=>m===a))==null?void 0:l.participantId,h=i.filter(m=>m.structureId===o.target.structureId&&m.roundNumber===o.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=_o(h);if((f==null?void 0:f.matchUpStatus)===On){let m=qa({matchUpId:f.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!$m({inContextDrawMatchUps:i,drawDefinition:r,targetData:m})){let g=(c=f.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:c.drawPosition,{structure:v}=Ut({structureId:f.structureId,drawDefinition:r});if(!v)return{error:bn};let y=Bi({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(D=>({[D.drawPosition]:D.participantId})));for(let D of v.structures)(u=D.positionAssignments)==null||u.forEach(w=>w.participantId=b[w.drawPosition])}qh({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:r,structure:v}),e=!0}}}}return{...ne,qualifierPlaced:e}}function cAe(t){var h,f;let e="attemptToSetWinningSide",i,{appliedPolicies:n,disableAutoCalc:r,drawDefinition:a,dualMatchUp:o,winningSide:s,structure:l,matchUp:c}=t;if(o!=null&&o._disableAutoCalc&&r!==!1)return kG(t);if(c.winningSide&&c.winningSide!==s){let{connectedStructureIds:m}=Eoe({drawDefinition:a,structure:l,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let g=E0(t);if(g.error)return g}let u=une(t);if(u.error)return ae({result:u,stack:e});let d,p;return t.qualifierChanging&&((h=n==null?void 0:n[zT])!=null&&h.autoReplaceQualifiers)&&(d=sAe(t).qualifierReplaced),t.qualifierAdvancing&&((f=n==null?void 0:n[zT])!=null&&f.autoPlaceQualifiers)&&(p=lAe(t).qualifierPlaced),ae({result:ht({...ne,...u,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var Y1={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Moe(t){var h;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:a,matchUp:o}=t,{iteration:s=0}=t;s+=1;let l="removeDoubleExit";Bs({method:l,color:"brightyellow",iteration:s,keyColors:Y1});let{targetLinks:{loserTargetLink:c},targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p}}=a;if(d&&d.matchUpStatus!==bi){let{stage:f,roundNumber:m,roundPosition:g}=d;Bs({winner:"winner",stage:f,roundNumber:m,roundPosition:g,keyColors:Y1}),kK({...t,targetMatchUp:d,sourceMatchUp:o,iteration:s})}if(u&&u.matchUpStatus!==bi){let f=e.find(({matchUpId:b})=>b===u.matchUpId),{structure:m}=Ut({drawDefinition:n,structureId:f.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:I}=u;if(Bs({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:Y1,feedRound:I}),(h=i==null?void 0:i.progression)==null?void 0:h.doubleExitPropagateBye)x$({drawPosition:p,targetLink:c,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:r});else{let b=kK({...t,structure:m,targetMatchUp:u,iteration:s});if(b.error)return ae({result:b,stack:l})}}return ae({result:{...ne},stack:l})}function kK(t){var b,D,w,S,U,C;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:a,matchUpsMap:o,structure:s,iteration:l}=t,c="conditionallyRemoveDrawPosition";Bs({method:c});let u=qa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:d}}=u,p=o==null?void 0:o.drawMatchUps.find(E=>E.matchUpId===a.matchUpId),h=[],f,m,g;if(a.feedRound)g=(D=(b=d==null?void 0:d.drawPositions)==null?void 0:b.filter(Boolean))==null?void 0:D.find(E=>a.drawPositions.includes(E));else if(!r)g=(w=kn((a==null?void 0:a.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:w[0];else if(m=(S=vie({structureId:s.structureId,matchUp:r,matchUpsMap:o}))==null?void 0:S.pairedPreviousMatchUp,f=[Qn,hr].includes(m==null?void 0:m.matchUpStatus),h=((U=m==null?void 0:m.drawPositions)==null?void 0:U.filter(Boolean))||[],[...gr,bi].includes(m==null?void 0:m.matchUpStatus)||(m==null?void 0:m.winningSide)){let E=r.drawPositions||[],P=(C=a.drawPositions)==null?void 0:C.filter(Boolean);za(E,P)&&(P=P==null?void 0:P.filter(M=>!E.includes(M))),g=E.concat(h).find(M=>P==null?void 0:P.includes(M))}if(d&&g){let{stage:E,roundNumber:P,roundPosition:M}=d;Bs({method:"removeDirectedWinner",drawPositionToRemove:g,keyColors:Y1,color:"brightgreen",stage:E,roundNumber:P,roundPosition:M}),Poe({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:o})}let v=Moe({targetData:u,matchUp:a,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:o,structure:s,iteration:l});if(v.error)return ae({result:v,stack:c});let y=uAe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),I=!f;return v=Xc({...t,matchUpId:a.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:c,matchUpStatus:y,removeScore:I,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?ae({result:v,stack:c}):{...ne}}function uAe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===bi?bi:t?[hr,fi].includes(e==null?void 0:e.matchUpStatus)?fi:Pi:On}function dAe(t){var o,s,l,c,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r}=t,a=(o=t.targetData.targetLinks)==null?void 0:o.winnerTargetLink;if(a.target.feedProfile===ml){let d=(l=(s=n.sides)==null?void 0:s.find(({sideNumber:h})=>h===n.winningSide))==null?void 0:l.participantId,p=i.find(h=>{var f;return h.structureId===a.target.structureId&&h.roundNumber===a.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===On){let h=qa({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!$m({inContextDrawMatchUps:i,drawDefinition:r,targetData:h})){let{structure:f}=Ut({structureId:p.structureId,drawDefinition:r}),m=Bi({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(c=y.positionAssignments)==null||c.forEach(I=>I.participantId=v[I.drawPosition])}qh({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:r,structure:f}),e=!0}}}}return{qualifierRemoved:e}}function pAe(t){var m;let{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t,a="noDownStreamDependencies";if([Qn,hr].includes(e==null?void 0:e.matchUpStatus)&&![Qn,hr].includes(i)){let g=Moe(t);if(g.error)return ae({result:g,stack:a})}let o=i===Qn,s=Vr({score:n})&&!o&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),l=((m=t==null?void 0:t.inContextMatchUp)==null?void 0:m.collectionId)&&tAe(t.inContextMatchUp),c=t.removeScore||!l&&![su,cs].includes(i||su),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!Vr({score:n}),d=i&&i!==On,p=g=>{var U,C;let v,{structure:y,drawDefinition:I,dualMatchUp:b,disableAutoCalc:D}=t;if(b!=null&&b._disableAutoCalc&&D!==!1)return kG(t);let{connectedStructureIds:w}=Eoe({drawDefinition:I,structure:y,matchUp:e});w.length&&(console.log({connectedStructureIds:w}),v=!0),Object.assign(t,{removeScore:g});let S=E0(t);if(S.error)return S;if(t.removingQualifier&&((C=(U=t.appliedPolicies)==null?void 0:U[zT])!=null&&C.autoRemoveQualifiers)){let E=dAe(t);return{...ne,connectedStructures:v,...E}}return{...ne,connectedStructures:v}};if(u&&r&&t.isCollectionMatchUp)return OK(t);let h=[$p,cs].includes(i)&&t.dualWinningSideChange,f=(r||h)&&cAe(t)||s&&p(c)||d&&nAe(t)||u&&p(c)||e&&OK({...t,removeScore:!0})||{...ne};return ae({result:f,stack:a})}function OK(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let r=E0(t);if(r.error)return r}let i=Xc({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=zp({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return ae({result:i,stack:e})}function Cf(t){var h;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:o,scheduledTime:s,matchUpId:l}=t;if(!l)return ae({result:{error:la},stack:e});if(!s0(s))return ae({result:{error:cl},stack:e});if(!i){let f=nn({drawDefinition:a,matchUpId:l});if(f.error)return ae({result:f,stack:e});i=f.matchUp}let c=xt(s),u=Om({matchUp:i}).scheduledDate,d=c&&!u;if((h=eG({matchUp:i}).timeModifiers||[])!=null&&h.length){let f=Roe({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:a,matchUpId:l,matchUp:i});if(f!=null&&f.error)return ae({result:f,stack:e})}let p=_y(s,!0,d);return ds({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:a,disableNotice:o,matchUpId:l,timeItem:{itemType:g0,itemValue:p}})}function Roe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return ae({result:{error:la},stack:s});if(r!==void 0&&!Array.isArray(r))return ae({info:gd("timeModifiers"),result:{error:ve},stack:s});if(!o){let d=nn({drawDefinition:i,matchUpId:a});if(d.error)return ae({result:d,stack:s});o=d.matchUp}let l=eG({matchUp:o}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...ne};if(c.some(d=>a$.includes(d))){l=l.filter(p=>!a$.includes(p));let d=Cf({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return ae({result:d,stack:s})}let u=r!=null&&r.length?[...c,...l]:void 0;return ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Jj,itemValue:u}})}function j_({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var u,d;if(!i&&!e)return{error:Re};if(!o)return{error:la};let l=nn({drawDefinition:n,matchUpId:o});if(l.error)return l;if(((u=l==null?void 0:l.matchUp)==null?void 0:u.matchUpType)!==lu)return{error:oo};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:ve,context:{courtIds:s}};let c;if(s){let p=e||i&&{[i.tournamentId]:i},h=Wp({tournamentRecords:p});if(h.error)return h;let f=(d=h.courts)==null?void 0:d.filter(m=>s.includes(m.courtId));if((f==null?void 0:f.length)!==s.length)return{error:ve,context:{courtIds:s}};c=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:yp,itemDate:a,itemValue:c}})}function M0({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:Re};if(!a)return{error:la};if(o){let s=jp({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:f0,itemValue:o}})}function Jy({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:Re};if(!o)return{error:la};if(s){let c=$y({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;M0({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:u})}return ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:km,itemDate:a,itemValue:s}})}function qc(t,e){let i=kee.test(t)?t:tn(t),n=xt(t)||xt(e)||Ic(new Date);return new Date(`${n}T${i}`).getTime()}function G_({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:l,drawMatchUps:c,matchUpId:u,schedule:d,event:p}){var M;if(!d)return{error:ut,info:"Missing schedule"};if(!s)return{error:et};if(!u)return{error:la};let h="addMatchUpScheduleItems",f,m;if(c)f=c.find(N=>N.matchUpId===u);else{let N=nn({drawDefinition:s,event:p,matchUpId:u});if(N.error)return N;f=N.matchUp}let{endTime:g,courtId:v,courtIds:y,courtOrder:I,resumeTime:b,scheduledDate:D,scheduledTime:w,startTime:S,stopTime:U,timeModifiers:C,venueId:E}=d;e&&(!i||!n)&&({matchUpDependencies:i,matchUps:n}=zl({drawDefinition:s}));let P=(M=i==null?void 0:i[u])==null?void 0:M.matchUpIds;if(d.scheduledDate&&e&&P){let N=n==null?void 0:n.filter(R=>{var A,_;return(((A=R.schedule)==null?void 0:A.scheduledDate)||xt((_=R.schedule)==null?void 0:_.scheduledTime))&&P.includes(R.matchUpId)}).map(({schedule:R})=>{let A=VM(R);return new Date(A).getTime()});if(N!=null&&N.length){let R=VM(d),A=new Date(R).getTime();if(Math.max(...N)>=A){if(t)return ae({result:{error:HF},stack:h});m=HF}}}if(D!==void 0){let N=H_({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledDate:D,matchUpId:u});if(N!=null&&N.error)return ae({result:N,stack:h,context:{scheduledDate:D}})}if(w!==void 0){let N=Cf({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledTime:w,matchUpId:u,matchUp:f});if(N!=null&&N.error)return ae({result:N,stack:h,context:{scheduledTime:w}})}if(S!==void 0){let N=pz({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,startTime:S,event:p});if(N!=null&&N.error)return ae({result:N,stack:h,context:{startTime:S}})}if(U!==void 0){let N=fz({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,stopTime:U,event:p});if(N!=null&&N.error)return ae({result:N,stack:h,context:{stopTime:U}})}if(b!==void 0){let N=mz({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,resumeTime:b,matchUpId:u,event:p});if(N!=null&&N.error)return ae({result:N,stack:h,context:{resumeTime:b}})}if(g!==void 0){let N=hz({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,endTime:g,event:p});if(N!=null&&N.error)return ae({result:N,stack:h,context:{endTime:g}})}if(y!==void 0){let N=j_({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtIds:y});if(N!=null&&N.error)return ae({result:N,stack:h,context:{courtIds:y}})}if(v!==void 0&&D!==void 0){let N=Jy({courtDayDate:D,disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtId:v});if(N!=null&&N.error)return ae({result:N,stack:h,context:{courtId:v}})}if(E!==void 0){let N=M0({disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,venueId:E});if(N!=null&&N.error)return ae({result:N,stack:h,context:{venueId:E}})}if(I!==void 0&&Mt(I)){let N=dz({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,courtOrder:I,matchUpId:u});if(N!=null&&N.error)return ae({result:N,stack:h,context:{courtOrder:I}})}if(C!==void 0){let N=Roe({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,timeModifiers:C,matchUpId:u,matchUp:f});if(N!=null&&N.error)return ae({result:N,stack:h,context:{timeModifiers:C}})}return l||oi({tournamentId:o==null?void 0:o.tournamentId,eventId:p==null?void 0:p.eventId,context:h,drawDefinition:s,matchUp:f}),m?{...ne,warnings:[m]}:{...ne}}function H_({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:la};let o=t&&ld.test(t);if(t&&!o)return{error:Ha};let s={itemValue:xt(t),itemType:m0};return ds({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s})}function dz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:la};if(r&&!Mt(r))return{error:ve,info:"courtOrder must be numeric"};let o=r&&wt(r);return ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:Xj,itemValue:o}})}function Noe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:la};if(!r)return{error:mr};if(e){let l=xn({tournamentRecord:e,participantFilters:{participantTypes:[Kt],participantRoles:[dG]}}).participants??[];if(!Gh({tournamentParticipants:l,participantId:r}))return{error:jn}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function pz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:la};if(!s0(a))return{error:cl};let{matchUp:s}=nn({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Om({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[rp,Ku,Ip].includes(u==null?void 0:u.itemType)).map(u=>qc(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||qc(a,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==dc));let u=_y(a,!0,!0);return ds({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:dc,itemValue:u}})}else return{error:qQ}}function hz({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:la};if(!s0(o))return{error:cl};let{matchUp:l}=nn({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:c}=Om({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[dc,Ku,rp].includes(d==null?void 0:d.itemType)).map(d=>qc(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||qc(o,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Ip));let d=_y(o,!0,!0);return ds({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Ip,itemValue:d}})}else return{error:zQ}}function fz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:la};if(!s0(a))return{error:cl};let{matchUp:s}=nn({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Om({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Ip||f,void 0))return{error:xV};let u=c.filter(f=>[dc,Ku,rp].includes(f==null?void 0:f.itemType)).sort((f,m)=>qc(f.itemValue,l)-qc(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===rp,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>qc(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(qc(a,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:_y(a,!0,!0),itemType:rp};return ds({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:WQ}}function mz({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:la};if(!s0(r))return{error:cl};let{matchUp:s}=nn({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Om({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Ip||f,void 0))return{error:xV};let u=c.filter(f=>[dc,Ku,rp].includes(f==null?void 0:f.itemType)).sort((f,m)=>qc(f.itemValue,l)-qc(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===Ku,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>qc(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(qc(r,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:_y(r,!0,!0),itemType:Ku};return ds({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:rDe}}function hAe(t){var D;let{tournamentRecord:e,inContextMatchUp:i,structure:n,drawDefinition:r}=t,a=i.roundNumber,o=i.sides.find(w=>w.sideNumber===i.winningSide),s=i.sides.find(w=>w.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=o,{drawPosition:u,participantId:d}=s,p="swapWinnerLoser",{matchUps:h}=Ti(t),f=h.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(l))&&S>a);Hs({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(w=>{var S,U;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(C=>C===l?u:C))||[],oi({tournamentId:e==null?void 0:e.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:p,drawDefinition:r,matchUp:w})});let{stage:m,stageSequence:g}=n,v=r.structures.filter(({stage:w,stageSequence:S})=>w===m&&S>g).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:y,winnerTargetLink:I}}=t.targetData,b=[y==null?void 0:y.target.structureId,(D=I==null?void 0:I.target)==null?void 0:D.structureId].filter(Boolean);return r.structures.filter(({stage:w,structureId:S})=>w!==m&&b.includes(S)).forEach(({stage:w,stageSequence:S,structureId:U})=>{v.includes(U)||v.push(U),r.structures.filter(({stage:C,stageSequence:E})=>C===w&&E>S).forEach(({structureId:C})=>{v.includes(C)||v.push(C)})}),r.structures.filter(({structureId:w})=>v.includes(w)).forEach(w=>{let{positionAssignments:S}=Bi({structure:w}),U=S==null?void 0:S.find(({participantId:E})=>E===c),C=S==null?void 0:S.find(({participantId:E})=>E===d);U&&(U.participantId=d),C&&(C.participantId=c)}),Xc({...t,context:p})}function TP(t){var j,z,H,K;let e="setMatchUpStatus";t.matchUpStatus&&[Pi,Qn].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:n,tournamentRecords:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpStatus:c,winningSide:u,matchUpId:d,event:p,score:h}=t;if(!l)return{error:et};if(c&&[$p,su,cs,On].includes(c)&&u)return{error:ve,winningSide:u,matchUpStatus:c};if(![void 0,...bj].includes(c))return ae({result:{error:Ab},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let f=ca({drawDefinition:l}),{matchUps:m}=sr({nextMatchUps:!0,tournamentRecord:a,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p}),g=f.drawMatchUps.find(q=>q.matchUpId===d),v=m==null?void 0:m.find(q=>q.matchUpId===d);if(!g||!m)return{error:ya};if((g.winningSide||u)&&c===bi)return{context:"Cannot have Bye with winningSide",error:O1,matchUpStatus:c};let y=v==null?void 0:v.structureId,{structure:I}=Ut({drawDefinition:l,structureId:y}),b=An(Ki)(g.matchUpType),D=(j=v==null?void 0:v.drawPositions)==null?void 0:j.filter(Boolean),w;if(b){if(o)ci({extension:{name:Fb,value:!0},element:g});else if(s){let q=g.winningSide;Ba({name:Fb,element:g});let{winningSide:Y,scoreStringSide1:Z,scoreStringSide2:Q,set:ie}=uP({drawDefinition:l,matchUpsMap:f,structure:I,matchUp:g,event:p}),ue={scoreStringSide1:Z,scoreStringSide2:Q,sets:ie?[ie]:[]};w=Y!==q,Object.assign(t,{winningSide:Y,dualWinningSideChange:w,projectedWinningSide:Y,score:ue})}dP({tournamentId:a==null?void 0:a.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(b&&c&&[ky].includes(c))return{error:ve,info:"Not supported for matchUpType: TEAM"};let S=v==null?void 0:v.matchUpTieId,U=qa({matchUpId:S||d,inContextDrawMatchUps:m,drawDefinition:l});if(h&&!b&&!n){let q=g.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),Y=lH({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:q,matchUpStatus:c,winningSide:u,score:h});if(Y.error)return Y}let C=g!=null&&g.sides?[]:Bi({drawDefinition:l,structureId:y}).positionAssignments,E=(z=v==null?void 0:v.sides)==null?void 0:z.map(q=>q.participantId).filter(Boolean).length,P=E&&E===2||g.collectionId&&Go({structure:I})&&E&&E>=1||(D==null?void 0:D.length)===2&&(C==null?void 0:C.filter(q=>D.includes(q.drawPosition)).every(q=>q.participantId));if(c&&Ij.includes(c)&&!P)return ae({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:c,requiredParticipants:P},result:{error:Ab}});let M=((H=Ei({policyTypes:[zT,ud],tournamentRecord:a,drawDefinition:l,event:p}))==null?void 0:H.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(M,t.policyDefinitions);let N=(v==null?void 0:v.stage)===mt&&v.finishingRound===1,R=N&&u,A=N&&g.winningSide&&!u&&(!t.matchUpStatus||t.matchUpStatus&&u$({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!Vr({outcome:t.outcome})),_=R&&u!==g.winningSide&&g.winningSide;if(Object.assign(t,{inContextDrawMatchUps:m,qualifierAdvancing:R,qualifierChanging:_,removingQualifier:A,inContextMatchUp:v,appliedPolicies:M,matchUpTieId:S,matchUpsMap:f,targetData:U,structure:I,matchUp:g}),S){let{matchUp:q}=nn({matchUpId:S,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p});if(q){let Y=(K=Ca({matchUp:q,drawDefinition:l,structure:I,event:p}))==null?void 0:K.tieFormat,{projectedWinningSide:Z}=ZNe({drawDefinition:l,matchUpStatus:c,dualMatchUp:q,matchUpsMap:f,winningSide:u,tieFormat:Y,structure:I,matchUp:g,event:p,score:h}),Q=q.winningSide;w=Z!==Q,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:w,projectedWinningSide:Z,matchUpTieId:S,dualMatchUp:q,tieFormat:Y})}}let O=$m(t),x=qD({matchUpStatus:c});if(!S){if(O&&!u&&(c&&u$({matchUpStatus:c})||c&&[Qn,hr].includes(c)))return{error:O1,activeDownstream:O,winningSide:u};if(u&&u===g.winningSide&&c&&!x)return{context:"winningSide must include directing matchUpStatus",error:O1,directingMatchUpStatus:x,matchUpStatus:c}}let{schedule:F}=t;if(F){let q=G_({disableNotice:!0,tournamentRecords:r,tournamentRecord:a,drawDefinition:l,matchUpId:d,schedule:F});if(q.error)return q}let $=!b&&!w&&u&&g.winningSide&&g.winningSide!==u;if(i&&$&&g.roundPosition)return hAe(t);let V=u&&!S||t.projectedWinningSide;Bs({activeDownstream:O,matchUpWinner:V,method:e,winningSide:u});let G=!O&&pAe(t)||V&&fAe(t)||x&&Aoe(t)||{error:tee};return ae({result:G,stack:e})}function fAe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?Aoe(t):ae({stack:"winningSideWithDownstreamDependencies",result:{error:AV},context:{winningSide:i,matchUp:e}})}function Aoe(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!Vr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&On||Wn:t.matchUpStatus||Wn,o=t.removeScore||[$p,Pi].includes(a)&&![su,cs].includes(a),s=Xc({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=zp({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function _oe({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:et};let{matchUp:r}=nn({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==lu?{error:oo}:TP({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function koe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:et};if(!i)return{error:la};let{matchUp:n}=nn({drawDefinition:t,event:e,matchUpId:i});return n?Ba({name:DA,element:n}):{error:ya}}function mAe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var h,f,m,g,v;let s="substituteParticipant";if(!n)return{error:et};if(!a)return{error:la};if(!e||!t)return ae({result:{error:mr},stack:s});let{matchUp:l}=nn({drawDefinition:n,matchUpId:a,event:o});if(!l)return{error:ya};if(!l.collectionId)return ae({result:{error:oo},stack:s});let c=ca({drawDefinition:n}),{matchUps:u}=sr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:c}),d=u==null?void 0:u.find(y=>y.matchUpId===a),p=(f=(h=u==null?void 0:u.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:h.sides)==null?void 0:f.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!p||r&&p.sideNumber!==r?{error:au}:(v=(g=(m=p.participant)==null?void 0:m.individualParticipants)==null?void 0:g.map(qt).filter(y=>y!==e))!=null&&v.includes(t)?cz({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):ae({result:{error:au},stack:s})}function Ooe(t){return mAe(t)}function xoe({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:et};let{matchUp:n}=nn({drawDefinition:t,matchUpId:e,event:i});return ci({extension:{name:Fb,value:!0},element:n})}function Loe(t){let e="setMatchUpFormat",i=gi(t,[{tournamentRecord:!0},{[uc]:D=>Ho({matchUpFormat:D}),[sd]:mD,matchUpFormat:!0}]);if(i.error)return ae({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return ae({result:{error:ve,scheduledDates:a},stack:e});if(c&&!HA([md,Al],c))return ae({result:{error:Vh},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return ae({result:{error:et},stack:e});if(h&&u&&r){let D=pH({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(D.error)return D;g+=1}let b=D=>{let w=[];for(let S of D.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,w.push(S.structureId),g+=1);let U=((m||a)&&Ti({matchUpFilters:{matchUpStatuses:[On]},structure:S}).matchUps)??[],C=(a&&Ti({matchUpFilters:{matchUpStatuses:[On]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(U!=null&&U.length){let E=C?C.map(Pr):U.map(Pr);for(let P of U)E.includes(P.matchUpId)&&(P.matchUpFormat=a!=null&&a.length?s:void 0,oi({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:D,matchUp:P}))}}return!w.length&&D.matchUpFormat!==s&&(D.matchUpFormat=s,g+=1),w};for(let D of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(D.eventId)||c&&c!==D.eventType||c===Tr))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of D.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let S=b(w);Xi({structureIds:S,drawDefinition:w})}else D.matchUpFormat!==s&&(D.matchUpFormat=s,g+=1);return g?{...ne,modificationsCount:g}:{...ne,info:i0}}function gz({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var l,c;if(!i)return{error:et};let a=(l=nn({drawDefinition:i,matchUpId:n}))==null?void 0:l.matchUp;if(!(a!=null&&a.tieMatchUps))return{error:oo};let o=(c=nn({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:c.matchUp,s=0;return((a==null?void 0:a.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((o==null?void 0:o.sides)||[]).forEach(u=>{if(s+=1,t===!1){let d=o==null?void 0:o.tieFormat,p=u.participantId;d&&p&&zy({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}oi({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:a})}),{...ne,modificationsCount:s}}function Foe(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let a=r.sets||[],o=Xu({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=Xu({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=Xu({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:a}),c=o===l?s:o;return n&&(o=n===1?l:c,s=n===2?l:c),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function UP(t){var v;let e=gi(t,[{[sg]:!0,[Lc]:!0}]);if(e.error)return e;let i=Uu(t);if(!t.drawDefinition){let y=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=y);let I=so({eventId:t.eventId,drawId:t.drawId,tournamentRecord:y});if(I.error)return I;I.drawDefinition&&(t.drawDefinition=I.drawDefinition),t.event=I.event}let{disableScoreValidation:n,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:u,schedule:d,event:p,notes:h}=t,{policy:f}=hg({policyType:ud,tournamentRecord:a,event:p}),m=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(f==null?void 0:f.allowChangePropagation)!==void 0&&f.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:uA};if(c){let y=pH({tournamentRecord:a,drawDefinition:l,matchUpFormat:c,matchUpId:u,event:p});if(y.error)return y}if((v=g==null?void 0:g.score)!=null&&v.sets&&!g.score.scoreStringSide1){let{score:y}=Foe(g);g.score=y,g.score.sets=g.score.sets.filter(I=>I.side1Score||I.side2Score||I.side1TiebreakScore||I.side2TiebreakScore)}return TP({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:m,disableScoreValidation:n,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:r,tournamentRecord:a,disableAutoCalc:o,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:u,schedule:d,event:p,notes:h})}function $oe(t){if(!(t!=null&&t.outcomes))return{error:ut};if(!Array.isArray(t.outcomes))return{error:ut,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:Re};let o=i.filter(s=>s.tournamentId===r);if(o.length){let s=gAe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...ne}}function gAe(t){var o;let{tournamentRecords:e,tournamentRecord:i,outcomes:n,policyDefinitions:r}=t,a={};n.forEach(s=>{let{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(let s of Object.keys(a)){let{event:l}=so({tournamentRecord:i,eventId:s});for(let c of a[s]){let{drawId:u}=c,d=(o=l==null?void 0:l.drawDefinitions)==null?void 0:o.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=UP({schedule:c==null?void 0:c.schedule,tournamentRecords:e,policyDefinitions:r,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...ne}}function vAe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:et};if(!i)return{error:ut,info:"missing outcome"};if(!n&&!e)return{error:To};if(!n){let o=nn({drawDefinition:t,matchUpId:e});if(o.error)return o;n=o.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:ve}:ci({element:n,extension:{name:DA,value:i}})}function Boe(t){return vAe(t)}function vz(t){var m,g;let e="resetTieFormat",{drawDefinition:i,event:n,uuids:r}=t,a=gi(t,[{[Rd]:!0,[sg]:!0}],e);if(a.error)return a;let o=bP(t,[{[SD]:If}]);if(o[mv])return o;let s=(m=t.tournamentRecord)==null?void 0:m.tournamentId,{matchUp:l,structure:c}=(o==null?void 0:o.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return ae({result:{error:oo},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...ne};let u=(g=Ca({structure:c,drawDefinition:i,event:n}))==null?void 0:g.tieFormat;if(!u)return ae({result:{error:Ia},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let v of u.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;p.push(I);let b=(l.tieMatchUps||[]).filter(D=>D.collectionId===I);if(b.length>y)b.sort((D,w)=>(D.matchUpStatus===On?1:0)-(w.matchUpStatus===On?1:0)),h.push(...b.slice(0,y)),d.push(...b.slice(3).map(Pr));else if(h.push(...b),b.length<y){let D=y-b.length,w=oP({collectionDefinition:v,matchUpsLimit:D,matchUp:l,uuids:r});f.push(...w)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return f.length&&(h.push(...f),Wh({eventId:n==null?void 0:n.eventId,matchUps:f,drawDefinition:i,tournamentId:s})),d.length&&Bp({matchUpIds:d,eventId:n==null?void 0:n.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,oi({structureId:c==null?void 0:c.structureId,eventId:n==null?void 0:n.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...ne,newMatchUps:f,deletedMatchUpIds:d}}function yz(t){var m,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}=t,a="resetScorecard";if(!i)return ae({result:{error:et},stack:a});if(!n)return ae({result:{error:la},stack:a});if(!Ga(n))return ae({result:{error:ve,matchUpId:n},stack:a});let o=ca({drawDefinition:i}),{matchUps:s}=sr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:o}),l=o.drawMatchUps.find(y=>y.matchUpId===n),c=s==null?void 0:s.find(y=>y.matchUpId===n);if(!l||!s)return{error:ya};if(l.matchUpType!==Ws)return{error:oo};let u=qa({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:n}),d=c==null?void 0:c.structureId,{structure:p}=Ut({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:c,matchUpsMap:o,targetData:u,structure:p,matchUp:l}),$m(t))return{error:AV};if((m=l.tieMatchUps)!=null&&m.length)for(let y of l.tieMatchUps){let I=TP({matchUpId:y.matchUpId,matchUpTieId:n,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:r});if(I.error)return ae({result:I,stack:a})}let h=(g=Ei({tournamentRecord:e,drawDefinition:i,event:r}))==null?void 0:g.appliedPolicies,f=zp({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:o,matchUpId:n});if(f.error)return ae({result:f,stack:a});if(t.tiebreakReset&&!f.tieFormatRemoved){let y=(v=Ca({drawDefinition:i,structure:p,event:r}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:D,valueDifference:w}=bp({descendant:l.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!D.collectionIds.length&&!D.groupsCount&&I===1&&w===1){let S=vz({tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r});if(S.error)return S}}}return{...ne}}function Voe(t){let e=gi(t,[{[Lc]:!0,[r0]:!0},{[GT]:{[wD]:!1,roundNumbers:!1},[Nee]:"At least one must be provided",[bf]:No}]);if(e.error)return e;let i=gne(t);if(i.error)return i;let{matchUpIds:n}=i,r=An(Ws)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of n){if(r){let u=yz({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error||t.removeAssignments&&gz({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return u}let c=TP({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=uz({...t,matchUpId:l});if(u.error)return u}}return{...ne}}function yAe({drawDefinition:t,finishingOrder:e}){var v;if(!t)return{error:et};let i="setOrderOfFinish";if(!Array.isArray(e))return ae({info:gd("finishingOrder"),result:{error:ve},stack:i});let{completedMatchUps:n,matchUpsMap:r}=y0({inContext:!0,drawDefinition:t}),a=(n==null?void 0:n.map(Pr))??[],o=e.map(Pr),{matchUpTypes:s,roundNumbers:l,structureIds:c,matchUpTieIds:u}=(n??[]).filter(({matchUpId:y})=>o.includes(y)).reduce((y,I)=>{let{matchUpTieId:b,matchUpType:D,roundNumber:w,structureId:S}=I;return y.matchUpTypes.includes(D)||y.matchUpTypes.push(D),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(b)||y.matchUpTieIds.push(b),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||u.length>1||l.length>1||c.length>1)return ae({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:ve},stack:i});let d,p,h={},f=[],m=[];if(!e.every(({orderOfFinish:y,matchUpId:I})=>(f.push(I),y&&m.push(y),h[I]=y,d=a.includes(I),p=y===void 0||Mt(y)&&Math.floor(y)>0,d&&p)))return ae({result:{error:d?ve:Ab},info:!d&&"matchUps must be completed"||!p&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:i});let g=n==null?void 0:n.filter(y=>y.structureId===c[0]&&y.roundNumber===l[0]&&y.matchUpType===s[0]&&y.matchUpTieId===u[0]&&!f.includes(y.matchUpId));for(let y of g??[]){let{orderOfFinish:I}=y||{};if(I){if(!Mt(I))return ae({context:{orderOfFinish:I,matchUp:y},result:{error:ve},stack:i});m.push(I)}}if(pee(m).length!==m.length||Math.max(...m)>m.length)return ae({info:"Values not unique or greater than expected number of values",result:{error:ve},stack:i});if(c.length){let y=zA({matchUpFilters:{matchUpIds:o},structureId:c[0],drawDefinition:t,matchUpsMap:r});if(y.error)return ae({result:y,stack:i});(v=y.completedMatchUps)==null||v.forEach(I=>I.orderOfFinish=h[I.matchUpId])}return{...ne}}function joe(t){return yAe(t)}function Goe({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:n,event:r}){var m,g,v,y;if(!t)return{error:Re};if(!e)return{error:$o};if(typeof i!="string")return{error:oo};if(!Array.isArray(n))return{error:ve,lineUps:n};let a="applyLineUps",o=t.participants||[],s=nn({tournamentParticipants:o,inContext:!0,drawDefinition:e,matchUpId:i});if(s.error)return s;if(!s.matchUp)return{error:ya};let{matchUp:l,structure:c}=s,{drawPositions:u,matchUpType:d}=l;if(d!==Ki)return{error:oo};if(!(u!=null&&u.length))return{error:hD};let p=(m=Ca({matchUp:l,drawDefinition:e,structure:c,event:r}))==null?void 0:m.tieFormat,h={};for(let I of n){if(!Array.isArray(I))return{error:ve,lineUp:I};let b={},D=[];for(let E of I){if(typeof E!="object")return{error:ve,lineUpAssignment:E};let{participantId:P,collectionAssignments:M=[]}=E;if(!Array.isArray(M))return{error:ve,collectionAssignments:M};let N=o.find(A=>A.participantId===P);if(!N)return{error:jn};if(N.participantType!==Kt)return{error:Dc};let R=(v=(g=l.sides)==null?void 0:g.find(A=>{var _,O;return(O=(_=A.participant)==null?void 0:_.individualParticipantIds)==null?void 0:O.includes(P)}))==null?void 0:v.sideNumber;R&&D.push(R);for(let A of M){if(typeof A!="object")return{error:ve,collectionAssignment:A};let{collectionId:_,collectionPosition:O}=A,x=(y=p==null?void 0:p.collectionDefinitions)==null?void 0:y.find(V=>V.collectionId===_);if(!x)return{error:ve,collectionId:_};let F=`${_}-${O}`;b[F]||(b[F]=[]);let $=b[F].length;if(An(Tn)(x.matchUpType)&&$||x.matchUpType===Wi&&$>1)return{info:"Excessive collectionPosition assignments",error:ve};b[F].push(P)}}let w=Object.values(b);for(let E of w)if(E.length===2){let{participant:P}=_l({tournamentParticipants:o,participantIds:E});if(!P){let M=pu({participant:{participantType:kt,participantRole:ga,individualParticipantIds:E},pairOverride:!0,tournamentRecord:t});if(M.error)return M}}let S=Vo(D),U=(S[1]||0)>(S[2]||0)&&1||(S[2]||0)>(S[1]||0)&&2||void 0,C=Object.keys(h).map(E=>parseInt(E));U&&!C.includes(U)&&(h[U]=I)}if(!Object.keys(h).length)return{error:VV};if(s=nn({drawDefinition:e,matchUpId:i}),s.error)return s;if(!s.matchUp)return{error:ya};let{matchUp:f}=s;f.sides||(f.sides=[]);for(let I of[1,2]){let b=f.sides.find(w=>w.sideNumber===I),D=h[I];if(D)b?b.lineUp=D:f.sides.push({lineUp:D,sideNumber:I});else continue}return oi({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:f}),{...ne}}var z_={};Gt(z_,{anonymizeTournamentRecord:()=>mse,generate:()=>Hoe,generateEventWithDraw:()=>Y_,generateOutcome:()=>Dz,generateOutcomeFromScoreString:()=>Iz,generateParticipants:()=>EP,generateTournamentRecord:()=>hse,modifyTournamentRecord:()=>gse,mutate:()=>fse});var Hoe={};Gt(Hoe,{generateEventWithDraw:()=>Y_,generateOutcome:()=>Dz,generateOutcomeFromScoreString:()=>Iz,generateParticipants:()=>EP,generateTournamentRecord:()=>hse});function Iz(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...QA,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:ve,winningSide:n};let a=r&&dR({scoreString:r}),o={},s=Xu({sets:a,matchUpFormat:e}),l=Xu({sets:a,reversed:!0,matchUpFormat:e});return n===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=dR({scoreString:o.scoreStringSide1}),ht({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function bz({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var a;let r=(((a=e==null?void 0:e[n.matchUpId])==null?void 0:a.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(r!=null&&r.length),remainingDependencies:r}}function Jb({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var c,u,d,p;let{individualParticipantIds:r}=LA(n);i=i??((c=n.schedule)==null?void 0:c.timeAfterRecovery);let a=h=>{t[h]||(t[h]=[]),t[h]=Ft(t[h].concat(...r))},o=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},s=((u=n.winnerTo)==null?void 0:u.matchUpId)||n.winnerMatchUpId;s&&(i&&o(s),a(s));let l=((d=n.loserTo)==null?void 0:d.matchUpId)||n.loserMatchUpId;l&&(i&&o(l),a(l)),(p=n.sidesTo)!=null&&p.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&o(h),a(h))})}function DP({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function IAe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function dU({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var f,m;let c=tn((f=l==null?void 0:l.schedule)==null?void 0:f.endTime),u=c?wo(c,wt(o)):wo(s,wt(n)+wt(o)),d=i&&(c?wo(tn(c),i):wo(s,wt(n)+wt(i))),p=((m=a==null?void 0:a[l.matchUpId])==null?void 0:m.participantIds)||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{DP({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||u;h.includes(g)?IAe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),Jb({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:u,matchUp:l})}function zoe({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var u,d,p,h,f;let a,o=(d=(u=r.minutesMap)==null?void 0:u[n])==null?void 0:d.recoveryMinutes,s=(((h=(p=r.minutesMap)==null?void 0:p[n])==null?void 0:h.averageMinutes)||0)+(o||0),l=wo(i,s),c=((f=e==null?void 0:e[n])==null?void 0:f.dependentMatchUpIds)||[];if(c.length){let m=c.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||ni(y)<ni(g.scheduleTime)?I:g},{});m.scheduleTime&&ni(l)>ni(m.scheduleTime)&&(a=m)}return{scheduledDependent:a}}function bAe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===Wi&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var PP="DO_NOT_SCHEDULE",Woe={DO_NOT_SCHEDULE:PP};function wz({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=bAe(o).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);s.push(...h)}let l=s.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===PP&&cd(a,h.date)),c=[],u=o==null?void 0:o.matchUpId,d=Xn(tn(r),xt(a)),p=tn(sj(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function F$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=LA(i),o=(t[i.matchUpId]||[]).filter(s=>!za(s,a)).flat();[...a,...o].forEach(s=>{if(DP({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Sl]?l[Sl]+=n:n>0&&(l[Sl]=n),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function wAe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var m,g;let p=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===bi;return I&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&yP({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map(Pr));let h=Array.isArray(l)?l.includes(c):l,f=h?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of f){F$({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(m=v.schedule)==null?void 0:m.scheduledTime;if(y){o[v.matchUpId]=y;let I=(g=u==null?void 0:u[v.matchUpId])==null?void 0:g.recoveryMinutes;dU({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:r,clearDate:h}}function SAe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),c=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),h=[bi,fi,Wn,cs,Ra,Pi,Qn,hr].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!h}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:h,tournamentId:f}=p;return d.matchUpMap[f]||(d.matchUpMap[f]={}),d.matchUpMap[f][h]?d.matchUpMap[f][h].push(p):d.matchUpMap[f][h]=[p],Jb({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function W_({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof n!="object")return{error:Pn};if(!Js(s)&&!Array.isArray(i))return{error:Md};a=a??F_({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=VD({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return yP({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==bi);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:I}=BA({timingDetails:v,eventType:g}),{courtId:b,venueId:D}=p,w=tn(p.scheduledTime),S=wo(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:S,venueId:D}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function TAe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Pn};s=s??F_({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=Wp({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(h==null?void 0:h.filter(D=>!u||u.includes(D.venueId)))??[];c=c??Xb({courts:m,scheduleDate:l,startTime:!0}),p=p??Xb({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=W_({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:I}=rz(y),b=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(jo("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function UAe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,o,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:r}),r=c.matchUpIds),s=i?e:c.averageMinutes,o=c.recoveryMinutes,a=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:n}}function qoe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var I;let m={},g=[],v=[],y=[];for(let b of f){let{rounds:D=[],venueId:w}=b,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:C,minutesMap:E}=gP({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:D});y.push(...C??[]);let{groupedRounds:P}=UAe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),M,N,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=TAe({averageMatchUpMinutes:(I=P[0])==null?void 0:I.averageMinutes,scheduleDate:xt(u),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let A=wAe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:M,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:O}=A;_!=null&&_.length&&v.push(..._);let{matchUpsToSchedule:x,matchUpMap:F}=SAe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:M,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:C,clearDate:O,matchUps:p}),$=h.filter(V=>V.venueId===w);m[w]={previousRemainingScheduleTimes:[],courtsCount:$.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:N,matchUpsToSchedule:x,scheduleTimes:R,groupedRounds:P,venueCourts:$,minutesMap:E,matchUpMap:F},s||g.push(...M)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function DAe(t,e){let i=ni(t.scheduleTime),n=ni(t.timeAfterRecovery),r=ni(e.scheduleTime),a=ni(e.timeAfterRecovery),o=i===r||n===a,s=i>r&&i<a,l=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return ht({hasOverlap:o||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function Sz({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var p,h,f,m,g;let o=(((p=i==null?void 0:i[r.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((f=(h=a==null?void 0:a.minutesMap)==null?void 0:h[r.matchUpId])==null?void 0:f.averageMinutes)||0,l=((g=(m=a==null?void 0:a.minutesMap)==null?void 0:m[r.matchUpId])==null?void 0:g.recoveryMinutes)||0,c=o.every(v=>{var D;DP({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let I=tn((D=r==null?void 0:r.schedule)==null?void 0:D.endTime),b=I?wo(I,wt(l)):wo(n,wt(s)+wt(l));return![...Object.keys(y.potentialBookings).filter(w=>w!==r.drawId).map(w=>y.potentialBookings[w]).flat(),...y.bookings].find(w=>DAe({scheduleTime:n,timeAfterRecovery:b},w).hasOverlap)}),u=e[r.matchUpId],d=(u?TD(Xn(u),Xn(n),!1):0)>=0;return{enoughTime:c&&d}}function Tz({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=LA(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=Ft(r.concat(...s));return l.forEach(c=>{DP({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[o,Sl].find(d=>{var f;let p=((f=u.counters)==null?void 0:f[d])||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function pU({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var g,v,y;if(!s)return{error:Re};if(!l&&(!c||!Array.isArray(c)))return{error:Jw};if(!l&&(!u||typeof u!="object"))return{error:YQ};let d,p=[],h=0;if(n&&!r){let I=zl({tournamentRecords:o,tournamentRecord:s});r=I.matchUpDependencies,d=I.matchUps}d||(d=((g=Br({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let f=d.reduce((I,b)=>{let{matchUpId:D,drawId:w,matchUpStatus:S}=b;return(e||S!==bi)&&(t||!gr.includes(S))&&(I[w]?I[w].push(D):I[w]=[D]),I},{}),m=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(f)){let{drawDefinition:b}=Pf({tournamentRecord:s,drawId:I});if(!b)continue;let D=f[I].filter(S=>(c==null?void 0:c.includes(S))??(m==null?void 0:m.includes(S))),w=no({inContext:!1,drawDefinition:b}).matchUps;for(let S of D){let U=((v=l==null?void 0:l.find(E=>E.matchUpId===S))==null?void 0:v.schedule)||u,C=G_({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:d,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:b,drawMatchUps:w,matchUpId:S});if((y=C==null?void 0:C.warnings)!=null&&y.length&&p.push(...C.warnings),C!=null&&C.success&&(h+=1),C.error)return C}}return p.length?{...ne,scheduled:h,warnings:p}:{...ne,scheduled:h}}function CP(t){var f;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:a,tournamentRecords:o,checkChronology:s,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!r)return pU(t);let u=gi(t,[{[ba]:!0},{[GT]:{matchUpContextIds:!1,matchUpDetails:!1},[sd]:ve,[bf]:No}]);if(u.error)return u;if((!l||r)&&!c)return{error:ut,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=zl({tournamentRecords:o});for(let m of Object.values(o)){let{tournamentId:g}=m,v=r==null?void 0:r.filter(I=>I.tournamentId===g).map(Pr),y=l==null?void 0:l.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=pU({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:a,tournamentRecords:o,tournamentRecord:m,checkChronology:s,matchUpIds:v,schedule:c});if((f=I.warnings)!=null&&f.length&&d.push(...I.warnings),I.scheduled&&(p+=I.scheduled),I.error)return I}}return d.length?{...ne,scheduled:p,warnings:d}:{...ne,scheduled:p}}function Koe({autoSchedulingAudit:t,tournamentRecords:e}){var o;ei({topic:Gb,payload:t});let i=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),r={scheduledDatesCount:(o=t.scheduledDates)==null?void 0:o.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:n},a={itemType:Qae,itemValue:r};for(let s of Object.values(e))Wy({tournamentRecord:s,timeItem:a})}function PAe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var M,N,R,A,_,O,x;let g={},v={},y={},I={},b={},D={},w={},S={},U={},C={};for(let F of r){let $=xt(F==null?void 0:F.scheduleDate),V=(F==null?void 0:F.venues)||[],G={},j={},z=(J,te)=>{J.forEach(se=>{let ee=j[se].counters;ee[te]?ee[te]+=1:ee[te]=1,ee[Sl]?ee[Sl]+=1:ee[Sl]=1})};y[$]={},I[$]={},g[$]={},v[$]={},w[$]=[],S[$]=[],U[$]=[],C[$]=[];let H={};h.forEach(J=>{var te;(te=J.schedule)!=null&&te.scheduledDate&&cd($,xt(J.schedule.scheduledDate))&&Jb({matchUpPotentialParticipantIds:G,matchUpNotBeforeTimes:H,matchUp:J})});let{allDateScheduledByeMatchUpDetails:K,venueScheduledRoundDetails:q,allDateMatchUpIds:Y}=qoe({matchUpPotentialParticipantIds:G,individualParticipantProfiles:j,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:H,matchUpScheduleTimes:D,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:$,matchUps:h,courts:f,venues:V}),Z=10,Q=0,ie,ue=10;for(;!ie;){for(let{venueId:J}of V){let te=0,se=q[J];for(;se.courtsCount&&((M=se.scheduleTimes)!=null&&M.length)&&((N=se.matchUpsToSchedule)!=null&&N.length)&&te<=se.courtsCount;){let{scheduleTime:ee,attempts:ce=0}=se.scheduleTimes.shift(),fe=se.matchUpsToSchedule.find(ge=>{var Ee,qe;let{matchUpId:he,matchUpType:Se}=ge,{participantIdsAtLimit:Ce,relevantParticipantIds:Fe}=Tz({matchUpPotentialParticipantIds:G,individualParticipantProfiles:j,matchUpDailyLimits:s,matchUp:ge});if(Ce.length)return S[$].includes(he)||S[$].push(he),!1;let{scheduledDependent:Je}=zoe({matchUpScheduleTimes:D,matchUpDependencies:o,scheduleTime:ee,matchUpId:he,details:se});if(Je)return!1;let{dependenciesScheduled:xe,remainingDependencies:st}=bz({matchUpScheduleTimes:D,matchUpDependencies:o,allDateMatchUpIds:Y,matchUp:ge});if(!xe)return I[$][he]||(I[$][he]=[]),I[$][he].push({scheduleTime:ee,remainingDependencies:st}),!1;let{enoughTime:we}=Sz({individualParticipantProfiles:j,matchUpNotBeforeTimes:H,matchUpDependencies:o,scheduleTime:ee,details:se,matchUp:ge});if(!we)return y[$][he]||(y[$][he]=[]),y[$][he].push({scheduleTime:ee}),!1;let Oe=se.greatestAverageMinutes,{conflicts:ye}=wz({potentials:e,averageMatchUpMinutes:Oe,requestConflicts:C,personRequests:d,scheduleTime:ee,scheduleDate:$,matchUp:ge});if(ye!=null&&ye.length)return b[$]||(b[$]=[]),b[$].push(...ye),!1;z(Fe,Se);let Be=(qe=(Ee=se.minutesMap)==null?void 0:Ee[he])==null?void 0:qe.recoveryMinutes;return dU({matchUpPotentialParticipantIds:G,individualParticipantProfiles:j,matchUpNotBeforeTimes:H,averageMatchUpMinutes:Oe,matchUpDependencies:o,recoveryMinutes:Be,scheduleTime:ee,matchUp:ge}),D[he]=ee,!0});se.matchUpsToSchedule=se.matchUpsToSchedule.filter(({matchUpId:ge})=>ge!==(fe==null?void 0:fe.matchUpId)),fe?te+=1:(v[$][J]||(v[$][J]=[]),v[$][J].push({scheduleTime:ee,attempts:ce+1}))}(R=se.matchUpsToSchedule)!=null&&R.length&&(v[$][J]=(A=v[$][J])==null?void 0:A.filter(ee=>{let ce=ee.attempts<Z;return ce&&se.scheduleTimes.push(ee),!ce})),(!((_=se.scheduleTimes)!=null&&_.length)||!((O=se.matchUpsToSchedule)!=null&&O.length))&&(se.complete=!0)}Q+=1,ie=V.every(({venueId:J})=>q[J].complete)||Q===ue}for(let{venueId:J}of V){let te=q[J].matchUpMap;Object.keys(te).forEach(se=>{let ee=c[se];ee&&Object.keys(te[se]).forEach(ce=>{let{drawDefinition:fe}=Pf({tournamentRecord:ee,drawId:ce});fe&&te[se][ce].forEach(({matchUpId:ge})=>{let he=D[ge];if(he){let Se=he.split(":").map(Ns).join(":"),Ce=`${xt($)}T${Se}`;m?w[$].push(ge):(Cf({drawDefinition:fe,scheduledTime:Ce,matchUpId:ge}).success&&w[$].push(ge),J&&M0({tournamentRecord:ee,drawDefinition:fe,matchUpId:ge,venueId:J}))}})})}),U[$]=q[J].matchUpsToSchedule.map(Pr),g[$][J]=q[J].scheduleTimes.sort((se,ee)=>ni(se.scheduleTime)-ni(ee.scheduleTime))}!m&&(K!=null&&K.length)&&CP({matchUpDetails:K,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of F.venues)for(let te of J.rounds){let se=(((x=te.matchUps)==null?void 0:x.map(({matchUpId:ce})=>ce))||[]).filter(ce=>w[$].includes(ce));te.canScheduledMatchUpIds=se;let ee=Math.round(se.length/te.matchUpsCount*1e4)/100;(ee===1/0||isNaN(ee))&&(ee=0),te.possibleToSchedulePct=ee,te.matchUpsCount===se.length&&(te.possibleToSchedule=!0)}}let E=r.map(({scheduleDate:F})=>F),P={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:w,schedulingProfile:u,noTimeMatchUpIds:U,requestConflicts:C,scheduledDates:E};return Koe({tournamentRecords:c,autoSchedulingAudit:P}),{...ne,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:g,dateSchedulingProfiles:r,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:D,overLimitMatchUpIds:S,scheduledMatchUpIds:w,noTimeMatchUpIds:U,requestConflicts:C,scheduledDates:E}}function xK({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:ut,stack:"getEarliestCourtTime"};let a=Xb({scheduleDate:r,courts:[n],startTime:!0}),o=Xb({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||o;let s=SP({court:n,date:r}),{timeSlots:l}=C0({courtDate:s}),c=Xn(e),u=Xn(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=Xn(p.startTime),f=Xn(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(TD(m,f)>=t){let g=tn(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function CAe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var P,M;let g={},v={},y={},I={},b={},D={},w={},S={},U={};for(let N of r??[]){let R=xt(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},O={},x=(J,te)=>{J.forEach(se=>{let ee=O[se].counters;ee[te]?ee[te]+=1:ee[te]=1,ee[Sl]?ee[Sl]+=1:ee[Sl]=1})};g[R]={},v[R]={},D[R]=[],w[R]=[],S[R]=[],U[R]=[];let F={};h==null||h.forEach(J=>{var te;(te=J.schedule)!=null&&te.scheduledDate&&cd(R,xt(J.schedule.scheduledDate))&&Jb({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:F,matchUp:J})});let{allDateScheduledByeMatchUpDetails:$,allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:G,allDateMatchUpIds:j}=qoe({matchUpPotentialParticipantIds:_,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:F,matchUpScheduleTimes:b,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:R,matchUps:h,courts:f,venues:A}),z=h==null?void 0:h.filter(({matchUpId:J})=>V.includes(J)),{bookings:H}=W_({dateScheduledMatchUps:z,tournamentRecords:c,scheduleDate:R,periodLength:u}),{virtualCourts:K}=L_({scheduleDate:R,periodLength:u,bookings:H,courts:f}),q=K==null?void 0:K.reduce((J,te)=>{let{earliestCourtTime:se,courtEndTime:ee}=xK({date:R,averageMinutes:0,court:te});return(!J.startTime||Xn(se)<Xn(J.startTime))&&(J.startTime=se),(!J.endTime||Xn(ee)>Xn(J.endTime))&&(J.endTime=ee),J},{}),Y=q.startTime,Z=({courtId:J,booking:te})=>{var se;return(se=K==null?void 0:K.find(ee=>ee.courtId===J))==null?void 0:se.dateAvailability[0].bookings.push(te)},Q=10,ie=0,ue;for(;!ue;){for(let{venueId:J}of A){let te=G[J],se=te.matchUpsToSchedule.length,ee=[],ce=[],fe,ge=0;for(;!fe;){for(let he of te.matchUpsToSchedule){if(ce.length===te.courtsCount||ee.length===te.courtsCount){fe=!0;break}let{matchUpId:Se,matchUpType:Ce}=he,{participantIdsAtLimit:Fe,relevantParticipantIds:Je}=Tz({matchUpPotentialParticipantIds:_,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:he});if(Fe.length){w[R].includes(Se)||w[R].push(Se);continue}let{dependenciesScheduled:xe,remainingDependencies:st}=bz({matchUpScheduleTimes:b,matchUpDependencies:o,allDateMatchUpIds:j,matchUp:he});if(!xe){v[R][Se]||(v[R][Se]=[]),v[R][Se].push({remainingDependencies:st});continue}let we=[],Oe=K==null?void 0:K.reduce((ye,Be)=>{var Ae,ze,de,pe;if(ce.includes(Be.courtId))return ye;let{earliestCourtTime:Ee}=xK({averageMinutes:te.greatestAverageMinutes,startTime:Y,date:R,court:Be});if(ye.scheduleTime&&ni(Ee)>=ni(ye.scheduleTime))return ye;let{scheduledDependent:qe}=zoe({matchUpScheduleTimes:b,matchUpDependencies:o,scheduleTime:Ee,matchUpId:Se,details:te});if(qe)return ye;let{enoughTime:Ge}=Sz({individualParticipantProfiles:O,matchUpNotBeforeTimes:F,matchUpDependencies:o,scheduleTime:Ee,details:te,matchUp:he});if(!Ge)return g[R][Se]||(g[R][Se]=[]),g[R][Se].includes(Ee)||g[R][Se].push(Ee),ye;let me=((ze=(Ae=te.minutesMap)==null?void 0:Ae[Se])==null?void 0:ze.averageMinutes)||te.greatestAverageMinutes,{conflicts:Me}=wz({potentials:e,averageMatchUpMinutes:me,requestConflicts:U,personRequests:p,scheduleTime:Ee,scheduleDate:R,matchUp:he});if(Me!=null&&Me.length)return we.push(...Me),!1;x(Je,Ce);let De=(pe=(de=te.minutesMap)==null?void 0:de[Se])==null?void 0:pe.recoveryMinutes;return dU({matchUpPotentialParticipantIds:_,individualParticipantProfiles:O,matchUpNotBeforeTimes:F,averageMatchUpMinutes:me,matchUpDependencies:o,recoveryMinutes:De,scheduleTime:Ee,matchUp:he}),(!ye.scheduleTime||ni(Ee)<ni(ye.scheduleTime))&&(ye.averageMatchUpMinutes=me,ye.recoveryMinutes=De,ye.scheduleTime=Ee,ye.courtName=Be.courtName,ye.courtId=Be.courtId),ye},{});if(Oe.scheduleTime){let{averageMatchUpMinutes:ye,recoveryMinutes:Be,scheduleTime:Ee,courtId:qe}=Oe;b[Se]=Ee,I[Se]=qe,ee.push(Se),ce.push(qe);let Ge=Ee,me=wo(Ge,ye);Z({courtId:qe,booking:{averageMatchUpMinutes:ye,recoveryMinutes:Be,periodLength:u,matchUpId:Se,startTime:Ge,courtId:qe,endTime:me,venueId:J}}),te.matchUpsToSchedule=te.matchUpsToSchedule.filter(Me=>Me.matchUpId!==Se)}else we!=null&&we.length&&(y[R]||(y[R]=[]),y[R].push(...we))}(ce.length===te.courtsCount||ee.length===te.courtsCount||!te.matchUpsToSchedule.length)&&(fe=!0),te.matchUpsToSchedule.length&&ee<te.courtsCount&&(Xn(Y)<Xn(q.endTime)?Y=wo(Y,u):(fe=!0,te.complete=!0)),ge+=1,!fe&&ge>=se&&(fe=!0)}(P=te.matchUpsToSchedule)!=null&&P.length||(te.complete=!0)}ie+=1,ue=A.every(({venueId:J})=>G[J].complete)||ie===Q}for(let{venueId:J}of A){let te=G[J].matchUpMap;Object.keys(te).forEach(se=>{let ee=c[se];ee&&Object.keys(te[se]).forEach(ce=>{let{drawDefinition:fe}=Pf({tournamentRecord:ee,drawId:ce});fe&&te[se][ce].forEach(({matchUpId:ge})=>{let he=b[ge],Se=I[ge];if(he){let Ce=he.split(":").map(Ns).join(":"),Fe=`${xt(R)}T${Ce}`;m||(Cf({drawDefinition:fe,scheduledTime:Fe,matchUpId:ge}),Jy({courtDayDate:R,tournamentRecords:c,tournamentRecord:ee,drawDefinition:fe,matchUpId:ge,courtId:Se})),D[R].push(ge)}})})}),S[R]=G[J].matchUpsToSchedule.map(Pr)}!m&&($!=null&&$.length)&&CP({matchUpDetails:$,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let te of J.rounds){let se=(M=(te.matchUps??[]).map(({matchUpId:ce})=>ce))==null?void 0:M.filter(ce=>D[R].includes(ce));te.canScheduledMatchUpIds=se;let ee=Math.round(((se==null?void 0:se.length)||0)/te.matchUpsCount*1e4)/100;(ee===1/0||isNaN(ee))&&(ee=void 0),te.possibleToSchedulePct=ee,te.matchUpsCount===(se==null?void 0:se.length)&&(te.possibleToSchedule=!0)}}let C=(r??[]).map(({scheduleDate:N})=>N),E={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:D,schedulingProfile:d,noTimeMatchUpIds:S,requestConflicts:U,scheduledDates:C};return Koe({tournamentRecords:c,autoSchedulingAudit:E}),{...ne,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:b,overLimitMatchUpIds:w,scheduledMatchUpIds:D,noTimeMatchUpIds:S,requestConflicts:U,scheduledDates:C}}function q_(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=gr,scheduledDates:n,venueIds:r}=t,a=Uu(t),o=Zi(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Pn};let s=0;for(let l of o){let c=a[l],u=EAe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...ne,clearedScheduleCount:s}}function EAe({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=gr,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:Re};if(!Array.isArray(e)||!Array.isArray(r))return{error:ve};r.length&&t.push("venueId");let a=Br({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&yP({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let c in o){let{event:u,drawDefinition:d}=so({tournamentRecord:i,drawId:c}),p=no({drawDefinition:d,matchUpFilters:{matchUpIds:o[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![yp,km,f0,m0,g0].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(oi({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:h}),l+=1)}}return{...ne,clearedScheduleCount:l}}function K_(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:c}=t,u=gi(t,[{[ba]:!0},{[uc]:C=>!C||Array.isArray(C)&&C.every(ss),[Dee]:!1,[bf]:No}]);if(u.error)return u;let d=qp({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...ne};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(C=>h0({tournamentRecord:C}).containedStructures)),g=r.map(C=>{if(ss(C))return xt(C)}).filter(Boolean),v=f.map(C=>C.scheduleDate).map(C=>ss(C)&&xt(C)).filter(C=>C&&(!r.length||g.includes(C)));if(!v.length)return{error:DQ};if(n&&!l){let C=Array.isArray(n)?n:[];q_({tournamentRecords:a,scheduledDates:C})}let y=Wp({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=Cc({matchUpFilters:{matchUpTypes:[Tn,Wi]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=zl({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:D}=R_({tournamentRecords:a}),{personRequests:w}=wg({requestType:PP,tournamentRecords:a}),S=f.filter(C=>{let E=xt(C==null?void 0:C.scheduleDate);return v.includes(E)}).sort((C,E)=>new Date(C.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:b,matchUpDailyLimits:D,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return c?CAe(U):PAe(U)}function Yoe(t){let e=t||{};return e.tournamentId||(e.tournamentId=Oi()),e.startDate&&!Mm(e.startDate)&&!BM.test(e.startDate)?{error:Ha}:e.endDate&&!Mm(e.endDate)&&!BM.test(e.endDate)?{error:Ha}:(e.extensions&&(e.extensions=e.extensions.filter(ou)),{...e})}function Uz({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var f,m;if(!i)return{error:Re};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Kt&&v===ga),c=0;for(let g of l){let v=a&&((f=vv({element:g,accessor:a}))==null?void 0:f.value)||n&&((m=g.person)==null?void 0:m[n])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(r==null?void 0:r[c])??v,participantId:(o==null?void 0:o.pop())??Oi(),individualParticipantIds:[],participantRole:ga,participantType:ji};let y={value:n??e,name:t$};ci({element:s[v],extension:y}),c+=1}s[v].individualParticipantIds.push(g.participantId)}}let u=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==ji||g.participantRole!==ga)return;let{extension:v}=Vt({name:t$,element:g}),y=v==null?void 0:v.value;if(u.includes(y))return g.participantId}).filter(Boolean),p=0,h=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),h.push(v),p++)}),t&&p?(ei({payload:{tournamentId:i.tournamentId,participants:h},topic:zh}),{...ne,participantsAdded:p}):h.length?{...ne,newParticipants:h}:{error:eDe}}var MAe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],RAe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Zoe({count:t=1,participantsCount:e=32}={}){let i=La(RAe),n=i.slice(0,t);return{cities:Ze(0,e).map(r=>r<Math.min(t,i.length)?n[r]:_o(n))}}function Xoe({count:t=1,participantsCount:e=32}={}){let i=La(MAe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Ze(0,e).map(r=>r<Math.min(t,i.length)?n[r]:_o(n))}}function Joe({count:t=1,participantsCount:e=32}={}){let i=Ze(0,t).map(()=>Ze(0,5).map(()=>Ds(0,9)).join(""));return{postalCodes:Ze(0,e).map(n=>n<t?i[n]:_o(i))}}function Qoe(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var NAe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function pL(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![Hi,fn].includes(i))return{personData:[],error:ve};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:o}=NAe,s=kh.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/a.length),u=Math.ceil(n/o.length),d=Ze(0,l).flatMap(()=>{let m=at(r,!1,!0);return Ze(0,r.length).map(()=>Oo(m))}),p=Ze(0,c).flatMap(()=>{let m=at(a,!1,!0);return Ze(0,a.length).map(()=>Oo(m))}),h=Ze(0,u).flatMap(()=>{let m=at(o,!1,!0);return Ze(0,o.length).map(()=>Oo(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||_o([Hi,fn]),y=v===Hi?h.pop():p.pop(),I=_o(s);f[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function ese(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:ve};let c=(a==null?void 0:a[Hi])||l===Hi&&e||0,u=(a==null?void 0:a[fn])||l===fn&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&pL({count:c,sex:Hi}).personData||[],h=u&&pL({count:u,sex:fn}).personData||[],f=[...p,...h,...d&&pL({count:d}).personData||[]],m=f.filter(U=>!l||c&&u||U.sex===l),g=[];if(Array.isArray(o)){let U=o.filter(C=>typeof C.firstName!="string"||typeof C.lastName!="string"||C.sex&&![Hi,fn].includes(C.sex)||C.nationalityCode&&(typeof C.nationalityCode!="string"||C.nationalityCode.length>3||!kh.find(({iso:E,ioc:P})=>[E,P].includes(C.nationalityCode)))?!1:(C.nationalityCode&&g.push(C.nationalityCode),!0));if(U.length)m=U;else return{error:ve}}let v=o?m:La(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:C,femaleFirstNames:E,femaleLastNames:P,nationalityCodes:M}=f.reduce((N,R)=>{let{firstName:A,lastName:_,nationalityCode:O}=R;return R.sex===Hi?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Ze(0,e-v.length).forEach(()=>{let N=l||_o([Hi,fn]),R=_o(M),A=_o(N===Hi?U:E),_=_o(N===Hi?C:P),O={firstName:A,lastName:_,sex:N,nationalityCode:R};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=lP({consideredDate:n,category:s}),b=wt((y==null?void 0:y.slice(0,4))||0)||wt((I==null?void 0:I.slice(0,4))||0)-3,D=wt((I==null?void 0:I.slice(0,4))||0)||wt((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,D],S=v.slice(0,e).map((U,C)=>{let[E,P]=w||[],M=w&&Oo(Ze(E,P)),N=Oo(Ze(0,365)),R=M&&dPe(M,N);return Object.assign(ht({extensions:i||[{name:"regionCode",value:C+1}],birthDate:R,isMock:r}),U)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var AAe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function $$({nameRoot:t="TEAM",count:e=1}={}){let i=La(AAe).slice(0,e);return i.length<e&&Ze(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function B$({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===Kt?"I":"P"}-${i}`:(n==null?void 0:n.pop())||Oi()}function EP(t){let{rankingRange:e,scaledParticipantsCount:i}=t,{ratingsParameters:n=ns,valuesInstanceLimit:r,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:c,participantsCount:u=32,participantType:d,personIds:p,idPrefix:h,uuids:f,personExtensions:m,addressProps:g,gendersCount:v,matchUpType:y,personData:I,sex:b,inContext:D,withISO2:w,withIOC:S,scaleAllParticipants:U}=t,C=d===kt||y===Am,E=d===ji||y===ji;e&&(!Array.isArray(e)||!e.every(ge=>En(ge))||e.length!==2)&&(e=void 0),i=U?u:i;let P=1e3,M=i&&i>P?i:P;e=e||[1,M],e[1]+=1;let N=u*(C?2:E?8:1),R=ese({count:N,personExtensions:m,consideredDate:a,gendersCount:v,personData:I,category:o,sex:b});if(R.error)return R;let{nationalityCodes:A,persons:_}=R,O=[],x=[],F=[],$=[];if(typeof o=="object"){let{categoryName:ge,ageCategoryCode:he,ratingType:Se}=o;if((ge||he)&&!Se){let[Ce,Fe]=e||[];if(x=La(Ze(Ce,Fe)).slice(0,i||Ds(20,30)),[kt,ji].includes(d)){let[Je,xe]=e||[];O=La(Ze(Je,xe)).slice(0,i||Ds(20,30))}}if(Se&&n[Se]){let{ratingMax:Ce,ratingMin:Fe,ratingAttributes:Je}=o,xe={...n[Se],...Je||{}},{attributes:st={},decimalsCount:we,accessors:Oe,range:ye,step:Be}=xe,Ee=De=>{let Ae={},ze=Object.keys(De||{});for(let de of ze){let pe=De[de];if(typeof pe=="object"&&pe.generator){let{range:ke}=pe,[Ue,Te]=ke.slice().sort();Ae[de]=Ds(Ue,Te)}else Ae[de]=pe}return Ae},qe=ye[0]>ye[1]?2:.5,[Ge,me]=ye.slice().sort(),Me=()=>Ze(0,2e3).map(()=>uee(Ge,me,qe,Be,we)).filter(De=>(!Ce||De<=Ce)&&(!Fe||De>=Fe)).slice(0,i||Ds(20,30)).map(De=>Oe?Object.assign({},...Oe.map(Ae=>({[Ae]:De})),Ee(st)):De);F=Me(),[kt,ji].includes(d)&&($=Me())}}let V=kh.filter(ge=>l==="IOC"&&ge.ioc||ge.iso);function G(ge){let he=Math.ceil(N/ge);return r&&he>r?Math.ceil(N/r):ge}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:H,citiesProfile:K,citiesCount:q,statesCount:Y}=g||{},Z=ge=>Object.keys(ge).map(he=>Ze(0,H[he]).map(()=>he)).flat(),Q=K&&Z(K)||(g==null?void 0:g.cities)||Zoe({count:q||N,participantsCount:N}).cities,ie=H&&Z(H)||(g==null?void 0:g.states)||Xoe({count:Y||N,participantsCount:N}).states,ue=j&&Z(j)||(g==null?void 0:g.postalCodes)||Joe({count:z||N,participantsCount:N}).postalCodes,J={cities:Q,states:ie,postalCodes:ue},te=G(s),se=te?La(V).slice(0,s):c?V.filter(ge=>c.includes(ge.iso)):V,ee=La(Ze(0,Math.ceil(N/(te||1))).map(()=>se).flat(1/0)),ce=$$({count:u}).names;return{participants:Ze(0,u).map(ge=>{let he=C?2:E?8:1,Se=Ze(0,he).map(st=>{let we=ge*he+st;return fe(we)}),Ce=Se.map(st=>st.participantId),Fe=Se.map(st=>st.person.standardFamilyName).join("/"),Je=C?kt:ji,xe={participantId:B$({participantType:Je,idPrefix:h,index:ge,uuids:f}),participantRole:ga,participantName:C?Fe:ce[ge],individualParticipantIds:Ce,participantType:Je};return D&&(xe.individualParticipants=Se),C||E?[xe,...Se]:Se}).flat(),...ne};function fe(ge){let he=_[ge],{nationalityCode:Se,participantExtensions:Ce,participantTimeItems:Fe,extensions:Je,firstName:xe,birthDate:st,lastName:we,personId:Oe,sex:ye}=he||{},Be=xe||"GivenName",Ee=we||"FamilyName",qe=`${Be} ${Ee}`,Ge=ee[ge],me=(A==null?void 0:A.length)&&Se||Ge&&(l==="IOC"?Ge.ioc||Ge.iso:Ge.iso||Ge.ioc)||Se;ee!=null&&ee.length&&!me&&!Se&&console.log("%c Invalid Nationality Code",{participantIndex:ge,country:Ge});let Me=Qoe({...J,participantIndex:ge,nationalityCode:me}),De=ht({participantId:B$({participantType:Kt,index:ge,idPrefix:h,uuids:f}),extensions:Ce,timeItems:Fe,participantRole:ga,participantType:Kt,participantName:qe,person:{addresses:[Me],personId:Oe||(p==null?void 0:p.length)&&p[ge]||Oi(),standardFamilyName:Ee,standardGivenName:Be,nationalityCode:me,extensions:Je,birthDate:ss(st)?st:void 0,sex:ye}});if(S&&me){let Ae=kh.find(({iso:ze})=>ze===me);Ae!=null&&Ae.ioc&&(De.person.iocNationalityCode=Ae.ioc),Ae!=null&&Ae.label&&(De.person.countryName=Ae.label)}if(w&&me){let Ae=kh.find(({iso:ze})=>ze===me);Ae!=null&&Ae.iso2&&(De.person.iso2NationalityCode=Ae.iso2),Ae!=null&&Ae.label&&(De.person.countryName=Ae.label)}if(o){let Ae=x[ge],ze=O[ge];BE({scaleValue:Ae,eventType:Yv,scaleType:jh,participant:De,category:o}),BE({scaleValue:ze,eventType:Kh,scaleType:jh,participant:De,category:o});let de=F[ge],pe=$[ge];BE({scaleValue:de,eventType:Yv,scaleType:wm,participant:De,category:o}),BE({scaleValue:pe,eventType:Kh,scaleType:wm,participant:De,category:o})}return De}}function BE({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o=[Gv,n,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function tse({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:n}){var h;let r=0,a=0,o=0,s=0,l={},c={[Hi]:0,[fn]:0,[Lo]:0,[sv]:0,[cu]:0};i=typeof i=="object"?i:ey({namedFormat:e}),(h=i==null?void 0:i.collectionDefinitions)==null||h.filter(Boolean).forEach(f=>{let{category:m,collectionId:g,matchUpType:v,matchUpCount:y,gender:I}=f;if([Hi,fn].includes(I)){let b=y*(v===Wi?2:1);c[I]<b&&(c[I]=b)}else I===Lo&&(c[Hi]<y&&(c[Hi]=y),c[fn]<y&&(c[fn]=y));if(m){let b=JSON.stringify(m);l[b]=m}if(g||(f.collectionId=Oi()),An(Wi)(v)){let b=y;s+=y,r=Math.max(r,b)}if(An(Tn)(v)){let b=y;o+=y,a=Math.max(a,b)}});let u=Object.keys(l).length?Math.max(o,s*2):Math.max(a,r*2),d=r*(n+t),p=a*(n+t);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function _Ae({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Kt}=t||{},a=n||0,o={[fn]:0,[Lo]:0,[sv]:0,[Hi]:0,[cu]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:D,stage:w})=>{let S=y===Al,U=y===Tr,C=!!(m||w===mt||b||D);if(U){u=Math.max(u,v+f),I=typeof I=="object"?I:ey({namedFormat:g});let{teamSize:E,maxDoublesDraw:P,maxSinglesDraw:M,genders:N}=tse({alternatesCount:f,tieFormatName:g,tieFormat:I,drawSize:v});c=Math.max(c,E),l=Math.max(l,M),C||(s=Math.max(s,P)),Object.keys(N).forEach(R=>o[R]+=N[R])}else if(S)if(C){let E=(v+f)*2;d+=E,D&&(o[D]+=E)}else v+f&&v+f>s&&(s=v+f);else if(C){let E=v+f;D&&(o[D]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=f;if(v)for(let D of v){let{tieFormatName:w,tieFormat:S}=D;p({...D,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,s*2,l);return s&&(r=kt),(n||a)<h&&(n=h),n&&s&&[kt,Tr].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:o}}function ise({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=_Ae({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=EP({uuids:a,...t,consideredDate:r,participantsCount:o,participantType:s,gendersCount:u}).participants,h=0,f=Ec({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=Uz({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Kt).map(qt),g=t!=null&&t.idPrefix?`${ji}-${t.idPrefix}`:void 0,v=Ze(0,l).map(y=>{let I=m.slice(y*c,(y+1)*c),b=B$({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:ga,individualParticipantIds:I,participantType:ji,participantId:b}});return f=Ec({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...ne})}function nse({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=it,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let h=(c||p)-l;return u||i||e||d===mt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):o[d]=Math.max(o[d],h),o},{}),a=Object.keys(n);return a.forEach(o=>r[o]+=n[o]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function rse({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[it]||0,a=e[mt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+r)}}}var kAe={[Pi]:2,[Qn]:1,[hr]:1,[Ra]:1,[fi]:4};function Dz(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=kAe,matchUpFormat:r=_s,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Ho({matchUpFormat:r}))return{error:DV};if(typeof n!="object")return{error:ve};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:ve};let s=Object.keys(n).filter(U=>Object.keys(Uj).includes(U)&&U!==Wn);if(Object.keys(s).reduce((U,C)=>U+n[C],0)>100)return{error:ve,matchUpStatusProfile:n};let l=s.reduce((U,C)=>(U.pointer=U.pointer+n[C],U.valueMap.push([U.pointer,C]),U),{pointer:0,valueMap:[]}),c=Ds(1,100),u=(l.valueMap.find(U=>c<=U[0])??[100,Wn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Pi,fi].includes(u)){i=i||Ds(1,2);let U={score:d,winningSide:i,matchUpStatus:u};if(!(u===fi&&Ds(1,100)>100-e))return{outcome:U}}else if([Qn,hr].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=fo(r),{bestOf:h,setFormat:f,finalSetFormat:m}=p??{},g=[],v=Ds(0,1),y=i?[i-1]:[...Ze(0,o).map(()=>v),1-v],I=[Ra,fi,su,Tf].includes(u)&&(Oo(Ze(1,h))||1),b;for(let U of Ze(1,(h??0)+1)){let C=U===h,{set:E,incomplete:P,winningSideNumber:M}=OAe({incomplete:I===U,matchUpStatus:u,pointsPerMinute:a,setFormat:C&&m||f,setNumber:U,weightedRange:y});if(g.push(E),P){b=M;break}if(uU({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let D=uU({matchUp:{score:{sets:g},matchUpFormat:r}}),w=b?i||b:D.calculatedWinningSide,{score:S}=Foe({score:{sets:g},winningSide:w,matchUpStatus:u});return{outcome:{score:S,winningSide:w,matchUpStatus:u}}}function OAe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=Ds(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Oo([1,-1])*v,I=UDe(y,2),b=[I,y-I];f&&b.reverse(),m=t[h]+1;let D=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(n){let[U,C]=b;return Object.assign(o,{side1Score:U,side2Score:C}),gr.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}D||(b[Ds(0,1)]+=1),D=b[0]>b[1]?1:2,D!==m&&b.reverse();let[w,S]=b;return Object.assign(o,{side1Score:w,side2Score:S,winningSide:m}),{set:o}}else{if(n)return o.side1Score=Ds(0,c),o.side2Score=Ds(0,c),gr.includes(i)&&(m=t[h]+1),{set:o,incomplete:n,winningSideNumber:m};{let g=Ze(1,s+1).map(S=>Ze(0,s+2-S).map(()=>S)).flat(),v=g[Ds(0,g.length-1)],y=s&&cH({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[h]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():f&&y.reverse();let[S,U]=y;Object.assign(o,{side1Score:S,side2Score:U})}let D=lU({matchUpScoringFormat:{setFormat:r},setObject:o}),w;if(D.hasTiebreakCondition||I){let{NoAD:S,tiebreakTo:U}=l||u||{},C=Ze(1,U+1).map(M=>Ze(0,U+2-M).map(()=>M)).flat(),E=C[Ds(0,C.length-1)],P=v_({isSide1:!0,tiebreakNoAd:S,tiebreakTo:U,lowValue:E});if(P)if(I){let M=P[0]>P[1]?1:2;b?M!==b&&P.reverse():f&&P.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=P,w=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else D.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=P:[o.side2TiebreakScore,o.side1TiebreakScore]=P}o.winningSide=D.winningSide||D.leadingSide||b||w}}return{set:o}}function mR(t){var m,g,v;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:n,tournamentRecord:r,completionGoal:a,drawDefinition:o,event:s}=t;if(!o)return{error:et};let l=t.matchUpFormat||o.matchUpFormat||(s==null?void 0:s.matchUpFormat),c=o.structures.slice().sort(xy),u=0,{matchUps:d,matchUpsMap:p}=sr({contextFilters:{stages:[it,mt]},matchUpFilters:{matchUpTypes:[Ki],roundNumbers:[1]},inContext:!0,drawDefinition:o});if(d!=null&&d.length){let y=((m=s==null?void 0:s.category)==null?void 0:m.ageCategoryCode)||((g=s==null?void 0:s.category)==null?void 0:g.categoryName);if(y){let I=voe({singlesOnly:!0,tournamentRecord:r,drawDefinition:o,scaleAccessor:{scaleName:y,sortOrder:moe,scaleType:jh},event:s});if(I.error)return I;let{lineUps:b,participantsToAdd:D}=I;Ec({tournamentRecord:r,participants:D}),ci({element:o,extension:{name:pp,value:b}})}else{let I=(v=d[0])==null?void 0:v.structureId,{positionAssignments:b}=Bi({drawDefinition:o,structureId:I});if(b!=null&&b.length){let{participants:D}=xn({participantFilters:{participantTypes:[Ki]},tournamentRecord:r}),w=S=>{let U=S.tieMatchUps.filter(An(Tn)),C=S.tieMatchUps.filter(An(Wi));U.forEach((E,P)=>{let M=E.matchUpId;E.sides.forEach(N=>{var _;let{drawPosition:R}=N,A=D==null?void 0:D.find(O=>{var F;let{participantId:x}=O;return((F=b.find($=>$.participantId===x))==null?void 0:F.drawPosition)===R});if(A){let O=(_=A.individualParticipantIds)==null?void 0:_[P];O&&fR({teamParticipantId:A.participantId,participantId:O,tournamentRecord:r,drawDefinition:o,tieMatchUpId:M,event:s})}})}),C.forEach((E,P)=>{let M=E.matchUpId;E.sides.forEach(N=>{var _,O;let{drawPosition:R}=N,A=D==null?void 0:D.find(x=>{var $;let{participantId:F}=x;return(($=b.find(V=>V.participantId===F))==null?void 0:$.drawPosition)===R});A&&((O=(_=A.individualParticipantIds)==null?void 0:_.slice(P*2,P*2+2))==null||O.forEach(x=>{fR({teamParticipantId:A.participantId,participantId:x,tournamentRecord:r,drawDefinition:o,tieMatchUpId:M,event:s})}))})})};d.forEach(w)}}}let h=typeof i=="string"&&i,f=h&&Wn;for(let y of c){if(u>=a)break;let{matchUps:I}=Ti({matchUpFilters:{matchUpTypes:[Wi,Tn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:y,event:s}),b=I.filter(({winningSide:D})=>!D).sort(Vy).map(Pr);for(let D of b){if(!isNaN(a)&&u>=a)break;let{matchUps:w}=Ti({matchUpFilters:{matchUpTypes:[Wi,Tn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:o,matchUpsMap:p,structure:y,event:s}),S=w.find(C=>C.matchUpId===D),U=[Qn,hr].includes(S.matchUpStatus);if(S!=null&&S.readyToScore&&!U){let C=xAe({winningSide:!n&&1,matchUpStatusProfile:e,tournamentRecord:r,drawDefinition:o,targetMatchUp:S,matchUpFormat:l,matchUpStatus:f,scoreString:h,event:s});if(C!=null&&C.error)return C;u+=1}}}return{...ne,completedCount:u}}function ase(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===bi)return;let{matchUpId:d}=a||{},{outcome:p}=Iz({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),UP({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function xAe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||a)return ase(t);let{matchUpId:d}=s||{},{outcome:p}=Dz({matchUpStatusProfile:e,matchUpFormat:o,winningSide:c});return UP({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function ose({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){var f,m,g,v;let o=Bn({event:a}).flightProfile,{eventName:s,eventType:l,category:c}=a,{startDate:u}=n,d=[],p=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(c==null?void 0:c.ratingType),h=(f=a.drawDefinitions)==null?void 0:f.map(({drawId:y})=>y);if(Array.isArray(o==null?void 0:o.flights))for(let[y,I]of o.flights.entries()){let{drawId:b,stage:D,drawName:w,drawEntries:S}=I;d.push(I.drawId);let U=r[y],{seedsCount:C,generate:E=!0}=U||{};if(E){let P=S.filter(jo(od)).map(jo(od)),M=p||s;if(n&&C&&C<=P.length&&Ze(1,C+1).forEach((O,x)=>{let F={scaleValue:O,scaleName:M,scaleType:qu,eventType:l,scaleDate:u},$=P[x];Yb({tournamentRecord:n,participantId:$,scaleItem:F})}),h==null?void 0:h.includes(b))break;let N=N_({...U,matchUpType:l,seedingScaleName:M,tournamentRecord:n,isMock:!0,drawEntries:S,drawName:w,drawId:b,event:a,stage:D});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:R}=N;if(!R)return{error:$o};let A=(m=r[y])==null?void 0:m.drawExtensions;if(Array.isArray(A)&&A.filter(ou).forEach(O=>ci({element:R,extension:O})),N=k_({suppressNotifications:!0,tournamentRecord:n,drawDefinition:R,event:a}),N.error)return{error:N.error,drawIds:[]};if(U!=null&&U.withPlayoffs){let O=(g=R.structures)==null?void 0:g[0].structureId,x=r_({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:n,drawDefinition:R,isMock:!0,structureId:O,event:a});if(x!=null&&x.error)return x}let _=U==null?void 0:U.completionGoal;if((U==null?void 0:U.automated)!==!1&&(e||_)){let O=U==null?void 0:U.matchUpFormat,x=mR({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:R,matchUpFormat:O,event:a});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((U==null?void 0:U.drawType)===hd){let $=(v=R.structures)==null?void 0:v.find(j=>j.stage===it);if(!$)return{error:bn};let V=iP({structureId:$.structureId,tournamentRecord:n,drawDefinition:R,event:a});if(V.error)return{error:V.error,drawIds:[]};let G=_?_-(F??0):void 0;if(V=mR({completeAllMatchUps:!_&&e,completionGoal:_?G:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:R,matchUpFormat:O,event:a}),V.error)return{error:V.error,drawIds:[]}}}}}return{...ne,drawIds:d}}function sse(t){var w,S;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:n,tournamentRecord:r,eventProfile:a,eventIndex:o,event:s,uuids:l}=t,{category:c,gender:u,eventType:d}=s,p=An(md)(d)&&Kt||An(Al)(d)&&kt||d,h=i[it]||0,f=i[mt]||0,m=(w=a.drawProfiles)!=null&&w.length?h+f:((S=a.participantsProfile)==null?void 0:S.participantsCount)??0,g=[Hi,fn].includes(u)?u:void 0,v=e!=null&&e.idPrefix?`E-${o}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=EP({uuids:a.uuids||l,...e,scaledParticipantsCount:a.scaledParticipantsCount,consideredDate:r==null?void 0:r.startDate,rankingRange:a.rankingRange,participantType:p,participantsCount:m,ratingsParameters:n,category:c,idPrefix:v,sex:g}),I=Ec({tournamentRecord:r,participants:y});if(I.error)return I;let b=y==null?void 0:y.filter(({participantType:U})=>U===p),D=y==null?void 0:y.map(qt);return{uniqueDrawParticipants:b,uniqueParticipantIds:D}}function LAe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=Zc,qualifyingPositions:o=0,stage:s=it,drawSize:l=0,drawName:c,drawId:u}=n,d=l-o,p=i.slice(0,d).map(qt);if(p.length){let m=Zu({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:us,entryStage:s,participantId:m})),f=x_({drawName:c||a,qualifyingPositions:o,drawEntries:h,drawId:u,event:r,stage:s});return f.error?f:{...ne}}function lse({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=it,drawSize:h=0}=c,f=h-u,m=d||o||a||p===mt,g=m?t.slice(l,l+f):i[p||it]||[];m&&(l+=f);let v=LAe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:s});if(v.error)return v}return{...ne}}function cse(t){var Z;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=u.gender,g=u.eventName,{eventType:v=md,policyDefinitions:y,drawProfiles:I=[],eventExtensions:b,surfaceCategory:D,tieFormatName:w,processCodes:S,discipline:U,eventLevel:C,timeItems:E,ballType:P,category:M}=u,N=u.eventId||Oi(),R=u.tieFormat||(v===Tr?ey({namedFormat:w,event:{eventId:N,category:M,gender:m},hydrateCollections:o,isMock:h}):void 0),A=c.participants;for(let Q of I)!m&&Q.gender&&(m=Q==null?void 0:Q.gender);let{stageParticipantsCount:_,uniqueParticipantsCount:O,uniqueParticipantStages:x}=nse({drawProfiles:I,category:M,gender:m}),F=An(md)(v)&&Kt||An(Al)(v)&&kt||v,{uniqueDrawParticipants:$=[],uniqueParticipantIds:V=[]}=x?sse({event:{eventType:v,category:M,gender:m},uniqueParticipantsCount:O,participantsProfile:n,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:f}):{},{eventAttributes:G}=u;typeof G!="object"&&(G={});let j=(M==null?void 0:M.categoryName)||(M==null?void 0:M.ageCategoryCode)||(M==null?void 0:M.ratingType);g=g||j||"Generated Event";let z={...G,surfaceCategory:D,processCodes:S,discipline:U,eventLevel:C,eventName:g,eventType:v,tieFormat:R,ballType:P,category:M,eventId:N,gender:m};if(b!=null&&b.length&&Array.isArray(b)){let Q=b.filter(ou);Q!=null&&Q.length&&Object.assign(z,{extensions:Q})}if(Array.isArray(E)&&E.forEach(Q=>qy({event:q,timeItem:Q})),typeof y=="object")for(let Q of Object.keys(y))Fm({policyDefinitions:{[Q]:y[Q]},event:z});z.category&&(z.category.categoryName=j);let H,K=wP({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:z});if(K.error)return K;let q=K==null?void 0:K.event,{stageParticipants:Y}=rse({allUniqueParticipantIds:e,stageParticipantsCount:_,eventParticipantType:F,targetParticipants:A});if(I!=null&&I.length){let Q=lse({uniqueDrawParticipants:$,autoEntryPositions:a,stageParticipants:Y,tournamentRecord:c,drawProfiles:I,category:M,gender:m,event:q});if(Q.error)return Q;let ie=ose({matchUpStatusProfile:i,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:c,drawProfiles:I,event:q});if(ie.error)return ie;H=ie.drawIds}else if((Z=u==null?void 0:u.participantsProfile)!=null&&Z.participantsCount){let Q=$.map(qt);if(Q.length){let ie=Zu({participantIds:Q,autoEntryPositions:a,tournamentRecord:c,entryStage:it,event:q});if(ie.error)return ie}}return p&&P0({tournamentRecord:c,event:q}),{drawIds:H,eventId:N,uniqueParticipantIds:V}}function Pz({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!ss(e))return{error:Ha};let r="addSchedulingProfileRound",{extension:a}=Vt({name:Wv,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>cd(e,p.scheduleDate));if(!s){let{startDate:p,endDate:h}=b_({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Ha};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>Zi(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return ae({result:{error:hQ},stack:r});l.rounds.push(n);let d=U0({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...ne}}function FAe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:ve};let i=h0({tournamentRecord:e}).containedStructures,n=Br({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var b;let y=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(D=>+D),I=(b=v.finishingPositionRange)==null?void 0:b.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!I||!y||kn(I,y).length===2||Ft(I).length===Ft(y).length&&kn(I,y).length===Ft(I).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:D}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(C=>i[C].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=Pz({tournamentRecords:{[r]:e},round:S,scheduleDate:s,venueId:d});if(U.error)return U;a.push({structureName:b,roundName:D,drawName:I,...S})}}}}return{scheduledRounds:a}}function Y_(t){var Je,xe,st;let e=gi(t,[{drawProfile:!0,_ofType:jd}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=at(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=_s,drawType:I=Zc,tournamentAlternates:b=0,alternatesCount:D=0,qualifyingPositions:w,qualifyingProfiles:S,generate:U=!0,eventExtensions:C,drawExtensions:E,completionGoal:P,tieFormatName:M,seedsCount:N,timeItems:R,drawName:A,category:_,idPrefix:O,publish:x,gender:F,stage:$}=g,V=g.drawSize||(g.ignoreDefaults?void 0:32),G=g.eventId||Oi(),j=p.eventType||p.matchUpType||md,z=j===Al?kt:Kt,H=typeof p.tieFormat=="object"&&p.tieFormat||j===ji&&ey({event:{eventId:G,category:_,gender:F},namedFormat:M,hydrateCollections:s,isMock:d})||void 0,K=(_==null?void 0:_.categoryName)||(_==null?void 0:_.ageCategoryCode)||(_==null?void 0:_.ratingType),q=p.eventName||K||`Generated ${j}`,Y=(u==null?void 0:u.participants)||[],Z=((S==null?void 0:S.map(we=>we.structureProfiles||[]).flat().reduce((we,Oe)=>{let ye=!Oe.participantsCount||Oe.participantsCount>Oe.drawSize?Oe.drawSize:Oe.participantsCount||0;return we+ye},0))||0)*(z===kt?2:1),Q=(!p.participantsCount||p.participantsCount>V?V:p.participantsCount)||0,ie={eventName:q,eventType:j,tieFormat:H,category:_,eventId:G,gender:F};Array.isArray(R)&&R.forEach(we=>qy({event:ie,timeItem:we}));let{eventAttributes:ue}=p;if(typeof ue!="object"&&(ue={}),Object.assign(ie,ue),(C==null?void 0:C.length)&&Array.isArray(C)){let we=C.filter(ou);we!=null&&we.length&&Object.assign(ie,{extensions:we})}let J=[];if(Z||p.uniqueParticipants||!u||F||_){let we=(Q||0)+D+Z,Oe=we,ye={[Hi]:0,[fn]:0},Be,Ee;j===ji&&({teamSize:Be,genders:Ee}=tse({alternatesCount:D,tieFormatName:M,tieFormat:H,drawSize:V}),Object.keys(Ee).forEach(me=>{[Hi,fn].includes(me)&&Ee[me]&&(ye[me]=V*Ee[me])}),Oe=Be*((V||0)+Z));let qe=n!=null&&n.idPrefix?`D-${f}-${n==null?void 0:n.idPrefix}`:void 0,Ge=EP({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:Oe,consideredDate:u==null?void 0:u.startDate,sex:F||(n==null?void 0:n.sex),rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:z,gendersCount:ye,idPrefix:qe,category:_}).participants;if(ie.category&&(ie.category.categoryName=K),u){let me=Ec({participants:Ge,tournamentRecord:u});if(me.error)return me}if(Ge.forEach(({participantId:me})=>J.push(me)),Y=Ge,j===ji){let me=Ee[Hi]?Ge.filter(({participantType:Te,person:rt})=>Te===Kt&&(rt==null?void 0:rt.sex)===Hi).map(qt):[],Me=Ee[fn]?Ge.filter(({participantType:Te,person:rt})=>Te===Kt&&(rt==null?void 0:rt.sex)===fn).map(qt):[],De=Ge.filter(({participantType:Te})=>Te===Kt).map(qt).filter(Te=>!me.includes(Te)&&!Me.includes(Te)),Ae=Be-(Ee[Hi]+Ee[fn]),ze=0,de=0,pe=0,ke=Ze(0,we).map(Te=>{let rt=Me.slice(ze,ze+Ee[fn]),je=me.slice(de,de+Ee[Hi]),Le=De.slice(pe,pe+Ae);return ze+=Ee[fn],de+=Ee[Hi],pe+=Ae,{individualParticipantIds:[...rt,...je,...Le],participantOtherName:`TM${Te+1}`,participantName:`Team ${Te+1}`,participantRole:ga,participantType:ji,participantId:Oi()}}),Ue=Ec({participants:ke,tournamentRecord:u});if(!Ue.success)return Ue;Y=ke}}let te=we=>{let{participantType:Oe}=we;return An(md)(j)&&Oe===Kt||An(Al)(j)&&Oe===kt?!0:j===ji&&Oe===ji},se=we=>{var Oe,ye;return!p.gender||((Oe=we.person)==null?void 0:Oe.sex)===p.gender?!0:(ye=we.individualParticipantIds)==null?void 0:ye.some(Be=>{let Ee=Y.find(qe=>qe.participantId===Be);return Ee&&se(Ee)})},ee=Y.filter(te).filter(se).filter(({participantId:we})=>!i.includes(we)),ce=ee.slice(0,Q).map(we=>we.participantId);if(d&&(ce!=null&&ce.length)){let we=Zu({autoEntryPositions:o,entryStage:$,tournamentRecord:u,participantIds:ce,event:ie});if(we.error)return we}let fe=Z?ee.slice(Q,Q+Z).map(we=>we.participantId):0;if(d&&(fe!=null&&fe.length)){let we=0,Oe=1,ye=(Ee,qe)=>Ee.stageSequence-qe.stageSequence,Be=(Ee,qe)=>Ee.roundTarget-qe.roundTarget;for(let Ee of S.sort(Be)){Oe=Ee.roundTarget||Oe;let qe=1,Ge;for(let me of Ee.structureProfiles.sort(ye)){let Me=(me.drawSize||HV(me.participantsCount))-(Ge||0),De=fe.slice(we,we+Me),Ae=Zu({entryStage:mt,entryStageSequence:qe,autoEntryPositions:o,tournamentRecord:u,participantIds:De,roundTarget:Oe,event:ie});if(Ae.error)return Ae;Ge=me.qualifyingPositions,we+=Me,qe+=1}Oe+=1}}let ge=v&&((Je=u==null?void 0:u.participants)==null?void 0:Je.filter(({participantId:we})=>!ce.includes(we)).filter(te).filter(se).slice(0,D||V-Q||b).map(we=>we.participantId));if(d&&(ge!=null&&ge.length)){let we=Zu({participantIds:ge,autoEntryPositions:!1,entryStatus:wl,tournamentRecord:u,event:ie});if(we.error)return we.error}let he=K||q;u&&N&&N<=ce.length&&Ze(1,N+1).forEach((we,Oe)=>{let ye={scaleName:he,scaleDate:h,scaleType:Qj,scaleValue:we,eventType:j},Be=ce[Oe];Yb({tournamentRecord:u,participantId:Be,scaleItem:ye})});let Se=N_({...at(p,!1,!0),tournamentRecord:u,seedingScaleName:he,matchUpFormat:y,eventId:G,isMock:d,event:ie});if(Se.error)return Se;if(!Se.drawDefinition)return{error:$o};let{drawDefinition:Ce}=Se,Fe=Ce.drawId;if(Array.isArray(E)&&E.filter(ou).forEach(we=>ci({element:Ce,extension:we})),U){if(k_({drawDefinition:Ce,event:ie,suppressNotifications:!0}),p.withPlayoffs){let Oe=(xe=Ce.structures)==null?void 0:xe[0].structureId,ye=r_({...p.withPlayoffs,tournamentRecord:u,drawDefinition:Ce,structureId:Oe,idPrefix:O,isMock:d,event:ie});if(ye!=null&&ye.error)return ye}let we=p.automated===!1;if(d&&!we){let Oe=ye=>{var qe;let Be=mR({completeAllMatchUps:ye.completeAllMatchUps,completionGoal:ye.completionGoal,matchUpStatusProfile:r,randomWinningSide:l,tournamentRecord:u,drawDefinition:Ce,matchUpFormat:y,event:ie});if(Be.error)return Be;let Ee=Be.completedCount;if(I===hd){let Ge=(qe=Ce.structures)==null?void 0:qe.find(De=>De.stage===it);if(!Ge)return{error:bn};iP({structureId:Ge.structureId,tournamentRecord:u,drawDefinition:Ce,event:ie});let me=P?P-(Ee??0):void 0,Me=mR({completionGoal:P?me:void 0,matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawDefinition:Ce,matchUpFormat:y,event:ie});if(Me.error)return Me}};if(P&&Oe({completionGoal:P}),p.outcomes){let{matchUps:ye}=no({inContext:!0,drawDefinition:Ce,event:ie});for(let Be of p.outcomes){let{matchUpStatus:Ee=Wn,matchUpStatusCodes:qe,stageSequence:Ge=1,matchUpIndex:me=0,structureOrder:Me,matchUpFormat:De,drawPositions:Ae,roundPosition:ze,stage:de=it,roundNumber:pe,winningSide:ke,scoreString:Ue}=Be,Te=(ye==null?void 0:ye.reduce((It,zt)=>{let{structureId:Jt,matchUpId:Yr}=zt;return It[Jt]?It[Jt].push(Yr):It[Jt]=[Yr],It},{}))??[],rt=Object.assign({},...Object.keys(Te).map((It,zt)=>({[It]:zt+1}))),je=(st=ye==null?void 0:ye.filter(It=>(!de||It.stage===de)&&(!Ge||It.stageSequence===Ge)&&(!pe||It.roundNumber===pe)&&(!ze||It.roundPosition===ze)&&(!Me||rt[It.structureId]===Me)&&(!Ae||kn(Ae,It.drawPositions).length===2)))==null?void 0:st[me],Le=ase({matchUpStatusCodes:qe,tournamentRecord:u,drawDefinition:Ce,targetMatchUp:je,matchUpFormat:De,matchUpStatus:Ee,scoreString:Ue,winningSide:ke});if(Le!=null&&Le.error)return Le}}a&&Oe({completeAllMatchUps:a})}x&&P0({tournamentRecord:u,event:ie})}else{let we=x_({drawEntries:Ce.entries,drawName:A||I,qualifyingPositions:w,drawId:Fe,event:ie,stage:$});if(we.error)return we}return{...ne,event:ht(ie),uniqueParticipantIds:J,targetParticipants:Y,drawDefinition:Ce,eventId:G,drawId:Fe}}var use=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),$Ae=use;function gR(t){return parseInt(t)}function LK({startTime:t="",endTime:e=""}={}){if(!t||!e||!vm.test(t)||!vm.test(e))return!1;let[i,n]=t.split(":").map(gR),[r,a]=e.split(":").map(gR);return r<i?!1:!(i===r&&a<n)}function BAe(t,e){let[i,n]=t.startTime.split(":").map(gR),[r,a]=e.startTime.split(":").map(gR);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function dse({dateAvailability:t}){if(!t)return{error:PQ};if(!Array.isArray(t))return{error:x1};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:x1};let{date:r,startTime:a,endTime:o,bookings:s=[]}=n;if(!a||!o)return{error:x1};if(r&&!ld.test(r))return{error:Ha,dateAvailability:{date:r},info:e};if(!vm.test(a))return{error:cl,dateAvailability:{startTime:a},info:i};if(!vm.test(o))return{error:cl,dateAvailability:{endTime:o},info:i};if(a===o)return{error:cl,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!LK({startTime:a,endTime:o}))return{error:cl,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:FM};for(let l of s){if(typeof l!="object")return{error:FM};let{startTime:c,endTime:u}=l;if(!vm.test(c))return{error:cl,booking:{startTime:c},info:i};if(!vm.test(u))return{error:cl,booking:{endTime:u},info:i};if(c===u)return{error:cl,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!LK({startTime:c,endTime:u}))return{error:cl,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function Z_({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=jp({tournamentRecord:t,venueId:i});if(!a)return{error:t0};a.courts||(a.courts=[]);let o={...use(),venueId:i,courtId:n};if(o.courtId||(o.courtId=Oi()),a.courts.some(s=>s.courtId===o.courtId))return{error:GQ};{let s=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:xt(u.date),startTime:tn(u.startTime),endTime:tn(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:tn(p),endTime:tn(h),bookingType:f}))}}),l=Object.keys(o);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=dse({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[u]=r[u];let c=o;return a.courts.push(c),e||ei({payload:{venue:a,tournamentId:t.tournamentId},topic:ug,key:a.venueId}),{...ne,court:at(o),venueId:i}}}function Cz(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:vf};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let o of Object.values(n)){let{venue:s}=jp({tournamentRecord:o,venueId:i});if(s){let l=VAe({...t,tournamentRecord:o});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...ne,courtIds:r}:{error:t0}}function VAe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:vf};let h=jp({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!En(o)||!r)return{error:jQ};o=o??r.length;let m=Ze(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:Ic(I),startTime:s,endTime:c,...v})):e;return v&&s&&c&&y.push({startTime:s,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return Z_({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==o?ae({info:"not all courts could be generated",result:{error:ve}}):(f&&ei({payload:{venue:f,tournamentId:n.tournamentId},topic:ug,key:f.venueId}),{...ne,courts:at(m)})}function pse({tournamentRecord:t,venueProfiles:e,uuids:i}){let{startDate:n,endDate:r}=t,a=[];for(let[o,s]of e.entries()){let{venueAbbreviation:l,venueId:c=(i==null?void 0:i.pop())??Oi(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:h,courtsCount:f,courtNames:m,venueName:g,idPrefix:v,courtIds:y}=s,I={venueName:g||`Venue ${o+1}`,venueAbbreviation:l,venueId:c},b=GD({tournamentRecord:t,venue:I});if(b.error)return b;a.push(c);let D=Ob(n,r),w=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(D.map(U=>({date:Ic(U),startTime:d,endTime:p}))),S=Cz({dateAvailability:u||w,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:m,startTime:d,idPrefix:v,courtIds:y,endTime:p,venueId:c,dates:D});if(S.error)return S}return a}var jAe=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function hse(t){let{tournamentAttributes:e,startDate:i,endDate:n}=t??{},{tournamentName:r=Oo(jAe),ratingsParameters:a=ns,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:c,participantsProfile:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,policyDefinitions:f,schedulingProfile:m,periodLength:g,autoSchedule:v,eventProfiles:y,venueProfiles:I,drawProfiles:b,uuids:D}=t??{};if(i&&!ss(i)||n&&!ss(n))return{error:Ha};if(y&&!Array.isArray(y))return{error:ve};if(!i){let R=new Date;i=Ic(n??R),n=Ic(R.setDate(R.getDate()+7))}if(!n){let R=new Date(i);n=Ic(R.setDate(R.getDate()+7))}typeof e!="object"&&(e={});let w=Yoe({...e,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(s!=null&&s.length&&Array.isArray(s)){let R=s.filter(A=>ou({extension:A}));R!=null&&R.length&&Object.assign(w,{extensions:R,isMock:!0})}if(typeof f=="object")for(let R of Object.keys(f))Fm({policyDefinitions:{[R]:f[R]},tournamentRecord:w});let S=ise({participantsProfile:u,tournamentRecord:w,eventProfiles:y,drawProfiles:b,startDate:i,uuids:D});if(!S.success)return S;let U=[],C=[],E=[];if(Array.isArray(b)){let R=0;for(let A of b){let _=Y_({allUniqueParticipantIds:U,matchUpStatusProfile:l,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,participantsProfile:u,randomWinningSide:h,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:A,startDate:i,drawIndex:R,uuids:D});if(_.error)return _;let{drawId:O,eventId:x,event:F,uniqueParticipantIds:$}=_;if(_=wP({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:F}),_.error)return _;O&&E.push(O),C.push(x),$!=null&&$.length&&U.push(...$),R+=1}}if(y){let R=0;for(let A of y){let _=cse({allUniqueParticipantIds:U,matchUpStatusProfile:l,participantsProfile:u,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,ratingsParameters:a,tournamentRecord:w,eventProfile:A,eventIndex:R,startDate:i,uuids:D});if(_.error)return _;let{eventId:O,drawIds:x,uniqueParticipantIds:F}=_;x&&E.push(...x),C.push(O),F!=null&&F.length&&U.push(...F),R+=1}}let P=I!=null&&I.length?pse({tournamentRecord:w,venueProfiles:I,uuids:D}):[],M,N={};if(m){let R=FAe({schedulingProfile:m,tournamentRecord:w});if(R.error)return R;if(M=R.scheduledRounds,v){let{tournamentId:A}=w,_={[A]:w};N=K_({scheduleCompletedMatchUps:o,tournamentRecords:_,periodLength:g})}}return qV(),ht({...ne,tournamentRecord:w,scheduledRounds:M,schedulerResult:N,eventIds:C,venueIds:P,drawIds:E})}var fse={};Gt(fse,{anonymizeTournamentRecord:()=>mse,modifyTournamentRecord:()=>gse});function mse({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var x,F,$,V,G;if(!i)return{error:Re};let o=Array.isArray(t)?q7.concat(...t):q7,s=j=>{var z;return Array.isArray(t)?(z=j==null?void 0:j.extensions)==null?void 0:z.filter(H=>o.includes(H.name)):j==null?void 0:j.extensions},l={};i.extensions=s(i);let c=a||Oi();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Ic(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let j of i.participants||[]){let z=Oi();l[j.participantId]=z,j.participantId=z}for(let j of i.participants||[])Array.isArray(j.individualParticipantIds)&&(j.individualParticipantIds=j.individualParticipantIds.map(z=>l[z]));let u=0;for(let j of i.venues||[]){j.extensions=s(j),j.venueName=`Venue #${u}`,j.venueAbbreviation=`V${u}`;let z=Oi();l[j.venueId]=z,j.isMock=!0,u+=1}let d=1;for(let j of i.events||[]){j.extensions=s(j),j.isMock=!0;let z=Oi();l[j.eventId]=z,j.eventId=z;let H=((x=j.category)==null?void 0:x.categoryName)||((F=j.category)==null?void 0:F.ageCategoryCode)||(($=j.category)==null?void 0:$.ratingType)||j.gender;if(j.eventName=`Event ${d} ${H}`,Array.isArray(j.entries))for(let q of j.entries)q.participantId=l[q.participantId];for(let q of j.drawDefinitions||[]){q.extensions=s(q);let Y=Oi();if(l[q.drawId]=Y,q.drawId=Y,q.isMock=!0,Array.isArray(q.entries))for(let Q of q.entries)Q.participantId=l[Q.participantId];let Z=Q=>{Q.extensions=s(Q);let ie=Oi();l[Q.structureId]=ie,Q.structureId=ie;for(let ue of Q.positionAssignments||[])ue.participantId&&(ue.participantId=l[ue.participantId]);for(let ue of Q.seedAssignments||[])ue.participantId&&(ue.participantId=l[ue.participantId]);for(let ue of Q.matchUps||[]){ue.isMock=!0;for(let J of ue.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:te,collectionAssignments:se})=>({participantId:l[te],collectionAssignments:se})))}};for(let Q of q.structures||[])if(Z(Q),Array.isArray(Q.structures))for(let ie of Q.structures)Z(ie);for(let Q of q.links||[])Q.source.structureId=l[Q.source.structureId],Q.target.structureId=l[Q.target.structureId]}let{extension:K}=Vt({name:Ml,element:j});Array.isArray((V=K==null?void 0:K.value)==null?void 0:V.flights)&&((G=K==null?void 0:K.value.flights)==null||G.forEach(q=>{if(q.drawId=l[q.drawId],Array.isArray(q.drawEntries))for(let Y of q.drawEntries)Y.participantId=l[Y.participantId]})),d+=1}let p=i.startDate||Ic(new Date),h=(i.participants||[]).filter(({participantType:j})=>j===Kt),f=h.reduce((j,z)=>{var K;let H=(K=z.person)==null?void 0:K.sex;return[Hi,fn].includes(H)?j[H]+=1:j[sv]+=1,j},{[Hi]:0,[fn]:0,[sv]:0}),m=Object.assign({},...Object.keys(f).map(j=>{var z;return{[j]:((z=ese({category:{ageCategoryCode:"O18"},count:f[j],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:j}))==null?void 0:z.persons)||[]}})),g={[Hi]:0,[fn]:0,[sv]:0},v=h.length,y=h.reduce((j,z)=>{var Z,Q;let H=((Q=(Z=z.person)==null?void 0:Z.addresses)==null?void 0:Q[0])||{},{city:K,state:q,postalCode:Y}=H;return j.cities.includes(K)||j.cities.push(K),j.states.includes(q)||j.states.push(q),j.postalCodes.includes(Y)||j.postalCodes.push(Y),j},{cities:[],postalCodes:[],states:[]}),I=y.postalCodes.length,b=y.cities.length,D=y.states.length,{cities:w}=Zoe({count:b||v,participantsCount:v}),{states:S}=Xoe({count:D||v,participantsCount:v}),{postalCodes:U}=Joe({count:I||v,participantsCount:v}),C={cities:w,states:S,postalCodes:U};h.forEach((j,z)=>{var Q,ie;let H=j==null?void 0:j.person,K=(H==null?void 0:H.sex)||sv,q=(Q=xt(H==null?void 0:H.birthDate))==null?void 0:Q.split("-")[0],Y=g[K],Z=m[K][Y];if(g[K]+=1,q){let[,ue,J]=((ie=Z==null?void 0:Z.birthDate)==null?void 0:ie.split("-"))||[],te=[q,ue,J].join("-");Z.birthDate=te}if(H!=null&&H.addresses){let ue=Qoe({...C,participantIndex:z,nationalityCode:Z.nationalityCode});Z.addresses=[ue]}Z.personId=(r==null?void 0:r[z])||Oi(),e?(Z.standardFamilyName=Z.lastName,Z.standardGivenName=Z.firstName,j.participantName=`${Z.standardGivenName} ${Z.standardFamilyName}`):(Z.standardFamilyName=H==null?void 0:H.standardFamilyName,Z.standardGivenName=H==null?void 0:H.standardGivenName),delete Z.firstName,delete Z.lastName,Z.extensions=s(H),j.person=Z,l[H==null?void 0:H.personId]=Z.personId}),(i.participants||[]).filter(({participantType:j})=>j===kt).forEach(j=>{let{individualParticipantIds:z}=j;j.participantName=GAe({individualParticipantIds:z,individualParticipants:h})});let E=(i.participants||[]).filter(({participantType:j})=>j===ji),P=E.length,M=$$({count:P}).names;E.forEach((j,z)=>{j.participantName=M[z]});let N=(i.participants||[]).filter(({participantType:j})=>j===vs),R=N.length,A=$$({count:R,nameRoot:"Group"}).names;N.forEach((j,z)=>{j.participantName=A[z]});let{extension:_}=Vt({element:i,name:Wv});Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(j=>{j.tournamentId=l[j.tournamentId],j.structureId=l[j.structureId],j.eventId=l[j.eventId],j.drawId=l[j.drawId]}));let{extension:O}=Vt({element:i,name:c0});return Array.isArray(O==null?void 0:O.value)&&(O==null||O.value.forEach(j=>{j.personId=l[j.personId]})),{...ne}}function GAe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function gse(t){var U,C,E;let{ratingsParameters:e=ns,participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,schedulingProfile:l,tournamentRecord:c,eventProfiles:u,periodLength:d,venueProfiles:p,autoSchedule:h,drawProfiles:f,uuids:m}=t;if(!c)return{error:Re};let g=[],v=[],y=[];u==null||u.forEach(P=>{var N;let M=(N=c.events)==null?void 0:N.find((R,A)=>P.eventIndex!==void 0&&A===P.eventIndex||P.eventName&&R.eventName===P.eventName||P.eventId&&R.eventId===P.eventId);M!=null&&M.gender&&(P.gender=M.gender)});let I=((U=c.participants)==null?void 0:U.length)||void 0;I&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${I}`);let b=ise({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:u,drawProfiles:f,uuids:m});if(!b.success)return b;if(u){let P=((C=c.events)==null?void 0:C.length)||0;for(let M of u){let{ratingsParameters:N}=M,R=(E=c.events)==null?void 0:E.find((A,_)=>M.eventIndex!==void 0&&_===M.eventIndex||M.eventName&&A.eventName===M.eventName||M.eventId&&A.eventId===M.eventId);if(R){let{gender:A,category:_,eventType:O}=R,{drawProfiles:x,publish:F}=M,$=An(md)(O)&&Kt||An(Al)(O)&&kt||O;if(x){let{stageParticipantsCount:V,uniqueParticipantsCount:G,uniqueParticipantStages:j}=nse({drawProfiles:x,category:_,gender:A}),{uniqueDrawParticipants:z=[],uniqueParticipantIds:H=[]}=j?sse({event:{eventType:O,category:_,gender:A},uniqueParticipantsCount:G,participantsProfile:i,ratingsParameters:N,tournamentRecord:c,eventProfile:M,uuids:m}):{};g.push(...H);let{stageParticipants:K}=rse({targetParticipants:c.participants||[],allUniqueParticipantIds:g,stageParticipantsCount:V,eventParticipantType:$}),q=lse({uniqueDrawParticipants:z,autoEntryPositions:a,stageParticipants:K,tournamentRecord:c,drawProfiles:x,category:_,gender:A,event:R});if(q.error||(q=ose({matchUpStatusProfile:n,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:c,drawProfiles:x,event:R}),q.error))return q;y.push(...q.drawIds)}F&&P0({tournamentRecord:c,event:R})}else{let A=cse({startDate:c.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,randomWinningSide:s,ratingsParameters:N,tournamentRecord:c,eventProfile:M,eventIndex:P,uuids:m});if(A.error)return A;let{eventId:_,drawIds:O,uniqueParticipantIds:x}=A;O&&y.push(...O),v.push(_),x!=null&&x.length&&g.push(...x),P+=1}}}if(f){let P=(c.events||[]).map(M=>{var N;return((N=M.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((M,N)=>M+N,0);for(let M of f){let N=Y_({startDate:c.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:a,hydrateCollections:o,randomWinningSide:s,ratingsParameters:e,tournamentRecord:c,drawProfile:M,drawIndex:P,uuids:m});if(N.error)return N;let{drawId:R,eventId:A,event:_,uniqueParticipantIds:O}=N;if(N=wP({tournamentRecord:c,event:_,internalUse:!0}),N.error)return N;R&&y.push(R),v.push(A),O!=null&&O.length&&g.push(...O),P+=1}}let D=p!=null&&p.length?pse({tournamentRecord:c,venueProfiles:p}):[],w,S={};if(l!=null&&l.length){let P={[c.tournamentId]:c},M=U0({tournamentRecords:P,schedulingProfile:l});if(M.error)return M;if(h){let{tournamentId:N}=c,R={[N]:c};S=K_({tournamentRecords:R,periodLength:d})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:w,schedulerResult:S,...ne,eventIds:v,venueIds:D,drawIds:y}}var Ez={};Gt(Ez,{addIndividualParticipantIds:()=>B_,addParticipant:()=>pu,addParticipants:()=>Ec,addPenalty:()=>xse,addPersonRequests:()=>Sse,addPersons:()=>Lse,createGroupParticipant:()=>Ese,createTeamsFromParticipantAttributes:()=>Uz,deleteParticipants:()=>Gy,filterParticipants:()=>ZD,findParticipant:()=>Cse,getCompetitionParticipants:()=>mH,getPairedParticipant:()=>_l,getParticipantEventDetails:()=>gH,getParticipantMembership:()=>vH,getParticipantScaleItem:()=>Kb,getParticipantSchedules:()=>yH,getParticipantSignInStatus:()=>IH,getParticipantTimeItem:()=>oG,getParticipants:()=>xn,getScaleValues:()=>o0,mergeParticipants:()=>Ose,modifyIndividualParticipantIds:()=>Tse,modifyParticipant:()=>V_,modifyParticipantName:()=>Mse,modifyParticipantOtherName:()=>Dse,modifyParticipantsSignInStatus:()=>Use,modifyPenalty:()=>_se,modifyPersonRequests:()=>bse,mutate:()=>vse,participantScaleItem:()=>Yu,query:()=>Dae,regenerateParticipantNames:()=>Pse,removeIndividualParticipantIds:()=>pG,removeParticipantIdsFromAllTeams:()=>qA,removePenalty:()=>Nse,removePersonRequests:()=>wse,scaledTeamAssignment:()=>Rse,setParticipantScaleItem:()=>Yb,setParticipantScaleItems:()=>Lne,validateLineUp:()=>YA});var vse={};Gt(vse,{addIndividualParticipantIds:()=>B_,addParticipant:()=>pu,addParticipants:()=>Ec,addPenalty:()=>xse,addPersonRequests:()=>Sse,addPersons:()=>Lse,createGroupParticipant:()=>Ese,createTeamsFromParticipantAttributes:()=>Uz,deleteParticipants:()=>Gy,findParticipant:()=>Cse,mergeParticipants:()=>Ose,modifyIndividualParticipantIds:()=>Tse,modifyParticipant:()=>V_,modifyParticipantName:()=>Mse,modifyParticipantOtherName:()=>Dse,modifyParticipantsSignInStatus:()=>Use,modifyPenalty:()=>_se,modifyPersonRequests:()=>bse,regenerateParticipantNames:()=>Pse,removeIndividualParticipantIds:()=>pG,removeParticipantIdsFromAllTeams:()=>qA,removePenalty:()=>Nse,removePersonRequests:()=>wse,scaledTeamAssignment:()=>Rse,setParticipantScaleItem:()=>Yb,setParticipantScaleItems:()=>Lne});function yse(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Ise({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:o,endTime:s}=r;return r.requestType===PP&&(a=xt(a),o=tn(o),s=tn(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=yse(),t[e].push(r);return{mergeCount:n.length}}function Mz(t){let{tournamentRecords:e,personRequests:i}=t,n=gi(t,[{[ba]:!0}]);if(n.error)return n;if(!i)return{...ne};let r=Object.values(e);for(let a of r){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(Gh({tournamentParticipants:o,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&ci({element:a,extension:{value:s,name:c0}})}return{...ne}}function bse(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=gi(t,[{[ba]:!0},{requests:!0,[bf]:No,[sd]:ve}]);if(r.error)return r;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:o}=wg({tournamentRecords:e}),s=c=>{o&&(o[c]=o[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&(o!=null&&o[n]))s(n);else if(o)for(let c of Object.keys(o))s(c);let l=i.filter(c=>!c.requestId);return l.length&&Ise({personRequests:o,personId:n,requests:l}),Mz({tournamentRecords:e,personRequests:o})}function wse(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,o=gi(t,[{[ba]:!0}]);if(o.error)return o;let{personRequests:s}=wg({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!n&&!r&&!a;if(!c){if(r&&(s!=null&&s[r]))l(r);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?Ba({name:c0,tournamentRecords:e,discover:!0}):Mz({tournamentRecords:e,personRequests:s})}function Sse(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=gi(t,[{[ba]:!0,[VDe]:!0},{requests:!0,[bf]:No,[sd]:ve}]);if(r.error)return r;let{personRequests:a}=wg({tournamentRecords:e}),{mergeCount:o}=Ise({personRequests:a,personId:i,requests:n});return o&&a?Mz({tournamentRecords:e,personRequests:a}):{error:ve}}function Tse({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return ae({result:{error:Re},stack:n});if(!e||!t)return ae({result:{error:ut},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return ae({result:{error:jn},stack:n});if(![ji,vs].includes(a.participantType))return ae({result:{error:Dc},context:{participantType:a.participantType},stack:n});let o=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==Kt});if(o.length)return ae({result:{error:bl,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=t.filter(h=>!s.includes(h)),c=s.filter(h=>!t.includes(h)),u=B_({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return ae({result:u,stack:n});let d=pG({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ae({result:d,stack:n});let{topics:p}=Xs();if(p.includes(aa)){let h=r.find(({participantId:f})=>f===e);ei({topic:aa,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function Use({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Re};if(!Array.isArray(e))return{error:ut};if(![eU,pte].includes(i))return{error:ve,signInState:i};let n=t.participants||[];if(!n.length)return{error:vD};let r=n.map(qt),a=e.filter(c=>!r.includes(c));if(a.length)return{error:ve,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=DG({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:AD,itemValue:i,createdAt:s}});if(d.error)return d;o.push(c)}}let{topics:l}=Xs();return o.length&&l.includes(aa)&&ei({topic:aa,payload:{tournamentId:t.tournamentId,participants:o}}),{...ne}}function Dse({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Re};if(!e)return{error:mr};let{participant:n}=vg({tournamentRecord:t,participantId:e});if(!n)return{error:jn};n.participantOtherName=i;let{topics:r}=Xs();return r.includes(aa)&&ei({topic:aa,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ne}}function FK({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),o=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=p$((e==null?void 0:e.standardGivenName)??""),h=p$((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:o(t)&&(s(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function HAe({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,o=n&&i[n];if(n!==$s&&o){let{personFormat:s,doublesJoiner:l}=o;n===Kt&&(e.participantName=FK({person:a,personFormat:s})),n===kt&&(e.participantName=r==null?void 0:r.map(c=>{var d;let u=(d=t[c])==null?void 0:d.person;return FK({person:u,personFormat:s})}).filter(Boolean).join(l??"/"))}}function Pse({tournamentRecord:t,formats:e}){if(!t)return{error:Re};if(!Zi(e))return{error:ut};let i=t.participants??[],n=QJ(i,"participantId");for(let r of i)HAe({participant:r,participantMap:n,formats:e});return{...ne}}function Cse(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:ut,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(o)){l=c.tournamentId;let u=c.participants||[];if(s=Gh({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),s)break}return{participant:s,tournamentId:l,...ne}}function Ese({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=oie,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:Re};if(!a)return{error:ut,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:ve};let o=(xn({participantFilters:{participantTypes:[Kt]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!o.includes(u))return{error:Dc,participantId:u};let s=ht({participantId:r||Oi(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:vs,participantRole:i}),l=pu({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:c}=Xs();return c.includes(zh)&&ei({topic:zh,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...ne,participant:at(s)}}function Mse({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Re};if(!i)return{error:mr};if(!e)return{error:ut,info:"Missing participantName"};let{participant:n}=vg({tournamentRecord:t,participantId:i});if(!n)return{error:jn};n.participantName=e;let{topics:r}=Xs();return r.includes(aa)&&ei({topic:aa,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ne}}function Rse({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var v,y,I,b,D;if(!o)return{error:Re};if(!Array.isArray(a)&&!Mt(c)&&!u||!Mt(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:ve};if(!s&&!r.length||!r&&!(e&&s))return{error:ut,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==Ws)return{error:Vh};a=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:w})=>w===us).map(qt)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:ut};let p=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let h=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],f=[];for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(h.includes(S)){if(U!==$s)return{error:Dc,participant:w};f.push(w)}}if(c&&f.length<c){let w=c-((f==null?void 0:f.length)||0),S=l??"Team",U=Ze(0,w).map(M=>({participantName:`${S} ${M+1}`,participantType:$s,participantRole:ga})),{participants:C=[]}=Ec({participants:U,returnParticipants:!0,tournamentRecord:o}),E=C.map(qt),P=((y=o.participants)==null?void 0:y.filter(({participantId:M})=>E.includes(M)))??[];f.push(...P)}if(!f.length)return{error:BV};if(t)for(let w of f)w.individualParticipantIds=[];else{let w=f.map(S=>S).flat();e!=null&&e.length?p=p.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:fA,info:"Nothing to be done"};if(!r.length){for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(!p.includes(S))continue;if(U!==Kt)return{error:Dc,participant:w};let C=(I=Yu({scaleAttributes:s,participant:w}))==null?void 0:I.scaleItem,E=s!=null&&s.accessor?(b=C==null?void 0:C.scaleValue)==null?void 0:b[s==null?void 0:s.accessor]:C==null?void 0:C.scaleValue,P={participantId:S,scaleValue:E};r.push(P)}if(!r.length)return{error:jn}}r.sort((w,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:ve,scaledParticipant:w};let m=0;for(;m<r.length;){for(let w of f){if(m+1>r.length)break;let S=r[m];w.individualParticipantIds.push(S.participantId),m++}f.reverse()}let g=f.map(qt);for(let w of o.events??[]){if(w.eventType!==Ws)continue;let S=(w.entries??[]).filter(U=>g.includes(U.participantId));for(let U of S){let C=U.participantId,E=(D=f.find(M=>M.participantId===C))==null?void 0:D.individualParticipantIds;w.entries=(w.entries??[]).filter(M=>!E.includes(M.participantId)),(w.drawDefinitions??[]).forEach(M=>{M.entries=(M.entries??[]).filter(N=>!E.includes(N.participantId))});let{flightProfile:P}=Bn({event:w});((P==null?void 0:P.flights)||[]).forEach(M=>{M.drawEntries=(M.drawEntries||[]).filter(N=>!E.includes(N.participantId))})}}return{...ne,scaledParticipants:r}}function Nse(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Pn};for(let i of Object.values(e)){let n=zAe({...t,tournamentRecord:i});if(n.error&&n.error!==_b)return n}return{...ne}}function zAe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Re};if(!e)return{error:OV};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(a=l,r=!0)),s&&n.push(o),l.penaltyId!==e))}),a&&ei({topic:aa,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...ne,penalty:a}:{error:_b}}var WAe=({penaltyId:t=Oi()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),Ase=WAe;function _se(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Pn};for(let i of Object.values(e)){let n=qAe({...t,tournamentRecord:i});if(n.error&&n.error!==_b||n.success)return n}return{error:_b}}function qAe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Re};if(!e)return{error:ve,modifications:e};if(!i)return{error:OV};let n=(t==null?void 0:t.participants)??[],r=Object.keys(Ase()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:mA};let o,s=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),o||(o=u)),u)),c&&s.push(l)}),o&&ei({topic:aa,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...ne,penalty:o}:{error:_b}}function kse(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Ft(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=Ft(t[r].map(o=>JSON.stringify(o)).concat(e[r].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=kse(t[r],e[r],i):n[r]=e[r];return n},{})}function Ose({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Re};e.participants||(e.participants=[]);let n=t.filter(jo(od)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=kse(c,r[c.participantId],i);return a.push(u),u}return c});let o=e.participants.map(jo(od))||[],s=t.filter(({participantId:c})=>!o.includes(c)),{topics:l}=Xs();return s.length&&(e.participants=e.participants.concat(...s),l.includes(zh)&&ei({topic:zh,payload:{participants:s}})),a.length&&l.includes(aa)&&ei({topic:aa,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...ne}}function xse(t){var a;let{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r;for(let o of Object.values(n)){let s=(a=xn({tournamentRecord:o}).participants??[])==null?void 0:a.map(qt).filter(l=>i.includes(l));s.length&&(r=KAe({...t,penaltyId:t.penaltyId??r,tournamentRecord:o,participantIds:s}).penaltyId)}return r?{...ne,penaltyId:r}:{error:jn}}function KAe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:Re};if(!i)return{error:mr};if(!r)return{error:VQ};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:jn};let d=new Date().toISOString(),p=Object.assign(Ase({penaltyId:o}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>ci({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),ei({topic:aa,payload:{tournamentId:e.tournamentId,participants:u}}),{...ne,penaltyId:p.penaltyId}}function Lse({participantRole:t=ga,tournamentRecord:e,persons:i}){var f;if(!e)return{error:Re};if(!Array.isArray(i))return{error:ve};if(!Object.keys(Uf).includes(t))return{error:RQ};let n=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),r=[],a=i.filter(m=>m&&(!m.personId||!n.includes(m.personId))).map(m=>(m.personId||(m.personId=Oi()),r.push(m.personId),m)),o=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),s=a.map(m=>ht({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Kt,participantRole:t,person:o(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=Ec({participants:s,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=((f=xn({participantFilters:{participantTypes:[Kt]},tournamentRecord:e}))==null?void 0:f.participants)??[];if(t===ga&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(I=>Gh({tournamentParticipants:p,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(qt);d.push(ht({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:ga,individualParticipantIds:I,participantType:kt}))}})}),d.length){if(u=Ec({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let h=c+l;return{...ne,addedCount:h,newPersonIds:r}}var X_={};Gt(X_,{bulkUpdatePublishedEventIds:()=>PH,getAllEventData:()=>CH,getCourtInfo:()=>VA,getDrawData:()=>w_,getEventData:()=>S_,getEventPublishStatus:()=>Qs,getPublishState:()=>jy,getVenueData:()=>zb,mutate:()=>Fse,publishEvent:()=>P0,publishEventSeeding:()=>$se,publishOrderOfPlay:()=>jse,query:()=>Rae,setEventDisplay:()=>O_,unPublishEvent:()=>Gse,unPublishEventSeeding:()=>Bse,unPublishOrderOfPlay:()=>Vse});var Fse={};Gt(Fse,{publishEvent:()=>P0,publishEventSeeding:()=>$se,publishOrderOfPlay:()=>jse,setEventDisplay:()=>O_,unPublishEvent:()=>Gse,unPublishEventSeeding:()=>Bse,unPublishOrderOfPlay:()=>Vse});function $se({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=Hl,drawIds:a=[],event:o}){var d,p,h,f;if(!n)return{error:Re};if(!o)return{error:Ai};let s=Qs({event:o,status:r}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},c=(((h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames)||e)&&{...(f=s==null?void 0:s.seeding)==null?void 0:f.stageSeedingScaleNames,...e},u=ht({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:a});return D0({statusObject:{seeding:u},removePriorValues:t,status:r,event:o}),ei({topic:ate,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...ne}}function Bse({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=Hl,drawIds:r,stages:a,event:o}){var l,c;if(!i)return{error:Re};if(!o)return{error:Ai};let s=Qs({event:o});if(s){let u=s.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&(u!=null&&u.seedingScaleNames)&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&(u!=null&&u.drawIds)&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((l=u.seedingScaleNames)!=null&&l.length)&&!((c=u.drawIds)!=null&&c.length)||!a&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),D0({statusObject:{seeding:u},removePriorValues:t,status:n,event:o})}return ei({topic:Gj,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...ne}}function Vse(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:Pn};for(let i of Object.values(e)){let n=YAe({tournamentRecord:i,...t});if(n.error)return n}return{...ne}}function YAe({removePriorValues:t=!0,tournamentRecord:e,status:i=Hl}){if(!e)return{error:Re};let n=`${fg}.${mg}`,{timeItem:r}=Pu({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Df({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),ei({topic:Hj,payload:{tournamentId:e.tournamentId}}),{...ne}}function jse(t){let e=Uu(t);if(!Object.keys(e).length)return{error:Pn};for(let i of Object.values(e)){let n=ZAe({tournamentRecord:i,...t});if(n.error)return n}return{...ne}}function ZAe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=Hl,eventIds:r=[]}){if(!i)return{error:Re};let a=`${fg}.${mg}`,{timeItem:o}=Pu({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},Df({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),ei({topic:ote,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...ne}}function Gse({removePriorValues:t=!0,tournamentRecord:e,status:i=Hl,event:n}){if(!e)return{error:Re};if(!n)return{error:Ai};let r=`${fg}.${mg}`,{timeItem:a}=zD({itemType:r,event:n}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,qy({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:t}),D0({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),ei({topic:jj,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...ne}}var Rz={};Gt(Rz,{getEntryStatusReports:()=>JAe,getParticipantStats:()=>XAe,getStructureReports:()=>e_e,getVenuesReport:()=>i_e});function XAe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var S,U,C,E,P;if(!r)return{error:Re};if(s&&!Array.isArray(s))return{error:oo};if(s=s??Br({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Md};let l=[];e&&l.push(e),n&&l.push(n);let c=l.length?{participantIds:l}:{participantTypes:[$s]},u=xn({participantFilters:c,tournamentRecord:r}).participants??[];if(!u.every(({participantType:M})=>M===$s))return{error:bl};l.length||l.push(...u.map(qt));let d=new Map,p=new Map,h=new Map,f=new Map,m=(M,N="")=>p.get(M)||p.set(M,{participantName:N,participantId:M,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(M);for(let M of u){let{participantId:N,individualParticipantIds:R}=M;f.set(N,R??[]),m(N,M.participantName)}if(n&&!f.get(n))return ae({result:{error:jn},context:{teamParticipantId:n}});if(e&&!f.get(e))return ae({result:{error:jn},context:{opponentParticipantId:e}});let g=[],v=M=>{let N=[[],[]];for(let A of M){let _=A.participant;if(_!=null&&_.participantName){d.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let O=p.get(_.participantId);O&&(O.participantName=_.participantName)}}let R=({side:A,individualParticipantIds:_})=>{var O,x,F,$,V;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((x=(O=A.participant)==null?void 0:O.individualParticipantIds)==null?void 0:x.length)&&(!(_!=null&&_.length)||kn(_,(F=A.participant)==null?void 0:F.individualParticipantIds).length===((V=($=A.participant)==null?void 0:$.individualParticipantIds)==null?void 0:V.length))&&A.participant.individualParticipantIds};if(f.size){let A=(_,O)=>{for(let x of M){if(!x.participant)continue;let F=R({individualParticipantIds:O,side:x});if(F!=null&&F.length){let $=x.sideNumber;if(!$)continue;let V=[_];i&&V.push(...F),N[$-1]=V;let G=p.get(_);for(let j of F.filter(Boolean))G&&!G.competitorIds.includes(j)&&G.competitorIds.push(j)}}};if(n)(!e||M.every(_=>_.participant&&(R({individualParticipantIds:f.get(n),side:_})||R({individualParticipantIds:f.get(e),side:_}))))&&A(n,f.get(n));else for(let[_,O]of f)A(_,O)}else if(i)for(let A of M){if(!A.participant)continue;let _=R({individualParticipantIds:[],side:A}),O=A.sideNumber;O&&(N[O-1]=_)}return N};for(let M of s){if(!Zi(M))return{error:oo};let{matchUpStatus:N,matchUpFormat:R,matchUpType:A,winningSide:_,score:O,sides:x}=M;if(!x||!O||A===lu||N===bi)continue;let F=v(x);if(!F.filter(Boolean).length)continue;let $=t&&_&&((S=BD({matchUp:M}))==null?void 0:S.competitiveness);g.push(M);let V=NG({matchUpStatus:N,matchUpFormat:R,tallyPolicy:o,winningSide:_,score:O}),G=Zie({matchUpStatus:N,matchUpFormat:R,tallyPolicy:o,winningSide:_,score:O}),{pointsTally:j,tiebreaksTally:z}=Xie({matchUpFormat:R,score:O});F.forEach((H,K)=>{var q;for(let Y of H){let Z=(q=d.get(Y))==null?void 0:q.participantName,Q=m(Y,Z);if(Q){let ie=(ee,ce)=>ce.forEach((fe,ge)=>Q[ee][ge]+=fe),ue=K?[...z].reverse():z,J=K?[...j].reverse():j,te=K?[...G].reverse():G,se=K?[...V].reverse():V;if(ie("tiebreaks",ue),ie("points",J),ie("games",te),ie("sets",se),_){let ee=_-1===K?0:1;Q.matchUps[ee]+=1}if($){let ee=$.toLowerCase();Q.competitiveness[ee]||(Q.competitiveness[ee]=[0,0]),Q.competitiveness[ee][K]+=1}if(N){let ee=N.toLowerCase();Q.matchUpStatuses[ee]||(Q.matchUpStatuses[ee]=0),Q.matchUpStatuses[ee]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],I=["competitive","routine","decisive"],b=new Map,D=(M,N)=>(M??0)+(N??0);for(let[M,N]of p.entries()){for(let R of y){let A=N[R].reduce(D);if(A){let _=N[R][0]/A,O=`${R}Ratio`,x=parseFloat(_.toFixed(2));N[O]=x,h.set(M,!0),b.has(O)||b.set(O,[]),(U=b.get(O))==null||U.push(x)}}for(let R of I){let A=(E=(C=N.competitiveness)==null?void 0:C[R])==null?void 0:E.reduce(D);if(A){let _=N.competitiveness[R][0]/A,O=`${R}Ratio`,x=parseFloat(_.toFixed(2));N[O]=x}}}if(!n){let M=(N,R)=>R-N;for(let N of p.values())for(let R of y){let A=`${R}Ratio`;if(typeof N[A]=="number"){let _=(P=b.get(A))==null?void 0:P.sort(M).indexOf(N[A]);if(typeof _=="number"&&_>=0){let O=`${R}Rank`;N[O]=_+1}}}}let w={relevantMatchUps:g,...ne};return n?(w.teamStats=p.get(n),e&&(w.opponentStats=p.get(e))):w.participatingTeamsCount=h.size,w.allParticipantStats=[...p.values()],w}function vR({participant:t,eventType:e}){var c,u,d,p,h,f;let i=(c=t==null?void 0:t.person)==null?void 0:c.personId,n=(d=(u=t==null?void 0:t.person)==null?void 0:u.personOtherIds)==null?void 0:d[0],r=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,a=(f=(h=t==null?void 0:t.ratings)==null?void 0:h[e])==null?void 0:f.find(({scaleName:m})=>m===eH),o=a==null?void 0:a.scaleValue,{wtnRating:s,confidence:l}=o||{};return{timeStamp:a==null?void 0:a.scaleDate,personOtherId:n,confidence:l,wtnRating:s,personId:i,tennisId:r}}function JAe({tournamentRecord:t}){if(!t)return{error:Re};let e=t.tournamentId,{participantMap:i}=xn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Br({matchUpFilters:{matchUpTypes:[gv,Am]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===Am?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},o={},s={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var E;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:I,entryStage:b,drawId:D}=f;a[h]||(a[h]=[]);let{participant:w,events:S}=(i==null?void 0:i[h])??{},U=vR({participant:w,eventType:g}),C=(E=S==null?void 0:S[m])==null?void 0:E.ranking;I===zG&&r.push(h),a[h].push({participantType:w==null?void 0:w.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:D,entryStatus:I,entryStage:b,...U,ranking:C,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,I=g.flatMap(S=>{let{drawId:U,entries:C}=S;l+=1;let E=({stage:R,stageSequence:A})=>R===it&&A===1||R===mt,P=(S.structures??[]).filter(E).flatMap(({positionAssignments:R})=>R).filter(Boolean).map(({participantId:R})=>R),M=({participantId:R})=>P.includes(R),N=R=>{var F,$,V,G,j,z,H,K;let{participantId:A,entryStatus:_,entryStage:O}=R;m(_);let x=(G=(V=($=(F=i==null?void 0:i[A])==null?void 0:F.draws)==null?void 0:$[U])==null?void 0:V.seedAssignments)==null?void 0:G[it];return{qualifyingSeeding:(K=(H=(z=(j=i==null?void 0:i[A])==null?void 0:j.draws)==null?void 0:z[U])==null?void 0:H.seedAssignments)==null?void 0:K[mt],participantId:A,mainSeeding:x,entryStatus:_,entryStage:O,drawId:U}};return C==null?void 0:C.filter(M).map(N)}),b=S=>{var E;let U=S.participantId,C=(E=i==null?void 0:i[U].participant.individualParticipantIds)==null?void 0:E.filter(P=>n.includes(P));return U&&{[U]:{individualParticipantIds:C}}};v===Kh?(()=>{let S=Object.assign({},...I.map(b).filter(Boolean)),U=C=>{S[C.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:C})})};I.forEach(U)})():I.forEach(S=>{c({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let D=Object.values(f).reduce((S,U)=>S+U.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/D*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:f};let w=Object.assign({},...jl.flatMap(S=>{var U,C;return[{[S+"_count"]:(U=f[S])==null?void 0:U.count},{[S+"_pct"]:(C=f[S])==null?void 0:C.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Kt&&f===ga),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function QAe({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},o=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),s=Object.values(o),l=s.map(f=>vR({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(s.length-l.length)/s.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function e_e({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var c;if(!i)return{error:Rb};let n={},r=Object.assign({},...(e??[]).map(({name:u,label:d,accessor:p})=>{var m,g,v;let h=(g=(m=Vt({element:i,name:u}))==null?void 0:m.extension)==null?void 0:g.value,f=p?(v=vv({element:h,accessor:p}))==null?void 0:v.value:h;return{[d||u]:f}})),a=i==null?void 0:i.tournamentId,o=Br({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],s=u=>{var d,p,h;return(h=(p=(d=Pu({itemType:Aj,itemSubTypes:[qu],element:{timeItems:u}}))==null?void 0:d.timeItem)==null?void 0:p.itemValue)==null?void 0:h.scaleBasis},l=(c=i==null?void 0:i.events)==null?void 0:c.flatMap(({timeItems:u,drawDefinitions:d=[],extensions:p,eventType:h,eventId:f,category:m})=>{var w,S,U,C,E;let g=(U=(S=(w=p==null?void 0:p.find(P=>P.name===Ml))==null?void 0:w.value)==null?void 0:S.flights)==null?void 0:U.map(P=>({[P.drawId]:P.flightNumber})),v=g&&Object.assign({},...g),y=((E=(C=p==null?void 0:p.find(P=>P.name===qM))==null?void 0:C.value)==null?void 0:E.length)||0,I=Object.values(v),b=v&&Math.min(...I),D=s(u);return n[f]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:y,seedingBasis:D?JSON.stringify(D):void 0,tournamentId:a,eventId:f},d.filter(P=>!t||!g||v[P.drawId]===b).flatMap(P=>{let{matchUpFormat:M,tieFormat:N,timeItems:R,extensions:A,structures:_,drawType:O,drawId:x}=P,{matchUpFormatCounts:F,matchUpsCount:$,avgConfidence:V,pctNoRating:G,avgWTN:j}=QAe({eventType:h,matchUps:o,drawId:x}),z=s(R)||D,H=t_e({extensions:A}),K=(H==null?void 0:H.length)||0;return n[f].totalPositionManipulations+=K,n[f].generatedDrawsCount+=1,K>n[f].maxPositionManipulations&&(n[f].maxPositionManipulations=K),_==null?void 0:_.filter(q=>q.stageSequence===1&&[mt,it,ra,Rn].includes(q.stage)).map(q=>{var Ae,ze,de;let Y=[it,Rn].includes(q.stage)?o.find(pe=>pe.structureId===q.structureId&&pe.finishingRound===1&&pe.winningSide):void 0,Z=(ze=(Ae=Y==null?void 0:Y.sides)==null?void 0:Ae.find(pe=>pe.sideNumber===Y.winningSide))==null?void 0:ze.participant,Q=(Z==null?void 0:Z.participantType)===$s&&Z.participantId,ie=(Z==null?void 0:Z.participantType)===kt?Z.individualParticipants:[],ue=vR({participant:(ie==null?void 0:ie[0])||Z,eventType:h}),{personId:J,personOtherId:te,tennisId:se,confidence:ee,wtnRating:ce}=ue||{},fe=vR({participant:ie==null?void 0:ie[1],eventType:h}),{personId:ge,personOtherId:he,tennisId:Se,confidence:Ce,wtnRating:Fe}=fe||{},{ageCategoryCode:Je,categoryName:xe,subType:st}=m??{},we=q.matchUpFormat||M,Oe=(F[we]||0)/$*100,{tieFormatName:ye,tieFormatDesc:Be}=pR(N),{tieFormatName:Ee,tieFormatDesc:qe}=pR(q.tieFormat),Ge=Be===qe,me=!Ge&&Ee,Me=q.tieFormat&&!Ge&&qe,De=((de=H==null?void 0:H.filter(pe=>pe.structureId===q.structureId))==null?void 0:de.length)||0;return{...r,tournamentId:a,eventId:f,structureId:q.structureId,drawId:x,eventType:h,category:st,categoryName:xe,ageCategoryCode:Je,flightNumber:v[x],drawType:O,stage:q.stage,seedingBasis:z?JSON.stringify(z):void 0,winningPersonId:J,winningPersonOtherId:te,winningPersonTennisId:se,winningPersonWTNrating:ce,winningPersonWTNconfidence:ee,winningPerson2Id:ge,winningPerson2OtherId:he,winningPerson2TennisId:Se,winningPerson2WTNrating:Fe,winningPerson2WTNconfidence:Ce,winningTeamId:Q,positionManipulations:De,pctNoRating:G,matchUpFormat:we,pctInitialMatchUpFormat:Oe,matchUpsCount:$,drawTieFormatName:ye,drawTieFormatDesc:Be,tieFormatName:me,tieFormatDesc:Me,avgConfidence:V,avgWTN:j}})})});return{eventStructureReports:Object.values(n),structureReports:l}}function t_e({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===WM))==null?void 0:e.value)==null?void 0:i.slice(1)}function i_e({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var u,d;if(!Array.isArray(r))return{error:ve,dates:r};if(!Array.isArray(n))return{error:ve,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Pn};if(!r.every(ss))return{error:Ha};let a=Wp({tournamentRecords:e,ignoreDisabled:t,dates:r});if(a.error)return a;let o=(u=a==null?void 0:a.venues)==null?void 0:u.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),s=(d=a.courts)==null?void 0:d.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),l={venueIds:o==null?void 0:o.map(({venueId:p})=>p)},{matchUps:c}=Cc({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:o==null?void 0:o.map(p=>n_e(s,p,c))}}function n_e(t,e,i){let{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach(s=>{var h;let l=0,c=0,u=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===s),g=(h=m&&C0({courtDate:m}).timeSlots)==null?void 0:h.reduce((v,y)=>{let{startTime:I,endTime:b}=y,D=ni(b)-ni(I);return v+D},0);g&&(u+=1),l+=g}let d=i.filter(({schedule:f})=>f.venueId===n&&cd(s,f.scheduledDate));d.forEach(({schedule:f})=>{let m=tn(f.scheduledTime),g=wo(m,f.averageMinutes),v=ni(g)-ni(m);c+=v});let p=l?(c/l*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:n,venueName:a,venueReport:o}}var Nz={};Gt(Nz,{addMatchUpCourtOrder:()=>dz,addMatchUpEndTime:()=>hz,addMatchUpOfficial:()=>Noe,addMatchUpResumeTime:()=>mz,addMatchUpScheduleItems:()=>G_,addMatchUpScheduledDate:()=>H_,addMatchUpScheduledTime:()=>Cf,addMatchUpStartTime:()=>pz,addMatchUpStopTime:()=>fz,addSchedulingProfileRound:()=>Pz,allocateTeamMatchUpCourts:()=>j_,assignMatchUpCourt:()=>Jy,assignMatchUpVenue:()=>M0,bulkRescheduleMatchUps:()=>Xse,bulkScheduleMatchUps:()=>CP,bulkScheduleTournamentMatchUps:()=>pU,bulkUpdateCourtAssignments:()=>qse,calculateScheduleTimes:()=>Az,clearMatchUpSchedule:()=>Qse,clearScheduledMatchUps:()=>q_,courtGridRows:()=>kH,findMatchUpFormatTiming:()=>T_,findVenue:()=>jp,generateBookings:()=>W_,generateVirtualCourts:()=>L_,getPersonRequests:()=>wg,getProfileRounds:()=>D_,getScheduledRoundsDetails:()=>gP,getSchedulingProfile:()=>qp,getSchedulingProfileIssues:()=>EH,matchUpScheduleChange:()=>Jse,modifyMatchUpFormatTiming:()=>YH,mutate:()=>Hse,proAutoSchedule:()=>Wse,proConflicts:()=>Yse,publicFindCourt:()=>Fte,query:()=>kae,removeEventMatchUpFormatTiming:()=>__,removeMatchUpCourtAssignment:()=>zse,reorderUpcomingMatchUps:()=>Zse,scheduleMatchUps:()=>Kse,scheduleProfileRounds:()=>K_,setMatchUpDailyLimits:()=>ele,setSchedulingProfile:()=>U0,toggleParticipantCheckInState:()=>$_,validateSchedulingProfile:()=>U_});var Hse={};Gt(Hse,{addMatchUpCourtOrder:()=>dz,addMatchUpEndTime:()=>hz,addMatchUpOfficial:()=>Noe,addMatchUpResumeTime:()=>mz,addMatchUpScheduleItems:()=>G_,addMatchUpScheduledDate:()=>H_,addMatchUpScheduledTime:()=>Cf,addMatchUpStartTime:()=>pz,addMatchUpStopTime:()=>fz,addSchedulingProfileRound:()=>Pz,allocateTeamMatchUpCourts:()=>j_,assignMatchUpCourt:()=>Jy,assignMatchUpVenue:()=>M0,bulkRescheduleMatchUps:()=>Xse,bulkScheduleMatchUps:()=>CP,bulkScheduleTournamentMatchUps:()=>pU,bulkUpdateCourtAssignments:()=>qse,calculateScheduleTimes:()=>Az,clearMatchUpSchedule:()=>Qse,clearScheduledMatchUps:()=>q_,courtGridRows:()=>kH,findMatchUpFormatTiming:()=>T_,findVenue:()=>jp,generateBookings:()=>W_,generateVirtualCourts:()=>L_,matchUpScheduleChange:()=>Jse,modifyMatchUpFormatTiming:()=>YH,proAutoSchedule:()=>Wse,proConflicts:()=>Yse,publicFindCourt:()=>Fte,removeEventMatchUpFormatTiming:()=>__,removeMatchUpCourtAssignment:()=>zse,reorderUpcomingMatchUps:()=>Zse,scheduleMatchUps:()=>Kse,scheduleProfileRounds:()=>K_,setMatchUpDailyLimits:()=>ele,setSchedulingProfile:()=>U0,toggleParticipantCheckInState:()=>$_,validateSchedulingProfile:()=>U_});function Az({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:Pn};o=o??F_({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=Wp({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),h=d==null?void 0:d.filter(E=>!c||c.includes(E.venueId));l||(l=h==null?void 0:h.reduce((E,P)=>{var N,R;let M=((R=(N=P.dateAvailability)==null?void 0:N.find(A=>!A.date||cd(s,A.date)))==null?void 0:R.startTime)??P.startTime;return M&&(!E||ni(M)<ni(E))?M:E},void 0)),u||(u=h==null?void 0:h.reduce((E,P)=>{var N,R;let M=((R=(N=P.dateAvailability)==null?void 0:N.find(A=>!A.date||cd(s,A.date)))==null?void 0:R.endTime)??P.endTime;return M&&(!E||ni(M)>ni(E))?M:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(P=>{let{scheduleTiming:M}=VD({tournamentRecord:E,event:P});return{[P.eventId]:{event:P,scheduleTiming:M}}})).flat()),g=IP({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},D=I==null?void 0:I.map(({eventId:E,schedule:P,matchUpFormat:M})=>{let{event:N,scheduleTiming:R}=m[E],A=N==null?void 0:N.eventType,_={...R,defaultTiming:b,matchUpFormat:M},{averageMinutes:O,recoveryMinutes:x}=BA({eventType:A,timingDetails:_}),{courtId:F,venueId:$}=P,V=tn(P.scheduledTime),G=wo(V,O);return{recoveryMinutes:x,averageMinutes:O,periodLength:o,startTime:V,endTime:G,courtId:F,venueId:$}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:u,bookings:D,courts:h},{scheduleTimes:S}=rz(w),U=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,C=I.map(Pr);return{venueId:U,scheduleTimes:S,dateScheduledMatchUpIds:C}}function zse(t){var h;let e=gi(t,[{[ba]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:n,tournamentId:r,courtDayDate:a,matchUpId:o,courtId:s,drawId:l}=t,c=n[r];if(!c)return{error:Re};let{drawDefinition:u,event:d}=Pf({tournamentRecord:c,drawId:l});if(!u)return{error:et};let p=nn({drawDefinition:u,event:d,matchUpId:o});if(p.error)return p;if(((h=p==null?void 0:p.matchUp)==null?void 0:h.matchUpType)===lu){let{itemValue:f}=gg({timeItems:p.matchUp.timeItems??[],itemType:yp}),m=s&&f.filter(g=>g.courtId!==s);return ds({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:o,timeItem:{itemType:yp,itemValue:m}})}else return Jy({tournamentRecord:c,drawDefinition:u,courtDayDate:a,courtId:"",matchUpId:o})}function Wse({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!Js(n))return{error:ve};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:hA};let r=IP({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(Zi(y)&&(y.matchUpId&&(m.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(f).filter(y=>Zi(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==bi&&(t||!gr.includes(h))).sort(Vy);let c=zl({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),I=v&&m.some(U=>c[v].matchUpIds.includes(U)),b=v&&d.some(U=>c[v].dependentMatchUpIds.includes(U)),D=h.matchUpIds.some(U=>y.includes(U)),w=s(g),S=h.participantIds.some(U=>w.includes(U));if(g&&!D&&!I&&!S&&!b){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),u.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=CP({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function qse(t){let{courtDayDate:e}=t,i=gi(t,[{courtAssignments:!0,[bf]:No,[sd]:ut},{[ba]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),r;return Object.keys(n).every(a=>{let o=t[ba][a];if(!o)return r={error:Re},!1;let s=n[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=so({tournamentRecord:o,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=Jy({tournamentRecord:o,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:XQ}}),!0):(r={error:et},!1)})}),r||ne}function Kse(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=gi(t,[{[ba]:!0,[wD]:!0},{[uc]:ss,[sd]:Ha,[$De]:!0},{[uc]:H=>!H||!isNaN(H),[GDe]:!1,[sd]:ve,[HDe]:!1,[zDe]:!1}]);if(b.error)return b;let D=t.competitionMatchUps??Cc({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??zl({includeParticipantDependencies:!0,matchUps:D,tournamentRecords:e}).matchUpDependencies;D.forEach(H=>{var K;(K=H.schedule)!=null&&K.scheduledDate&&cd(f,xt(H.schedule.scheduledDate))&&Jb({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:H})});let S=m.map(H=>D.find(K=>K.matchUpId===H)).filter(Boolean),{venueId:U,scheduleTimes:C,dateScheduledMatchUpIds:E}=Az({tournamentRecords:e,remainingScheduleTimes:d,startTime:tn(v),endTime:tn(y),scheduleDate:xt(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},M=[],N={},R={},A={};D.filter(({matchUpId:H})=>E==null?void 0:E.includes(H)).forEach(H=>{var q;F$({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:H,value:1});let K=(q=H.schedule)==null?void 0:q.scheduledTime;if(K){N[H.matchUpId]=K;let Y=a==null?void 0:a[H.matchUpId];dU({recoveryMinutes:Y||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:K,matchUp:H})}});let _=S.filter(H=>{let K=E==null?void 0:E.includes(H.matchUpId),q=[bi,fi,Wn,cs,Ra,Pi].includes(H==null?void 0:H.matchUpStatus);return!K&&!H.winningSide&&!q}),{matchUpMap:O,overLimitMatchUpIds:x,participantIdsAtLimit:F}=_.reduce((H,K)=>{let{drawId:q,tournamentId:Y,matchUpType:Z}=K,{participantIdsAtLimit:Q,relevantParticipantIds:ie}=Tz({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:c,matchUp:K});return Q!=null&&Q.length?(H.overLimitMatchUpIds.push(K.matchUpId),H.participantIdsAtLimit.push(...Q),H):(ie.forEach(ue=>{DP({individualParticipantProfiles:s,participantId:ue});let J=s[ue].counters;J[Z]?J[Z]+=1:J[Z]=1,J[Sl]?J[Sl]+=1:J[Sl]=1}),H.matchUpMap[Y]||(H.matchUpMap[Y]={}),H.matchUpMap[Y][q]?H.matchUpMap[Y][q].push(K):H.matchUpMap[Y][q]=[K],Jb({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:K}),H)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:H})=>!x.includes(H));let $=0,V=(C==null?void 0:C.length)??0,{personRequests:G}=wg({tournamentRecords:e,requestType:PP});for(;C!=null&&C.length&&_.length&&$<=V;){$++;let{scheduleTime:H}=C.shift(),K=_.find(q=>{let{matchUpId:Y}=q,{dependenciesScheduled:Z,remainingDependencies:Q}=bz({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:q});if(!Z)return A[Y]||(A[Y]=[]),A[Y].push({scheduleTime:H,remainingDependencies:Q}),!1;let{enoughTime:ie}=Sz({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:H,matchUp:q});if(!ie)return R[Y]||(R[Y]=[]),R[Y].push({scheduleTime:H}),!1;let{conflicts:ue}=wz({potentials:u,averageMatchUpMinutes:n,requestConflicts:P,personRequests:G,scheduleTime:H,scheduleDate:f,matchUp:q});if(ue!=null&&ue.length)return!1;let J=a==null?void 0:a[q.matchUpId];return dU({recoveryMinutes:J||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:H,matchUp:q}),N[q.matchUpId]=H,!0});_=_.filter(({matchUpId:q})=>q!==(K==null?void 0:K.matchUpId)),K||M.push(H)}_.forEach(H=>{F$({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:H})});let j=[];Object.keys(O).forEach(H=>{let K=e[H];K&&Object.keys(O[H]).forEach(q=>{let{drawDefinition:Y}=Pf({tournamentRecord:K,drawId:q});Y&&O[H][q].forEach(({matchUpId:Z})=>{let Q=N[Z];if(Q){let ie=Q.split(":").map(Ns).join(":"),ue=`${xt(f)}T${ie}`;I?j.push(Z):(Cf({drawDefinition:Y,matchUpId:Z,scheduledTime:ue}).success&&j.push(Z),U&&M0({tournamentRecords:e,tournamentRecord:K,drawDefinition:Y,matchUpId:Z,venueId:U}))}})})});let z=vj(_);return{...ne,requestConflicts:Object.values(P),remainingScheduleTimes:C==null?void 0:C.map(({scheduleTime:H})=>H),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:M,overLimitMatchUpIds:x,scheduledMatchUpIds:j,noTimeMatchUpIds:z,recoveryTimeDeferred:R,dependencyDeferred:A}}function Yse({tournamentRecords:t,matchUps:e}){if(!Js(e))return{error:Md};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:hA};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>wt(h))),n=Ze(1,i+1).map(h=>e.filter(f=>{var m;return wt((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},o={};n.flat().filter(Boolean).sort(Vy).forEach(({schedule:h})=>delete h[j1]);let s=Ft(e.map(({drawId:h})=>h)),l=zl({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:D,potentialParticipants:w}=g,S=b==null?void 0:b.courtId;r[v]=f,a[S]=[],m.matchUpIds.push(v),o[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let C=(D==null?void 0:D.map(P=>{var M;return[(M=P.participant)==null?void 0:M.individualParticipantIds,P.participantId]}).flat().filter(Boolean))??[],E=(w==null?void 0:w.flat().map(({individualParticipantIds:P,participantId:M})=>[P,M]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...C),y&&m.targetMatchUpIds.push(y),I&&m.targetMatchUpIds.push(I),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!o[h].schedule[j1]){o[h].schedule[j1]=f,o[h].schedule[_te]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=o[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=Vo(h.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=h.matchUpIds.filter(w=>l[w].participantIds.some(S=>I.includes(S)));b.forEach(w=>{v[w]||(v[w]={}),v[w][im]||(v[w][im]=b.filter(S=>S!==w))});let D=m&&h.participantIds.filter(w=>m.participantIds.includes(w));D&&D.forEach(w=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));S.forEach(U=>{v[U]||(v[U]={}),v[U][nm]||(v[U][nm]=S.filter(C=>C!==U))})}),h.matchUpIds.forEach(w=>{var C,E,P,M;let S=l[w].matchUpIds;for(let N of g){let R=N.matchUpIds.filter(A=>S.includes(A));R!=null&&R.length&&(R.forEach(A=>p(A,s$,wh,[w])),p(w,s$,wh,R))}if((C=v[w])!=null&&C[im]&&p(w,im,o$,v[w][im]),h.sourceMatchUpIds.includes(w)){let N=h.matchUpIds.filter(R=>l[R].matchUpIds.includes(w));p(w,im,wh,N),h.matchUpIds.filter(R=>l[R].matchUpIds.includes(w)).forEach(R=>p(R,im,wh,[w]))}let U=(E=m==null?void 0:m.matchUpIds)==null?void 0:E.filter(N=>u(w,N)>1);if(U!=null&&U.length&&(p(w,l$,wh,U),U.forEach(N=>p(N,l$,wh,[w]))),(P=v[w])!=null&&P[nm]&&p(w,nm,o$,v[w][nm]),(M=m==null?void 0:m.targetMatchUpIds)==null?void 0:M.includes(w)){let N=o[w].schedule.courtId,R=S.filter(A=>m.matchUpIds.includes(A));R.some(A=>o[A].schedule.courtId===N)||(R.forEach(A=>p(A,nm,wh,[w])),p(w,nm,wh,R))}})}),{courtIssues:a,rowIssues:d}}function Zse(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ae({result:{error:Pn},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return ae({result:{error:ut},stack:e});let a=n==null?void 0:n.length;if(!a)return{...ne};let o=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=s({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)o++;else return m}),o===a?ne:ae({result:{error:ZQ},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=Pf({tournamentRecord:p,drawId:d});return h?Cf({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:$o}}}function Xse(t){var l,c;let{scheduleChange:e,matchUpIds:i,dryRun:n}=t;if(!i||!Array.isArray(i))return{error:Jw};if(typeof e!="object")return{error:ve};let r=Uu(t),a=[],o=[];for(let u of Object.values(r)){let d=r_e({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:n});if(d.error)return d;Array.isArray(d.notRescheduled)&&o.push(...d.notRescheduled);let p=vj(d.notRescheduled),h=[];(l=d.rescheduled)==null||l.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),a.push(f)}),h.length&&(o=((c=d==null?void 0:d.notRescheduled)==null?void 0:c.filter(({matchUpId:f})=>!h.includes(f)))||[])}let s=!!(a.length&&!o.length);return{...ne,rescheduled:a,notRescheduled:o,allRescheduled:s}}function r_e({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var b;if(!t)return{error:Re};if(!i||!Array.isArray(i))return{error:Jw};if(typeof e!="object")return{error:ve};let r=[],a=[],{minutesChange:o,daysChange:s}=e;if(!o&&!s)return{...ne};if(o&&isNaN(o))return{error:ve};if(s&&isNaN(s))return{error:ve};let{matchUps:l}=Br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:D})=>!gr.includes(D),u=l==null?void 0:l.filter(D=>yP({schedule:D.schedule})).filter(D=>c({matchUpStatus:D.matchUpStatus}));if(!(u!=null&&u.length))return{...ne};let{tournamentInfo:d}=Zy({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=u==null?void 0:u.reduce((D,w)=>{let{matchUpId:S,drawId:U}=w;return D[U]?D[U].push(S):D[U]=[S],D},{}),m=1440;for(let D of Object.keys(f)){let w=Pf({tournamentRecord:t,drawId:D});if(w.error)return w;let S=w.drawDefinition,U=f[D].filter(C=>i.includes(C));for(let C of U)if(C&&S){let E=(b=u.find(_=>_.matchUpId===C))==null?void 0:b.schedule,{scheduledTime:P,scheduledDate:M}=E,N,R,A;if(!N&&s&&M){let _=xt(M);A=HS(_,s),N=new Date(A)<new Date(p)||new Date(A)>new Date(h)}if(o&&P){let _=xt(P),O=ni(tn(P))+o;if(N=O<0||O>m,!N){let x=wo(P,o),F=_&&A||M===_&&_;R=F?`${F}T${x}`:x}}if(N)a.push(C);else{if(!n){if(R){let _=Cf({scheduledTime:R,drawDefinition:S,matchUpId:C});if(_.error)return _}if(A){let _=H_({scheduledDate:A,drawDefinition:S,matchUpId:C});if(_.error)return _}}(R||A)&&r.push(C)}}}let g=Br({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:D})=>r.includes(D)),y=g.filter(({matchUpId:D})=>a.includes(D)),I=v.length&&!y.length;return{...ne,rescheduled:v,notRescheduled:y,allRescheduled:I}}function Jse(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Pn};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return ae({result:{error:ut},stack:e});let{matchUps:f}=Cc({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:b})=>b===c),g=f==null?void 0:f.find(({matchUpId:b})=>b===p),v=0;if(o&&c&&!p){let b=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return ae({result:b,stack:e})}else if(a&&o&&c&&p){let b=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return ae({result:b,stack:e,info:"source"});let D=y({tournamentId:h,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(D.success&&v++,D.error)return ae({result:D,stack:e,info:"target"})}else return{error:ut};return v?ne:ae({result:{error:i0},stack:e});function y(b){let{tournamentRecords:D,tournamentId:w,matchUp:S,drawId:U}=b,C=D[w],{drawDefinition:E}=Pf({tournamentRecord:C,drawId:U});return S.matchUpType===Ki?I({...b,tournamentRecord:C,drawDefinition:E}):Jy({...b,tournamentRecord:C,drawDefinition:E})}function I({removePriorValues:b,tournamentRecords:D,tournamentRecord:w,drawDefinition:S,sourceCourtId:U,courtDayDate:C,matchUpId:E,matchUp:P,courtId:M}){let N=[M].concat(P.schedule.allocatedCourts.map(({courtId:R})=>R).filter(R=>R!==U));return j_({removePriorValues:b,tournamentRecords:D,tournamentRecord:w,drawDefinition:S,courtDayDate:C,matchUpId:E,courtIds:N})}}function Qse({scheduleAttributes:t=[yp,km,f0,m0,g0,dc,Ip,Ku,rp],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var s,l;let r="clearMatchUpSchedule",a=i?(s=no({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=Br({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!a)return{error:ya};let o=(a.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return a.timeItems=o,oi({tournamentId:e.tournamentId,context:r,drawDefinition:i,matchUp:a}),{...ne}}function ele(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Pn};if(typeof n!="object")return{error:Fp};let a=Object.keys(r).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:ve};for(let o of a){let s=r[o],l=ci({element:s,extension:{name:DD,value:{dailyLimits:n}}});if(l.error)return l}return{...ne}}var _z={};Gt(_z,{addCollectionDefinition:()=>xz,addCollectionGroup:()=>ole,aggregateTieFormats:()=>lle,compareTieFormats:()=>bp,getTieFormat:()=>DH,modifyCollectionDefinition:()=>kz,modifyTieFormat:()=>sle,mutate:()=>tle,orderCollectionDefinitions:()=>rle,query:()=>Eae,removeCollectionDefinition:()=>Oz,removeCollectionGroup:()=>nle,tieFormatGenderValidityCheck:()=>e_,validateCollectionDefinition:()=>cP});var tle={};Gt(tle,{addCollectionDefinition:()=>xz,addCollectionGroup:()=>ole,aggregateTieFormats:()=>lle,modifyCollectionDefinition:()=>kz,modifyTieFormat:()=>sle,orderCollectionDefinitions:()=>rle,removeCollectionDefinition:()=>Oz,removeCollectionGroup:()=>nle});function Vm({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var c;let s="getTieFormat",l;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:et};if(a&&o)l=Dh(o);else if(i){if(t&&(!r||!n)){let u=nn({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((c=u.matchUp)==null?void 0:c.matchUpType)!==lu)return ae({result:{error:oo},stack:s});n||(n=u.structure),r||(r=u.matchUp)}l=cT({item:r,drawDefinition:t,structure:n,event:o})||cT({item:n,drawDefinition:t,structure:n,event:o})||Dh(t)||Dh(o)}else if(t&&e){if(!n){let u=Ut({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}l=cT({item:n,drawDefinition:t,structure:n,event:o})||Dh(t)||Dh(o)}else l=Dh(t)||Dh(o);return l?{...ne,structure:n,tieFormat:l,matchUp:r}:ae({result:{error:gD},stack:s})}function yR({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![gr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Bl&&!Vr(t))}function hL({from:t,to:e}){let i=Object.keys(t),n=kn(i,Object.keys(e)).length===i.length,r=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:n&&a,matchUpsCountChanges:r}}function a_e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var w,S,U,C;let c="updateTieFormat",u=e==null?void 0:e.tournamentId,d=0,p=0,h=0,f=0,m=r==null?void 0:r.collectionDefinitions.reduce((E,P)=>(E[P.collectionId]=(E[P.collectionId]||0)+P.matchUpCount,E),{}),g=({tieFormat:E})=>{let P=E==null?void 0:E.collectionDefinitions.reduce((M,N)=>(M[N.collectionId]=(M[N.collectionId]||0)+N.matchUpCount,M),{});return hL({from:P,to:m}).equivalent},v=(w=Vm({drawDefinition:i}))==null?void 0:w.tieFormat,y=(S=Vm({event:s}))==null?void 0:S.tieFormat;if(s&&a){for(let E of s.drawDefinitions??[])I({drawDefinition:E});s.tieFormat=Xr(r),f+=1}else if(o){if(!o.tieMatchUps)return ae({result:{error:oo},stack:c});let E=Vo((U=o.tieMatchUps)==null?void 0:U.map(({collectionId:A})=>A)),P=hL({to:m,from:E}),{changes:M,changesArePossible:N,cannotChangeReaon:R}=$K({matchUp:o,check:P});if(P.equivalent)if(yR({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Xr(r),f+=1;else return ae({result:{error:NV},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(N)D({tieFormat:r,matchUp:o,changes:M,uuids:l});else return ae({context:{collectionMap:m,matchUpMap:E},result:{error:Wd},info:R||"specified changes not possible",stack:c});p+=1,oi({eventId:s==null?void 0:s.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:o})}else if(n){let E=(C=b({inheritedTieFormat:v??y,structure:n}))==null?void 0:C.modifiedMatchUpsCount;E&&(p+=E,d+=1,f+=1);let P=!n.tieFormat||bp({ancestor:n.tieFormat,descendant:r}).different;P&&(n.tieFormat=Xr(r),d+=1,f+=1),(E||P)&&i&&Xi({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)I({drawDefinition:i}),i.tieFormat=Xr(r),f+=1;else return{error:et};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...ne,tieFormat:r};function I({drawDefinition:E}){var N;let P=E.structures||[],M=[];for(let R of P){if(R.tieFormat)continue;let A=(N=b({inheritedTieFormat:y,structure:R}))==null?void 0:N.modifiedMatchUpsCount;if(A){d+=1,p+=A;let _=R.structureId;M.push(_)}}return Xi({structureIds:M,eventId:s==null?void 0:s.eventId,drawDefinition:E}),M.length}function b({inheritedTieFormat:E,structure:P}){var R,A;let M=0,N=((R=Ti({matchUpFilters:{matchUpTypes:[Ki]},structure:P}))==null?void 0:R.matchUps)||[];for(let _ of N){let O=yR({matchUp:_,updateInProgressMatchUps:t}),x=!1,F=Vo((A=_.tieMatchUps)==null?void 0:A.map(({collectionId:V})=>V)),$=hL({from:F,to:m});if($.equivalent)_.tieFormat&&g(_)&&O&&(_.tieFormat=Xr(r),x=!0);else{let{changes:V,changesArePossible:G}=$K({matchUp:_,check:$});if(G&&!_.tieFormat)D({changes:V,matchUp:_,tieFormat:r,uuids:l});else if(E)(!_.tieFormat||bp({ancestor:E,descendant:_.tieFormat}).different)&&(_.tieFormat=E,x=!0);else return ae({result:{error:gD},stack:c})}x&&(M+=1,oi({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:c,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:M}}function D({uuids:E,matchUp:P,tieFormat:M,changes:N}){P.tieFormat=Xr(M);let R=[],A=[];return N.forEach(_=>{if(_.countChange>0){let O=Math.max(0,...P.tieMatchUps.filter($=>$.collectionId===_.collectionId).map(jo("collectionPosition"))),x=M.collectionDefinitions.find($=>$.collectionId===_.collectionId),F=oP({matchUpsLimit:_.countChange,collectionPositionOffset:O,collectionDefinition:x,matchUp:P,uuids:E});A.push(...at(F,!1,!0)),h+=A.length,P.tieMatchUps.push(...F)}else{let O=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",O.length),R.push(...O),P.tieMatchUps=P.tieMatchUps.filter(({matchUpId:x})=>!O.includes(x))}}),A.length&&Wh({matchUps:A,drawDefinition:i,tournamentId:u,eventId:a}),R.length&&Bp({matchUpIds:R,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:a}),{matchUpIdsRemoved:R,matchUpsAdded:A}}}function $K({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===On).map(jo("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:o,collectionId:r,countChange:a}),s}),changes:n,cannotChangeReaon:i}}function J_({drawDefinition:t,auditData:e}){let{extension:i}=Vt({name:qv,element:t}),n={name:qv,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]};ci({element:t,extension:n})}function kz({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){var j;let D="modifyCollectionDefinition";if(o&&!Ho({matchUpFormat:o}))return ae({result:{error:ve},context:{matchUpFormat:o},stack:D});if(n&&typeof n!="string")return ae({result:{error:ve},context:{collectionName:n},stack:D});if(f&&!Object.values(Du).includes(f))return ae({result:{error:ve},context:{gender:f},stack:D});if(p&&typeof p!="object")return ae({result:{error:ve},context:{category:p},stack:D});let w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(w).filter(Boolean).length&&!i&&!n&&!o&&!s&&!c)return ae({result:{error:ut},stack:D});if(Object.values(w).filter(Boolean).length>1)return ae({info:"Only one value assignment allowed per collectionDefinition",result:{error:ve},stack:D});let S=Vm({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(S.error)return ae({result:S,stack:D});let{matchUp:U,structure:C,tieFormat:E}=S,P=Xr(E),M=E==null?void 0:E.collectionDefinitions.find(z=>z.collectionId===l),N=P==null?void 0:P.collectionDefinitions.find(z=>z.collectionId===l);if(!M)return ae({info:"source collectionDefinition",result:{error:Ia},context:{collectionId:l},stack:D});let R=v??y??I??b;if(g){let z=sne({matchUpCount:s??(M==null?void 0:M.matchUpCount)??0,collectionValueProfiles:g});if(z.errors)return ae({result:{error:ve},info:z.errors,stack:D})}else if(R&&!Mt(R))return ae({result:{error:ve},info:"value is not an integer",context:{value:R},stack:D});let A=(z,H)=>kn(Object.keys(z),Object.keys(H)).length===Object.keys(z).length&&kn(Object.values(z),Object.values(H)).length===Object.values(z).length,_=g&&(!M.collectionValueProfiles||!A(M.collectionValueProfiles,g)),O=Mt(v)&&M.collectionValue!==v||Mt(y)&&M.matchUpValue!==y||Mt(I)&&M.scoreValue!==I||Mt(b)&&M.setValue!==b||_,x=[];if(O&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,w),x.push({collectionId:l,...ht(w)})),(Mt(I)||Mt(b))&&N.collectionGroupNumber){let z=N.collectionGroupNumber;P.collectionDefinitions=P.collectionDefinitions.map(H=>{let{collectionGroupNumber:K,...q}=H;return K===z?q:H}),P.collectionGroups=P.collectionGroups.filter(({groupNumber:H})=>H!==z),x.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:$}=Xy(P),V=ht({aggregateValue:F,valueGoal:$});if((V.aggregateValue!==(E==null?void 0:E.winCriteria.aggregateValue)||V.valueGoal!==(E==null?void 0:E.winCriteria.valueGoal))&&(P.winCriteria=V,x.push({collectionId:l,winCriteria:V})),Mt(i)&&M.collectionOrder!==i&&(N.collectionOrder=i,x.push({collectionId:l,collectionOrder:i})),n&&M.collectionName!==n&&(N.collectionName=n,x.push({collectionId:l,collectionName:n})),o&&M.matchUpFormat!==o&&(N.matchUpFormat=o,x.push({collectionId:l,matchUpFormat:o})),Mt(s)&&M.matchUpCount!==s&&(N.matchUpCount=s,x.push({collectionId:l,matchUpCount:s})),c&&M.matchUpType!==c)return ae({result:{error:gA},context:{matchUpType:c},stack:D});p&&M.category!==p&&(N.category=p,x.push({collectionId:l,category:p})),f&&M.gender!==f&&(N.gender=f,x.push({collectionId:l,gender:f}));let G=ht(P);if(S=Uo({tieFormat:G}),S.error)return ae({result:S,stack:D});if(!x.length)return ae({result:{...ne,modifications:x}});if((E==null?void 0:E.tieFormatName)!==r?(G.tieFormatName=r,x.push({tieFormatName:r})):x.length&&(delete G.tieFormatName,x.push("tieFormatName removed: modifications without new tieFormatName")),S=a_e({tieFormat:G,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:C,eventId:h,matchUp:U,event:m}),!S.error){let{appliedPolicies:z}=Ei({tournamentRecord:e});if((j=z==null?void 0:z.audit)!=null&&j[qv]){let H=ht({collectionDefinition:N,drawId:a==null?void 0:a.drawId,action:D,structureId:u,matchUpId:d,eventId:h});J_({drawDefinition:a,auditData:H})}}return ae({result:{...S,modifications:x},stack:D})}function o_e({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var s,l;let o=[];return r&&a?o=[a]:i&&n?o=((s=Ti({matchUpFilters:{matchUpTypes:[Ki]},structure:n}))==null?void 0:s.matchUps)??[]:e&&(o=((l=no({matchUpFilters:{matchUpTypes:[Ki]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:o.filter(c=>!c.winningSide&&c.matchUpStatus!==Wn&&(t||c.matchUpStatus!==Bl&&!Vr(c)))}}function s_e({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let s=!!o.tieFormat;s&&(o.tieFormat=Xr(r));let l;if(t){let c=Ei({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=zp({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}s&&!l&&oi({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...ne}}function ile({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=Xy(l);l.winCriteria=ht({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=o_e({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:c,matchUp:u});s_e({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=ht(l),v=Uo({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:et};return Xi({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...ne}}function nle({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:c}){var y;if(!e)return{error:ut};if(isNaN(e))return{error:ve};let u="removeCollectionGroup",d=s?void 0:Vm({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:c});if(d!=null&&d.error)return ae({result:d,stack:u});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let h=d==null?void 0:d.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,m=h==null?void 0:h.winCriteria.aggregateValue,g=Xr(h);if(d=Uo({tieFormat:g}),d.error)return ae({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(I=>{let{collectionGroupNumber:b,...D}=I;return b!==e?I:(v.push(I.collectionId),D)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:I})=>I!==e),d=ile({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:p,tieFormat:g,matchUpId:o,matchUp:s,eventId:l,event:c}),!d.error){let{appliedPolicies:I}=Ei({tournamentRecord:i});if((y=I==null?void 0:I.audit)!=null&&y[qv]){let b=ht({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:u,structureId:a,matchUpId:o,eventId:l});J_({drawDefinition:n,auditData:b})}}return ae({result:{...d,modifiedCollectionIds:v},stack:u})}function Qb({tieFormat:t,orderMap:e}){let i=Xr(t);return i.collectionDefinitions.forEach(n=>{let r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions.sort((n,r)=>kb(n.collectionOrder)-kb(r.collectionOrder)),i}function rle({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>Mt(l)))return ae({result:{error:ve},context:{orderMap:r}});if(a&&(s!=null&&s.tieFormat))BK({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&nn({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:To};o!=null&&o.tieFormat&&(o.tieFormat=Qb({tieFormat:o.tieFormat,orderMap:r}),oi({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=Ut({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=Qb({tieFormat:c.tieFormat,orderMap:r}),ale({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),Xi({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)V$({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)BK({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:Ia}}else if(e!=null&&e.tieFormat)V$({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:Ia};return{...ne}}function BK({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=Qb({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])V$({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function V$({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),o=Qb({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=Qb({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),ale({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));Xi({drawDefinition:e,structureIds:s})}function ale({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var o;let a=(o=Ti({matchUpFilters:{matchUpTypes:[Ki]},structure:i}))==null?void 0:o.matchUps;for(let s of a)s.tieFormat&&(s.tieFormat=Qb({tieFormat:s.tieFormat,orderMap:n}),oi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function Oz({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:c,event:u}){var E,P,M,N,R,A;let d="removeCollectionDefinition",p=c?void 0:Vm({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:u});if(p!=null&&p.error)return ae({result:p,stack:d});let h=p==null?void 0:p.structure;c=c??(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=Xr(f);if(p=Uo({tieFormat:m}),p.error)return ae({result:p,stack:d});let g=(E=m==null?void 0:m.collectionDefinitions)==null?void 0:E.find(_=>_.collectionId===a);if(!g)return ae({result:{error:Ia,collectionId:a}});m.collectionDefinitions=m.collectionDefinitions.filter(_=>_.collectionId!==a),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(_=>{let{collectionGroupNumber:O,...x}=_;return x}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:_})=>_!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=Xy(m);m.winCriteria=ht({aggregateValue:v,valueGoal:y});let I=f==null?void 0:f.winCriteria.valueGoal,b=f==null?void 0:f.winCriteria.aggregateValue;(I&&I!==y||v&&!b)&&(r?m.tieFormatName=r:delete m.tieFormatName);let D=[];s&&c?D=[c]:o&&h?D=((P=Ti({matchUpFilters:{matchUpTypes:[Ki]},structure:h}))==null?void 0:P.matchUps)??[]:n?D=((M=no({matchUpFilters:{matchUpTypes:[Ki]},drawDefinition:n}))==null?void 0:M.matchUps)??[]:u&&(D=((N=Hp({matchUpFilters:{matchUpTypes:[Ki]},drawDefinition:n}))==null?void 0:N.matchUps)??[]);let w=(D||[]).filter(_=>{var F,$,V;let O=($=(F=_.tieMatchUps)==null?void 0:F.filter(G=>G.collectionId===a))==null?void 0:$.some(Vr),x=e&&_.tieFormat?(V=bp({descendant:_.tieFormat,ancestor:m}))==null?void 0:V.different:!1;return t&&!O||!_.winningSide&&_.matchUpStatus!==Wn&&(t||_.matchUpStatus!==Bl&&!Vr(_)&&!x)});if(!w.length)return{error:i0};let{appliedPolicies:S}=Ei({tournamentRecord:i});if(s&&c&&t){let _=(R=c.tieMatchUps)==null?void 0:R.filter(O=>O.collectionId===a);for(let O of _??[]){let x=TP({matchUpId:O.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:u});if(x.error||(x=nn({drawDefinition:n,matchUpId:s}),x.error))return x;c=x==null?void 0:x.matchUp}}let U=[];for(let _ of w){for(let O of(_==null?void 0:_.sides)??[])O.lineUp=(O.lineUp??[]).map(x=>({participantId:x.participantId,collectionAssignments:((x==null?void 0:x.collectionAssignments)??[]).filter(F=>F.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(O=>{let x=O.collectionId===a;return x&&U.push(O.matchUpId),!x}),_.tieFormat&&(_.tieFormat=Xr(m)),t){let O=zp({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:S,drawDefinition:n,event:u});if(O.error)return O}oi({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:d,matchUp:_})}U.length&&Bp({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:U,eventId:u==null?void 0:u.eventId,drawDefinition:n});let C=ht(m);if(p=Uo({tieFormat:C}),p.error)return ae({result:p,stack:d});if(l&&u)u.tieFormat=C;else if(s&&c)c.tieFormat=C;else if(h)h.tieFormat=C;else if(n)n.tieFormat=C;else if(!c||!n)return{error:et};if(Xi({drawDefinition:n,eventId:u==null?void 0:u.eventId}),(A=S==null?void 0:S.audit)==null?void 0:A[qv]){let _=ht({drawId:n==null?void 0:n.drawId,action:d,collectionId:a,structureId:o,matchUpId:s,eventId:l});J_({drawDefinition:n,auditData:_})}return{tieFormat:C,deletedMatchUpIds:U,targetMatchUps:w,...ne}}function ole({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return ae({result:{error:ut},stack:d});let p=l?void 0:Vm({drawDefinition:n,structureId:o,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return ae({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=Xr(f);if(p=Uo({tieFormat:g}),p.error)return ae({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&r.includes(I))return ae({info:"collectionIds cannot be part of other collectionGroups",result:{error:ve},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],ile({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:o,structure:h,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function xz({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var F,$,V;let g="addCollectionDefinition",v=Ei({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},y=(r==null?void 0:r[_r])??(v==null?void 0:v[_r]);a=a??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let I=(c??(($=y==null?void 0:y.participants)==null?void 0:$.enforceGender))!==!1,b=!!((i??(m==null?void 0:m.category))&&a!==!1),D=!!((o??(m==null?void 0:m.gender))&&I),w=cP({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:o,checkCategory:b,checkGender:D,event:m});if(w.error)return ae({result:w,stack:g});let S=p!=null&&p.tieFormat?void 0:Vm({drawDefinition:s,structureId:u,matchUpId:d,eventId:h,event:m});if(S!=null&&S.error)return ae({result:{error:S.error},stack:g});let U=S==null?void 0:S.structure;p=p??(S==null?void 0:S.matchUp);let C=(p==null?void 0:p.tieFormat)??(S==null?void 0:S.tieFormat),E=Xr(C);if(S=Uo({tieFormat:E}),S==null?void 0:S.error)return ae({result:{error:S.error},stack:g});if(!e.collectionId)e.collectionId=Oi();else if(E.collectionDefinitions.map(({collectionId:G})=>G).includes(e.collectionId))return ae({context:{collectionId:e.collectionId},result:{error:eee}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((G,j)=>(G.collectionOrder||0)-(j.collectionOrder||0)).forEach((G,j)=>G.collectionOrder=j+1);let{aggregateValue:P,valueGoal:M}=Xy(E);E.winCriteria=ht({aggregateValue:P,valueGoal:M});let N=C==null?void 0:C.winCriteria.valueGoal,R=C==null?void 0:C.winCriteria.aggregateValue;(N&&N!==M||P&&!R)&&(l?E.tieFormatName=l:delete E.tieFormatName);let A=[],_=[],O=[],x=ht(E);if(S=Uo({tieFormat:x}),S==null?void 0:S.error)return ae({result:{error:S.error},stack:g});if(h&&m){m.tieFormat=x;for(let G of m.drawDefinitions??[])if(!G.tieFormat)for(let j of G.structures??[]){if(j.tieFormat)continue;let z=fL({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});_.push(...z.newMatchUps),O.push(...z.targetMatchUps),A.push(j.structureId)}VE({modifiedMatchUps:O,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(u&&U){U.tieFormat=x;let G=fL({updateInProgressMatchUps:t,collectionDefinition:e,structure:U,uuids:f});_.push(...G.newMatchUps),O=G.targetMatchUps,VE({modifiedMatchUps:O,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(d&&p){if(!yR({matchUp:p,updateInProgressMatchUps:t}))return ae({result:{error:NV},stack:g});p.tieFormat=x;let G=oP({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...G),_.push(...G),VE({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(s){s.tieFormat=x;for(let G of s.structures??[]){let j=fL({updateInProgressMatchUps:t,collectionDefinition:e,structure:G,uuids:f});A.push(G.structureId),_.push(...j.newMatchUps),O.push(...j.targetMatchUps)}VE({modifiedMatchUps:O,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else return{error:et};if((V=v==null?void 0:v.audit)!=null&&V[qv]){let G=ht({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:h});J_({drawDefinition:s,auditData:G})}return{tieFormat:x,targetMatchUps:O,addedMatchUps:_,...ne}}function fL({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var o;let r=[],a=((o=Ti({matchUpFilters:{matchUpTypes:[Ki]},structure:i}))==null?void 0:o.matchUps).filter(s=>yR({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of a){let l=oP({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),r.push(...l)}return{newMatchUps:r,targetMatchUps:a}}function VE({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){Wh({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(s=>{oi({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:o,matchUp:s,eventId:a})}),Xi({structureIds:t,drawDefinition:n,eventId:a})}function sle({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,uuids:l,event:c}){let u="modifyTieFormat";if(!Uo({tieFormat:i}).valid)return ae({result:{error:Wd},info:"falied validation",stack:u});let d=Vm({drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:c});if(d.error)return ae({result:d,stack:u});let{matchUp:p,tieFormat:h}=d,f=Xr(h),m=bp({descendant:i,ancestor:f});if(m.invalid)return ae({context:{invalid:m.invalid},result:{error:Wd},stack:u});if(!(m!=null&&m.different))return ae({result:{...ne},info:"Nothing to do",stack:u});let g=f.collectionDefinitions.map(({collectionId:U})=>U),v=i.collectionDefinitions.map(({collectionId:U})=>U),y=g.filter(U=>!v.includes(U)),I=i.collectionDefinitions.filter(({collectionId:U})=>!g.includes(U)),b=I.map(jo("collectionId")),D=[],w,S=i.tieFormatName;for(let U of i.collectionDefinitions){if(b.includes(U.collectionId))continue;let C=kz({updateInProgressMatchUps:t,...U,tournamentRecord:n,tieFormatName:S,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:c});if(C.modifications&&D.push(...C.modifications),C.error)return ae({result:C,stack:u});C.tieFormat&&(w=C.tieFormat)}for(let U of I){let C=xz({updateInProgressMatchUps:t,collectionDefinition:U,tournamentRecord:n,drawDefinition:r,tieFormatName:S,structureId:a,matchUpId:o,matchUp:p,eventId:s,uuids:l,event:c});if(C.error)return ae({result:C,stack:u});C.tieFormat&&(w=C.tieFormat)}for(let U of y){let C=Oz({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:r,tieFormatName:S,collectionId:U,structureId:a,matchUpId:o,eventId:s,matchUp:p,event:c});if(C.error)return ae({result:C,stack:u});C.tieFormat&&(w=C.tieFormat)}return(h==null?void 0:h.tieFormatName)!==S?(w.tieFormatName=S,D.push({tieFormatName:S})):(D.length||b.length||y.length)&&(delete w.tieFormatName,D.push("tieFormatName removed: modifications without new tieFormatName")),w.collectionDefinitions=w.collectionDefinitions.sort((U,C)=>kb(U.collectionOrder)-kb(C.collectionOrder)).map((U,C)=>({...U,collectionOrder:C+1})),{processedTieFormat:Xr(w),modifications:D,...ne}}function lle({tournamentRecord:t}){if(!t)return{error:Re};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)bp({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=at(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Oi()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let o=(u,d)=>{var h;let p=(h=l.matchUps)==null?void 0:h.find(f=>f.matchUpId===u);p&&(p.tieFormatId=d,delete p.tieFormat,oi({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=u=>{let d=at(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Oi()),n.push(d),e+=1,o(u.matchUpId,d.tieFormatId)},l=Hp({matchUpFilters:{matchUpTypes:[lu]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&bp({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(u.matchUpId,d):s(u)}n.length&&(i.tieFormats=n)}return{...ne,addedCount:e}}var Lz={};Gt(Lz,{addDrawDefinitionExtension:()=>TA,addEventExtension:()=>Sf,addEventTimeItem:()=>qy,addExtension:()=>ci,addNotes:()=>JA,addOnlineResource:()=>dle,addParticipantExtension:()=>Lee,addParticipantTimeItem:()=>DG,addTimeItem:()=>Df,addTournamentExtension:()=>dj,addTournamentTimeItem:()=>Wy,analyzeDraws:()=>pP,analyzeTournament:()=>TH,getAllowedDrawTypes:()=>y_,getAllowedMatchUpFormats:()=>bH,getAppliedPolicies:()=>Ei,getCompetitionDateRange:()=>b_,getCompetitionPenalties:()=>wH,getPolicyDefinitions:()=>Vp,getTournamentInfo:()=>Zy,getTournamentPenalties:()=>I_,getTournamentPersons:()=>SH,getTournamentStructures:()=>TG,getTournamentTimeItem:()=>WD,mutate:()=>cle,query:()=>Pae,removeDrawDefinitionExtension:()=>Fee,removeEventExtension:()=>UA,removeExtension:()=>Ba,removeNotes:()=>ane,removeParticipantExtension:()=>$ee,removeTournamentExtension:()=>pj,setTournamentCategories:()=>fle,setTournamentDates:()=>Q_,setTournamentEndDate:()=>gle,setTournamentName:()=>ple,setTournamentNotes:()=>hle,setTournamentStartDate:()=>mle,setTournamentStatus:()=>ule});var cle={};Gt(cle,{addDrawDefinitionExtension:()=>TA,addEventExtension:()=>Sf,addEventTimeItem:()=>qy,addExtension:()=>ci,addNotes:()=>JA,addOnlineResource:()=>dle,addParticipantExtension:()=>Lee,addParticipantTimeItem:()=>DG,addTimeItem:()=>Df,addTournamentExtension:()=>dj,addTournamentTimeItem:()=>Wy,removeDrawDefinitionExtension:()=>Fee,removeEventExtension:()=>UA,removeExtension:()=>Ba,removeNotes:()=>ane,removeParticipantExtension:()=>$ee,removeTournamentExtension:()=>pj,setTournamentCategories:()=>fle,setTournamentDates:()=>Q_,setTournamentEndDate:()=>gle,setTournamentName:()=>ple,setTournamentNotes:()=>hle,setTournamentStartDate:()=>mle,setTournamentStatus:()=>ule});var l_e="ABANDONED",c_e="ACTIVE",u_e="CANCELLED",d_e="COMPLETED",p_e="IN_PROGRESS",Fz={ABANDONED:l_e,ACTIVE:c_e,CANCELLED:u_e,COMPLETED:d_e,IN_PROGRESS:p_e};function ule({tournamentRecord:t,status:e}){return t?e&&!Object.keys(Fz).includes(e)?{error:ve,info:"Unknown status"}:(t.tournamentStatus=e,{...ne}):{error:Re}}function dle({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:n,personId:r,courtId:a,venueId:o}){var s,l,c;if(!t)return{error:Re};if(!Zi(e))return{error:ut};if(kn(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return ae({result:{error:Fp},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return ae({result:{error:Ia}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(n||r){let u=(t.participants??[]).find(d=>{var p;return r&&((p=d.person)==null?void 0:p.personId)===r||d.participantId===n});if(!u)return ae(r?{result:{error:Ia}}:{result:{error:jn}});if(r){if(((l=u.person)==null?void 0:l.personId)!==r)return ae({result:{error:Qw}});u.person.onlineResources||(u.person.onlineResources=[]),u.person.onlineResources.push(e)}else u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(a){let u=(c=(t.venues??[]).filter(d=>!o||d.venueId===o).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===a)))==null?void 0:c[0];if(!u)return ae({result:{error:yD}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(o){let u=(t.venues??[]).find(d=>d.venueId===o);if(!u)return ae({result:{error:t0}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...ne}}function ple({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...ne}):{error:Re}}function hle({tournamentRecord:t,notes:e}){return t?JA({element:t,notes:e}):{error:Re}}function fle({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...ne}):{error:Re}}function h_e({tournamentRecord:t}){var a,o;if(!t)return{error:Re};let{startDate:e,endDate:i}=t,n=Ob(e,i),r=[];for(let s of t.venues||[])(a=s==null?void 0:s.courts)!=null&&a.length&&r.push(...s.courts);for(let s of r){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,h)=>{let f=ni(p.startTime),m=ni(p.endTime);return h.startTime&&ni(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&ni(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=n.map(p=>{var h;return((h=s.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(o=s.dateAvailability)==null?void 0:o.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...ne}}function Q_(t){var d;let{tournamentRecord:e,startDate:i,endDate:n}=t,r=gi(t,[{tournamentRecord:!0},{[rj]:{startDate:!1,endDate:!1},[sd]:Ha,[uc]:p=>ld.test(p)}]);if(r.error)return r;if(n&&i&&new Date(n)<new Date(i))return{error:ve};let a;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(a=!0);let o=Ob(e.startDate,e.endDate);i&&(e.startDate=i),n&&(e.endDate=n);let s=Ob(e.startDate,e.endDate),l=o.filter(p=>!s.includes(p)),c=s.filter(p=>!o.includes(p));for(let p of e.events??[])i&&p.startDate&&new Date(p.startDate)<new Date(i)&&(p.startDate=i),n&&p.startDate&&new Date(p.startDate)>new Date(n)&&(p.startDate=i??n),n&&p.endDate&&new Date(p.endDate)>new Date(n)&&(p.endDate=n),i&&p.endDate&&new Date(p.endDate)<new Date(i)&&(p.endDate=n??i);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n);let u=a&&((d=f_e({tournamentRecord:e}))==null?void 0:d.unscheduledMatchUpIds);return h_e({tournamentRecord:e}),ei({topic:rte,payload:{startDate:i,endDate:n}}),{...ne,unscheduledMatchUpIds:u,datesAdded:c,datesRemoved:l}}function mle({tournamentRecord:t,startDate:e}){return Q_({tournamentRecord:t,startDate:e})}function gle({tournamentRecord:t,endDate:e}){return Q_({tournamentRecord:t,endDate:e})}function f_e({tournamentRecord:t}){let e=Br({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||n&&c>n)&&(a.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!q_({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:nQ}:{unscheduledMatchUpIds:a}}var $z={};Gt($z,{addCourt:()=>Z_,addCourts:()=>Cz,addVenue:()=>GD,deleteCourt:()=>Dle,deleteVenue:()=>Gz,deleteVenues:()=>ble,disableCourts:()=>wle,disableVenues:()=>Sle,enableCourts:()=>Tle,enableVenues:()=>Ule,generate:()=>vle,generateCourts:()=>nz,getCompetitionVenues:()=>mP,getCourts:()=>VH,getVenuesAndCourts:()=>Wp,modifyCourt:()=>Hz,modifyCourtAvailability:()=>Vz,modifyVenue:()=>Ple,mutate:()=>yle,publicFindVenue:()=>tG,query:()=>Vae});var vle={};Gt(vle,{generateCourts:()=>nz});var yle={};Gt(yle,{addCourt:()=>Z_,addCourts:()=>Cz,addVenue:()=>GD,deleteCourt:()=>Dle,deleteVenue:()=>Gz,deleteVenues:()=>ble,disableCourts:()=>wle,disableVenues:()=>Sle,enableCourts:()=>Tle,enableVenues:()=>Ule,modifyCourt:()=>Hz,modifyCourtAvailability:()=>Vz,modifyVenue:()=>Ple});function Bz(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:Re};if(!(t!=null&&t.courtId))return{error:My};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:o}=qp({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=Br({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var f,m,g;let h=(m=(f=p.schedule)==null?void 0:f.allocatedCourts)==null?void 0:m.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===u||(h==null?void 0:h.includes(u))});return hR({matchUps:d,schedulingProfile:o})}}function m_e({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:Re};if(!n)return{error:vf};let{schedulingProfile:r}=qp({tournamentRecord:e}),{matchUps:a}=Br({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:n})};function o({matchUps:s,venueId:l}){let c=s.filter(u=>{var p,h,f;let d=(h=(p=u.schedule)==null?void 0:p.allocatedCourts)==null?void 0:h.map(({venueId:m})=>m);return((f=u.schedule)==null?void 0:f.venueId)===l||(d==null?void 0:d.includes(l))});return hR({matchUps:c,schedulingProfile:r})}}function Vz({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var h,f,m;if(!t)return{error:Re};if(!r)return{error:My};let o=dse({dateAvailability:e});if(o.error)return o;let{updatedDateAvailability:s,totalMergeCount:l}=g_e(e);e=s;let c=$y({tournamentRecord:t,courtId:r});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=Bz({tournamentRecord:t,venueMatchUps:n,courtId:r});if(p!=null&&p.length){let g=(h=Ei({tournamentRecord:t}))==null?void 0:h.appliedPolicies,v=a??((m=(f=g==null?void 0:g[wf])==null?void 0:f.allowDeletionWithScoresPresent)==null?void 0:m.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return u&&(u.dateAvailability=e,!i&&d&&ei({payload:{venue:d,tournamentId:t.tournamentId},topic:ug,key:d.venueId})),{...ne,totalMergeCount:l}}function g_e(t){let e=0,i=t.reduce((r,a)=>{let{date:o,startTime:s,endTime:l,bookings:c}=a;return r[o]||(r[o]=[]),r[o].push({startTime:s,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(BAe);let{mergedAvailability:a,mergeCount:o}=v_e(i[r]);n.push(...a.map(s=>({date:r,...s}))),e+=o}),{updatedDateAvailability:n,totalMergeCount:e}}function v_e(t){let e,i,n,r=t.length,a=0,o=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(TD(Xn(i),Xn(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),o.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}function jz({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:aee,info:e}}function Ile({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:la};if(!e&&!n)return{error:xc};let a;if(!e){if(!t)return{error:Re};({drawDefinition:e}=so({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=nn({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Re};let o=Br({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=rne({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[km,yp].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![km,yp].includes(o)),oi({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...ne}):{error:ya}}function Gz(t){var l,c,u;if(typeof(t==null?void 0:t.venueId)!="string")return{error:vf};let{tournamentRecord:e,venueId:i,force:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(r).length)return{error:Re};let a=Cc({tournamentRecords:r,contextFilters:{venueIds:[i]}}).matchUps??[],o=(l=Ei({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=n??((u=(c=o==null?void 0:o[wf])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:u.venues);if(!a.length||s)for(let d of Object.values(r)){for(let h of a){let f=Ile({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==i?!0:(p=!0,!1)),p&&ei({payload:{venueId:i,tournamentId:d.tournamentId},topic:Oj,key:i})}else return jz({matchUpsCount:a.length});return vP({tournamentRecords:r}),{...ne}}function ble({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Re};if(!Array.isArray(e))return{error:ve};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,o=Gz({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...ne}}function wle(t){let{courtIds:e,dates:i}=t,n=Uu(t),r=[{[ba]:!0,[wA]:!0}],a=gi(t,r);if(a.error)return a;for(let o of Object.values(n))y_e({tournamentRecord:o,courtIds:e,dates:i});return{...ne}}function y_e({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>ci({extension:{value:n,name:bc},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=r(o);if(s.error)return s}return{...ne}}function Sle(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[ba]:!0,[SA]:!0}],a=gi(t,r);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];I_e({tournamentRecord:l,venueIds:n})}return{...ne}}function I_e({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=ci({creationTime:!1,element:i,extension:{name:bc,value:!0}});if(n.error)return n}return{...ne}}function Tle(t){let e=Uu(t),i=[{[ba]:!0}];!t.enableAll&&i.push({[wA]:!0});let n=gi(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=t;for(let s of Object.values(e))b_e({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...ne}}function b_e({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:o}=Vt({element:a,name:bc});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),ci({extension:{name:bc,value:s},creationTime:!1,element:a})}}else Ba({element:a,name:bc});return{...ne}}function Ule(t){let e=Uu(t),i=[{[ba]:!0}];!t.enableAll&&i.push({[SA]:!0});let n=gi(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||r!=null&&r.includes(s.venueId))&&Ba({element:s,name:bc});return{...ne}}function Dle(t){let{courtId:e,disableNotice:i,force:n}=t,r=Uu(t),a=gi(t,[{[ba]:!0,[Eee]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(r)){if(s=w_e({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==yD)return s;s.success&&(o=!0)}return o?{...ne}:s}function w_e({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var c,u,d;let r=$y({tournamentRecord:t,courtId:i});if(r.error)return r;let a=r.venue,{matchUps:o}=Bz({tournamentRecord:t,courtId:i}),s=(c=Ei({tournamentRecord:t}))==null?void 0:c.appliedPolicies,l=n??((d=(u=s==null?void 0:s[wf])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(o!=null&&o.length)||l){for(let p of o??[]){let h=Ile({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}a&&(a.courts=(a.courts??[]).filter(p=>p.courtId!==i),e||ei({payload:{venue:a,tournamentId:t.tournamentId},topic:ug,key:a.venueId}))}else return jz({matchUpsCount:o.length});return{...ne}}function Hz(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,o=Uu(t);if(!Object.keys(o).length)return{error:Pn};let s,l;for(let c of Object.values(o)){let u=S_e({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;s=!0}return s?{...ne}:l}function S_e({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:Re};if(!r)return{error:My};if(!n||typeof n!="object")return{error:Fp};let o=$y({tournamentRecord:t,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,c=Object.keys($Ae()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:mA};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=Vz({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||ei({payload:{venue:s,tournamentId:t.tournamentId},topic:ug,key:s==null?void 0:s.venueId}),{...ne,court:at(l)}}var T_e=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),U_e=T_e;function Ple(t){let{modifications:e,venueId:i,force:n}=t,r=Uu(t);if(!Object.keys(r).length)return{error:Pn};if(typeof i!="string")return{error:vf};let a,o;for(let s of Object.values(r)){let l=D_e({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==t0)return l}return vP({tournamentRecords:r}),o?{...ne}:{error:a}}function D_e({tournamentRecord:t,modifications:e,venueId:i,force:n}){var g,v,y,I,b,D,w,S;if(!t)return{error:Re};if(!e||typeof e!="object")return{error:Fp};if(!i)return{error:vf};let r=(g=Ei({tournamentRecord:t}))==null?void 0:g.appliedPolicies,a=n??((y=(v=r==null?void 0:r[wf])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:o}=m_e({tournamentRecord:t,venueId:i}),s=jp({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,c=Object.keys(U_e()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>c.includes(U)).length)return{error:mA};let u=c.filter(U=>!["courts","onlineResources"].includes(U)),d=Object.keys(e).filter(U=>u.includes(U));l&&d.forEach(U=>Object.assign(l,{[U]:e[U]}));let p=((I=l==null?void 0:l.courts)==null?void 0:I.map(U=>U.courtId))??[],h=((b=e.courts)==null?void 0:b.map(U=>U.courtId))||[],f=h.length?p.filter(U=>!h.includes(U)):(e==null?void 0:e.courts)&&p,m=[];if(f!=null&&f.length){let U=(w=(D=l==null?void 0:l.courts)==null?void 0:D.filter(C=>f.includes(C.courtId)))==null?void 0:w.map(C=>{var P;let E=Bz({courtId:C.courtId,tournamentRecord:t,venueMatchUps:o});for(let M of E.matchUps??[])m.push({matchUpId:M.matchUpId,drawId:M.drawId});return((P=E.matchUps)==null?void 0:P.length)??0}).reduce((C,E)=>C+E);if(l&&(!U||a))l.courts=(S=l.courts)==null?void 0:S.filter(C=>h.includes(C.courtId)),pU({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return jz({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:C}=U||{},E=Hz({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:o,courtId:C,force:n});if(E.error===yD&&(E=Z_({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return vP({tournamentRecord:t}),l&&ei({payload:{venue:l,tournamentId:t.tournamentId},topic:ug,key:l==null?void 0:l.venueId}),{...ne,venue:at(l)}}var hi={};Gt(hi,{JSON2CSV:()=>N_e,UUID:()=>Oi,UUIDS:()=>sCe,allNumeric:()=>fee,attributeFilter:()=>Hv,chunkArray:()=>Fr,chunkByNth:()=>JF,chunkSizeProfile:()=>hee,constantToString:()=>ta,countValues:()=>CDe,createMap:()=>QJ,dateTime:()=>pPe,definedAttributes:()=>ht,dehydrateMatchUps:()=>C_e,extractAttributes:()=>dte,flattenJSON:()=>zz,generateDateRange:()=>Ob,generateHashCode:()=>HUe,generateRange:()=>Ze,generateTimeCode:()=>yse,groupValues:()=>dee,hasAttributeValues:()=>GUe,instanceCount:()=>Vo,intersection:()=>kn,isConvertableInteger:()=>Mt,isNumeric:()=>En,isOdd:()=>cee,isPowerOf2:()=>Pc,makeDeepCopy:()=>at,matchUpSort:()=>Vy,nearestPowerOf2:()=>zV,nextPowerOf2:()=>n0,noNulls:()=>PDe,noNumeric:()=>mee,numericSort:()=>ar,occurrences:()=>MDe,overlap:()=>za,randomMember:()=>_o,randomPop:()=>Oo,shuffleArray:()=>La,structureSort:()=>xy,subSort:()=>RDe,undefinedToNull:()=>jF,unique:()=>Ft,visualizeScheduledMatchUps:()=>P_e});function P_e({scheduledMatchUps:t,showGlobalLog:e}){VCe();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===r);return{[r]:`${a} ${o}`}})};i==null||i.forEach(r=>{var s;Bs({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let a=t.filter(l=>l.structureId===r),o=((s=Wa({matchUps:a}))==null?void 0:s.roundMatchUps)||[];Object.keys(o).forEach(l=>{Bs({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),o[l].forEach(({matchUpId:c,schedule:u})=>{let d=tn(u.scheduledTime);Bs({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&BCe()}function C_e({tournamentRecord:t}){if(!t)return{error:Re};if(typeof t!="object"||!t.tournamentId)return{error:ve};let{matchUps:e}=Br({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=E_e({tournamentRecord:t});R_e(e,i)}return{...ne}}function E_e({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var M_e=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function R_e(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,o=e[n]||e[r]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))M_e.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function N_e(t,e){if(e&&typeof e!="object")return{error:ve};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:ve};i=Object.assign({},...Object.keys(i).reverse().map(R=>({[R]:Array.isArray(i[R])?i[R]:[typeof i[R]=="string"&&i[R]].filter(Boolean)})));let v=t.filter(Boolean).map(R=>zz(R,g)),y=Object.values(i).flat();n&&l.push(...y);let I=v.reduce((R,A)=>Object.keys(A).every(_=>!R.includes(_)&&R.push(_)||!0)&&R,[]).filter(R=>!(l!=null&&l.length)||l.includes(R)),b=Object.assign({},...Object.keys(i).reverse().map(R=>i[R].map(A=>({[A]:R})).flat()).flat()),D=(R,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(R)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(R)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=I.reduce((R,A)=>{let _=b[A];return _?R.includes(_)||R.push(_):R.push(A),R},[]).sort(D);Object.keys(u).forEach(R=>!w.includes(R)&&w.unshift(R)),Object.keys(i).forEach(R=>!w.includes(R)&&w.unshift(R)),typeof p=="object"&&Object.keys(p).forEach(R=>!w.includes(R)&&w.unshift(R));let S=w.map(R=>u[R]||R);if(s)return[S];let U=R=>`${h}${R}${h}`,C=[],E=R=>Object.values(w.reduce((A,_,O)=>{var G;let x=i[_],F=(x!=null&&x.length?R[x.find(j=>R[j])]:R[_])||(p==null?void 0:p[_])||"",$=((G=d[_])==null?void 0:G[F])||F,V=io(c[_])?c[_]($):$;return A[_]=U(V),V&&(C[O]=(C[O]||0)+1),A},{})),P=v.map(E),M=o&&[...C].map((R,A)=>!R&&A).filter(En).reverse();if(M){let R=A=>A.filter((_,O)=>!M.includes(O));P=P.map(R),S=R(S)}let N=P.map(R=>R.join(f));return a?N.map(R=>{let A=R.split(f);return Object.assign({},...A.map((_,O)=>({[S[O]]:_})))}):r?[S.map(U).join(f),...N].join(m):N.join(m)}function zz(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,zz(t[r],e,i.concat(r))),{})}var A_e={},{FACTORY:VK}=fj;function __e({tournamentRecord:t,value:e}){let{extension:i}=Vt({element:t,name:VK}),n={name:VK,value:{...i==null?void 0:i.value,...e}};ci({element:t,extension:n})}function ek({timeStamp:t}){let e=yf(),i=qV();return i&&Object.values(e).forEach(n=>{__e({tournamentRecord:n,value:{version:Yw(),timeStamp:t}})}),i}function Cle({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var d,p;let a=Hs();if(typeof a!="object")return;let o={method:e},s=(r==null?void 0:r.error)&&(a.errors===!0||Array.isArray(a.errors)&&a.errors.includes(e)),l=Array.isArray(a.params)&&((d=a.params)==null?void 0:d.includes(e)),c=a.params&&!Array.isArray(a.params)||l,u=Array.isArray(a.exclude)&&a.exclude.includes(e);!u&&![void 0,!1].includes(a.perf)&&!isNaN(a.perf)&&i>=a.perf&&(o.elapsed=i),!u&&(s||c)&&(o.params=n),!u&&(s||a.result&&!Array.isArray(a.result)&&(!Array.isArray(a.params)||l)||Array.isArray(a.result)&&((p=a.result)!=null&&p.includes(e)))&&(o.result=r),Object.keys(o).length>1&&Tee(o,t)}function MP({methodName:t,params:e,start:i}){let n={error:bD,methodName:t},r=i?Date.now()-i:0;return Cle({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function k_e(t,e){var a;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Re};let i=e.drawId||((a=e.matchUp)==null?void 0:a.drawId);if(i){let{event:o,drawDefinition:s,tournamentId:l}=so({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=so({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:Bo};e.tournamentId=s,e.event=o}let n=e.tournamentId??Ay();if(!n&&e)return e;let r=t[n];return n&&!r?{error:Re}:(r&&(e.tournamentRecord=r),e)}function RP(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),o=Ay();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||XV(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||yf(),c=i?at(i,void 0,!0):void 0,u=i?k_e(l,i):void 0;if(u!=null&&u.error)return u;let d=O_e({params:u,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-a;return Cle({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function O_e({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(Hs())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return bA({engineName:"engine",methodName:n,params:i,err:a})}}function tk(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=Xs();for(let o of[...a].sort(Mle)){let s=YV({topic:o});s!=null&&s.length&&VT({topic:o,notices:s})}e&&r&&a.includes(QT)&&VT({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:QT})}async function Ele(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=Xs();for(let o of[...a].sort(Mle)){let s=YV({topic:o});s&&await VT({topic:o,notices:s})}e&&r&&a.includes(QT)&&VT({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:QT})}var jK={[Gj]:5,[jj]:5,[Hj]:5,[Vj]:5,[Bj]:5,[Fj]:5,[ite]:5,[nte]:5,[$j]:1,[kA]:1,[aa]:5,[ug]:5,[Lj]:4,[kj]:4,[Oj]:4,[xj]:4,[_A]:3,[Nj]:2};function Mle(t,e){return(jK[e]||0)-(jK[t]||0)}function x_e({convertExtensions:t,removeExtensions:e}){let i=yf();return{tournamentId:Ay(),tournamentRecords:at(i,t,!1,e)}}function L_e(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??Ay();if(typeof n!="string")return{};let r=XV(n);return{tournamentRecord:at(r,e,!1,i)}}function F_e(){var n;let t=yf(),{extension:e}=Vt({name:zv,tournamentRecords:t,discover:!0}),i=((n=e==null?void 0:e.value)==null?void 0:n.tournamentIds)||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),IA(t)}function GK(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Fp}:t!=null&&t.tournamentId?wee(e?at(t):t):{error:ve}}function R0(t,e=!0){if(typeof t!="object")return{error:Fp};if(jT(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:zF};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},jT(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:zF};return IA(e?at(t):t)}async function $_e(t,e,i){if(!Array.isArray(e))return{error:ve,message:"directives must be an array"};let n=KV(),r=Date.now(),a=i&&at(yf(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:ve,message:"directive must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return MP({methodName:u,start:r,params:p});if(d){let f=o[o.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=RP(t,n[u],p,u,"async");if(h!=null&&h.error)return a&&R0(a),{...h,rolledBack:!!a};o.push({...h,methodName:u})}let s=Date.now(),l=ek({timeStamp:s});return await Ele({directives:e,mutationStatus:l,timeStamp:s}),Ny(),{success:o.every(c=>c.success),results:o}}async function HK(t,e){if(!Zi(e))return{error:ve,message:"args must be an object"};let i=Object.values(e).filter(io).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ve};let n=i?Object.keys(e).find(h=>io(e[h])):Ga(e.method)&&e.method;if(!n)return{error:bD};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&at(yf(),!1,!0),l=r||t[n]||yA()[n];if(!l)return MP({methodName:n,params:o});let c=await RP(t,l,o,n,"async")??{};c!=null&&c.error&&s&&R0(s);let u=Date.now(),d=ek({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&await Ele({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&Ny(),c}function B_e(t,e,i,n,r,a){let o=Uee(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>io(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(Hs())return u();try{return u()}catch(d){bA({engineName:"engine",methodName:l,params:c,err:d})}}}),{...ne,...t}}function $I(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function Wz(t,e){t.importMethods=(i,n,r,a)=>B_e(t,e,i,n,r,a),t.getTournament=i=>L_e(i),t.getState=i=>x_e({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>Yw(),t.reset=()=>(IA({}),$I(t)),t.devContext=i=>($T(i),$I(t)),t.getDevContext=i=>Hs(i),t.newTournamentRecord=(i={})=>{let n=Yoe(i),r=n.tournamentId;return n.error?n:(GK(n),jT(r),{...ne,tournamentId:r})},t.setState=(i,n,r)=>{BT(n,r);let a=R0(i,n);return $I(t,a)},t.setTournamentId=i=>jT(i),t.getTournamentId=()=>Ay(),t.setTournamentRecord=(i,n,r)=>{BT(n,r);let a=GK(i,n);return $I(t,a)},t.removeTournamentRecord=i=>{let n=See(i);return $I(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=F_e();return $I(t,i)}}function V_e(t){let e=gee();if(e.error&&!t)return e;let i={executionQueue:(n,r)=>$_e(i,n,r),execute:n=>HK(i,n)};return Wz(i,HK),i}function j_e(t,e,i){if(!Array.isArray(e))return{error:ve,message:"directives must be an array"};let n=KV(),r=Date.now(),a=i&&at(yf(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:ve,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:ve,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return MP({methodName:u,start:r,params:p});if(d){let f=o[o.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=RP(t,n[u],p,u,"sync");if(h!=null&&h.error)return a&&R0(a),{...h,rolledBack:!!a};o.push({...h,methodName:u})}let s=Date.now(),l=ek({timeStamp:s});return tk({directives:e,mutationStatus:l,timeStamp:s}),Ny(),{success:o.every(c=>c.success),results:o}}function zK(t,e){if(!Zi(e))return{error:ve,message:"args must be an object"};let i=Object.values(e).filter(io).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ve};let n=i?Object.keys(e).find(h=>io(e[h])):Ga(e.method)&&e.method;if(!n)return{error:bD};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&at(yf(),!1,!0),l=r||t[n]||yA()[n];if(!l)return MP({methodName:n,params:o});let c=RP(t,l,o,n,"sync")??{};c!=null&&c.error&&s&&R0(s);let u=Date.now(),d=ek({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&tk({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&Ny(),c}var Rle=(()=>{let t={executionQueue:(e,i)=>j_e(t,e,i),execute:e=>zK(t,e)};return Wz(t,zK),t})(),NP=Rle;function WK(t,e){if(!Zi(e))return{error:ve,message:"args must be an object"};let i=Object.values(e).filter(io).length;if(i>1)return{message:"there must be only one arg with typeof function",error:ve};let n=i?Object.keys(e).find(l=>io(e[l])):Ga(e.method)&&e.method;if(!n)return{error:bD};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=r||t[n]||yA()[n];return s?RP(t,s,o,n,"ask"):MP({methodName:n,params:o})}var G_e=(()=>{let t={execute:e=>WK(t,e)};return Wz(t,WK),t})(),Uv={},Eh;function qK(t,e=!0){if(!t)return{error:ut};if(typeof t!="object")return{error:Fp};if(t.matchUpId)Eh=t.matchUpId,Uv[Eh]=e?at(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(Uv[i.matchUpId]=e?at(i):i,Eh||(Eh=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(Uv[i.matchUpId]=e?at(i):i,Eh||(Eh=i.matchUpId));return e?at(t):t}function H_e(){return Uv[Eh]}function z_e(){return Object.values(Uv)}function W_e(){Eh=void 0,Uv={}}function q_e(t){return at(Uv[Eh],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}var K_e=(()=>{let t={getState:r=>q_e(r),version:()=>Yw(),reset:()=>(W_e(),{...ne}),drawId:void 0,error:void 0,success:!1,devContext:r=>($T(r),t),setState:(r,a,o)=>{BT(a,o);let s=qK(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([wv]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(Hs())return n({params:s,governor:a,methodName:o});try{return n({params:s,governor:a,methodName:o})}catch(l){bA({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function n({params:r,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||H_e(),l=(r==null?void 0:r.matchUps)||z_e(),c=(r==null?void 0:r.rollbackOnError)&&at(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=a[o](r);if(u!=null&&u.error)return c&&qK(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&tk(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&Ny(),u}})(),mL=!1,ik=(()=>{let t={version:()=>Yw(),setDeepCopy:(n,r)=>(BT(n,r),t),devContext:n=>($T(n),mL=!0,t)};return i([z_]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||tk(),Ny(),mL&&($T(!1),mL=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=o=>{try{let s=e(r[a],o);return!(s!=null&&s.error)&&(o!=null&&o.setState)&&(s!=null&&s.tournamentRecord)&&R0(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();NP.importMethods(aA,!0,1);var Sg=NP,$e=NP;function Nle(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function Y_e(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,I,b,D,w,S,U;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(o)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((I=f.levels)!=null&&I.length)||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((D=(b=f.flights)==null?void 0:b.flightNumbers)!=null&&D.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=f.eventTypes)!=null&&S.length)||((U=f.eventTypes)==null?void 0:U.includes(r)))})}}function KK({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var f,m;let o=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(Mt(g)?g:0),I=Nle(a,g==null?void 0:g.level);return{value:o(v,I)||Mt(I)&&I||y}},l=0,c,u,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===n||((b=I.drawSizes)==null?void 0:b.includes(n))}),v=i.find(I=>I.drawSize&&I.threshold&&n>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h],y=y==null?void 0:y[h]),u=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=u||d||p,c=u&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(f=i==null?void 0:i.drawSizes)==null?void 0:f[n],v=i;h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h]),u=s(g,e).value,p=s(v,e).value,l=u||p,c=u?g.requireWin:v==null?void 0:v.requireWin}else Mt(i)&&h===void 0&&(l=i);return e&&((m=r==null?void 0:r.pct)!=null&&m[e])&&(l=Math.round(l*r.pct[e])),{awardPoints:l,requireWin:c}}function Z_e({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var v;if(!i)return{error:Re};let{policyDefinitions:r}=Vp({policyTypes:[$1],tournamentRecord:i}),a=(e==null?void 0:e[$1])??(r==null?void 0:r[$1]);if(!a)return{error:lA};let o=a.awardProfiles,s=a.requireWinFirstRound,l=a.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=xn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),f={},m={},g={};for(let y of h??[]){let{participantType:I,participantId:b,person:D,draws:w}=y;for(let S of w){let{drawId:U,structureParticipation:C,eventId:E}=S,P=u[E],M=d[U],N=M==null?void 0:M.drawType,{category:R,eventType:A}=P||{},_=S.startDate||P.startDate||i.startDate,O=S.endDate||P.endDate||i.endDate;if(A===Ws&&b!==$s)continue;let x;if(o){let F=l,$=0,V=0,G=0,j;for(let z of C){let{finishingPositionRange:H,participationOrder:K,participantWon:q,flightNumber:Y,rankingStage:Z,winCount:Q}=z;$+=Q||0;let ie=M==null?void 0:M.drawSize,{awardProfile:ue}=Y_e({awardProfiles:o,participation:z,eventType:A,startDate:_,category:R,drawSize:ie,drawType:N,endDate:O,level:n});if(ue){if(!ie)continue;let J=Array.isArray(H)&&Math.max(...H),te=Ft(H||[]).join("-"),se=J&&Z!==mt&&(H==null?void 0:H.includes(ie));ue.requireWinForPoints!==void 0&&(F=ue.requireWinForPoints),ue.requireWinFirstRound!==void 0&&(s=ue.requireWinFirstRound);let{finishingPositionPoints:ee={},finishingPositionRanges:ce,finishingRound:fe,pointsPerWin:ge,flights:he}=ue,Se=Array.isArray(ue.perWinPoints)?(v=ue.perWinPoints)==null?void 0:v.find(xe=>{var st;return(st=xe.participationOrders)==null?void 0:st.includes(K)}):ue.perWinPoints,Ce=ee.participationOrders,Fe=0,Je;if((!Ce||Ce.includes(K))&&ce&&J){let xe=ce[J];xe&&({awardPoints:Fe,requireWin:Je}=KK({flightNumber:Y,valueObj:xe,drawSize:ie,flights:he,level:n}))}if(!Fe&&fe&&K===1&&J){let xe=fe[J];xe&&({awardPoints:Fe,requireWin:Je}=KK({participantWon:q,flightNumber:Y,valueObj:xe,drawSize:ie,flights:he,level:n}))}if(se&&s!==void 0&&(F=s),Je!==void 0&&(F=Je),Fe>V&&(!F||Q)&&(V=Fe,j=J),!Fe&&ge&&Q&&(G+=Q*ge,j=te),!Fe&&Q&&Se){let xe=Nle(n,Se==null?void 0:Se.level);xe?G+=Q*xe:Se.value&&(G+=Q*Se.value)}}if(x=V+G,I===$s){let J=(y.matchUps||[]).filter(({structureId:te})=>te===z.structureId);for(let{matchUpId:te}of J){let se=p[te],ee=se.sides.find(ce=>ce.participantId===b).sideNumber;if(se.winningSice===ee)for(let ce of se.tieMatchUps)ce.winningSide}}}if(G||V){let z={winCount:$,positionPoints:V,rangeAccessor:j,perWinPoints:G,eventType:A,drawId:U,points:x},H=D==null?void 0:D.personId;H?(f[H]||(f[H]=[]),f[H].push(z)):I===kt?(g[b]||(g[b]=[]),g[b].push(z)):I===$s&&(m[b]||(m[b]=[]),m[b].push(z))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...ne}}var X_e={getTournamentPoints:Z_e},J_e=X_e,Q_e={calculateNewRatings:Gne,generateDynamicRatings:Hne},eke=Q_e,tke={...J_e,...eke};NP.importMethods(tke);var ike=NP,nke={[WT]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},rke={[dp]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Iv,uT]}},ake={[dp]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Iv,aU,Jv],disabledActions:[]}]}},oke={[dp]:{policyName:"positionActionsDisabled",enabledStructures:!1}},ske={[l0]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},lke={[ud]:{defaultMatchUpFormat:_s,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[it]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},cke={[ud]:{requireAllPositionsAssigned:!1,stage:{[it]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:_s,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:_s,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},uke={[hl]:{seedingProfile:{positioning:MA},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},dke={POLICY_AVOIDANCE_COUNTRY:nke,POLICY_POSITION_ACTIONS_DEFAULT:Sne,POLICY_POSITION_ACTIONS_DISABLED:oke,POLICY_POSITION_ACTIONS_NO_MOVEMENT:ake,POLICY_POSITION_ACTIONS_UNRESTRICTED:rke,POLICY_PRIVACY_DEFAULT:ske,POLICY_ROUND_NAMING_DEFAULT:nG,POLICY_SCHEDULING_DEFAULT:$ae,POLICY_SCORING_DEFAULT:lke,POLICY_SCORING_USTA:cke,POLICY_SEEDING_ITF:uke,POLICY_SEEDING_DEFAULT:Uae},ew={ratingsParameters:ns,matchUpFormats:y1e,countryToFlag:zte,tieFormats:doe,countries:kh,policies:dke,flagIOC:RCe},mo={};Gt(mo,{activeMatchUpStatuses:()=>EA,auditConstants:()=>eoe,completedMatchUpStatuses:()=>gr,directingMatchUpStatuses:()=>wj,drawDefinitionConstants:()=>tr,entryStatusConstants:()=>Gl,errorConditionConstants:()=>oee,eventConstants:()=>Xo,extensionConstants:()=>fj,flightConstants:()=>foe,genderConstants:()=>Du,keyValueConstants:()=>aH,matchUpActionConstants:()=>YG,matchUpStatusConstants:()=>Uj,matchUpTypes:()=>ute,nonDirectingMatchUpStatuses:()=>Sj,particicipantsRequiredMatchUpStatuses:()=>Ij,participantConstants:()=>Ua,participantRoles:()=>Uf,participantTypes:()=>yb,penaltyConstants:()=>Ale,policyConstants:()=>lg,positionActionConstants:()=>Ky,ratingConstants:()=>jne,recoveryTimeRequiredMatchUpStatuses:()=>qee,requestConstants:()=>Woe,resultConstants:()=>eQ,scaleConstants:()=>a0,scheduleConstants:()=>kte,sortingConstants:()=>goe,surfaceConstants:()=>_le,tieFormatConstants:()=>vae,timeItemConstants:()=>$A,topicConstants:()=>ste,tournamentConstants:()=>Fz,upcomingMatchUpStatuses:()=>Tj,validMatchUpStatuses:()=>bj,venueConstants:()=>kle});var pke="Coaching",hke="Ball Abuse",fke="Racket Abuse",mke="Verbal Abuse",gke="INELIGIBILITY",vke="Physical Abuse",yke="Unsportmanlike Conduct",Ike="Dress Code Violation",bke="Equipment Violation",wke="Leaving the court",Ske="Failure to complete",Tke="No Show",Uke="Other",Dke="REFUSAL_TO_PLAY",Pke="PROHIBITED_SUBSTANCE",Cke="Puncuality",Eke="Failure to sign in",Ale={COACHING:pke,BALL_ABUSE:hke,RACKET_ABUSE:fke,VERBAL_ABUSE:mke,PHYSICAL_ABUSE:vke,INELIGIBILITY:gke,UNSPORTSMANLIKE_CONDUCT:yke,PROHIBITED_SUBSTANCE:Pke,DRESS_CODE_VIOLATION:Ike,EQUIMENT_VIOLATION:bke,LEAVING_THE_COURT:wke,REFUSAL_TO_PLAY:Dke,FAILURE_TO_COMPLETE:Ske,NO_SHOW:Tke,OTHER:Uke,PUNCTUALITY:Cke,FAILUIRE_TO_SIGN_IN:Eke},Mke="CLAY",Rke="HARD",Nke="GRASS",Ake="CARPET",_ke="ARTIFICIAL",_le={CLAY:Mke,HARD:Rke,GRASS:Nke,CARPET:Ake,ARTIFICIAL:_ke},kke="INDOOR",Oke="OUTDOOR",kle={INDOOR:kke,OUTDOOR:Oke};const Ole=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:EA,askEngine:G_e,asyncEngine:V_e,auditConstants:eoe,competitionEngine:Sg,competitionGovernor:mV,completedMatchUpStatuses:gr,directingMatchUpStatuses:wj,drawDefinitionConstants:tr,drawsGovernor:mj,entriesGovernor:zH,entryStatusConstants:Gl,errorConditionConstants:oee,eventConstants:Xo,eventGovernor:KH,extensionConstants:fj,factoryConstants:mo,fixtures:ew,flightConstants:foe,forge:A_e,genderConstants:Du,generationGovernor:iz,globalState:oT,governors:aA,keyValueConstants:aH,matchUpActionConstants:YG,matchUpEngine:K_e,matchUpFormatCode:wp,matchUpFormatGovernor:wp,matchUpGovernor:az,matchUpStatusConstants:Uj,matchUpTypes:ute,mocksEngine:ik,mocksGovernor:z_,nonDirectingMatchUpStatuses:Sj,particicipantsRequiredMatchUpStatuses:Ij,participantConstants:Ua,participantGovernor:Ez,participantRoles:Uf,participantTypes:yb,penaltyConstants:Ale,policyConstants:lg,policyGovernor:hH,positionActionConstants:Ky,publishingGovernor:X_,queryGovernor:fH,ratingConstants:jne,recoveryTimeRequiredMatchUpStatuses:qee,reportGovernor:Rz,requestConstants:Woe,resultConstants:eQ,scaleConstants:a0,scaleEngine:ike,scheduleConstants:kte,scheduleGovernor:Nz,scoreGovernor:wv,sortingConstants:goe,surfaceConstants:_le,syncEngine:Rle,tieFormatConstants:vae,tieFormatGovernor:_z,timeItemConstants:$A,tools:hi,topicConstants:ste,tournamentConstants:Fz,tournamentEngine:$e,tournamentGovernor:Lz,upcomingMatchUpStatuses:Tj,utilities:hi,validMatchUpStatuses:bj,venueConstants:kle,venueGovernor:$z,version:Yw},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:xle,FOLLOWED_BY:Lle,NEXT_AVAILABLE:Fle,NOT_BEFORE:$le,TO_BE_ANNOUNCED:Ble}=mo.timeItemConstants,{SCHEDULE_ERROR:xke,SCHEDULE_CONFLICT:Lke,SCHEDULE_WARNING:Fke}=mo.scheduleConstants,{ORGANISER_ACCEPTANCE:$ke,DIRECT_ACCEPTANCE:Bke,SPECIAL_EXEMPT:Vke,JUNIOR_EXEMPT:jke,ALTERNATE:Gke,WILDCARD:Hke}=Gl,YK="All statuses",zke="All genders",gL="All flights",ty="All events",ZK="All teams",Vle="registration",Wke="timepicker",qke="timevalue",IR="tmxContent",jle="tmxDrawer",nk="navbar",hU="splash",rk="superadmin",bR="competitionEngine",vL="tournamentEngine",Sp="tournaments",Gle="drawEntries",xa="tournament",j$="structure",Kke="invite",ev="event",zS="draw",G$="view",fU="tournamentEvents",AP="overview",Tp="participants",iy="schedule",qz="matchUps",Vu="events",Kz="venues",Yke="unscheduled",_P={success:!0},Zke=10,Hle="ISSUE",Ps="Automated",Yz="Manual",zle={[xke]:"matchup-error",[Lke]:"matchup-conflict",[Hle]:"matchup-issue",[Fke]:"matchup-warning"},wR="tournamentParticipants",Wle="scheduledDateFilter",Dv="unscheduledMatchUps",ak="tournamentsCalendar",SR="tournamentMatchUps",TR="tournamentSchedule",H$="tournamentsTable",UR="tournamentTeams",DR="venuesTable",qle="entriesCount",Kle="eventsTable",mU="tmxOverlay",Zz="teamStats",Xz="drawControl",Xke="drawFrame",Yle="drawRight",Zle="drawLeft",Xle="entriesView",vd="drawsView",kP="QUALIFYING",sc="ACCEPTED",Jle="eventInfo",Jz="acceptedPanel",Qz="alternatesPanel",eW="qualifyingPanel",tW="ungroupedPanel",iW="withdrawaPanel",Qle="unscheduledVisibility",ece="tournamentsControl",nW="participantControl",rW="unscheduledControl",aW="scheduleControl",oW="matchUpsControl",sW="venuesControl",lW="eventsControl",OP="eventControl",cW="teamsControl",Jke="controlBar",tce="buttonBar",nv="tmxPanel",ice="tmxTable",nce="tcContainer",dr="overlay",At="center",PR="header",vt="right",Et="left",Ef="bottom",XK="top",ok="subTable",tw="",jE="flex",ct="none",rce="isOpen",uW="Collection value",dW="Match value",pW="Score value",hW="Set value",DS={[xle]:"After rest",[Lle]:"Followed by",[Ble]:"To be announced",[Fle]:"Next available",[$le]:"Not before"},Qke={[xle]:"After rest",[Lle]:"Followed by",[Ble]:"TBA",[Fle]:"Next available",[$le]:"NB"},ace={[$ke]:"OA",[Bke]:"DA",[Vke]:"SE",[jke]:"JE",[kP]:"QUAL",[Gke]:"ALT",[Hke]:"WC"},CR="Playoff",lm="drawSize",ER="CUSTOM",nb="advancePerGroup",MR="qualifiersCount",RR="groupRemaining",fW="matchUpFormat",gU="structureName",pT="playoffType",Xd="groupSize",oce="positions",ny="drawName",Gu="drawType",hT="top",eOe="winners",z$="roundsColumns",iw="roundsStats",nw="roundsTable",mW="utr",tOe="wtn",fT={},iOe={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},nOe=(t,e,i,n,r)=>{const a=t.split("-"),o=a.includes(Et)&&`left:${n}`,s=a.includes(vt)&&`right:${r}`,l=a.includes("top")&&`top:${e}`,c=a.includes("bottom")&&`bottom:${i}`,u="align-items: "+(a.includes("left")&&"flex-start"||a.includes("right")&&"flex-end"||At),d="text-align: "+(a.includes("left")&&"left"||a.includes("right")&&"right"||At);return[o,s,l,c,u,d].filter(Boolean).join(";")};function rOe(t){if(fT.position)return fT.position;const e=document.createElement("div");return e.style="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+nOe(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),fT.position=e,e}function aOe(t){if(!t.message)return{error:"Missing message"};const e={...iOe,...t},i=rOe(e),n=oOe(e);if(e.onlyOne){let r=i.lastElementChild;for(;r;)i.removeChild(r),r=i.lastElementChild}i.appendChild(n.element)}function oOe(t){var l,c;const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>a(t.onClose));const i=t.duration&&BUe(()=>a(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const n=["notification"];if(typeof t.classList=="string"&&n.push(t.classList),t.type&&n.push(t.type),(l=t==null?void 0:t.animate)!=null&&l.in){const u=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",d=`animate__${t.animate.in}`;n.push(`animate__animated ${d} ${u}`),s(()=>e.classList.remove(d))}if(e.className=n.join(" "),t.dismissible){const u=document.createElement("button");u.className="delete",u.addEventListener("click",()=>a(t.onClose)),e.insertAdjacentElement("afterbegin",u)}const r=document.createElement("div");if(r.style="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?r.insertAdjacentHTML("beforeend",t.message):t.message&&(console.log(" MESSAGE ",t.message,typeof t.messsage),r.appendChild(t.message)),pt((c=t.action)==null?void 0:c.onClick)){const u=document.createElement("button");u.style="margin-left: 1em;",u.className="button",u.innerHTML=t.action.text||"OK",u.addEventListener("click",t.action.onClick),r.appendChild(u)}return e.appendChild(r),{element:e};function a(u){var d;pt(u)&&u(),(d=t==null?void 0:t.animate)!=null&&d.out?(e.classList.add(`animate__${t.animate.out}`),s(()=>{o(e.parentNode),delete fT.position,e.remove()})):(o(e.parentNode),delete fT.position,e.remove())}function o(u){u&&u.children.length<=1&&u.remove()}function s(u=()=>{}){const d={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const p in d)if(e.style[p]!==void 0){e.addEventListener(d[p],()=>u());break}}}function ai(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:n=!1,dismissible:r=!0,clickClose:a=!0,duration:o=2500,single:s=!0,onClose:l,offsetBottom:c=0,offsetRight:u=0,offsetLeft:d=0,offsetTop:p=0,opacity:h=1,message:f,action:m}=t??{};aOe({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:n,offsetBottom:c,type:i,offsetRight:u,dismissible:r,offsetLeft:d,clickClose:a,offsetTop:p,duration:o,position:e,message:f,onClose:l,opacity:h,action:m,single:s})}function sOe(){ai({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function lOe(){let t=`${Nr.tr("phrases.blocked")}. ${Nr.tr("phrases.enablepopups")}`;return ai({intent:"is-danger",message:t})}function cOe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${AP} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function uOe(){const t=document.createElement("nav");return t.className="navbar is-transparent",t.ariaLabel="main navigation",t.style.display=ct,t.style.width="100%",t.role="navigation",t.id=nk,t.innerHTML=`
    <div class="navbar-brand">
      <div class="navbar-item" id="provider">TMX</div>
      <div class="navbar-item" id="pageTitle">
      </div>
      <a
        data-target="navbar-basic"
        class="navbar-burger"
        aria-expanded="false"
        aria-label="menu"
        role="button"
      >
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbar-menu" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" style="font-size: 2em">
          <i id="config" class="fa-solid fa-sliders"></i>
        </div>
        <div class="navbar-item" style="font-size: 2.5em">
          <i id="login" class="fa-solid fa-circle-user"></i>
        </div>
      </div>
    </div>
  `,t}function dOe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${Jle} class="block" style='display: none; width: 100%;'}>
        <div id=${OP} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${Kle}>
        <div id=${lW} class="controlBar"></div>
        <div id=${fU} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${Xle} style='display: none;'}>
        <div id=${Jz} class='tableClass block ${nv}'>
          {' '}
        </div>
        <div id=${eW} class='tableClass block ${nv}'>
          {' '}
        </div>
        <div id=${Qz} class='tableClass block ${nv}'>
          {' '}
        </div>
        <div id=${tW} class='tableClass block ${nv}'>
          {' '}
        </div>
        <div id=${iW} class='tableClass block ${nv}'>
          {' '}
        </div>
      </div>
      <div style="background-color: white; width: 100%; margin: 0">
        <div id=${Xz}></div>
        <div id=${Xke} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${Zle} ></div>
          <div
            id=${vd}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${Yle} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const pOe=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function hOe(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=pOe,t}function fOe(){const t=document.getElementById("root"),e=document.createElement("div");e.className="flexrow flexcenter",e.id=hU,e.style="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(hOe()),t.appendChild(e);const i=document.createElement("div");i.style.display=ct,i.id=Wke;const n=document.createElement("input");n.className="timepicker-ui-input",n.id=qke,n.type="text",i.appendChild(n),t.appendChild(i);const r=document.createElement("section");r.className="drawer drawer--left",r.setAttribute("data-drawer-target",""),r.id=jle,r.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(r);const a=document.createElement("div");a.className="main noselect",a.appendChild(uOe());const o=document.createElement("div");o.id=IR,o.className="springboard flexrow flexcenter",o.style.display=ct;const s=document.createElement("div");s.id="sideNav",s.className="sideNav",o.appendChild(s);const l=document.createElement("div");l.id=nce,l.className="flexcol flexcenter tournament_container",l.appendChild(cOe()),l.appendChild(dOe()),o.appendChild(l),a.appendChild(o);const c=document.createElement("div");c.className="flexcol flexgrow",c.style.paddingTop="3em",c.style.display=ct,c.id=Sp;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=ece,c.appendChild(u);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=H$,c.appendChild(d),a.appendChild(c);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=ct,p.style.height="90%",p.style.width="100%",p.id=ak,a.appendChild(p),t.appendChild(a),t}window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);function mOe(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function lo(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const Z1={[AP]:"o-tab",[Tp]:"p-tab",[Vu]:"e-tab",[qz]:"m-tab",[iy]:"s-tab",[Kz]:"v-tab"};function gOe(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
            <div id='${nW}' class='controlBar'></div>
            <div id='${wR}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${cW}' class='controlBar'></div>
              <div id='${UR}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${Qle}' style='width: 100%; display: none;'>
                  <div id='${rW}' class='controlBar flexcol flexcenter'></div>
                  <div id='${Dv}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${aW}' class='controlBar flexcol flexcenter'></div>
                  <div id='${TR}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${sW}' class='controlBar'></div>
              <div id='${DR}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,n=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${oW}' class='controlBar'></div>
              <div id='${Zz}' class='controlBar'></div>
              <div id='${SR}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,r={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":n},a=document.getElementById(nce);Object.keys(r).forEach(o=>{const s=document.createElement("div");s.class="is-marginless",s.style="width: inherit",s.id=o,s.innerHTML=r[o],a.appendChild(s)}),sce(Tp)}function sce(t){return Object.keys(Z1).includes(t)?(Object.keys(Z1).forEach(e=>{const i=Z1[e],n=document.getElementById(i);n?n.style.display=t===e?"":ct:console.log({key:e,id:i,element:n})}),{..._P}):!1}function vOe(){[vd,lW,oW,nW,rW,OP,cW,aW,sW,Zz,Jz,Qz,eW,tW,iW,fU,SR,wR,TR,UR,Dv,DR].forEach(e=>{const i=Z1[e],n=document.getElementById(i);n&&lo(n)})}function lce(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}function cce(){return"tmxToken"}const gW=cce();function uce(){localStorage.removeItem(gW)}function dce(){return localStorage.getItem(gW)}function yOe(t){localStorage.setItem(gW,t)}var pce=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};function vW({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"falied normal parse",note:t})}}function IOe(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function hce(t,e){let i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);let n=document.body.appendChild(i);n.click(),n.remove()}function bOe(t,e){let i="data:text/json;charset=utf-8,"+encodeURIComponent(IOe(e));hce(t,i)}function wOe(t,e){let i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);hce(t,i)}function SOe(){const t=s=>s.toString()[1]?s:"0"+s,e=s=>{if(!s)return"";const l=new Date(s);return[t(l.getMonth()+1),t(l.getDate()),l.getFullYear()].join("/")},{tournamentInfo:i}=$e.getTournamentInfo(),{completedMatchUps:n}=$e.tournamentMatchUps({context:{tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventType:"Tournament",...i,idType:mW}}),r=n.map(s=>{const{winningSide:l,sides:c,score:u}=s,d=c.find(({sideNumber:f})=>f===l),p=c.find(({sideNumber:f})=>f!==l);return{winnerScore:u[`scoreStringSide${l}`],...s,winners:d,losers:p}}),a={columnAccessors:[""],columnTransform:{"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament Import Source":["tournamentEventSource"],"Tournament Event Type":["tournamentEventType"],"Tournament Name":["tournamentName"],"Draw Name":[ny],"Draw Type":[Gu],"Match ID":["matchUpId"],Score:["winnerScore"],"Id Type":["idType"]}};let o=hi.JSON2CSV(r,a);wOe(`UTR-${i.tournamentId}.csv`,o)}var JK,rr="colors",Us="sizes",Ct="space",TOe={gap:Ct,gridGap:Ct,columnGap:Ct,gridColumnGap:Ct,rowGap:Ct,gridRowGap:Ct,inset:Ct,insetBlock:Ct,insetBlockEnd:Ct,insetBlockStart:Ct,insetInline:Ct,insetInlineEnd:Ct,insetInlineStart:Ct,margin:Ct,marginTop:Ct,marginRight:Ct,marginBottom:Ct,marginLeft:Ct,marginBlock:Ct,marginBlockEnd:Ct,marginBlockStart:Ct,marginInline:Ct,marginInlineEnd:Ct,marginInlineStart:Ct,padding:Ct,paddingTop:Ct,paddingRight:Ct,paddingBottom:Ct,paddingLeft:Ct,paddingBlock:Ct,paddingBlockEnd:Ct,paddingBlockStart:Ct,paddingInline:Ct,paddingInlineEnd:Ct,paddingInlineStart:Ct,top:Ct,right:Ct,bottom:Ct,left:Ct,scrollMargin:Ct,scrollMarginTop:Ct,scrollMarginRight:Ct,scrollMarginBottom:Ct,scrollMarginLeft:Ct,scrollMarginX:Ct,scrollMarginY:Ct,scrollMarginBlock:Ct,scrollMarginBlockEnd:Ct,scrollMarginBlockStart:Ct,scrollMarginInline:Ct,scrollMarginInlineEnd:Ct,scrollMarginInlineStart:Ct,scrollPadding:Ct,scrollPaddingTop:Ct,scrollPaddingRight:Ct,scrollPaddingBottom:Ct,scrollPaddingLeft:Ct,scrollPaddingX:Ct,scrollPaddingY:Ct,scrollPaddingBlock:Ct,scrollPaddingBlockEnd:Ct,scrollPaddingBlockStart:Ct,scrollPaddingInline:Ct,scrollPaddingInlineEnd:Ct,scrollPaddingInlineStart:Ct,fontSize:"fontSizes",background:rr,backgroundColor:rr,backgroundImage:rr,borderImage:rr,border:rr,borderBlock:rr,borderBlockEnd:rr,borderBlockStart:rr,borderBottom:rr,borderBottomColor:rr,borderColor:rr,borderInline:rr,borderInlineEnd:rr,borderInlineStart:rr,borderLeft:rr,borderLeftColor:rr,borderRight:rr,borderRightColor:rr,borderTop:rr,borderTopColor:rr,caretColor:rr,color:rr,columnRuleColor:rr,fill:rr,outline:rr,outlineColor:rr,stroke:rr,textDecorationColor:rr,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Us,minBlockSize:Us,maxBlockSize:Us,inlineSize:Us,minInlineSize:Us,maxInlineSize:Us,width:Us,minWidth:Us,maxWidth:Us,height:Us,minHeight:Us,maxHeight:Us,flexBasis:Us,gridTemplateColumns:Us,gridTemplateRows:Us,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},UOe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,xP=()=>{const t=Object.create(null);return(e,i,...n)=>{const r=(a=>JSON.stringify(a,UOe))(e);return r in t?t[r]:t[r]=i(e,...n)}},X1=Symbol.for("sxs.internal"),yW=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),QK=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:DOe}=Object.prototype,W$=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),POe=/\s+(?![^()]*\))/,BI=t=>e=>t(...typeof e=="string"?String(e).split(POe):[e]),eY={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:BI((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:BI((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:BI((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:BI((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:BI((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:BI((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},yL=/([\d.]+)([^]*)/,COe=(t,e)=>t.length?t.reduce((i,n)=>(i.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(r)?`:is(${n})`:n):n+" "+r)),i),[]):e,EOe=(t,e)=>t in MOe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,n,r,a)=>n+(r==="stretch"?`-moz-available${a};${W$(t)}:${n}-webkit-fill-available`:`-moz-fit-content${a};${W$(t)}:${n}fit-content`)+a):String(e),MOe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Xh=t=>t?t+"-":"",fce=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,r,a,o,s)=>o=="$"==!!a?n:(r||o=="--"?"calc(":"")+"var(--"+(o==="$"?Xh(e)+(s.includes("$")?"":Xh(i))+s.replace(/\$/g,"-"):s)+")"+(r||o=="--"?"*"+(r||"")+(a||"1")+")":"")),ROe=/\s*,\s*(?![^()]*\))/,NOe=Object.prototype.toString,hb=(t,e,i,n,r)=>{let a,o,s;const l=(c,u,d)=>{let p,h;const f=m=>{for(p in m){const y=p.charCodeAt(0)===64,I=y&&Array.isArray(m[p])?m[p]:[m[p]];for(h of I){const b=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,w=>w[1].toUpperCase()),D=typeof h=="object"&&h&&h.toString===NOe&&(!n.utils[b]||!u.length);if(b in n.utils&&!D){const w=n.utils[b];if(w!==o){o=w,f(w(h)),o=null;continue}}else if(b in eY){const w=eY[b];if(w!==s){s=w,f(w(h)),s=null;continue}}if(y&&(g=p.slice(1)in n.media?"@media "+n.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(w,S,U,C,E,P)=>{const M=yL.test(S),N=.0625*(M?-1:1),[R,A]=M?[C,S]:[S,C];return"("+(U[0]==="="?"":U[0]===">"===M?"max-":"min-")+R+":"+(U[0]!=="="&&U.length===1?A.replace(yL,(_,O,x)=>Number(O)+N*(U===">"?1:-1)+x):A)+(E?") and ("+(E[0]===">"?"min-":"max-")+R+":"+(E.length===1?P.replace(yL,(_,O,x)=>Number(O)+N*(E===">"?-1:1)+x):P):"")+")"})),D){const w=y?d.concat(p):[...d],S=y?[...u]:COe(u,p.split(ROe));a!==void 0&&r(tY(...a)),a=void 0,l(h,S,w)}else a===void 0&&(a=[[],u,d]),p=y||p.charCodeAt(0)!==36?p:`--${Xh(n.prefix)}${p.slice(1).replace(/\$/g,"-")}`,h=D?h:typeof h=="number"?h&&b in AOe?String(h)+"px":String(h):fce(EOe(b,h??""),n.prefix,n.themeMap[b]),a[0].push(`${y?`${p} `:`${W$(p)}:`}${h}`)}}var g,v};f(c),a!==void 0&&r(tY(...a)),a=void 0};l(t,e,i)},tY=(t,e,i)=>`${i.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,AOe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},iY=t=>String.fromCharCode(t+(t>25?39:97)),Pv=t=>(e=>{let i,n="";for(i=Math.abs(e);i>52;i=i/52|0)n=iY(i%52)+n;return iY(i%52)+n})(((e,i)=>{let n=i.length;for(;n;)e=33*e^i.charCodeAt(--n);return e})(5381,JSON.stringify(t))>>>0),WS=["themed","global","styled","onevar","resonevar","allvar","inline"],_Oe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},kOe=t=>{let e;const i=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(a,o)=>{const{cssText:s}=a;let l="";if(s.startsWith("--sxs"))return"";if(r[o-1]&&(l=r[o-1].cssText).startsWith("--sxs")){if(!a.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===a)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${s}`;return a.cssRules.length?`${l}${s}`:""}return s}).join("")},n=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in s)delete s[c]}const r=Object(t).styleSheets||[];for(const s of r)if(_Oe(s)){for(let l=0,c=s.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const h=p.slice(14,-3).trim().split(/\s+/),f=WS[h[0]];f&&(e||(e={sheet:s,reset:n,rules:{},toString:i}),e.rules[f]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const s=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,s(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,u=>u.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:n,toString:i}}const{sheet:a,rules:o}=e;for(let s=WS.length-1;s>=0;--s){const l=WS[s];if(!o[l]){const c=WS[s+1],u=o[c]?o[c].index:a.cssRules.length;a.insertRule("@media{}",u),a.insertRule(`--sxs{--sxs:${s}}`,u),o[l]={group:a.cssRules[u+1],index:u,cache:new Set([s])}}OOe(o[l])}};return n(),e},OOe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=n=>{try{e.insertRule(n,i),++i}catch{}}},PS=Symbol(),xOe=xP(),LOe=(t,e)=>xOe(t,()=>(...i)=>{let n={type:null,composers:new Set};for(const r of i)if(r!=null)if(r[X1]){n.type==null&&(n.type=r[X1].type);for(const a of r[X1].composers)n.composers.add(a)}else r.constructor!==Object||r.$$typeof?n.type==null&&(n.type=r):n.composers.add(FOe(r,t));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),$Oe(t,n,e)}),FOe=({variants:t,compoundVariants:e,defaultVariants:i,...n},r)=>{const a=`${Xh(r.prefix)}c-${Pv(n)}`,o=[],s=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,DOe.call(u,d)||(l[p]="undefined");const h=t[p];for(const f in h){const m={[p]:String(f)};String(f)==="undefined"&&c.push(p);const g=h[f],v=[m,g,!QK(g)];o.push(v)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:h,...f}=p;h=typeof h=="object"&&h||{};for(const g in f)f[g]=String(f[g]);const m=[f,h,!QK(h)];s.push(m)}return[a,n,o,s,l,c]},$Oe=(t,e,i)=>{const[n,r,a,o]=BOe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let h=0;h<p[PS].length;h++){const[f,m]=p[PS][h];d.rules[f].apply(m)}return p[PS]=[],null}return p[PS]=[],p.rules={},WS.forEach(h=>p.rules[h]={apply:f=>p[PS].push([h,f])}),p})(i):null,l=(s||i).rules,c=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||VOe;const{css:p,...h}=d,f={};for(const v in a)if(delete h[v],v in d){let y=d[v];typeof y=="object"&&y?f[v]={"@initial":a[v],...y}:(y=String(y),f[v]=y!=="undefined"||o.has(v)?y:a[v])}else f[v]=a[v];const m=new Set([...r]);for(const[v,y,I,b]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),hb(y,[`.${v}`],[],t,S=>{l.styled.apply(S)}));const D=nY(I,f,t.media),w=nY(b,f,t.media,!0);for(const S of D)if(S!==void 0)for(const[U,C,E]of S){const P=`${v}-${Pv(C)}-${U}`;m.add(P);const M=(E?i.rules.resonevar:i.rules.onevar).cache,N=E?l.resonevar:l.onevar;M.has(P)||(M.add(P),hb(C,[`.${P}`],[],t,R=>{N.apply(R)}))}for(const S of w)if(S!==void 0)for(const[U,C]of S){const E=`${v}-${Pv(C)}-${U}`;m.add(E),i.rules.allvar.cache.has(E)||(i.rules.allvar.cache.add(E),hb(C,[`.${E}`],[],t,P=>{l.allvar.apply(P)}))}}if(typeof p=="object"&&p){const v=`${n}-i${Pv(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),hb(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=h.className=[...m].join(" ");return{type:e.type,className:g,selector:c,props:h,toString:()=>g,deferredInjector:s}};return yW(u,{className:n,selector:c,[X1]:e,toString:()=>(i.rules.styled.cache.has(n)||u(),n)})},BOe=t=>{let e="";const i=[],n={},r=[];for(const[a,,,,o,s]of t){e===""&&(e=a),i.push(a),r.push(...s);for(const l in o){const c=o[l];(n[l]===void 0||c!=="undefined"||s.includes(c))&&(n[l]=c)}}return[e,i,n,new Set(r)]},nY=(t,e,i,n)=>{const r=[];e:for(let[a,o,s]of t){if(s)continue;let l,c=0,u=!1;for(l in a){const d=a[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let h,f,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(f=f||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),u=!0}c+=m,h=!0}++m}if(f&&f.length&&(o={["@media "+f.join(", ")]:o}),!h)continue e}}}(r[c]=r[c]||[]).push([n?"cv":`${l}-${a[l]}`,o,u])}return r},VOe={},jOe=xP(),GOe=(t,e)=>jOe(t,()=>(...i)=>{const n=()=>{for(let r of i){r=typeof r=="object"&&r||{};let a=Pv(r);if(!e.rules.global.cache.has(a)){if(e.rules.global.cache.add(a),"@import"in r){let o=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(r["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,o++);delete r["@import"]}hb(r,[],[],t,o=>{e.rules.global.apply(o)})}}return""};return yW(n,{toString:n})}),HOe=xP(),zOe=(t,e)=>HOe(t,()=>i=>{const n=`${Xh(t.prefix)}k-${Pv(i)}`,r=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const a=[];hb(i,[],[],t,s=>a.push(s));const o=`@keyframes ${n}{${a.join("")}}`;e.rules.global.apply(o)}return n};return yW(r,{get name(){return r()},toString:r})}),WOe=class{constructor(t,e,i,n){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Xh(this.prefix)+Xh(this.scale)+this.token}toString(){return this.computedValue}},qOe=xP(),KOe=(t,e)=>qOe(t,()=>(i,n)=>{n=typeof i=="object"&&i||Object(n);const r=`.${i=(i=typeof i=="string"?i:"")||`${Xh(t.prefix)}t-${Pv(n)}`}`,a={},o=[];for(const l in n){a[l]={};for(const c in n[l]){const u=`--${Xh(t.prefix)}${l}-${c}`,d=fce(String(n[l][c]),t.prefix,l);a[l][c]=new WOe(c,d,l,t.prefix),o.push(`${u}:${d}`)}}const s=()=>{if(o.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${n===t.theme?":root,":""}.${i}{${o.join(";")}}`;e.rules.themed.apply(l)}return i};return{...a,get className(){return s()},selector:r,toString:s}}),YOe=xP(),mce=t=>{let e=!1;const i=YOe(t,n=>{e=!0;const r="prefix"in(n=typeof n=="object"&&n||{})?String(n.prefix):"",a=typeof n.media=="object"&&n.media||{},o=typeof n.root=="object"?n.root||null:globalThis.document||null,s=typeof n.theme=="object"&&n.theme||{},l={prefix:r,media:a,theme:s,themeMap:typeof n.themeMap=="object"&&n.themeMap||{...TOe},utils:typeof n.utils=="object"&&n.utils||{}},c=kOe(o),u={css:LOe(l,c),globalCss:GOe(l,c),keyframes:zOe(l,c),createTheme:KOe(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:r,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(s)),u});return e||i.reset(),i},ZOe=()=>JK||(JK=mce()),Di=(...t)=>ZOe().css(...t);function XOe({variant:t}){return Di({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const JOe=Di({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),QOe=Di({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),exe=Di({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function txe({drawPosition:t,sideNumber:e}){return Di({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function ixe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return Di({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const IW=Di({fontSize:"smaller",color:"gray"});var nxe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gce(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var vce={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var a="",o=0;o<arguments.length;o++){var s=arguments[o];s&&(a=r(a,n(s)))}return a}function n(a){if(typeof a=="string"||typeof a=="number")return a;if(typeof a!="object")return"";if(Array.isArray(a))return i.apply(null,a);if(a.toString!==Object.prototype.toString&&!a.toString.toString().includes("[native code]"))return a.toString();var o="";for(var s in a)e.call(a,s)&&a[s]&&(o=r(o,s));return o}function r(a,o){return o?a?a+" "+o:a+o:a}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(vce);var rxe=vce.exports;const Tg=gce(rxe);function axe({individualParticipant:t,className:e}){var i,n;const{city:r,state:a,countryCode:o}=((n=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:n[0])||{},s=[r,a,o].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=Tg(IW(),e),l.innerHTML=s,l}const oxe=Di({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),sxe=Di({display:"block"}),lxe=Di({position:"fixed",right:0,left:0}),cxe=Di({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),uxe=Di({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),dxe=Di({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),pxe=Di({fontWeight:"600",fontSize:"20px"}),rY=Di({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),aY="Nothing to see here";function gc(t){return typeof t=="function"}function J1(t){return typeof t=="string"}function oY(t){return Array.isArray(t)}function IL(t){return typeof t=="object"&&!Array.isArray(t)}function hxe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const NR=(()=>{const t=lxe(),e={},i=".5";let n=[],r,a=[],o=[],s;const l=m=>{if(m){let g;o=o.filter(v=>(v.id===m&&(g=v),v.id!==m)),g&&document.body.removeChild(g)}else{const g=o.pop();g&&document.body.removeChild(g)}},c=()=>{s&&(s.style.opacity=0,s.style.display="none")},u=m=>{const g=o.length;if(m&&e[g]===!1)return;const v=a.pop(),y=n.pop();gc(v)&&v({content:y}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:r,behavior:"instant"}),c(),l()},d=()=>{s=document.createElement("div"),s.className=oxe(),s.id="cmdl-backdrop",s.onclick=()=>u(!0),document.body.appendChild(s)},p=({config:m})=>{r=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${r}px`,s||d(),s.style.display="",(m==null?void 0:m.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},h=({config:m,attr:g,attrs:v,unit:y="em",value:I})=>{var b;let D;return J1(g)?D=q$({element:m,attr:g}):oY(v)&&(D=(b=v.map(w=>q$({element:m,attr:w})).filter(Boolean))==null?void 0:b[0]),D!==void 0&&(I=D),isNaN(I)?I:`${I}${y}`},f=({buttons:m,config:g,modalNumber:v})=>{var y,I;const b=document.createElement("div");b.className=rY(),b.style.padding=h({config:g,attrs:["footer.padding","padding"],value:i});const D={label:((y=g==null?void 0:g.dictionary)==null?void 0:y.close)||"Close",onClick:NR.close,intent:"is-info"};for(const w of m){if(w.hide)continue;const S={...D};IL(w)&&Object.assign(S,w);const U=document.createElement("button");S.disabled!==void 0&&(U.disabled=S.disabled),S.id&&(U.id=S.id),U.className=((I=S==null?void 0:S.footer)==null?void 0:I.className)||"button font-medium",U.classList.add(S.intent),U.style="margin-right: .5em;",U.innerHTML=S.label||S.text,U.onclick=C=>{C.stopPropagation(),gc(S.onClick)&&(U.classList.add("is-loading"),S.onClick({e:C,content:n[v]})),S.close!==!1&&(gc(S.close)&&S.close(),NR.close())},b.appendChild(U)}return b};return{close:u,open:({title:m="",content:g,buttons:v,footer:y,config:I,onClose:b}={})=>{p({config:I}),a.push(b);const D=o.length+1;e[D]=I==null?void 0:I.clickAway;const w=document.createElement("section"),S=`cmdl-${D}`;w.className=sxe(),w.role="dialog",w.tabIndex=-1,w.id=S;const U=document.createElement("div");U.className=cxe(),U.style.maxWidth=`${(I==null?void 0:I.maxWidth)||450}px`,U.onclick=()=>u(!0);const C=document.createElement("div");C.className=uxe(),C.onclick=x=>x.stopPropagation();const E=document.createElement("div"),P=document.createElement("div");E.appendChild(P),C.appendChild(E);const M=({title:x,config:F})=>{E.className=x?dxe():"",E.style.padding=h({config:F,attrs:["title.padding","padding"],value:i}),P.className=x?pxe():"",P.innerHTML=x};m&&M({title:m});const N=document.createElement("div");C.appendChild(N);const R=({content:x,config:F})=>{N.style.fontSize=h({config:F,attr:"fontSize",value:"15px"}),N.style.position="relative",N.style.padding=h({config:F,attrs:["content.padding","padding"],value:i}),gc(x)?n[D]=x(N):IL(x)?N.appendChild(x):J1(x)?N.innerHTML=x:N.innerHTML=aY};if(R({content:g,config:I}),oY(v))y=f({buttons:v,config:I,modalNumber:D}),C.appendChild(y);else if(y){const x=document.createElement("div");x.className=rY(),x.style.padding=h({config:I,attrs:["footer.padding","padding"]}),IL(y)?x.appendChild(y):J1(y)?x.innerHTML=y:x.innerHTML=aY,C.appendChild(x)}U.appendChild(C),w.appendChild(U),document.body.appendChild(w),o.push(w);const A=({content:x,config:F})=>{n[D]=void 0,hxe(N),R({content:x,config:F})},_=({buttons:x,config:F})=>{C.removeChild(y),y=f({buttons:x,config:F,modalNumber:D}),C.appendChild(y)},O=({onClose:x})=>{a.length=0,a.push(x)};return{setContent:A,setButtons:_,update:({content:x,buttons:F,title:$,config:V,onClose:G})=>{I=V||I,x&&A({content:x,config:I}),F&&_({buttons:F,config:I}),G&&O({onClose:G}),$&&M({title:$,config:I})}}}}})();function q$({element:t,attr:e}){if(!J1(e))return;const i=e.split(".");for(const n of i)if(t=t==null?void 0:t[n],!t)return;return t}function fxe({individualParticipant:t,attribute:e,className:i}){const n=t==null?void 0:t.person,r=q$({element:n,attr:e});if(!r)return;const a=document.createElement("div");return a.className=Tg(IW(),i),a.innerHTML=r,a}function mxe({individualParticipant:t,className:e}){var i;const n=(i=t==null?void 0:t.teams)==null?void 0:i[0],r=(n==null?void 0:n.participantName)||" ",a=document.createElement("div");return a.className=Tg(IW(),e),a.classList.add("tmx-tm"),a.setAttribute("id",n==null?void 0:n.participantId),a.innerHTML=r,a}function gxe(t){var e,i,n,r;const a=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;if(((r=(n=t==null?void 0:t.composition)==null?void 0:n.configuration)==null?void 0:r.showAddress)??a==="ADDRESS")return axe(t);if(a==="TEAM")return mxe(t);if(a){const o=fxe({...t,attribute:a});if(o)return o}return document.createElement("div")}const vxe=Di({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function yxe({className:t,composition:e,side:i}){const n=(i==null?void 0:i.seedValue)||(i==null?void 0:i.seedNumber);if(!n)return"";const r=(e==null?void 0:e.configuration)||{},{bracketedSeeds:a}=r,o=typeof a=="boolean"&&["(",")"]||a==="square"&&["[","]"]||["",""],s=`${o[0]}${n}${o[1]}`,l=r.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t,c.innerHTML=s,c}const Ixe=Di({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function bxe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r}){var a,o,s,l,c,u,d;const p=e==null?void 0:e.configuration,h=((a=p==null?void 0:p.scaleAttributes)==null?void 0:a.eventType)||(n==null?void 0:n.matchUpType)||"SINGLES",f=t==null?void 0:t.rankings,m=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,I=g==null?void 0:g.accessor,b=v==="RATING"?m:f,D=(s=(o=b==null?void 0:b.SINGLES)==null?void 0:o.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,w=(c=(l=b==null?void 0:b.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:c.scaleValue,S=D&&I?D[I]:D||"",U=w&&I?w[I]:w||"",C=h==="SINGLES"?S:U,E=(u=p==null?void 0:p.scaleAttributes)==null?void 0:u.fallback,P=!r&&(C||E&&(S||U)),M=document.createElement("span");return P&&(M.className=Tg(i,Ixe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),M.innerHTML=P||"",M}var wxe=Object.defineProperty,Ht=(t,e)=>{for(var i in e)wxe(t,i,{get:e[i],enumerable:!0})};function sk(){return"2.0.28"}var yce={};Ht(yce,{competitionGovernor:()=>Ice,drawsGovernor:()=>hde,entriesGovernor:()=>yge,eventGovernor:()=>Dge,generationGovernor:()=>Bge,matchUpFormatGovernor:()=>Yge,matchUpGovernor:()=>Zge,mocksGovernor:()=>u5,participantGovernor:()=>zve,policyGovernor:()=>Wme,publishingGovernor:()=>hye,queryGovernor:()=>Xme,reportGovernor:()=>bye,scheduleGovernor:()=>wye,scoreGovernor:()=>Qq,tieFormatGovernor:()=>_ye,tournamentGovernor:()=>jye,venueGovernor:()=>Jye});var Ice={};Ht(Ice,{getLinkedTournamentIds:()=>XP,getTournamentIds:()=>YP,linkTournaments:()=>cde,mutate:()=>bce,query:()=>pde,unlinkTournament:()=>dde,unlinkTournaments:()=>ude});var bce={};Ht(bce,{linkTournaments:()=>cde,unlinkTournament:()=>dde,unlinkTournaments:()=>ude});var Sxe={};Ht(Sxe,{addNotice:()=>ti,callListener:()=>aB,createInstanceState:()=>vLe,cycleMutationStatus:()=>JW,deepCopyEnabled:()=>XW,deleteNotice:()=>QW,deleteNotices:()=>zP,disableNotifications:()=>Lue,enableNotifications:()=>iM,getDevContext:()=>qs,getMethods:()=>Bue,getNotices:()=>Vue,getProvider:()=>oB,getTopics:()=>Wl,getTournamentId:()=>iI,getTournamentRecord:()=>e3,getTournamentRecords:()=>nI,globalLog:()=>Hue,handleCaughtError:()=>Sk,removeTournamentRecord:()=>Gue,setDeepCopy:()=>yU,setDevContext:()=>vU,setGlobalLog:()=>xue,setGlobalMethods:()=>Fue,setGlobalSubscriptions:()=>ILe,setMethods:()=>$ue,setStateMethods:()=>zue,setStateProvider:()=>gLe,setSubscriptions:()=>bLe,setTournamentId:()=>IU,setTournamentRecord:()=>jue,setTournamentRecords:()=>wk,timeKeeper:()=>yLe});function ko(t){return typeof t=="function"}function co(t){return typeof t=="string"}function on(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function Txe(t,e){if(!on(t)||!on(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function wce(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(on).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var Uxe=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function K$(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(a=>K$(a))}:{[r]:e?n(t[r]):K$(t[r])}))}function Y$(t){return Array.isArray(t)?t.length+t.map(Y$).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>Y$(t[e])).reduce((e,i)=>e+i,0):0}function Dxe(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=Y$(t),n=e.split("").reduce((r,a)=>r+a.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var re={success:!0},Pxe="error",Cxe={SUCCESS:re,ERROR:Pxe},Z$={message:"Chronological error; time violation.",code:"ANACHRONISM"},Sce={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},X$={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Cn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Ne={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},LP={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},rw={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},Cv={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},tt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},Tce={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},zo={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Qy={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},bW={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},wW={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},aw={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},Uce={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},Dce={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Exe={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},SW={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},FP={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},lk={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},N0={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},A0={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},TW={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},ck={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},UW={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},$P={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Fc={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},Pce={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},Cce={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},Ece={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},Mce={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},Rce={message:"Invalid action",code:"ERR_INVALID_ACTION"},J$={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},Nce={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},Ace={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},_ce={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},DW={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},kce={message:"Existing round",code:"ERR_EXISTING_ROUND"},Mxe={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},Is={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},wn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},PW={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},Mf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},Oce={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Jh={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},_i={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},Wo={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},xce={message:"Event exists",code:"ERR_EXISTING_EVENT"},Lce={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},Fce={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},CW={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},EW={message:"Missing stage",code:"ERR_MISSING_STAGE"},Ug={message:"Invalid stage",code:"ERR_INVALID_STAGE"},$ce={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},Bce={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},Vce={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},Q$={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},BP={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},Q1={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},ow={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},qd={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},MW={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},RW={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},jce={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},VP={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},ua={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},_0={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},wa={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Nd={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Do={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},uo={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},NW={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},uk={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},Rxe={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},Gce={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},AW={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},Hce={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},_W={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},Nxe={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},sw={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},Axe={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},kW={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},_xe={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},dk={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},kxe={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},Oxe={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},eI={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},dt={message:"Missing value",code:"ERR_MISSING_VALUE"},zce={message:"Missing date",code:"ERR_MISSING_DATE"},Wce={message:"No valid dates",code:"ERR_NO_VALID_DATES"},AR={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},eM={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},qce={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ka={message:"Invalid Date",code:"ERR_INVALID_DATE"},ul={message:"Invalid time",code:"ERR_INVALID_TIME"},Kce={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},eB={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},Yce={message:"Invalid score",code:"ERR_INVALID_SCORE"},pk={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},xxe={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},OW={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},Zce={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},hk={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},xW={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},k0={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},hu={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Tl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},Xce={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Mc={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},Jce={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},tI={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},jP={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},vr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Gn={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},Qce={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},Lxe={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},eue={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Rf={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},tue={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},iue={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},nue={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},O0={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},fk={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},LW={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},tB={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},rue={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},Fxe={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},$xe={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},aue={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},oue={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},iB={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},sue={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},FW={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},lue={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},$W={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},lw={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},cue={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},GP={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},uue={message:"Court exists",code:"ERR_EXISTING_COURT"},due={message:"Venue exists",code:"ERR_EXISTING_VENUE"},x0={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Nf={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},pue={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},BW={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},hue={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},fue={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},Bxe={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},VW={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},mue={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},jW={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},GW={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},mk={message:"Missing context",code:"ERR_MISSING_CONTEXT"},gue={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},HP={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},vue={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},L0={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},yue={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},gk={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},Iue={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},bue={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Kp={message:"Invalid object",code:"ERR_INVALID_OBJECT"},tM={message:"Invalid gender",code:"ERR_INVALID_GENDER"},_R={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Ie={message:"Invalid values",code:"ERR_INVALID_VALUES"},wue={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},HW={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Sue={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},vk={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},zW={message:"Value unchanged",code:"ABORT_UNCHANGED"},Sa={message:"Not found",code:"ERR_NOT_FOUND"},yk={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},Tue={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},WW={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Uue={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},Due={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},nB={message:"Existing stage",code:"ERR_EXISTING_STAGE"},qW={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},Ik={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},Pue={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},bk={message:"Scores present",code:"ERR_SCORES_PRESENT"},Vxe={ANACHRONISM:Z$,CANNOT_CHANGE_WINNING_SIDE:xW,CANNOT_MODIFY_TIEFORMAT:OW,CANNOT_MODIFY_PARTICIPANT_TYPE:Zce,CANNOT_REMOVE_MAIN_STRUCTURE:Sce,CANNOT_REMOVE_PARTICIPANTS:hk,COURT_EXISTS:uue,COURT_NOT_FOUND:GP,DRAW_DEFINITION_NOT_FOUND:zo,DRAW_ID_EXISTS:Pce,DRAW_POSITION_ACTIVE:lk,DRAW_POSITION_ASSIGNED:aw,DRAW_POSITION_NOT_CLEARED:Dce,DRAW_POSITION_NOT_FOUND:Exe,DRAW_SIZE_MISMATCH:UW,DUPLICATE_VALUE:wue,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:oue,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:aue,EVENT_EXISTS:xce,EVENT_NOT_FOUND:Wo,EXISTING_DRAW_DEFINITIONS:Tce,EXISTING_END_TIME:BW,EXISTING_FLIGHT:Tue,EXISTING_MATCHUP_ID:Due,EXISTING_OUTCOME:Uue,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:O0,EXISTING_PARTICIPANT:fk,EXISTING_POLICY_TYPE:_W,EXISTING_PROFILE:WW,EXISTING_ROUND:kce,EXISTING_STAGE:nB,EXISTING_STRUCTURE:qW,INCOMPATIBLE_MATCHUP_STATUS:Q1,INCOMPLETE_SOURCE_STRUCTURE:bW,INSUFFICIENT_DRAW_POSITIONS:FW,INVALID_ACTION:Rce,INVALID_ASSIGNMENT:J$,INVALID_BOOKINGS:AR,INVALID_CATEGORY:_R,INVALID_COLLECTION_DEFINITION:bue,INVALID_CONFIGURATION:Iue,INVALID_DATE_AVAILABILITY:eM,INVALID_DATE:Ka,INVALID_DRAW_DEFINITION:Cv,INVALID_DRAW_POSITION_FOR_SEEDING:wW,INVALID_DRAW_POSITION:N0,INVALID_DRAW_SIZE:ck,INVALID_END_TIME:pue,INVALID_ENTRIES:Fce,INVALID_EVENT_TYPE:Jh,INVALID_GAME_SCORES:eB,INVALID_GENDER:tM,INVALID_MATCHUP_FORMAT:MW,INVALID_MATCHUP_STATUS:ow,INVALID_MATCHUP_STATUS_BYE:Vce,INVALID_MATCHUP:uo,INVALID_OBJECT:Kp,INVALID_PARTICIPANT_ID:hu,INVALID_PARTICIPANT_IDS:Tl,INVALID_PARTICIPANT_ROLE:Xce,INVALID_PARTICIPANT_SEEDING:Cce,INVALID_PARTICIPANT_TYPE:Mc,INVALID_PARTICIPANT:k0,INVALID_POLICY_DEFINITION:Hce,INVALID_RECORDS:X$,INVALID_SCALE_ITEM:HP,INVALID_SEED_NUMBER:Ace,INVALID_SEED_POSITION:_ce,INVALID_SET_NUMBER:_xe,INVALID_SIDE_NUMBER:kW,INVALID_SCORE:Yce,INVALID_STAGE:Ug,INVALID_START_TIME:fue,INVALID_STRUCTURE:Qy,INVALID_STOP_TIME:hue,INVALID_TIE_FORMAT:qd,INVALID_TIME:ul,INVALID_TIME_ITEM:VW,INVALID_TOURNAMENT_DATES:Kce,INVALID_TOURNAMENT_RECORD:LP,INVALID_VALUES:Ie,INVALID_WINNING_SIDE:pk,MATCHUP_NOT_FOUND:wa,METHOD_NOT_FOUND:Ik,MISSING_ASSIGNMENTS:CW,MISSING_ASYNC_STATE_PROVIDER:mue,MISSING_AVOIDANCE_POLICY:Gce,MISSING_COLLECTION_DEFINITION:jce,MISSING_COURT_ID:eI,MISSING_COURTS_INFO:cue,MISSING_DATE_AVAILABILITY:qce,MISSING_DATE:zce,MISSING_DRAW_DEFINITION:tt,MISSING_DRAW_ID:Fc,MISSING_DRAW_POSITION:A0,MISSING_DRAW_POSITIONS:FP,MISSING_DRAW_SIZE:$P,MISSING_ENTRIES:Lce,MISSING_EVENT:_i,MISSING_MATCHUP_FORMAT:RW,MISSING_MATCHUP_ID:ua,MISSING_MATCHUP_IDS:_0,MISSING_MATCHUP:Do,MISSING_MATCHUPS:Nd,MISSING_PARTICIPANT_COUNT:tue,MISSING_PARTICIPANT_ID:vr,MISSING_PARTICIPANT_IDS:Rf,MISSING_PARTICIPANT_ROLE:Jce,MISSING_PARTICIPANT:tI,MISSING_PARTICIPANTS:jP,MISSING_PENALTY_ID:$W,MISSING_PENALTY_TYPE:lue,MISSING_PERSON_DETAILS:nue,MISSING_POLICY_ATTRIBUTES:AW,MISSING_POLICY_DEFINITION:uk,MISSING_POLICY_TYPE:NW,MISSING_POSITION_ASSIGNMENTS:Bce,MISSING_ROUND_NUMBER:Mxe,MISSING_SCHEDULE:gue,MISSING_SCORING_POLICY:Axe,MISSING_SEED_ASSIGNMENTS:Nce,MISSING_SEEDCOUNT_THRESHOLDS:Mce,MISSING_SEEDING_POLICY:Rxe,MISSING_SET_NUMBER:kxe,MISSING_SET_OBJECT:dk,MISSING_SIDE_NUMBER:Oxe,MISSING_STAGE:EW,MISSING_STRUCTURE_ID:Is,MISSING_STRUCTURE:Mf,MISSING_STRUCTURES:PW,MISSING_TARGET_LINK:DW,MISSING_TIE_FORMAT:VP,MISSING_TIME_ITEM:jW,MISSING_TIME_ITEMS:GW,MISSING_TOURNAMENT_ID:rw,MISSING_TOURNAMENT_RECORD:Ne,MISSING_TOURNAMENT_RECORDS:Cn,MISSING_VALUE:dt,MISSING_VENUE_ID:Nf,MODIFICATIONS_FAILED:vue,NO_CANDIDATES:gk,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:sue,NO_MODIFICATIONS_APPLIED:L0,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:iB,NO_PARTICIPANT_REMOVED:eue,NO_VALID_ACTIONS:Sue,NO_VALID_ATTRIBUTES:vk,NO_VALID_DATES:Wce,NOT_FOUND:Sa,NOT_IMPLEMENTED:yk,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:LW,PARTICIPANT_ID_EXISTS:Qce,PARTICIPANT_NOT_CHECKED_IN:iue,PARTICIPANT_NOT_FOUND:Gn,PARTICIPANT_PAIR_EXISTS:Lxe,PENALTY_NOT_FOUND:lw,POLICY_NOT_ATTACHED:Nxe,POLICY_NOT_FOUND:sw,SCHEDULE_NOT_CLEARED:Uce,SCHEDULED_MATCHUPS:Pue,SCORES_PRESENT:bk,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:Ece,STAGE_SEQUENCE_LIMIT:$ce,STRUCTURE_NOT_FOUND:wn,TEAM_NOT_FOUND:HW,UNABLE_TO_ASSIGN_COURT:yue,UNLINKED_STRUCTURES:Oce,UNRECOGNIZED_DRAW_TYPE:SW,UNRECOGNIZED_MATCHUP_FORMAT:BP,UNRECOGNIZED_MATCHUP_STATUS:Q$,VALUE_UNCHANGED:zW,VENUE_EXISTS:due},mn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},Cue={addNotice:Qxe,callListener:rLe,cycleMutationStatus:Jxe,deleteNotice:iLe,deleteNotices:tLe,disableNotifications:jxe,enableNotifications:Gxe,getMethods:KW,getNotices:eLe,getTopics:nLe,getTournamentId:Eue,getTournamentRecord:Hxe,getTournamentRecords:zxe,removeTournamentRecord:Yxe,setMethods:Xxe,setSubscriptions:Zxe,setTournamentId:qxe,setTournamentRecord:Wxe,setTournamentRecords:Kxe,handleCaughtError:aLe};function jxe(){mn.disableNotifications=!0}function Gxe(){mn.disableNotifications=!1}function Eue(){return mn.tournamentId}function Hxe(t){return mn.tournamentRecords[t]}function zxe(){return mn.tournamentRecords}function Wxe(t){let e=t==null?void 0:t.tournamentId;return e?(mn.tournamentRecords[e]=t,{success:!0}):{error:LP}}function qxe(t){return t?mn.tournamentRecords[t]?(mn.tournamentId=t,{success:!0}):{error:Ne}:(mn.tournamentId=void 0,{success:!0})}function Kxe(t){mn.tournamentRecords=t;let e=Object.keys(t);e.length===1?mn.tournamentId=e[0]:e.length||(mn.tournamentId=void 0)}function Yxe(t){if(typeof t!="string")return{error:Ie};if(!mn.tournamentRecords[t])return{error:Sa};delete mn.tournamentRecords[t];let e=Object.keys(mn.tournamentRecords);return e.length===1?mn.tournamentId=e[0]:e.length||(mn.tournamentId=void 0),{success:!0}}function Zxe(t){return typeof t.subscriptions!="object"?{error:Ie}:(Object.keys(t.subscriptions).forEach(e=>{mn.subscriptions[e]=t.subscriptions[e]}),{...re})}function Xxe(t){return typeof t!="object"?{error:Ie}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(mn.methods[e]=t[e])}),{...re})}function Jxe(){let t=mn.modified;return mn.modified=!1,t}function Qxe({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(mn.disableNotifications||(mn.modified=!0),!(mn.disableNotifications||!mn.subscriptions[t]&&!n)))return i&&(mn.notices=mn.notices.filter(r=>!(r.topic===t&&r.key===i))),mn.notices.push({topic:t,payload:e,key:i}),{...re}}function KW(){return mn.methods??{}}function eLe({topic:t}){return mn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function tLe(){mn.notices=[]}function iLe({topic:t,key:e}){mn.notices=mn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function nLe(){return{topics:Object.keys(mn.subscriptions)}}function rLe({topic:t,notices:e},i){let n=mn.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function aLe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:Eue(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function or(t,e){return(t??0)-(e??0)}function St(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Rc(t){return isNaN(t)?!1:t&&(t&t-1)===0}function sY(t){if(!t.length)return;let e=[...t].sort(or),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function oLe(t){if(!Rc(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function YW(t){return isNaN(t)?0:t%2&&t+1||t}function ZW(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Mn(t){return!isNaN(parseFloat(t))}function Mue(t){let e=St(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function F0(t){if(isNaN(t))return!1;for(;!Rc(t);)t++;return t}function Cs(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function Rt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function sLe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function lLe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function Rue(t,e,i,n,r=2){let a=1-Math.random(),o=1-Math.random(),s=Math.sqrt(-2*Math.log(a))*Math.cos(2*Math.PI*o);return s=s/10+.5,s>1||s<0?s=Rue(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=lLe(s,n)),parseFloat(s.toFixed(r))}function $t(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function cLe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Fa(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function cw(t){return Rt(t)?t:1/0}function qo(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function uLe(t){return Nue(qo(t))}function Nue(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function dLe(t,e,i){return i.indexOf(t)===e}function Aue(t){return t.filter(dLe)}function xo(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function vl(t){let e=Math.floor(Math.random()*t.length);return t[e]}function Xe(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function Jc(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Ln(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function lY(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function Ya(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function pLe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function hLe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function jr(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let a=Math.floor(r/e);return i[a]=[].concat(i[a]||[],n),i},[]):[]}function _ue(t,[e,...i]){return t.length?[t.slice(0,e),..._ue(t.slice(e),[...i,e])]:[]}function fLe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function kue(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function Oue(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function rB(t,e,i){return Array.isArray(t)?t.reduce((n,r,a)=>{let o=i?!!(Math.floor(a/e)%2):!1,s=a%e,l=o?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function mLe(t,e=1){if(!Array.isArray(t)||!t.every(Rt))return[];let i=Math.min(...t,e),n=Math.max(...t);return Xe(i,n+1).filter(r=>!t.includes(r))}var $i={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},Gr=Cue,cY=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function gLe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Ln(Object.keys(t),cY).length!==cY.length)throw new Error("Global state provider is missing required methods");return Gr=t,{success:!0}}function vLe(){if(Gr.createInstanceState){try{Gr.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:mue}}function qs(t){return!t||typeof t!="object"?$i.devContext??!1:typeof $i.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=$i.devContext)==null?void 0:i[e])===t[e]})&&$i.devContext}function yLe(t="reset",e="default"){var i,n;let r=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys($i.timers).filter(a=>a!=="default"||$i.timers[a].startTime).map(a=>{let o=$i.timers[a],s=o.state==="stopped"?0:(r-((o==null?void 0:o.startTime)??0))/1e3,l=o.elapsedTime+s;return{state:$i.timers[a].state,elapsedTime:l.toFixed(2),timer:a}});{let a=$i.timers[e].state==="stopped"?0:(r-(((i=$i.timers[e])==null?void 0:i.startTime)??0))/1e3,o=$i.timers[e].elapsedTime+a;return{state:$i.timers[e].state,elapsedTime:o.toFixed(2),timer:e}}}if(!$i.timers[e]||t==="reset"){if(e==="allTimers")return $i.timers={default:{elapsedTime:0}},!0;$i.timers[e]={startTime:r,state:"active",elapsedTime:0}}return $i.timers[e].elapsedTime||($i.timers[e].elapsedTime=0),t==="stop"&&$i.timers[e].state!=="stopped"&&($i.timers[e].state="stopped")&&($i.timers[e].elapsedTime+=(r-(((n=$i.timers[e])==null?void 0:n.startTime)??0))/1e3),t==="start"&&($i.timers[e].startTime=r)&&($i.timers[e].state="active"),$i.timers[e]}function xue(t){ko(t)?$i.globalLog=t:delete $i.globalLog}function vU(t){$i.devContext=t}function Lue(){Gr.disableNotifications()}function iM(){Gr.enableNotifications()}function yU(t,e){typeof t=="boolean"&&($i.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&($i.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&($i.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&($i.deepCopyAttributes.stringify=e.stringify),e.threshold&&($i.deepCopyAttributes.threshold=e.threshold))}function XW(){return{enabled:$i.deepCopy,...$i.deepCopyAttributes}}function ILe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{$i.globalSubscriptions[e]=t.subscriptions[e]}),{...re}):{error:dt,info:"missing subscriptions"}}function bLe(t){return t!=null&&t.subscriptions?Gr.setSubscriptions({subscriptions:t.subscriptions}):{error:dt,info:"missing subscriptions"}}function Fue(t){return t?typeof t!="object"?{error:Ie}:(Object.keys(t).forEach(e=>{ko(t[e])&&($i.globalMethods[e]=t[e])}),{...re}):{error:dt,info:"missing method declarations"}}function $ue(t){return t?typeof t!="object"?{error:Ie}:Gr.setMethods(t):{error:dt,info:"missing method declarations"}}function JW(){return Gr.cycleMutationStatus()}function ti(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=$i.globalSubscriptions[t.topic];return Gr.addNotice(t,e)}function Bue(){return{...$i.globalMethods,...Gr.getMethods()}}function Vue(t){return Gr.getNotices(t)}function QW({key:t,topic:e}){return Gr.deleteNotice({key:t,topic:e})}function zP(){return Gr.deleteNotices()}function Wl(){return Gr.getTopics()}async function aB(t){return Gr.callListener(t,$i.globalSubscriptions)}function iI(){return Gr.getTournamentId()}function e3(t){return Gr.getTournamentRecord(t)}function nI(){return Gr.getTournamentRecords()}function jue(t){return Gr.setTournamentRecord(t)}function wk(t){return Gr.setTournamentRecords(t)}function IU(t){return Gr.setTournamentId(t)}function Gue(t){return Gr.removeTournamentRecord(t)}function oB(){return Gr}function Sk({engineName:t,methodName:e,params:i,err:n}){return(ko(Gr.handleCaughtError)&&Gr.handleCaughtError||Cue.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function Hue(t,e){if($i.globalLog)try{$i.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),xue()}else console.log(e,t)}function zue(t,e,i,n){if(!on(t))return{error:Ie};Mn||(i=1);let r=Array.isArray(e)?e:[],a={},o=(s,l=0)=>{Object.keys(s).forEach(c=>{ko(s[c])?a[c]=s[c]:on(s[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&o(s[c],l+1)})};return o(t),n?Fue(a):$ue(a),{methods:a}}function wLe(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function ft(t,e,i,n){var r;if(typeof t!="object"||t===null)return t;(r=XW())!=null&&r.enabled||(n=!0);let a=["",void 0,null];e&&a.push(!1);let o=wLe(t,a,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>ft(l))}:{[s]:n?t[s]:ft(t[s])}))}function oe({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,ft(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...re}),e??{success:!0}}var Ta="tournamentRecords",t3="policyDefinitions",Ad="tournamentRecord",$c="drawDefinition",i3="matchUpFormat",yd="participantId",Wue="scheduleDates",SLe="tournamentId",TLe="scheduleDate",n3="structureId",r3="participant",WP="matchUpIds",ULe="policyType",que="structures",Dg="matchUpId",a3="inContext",o3="structure",Tk="courtIds",DLe="personId",Uk="venueIds",Kue="matchUps",Yue="courtId",Zue="eventId",Af="matchUp",Xue="drawId",Ev="error",$0="event",qP="param",PLe="uuids",CLe="averageMatchUpMinutes",ELe="recoveryMinutes",MLe="periodLength",RLe="number",Gd="object",Ao="array",pc="_validate",Jue="_message",Id="_invalid",_f="_ofType",s3="_anyOf",bU="_oneOf",NLe={[Ta]:Cn,[Ad]:Ne,[t3]:uk,[$c]:tt,[yd]:vr,[i3]:RW,[SLe]:rw,[n3]:Is,[WP]:_0,[r3]:tI,[que]:PW,[Dg]:ua,[o3]:Mf,[Yue]:eI,[Kue]:Nd,[Zue]:Wo,[Af]:Do,[Tk]:dt,[Uk]:dt,[Xue]:Fc,[$0]:_i},ALe={[Ta]:Gd,[t3]:Gd,[Ad]:Gd,[$c]:Gd,[Wue]:Ao,[r3]:Gd,[WP]:Ao,[que]:Ao,[o3]:Gd,[Tk]:Ao,[Uk]:Ao,[Kue]:Ao,[Af]:Gd,[$0]:Gd,[PLe]:Ao};function vi(t,e,i){if(!t&&!on(t))return{error:Ie};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Ie};let{paramError:n,errorParam:r}=OLe(t,e);if(!n)return{valid:!0};let a=(t==null?void 0:t[r])===void 0?NLe[r]||Ie:n[pc]&&n[Id]||Ie,o=r??(n[bU]&&Object.keys(n[bU]).join(", "));return oe({info:{param:o,message:n[Jue]},result:{error:a},stack:i})}function Que(t,e){let i=Object.keys(t),n=Object.keys(e);return Ln(i,n)}function _Le(t,e){if(!e)return;let i=Que(t,e);return i.length!==1?{error:Ie}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function kLe(t,e){if(!e)return;let i=Que(t,e).filter(n=>t[n]);return i.length<1?{error:Ie}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function OLe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:a,_anyOf:o,_validate:s,_info:l,...c})=>{let u=a&&_Le(t,a);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=o&&kLe(t,o);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=s&&!ko(s),g=t[f]&&!s&&xLe(t,f,r),v=c[f]&&!t[f],y=m||g||v||s&&t[f]&&!LLe(t[f],s);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function xLe(t,e,i){return i=i||ALe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function LLe(t,e){return ko(e)?e(t):!0}var ede="DYNAMIC",Qh="RANKING",Tm="RATING",ry="SCALE",Qu="SEEDING",FLe={RANKING:Qh,RATING:Tm,SCALE:ry,SEEDING:Qu};function B0(t){var e;let i=vi(t,[{[r3]:!0}]);if(i.error)return i;let n=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:a})=>(a==null?void 0:a.startsWith(ry))&&[Qh,Tm,Qu].includes(a.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(n!=null&&n.length){let a=s=>n.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),o=$t(n.map(({itemType:s})=>s));for(let s of o){let l=a(s);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===Qu&&"seedings"||c===Qh&&"rankings"||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...re,...r}}function ay(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(a,o,s){if(!a||!o)return;let l=Object.keys(a),c=Object.keys(o),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=o[f]||p,g=a[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let I={};return r(y,m,I)!==!1?I:void 0}).filter(Boolean);s[h]=v}else g&&(s[h]={},r(g,m,s[h]));else{let v=a[h];if(Array.isArray(m)&&!m.includes(v))return!1;(o[h]||p&&o[h]!==!1)&&(s[h]=v)}}}}var kR=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,tde=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,bd=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,ym=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function OR(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Lt(t.scheduledTime)),!e)return;let i=rn(t.scheduledTime),n=Lt(e);return n&&i&&(n+=`T${i}`),n}function $Le(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function V0(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||ym.test(rI(t,!0,!0)))}function ls(t){return jm(t)||kR.test(t)}function BLe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return VLe(i,{displaySeconds:!1})}function VLe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+a:n+":"+r).split(":").map(ks).join(":")}var l3=t=>{let e=wU(t)||jm(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${ks(n)}-${ks(e.getUTCDate())}`};function jLe(t){let e=wU(t)||jm(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Sc(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),a=""+n.getDate(),o=n.getFullYear();return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),i==="DMY"?[a,r,o].join(e):i==="MDY"?[r,a,o].join(e):i==="YDM"?[o,a,r].join(e):i==="DYM"?[a,o,r].join(e):i==="MYD"?[r,o,a].join(e):[o,r,a].join(e)}function xR(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function GLe(t){return xR(t).getTime()}function wU(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function uw(t,e){if(!ls(t)||!ls(e))return[];let i=Lt(t)+"T00:00",n=Lt(e)+"T00:00",r=new Date(i),a=new Date(n),o=wU(a)&&wU(r)&&c(r,a),s=[],l=0;if(o){let u=r,d=u.getTime();for(;d<=a.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>Sc(u));function c(u,d){return u<=d}}var HLe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function jm(t){return typeof t!="string"?!1:HLe.test(t)}function c3(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function ri(t){let e=rn(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function zLe(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[ks(e),ks(i)].join(":")}function LR(t){return c3(t)?t.split(":").slice(0,2).map(ks).join(":"):void 0}function rn(t){return jm(t)&&t.indexOf("T")>0?LR(t.split("T").reverse()[0]):LR(t)}function Lt(t){return jm(t)||bd.test(t)?t.split("T")[0]:void 0}function qS(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Lt(i.toISOString())}function FR(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function WLe(t){let e=FR(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(ks).join(":")}function qLe(t){var e;let i=FR(t);if(!(typeof i=="object"&&!Object.keys(i).length))return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),((e=i.hours)==null?void 0:e[0])==="0"&&(i.hours=i.hours.slice(1)),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function rI(t,e,i){let n=Lt(t),r=rn(t),a=n?r:t;return t?e&&(n&&i&&t||WLe(a))||qLe(a):void 0}function ide(t,e){let i=FR(t),n=FR(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function nde(t,e=7){let i=Lt(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Sc(r)}function KLe(t){return nde(t)}function YLe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),a=n?0:1;return r.setDate(r.getDate()+(a-r.getDay())),Sc(r,i)}function ZLe(t,e,i){let n=new Date(t,0);return Sc(new Date(n.setDate(e)),i)}function Jn(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(ks),r=xR(e).setHours(i,n,0,0);return xR(r)}function KP(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function So(t,e){let i=rn(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return rn(u3(Jn(i),n).toISOString())}function u3(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function ks(t){return t.toString()[1]?t:"0"+t}function wd(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var XLe={addDays:nde,addWeek:KLe,addMinutesToTimeString:So,convertTime:rI,getIsoDateString:OR,getUTCdateString:l3,DateHHMM:BLe,extractDate:Lt,extractTime:rn,formatDate:Sc,getDateByWeek:YLe,isISODateString:jm,isDate:wU,isTimeString:c3,offsetDate:xR,offsetTime:GLe,sameDay:wd,timeStringMinutes:ri,timeToDate:Jn,timeUTC:jLe,validTimeValue:V0,validDateString:kR,timeValidation:ym,dateValidation:bd};function ot(t,e,i,n,r=0){if(oB().makeDeepCopy)return oB().makeDeepCopy(t,e,i,n);let a=XW(),{stringify:o,toJSON:s,ignore:l,modulate:c}=a||{};if(!(a!=null&&a.enabled)&&!i||typeof t!="object"||ko(t)||t===null||typeof(a==null?void 0:a.threshold)=="number"&&r>=a.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||ko(l)&&!l(h)),p=(h,f)=>{u[h]=ko(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=ko(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=d3(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(o)&&o.includes(h)?p(h,f):Array.isArray(s)&&s.includes(h)&&ko(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:$Le(f)?u[h]=new Date(f).toISOString():u[h]=ot(f,e,i,n,r+1)}return u}function d3(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var sB="voluntaryConsolation",Jd="competitiveBands",p3="roundRobinTally",Up="positionActions",Or="matchUpActions",nM="rankingPoints",dw="roundNaming",j0="participant",SU="progression",kf="scheduling",TU="avoidance",JLe="display",Sd="scoring",fl="seeding",pw="feedIn",QLe="audit",$R="draws",eFe={POLICY_TYPE_VOLUNTARY_CONSOLATION:sB,POLICY_TYPE_COMPETITIVE_BANDS:Jd,POLICY_TYPE_ROUND_ROBIN_TALLY:p3,POLICY_TYPE_POSITION_ACTIONS:Up,POLICY_TYPE_MATCHUP_ACTIONS:Or,POLICY_TYPE_RANKING_POINTS:nM,POLICY_TYPE_ROUND_NAMING:dw,POLICY_TYPE_PARTICIPANT:j0,POLICY_TYPE_PROGRESSION:SU,POLICY_TYPE_SCHEDULING:kf,POLICY_TYPE_AVOIDANCE:TU,POLICY_TYPE_DISPLAY:JLe,POLICY_TYPE_FEED_IN:pw,POLICY_TYPE_SCORING:Sd,POLICY_TYPE_SEEDING:fl,POLICY_TYPE_AUDIT:QLe,POLICY_TYPE_DRAWS:$R};function ef({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:a}){let o=t.find(l=>n&&l.participantId===n||a&&l.person&&l.person.personId===a),s=ot(o,!1,r);if(s){let l=e==null?void 0:e[j0];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=B0({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return ay({template:l.participant,source:s})}return s}var h3="element required",tFe="missing name";function Va(t){if(!t||typeof t!="object")return{error:dt};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Ie};if(!(t!=null&&t.name))return{error:dt,info:tFe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=Va({element:i,name:t.name});if(n.error)return oe({result:n,stack:"removeExtension"})}return{...re}}return{error:dt,info:h3}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...re}):{...re,info:Sa}}function fu({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function ui(t){if(typeof t!="object")return{error:dt};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return oe({result:{error:Ie},stack:e});if(!fu({extension:t.extension}))return oe({result:{error:Ie,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=ui({extension:t.extension,element:n});if(r.error)return oe({result:r,stack:e})}return{...re}}else return oe({result:{error:dt},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...re}}function f3(t){return!t||typeof t!="object"?{error:dt}:t.tournamentRecord?ui({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Ne}}function Dk(t){return!t||typeof t!="object"?{error:dt}:t.drawDefinition?ui({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:zo}}function Of(t){return!t||typeof t!="object"?{error:dt}:t.event?ui({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:Wo}}function rde(t){var e;if(!t||typeof t!="object")return{error:dt};if(!t.participantId)return{error:vr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ef({participantId:t.participantId,tournamentParticipants:i});return n?ui({creationTime:t.creationTime,extension:t.extension,element:n}):{error:Gn}}function m3(t){return!t||typeof t!="object"?{error:dt}:t.tournamentRecord?Va({element:t.tournamentRecord,name:t.name}):{error:Ne}}function ade(t){return!t||typeof t!="object"?{error:dt}:t.drawDefinition?Va({element:t.drawDefinition,name:t.name}):{error:zo}}function Pk(t){return!t||typeof t!="object"?{error:dt}:t!=null&&t.event?Va({element:t.event,name:t.name}):{error:Wo}}function ode(t){var e;if(!t||typeof t!="object")return{error:dt};if(!t.participantId)return{error:vr};let i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ef({participantId:t.participantId,tournamentParticipants:i});return n?Va({element:n,name:t.name}):{error:Gn}}function YP({tournamentRecords:t}){return{tournamentIds:on(t)?Object.keys(t):[],...re}}var iFe="extensionQueries";function jt({discover:t,element:e,name:i,...n}){var r;if(!e||!i){if(t&&n){let o=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=o&&n[o];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(r=s==null?void 0:s.extensions)==null?void 0:r.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:Sa}}return oe({result:{error:dt},stack:iFe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let a=e.extensions.find(o=>(o==null?void 0:o.name)===i);return{extension:a,info:a?void 0:Sa}}var nFe="activeSuspension",UU="appliedPolicies",BR="positionActions",sde="context",Ck="delegatedOutcome",Tc="disabled",Ek="disableLinks",hw="disableAutoCalc",VR="drawDeletions",rFe="drawProfile",jR="entryProfile",aFe="eventProfile",oFe="eventWithdrawalRequests",sFe="factory",kl="flightProfile",lB="groupingAttribute",Dp="lineUps",oy="linkedTournamentsIds",Mk="matchUpHistory",g3="participantRepresentatives",G0="personRequests",lFe="rankingPoints",Cu="roundTarget",ZP="scheduleLimits",Pp="scheduleTiming",sy="schedulingProfile",cFe="statusDetail",fw="subOrder",tf="tally",ly="tieFormatModification",lde={ACTIVE_SUSPENSION:nFe,APPLIED_POLICIES:UU,AUDIT_POSITION_ACTIONS:BR,CONTEXT:sde,DELEGATED_OUTCOME:Ck,DISABLED:Tc,DISABLE_LINKS:Ek,DISABLE_AUTO_CALC:hw,DRAW_DELETIONS:VR,DRAW_PROFILE:rFe,ENTRY_PROFILE:jR,EVENT_PROFILE:aFe,EVENT_WITHDRAWAL_REQUESTS:oFe,FLIGHT_PROFILE:kl,GROUPING_ATTRIBUTE:lB,LINEUPS:Dp,LINKED_TOURNAMENTS:oy,MATCHUP_HISTORY:Mk,PARTICIPANT_REPRESENTATIVES:g3,PERSON_REQUESTS:G0,RANKING_POINTS:lFe,ROUND_TARGET:Cu,SCHEDULE_LIMITS:ZP,SCHEDULE_TIMING:Pp,SCHEDULING_PROFILE:sy,STATUS_DETAIL:cFe,SUB_ORDER:fw,TALLY:tf,TIE_FORMAT_MODIFICATIONS:ly,FACTORY:sFe},uY=[Ck,Tc,Ek,kl,Dp,Mk,g3,G0,Cu,ZP,Pp,sy,fw,tf];function cde({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let e=YP({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?ui({tournamentRecords:t,discover:!0,extension:{name:oy,value:{tournamentIds:i}}}):{...re}}function ude({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let e=Va({name:oy,tournamentRecords:t,discover:!0});return oe({result:e,stack:"unlinkTournaments"})}function dde({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Ie};if(!e)return{error:rw};let i=YP({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:rw};let r;return n.every(a=>{var o;let s=t[a],{extension:l}=jt({element:s,name:oy});if(!l)return!0;let c=((o=l==null?void 0:l.value)==null?void 0:o.tournamentIds)||[];if(!(c!=null&&c.length)||c.length===1&&c.includes(e)||a===e){let p=m3({name:oy,tournamentRecord:s});return p.error&&(r=p.error),p.success}let u=c.filter(p=>p!==e);l.value={tournamentIds:u};let d=f3({tournamentRecord:s,extension:l});return d.error&&(r=d.error),d.success}),r?{error:r}:{...re}}var pde={};Ht(pde,{getLinkedTournamentIds:()=>XP,getTournamentIds:()=>YP});function XP({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Cn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;let n=t[e],r=n==null?void 0:n.tournamentId,{extension:a}=jt({element:n,name:oy}),o=(((i=a==null?void 0:a.value)==null?void 0:i.tournamentIds)||[]).filter(s=>s!==r);return{[e]:o}}))}}var hde={};Ht(hde,{addAdHocMatchUps:()=>aO,addDrawDefinitionTimeItem:()=>Dq,addFinishingRounds:()=>iC,addGoesTo:()=>Zm,addPlayoffStructures:()=>rO,addQualifyingStructure:()=>fhe,addVoluntaryConsolationStage:()=>phe,addVoluntaryConsolationStructure:()=>pq,allPlayoffPositionsFilled:()=>Sq,alternateDrawPositionAssignment:()=>qpe,assignDrawPosition:()=>Vhe,assignDrawPositionBye:()=>ws,attachConsolationStructures:()=>Lhe,attachPlayoffStructures:()=>Oq,attachQualifyingStructure:()=>Uq,attachStructures:()=>nO,autoSeeding:()=>NGe,automatedPlayoffPositioning:()=>CC,automatedPositioning:()=>PC,checkValidEntries:()=>cO,deleteAdHocMatchUps:()=>Ghe,drawMatic:()=>l4,findDrawDefinition:()=>Bq,generateAdHocMatchUps:()=>uO,generateAdHocRounds:()=>s4,generateAndPopulatePlayoffStructures:()=>kq,generateDrawDefinition:()=>NO,generateDrawMaticRound:()=>Jq,generateDrawStructuresAndLinks:()=>Yq,generateDrawTypeAndModifyDrawDefinition:()=>Zq,generateQualifyingStructure:()=>Cq,generateVoluntaryConsolation:()=>vfe,getAssignedParticipantIds:()=>Og,getAvailableMatchUpsCount:()=>oO,getAvailablePlayoffProfiles:()=>MC,getDrawDefinitionTimeItem:()=>iq,getDrawParticipantRepresentativeIds:()=>Fq,getDrawTypeCoercion:()=>FC,getEligibleVoluntaryConsolationParticipants:()=>Lq,getMatchUpsMap:()=>da,getParticipantIdFinishingPositions:()=>$q,getPositionAssignments:()=>xU,getPositionsPlayedOff:()=>iS,getSeedingThresholds:()=>gq,getSeedsCount:()=>$C,getStructureSeedAssignments:()=>Ks,getTeamLineUp:()=>Ym,getValidGroupSizes:()=>UC,isAdHoc:()=>Yo,isCompletedStructure:()=>sf,isValidForQualifying:()=>Kq,luckyLoserDrawPositionAssignment:()=>Wpe,modifyDrawDefinition:()=>Fhe,modifyDrawName:()=>xq,modifySeedAssignment:()=>ihe,mutate:()=>fde,positionActions:()=>qq,pruneDrawDefinition:()=>Bhe,qualifierDrawPositionAssignment:()=>Qpe,query:()=>Whe,removeDrawPositionAssignment:()=>_U,removeRoundMatchUps:()=>Hhe,removeSeededParticipant:()=>hhe,removeStructure:()=>uhe,renameStructures:()=>che,resetDrawDefinition:()=>$he,resetVoluntaryConsolationStructure:()=>Lde,setDrawParticipantRepresentativeIds:()=>mde,setPositionAssignments:()=>Xpe,setStructureOrder:()=>she,setSubOrder:()=>zhe,shiftAdHocRounds:()=>Zpe,swapAdHocRounds:()=>Jpe,swapDrawPositionAssignments:()=>the,updateTeamLineUp:()=>gI,withdrawParticipantAtDrawPosition:()=>Fpe});var fde={};Ht(fde,{addAdHocMatchUps:()=>aO,addDrawDefinitionTimeItem:()=>Dq,addPlayoffStructures:()=>rO,addQualifyingStructure:()=>fhe,addVoluntaryConsolationStage:()=>phe,addVoluntaryConsolationStructure:()=>pq,alternateDrawPositionAssignment:()=>qpe,assignDrawPosition:()=>Vhe,assignDrawPositionBye:()=>ws,attachConsolationStructures:()=>Lhe,attachPlayoffStructures:()=>Oq,attachQualifyingStructure:()=>Uq,attachStructures:()=>nO,automatedPlayoffPositioning:()=>CC,automatedPositioning:()=>PC,deleteAdHocMatchUps:()=>Ghe,luckyLoserDrawPositionAssignment:()=>Wpe,modifyDrawDefinition:()=>Fhe,modifyDrawName:()=>xq,modifySeedAssignment:()=>ihe,pruneDrawDefinition:()=>Bhe,qualifierDrawPositionAssignment:()=>Qpe,removeDrawPositionAssignment:()=>_U,removeRoundMatchUps:()=>Hhe,removeSeededParticipant:()=>hhe,removeStructure:()=>uhe,renameStructures:()=>che,resetDrawDefinition:()=>$he,resetVoluntaryConsolationStructure:()=>Lde,setDrawParticipantRepresentativeIds:()=>mde,setPositionAssignments:()=>Xpe,setStructureOrder:()=>she,setSubOrder:()=>zhe,shiftAdHocRounds:()=>Zpe,swapAdHocRounds:()=>Jpe,swapDrawPositionAssignments:()=>the,updateTeamLineUp:()=>gI,withdrawParticipantAtDrawPosition:()=>Fpe});var v3=t=>e=>t[e],y3=(t=[])=>t.map(Cr).filter(Boolean),cB=(t=[])=>t.map(Yt).filter(Boolean),Yt=(t={})=>v3(t)("participantId"),Cr=(t={})=>v3(t)("matchUpId"),DU=(t={})=>v3(t)("drawId");function mde({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:zo};if(!Array.isArray(t))return{error:Ie};let i=cB((e==null?void 0:e.entries)||[]);return t.length&&Ln(t,i).length<t.length?{error:Ie}:Dk({drawDefinition:e,extension:{name:g3,value:t}})}var ps="ABANDONED",aI="AWAITING_RESULT",wi="BYE",Yp="CANCELLED",qn="COMPLETED",H0="DEAD_RUBBER",mi="DEFAULTED",fr="DOUBLE_DEFAULT",er="DOUBLE_WALKOVER",ql="IN_PROGRESS",mu="INCOMPLETE",I3="NOT_PLAYED",Na="RETIRED",xf="SUSPENDED",Fn="TO_BE_PLAYED",Ci="WALKOVER",uFe=[aI,qn,mi,ql,mu,Na,xf],gde=[aI,qn,mi,er,fr,ql,mu,Na,xf,Ci],vde=[ps,aI,wi,Yp,qn,H0,mi,er,fr,ql,mu,I3,Na,xf,Fn,Ci],yde=[wi,er,fr,qn,mi,Na,Ci],Ide=[ps,aI,Yp,H0,ql,mu,I3,xf,Fn,void 0],Mr=[Yp,ps,qn,H0,mi,er,fr,Na,Ci],b3=[ps,qn,mi,er,fr,ql,Na,Ci],bde=[ql,mu,xf,Fn],wde={ABANDONED:ps,AWAITING_RESULT:aI,BYE:wi,CANCELLED:Yp,COMPLETED:qn,DEAD_RUBBER:H0,DEFAULTED:mi,DOUBLE_WALKOVER:er,DOUBLE_DEFAULT:fr,IN_PROGRESS:ql,INCOMPLETE:mu,NOT_PLAYED:I3,RETIRED:Na,SUSPENDED:xf,TO_BE_PLAYED:Fn,WALKOVER:Ci},nt="MAIN",gt="QUALIFYING",oa="CONSOLATION",xr="VOLUNTARY_CONSOLATION",Nn="PLAY_OFF",w3=[nt,gt,oa,Nn,xr],cy={[gt]:1,[nt]:2,[Nn]:3,[oa]:3,[xr]:4},Sde="finishingPositions",Tde="aggregateEventStructures",Ude={[nt]:1,[Nn]:2,[oa]:3,[gt]:4,[xr]:5},dFe={[Nn]:1,[nt]:2,[oa]:3,[gt]:4,[xr]:5},Rk="CLUSTER",pFe="SEPARATE",Gm="WATERFALL",Nk="ITEM",eo="CONTAINER",hc="DRAW",Ak="RANDOM",yl="TOP_DOWN",Hm="BOTTOM_UP",Cp="POSITION",Ep="WINNER",Td="LOSER",Ud="FIRST_MATCHUP",Ol="AD_HOC",hFe="AD_HOC",z0="FEED_IN",mw="COMPASS",gw="OLYMPIC",fFe="SINGLE_ELIMINATION",Qc="SINGLE_ELIMINATION",JP="DOUBLE_ELIMINATION",vw="FIRST_MATCH_LOSER_CONSOLATION",QP="FIRST_ROUND_LOSER_CONSOLATION",Pg="LUCKY_DRAW",_k="CURTIS_CONSOLATION",mFe="CURTIS_CONSOLATION",S3="FEED_IN_CHAMPIONSHIP_TO_SF",PU="FEED_IN_CHAMPIONSHIP_TO_SF",T3="FEED_IN_CHAMPIONSHIP_TO_QF",CU="FEED_IN_CHAMPIONSHIP_TO_QF",U3="FEED_IN_CHAMPIONSHIP_TO_R16",EU="FEED_IN_CHAMPIONSHIP_TO_R16",Dde="MODIFIED_FEED_IN_CHAMPIONSHIP",MU="MODIFIED_FEED_IN_CHAMPIONSHIP",eC="FEED_IN_CHAMPIONSHIP",xl="ROUND_ROBIN",Dd="ROUND_ROBIN_WITH_PLAYOFF",Pde="DECIDER",Cde="BACKDRAW",D3={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},P3={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},W0="WIN_RATIO",oI="ROUND_OUTCOME",Ede=[mw,_k,CU,EU,PU,eC,T3,U3,S3,vw,QP,Pg,MU,gw,Nn,Dd],gFe=[Ol,mw,_k,JP,CU,EU,PU,eC,z0,vw,QP,Pg,MU,gw,Nn,xl,Dd,Qc],Mde={MAIN:nt,QUALIFYING:gt,CONSOLATION:oa,ITEM:Nk,CONTAINER:eo,FIRST_MATCHUP:Ud,WINNER:Ep,LOSER:Td,AD_HOC:Ol,FEED_IN:z0,FLEX_ROUNDS:hFe,COMPASS:mw,PLAY_OFF:Nn,OLYMPIC:gw,KNOCKOUT:fFe,SINGLE_ELIMINATION:Qc,DOUBLE_ELIMINATION:JP,CURTIS:_k,FICSF:S3,FICQF:T3,FICR16:U3,MFIC:Dde,VOLUNTARY_CONSOLATION:xr,FIRST_MATCH_LOSER_CONSOLATION:vw,FIRST_ROUND_LOSER_CONSOLATION:QP,MODIFIED_FEED_IN_CHAMPIONSHIP:MU,FEED_IN_CHAMPIONSHIP_TO_R16:EU,FEED_IN_CHAMPIONSHIP_TO_QF:CU,FEED_IN_CHAMPIONSHIP_TO_SF:PU,FEED_IN_CHAMPIONSHIP:eC,LUCKY_DRAW:Pg,ROUND_ROBIN_WITH_PLAYOFF:Dd,ROUND_ROBIN:xl,DECIDER:Pde,BACKDRAW:Cde,COMPASS_ATTRIBUTES:D3,OLYMPIC_ATTRIBUTES:P3,DRAW:hc,RANDOM:Ak,TOP_DOWN:yl,BOTTOM_UP:Hm,WATERFALL:Gm,WIN_RATIO:W0,ROUND_OUTCOME:oI,MULTI_STRUCTURE_DRAWS:Ede,generatedDrawTypes:gFe,stageOrder:cy,finishOrder:Ude,AGGREGATE_EVENT_STRUCTURES:Tde,FINISHING_POSITIONS:Sde},vFe=Mde;function sI(t,e,i){var n,r;let a=h=>{var f,m;return(m=(f=jt({element:h,name:Cu}))==null?void 0:f.extension)==null?void 0:m.value},o=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===Tde&&dFe,l=(i==null?void 0:i.mode)===Sde&&Ude,c=l||s||cy,u=h=>(h==null?void 0:h.stage)===nt&&(h==null?void 0:h.stageSequence)===1,d=h=>u(h)?-1:c[h==null?void 0:h.stage],p=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>Mr.includes(f)?1:-1);return o&&p(t)-p(e)||s&&d(t)-d(e)||((t==null?void 0:t.stage)&&c[t.stage]||0)-((e==null?void 0:e.stage)&&c[e.stage]||0)||(a(t)||0)-(a(e)||0)||!l&&!s&&(((n=e==null?void 0:e.positionAssignments)==null?void 0:n.length)??1/0)-(((r=t==null?void 0:t.positionAssignments)==null?void 0:r.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(GR(t)||0)-(GR(e)||0)}function GR(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;let r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((a,o)=>a+o,0);return!e||r<e?r:e},void 0)}function Dt(t){let e=vi(t,[{[$c]:!0,[n3]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=Pd({drawDefinition:i}),a=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),o=a==null?void 0:a.find(l=>l.structureId===n);if(!o)return{error:wn};let s=o.structureType===Nk?a==null?void 0:a.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:o,containingStructure:s}}function Pd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:a,stages:o,stage:s}){var l;let c=!e&&tt||!(e!=null&&e.structures)&&PW||void 0;if(c)return{error:c,structures:[],stageStructures:{}};let u=m=>{var g,v;let y=(v=(g=jt({element:m,name:Cu}))==null?void 0:g.extension)==null?void 0:v.value;return!r||r===y},d=((l=e==null?void 0:e.structures)==null?void 0:l.filter(h).filter(f).filter(u).sort((m,g)=>sI(m,g,a)))??[],p=t?Object.assign({},...w3.map(m=>{let g=d==null?void 0:d.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:d,stageStructures:p};function h(m){return!s&&!Array.isArray(o)||s&&m.stage===s||Array.isArray(o)&&o.includes(m.stage)}function f(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function Rde({drawDefinition:t}){if(!t)return{error:tt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Vi({structure:i}),a=(r==null?void 0:r.map(Yt).filter(Boolean))??[];return e[n].push(...a),a}).flat(),stagePositionedParticipantIds:e}}function Vi({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:tt};if({structure:i,error:n}=Dt({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(a=>Vi({structure:a}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=Bce,{positionAssignments:r,error:n}}function Rr({drawDefinition:t,structureId:e,structure:i}){var n;let r=((n=Vi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:n.positionAssignments)||[],a=r==null?void 0:r.filter(u=>u.participantId??u.bye??u.qualifier),o=r&&(r==null?void 0:r.length)===(a==null?void 0:a.length),s=r==null?void 0:r.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),l=r==null?void 0:r.filter(u=>!u.participantId&&u.bye),c=r==null?void 0:r.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:o,positionAssignments:r,unassignedPositions:s,assignedPositions:a,qualifierPositions:c,byePositions:l}}var C3="addDrawDefinition",kk="addMatchUps",nf="addParticipants",E3="addScaleItems",M3="addVenue",yw="audit",R3="deleteParticipants",N3="deleteVenue",A3="deletedDrawIds",_3="deletedMatchUpIds",k3="modifyDrawDefinition",Nde="modifyDrawEntries",Ade="modifyEventEntries",O3="modifyMatchUp",sa="modifyParticipants",x3="modifyPositionAssignments",L3="modifySeedAssignments",_de="modifyTournamentDetail",Cg="modifyVenue",uB="mutations",dB="publishEvent",kde="publishEventSeeding",Ode="publishOrderOfPlay",F3="unPublishEvent",$3="unPublishEventSeeding",B3="unPublishOrderOfPlay",Ok="updateInContextMatchUp",yFe={ADD_DRAW_DEFINITION:C3,ADD_MATCHUPS:kk,ADD_PARTICIPANTS:nf,ADD_SCALE_ITEMS:E3,ADD_VENUE:M3,AUDIT:yw,DELETE_PARTICIPANTS:R3,DELETE_VENUE:N3,DELETED_DRAW_IDS:A3,DELETED_MATCHUP_IDS:_3,MODIFY_DRAW_DEFINITION:k3,MODIFY_DRAW_ENTRIES:Nde,MODIFY_EVENT_ENTRIES:Ade,MODIFY_MATCHUP:O3,MODIFY_PARTICIPANTS:sa,MODIFY_POSITION_ASSIGNMENTS:x3,MODIFY_SEED_ASSIGNMENTS:L3,MODIFY_TOURNAMENT_DETAIL:_de,MODIFY_VENUE:Cg,MUTATIONS:uB,PUBLISH_EVENT_SEEDING:kde,PUBLISH_EVENT:dB,PUBLISH_ORDER_OF_PLAY:Ode,UNPUBLISH_EVENT_SEEDING:$3,UNPUBLISH_EVENT:F3,UNPUBLISH_ORDER_OF_PLAY:B3,UPDATE_INCONTEXT_MATCHUP:Ok};function xk(t,e){var i;if(!t)return{error:tt};let n=Date.now();t.updatedAt&&n===new Date(t.updatedAt).getTime()&&(n+=1);let r=new Date(n).toISOString(),a=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(i=t.structures)==null||i.filter(Boolean).forEach(o=>{(!(a!=null&&a.length)||a!=null&&a.includes(o.structureId))&&(o.updatedAt=r)}),{...re}}function rf({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&xk(t),ti({payload:{matchUps:i,tournamentId:e,eventId:n},topic:kk}),{...re}}function Zp({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&xk(t),ti({topic:_3,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let a of i)QW({key:a});return{...re}}function si({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:a}){return a?(t&&Ji({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),ti({topic:O3,payload:{matchUp:a,tournamentId:e,context:n},key:a.matchUpId}),{...re}):(console.log(Do),{error:Do})}function IFe({tournamentId:t,inContextMatchUp:e}){return e?(ti({payload:{inContextMatchUp:e,tournamentId:t},topic:Ok,key:e.matchUpId}),{...re}):{error:Do}}function tC({tournamentId:t,eventId:e,drawDefinition:i}){return i?(xk(i),ti({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:C3,key:i.drawId}),{...re}):(console.log(tt),{error:tt})}function bFe({tournamentId:t,eventId:e,drawId:i}){return ti({payload:{drawId:i,tournamentId:t,eventId:e},topic:A3,key:i}),QW({key:i}),{...re}}function Ji({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(xk(t,i),ti({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:k3,key:t.drawId}),{...re}):{error:tt}}function xde({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:tt};if(!i)return{error:Mf};let r=i.seedAssignments,a=i.structureId,o=t.drawId;return ti({payload:{tournamentId:e,eventId:n,drawId:o,structureId:a,seedAssignments:r},topic:L3,key:t.drawId}),Ji({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:n}),{...re}}function af({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:tt};if(!i)return{error:Mf};let r=Vi({structure:i}),a=i.structureId,o=t.drawId,s=n==null?void 0:n.eventId;return ti({topic:x3,payload:{positionAssignments:r,tournamentId:e,structureId:a,eventId:s,drawId:o},key:a}),Ji({structureIds:[a],drawDefinition:t,tournamentId:e,eventId:s}),{...re}}function Lde({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var r,a;if(!e)return{error:tt};let o=(r=e.structures)==null?void 0:r.find(l=>l.stage===xr);if(!o)return{error:wn};let s=((a=o.matchUps)==null?void 0:a.map(({matchUpId:l})=>l))||[];return o.positionAssignments=[],o.seedAssignments=[],o.matchUps=[],Zp({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==xr)),Ji({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[o.structureId]}),{...re}}function V3({drawPositions:t,structure:e}){var i;if([gt,nt].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:n}=Vi({structure:e});(i=n==null?void 0:n.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||i.forEach(r=>{ui({element:r,extension:{name:Ek,value:!0}})})}function Lk({drawDefinition:t,positionAction:e}){var i;let{extension:n}=jt({name:BR,element:t}),r=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(r!=null&&r.length)){let o=t.structures.find(s=>s.stage===nt);if(o){let s=(i=Vi({structure:o}).positionAssignments)==null?void 0:i.map(({drawPosition:l,participantId:c,bye:u,qualifier:d})=>({drawPosition:l,participantId:c,qualifier:d,bye:u}));r.push({name:"initialMainAssignments",initialAssignments:s})}}let a={name:BR,value:r.concat(e)};ui({element:t,extension:a})}function q0({tournamentRecord:t,drawDefinition:e,event:i}){var n;let r=((n=(t==null?void 0:t.events)||i&&[i])==null?void 0:n.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],a={},o={},s=r.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of s){let{structures:c,structureId:u}=l??{};c&&u&&(a[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:a,containerStructures:o}}var Mv="SINGLES",Un="SINGLES",zm="DOUBLES",qi="DOUBLES",gu="TEAM",Yi="TEAM",wFe={SINGLES_MATCHUP:Mv,SINGLES:Un,DOUBLES_MATCHUP:zm,DOUBLES:qi,TEAM_MATCHUP:gu,TEAM:Yi};function Fk(t){var e;let{sides:i,matchUpType:n}=t||{},r=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(o=>n===qi?(o==null?void 0:o.individualParticipantIds)||[]:o.participantId).flat():[],a=(i||[]).map(o=>{var s;return n===qi&&(((s=o==null?void 0:o.participant)==null?void 0:s.individualParticipantIds)||[])||(o==null?void 0:o.participantId)&&[o.participantId]||[]}).flat();return{individualParticipantIds:a.concat(r).flat(),enteredIndividualParticipantIds:a,potentialIndividualParticipantIds:r}}function Eu(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}function $k(t){if(!on(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(a=>Rt(a)||a===void 0||a===null);return n&&r}function el(t){return Array.isArray(t)?t.every($k):!1}function Za({matchUps:t=[],interpolate:e}){var i;if(!el(t))return{roundMatchUps:[],error:Ie};let n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?St(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(or).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===Yi)?h.filter(({matchUpType:g})=>g===Yi):h,m=g=>g.sort((v,y)=>or(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),r=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?St(h.roundNumber):h.roundNumber;return p[f]||(p[f]=ft({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),a=Object.assign({},...n);if(e){let p=Math.max(...Object.keys(a).map(f=>St(f)).filter(f=>!isNaN(f))),h=(i=a[p])==null?void 0:i.length;if(h>1&&Rc(h)){let f=p+1,m=f+h/2;Xe(f,m).forEach((g,v)=>{a[g]=Xe(0,h/(2+v*2)).map(()=>({}))})}}let o=0,s=Object.assign({},...Object.keys(a).map(p=>{var h,f,m;let g=(h=a[p])==null?void 0:h.length,v=(m=(f=a[p])==null?void 0:f.filter(I=>{var b;return!Mr.includes(I.matchUpStatus)&&!((b=I.score)!=null&&b.scoreStringSide1)}))==null?void 0:m.length,y=g&&g===v;return o=Math.max(o,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}})),l=0,c=0,u=Object.keys(a).map(p=>St(p)).filter(p=>!isNaN(p));u.forEach(p=>{var h,f,m,g,v;let y=a[p].sort((b,D)=>b.roundPosition-D.roundPosition),I=y.map(b=>(b==null?void 0:b.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?o/s[p].matchUpsCount:1,s[p].finishingRound=(h=r[p])==null?void 0:h.finishingRound,s[p].roundName=(f=r[p])==null?void 0:f.roundName,s[p].abbreviatedRoundName=(m=r[p])==null?void 0:m.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=a[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p===1||!s[p-1]){let b=I.sort(or),D=jr(b,2);s[p].drawPositions=b,s[p].pairedDrawPositions=D}else{let b=s[p-1],D=b.drawPositions,w=b.matchUpsCount/s[p].matchUpsCount,S=jr(D,w),U=y.map(C=>{let{roundPosition:E}=C,P=[...C.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return P;let M=(P==null?void 0:P.filter(Boolean))||[];if(!(M!=null&&M.length))return[void 0,void 0];if(p<3&&(M==null?void 0:M.length)===2)return P==null?void 0:P.slice().sort(or);let N=Ln(D,M).length!==(M==null?void 0:M.length);if(M!=null&&M.length&&N)return(M==null?void 0:M.length)===1?[M[0],void 0]:P==null?void 0:P.slice().sort(or);let R=(E-1)*2;return S.slice(R,R+2).map(A=>M==null?void 0:M.find(_=>A.includes(_)))});s[p].drawPositions=U==null?void 0:U.flat(),s[p].pairedDrawPositions=U}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=c,s[p].preFeedRound=!0,c+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});let d=!!Object.values(s).find(({matchUpsCount:p})=>!Rc(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:o,roundMatchUps:a,roundNumbers:u,roundProfile:s,...re}}function Rv({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=ot(t),n=e.split("."),r=[],a;s({targetElement:i,attributes:n});let o={value:a};return r.length&&(o.values=r),o;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>s({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(a||(a=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;a?r.includes(f)||r.push(f):(a=f,r.push(f))}}}}var Fde=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=Rv({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=Rv({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&Rv({element:e,accessor:t}))==null?void 0:i.value)},Ko=Fde;function iC({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:a,lucky:o,fmlc:s}){var l;if(!el(a))return[];let{roundProfile:c,roundNumbers:u=[]}=Za({interpolate:!0,matchUps:a});n=n??Math.max(...u,0);let d=r?n-r:0,p=d&&((l=c==null?void 0:c[n-d])==null?void 0:l.matchUpsCount),h=c&&Object.values(c).map(Ko("matchUpsCount")),f=(v,y)=>{let I=Math.min(...v);p&&y&&I===1&&(I=p);let b=Math.max(...v);return e&&b>e&&(b=e),[I,b]},m=c&&Object.assign({},...u.map(v=>{let y=(n??0)+1-v-d,I=c[v].matchUpsCount,b={finishingPositionRange:{},finishingRound:y},D=h==null?void 0:h.slice(v-1).reduce((N,R)=>N+(R||0),0),w=s&&v!==1,S=1+t+(w?i??0:0),U=1,C=Xe(S,o?S+I*2:D+S+U),E=D+U-I,P=f(C.slice(E)),M=f(C.slice(0,E),!0);return b.finishingPositionRange={loser:P,winner:M},{[v]:b}})),g=qs({finishingRound:!0});return a.filter(Boolean).forEach(v=>{let y=v.roundNumber&&m[v.roundNumber];g&&!y&&console.log({roundFinishingData:m,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),a}function da({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:a,matchUps:o,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[a]||(i[a]={itemStructureIds:[],matchUps:[]}),i[a].itemStructureIds||(i[a].itemStructureIds=[]),i[a].itemStructureIds.push(c.structureId)});else{let c=o;i[a]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function Wm({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],a=((r==null?void 0:r.itemStructureIds)||[]).map(o=>{let{matchUps:s,structureName:l}=t[o];return n?s.map(c=>Object.assign(ot(c,!0,!0),{containerStructureId:i,structureId:o,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...a)}var nC="SIGN_IN_STATUS",$de="SIGNED_OUT",RU="SIGNED_IN",Vs="TEAM",Zt="INDIVIDUAL",bs="GROUP",Ot="PAIR",Gi="TEAM",mT={TEAM_PARTICIPANT:Vs,INDIVIDUAL:Zt,GROUP:bs,TEAM:Gi,PAIR:Ot},SFe={INDIVIDUAL:Zt,GROUP:bs,PAIR:Ot,TEAM:Gi,SIGN_IN_STATUS:nC,SIGNED_OUT:$de,SIGNED_IN:RU};function j3({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?ot(e,t==null?void 0:t.convertExtensions,!0):e,a=r.filter(l=>l.participantType===Gi),o=r.filter(l=>l.participantType===bs),s=r.filter(l=>l.participantType===Ot);return r.forEach(l=>{if(l.participantType===Zt){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function G3({drawDefinition:t,attributes:e}){let{extension:i}=jt({element:t,name:jR}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(a=>{n[a]?Object.assign(n[a],r[a]):n[a]=r[a]})}),i={name:jR,value:n},Dk({drawDefinition:t,extension:i}),{entryProfile:n}}function rC({drawDefinition:t}){let{extension:e}=jt({element:t,name:jR});return{entryProfile:(e==null?void 0:e.value)||{}}}var Ul="ALTERNATE",aC="CONFIRMED",hs="DIRECT_ACCEPTANCE",oC="FEED_IN",sC="JUNIOR_EXEMPT",Mp="LUCKY_LOSER",lC="ORGANISER_ACCEPTANCE",cC="QUALIFIER",TFe="REGISTERED",uC="SPECIAL_EXEMPT",Kl="UNGROUPED",Eg="UNPAIRED",Iw="WILDCARD",Rp="WITHDRAWN",rM=[aC,hs,sC,lC,uC],Bde=[oC,Mp,cC],Mg=[aC,hs,oC,sC,lC,uC,Iw],Yl=[aC,hs,sC,Mp,cC,lC,uC,Iw],Vde=[Ul,aC,hs,oC,sC,Mp,lC,cC,TFe,uC,Kl,Eg,Iw,Rp],UFe={ALTERNATE:Ul,CONFIRMED:aC,DIRECT_ACCEPTANCE:hs,DIRECT_ENTRY_STATUSES:Mg,DRAW_SPECIFIC_STATUSES:Bde,EQUIVALENT_ACCEPTANCE_STATUSES:rM,FEED_IN:oC,JUNIOR_EXEMPT:sC,LUCKY_LOSER:Mp,ORGANISER_ACCEPTANCE:lC,QUALIFIER:cC,SPECIAL_EXEMPT:uC,STRUCTURE_SELECTED_STATUSES:Yl,UNGROUPED:Kl,UNPAIRED:Eg,VALID_ENTRY_STATUSES:Vde,WILDCARD:Iw,WITHDRAWN:Rp};function H3({stage:t,drawDefinition:e}){let{entryProfile:i}=rC({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&w3.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return G3({drawDefinition:e,attributes:r}),!0}return n}function DFe({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=rC({drawDefinition:e});return((i=n[t])==null?void 0:i.alternates)||0}function PFe({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=rC({drawDefinition:e});return((i=n[t])==null?void 0:i.wildcardsCount)||0}function pB({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function lI({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:a,roundTarget:o,stages:s,stage:l}){var c;let u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var h,f;let m=(f=(h=jt({name:Cu,element:p}))==null?void 0:h.extension)==null?void 0:f.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!r||p.entryStatus&&r.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!n||y===n)&&v&&(!o||!m||o===m)?d.concat(p):d},[]))??[];if(a&&l===Nn){let{playoffEntries:d,error:p}=CFe({provisionalPositioning:t,drawDefinition:i,structureId:a});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(h=>!e||h.placementGroup===e)}return u}function CFe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(a=>a.linkType===Cp&&a.target.structureId===i);if(r){let{finishingPositions:a,structureId:o}=r.source,{structure:s}=Dt({drawDefinition:e,structureId:o});(s==null?void 0:s.structureType)===eo&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var g;let{participantId:v}=m,y=(g=jt({element:m,name:tf}).extension)==null?void 0:g.value;return y&&v?{[v]:y}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return a==null?void 0:a.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:I}=g,b=v||t&&y,D=[...a??[]].sort(or).indexOf(b)+1;n.push({entryStage:Nn,entryStatus:oC,placementGroup:D,groupingValue:d,participantId:m,GEMscore:I})})})}return{playoffEntries:n}}function EFe({stage:t,drawDefinition:e}){return Mg.reduce((i,n)=>(pB({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function Ks({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var a;let o,s=[];r||({structure:r,error:o}=Dt({drawDefinition:i,structureId:n}));let l=Vi({structure:r}).positionAssignments;if(o||!r)return{seedAssignments:[],error:wn};n||(n=r.structureId);let{stage:c,stageSequence:u}=r,d=c===Nn&&i&&lI({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:n,stage:c}),p=d?d.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],h=p==null?void 0:p.slice(0,e?p.length:l.length/2);h.length?s=h:r.seedAssignments?s=r.seedAssignments:o=Nce;let f=r.seedLimit??((a=r==null?void 0:r.positionAssignments)==null?void 0:a.length);return{seedAssignments:s,stageSequence:u,seedLimit:f,stage:c,error:o}}var jde="WALKOVER",dY="RETIRED",z3="COMPETITIVE",NU="ROUTINE",AU="DECISIVE",aM="winRatio",MFe=(t,e)=>(t||0)+(e||0);function Gde(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&jde||i<=e[AU]&&AU||i<=e[NU]&&NU||z3}function Hde({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,a)=>(r[0]+=a.side1Score||0,r[1]+=a.side2Score||0,r),[0,0]),n=e.reduce((r,a)=>(r[0]+=a.side1TiebreakScore||0,r[1]+=a.side2TiebreakScore||0,r),[0,0]);return n.reduce(MFe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function RFe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function zde(t){return t.map(RFe).sort().map(e=>parseFloat(e.toFixed(2)))}function Mi({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:a}){if(!Array.isArray(e))return{error:NW};let o={};return i&&s(i),a&&s(a),n&&s(n),r&&s(r),{appliedPolicies:o,...re};function s(l){var c,u;let d=(u=(c=l==null?void 0:l.extensions)==null?void 0:c.find(p=>p.name===UU))==null?void 0:u.value;if(d)for(let p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(o[p]=ot(d[p],!1,!0))}}function Xp({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:NW};let{appliedPolicies:a}=Mi({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),o={};for(let s of t){let l=a==null?void 0:a[s];l&&(o[s]=l)}return Object.keys(o).length?{policyDefinitions:o}:{info:sw.message}}function Rg({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:Ne};let{appliedPolicies:a}=Mi({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return a!=null&&a[i]?{policy:a[i]}:{info:sw==null?void 0:sw.message}}var NFe={[Jd]:{policyName:"Competitive Bands Default",profileBands:{[AU]:20,[NU]:50}}},W3=NFe;function dC({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Do};let{score:n,winningSide:r}=i;if(!r)return{error:Ie};let a=!e&&t&&Rg({policyType:Jd,tournamentRecord:t}).policy,o=e||(a==null?void 0:a.profileBands)||W3[Jd].profileBands,s=Hde({score:n}),l=zde([s]),c=Gde(l,o),u=Array.isArray(l)?l[0]:l;return{...re,competitiveness:c,pctSpread:u}}function Wde({matchUp:t}){var e,i,n;if(!t)return{error:Do};if(t&&!t.sides)return{error:uo};if(t&&!t.hasContext)return{error:mk};let r=(e=t.sides??[])==null?void 0:e.map(c=>c==null?void 0:c.participantId).filter(Boolean),a=((i=t.sides)==null?void 0:i.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===Zt}).map(c=>c.participantId).filter(Boolean))??[],o=(((n=t.sides??[])==null?void 0:n.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),s=[...a,...o.flat()].filter(Boolean)??[],l=$t(s.concat(r)).filter(Boolean)??[];return{nestedIndividualParticipantIds:o,allRelevantParticipantIds:l,individualParticipantIds:s,sideParticipantIds:r,...re}}var HR="CHECK_IN",zR="CHECK_OUT",AFe="SCHEDULE",K0="SCHEDULE.ASSIGNMENT.VENUE",Np="SCHEDULE.ALLOCATION.COURTS",qm="SCHEDULE.ASSIGNMENT.COURT",q3="SCHEDULE.COURT.ORDER",Y0="SCHEDULE.DATE",_Fe="COMPLETED.DATE",qde="SCHEDULE.ASSIGN.OFFICIAL",Z0="SCHEDULE.TIME.SCHEDULED",fc="SCHEDULE.TIME.START",ap="SCHEDULE.TIME.STOP",ed="SCHEDULE.TIME.RESUME",Ap="SCHEDULE.TIME.END",K3="SCHEDULE.TIME.MODIFIERS",Kde="TO_BE_ANNOUNCED",Yde="NEXT_AVAILABLE",Zde="FOLLOWED_BY",Xde="AFTER_REST",Jde="RAIN_DELAY",kFe="NOT_BEFORE",hB=[Kde,Yde,Zde,Xde,Jde],OFe="ELIGIBILITY",xFe="REGISTRATION",LFe="SUSPENSION",FFe="MEDICAL",$Fe="PENALTY",Qde="SCALE",epe="RATING",tpe="RANKING",Y3="SEEDING",Ng="PUBLISH",Zl="PUBLIC",Ag="STATUS",BFe="MODIFICATION",VFe="RETRIEVAL",jFe="other",GFe={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:hB,AFTER_REST:Xde,ALLOCATE_COURTS:Np,ASSIGN_COURT:qm,ASSIGN_OFFICIAL:qde,ASSIGN_VENUE:K0,CHECK_IN:HR,CHECK_OUT:zR,COMPLETED_DATE:_Fe,COURT_ORDER:q3,ELIGIBILITY:OFe,END_TIME:Ap,FOLLOWED_BY:Zde,MEDICAL:FFe,MODIFICATION:BFe,NEXT_AVAILABLE:Yde,NOT_BEFORE:kFe,OTHER:jFe,PENALTY:$Fe,PUBLIC:Zl,PUBLISH:Ng,RANKING:tpe,RATING:epe,RAIN_DELAY:Jde,REGISTRATION:xFe,RESUME_TIME:ed,RETRIEVAL:VFe,SCALE:Qde,SCHEDULE:AFe,SCHEDULED_DATE:Y0,SCHEDULED_TIME:Z0,SEEDING:Y3,START_TIME:fc,STATUS:Ag,STOP_TIME:ap,SUSPENSION:LFe,TIME_MODIFIERS:K3,TO_BE_ANNOUNCED:Kde};function cI({matchUp:t}){if(!t)return{error:Do};if(!t.hasContext)return{error:mk};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:uo};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Wde({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[HR,zR].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),a=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===HR);e==null||e.forEach((s,l)=>{let c=n==null?void 0:n[l],u=(s==null?void 0:s.length)&&s.every(d=>a.includes(d));c&&u&&!a.includes(c)&&a.push(c)}),n==null||n.forEach((s,l)=>{a.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!a.includes(c)&&a.push(c)})});let o=n==null?void 0:n.reduce((s,l)=>a.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:o,checkedInParticipantIds:a,...re}}var ipe={[Un]:[Un,"S"],[qi]:[qi,"D"],[Yi]:[Yi,"T"],S:[Un,"S"],D:[qi,"D"],T:[Yi,"T"]},_n=t=>e=>{let i=on(e)&&(e==null?void 0:e.matchUpType)||co(e)&&e;return i&&ipe[t].includes(i)};function gT(t){var e;let{matchUpAverageTimes:i,matchUpFormat:n}=t||{},r=(i==null?void 0:i.map(({matchUpFormatCodes:o})=>o==null?void 0:o.filter(s=>s===n)).flat().filter(Boolean).sort((o,s)=>((o==null?void 0:o.length)||0)-((s==null?void 0:s.length)||0)))||[],a=r.includes(n)?n:r[0];return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:s})=>(o==null?void 0:o.find(l=>a===l))&&s))==null?void 0:e.averageTimes}function vT(t){var e;let{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:a,averageTimes:o,recoveryTimes:s})=>{if(o&&n){let{greaterThan:l=0,lessThan:c=360}=o;if(n>l&&n<c)return!0}return(a==null?void 0:a.find(l=>l===r))&&s}))==null?void 0:e.recoveryTimes}function npe({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,a)=>{var o,s;return(((o=a.categoryNames)==null?void 0:o.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:a})=>!(a!=null&&a.length)&&!(r!=null&&r.length)||(a==null?void 0:a.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function HFe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:a,categoryType:o,policy:s}){var l;let c=(e==null?void 0:e.matchUpRecoveryTimes)&&vT({...e,averageMinutes:i,matchUpFormat:r}),u=(t==null?void 0:t.matchUpRecoveryTimes)&&vT({...t,averageMinutes:i,matchUpFormat:r}),d=(s==null?void 0:s.matchUpRecoveryTimes)&&vT({...s,averageMinutes:i,matchUpFormat:r}),p=[c,u,d,(l=s==null?void 0:s.defaultTimes)==null?void 0:l.recoveryTimes,n==null?void 0:n.recoveryTimes];return npe({categoryName:a,categoryType:o,timesBlockArray:p})}function zFe({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:a,policy:o}){var s;let l=(a==null?void 0:a.matchUpAverageTimes)&&gT({...a,matchUpFormat:t}),c=(r==null?void 0:r.matchUpAverageTimes)&&gT({...r,matchUpFormat:t}),u=(o==null?void 0:o.matchUpAverageTimes)&&gT({...o,matchUpFormat:t}),d=[l,c,u,(s=o==null?void 0:o.defaultTimes)==null?void 0:s.averageTimes,n==null?void 0:n.averageTimes];return npe({categoryName:e,categoryType:i,timesBlockArray:d})}function pC({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,a,o,s,l,c;e=e??((r=n==null?void 0:n.category)==null?void 0:r.categoryName)??((a=n==null?void 0:n.category)==null?void 0:a.ageCategoryCode),i=i??((o=n==null?void 0:n.category)==null?void 0:o.categoryType)??((s=n==null?void 0:n.category)==null?void 0:s.subType);let{policy:u}=Rg({policyType:kf,tournamentRecord:t,event:n}),d=(l=t?jt({element:t,name:Pp}).extension:void 0)==null?void 0:l.value,p=(c=n&&jt({name:Pp,element:n}).extension)==null?void 0:c.value;return{scheduleTiming:{tournamentScheduling:d,eventScheduling:p,categoryName:e,categoryType:i,policy:u}}}var rpe="DOUBLES_SINGLES",ape="SINGLES_DOUBLES",Dl="total",fB="participantConflict",Th="matchUpConflict",ope="ISSUE_IDS",rm="CONFLICT",am="WARNING",mB="ERROR",gB="ISSUE",oM="STATE",WFe={SINGLES_DOUBLES:ape,DOUBLES_SINGLES:rpe,TOTAL:Dl,CONFLICT_MATCHUP_ORDER:Th,CONFLICT_PARTICIPANTS:fB,SCHEDULE_ISSUE_IDS:ope,SCHEDULE_CONFLICT:rm,SCHEDULE_WARNING:am,SCHEDULE_ERROR:mB,SCHEDULE_ISSUE:gB,SCHEDULE_STATE:oM},Cd="SINGLES",uy="SINGLES",Ll="DOUBLES",of="DOUBLES",Ur="TEAM",Ys="TEAM",qFe="AGE",KFe="RATING",YFe="BOTH",ZFe={AGE:qFe,BOTH:YFe,DOUBLES:Ll,DOUBLES_EVENT:of,RATING:KFe,SINGLES:Cd,SINGLES_EVENT:uy,TEAM_EVENT:Ys,TEAM:Ur};function hC({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:a,eventType:o,event:s}){if(!i)return{error:Ne};o=o??(s==null?void 0:s.eventType)??uy;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=pC({tournamentRecord:i,categoryName:r,categoryType:a,event:s}),u={...c,matchUpFormat:n,categoryType:a,defaultTiming:l};return Bk({eventType:o,timingDetails:u})}function Bk({timingDetails:t,eventType:e}){let i=zFe(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),a=HFe({...t,averageMinutes:r}),o=Object.keys((a==null?void 0:a.minutes)||{}),s=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(e))&&a.minutes[e]||a.minutes.default),l=_n(uy)(e)?ape:rpe,c=(a==null?void 0:a.minutes)&&((o==null?void 0:o.includes(l))&&a.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function GE(t){return t.createdAt?new Date(t.createdAt).getTime():0}function _g({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(a=>a&&a.itemType===i&&(!t||GE(a)<new Date(t).getTime())).sort((a,o)=>GE(a)-GE(o)).pop(),r=n&&GE(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function vB({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Z0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function Km({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Y0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function spe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Np,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{allocatedCourts:ot(r,!1,!0)}:i}function lpe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:qm,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtId:r}:i}function cpe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:K0,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{venueId:r}:i}function Z3({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:K3,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function Wg(t){if(tde.test(t)){let e=l3();return new Date(`${e}T${t}`)}else return new Date(t)}function XFe({matchUp:t}){if(!t)return{error:Do};if(!t.timeItems)return{error:GW};let e=t.timeItems.filter(n=>[fc,ap,ed,Ap].includes(n==null?void 0:n.itemType)).sort((n,r)=>Wg(n.itemValue).getTime()-Wg(r.itemValue).getTime()),i=e.reduce((n,r)=>{var a,o;let s,l=(a=r==null?void 0:r.itemType)==null?void 0:a.split("."),c=`SCHEDULE.TIME.${((o=r==null?void 0:r.itemType)==null?void 0:o.startsWith("SCHEDULE.TIME"))&&l[2]}`;switch(c){case fc:s=0;break;case Ap:if(n.lastValue&&[fc,ed].includes(n.lastType)){let u=Wg(r.itemValue).getTime()-Wg(n.lastValue).getTime();s=n.milliseconds+u}else s=n.milliseconds;break;case ap:if([fc,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=Wg(r.itemValue).getTime()-Wg(n.lastValue).getTime();s=n.milliseconds+u}else s=n.milliseconds;break;default:s=n.milliseconds;break}return{milliseconds:s,lastType:c,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([fc,ed].includes(i.lastType)){let n=new Date().getTime()-Wg(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:JFe(i.milliseconds),relevantTimeItems:e}}function JFe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function QFe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:a}=_g({timeItems:(n==null?void 0:n.timeItems)||[],itemType:q3,visibilityThreshold:t});return!i||a&&e&&new Date(a).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function e$e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(e=i.reduce((r,a)=>{let o=a.itemType===fc&&a;return o&&(!r||n(o)<n(r))?o:r},void 0))==null?void 0:e.itemValue}}function t$e(t=1){return Xe(0,t).map(xi)}function xi(){let t=[];for(let a=0;a<256;a++)t[a]=(a<16?"0":"")+a.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function fC(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Ie};let r=Eu(t);i.venueId||(i.venueId=xi());let a;for(let o of Object.values(r)){let s=i$e({disableNotice:!0,tournamentRecord:o,context:n,venue:i});if(s!=null&&s.error)return s;a=s.venue}return e||ti({topic:M3,payload:{venue:i}}),ft({...re,venue:a})}function i$e({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=xi()),t.venues.reduce((r,a)=>r||a.venueId===n.venueId,void 0)?{error:due}:(i&&ui({element:n,extension:{value:i,name:sde}}),t.venues.push(n),e||ti({payload:{venue:n,tournamentId:t.tournamentId},topic:M3}),{...re,venue:ot(n)})):{error:dt,info:"missing venue"}:{error:Ne}}function Jp({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Ne};if(!i)return{error:Nf};let n=(e.venues??[]).reduce((r,a)=>a.venueId===i?a:r,void 0);if(!n&&t){let r=(XP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let a of r){let o=t[a],s=Jp({tournamentRecord:o,venueId:i});if(s.success&&s.venue)return fC({tournamentRecord:e,venue:s.venue}),{...re,venue:n}}}return n?{...re,venue:n}:{error:x0}}function X3({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,a=Jp({tournamentRecords:i,tournamentRecord:n,venueId:r});return ot(a,t,!0)}function uI({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Ne};if(!i)return{error:eI};let n="findCourt",r,a;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(s=>{s.courtId===i&&(r=s,a=o)})}),r)return{...re,court:r,venue:a};if(t){let o=(XP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of o){let l=t[s],c=uI({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&fC({tournamentRecord:e,venue:c.venue}),{...re,court:r,venue:a}}}return oe({result:{error:GP},stack:n})}function upe(t){return ot(uI(t),!1,!0)}function Vk({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Ne};if(!i)return{error:eI};let n=uI({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:a,courtId:o,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...re,courtInfo:ot(r,!1,e)}}function bw({tournamentRecord:t,venueId:e}){var i;if(!t)return{error:Ne};if(!e)return{error:Nf};let n=Jp({tournamentRecord:t,venueId:e});if(n.error)return n;let r=(((i=n.venue)==null?void 0:i.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(Vk({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),a=n.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(n.venue),o=a&&{...a,courtsInfo:r};return{...re,venueData:ot(o,!1,!0)}}function n$e({matchUp:t}){var e;let i=(t==null?void 0:t.timeItems)||[],n=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(e=i.reduce((r,a)=>{let o=a.itemType===Ap&&a;return o&&(!r||n(o)>n(r))?o:r},void 0))==null?void 0:e.itemValue}}function Vn({event:t,eventId:e}){var i,n;if(!t)return{error:_i};let r=(i=jt({name:kl,element:t}))==null?void 0:i.extension,a=e?ot(r==null?void 0:r.value,!1,!0):r==null?void 0:r.value;return e&&((n=t.drawDefinitions)==null||n.forEach(o=>{var s;(s=a==null?void 0:a.flights)==null||s.forEach(l=>{l.drawId===o.drawId&&Object.assign(l,{drawDefinition:o})})})),{flightProfile:a}}function po(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",a={},o=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(o).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{a[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=s.find(d=>{var p,h,f;let m=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(m)c=m,l=a[d.eventId].tournamentId;else{let g=(f=(h=d&&((p=Vn({event:d}))==null?void 0:p.flightProfile))==null?void 0:h.flights)==null?void 0:f.find(v=>v.drawId===n);if(g)return l=a[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return m});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=a[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...oe({result:{error:Wo},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...oe({result:{error:zo},context:{drawId:n,eventId:i},stack:r})}}function jk(t){var e,i,n,r,a,o,s,l,c;let u=t.event,d=t.matchUpType,{scheduleVisibilityFilters:p,afterRecoveryTimes:h,tournamentRecord:f,usePublishState:m,scheduleTiming:g,matchUpFormat:v,publishStatus:y,matchUp:I}=t;if(!I)return{error:Do};if(h&&!I.matchUpType&&!t.matchUpType&&(u||f)&&I.drawId){let A=(e=u==null?void 0:u.drawDefinitions)==null?void 0:e.find(O=>O.drawId===I.drawId);!A&&f&&({drawDefinition:A,event:u}=po({tournamentRecord:f,drawId:I.drawId}));let _=I.structureId&&((i=A==null?void 0:A.structures)==null?void 0:i.find(({structureId:O})=>O===I.structureId));d=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(u==null?void 0:u.eventType)!==Ur&&(u==null?void 0:u.eventType)}let{milliseconds:b,time:D}=XFe({matchUp:I}),{startTime:w}=e$e({matchUp:I}),{endTime:S}=n$e({matchUp:I}),U,{visibilityThreshold:C,eventIds:E,drawIds:P}=p??{};if((!E||E.includes(I.eventId))&&(!P||P.includes(I.drawId))){let A={matchUp:I,visibilityThreshold:C},{allocatedCourts:_}=spe(A),{scheduledTime:O}=vB(A),{scheduledDate:x}=Km(A),{venueId:F}=cpe(A),{courtId:$}=lpe(A),{courtOrder:V}=QFe(A),{timeModifiers:G}=Z3(A),j,z,H,K,q,Y=I.matchUpType??d;if(g&&O&&h&&Y){let ee={matchUpFormat:I.matchUpFormat??v,...g};({averageMinutes:z=0,recoveryMinutes:H=0,typeChangeRecoveryMinutes:K=0}=Bk({timingDetails:ee,eventType:Y})),(z||H)&&(j=S?So(rn(S),H):So(O,z+H)),K&&(q=S?So(rn(S),K):So(O,z+K))}!x&&O&&(x=Lt(O));let Z=OR({scheduledDate:x,scheduledTime:O}),Q={},ie=((n=f&&F&&bw({tournamentRecord:f,venueId:F}))==null?void 0:n.venueData)||{};F&&(Q[F]=ie);let{venueName:ue,venueAbbreviation:J,courtsInfo:te}=ie,se=(r=$&&(te==null?void 0:te.find(ee=>ee.courtId===$)))==null?void 0:r.courtName;for(let ee of _||[]){if(!f)break;ee.venueId&&!Q[ee.venueid]&&(Q[ee.venueId]=(a=bw({venueId:ee.venueId,tournamentRecord:f}))==null?void 0:a.venueData);let ce=Q[ee.venueId];ee.venueName=ce==null?void 0:ce.venueName;let fe=(o=ce==null?void 0:ce.courtsInfo)==null?void 0:o.find(ge=>ge.courtId===ee.courtId);ee.courtName=fe==null?void 0:fe.courtName}U=ft({typeChangeTimeAfterRecovery:q,timeAfterRecovery:j,scheduledDate:x,scheduledTime:O,isoDateString:Z,allocatedCourts:_,timeModifiers:G,venueAbbreviation:J,venueName:ue,venueId:F,courtOrder:V,courtName:se,courtId:$,typeChangeRecoveryMinutes:K,recoveryMinutes:H,averageMinutes:z,milliseconds:b,startTime:w,endTime:S,time:D})}else U=ft({milliseconds:b,startTime:w,endTime:S,time:D});let{scheduledDate:M}=Km({matchUp:I}),{scheduledTime:N}=vB({matchUp:I});if(m&&(s=y==null?void 0:y.displaySettings)!=null&&s.draws){let A=y.displaySettings.draws,_=(l=(A==null?void 0:A[I.drawId])??(A==null?void 0:A.default))==null?void 0:l.scheduleDetails;if(_){let O=(c=_.find(x=>{var F;return M&&((F=x.dates)==null?void 0:F.includes(M))})??_.find(x=>{var F;return!((F=x.dates)!=null&&F.length)}))==null?void 0:c.attributes;if(O){let x=Object.assign({},...Object.keys(U).map(F=>({[F]:!0})),O);U=ay({source:U,template:x})}}}let R=I.matchUpStatus&&Mr.includes(I.matchUpStatus)&&(Lt(S)||Lt(M)||Lt(N))||void 0;return{schedule:U,endDate:R}}function Ph(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function yT({item:t,drawDefinition:e,structure:i,event:n}){var r,a,o;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(s=>t.tieFormatId===s.tieFormatId))||(n.tieFormat?n.tieFormat:(a=n.tieFormats)==null?void 0:a.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(o=e.tieFormats)==null?void 0:o.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function Ea({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:yT({item:i,drawDefinition:t,structure:e,event:n})||yT({item:e,drawDefinition:t,structure:e,event:n})||Ph(t)||Ph(n)}}function r$e({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function dpe({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=jr(t,t.length/e).map(r=>r.reduce((a,o)=>a+o)),n=i.slice().sort(or);return i.map(r=>n.indexOf(r)+1)}function sM(t){if(!Array.isArray(t))return"";let e=t.filter(Mn);return e.length?$t([Math.min(...e),Math.max(...e)]).join("-"):""}function a$e({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:tt};if(!e)return{error:Is};let{structure:n}=Dt({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==oa)return{error:Ug,info:"Structure is not CONSOLATION stage"};let{links:r}=t,a=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],o=(a==null?void 0:a.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],s=Object.assign({},...o.map(d=>{let p=Wm({structureId:d,matchUpsMap:i}),h=Za({matchUps:p}).roundProfile;return{[d]:h}})),l=Wm({matchUpsMap:i,structureId:e}),{roundProfile:c}=Za({matchUps:l}),u={};return a==null||a.forEach(d=>{var p,h,f;let{structureId:m,roundNumber:g}=d.source,{feedProfile:v,groupedOrder:y,positionInterleave:I,roundNumber:b}=d.target,D=s[m],w=(p=D[1])==null?void 0:p.drawPositions,S=(h=D[g])==null?void 0:h.matchUpsCount;if(!S)return;let U=S?w.length/S:0,C=w.length/U,E=w.slice(),P=dpe({roundPositionsCount:C,groupedOrder:y}),M=(P==null?void 0:P.length)||1;if(M<=C){let A=w.length/M,_=jr(E,A);v===Hm&&_.forEach(O=>O.reverse()),E=(P==null?void 0:P.length)&&(P==null?void 0:P.map(O=>_[O-1]).flat())||E}let N=jr(E,U);if(I){let A=Xe(0,I.interleave).map(()=>{}),_=Xe(0,I.offset).map(()=>{});N=N.map(x=>[x,...A]),N.unshift(_),N=N.flat(1);let O=N.length-I.offset;N=N.slice(0,O)}u[b]||(u[b]={});let R=(f=c==null?void 0:c[b])!=null&&f.feedRound?2:1;N.forEach((A,_)=>{let O=1+_*R;u[b][O]||(u[b][O]=sM(A))})}),{sourceDrawPositionRanges:u}}function Qp({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let a={policies:{}};if(!i)return a;let o=Xp({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[Jd])??(o==null?void 0:o[Jd])??W3[Jd];a.policies[Jd]=s}return a}function o$e({drawPositions:t,roundProfile:e,roundNumber:i}){var n;let r=[void 0,void 0];if(Oue(t))return{orderedDrawPositions:r,displayOrder:r};let a=e==null?void 0:e[i],o=((n=a==null?void 0:a.pairedDrawPositions)==null?void 0:n.find(l=>Ya(l||[],t.filter(Boolean))))??r,s=a==null?void 0:a.feedRound;if(kue(t)){let l=[...t].sort(or);return{orderedDrawPositions:l.length===2?l:o,displayOrder:s?l:o}}if(s){let l=[t.find(c=>!isNaN(St(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function WR({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let a=s=>s===void 0?-1:s,o=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>a(s.substitutionOrder)-a(l.substitutionOrder));for(let s of o){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Fl({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:Ne};if(!Array.isArray(i)||i.length>2)return{error:Tl};if(!i.length)return oe({result:{error:Rf},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===Ot&&Ln(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),a=r[0];if(!a)return oe({result:{error:Gn},stack:n});let o=ot(r.slice(1),!1,!0);return{participant:ot(a),duplicatedPairParticipants:o,...re}}function Ym({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:tt};if(typeof e!="string")return{error:vr};let{extension:i}=jt({element:t,name:Dp});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function s$e({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:a,collectionId:o,sideLineUps:s,matchUpType:l}){if(!o||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var f,m,g,v;let{assignedParticipantIds:y,substitutions:I}=WR({collectionPosition:i,collectionId:o,lineUp:p});if(l===qi){if((y==null?void 0:y.length)<=2){let b=(m=(f=r==null?void 0:r[y[0]])==null?void 0:f.pairIdMap)==null?void 0:m[y[1]],D=(v=b&&((g=r[b])==null?void 0:g.participant)||Fl({participantIds:y,tournamentParticipants:t}).participant)==null?void 0:v.participantId;return{[d]:{participantId:D,teamParticipant:h,substitutions:I}}}else if((y==null?void 0:y.length)>2)return{[d]:{teamParticipant:h,substitutions:I}}}else{let b=y==null?void 0:y[0];return b&&{[d]:{participantId:b,teamParticipant:h,substitutions:I}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var h;let{teamParticipant:f,sideNumber:m}=p,g=p.lineUp||((h=Ym({participantId:f.teamParticipantId,drawDefinition:a}))==null?void 0:h.lineUp);return c({attribute:m,lineUp:g,teamParticipant:f})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var p,h,f;let m=(p=e.find(I=>I.drawPosition===d))==null?void 0:p.participantId,g=s==null?void 0:s.find(I=>(I==null?void 0:I.drawPosition)===d),v=(g==null?void 0:g.teamParticipant)||m&&((h=r==null?void 0:r[m])==null?void 0:h.participant)||(t==null?void 0:t.find(({participantId:I})=>I===m)),y=(g==null?void 0:g.lineUp)||((f=Ym({participantId:m,drawDefinition:a}))==null?void 0:f.lineUp);return c({attribute:d,lineUp:y,teamParticipant:v})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function ppe({drawDefinition:t}){if(typeof t!="object")return{error:Cv};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((o,s)=>{let{stage:l}=s;return o[l]?o[l].push(s):o[l]=[s],o},{});for(let o of Object.keys(r)){let s=r[o].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;a({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:o})}return{exitProfiles:e};function a({exitProfiles:o,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){o[l]||(o[l]=[]),s==="0"&&[oa,Nn].includes(d)||o[l].push(s);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(I=>I.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,a({exitProfile:`${s}-${f}`,structureId:g,exitProfiles:o,targetRound:m,aggregator:u,stage:v})}}}function l$e({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var r;if(!t)return{error:tt};if(!i)return{error:Is};if(!e){let s=Wm({matchUpsMap:n,structureId:i});if({roundProfile:e}=Za({matchUps:s}),!e)return{error:dt}}let a=(Math.min(...((r=e==null?void 0:e[1])==null?void 0:r.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var l,c;let u=(l=e==null?void 0:e[s])==null?void 0:l.matchUpsCount,d=((c=e==null?void 0:e[1])==null?void 0:c.drawPositions)??[],p=jr(d,d.length/u),h=p.map(sM),f=p.map(I=>I.map(b=>b-a)).map(sM),m=o.map(I=>{var b;if(I>s)return;let D=((b=e==null?void 0:e[I])==null?void 0:b.drawPositions)??[];return jr(D,D.length/u)}).filter(Boolean),g=Xe(0,u).map(I=>m.map(b=>b[I]).flat().filter(Boolean).sort(or)).map(I=>$t(I)),v=g.map(I=>fLe(I).map(sM).join(", ")),y=Object.assign({},...Xe(0,u).map(I=>({[I+1]:{firstRoundDrawPositionsRange:h[I],firstRoundOffsetDrawPositionsRange:f[I],possibleDrawPositions:g[I],drawPositionsRange:v[I]}})));return{[s]:y}}))}}function J3({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],t=t??Za({matchUps:n}).roundsNotPowerOf2;let a=!!((r=i.positionAssignments)!=null&&r.find(({drawPosition:o})=>o))||!!(n!=null&&n.find(({drawPositions:o})=>o==null?void 0:o.length));return(!(e!=null&&e.drawType)||e.drawType!==Pg)&&!(i!=null&&i.structures)&&t&&a}function Yo({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var a;return(a=r==null?void 0:r.drawPositions)==null?void 0:a.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==xr&&(!e.length||!i&&!n)}var Q3={[dw]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[nt]:"",[Nn]:"P",[gt]:"Q",[oa]:"C"}}},c$e=Q3;function u$e({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,o;let{roundProfile:s,roundMatchUps:l}=Za({matchUps:n}),{structureAbbreviation:c,stage:u}=i,d=Yo({structure:i}),p=J3({structure:i}),h=i.structures,f={},m=Q3[dw],g=i.stage===gt,v=g?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===gt).map(({stageSequence:A})=>A??1),0):0,y=(i.stageSequence??1)<v?i.stageSequence??1:"",I=y&&(((r=t==null?void 0:t.affixes)==null?void 0:r.preQualifying)||m.affixes.preQualifying)||"",b=(t==null?void 0:t.roundNamingMap)||m.roundNamingMap||{},D=(t==null?void 0:t.abbreviatedRoundNamingMap)||m.abbreviatedRoundNamingMap||{},w=((a=t==null?void 0:t.affixes)==null?void 0:a.preFeedRound)||m.affixes.preFeedRound,S=((o=t==null?void 0:t.affixes)==null?void 0:o.roundNumber)||m.affixes.roundNumber,U=((t==null?void 0:t.namingConventions)||m.namingConventions).round,C=u&&u!==nt?u[0]:"",E=(t==null?void 0:t.stageConstants)||m.stageConstants,P=u&&(E==null?void 0:E[u])||C,M=`${I}${P}${y}`,N=s?Object.keys(s):[],R=g&&E!=null&&E[gt]?`${E==null?void 0:E[gt]}-`:"";if(h||d||p)Object.assign(f,...N.map(A=>{let _=`${R}${U} ${A}`,O=`${S}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:O}}}));else{let A=g&&((t==null?void 0:t.qualifyingFinishMap)||(m==null?void 0:m.qualifyingFinishMap)||{});Object.assign(f,...N.map(_=>{if(!(s!=null&&s[_]))return;let{matchUpsCount:O,preFeedRound:x}=s[_],F=O*2,$=(A==null?void 0:A[s==null?void 0:s[_].finishingRound])||A&&`${S}${F}`||b[O]||`${S}${F}`,V=x?`-${w}`:"",G=`${$}${V}`,j=[M,c,G].filter(Boolean).join("-"),z=`${D[O]||`${S}${F}`}${V}`,H=[M,c,z].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:H,roundName:j}}}))}return{roundNamingProfile:f,roundProfile:s,roundMatchUps:l}}function Gk(t){var e,i,n;let r=vi(t,[{[Af]:!0}]);if(r.error)return r;let a=t==null?void 0:t.matchUp,o=a==null?void 0:a.matchUpType;if(!o&&(e=a==null?void 0:a.sides)!=null&&e.length){let s=(n=(i=a.sides.find(({participant:l})=>l))==null?void 0:i.participant)==null?void 0:n.participantType;o=s===Zt&&Un||s===Ot&&qi||s===Gi&&Gi||void 0}return{matchUpType:o}}var d$e="normal",pY="timed",p$e="final",eq="NOAD",lM="SET",h$e={S:d$e,F:p$e};function go(t){if(typeof t=="string"){let e=t.startsWith("T")&&pY||t.startsWith(lM)&&lM||"";if(e===pY){let i=fpe(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===lM)return f$e(t)}}function f$e(t){let e=t.split("-"),i=mC(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,a=e&&hY(e[1]),o=e&&hY(e[2]),s=a&&a.timed||o&&o.timed,l=n&&n<6||s&&r,c=!e[2]||o,u=a,d=ft({setFormat:a,exactly:r,bestOf:n});if(o&&(d.finalSetFormat=o),l&&u&&c)return d}function hY(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=h$e[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=fY(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return fpe(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),a=r&&mpe(r[2])||!1,o=!(r!=null&&r[2])||a,s=r?mC(r[1]):void 0,l=hpe(n),c=l!==!1,u=c&&l||s,d=fY(n.split("/")[1]),p=d!==!1,h={setTo:s};return a&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,s&&o&&p&&c&&h||!1}}}function hpe(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?mC(i[1]):i[1])||!1}function fY(t){if(t)if(t.startsWith("TB")){let e=hpe(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&mpe(i[2]),a=!(i!=null&&i[2])||r,o=mC(n);if(o&&a){let s={tiebreakTo:o};return e&&typeof e=="string"&&!Rt(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function fpe(t){var e;let i=t.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=mC(n==null?void 0:n[1]);if(!r)return;let a={timed:!0,minutes:r},o=n==null?void 0:n[2],s=[void 0,"P","G"].includes(o);if(o&&!s){let l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(a.modifier=l,a):void 0}return o&&(a.based=n[2]),a}function mpe(t){return t&&t.indexOf(eq)>=0}function mC(t){return isNaN(Number(t))?0:Number(t)}function Hk(t,e){return!Array.isArray(t)||!co(e)?!1:Ln(t,ipe[e]).length}function lv(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:a,matchUpFormats:o,roundPositions:s,matchUpFormat:l,collectionIds:c,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:h,stageSequences:f,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:I,matchUpTypes:b,structureIds:D,readyToScore:w,courtIds:S,eventIds:U,venueIds:C,drawIds:E,stages:P,filterMatchUpIds:M=!0,filterMatchUpTypes:N=!0}=t,R=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],O=Array.isArray(P)?P.filter(Boolean):[],x=Array.isArray(f)?f.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],$=Array.isArray(h)?h.filter(Boolean):[],V=Array.isArray(d)?d.filter(Boolean):[],G=Array.isArray(s)?s.filter(Boolean):[],j=Array.isArray(p)&&M?p.filter(Boolean):[],z=Array.isArray(b)&&N?b.filter(Boolean):[],H=Array.isArray(S)?S.filter(Boolean):[],K=Array.isArray(C)?C.filter(Boolean):[],q=Array.isArray(o)&&o.filter(Boolean)||typeof l=="string"&&[l]||[],Y=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],Z=Array.isArray(I)?I.filter(Boolean):[],Q=Array.isArray(U)?U.filter(Boolean):[],ie=Array.isArray(E)?E.filter(Boolean):[],ue=Array.isArray(D)?D.filter(Boolean):[];return e.filter(J=>{var te;if(w&&!_n(gu)(J)&&!J.readyToScore||J.winningSide&&a&&![1,2].includes(J.winningSide)||u!==void 0&&(u&&!J.tieMatchUps||!u&&J.tieMatchUps)||i!==void 0&&(i&&!J.collectionId||!i&&J.collectionId)||O.length&&!O.includes(J.stage)||x.length&&!x.includes(J.stageSequence)||F.length&&(!J.collectionId||!F.includes(J.collectionId))||$.length&&(!J.roundName||!$.includes(J.roundName))||V.length&&(!J.roundNumber||!V.includes(J.roundNumber))||G.length&&(!J.roundPosition||!G.includes(J.roundPosition))||A.length&&(!J.matchUpStatus||!A.includes(J.matchUpStatus))||_.length&&J.matchUpStatus&&_.includes(J.matchUpStatus)||j.length&&!j.includes(J.matchUpId)||z.length&&(!J.matchUpType||!Hk(z,J.matchUpType))||q.length&&(!J.matchUpFormat||!q.includes(J.matchUpFormat)))return!1;if(Y!=null&&Y.length){let{scheduledTime:se}=vB({matchUp:J}),{scheduledDate:ee}=Km({matchUp:J}),ce=Lt(se)||ee;if(!Y.find(fe=>wd(fe,ce)))return!1}if(H.length){let{courtId:se}=lpe({matchUp:J}),{allocatedCourts:ee}=spe({matchUp:J}),ce=ee==null?void 0:ee.map(({courtId:fe})=>fe);if(!H.filter(Boolean).includes(se)||ce!=null&&ce.includes(se))return!1}if(K.length){let{venueId:se}=cpe({matchUp:J});if(!K.filter(Boolean).includes(se))return!1}if(y){if(Z.length&&!Z.includes(J.tournamentId)||Q.length&&!Q.includes(J.eventId)||ie.length&&!ie.includes(J.drawId)||ue.length&&!ue.includes(J.structureId))return!1;if(R.length){let se=((te=J.sides)==null?void 0:te.map(({participantId:ee})=>ee).filter(Boolean))??[];if(!R.some(ee=>se.includes(ee)))return!1}}return!0})}function m$e({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:a,isFeedRound:o,sideNumber:s}){var l,c,u,d;let p=i.find(v=>v.drawPosition&&v.drawPosition===a),h=a&&t,f=s&&e,m=h?(l=h[a])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?g$e({displaySideNumber:n,seedAssignments:r,participantId:m,assignment:p,sideNumber:s}):{...f==null?void 0:f[s]};if(o&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),a&&h){let v=(c=h[a])==null?void 0:c.teamParticipant,y=(u=h[a])==null?void 0:u.participant,I=(d=h[a])==null?void 0:d.substitutions;y&&(g.participant=y),I&&(g.substitutions=I),v&&(g.teamParticipant=v)}return g}function g$e({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let a={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let o=v$e({seedAssignments:e,participantId:i});Object.assign(a,o,{participantId:i})}else n.bye&&Object.assign(a,{bye:!0});return n.qualifier&&Object.assign(a,{qualifier:!0}),a}function v$e({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var vu="ANY",zi="MALE",Fo="MIXED",cv="OTHER",gn="FEMALE",tq={ANY:vu,MALE:zi,FEMALE:gn,MIXED:Fo,OTHER:cv};function Ui({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:h,contextProfile:f,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:I,structure:b,inContext:D,event:w}){var S,U,C,E,P;let M={},N={};if(n=n??(o==null?void 0:o.participants),!b)return{collectionPositionMatchUps:M,error:Mf,roundMatchUps:N,matchUps:[]};let R=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],A=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],_=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],O=!(v!=null&&v.eventId)||!(R!=null&&R.length)&&!((S=c==null?void 0:c.eventIds)!=null&&S.filter(Boolean).length)||(R==null?void 0:R.includes(v.eventId))||((U=c==null?void 0:c.eventIds)==null?void 0:U.includes(v.eventId)),x=!(A!=null&&A.length)||A.includes(b.structureId),F=!m||!(_!=null&&_.length)||_.includes(m.drawId);if(!O||!x||!F)return{collectionPositionMatchUps:M,roundMatchUps:N,matchUps:[]};f&&!u&&(u=Qp({tournamentRecord:o,contextProfile:f,drawDefinition:m}));let{appliedPolicies:$}=Mi({drawDefinition:m}),V={...e,...$,...a},G=(C=V==null?void 0:V.scoring)==null?void 0:C.structures,j=b.stage&&(G==null?void 0:G.stage)&&(G==null?void 0:G.stage[b.stage]),z=b.stageSequence&&(j==null?void 0:j.stageSequence)&&j.stageSequence[b.stageSequence],H=((E=V==null?void 0:V.scoring)==null?void 0:E.requireAllPositionsAssigned)||(j==null?void 0:j.requireAllPositionsAssigned)||(z==null?void 0:z.requireAllPositionsAssigned);I||(I=da({drawDefinition:m,structure:b}));let{positionAssignments:K,allPositionsAssigned:q}=Rr({structure:b}),Y=!H||q,{seedAssignments:Z}=Ks({provisionalPositioning:i,drawDefinition:m,structure:b});s=s??Z;let{roundOffset:Q,structureId:ie,structureName:ue,stage:J,stageSequence:te}=b,{drawId:se,drawName:ee,drawType:ce}=m??{};y=y||m&&ppe({drawDefinition:m}).exitProfiles;let fe=y==null?void 0:y[ie],ge=(fe==null?void 0:fe.length)&&(fe[0].split("-").map(we=>parseInt(we)).reduce((we,Oe)=>we+Oe)||0),he=!!b.structures,Se=Wm({matchUpsMap:I,structureId:ie,inContext:D}),Ce=V==null?void 0:V[dw],Fe=u$e({roundNamingPolicy:Ce,drawDefinition:m,structure:b,matchUps:Se}),{roundNamingProfile:Je,roundProfile:xe}=Fe;if(N=(Fe==null?void 0:Fe.roundMatchUps)??[],d&&(Se=lv({matchUps:Se,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),D){let{sourceDrawPositionRanges:we}=a$e({drawDefinition:m,matchUpsMap:I,structureId:ie}),Oe=m?l$e({drawDefinition:m,roundProfile:xe,matchUpsMap:I,structureId:ie}).drawPositionsRanges:void 0;Se=Se.map(ye=>st({scheduleVisibilityFilters:t,sourceDrawPositionRanges:we,drawPositionsRanges:Oe,roundNamingProfile:Je,initialRoundOfPlay:ge,appliedPolicies:V,usePublishState:l,publishStatus:g,isRoundRobin:he,roundProfile:xe,matchUp:ye,event:w})),(Se==null?void 0:Se.filter(ye=>Array.isArray(ye.tieMatchUps))).forEach(ye=>{let Be=ye.tieMatchUps;Se=Se.concat(...Be)}),c&&(Se=lv({processContext:!0,...c,matchUps:Se}))}else(Se==null?void 0:Se.filter(we=>Array.isArray(we.tieMatchUps))).forEach(we=>{let Oe=we.tieMatchUps;Se=Se.concat(...Oe)});return d&&(Se=lv({matchUps:Se,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(Se=lv({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:Se})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||D)&&(N=Za({matchUps:Se}).roundMatchUps??[]),(P=Ea({drawDefinition:m,structure:b,event:w}))!=null&&P.tieFormat&&({collectionPositionMatchUps:M}=r$e({matchUps:Se})),{collectionPositionMatchUps:M,roundMatchUps:N,isRoundRobin:he,roundProfile:xe,matchUpsMap:I,matchUps:Se};function st({scheduleVisibilityFilters:we,sourceDrawPositionRanges:Oe,drawPositionsRanges:ye,initialRoundOfPlay:Be,additionalContext:Ee,roundNamingProfile:qe,tieDrawPositions:Ge,appliedPolicies:me,isCollectionBye:Me,usePublishState:De,publishStatus:Ae,matchUpTieId:ze,isRoundRobin:de,roundProfile:pe,sideLineUps:ke,matchUp:Ue,event:Te}){var rt,je,Le,It,zt,Jt,Yr,Eo,Qt,yr,Kn,yt,cr,Jo,Qo;Ee=Ee??{};let vo=(rt=Ea({drawDefinition:m,structure:b,matchUp:Ue,event:Te}))==null?void 0:rt.tieFormat,Od=vo==null?void 0:vo.collectionDefinitions,Aa=Ue.collectionId&&(Od==null?void 0:Od.find(pi=>pi.collectionId===Ue.collectionId)),es=Ue.collectionId?Aa==null?void 0:Aa.matchUpFormat:Ue.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(Te==null?void 0:Te.matchUpFormat),Ql=Ue.matchUpType||(Aa==null?void 0:Aa.matchUpType)||(b==null?void 0:b.matchUpType)||(m==null?void 0:m.matchUpType)||!_n(Ur)(Te==null?void 0:Te.eventType)&&(Te==null?void 0:Te.eventType),Vg=Me?wi:Ue.matchUpStatus,{schedule:uh,endDate:Ru}=jk({scheduleVisibilityFilters:we,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:De,scheduleTiming:h,matchUpFormat:es,publishStatus:Ae,matchUpType:Ql,matchUp:Ue,event:Te}),Nu=Ge??Ue.drawPositions??[],{collectionPosition:ec,collectionId:tc,roundPosition:to}=Ue,di=Ue.roundNumber??Ee.roundNumber,jf=tc?s$e({tournamentParticipants:n,positionAssignments:K,collectionPosition:ec,drawDefinition:m,participantMap:p,drawPositions:Nu,collectionId:tc,sideLineUps:ke,matchUpType:Ql}):void 0,Gf=((je=qe==null?void 0:qe[di])==null?void 0:je.roundName)||Ee.roundName,Hf=((Le=qe==null?void 0:qe[di])==null?void 0:Le.abbreviatedRoundName)||Ee.abbreviatedRoundName,We=(It=pe==null?void 0:pe[di])==null?void 0:It.feedRound,Xt=(zt=pe==null?void 0:pe[di])==null?void 0:zt.preFeedRound,Yn=(Jt=pe==null?void 0:pe[di])==null?void 0:Jt.roundFactor,Da=ye==null?void 0:ye[di],ic=to?Da==null?void 0:Da[to]:void 0,Au=Oe==null?void 0:Oe[di],sn=Aa!=null&&Aa.category?{...(v==null?void 0:v.category)||{},...Aa.category}:(v==null?void 0:v.category)??(Te==null?void 0:Te.category),nr=((Yr=Ue.processCodes)==null?void 0:Yr.length)&&Ue.processCodes||((Eo=Aa==null?void 0:Aa.processCodes)==null?void 0:Eo.length)&&(Aa==null?void 0:Aa.processCodes)||((Qt=b==null?void 0:b.processCodes)==null?void 0:Qt.length)&&(b==null?void 0:b.processCodes)||((yr=m==null?void 0:m.processCodes)==null?void 0:yr.length)&&(m==null?void 0:m.processCodes)||((Kn=Te==null?void 0:Te.processCodes)==null?void 0:Kn.length)&&(Te==null?void 0:Te.processCodes)||(o==null?void 0:o.processCodes),dh=(f==null?void 0:f.withCompetitiveness)&&dC({...u,matchUp:Ue}),_u=Ue.finishingPositionRange??Ee.finishingPositionRange,sl=pi=>ft(pi,void 0,!0),ln={...sl(v),...sl({matchUpFormat:Ue.matchUpType===Ur?void 0:es,tieFormat:Ue.matchUpType!==Ur?void 0:vo,gender:(Aa==null?void 0:Aa.gender)??(Te==null?void 0:Te.gender),roundOfPlay:J!==gt&&Rt(Be)&&Be+(di||0),endDate:Ue.endDate??Ru,discipline:Te==null?void 0:Te.discipline,category:sn,finishingPositionRange:_u,abbreviatedRoundName:Hf,drawPositionsRange:ic,competitiveProfile:dh,structureName:ue,stageSequence:te,drawPositions:Nu,matchUpStatus:Vg,processCodes:nr,isRoundRobin:de,matchUpTieId:ze,preFeedRound:Xt,matchUpType:Ql,roundFactor:Yn,roundOffset:Q,structureId:ie,roundNumber:di,feedRound:We,roundName:Gf,drawName:ee,drawType:ce,schedule:uh,drawId:se,stage:J}),...ot(sl(Ue),!0,!0)};if(es&&(yt=Ue.score)!=null&&yt.scoreStringSide1){let pi=go(es),{bestOf:br,finalSetFormat:lt,setFormat:_t}=pi??{};(lt!=null&&lt.tiebreakSet||_t!=null&&_t.tiebreakSet||_t!=null&&_t.timed)&&(ln.score.sets=ln.score.sets.sort((Ii,dn)=>Ii.setNumber-dn.setNumber).map((Ii,dn)=>(dn+1===br?(lt!=null&&lt.tiebreakSet||lt!=null&&lt.timed)&&(Ii.tiebreakSet=!0):(_t!=null&&_t.tiebreakSet||_t!=null&&_t.timed)&&(Ii.tiebreakSet=!0),Ii)))}if(Array.isArray(Nu)){let{orderedDrawPositions:pi,displayOrder:br}=o$e({drawPositions:Nu,roundProfile:pe,roundNumber:di}),lt=(cr=pe==null?void 0:pe[di])==null?void 0:cr.feedRound,_t=br[0]!==pi[0],Ii=pi.concat(void 0,void 0).slice(0,2).map((dn,Nt)=>{var Ri;let pa=Nt+1,nc=_t?3-pa:pa,rc=m$e({...jf,positionAssignments:K,displaySideNumber:nc,seedAssignments:s,drawPosition:dn,isFeedRound:lt,sideNumber:pa}),xd=(Ri=Ue.sides)==null?void 0:Ri.find(qf=>qf.sideNumber===pa),zf=to?(to-1)*2+Nt+1:void 0,Wf=zf?Au==null?void 0:Au[zf]:void 0;return sl({sourceDrawPositionRange:Wf,...xd,...rc})});Object.assign(ln,ot({sides:Ii},!0,!0))}if(n&&ln.sides){let pi=me==null?void 0:me[j0],br=lt=>{var _t;let Ii=(_t=p==null?void 0:p[lt])==null?void 0:_t.participant;return Ii&&ay({template:pi==null?void 0:pi.participant,source:Ii})};if(ln.sides.filter(Boolean).forEach(lt=>{var _t,Ii,dn;if(lt.participantId){let Nt=ot(br(lt.participantId)||n&&ef({policyDefinitions:me,participantId:lt.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(Nt){if(m!=null&&m.entries){let Ri=m.entries.find(pa=>pa.participantId===lt.participantId);Ri!=null&&Ri.entryStatus&&(Nt.entryStatus=Ri.entryStatus),Ri!=null&&Ri.entryStage&&(Nt.entryStage=Ri.entryStage)}Object.assign(lt,{participant:Nt})}}if((Ii=(_t=lt==null?void 0:lt.participant)==null?void 0:_t.individualParticipantIds)!=null&&Ii.length&&!((dn=lt.participant.individualParticipants)!=null&&dn.length)){let Nt=lt.participant.individualParticipantIds.map(Ri=>br(Ri)||n&&ef({policyDefinitions:me,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:Ri}));Object.assign(lt.participant,{individualParticipants:Nt})}}),!ln.matchUpType){let{matchUpType:lt}=Gk({matchUp:ln});lt&&Object.assign(ln,{matchUpType:lt})}if(f!=null&&f.inferGender&&(!ln.gender||ln.gender===Fo)&&((Jo=ln.sides)==null?void 0:Jo.length)===2&&ln.matchUpType!==Ur){let lt=ln.sides.map(_t=>{var Ii,dn,Nt,Ri;if(_n(Un)(ln.matchUpType))return(dn=(Ii=_t.participant)==null?void 0:Ii.person)==null?void 0:dn.sex;if(((Ri=(Nt=_t.participant)==null?void 0:Nt.individualParticipants)==null?void 0:Ri.length)===2){let pa=$t(_t.participant.individualParticipants.map(nc=>{var rc;return(rc=nc.person)==null?void 0:rc.sex})).filter(Boolean);if(pa.length===1)return pa[0]}});if(lt.filter(Boolean).length===2&&$t(lt).length===1){let _t=lt[0];ln.inferredGender=_t}}}if(ln.tieMatchUps){let pi=ln.matchUpStatus===wi,br=(Qo=ln.sides)==null?void 0:Qo.map(({participant:lt,drawPosition:_t,sideNumber:Ii,lineUp:dn})=>{let Nt=(lt==null?void 0:lt.participantType)===Ur&&lt;return{teamParticipant:Nt&&ft({participantRoleResponsibilities:Nt.participantRoleResponsibilities,participantOtherName:Nt.participanOthertName,participantName:Nt.participantName,participantId:Nt.participantId,teamId:Nt.teamId}),drawPosition:_t,sideNumber:Ii,lineUp:dn}});ln.tieMatchUps=ln.tieMatchUps.map(lt=>{let _t=ln.matchUpId,Ii={finishingPositionRange:ln.finishingPositionRange,abbreviatedRoundName:Hf,roundNumber:di,roundName:Gf};return st({tieDrawPositions:Nu,scheduleVisibilityFilters:we,sourceDrawPositionRanges:Oe,sideLineUps:br,drawPositionsRanges:ye,initialRoundOfPlay:Be,roundNamingProfile:qe,additionalContext:Ii,appliedPolicies:me,isCollectionBye:pi,usePublishState:De,publishStatus:Ae,matchUpTieId:_t,isRoundRobin:de,roundProfile:pe,matchUp:lt,event:Te})})}let yi=ln.sides&&ln.sides.filter(pi=>pi==null?void 0:pi.participantId).length===2,Ir=!ln.winningSide;if(Object.assign(ln,{readyToScore:Y&&yi&&Ir,hasContext:!0}),yi){let{allParticipantsCheckedIn:pi,checkedInParticipantIds:br}=cI({matchUp:ln});Object.assign(ln,{allParticipantsCheckedIn:pi,checkedInParticipantIds:br})}return Array.isArray(f==null?void 0:f.exclude)&&(f==null||f.exclude.forEach(pi=>delete ln[pi])),ln}}function Um({matchUp:t}){return t?Mr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function zk({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:I,structure:b,context:D,event:w}){!b&&y&&({structure:b}=Dt({drawDefinition:m,structureId:y}));let S=Ui({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:o,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:b,inContext:I,context:D,event:w}),U=[],C=[],E=[],P=[],M=[];if(S.error)return S;let{matchUps:N}=S,{assignedPositions:R}=Rr({structure:b}),A=R==null?void 0:R.filter(O=>O.participantId).map(O=>O.drawPosition),_;return N.filter(O=>{var x;let F=((x=l==null?void 0:l.matchUpTypes)==null?void 0:x.length)===1&&l.matchUpTypes[0]===Yi;return!(O.matchUpType!==Yi&&F)}).forEach(O=>{var x,F,$,V;if(O.matchUpStatus===ps){U.push(O);return}O.matchUpType===Yi&&(_=!0);let G=O.collectionId,j=G&&((x=O.sides)==null?void 0:x.every(Z=>Z.participantId)),z=!G&&((F=O.drawPositions)==null?void 0:F.filter(Boolean).length)===2,H=!G&&(($=O.drawPositions)==null?void 0:$.every(Z=>A==null?void 0:A.includes(Z))),K=R==null?void 0:R.filter(Z=>Z.bye).map(Z=>Z.drawPosition),q=!G&&((V=O.drawPositions)==null?void 0:V.find(Z=>K==null?void 0:K.includes(Z))),Y=bde.includes(O.matchUpStatus)&&(j||z&&(!t||H));return q?M.push(O):Um({matchUp:O})?C.push(O):Y?E.push(O):P.push(O)}),{includesTeamMatchUps:_,abandonedMatchUps:U,completedMatchUps:C,upcomingMatchUps:E,pendingMatchUps:P,byeMatchUps:M,structure:b}}function y$e({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:tt};if(!i)return{error:Is};let{links:n}=X0({drawDefinition:t,structureId:i}),r=n.source.reduce((o,s)=>!s.source.roundNumber||s.source.roundNumber===e?o.concat(s):o,[]),a=n.target.reduce((o,s)=>!s.target.roundNumber||s.target.roundNumber===e?o.concat(s):o,[]);return{links:{source:r,target:a}}}function bL({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var r;let a=n.find(o=>{var s,l;let c=!((s=o.source)!=null&&s.finishingPositions)||!t||Ya(t,(l=o.source)==null?void 0:l.finishingPositions);return e===o.linkCondition&&c&&o.linkType===i});return[Ep,Td].includes(a==null?void 0:a.linkType)&&!((r=a==null?void 0:a.source)!=null&&r.roundNumber)?oe({result:{error:Ie},stack:"getTargetLink",context:a}):a}function X0({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var a,o;return((a=r.source)==null?void 0:a.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((o=r.target)==null?void 0:o.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:Is}:{error:tt}}function I$e({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(o=>o.roundNumber===i&&!o.matchUpTieId),a=t.filter(o=>o.roundNumber===i+1&&!o.matchUpTieId);if(a.length){let o;return a.length===r.length?o=a.find(s=>s.roundPosition===n):a.length===r.length/2&&(o=a.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:o}}return{message:"no progression found"}}function wL({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var a;if(!r)return{error:DW};let{target:{structureId:o,feedProfile:s,groupedOrder:l,roundNumber:c,positionInterleave:u}}=r,{structure:d}=Dt({drawDefinition:n,structureId:o}),{positionAssignments:p}=Vi({structure:d}),h=(e==null?void 0:e.filter(E=>E.structureId===(d==null?void 0:d.structureId))).filter(E=>E.roundNumber===c&&!E.matchUpTieId),f=h.length,m=Xe(1,f+1),g=f/t,v=Math.ceil(g*i),y=1-i%2;if(u!=null&&u.interleave&&g!==.5){let E=u.offset+(i-1)*u.interleave,P=i+E;v=Math.ceil(P/2),y=1-P%2}let I=m,b=m[v-1],D=dpe({roundPositionsCount:m.length,groupedOrder:l}),w=(D==null?void 0:D.length)||1;if(w<=m.length){let E=f/w,P=jr(m,E);s===Hm&&P.forEach(M=>M.reverse()),I=(D==null?void 0:D.length)&&(D==null?void 0:D.map(M=>P[M-1]).flat())||I}s===yl?b=I[v-1]:s===Hm?((!(D!=null&&D.length)||w>m.length)&&(v=h.length+1-v),b=I[v-1]):s===Ak&&qs()&&console.log(yk,{feedProfile:s});let S=b&&h.reduce((E,P)=>P.roundPosition===b?P:E,void 0),U;S!=null&&S.feedRound?(y=0,U=Math.min(...(S.drawPositions||[]).filter(Boolean))):U=((a=S==null?void 0:S.drawPositions)==null?void 0:a.length)===2&&(S==null?void 0:S.drawPositions[y]);let C=p==null?void 0:p.find(({drawPosition:E})=>E===U);if(C){let{extension:E}=jt({element:C,name:Ek});if(E!=null&&E.value)return{disabledDrawPosition:U}}return{matchUp:S,targetDrawPosition:U,matchUpDrawPositionIndex:y}}function Xa({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let a=i;t.length&&!a&&(a=t.find(s=>s.matchUpId===r));let{structure:o}=Dt({structureId:a==null?void 0:a.structureId,drawDefinition:n});return(o==null?void 0:o.finishingPosition)===oI?b$e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:o,matchUp:a}):w$e({matchUp:a})}function b$e({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var a,o,s;let{winnerMatchUpId:l,loserMatchUpId:c}=r,{links:u}=y$e({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),d=u==null?void 0:u.source,p=bL({source:d,linkType:Ep}),h=bL({linkCondition:Ud,linkType:Td,source:d}),f=bL({source:d,linkType:Td}),m=h&&f;f||(f=h);let g=(a=p==null?void 0:p.target)==null?void 0:a.feedProfile,v=(o=f==null?void 0:f.target)==null?void 0:o.feedProfile,y=(s=h==null?void 0:h.target)==null?void 0:s.feedProfile,I,b,D,w,S,U,C,E,P,M;if(e&&(l||c)&&(C=l&&g!==hc&&t.find(({matchUpId:A})=>A===l),w=c&&v!==hc&&t.find(({matchUpId:A})=>A===c),C||w))return{matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p},targetMatchUps:{loserMatchUp:w,winnerMatchUp:C}};let{roundPosition:N}=r;M=M||t.filter(A=>A.structureId===n.structureId);let R=M.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return f&&!w&&v!==hc&&({matchUpDrawPositionIndex:U,targetDrawPosition:S,matchUp:w}=wL({targetLink:f,sourceRoundMatchUpCount:R,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),m&&y!==hc&&({matchUpDrawPositionIndex:D,targetDrawPosition:b,matchUp:I}=wL({targetLink:h,sourceRoundMatchUpCount:R,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),p&&!C&&g!==hc&&({matchUpDrawPositionIndex:P,targetDrawPosition:E,matchUp:C}=wL({targetLink:p,sourceRoundMatchUpCount:R,inContextDrawMatchUps:t,sourceRoundPosition:N,drawDefinition:i})),C||(M=M||t.filter(A=>A.structureId===n.structureId),{matchUp:C}=I$e({structureMatchUps:M,matchUp:r})),ft({matchUp:r,targetLinks:{loserTargetLink:f,winnerTargetLink:p,byeTargetLink:h},targetMatchUps:{winnerMatchUpDrawPositionIndex:P,loserMatchUpDrawPositionIndex:U,byeMatchUpDrawPositionIndex:D,winnerTargetDrawPosition:E,loserTargetDrawPosition:S,byeTargetDrawPosition:b,winnerMatchUp:C,loserMatchUp:w,byeMatchUp:I},targetMatchUpIds:!!(l||c)})}function w$e({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function S$e({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var r,a,o,s,l,c;let{matchUpId:u,structureId:d,drawPositions:p=[]}=n,{structure:h}=Dt({drawDefinition:t,structureId:d});if((h==null?void 0:h.finishingPosition)===W0){let{roundNumber:f}=n,m=f&&St(f)+1,g=h.matchUps??[],{roundMatchUps:v}=Za({matchUps:g});if(m&&v!=null&&v[m]){let y=[...p].sort(or).map((I,b)=>{let D=v[m].find(w=>{var S;return(S=w.drawPositions)==null?void 0:S.includes(I)});return{matchUpId:D==null?void 0:D.matchUpId,roundNumber:m,schedule:D==null?void 0:D.schedule,sideNumber:b+1,structureName:h.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=Xa({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:u}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=SL({upcomingMatchUp:m}),y=SL({upcomingMatchUp:g});if(n.matchUpStatus!==wi&&(g==null?void 0:g.matchUpStatus)===wi){let{matchUp:b}=gpe({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=b&&SL({upcomingMatchUp:b})||y}let I=(r=n.schedule)==null?void 0:r.timeAfterRecovery;if(I&&((a=v==null?void 0:v.schedule)!=null&&a.scheduledTime&&ri(v.schedule.scheduledTime)<ri(I)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&ri(y.schedule.scheduledTime)<ri(I)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(s=n.drawPositions)==null?void 0:s.filter(Boolean).length){let b=((c=(l=f.targetLinks)==null?void 0:l.loserTargetLink)==null?void 0:c.linkCondition)===Ud,D=T$e(n);if(D.length){let w=cB(m==null?void 0:m.sides),S=cB(g==null?void 0:g.sides),U=D.find(({participantId:E})=>w.includes(E))?[]:D,C=D.find(({participantId:E})=>S.includes(E))?[]:D;g&&b&&C.length<2&&C.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),C!=null&&C.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(C))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function T$e(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function gpe({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var n;let{matchUpId:r,matchUpStatus:a,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Fn)return{matchUp:t};if(a===wi){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((n=Xa({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:r}))==null?void 0:n.targetMatchUps)||{},gpe({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function SL(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:a,structureName:o}))(t.upcomingMatchUp)}function lr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=J0(t);if(i.error)return oe({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:a,pendingMatchUps:o,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...a??[],...o??[],...s??[]),matchUpsMap:l}}function J0(t){if(!(t!=null&&t.drawDefinition))return{error:tt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,requireParticipants:o,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:I,inContext:b,context:D,event:w}=t,S=[],U=[],C=[],E=[],P=[];v&&!i&&(i=Qp({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:w}));let M;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(b||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:M}=j3({participants:e,participantsProfile:s})));let{structures:N}=Pd({drawDefinition:y});if(!N)return{error:wn};n||(n=da({drawDefinition:y}));let R=y&&ppe({drawDefinition:y}).exitProfiles;N.forEach(O=>{let{byeMatchUps:x=[],pendingMatchUps:F=[],upcomingMatchUps:$=[],completedMatchUps:V=[],abandonedMatchUps:G=[]}=zk({matchUpFilters:I?void 0:h,contextFilters:I?void 0:p,inContext:b||I||p,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:o,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:R,matchUpsMap:n,structure:O,context:D,event:w});S=S.concat(...G),U=U.concat(...V),C=C.concat(...$),E=E.concat(...F),P=P.concat(...x)});let A=O=>(!h&&!I&&!p||(h&&(O=lv({matchUps:O,...h})),p&&(O=lv({matchUps:O,...p,processContext:!0}))),O),_={abandonedMatchUps:A(S),completedMatchUps:A(U),upcomingMatchUps:A(C),pendingMatchUps:A(E),byeMatchUps:A(P),matchUpsMap:n,...re,groupInfo:M};if(I){let O=typeof I=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:x,completed:F,upcoming:$,pending:V,bye:G}=O,j=[].concat(...x&&S||[],...F&&U||[],...$&&C||[],...V&&E||[],...G&&P||[]);S$e({inContextDrawMatchUps:j,drawDefinition:y})}return _}function Zm({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:tt};let r={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=lr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(a=>a.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)){let a=(i==null?void 0:i.drawMatchUps)??[];iC({matchUps:a})}return(t??[]).filter(({collectionId:a})=>!a).forEach(a=>{let{matchUpId:o,structureId:s}=a,l=Xa({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:o}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=Wm({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===o);if(h&&(d&&(r.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(a,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[h.matchUpId]=p,a.loserMatchUpId=p,h.loserMatchUpId=p,a.finishingPositionRange))){let f=u.finishingPositionRange&&[...a.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];a.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function vpe(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function U$e(t){let e=Object.assign({},...xh.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return vpe(e[t])}var xh=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function ype({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,a=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function o(s){let{nationalityCode:l}=s||{};if(l){let c=xh.find(({iso:u})=>u===l);i&&c!=null&&c.ioc&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&c!=null&&c.iso2&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}a.forEach(o)}function D$e({participantMap:t,template:e}){var i;let n=Object.values(t);for(let r of n){let a=r.participant;if((i=a.individualParticipantIds)!=null&&i.length){a.individualParticipants=[];for(let o of a.individualParticipantIds){let s=t[o].participant;a.individualParticipants.push(e?ay({template:e,source:s}):s)}}}}function kg(t){var e;let{tournamentRecord:i,participantId:n}=t,r=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(let a of Object.values(r)){let o=(e=a.participants)==null?void 0:e.find(s=>s.participantId===n);if(o)return{participant:o,tournamentId:a.tournamentId}}return{error:Gn}}function Mu({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:n}){if(!n)return{error:dt,info:h3};if(e&&!Array.isArray(e))return{error:Ie,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:GW};let r=n.timeItems.filter(o=>(o==null?void 0:o.itemType)===i).filter(o=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=o==null?void 0:o.itemSubTypes)==null?void 0:l.includes(s)})).sort((o,s)=>{let l=new Date(o.createdAt||void 0).getTime(),c=new Date(s.createdAt||void 0).getTime();return l-c}),a=r.pop();if(a){let o={timeItem:a,...re};return t&&Object.assign(o,{previousItems:r}),o}else return{info:Sa}}function iq({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Fc};if(!e.timeItems)return{info:Sa};let{timeItem:r,previousItems:a,info:o}=Mu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function gC({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:_i};if(!n.timeItems)return{info:Sa};let{timeItem:r,previousItems:a,info:o}=Mu({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:a}||{info:o}}function vC({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Ne};if(!e.timeItems)return{info:Sa};let{timeItem:r,previousItems:a,info:o}=Mu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:a}||{info:o}}function nq({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:Ne};if(!i)return{error:vr};let a=kg({tournamentRecord:e,participantId:i});if(a.error)return a;let{participant:o}=a;if(!(o!=null&&o.timeItems))return{info:Sa};let{timeItem:s,previousItems:l,info:c}=Mu({element:a.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:c}}var P$e={[bs]:"groupParticipantIds",[Ot]:"pairParticipantIds",[Gi]:"teamParticipantIds"},C$e={[bs]:"groups",[Gi]:"teams"};function Ipe({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:a,withISO2:o,withIOC:s}){let l={};for(let c of i.participants??[]){let u=c==null?void 0:c.participantId;u&&R$e({participantMap:l,participantId:u})}for(let c of i.participants??[]){let u=ot(c,e,a),{participantId:d,individualParticipantIds:p,participantType:h}=u;if(Object.assign(l[d].participant,u),p&&M$e({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:h,participantId:d}),n&&(l[d].participant.signedIn=E$e(u)),r){let{ratings:f,rankings:m,seedings:g}=B0({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=f}(s||o)&&ype({participant:l[d].participant,withISO2:o,withIOC:s})}if(t){let c=on(t)?t:void 0;D$e({participantMap:l,template:c})}return{participantMap:l}}function E$e(t){let{timeItem:e}=Mu({itemType:nC,element:t});return(e==null?void 0:e.itemValue)===RU}function M$e({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(let a of t){let o=i[a].participant;if(o[P$e[n]].push(r),[Gi,bs].includes(n)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e,p=C$e[n];o[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(n===Ot){let s=t.find(l=>l!==a);i[a].pairIdMap[r]=s,i[a].pairIdMap[s]=r}}}function R$e({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[Un]:{...i},[qi]:{...i},[Gi]:{...i},...i}}}function dI({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var a;if(e)return{participantMap:(a=Ipe({...t,...n,tournamentRecord:i}))==null?void 0:a.participantMap};let o=ot(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>ype({participant:l,...t}));let s;if((r||t!=null&&t.withGroupings)&&o!=null&&o.length&&({participantsWithGroupings:o,groupInfo:s}=j3({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:c,rankings:u}=B0({participant:l});l.rankings=u,l.ratings=c}return{participants:o,groupInfo:s}}function eh(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:h,nextMatchUps:f,inContext:m,context:g,event:v}=t;if(!v)return{error:_i};let{eventId:y,eventName:I,endDate:b,eventType:D,category:w,gender:S,matchUpFormat:U}=v??{},C={...g,...ft({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:U,eventName:I,eventType:D,category:w,eventId:y,gender:S})};b&&(C.endDate=b),p&&!i&&(i=Qp({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let E;if(!(e!=null&&e.length)&&!n&&u){let N=dI({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],E=N.groupInfo}let P=v.drawDefinitions??[],M=pC({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:P.flatMap(N=>{let{matchUps:R}=lr({tournamentParticipants:e,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,context:C,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:M,nextMatchUps:f,inContext:m,event:v});return R??[]}),groupInfo:E}}function Hr(t){let e=vi(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:Ne};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:a,afterRecoveryTimes:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:h,nextMatchUps:f,context:m}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=dI({participantsProfile:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:y}=Mi({tournamentRecord:c}),I={...m,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},b=Qp({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(D=>{var w;return I.eventDrawsCount=((w=D.drawDefinitions)==null?void 0:w.length)??0,eh({context:I,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:a,afterRecoveryTimes:o,policyDefinitions:l,tournamentRecord:c,contextContent:b,contextFilters:h,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:f,participants:n,inContext:u,event:D}).matchUps??[]}).concat(...c.matchUps??[])}}function Nc({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){return typeof n!="object"||!Object.keys(n).length?{error:Cn}:{matchUps:Object.keys(n).map(c=>{let u=n[c];return Hr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:u,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function pI(t,e){return N$e(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function N$e(t,e){return(cy[t==null?void 0:t.stage]||0)-(cy[e==null?void 0:e.stage]||0)}function ro(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:I,eventName:b,endDate:D,eventType:w,category:S,gender:U,matchUpFormat:C}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:C,eventType:w,eventName:b,category:S,eventId:I,endDate:D,gender:U},P;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:P}=dI({participantsProfile:o,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=Qp({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...lr({context:E,tournamentAppliedPolicies:a,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:P}}function Xl(t){var e;let i=Eu(t),n=t.matchUps??[],r=t.drawIds??[],{includeParticipantDependencies:a,tournamentRecord:o,drawDefinition:s}=t;if(!Array.isArray(n))return{error:Nd};if(!Array.isArray(r))return{error:Fc};let l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:n.map(I=>I.matchUpId);if(!Array.isArray(l))return{error:_0};let c={},u={},d={},p={};o&&!Object.keys(i).length&&(i={[o.tournamentId]:o});let h=Object.values(i),f=h.reduce((I,b)=>I.concat(b.events??[]).map(D=>(D.drawDefinitions||[]).map(w=>w.links||[])).flat(1/0),[]).filter(({linkType:I})=>I===Cp),m=n;if(f.length){m=Nc({nextMatchUps:!0,tournamentRecords:i}).matchUps;let I=f.reduce((b,D)=>{var w,S;let U=(w=D.source)==null?void 0:w.structureId,C=(S=D.target)==null?void 0:S.structureId;return U&&C&&(d[C]=U),U&&!b.includes(U)&&b.push(U),b},[]);for(let b of I)c[b]=[];for(let b of m??[]){let D=b.containerStructureId||b.structureId;I.includes(D)&&c[D].push(b.matchUpId)}}let g=I=>{u[I]||(u[I]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[I]=[])},v=(I,b)=>{u[I].matchUpIds.forEach(D=>{u[b].matchUpIds.push(D)}),u[b].matchUpIds.push(I),u[I].dependentMatchUpIds.push(b),a&&u[I].participantIds.forEach(D=>u[b].participantIds.push(D))},y=I=>{let b=Object.keys(c).length;for(let D of I||[]){let{matchUpId:w,winnerMatchUpId:S,loserMatchUpId:U}=D;if(!l.length||l.includes(w)){if(g(w),a){let{individualParticipantIds:P}=Fk(D);u[w].participantIds=P}S&&(g(S),v(w,S),p[S].push(w)),U&&(g(U),v(w,U),p[U].push(w)),u[w].sources.push(p[w]);let C=p[w].map(P=>u[P].sources[0]).flat(),E=p[w].map(P=>u[P].sources[1]).flat();if(u[w].sources.push(C,E),b){let P=D.containerStructureId||D.structureId,M=d[P];if(c[M])for(let N of c[M])g(N),v(N,w),p[N].push(w)}}}};if(s)Zm({drawDefinition:s}),m!=null&&m.length||(m=ro({drawDefinition:s}).matchUps),y(m);else{if(m!=null&&m.length||(m=Nc({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){let I=h!=null&&h.length?h.map(({events:b=[]})=>b.map(({drawDefinitions:D=[]})=>D.map(({drawId:w})=>w))).flat(1/0):[];I&&(r=I)}for(let I of r){let b=m==null?void 0:m.filter(D=>D.drawId===I).sort(pI);if(!(b!=null&&b.find(({roundPosition:D})=>!D))){let D=b==null?void 0:b.find(({tournamentId:S})=>S),{drawDefinition:w}=po({tournamentRecord:i[D==null?void 0:D.tournamentId],drawId:I});w&&Zm({drawDefinition:w})}y(b)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:p,matchUps:m,...re}}function zr(t){var e,i;let n=t==null?void 0:t.matchUp,r=(t==null?void 0:t.score)||(n==null?void 0:n.score),a=(e=r==null?void 0:r.sets)==null?void 0:e[0],{side1Score:o,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:c,side1PointScore:u,side2PointScore:d}=a||{},p=o||s||l||c||u||d;return!!(((i=r==null?void 0:r.sets)==null?void 0:i.length)>1||p)}function yC({matchUpStatus:t}){return yde.includes(t)}function A$e({matchUpStatus:t}){return b3.includes(t)}function yB({matchUpStatus:t}){return Ide.includes(t)}function rq({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var a;let o=n==null?void 0:n.find(({participantId:l})=>l),s=(a=i==null?void 0:i.filter(rq))==null?void 0:a.length;return zr({score:r})||s||e&&o||t&&A$e({matchUpStatus:t})&&![mi,Ci,ql].includes(t)}function IC(t){var e;let{drawDefinition:i,findContainer:n,structureId:r,event:a}=t,o=t.structure,s={isCollectionMatchUp:!1},{containedStructures:l}=q0({drawDefinition:i}),c=r?l[r]||[]:[];if(!o){let U=Dt({drawDefinition:i,structureId:r});if(U.error)return U;o=n?U.containingStructure??U.structure:U.structure}if(Yo({structure:o}))return{structure:o,isAdHoc:!0,error:N0};let{matchUps:u}=lr({inContext:!0,matchUpFilters:s,drawDefinition:i,event:a}),d=u==null?void 0:u.filter(U=>U.structureId===r||c.includes(U.structureId)),{matchUpDependencies:p}=Xl({drawIds:[i.drawId],matchUps:u,drawDefinition:i}),h=[],f=[],m={},g=[];for(let U of u??[]){if(U.structureId===r||c.includes(U.structureId)){f.push(...U.drawPositions??[]);let C=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!m[E]||C&&m[E]>C)&&(m[E]=C)}rq(U)&&(g.push(U),h.push(U.matchUpId,...((e=p==null?void 0:p[U==null?void 0:U.matchUpId])==null?void 0:e.matchUpIds)||[]))}let v=$t(f.filter(Boolean)).sort(or),y=$t(h),I=$t(d==null?void 0:d.map(({matchUpId:U,drawPositions:C})=>y.includes(U)?C:[]).flat().filter(Boolean)).sort(or),{positionAssignments:b}=Vi({drawDefinition:i,structure:o}),D=b==null?void 0:b.filter(U=>U.bye).map(U=>U.drawPosition),w=b==null?void 0:b.filter(U=>U.qualifier).map(U=>U.drawPosition),S=(v==null?void 0:v.filter(U=>!I.includes(U)))||[];return{allDrawPositions:v,inContextStructureMatchUps:d,drawPositionInitialRounds:m,activeDependentMatchUpIds:y,qualifyingDrawPositions:w,inactiveDrawPositions:S,positionAssignments:b,activeDrawPositions:I,byeDrawPositions:D,activeMatchUps:g,structure:o}}function dy({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(or)[0]}}var vh={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},qR=[];function js(t,e){typeof t=="string"&&(t={method:t}),(e||qs())&&qR.push(t)}function _$e(t){let e=qR.slice();return t&&(qR.length=0),e}function k$e(t){let e=_$e(t).map(i=>{let{color:n,keyColors:r,method:a,newline:o}=i,s=Object.keys(vh).includes(n)?vh[n]:vh.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&vh[r[u]]?vh[r[u]]:vh.brightwhite;return`${vh.white}${u}: ${d}${i[u]}`}).join(", "),c=(a==null?void 0:a.length)<15?"		":"	";return[o?`
`:"",s,a,c,vh.white,l,vh.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function O$e(){qR.length=0}function ws({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:a,structureId:o,structure:s,event:l}){var c,u,d;if(!n)return{error:tt};if(s||({structure:s}=Dt({drawDefinition:n,structureId:o})),!s)return{error:wn};o||({structureId:o}=s);let p="assignDrawPositionBye";js({method:p,color:"cyan",drawPosition:r}),a||(a=da({drawDefinition:n}));let{positionAssignments:h}=Vi({structure:s}),{activeDrawPositions:f}=IC({drawDefinition:n,structureId:o});if((c=h==null?void 0:h.find(P=>P.drawPosition===r))!=null&&c.bye)return{...re};if(f!=null&&f.includes(r))return{error:lk};let m=h==null?void 0:h.find(P=>P.drawPosition===r);if(!m)return{error:N0};let{filled:g,containsBye:v,assignedParticipantId:y}=x$e(m);if(v)return{...re};if(g&&!v)return oe({result:{error:aw},stack:p});let I=lr({inContext:!0,drawDefinition:n,matchUpsMap:a}).matchUps??[],b={isCollectionMatchUp:!1},{matchUps:D}=Ui({provisionalPositioning:t,drawDefinition:n,matchUpFilters:b,matchUpsMap:a,structure:s});if(h==null||h.forEach(P=>{P.drawPosition===r&&(P.bye=!0)}),s.structureType===eo)return L$e({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:D}),af({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),mY({assignedParticipantId:y,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:p});let{roundProfile:w,roundMatchUps:S}=Za({matchUps:D}),U=(u=w&&Object.keys(w).map(P=>parseInt(P)).reverse())==null?void 0:u.find(P=>{var M;return(M=w==null?void 0:w[P].drawPositions)==null?void 0:M.includes(r)}),C=U?S==null?void 0:S[U].find(({drawPositions:P})=>P==null?void 0:P.includes(r)):void 0;C&&bpe({tournamentRecord:i,drawDefinition:n,matchUp:C,event:l});let E=(d=C==null?void 0:C.drawPositions)==null?void 0:d.find(P=>P!==r);if(C&&E){let P=aq({sourceDrawPositions:C.drawPositions,matchUpId:C.matchUpId,inContextDrawMatchUps:I,drawPositionToAdvance:E,tournamentRecord:i,drawDefinition:n,matchUpsMap:a});if(P.error)return P}return af({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),mY({assignedParticipantId:y,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:o,stack:p})}function mY({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:n,structureId:r,stack:a}){return e&&Lk({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:n,structureId:r,name:a}}),oe({result:{...re},stack:a})}function x$e(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function bpe({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:wi,score:void 0,winningSide:void 0}),si({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function L$e({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(a=>{var o;(o=a.drawPositions)!=null&&o.includes(i)&&bpe({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:a})})}function aq({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,event:s}){var l,c;js({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let u=a.drawMatchUps.find(D=>D.matchUpId===o),d=(l=e.find(D=>D.matchUpId===o))==null?void 0:l.structureId,{structure:p}=Dt({drawDefinition:r,structureId:d}),{positionAssignments:h}=Vi({structure:p}),f=h==null?void 0:h.filter(D=>D.bye).map(D=>D.drawPosition),m=(c=u==null?void 0:u.drawPositions)==null?void 0:c.find(D=>D!==t),g=m&&(f==null?void 0:f.includes(m)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:I,loserTargetDrawPosition:b}}=Xa({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:o});if(I&&I.structureId===(p==null?void 0:p.structureId)&&F$e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:I,matchUpsMap:a,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){let{roundNumber:D}=y;if(D===1){let w=ws({structureId:v.target.structureId,drawPosition:b,tournamentRecord:n,drawDefinition:r,event:s});if(w.error)return w}else wpe({loserTargetDrawPosition:b,tournamentRecord:n,loserTargetLink:v,drawDefinition:r,loserMatchUp:y,matchUpsMap:a,event:s})}return{...re}}function F$e({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:a,matchUpsMap:o,event:s}){var l,c,u,d,p,h;let f="advanceWinner",m=o.drawMatchUps.find($=>$.matchUpId===a.matchUpId),g=(l=e.find($=>$.matchUpId===a.matchUpId))==null?void 0:l.structureId,{structure:v}=Dt({drawDefinition:r,structureId:g}),{positionAssignments:y}=Vi({structure:v}),I=(c=y==null?void 0:y.find(({drawPosition:$})=>$===t))==null?void 0:c.bye,b=(u=m.drawPositions)==null?void 0:u.filter(Boolean),D=y==null?void 0:y.filter($=>b==null?void 0:b.includes($.drawPosition)),w=y==null?void 0:y.find(({drawPosition:$})=>$===t),S=i==null?void 0:i.find($=>$!==t),U=(d=S&&(D==null?void 0:D.find(({drawPosition:$})=>$===S)))==null?void 0:d.bye,C=I&&U;if(C&&console.log({isByeAdvancedBye:C}),(b==null?void 0:b.length)>1&&I&&!U)return oe({result:{error:aw},stack:f});let E=b==null?void 0:b.find($=>$!==t),P=C,M=[...(m.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),N=M.map($=>!$&&!P||$===t?(P=!0,t):$).sort(or);if(!P)return console.log("@@@@@@@",{advancingAssignmentIsBye:w,drawPositionToAdvance:t,existingAssignments:D}),oe({result:{error:aw},stack:f});let R=(p=y==null?void 0:y.find(({drawPosition:$})=>$===E))==null?void 0:p.bye,A=(h=y==null?void 0:y.find(({drawPosition:$})=>$===t))==null?void 0:h.bye;Object.assign(m,{matchUpStatus:A||R?wi:Fn,score:void 0,winningSide:void 0,drawPositions:N});let _=m.drawPositions.find($=>!M.includes($));js({method:f,color:"brightyellow",changedDrawPosition:_,pairedDrawPositionIsBye:R,drawPositionIsBye:A}),si({tournamentId:n==null?void 0:n.tournamentId,matchUp:m,eventId:s==null?void 0:s.eventId,context:f,drawDefinition:r});let{targetLinks:{loserTargetLink:O},targetMatchUps:{loserMatchUp:x,loserTargetDrawPosition:F}}=Xa({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(R||A){let $=R?t:E;if($)aq({drawPositionToAdvance:$,matchUpId:a.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:o});else if(A&&O&&x)if(x.feedRound)wpe({loserTargetDrawPosition:F,tournamentRecord:n,loserTargetLink:O,drawDefinition:r,loserMatchUp:x,matchUpsMap:o});else{let V=1-a.roundPosition%2,G=x.drawPositions[V],j=ws({structureId:O.target.structureId,drawPosition:G,tournamentRecord:n,drawDefinition:r,event:s});if(j.error)return j}}}function wpe({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){let{roundNumber:s}=r;js({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((a==null?void 0:a.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=dy({drawPosition:t,matchUps:l});if(c===s){let u=ws({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:o});if(u.error)return u}}function Spe({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:a}){let{matchUps:o}=Ui({drawDefinition:i,matchUpsMap:n,structure:r,event:a});o.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?wi:Fn}),si({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:a==null?void 0:a.eventId,drawDefinition:i,matchUp:s}))})}function bC(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:a,structureId:o,matchUpsMap:s,event:l}=t,{structure:c}=Dt({drawDefinition:a,structureId:o}),u=(Rr({drawDefinition:a,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:A0};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=IC({drawDefinition:a,structureId:o});return d.includes(n)?{error:lk}:(e||({matchUps:e}=lr({inContext:!0,drawDefinition:a,matchUpsMap:s})),IB({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,structureId:o,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(af({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:c,event:l}),{...re,participantId:i}):{error:Dce})}function IB({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:a,event:o}){var s,l;let{structure:c}=Dt({drawDefinition:i,structureId:a});if(!c)return{error:wn};let u=Rr({drawDefinition:i,structure:c}).positionAssignments||[],d=u.some(I=>{if(I.drawPosition===n)return delete I.participantId,delete I.qualifier,delete I.bye,!0});if(c.structureType===eo)return Spe({positionAssignments:u,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:c}),{drawPositionCleared:d,...re};let p={isCollectionMatchUp:!1},{matchUps:h}=Ui({drawDefinition:i,matchUpFilters:p,matchUpsMap:r,structure:c,event:o}),{roundProfile:f,roundMatchUps:m}=Za({matchUps:h}),g=(s=f&&Object.keys(f))==null?void 0:s.map(I=>St(I)),v=n,y=(l=g==null?void 0:g.map(I=>{var b,D,w,S;let U=(D=(b=f==null?void 0:f[I])==null?void 0:b.pairedDrawPositions)==null?void 0:D.find(_=>_.includes(v)),C=U==null?void 0:U.find(_=>_!==v),E=u.find(_=>_.drawPosition===C),P=f==null?void 0:f[I+1],M=E==null?void 0:E.bye,N=(w=P==null?void 0:P.pairedDrawPositions)==null?void 0:w.find(_=>_.includes(C)),R=M&&N&&P&&((S=P.drawPositions)==null?void 0:S.includes(C)),A=U&&{pairedDrawPositionByeAdvancedPair:!R&&N,pairedDrawPosition:C,targetDrawPosition:v,relevantPair:U,roundNumber:I};return R&&(v=C),A}).filter(I=>I==null?void 0:I.targetDrawPosition))==null?void 0:l.reduce((I,b)=>{let{roundNumber:D,relevantPair:w,targetDrawPosition:S,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:C}=b,E={roundNumber:D,targetDrawPosition:S,relevantPair:w},P=C&&{roundNumber:D+1,targetDrawPosition:U,relevantPair:C,subsequentRoundRemoval:!0},M=[E,P].filter(Boolean);return I.concat(...M)},[]);return y==null||y.forEach(({roundNumber:I,targetDrawPosition:b,relevantPair:D})=>{let w=m==null?void 0:m[I].find(S=>{var U;return Ya((U=S.drawPositions)==null?void 0:U.filter(Boolean),D.filter(Boolean))});w&&($$e({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:a,roundNumber:I,matchUpsMap:r}),Tpe({inContextDrawMatchUps:t,positionAssignments:u,tournamentRecord:e,drawDefinition:i,targetMatchUp:w,drawPosition:n,matchUpsMap:r,structure:c,event:o}))}),{tasks:y,drawPositionCleared:d,positionAssignments:u}}function $$e({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:a,structureId:o}){let{structure:s}=Dt({drawDefinition:n,structureId:o});if(!s)return{error:wn};if(s.structureType===eo)return;r=r||da({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:c}=dy({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=a&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=Vi({drawDefinition:n,structureId:o}).positionAssignments??[];return u==null||u.forEach(p=>Tpe({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...re}}function Tpe({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){var c,u,d,p,h,f;let m="removeDrawPosition",g=(c=r.drawPositions)==null?void 0:c.slice(),v=r.matchUpStatus,y=r.winningSide;o=o??da({drawDefinition:n});let I=o.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:b}=dy({drawPosition:a,matchUps:I});if(r.roundNumber&&b&&r.roundNumber>b){let N=(r.drawPositions??[]).map(R=>R===a?void 0:R);r.drawPositions=N}if(r.matchUpType===Yi){let N=(((u=t==null?void 0:t.find(R=>R.matchUpId===r.matchUpId))==null?void 0:u.sides)??[]).reduce((R,A,_)=>A.drawPosition===a?_:R,void 0);N!==void 0&&(p=(d=r.sides)==null?void 0:d[N])!=null&&p.lineUp&&((h=r.sides)==null||delete h[N].lineUp,si({tournamentId:i==null?void 0:i.tournamentId,context:`${m}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let D=Xa({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:w},targetMatchUps:{loserMatchUp:S,winnerMatchUp:U,loserMatchUpDrawPositionIndex:C}}=D,E=e.filter(({drawPosition:N})=>{var R;return(R=r.drawPositions)==null?void 0:R.includes(N)}).filter(N=>N.bye).length,P=E&&wi||r.matchUpStatus&&[mi,Ci].includes(r.matchUpStatus)&&r.matcHUpStatus||((f=r.drawPositions)==null?void 0:f.length)===2&&Fn||void 0;r.matchUpStatus=P,r.matchUpStatus&&[Ci,mi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let M=g==null?void 0:g.find(N=>{var R;return!((R=r.drawPositions)!=null&&R.includes(N))});if(g!=null&&g.includes(a)&&v===r.matchUpStatus&&y===r.winningSide||(M&&js({method:m,color:"brightyellow",removedDrawPosition:M}),si({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${m}-${a}`,drawDefinition:n})),S&&S.structureId!==D.matchUp.structureId&&!E){let{drawPositions:N,roundNumber:R}=S;if(R===1){let A=N[C];IB({structureId:S.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o})}else{let A=Math.min(...N.filter(Boolean)),_=B$e({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:S,matchUpsMap:o,event:l});if(_.error)return oe({result:_,stack:m});let O=((o==null?void 0:o.mappedMatchUps)||{})[S.structureId].matchUps,{initialRoundNumber:x}=dy({drawPosition:A,matchUps:O});x===1&&(js({method:m,color:"brightyellow",loserMatchUpDrawPosition:A}),IB({structureId:S.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:o}))}}return U&&U.structureId!==D.matchUp.structureId&&w.target.feedProfile,{...re}}function B$e({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:a,event:o}){var s;let{structure:l}=Dt({structureId:r.structureId,drawDefinition:n}),{positionAssignments:c}=Vi({structure:l});if((s=c==null?void 0:c.find(u=>u.drawPosition===t))!=null&&s.bye){let u=bC({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:a,event:o});if(u.error)return u}return{...re}}function Og({drawDefinition:t,stages:e}){if(!t)return{error:tt};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=$t(i.map(r=>{let{positionAssignments:a}=Vi({structure:r});return a?a.map(Yt):[]}).flat().filter(Boolean));return{...re,assignedParticipantIds:n}}function Uc(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:a,entryStatus:o}=r,s=`_${a||nt}${o||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,a)=>i(r.entryPosition)-i(a.entryPosition)).map((r,a)=>{let o=a+1;return{...r,entryPosition:o}})).flat()}function cm(t){return[Eg,Kl].includes(t)}function KR({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:a,entryStage:o,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var p,h,f,m,g,v,y,I,b,D,w,S;if(!r||!Array.isArray(r))return{error:hu,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:_i};if(a&&!Vde.includes(a))return{error:tB};if(o&&!w3.includes(o))return{error:Ug};let U="modifyEntriesStatus",C=[];if(!a&&!s)return oe({result:{error:dt},info:"Missing entryStatus",stack:U});if(s&&!fu({extension:s,requiredAttributes:["name"]}))return oe({result:{error:Ie},info:"Invalid extension",context:{extension:s},stack:U});let E=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach(V=>{let G=Og({stages:u&&[u],drawDefinition:V}).assignedParticipantIds??[];E.push(...G)});let P=(i==null?void 0:i.participants)??[];if(!r.every(V=>{var G;let j=(G=ef({tournamentParticipants:P,participantId:V}))==null?void 0:G.participantType;return!(j&&[Ot,Vs].includes(j)&&cm(a))&&!(a&&d!=null&&d.eventType&&j===Zt&&[Ll,Ys].includes(d.eventType)&&[Ul,...rM].includes(a))}))return{error:tB};let M=d&&Vn({event:d}).flightProfile,N=(h=M==null?void 0:M.flights)==null?void 0:h.find(V=>V.drawId===c),R=V=>{let G=(V||[]).filter(z=>!u||!z.entryStage||u===z.entryStage).filter(({participantId:z})=>r.includes(z)),j=z=>a&&E.includes(z.participantId)&&!(rM.includes(z.entryStatus)&&rM.includes(a));return G.every(z=>j(z)&&!e?!1:(a&&(z.entryStatus=a,delete z.entryPosition),o&&(z.entryStage=o,delete z.entryPosition),s&&(s.value?ui({element:z,extension:s}):Va({element:z,name:s.name})),!0))?{...re}:{error:O0}},A=({flight:V,drawDefinition:G})=>{d&&(d.entries=Uc({entries:d.entries??[]})),V&&(V.drawEntries=Uc({entries:V.drawEntries})),G&&(G.entries=Uc({entries:G.entries}))},_=V=>{let{flight:G,drawDefinition:j}=V,z="updateDrawEntries";if(G){let H=R(G.drawEntries);if(H.error)return oe({result:H,stack:z})}if(j){let H=R(j.entries);if(H.error)return oe({result:H,stack:z});C.includes(j.drawId)||C.push(j.drawId)}return{...re}},O=((f=d==null?void 0:d.entries)==null?void 0:f.find(({entryPosition:V})=>V))??(((m=N==null?void 0:N.drawEntries)==null?void 0:m.find(({entryPosition:V})=>V))||((g=n==null?void 0:n.entries)==null?void 0:g.find(({entryPosition:V})=>V)));if(t&&!O&&A({flight:N,drawDefinition:n}),N||n){let V=_({flight:N,drawDefinition:n});if(V.error)return oe({result:V,stack:U})}let x=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:V})=>V))??[],F=((y=M==null?void 0:M.flights)==null?void 0:y.filter(V=>!x.includes(V.drawId)))||[];for(let V of F){let G=V&&_({flight:V});if(G!=null&&G.error)return oe({result:G,stack:U})}let $=((I=M==null?void 0:M.flights)==null?void 0:I.length)===1&&(((b=d==null?void 0:d.drawDefinitions)==null?void 0:b.length)??0)<=((D=M==null?void 0:M.flights)==null?void 0:D.length);if(!N&&!n&&a&&Bde.includes(a))return{error:oue};if(!N&&!n||a===Rp||l&&$){let V=R(d==null?void 0:d.entries);if(V!=null&&V.error)return oe({result:V,stack:U});let G;if(a===Rp&&((w=M==null?void 0:M.flights)==null||w.every(j=>{let z=R(j.drawEntries);return z.error?(G=z.error,!1):(j.drawEntries=j.drawEntries.filter(({participantId:H})=>!r.includes(H)),!0)}),(S=d==null?void 0:d.drawDefinitions)==null||S.every(j=>{var z;let H=R(j.entries);return H.error?(G=H.error,!1):(j.entries=(z=j.entries)==null?void 0:z.filter(({participantId:K})=>!r.includes(K)),!0)})),G)return oe({result:{error:G},stack:U})}t&&A({flight:N,drawDefinition:n});for(let V of(d==null?void 0:d.drawDefinitions)??[])C.length&&!C.includes(V.drawId)||Ji({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:V});return{...re}}function Upe(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===wi||e[i].scheduleItems.push({...u,scheduledDate:Lt(u==null?void 0:u.scheduledDate),scheduledTime:rn(u==null?void 0:u.scheduledTime),checkScoreHasValue:zr({score:p}),matchUpStatus:n,roundPosition:r,structureId:a,matchUpType:o,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function td({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:tI};if(!on(e))return{error:Ie};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:a,scaleType:o,eventType:s,scaleName:l}=e,c=[ry,o,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==ry)return{error:HP};let m=((r=a&&Rv({element:u.itemValue,accessor:a}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...re,scaleItem:g}}}return{...re,scaleItem:void 0}}function V$e({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var a,o,s;let l={},c=h=>[ry,Qu,r.eventType,h].join("."),u=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===Qu).map(({itemType:h,itemValue:f})=>({[h]:f}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(c),p=Ln(Object.keys(u),d);if((!e||!Object.keys(u).length&&!((a=t==null?void 0:t.drawIds)!=null&&a.length)||p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=c(t.stageSeedingScaleNames[m]),v=u[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else if(p){let h=p.map(f=>u[f]);l.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=c(i[m]),v=u[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:Qu,scaleName:v},I=td({scaleAttributes:y,participant:n});if(I.scaleItem){g=I.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(o=t==null?void 0:t.published)==null?void 0:o.drawIds)!=null&&s.length))){let v=g.scaleValue;l.seedValue=v}}return l}function j$e({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:a,ranking:o,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...d3(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:o,eventId:a});i.events[a]=ft(h,!1,!1,!0),n&&(e&&(i.events[a].seedAssignments=e),r&&(i.events[a].seedValue=r))}function Wk(t,e){return(t||"").localeCompare(e||"")}function G$e({tournamentRecord:t,status:e=Zl}){var i,n,r;let a=`${Ng}.${Ag}`;return(r=(n=(i=vC({tournamentRecord:t,itemType:a}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function H$e(t){let{tournamentId:e}=t??{};return!!e}function tl({event:t,status:e=Zl}){var i,n,r;let a=`${Ng}.${Ag}`;return(r=(n=(i=gC({itemType:a,event:t}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function oq({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function hI(t){var e,i,n,r,a,o,s;let{tournamentRecord:l,drawDefinition:c,eventIds:u,eventId:d,drawIds:p,drawId:h,event:f}=t??{};if(l&&!H$e(l))return{error:Ie};if(d&&!f)return{error:Wo};if(Array.isArray(u)&&u!=null&&u.length){let I={};for(let b of u){if(!co(b))return{error:Ie};let D=(e=po({tournamentRecord:l,eventId:b}))==null?void 0:e.event;if(!D)return{error:Wo};let w=TL({event:D});I[b]=w}return{...re,publishState:I}}if(f){let I=TL({event:f}),b={};if(h)return c?{publishState:{status:{published:!!((i=I.status.publishedDrawIds)!=null&&i.includes(h)),drawDetail:(n=I.status.drawDetails)==null?void 0:n[h]},...re}}:{error:zo};if(Array.isArray(p)&&p!=null&&p.length){let D=((r=f.drawDefinitions)==null?void 0:r.map(DU))??[];for(let w of p){if(!co(w))return{error:Ie};if(!D.includes(w))return{error:zo};b[w]={status:{published:!!I.status.publishedDrawIds.includes(w),drawDetail:(a=I.status.drawDetails)==null?void 0:a[w]}}}}else b=I;return{...re,publishState:b}}let m=[],g=!1,v={},y=G$e({tournamentRecord:l});v.tournament=y??{};for(let I of(l==null?void 0:l.events)??[]){let b=TL({event:I});v[I.eventId]=b,b.status.published&&(m.push(I.eventId),g=!0);for(let{drawId:D}of I.drawDefinitions??[]){let w=(s=(o=b.status)==null?void 0:o.publishedDrawIds)==null?void 0:s.includes(D);w&&(v[D]={status:{published:w}})}}return l&&(v.tournament.status={published:g,publishedEventIds:m}),{...re,publishState:v}}function TL({event:t}){var e;let i=tl({event:t});if(!i)return{status:{published:!1}};let n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);let r=i.drawDetails??{};for(let o of((e=t.drawDefinitions)==null?void 0:e.map(DU))||[])r[o]||(r[o]={publishingDetail:{published:!1}});let a=r&&Object.keys(r).length&&Object.keys(r).filter(o=>oq({drawDetails:r,drawId:o}))||i.drawIds;return{status:{published:a&&a.length>0,publishedDrawIds:a,publishedSeeding:n,drawDetails:r}}}function z$e({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:a,stageSequence:o,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[a],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:o,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===Ci&&(f.walkoverWinCount+=1),r===mi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=s),i===1&&(f.participantWon=n))}function gY(t){var e,i,n,r,a,o,s,l,c,u;let{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:h,participantMap:f,withOpponents:m,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:I,finishingRound:b,matchUpStatus:D,stageSequence:w,roundNumber:S,structureId:U,score:C,stage:E,withRankingProfile:P,tieWinningSide:M,roundPosition:N,matchUpTieId:R,matchUpSides:A,collectionId:_,matchUpType:O,winningSide:x,matchUpId:F,schedule:$,eventId:V,drawId:G,sides:j}=t,z=m&&(j==null?void 0:j.length)===2&&Object.assign({},...j.map(({sideNumber:H},K)=>{let q=j[1-K].participantId;return H&&{[H]:q}}).filter(Boolean));for(let H of j){let{participantId:K,sideNumber:q,bye:Y}=H;if(Y)continue;let Z=x===q,Q=J=>{var te,se;let ee=(te=f[J])==null?void 0:te.participant,ce=ee==null?void 0:ee.participantType,fe=[{participantId:J,participantType:ce}];if(ce!==Vs)for(let ge of(ee==null?void 0:ee.individualParticipantIds)||[]){let he=(se=f[ge])==null?void 0:se.participant;fe.push({participantType:he==null?void 0:he.participantType,participantId:ge})}return fe},ie=(J,te)=>{if(g){if(f[J].matchUps[F]={participantWon:Z,matchUpType:O,structureId:U,sideNumber:q,matchUpId:F,eventId:V,drawId:G,stage:E},m){let se=Q(te);f[J].matchUps[F].opponentParticipantInfo=se}_&&(f[J].matchUps[F].collectionId=_)}m&&te&&(f[J].opponents[te]={participantId:te,matchUpId:F,eventId:V,drawId:G}),P&&z$e({finishingPositionRange:I,participantMap:f,participantWon:Z,finishingRound:b,matchUpStatus:D,participantId:J,stageSequence:w,roundNumber:S,structureId:U,matchUpId:F,drawId:G,stage:E}),(p||d)&&Upe({participantMap:f,participantId:J,matchUpStatus:D,roundPosition:N,matchUpType:O,roundNumber:S,structureId:U,matchUpId:F,schedule:$,drawId:G,score:C})},ue=({participant:J,partnerParticipantId:te})=>{var se,ee,ce;let fe=(ge,he)=>{ge&&(ge.partnerParticipantIds||(ge.partnerParticipantIds=[]),ge.partnerParticipantIds.includes(he)||ge.partnerParticipantIds.push(he))};y&&fe((se=J==null?void 0:J.draws)==null?void 0:se[G],te),v&&fe((ee=J==null?void 0:J.events)==null?void 0:ee[V],te),g&&fe((ce=J==null?void 0:J.matchUps)==null?void 0:ce[F],te)};if(K&&f[K]){let J=z==null?void 0:z[q];ie(K,J);let te=((e=f[K])==null?void 0:e.participant.participantType)===Ot,se=((i=f[K])==null?void 0:i.participant.individualParticipantIds)||[];if(R){if(h){let ee=ce=>f[ce].matchUps[R]={participantWon:M===q,matchUpId:R,matchUpType:Yi,sideNumber:q};ee(K),se.forEach(ee)}if(y&&!f[K].draws[G]){let ee=(r=(n=A.find(ge=>ge.sideNumber===q))==null?void 0:n.participant)==null?void 0:r.participantId,ce=(s=(o=(a=f[ee])==null?void 0:a.draws)==null?void 0:o[G])==null?void 0:s.entryStatus,fe=ge=>f[ge].draws[G]={entryStatus:ce,eventId:V,drawId:G};fe(K),se.forEach(fe)}}if(te&&(se.forEach(ee=>f[ee]&&ie(ee,J)),se.forEach((ee,ce)=>{let fe=se[1-ce],ge=f[ee];ge&&ue({participant:ge,partnerParticipantId:fe})}),v&&A)){let ee=(c=(l=A.find(ce=>ce.sideNumber===q))==null?void 0:l.participant)==null?void 0:c.participantId;if(ee){let ce=(u=f[ee])==null?void 0:u.events[V];ce?(f[K].events[V]={...ce},se.forEach(fe=>f[fe].events[V]={...ce})):console.log("Missing teamEntry",{eventId:V,teamParticipantId:ee})}}if(x){let ee=ce=>{Z?(f[ce].counters[O].wins+=1,f[ce].counters.wins+=1,D===Ci&&(f[ce].counters[O].walkoverWins+=1,f[ce].counters.walkoverWins+=1),D===mi&&(f[ce].counters[O].defaultWins+=1,f[ce].counters.defaultWins+=1)):(f[ce].counters[O].losses+=1,f[ce].counters.losses+=1,D===Ci&&(f[ce].counters[O].walkovers+=1,f[ce].counters.walkovers+=1),D===mi&&(f[ce].counters[O].defaults+=1,f[ce].counters.defaults+=1))};ee(K),se.forEach(ee)}}}}function W$e(t){var e,i,n,r,a,o,s;let{participantFilters:l,convertExtensions:c,policyDefinitions:u,tournamentRecord:d,usePublishState:p,contextProfile:h,participantMap:f,withPotentialMatchUps:m,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:I,withStatistics:b,withOpponents:D,withMatchUps:w,withSeeding:S,withEvents:U,withDraws:C}=t,E=l==null?void 0:l.participantIds,P=$=>{var V,G;let j=[$];return(G=(V=f[$])==null?void 0:V.participant.individualParticipantIds)==null||G.forEach(z=>j.push(z)),j.some(z=>!(E!=null&&E.length)||E.includes(z))?j:[]},M={withMatchUps:w||g,withEvents:U||g,withDraws:C||g,withPotentialMatchUps:m,withRankingProfile:g,withScheduleItems:v,scheduleAnalysis:y,withTeamMatchUps:I,withStatistics:b,participantMap:f,withOpponents:D,withSeeding:S},N=[],R={},A=[],_={},O={},x={},F=({eventType:$,scaleNames:V,participantId:G})=>{var j,z,H,K;return(K=(H=(z=(j=f[G].participant)==null?void 0:j.rankings)==null?void 0:z[$])==null?void 0:H.find(q=>V.includes(q.scaleName)))==null?void 0:K.scaleValue};for(let $ of(d==null?void 0:d.events)||[]){if(l!=null&&l.eventIds&&!l.eventIds.includes($.eventId))continue;let{drawDefinitions:V=[],extensions:G=[],eventType:j,eventName:z,category:H,entries:K,eventId:q,gender:Y}=$,{flightProfile:Z}=Vn({event:$}),Q=(Z==null?void 0:Z.flights)??[],ie=hI({event:$}).publishState;ie&&(_[q]=ie);let ue=(e=ie==null?void 0:ie.status)==null?void 0:e.publishedSeeding;if(U||S||g){let te=c?Object.assign({},...d3(G??[])):{};O[q]={...te,eventName:z,eventType:j,category:H,eventId:q,gender:Y};let se=[H==null?void 0:H.categoryName,H==null?void 0:H.ageCategoryCode].filter(Boolean);for(let ee of K){let{participantId:ce}=ee;if(!ce||!f[ce])continue;let fe=F({eventType:j,scaleNames:se,participantId:ce}),ge,he;if(S){let Ce=f[ce].participant;({seedAssignments:ge,seedValue:he}=V$e({publishedSeeding:ue,usePublishState:p,withSeeding:S,participant:Ce,event:$}))}let Se=Ce=>{var Fe,Je;if((Je=(Fe=f[Ce])==null?void 0:Fe.events)!=null&&Je[q])return;let xe=f[Ce];j$e({convertExtensions:c,seedAssignments:ge,participant:xe,withSeeding:S,seedValue:he,eventId:q,ranking:fe,entry:ee})};Se(ce),(f[ce].participant.individualParticipantIds||[]).forEach(Se)}}let J=(i=_==null?void 0:_[q])==null?void 0:i.publishedSeeding;if(C||g||S){let te=ee=>ee?Object.assign({},...ee.map(({participantId:ce,seedValue:fe,seedNumber:ge})=>({[ce]:{seedValue:fe,seedNumber:ge}}))):void 0,se=$t([...V.map(DU),...Q.map(DU)]);for(let ee of se){let ce=V.find(de=>de.drawId===ee),fe=Q==null?void 0:Q.find(de=>de.drawId===ee),ge=(ce==null?void 0:ce.entries)||(fe==null?void 0:fe.drawEntries),{structures:he=[],drawOrder:Se,drawName:Ce,drawType:Fe}=ce??{},Je=fe==null?void 0:fe.flightNumber,xe=[H==null?void 0:H.categoryName,H==null?void 0:H.ageCategoryCode].filter(Boolean),st=((ce==null?void 0:ce.structures)||[]).sort((de,pe)=>sI(de,pe)).map(({structureId:de,structures:pe})=>[de,...(pe||[]).map(({structureId:ke})=>ke)]).flat(1/0),we,Oe,ye,Be,Ee=0,qe=he.filter(({stage:de,stageSequence:pe})=>de===nt&&pe===1||de===gt).flatMap(de=>{let{seedAssignments:pe,stageSequence:ke,stage:Ue}=de,{positionAssignments:Te}=Vi({structure:de});return Ue===nt?(Ee=(Te==null?void 0:Te.length)??0,ye=Te,Be=pe):ke===1&&(we=Te,Oe=pe),Te}).map(({participantId:de})=>de).filter(Boolean),Ge=te(Be),me=te(Oe),Me=ce?ge.filter(({participantId:de})=>qe.includes(de)):ge,De=!p||(J==null?void 0:J.published)&&(((n=J==null?void 0:J.drawIds)==null?void 0:n.length)===0||((r=J==null?void 0:J.drawIds)==null?void 0:r.includes(ee)));for(let de of Me){let{entryStatus:pe,entryStage:ke,entryPosition:Ue,participantId:Te}=de,rt=F({participantId:Te,scaleNames:xe,eventType:j}),je=Le=>{var It,zt,Jt,Yr,Eo;if((It=f[Le].draws)!=null&&It[ee])return;let Qt=S&&De,yr=Qt?{}:void 0,Kn=Qt?((zt=Ge==null?void 0:Ge[Te])==null?void 0:zt.seedValue)||((Jt=Ge==null?void 0:Ge[Te])==null?void 0:Jt.seedNumber):void 0,yt=Kn?Ge==null?void 0:Ge[Te]:void 0,cr=Qt?((Yr=me==null?void 0:me[Te])==null?void 0:Yr.seedValue)||((Eo=me==null?void 0:me[Te])==null?void 0:Eo.seedNumber):void 0,Jo=cr?me==null?void 0:me[Te]:void 0;yr&&Kn&&(yr[nt]=yt),yr&&cr&&(yr[gt]=Jo);let Qo=Kn||cr;Qo&&(f[Le].participant.seedings[j]||(f[Le].participant.seedings[j]=[]),yt&&f[Le].participant.seedings[j].push({...yt,scaleName:ee}),Jo&&f[Le].participant.seedings[j].push({...Jo,scaleName:ee}),yr&&(f[Le].events[q].seedAssignments||(f[Le].events[q].seedAssignments={}),Object.keys(yr).forEach(vo=>f[Le].events[q].seedAssignments[vo]=yr[vo]))),(C||g)&&(f[Le].draws[ee]=ft({seedAssignments:yr,entryPosition:Ue,entryStatus:pe,entryStage:ke,seedValue:Qo,eventId:q,ranking:rt,drawId:ee},!1,!1,!0))};[Kl,Eg].includes(pe)||(je(Te),(a=f[Te].participant.individualParticipantIds||[])==null||a.forEach(je))}let Ae=((ce==null?void 0:ce.structures)??[]).reduce((de,pe)=>(de.includes(pe.stage)||de.push(pe.stage),de),[]),ze=((ce==null?void 0:ce.links)??[]).length;x[ee]={qualifyingPositionAssignments:we,qualifyingSeedAssignments:Oe,mainPositionAssignments:ye,qualifyingSeedingMap:me,mainSeedAssignments:Be,orderedStructureIds:st,mainSeedingMap:Ge,flightNumber:Je,linksCount:ze,drawOrder:Se,drawName:Ce,drawType:Fe,drawSize:Ee,drawId:ee,stages:Ae}}}if(g||y||I||b||D||w||C){let te=!!y||m,se=((o=eh({afterRecoveryTimes:!!y,policyDefinitions:u,tournamentRecord:d,inContext:!0,contextProfile:h,participantMap:f,nextMatchUps:te,event:$}))==null?void 0:o.matchUps)??[];for(let ee of se){let{finishingPositionRange:ce,potentialParticipants:fe,tieMatchUps:ge=[],sides:he=[],winningSide:Se,matchUpType:Ce,matchUpId:Fe,eventId:Je,drawId:xe,collectionId:st,stageSequence:we,finishingRound:Oe,matchUpStatus:ye,roundPosition:Be,roundNumber:Ee,structureId:qe,schedule:Ge,score:me,stage:Me}=ee;R[Fe]=ee;let De={finishingPositionRange:ce,finishingRound:Oe,stageSequence:we,roundPosition:Be,collectionId:st,roundNumber:Ee,structureId:qe,schedule:Ge,eventId:Je,drawId:xe,score:me,stage:Me};gY({...De,...M,matchUpStatus:ye,winningSide:Se,matchUpType:Ce,matchUpId:Fe,sides:he});for(let Ae of ge){let{winningSide:ze,sides:de=[],matchUpId:pe,matchUpStatus:ke,matchUpType:Ue}=Ae;gY({...De,...M,winningSide:ze,tieWinningSide:Se,matchUpTieId:Fe,matchUpId:pe,sides:de,matchUpSides:he,matchUpStatus:ke,matchUpType:Ue})}Array.isArray(fe)&&(te||y||v)&&((s=fe.flat().map(Yt).filter(Boolean))==null||s.forEach(Ae=>{var ze;(ze=P(Ae))==null||ze.forEach(de=>{f[de]&&(f[de].potentialMatchUps[Fe]=ft({tournamentId:d==null?void 0:d.tournamentId,matchUpId:Fe,eventId:Je,drawId:xe}))}),(y||v)&&Upe({potential:!0,participantMap:f,participantId:Ae,matchUpStatus:ye,roundPosition:Be,structureId:qe,matchUpType:Ce,roundNumber:Ee,matchUpId:Fe,schedule:Ge,drawId:xe,score:me})}))}A.push(...se)}}if(b||g||y){let $=Object.values(f);for(let V of $){let{wins:G,losses:j,[Un]:{wins:z,losses:H},[qi]:{wins:K,losses:q}}=V.counters,Y=(Z,Q,ie)=>{let ue=Q+ie,J=Q,te=ue&&J/ue;V.statistics[Z]={denominator:ue,numerator:J,statValue:te,statCode:Z}};if(b&&(Y(aM,G,j),Y(`${aM}.${Un}`,z,H),Y(`${aM}.${qi}`,K,q)),g){let Z=(Q=[])=>Math.abs(Q[0]-Q[1]);for(let Q of Object.keys(V.draws)){let{orderedStructureIds:ie=[],flightNumber:ue}=x[Q]||{};if(V.structureParticipation&&ie.length){let J,te=0,se=ie.map(ee=>{let ce=V.structureParticipation[ee];if(!ce)return;J||(J=ce==null?void 0:ce.finishingPositionRange),Z(J)>Z(ce==null?void 0:ce.finishingPositionRange)&&(J=ce==null?void 0:ce.finishingPositionRange);let fe=ce.stage!==gt;return fe&&(te+=1),ft({...ce,participationOrder:fe?te:void 0,flightNumber:ue})}).filter(Boolean);V.draws[Q]&&(V.draws[Q].finishingPositionRange=J,V.draws[Q].structureParticipation=se)}}}if(y){let Z=on(y)?y.scheduledMinutesDifference:0,Q=V.scheduleItems||[],ie=V.potentialMatchUps||{},ue=Q.reduce((te,se)=>{let{scheduledDate:ee,scheduledTime:ce}=se;return te[ee]||(te[ee]=[]),ce&&te[ee].push(se),te},{});Object.values(ue).forEach(te=>te.sort(ide));for(let te of Q){let{typeChangeTimeAfterRecovery:se,timeAfterRecovery:ee,scheduledDate:ce,scheduledTime:fe}=te,ge=ue[ce],he=ri(fe);for(let Se of ge){if(Se.matchUpId===te.matchUpId||[Ci,mi].includes(Se.matchUpStatus)&&!Se.checkScoreHasValue)continue;let Ce=te.matchUpType!==Se.matchUpType&&se||ee,Fe=te.drawId===Se.drawId,Je=ie[te.matchUpId]&&ie[Se.matchUpId],xe=ri(Se.scheduledTime),st=Math.abs(xe-he),we=xe>=he;if((Z&&!isNaN(Z)?st<=Z:we&&ri(Se.scheduledTime)<ri(Ce))&&!(Je&&Fe)&&we){let Oe=[te.matchUpId,Se.matchUpId].sort(Wk).join("|");V.scheduleConflicts[Oe]={priorScheduledMatchUpId:te.matchUpId,matchUpIdWithConflict:Se.matchUpId}}}}let J=V.participant.participantId;Object.keys(V.scheduleConflicts).length&&N.push(J),f[J].scheduleConflicts=V.scheduleConflicts}}}return{participantIdsWithConflicts:N,eventsPublishStatuses:_,derivedEventInfo:O,derivedDrawInfo:x,mappedMatchUps:R,participantMap:f,matchUps:A}}function wC({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var n;if(!Object.keys(t).length)return i;let{accessorValues:r,drawEntryStatuses:a,positionedParticipants:o,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:h,eventIds:f,genders:m}=t,g=Lu(f)&&((n=e==null?void 0:e.events)==null?void 0:n.filter(D=>f==null?void 0:f.includes(D.eventId)))||(e==null?void 0:e.events)||[],v=a&&q$e({drawEntryStatuses:a,tournamentEvents:g}),y=s&&K$e({eventEntryStatuses:s,tournamentEvents:g}),I=o!==void 0&&[!0,!1].includes(o)&&g.reduce((D,w)=>D.concat(...(w.drawDefinitions||[]).map(S=>Rde({drawDefinition:S}).allPositionedParticipantIds).filter(Boolean)),[]),b=D=>r==null?void 0:r.reduce((w,S)=>{let{accessor:U,value:C}=S,{values:E}=Rv({element:D,accessor:U});return w&&(E==null?void 0:E.includes(C))},!0);if(i=i==null?void 0:i.filter(D=>{var w,S;let U=(S=(w=Mu({element:D,itemType:nC}))==null?void 0:w.timeItem)==null?void 0:S.itemValue,{participantRoleResponsibilities:C,participantType:E,participantRole:P,participantId:M,person:N}=D,R=Array.isArray(m)&&(m==null?void 0:m.length)&&(N==null?void 0:N.sex)&&m.includes(N.sex);return h?m&&R||o&&I.includes(M)||o===!1&&!I.includes(M)||(v==null?void 0:v.includes(M))||(y==null?void 0:y.includes(M))||(d==null?void 0:d.includes(M))||p&&U===p||u&&E&&Lu(u)&&u.includes(E)||l&&P&&Lu(l)&&l.includes(P)||c&&Lu(C)&&Lu(c)&&c.find(A=>C==null?void 0:C.includes(A))||(r==null?void 0:r.length)&&Lu(r)&&b(D):(!m||R)&&(o===void 0||o&&I.includes(M)||o===!1&&!I.includes(M))&&(!v||v.includes(M))&&(!y||y.includes(M))&&(!d||d.includes(M))&&(!p||U===p)&&(!u||E&&Lu(u)&&u.includes(E))&&(!l||P&&Lu(l)&&l.includes(P))&&(!c||Lu(C)&&Lu(c)&&c.find(A=>C==null?void 0:C.includes(A)))&&(!(r!=null&&r.length)||Lu(r)&&b(D))}),g.length&&f){let D=g.filter(w=>f.includes(w.eventId)).map(w=>{let S=(w.entries||[]).map(C=>C.participantId);if(_n(Cd)(w.eventType))return S;let U=((e==null?void 0:e.participants)??[]).filter(C=>S.includes(C.participantId)).map(C=>C.individualParticipantIds).flat(1);return S.concat(...U)}).flat(1);i=i==null?void 0:i.filter(w=>D.includes(w.participantId))}return i}function Lu(t){return t&&Array.isArray(t)&&t.length}function q$e({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return $t(e.reduce((n,r)=>{var a,o;let{flightProfile:s}=Vn({event:r}),l=((a=s==null?void 0:s.flights)==null?void 0:a.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(Yt):[]).flat())||[],c=((o=r.drawDefinitions)==null?void 0:o.map(({entries:u})=>u?u.filter(i).map(Yt):[]))||[];return n.concat(...l,...c)},[]))}function K$e({eventEntryStatuses:t,tournamentEvents:e}){return $t(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:a})=>Array.isArray(t)?t.includes(a):!0).map(Yt);return i.concat(...r)},[]))}function $n(t){var e;let{withIndividualParticipants:i,participantFilters:n={},withPotentialMatchUps:r,withRankingProfile:a,convertExtensions:o,policyDefinitions:s,withScheduleItems:l,tournamentRecord:c,scheduleAnalysis:u,withSignInStatus:d,withTeamMatchUps:p,withScaleValues:h,usePublishState:f,contextProfile:m,withStatistics:g,withOpponents:v,withMatchUps:y,internalUse:I,withSeeding:b,withEvents:D,withDraws:w,withISO2:S,withIOC:U}=t;if(!c)return{error:Ne};(y||a)&&Xl({tournamentRecord:c});let{participantMap:C}=Ipe({convertExtensions:o,tournamentRecord:c,withSignInStatus:d,withScaleValues:h,internalUse:I,withISO2:S,withIOC:U}),E=W$e({withMatchUps:y??a,withEvents:D??a,withDraws:w??a,withPotentialMatchUps:r,participantFilters:n,withRankingProfile:a,convertExtensions:o,withScheduleItems:l,policyDefinitions:s,tournamentRecord:c,scheduleAnalysis:u,withTeamMatchUps:p,usePublishState:f,withStatistics:g,participantMap:C,withOpponents:v,contextProfile:m,withSeeding:b}),{participantIdsWithConflicts:P,eventsPublishStatuses:M,derivedEventInfo:N,derivedDrawInfo:R,mappedMatchUps:A}=E,_=E.matchUps;C=E.participantMap;let O=u??r,x=({potentialMatchUps:z,scheduleConflicts:H,scheduleItems:K,participant:q,statistics:Y,opponents:Z,matchUps:Q,events:ie,draws:ue})=>{let J=Object.values(ue),te=Object.values(Z);return v&&(J==null||J.forEach(se=>{se.opponents=te.filter(ee=>ee.drawId===se.drawId)})),ft({...q,scheduleConflicts:u?Object.values(H):void 0,draws:w||a?J:void 0,events:D||a?Object.values(ie):void 0,matchUps:y||a?Object.values(Q):void 0,opponents:v?te:void 0,potentialMatchUps:O?Object.values(z):void 0,statistics:g?Object.values(Y):void 0,scheduleItems:l?K:void 0},!1,!1,!0)},F=new Map;for(let z of Object.keys(C))F.set(z,x(C[z]));let $=[...F.values()],V=(e=s==null?void 0:s[j0])==null?void 0:e.participant,G=wC({participants:$,participantFilters:n,tournamentRecord:c});if(i){let z=on(i)?i:void 0;for(let H of G)for(let K of H.individualParticipantIds??[]){H.individualParticipants||(H.individualParticipants=[]);let q=F.get(K);H.individualParticipants.push(z?ay({template:z,source:q}):q)}}let j=V?G.map(z=>ay({source:z,template:V})):G;return{participantIdsWithConflicts:P,eventsPublishStatuses:M,derivedEventInfo:N,derivedDrawInfo:R,mappedMatchUps:A,participantMap:C,participants:j,...re,matchUps:_}}function Nv({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:tt};let a=(r=e.entries)==null?void 0:r.find(o=>o.participantId===t&&(!i||i===o.entryStatus)&&(!n||n===o.entryStage));return t&&a}function Q0(t){var e,i,n,r,a,o,s,l,c;let{provisionalPositioning:u,drawDefinition:d,stageSequence:p,structureId:h,stage:f}=t;if(!d)return{error:tt};let{entryProfile:m}=rC({drawDefinition:d}),g=f&&p&&((n=(i=(e=m==null?void 0:m[f])==null?void 0:e.stageSequence)==null?void 0:i[p])==null?void 0:n.qualifiersCount)||f&&((r=m==null?void 0:m[f])==null?void 0:r.qualifiersCount)||0,v={};if(!h)return{qualifiersCount:g,roundQualifiersCounts:v};let{structure:y}=Dt({drawDefinition:d,structureId:h}),I=(a=d.links)==null?void 0:a.filter(w=>{var S;return((S=w==null?void 0:w.target)==null?void 0:S.structureId)===(y==null?void 0:y.structureId)}),b=0;if(I!=null&&I.length)for(let w of I){let S=(o=Dt({structureId:w.source.structureId,drawDefinition:d}))==null?void 0:o.structure;if((S==null?void 0:S.stage)===gt){let U=w.source.roundNumber,C=w.target.roundNumber,E=0;if(S.structureType===eo){let P=((s=S.structures)==null?void 0:s.length)??0,M=((l=w.source.finishingPositions)==null?void 0:l.length)??0;E=P*M}else E=((c=Ui({matchUpFilters:{roundNumbers:[U]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:u,inContext:!1}).matchUps)==null?void 0:c.length)||0;v[C]||(v[C]=0),v[C]+=E,b+=E}}let D=Object.keys(v);if(D.length<=1){let w=D[0]||1;v[w]=Math.max(v[w]||0,g)}return b=Math.max(b,g),{qualifiersCount:b,roundQualifiersCounts:v}}function YR({stage:t,drawDefinition:e}){var i;let{entryProfile:n}=rC({drawDefinition:e});return((i=n==null?void 0:n[t])==null?void 0:i.drawSize)||0}function Y$e(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,a=YR({stage:r,drawDefinition:i}),{qualifiersCount:o}=Q0({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return a&&a-o}function Dpe({stage:t,drawDefinition:e}){return!!(t===xr||H3({stage:t,drawDefinition:e})&&YR({stage:t,drawDefinition:e}))}function Ppe({entryStatus:t=hs,drawDefinition:e,stageSequence:i,stage:n}){if(t===Ul)return DFe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...re}:{error:aue};let r=Y$e({drawDefinition:e,stageSequence:i,stage:n}),a=PFe({drawDefinition:e,stage:n}),o=pB({entryStatus:Iw,drawDefinition:e,stage:n}),s=pB({entryStatus:hs,drawDefinition:e,stage:n}),l=o+s,c=l>=r,u=r-l;return n!==xr&&c?{error:iB}:t===Iw?o<a?{...re}:{error:iB}:{positionsAvailable:u,...re}}function Cpe(t){let{entryStatus:e=hs,entryStageSequence:i,entryStage:n=nt,ignoreStageSpace:r,drawDefinition:a,entryPosition:o,participant:s,roundTarget:l,extensions:c,extension:u,drawType:d}=t,p="addDrawEntry";if(!a)return{error:tt};if(!n)return{error:EW};if(d!==Ol&&!Dpe({stage:n,drawDefinition:a}))return oe({result:{error:Ug},stack:p});let h=Ppe({stageSequence:i,stage:n,drawDefinition:a,entryStatus:e});if(!r&&!h.success&&(!d||d!==Ol))return{error:h.error};if(u&&!fu({extension:u}))return oe({result:{error:Ie},info:"Invalid extension",context:{extension:u},stack:p});let f=t.participantId||(s==null?void 0:s.participantId);if(!f)return oe({result:{error:vr},stack:p});let m=e===Mp&&Nv({participantId:f,drawDefinition:a,entryStatus:e}),g=n===xr&&Nv({participantId:f,drawDefinition:a,entryStage:n}),v=e!==Mp&&n!==xr&&Nv({drawDefinition:a,participantId:f});if(v||m||g)return oe({context:{invalidEntry:v,invalidLuckyLoser:m,invalidVoluntaryConsolation:g},result:{error:fk},stack:p});let y=ft({entryStageSequence:i,participantId:f,entryPosition:o,entryStatus:e,entryStage:n,extensions:c});return u&&ui({element:y,extension:u}),l&&ui({extension:{name:"roundEntry",value:l},element:y}),a.entries||(a.entries=[]),a.entries.push(y),Ji({drawDefinition:a}),{...re}}function Z$e(t){let e="addDrawEntries",{entryStatus:i=hs,stage:n=nt,autoEntryPositions:r=!0,ignoreStageSpace:a,drawDefinition:o,participantIds:s,stageSequence:l,roundTarget:c,extension:u}=t;if(!n)return{error:EW};if(!o)return{error:tt};if(!Array.isArray(s))return{error:Tl};if(!Dpe({stage:n,drawDefinition:o}))return{error:Ug};if(u&&!fu({extension:u}))return oe({result:{error:Ie},info:"Invalid extension",context:{extension:u},stack:e});let d=Ppe({drawDefinition:o,stageSequence:l,entryStatus:i,stage:n});if(!a&&!d.success)return{error:d.error};let p=d.positionsAvailable??0;if(!a&&n!==xr&&p<s.length)return{error:LW};let h=s.reduce((f,m)=>{let g=i===Mp&&Nv({participantId:m,drawDefinition:o,entryStatus:i}),v=n===xr&&Nv({entryStage:n,drawDefinition:o,participantId:m});return i!==Mp&&n!==xr&&Nv({drawDefinition:o,participantId:m})||g||v?f.concat(m):f},[]);return s.filter(f=>f&&!h.includes(f)).forEach(f=>{let m={entryStageSequence:l,entryStage:n,participantId:f,entryStatus:i};u&&ui({element:m,extension:u}),c&&ui({extension:{name:Cu,value:c},element:m}),o.entries||(o.entries=[]),o.entries.push(m)}),r&&(o.entries=Uc({entries:o.entries})),Ji({drawDefinition:o}),h!=null&&h.length?{info:"some participantIds could not be added",participantIdsNotAdded:h,...re}:{...re}}function sq({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,entryStage:s,extension:l,drawId:c,event:u}){if(!(r!=null&&r.length))return{error:Rf};if(!u)return{error:Wo};if(!c)return{error:Fc};let d=(u.entries||[]).map(Yt);if(r.filter(f=>!d.includes(f)).length)return{error:Lce};if(n){let f=Z$e({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:a,roundTarget:o,extension:l});if(f.error)return f}let{flightProfile:p}=Vn({event:u}),h=p==null?void 0:p.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(r.forEach(f=>{let m=a===Mp&&UL({participantId:f,entryStatus:a,flight:h}),g=s===xr&&UL({participantId:f,entryStage:s,flight:h});!(a!==Mp&&s!==xr&&UL({flight:h,participantId:f}))&&!m&&!g&&h.drawEntries.push({participantId:f,entryStatus:a,entryStage:s})}),t&&(h.drawEntries=Uc({entries:h.drawEntries}))),{...re}}function UL({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;let a=(r=n.drawEntries)==null?void 0:r.find(o=>o.participantId===t&&(!e||e===o.entryStatus)&&(!i||i===o.entryStage));return t&&a}function SC({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var a,o,s,l;let c="removeEventEntries";if(!(r!=null&&r.eventId))return{error:_i};if(!Array.isArray(e)||e.some(m=>!co(m)))return oe({result:{error:hu},stack:c});let u=(r.drawDefinitions??[]).flatMap(m=>Og({drawDefinition:m}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((a=r.entries)==null?void 0:a.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(Yt).filter(m=>!u.includes(m)),p=(n&&((o=r.entries)==null?void 0:o.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(Yt).filter(m=>!u.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||d.includes(m))&&(!n||p.includes(m))):d.length&&p.length?e=Ln(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&u.some(m=>e.includes(m)))return oe({result:{error:O0},stack:c});if(!(e!=null&&e.length))return{...re,participantIdsRemoved:[]};let h=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||h.push(m.participantId),g}),t&&(r.entries=Uc({entries:r.entries}));let{flightProfile:f}=Vn({event:r});return(s=f==null?void 0:f.flights)==null||s.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=r.drawDefinitions)==null||l.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...re,participantIdsRemoved:h}}var Epe={[Or]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},eS=Epe;function id(t){var e,i;let{entryStatus:n=hs,autoEntryPositions:r=!0,enforceGender:a=!0,participantIds:o=[],entryStageSequence:s,policyDefinitions:l,entryStage:c=nt,tournamentRecord:u,ignoreStageSpace:d,drawDefinition:p,roundTarget:h,extensions:f,extension:m,drawId:g,event:v}=t,y="addEventEntries";if(!v)return{error:_i};if(!(o!=null&&o.length))return oe({result:{error:Rf},stack:y});if(!(v!=null&&v.eventId))return{error:Wo};let I=Mi({tournamentRecord:u,event:v}).appliedPolicies??{},b=(l==null?void 0:l[Or])??(I==null?void 0:I[Or])??eS[Or],D=(a??((e=b==null?void 0:b.participants)==null?void 0:e.enforceGender))!==!1,w=[],S=[];if(f&&(!Array.isArray(f)||!f.every(A=>fu({extension:A})))||m&&!fu({extension:m}))return oe({context:ft({extension:m,extensions:f}),result:{error:Ie},info:"Invalid extension(s)",stack:y});let U=!!u,C=[],E,P=((i=u==null?void 0:u.participants)==null?void 0:i.filter(A=>{var _,O,x;if(!o.includes(A.participantId))return!1;let F=_n(Un)(v.eventType)&&A.participantType===Zt&&!cm(n),$=v.eventType===qi&&A.participantType===Ot;return F&&(!v.gender||!D||[Fo,vu].includes(v.gender)||v.gender===((_=A.person)==null?void 0:_.sex))||$&&!cm(n)||v.eventType===qi&&A.participantType===Zt&&cm(n)?!0:F&&v.gender&&D&&![Fo,vu].includes(v.gender)&&v.gender!==((O=A.person)==null?void 0:O.sex)?(C.push({participantId:A.participantId,sex:(x=A.person)==null?void 0:x.sex}),!1):v.eventType===Gi&&(A.participantType===Gi||cm(n)&&A.participantType===Zt)}).map(A=>A.participantId))??[],M=o.filter(A=>!U||P.includes(A));v.entries||(v.entries=[]);let N=v.entries.map(A=>{var _;return A.participantId||((_=A.participant)==null?void 0:_.participantId)});if(M.forEach(A=>{var _;if(!N.includes(A)){let O=ft({participantId:A,entryStatus:n,entryStage:c,extensions:f});m&&ui({element:O,extension:m}),h&&ui({extension:{name:Cu,value:h},element:O}),s&&(O.entryStageSequence=s),w.push(O.participantId),(_=v.entries)==null||_.push(O)}}),g&&!cm(c)){let A=sq({participantIds:M,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:h,entryStage:c,extension:m,drawId:g,event:v});A.error&&(E=A.error)}if(v.eventType&&[of,Ys].includes(v.eventType)){let A=(v.entries||[]).map(F=>F.participantId),_=(v.entries||[]).filter(F=>cm(F.entryStatus)).map(F=>F.participantId),O=((u==null?void 0:u.participants)??[]).filter(F=>A.includes(F.participantId)&&F.participantType&&[Ot,Gi].includes(F.participantType)).map(F=>F.individualParticipantIds).flat(1/0),x=_.filter(F=>O.includes(F));x.length&&(S.push(...x),SC({participantIds:x,autoEntryPositions:!1,event:v}))}if(M.length!==o.length)return oe({context:{mismatchedGender:C,gender:v.gender},result:{error:Tl},stack:y});r&&(v.entries=Uc({entries:v.entries||[]}));let R=w.length-S.length;return oe({result:{...re,addedEntriesCount:R},stack:y,info:E})}var Mpe="ADMINISTRATION",X$e="CAPTAIN",J$e="COACH",va="COMPETITOR",Rpe="MEDIA",Npe="MEDICAL",lq="OFFICIAL",Ape="OTHER",_pe="SECURITY",cq={ADMINISTRATION:Mpe,CAPTAIN:X$e,COACH:J$e,COMPETITOR:va,MEDIA:Rpe,MEDICAL:Npe,OFFICIAL:lq,OTHER:Ape,SECURITY:_pe};function uq({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let a="removeIndividualParticipantIds";if(!n)return oe({result:{error:Ne},stack:a});if(!i||!e)return oe({result:{error:dt},stack:a});let o=(n.participants??[]).find(u=>u.participantId===i);if(!o)return oe({result:{error:Gn},stack:a});if(![Gi,bs].includes(o.participantType))return oe({result:{participantType:o.participantType,error:Mc},stack:a});let s=kpe({individualParticipantIds:e,groupingParticipant:o,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=s;if(c)return oe({result:s,stack:a});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));id({participantIds:p,entryStatus:Kl,tournamentRecord:n,event:u})}}return l&&ti({topic:sa,payload:{tournamentId:n.tournamentId,participants:[o]}}),{...re,...s}}function kpe({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:a}){var o,s;let l=[];if(!e)return{removed:l};let c=[],u=[];a||({participants:a,mappedMatchUps:r}=$n({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let d=(s=(o=a==null?void 0:a.find(({participantId:f})=>f===e.participantId))==null?void 0:o.events)==null?void 0:s.map(({eventId:f})=>f),p=(e.individualParticipantIds??[]).filter(f=>{var m;let g=t==null?void 0:t.includes(f),v=g&&((m=a==null?void 0:a.find(I=>I.participantId===f))==null?void 0:m.matchUps.filter(({eventId:I})=>d.includes(I)).map(({matchUpId:I})=>r==null?void 0:r[I]).filter(({winningSide:I,score:b})=>I||zr({score:b}))),y=g&&!(v!=null&&v.length);if(g&&!y&&u.push(f),y){l.push(f);for(let I of i.events??[])for(let b of I.drawDefinitions??[]){let{extension:D}=jt({element:b,name:Dp}),w=D==null?void 0:D.value[e.participantId];D&&w&&(D.value[e.participantId]=w.filter(U=>U.participantId!==f),ui({element:b,extension:D}),tC({drawDefinition:b}));let S=ro({drawDefinition:b,inContext:!1}).matchUps??[];for(let U of S){let C=U.sides??[];for(let E of C){let P=E.lineUp??[];P.find(M=>M.participantId===f)&&(E.lineUp=P.filter(M=>M.participantId!==f),si({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:b,matchUp:U}))}}}}else c.push(f);return!y});e.individualParticipantIds=p;let h={groupingParticipantId:e.participantId,cannotRemove:u,notRemoved:c,removed:l};return u.length&&!n&&{...h,cannotRemove:u,error:hk}||h}function qk({participantRole:t=va,individualParticipantIds:e=[],groupingTypes:i=[Vs,bs],tournamentRecord:n}){if(!n)return{error:Ne};let r=n.participants??[],{participants:a,mappedMatchUps:o}=$n({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=kpe({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:o,participants:a});c&&s++}),s?re:{error:eue}}function fI(t){var e,i,n;if(!(t!=null&&t.tournamentRecord))return{error:Ne};if(!((e=t==null?void 0:t.participantIds)!=null&&e.length))return{error:Rf};let{addIndividualParticipantsToEvents:r,tournamentRecord:a,participantIds:o}=t,s=((i=a.participants)==null?void 0:i.length)||0;if(!s)return{...re};let l=(n=a.events||[])==null?void 0:n.filter(({eventType:g})=>g===Ur).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),c=$n({participantFilters:{participantIds:o},tournamentRecord:a,withDraws:!0}).participants??[],u=()=>{let g=(Hr({matchUpFilters:{drawIds:l,matchUpTypes:[qi]},tournamentRecord:a}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return Ln(g,o)},d=(l==null?void 0:l.length)&&u(),p=c.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(l!=null&&l.length)||!(l!=null&&l.includes(y.drawId)))&&y.positionAssignments).length});if(d!=null&&d.length||p.length)return{error:O0};let h={},f={};for(let g of a.events||[]){let v=SC({participantIds:o,event:g});if(v.error)return v;h[g.eventId]=v.participantIdsRemoved}a.participants=a.participants.filter(g=>{let v=o.includes(g.participantId)||g.participantType===Ot&&g.individualParticipantIds.some(y=>o.includes(y));if(!v&&g.participantType===Ur&&g.individualParticipantIds.some(y=>o.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!o.includes(y))),v&&r&&[Ot,Gi].includes(g.participantType))for(let y of g.individualParticipantIds||[])o.includes(y)||(f[g.participantId]||(f[g.participantId]=[]),f[g.participantId].push(y));return!v});let m=s-a.participants.length;if(qk({individualParticipantIds:o,tournamentRecord:a}),r)for(let g of a.events||[]){let v=h[g.eventId].map(y=>f[y]||[]).flat();id({participantIds:v,entryStatus:Kl,tournamentRecord:a,event:g})}return m&&ti({payload:{participantIds:o,tournamentId:a.tournamentId},topic:R3}),m?{...re,participantsRemovedCount:m}:{error:hk}}function Ope({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:a}){var o;let s=r.entries??[];if(n){let{flightProfile:c}=Vn({event:r}),u=(o=c==null?void 0:c.flights)==null?void 0:o.find(d=>d.drawId===n);u?s=u.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}let l=s.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!a||!c.entryStage||c.entryStage===a)&&(!t||c.entryStatus&&Yl.includes(c.entryStatus)));return{entries:s,stageEntries:l}}function xpe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:a,event:o}){var s;let l="destroyGroupEntry";if(!e)return{error:Ne};if(!n)return oe({result:{error:vr},stack:l});if(!o)return{error:_i};if(!o.eventType||![of,Ys].includes(o.eventType))return oe({result:{error:Jh},stack:l});let c=e.participants??[],u=c.find(y=>y.participantId===n);if(!u)return oe({result:{error:Gn},stack:l});if(!u.participantType||![Ot,Vs].includes(u.participantType)||u.participantType===Vs&&o.eventType!==Ys||u.participantType===Ot&&o.eventType!==of)return{error:Mc};let d=(o.entries??[]).find(y=>y.participantId===n);if(!d)return{error:rue};let{stageEntries:p}=Ope({selected:!1,drawDefinition:i,drawId:r,event:o,stage:a}),h=p.map(Yt),f=c.filter(({participantId:y})=>h.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),m=(s=u.individualParticipantIds)==null?void 0:s.filter(y=>Jc(y,f).length===1),g=SC({participantIds:[n],event:o});if(g.error||m!=null&&m.length&&(g=id({participantIds:m,entryStatus:Kl,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:o}),g.error))return g;let v;return t&&fI({participantIds:[n],tournamentRecord:e}).success&&(v=!0),{...re,participantRemoved:v}}function dq({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a}){return xpe({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:a})}function Lpe(t){if(!t.tournamentRecord)return{error:Ne};let{participantIds:e,...i}=t,n=0,r=[];for(let a of e){let o=xpe({participantId:a,...i});o.success&&(n+=1),o.error&&r.push(o.error)}return n?{destroyedCount:n,...re}:{error:r}}function _U(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:a,matchUpsMap:o,drawId:s}=t,l="removeDrawPositionAssignment",c=bC(t);if(c.error)return oe({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t;if([Ul,Rp].includes(a)&&u){let{tournamentRecord:m}=t,{participant:g}=kg({tournamentRecord:m,participantId:u}),{participantType:v,individualParticipantIds:y}=g??{};if(r&&v===Ot){let I=dq({tournamentRecord:m,drawDefinition:n,participantId:u,event:p});if(I.error)return oe({result:I,stack:l});y&&KR({participantIds:y,tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}else KR({participantIds:[u],tournamentRecord:m,drawDefinition:n,entryStatus:a,drawId:s,event:p})}if(i){let m=ws({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:o,event:p});if(m.error)return oe({result:m,stack:l})}let{structure:f}=Dt({drawDefinition:n,structureId:h});return V3({structure:f,drawPositions:[d]}),Lk({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:a,structureId:h}}),c}function Fpe(t){return Object.assign(t,{entryStatus:Rp}),_U(t)}function bB(t){return co(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function ia(t){return co(t)?bB(t.replace(/_/g," ")):""}var Lh=({finishingPosition:t=oI,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:a,seedingProfile:o,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??xi(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:c};a&&(y.structureOrder=a),l&&(y.structureType=l),o&&(typeof o=="string"?y.seedingProfile=o:typeof o=="object"&&typeof o.positioning=="string"&&(y.seedingProfile=o.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let I=d.flatMap(({drawPositions:b})=>b).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=$t(I).sort((b,D)=>b-D).map(b=>({drawPosition:b}))),y},Os=Lh;function pq({structureName:t=ia(xr),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:tt};let a=Os({stage:xr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(a),Ji({drawDefinition:i,structureIds:[a.structureId]}),{...re}}function hq({drawPositions:t}){if(!(t!=null&&t.length))return{error:FP};let e=r=>t.filter(a=>a!==r).map(a=>[r,a]),i=[].concat(...(t??[]).map(e)),n=$t(i.map(Kk)).map(r=>r.split("|").map(a=>+a));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function Kk(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(or).join("|")}function $pe({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),a=n.slice(0,n.length/2),o=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{a.forEach((g,v)=>{r[p].push([a[v],o[v]])});let h=a.shift(),f=a.pop(),m=o.shift();a=[h,m,...a].filter(Boolean),o=[...o,f].filter(Boolean)});let s=a.shift(),l=a.pop(),c=o.shift();a=[s,c,...a].filter(Boolean),o=[...o,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return Kk(h)}))}function Q$e({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:dt}}var eBe={getRoundRobinGroupMatchUps:hq,determineRoundNumber:Q$e,drawPositionsHash:Kk,groupRounds:$pe};function TC(t){var e;let{groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:a,appliedPolicies:o,seedingProfile:s,stage:l=nt,matchUpType:c,roundTarget:u,structureId:d,groupNames:p,drawSize:h,idPrefix:f,isMock:m,uuids:g}=t,v=t.structureName??((e=n==null?void 0:n[0])==null?void 0:e.name)??ia(nt),{groupCount:y,groupSize:I}=tBe({structureOptions:a,appliedPolicies:o,drawSize:h}),b=W0,D,w=Xe(1,y+1).map(U=>{let C=iBe({groupSize:I,structureOrder:U,matchUpType:c,drawSize:h,idPrefix:f,isMock:m});D=Array.isArray(C)?Math.max(...C.map(({roundNumber:P})=>P??0)):0;let E=(p==null?void 0:p[U-1])??`${i} ${U}`;return Lh({structureId:g==null?void 0:g.pop(),structureType:Nk,finishingPosition:b,structureOrder:U,structureName:E,matchUps:C})}),S=Lh({structureId:d??(g==null?void 0:g.pop()),structureType:eo,finishingPosition:b,seedingProfile:s,structureName:v,stageSequence:r,structures:w,stage:l});return u&&ui({extension:{name:Cu,value:u},element:S}),{structures:[S],maxRoundNumber:D,groupCount:y,links:[],groupSize:I,...re}}function tBe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:a}=UC({groupSizeLimit:r,drawSize:i}),o=a&&Math.max(...a);n&&a!=null&&a.includes(n)||(n&&n>4||!(a!=null&&a.includes(4))?n=o:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function UC({drawSize:t,groupSizeLimit:e=10}){let i=Xe(3,e+1).filter(n=>{let r=Math.ceil(t/n),a=r*n-t,o=Math.ceil(t/r),s=Math.ceil(a/r);return(!a||a<n)&&o===n&&o>=3&&s<2});return{...re,validGroupSizes:i}}function iBe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:a,uuids:o}){let s=(t-1)*i,l=Xe(1+s,i+1+s),c=hq({drawPositions:l}).uniqueMatchUpGroupings??[],u=$pe({groupSize:i,drawPositionOffset:s});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=Kk(h),m=d(f),g=[1,n],v=nBe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:o}),y={matchUpStatus:m?Fn:wi,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return a&&(y.isMock=!0),y}}function nBe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||xi()}function fq(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!Rt(i))return{seedBlocks:void 0,...oe({result:{error:Ie},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=F0(i);if(e){let h=Math.min(e,r),f=[],m=1;for(Xe(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=Xe(m,m+h);m+=h,f.push(g)}return{...re,seedBlocks:f}}let a=Xe(1,r+1),o=[],s=r/2;for(;s>1;){let h=jr(a,s),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,I=g%2===0,b=m[0],D=m[m.length-1];n&&f>4?f===8?v=y?D:b:v=I?b:D:v=y?b:D,Ya(m,o)||o.push(v)}),s=s/2}let l=a.filter(h=>!o.includes(h));for(;l.length;)l.length%2===0?o.push(l.pop()):o.push(l.shift());let c=Xe(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return Xe(0,u).forEach(h=>{p.push(o.slice(d,d+c[h])),d+=c[h]}),{...re,seedBlocks:p}}function mq({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!Rt(e))return{seedGroups:void 0,...oe({result:{error:Ie},context:{drawSize:e},stack:i})};if(t){if(!Rt(t))return{seedGroups:void 0,...oe({context:{roundRobinGroupsCount:t},result:{error:Ie},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:Xe(0,r).map(()=>{let a=Xe(n,n+t);return n+=t,a})}}else{let{seedBlocks:n}=fq({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(a=>(a||[]).map(()=>(r+=1,r)))}}}function gq({roundRobinGroupsCount:t,participantsCount:e}){var i;if(t){let{validGroupSizes:a}=UC({drawSize:e});if(!((i=a==null?void 0:a.map(o=>Math.ceil(e/o)))!=null&&i.includes(t)))return oe({context:{roundRobinGroupsCount:t},result:{error:Ie}})}let{seedGroups:n}=mq({drawSize:e,roundRobinGroupsCount:t}),r=(n==null?void 0:n.map(a=>Math.min(...a)))||[];return{...re,seedingThresholds:r}}function ww(t){if(!t)return 1/0;if(Rt(t))return St(t);let e=t.split("-")[0];return Rt(e)?St(e):1/0}function rBe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(or),e.reverse(),e}function aBe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function oBe({positioning:t,size:e}){let i=rBe({size:e}),n=[],r=[],a=p=>p[0],o=p=>p[p.length-1],s=(p,h)=>(t&&[Rk,Gm].includes(t)&&h%2?o(p):a(p))||a(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=s(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=s(p,h);if(!r.includes(f))return r.push(f),f},d=Xe(1,e+1);for(let p of i)if(p===1){let h=jr(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=jr(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function mI({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:a,structure:o}){var s;let l=[];if(!o)return{error:Mf};let{matchUps:c,roundMatchUps:u}=Ui({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:o}),{seedAssignments:d}=Ks({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:o}),{positionAssignments:p}=Rr({structure:o}),h=p==null?void 0:p.length,f=(d==null?void 0:d.length)??0,m=[],g=Object.keys(u).map(O=>parseInt(O)).sort((O,x)=>O-x).map(O=>{let x=u[O].map($=>$.drawPositions).flat(1/0).filter(Boolean),F=x.filter($=>!m.includes($));return m=m.concat(...x),F}).filter(O=>O.length).reverse(),v=g.pop()??[],y=v&&Math.min(...v)-1||0;n=n??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);let I=(v==null?void 0:v.length)||0,b=g.filter(O=>O.filter(x=>x<=f).length),{stage:D,structureType:w,roundLimit:S}=o,U=w===eo,C=!U&&(g==null?void 0:g.length),E=!U&&D===gt&&S,P=b.flat(1/0),M=C?P==null?void 0:P.length:0,N=a?h:f,R=J3({drawDefinition:r,structure:o,matchUps:c}),A=R?0:!C&&N||N&&P.length<N&&N-P.length||0;if(E){let O=o!=null&&o.matchUps?o.matchUps.filter(({roundNumber:F})=>F===o.roundLimit).length:0,x=v.length/O;if(!C){let F=DC(n),$=jr(v,x),V=1,G=Xe(0,$[0].length).map(()=>{let j=Xe(V,V+$.length);return V+=$.length,j});({validSeedBlocks:l}=Bpe({drawPositionBlocks:$,nonRandom:n==null?void 0:n.nonRandom,positioning:F,seedGroups:G}))}}else U?{validSeedBlocks:l}=sBe({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:o}):C?l=b.map(O=>({seedNumbers:O,drawPositions:O})):R&&jr(v,2).map((O,x)=>({drawPositions:[O[0]],seedNumbers:[x+1]})).forEach(O=>l.push(O));if(!U&&!R&&!E){let{blocks:O}=lBe({drawPositionOffset:y,seedNumberOffset:M,seedCountGoal:A,seedingProfile:n,baseDrawSize:I});O.forEach(x=>l.push(x))}let _=l.flatMap(O=>O.drawPositions).reduce((O,x)=>(v==null?void 0:v.includes(x))&&O,!0);return!R&&!C&&!U&&!_?{error:_ce,validSeedBlocks:[],isContainer:U,isFeedIn:C}:{isLuckyStructure:R,validSeedBlocks:l,isContainer:U,isFeedIn:C}}function sBe({seedingProfile:t,structure:e,nonRandom:i}){var n;let r=e.structures||[],a=r.length,o=(n=Vi({structure:e}))==null?void 0:n.positionAssignments,s=DC(t),l=(o==null?void 0:o.length)??0,{seedGroups:c}=mq({roundRobinGroupsCount:a,drawSize:l}),u=r.map(d=>{var p;return(p=Vi({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return Bpe({drawPositionBlocks:u,positioning:s,seedGroups:c,nonRandom:i})}function Bpe({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:a}=oBe({size:i.length,positioning:e}),o=[];return i.forEach((s,l)=>{let c=aBe({blockPattern:a,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Gm?h=n?h:Fa(h):l%2&&h.reverse();let f=h.find(m=>!o.includes(m));f&&(o.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function lBe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:a,baseDrawSize:o}=t,s=1,l=[],{seedBlocks:c}=fq({cluster:DC(r)===Rk,participantsCount:o,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>a)break;let p=d.map(f=>f+e),h=u(s+1,d.length).map(f=>+f+n);s+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function ZR({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:a}){var o,s,l,c,u,d;let{structure:p}=Dt({drawDefinition:e,structureId:r});t||(t=Mi({drawDefinition:e}).appliedPolicies);let h=i==null?void 0:i.validSeedBlocks;return!h&&p&&(h=(o=mI({appliedPolicies:t,drawDefinition:e,structure:p}))==null?void 0:o.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)!=null&&l.ignore?!0:(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.strict?(((d=h.find(f=>f.seedNumbers.includes(a)))==null?void 0:d.drawPositions)||[]).includes(n):[].concat(...h.map(f=>f.drawPositions)).includes(n)}function Vpe(t){var e,i,n;let{provisionalPositioning:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,structureId:l,randomize:c}=t,{structure:u}=Dt({drawDefinition:a,structureId:l}),{seedAssignments:d}=Ks({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,drawDefinition:a,structure:u}),{positionAssignments:p}=Rr({structure:u}),h=(e=p==null?void 0:p.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:e.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:f}=Mi({drawDefinition:a}),m=((s==null?void 0:s.validSeedBlocks)||u&&((i=mI({returnAllProxies:t.returnAllProxies,provisionalPositioning:r,appliedPolicies:f,drawDefinition:a,seedingProfile:o,structure:u}))==null?void 0:i.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(h!=null&&h.includes(_))).length)[0],g=d==null?void 0:d.map(A=>A.participantId).filter(Boolean),v=p==null?void 0:p.map(A=>A.participantId).filter(Boolean),y=g==null?void 0:g.filter(A=>v==null?void 0:v.includes(A)),I=g==null?void 0:g.filter(A=>!(v!=null&&v.includes(A))),b=d==null?void 0:d.filter(A=>I==null?void 0:I.includes(A.participantId)),D=d==null?void 0:d.filter(A=>!A.participantId),w=(b!=null&&b.length&&b.length>0?b.length:(D==null?void 0:D.length)??0)&&(m==null?void 0:m.drawPositions.filter(A=>!(h!=null&&h.includes(A))))||[],S=c?Fa(w):w,U=[],C=S.map(()=>{var A;let _=(A=R(b,U))==null?void 0:A.participantId;return _&&U.push(_),_}).filter(Boolean),E=d==null?void 0:d.filter(A=>y==null?void 0:y.includes(A.participantId)).map(A=>A.seedNumber),P=((m==null?void 0:m.seedNumbers)||[]).filter(A=>!(E!=null&&E.includes(A))),M=d==null?void 0:d.filter(A=>P.includes(A.seedNumber)).map(A=>A.participantId),N=(n=f==null?void 0:f.seeding)==null?void 0:n.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:N===void 0||N?C:M,unplacedSeedNumbers:P,unfilledPositions:S,unplacedSeedAssignments:b};function R(A,_){let O=A.filter($=>!_.includes($.participantId)),x=Math.min(...O.map($=>ww($.seedValue))),F=O.filter($=>ww($.seedValue)===x);return Fa(F).pop()}}function DC(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function tS({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:a,structureId:o,seedNumber:s,seedValue:l,eventId:c,event:u}){var d,p,h;let f="assignSeed",{structure:m}=Dt({drawDefinition:i,structureId:o}),{positionAssignments:g}=Rr({structure:m}),v=Ks({provisionalPositioning:t,drawDefinition:i,structure:m}).seedAssignments,y=v.map(U=>U.seedNumber),I=Nv({drawDefinition:i,participantId:r});if(r&&!I)return oe({result:{error:hu},context:{participantId:r},stack:f});let b=u?(p=(d=Vn({event:u}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,D=b&&b>1,w=(h=g==null?void 0:g.find(U=>U.participantId===r))==null?void 0:h.drawPosition;if(w&&!ZR({drawPosition:w,drawDefinition:i,seedBlockInfo:a,structureId:o,seedNumber:s}))return oe({result:{error:wW},context:{assignedDrawPosition:w},info:"invalid seed position",stack:f});y.includes(s)||v.push({seedNumber:s,seedValue:l});let S;return v.forEach(U=>{U.participantId===r&&U.seedNumber!==s&&(U.participantId=void 0),U.seedNumber===s&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!D&&(U.seedValue=l??s),S=!0)}),S?(xde({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:m,eventId:c}),{...re}):oe({result:{error:Ace},stack:f})}function vq({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:a,event:o}){var s,l,c,u;let d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((c=a.sides)==null?void 0:c.find(g=>g.sideNumber===d)),{extension:h}=jt({element:r,name:Dp}),f=(h==null?void 0:h.value)||{},m=ot(f[i],!1,!0);if(p)(u=a==null?void 0:a.sides)==null||u.forEach(g=>{g.sideNumber===d&&(g.lineUp=m)});else{a.sides=[1,2].map(v=>{var y;return{...((y=a.sides)==null?void 0:y.find(I=>I.sideNumber===v))??{},sideNumber:v}});let g=a.sides.find(v=>v.sideNumber===d);g&&(g.lineUp=m)}si({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a})}function jpe(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:a}=t,o=i.roundNumber>1&&i.roundNumber-1,s=Wm({structureId:n.structureId,matchUpsMap:r});!e&&a&&(e=s.find(({drawPositions:f,roundNumber:m})=>m===o&&(f==null?void 0:f.includes(a))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=o&&s.find(({roundNumber:f,roundPosition:m})=>f===o&&m===u),p=d==null?void 0:d.matchUpStatus,h=[er,fr].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function cBe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(or).filter(Boolean),positionAdded:i,positionAssigned:n}}function Gpe({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,a=n+r;return{pairedPreviousMatchUp:Wm({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:s})=>o===(i==null?void 0:i.roundNumber)&&s===a)}}function Hpe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let a=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:o}=Gpe({structureId:a==null?void 0:a.structureId,matchUp:a,matchUpsMap:n});if(a&&o){let s=o==null?void 0:o.matchUpId,l=t.find(u=>u.matchUpId===s),c=(a==null?void 0:a.structureId)===(l==null?void 0:l.structureId)?(a==null?void 0:a.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:a.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=co(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function cM({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:a})=>a===i||r===i).sort((r,a)=>r.roundPosition-a.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,a,o)=>{var s;return(s=a.drawPositions)!=null&&s.includes(e)?o+1:r},void 0)}function Sw({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:a,drawPosition:o,matchUpsMap:s,matchUpId:l,event:c}){var u,d,p,h;let f="assignMatchUpDrawPosition";s||(s=da({drawDefinition:r})),t||(t=lr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let m=t.find(_=>_.matchUpId===l),g=m==null?void 0:m.structureId,v=(u=r==null?void 0:r.structures)==null?void 0:u.find(_=>_.structureId===g);if(!v)return{error:wn};let y=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(_=>_.matchUpId===l),I=(y==null?void 0:y.drawPositions)??[],{positionAdded:b,positionAssigned:D,updatedDrawPositions:w}=cBe({drawPosition:o,drawPositions:I}),{positionAssignments:S}=Vi({drawDefinition:r,structure:v}),U=(p=S==null?void 0:S.filter(_=>w.includes(_.drawPosition)))==null?void 0:p.find(({bye:_})=>_),C=(y==null?void 0:y.matchUpStatus)&&[Ci,mi].includes(y.matchUpStatus)&&w.filter(Boolean).length<2;if(a=U&&wi||a||C&&y.matchUpStatus||(y==null?void 0:y.matchUpStatus)&&[er,fr].includes(y.matchUpStatus)&&y.matchUpStatus||Fn,y&&b){t=lr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=C&&cM({inContextDrawMatchUps:t,drawPosition:o,matchUpId:l})||void 0;y!=null&&y.matchUpStatusCodes&&Hpe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:y}),Object.assign(y,{drawPositions:w,winningSide:_,matchUpStatus:a}),si({tournamentId:i==null?void 0:i.tournamentId,eventId:m==null?void 0:m.eventId,context:f,drawDefinition:r,matchUp:y})}let E=Xa({inContextDrawMatchUps:t,inContextMatchUp:m,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:P,loserMatchUp:M,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:R}}=E,A=Wm({structureId:v.structureId,matchUpsMap:s});if(D&&U){if(P)if([wi,er,fr].includes(a)){let _=Sw({matchUpId:P.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=P;_!==v.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(P&&m&&!m.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=jpe({targetMatchUp:y,drawPosition:o,matchUpsMap:s,structure:v});if(_){let O=Sw({matchUpId:P.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:o,matchUpsMap:s});if(O.error)return O}}if((y==null?void 0:y.matchUpType)===Yi){let _=t==null?void 0:t.find(({matchUpId:F})=>F===y.matchUpId),O=((_==null?void 0:_.sides)??[]).reduce((F,$,V)=>$.drawPosition===o?V:F,void 0),x=(h=S==null?void 0:S.find(F=>F.drawPosition===o))==null?void 0:h.participantId;x&&O!==void 0&&vq({inContextTargetMatchUp:_,drawPositionSideIndex:O,teamParticipantId:x,tournamentRecord:i,drawDefinition:r,matchUp:y})}if((R==null?void 0:R.linkCondition)===Ud&&w.filter(Boolean).length===2&&!U&&A.filter(({drawPositions:_,roundNumber:O})=>O===1&&Ya(_,w)).every(({matchUpStatus:_})=>[qn,Na].includes(_))&&M){let{structureId:_}=M,O=ws({drawPosition:N,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:c});if(O.error)return O}return D?{...re}:oe({result:{error:aw},context:{drawPosition:o},stack:f})}function zpe({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var a,o,s,l;let c=((s=(o=(a=q0({drawDefinition:e}))==null?void 0:a.containedStructures)==null?void 0:o[r.structureId])==null?void 0:s.map(({structureId:f})=>f))||[];c.push(r==null?void 0:r.structureId);let u=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],d=(t==null?void 0:t.filter(f=>c.includes(f.structureId)&&Ln(f.drawPositions??[],u).length))??[],p=d.map(({matchUpId:f})=>f),h=((l=n==null?void 0:n.drawMatchUps)==null?void 0:l.filter(f=>p.includes(f.matchUpId)))??[];return{drawPositions:u,matchUps:h,targetMatchUps:d}}function yq({lineUp:t}){if(!Array.isArray(t))return;let e={};return $t(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),a=parseInt(r),{assignedParticipantIds:o}=WR({collectionPosition:a,collectionId:n,lineUp:t});o.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:a})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Ed(t){return`${t} must be an array`}function Yk({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Ed("lineUp")),{valid:!1,errors:i,error:Ie};let n=t.every(a=>{if(typeof a!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:o,collectionAssignments:s}=a;return o?typeof o!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Ed("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=$t(t.map(Yt)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Ie:void 0}}function gI({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:tt};if(typeof e!="string")return{error:vr};let r=Yk({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:a}=jt({element:t,name:Dp}),o=(a==null?void 0:a.value)||{};return o[e]=yq({lineUp:n}),ui({element:t,extension:{name:Dp,value:o}}),tC({drawDefinition:t}),{...re}}function Iq({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:a,structure:o,event:s}){if(!n)return{error:tt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=zpe({inContextDrawMatchUps:t,matchUpsMap:r,assignments:a,structure:o});for(let d of u)d.matchUpType===gu&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&gI({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}si({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...re}}function yu({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var h,f,m;let g="assignDrawPosition";if(!s&&!i)return oe({result:{error:vr},stack:g});u=u??da({drawDefinition:a}),e||({matchUps:e}=lr({inContext:!0,drawDefinition:a,matchUpsMap:u}));let v=Dt({drawDefinition:a,structureId:d});if(v.error)return oe({result:v,stack:g});let{structure:y}=v;if(!y)return{error:wn};if(Yo({structure:y}))return oe({result:{error:uo},stack:g});let{seedAssignments:I}=Ks({provisionalPositioning:t,drawDefinition:a,structure:y}),b=(h=I==null?void 0:I.find(P=>P.participantId===s))==null?void 0:h.seedNumber,{appliedPolicies:D}=Mi({tournamentRecord:r,drawDefinition:a,structure:y,event:p});if(b&&!ZR({seedNumber:b,appliedPolicies:D,drawDefinition:a,seedBlockInfo:l,drawPosition:c,structureId:d}))return oe({result:{error:wW},context:{drawPosition:c},stack:g});let w=Rr({structure:y}).positionAssignments||[],S=w==null?void 0:w.find(P=>P.drawPosition===c);if(!S)return oe({result:{error:N0},context:{drawPosition:c},stack:g});if(w!=null&&w.map(Yt).includes(s))return oe({result:{error:O0},context:{drawPosition:c},stack:g});let{containsParticipant:U,containsBye:C}=E(S);if(C){let P=bC({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(P.error)return oe({result:P,stack:g})}if(U&&S.participantId!==s){let{activeDrawPositions:P}=IC({drawDefinition:a,structureId:d});if(P.includes(c))return oe({result:{error:lk},stack:g});Iq({assignments:[S],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:y})}if(S.participantId=s,i&&(S.qualifier=!0),((y==null?void 0:y.stageSequence)||0)>1||y.stage&&[oa,Nn].includes(y.stage)){let P=y.stage===gt?gt:nt,M=(((m=(f=a.structures)==null?void 0:f.find(N=>(N==null?void 0:N.stage)===P&&(N==null?void 0:N.stageSequence)===1))==null?void 0:m.seedAssignments)??[]).find(N=>N.participantId===s);if(M!=null&&M.participantId){let{participantId:N,seedNumber:R,seedValue:A}=M;tS({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:a,seedingProfile:o,participantId:N,seedNumber:R,seedValue:A,structureId:d,event:p})}}if(y.structureType!==eo)uBe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:a,drawPosition:c,matchUpsMap:u,structure:y,event:p});else{Spe({positionAssignments:w,tournamentRecord:r,drawDefinition:a,matchUpsMap:u,structure:y});let{drawPositions:P,matchUps:M,targetMatchUps:N}=zpe({assignments:[S],inContextDrawMatchUps:e,drawDefinition:a,matchUpsMap:u,structure:y});if(P&&(M==null?void 0:M.length)===1&&M[0].matchUpType===Yi){let R=((N==null?void 0:N[0].sides)??[]).reduce((A,_,O)=>P!=null&&P.includes(_.drawPosition)?O:A,void 0);vq({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:M[0],drawPositionSideIndex:R,tournamentRecord:r,drawDefinition:a})}}return af({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:a,structure:y,event:p}),{positionAssignments:w,...re};function E(P){let M=P.bye,N=P.qualifier,R=P.participantId;return{containsBye:M,containsQualifier:N,containsParticipant:R,filled:M||N||R}}}function uBe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=Ui({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:o,structure:s,event:l}),{roundMatchUps:d}=Za({matchUps:u}),{initialRoundNumber:p}=dy({drawPosition:a,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(a)}));if(h){let f=Sw({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:a,matchUpsMap:o});if(f.error)return oe({stack:"assignDrawPositionToMatchUps",context:{drawPosition:a},result:f})}return{...re}}function bq(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!a)return{error:tt};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=da({drawDefinition:a}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=lr({inContext:!0,drawDefinition:a,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));let{positionAssignments:h}=Vi({drawDefinition:a,structureId:l}),f=h==null?void 0:h.find(I=>I.drawPosition===s);if(f!=null&&f.participantId){let I=f.participantId,b=yu({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return b.success?y({removedParticipantId:I}):oe({result:b,stack:u})}let m=bC({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(m.error)return oe({result:m,stack:u});let g=m.participantId,v=yu({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:r,drawDefinition:a,participantId:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(!v.success)return oe({result:v,stack:u});return y({removedParticipantId:g});function y({removedParticipantId:I}){let{structure:b}=Dt({drawDefinition:a,structureId:l});V3({drawPositions:[s],structure:b});let D={[e]:o,name:n,drawPosition:s,structureId:l};return Lk({drawDefinition:a,positionAction:D}),oe({context:{removedParticipantId:I},result:{...re},stack:u})}}function dBe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return bq({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Wpe(t){return dBe(t)}function pBe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return bq({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function qpe(t){return pBe(t)}function Kpe({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:a}=t;for(let o of i.matchUps)e[o.matchUpId]&&(o.roundNumber=e[o.matchUpId],si({tournamentId:n==null?void 0:n.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o}))}function Ype(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=vi(t,i);if(n.error)return n;let r=Dt(t);if(r.error)return r;let a=r.structure;if(!Yo({structure:a}))return oe({result:{error:Qy,message:"structure must be adHoc"}});let{roundMatchUps:o=[],roundNumbers:s}=Za({matchUps:a==null?void 0:a.matchUps});return s!=null&&s.length?{valid:!0,structure:a,roundMatchUps:o,roundNumbers:s}:{error:Nd}}function Zpe(t){var e;let i=Ype(t,[{targetRoundNumber:!0,roundNumber:!0,[_f]:RLe}]);if(i.error)return i;let{structure:n,roundMatchUps:r,roundNumbers:a}=i,{targetRoundNumber:o,roundNumber:s}=t;if(!(a!=null&&a.includes(s))||!(a!=null&&a.includes(o)))return oe({result:{error:Ie},info:"roundNumbers must be valid rounds"});let l=o>s,c=l?Xe(s+1,o+1):Xe(o,s),u={};return c.forEach(d=>((r==null?void 0:r[d])??[]).forEach(({matchUpId:p})=>{u[p]=d-(l?1:-1)})),(e=r==null?void 0:r[s])==null||e.forEach(({matchUpId:d})=>u[d]=o),Kpe({params:t,modMap:u,structure:n}),{...re}}function Xpe({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var a;if(!n)return{error:tt};if(!Array.isArray(t))return{error:Ie};let o="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=Dt({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:wn};let h=(a=Vi({structure:p}).positionAssignments)==null?void 0:a.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(Ln(h,f).length!==(h==null?void 0:h.length))return oe({result:{error:Ie},info:"drawPositions do not match",stack:o});let m=da({drawDefinition:n}),{matchUps:g}=lr({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:I,bye:b,qualifier:D}=v;if(b){let w=ws({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(w!=null&&w.error)return w}else if(D)u.forEach(w=>{w.drawPosition===y&&(w.qualifier=!0,delete w.participantId,delete w.bye)});else if(I){let w=yu({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:I,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(w!=null&&w.error)return w}}af({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let s=t.map(({structureId:l})=>l);return Ji({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:s}),{...re}}function Jpe(t){let e=Ype(t,[{roundNumbers:!0,[_f]:Ao,[pc]:o=>o.length===2&&o.every(Mn)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(o=>r==null?void 0:r.includes(o)))return oe({result:{error:Ie,message:"roundNumbers must be valid rounds"}});let a={};return t.roundNumbers.forEach((o,s)=>((n==null?void 0:n[o])??[]).forEach(({matchUpId:l})=>{a[l]=t.roundNumbers[1-s]})),Kpe({params:t,modMap:a,structure:i}),{...re}}function hBe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return bq({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Qpe(t){return hBe(t)}function fBe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:tt};if(!n)return{error:Is};if((i==null?void 0:i.length)!==2)return{error:Ie,drawPositions:i};let a=da({drawDefinition:e}),{matchUps:o}=lr({inContext:!0,drawDefinition:e,matchUpsMap:a}),{structure:s}=Dt({drawDefinition:e,structureId:n});if(!s)return{error:wn};let l;if(s.structureType===eo?l=vBe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}):l=mBe({inContextDrawMatchUps:o,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:a,structure:s,event:r}),l.error)return l;if(V3({structure:s,drawPositions:i}),Lk({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),af({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===Ys){let c=Ui({matchUpFilters:{matchUpTypes:[gu]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(h=>i.includes(h))}),u=Ui({matchUpFilters:{matchUpTypes:[gu]},structure:s}).matchUps;c.forEach(d=>{(d.sides||[]).forEach(p=>{var h;let f=p==null?void 0:p.drawPosition;if(i.includes(f)){let m=p.participantId,g=u.find(({matchUpId:y})=>y===d.matchUpId),v=(h=d==null?void 0:d.sides)==null?void 0:h.reduce((y,I,b)=>I.drawPosition===f?b:y,void 0);vq({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return Ji({drawDefinition:e,structureIds:[n]}),{...re}}function mBe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){let s=a==null?void 0:a.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!s)return{error:Ie,structure:a,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...re};if(s.filter(({qualifier:c})=>c).length===2)return{...re};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?ehe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o}):gBe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:a,event:o})}function ehe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=a,h=_U({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=_U({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(ws({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:o}),h=yu({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:o}),h.error)?h:{...re}}function gBe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:a,event:o}){let s=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return a.positionAssignments=a.positionAssignments.map(l=>s[l.drawPosition]||l),Iq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:a,event:o}),{...re}}function vBe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:a,event:o}){var s;let l=(s=a.structures)==null?void 0:s.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(l.filter(({bye:u})=>u).length===2)return{...re};if(l.filter(({qualifier:u})=>u).length===2)return{...re};Iq({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:l,structure:a,event:o});let c=l.some(({qualifier:u})=>u);if(l.some(({bye:u})=>u)&&!c)ehe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:l,matchUpsMap:r,structure:a,event:o});else{let u=ot(l,!1,!0);l.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...re}}function the(t){return fBe(t)}function ihe({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:a,event:o}){if(!i)return{error:tt};if(!r)return{error:Is};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:hu};let{structure:l}=Dt({drawDefinition:i,structureId:r});if(!l)return{error:wn};if(!(!t||Mn(a)||a===void 0||a===""||typeof a=="string"&&a.split("-").every(p=>Mn(p)&&St(p)>0)))return{error:Ie};let{seedAssignments:c}=Ks({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof a=="string"?a.includes("-")&&a.split("-").map(h=>parseInt(h)).join("-")||parseInt(a)>0&&parseInt(a)||"":a&&a>0&&a||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};a&&(p.seedValue=a),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return xde({tournamentId:e==null?void 0:e.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:i,structure:l}),{...re}}function nhe({drawDefinition:t,structureId:e}){if(!t)return{error:tt};let{structure:i}=Dt({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var a;return((a=r.source)==null?void 0:a.structureId)===e}).map(r=>{var a;return(a=r.target)==null?void 0:a.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function Zk({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:a,stage:o}){if(!a)return{error:_i};let s={},l=[];for(let c of a.drawDefinitions||[]){let{structures:u,stageStructures:d}=Pd({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:o});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function wq({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,stage:o}){if(!e)return{error:Ne};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=Zk({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:a,event:c,stage:o});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function sf(t){if(!(t!=null&&t.drawDefinition))return!1;let e=zk(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:a}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:o})=>o===Yi),r=r==null?void 0:r.filter(({matchUpType:o})=>o===Yi),a=a==null?void 0:a.filter(({matchUpType:o})=>o===Yi)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(a!=null&&a.length))}function Sq(t){var e,i;let{drawDefinition:n,structureId:r}=t;if(!n)return{error:tt};let{playoffStructures:a}=nhe({drawDefinition:n,structureId:r});if(!(a!=null&&a.length))return!1;let o=((i=(e=n==null?void 0:n.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&Yl.includes(l.entryStatus)))==null?void 0:i.length)??0,s=0;return(a||[]).reduce((l,c)=>{var u;return!!((u=Vi({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!a.length)||s===o}function wB({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=wB({accessors:o,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],o.length){let s=wB({accessors:o,significantCharacters:t,value:i});n.push(...s)}else a({value:i})}function a({value:o}){if(o&&["string","number"].includes(typeof o)){let s=t?o.slice(0,t):o;n.push(s)}}return n}function yBe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:AW};if(!Array.isArray(n))return{error:jP};let r={};return t.forEach(a=>{let o=n.find(l=>l.participantId===a),{values:s}=rhe({policyAttributes:e,idCollections:i,participants:n,participant:o});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(a)||r[l].push(a)})}),r}function rhe({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:AW};if(!n)return{error:tI};let r=[];return t.forEach(a=>{let{directive:o,groupings:s,key:l,significantCharacters:c}=a||{};if(l){let u=l.split(".");r.push(...wB({significantCharacters:c,value:n,accessors:u}))}else if(o){let u=a==null?void 0:a.includeIds,d=((e==null?void 0:e[o])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var h;let f=i.find(m=>m.participantId===p);if((h=f==null?void 0:f.individualParticipantIds)!=null&&h.includes(n.participantId)){let m=f==null?void 0:f.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(n.participantId)&&r.push(u)})}),{values:$t(r)}}function vY({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(a=>({[a.participantId]:a})));return t.map(a=>{let o=r[a.participantId],{values:s}=rhe({participants:e,policyAttributes:i,idCollections:n,participant:o});return{...a,values:s}})}function ahe({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:a}=n,o=t?t[a]||[]:[],s=!!i.some(l=>o.includes(l));return{[r]:{participantGroups:o,includesGroupsToAvoid:s}}}))}function IBe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=ahe(t);return i.map(a=>{let o=e.filter(c=>a.includes(c)),s=r(o),l=o.filter(c=>!s.includes(c)).filter(c=>{var u;let d=yY(c);return!((u=n[d])!=null&&u.includesGroupsToAvoid)});return{unassigned:o,unpaired:s,pairedNoConflict:l}});function r(a){return a.filter(s=>!o(s));function o(s){let l=yY(s);return!a.includes(l)}}}function bBe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=ahe(t);return i.map(r=>{let a=e.filter(l=>r.includes(l)),o=a.length===r.length?a:[],s=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:a,unpaired:o,pairedNoConflict:s?[]:a,conflictsCount:s}})}function yY(t){return Number(t%2?t+1:t-1)}function wBe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function SBe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:a}){let o=n.map(s=>a?bBe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):IBe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(a){let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=o.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=o.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=o.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function ohe({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function TBe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var a;let o=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),s=Object.keys(o).reduce((u,d)=>o[d].length>u?o[d].length:u,0),l=Object.keys(o).filter(u=>o[u].length===s),c=vl(i?l:Object.keys(o));return r=t&&(a=o[r])!=null&&a.length?r:c,{participantId:r&&o[r]?vl(o[r]):vl(e),groupKey:r}}function UBe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function DBe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:a,allGroups:o,groupKey:s}){let l=r.reduce((U,C)=>C.length>U?C.length:U,0)<=2,c=ohe({positionAssignments:t,participantIds:e}),u=UBe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=TBe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:o,groupKey:s}),h=wBe({participantId:d,allGroups:o}),f=SBe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],I=(g==null?void 0:g.length)&&g[0],b=a&&y?y:I,D=a?I:y,w=(b==null?void 0:b.length)&&b||(D==null?void 0:D.length)&&D,S;if(w!=null&&w.length){let U=xo(w);S=xo(U)}else{let U=xo(m[0]);S=xo(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:S}}function XR({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),a=hq({drawPositions:r}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));a.forEach(s=>{Ya(o[s[0]].values||[],o[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,a;Ya(((r=n[0])==null?void 0:r.values)||[],((a=n[1])==null?void 0:a.values)||[])&&(i.push(n),n.conflict=!0)}),i}function PBe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(a=>{let o=a.map(s=>s.drawPosition);return a.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(o!=null&&o.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=XR({isRoundRobin:r,groupedParticipants:[[s,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=XR({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function IY(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:a,policyAttributes:o,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(a||[]).map(I=>I==null?void 0:I.length).filter(Boolean)),p=d>2,h=ot(e,!1,!0).filter(I=>!I.qualifier),f=e.filter(I=>!I.participantId&&(!I.bye||(r==null?void 0:r.includes(I.drawPosition)))).map(I=>I.drawPosition);Xe(0,n).forEach(()=>{let{newGroupKey:I,selectedParticipantId:b,targetDrawPosition:D}=DBe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=I,h.forEach(w=>{w.drawPosition===D&&(w.participantId=b)})});let m=vY({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=jr(m,d),v=XR({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let I=PBe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:a,isRoundRobin:p});if(I.length){let b=CBe({candidatePositionAssignments:h,swapOptions:I});b.error&&console.log({result:b}),m=vY({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:o,idCollections:s}),g=jr(m,d),v=XR({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(I=>{if(I.bye&&I.participantId){let b=J$;c.push(b)}if(I.qualifier&&I.participantId){let b=J$;c.push(b)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function CBe({candidatePositionAssignments:t,swapOptions:e}){let i=xo(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=xo(i.possibleDrawPositions),a=t.find(c=>c.drawPosition===n),o=t.find(c=>c.drawPosition===r)??{},s={participantId:o==null?void 0:o.participantId,qualifier:o==null?void 0:o.qualifier,bye:o==null?void 0:o.bye},l={participantId:a.participantId,qualifier:a.qualifier,bye:a.bye};return Object.assign(a,s),Object.assign(o,l),{...re}}function EBe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var h;if(!u)return{error:Gce};let{candidatesCount:f=1,policyAttributes:m,targetDivisions:g}=u,{roundsToSeparate:v}=u,y="randomUnseededSeparation",{structure:I}=Dt({drawDefinition:a,structureId:c}),{matchUps:b}=Ui({provisionalPositioning:t,matchUpsMap:l,structure:I,event:p});if(g&&Rc(g)&&!v){let G=oLe(g)||0,j=b.reduce((z,H)=>H.roundNumber>z?H.roundNumber:z,0);v=j<G?1:j-G+1}let{positionAssignments:D}=Rr({structure:I}),w=j3({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,S=D==null?void 0:D.filter(G=>!G.participantId),U=D==null?void 0:D.map(G=>G.drawPosition),C=(I==null?void 0:I.structureType)===eo,E=C?{structure:I,matchUps:b,allDrawPositions:U,roundsToSeparate:v}:{matchUps:b,allDrawPositions:U,roundsToSeparate:v},{drawPositionGroups:P,drawPositionChunks:M}=C?MBe(E):RBe(E),N={groupParticipants:s.filter(G=>G.participantType===bs).map(G=>G.participantId),teamParticipants:s.filter(G=>G.participantType===Gi).map(G=>G.participantId),pairParticipants:s.filter(G=>G.participantType===Ot).map(G=>G.participantId)},R=yBe({targetParticipantIds:e,policyAttributes:m,idCollections:N,participants:s});if(R.error)return oe({result:R,stack:y});let A=Object.assign({},...e.map(G=>{let j=Object.keys(R).filter(z=>(R[z]??[]).includes(G));return{[G]:j}})),_=ohe({participantIds:e,positionAssignments:D});if(_.length>((S==null?void 0:S.length)||0))return{error:FW};let O,x=_.length,F=Xe(0,f).map(()=>IY({initialPositionAssignments:D,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:M,drawPositionGroups:P,policyAttributes:m,idCollections:N,allGroups:R,drawSize:d}));if(O=F.reduce((G,j)=>!G||(j.conflicts||0)<(G.conflicts||0)?j:G,void 0),!O||O.conflicts){let G=Xe(0,f).map(()=>IY({initialPositionAssignments:D,participantsWithGroupings:w,unseededParticipantIds:e,opponentsToPlaceCount:x,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:M,drawPositionGroups:P,policyAttributes:m,idCollections:N,allGroups:R,drawSize:d}));O=F.concat(...G).filter(j=>{var z;return!((z=j.errors)!=null&&z.length)}).reduce((j,z)=>!j||(z.conflicts||0)<(j.conflicts||0)?z:j,void 0)}if(!O)return{error:gk};let $=(((h=Vi({structure:I}))==null?void 0:h.positionAssignments)??[]).filter(G=>G.participantId).map(G=>G.participantId),V=O.positionAssignments.filter(G=>!$.includes(G.participantId));for(let G of V)if(G.bye){let j=ws({tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...G});if(j.error)return oe({result:j,stack:y})}else if(G.participantId){let j=yu({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,event:p,...G});if(j.error)return oe({result:j,stack:y,context:{assignment:G}})}return{...re}}function MBe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function RBe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(or),a=Math.max(...r),o=t.filter(u=>u>a),s=r.length,l=Xe(s===2?1:2,s).filter(u=>u===ZW(u)),c=l.slice(0,e||l.length).reverse().map(u=>jr(r,u));return o.length&&console.log({fedDrawPositions:o}),{drawPositionGroups:n,drawPositionChunks:c}}function NBe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var h,f;let m="positionUnseededParticipants";u||({structure:u}=Dt({drawDefinition:a,structureId:c})),c||({structureId:c}=u);let{positionAssignments:g}=Rr({structure:u}),{seedAssignments:v}=Ks({provisionalPositioning:t,drawDefinition:a,structure:u}),y=v==null?void 0:v.map(P=>P.participantId).filter(Boolean),{stage:I,stageSequence:b}=u,D=I===gt?(f=(h=jt({element:u,name:Cu}))==null?void 0:h.extension)==null?void 0:f.value:void 0,w=lI({provisionalPositioning:t,drawDefinition:a,stageSequence:b,entryStatuses:Mg,structureId:c,roundTarget:D,stage:I}),S=w.filter(P=>!(y!=null&&y.includes(P.participantId))).map(P=>P.participantId),U=g==null?void 0:g.filter(P=>!P.participantId&&!P.bye&&!P.qualifier).map(P=>P.drawPosition);if(!n&&S.length>((U==null?void 0:U.length)||0))return oe({result:{error:FW},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:U==null?void 0:U.length},stack:m});let{appliedPolicies:C}=Mi({tournamentRecord:r,drawDefinition:a,event:p}),E=C==null?void 0:C[TU];if(u.stage===Nn){let P=w.reduce((M,N)=>(M[N.groupingValue]||(M[N.groupingValue]=[]),M[N.groupingValue].push(N.participantId),M),{});Object.keys(P).length&&(E||(E={policyName:"Playoff Avoidance"}),E.policyAttributes||(E.policyAttributes=[]),E.policyAttributes.push({groupings:P}))}return E&&s?EBe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,participants:s,matchUpsMap:l,structureId:c,avoidance:E,drawSize:d,entries:w}):ABe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:U,multipleStructures:n,tournamentRecord:r,drawDefinition:a,seedBlockInfo:o,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function ABe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?Fa(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=yu({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:a,drawDefinition:o,seedBlockInfo:s,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return oe({result:m,stack:"randomUnseededDistribution"})}}return{...re}}function _Be(t){let e=t.structure??Dt(t).structure,i="positionQualifiers",n=[];if(e.stage===oa)return oe({result:{error:Ug},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:a,roundDrawPositions:o}=kBe(t);for(let s of Object.keys(r)){let l=a==null?void 0:a.filter(c=>o[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[s]>(l||0))return oe({result:{error:sue},context:{unfilledDrawPositions:l},stack:i});Xe(0,r[s]).forEach(()=>{let c=xo(l);n.push(c),a==null||a.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...re,qualifierDrawPositions:n}}function kBe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=Dt({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=Rr({structure:e}),{stage:r,stageSequence:a}=e,{qualifiersCount:o,roundQualifiersCounts:s}=Q0({drawDefinition:t,stageSequence:a,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>St(m)),{matchUps:c}=Ui({structure:e}),{roundProfile:u}=Za({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=o-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,I;return v.qualifier&&((I=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:I.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:o}}function bY({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=Dt({drawDefinition:a,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=Mi({drawDefinition:a}).appliedPolicies),!r){let v=p&&mI({provisionalPositioning:t,appliedPolicies:n,drawDefinition:a,seedingProfile:o,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,Xe(0,c).forEach(()=>{if(g<(c||0)){let v=OBe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:a,seedingProfile:o,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...re,seedPositions:f}}function OBe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,participants:o,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=Vpe({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,structureId:s,event:c}),{appliedPolicies:p}=Mi({drawDefinition:n}),{avoidance:h}=p??{};h&&o&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:A0};f.push(g);let v=yu({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:a,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...re,seedPositions:f}}function xBe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=Rr({structure:i}),{seedAssignments:r}=Ks({provisionalPositioning:t,drawDefinition:e,structure:i}),a=Object.assign({},...(r||[]).filter(o=>o.participantId).map(o=>({[o.participantId]:o})));return n==null?void 0:n.map(o=>a[o.participantId]?{...o,seedNumber:a[o.participantId].seedNumber,seedValue:a[o.participantId].seedValue}:"").filter(Boolean)}function LBe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(a=>{if(i-n.length>a.drawPositions.length)n.push(...a.drawPositions);else{let o=SB(jr(a.drawPositions,2)),s,l=t[n.length];for(;s=uM(o,l);)n.push(s),l=t[n.length]}});let r=n.map(a=>Array.isArray(a)?Fa(a):a).flat(1/0);return Mue(i)&&e.map(a=>a.seedNumbers[0]).includes(i)?t:r}function uM(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return uM(e?r:t[Math.round(Math.random())],e)}return i<n?uM(t[1],e):uM(t[0],e)}function SB(t){let e=Math.floor(t.length/2);return t.length>2?[SB(t.slice(0,e)),SB(t.slice(e))]:t}function FBe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:a,byesToPlace:o,structure:s}){var l;a||(a=mI({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:c,isLuckyStructure:u,isContainer:d}=a,{validSeedBlocks:p}=a;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);let h=xBe({provisionalPositioning:t,drawDefinition:n,structure:s})??[],f=$t([].concat(...e.map(D=>D.drawPositions))),m=h.filter(D=>f.includes(D.drawPosition)),g=(D,w)=>ww(D.seedValue)-ww(w.seedValue),v=p.reduce((D,w)=>{let S=m.filter(U=>{var C;return(C=w.drawPositions)==null?void 0:C.includes(U.drawPosition)}).sort(g);return D.concat(...S)},[]).map(D=>D.drawPosition),y=LBe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:o}),I=wY({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,o),b=wY({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,o);return{strictSeedOrderByePositions:I,blockSeedOrderByePositions:b,isLuckyStructure:u,positionedSeeds:h,isContainer:d,isFeedIn:c}}function wY({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,a)=>r-a)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,a)=>t.includes(a)?r:a,void 0)).filter(Boolean)}function $Be({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:a,structure:o,isFeedIn:s}){var l,c;let u=(l=n==null?void 0:n.seeding)==null?void 0:l.seedingProfile,d=o.stage===gt,{positionAssignments:p}=Rr({structure:o}),h=p==null?void 0:p.filter(O=>O.participantId).map(O=>O.drawPosition),f={isCollectionMatchUp:!1},{matchUps:m,roundMatchUps:g}=Ui({provisionalPositioning:t,matchUpFilters:f,structure:o}),v=(g==null?void 0:g[1])||[],y=o.structureType===eo?m:v,I=$t([].concat(...y.map(O=>O.drawPositions))),b=Math.min(...I)-1,D=h==null?void 0:h.filter(O=>I.includes(O)),w=O=>{let x=Math.ceil(O.length/2),F=[O.slice(0,x),O.slice(x)],$=F.map(Y=>[].concat(...Y.flat(1/0)).length),V=Math.min(...$.flat(1/0)),G=Math.max(...$.flat(1/0)),j=$.indexOf(G),z=V!==G,H=Fa(F),[K,q]=!V||z?[F[j],F[1-j]]:[H[0],H[1]];return{greaterHalf:K,lesserHalf:q}},S=O=>{let{greaterHalf:x,lesserHalf:F}=w(O),{greaterHalf:$,lesserHalf:V}=w(x),G=Fa($.flat(1/0)).pop(),j=$.flat().filter(z=>z!==G);return{newlyFilteredChunks:[...F,...V,j],drawPosition:G}},U=O=>!e.includes(O),C=O=>!(D!=null&&D.includes(O)),E=O=>{let x=jr(O.sort(or),Math.ceil(O.length/4)).map(V=>V.filter(C)),F=[].concat(...x.flat(1/0)).length,$=[];for(let V=0;V<F;V++){let{newlyFilteredChunks:G,drawPosition:j}=S(x);$.push(j),x=G}return $},{validSeedBlocks:P}=mI({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:o}),M=P==null?void 0:P.map(O=>{var x;return(x=O.drawPositions)==null?void 0:x.map(F=>F+b)}),N;if(s){let O=I.length,{seedBlocks:x}=fq({cluster:DC(u)===Rk,participantsCount:O});N=x.map(F=>F.map($=>$+b)).map(E).filter(F=>F.length)}else d?N=M==null?void 0:M.map(O=>O.filter(C)):N=M==null?void 0:M.map(E).filter(O=>O.length);let R=y.map(O=>O.drawPositions).map(O=>O==null?void 0:O.sort((x,F)=>x-F)).filter(O=>(O==null?void 0:O[0])+1===(O==null?void 0:O[1])),A=O=>R.reduce((x,F)=>F.includes(O)?F.reduce(($,V)=>V!==O?V:$,void 0):x,void 0),_=N.map(O=>O.map(A)).flat(1/0).filter(C).filter(U).filter(Boolean);if(d&&!o.structures){let O=a%4,x=_.slice(0,O),F=(c=g[o.roundLimit])==null?void 0:c.length,$=jr(_.slice(O),F).map(Fa).flat();_=x.concat($)}return{unseededByePositions:_}}function BBe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var a;let o={isCollectionMatchUp:!1},{matchUps:s,roundMatchUps:l}=Ui({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:n,event:r}),c=(l==null?void 0:l[1])||[],u=(n==null?void 0:n.structureType)===eo,d=u?s:c,p=u?((a=n==null?void 0:n.structures)==null?void 0:a.length)||0:s.length,{structureId:h,stage:f,stageSequence:m}=n,g=lI({entryStatuses:Yl,provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),{qualifiersCount:v}=Q0({provisionalPositioning:t,drawDefinition:e,stageSequence:m,structureId:h,stage:f}),y=g.length+v,{positionAssignments:I,unassignedPositions:b}=Rr({structure:n}),D=b==null?void 0:b.map(P=>P.drawPosition),w=I==null?void 0:I.filter(P=>P.bye).length,S=I==null?void 0:I.filter(P=>P.bye).map(P=>P.drawPosition),U=d.map(P=>P.drawPositions).filter(P=>P==null?void 0:P.reduce((M,N)=>!(S!=null&&S.includes(N))&&M,!0)).flat(1/0).filter(P=>D==null?void 0:D.includes(P)),C=I==null?void 0:I.length,E=C?C-y:0;return E>p&&n.stageSequence===1&&n.stage!==oa&&(E=p),{placedByes:w,byesCount:E,relevantMatchUps:d,placedByePositions:S,roundMatchUps:l,positionsToAvoidDoubleBye:U}}function SY({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:a,matchUpsMap:o,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var p;l||({structure:l}=Dt({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let h=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===gt),{byesCount:f,placedByes:m,relevantMatchUps:g}=BBe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:o,structure:l,event:d}),v=f-(m||0);if(v<=0)return{...re};let{strictSeedOrderByePositions:y,blockSeedOrderByePositions:I,isLuckyStructure:b,isFeedIn:D}=FBe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:n,seedingProfile:a,seedBlockInfo:r,byesToPlace:v,structure:l}),w=(l==null?void 0:l.structureType)&&[eo,Nk].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),S=h&&I!=null&&I.length?I:y,{unseededByePositions:U}=$Be({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:b,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:D}),C=N=>N%2,E=(N,R)=>(N||[]).every(A=>C(A)?R!==A+1:R!==A-1),P=[].concat(...S);if(!u)for(;U.length;){let N=U.find(R=>E(P,R));N?(P.push(N),U=U.filter(R=>R!==N)):(P.push(...U),U=[])}w&&(P=Fa(P),qs({ignoreSeededByes:w})&&console.log({byePositions:P}));let M=P.slice(0,v);for(let N of M){let R=ws({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:o,structureId:s,structure:l,event:d});if(R!=null&&R.error)return R}return{...re,unseededByePositions:U,byeDrawPositions:M}}function PC(t){var e,i,n,r;let{drawDefinition:a}=t,{applyPositioning:o=!0,provisionalPositioning:s,multipleStructures:l,placeByes:c=!0,tournamentRecord:u,placementGroup:d,seedingProfile:p,structureId:h,seedLimit:f,seedsOnly:m,drawType:g,drawSize:v,event:y}=t,I=[];o||(Lue(),a=ot(a,!1,!0));let b=F=>(o||iM(),oe({result:F,stack:"automatedPositioning"})),D=F=>(o||iM(),F),w=Dt({drawDefinition:a,structureId:h});if(w.error)return b(w);let S=w.structure;if(!S)return{error:wn};let U=t.appliedPolicies||((e=Mi({drawDefinition:a,structure:S,event:y}))==null?void 0:e.appliedPolicies),{qualifiersCount:C}=Q0({stageSequence:S.stageSequence,provisionalPositioning:s,stage:S.stage,drawDefinition:a,structureId:h}),E=Mg;if(!((i=lI({stageSequence:S.stageSequence,provisionalPositioning:s,stage:S.stage,placementGroup:d,drawDefinition:a,entryStatuses:E,structureId:h}))!=null&&i.length)&&!C)return D({...re});let P=t.matchUpsMap??da({drawDefinition:a}),M=t.inContextDrawMatchUps??((n=lr({inContext:!0,drawDefinition:a,matchUpsMap:P}))==null?void 0:n.matchUps),N=[],R=mI({provisionalPositioning:s,appliedPolicies:U,drawDefinition:a,seedingProfile:p,structure:S});if(R.error)return R;let{validSeedBlocks:A}=R;I.push({validSeedBlocks:A});let _=t.participants||(u?(r=$n({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:u}))==null?void 0:r.participants:[]);if(DC(S.seedingProfile||p)===Gm){let F=c?SY({provisionalPositioning:s,tournamentRecord:u,appliedPolicies:U,drawDefinition:a,seedBlockInfo:R,matchUpsMap:P,structure:S,seedLimit:f,seedsOnly:m,event:y}):void 0;if(F!=null&&F.error)return b(F);N=F.unseededByePositions,I.push({action:"positionByes",unseededByePositions:N});let $=S.seedingProfile?{positioning:S.seedingProfile}:p;if(F=bY({seedingProfile:$,provisionalPositioning:s,inContextDrawMatchUps:M,tournamentRecord:u,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:R,participants:_,matchUpsMap:P,structure:S,event:y}),F.error)return b(F);I.push({seedPositions:F.seedPositions,action:"positionSeedBlocks"})}else{if(g!==Pg){let $=S.seedingProfile?{positioning:S.seedingProfile}:p,V=bY({seedingProfile:$,provisionalPositioning:s,inContextDrawMatchUps:M,tournamentRecord:u,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:R,participants:_,matchUpsMap:P,structure:S,event:y});if(V.error)return b(V);I.push({action:"positionSeedBlocks",seedPositions:V.seedPositions})}let F=c?SY({provisionalPositioning:s,tournamentRecord:u,appliedPolicies:U,drawDefinition:a,seedBlockInfo:R,matchUpsMap:P,structure:S,seedLimit:f,seedsOnly:m,event:y}):void 0;if(F!=null&&F.error)return b(F);N=F==null?void 0:F.unseededByePositions,I.push({action:"positionByes",byeDrawPositions:F==null?void 0:F.byeDrawPositions,unseededByePositions:N})}let O={};if(!m){let F=_Be({inContextDrawMatchUps:M,tournamentRecord:u,appliedPolicies:U,validSeedBlocks:A,drawDefinition:a,seedBlockInfo:R,participants:_,matchUpsMap:P,structure:S});if(F.error||(F.conflicts&&(O.qualifierConflicts=F.conflicts),I.push({action:"positionQualifiers",qualifierDrawPositions:F.qualifierDrawPositions}),F=NBe({provisionalPositioning:s,inContextDrawMatchUps:M,unseededByePositions:N,multipleStructures:l,tournamentRecord:u,drawDefinition:a,seedBlockInfo:R,participants:_,matchUpsMap:P,structureId:h,structure:S,drawSize:v,event:y}),F.error))return b(F);F.conflicts&&(O.unseededConflicts=F.conflicts),I.push({action:"positionUnseededParticipants"})}let{positionAssignments:x}=Vi({drawDefinition:a,structure:S});return Ji({drawDefinition:a,structureIds:[h]}),o||iM(),{positionAssignments:x,conflicts:O,...re,positioningReport:I}}function CC(t){var e;let{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:a,seedingProfile:o,structureId:s,placeByes:l,seedsOnly:c,event:u}=t;if(!u)return{error:Wo};if(!a)return{error:zo};if(!sf({drawDefinition:a,structureId:s})&&!n)return{error:bW};let d=(e=nhe({drawDefinition:a,structureId:s}).playoffStructures)==null?void 0:e.sort((f,m)=>GR(f)-GR(m)),p=[],h=[];if(d)for(let f of d){let{structureId:m}=f,g=PC({structureId:m,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:a,seedingProfile:o,placeByes:l,seedsOnly:c});if(g.error)return g;g.positionAssignments&&p.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&h.push(g.positioningReport)}return{...re,structurePositionAssignments:p,positioningReports:h}}function she({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>Rt(i)))&&oe({result:{error:Ie},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>cw(i.structureOrder)-cw(n.structureOrder)),{...re}):{error:tt}}function Xk({drawDefinition:t}){var e,i,n,r,a,o,s;let l=t.structures??[],c=t.links??[],u=new Map,d=S=>{let U=u.get(S)||u.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&u.get(S);if(U&&!(U!=null&&U.stage)){let C=l.find(E=>E.structureId===S);U.stage=C==null?void 0:C.stage}return U},p={},h={},f=c.map(S=>{let U=S.source.structureId,C=S.target.structureId,E=d(U),P=d(C);return[Hm,yl,Ak,Gm].includes(S.target.feedProfile)?(E==null||E.targets.push(C),P==null||P.sources.push(U)):S.target.feedProfile===hc&&(P==null||P.drawSources.push(U),E==null||E.drawTargets.push(C)),h[C]=h[C]||S.target.feedProfile===hc,p[C]=$t([...p[C]||[],U]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(let S of u.keys()){let U=u.get(S);if(U){let C=U.targets??[];for(;C.length;){let E=C.pop(),P=E&&u[E];(e=P==null?void 0:P.targets)!=null&&e.length?C.push(...P.targets):P&&(U.rootStage=P.stage)}if(U.rootStage||(U.rootStage=U.stage),!((i=U.targets)!=null&&i.length)){let E=U.sources??[];for(;E.length;){let P=E.pop(),M=P&&u[P];if((n=M==null?void 0:M.sources)!=null&&n.length){for(let N of M.sources)(r=U.progeny)!=null&&r.includes(N)||(a=U.progeny)==null||a.push(N);E.push(...M.sources)}}}}}let m=0;for(let S of u.keys()){let U=u.get(S);if(U&&U.rootStage===gt){let C=[(o=U.drawTargets)==null?void 0:o[0]],E=0;for(;C.length;){E+=1;let P=C.pop(),M=P?u.get(P):void 0;(s=M==null?void 0:M.drawTargets)!=null&&s.length&&C.push(M.drawTargets[0])}U.distanceFromMain=E,E>m&&(m=E)}}let g=f.length;Xe(0,Math.ceil(g/2)).forEach(()=>{f=Xe(0,g).map(S=>{let U=f[S],C=f.reduce((E,P)=>Ya(U,P)?E.concat(...P):E,[])||[];return $t(U.concat(...C))})});let v=f[0],y=(S,U)=>Ln(S,U).length===S.length,I=f.slice(1).reduce((S,U)=>S&&y(U,v),!0),b=[v].filter(Boolean),D=[v].filter(Boolean);l.forEach(S=>{let{structureId:U,stage:C}=S;b.find(E=>E.includes(U))||(b.push([U]),C!==xr&&D.push([U]))});let w=I&&D.length===1;return!(c!=null&&c.length)&&l.length===1&&d(l[0].structureId),{structureProfiles:Object.fromEntries(u),allStructuresLinked:w,maxQualifyingDepth:m,sourceStructureIds:p,hasDrawFeedProfile:h,structureGroups:b}}function lhe({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=Xk({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...re}}function Lf(t){var e;let{duplicateValues:i=!0,creationTime:n=!0,removePriorValues:r,timeItem:a,element:o}=t;if(!a)return{error:jW};if(!o)return{error:dt,info:h3};let s=a&&Object.keys(a),l=["itemType","itemValue"];if(l.filter(c=>s.includes(c)).length!==l.length)return{error:VW};if(!o.timeItems)o.timeItems=[];else{let{itemType:c,itemSubTypes:u,itemValue:d}=a,p=c&&((e=Mu({itemSubTypes:u,itemType:c,element:o}))==null?void 0:e.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!i)return{...re}}if(a.itemSubTypes&&!a.itemSubTypes.length&&delete a.itemSubTypes,n){let c=new Date().toISOString();Object.assign(a,{createdAt:c})}return r&&(o.timeItems=o.timeItems.filter(({itemType:c})=>a.itemType!==c)),r&&!a.itemValue||o.timeItems.push(a),{...re}}function Tq({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:a}){if(!i)return{error:Ne};if(!r)return{error:vr};let o=kg({tournamentRecord:i,participantId:r});return o.error?o:Lf({element:o.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:a})}function vI(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:a}=t;return i?Lf({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:a}):{error:Ne}}function yI(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:a}=t;return a?Lf({removePriorValues:e,duplicateValues:i,element:a,creationTime:n,timeItem:r}):{error:Wo}}function Uq({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:Ne};if(!e)return{error:tt};let r=VBe({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});if(r.error)return r;let a={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return vI({tournamentRecord:t,timeItem:a}),r}function VBe({drawDefinition:t,tournamentId:e,structure:i,eventId:n,link:r}){var a;if(!t)return{error:tt};if(!i)return{error:Mf};if(!r)return{error:DW};let o=r.target.structureId,s=Dt({drawDefinition:t,structureId:o});if(s.error)return oe({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:s});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(r),lhe({drawDefinition:t});let l=((a=Ui({structure:i}))==null?void 0:a.matchUps)||[];return rf({drawDefinition:t,tournamentId:e,matchUps:l,eventId:n}),Ji({drawDefinition:t,structureIds:[i.structureId]}),{...re}}function che({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Ie};if(!t)return{error:tt};let i=Object.assign({},...e.map(n=>{if(!on(n))return;let{structureId:r,structureName:a}=n||{};if(!(!r||!a))return{[r]:a}}).filter(Boolean));if(!Object.values(i).length)return{error:dt};for(let n of t.structures||[]){let r=i[n.structureId];r&&(n.structureName=r)}return{...re}}function Dq({drawDefinition:t,timeItem:e}){if(!t)return{error:zo};if(!e)return{error:jW};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(a=>i.includes(a)).length!==n.length)return{error:VW};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),tC({drawDefinition:t}),{...re}}function uhe(t){var e;let{tournamentRecord:i,drawDefinition:n,structureId:r,event:a}=t,o=vi(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let s=n.structures??[],l=s.find(y=>y.structureId===r);if(!l)return{error:wn};let c=s.find(({stage:y,stageSequence:I})=>y===nt&&I===1),u=r===(c==null?void 0:c.structureId),d=s.filter(({stage:y})=>y===gt).map(Ko("structureId"));if(u&&!d.length)return{error:Sce};let p=d.includes(r),h=jBe({isQualifyingStructure:p,structure:l,...t});if(h!=null&&h.error)return h;let{structureIdsToRemove:f,relatedStructureIdsMap:m}=HBe({qualifyingStructureIds:d,isQualifyingStructure:p,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:n,structureId:r}),{removedMatchUpIds:g,removedStructureIds:v}=zBe({relatedStructureIdsMap:m,qualifyingStructureIds:d,isMainStageSequence1:u,mainStageSequence1:c,drawDefinition:n,structureIdsToRemove:f,structureId:r});if(GBe({removedMatchUpIds:g,drawDefinition:n}),u){let y=(e=c.matchUps??[])==null?void 0:e.map(Ko("matchUpId"));g.push(...y),c.positionAssignments=[],c.seedAssignments=[],c.matchUps=[],c.extensions&&(c.extensions=[])}return p&&lhe({drawDefinition:n}),Zp({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:g,action:"removeStructure",eventId:a==null?void 0:a.eventId,drawDefinition:n}),Ji({drawDefinition:n,eventId:a==null?void 0:a.eventId}),{...re,removedMatchUpIds:g,removedStructureIds:v}}function jBe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:a,force:o}){var s,l,c,u,d,p;let h=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(s=f(n))==null?void 0:s.source.structureId;for(;m;)h.push(m),m=(l=f(m))==null?void 0:l.source.structureId}if((c=lr({matchUpFilters:{structureIds:h},drawDefinition:i}).matchUps)!=null&&c.some(({score:f})=>zr({score:f}))){let f=(u=Mi({tournamentRecord:e,drawDefinition:i,structure:r,event:a}))==null?void 0:u.appliedPolicies;if(!(o??((p=(d=f==null?void 0:f[Sd])==null?void 0:d.allowDeletionWithScoresPresent)==null?void 0:p.structures)))return{error:bk}}return{...re}}function GBe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=lr({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function HBe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:a}){let o=(r.structures??[]).map(Ko("structureId")),s=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return o.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(a):[a],relatedStructureIdsMap:c}}function zBe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:a,structureId:o}){let s=[],l=[];for(;a!=null&&a.length;){let c=a.pop();l.push(...KBe({idBeingRemoved:c,drawDefinition:r}));let u=qBe({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:o});s.push(...u.removedStructureIds);let d=WBe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:o});d!=null&&d.length&&a.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function WBe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(a=>a!==(i==null?void 0:i.structureId)||n===i.structureId))}function qBe({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let o=[];return n.links=((a=n.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function KBe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=Dt({structureId:t,drawDefinition:e}),n=Ui({structure:i}).matchUps;return y3(n)}function JR({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:tt};if(!H3({drawDefinition:e,stage:n}))return{error:Ug};let r=EFe({drawDefinition:e,stage:n}),{qualifiersCount:a}=Q0({drawDefinition:e,stageSequence:t,stage:n}),o=r+a;if(i<o)return{error:UW};let{entryProfile:s}=G3({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return Ji({drawDefinition:e}),{...re,entryProfile:s}}function dhe({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?H3({drawDefinition:e,stage:i})?i!==nt?{error:UW,info:"qualifiersCount can only be set for main stage"}:(G3({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),Ji({drawDefinition:e}),{...re}):{error:Ug}:{error:tt}}function YBe({drawDefinition:t,drawSize:e}){if(!t)return{error:tt};let i=JR({stage:xr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(Ji({drawDefinition:t}),{...re})}function phe(t){return YBe(t)}function hhe({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var r;let a="removeSeededParticipant";if(!t)return{error:Ne};if(!e)return{error:tt};let o=(e.structures??[]).find(s=>s.structureId===n);return o?!o.stage||![nt,gt].includes(o.stage)||o.stage===nt&&o.stageSequence!==1?oe({result:{error:Qy},stack:a}):(r=o.seedAssignments)!=null&&r.find(s=>s.participantId===i)?{...re}:oe({info:"participant not seeded",result:{error:Sa},context:{participantId:i}}):oe({result:{error:wn},stack:a})}function EC({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:a=Ep}){return!n||!r?{error:Is}:{link:ft({linkType:a,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:hc,roundNumber:t,structureId:r}})}}function Pq({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||xi()}function QR({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:a,uuids:o,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let h=s==null?void 0:s[l],f=s==null?void 0:s[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=Pq({roundPosition:u,roundNumber:i,idPrefix:r,uuids:o}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Fn,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),a&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function Iu({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:a,idPrefix:o,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!Rc(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let u=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!Rc(s)&&!u)return{matchUps:[],roundsCount:0};let d=Xe(1,s+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=QR({matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,a=a??i;p.length>1;)n&&p.length===n&&(a=f-1),{roundNodes:p,matchUps:h}=QR({nodes:p,matchUpType:r,roundNumber:f,idPrefix:o,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=iC({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:a,matchUps:h}),a?h=h.filter(g=>a&&(g.roundNumber??0)<=a):a=f-1,{drawSize:s,matchUps:h,roundsCount:m,roundLimit:a}}function Cq(t){var e,i,n,r,a,o;let s="generateQualifyingStructure";if(!t.drawDefinition)return oe({result:{error:tt},stack:s});if(t.drawSize&&!Rt(t.drawSize)||t.participantsCount&&!Rt(t.participantsCount)||t.qualifyingPositions&&!Rt(t.qualifyingPositions))return oe({result:{error:Ie},stack:s});let l=t.drawSize??YW(t.participantsCount),{qualifyingRoundNumber:c,qualifyingPositions:u,targetStructureId:d,structureOptions:p,appliedPolicies:h,drawDefinition:f,matchUpFormat:m,structureName:g,structureId:v,roundTarget:y,drawType:I,idPrefix:b,isMock:D,uuids:w}=t;if(!t.drawSize)return oe({result:{error:$P},context:{drawSize:l},stack:s});if(u&&u>=t.drawSize)return oe({result:{error:Ie},context:{drawSize:l,qualifyingPositions:u},stack:s});let S,U,C,E,P=0,M,N=1,{structureProfiles:R}=Xk({drawDefinition:f}),A=R[d];if(!A)return oe({result:{error:wn},context:{targetStructureId:d},stack:s});let _=f.matchUpType,O=y?`${y}-`:"",x=A.stage===gt,F=((i=(e=h==null?void 0:h[dw])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((r=(n=c$e[dw])==null?void 0:n.namingConventions)==null?void 0:r.pre),$=x&&F?`${F}-`:"",V=g??(O?`${$}${ia(gt)} ${O}`:`${$}${ia(gt)}`);if(I===xl){let{maxRoundNumber:z,structures:H,groupCount:K}=TC({structureName:g??V,structureId:v??(w==null?void 0:w.pop()),stage:gt,structureOptions:p,appliedPolicies:h,stageSequence:N,matchUpType:_,roundTarget:y,idPrefix:b,drawSize:l,isMock:D,uuids:w});P=K,S=z,C=H[0],M=[1]}else({drawSize:l,matchUps:E,roundLimit:S,roundsCount:U}=Iu({qualifyingRoundNumber:c,qualifyingPositions:u,matchUpType:_,idPrefix:b,drawSize:l,isMock:D,uuids:w})),S||(S=U),C=Os({structureName:g??V,structureId:v??(w==null?void 0:w.pop()),qualifyingRoundNumber:S,stage:gt,matchUpFormat:m,stageSequence:N,matchUpType:_,roundLimit:S,matchUps:E}),y&&ui({extension:{name:Cu,value:y},element:C}),P=(a=E==null?void 0:E.filter(z=>z.roundNumber===S))==null?void 0:a.length;let G=I===xl?Cp:Ep,j=C&&S&&((o=EC({sourceStructureId:C.structureId,sourceRoundNumber:S,targetStructureId:d,finishingPositions:M,linkType:G}))==null?void 0:o.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:P,...re,structure:C,link:j}}function fhe(t){let e=t.tournamentRecord;if(!e)return{error:Ne};let i=ZBe(t);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,drawDefinition:o,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t,d={itemType:"addQualifyingStructures",itemValue:ft({drawId:o.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:a,structureName:s,matchUpType:l,drawSize:c,drawType:u})};return vI({tournamentRecord:e,timeItem:d}),i}function ZBe(t){if(!t.drawDefinition)return{error:tt};if(!t.targetStructureId)return{error:Is};let e=Cq(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Ie}:Uq({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function XBe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:a,isMock:o,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=Xe(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let I=Pq({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),b={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Fn,roundNumber:i,matchUpId:I};t&&(b.matchUpType=n),o&&(b.isMock=!0),a.push(b);let D={children:[y,v]};h.push(D)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:a,drawPosition:f}}function lf(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:a}=t,{linkFedFinishingRoundNumbers:o,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;a=a??R(e);let g=JBe({drawSize:a}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-a;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,O)=>_+O,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,_)=>c&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let I=[...g,...i].sort((A,_)=>_-A),b=I.length,D=[...(l??[]).map(A=>A-1),...(o??[]).map(A=>b-A)].map(A=>I[A]).reduce((A,_)=>A+_,0);y=y-D;let w=0,S=[],U,C=1,E=Xe(0,a).map((A,_)=>({drawPosition:_+1+y})),P=y+1;for(let A of g){if({roundNodes:U,matchUps:S}=QR({matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,nodes:E,uuids:f}),C++,i.includes(A)){let _=qo(i)[A],O=Xe(0,_),x=b+1-C,F=(o==null?void 0:o.includes(x))??(l==null?void 0:l.includes(C));O.forEach(()=>{({roundNodes:U,matchUps:S,drawPosition:P}=XBe({drawPosition:!F&&P||void 0,nodes:U,matchUpType:d,roundNumber:C,idPrefix:p,matchUps:S,isMock:h,uuids:f,fed:w})),C++,w+=1})}E=U}b!==C-1&&console.log("ERROR");let M=a-y;S=iC({finishingPositionOffset:u?M:s,positionsFed:y,roundsCount:b,matchUps:S,fmlc:m});let N=U!=null&&U.length?U[0]:U;return N&&(N.roundNumber=C-1,N.matchUps=S),{draw:N,matchUps:S,roundsCount:b};function R(A){let _=ZW(A);return _>A?_/2:_}}function JBe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return Xe(0,e).reverse().map(i=>Math.pow(2,i))}function wb(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=nt,drawSize:g,idPrefix:v,isMock:y,uuids:I}=t;if(!(!o||!c||o!=null&&o[l])||g<2||f&&s>f)return{};let b=[],D=[],w=[],S=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,C=e+g,E=`${U}-${C}`,P=o==null?void 0:o[l],M=n&&`${n} `||"",N=(o==null?void 0:o[E])??(r==null?void 0:r[E]),R=t.structureName||(N==null?void 0:N.name)||(P==null?void 0:P.name)&&(i?`${M}${P==null?void 0:P.name}`:P.name)||`${M}${E}`,A=(N==null?void 0:N.abbreviation)??(P==null?void 0:P.abbreviation),_=t.structureId??(P==null?void 0:P.structureId)??(I==null?void 0:I.pop()),O={idPrefix:v&&`${v}-${R}-RP`,finishingPositionOffset:e,matchUpType:S,drawSize:g,isMock:y,uuids:I},{matchUps:x}=h?lf(O):Iu(O),F=Os({structureAbbreviation:A,stageSequence:s,structureName:R,matchUpType:S,roundOffset:d,structureId:_,matchUps:x,stage:m});b.push(...x),D.push(F);let $=Math.ceil(Math.log(g)/Math.log(2)),V=u?Math.min(u-d,$):!a||U<a?$:0;return g>2&&Xe(1,V+1).forEach(j=>G(j)),{structureId:F.structureId,matchUps:b,structureName:R,structures:D,links:w,...re};function G(j){let z=g/Math.pow(2,j);if(z<2)return;let H=g/Math.pow(2,j)+e;if(a&&H+1>a)return;let{structures:K,structureId:q,matchUps:Y,links:Z}=wb({finishingPositionOffset:H,exitProfile:`${l}-${j}`,roundOffset:d+j,stageSequence:s+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:a,playoffAttributes:o,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:S,idPrefix:v,uuids:I,stage:m});if(F.structureId&&q){let Q={linkType:Td,source:{roundNumber:j,structureId:F.structureId},target:{roundNumber:1,feedProfile:yl,structureId:q}};Z&&F&&Z.push(Q),Z!=null&&Z.length&&w.push(...Z)}return K!=null&&K.length&&D.push(...K),Y!=null&&Y.length&&b.push(...Y),{structureId:q,childLinks:Z,structures:D}}}function Eq({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=Dt({drawDefinition:t,structureId:i});if(n.error)return oe({result:n});let{matchUps:r}=Ui({structure:n.structure,matchUpsMap:e});return{...Za({matchUps:r}),matchUps:r,matchUpsMap:e}}function TY({finishingPositions:t,drawDefinition:e,structureId:i}){var n;let{roundProfile:r}=Eq({drawDefinition:e,structureId:i});return(n=r&&Object.keys(r))==null?void 0:n.reduce((a,o)=>(mhe(r==null?void 0:r[o]).forEach(s=>{t.forEach(l=>{QBe({position:l,rangeDefinition:s})&&(a[l]={roundNumber:o})})}),a),{})}function QBe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,a)=>r||isNaN(a),!1))return!1;let[i,n]=e;return Xe(i,(n||i)+1).includes(t)}function mhe(t){var e,i;return[$t(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),$t(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function e2e(t){return mhe(t).map(e=>Xe(e[0],e[1]&&e[1]+1||e[0]+1))}function iS({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Ie,context:{structureIds:e}};if(!t)return{error:tt};e=e??(t.structures??[]).filter(a=>a.stage!==gt).map(({structureId:a})=>a);let n=e.map(a=>{var o;let{roundProfile:s}=Eq({drawDefinition:t,matchUpsMap:i,structureId:a});return(o=s&&Object.values(s))==null?void 0:o.map(e2e).flat()}).flat(),r=n.filter(a=>(a==null?void 0:a.length)===1).sort(or).flat();return{positionsNotPlayedOff:$t(n.flat()).filter(a=>!r.includes(a)),positionsPlayedOff:r}}function ghe({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:tt};if(!n)return{error:Is};if(!e)return{error:dt,info:"missing playoffPositions"};let r=iS({drawDefinition:i});if(r.error)return r;let a=r.positionsPlayedOff,o=e.filter(v=>!a.includes(v)),s=TY({finishingPositions:o,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>St(v)).filter(v=>!t.includes(v)),c=TY({finishingPositions:a,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>St(v)):[],p=l.filter(v=>!d.includes(v)).sort(or),{roundProfile:h}=Eq({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[I,b]=y??[0,0];return Xe(I,(b||I)+1)}).flat().sort(or),{playoffRoundsRanges:m}=t2e({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function t2e({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,a]=n,o=Xe(r,(a||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:o,roundNumber:i}})}}function MC({drawDefinition:t,structureId:e}){if(!t)return{error:tt};let{matchUps:i,matchUpsMap:n}=ro({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:a}=iS({drawDefinition:t,matchUpsMap:n}),{structures:o}=Pd({drawDefinition:t}),s=o.filter(c=>!e&&c.stage!==xr||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=i2e({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:a,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:a}}function i2e({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var r,a,o,s,l,c,u,d,p;let h=i==null?void 0:i.structureId,{links:f}=X0({drawDefinition:e,structureId:h});if(i.structureType===eo||i.structures){let w=(a=(r=Vi({structure:i}))==null?void 0:r.positionAssignments)==null?void 0:a.length,S=i.structures.length,U=(w??0)/S,C=((o=f.source)==null?void 0:o.flatMap(({source:F})=>(F==null?void 0:F.finishingPositions)||[]))||[],E=Xe(1,U+1).filter(F=>!C.includes(F)),P=((l=(s=n.find(F=>F.containerStructureId===h&&F.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],M=f==null?void 0:f.source.map(({target:F})=>F.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:R=[]}=iS({structureIds:M,drawDefinition:e}),A=[...N,...R],_=Xe(P[0],P[1]+1).filter(F=>!A.includes(F)),O=jr(_,_.length/E.length),x=E.map((F,$)=>{let V=O[$],G=[Math.min(...V||[]),Math.max(...V||[])].join("-");return{finishingPosition:F,finishingPositions:V,finishingPositionRange:G}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:x,finishingPositionsAvailable:E,finishingPositionsPlayedOff:C,positionsPlayedOff:N,groupCount:S,groupSize:U}}let m=((c=f==null?void 0:f.source)==null?void 0:c.filter(w=>w.linkCondition!==Ud).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],g=((u=f==null?void 0:f.source)==null?void 0:u.filter(w=>w.linkCondition===Ud).map(w=>{var S;return(S=w.source)==null?void 0:S.roundNumber}))||[],v=ghe({excludeRoundNumbers:m,playoffPositions:t,drawDefinition:e,structureId:h}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,I=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:b,error:D}=v;for(let w of g){let S=f==null?void 0:f.source.find(M=>M.source.roundNumber===w),U=S==null?void 0:S.target.roundNumber,C=S==null?void 0:S.target.structureId,E=n.filter(({roundNumber:M,structureId:N})=>N===C&&M===U),P=E.filter(({sides:M})=>M.find(N=>N.participantFed&&!N.participantId)).length;if(y&&P===E.length){y.push(w);let M=(p=(d=b==null?void 0:b[w])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(M){let N=Math.min(...M),R=N+P,A=Xe(N,R),_={finishingPositionRange:[N,R-1].join("-"),finishingPositions:A,roundNumber:w};I.push(_)}}}return y&&y.sort(or),I.sort((w,S)=>w.roundNumber-S.roundNumber),{playoffRounds:y,playoffRoundsRanges:I,error:D}}function n2e({playoffGroups:t,drawDefinition:e,structureId:i}){var n,r;if(!e)return{error:tt};if(typeof i!="string"||!Array.isArray(t))return{error:Ie};let a=t.map(({finishingPositions:o})=>o).flat();return{positionRangeMap:(r=(n=MC({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:n.filter(o=>a.includes(o.finishingPosition)))==null?void 0:r.reduce((o,s)=>(o[s.finishingPosition]=s,o),{})}}function vhe(t){var e,i;let{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:a=1,staggeredEntry:o,structureName:s,stage:l=nt,matchUpType:c,structureId:u,idPrefix:d,drawSize:p,isMock:h,uuids:f}=t,m={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:d,isMock:h,uuids:f},{matchUps:g}=o?lf(m):Iu(m),v=Os({structureName:s||((e=r==null?void 0:r[0])==null?void 0:e.name)||ia(nt),structureId:u||(f==null?void 0:f.pop()),stageSequence:a,matchUpType:c,matchUps:g,stage:l}),y=[v],I=[];if(p>2){let b=p/2,{matchUps:D}=Iu({finishingPositionOffset:n+b,idPrefix:d&&`${d}-c`,drawSize:b,matchUpType:c,isMock:h}),w=ia(oa),S=((i=r==null?void 0:r["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${w}`:w),U=Os({structureName:S,matchUps:D,structureId:f==null?void 0:f.pop(),stage:oa,stageSequence:1,matchUpType:c});y.push(U);let C={linkType:Td,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:yl,structureId:U.structureId}};I.push(C)}return{...re,structures:y,links:I}}function yhe({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:a}){let o=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return Xe(1+e,n+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?yl:Hm,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:Td,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=s[c-1];return h&&(p.target.groupedOrder=h),qs()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&a&&(p.linkCondition=Ud,p.target.feedProfile=yl),o.includes(d)?p:void 0}).filter(Boolean)}function Ihe(t){var e,i;let{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:a=1,playoffAttributes:o,structureNameMap:s,staggeredEntry:l,stage:c=nt,matchUpType:u,structureId:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:h,isMock:f,uuids:m},{matchUps:v,roundsCount:y}=l?lf(g):Iu(g),I=t.structureName??((e=o==null?void 0:o[0])==null?void 0:e.name)??ia(nt),b=Lh({structureId:d||(m==null?void 0:m.pop()),structureName:I,stageSequence:a,matchUpType:u,matchUps:v,stage:c}),D=[b],w=[];if(p>2){let S=[0,2].slice(0,p/16).map((U,C)=>{let E=C+1,{consolationStructure:P}=r2e({idPrefix:h&&`${h}-c${C}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:n,playoffAttributes:o,structureNameMap:s,stageSequence:E,roundOffset:U,matchUpType:u,drawSize:p,isMock:f,index:C,uuids:m});D.push(P);let M=yhe({consolationStructure:P,roundsCount:2,mainStructure:b,roundOffset:U});return{consolationStructure:P,links:M}}).map(U=>U.links).flat();if(w.push(...S),p>=4&&p<=16||p>32){let{matchUps:U}=Iu({idPrefix:h&&`${h}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:u,isMock:f}),C=((i=o==null?void 0:o["3-4"])==null?void 0:i.name)??ia(Nn),E=(s==null?void 0:s[C])||C,P=n?`${n} ${E}`:E,M=Lh({structureId:m==null?void 0:m.pop(),matchUps:U,stageSequence:2,stage:Nn,structureName:P,matchUpType:u}),N={linkType:Td,source:{roundNumber:y-1,structureId:b.structureId},target:{structureId:M.structureId,feedProfile:yl,roundNumber:1}};D.push(M),w.push(N)}}return{structures:D,links:w,...re}}function r2e({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:a,structureId:o,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var p,h;let f=l/(2*Math.pow(2,r)),{matchUps:m,roundsCount:g}=lf({finishingPositionOffset:f,baseDrawSize:f,isConsolation:!0,feedRounds:1,matchUpType:a,idPrefix:s,isMock:c,uuids:d}),v=u===0&&((p=i==null?void 0:i["0-1"])==null?void 0:p.name)||u===1&&((h=i==null?void 0:i["0-3"])==null?void 0:h.name)||`${ia(oa)} ${u+1}`,y=(n==null?void 0:n[v])||v,I=t?`${t} ${y}`:y;return{consolationStructure:Lh({matchUps:m,stage:oa,structureName:I,stageSequence:e,matchUpType:a,structureId:o}),consolationRoundsCount:g}}function tv(t){var e,i,n,r;let{finishingPositionOffset:a,stageSequence:o=1,playoffAttributes:s,feedsFromFinal:l,staggeredEntry:c,structureName:u,stage:d=nt,structureId:p,matchUpType:h,skipRounds:f,feedRounds:m,idPrefix:g,drawSize:v,isMock:y,uuids:I,fmlc:b}=t,D=t.feedPolicy||((e=t.policyDefinitions)==null?void 0:e[pw])||((i=t.appliedPolicies)==null?void 0:i[pw]),w={finishingPositionOffset:a,matchUpType:h,skipRounds:f,drawSize:v,idPrefix:g,isMock:y,uuids:I},{matchUps:S}=c?lf(w):Iu(w),U=Os({structureName:u||((n=s==null?void 0:s[0])==null?void 0:n.name)||ia(nt),structureId:p||(I==null?void 0:I.pop()),stageSequence:o,matchUpType:h,matchUps:S,stage:d}),C=[U],E=[],P=v/2,{matchUps:M,roundsCount:N}=lf({finishingPositionOffset:P,idPrefix:g&&`${g}-c`,isConsolation:!0,feedsFromFinal:l,baseDrawSize:P,matchUpType:h,feedRounds:m,skipRounds:f,isMock:y,uuids:I,fmlc:b});if(v>2){let R=((r=s==null?void 0:s["0-1"])==null?void 0:r.name)??ia(oa),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${R}`:R,_=Os({matchUps:M,structureId:I==null?void 0:I.pop(),stage:oa,stageSequence:1,structureName:A,matchUpType:h});C.push(_);let O=yhe({consolationStructure:_,mainStructure:U,roundsCount:N,feedPolicy:D,fmlc:b});E.push(...O)}return{...re,structures:C,links:E}}function bhe({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:a,drawDefinition:o,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var f,m,g,v,y,I;c=c||(r==null?void 0:r[pw]);let b="processPlayoffGroups",D=0,w=[],S=[],U=[],{error:C,positionRangeMap:E}=n2e({structureId:n,drawDefinition:o,playoffGroups:s});if(C)return oe({result:{error:C},stack:b});if(!(!E||s!=null&&s.every(P=>{let{finishingPositions:M=[]}=P;if(!M.length)return!1;let N=[...M].sort(or).map((R,A)=>(M[A+1]||R)-R).every(R=>R<2);return(!t||N)&&M.every(R=>E[R])})))return oe({context:{validFinishingPositions:Object.values(E)},result:{error:Ie},stack:b});for(let P of s){let M=P.finishingPositions,N=E&&M.map(V=>{var G;return(G=E[V])==null?void 0:G.finishingPositions}).flat(),R=u*M.length,A=F0(R),_=A===2&&Qc||P.drawType||Qc;N&&(D=Math.min(...N)-1);let O=N&&`${Math.min(...N)}-${Math.max(...N)}`,x=P.structureName||O&&((m=(f=P.playoffAttributes)==null?void 0:f[O])==null?void 0:m.name)||((v=(g=P.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),F={addNameBaseToAttributeName:P.addNameBaseToAttributeName,playoffStructureNameBase:P.playoffStructureNameBase,finishingPositionNaming:P.finishingPositionNaming,finishingPositionLimit:P.finishingPositionLimit,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,structureNameMap:P.structureNameMap,sequenceLimit:P.sequenceLimit,structureName:x,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:D,stage:Nn,stageSequence:a,matchUpType:l,drawSize:A,isMock:p,uuids:h},$=({playoffStructures:V,playoffLinks:G})=>{let[j]=V,z=HE({playoffStructureId:j.structureId,finishingPositions:M,sourceStructureId:n});U.push(z),U.push(...G),S.push(...V),w.push({structureId:j.structureId,finishingPositions:M}),D+=R};if(_===Qc){let{matchUps:V}=Iu({finishingPositionLimit:D+R,idPrefix:d&&`${d}-po`,finishingPositionOffset:D,matchUpType:l,drawSize:A,isMock:p,uuids:h}),G=Os({structureId:P.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Nn,structureName:x,stageSequence:a,matchUps:V});S.push(G);let j=HE({playoffStructureId:G.structureId,finishingPositions:M,sourceStructureId:n});U.push(j),D+=R,w.push({structureId:G.structureId,finishingPositions:M})}else if([mw,gw,Nn].includes(_)){let V={playoffAttributes:P.playoffAttributes??i,playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:D,stage:Nn,roundOffset:0,stageSequence:a,drawSize:A,isMock:p,uuids:h};_===mw?Object.assign(V,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??D3,roundOffsetLimit:3}):_===gw&&Object.assign(V,{playoffAttributes:(P==null?void 0:P.playoffAttributes)??i??P3,roundOffsetLimit:2});let G=wb(V);if(G.error)return G;if((y=G.links)!=null&&y.length&&U.push(...G.links),(I=G.structures)!=null&&I.length&&S.push(...G.structures),S.sort(sI),G.structureId){let j=HE({playoffStructureId:G.structureId,finishingPositions:M,sourceStructureId:n});U.push(j),w.push({structureId:G.structureId,finishingPositions:M})}D+=R}else if([vw,eC,EU,CU,PU,MU].includes(_)){let V=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],G={playoffStructureNameBase:P.playoffStructureNameBase,structureId:P.structureId??(h==null?void 0:h.pop()),playoffAttributes:P.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:D,uuids:V,stage:Nn,structureName:x,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},j={[vw]:{fmlc:!0,feedRounds:1},[MU]:{feedRounds:1},[EU]:{feedsFromFinal:3},[CU]:{feedsFromFinal:2},[PU]:{feedsFromFinal:1}};Object.assign(G,j[_]||{});let{structures:z,links:H}=tv(G),[K]=z,q=HE({playoffStructureId:K.structureId,finishingPositions:M,sourceStructureId:n});U.push(q),U.push(...H),S.push(...z),w.push({structureId:K.structureId,finishingPositions:M}),D+=R}else if([xl].includes(_)){let{structures:V,links:G}=TC({...F,structureOptions:P.structureOptions||{groupSize:4}});$({playoffStructures:V,playoffLinks:G})}else if([QP].includes(_)){let{structures:V,links:G}=vhe(F);$({playoffStructures:V,playoffLinks:G})}else if([mFe].includes(_)){let{structures:V,links:G}=Ihe(F);$({playoffStructures:V,playoffLinks:G})}else if([Ol].includes(_)){let V=Os({structureId:P.structureId??(h==null?void 0:h.pop()),structureName:P.structureName,finishingPosition:aM,stage:Nn,stageSequence:a,matchUps:[]});$({playoffStructures:[V],playoffLinks:[]})}}return{finishingPositionTargets:w,positionRangeMap:E,structures:S,links:U}}function HE({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Cp,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:hc,roundNumber:1}}}function RC({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(a=>NC({matchUp:t,collectionDefinition:a,uuids:n,isMock:i})).filter(Boolean).flat()}}function NC({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:a}){let{matchUpCount:o,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??o??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(a==null?void 0:a.pop())??xi();let h=e==null?void 0:e.collectionId;return(a==null?void 0:a.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return Xe(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Fn,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:s,isMock:r}})}function a2e(t){var e,i,n;let r="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return oe({result:{error:dt},info:"playoffGroups required",stack:r});let{sourceStructureId:a,requireSequential:o,tournamentRecord:s,drawDefinition:l,playoffGroups:c,groupCount:u,groupSize:d,event:p}=t,{structures:h=[],links:f=[],finishingPositionTargets:m,positionRangeMap:g,error:v}=bhe({requireSequential:o,sourceStructureId:a,playoffGroups:c,groupCount:u,groupSize:d,...t});if(v)return{error:v};let y=m==null?void 0:m.map(({finishingPositions:P})=>P).flat().map(P=>g[P].finishingPositions).flat();l.structures.push(...h),l.links.push(...f);let{matchUps:I,matchUpsMap:b}=lr({inContext:!0,drawDefinition:l}),D=h.map(({structureId:P})=>P),w=I==null?void 0:I.filter(({structureId:P})=>D.includes(P)).map(Cr),S=(e=b==null?void 0:b.drawMatchUps)==null?void 0:e.filter(({matchUpId:P})=>w==null?void 0:w.includes(P));if(S!=null&&S.length){let P=(i=Ea({drawDefinition:l,event:p}))==null?void 0:i.tieFormat;P&&S.forEach(M=>{let{tieMatchUps:N}=RC({isMock:t.isMock,tieFormat:P,matchUp:M});Object.assign(M,{tieMatchUps:N,matchUpType:gu})})}let{positionAssignments:U}=Vi({structureId:a,drawDefinition:l}),C={};U==null||U.forEach(P=>{var M,N,R;let A=(R=(N=(M=jt({element:P,name:tf}))==null?void 0:M.extension)==null?void 0:N.value)==null?void 0:R.groupOrder;A&&(C[A]||(C[A]=[]),C[A].push(P.participantId))});let E=CC({provisionalPositioning:t.provisionalPositioning,structureId:a,applyPositioning:!0,event:t.event,tournamentRecord:s,drawDefinition:l});return E.error&&((n=E.error)==null?void 0:n.code)!==bW.code?oe({result:E,stack:r}):{structures:h,links:f,positionsPlayedOff:y,drawDefinition:l,...re}}var xs="SET3-S:6/TB7",o2e="SET3-S:6NOAD",whe="SET3-S:6/TB7-F:TB10",s2e="SET3-S:4/TB7",l2e="SET3-S:4/TB5@3",c2e="SET1-S:T20",u2e="SET1-S:8/TB7",d2e="SET1-S:8/TB7@7",p2e={FORMAT_STANDARD:xs,FORMAT_STANDARD_NOAD:o2e,FORMAT_ATP_DOUBLES:whe,FORMAT_SHORT_SETS:s2e,FORMAT_FAST4:l2e,FORMAT_PRO_SET:u2e,FORMAT_COLLEGE_PRO_SET:d2e,TIMED20:c2e};function Mq({winningSide:t,matchUpFormat:e=xs,matchUpStatus:i,tallyPolicy:n,score:r}){let a=[0,0],o=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=go(e),c=Rq((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===mi&&n!=null&&n.setsCreditForDefaults||i===Ci&&n!=null&&n.setsCreditForWalkovers))a[s]=c;else for(let u of o||[]){let{winningSide:d}=u;d&&(a[d-1]+=1)}return typeof s=="number"&&i===Na&&(+a[1-s]===c&&(a[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(a[s]=c)),a}function She({matchUpFormat:t=xs,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var a,o;let{sets:s}=r||{};if(!s)return[0,0];let l=typeof e=="number"&&e-1,c=go(t),u=(c==null?void 0:c.bestOf)??1,d=Rq(u),p=((a=c==null?void 0:c.setFormat)==null?void 0:a.tiebreakAt)||0,h=[[],[]];if(typeof l=="number"&&(i===mi&&n!=null&&n.gamesCreditForDefaults||i===Ci&&n!=null&&n.gamesCreditForWalkovers)){let f=((o=c==null?void 0:c.setFormat)==null?void 0:o.setTo)||0,m=d*f;h[l].push(m)}else s.forEach((f,m)=>{var g;let v=(f.setNumber||m+1)>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",y=(g=c==null?void 0:c[v])==null?void 0:g.based,I=c==null?void 0:c[v].tiebreakSet,{side1Score:b,side2Score:D}=f;UY(y)&&(h[0].push(St(b||0)),h[1].push(St(D||0))),I&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&h[f.winningSide-1].push(1)});if(i===Na&&typeof l=="number"){let f=s.length>d&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",m=c==null?void 0:c[f];if(UY(m.based)){let g=(m==null?void 0:m.setTo)||0,v=I=>{if(!(!c||I===""))return+I===p-1||+I===p?St(p||0)+1:+I<p?g:p},y=Mq({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(h.map(I=>I[l]<=I[1-l]).reduce((I,b)=>I+(b?1:0),0)>y[1-l]){let I=h[l].length,b=v(h[1-l][I-1]);b&&(h[l][I-1]=b)}d>h[l].length&&n!=null&&n.gamesCreditForRetirements&&h[l].push(g)}}return[h[0].reduce((f,m)=>f+m,0),h[1].reduce((f,m)=>f+m,0)]}function The({matchUpFormat:t,score:e}){var i;let n=t?go(t):void 0,r=(n==null?void 0:n.bestOf)??1,a=Rq(r),o=[0,0],s=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((l,c)=>{var u;let d=(l.setNumber||c+1)>a&&n!=null&&n.finalSetFormat?"finalSetFormat":"setFormat",p=(u=n==null?void 0:n[d])==null?void 0:u.based;if(Uhe(p)){let{side1Score:h,side2Score:f}=l;h&&(s[0]+=St(h||0)),f&&(s[1]+=St(f||0))}else l.side1TiebreakScore&&(s[0]+=St(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(s[1]+=St(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:s,tiebreaksTally:o}}function Rq(t){return t&&Math.ceil(t/2)||1}function Uhe(t){return t==="P"}function UY(t){return!Uhe(t)}function h2e({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var a;let o=e&&go(e)||{},s=o.bestOf,l=s&&Math.ceil(s/2)||1,c=(a=o.setFormat)==null?void 0:a.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(l||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let I=t[u].matchUpsWon,b=t[u].matchUpsLost,D=I+b,w=Math.round(I/D*1e3)/1e3;(w===1/0||isNaN(w))&&(w=I);let S=t[u].gamesWon||0,U=t[u].gamesLost||0,C=(n||0)*(l||0)*(c||0),E=Math.max(C,S+U),P=Math.round(S/E*1e3)/1e3;(P===1/0||isNaN(P))&&(P=0);let M=Math.round(t[u].pointsWon/t[u].pointsLost*1e3)/1e3;(M===1/0||isNaN(M))&&(M=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=w,t[u].gamesWon=S,t[u].gamesLost=U,t[u].gamesPct=P,t[u].pointsPct=M,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function AC({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){var a,o,s,l,c,u,d;let p={},h=(i==null?void 0:i.excludeMatchUpStatuses)||[],f=r==null?void 0:r.filter(g=>(g.tieMatchUps||!h.includes(g.matchUpStatus))&&(!(t!=null&&t.length)||Ln(t,[fb(g,0),fb(g,1)]).length===2)),m=(a=f==null?void 0:f.flatMap(({score:g,tieMatchUps:v})=>{var y;return v?v.filter(({matchUpStatus:I})=>!h.includes(I)).flatMap(({score:I})=>{var b;return((b=I==null?void 0:I.sets)==null?void 0:b.length)??0}):((y=g==null?void 0:g.sets)==null?void 0:y.length)??0}))==null?void 0:a.reduce((g,v)=>g+v,0);for(let g of f??[]){let{matchUpStatus:v,tieMatchUps:y,tieFormat:I,score:b,winningSide:D,sides:w}=g,S=I&&g._disableAutoCalc&&I.collectionDefinitions.every(({scoreValue:E})=>E),U=D&&f2e(g),C=D&&m2e(g);if(!U&&!C)if(v&&Mr.includes(v)){let E=fb(g,0),P=fb(g,1);E&&(Uh(p,E),p[E].matchUpsCancelled+=1),P&&(Uh(p,P),p[P].matchUpsCancelled+=1)}else if(y!=null&&y.length){n=0;for(let E of y){if(E.winningSide){let P=(o=w==null?void 0:w.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:o.participantId,M=(s=w==null?void 0:w.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:s.participantId;P&&M&&(Uh(p,P),Uh(p,M),p[P].tieMatchUpsWon+=1,p[M].tieMatchUpsLost+=1,_n(Un)(E.matchUpType)?(p[P].tieSinglesWon+=1,p[M].tieSinglesLost+=1):_n(qi)(E.matchUpType)&&(p[P].tieDoublesWon+=1,p[M].tieDoublesLost+=1))}DY({score:E.score,manualGamesOverride:S,participantResults:p,sides:w})}}else DY({manualGamesOverride:S,participantResults:p,score:b,sides:w});else if(Uh(p,U),Uh(p,C),y==null?void 0:y.length){n=0;for(let E of y){let{matchUpType:P}=E,M=_n(qi)(P),N=_n(Un)(P);E.winningSide&&(E.winningSide===D?(U&&(p[U].tieMatchUpsWon+=1,N&&(p[U].tieSinglesWon+=1),M&&(p[U].tieDoublesWon+=1)),C&&(p[C].tieMatchUpsLost+=1,N&&(p[C].tieSinglesLost+=1),M&&(p[C].tieDoublesLost+=1))):E.winningSide!==D&&(C&&(p[C].tieMatchUpsWon+=1,N&&(p[C].tieSinglesWon+=1),M&&(p[C].tieDoublesWon+=1)),U&&(p[U].tieMatchUpsLost+=1,N&&(p[U].tieSinglesLost+=1),M&&(p[U].tieDoublesLost+=1)))),PY({matchUpFormat:E.matchUpFormat,matchUpStatus:E.matchUpStatus,score:E.score,winningParticipantId:U,losingParticipantId:C,participantResults:p,isTieMatchUp:!0,manualGamesOverride:S,tallyPolicy:i,winningSide:D})}Dhe({winningParticipantId:U,losingParticipantId:C,participantResults:p,matchUpStatus:v})}else PY({matchUpFormat:g.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:U,manualGamesOverride:S,losingParticipantId:C,participantResults:p,matchUpStatus:v,tallyPolicy:i,winningSide:D,score:b});if(S){let E=(l=w==null?void 0:w.find(({sideNumber:R})=>R===1))==null?void 0:l.participantId,P=(c=w==null?void 0:w.find(({sideNumber:R})=>R===2))==null?void 0:c.participantId;Uh(p,E),Uh(p,P);let M=(u=b==null?void 0:b.sets)==null?void 0:u.reduce((R,A)=>R+((A==null?void 0:A.side1Score)??0),0),N=(d=b==null?void 0:b.sets)==null?void 0:d.reduce((R,A)=>R+(A.side2Score??0),0);E&&(p[E].gamesWon+=M,p[E].gamesLost+=N),P&&(p[P].gamesWon+=N,p[P].gamesLost+=M)}}return h2e({participantResults:p,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:m}),{participantResults:p}}function f2e(t){let e=t.winningSide-1;return fb(t,e)}function m2e(t){let e=1-(t.winningSide-1);return fb(t,e)}function fb(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function Uh(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function DY({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},a=[[],[]],o=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(o[c-1]+=1),a[0].push(St(u||0)),a[1].push(St(d||0))}let s=[a[0].reduce((l,c)=>l+c,0),a[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(Uh(e,u),e[u].setsWon+=o[c],e[u].setsLost+=o[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function PY({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:a,isTieMatchUp:o,tallyPolicy:s,winningSide:l,score:c}){let u=l&&l-1,d=1-u;o||Dhe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:a});let p=Mq({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),h=She({matchUpStatus:a,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),{pointsTally:f}=The({score:c,matchUpFormat:r});t&&(i[t].setsWon+=p[u],i[t].setsLost+=p[d],n||(i[t].gamesWon+=h[u],i[t].gamesLost+=h[d]),i[t].pointsWon+=f[u],i[t].pointsLost+=f[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[u],n||(i[e].gamesWon+=h[d],i[e].gamesLost+=h[u]),i[e].pointsWon+=f[d],i[e].pointsLost+=f[u])}function Dhe({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===Ci&&(i[e].walkovers+=1),n===mi&&(i[e].defaults+=1),n===Na&&(i[e].retirements+=1),[mi,Na,Ci].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function g2e({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:a})=>{a.forEach(o=>{o.participantId&&o.participant&&(n[o.participantId]=o.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((a,o)=>{var s,l;if((s=a.excludedDirectives)!=null&&s.length){let c=a.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(a.reversed?m:g)-parseFloat(a.reversed?g:m),u=a.groups?Object.values(a.groups).flat(1/0).length:((l=a.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(I=>n[I]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=a.reversed?" in reverse order":"",h=a.groups?"grouped":"separated",f=`Step ${o+1}: ${u} particiants were ${h}${p} by ${a.attribute}`;if(r.push(f),a.idsFilter){let m=`${a.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(a)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(a=>{let{participantId:o,resolved:s}=a,l=a.groupOrder||a.provisionalOrder;r.push(`${l}: ${n[o]} => resolved: ${!!s}`)}),r.join(`\r
`)}function Phe({participantResults:t,participantIds:e,attribute:i}){return Che({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:a,results:o}=r,s=o==null?void 0:o[i];return!isNaN(s)&&a&&(n[s]?n[s].push(a):n[s]=[a]),n},{})}function Che(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var v2e=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],DL={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function CY(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,a=[];if(e&&!y2e(t))return{};let o=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=Phe({participantResults:i,attribute:o});a.push({attribute:o,groups:s});let l=Object.keys(s).map(f=>parseFloat(f)).sort((f,m)=>m-f).map(f=>s[f]).map(f=>{let m=Ehe({participantIds:f,...t});return a.push(...m.report??[]),m.order}).flat(1/0),c=1,u;l.forEach((f,m)=>{m&&(f.resolved||u&&!f.resolved)&&(c+=1),u=f.resolved,f.resolved?(f.position=m+1,c=f.position):f.position=c});let d=l.map(({position:f})=>f),p=qo(d);return l.forEach(f=>{let{participantId:m,position:g}=f||{},v=i[m];f.GEMscore=h(v);let y=p[g];(f==null?void 0:f.position)!==void 0&&(y>1&&(f.ties=y,n&&(f.subOrder=n[m])),f.rankOrder=g,f.groupOrder=g+(f.subOrder||1)-1)}),{groupOrder:l,report:a.flat(1/0).filter(Boolean)};function h(f){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(DL).filter(m=>r.GEMscore.includes(m)):Object.keys(DL)).map(m=>(f[m]||0)*Math.pow(10,DL[m].toFixed(3))).reduce((m,g)=>m+g,0)}}function y2e({participantResults:t,participantsCount:e}){let i=Che({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function I2e({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:a,matchUps:o,reversed:s}){let{participantResults:l}=AC({participantIds:a&&e,matchUpFormat:i,tallyPolicy:n,matchUps:o}),c=Phe({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:s,groups:c,idsFilter:a}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>s?p-h:h-p).map(p=>c[p]).map(p=>{let h=Ehe({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:o});return u.push(...h.report??[]),h.order}).flat(1/0)),{order:d,report:u}}function Ehe({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:a}){let o=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=b2e({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[u],headToHeadWinner:d,report:s}}}let c=((r==null?void 0:r.tallyDirectives)||v2e).filter(u=>{let d=!(Mn(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||o.push(u),d});return o.length&&s.push({excludedDirectives:o,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=I2e({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:a,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function b2e({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function nS({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:a}){if(!(n!=null&&n.length)||!el(n))return{error:Nd};let o=$t(n.map(({structureId:I})=>I));if(o.length!==1)return oe({result:{error:Ie,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:o}});let s=n.filter(I=>I&&I.matchUpStatus!==wi),l=s.length&&$t(s.map(({drawPositions:I})=>I).flat()).length,c=s.filter(I=>Um({matchUp:I})).length===s.length;c||(a=0);let u=n.every(({matchUpType:I,tieMatchUps:b})=>I===Yi&&(b==null?void 0:b.every(D=>Um({matchUp:D})))),d=t==null?void 0:t[p3],p=n.filter(I=>Um({matchUp:I})||I.matchUpType===Yi),{participantResults:h}=AC({matchUps:p,matchUpFormat:i,tallyPolicy:d,perPlayer:a}),f,m,{groupOrder:g,report:v}=CY({matchUps:p,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r});if(c&&g)f=v,m=g,g.forEach(I=>{let{participantId:b,groupOrder:D,rankOrder:w,subOrder:S,ties:U,GEMscore:C}=I,E=h[b];Object.assign(E,{groupOrder:D,rankOrder:w,GEMscore:C,subOrder:S,ties:U})});else{let{groupOrder:I,report:b}=CY({requireCompletion:!1,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r,matchUps:n});f=b,m=I,I&&I.forEach(D=>{let{participantId:w,groupOrder:S,GEMscore:U}=D,C=h[w];Object.assign(C,{provisionalOrder:S,GEMscore:U})})}let y={completedTieMatchUps:u,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||u)&&(y.order=m),e||qs({tally:!0})){let I=g2e({matchUps:n,report:f,order:m});qs({tally:!0})&&console.log(I),y.readableReport=I}return y}function Mhe({positionAssignments:t}){let e=(t||[]).filter(Ko(yd)).map(r=>{let{extension:a}=jt({element:r,name:fw}),o=St(a==null?void 0:a.value),s=!isNaN(o)&&o;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=qo(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:a})=>({[r]:a})))}}function Nq({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:a}){if(!el(r))return{error:Ie};if(!t)return{error:Ie};let{policyDefinitions:o}=Xp({policyTypes:[p3],tournamentRecord:e,drawDefinition:i,event:a}),{subOrderMap:s}=Mhe({positionAssignments:t}),l=r.length?nS({policyDefinitions:o,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:tf};ui({element:h,extension:m}),c[f].ties||Va({element:h,name:fw})}else Va({element:h,name:tf}),Va({element:h,name:fw})}),Ji({drawDefinition:i}),{...re,participantResults:c,bracketComplete:u,report:d}}function Rhe({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function an({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:a,matchUpId:o,inContext:s,context:l,event:c}){if(!r)return{error:tt};if(!o)return{error:ua};if(typeof o!="string")return{error:Ie};let{structures:u=[]}=Pd({drawDefinition:r});n&&!i&&(i=Qp({contextProfile:n,drawDefinition:r}));for(let d of u){let{matchUps:p}=Ui({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:a,inContext:s,structure:d,context:l,event:c}),{matchUp:h}=Rhe({matchUps:p,matchUpId:o});if(h)return{matchUp:h,structure:d}}return{error:wa}}function Jk(t){var e;return typeof t!="object"?{error:dt}:typeof t.element!="object"?{error:Ie}:t.notes?typeof t.notes!="string"&&!((e=t.notes)!=null&&e.testing)?{error:Ie}:(Object.assign(t.element,{notes:t.notes}),{...re}):{error:dt}}function Nhe(t){return typeof t!="object"?{error:dt}:typeof t.element!="object"?{error:Ie}:(t.element.notes&&delete t.element.notes,{...re})}var Qk={matchUpStatus:Fn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function eu(t){var e,i,n,r,a,o,s,l;let c="modifyMatchUpScore",u=t.matchUpFormat,d=t.matchUp,p,{matchUpStatusCodes:h,removeWinningSide:f,tournamentRecord:m,drawDefinition:g,matchUpStatus:v,removeScore:y,winningSide:I,matchUpId:b,event:D,notes:w,score:S}=t,U=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(e=Mi({policyTypes:[Sd],tournamentRecord:m,drawDefinition:g,structure:p,event:D}))==null?void 0:e.appliedPolicies,C=d.matchUpType===Yi;if(C&&g){if(b&&d.matchUpId!==b){let _=an({drawDefinition:g,matchUpId:b,event:D});if(!_.matchUp)return{error:wa};({matchUp:d,structure:p}=_)}}else d.matchUpId!==b&&console.log("!!!!!");v&&[Ci,er].includes(v)||y?Object.assign(d,{...Qk}):S&&(d.score=S);let E=v&&(d==null?void 0:d.matchUpStatus)===mi&&v!==mi;v&&(d.matchUpStatus=v),u&&(d.matchUpFormat=u),h&&(d.matchUpStatusCodes=h),I&&(d.winningSide=I),f&&(d.winningSide=void 0),!p&&g&&({structure:p}=an({drawDefinition:g,matchUpId:b,event:D})),v&&!d.winningSide&&zr(d)&&!Mr.includes(v)&&![aI,xf].includes(v)&&(d.matchUpStatus=ql);let P;if((E&&(i=d==null?void 0:d.processCodes)!=null&&i.length||v===mi)&&(P=(r=(n=U==null?void 0:U[Sd])==null?void 0:n.processCodes)==null?void 0:r.incompleteAssignmentsOnDefault),!d.collectionId){let _=(p==null?void 0:p.structureType)===eo,O=Yo({structure:p});if(J3({drawDefinition:g,structure:p})||O||_){let x=V=>{u=C?"SET1-S:T100":u??d.matchUpFormat??(V==null?void 0:V.matchUpFormat)??(g==null?void 0:g.matchUpFormat)??(D==null?void 0:D.matchUpFormat);let G=C?{matchUpTypes:[Yi]}:void 0,{matchUps:j}=Ui({afterRecoveryTimes:!1,tournamentRecord:m,inContext:!0,matchUpFilters:G,drawDefinition:g,structure:V,event:D});return O&&(V.positionAssignments=$t(j.flatMap(z=>(z.sides??[]).map(H=>H.participantId)).filter(Boolean)).map(z=>({participantId:z}))),Nq({positionAssignments:V.positionAssignments,tournamentRecord:m,drawDefinition:g,matchUpFormat:u,matchUps:j,event:D})},F=_&&p.structures.find(V=>V==null?void 0:V.matchUps.find(G=>G.matchUpId===b)),$=x(F||p);if($.error)return oe({result:$,stack:c})}}if(w){let _=Jk({element:d,notes:w});if(_.error)return oe({result:_,stack:c})}let M=m==null?void 0:m.tournamentId,N=Wl().topics.includes(Ok),R=(N||P)&&da({drawDefinition:g}),A=R&&((a=lr({matchUpFilters:{matchUpIds:[b]},nextMatchUps:!0,tournamentRecord:m,inContext:!0,drawDefinition:g,matchUpsMap:R}).matchUps)==null?void 0:a[0]);if(N&&A&&IFe({tournamentId:M,inContextMatchUp:A}),Array.isArray(P)&&A&&!((o=A.sides)!=null&&o.every(({participantId:_})=>_)))if(v===mi)d.processCodes=$t([...d.processCodes??[],...P]);else for(let _ of P||[]){let O=_&&((s=d==null?void 0:d.processCodes)==null?void 0:s.lastIndexOf(_));(l=d==null?void 0:d.processCodes)==null||l.splice(O,1)}return si({eventId:D==null?void 0:D.eventId,context:c,drawDefinition:g,tournamentId:M,matchUp:d}),{...re}}function Aq(t){let{dualWinningSideChange:e,matchUpStatusCodes:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=yC({matchUpStatus:n})||[Yp,ps].includes(n)&&e,s="attemptToModifyScore",l=!!a.collectionId,c=Yo({structure:r});if(!(l||c||w2e({structure:r,matchUp:a})))return{error:CW};let u=[Ci].includes(n),d=eu({...t,matchUpStatusCodes:o&&i||[],matchUpStatus:o&&n||qn,context:s,removeScore:u});return oe({result:d,stack:s})}function w2e({structure:t,matchUp:e}){var i;let{drawPositions:n}=e,{positionAssignments:r}=Rr({structure:t});return((i=r==null?void 0:r.filter(a=>(n==null?void 0:n.includes(a.drawPosition))&&a.participantId))==null?void 0:i.length)===2}function Ahe({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>Rt(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>St(n));return{groupValueGroups:e,groupValueNumbers:i}}function S2e({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let a=r.filter(y=>y.collectionId===t.collectionId),o=[0,0],s=[0,0],l=a.every(y=>Mr.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(a.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),Rt(p)?a.forEach(y=>{y.winningSide&&(o[y.winningSide-1]+=p)}):Rt(m)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(D=>{D.winningSide&&(o[D.winningSide-1]+=m)})}):Rt(f)?a.forEach(y=>{var I,b;(b=(I=y.score)==null?void 0:I.sets)==null||b.forEach(D=>{let{side1TiebreakScore:w=0,side2TiebreakScore:S=0,side1Score:U=0,side2Score:C=0}=D;(y.matchUpStatus===qn||y.winningSide||D.winningSide)&&(U||C?(o[0]+=U,o[1]+=C):(w||S)&&D.winningSide&&(o[D.winningSide-1]+=1))})}):Array.isArray(c)&&a.forEach(y=>{if(y.winningSide){let I=y.collectionPosition,b=T2e({collectionDefinition:t,collectionPosition:I});Rt(b)&&(o[y.winningSide-1]+=b)}}),Rt(d)){let y;if(h!=null&&h.aggregateValue)l&&(Rt(p||m||f)&&o[0]!==o[1]?y=o[0]>o[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=o.reduce((I,b,D)=>b>=h.valueGoal?D+1:I,0);else{let I=Math.floor(t.matchUpCount/2)+1;y=v.reduce((b,D,w)=>D>=I?w+1:b,0)}y&&(g?i[u].values[y-1]+=d:s[y-1]+=d)}else g?(i[u].values[0]+=o[0]||0,i[u].values[1]+=o[1]||0):s=o;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=a.length):s.forEach((y,I)=>n[I]+=y||0)}function T2e({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function _he({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:a,collectionPosition:o}=r;if(typeof a!="number"||typeof o!="number"||o>e||o<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==$t(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...re}}var U2e="MIXED events can not contain mixed singles or { gender: ANY } collections",D2e="events with { gender: ANY } can not contain MIXED singles collections";function eO(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[zi,gn].includes(i)&&i!==r?oe({result:{valid:!1,error:tM},context:{gender:r},stack:e}):i===Fo&&(r===vu||r===Fo&&n!==qi)?oe({result:{error:tM,valid:!1},info:U2e,stack:e}):i===vu&&r===Fo&&n!==qi?oe({result:{error:tM,valid:!1},info:D2e,stack:e}):{valid:!0}}function tO(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return P2e(t,e)}function kU(t){return!isNaN(Number(t))&&Number(t)}function khe(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function P2e(t,e){var i;let n=kU(t.bestOf)||void 0,r=kU(t.exactly)||void 0,a=n||r;if((i=t.setFormat)!=null&&i.timed&&t.simplified&&a===1)return khe(t.setFormat);let o=a&&`${lM}${a}`||"",s=EY(t.setFormat,e),l=s&&`S:${s}`||"",c=EY(t.finalSetFormat,e),u=a&&a>1&&c&&s!==c&&`F:${c}`||"";if(o&&s)return[o,l,u].filter(d=>d).join("-")}function EY(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return khe(t);if(t.tiebreakSet)return MY(t.tiebreakSet);let i=kU(t.setTo);if(i){let n=t.NoAD&&eq||"",r=MY(t.tiebreakFormat),a=r&&`/${r}`||"",o=kU(t.tiebreakAt),s=o&&(o!==i||e)&&`@${o}`||"";if(r!==!1)return`${i}${n}${a}${s}`}}}function MY(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&kU(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?eq:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function Zo({matchUpFormat:t}){if(typeof t!="string")return!1;let e=go(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],a=i==null?void 0:i[3],o=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=o==null?void 0:o[1],l=o==null?void 0:o[2],c=o==null?void 0:o[3];return tO(e,!!(i&&r&&n===a||o&&l&&s===c))===t}var C2e=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),E2e=t=>t.filter(Boolean).every(Mn);function _C(t){let e=t.category;if(typeof e!="object")return{error:_R};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o}=e,s=e.categoryName,l;if(!C2e([i,n,r,s],"string")||!E2e([a,o]))return{error:_R};let c=t.consideredDate??Lt(new Date().toLocaleDateString("sv"));if(!ls(c))return{error:Ka};let[u]=c.split("-").slice(0,3).map(F=>parseInt(F)),d=qS(c,-1),[p,h]=d.split("-").slice(1,3).map(F=>parseInt(F)),f=`${ks(p)}-${ks(h)}`,m=qS(c,1),[g,v]=m.split("-").slice(1,3).map(F=>parseInt(F)),y=`${ks(g)}-${ks(v)}`,I=o&&qS(c,-1*365*o),b=a&&qS(c,-1*365*a),D=[],w=F=>!D.includes(F)&&D.push(F);i=i??s;let S=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,C=i==null?void 0:i.includes("-"),E=C&&(i==null?void 0:i.match(U)),P=i==null?void 0:i.match(S),M=(F,$)=>`${F}-${$}`,N=F=>{let $=u-F,V=M($,y);e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==F-1&&(w(`Invalid submitted ageMax: ${a}`),b=void 0),a=F-1)},R=F=>{let $=u-F-1,V=M($,y);e.ageMin&&e.ageMin>F&&w(`Invalid submitted ageMin: ${o}`),e.ageMax&&e.ageMax>F&&w(`Invalid submitted ageMax: ${a}`),e.ageMinDate&&e.ageMinDate!==V&&w(`Invalid submitted ageMinDate: ${r}`),r=V,i&&(e.ageMax&&e.ageMax!==F&&(w(`Invalid submitted ageMax: ${a}`),I=void 0),a=F)},A=F=>{let $=u-F,V=M($,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==F+1&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=F+1)},_=F=>{let $=u-F-1,V=M($,f);e.ageMaxDate&&e.ageMaxDate!==V&&w(`Invalid submitted ageMaxDate: ${n}`),n=V,i&&(e.ageMin&&e.ageMin!==F&&(w(`Invalid submitted ageMin: ${o}`),I=void 0),o=F)},O=F=>{let[$,V,G]=(F.match(S)||[]).slice(1),j=parseInt(V);$==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(j)):$==="O"&&A(j),G==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&w(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(j)):G==="O"&&_(j),n=n??I,r=r??b};if(E){if(n=void 0,r=void 0,a=void 0,o=void 0,e.ageMin){let V=u-e.ageMin;n=M(V,f)}if(e.ageMax){let V=u-e.ageMax-1;r=M(V,y)}let[F,$]=((i==null?void 0:i.match(U))??[]).slice(1).map(V=>parseInt(V));F<=$?(o=F,a=$,l=!0):w(`Invalid combined age range ${i}`)}else C?i==null||i.split("-").forEach(O):P?O(i):(o&&A(o),a&&R(a));a&&e.ageMin&&e.ageMin>a&&(w(`Invalid submitted ageMin: ${e.ageMin}`),o=void 0);let x=ft({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:a,ageMin:o});return D.length&&(x.errors=D),x}function eN({category:t}){if(!on(t))return{error:Ie};let e=_C({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Mn(i)?oe({result:{error:Ie},context:{ratingMax:i}}):n&&!Mn(n)?oe({result:{error:Ie},context:{ratingMin:n}}):{...e}}function iO({childCategory:t,withDetails:e,category:i}){let n=eN({category:i}),r=eN({category:t}),a=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),o=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=ft({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:o,invalidAgeMin:a,valid:!c&&!s&&!l&&!u&&!o&&!a},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function kC({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:a,event:o}){a=a??(o==null?void 0:o.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),oe({result:{errors:l,error:Kp},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:I,gender:b}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!Hk([Un,qi],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(Rt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let D=_he({collectionValueProfiles:c,matchUpCount:h});D.errors&&l.push(...D.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Zo({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let D=eO({referenceGender:a,matchUpType:g,gender:b});if(D.error)return oe({context:{referenceGender:a,gender:b},result:D,stack:s})}if(t&&r&&I){let D=iO({category:r,childCategory:I});if(!D.valid)return oe({result:{error:_R},context:D,stack:s})}return l.length?oe({result:{errors:l,error:bue},stack:s}):{valid:!0}}function Po(t){var e,i,n,r;let a=!!((t==null?void 0:t.enforceCategory)!==!1&&t!=null&&t.category),o=!!((t==null?void 0:t.enforceGender)!==!1&&t!=null&&t.gender),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,c=t==null?void 0:t.event,u="validateTieFormat",d=[];if(!t||!l||typeof l!="object")return d.push("tieFormat must be an object"),oe({result:{error:qd},context:{tieFormat:l,errors:d},stack:u});if(typeof l.winCriteria!="object")return d.push("tieFormat.winCriteria must be an object"),oe({result:{error:qd},context:{tieFormat:l,errors:d},stack:u});if(!Array.isArray(l.collectionDefinitions))return d.push(Ed("tieFormat.collectionDefinitions")),oe({result:{error:qd},context:{tieFormat:l,errors:d},stack:u});let p,h=l.collectionDefinitions.every(y=>{let{setValue:I,scoreValue:b,collectionValue:D}=y;(I||b)&&!D&&(p=!0);let{valid:w,errors:S}=kC({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:y,checkCollectionIds:s,checkCategory:a,checkGender:o,event:c});return w?!0:(Array.isArray(S)&&d.push(...S),!1)}),f=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!p||((n=l.winCriteria)==null?void 0:n.aggregateValue);if(!(f||(r=l.winCriteria)!=null&&r.aggregateValue))return p?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),oe({context:{tieFormat:l,errors:d,aggregateValueImperative:p},result:{error:qd},stack:u});let m=l.collectionDefinitions.map(({collectionId:y})=>y),g=!s||m.length===$t(m).length,v=h&&f&&g;return v?{valid:v,errors:d}:oe({result:{error:qd},context:{tieFormat:l,errors:d},stack:u})}function OC(t){var e,i,n,r,a;let{sideAdjustments:o=[0,0],separator:s="-",drawDefinition:l,matchUpsMap:c,structure:u,matchUp:d,event:p}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((C,E)=>C+E)))return{error:Ie};if(!d)return{error:Do};let h=((e=Ea({matchUp:d,drawDefinition:l,structure:u,event:p}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!h)return{error:VP};let f=Po({tieFormat:h});if(f.error)return f;let m=(h==null?void 0:h.collectionDefinitions)||[],g=(d==null?void 0:d.tieMatchUps)??[],v=[0,0],{groupValueGroups:y,groupValueNumbers:I}=Ahe(h);for(let C of m)S2e({collectionDefinition:C,groupValueNumbers:I,groupValueGroups:y,sideTieValues:v,tieMatchUps:g});for(let C of I){let E=y[C],{allGroupMatchUpsCompleted:P,matchUpCount:M,winCriteria:N,groupValue:R,sideWins:A,values:_}=E,O;if(N!=null&&N.aggregateValue)P&&_[0]!==_[1]&&(O=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)O=_.reduce((x,F,$)=>F>=N.valueGoal?$+1:x,void 0);else{let x=Math.floor(M/2)+1;O=A.reduce((F,$,V)=>$>=x?V+1:F,void 0)}O&&(v[O-1]+=R||0)}let b=v.map((C,E)=>(C||0)+o[E]),D={side1Score:b[0],side2Score:b[1],winningSide:void 0},w=b.join(s),S=b.slice().reverse().join(s),U;if(h!=null&&h.winCriteria){let{valueGoal:C,aggregateValue:E,tallyDirectives:P}=h.winCriteria;if(C?U=(i=b.map((M,N)=>({sideNumber:N+1,points:M})).find(({points:M})=>M>=C))==null?void 0:i.sideNumber:E&&g.every(M=>M.matchUpStatus&&Mr.includes(M.matchUpStatus)||M.winningSide)&&b[0]!==b[1]&&(U=b[0]>b[1]?1:2),!U&&P){let M=d.matchUpId,N=d.hasContext?d:((n=c==null?void 0:c.drawMatchUps)==null?void 0:n[M])||l&&((r=an({inContext:!0,drawDefinition:l,matchUpId:M}))==null?void 0:r.matchUp);if(N){let{completedTieMatchUps:R,order:A}=nS({matchUps:[N]});if(R&&A!=null&&A.length){let _=A[0].participantId;U=(a=N.sides.find(({participantId:O})=>O===_))==null?void 0:a.sideNumber}}}}return U&&(D.winningSide=U),{scoreStringSide1:w,scoreStringSide2:S,winningSide:U,set:D}}function xC({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var a,o;if(n){t||(t=(a=an({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:a.matchUp);let{extension:s}=jt({element:e,name:Dp}),l=ot((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(o=t==null?void 0:t.sides)==null?void 0:o.map(u=>{var d;let p=u.participantId,h=p&&l[p]||void 0,{lineUp:f,...m}=((d=n.sides)==null?void 0:d.find(({sideNumber:v})=>v===u.sideNumber))??{},g=f!=null&&f.length?f:h;return{...c(u),...m,lineUp:g}}),si({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function Jr(t){if(t)return ot(t,!1,!0)}function _q(t){let e=vi(t,[{[Ta]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],a=r.map(({eventId:s})=>s),o=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...a,...o),i.eventIds.push(...a),i.drawIds.push(...o),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Ohe({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=_q({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function th(t){var e,i,n,r;let{exitWhenNoValues:a,drawDefinition:o,matchUpStatus:s,removeScore:l,matchUpsMap:c,matchUpId:u,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},h=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&Ohe({tournamentRecords:p,...t});let f=h&&p[h];if(!f)return{error:Ne};let m=an({drawDefinition:o,event:d,matchUpId:u});if(m.error)return m;if(!m.matchUp)return{error:wa};let{matchUp:g,structure:v}=m;if(!g.tieMatchUps)return{error:uo};xC({tournamentId:f==null?void 0:f.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:o});let{extension:y}=jt({name:hw,element:g});if(y!=null&&y.value)if(l)Va({element:g,name:hw});else return{...re,score:g.score};let I=(n=Ea({drawDefinition:o,structure:v,matchUp:g,event:d}))==null?void 0:n.tieFormat;g.tieFormat=Jr(I);let b=OC({drawDefinition:o,matchUpsMap:c,structure:v,matchUp:g,event:d}),{winningSide:D,set:w,scoreStringSide1:S,scoreStringSide2:U}=b,C=(w==null?void 0:w.side1Score)||(w==null?void 0:w.side2Score);if(a&&!g.score&&!C)return{...re};let E={scoreStringSide1:S,scoreStringSide2:U,sets:w?[w]:[]},P=D&&[1,2].includes(D),M=P&&qn||rq({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:E})&&ql||Fn,N=!!(g.winningSide&&!P),R=g.tieMatchUps.find(({score:_,winningSide:O,matchUpStatus:x})=>{var F;return((F=_==null?void 0:_.sets)==null?void 0:F.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||x&&Mr.includes(x)||O}),A;if(g.tieFormat&&!P&&!R){let _=(r=Ea({drawDefinition:o,structure:v,event:d}))==null?void 0:r.tieFormat;_&&JSON.stringify(I)===JSON.stringify(_)&&(g.tieFormatId=void 0,g.tieFormat=void 0,A=!0)}return eu({appliedPolicies:t.appliedPolicies,matchUpStatus:M,score:E,removeWinningSide:N,tournamentRecord:f,drawDefinition:o,removeScore:l,winningSide:D,matchUpId:u,matchUp:g,event:d}),{...re,score:E,removeWinningSide:N,tieFormatRemoved:A,winningSide:D}}function M2e({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:a,winnerTargetLink:o,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var h,f,m,g,v;let y="directWinner";if(o){let I=c.drawPositions||[],b=I[t],D=o.source.structureId,w=Dt({structureId:D,drawDefinition:l});if(w.error)return w;let{structure:S}=w,{positionAssignments:U}=Rr({structureId:D,drawDefinition:l}),C=(h=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:h.participantId,E=o.target.structureId,{positionAssignments:P}=Rr({structureId:E,drawDefinition:l}),M=(f=P==null?void 0:P.find(A=>A.participantId===C))==null?void 0:f.drawPosition,N=P==null?void 0:P.filter(A=>{let _=I.includes(A.drawPosition),O=!A.participantId&&!A.bye&&!A.qualifier;return _&&O}).map(A=>A.drawPosition),R=N==null?void 0:N.includes(b);if(C&&o.target.roundNumber===1&&R)yu({drawPosition:b,participantId:C,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});else if(C&&N!=null&&N.length){let A=N.pop();A&&yu({participantId:C,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(M){let A=Sw({drawPosition:M,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return oe({result:A,stack:y})}else if((S==null?void 0:S.stage)!==gt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(S!=null&&S.seedAssignments&&S.structureId!==E){let A=S.seedAssignments.find(({participantId:O})=>O===C),_=A==null?void 0:A.participantId;A&&_&&tS({eventId:c==null?void 0:c.eventId,structureId:E,...A,tournamentRecord:a,drawDefinition:l,participantId:_})}}else{let I=Sw({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:a,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(I.error)return I}if(u&&i){let I=(m=u.sides)==null?void 0:m.find(b=>b.sideNumber===i);if(I!=null&&I.lineUp){let b=u.roundPosition,D=c.roundPosition,w=b===D&&b!==1||Math.floor(b/2)===D?2:1,S=(g=d==null?void 0:d.drawMatchUps)==null?void 0:g.find(({matchUpId:E})=>E===c.matchUpId),U=[1,2].map(E=>{var P;return{...((P=S.sides)==null?void 0:P.find(M=>M.sideNumber===E))||{},sideNumber:E}});S.sides=U;let C=S.sides.find(E=>E.sideNumber===w);if(C){let E=(v=I.lineUp)==null?void 0:v.filter(P=>P==null?void 0:P.participantId);C.lineUp=yq({lineUp:E}),si({tournamentId:a==null?void 0:a.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:S,context:y,drawDefinition:l})}}}return{...re}}function R2e(t){var e,i,n;let{loserMatchUpDrawPositionIndex:r,inContextDrawMatchUps:a,projectedWinningSide:o,sourceMatchUpStatus:s,loserDrawPosition:l,tournamentRecord:c,loserTargetLink:u,drawDefinition:d,loserMatchUp:p,dualMatchUp:h,matchUpsMap:f,event:m}=t,g="directLoser",v=u.linkCondition,y=p.drawPositions||[],I=v===Ud&&p.roundNumber===2&&Math.min(...y.filter(Boolean)),b=I||y[r],D=I||y[1-r],w=u.source.structureId,{structure:S}=Dt({structureId:w,drawDefinition:d}),{matchUps:U}=Ui({afterRecoveryTimes:!1,inContext:!0,drawDefinition:d,structure:S,event:m}),C=U.filter(j=>{var z;return(z=j.drawPositions)==null?void 0:z.includes(l)}).filter(j=>{let z=j.sides.find(K=>K.drawPosition===l),H=j.matchUpStatus===Ci||j.matchUpStatus===mi&&!zr(j);return(z==null?void 0:z.sideNumber)===j.winningSide&&!H}),E=v===Ud&&C.length===0,{positionAssignments:P}=Rr({structureId:w,drawDefinition:d}),M=(e=P==null?void 0:P.find(j=>j.drawPosition===l))==null?void 0:e.participantId,N=u.target.structureId,{positionAssignments:R}=Rr({structureId:N,drawDefinition:d}),A=R==null?void 0:R.filter(({drawPosition:j})=>y.includes(j));if(A!=null&&A.some(j=>j.participantId===M))return{...re};let _=A==null?void 0:A.filter(j=>{let z=y.includes(j.drawPosition),H=!j.participantId&&!j.bye&&!j.qualifier;return z&&H}).map(j=>j.drawPosition),O=_==null?void 0:_.includes(b),x=u.target.roundNumber>1&&(_==null?void 0:_.length),F=u.target.roundNumber===1&&O;if(I){let j=$();if(j.error)return oe({result:j,stack:g})}else if(F){let j=G();if(j.error)return oe({result:j,stack:g})}else if(M&&x){_.sort(or);let j=_[0],z=yu({participantId:M,structureId:N,drawPosition:j,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:d,matchUpsMap:f,event:m});if(z.error)return oe({result:z,stack:g})}else return oe({result:{error:N0},context:{loserDrawPosition:l,loserTargetLink:u},stack:g});if(S!=null&&S.seedAssignments&&S.structureId!==N){let j=S.seedAssignments.find(({participantId:H})=>H===M),z=j==null?void 0:j.participantId;j&&z&&tS({eventId:p==null?void 0:p.eventId,structureId:N,...j,tournamentRecord:c,drawDefinition:d,participantId:z})}if(h&&o){let j=(i=h.sides)==null?void 0:i.find(z=>z.sideNumber===3-o);if(j!=null&&j.lineUp){let{roundNumber:z,eventId:H}=p,{roundPosition:K}=h,q=z===1?2-K%2:1,Y=(n=f==null?void 0:f.drawMatchUps)==null?void 0:n.find(({matchUpId:ie})=>ie===p.matchUpId),Z=[1,2].map(ie=>{var ue;return{...((ue=Y.sides)==null?void 0:ue.find(J=>J.sideNumber===ie))||{},sideNumber:ie}});Y.sides=Z;let Q=Y.sides.find(ie=>ie.sideNumber===q);Q&&(Q.lineUp=yq({lineUp:j.lineUp}),si({tournamentId:c==null?void 0:c.tournamentId,matchUp:Y,context:g,drawDefinition:d,eventId:H}))}}return{...re};function $(){let j="loserLinkFedFMLC";return oe(E?{result:G(),stack:j}:{result:V(),stack:j})}function V(){let j=ws({drawPosition:D,structureId:N,tournamentRecord:c,drawDefinition:d,event:m});return oe({result:j,stack:"assignLoserPositionBye"})}function G(){let j=M?yu({drawPosition:b,participantId:M,structureId:N,inContextDrawMatchUps:a,sourceMatchUpStatus:s,tournamentRecord:c,drawDefinition:d,matchUpsMap:f,event:m}):{error:vr};return oe({result:j,stack:"assignLoserDrawPosition"})}}function xhe(t){var e;let i=Aq(t);if(i.error)return i;let n=yC({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:r,projectedWinningSide:a,inContextDrawMatchUps:o,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,dualMatchUp:u,matchUpsMap:d,winningSide:p,targetData:h,matchUpId:f,structure:m,matchUp:g,event:v}=t,y="directParticipants",I=!!g.collectionId,b=Yo({structure:m}),D=g.drawPositions,w;if(I){let{matchUpTieId:S,matchUpsMap:U}=t,C=th({appliedPolicies:t.appliedPolicies,matchUpId:S,tournamentRecord:s,drawDefinition:l,matchUpsMap:U,event:v});if(w=C&&{tieMatchUpResult:C},D=(e=o.find(({matchUpId:E})=>E===S))==null?void 0:e.drawPositions,!r)return oe({result:{...re,...w},stack:y})}if(b)return oe({result:{...re,...w},stack:y});if(D){let S=a?a-1:p-1,U=1-S,C=D[S],E=D[U],{targetLinks:{loserTargetLink:P,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:R,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:O,byeMatchUp:x}}=h;if(_){let F=M2e({sourceMatchUpStatus:n&&c||qn,winnerMatchUpDrawPositionIndex:R,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,winningDrawPosition:C,tournamentRecord:s,winnerTargetLink:M,drawDefinition:l,winnerMatchUp:_,dualMatchUp:u,matchUpsMap:d,event:v});if(F.error)return oe({result:F,stack:y})}if(O){let F=R2e({sourceMatchUpStatus:n&&c||qn,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:f,inContextDrawMatchUps:o,projectedWinningSide:a,loserDrawPosition:E,tournamentRecord:s,loserTargetLink:P,drawDefinition:l,loserMatchUp:O,winningSide:p,matchUpsMap:d,dualMatchUp:u,event:v});if(F.error)return oe({result:F,stack:y})}if(x){let F=x.drawPositions||[],$=Math.min(...F.filter(Boolean)),V=N.target.structureId,G=ws({drawPosition:$,structureId:V,tournamentRecord:s,drawDefinition:l,event:v});if(G.error)return oe({result:G,stack:y})}}else return oe({result:{error:FP},stack:y});return oe({result:{...re,...w},stack:y})}function kq(t){var e,i,n,r;let a="genPlayoffStructure";if(!t.drawDefinition)return oe({result:{error:tt},stack:a});let o=MC(t);if(o.error)return oe({result:o,stack:a});let{structureId:s,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionNaming:u,finishingPositionLimit:d,playoffAttributes:p,playoffPositions:h,roundOffsetLimit:f,tournamentRecord:m,exitProfileLimit:g,roundProfiles:v,roundNumbers:y,idPrefix:I,isMock:b,event:D,uuids:w}=t,S=ot(t.drawDefinition,!1,!0),{structure:U}=Dt({structureId:s,drawDefinition:S});if(!U)return oe({result:{error:wn},stack:a});if(U.structureType===eo||U.structures)return a2e({sourceStructureId:U.structureId,...t,...o,drawDefinition:S});let{playoffRoundsRanges:C,playoffRounds:E}=o,{playoffPositionsReturned:P,error:M,playoffSourceRounds:N,playoffRoundsRanges:R}=ghe(t);if(M)return oe({result:{error:M},stack:a});let A=(v==null?void 0:v.length)&&Object.assign({},...v),_=y||typeof v=="object"&&v.map(ie=>Object.keys(ie)).flat(),O=Array.isArray(_)&&_.map(ie=>!isNaN(ie)&&St(ie)).filter(Boolean);if(O){if(!Array.isArray(O))return oe({result:{error:Ie},context:{validRoundNumbers:O},stack:a});O.forEach(ie=>{if(!(E!=null&&E.includes(ie)))return oe({result:{error:Ie},context:{roundNumber:ie},stack:a})})}h&&h.forEach(ie=>{if(!(P!=null&&P.includes(ie)))return oe({result:{error:Ie},context:{playoffPosition:ie},stack:a})});let x=O||N,F=O?C:R,$=[],V=[];for(let ie of x??[]){let ue=F==null?void 0:F.find(he=>he.roundNumber===ie);if(!ue)return oe({result:{error:Ie},context:{roundNumber:ie},stack:a});let J=ue.finishingPositions.length,te=Math.min(...ue.finishingPositions)-1,se=2,ee=ie&&(A==null?void 0:A[ie])&&se+A[ie]-1,ce=wb({exitProfile:`0-${ie}`,addNameBaseToAttributeName:l,playoffStructureNameBase:c,finishingPositionOffset:te,playoffAttributes:p,exitProfileLimit:g,stage:Nn,roundOffset:0,drawDefinition:S,sequenceLimit:ee,stageSequence:se,drawSize:J,idPrefix:I,isMock:b,uuids:w,finishingPositionNaming:u,finishingPositionLimit:d,roundOffsetLimit:f});if(ce.error)return oe({result:ce,stack:a});let{structures:fe,links:ge}=ce;if(fe!=null&&fe.length&&$.push(...fe),ge!=null&&ge.length&&V.push(...ge),ce.structureId&&ie){let he={linkType:Td,source:{structureId:s,roundNumber:ie},target:{structureId:ce.structureId,feedProfile:yl,roundNumber:1}};V.push(he)}}if(!$.length)return oe({result:{error:Ie},info:"No structures generated",stack:a});S.structures.push(...$),S.links.push(...V);let{matchUps:G,matchUpsMap:j}=lr({inContext:!0,drawDefinition:S}),z=$.map(({structureId:ie})=>ie),H=G==null?void 0:G.filter(({structureId:ie})=>z.includes(ie)).map(Cr),K=(e=j==null?void 0:j.drawMatchUps)==null?void 0:e.filter(({matchUpId:ie})=>H==null?void 0:H.includes(ie));if(K!=null&&K.length){let ie=(i=Ea({drawDefinition:S,event:D}))==null?void 0:i.tieFormat;ie&&K.forEach(ue=>{let{tieMatchUps:J}=RC({matchUp:ue,tieFormat:ie,isMock:b});Object.assign(ue,{tieMatchUps:J,matchUpType:Yi})})}(n=G==null?void 0:G.filter(ie=>Um({matchUp:ie})&&ie.structureId===s))==null||n.forEach(ie=>{let{matchUpId:ue,score:J,winningSide:te}=ie,se=Xa({inContextDrawMatchUps:G,drawDefinition:S,matchUpId:ue}),ee=xhe({inContextDrawMatchUps:G,tournamentRecord:m,drawDefinition:S,matchUpsMap:j,winningSide:te,targetData:se,matchUpId:ue,structure:U,matchUp:ie,score:J,event:D});ee.error&&console.log(ee.error)}),(r=G==null?void 0:G.filter(ie=>ie.matchUpStatus===wi&&ie.structureId===s))==null||r.forEach(ie=>{let{matchUpId:ue}=ie,J=Xa({inContextDrawMatchUps:G,drawDefinition:S,matchUpId:ue}),{targetLinks:{loserTargetLink:te},targetMatchUps:{loserMatchUpDrawPositionIndex:se,loserMatchUp:ee}}=J;if(te&&ee){let ce=te.target.structureId,fe=ee.drawPositions[se],ge=ws({drawPosition:fe,structureId:ce,tournamentRecord:m,drawDefinition:S,event:D});ge.error&&console.log(ge.error)}});let q=[],Y=Zm({inContextDrawMatchUps:G,drawDefinition:S,matchUpsMap:j}).goesToMap,{structure:Z}=Dt({drawDefinition:t.drawDefinition,structureId:s}),{matchUps:Q}=Ui({structure:Z});return Q.forEach(ie=>{var ue,J;let te=Y==null?void 0:Y.loserMatchUpIds[ie.matchUpId];if(te&&ie.loserMatchUpId!==te){ie.loserMatchUpId=te;let ee={tournamentId:m==null?void 0:m.tournamentId,eventId:(ue=t.event)==null?void 0:ue.eventId,context:a,matchUp:ie};q.push(ee)}let se=Y==null?void 0:Y.winnerMatchUpIds[ie.matchUpId];if(se&&ie.winnerMatchUpId!==se){ie.winnerMatchUpId=se;let ee={tournamentId:m==null?void 0:m.tournamentId,eventId:(J=t.event)==null?void 0:J.eventId,context:a,matchUp:ie};q.push(ee)}}),{structures:$,matchUpModifications:q,links:V,drawDefinition:S,...re}}function Lhe(t){return nO({...t,itemType:"attachConsolationStructures"})}function Oq(t){return nO({...t,itemType:"attachPlayoffStructures"})}function nO({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:a=[],event:o}){var s,l,c;let u="attachStructures";if(!n)return{error:tt};if(!Array.isArray(r)||!Array.isArray(a))return oe({result:{error:Ie},stack:u});let d=I=>{var b;return[I.source.structureId,I.source.roundNumber||((b=I.source.finishingPositions)==null?void 0:b.join("|")),I.target.roundNumber].join("|")},p=(s=n.links)==null?void 0:s.map(d);if(a.some(I=>{let b=d(I);return p==null?void 0:p.includes(b)}))return oe({result:{error:qW},info:"playoff structure exists",stack:u});a.length&&((l=n.links)==null||l.push(...a));let h=r.map(({structureId:I})=>I),f=(c=n.structures)==null?void 0:c.map(({structureId:I})=>I);n.structures=(n.structures??[]).map(I=>h.includes(I.structureId)?r.find(({structureId:b})=>b===I.structureId):I);let m=r==null?void 0:r.filter(({structureId:I})=>!(f!=null&&f.includes(I)));m.length&&n.structures.push(...m),Zm({drawDefinition:n});let g=r.map(I=>{var b;return((b=Ui({structure:I}))==null?void 0:b.matchUps)||[]}).flat();rf({tournamentId:i==null?void 0:i.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:n,matchUps:g});let v=r.map(({structureId:I})=>I);if(Ji({drawDefinition:n,structureIds:v}),e==null?void 0:e.length){let I={};e.forEach(D=>{var w;let S=(w=D.matchUp)==null?void 0:w.matchUpId;S&&(I[S]=D)});let b=D=>{D.matchUps.forEach(w=>{if(I[w.matchUpId]){let{tieMatchUps:S,...U}=I[w.matchUpId].matchUp;if(Object.assign(w,U),S==null?void 0:S.length){let C={};S.forEach(E=>I[E.matchUpId]=E),w.tieMatchUps.forEach(E=>Object.assign(E,C[E.matchUpId]))}I[w.matchUpId].matchUp=w,si(I[w.matchUpId])}})};n.structures.forEach(D=>{if(f!=null&&f.includes(D.structureId))if(D.structures)for(let w of D.structures)b(w);else b(D)})}let y=m.map(Ko("structureId"));if(i){let I={itemValue:{structureIds:v,drawId:n.drawId},itemType:t};Lf({element:i,timeItem:I})}return{...re,addedStructureIds:y}}function rO(t){var e,i;let{structures:n,links:r,matchUpModifications:a,error:o}=kq(t);if(o)return{error:o};let s=t.drawDefinition;return Oq({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:a,drawDefinition:s,structures:n,links:r})}function Xm(t){let e=vi(t,[{_anyOf:{[Ta]:!1,[Ad]:!1,[$c]:!1,[$0]:!1},[t3]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=RY(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&Ji({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Ne};for(let a of r){let o=t.tournamentRecords[a],s=RY(t,o);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:Ne};return i.length?{...re,applied:i}:{error:_W}}function RY(t,e){let i=Mi(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:uk};for(let a of r)if(!i[a]||t.allowReplacement){let o=t.policyDefinitions[a];if(!o)continue;if(!on(o))return{error:Ie};let{policyName:s,...l}=o;if(!l||!Object.keys(l).length||s&&!co(s))return{error:Ie};i[a]=t.policyDefinitions[a],n.push(a)}return n!=null&&n.length?{...ui({element:e,extension:{name:UU,value:i}}),applied:n}:{applied:n,error:_W}}function xq({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:a}){var o;if(!n||typeof n!="string")return oe({result:{error:Ie},context:{drawName:n}});i||(i=Vn({event:a}).flightProfile);let s=(o=i==null?void 0:i.flights)==null?void 0:o.find(l=>l.drawId===r);if(s){s.drawName=n;let l={name:kl,value:{...i,flights:i.flights}};Of({event:a,extension:l})}return e&&(e.drawName=n,Ji({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!s&&!e?{error:tt}:{...re,flight:s}}function Fhe({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var a;if(!on(i))return{error:Ie};let o=Vn({event:r}).flightProfile,s=i.drawName&&xq({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:n,event:r});if(s!=null&&s.error)return s==null?void 0:s.error;let l=(s==null?void 0:s.flight)||((a=o==null?void 0:o.flights)==null?void 0:a.find(c=>c.drawId===n));if(!l&&!e)return{error:tt};if(l){let c={name:kl,value:{...o,flights:o.flights}};Of({event:r,extension:c})}return e&&(i.policyDefinitions&&Xm({policyDefinitions:i.policyDefinitions,drawDefinition:e}),Ji({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...re}}function $he({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var n,r;if(!i)return{error:tt};let a=da({drawDefinition:i}),o=l=>{var c;return(c=a==null?void 0:a.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![gt,nt].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=Ui({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:a,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=o(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==wi&&Object.assign(y,Qk),g&&g>1&&((n=y.drawPositions)==null?void 0:n.length)&&!h){let I=v==null?void 0:v.map(({drawPosition:D,participantFed:w})=>!w&&D).filter(Boolean),b=y.drawPositions.map(D=>I.includes(D)?void 0:D);y.drawPositions=b}e?delete y.timeItems:(r=y.timeItems)!=null&&r.length&&(y.timeItems=y.timeItems.filter(I=>I.itemType&&![Np,qm,K0,qde,Y0,Z0].includes(I.itemType))),si({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let s=(i.structures||[]).map(({structureId:l})=>l);return Ji({drawDefinition:i,structureIds:s}),{...re}}function LC({tournamentRecord:t}){var e;if(!t)return{error:Ne};let i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return((e=t.events)==null?void 0:e.map(r=>{let a=r.eventId;return n[a]=r,((r==null?void 0:r.drawDefinitions)||[]).map(o=>({drawDefinition:o,eventId:a}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:a})=>{let o=0,s=0,l=0,{allStructuresLinked:c}=Xk({drawDefinition:r}),u=n[a],d=((r==null?void 0:r.structures)||[]).map(b=>{let{stage:D,stageSequence:w,structureId:S}=b,U=cy[D],{inContextStructureMatchUps:C}=IC({drawDefinition:r,structure:b,event:u}),E=C==null?void 0:C.filter(({winningSide:j})=>j),P=E.filter(Boolean).length||0;s+=P,l+=C.length-s;let M=Math.max(E.filter(({roundNumber:j})=>j===1).map(({roundPosition:j})=>j)),{positionAssignments:N}=Vi({structure:b}),R=N==null?void 0:N.filter(({participantId:j})=>j);o+=(R==null?void 0:R.length)??0;let A=((N==null?void 0:N.length)??0)-((R==null?void 0:R.length)??0),{roundMatchUps:_,roundProfile:O,roundNumbers:x,maxMatchUpsCount:F}=Za({matchUps:C}),$=O&&Object.keys(O).filter(j=>!O[j].inactiveRound).map(j=>parseInt(j)),V=O&&Object.keys(O).filter(j=>O[j].inactiveRound).map(j=>parseInt(j)),G=O&&Object.values(O).every(j=>j.inactiveRound);return{positionsAssignedCount:(R==null?void 0:R.length)??0,maxWinningSideFirstRoundPosition:M,unassignedPositionsCount:A,inactiveStructure:G,maxMatchUpsCount:F,inactiveRounds:V,roundMatchUps:_,activeRounds:$,roundNumbers:x,roundProfile:O,structureId:S,stageSequence:w,orderNumber:U,stage:D}}),p=d.find(b=>b.orderNumber===2&&b.stageSequence===1),h=d.filter(({inactiveStructure:b})=>!b).length,{links:f}=X0({structureId:p.structureId,drawDefinition:r}),m=St(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:b})=>b),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;o&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),m&&i.matchPlay.push(y),v&&i.canBePruned.push(y);let I={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:o,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};i.drawAnalysis[y]=I}),{...re,drawsAnalysis:i}}function Bhe({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var r;if(!e)return{error:Ne};if(!i)return{error:tt};let a=[],{drawsAnalysis:o}=LC({tournamentRecord:e});if(o.canBePruned.includes(n)){let s=o.matchPlay.includes(n),l=o.drawAnalysis[n],{structures:[c]}=Pd({stageSequence:1,drawDefinition:i,stage:nt}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);a=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=a.map(Cr),h=d.map(Cr).filter(f=>!p.includes(f));if(s){let f=a.filter(({roundNumber:I})=>!u.inactiveRounds.includes(I)).filter(({winningSide:I})=>I),m=f.map(Cr),g=p.filter(I=>!m.includes(I));h.push(...g);let v=f.flatMap(I=>I.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((I,b)=>({[I]:b+1})));if(f.forEach(I=>{t?I.drawPositions=I.drawPositions.map(b=>y[b]):delete I.drawPositions}),t){let I=(r=c==null?void 0:c.positionAssignments)==null?void 0:r.filter(b=>v.includes(b.drawPosition)).map(b=>(b.drawPosition=y[b.drawPosition],b));c.positionAssignments=I}else c.positionAssignments=[];c.matchUps=f,a=f}Zp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),Ji({drawDefinition:i})}return{...re,matchUps:a}}function Vhe({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:a,event:o,bye:s}){if(!e)return{error:tt};if(!n)return{error:A0};if(!r)return{error:Is};if(s){let l=ws({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:o});if(l.error)return l}else{if(a)return{error:yk};{let l=yu({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:o});if(l.error)return l}}return{...re}}function jhe(t){var e,i,n,r,a;let o=t.matchUpIds??[],{drawDefinition:s}=t,l=t.structureId??((i=(e=s==null?void 0:s.structures)==null?void 0:e.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>o.includes(m))}))==null?void 0:i.structureId)??((r=(n=s==null?void 0:s.structures)==null?void 0:n[0])==null?void 0:r.structureId);if(!l)return{error:wn};let c=(a=s.structures)==null?void 0:a.find(h=>h.structureId===l);if(!c)return{error:wn};let u=c==null?void 0:c.matchUps,d=u==null?void 0:u.find(h=>!!h.roundPosition);if(c.structures||d||c.finishingPosition===oI)return{error:Qy};let p=u.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Cr);return o=o.filter(h=>!p.includes(h)),t.roundNumbers&&!o.length&&(o=p),{existingMatchUps:u,matchUpIds:o,structureId:l,structure:c}}function Ghe(t){let e=vi(t,[{[$c]:!0},{[bU]:{[WP]:!1,roundNumbers:!1},[Id]:Ie,[_f]:Ao}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:a,drawDefinition:o,event:s}=t,l=jhe(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:I})=>{if(I&&!r)return!1;if(zr({score:y})){if(!I&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map(Cr),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map(Cr)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:I})=>!m.includes(I)),Zp({tournamentId:a==null?void 0:a.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:o});let v=$t(c.matchUps.map(Ko("roundNumber"))),y=mLe(v);if(y.length){y.reverse();for(let I of y)c.matchUps.forEach(b=>{b.roundNumber&&b.roundNumber>I&&(b.roundNumber-=1,si({tournamentId:a==null?void 0:a.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:o,matchUp:b}))})}if(h.length){c.positionAssignments=$t(c.matchUps.flatMap(w=>(w.sides??[]).map(S=>S.participantId)).filter(Boolean)).map(w=>({participantId:w}));let I=(c==null?void 0:c.matchUpFormat)??(o==null?void 0:o.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:b}=Ui({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),D=Nq({positionAssignments:c.positionAssignments,tournamentRecord:a,drawDefinition:o,matchUpFormat:I,matchUps:b,event:s});D.error&&console.log(D)}Ji({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:o})}return!m.length&&p.length?{error:bk}:{...re,deletedMatchUpsCount:[...m,...g].length}}function Hhe({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:a}){if(!e)return{error:Ne};if(!i)return{error:tt};if(!r)return oe({result:{error:dt},info:"roundNumber required"});let o=Dt({drawDefinition:i,structureId:n});if(o.error)return o;let s=o.structure;return s!=null&&s.structures?{error:Qy}:Yo({structure:s})?N2e({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:a.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...re})}function N2e({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:a}){let o=(r==null?void 0:r.matchUps)??[],s=[],l=[],c=!1;if(o.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(or).includes(n)){let u=o.filter(d=>{let p=d.roundNumber===n&&(!Mr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Cr))),!p});l.length&&(Zp({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:a}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,si({drawDefinition:e,tournamentId:i,eventId:a,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...re}}function aO(t){var e,i,n,r,a,o;let{suppressNotifications:s,tournamentRecord:l,drawDefinition:c,matchUps:u,event:d}=t;if(typeof c!="object")return{error:tt};let p=t==null?void 0:t.structureId;if(!p&&((e=c.structures)==null?void 0:e.length)===1&&(p=(n=(i=c.structures)==null?void 0:i[0])==null?void 0:n.structureId),typeof p!="string")return{error:Is};if(!el(u))return{error:Ie,info:Ed("matchUps")};let h=(r=c.structures)==null?void 0:r.find(y=>y.structureId===p);if(!h)return{error:wn};let f=(h==null?void 0:h.matchUps).find(y=>!!y.roundPosition);if(h.structures||f||h.finishingPosition===oI)return{error:Qy};let m=((o=(a=Hr({tournamentRecord:l,inContext:!1}))==null?void 0:a.matchUps)==null?void 0:o.map(Cr))??[],g=u.map(Cr);if(Ya(m,g))return{error:Due,info:"One or more matchUpIds already present in tournamentRecord"};h.matchUps.push(...u);let v=u.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return s||(rf({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...v,...u],eventId:d==null?void 0:d.eventId,drawDefinition:c}),Ji({drawDefinition:c,structureIds:[p]})),{...re}}function zhe({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:a}){var o;if(!e)return{error:tt};if(!n)return{error:Is};if(!i)return{error:A0};let{structure:s}=Dt({drawDefinition:e,structureId:n});if(!s)return{error:wn};let l=s;s.structures&&s.structureType===eo&&(l=(o=s.structures)==null?void 0:o.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let c=l==null?void 0:l.positionAssignments,u=c==null?void 0:c.find(f=>f.drawPosition===i);u&&ui({element:u,extension:{name:fw,value:r}});let d=((a==null?void 0:a.eventType)===Yi||e.matchUpType===Yi||((a==null?void 0:a.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[Yi]},{matchUps:p}=Ui({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:a}),h=(s==null?void 0:s.matchUpFormat)??e.matchUpFormat;return Nq({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:h,matchUps:p,event:a}),Ji({drawDefinition:e,structureIds:[n]}),{...re}}var Whe={};Ht(Whe,{addGoesTo:()=>Zm,allPlayoffPositionsFilled:()=>Sq,checkValidEntries:()=>cO,findDrawDefinition:()=>Bq,getAssignedParticipantIds:()=>Og,getAvailableMatchUpsCount:()=>oO,getAvailablePlayoffProfiles:()=>MC,getDrawDefinitionTimeItem:()=>iq,getDrawParticipantRepresentativeIds:()=>Fq,getDrawTypeCoercion:()=>FC,getEligibleVoluntaryConsolationParticipants:()=>Lq,getMatchUpsMap:()=>da,getParticipantIdFinishingPositions:()=>$q,getPositionAssignments:()=>xU,getPositionsPlayedOff:()=>iS,getSeedingThresholds:()=>gq,getSeedsCount:()=>$C,getStructureSeedAssignments:()=>Ks,getTeamLineUp:()=>Ym,getValidGroupSizes:()=>UC,isAdHoc:()=>Yo,isCompletedStructure:()=>sf,isValidForQualifying:()=>Kq,positionActions:()=>qq});function Lq({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:a,tournamentRecord:o,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var f,m,g,v,y;if(!s)return{error:tt};let I=[nt,Nn];i&&I.push(gt);let b=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,D=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,w=e&&h?((f=eh({contextFilters:{stages:I},matchUpFilters:b,tournamentRecord:o,inContext:!0,event:h}))==null?void 0:f.matchUps)??[]:((m=ro({contextFilters:{stages:I},matchUpFilters:D,tournamentRecord:o,inContext:!0,drawDefinition:s}))==null?void 0:m.matchUps)??[],S=lI({stage:xr,drawDefinition:s}).map(({participantId:G})=>G),U={},C={},E={},P={};r||(r=Xp({policyTypes:[sB],tournamentRecord:o,drawDefinition:s,event:h}).policyDefinitions);let M=r==null?void 0:r[sB];t=t.length&&t||(M==null?void 0:M.excludedMatchUpStatuses)||[],e=e??(M==null?void 0:M.includeEventParticipants),d=d??(M==null?void 0:M.allEntries),n=n??(M==null?void 0:M.finishingRoundLimit),a=a??(M==null?void 0:M.roundNumberLimit),l=l??(M==null?void 0:M.matchUpsLimit),c===void 0&&(c=(M==null?void 0:M.requirePlay)!==void 0?M.requirePlay:!0),u===void 0&&(u=(M==null?void 0:M.requireLoss)!==void 0?M.requireLoss:!0),p=p??(M==null?void 0:M.winsLimit);for(let G of w){if(c&&G.winningSide&&![1,2].includes(G.winningSide)&&G.matchUpStatus!==er||G.finishingRound&&n&&G.finishingRound>=n||G.finishingRound&&a&&G.finishingRound<=a)continue;let j=(g=G.sides)==null?void 0:g.find(({sideNumber:H})=>G.winningSide&&H===3-G.winningSide),z=(v=G.sides)==null?void 0:v.find(({sideNumber:H})=>G.winningSide&&H===G.winningSide);if((y=G.sides)==null||y.forEach(H=>{var K;let q=(K=H==null?void 0:H.participant)==null?void 0:K.participantId;q&&(E[q]=H.participant,G.matchUpStatus===er&&!c&&(C[q]=H.participant,U[q]||(U[q]=0),(!G.matchUpStatus||!t.includes(G.matchUpStatus))&&(U[q]+=1)))}),j==null?void 0:j.participant){let H=j.participant.participantId;C[H]=j.participant,U[H]||(U[H]=0),G.matchUpStatus&&!t.includes(G.matchUpStatus)&&(U[H]+=1)}if(z!=null&&z.participant){let H=z.participant.participantId;P[H]||(P[H]=0),P[H]+=1,U[H]||(U[H]=0),G.matchUpStatus&&!t.includes(G.matchUpStatus)&&(U[H]+=1)}}let N=(o==null?void 0:o.participants)&&!c&&!u&&d,R=N?((e&&h?h.entries:s.entries)??[]).filter(G=>![Rp,Kl].includes(G.entryStatus)).map(({participantId:G})=>G):[],A=Object.keys(C),_=N?((o==null?void 0:o.participants)??[]).filter(({participantId:G})=>R.includes(G)):u&&Object.values(C)||Object.values(E),O=G=>!u||A.includes(G),x=G=>!c||(U[G]||0)>=0,F=G=>!p||(P[G]||0)<=p,$=G=>!l||U[G]<=l,V=G=>!S.includes(G);return{eligibleParticipants:_.filter(G=>O(G.participantId)&&x(G.participantId)&&F(G.participantId)&&$(G.participantId)&&V(G.participantId)).map(G=>{var j;return{...G,individualParticipants:(j=G.individualParticipantIds)==null?void 0:j.map(z=>{var H;return(H=o==null?void 0:o.participants)==null?void 0:H.find(K=>K.participantId===z)})}}),losingParticipantIds:A,...re}}function oO(t){var e,i,n,r,a,o,s,l;let c=vi(t,[{drawDefinition:!0}]);if(c.error)return c;let{drawDefinition:u,roundNumber:d}=t,p=t.structureId??(((e=u.structures)==null?void 0:e.length)===1&&((n=(i=u.structures)==null?void 0:i[0])==null?void 0:n.structureId));if(typeof p!="string")return{error:Is};let h=(r=u.structures)==null?void 0:r.find(w=>w.structureId===p);if(!h)return{error:wn};let f,m=(a=h.matchUps??[])==null?void 0:a.reduce((w,S)=>(S.roundPosition&&(f=!0),((S==null?void 0:S.roundNumber)||0)>w?S.roundNumber:w),0);if(h.structures||f||h.finishingPosition===oI)return{error:Qy};let g=((o=u==null?void 0:u.entries)==null?void 0:o.filter(w=>{let S=w.entryStatus;return Yl.includes(S)}))??[],v=Math.floor((g==null?void 0:g.length)/2)||1,y=d??m??1,I=((l=(s=h.matchUps)==null?void 0:s.filter(w=>w.roundNumber===y))==null?void 0:l.length)??0,b=v-I,D=b>0?b:0;return{...re,availableMatchUpsCount:D,lastRoundNumber:m,roundMatchUpsCount:v}}function Fq({drawDefinition:t}){var e;let i=jt({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function A2e({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:tt};let n=lr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=ot(n.matchUps,!1,!0),a=$t(r.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),o=Object.assign({},...a.map(s=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:a,participantIdMatchUps:o}}function $q({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:tt};let{participantIds:n,participantIdMatchUps:r}=A2e({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),a=(n==null?void 0:n.map(o=>{let s=r[o].filter(d=>[qn,wi].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===o).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[o]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...a)}function Ff({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:Ne};if(!n)return{error:Fc};if(!e&&t){if(typeof i!="string"&&(i=Ohe({tournamentRecords:t,drawId:n}),!i))return{error:rw};if(e=t[i],!e)return{error:Ne}}let r=e&&po({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...re}:oe({result:{error:zo},stack:"findDrawDefinition"})}function Bq(t){let{drawDefinition:e,error:i}=Ff(t);return i?{error:i}:{drawDefinition:ot(e)}}function TB({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:a}=X0({drawDefinition:i,structureId:n})||{},o=((a==null?void 0:a.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=Dt({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:o.map(({source:s})=>s.structureId),relevantLinks:o}}var _2e="qualifierDrawPositionAssignment",k2e="withdrawParticipantAtDrawPosition",O2e="alternateDrawPositionAssignment",x2e="luckyLoserDrawPositionAssignment",NY="removeDrawPositionAssignment",L2e="swapDrawPositionAssignments",F2e="modifyPairAssignment",$2e="modifyParticipantOtherName",AY="assignDrawPosition",B2e="removeSeededParticipant",V2e="assignDrawPositionBye",j2e="modifySeedAssignment",qhe="addPenalty",Vq="MODIFY_PAIR",sO="QUALIFIER",jq="ALTERNATE",Gq="WITHDRAW",py="ASSIGN",UB="REMOVE",Hq="LUCKY",IT="REMOVE_SEED",zq="SWAP",OU="NICKNAME",Av="SEED_VALUE",hy="PENALTY",tN="BYE",G2e={MODIFY_PAIR_ASSIGNMENT:Vq,QUALIFYING_PARTICIPANT:sO,ALTERNATE_PARTICIPANT:jq,WITHDRAW_PARTICIPANT:Gq,ASSIGN_PARTICIPANT:py,LUCKY_PARTICIPANT:Hq,REMOVE_ASSIGNMENT:UB,SWAP_PARTICIPANTS:zq,ADD_NICKNAME:OU,REMOVE_SEED:IT,ADD_PENALTY:hy,ASSIGN_BYE:tN,SEED_VALUE:Av};function H2e({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:a}){var o;let s=((o=a==null?void 0:a.entries)==null?void 0:o.filter(({entryStatus:l})=>[Kl,Eg].includes(l)).map(({participantId:l})=>l))||[];if(s.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>s.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:ft({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:F2e,availableIndividualParticipantIds:s,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:Vq},!1,!1,!0)}}return{}}function Jm(t){var e,i;let{inContextDrawMatchUps:n,targetData:r,drawDefinition:a,relevantLink:o}=t;if((o==null?void 0:o.linkCondition)===Ud&&((e=r==null?void 0:r.matchUp)==null?void 0:e.matchUpStatus)===wi)return!1;let{targetMatchUps:{loserMatchUp:s,winnerMatchUp:l},targetLinks:c}=r,u=[mi,Ci].includes(s==null?void 0:s.matchUpStatus),d=((i=l==null?void 0:l.drawPositions)==null?void 0:i.filter(Boolean).length)||0;if(s!=null&&s.winningSide&&!u||l!=null&&l.winningSide&&d===2&&(!l.feedRound||![Ci,mi].includes(l==null?void 0:l.matchUpStatus)))return!0;let p=s&&Xa({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),h=l&&Xa({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:a}),f=p&&Jm({relevantLink:c==null?void 0:c.loserTargetLink,targetData:p,inContextDrawMatchUps:n,drawDefinition:a});return!!(h&&Jm({targetData:h,inContextDrawMatchUps:n,drawDefinition:a})||f)}var Khe={[Up]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[gt,nt],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[OU,hy,sO,Av],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},dM="positionAction",DB="matchUpAction";function Yhe({actionType:t=dM,appliedPolicies:e,drawDefinition:i,structure:n}){var r,a;let o=t===dM&&Up||t===DB&&Or,s=t===dM&&Khe||t===DB&&Epe,l=o&&((e==null?void 0:e[o])||(s==null?void 0:s[o])),c=((a=(r=i.links)==null?void 0:r.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:a.map(({target:h})=>h.feedProfile))??[],{enabledStructures:u,disabledStructures:d}=l||{},p=d==null?void 0:d.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>c.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:u,actionsDisabled:p,actionsPolicy:l}}function _Y({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Zhe({enabledStructures:t,drawDefinition:e,structure:i}){var n,r;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:a,stageSequence:o,structureType:s}=i||{},l=((r=(n=e.links)==null?void 0:n.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:r.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(a),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(s),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>l.includes(y));return m&&g&&v&&c&&f})}}function bo({action:t,policyActions:e}){var i;let n=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return n?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!n}var Xhe="replaceTieMatchUpParticipantId",Jhe="assignTieMatchUpParticipantId",PB="removeTieMatchUpParticipantId",kY="assignMatchUpSideParticipant",z2e="removeMatchUpSideParticipant",Qhe="substituteParticipant",CB="REMOVE_SUBSTITUTION",efe="REPLACE_PARTICIPANT",Wq="REMOVE_PARTICIPANT",EB="setMatchUpStatus",MB="SUBSTITUTION",tfe="SCHEDULE",W2e="PENALTY",RB="REFEREE",ife="STATUS",NB="START",nfe="SCORE",AB="END",q2e={REPLACE_TEAM_POSITION_METHOD:Xhe,ASSIGN_TEAM_POSITION_METHOD:Jhe,REMOVE_TEAM_POSITION_METHOD:PB,REPLACE_PARTICIPANT:efe,SUBSTITUTION_METHOD:Qhe,REMOVE_SUBSTITUTION:CB,REMOVE_PARTICIPANT:Wq,SCHEDULE_METHOD:EB,SUBSTITUTION:MB,SCHEDULE:tfe,PENALTY:W2e,REFEREE:RB,STATUS:ife,SCORE:nfe,START:NB,END:AB};function K2e({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:a,enforceGender:o,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var h,f,m,g,v,y,I,b,D,w,S,U,C,E,P;let M=[],N=(h=r.sides)==null?void 0:h.find(Z=>Z.participant),R=r.gender===Fo&&r.sideNumber&&((f=r.sides)==null?void 0:f.filter(Z=>Z.particiapntId).length)===1&&((g=(m=N==null?void 0:N.participant)==null?void 0:m.person)==null?void 0:g.sex),A=r.matchUpType,_=(o??((v=n==null?void 0:n.participants)==null?void 0:v.enforceGender))!==!1?r.gender:void 0,O=(I=(y=r.sides)==null?void 0:y.flatMap(Z=>{var Q;return((Q=Z.participant)==null?void 0:Q.individualParticipants)||Z.participant}).filter(Boolean))==null?void 0:I.map(Yt),x=(b=r.sides)==null?void 0:b.filter(Z=>!l||Z.sideNumber===l).flatMap(Z=>{var Q;return((Q=Z.participant)==null?void 0:Q.individualParticipants)||Z.participant}).filter(Boolean),F=x==null?void 0:x.map(Yt),$=(w=(D=e==null?void 0:e.find(Z=>Z.matchUpId===r.matchUpTieId))==null?void 0:D.sides)==null?void 0:w.map(Z=>{var Q;return(Q=Z.participant)==null?void 0:Q.individualParticipants.filter(({participantId:ie,person:ue})=>!(F!=null&&F.includes(ie))&&(!_||_===vu||ue.sex===_||_===Fo&&!R||R&&ue.sex!==R))}),V=l?$==null?void 0:$[l-1]:$==null?void 0:$.map((Z,Q)=>({participants:Z,sideNumber:Q+1})),G=l?(S=$==null?void 0:$[l-1])==null?void 0:S.map(Yt):$==null?void 0:$.map((Z,Q)=>({participants:Z==null?void 0:Z.map(Yt),sideNumber:Q+1})),j=l&&(_n(Mv)(A)&&!(F!=null&&F.length)||_n(zm)(A)&&((F==null?void 0:F.length)??0)<2)||!l&&(_n(Mv)(A)&&((F==null?void 0:F.length)??0)<2||_n(zm)(A)&&((F==null?void 0:F.length)??0)<4),z=G==null?void 0:G.filter(Z=>!(O!=null&&O.includes(Z))),H=V==null?void 0:V.filter(({participantId:Z})=>z.includes(Z));if(j&&z!=null&&z.length&&M.push({availableParticipantIds:z,method:Jhe,availableParticipants:H,type:py,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),F!=null&&F.length&&(!zr(u)||(U=p==null?void 0:p.substitutions)!=null&&U.length)&&M.push({method:PB,type:Wq,existingParticipantIds:F,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),H!=null&&H.length&&(!l&&F!=null&&F.length||l&&p!=null&&p.participant)&&M.push({availableParticipantIds:z,method:Xhe,availableParticipants:H,type:efe,existingParticipantIds:F,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),bo({policyActions:a,action:CB})&&((C=p==null?void 0:p.substitutions)==null?void 0:C.length)){let Z=((E=p.participant)==null?void 0:E.participantType)===Zt&&[p.participantId]||((P=p.participant)==null?void 0:P.participantType)===Ot&&p.participant.individualParticipantIds||[],Q=p.substitutions.map(ie=>ie.participantId).filter(ie=>Z.includes(ie));(!s||Q.includes(s))&&M.push({method:PB,type:CB,substitutedParticipantIds:Q,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let K=t==null?void 0:t[Or],q=K==null?void 0:K.substituteWithoutScore,Y=K==null?void 0:K.substituteAfterCompleted;if(bo({policyActions:a,action:MB})&&i.length===2&&(!l&&F!=null&&F.length||l&&p!=null&&p.participant)&&(q||zr(u))&&(Y||u.matchUpStatus&&!Mr.includes(u.matchUpStatus))&&x!=null&&x.length&&V.length){let Z=x.map(Yt);M.push({info:"list of team players available for substitution",method:Qhe,availableParticipantIds:G,existingParticipantIds:Z,availableParticipants:V,existingParticipants:x,type:MB,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return M}function Y2e({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:a,drawDefinition:o,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var h,f,m,g,v;if(i.includes(s))return{};let y=(h=l.find(M=>M.type===py))==null?void 0:h.availableParticipantIds,I=(f=a==null?void 0:a[Up])==null?void 0:f.otherFlightEntries,b=(m=a==null?void 0:a[Up])==null?void 0:m.restrictQualifyingAlternates,D=(o.entries??[]).filter(({entryStage:M})=>!b||(u.stage===gt?M===gt:M!==gt)).sort((M,N)=>(M.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:M})=>M).filter(Boolean),{allPositionedParticipantIds:w}=Rde({drawDefinition:o}),S=n.map(M=>M.participantId).filter(Boolean),U=D.filter(M=>u.stage&&[gt,nt,Nn].includes(u.stage)?!(w!=null&&w.includes(M)):!S.includes(M)),C=((p==null?void 0:p.entries)??[]).filter(M=>M.entryStatus===Ul&&rfe({restrictQualifyingAlternates:b,structure:u,entry:M})&&(u.stage&&[gt,nt,Nn].includes(u.stage)?!(w!=null&&w.includes(M.participantId)):!S.includes(M.participantId))).sort((M,N)=>(M.entryPosition??1/0)-(N.entryPosition??1/0)).map(M=>M.participantId),E=$t(U.concat(C));if(I){let M=(v=(g=p?Vn({event:p}).flightProfile:void 0)==null?void 0:g.flights)==null?void 0:v.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(R=>R.participantId&&![Rp,Kl,Eg].includes(R.entryStatus)&&!D.includes(R.participantId)).map(({participantId:R})=>R)).flat().filter(Boolean);M!=null&&M.length&&E.push(...M)}y!=null&&y.length&&(E=E.filter(M=>!y.includes(M)));let P=r?t==null?void 0:t.filter(M=>E.includes(M.participantId)):void 0;return P==null||P.forEach(M=>{let N=(o.entries??[]).find(R=>R.participantId===M.participantId);M.entryPosition=N==null?void 0:N.entryPosition}),P==null||P.sort((M,N)=>(M.entryPosition||1/0)-(N.entryPosition||1/0)),E.length?{validAlternatesAction:ft({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:O2e,availableAlternatesParticipantIds:E,type:jq,availableAlternates:P})}:{}}function rfe({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===gt&&!t||i.entryStage===nt&&n===oa)return!0}function Z2e({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Ul&&rfe({structure:e,entry:r}),n=(r,a)=>(r.entryPosition||1/0)-(a.entryPosition||1/0);return t.filter(i).sort(n).map(Yt)}function X2e({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:a,sideNumber:o,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var p,h,f,m,g;let v=[],y=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:P})=>P===c.roundNumber),I=((p=r==null?void 0:r.entries)==null?void 0:p.filter(({entryStatus:P})=>P&&Mg.includes(P)).map(Yt))??[],b=y.map(P=>(P.sides??[]).flatMap(Yt)).flat().filter(Boolean),D=I.filter(P=>!i.includes(P)&&(!t||!b.includes(P))),w=e==null?void 0:e.filter(P=>D==null?void 0:D.includes(P.participantId)).map(P=>ot(P,void 0,!0));w==null||w.forEach(P=>{let M=(r.entries??[]).find(N=>N.participantId===P.participantId);P.entryPosition=M==null?void 0:M.entryPosition}),D.length&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:kY,type:py,availableParticipantIds:D,participantsAvailable:w});let S=(d==null?void 0:d.entries)??[],U=Z2e({eventEntries:S,structure:l}),C=$t(I.concat(U));if(n){let P=(f=(h=d?Vn({event:d}):void 0)==null?void 0:h.flights)==null?void 0:f.filter(M=>M.drawId!==u).flatMap(M=>M.drawEntries.filter(N=>N.participantId&&![Rp,Kl,Eg].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);P!=null&&P.length&&C.push(...P)}C=C.filter(P=>!i.includes(P)&&!D.includes(P)&&(!t||!b.includes(P)));let E=e==null?void 0:e.filter(P=>C.includes(P.participantId)).map(P=>ot(P,void 0,!0));return E==null||E.forEach(P=>{let M=(r.entries??[]).find(N=>N.participantId===P.participantId);P.entryPosition=M==null?void 0:M.entryPosition}),E==null||E.sort((P,M)=>(P.entryPosition||1/0)-(M.entryPosition||1/0)),C.length&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},availableParticipantIds:C,participantsAvailable:E,method:kY,type:Ul}),!zr(c)&&o&&(g=(m=c.sides)==null?void 0:m.find(P=>P.sideNumber===o))!=null&&g.participantId&&v.push({payload:{drawId:u,matchUpId:s,structureId:a,sideNumber:o},method:z2e,type:Wq}),v}function lO(t){var e,i,n,r,a,o,s,l,c;if(!t)return{error:Ie};let{drawDefinition:u,event:d}=t,{restrictAdHocRoundParticipants:p=!0,policyDefinitions:h,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&co(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:Ne};if(!v||!co(v))return{error:ua};if(g&&![1,2].includes(g))return oe({result:{error:Ie},context:{sideNumber:g}});if(!u){let fe=(Hr({tournamentRecord:y}).matchUps??[]).find(he=>he.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(he=>he.eventId===(fe==null?void 0:fe.eventId));let ge=((d==null?void 0:d.drawDefinitions)??[]).find(he=>he.drawId===(fe==null?void 0:fe.drawId));ge&&(u=ge)}if(!u)return{error:tt};let I=$n({withIndividualParticipants:!0,tournamentRecord:y}).participants,{drawId:b}=u,{matchUp:D,structure:w}=an({drawDefinition:u,matchUpId:v,event:d});if(!D)return{error:wa};let S=Mi({tournamentRecord:y,drawDefinition:u,structure:w,event:d}).appliedPolicies??{};Object.assign(S,h??{});let U=(i=S==null?void 0:S[Up])==null?void 0:i.otherFlightEntries,C=(S==null?void 0:S[Or])??eS[Or],{enabledStructures:E}=Yhe({actionType:DB,appliedPolicies:S,drawDefinition:u,structure:w}),{policyActions:P}=Zhe({enabledStructures:E,drawDefinition:u,structure:w}),M=t.matchUpsMap??da({drawDefinition:u}),N=t.inContextDrawMatchUps??lr({tournamentParticipants:I,inContext:!0,drawDefinition:u,matchUpsMap:M,event:d}).matchUps,R=N==null?void 0:N.find(fe=>fe.matchUpId===v),A=g&&((n=R==null?void 0:R.sides)==null?void 0:n.find(fe=>fe.sideNumber===g)),_=((r=R==null?void 0:R.sides)==null?void 0:r.map(fe=>{var ge;return fe.participantId||((ge=fe.participant)==null?void 0:ge.participantid)}).filter(Boolean))??[],{assignedPositions:O,allPositionsAssigned:x}=Rr({structure:w}),{structureId:F}=w??{},$=[];if(!F)return{validActions:$};let V=Yo({structure:w}),G=D.collectionId;if(V&&!G){let fe=X2e({restrictAdHocRoundParticipants:p,tournamentParticipants:I,matchUpParticipantIds:_,otherFlightEntries:U,drawDefinition:u,structureId:F,sideNumber:g,matchUpId:v,structure:w,matchUp:D,drawId:b,event:d});$.push(...fe)}let j=sf({drawDefinition:u,structure:w}),z=O==null?void 0:O.filter(fe=>fe.participantId).map(fe=>fe.drawPosition),H=O==null?void 0:O.filter(fe=>fe.bye).map(fe=>fe.drawPosition),K=D.matchUpStatus===wi||!G&&((a=D.drawPositions)==null?void 0:a.reduce((fe,ge)=>(H==null?void 0:H.includes(ge))||fe,!1));if(K)return{validActions:$,isByeMatchUp:K};bo({policyActions:P,action:RB})&&$.push({type:RB,payload:{matchUpId:v}});let q=!yC({matchUpStatus:D.matchUpStatus}),Y=(o=S==null?void 0:S.scoring)==null?void 0:o.structures,Z=(w==null?void 0:w.stage)&&(Y==null?void 0:Y.stage)&&(Y==null?void 0:Y.stage[w.stage]),Q=(w==null?void 0:w.stageSequence)&&(Z==null?void 0:Z.stageSequence)&&Z.stageSequence[w.stageSequence],ie=!((s=S==null?void 0:S.scoring)!=null&&s.requireAllPositionsAssigned||Z!=null&&Z.requireAllPositionsAssigned||Q!=null&&Q.requireAllPositionsAssigned)||x,ue=D.sides&&D.sides.filter(fe=>fe==null?void 0:fe.participantId).length===2,J=D.matchUpStatus&&[er,fr].includes(D.matchUpStatus),te=Xa({inContextDrawMatchUps:N,drawDefinition:u,matchUpId:v}),se=Jm({inContextDrawMatchUps:N,drawDefinition:u,targetData:te}),ee=(((l=R==null?void 0:R.drawPositions)==null?void 0:l.length)===2&&R.drawPositions.every(fe=>z==null?void 0:z.includes(fe))&&((c=R==null?void 0:R.sides)==null?void 0:c.length)===2&&R.sides.every(({participantId:fe})=>fe)||ue)&&!(J&&se),ce={method:qhe,type:hy,payload:{drawId:b,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(q&&$.push({payload:{drawId:b,matchUpId:v,schedule:{}},method:EB,type:tfe}),bo({policyActions:P,action:hy})&&(A!=null&&A.participant||!g&&_!=null&&_.length)&&$.push(ce),q&&ee&&$.push({type:ife}),ie&&ee){let{matchUpId:fe,matchUpFormat:ge}=D,he={drawId:b,matchUpId:fe,matchUpFormat:ge,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};$.push({info:"set outcome and winningSide",method:EB,type:nfe,payload:he}),bo({policyActions:P,action:NB})&&$.push({type:NB}),bo({policyActions:P,action:AB})&&$.push({type:AB})}if(G&&R){let fe=K2e({specifiedPolicyDefinitions:h,inContextDrawMatchUps:N,matchUpParticipantIds:_,matchUpActionsPolicy:C,inContextMatchUp:R,policyActions:P,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v,matchUp:D,drawId:b,side:A});$.push(...fe)}return{structureIsComplete:j,validActions:$,isDoubleExit:J,...re}}function J2e({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:a,drawDefinition:o,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var p,h,f,m,g,v,y;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:I,targetStructureIds:b}=((p=o.links)==null?void 0:p.reduce((U,C)=>{var E,P;let M=(E=C.source)==null?void 0:E.structureId,N=(P=C.target)==null?void 0:P.structureId;return U.sourceStructureIds.includes(M)||U.sourceStructureIds.push(M),U.targetStructureIds.includes(N)||U.targetStructureIds.push(N),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},D=[],w=((h=o.links)==null?void 0:h.filter(U=>{var C;return((C=U.target)==null?void 0:C.structureId)===c.structureId}))??[];for(let U of w){let C=(f=U==null?void 0:U.source)==null?void 0:f.structureId,{structure:E}=Dt({structureId:C,drawDefinition:o}),P=(E==null?void 0:E.finishingPosition)===oI&&((I==null?void 0:I.length)!==1||(b==null?void 0:b.length)!==1),M={};if(P){let{matchUps:A}=Ui({drawDefinition:o,structure:c,event:d}),{initialRoundNumber:_}=dy({drawPosition:s,matchUps:A}),O=(v=(g=(m=o.links)==null?void 0:m.find(x=>{var F;return((F=x.target)==null?void 0:F.structureId)===(c==null?void 0:c.structureId)&&x.target.roundNumber===_}))==null?void 0:g.source)==null?void 0:v.roundNumber;M.roundNumbers=[O]}let{completedMatchUps:N}=zk({structureId:C,inContext:!0,matchUpFilters:M,drawDefinition:o}),R=a.map(A=>A.participantId).filter(Boolean);(y=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==Ur||A===Ur)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(Yt).filter(A=>A&&!R.includes(A)))==null||y.forEach(A=>{D.includes(A)||D.push(A)})}let S=t==null?void 0:t.filter(U=>D==null?void 0:D.includes(U.participantId));return S==null||S.forEach(U=>{let C=(o.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=C==null?void 0:C.entryPosition}),D!=null&&D.length?{validLuckyLosersAction:{type:Hq,method:x2e,availableLuckyLosers:S,availableLuckyLoserParticipantIds:D,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function Q2e({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:a,positionAssignments:o,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var m,g,v;let{drawId:y}=c,I=[],b,D,w=[],S=(g=(m=l==null?void 0:l[fl])==null?void 0:m.validSeedPositions)==null?void 0:g.ignore;if(S||({unplacedSeedParticipantIds:b,unplacedSeedAssignments:D,unfilledPositions:w}=Vpe({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),w!=null&&w.length||(w=o.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||I.push({payload:{drawId:y,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:V2e,type:tN}),a&&S){let U=o.map(N=>N.participantId).filter(Boolean),C={structureIds:t},{completedMatchUps:E}=J0({inContext:!0,matchUpFilters:C,drawDefinition:c}),P=$t((v=(E??[]).filter(({matchUpType:N})=>(f==null?void 0:f.eventType)!==Ur||N===Ur))==null?void 0:v.map(({sides:N})=>N==null?void 0:N.map(Yt)).flat().filter(N=>N&&!U.includes(N))),M=s?r==null?void 0:r.filter(N=>P==null?void 0:P.includes(N.participantId)).map(N=>ot(N,void 0,!0)):void 0;return M==null||M.forEach(N=>{let R=(c.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=R==null?void 0:R.entryPosition}),M!=null&&M.length&&I.push(ft({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:AY,type:py,availableParticipantIds:P,participantsAvailable:M})),{validAssignmentActions:I}}if(w.includes(p)||d){let U;if(D!=null&&D.length){let E=D.filter(P=>b==null?void 0:b.includes(P.participantId));E.sort(eVe),U=E.map(P=>P.participantId)}else U=e;let C=s?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>ot(E,void 0,!0)):void 0;C!=null&&C.length&&I.push(ft({payload:{drawId:y,structureId:h,drawPosition:p},willDisableLinks:i,method:AY,type:py,availableParticipantIds:U,participantsAvailable:C}))}return{validAssignmentActions:I}}function eVe(t,e){return t.bye||ww(t.seedValue)<ww(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function tVe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:a,drawPosition:o,structureId:s,drawId:l}){var c,u,d;let p=[],h=[],f=[],m=[],g=i.map(U=>U.participantId).filter(Boolean),v=r==null?void 0:r[Up],y=!(v!=null&&v.disableRoundRestrictions)&&t[o],I=v==null?void 0:v.requireCompletedStructures,{sourceStructureIds:b,relevantLinks:D}=TB({targetRoundNumber:y,linkType:Ep,drawDefinition:a,structureId:s})||{};b!=null&&b.length&&m.push(...b);let{sourceStructureIds:w,relevantLinks:S}=TB({targetRoundNumber:y,linkType:Cp,drawDefinition:a,structureId:s})||{};w!=null&&w.length&&m.push(...w);for(let U of D){let C=(c=a.structures)==null?void 0:c.find(P=>P.structureId===U.source.structureId);if((C==null?void 0:C.stage)!==gt)continue;let E=sf({structureId:U.source.structureId,drawDefinition:a});if(!I||E){let P=C.qualifyingRoundNumber,{matchUps:M}=Ui({matchUpFilters:{roundNumbers:[P],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:C});for(let N of M){let R=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===wi&&((u=N.sides)==null?void 0:u.find(({participantId:_})=>_));if(R||A){let{participantId:_,participant:O}=R||A||{};_&&!g.includes(_)&&(O&&n&&p.push(O),h.push(_))}}}}for(let U of S){let C=(d=a.structures)==null?void 0:d.find(P=>P.structureId===U.source.structureId);if((C==null?void 0:C.stage)!==gt)continue;let E=sf({structureId:U.source.structureId,drawDefinition:a});if(!I||E){let{positionAssignments:P}=Vi({structure:C}),M=(P==null?void 0:P.map(N=>{var R;let A=N.participantId,_=(R=jt({element:N,name:tf}).extension)==null?void 0:R.value;return _?{participantId:A,groupOrder:_==null?void 0:_.groupOrder}:{}}).filter(({groupOrder:N,participantId:R})=>N===1&&!g.includes(R)).map(({participantId:N})=>N))??[];if(M&&h.push(...M),n){let N=e.filter(({participantId:R})=>M.includes(R));p.push(...N)}}}return h.length&&f.push(ft({payload:{qualifyingParticipantId:void 0,drawPosition:o,structureId:s,drawId:l},method:_2e,type:sO,qualifyingParticipantIds:h,qualifyingParticipants:n?p:void 0})),{validAssignmentActions:f,sourceStructureIds:m}}function iVe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:a,returnParticipants:o,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==u&&!(c&&s.includes(E))),v=(a==null?void 0:a.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:I}=Ui({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),b=I.filter(({drawPositions:E})=>Ya(E,y)),D=Object.assign({},...b.map(E=>{var P;return(P=E.sides)==null?void 0:P.filter(({sourceDrawPositionRange:M})=>M).map(({drawPosition:M,sourceDrawPositionRange:N})=>({[M]:N}))}).flat()),w=v.map(E=>E.participantId).filter(Boolean),S=(i??[]).filter(E=>w.includes(E.participantId)),U=Object.assign({},...S.map(E=>({[E.participantId]:E}))),C=v.map(E=>{let P=U==null?void 0:U[E.participantId],M=D[E.drawPosition];return ft({...E,participant:o?ot(P,!1,!0):void 0,sourceDrawPositionRange:M})});return C.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:L2e,type:zq,availableAssignments:C}}:{}}function qq(t){var e;let i=vi(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(i.error)return i;let{policyDefinitions:n,returnParticipants:r=!0,provisionalPositioning:a,tournamentRecord:o,drawDefinition:s,drawPosition:l,event:c}=t,u=t.tournamentParticipants??(o&&$n({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],d=Dt({structureId:t.structureId,drawDefinition:s});if(d.error)return d;let p=d.containingStructure||d.structure;if(!p)return{error:wn};let h=p.structureId;if(d=IC({drawDefinition:s,structureId:h}),l===void 0&&!d.isAdHoc)return{error:A0};if(d.isAdHoc)return lO(t);if(d.error)return d;let{drawPositionInitialRounds:f,inactiveDrawPositions:m,activeDrawPositions:g,byeDrawPositions:v}=d,y=Mi({tournamentRecord:o,drawDefinition:s,structure:p,event:c}).appliedPolicies??{};Object.assign(y,n??{});let{actionsPolicy:I,enabledStructures:b,actionsDisabled:D}=Yhe({actionType:dM,appliedPolicies:y,drawDefinition:s,structure:p}),w=(I==null?void 0:I.activePositionOverrides)||[],{sourceStructureIds:S}=TB({finishingPosition:W0,targetRoundNumber:1,linkType:Cp,drawDefinition:s,structureId:h})||{},U;S!=null&&S.length&&(U=S.reduce((Y,Z)=>sf({structureId:Z,drawDefinition:s})&&Y,!0));let C=S.length,E=S.length&&!U,{policyActions:P}=Zhe({enabledStructures:b,drawDefinition:s,structure:p}),M=![gt,nt].includes(p.stage)||p.stageSequence!==1,{drawId:N}=s,R=[],{assignedPositions:A,positionAssignments:_}=Rr({structure:p}),O=A==null?void 0:A.find(Y=>Y.drawPosition===l);if(!((e=_==null?void 0:_.map(Y=>Y.drawPosition))!=null&&e.includes(l)))return{error:N0};let{stage:x,stageSequence:F}=p,$=[x];x===oa&&$.push(nt),x===nt&&$.push(oa);let V=lI({entryStatuses:Mg,provisionalPositioning:a,drawDefinition:s,stageSequence:F,structureId:h,stages:$}),G=Og({drawDefinition:s,stages:$}).assignedParticipantIds??[],j=V.filter(Y=>!G.includes(Y.participantId)).map(Y=>Y.participantId),z=v.includes(l),H=g.includes(l);if(D)return{hasPositionAssigned:!!O,info:"Actions Disabled for structure",isActiveDrawPosition:H,isDrawPosition:!0,validActions:[],isByePosition:z};if(bo({policyActions:P,action:py})&&!H&&_&&!E&&(!O||z)){let{validAssignmentActions:Y}=Q2e({positionSourceStructureIds:S,unassignedParticipantIds:j,possiblyDisablingAction:M,isWinRatioFedStructure:C,tournamentParticipants:u,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:s,isByePosition:z,drawPosition:l,structureId:h,event:c});Y==null||Y.forEach(Z=>R.push(Z))}if(bo({policyActions:P,action:sO})){let{validAssignmentActions:Y}=tVe({drawPositionInitialRounds:f,tournamentParticipants:u,positionAssignments:_,returnParticipants:r,appliedPolicies:y,drawDefinition:s,drawPosition:l,structureId:h,drawId:N});Y==null||Y.forEach(Z=>R.push(Z))}let{participantId:K}=O||{},q=K&&u.find(Y=>Y.participantId===K);if(O){bo({policyActions:P,action:UB})&&!H&&(R.push({type:UB,method:NY,payload:{drawId:N,structureId:h,drawPosition:l},willDisableLinks:M}),z||R.push({type:Gq,method:k2e,payload:{drawId:N,structureId:h,drawPosition:l},willDisableLinks:M}),bo({policyActions:P,action:tN})&&!z&&R.push({type:tN,method:NY,payload:{drawId:N,structureId:h,drawPosition:l,replaceWithBye:!0},willDisableLinks:M}));let Y=p.stage===gt||p.stage===nt&&p.stageSequence===1;if(!z&&_Y({activePositionOverrides:w,activeDrawPositions:g,action:Av})&&bo({policyActions:P,action:Av})&&ZR({drawDefinition:s,structureId:h,drawPosition:l})&&Y){let{seedAssignments:Z}=Ks({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Q,seedValue:ie}=(Z==null?void 0:Z.find(ue=>ue.participantId===K))??{};R.push({type:Av,method:j2e,participant:q,seedNumber:Q,payload:{drawId:N,structureId:h,participantId:K,seedValue:ie}})}if(!z&&_Y({activePositionOverrides:w,activeDrawPositions:g,action:IT})&&bo({policyActions:P,action:IT})&&ZR({drawDefinition:s,structureId:h,drawPosition:l})&&Y){let{seedAssignments:Z}=Ks({returnAllProxies:!0,drawDefinition:s,structure:p}),{seedNumber:Q}=(Z==null?void 0:Z.find(ie=>ie.participantId===K))??{};R.push({method:B2e,type:IT,participant:q,seedNumber:Q,payload:{participantId:K,structureId:h,drawId:N}})}if(!z&&K){if(bo({policyActions:P,action:hy})){let Z={type:hy,method:qhe,participant:q,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:N}};R.push(Z)}if(bo({policyActions:P,action:OU})){let Z={type:OU,method:$2e,participant:q,payload:{participantId:K,otherName:void 0}};R.push(Z)}}if(bo({policyActions:P,action:zq})){let{validSwapAction:Z}=iVe({possiblyDisablingAction:M,tournamentParticipants:u,inactiveDrawPositions:m,activeDrawPositions:g,positionAssignments:_,returnParticipants:r,byeDrawPositions:v,drawDefinition:s,isByePosition:z,drawPosition:l,structureId:h,structure:p,drawId:N});Z&&R.push(Z)}}if(bo({policyActions:P,action:jq})&&!E){let{validAlternatesAction:Y}=Y2e({possiblyDisablingAction:M,tournamentParticipants:u,positionAssignments:_,activeDrawPositions:g,returnParticipants:r,appliedPolicies:y,drawDefinition:s,drawPosition:l,validActions:R,structureId:h,structure:p,drawId:N,event:c});Y&&R.push(Y)}if(bo({policyActions:P,action:Hq})&&!E&&_){let{validLuckyLosersAction:Y}=J2e({sourceStructuresComplete:U,possiblyDisablingAction:M,isWinRatioFedStructure:C,tournamentParticipants:u,activeDrawPositions:g,positionAssignments:_,drawDefinition:s,drawPosition:l,structureId:h,structure:p,drawId:N});Y&&R.push(Y)}if((q==null?void 0:q.participantType)===Ot&&bo({policyActions:P,action:Vq})){let{validModifyAssignedPairAction:Y}=H2e({tournamentParticipants:u,returnParticipants:r,drawPosition:l,participant:q,drawId:N,event:c});Y&&R.push(Y)}return{hasPositionAssigned:!!O,isActiveDrawPosition:H,isDrawPosition:!0,isByePosition:z,validActions:R,...re}}function FC({policyDefinitions:t,appliedPolicies:e,drawType:i}){var n,r;let a=(n=t==null?void 0:t[$R])==null?void 0:n.drawTypeCoercion,o=(r=e==null?void 0:e[$R])==null?void 0:r.drawTypeCoercion;return(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??!0}function xU({tournamentRecord:t,drawDefinition:e,stage:i=nt,structureId:n,structure:r}){var a;if(!t)return{error:Ne};if(!r&&!e)return{error:tt};if(!r&&!n&&((a=e==null?void 0:e.structures)==null?void 0:a.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:Is};let{error:o,positionAssignments:s}=Vi({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:s??[],structureId:r==null?void 0:r.structureId,error:o}}function Kq({structureId:t,drawDefinition:e}){if(!e)return{error:tt};if(!co(t))return{error:Ie};let i=X0({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(a=>a.target.feedProfile).filter(Boolean),r=!Ln([Hm,yl,Ak,Gm],n).length;return{...re,valid:r}}function afe({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Ie};let i=F0(t);return i?{drawSize:i}:oe({result:{error:Ie},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function $C(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:a,drawDefinition:o,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=Xp({tournamentRecord:a,drawDefinition:o,event:s});if(f.error)return oe({result:f,stack:l});i=f.policyDefinitions}let u=Rt(c);if(c&&!u)return oe({result:{error:Ie},context:{participantsCount:c},stack:l});if(r&&!u)return oe({result:{error:tue},stack:l});if(isNaN(n))if(c)({drawSize:n}=afe({participantsCount:c}));else return oe({result:{error:$P},stack:l});let d=r&&c||n;if(d&&d>n)return{error:LW};let p=i==null?void 0:i[fl];if(!p)return{error:Hce};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:Mce}}function cO({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:a,participants:o,event:s}){var l;if((!o||!r)&&i&&({participants:o,participantMap:r}=$n({tournamentRecord:i})),!o)return{error:jP};if(!Array.isArray(o))return{error:Ie};if(!s)return{error:_i};let c=(e==null?void 0:e[Or])??(n==null?void 0:n[Or])??eS[Or],u=(a??((l=c==null?void 0:c.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,h=d===of,f=d===Ys&&Gi||h&&Ot||Zt,m=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(m),v=o.filter(y=>g.includes(y.participantId)).filter(y=>{let I=nVe({participant:y,participantType:f,eventType:d,entryStatusMap:m}),b=rVe({genderEnforced:u,participantMap:r,eventGender:p,participant:y,isDoubles:h,mismatch:I});return I||!b});if(v.length){let y=v.map(I=>I.participantId);return{error:Fce,invalidParticipantIds:y}}return{...re,valid:!0}}function nVe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],a=i&&[of,Ys].includes(i)&&t.participantType===Zt&&(cm(r)||r===Rp);return t.participantType!==e&&!a}function rVe(t){var e,i,n;let{participant:r,participantMap:a,eventGender:o,mismatch:s,isDoubles:l,genderEnforced:c}=t,u=!s&&l&&$t(((e=r==null?void 0:r.individualParticipantIds)==null?void 0:e.map(f=>{var m,g,v;return(v=(g=(m=a==null?void 0:a[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],d=!o||!(u!=null&&u.length)||vu===o||[zi,gn].includes(o)&&u[0]===o||Fo===o&&(u.length==1&&((i=r.individualParticipantIds)==null?void 0:i.length)===1||u.length===2),p=(n=r==null?void 0:r.person)==null?void 0:n.sex,h=!(r!=null&&r.person)||!o||[vu,Fo].includes(o)||[zi,gn].includes(o)&&p===o;return!c||d&&h}function ofe({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var a;let o="generateQualifyingSTructures",s=[],l=[],c=[],u=(g,v)=>g.stageSequence-v.stageSequence,d=(g,v)=>g.roundTarget-v.roundTarget,p=0,h=0,f,m=1;for(let g of t.sort(d)){let v=g.structureProfiles||[];m=g.roundTarget||m;let y=1,I=0,b,D,w;for(let S of(v||[]).sort(u)){let U=YW(S.drawSize||S.participantsCount),{qualifyingRoundNumber:C,structureOptions:E,matchUpFormat:P,structureName:M,structureId:N,drawType:R}=S,A=S.matchUpType,_=S.qualifyingPositions||aVe({drawSize:U,qualifyingRoundNumber:C}),O,x,F;if(!Rt(U))return oe({result:{error:$P},stack:o});let $=t.length>1?`${m}-`:"",V=v.length>1||$?y:"",G=M||($||V?`${ia(gt)} ${$}${V}`:ia(gt));if(R===xl){let{structures:j,groupCount:z,maxRoundNumber:H}=TC({structureName:S.structureName||G,structureId:N||(r==null?void 0:r.pop()),stage:gt,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:m,drawSize:U,idPrefix:i,isMock:n,uuids:r});I=z,O=H,x=j[0],f=[1]}else({drawSize:U,matchUps:F,roundLimit:O}=Iu({qualifyingRoundNumber:C,qualifyingPositions:_,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),x=Os({structureName:S.structureName||G,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:O,stage:gt,matchUpFormat:P,stageSequence:y,matchUpType:A,roundLimit:O,matchUps:F}),m&&ui({extension:{name:Cu,value:m},element:x}),I=((a=F==null?void 0:F.filter(j=>j.roundNumber===O))==null?void 0:a.length)||0;if(y>1){let{link:j}=EC({sourceStructureId:D,sourceRoundNumber:b,targetStructureId:x.structureId,finishingPositions:w===Cp?[1]:void 0,linkType:w});c.push(j),p+=(U||0)-I}else p+=U||0;w=R===xl?Cp:Ep,D=x.structureId,b=O,l.push(x),y+=1}h+=I,s.push({qualifiersCount:I,finalQualifyingRoundNumber:b,finalQualifyingStructureId:D,finishingPositions:f,roundTarget:m,linkType:w}),m+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:p,qualifyingDetails:s,structures:l,...re,links:c}}function aVe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function sfe(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=St(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&Qc||t.drawType||Qc,a=Ede.includes(r);if(n&&a){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=Qc;else if(n<4&&i)return{...oe({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:ck},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function oVe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:ia(nt),...t,stage:nt},{structures:a,groupCount:o,groupSize:s}=TC(r);if(o<1)return{error:Iue};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:ia(Nn)}],[c]=a,{structures:u,links:d}=bhe({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:o,groupSize:s,...t});return u&&a.push(...u),{...re,structures:a,links:d}}function sVe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=n.map((c,u)=>{let d=n.indexOf(c)%2?yl:Hm,p=1+u;return{linkType:Td,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:Ep,source:{roundNumber:a,structureId:e.structureId},target:{feedProfile:yl,roundNumber:r,structureId:t.structureId}},l=[{linkType:Ep,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:yl,roundNumber:1,structureId:i.structureId}},{linkType:Td,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:yl,roundNumber:1,structureId:i.structureId}}];return[...o,s,...l]}function lVe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:a}){let o=[],{matchUps:s}=lf({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=Lh({structureName:t||ia(nt),structureId:a==null?void 0:a.pop(),stageSequence:1,stage:nt,matchUpType:e,matchUps:s});o.push(l);let c=n/2,{matchUps:u}=lf({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:a}),d=Lh({structureName:ia(Cde),matchUps:u,structureId:a==null?void 0:a.pop(),stage:oa,stageSequence:2,matchUpType:e});o.push(d);let{matchUps:p}=Iu({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=Lh({structureName:ia(Pde),matchUps:p,structureId:a==null?void 0:a.pop(),stageSequence:3,stage:Nn,matchUpType:e});o.push(h);let f=sVe({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:o,links:f,...re}}function cVe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:a,drawSize:o,isMock:s,uuids:l}=t;if(!Rt(o)||o<2)return{matchUps:[],roundsCount:0};if(Rc(o))return Iu(t);let c=uVe(o),u=c.shift(),d=Xe(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=QR({roundNumber:h,matchUpType:r,idPrefix:a,matchUps:p,isMock:s,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=Xe(1,v+1);n&&v===n&&(f=h-1);let I=y.map(b=>{let D=Pq({roundPosition:b,roundNumber:h,idPrefix:a,uuids:l});return{roundPosition:b,roundNumber:h,matchUpId:D}});p.push(...I),h++}let m=h-1;return p=iC({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function uVe(t){let e=St(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let a=Math.ceil(i/2),o=a===1,s=!!(!o&&a%2);i=!o&&s?a+1:a;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function lfe(t){var e,i;let{playoffAttributes:n,stageSequence:r=1,stage:a=nt,matchUpType:o,drawSize:s,uuids:l}=t,c=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,u=t.structureId||c()||(l==null?void 0:l.pop()),d=t.appliedPolicies??Mi(t),p=((e=t.policyDefinitions)==null?void 0:e[pw])||(d==null?void 0:d[pw]);t.skipRounds=t.skipRounds||s<=4&&(p!=null&&p.feedFromMainFinal?0:1)||0;let h=t.structureName??((i=n==null?void 0:n[0])==null?void 0:i.name)??ia(nt),f=()=>{let{matchUps:m}=Iu(t);return{structures:[Os({stageSequence:r,structureName:h,matchUpType:o,structureId:u,matchUps:m,stage:a})],links:[],...re}};return{generators:{[Ol]:()=>({structures:[Os({finishingPosition:W0,stageSequence:r,structureName:h,matchUps:[],matchUpType:o,structureId:u,stage:a})],links:[],...re}),[Pg]:()=>{let{matchUps:m}=cVe(t);return{structures:[Os({stageSequence:r,structureName:h,matchUpType:o,structureId:u,matchUps:m,stage:a})],links:[],...re}},[Qc]:()=>f(),[JP]:()=>lVe(t),[mw]:()=>wb({...t,roundOffsetLimit:3,playoffAttributes:n??D3}),[gw]:()=>wb({...t,roundOffsetLimit:2,playoffAttributes:n??P3}),[Nn]:()=>wb(t),[z0]:()=>{let{matchUps:m}=lf({drawSize:s,uuids:l,matchUpType:o});return{structures:[Os({stageSequence:r,structureName:h,matchUpType:o,structureId:u,stage:nt,matchUps:m})],links:[],...re}},[QP]:()=>vhe(t),[vw]:()=>tv({...t,feedRounds:1,fmlc:!0}),[Dde]:()=>tv({...t,feedRounds:1}),[S3]:()=>tv({...t,feedsFromFinal:1}),[T3]:()=>tv({...t,feedsFromFinal:2}),[U3]:()=>tv({...t,feedsFromFinal:3}),[eC]:()=>tv(t),[_k]:()=>Ihe(t),[xl]:()=>TC(t),[Dd]:()=>oVe(t)}}}function Yq(t){var e,i,n,r,a;let{enforceMinimumDrawSize:o=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:c,drawDefinition:u,tieFormat:d,isMock:p,uuids:h}=t||{},f=St(t.drawSize),m=t.drawTypeCoercion??FC({appliedPolicies:l,drawType:t.drawType}),g="generateDrawStructuresAndLinks",v=sfe({drawType:t.drawType,enforceMinimumDrawSize:o,drawTypeCoercion:m,drawSize:f});if(v.error)return v;let y=v.drawType,I=[],b=[],D=(t==null?void 0:t.matchUpType)??Un,w=(e=u==null?void 0:u.structures)==null?void 0:e.filter(({stage:q})=>q===gt);w&&I.push(...w);let S=w==null?void 0:w.map(({structureId:q})=>q),U=(i=u==null?void 0:u.structures)==null?void 0:i.find(({stage:q,stageSequence:Y})=>q===nt&&Y===1),C=(n=u==null?void 0:u.links)==null?void 0:n.filter(q=>q.target.structureId===(U==null?void 0:U.structureId)&&(S==null?void 0:S.includes(q.source.structureId))),E=(q,Y)=>{var Z;if(q.linkType===Cp&&Y!=null&&Y.structures){let Q=q.source.finishingPositions||[];return Y.structures.length*Q.length}else if(q.linkType===Ep&&(Z=Y==null?void 0:Y.matchUps)!=null&&Z.length){let Q=q.source.roundNumber;return Y.matchUps.filter(({roundNumber:ie})=>ie===Q).length}},P=w==null?void 0:w.map(q=>{var Y,Z,Q;let ie=C==null?void 0:C.find(ee=>ee.target.structureId===q.structureId),ue=((Z=(Y=Vi({structure:q}))==null?void 0:Y.positionAssignments)==null?void 0:Z.length)??0;if(!ie)return ue;let J=ie==null?void 0:ie.source.structureId,te=(Q=u.structures)==null?void 0:Q.find(ee=>ee.structureId===J),se=E(ie,te)||0;return ue-se}).filter(Boolean).reduce((q,Y)=>q+Y,0),M=C==null?void 0:C.map(q=>{let Y=q.source.structureId,Z=w==null?void 0:w.find(Q=>Q.structureId===Y);return E(q,Z)}).filter(Boolean).reduce((q,Y)=>q+Y,0),N=!!(U&&!((r=U==null?void 0:U.matchUps)!=null&&r.length));if(w!=null&&w.length&&!N)return{error:nB};let R=!(w!=null&&w.length)&&t.qualifyingProfiles,A=(R==null?void 0:R.length)&&ofe({idPrefix:t.idPrefix,qualifyingProfiles:R,appliedPolicies:l,isMock:p,uuids:h});if(A!=null&&A.error)return A;let{qualifyingDrawPositionsCount:_,qualifyingDetails:O,qualifiersCount:x}=A||{qualifyingDrawPositionsCount:P,qualifiersCount:M};_&&(A!=null&&A.structures&&I.push(...A.structures),A!=null&&A.links&&b.push(...A.links)),Object.assign(t,ft({drawSize:f,matchUpType:D,tieFormat:d}));let F=y!==Ol&&(!f||f<2||!c&&![z0,Pg].includes(y)&&([Dd,xl].includes(y)&&f<3||![xl,Dd].includes(y)&&!Rc(f)));if(F&&!_)return oe({context:{drawSize:f,invalidDrawSize:F},result:{error:ck},stack:g});let{generators:$,error:V}=lfe(t);if(V)return{error:V};let G=$[y];if(!G)return{error:SW};let j=G==null?void 0:G();if(j.error)return j;let{structures:z,links:H}=j;if(z!=null&&z.length){let q=z.find(({stage:Y,stageSequence:Z})=>Y===nt&&Z===1);if(U&&q){if(N){let Y=q.structureId;if(q.structureId=U.structureId,H==null?void 0:H.length)for(let Z of H)Z.source.structureId===Y&&(Z.source.structureId=U.structureId),Z.target.structureId===Y&&(Z.target.structureId=U.structureId)}else if(!s)return{error:nB}}I.push(...z)}I.sort(sI),H!=null&&H.length&&b.push(...H);let K=j.structures.find(({stage:q,stageSequence:Y})=>q===nt&&Y===1);for(let q of O||[]){let{finalQualifyingRoundNumber:Y,finalQualifyingStructureId:Z,roundTarget:Q,finishingPositions:ie,linkType:ue}=q,J=K&&((a=EC({targetStructureId:K.structureId,sourceStructureId:Z,sourceRoundNumber:Y,finishingPositions:ie,targetEntryRound:Q,linkType:ue}))==null?void 0:a.link);if(J!=null&&J.error)return J;J&&b.push(J)}return C&&b.push(...C),{...re,qualifyingResult:{qualifyingDrawPositionsCount:_,qualifiersCount:x},structures:I,links:b}}function Zq(t){var e,i;let{modifyOriginal:n=!0,stageSequence:r=1,isMock:a}=t||{},o="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return oe({result:{error:tt},stack:o});let s=n?t.drawDefinition:ot(t.drawDefinition,!1,!0),{tieFormat:l,matchUpType:c}=t;if(l){let D=Po({tieFormat:l});if(D.error)return D}l=Jr(l??((e=Ea({drawDefinition:s}))==null?void 0:e.tieFormat)),c=c??(s.matchUpType||Un),t.tieFormat=l,t.matchUpType=c;let u=YR({drawDefinition:s,stage:nt});t.drawSize=t.drawSize??u,!u&&t.drawSize&&JR({drawSize:t.drawSize,drawDefinition:s,stageSequence:r,stage:nt});let d=da({drawDefinition:s}).drawMatchUps.map(Cr),p=Yq(t);if(p.error)return oe({result:p,stack:o});let{structures:h,links:f,qualifyingResult:m}=p;s.structures=h,s.links=f;let g=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!YR({stage:gt,drawDefinition:s})){let D=JR({drawSize:m.qualifyingDrawPositionsCount,stage:gt,drawDefinition:s});if(D.error)return D}if(g){let D=dhe({qualifiersCount:g,drawDefinition:s,stage:nt});if(D.error)return D}let v=t.drawSize??u;Object.assign(t,ft({drawSize:v,matchUpType:c,tieFormat:l}));let{matchUps:y,matchUpsMap:I}=lr({drawDefinition:s});l&&(y==null||y.forEach(D=>{if(!d.includes(D.matchUpId)){let{tieMatchUps:w}=RC({tieFormat:l,matchUp:D,isMock:a});Object.assign(D,{tieMatchUps:w,matchUpType:c})}}));let{inContextDrawMatchUps:b}=Zm({drawDefinition:s,matchUpsMap:I});return Ji({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:b,drawDefinition:s,matchUpsMap:I,...re,structures:h,matchUps:y,links:f}}function Tw(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:vr};let{participant:a,tournamentId:o}=kg({tournamentRecords:r,tournamentRecord:e,participantId:n});return a?{...td({participant:a,scaleAttributes:i}),tournamentId:o}:{error:Gn}}function Uw(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,a,o;if(!ufe({scaleItem:r}))return{error:HP};if(n&&Array.isArray(i.participants)&&(o=i.participants.find(s=>s.participantId===n),o)){let s=dfe({removePriorValues:e,participant:o,scaleItem:r});if(s.error)return s;a=!s.valueChanged;let{topics:l}=Wl();l.includes(sa)&&ti({topic:sa,payload:{tournamentId:i.tournamentId,participants:[o]}})}return a&&{...re,info:zW,existingValue:r==null?void 0:r.scaleValue}||o&&{...re,newValue:r==null?void 0:r.scaleValue}||{error:Gn}}function cfe(t){var e;let{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:a,context:o}=t;if(!r)return{error:Ne};if(!r.participants)return{error:jP};let s=0,l={},c=[];for(let p of i){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if(ufe({scaleItem:f}))Array.isArray(l[h])||(l[h]=[]),l[h].push(f);else return{error:HP}}r.participants.forEach(p=>{let{participantId:h}=p||{};Array.isArray(l[h])&&l[h].forEach(f=>{dfe({participant:p,scaleItem:f,removePriorValues:n}),c.push(p),s++})});let u=s?void 0:L0,{topics:d}=Wl();if(d.includes(sa)&&s&&ti({topic:sa,payload:{tournamentId:r.tournamentId,participants:c}}),o){let{eventId:p,drawId:h,...f}=o,m=((e=f.scaleAttributes)==null?void 0:e.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:E3,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=po({tournamentRecord:r,eventId:p,drawId:h});h&&Dq({drawDefinition:v,timeItem:g}),p&&yI({event:y,timeItem:g})}else vI({tournamentRecord:r,timeItem:g})}}return a&&d.includes(yw)&&ti({topic:yw,payload:a}),ft({...re,modificationsApplied:s,info:u})}function ufe({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function dfe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:tI};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:HP};let a=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:o}=td({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(o==null?void 0:o.scaleValue)&&s(i.scaleValue))&&JSON.stringify(o==null?void 0:o.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[ry,c,u,d].join("."),h=ft({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:a,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...re,valueChanged:l,newValue:i.scaleValue}}var mm="ELO",pfe="NTRP",dVe="TRN",hfe="UTR",Xq="WTN",pVe={ELO:mm,NTRP:pfe,TRN:dVe,UTR:hfe,WTN:Xq},hVe={[mm]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[pfe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[hfe]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[Xq]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},rs=hVe,fVe=t=>250/Math.pow(t+5,.4),mVe=()=>1;function gVe(t=3,e=2){let i=t/e;return isNaN(i)?rb.kDefault():i}var rb={nSpread:400,diffThreshold:.125,kCalc:fVe,kMultiplier:gVe,kDefault:mVe};function ffe(t){let{winnerRating:e,loserRating:i,ratingRange:n}=t,{ratings:r=rs,winnerCountables:a=1,loserCountables:o=0,ratingType:s=mm,maxCountables:l,countables:c}=t||{},u=r==null?void 0:r[s];if(!u)return{error:dt};n=u.range||n,e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=n[0]>n[1],p=u.decimalsCount||0,h=d?n.slice().reverse():n,f=(O,x)=>parseFloat(x)>=Math.min(...O)&&parseFloat(x)<=Math.max(...O);(!f(n,e)||!f(n,i))&&(f(n,e)||(e=u.defaultInitialization),f(n,i)||(i=u.defaultInitialization));let m=({value:O,sourceRange:x,targetRange:F})=>(O-x[0])*(F[1]-F[0])/(x[1]-x[0])+F[0],g=m({targetRange:rs[mm].range,sourceRange:h,value:d?n[0]-e:e}),v=m({targetRange:rs[mm].range,sourceRange:h,value:d?n[0]-i:i}),y=(O,x)=>1/(1+Math.pow(10,(x-O)/rb.nSpread)),I=y(g,v),b=y(v,g),D=rb.kCalc(a),w=rb.kCalc(o),S=rb.kMultiplier(l,c),U=g+S*D*(1-I),C=v+S*w*(0-b),E=m({sourceRange:rs[mm].range,value:U,targetRange:h}),P=m({sourceRange:rs[mm].range,value:C,targetRange:h}),M=d?n[0]-E:E,N=parseFloat(parseFloat(M).toFixed(p)),R=d?n[0]-P:P,A=parseFloat(parseFloat(R).toFixed(p)),_=Math.max(...n)?Math.abs(e-i)/Math.max(...n):0;return(E>P&&_>rb.diffThreshold||N<0||A<0)&&(N=e,A=i),{newWinnerRating:N,newLoserRating:A}}var vVe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function mfe(t){var e,i;let{removePriorValues:n=!0,tournamentRecord:r,ratingType:a=mm,considerGames:o,matchUpIds:s,asDynamic:l}=t;if(!r)return{error:Ne};if(!Array.isArray(s))return{error:Nd};if(typeof a!="string")return{error:Ie,ratingType:a};if(!rs[a])return{error:Ie};let c=rs[a],{accessor:u}=c,d={},p=t.matchUps??Hr({matchUpFilters:{matchUpIds:s,matchUpStatuses:Mr},tournamentRecord:r,inContext:!0}).matchUps??[];p.sort(pI);for(let f of p){let{endDate:m,matchUpFormat:g,score:v,sides:y,winningSide:I}=f,b=f.matchUpType,D={eventType:b,scaleName:a,scaleType:Tm},w=`${a}.${ede}`,S={scaleName:w,eventType:b,scaleType:Tm},U=Object.assign({},...(y??[]).map(x=>{let{sideNumber:F,participant:$}=x;return F&&{[F]:[$==null?void 0:$.participantId,...($==null?void 0:$.individualParticipantIds)??[]].filter(Boolean).flat()}})),C=l?w:a,E=Object.assign({},...Object.values(U).flat().map(x=>{let{scaleItem:F}=Tw({scaleAttributes:S,tournamentRecord:r,participantId:x}),{scaleItem:$}=Tw({tournamentRecord:r,scaleAttributes:D,participantId:x}),V=u?{[u]:void 0}:void 0;return x&&{[x]:F??$??{scaleName:C,eventType:b,scaleDate:m,scaleType:Tm,scaleValue:V}}})),P=g?go(g):{},M=(P==null?void 0:P.bestOf)||1,N=(P==null?void 0:P.setsTo)||1,R=o?M&N:M,A=(v==null?void 0:v.sets)&&vVe(v.sets)||I===1&&[1,0]||[0,1],_=I?U[I]:[],O=I?U[3-I]:[];for(let x of _){let F=(e=E[x])==null?void 0:e.scaleValue,$=typeof F=="object"?F[u]:F;for(let V of O){let G=(i=E[V])==null?void 0:i.scaleValue,j=typeof G=="object"?G[u]:G,z=I?A[I]:[0,0],H=I?A[3-I]:[0,0],{newWinnerRating:K,newLoserRating:q}=ffe({winnerCountables:z,loserCountables:H,maxCountables:R,winnerRating:$,loserRating:j,ratingType:a}),Y=u?{...F,[u]:K}:K,Z=u?{...G,[u]:q}:q;E[x].scaleValue=Y,E[V].scaleValue=Z;let Q=Uw({participantId:x,removePriorValues:n,tournamentRecord:r,scaleItem:{...E[x],scaleName:C}});if(Q.error||(Q=Uw({participantId:V,removePriorValues:n,tournamentRecord:r,scaleItem:{...E[V],scaleName:C}}),Q.error))return Q}}Object.assign(d,E)}let h=p.map(({matchUpId:f})=>f);return{...re,modifiedScaleValues:d,processedMatchUpIds:h}}function uO(t){var e;let{matchUpIds:i=[],drawDefinition:n,roundNumber:r,newRound:a,isMock:o,event:s}=t;if(typeof n!="object")return{error:tt};let{participantIdPairings:l,matchUpsCount:c}=t,u=oO(t);if(u.error)return oe({result:u});let{lastRoundNumber:d,availableMatchUpsCount:p=0,roundMatchUpsCount:h=0}=u;if(!c)a?c=h:p>0&&(c=p);else if(c>h&&t.restrictMatchUpsCount!==!1)return oe({result:{error:Ie,info:"matchUpsCount error",context:{roundMatchUpsCount:h}}});if(l&&!Array.isArray(l)||c&&!Rt(c)||i&&!Array.isArray(i)||!l&&!c)return{error:Ie,info:"matchUpsCount or pairings error"};if(c&&t.restrictMatchUpsCount!==!1&&c>32)return{error:Ie,info:"matchUpsCount must be less than 33"};if(r&&!t.ignoreLastRoundNumber&&r-1>(d||0))return{error:Ie,info:"roundNumber error"};let f=r??(a&&(d??0)+1||d||1);l=l??Xe(0,c).map(()=>({participantIds:[void 0,void 0]}));let m=v=>{if(!t.idPrefix)return;let y=n.drawId,I=t.idPrefix??"ah";return`${y}-${I}-${f}-${v}`},g=l==null?void 0:l.map((v,y)=>{let I=(v==null?void 0:v.participantIds)??[void 0,void 0];I.push(void 0,void 0);let b=I.slice(0,2).map((w,S)=>ft({sideNumber:S+1,participantId:w})),D=i[y]??m(y)??xi();return{roundNumber:f,matchUpStatus:Fn,matchUpId:D,sides:b}});if(g!=null&&g.length){let v=(e=Ea({drawDefinition:n,event:s}))==null?void 0:e.tieFormat;v&&g.forEach(y=>{let{tieMatchUps:I}=RC({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:I,matchUpType:Yi})})}return{roundNumber:f,matchUpsCount:(g==null?void 0:g.length)??0,matchUps:g,...re}}function yVe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let a=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),o=Object.keys(i),s=[],l=OY({actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n}),c=[PL(l)];s.push(l);let u=l.value,d=l,p=0,h=0,f=o.length,m;do f-=1,m=o.length*i[o[0]].length;while(m>t&&f>5);let g=[];o.forEach(y=>{i[y].slice(0,f).forEach(I=>{h+=1;let b=_v(y,I.opponent);if(!g.includes(b)){let D=OY({stipulated:[[y,I.opponent]],actorsCount:o.length,valueSortedPairings:e,pairingValueMap:a,deltaObjects:r,valueObjects:n});if(!c.includes(PL(D))){c.push(PL(D)),s.push(D);let{maxDelta:w,value:S}=D;w<d.maxDelta&&(d=D),(S<u||S===u&&Math.round(Math.random()))&&(u=S),g.push(b),p+=1}}}),s=s.filter(I=>Math.abs(I.value-u)<5)}),s.sort((y,I)=>y.maxDiff-I.maxDiff);let v=xo(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function PL(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function OY({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:a}){let o=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=_v(p,h),m=i[f];s.push({participantIds:d,value:m}),l+=i[f]}),jr(t,a).map(d=>Fa(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>o.includes(f)||h,!1)){o.push(...p);let h=d.value;l+=h,s.push({participantIds:p,value:h})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=_v(h,f),g=n[m];return g>d?g:d},0),u=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=_v(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function _v(t,e){return[t,e].sort(Wk).join("|")}function gfe({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(a=>a!==r),e[r].forEach(a=>{let o=_v(a,r);i.includes(o)||i.push(o)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function IVe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(Yt);if(n.length===2){let[r,a]=n,o=_v(r,a);e.includes(o)||e.push(o)}}return{encounters:e}}function bVe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let a=t[r].map(o=>n(r,o));i[r]=a.sort((o,s)=>o.value-s.value)}function n(r,a){let o=_v(r,a);return{opponent:a,value:e[o]}}return{pairingValues:i}}var wVe=0;function SVe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var a;let o=((a=rs[n])==null?void 0:a.defaultInitialization)??wVe;return r.split("|").map(s=>{var l;if(i===Ll){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||o):o*2}else return e[s]||o})}function TVe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:a,valueObjects:o,eventType:s,scaleName:l,salted:c}){n.forEach(v=>{let y=SVe({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),I=typeof c=="number"&&c||.5,b=c&&(Math.round(Math.random())?I:I*-1)||0,D=Math.abs(y[0]-y[1])+b,w=Math.abs(y[0]-y[1]);a[v]=w,o[v]||(o[v]=0),o[v]+=D?Math.pow(D,2):0});let u=n.map(v=>({pairing:v,value:o[v]})).sort((v,y)=>v.value-y.value),{pairingValues:d}=bVe({possiblePairings:i,valueObjects:o}),{candidate:p,candidatesCount:h,deltaCandidate:f,iterations:m}=yVe({valueSortedPairings:u,maxIterations:r,pairingValues:d,deltaObjects:a,valueObjects:o}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:h,deltaCandidate:f,iterations:m,candidate:p}}var UVe=100,DVe=100,PVe=4e3;function Jq({encounterValue:t=UVe,sameTeamValue:e=DVe,maxIterations:i=PVe,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:a,tournamentRecord:o,dynamicRatings:s,participantIds:l,drawDefinition:c,adHocRatings:u,salted:d=.5,roundNumber:p,structureId:h,matchUpIds:f,eventType:m,structure:g,scaleName:v,idPrefix:y,isMock:I,event:b}){var D,w;if(!c)return{error:tt};if(!g&&!h)return{error:wn};if(g||(g=Dt({drawDefinition:c,structureId:h}).structure),!on(g))return{error:Mf};if(!(l!=null&&l.length))return{error:Rf};let S=[...a??[],...(g==null?void 0:g.matchUps)??[]],{encounters:U}=IVe({matchUps:S}),C=(o==null?void 0:o.participants)??[];if(s){let j=$t(g!=null&&g.matchUps?g.matchUps.map(({roundNumber:H})=>H):[]),z=Math.max(...j,0);if(z){let H=(D=g==null?void 0:g.matchUps)==null?void 0:D.filter(({roundNumber:K})=>K===z).map(({matchUpId:K})=>K);mfe({ratingType:v||((w=b==null?void 0:b.category)==null?void 0:w.ratingType),tournamentRecord:o,asDynamic:!0,matchUpIds:H})}}let{valueObjects:E}=CVe({tournamentParticipants:C,encounterValue:t,sameTeamValue:e,encounters:U}),{uniquePairings:P,possiblePairings:M,deltaObjects:N}=gfe({participantIds:l}),R={tournamentParticipants:C,possiblePairings:M,drawDefinition:c,participantIds:l,uniquePairings:P,maxIterations:i,adHocRatings:u,deltaObjects:N,valueObjects:E,eventType:m,scaleName:v,structure:g,salted:d},{candidatesCount:A,participantIdPairings:_,iterations:O,candidate:x}=TVe(R);if(!A)return{error:gk};let F,$;if(n){let j=uO({structureId:g==null?void 0:g.structureId,ignoreLastRoundNumber:r,participantIdPairings:_,newRound:!0,drawDefinition:c,roundNumber:p,matchUpIds:f,idPrefix:y,isMock:I,event:b});if(j.error)return j;F=j.roundNumber,$=j.matchUps}let{maxDelta:V,maxDiff:G}=x;return{roundNumber:F,participantIdPairings:_,candidatesCount:A,...re,iterations:O,matchUps:$,maxDelta:V,maxDiff:G}}function CVe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let o of t)r[o]||(r[o]=0),r[o]+=i;let a=e==null?void 0:e.filter(({participantType:o})=>o===Gi);if(a)for(let o of a){let s=o.individualParticipantIds??[],{uniquePairings:l}=gfe({participantIds:s});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function vfe(t){var e,i,n,r;let{drawType:a=Qc,attachConsolation:o=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:c,automated:u,placeByes:d,isMock:p,event:h}=t,f=t==null?void 0:t.drawDefinition;if(!f)return{error:tt};let m=xr,g=lI({stageSequence:1,drawDefinition:f,stage:m}),v=[xl,JP,Dd].includes(a)?g.length:F0(g.length);if(!c&&a===z0&&g.length<2||a===xl&&g.length<3)return{error:ck};let{tieFormat:y,matchUpType:I}=t;if(y){let A=Po({tieFormat:y});if(A.error)return A}y=Jr(y??((e=Ea({drawDefinition:f}))==null?void 0:e.tieFormat)),I=I??f.matchUpType??Un;let{structures:b}=Pd({stageSequence:1,drawDefinition:f,stage:m});if(b.length>1)return{error:$ce};if((n=(i=b==null?void 0:b[0])==null?void 0:i.matchUps)!=null&&n.length)return{error:qW};let D=(r=b==null?void 0:b[0])==null?void 0:r.structureId;Object.assign(t,ft({structureName:t.structureName??ia(xr),structureId:D,matchUpType:I,tieFormat:y,drawSize:v,stage:m}));let w=lfe(t);if(w.error)return w;let S=w.generators[a];if(!S)return{error:SW};let U=S==null?void 0:S();if(U.error)return U;let{structures:C,links:E}=U,P=C.map(A=>Ui({structure:A}).matchUps).flat();y&&P.forEach(A=>{let{tieMatchUps:_}=RC({matchUp:A,tieFormat:y,isMock:p});Object.assign(A,{tieMatchUps:_,matchUpType:I})}),(!s||!o)&&(f=ot(f,!1,!0)),f.links||(f.links=[]),E.length&&f.links.push(...E);let M=C.map(({structureId:A})=>A);f.structures||(f.structures=[]);let N=f.structures.map(({structureId:A})=>A);f.structures=f.structures.map(A=>M.includes(A.structureId)?C.find(({structureId:_})=>_===A.structureId):A);let R=C.filter(({structureId:A})=>!N.includes(A));return R.length&&f.structures.push(...R),u&&PC({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:f,structureId:D,placeByes:d,drawSize:v,event:h}),o&&Ji({drawDefinition:f}),{links:E,structures:C,...re}}var Qq={};Ht(Qq,{addGame:()=>Dfe,addPoint:()=>Ufe,addSet:()=>Cfe,addShot:()=>Pfe,analyzeSet:()=>FU,calculateHistoryScore:()=>wfe,checkScoreHasValue:()=>zr,checkSetIsComplete:()=>hO,clearHistory:()=>Tfe,generate:()=>yfe,generateScoreString:()=>nd,generateTieMatchUpScore:()=>OC,getSetComplement:()=>o4,getTiebreakComplement:()=>vO,helpers:()=>Nfe,isValidMatchUpFormat:()=>Zo,keyValueScore:()=>nme,mutate:()=>bfe,parseMatchUpFormat:()=>go,parseScoreString:()=>aN,query:()=>lme,redo:()=>Efe,reverseScore:()=>Ife,setServingSide:()=>Sfe,stringifyMatchUpFormat:()=>tO,tidyScore:()=>sme,umo:()=>Rfe,undo:()=>Mfe,validateScore:()=>a4,validateTieFormat:()=>Po});var yfe={};Ht(yfe,{generateScoreString:()=>nd,generateTieMatchUpScore:()=>OC,reverseScore:()=>Ife});function nd(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:a,autoComplete:o,winningSide:s,sets:l}=t;if(!l)return{error:dt,info:"missing sets"};let c=a&&go(a),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},h=n||!(!e||!s||s===1),f=i?EVe({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(MVe).map(g).filter(Boolean).join(" "))||"";if(!f)return m;if(s===2)return`${f} ${m}`;return`${m} ${f}`;function g(v){let y=u&&v.setNumber===u&&d?d:p,I=O=>Mn(O==null?void 0:O.side1Score)||Mn(O==null?void 0:O.side2Score),b=O=>Mn(O==null?void 0:O.side1TiebreakScore)||Mn(O==null?void 0:O.side2TiebreakScore),D=(y==null?void 0:y.tiebreakSet)||!I(v)&&b(v),{side1Score:w,side2Score:S,side1TiebreakScore:U,side2TiebreakScore:C}=v,E=U||(Mn(U)||o?0:""),P=C||(Mn(C)||o?0:"");if(D)return`[${(h?[P,E]:[E,P]).join("-")}]`;let M=Math.min(E,P),N=M?`(${M})`:"",R=w||(Mn(w)||o?0:""),A=S||(Mn(S)||o?0:""),_=h?`${[A,R].join("-")}${N}`:`${[R,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function EVe({matchUpStatus:t}){let e={[Na]:"RET",[Ci]:"WO",[fr]:"DF/DF",[er]:"WO/WO",[xf]:"SUS",[ps]:"ABN",[mi]:"DEF",[H0]:"DR"};return t&&e[t]||""}function MVe(t,e){return t.setNumber-e.setNumber}function Ife(t){if(!(t!=null&&t.score))return{error:dt};let{sets:e}=t.score,i=e.map(a=>{let{side1TiebreakScore:o,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=a;return ft({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:o,side1Score:u,side2Score:c,setNumber:d})}),n=nd({sets:i}),r=nd({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...re}}var bfe={};Ht(bfe,{addGame:()=>Dfe,addPoint:()=>Ufe,addSet:()=>Cfe,addShot:()=>Pfe,calculateHistoryScore:()=>wfe,clearHistory:()=>Tfe,redo:()=>Efe,setServingSide:()=>Sfe,umo:()=>Rfe,undo:()=>Mfe});function xg({matchUp:t}){let{extension:e}=jt({name:Mk,element:t});if(!e)return{error:Sa};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...re}}function wfe(t){var e,i;if(!t)return{error:dt};let{matchUp:n,updateScore:r}=t;if(!n)return{error:Do};let a=((e=xg({matchUp:n}))==null?void 0:e.history)||[];if(!Array.isArray(a))return{error:Ie,info:"history is not an array"};let{matchUpFormat:o}=n;if(!o)return{error:RW};if(!Zo({matchUpFormat:o}))return{error:MW};let s=go(o),{bestOf:l,finalSetFormat:c,setFormat:u}=s,d=["0","15","30","40","A","G"],p={sets:[]},h=[],f,m=[0,0],g=1,v=0,y,I=0,b=M=>[1,2].includes(M),D=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]}),w=()=>({winningSide:void 0,points:[]}),S=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),U=S(),C=w(),E=D(),P=0;for(let M of a){P+=1,y=p.sets.length+1===l;let N=y&&c?c:u,{tiebreakAt:R,setTo:A,NoAD:_,tiebbreakFormat:O}=N,x=E.side1Score===R&&E.side1Score===E.side2Score,F=!!N.tiebreakSet,$=F?N.tiebreakSet:O,{tiebreakTo:V,NoAD:G}=$||{},j=()=>{f=void 0,m=[0,0],g=3-g,E.side1TiebreakScore=0,E.side2TiebreakScore=0,E.side1PointScore="",E.side2PointScore="",I=0},z=q=>{E.winningSide=q;let{s:Y,...Z}=E;p.sets.push(Z),U=S(),C=w(),E=D(),j()},H=q=>{C.winningSide=q;let{g:Y,...Z}=C;E.games.push(Z),U=S(),C=w(),j();let Q=`side${q}Score`;E[Q]+=1},K=q=>{U.winningSide=q;let{p:Y,...Z}=U;C.points.push(Z),U=S(),I=0;let Q=()=>m.reduce((ue,J)=>ue+J)%4/4>.5?g:3-g,ie=q-1;if(x||F){m[ie]+=1,f=Q(),E[`side${q}TiebreakScore`]=m[ie],E[`side${3-q}TiebreakScore`]=m[1-ie];let ue=G?1:2;if(m[ie]>=V&&m[ie]>=m[1-ie]+ue)return H(q),{gameCompleted:!0}}else if(m[1-ie]===4&&m[ie]===3?m[1-ie]-=1:m[ie]+=1,E.side1PointScore=d[m[0]],E.side2PointScore=d[m[1]],m[ie]===5||m[ie]===4&&m[1-ie]<3||_&&m[ie]===4)return H(q),{gameCompleted:!0}};if(b(M.srv)&&(g=M.srv),["p","s","g","o"].includes(M.u)&&h.push(M.u),M.shotOutcome&&(U.shots.push(M),M.shotType==="SERVE"&&["OUT","NET"].includes(M.shotOutcome)&&(I+=1),I===2)){let q=3-g;K(q)}if(b(M.p)||Rt(M.pointNumber)){let q=M.winningSide||M.p;if((i=K(q))!=null&&i.gameCompleted)continue}if(b(M.g)||Rt(M.gameNumber)){let q=M.winningSide||M.g;C.winningSide=q;let Y=`side${q}Score`,Z=`side${3-q}Score`;if(h.length&&(h.includes("p"),h=[]),H(q),E[Y]===A&&E[Y]-E[Z]>=(_?1:2)&&(z(q),y))break}if(b(M.s)||Rt(M.setNumber)){let q=M.winningSide||M.s;if(z(q),h.length&&(h.includes("p"),h.includes("g"),h=[]),y)break}}return P!==a.length&&console.log({error:"Match completed with excess history"}),(E.side1Score||E.side2Score||E.games.length||E.side1TiebreakScore||E.side2TiebreakScore)&&p.sets.push(E),p.scoreStringSide1=nd({...p,matchUpFormat:o}),p.scoreStringSide2=nd({...p,matchUpFormat:o,reversed:!0}),g=f||g,r&&(n.score=p),{...re,servingSide:g,score:p}}function Lg({undoHistory:t,history:e,matchUp:i}){return ui({element:i,extension:{value:{history:e,undoHistory:t},name:Mk}})}function Sfe({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:kW};let{history:i=[]}=xg({matchUp:t});return i.push({srv:e}),Lg({matchUp:t,history:i})}function Tfe({matchUp:t}){return Lg({matchUp:t})}function Ufe({matchUp:t,point:e}){if(!e||!t)return{error:dt};if(typeof e!="object")return{error:Ie,context:{point:e}};let{history:i=[]}=xg({matchUp:t});return i.push(e),Lg({matchUp:t,history:i})}function Dfe({matchUp:t,game:e}){if(typeof e!="object")return{error:Ie,context:{game:e}};let{history:i=[]}=xg({matchUp:t});return i.push(e),Lg({matchUp:t,history:i})}function Pfe({matchUp:t,shot:e}){if(typeof e!="object")return{error:dt};let{history:i=[]}=xg({matchUp:t});return i.push(e),Lg({matchUp:t,history:i})}function Cfe({matchUp:t,set:e}){if(typeof e!="object")return{error:dt};let{history:i=[]}=xg({matchUp:t});return i.push(e),Lg({matchUp:t,history:i})}function Efe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=xg({matchUp:t});return i.length&&e.push(i.pop()),Lg({matchUp:t,history:e,undoHistory:i})}function Mfe({matchUp:t}){let{history:e=[],undoHistory:i=[]}=xg({matchUp:t});return i.push(e.pop()),Lg({matchUp:t,history:e,undoHistory:i})}var Rfe={},Nfe={};Ht(Nfe,{keyValueScore:()=>nme,parseMatchUpFormat:()=>go,stringifyMatchUpFormat:()=>tO,tidyScore:()=>sme});var kv=" ",_B="DEF",RVe="COMPLETED",Afe="WO",NVe="WO/WO",_fe="ABN",kfe="SUS",Ofe="RET",xfe="INT",Lfe=[Ofe,_B,Afe,NVe,_fe,kfe,xfe],kB="DEFAULTED",Ffe="WALKOVER",$fe="ABANDONED",Bfe="SUSPENDED",Vfe="RETIRED",jfe="INTERRUPTED",AVe=[Vfe,kB,Ffe],_Ve="Enter Score",fy="()",Qm="[]",e4=["up","left","shift+tab"],t4=["enter","down","tab","right"],iN="backspace",Gfe="r",Hfe="s",zfe="a",Wfe="d",qfe="w",Kfe="i",dO=[Gfe,Wfe,qfe,zfe,Hfe,Kfe],pO="space",CL=["[","("],nN=[...e4,...t4,pO,"]"],Yfe="-",kVe="/",Ov=Yfe,rd=Yfe,Zfe=[kVe],OVe=0,xVe=["=","+","num_1","num_2","shift+=","shift+-"],i4=["0","1","2","3","4","5","6","7","8","9"].concat(dO),Xfe=i4.map(t=>`shift+${t}`),Jfe=[Ov,iN].concat(nN,Zfe),Qfe=[i4,Xfe,Jfe].join(","),LVe=[Qfe,e4,t4,xVe].join(","),FVe={OUTCOMEKEYS:dO,SIDE1KEYS:i4,SIDE2KEYS:Xfe,MODIFIERS:Jfe,PROMPT:_Ve,MOVEUP:e4,MOVEDOWN:t4,HOTKEYS:LVe};function VI({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=eme({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==kv?kv:"";return t+n+i}else return i+kv+t}function eme({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of Lfe){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+kv:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function OB({analysis:t,scoreString:e,sets:i,lowSide:n}){var r,a,o;let s,l;if(!e)return{scoreString:e,sets:i};let{scoreString:c,removed:u}=eme({scoreString:e});if(e=c,u)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{},p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(i=i.slice(0,i.length-1),d=i[i.length-1]||{});let{tiebreakSet:h}=t.setFormat,{tiebreakTo:f,NoAD:m}=h||{},{isTiebreakEntry:g}=Sb({brackets:Qm,scoreString:e}),v=BVe(e);if(v>=0){s=e.slice(0,v);let{isTiebreakEntry:y}=Sb({brackets:fy,scoreString:s}),{lastOpenBracketIndex:I,isTiebreakEntry:b}=Sb({brackets:Qm,scoreString:s}),D=s&&s[s.length-1].trim(),w=s&&!isNaN(D),S=t.isIncompleteSetScore;if(g&&b){let U=s.slice(I+1).split(rd),C=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,P=[C,E];if(E){let M=n===1?1:0;P[M]=((P==null?void 0:P[1-M])||0)+(m?1:2),(P[M]||0)<f&&(P[M]=f),s=e.slice(0,I+1),s+=P.join(rd)}else C!==void 0?(s=e.slice(0,I+1),s+=C):(s=e.slice(0,I),S=!0);d.side1TiebreakScore=P[0]||0,d.side2TiebreakScore=P[1]||0}if(s.length||(s=void 0),S){let U=(r=d.side1Score)==null?void 0:r.toString();if(U){let C=U==null?void 0:U.slice(0,U.length-1);d.side1Score=!isNaN(C)&&parseInt(C)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(w){let U=(a=d.side2Score)==null?void 0:a.toString(),C=(o=d.side1Score)==null?void 0:o.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);d.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=C==null?void 0:C.slice(0,C.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!b?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function Sb({brackets:t=fy,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),a=Math.max(...Jc(i,r)),o=Math.max(...Jc(n,r));return{isTiebreakEntry:a>o,lastOpenBracketIndex:a}}function $Ve({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=Qm.split(""),a=t.split(""),o=Math.max(...Jc(n,a)),s=Math.max(...Jc(r,a)),l=Math.max(...Jc(rd,a));return i&&o>s&&l>o}function BVe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function tme(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function xY({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var r;let a=go(t),{bestOf:o}=a,s=Math.ceil(o/2),l=((r=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:r.indexOf(s))+1||void 0;return AVe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function hO({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:a}){var o;if(!a)return{error:dt,info:"missing set"};e=e||i&&go(i);let s=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:c}=a,{setTo:u,tiebreakAt:d}=s,p=fO({set:a}),h=Math.abs(l-c),f=l>=u||c>=u,m=n||l>=u&&c>=u||d&&d<u&&(l===d||c===d),g=t||m&&(p===1&&a.side1TiebreakScore>a.side2TiebreakScore||p===2&&a.side2TiebreakScore>a.side1TiebreakScore),v=!m&&s.NoAD||m||n&&(o=s.tiebreakFormat)!=null&&o.NoAD?1:2,y=h>=v;return!!((f&&(y||m)||n)&&(!m||g))}function fO({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function n4({analysis:t,set:e}){let i=fO({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:a}=t;return hO({matchUpScoringFormat:a,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function VVe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let a=i[i.length-1];n=St(n);let{validSide2Score:o,requiresTiebreak:s}=jVe({analysis:t,set:a,value:n});if(o){r=!0,e=(e||"")+n,a.side2Score=n;let l=n4({analysis:t,set:i[i.length-1]});if(a.winningSide=l||void 0,s){let c=fy.split("")[0];e+=c}else t.isDecidingSet||(e+=kv)}return{sets:i,scoreString:e,updated:r}}function jVe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:a,NoAD:o}=n,{side1Score:s}=e,l,c;return r&&r<a?s===r?l=i<=a:l=i<=r:s===a?o?l=i<a:l=i<=a+1:s===a-1?o?l=i<=a:l=i<=a+1:s===a+1?l=i===a||i===a-1:l=i<=a,l&&(r&&r<a?c=s===a&&i===r||s===r&&i===a:c=s>=a&&i>=a&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function ime({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:a}){let o;return e===Gfe?n?(o=!0,n=VI({scoreString:n,lowSide:t,outcome:Ofe}),r=t===2?1:2,a=Vfe):(o=!0,n=VI({scoreString:n,lowSide:t,outcome:_B}),r=t===2?1:2,a=kB):e===Wfe?(o=!0,n=VI({scoreString:n,lowSide:t,outcome:_B}),r=t===2?1:2,a=kB):e===qfe?(o=!0,i=[],n=Afe,r=t===2?1:2,a=Ffe):e===Hfe&&n?(o=!0,n=VI({scoreString:n,lowSide:t,outcome:kfe}),a=Bfe,r=void 0):e===zfe?(o=!0,n=VI({scoreString:n,lowSide:t,outcome:_fe}),a=$fe,r=void 0):e===Kfe&&n&&(o=!0,n=VI({scoreString:n,lowSide:t,outcome:xfe}),a=jfe,r=void 0),{updated:o,sets:i,scoreString:n,matchUpStatus:a,winningSide:r}}function GVe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:a}=t,{analysis:o,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==iN&&(e=[{setNumber:1}]);let d=e.length-1;if(dO.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":o.finalSetIsComplete||r?i="final set is already complete":o.isIncompleteSetScore?i="incomplete set scoreString":o.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:c}=ime({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:a,winningSide:r}))}else if(l===iN){if({scoreString:n,sets:e,outcomeRemoved:u}=OB({analysis:o,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}a=void 0,r=void 0,c=!0}else if(o.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,updated:!1,info:"matchUp is complete"};if(l===pO){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!o.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===Ov&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&o.isNumericEnding)n+="-",e[d].side2Score=0,a=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=St((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=St(h),p=e[d].side1Score.toString(),c=!0}else{let h=St((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=St(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:a,info:i,updated:c}}function HVe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:a}){var o;let s,l,{tiebreakSet:{tiebreakTo:c,NoAD:u}}=t.setFormat,[d]=Qm.split("");if(t.isMatchTiebreakEntry||(n+=d),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=Sb({brackets:Qm,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":a)).split(rd);if((((o=h[i-1])==null?void 0:o.length)||0)>=2)l="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+a),i===2&&(h[1]=(h[1]||"")+a);let f=[h[0]||0,h[1]||0].map(v=>St(v)),m=i===1?1:0;f[m]=f[1-m]+(u?1:2),f[m]<c&&(f[m]=c);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(rd),s=!0}else{let f=[h[0]||0,h[1]||0].map(g=>St(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=a,s=!0}}else{let p=tme({lowValue:St(a||0),tiebreakTo:c,NoAD:u}),h=[St(a),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(rd),s=!0}return{info:l,scoreString:n,sets:r,updated:s}}function zVe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:a,NoAD:o}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(a||r);if(a&&a<r&&n>a)return{scoreString:i};if(o&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=fy.split("")[0],d=c.join(Ov)+(s?u:kv);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=n4({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return s?n+1:n+1===r?n+(o?1:2):r}}function WVe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var a,o,s;let l=(((a=r==null?void 0:r.filter(G=>G==null?void 0:G.winningSide))==null?void 0:a.length)||0)+(i?0:1),c=go(t),u=l===(c==null?void 0:c.bestOf),d=u&&(c==null?void 0:c.finalSetFormat)||(c==null?void 0:c.setFormat)||{},p=d==null?void 0:d.timed,h=u&&r[(c==null?void 0:c.bestOf)-1],f=h==null?void 0:h.winningSide,{isTiebreakEntry:m}=Sb({brackets:fy,scoreString:e}),{isTiebreakEntry:g}=Sb({brackets:Qm,scoreString:e}),v=m||g,y=!!d.tiebreakSet,I=(o=e==null?void 0:e[e.length-1])==null?void 0:o.trim(),b=e&&!isNaN(I),D=!v&&I===Ov,w=m&&CL.includes(I),S=g&&CL.includes(I),U=g&&I===rd,C=e==null?void 0:e.split(""),[E]=Qm.split(""),P=C&&Math.max(...Jc(E,C)),M=C&&Math.max(...Jc(rd,C)),N=C&&M>P,R=(s=r[r.length-1])==null?void 0:s.winningSide,A=(r==null?void 0:r.length)&&!R,_=Lfe.find(G=>(e==null?void 0:e.indexOf(G))>=0),O=!isNaN(n),x=n===pO,F=nN.includes(n),$=e==null?void 0:e.split("").find(G=>CL.includes(G)),V=F&&g&&!S&&(U||!$Ve({scoreString:e}));return{isTiebreakSetValue:y&&O,matchUpScoringFormat:c,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:A,isSpace:x,isCloser:F,isTiebreakCloser:F&&$&&v&&b,isDecidingSet:u,isTiebreakSet:y,isTimedSet:p,isNumericEnding:b,isNumericValue:O,hasOpener:$,hasOutcome:_,finalSet:h,finalSetIsComplete:f,lastSetIsComplete:R,isInvalidSetTiebreakValue:x&&v&&w,isInvalidMatchTiebreakValue:V,isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:D,isIncompleteSetTiebreak:w,isIncompleteMatchTiebreak:S,isPartialMatchTiebreakValue:U}}function nme(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:a,matchUpStatus:o}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!Qfe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=xY({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});a=h;let f=WVe({value:i,winningSide:a,scoreString:n,sets:r,matchUpFormat:s});if(Zfe.includes(i)&&(i=Ov),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&St(i)===0&&(f.isTiebreakCloser=!0),nN.includes(i)&&f.hasOpener&&(i=""),nN.includes(i)&&(i=pO),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:o,winningSide:a}=GVe({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:o,winningSide:a,value:i}));else if(dO.includes(i))f.finalSetIsComplete||a?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:o,winningSide:a,updated:u}=ime({lowSide:e,sets:r,scoreString:n,matchUpStatus:o,winningSide:a,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===iN)u=!0,{scoreString:n,sets:r}=OB({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),o=void 0,a=void 0;else if(f.hasOutcome)d="has outcome";else if(i===Ov&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=OB({analysis:f,scoreString:n,sets:r,lowSide:e}),o=void 0);else if(i===rd&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=rd);else if([Ov,rd].includes(i))d="invalid location for joiner";else{if(a)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=VVe({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?fy:Qm,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:I}=f.setFormat,{tiebreakTo:b,NoAD:D}=I||{},w=fO({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),C=tme({lowValue:U,tiebreakTo:b,NoAD:D});w===1?(y.side1TiebreakScore=C,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=C)}n=(n||"")+g,f.isDecidingSet||(n+=kv);let S=n4({analysis:f,set:y});y.winningSide=S||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=HVe({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=fy.split(""),g=Math.max(...Jc(m,n.split(""))),v=n.slice(g+1),y=v&&St(v)===OVe,I=St(v?v+i:i),{tiebreakFormat:b}=f.setFormat,{tiebreakTo:D,NoAD:w}=b||{};!y&&v.length<2?w&&I>D-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=zVe({analysis:f,lowSide:e,scoreString:n,value:St(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=xY({sets:r,winningSide:a,matchUpStatus:o,matchUpFormat:s});return a=m,m&&(!o||[Fn,mu].includes(o))?(o=RVe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:I,side2TiebreakScore:b}=g;return v||y||I||b})):n&&!a&&![Bfe,$fe,jfe].includes(o)&&(o=void 0),{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:a,matchUpStatus:o,info:d}}var mO="\\d+-\\d+",LU="\\d+-\\d+\\(\\d+\\)",r4="\\[\\d+-\\d+\\]",qVe="\\d+-\\d+\\(\\d+-\\d+\\)",KVe=new RegExp(`(${mO}),`,"g"),YVe=new RegExp(`(${LU}),`,"g"),ZVe=[mO,LU,r4,qVe],XVe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],JVe=XVe.map(t=>{let e=t.split("").map(i=>ZVe[i]).join(" ");return new RegExp(`^${e}$`)});function LY(t){return!t||JVe.some(e=>e.test(t))}function QVe(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],a=Object.assign({},...n.split("").map(l=>({[l]:0}))),o="",s=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return a[c]+=1,o=c,l;if(!u&&c&&o&&c!==o){a[o]-=1;let d=e.includes(o)&&e||i.includes(o)&&i||"",p=d.split("").find(h=>h!==o);if(d.includes(c))a[o]||(o="");else return a[c]||(o=""),p}return l}).join("");return t!==s?s:t}function pM(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function eje(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function Dw(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function rN(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,a)=>+r-+a))>=2)return n.join("-")}function FY(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function tje(t){return t.startsWith("(")&&t.endsWith(")")}function ije({score:t,applied:e}){t=QVe(t);let i=/\)(\d+)/g;if(i.test(t))for(let w of t.match(i)){let S=w.replace(")",") ");t=t.replace(w,S)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,a=t.match(n);for(let w of a||[]){let[S]=w.match(r).slice(1),U=S.replace(/ /g,"");t=t.replace(w,`(${U})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(S,U)})}if(o=/\(\((\d)\)\)/g,o.test(t)){let w=t.match(o);w.length&&w.forEach(S=>{let U=S.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(S,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(w=>{let S=new RegExp(`(\\d+)${w}(\\d+)`,"g"),U=t.match(S);U&&U.forEach(C=>t=t.replace(C,C.split(w).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(w=>{let[S]=w.match(/\((\d+), \)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"&&(t=t.replace(w,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(w=>{let[S]=w.match(/\((\d+)\/\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&S==="6"?t=t.replace(w,"(6-0)"):t=t.replace(w,`(${S})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(w=>{let[S]=w.match(/(\d\/\d)\/,/).slice(1);t=t.replace(w,`${S},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(w=>{let[S]=w.match(/\(\/(\d+)\)/).slice(1);S.length===2?t=t.replace(w,`(${S})`):S.length===1&&parseInt(S)<6?t=t.replace(w,`(6-${S})`):t=t.replace(w,`(${S})`)});let p,h,f,m,g,v=()=>{g=qo(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[w]=t.match(y).slice(1);t=t.replace(y,w+")")}if(g["("]===g[")"]&&g["("]>1){let w=t.split(")(").join(") (").split(" ");w.every(tje)?t=w.map(S=>{let U=S.slice(1,S.length-1);return U.length>2?U:S}).join(" "):t=w.join(" ")}v();let I=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!I&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(w=>g[w])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(w=>g[w]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let w=[],S=0;for(let U of t.split("").reverse())U===")"&&(S?w.push("("):S+=1),U==="("&&(S-=1),w.push(U);w.reverse(),t=w.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let w="",S=0;for(let U of t.split(""))U==="("&&(S?w+=")":S+=1),U===")"&&(S-=1),w+=U;t=w}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let D=w=>{let S=w.indexOf("("),U=w.indexOf(")");return S>=0&&U>=0&&S<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let w=t.slice(1,t.length-1);D(w)&&(t=w,v())}return{score:t,applied:e}}function gO(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=Jc("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((a,o)=>o%2).forEach(a=>{t=t.substring(0,a)+" "+t.substring(a+1)}),t}function nje({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[KVe,YVe].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(gO).join(" "),{score:t,applied:e}}function rje({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(pM),a=0,o="";for(let p of r){let h=Jc(p,n).filter(v=>!a||v>a)[0],f=n.slice(a,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((I,b)=>+I-+b));if(y===1){let I=[f.join(" "),[m,p].join("")].join(" ");o+=I,a=h+1}else if(y===0){let I=Math.max(...v);if([4,5,6,7,8,9].includes(I)){let b=[6,4].includes(I)?I+1:I-1,D=[I,b].sort().reverse().join("-"),w=[f.join(" "),[D,p].join("")].join(" ");o+=w,a=h+1}}}}if(r.length&&o.length){let p=n.slice(a).join(" ");return o=[o,p].join(" "),{score:o.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>eje(p)&&"bracket"||Dw(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,h="";return n.forEach((f,m)=>{s[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=s[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,I)=>+y-+I)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=Jc("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!Dw(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(r4).test(p)&&"super"||new RegExp(LU).test(p)&&"tiebreak"||new RegExp(mO).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function aje({score:t,applied:e}){for(let U of[".",","," ","/"]){let C=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(C.test(t)){let E=t.match(C).slice(1).map(M=>parseInt(M)),P=Math.abs(E[0]-E[1]);P<=10&&P>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,C,E,P,M,N]=t.match(i).slice(1);t=t.replace(i,`${U}${C}-${E} ${P}-${M}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,a=/\(\d+\)\d+/;[r,a].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),a.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let o=gO(t);o!==t&&(t=o,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[U,C,E]=t.match(s).slice(1),[P,M]=C.split("");t=`${U}-${P} ${M}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[U,C]=t.match(c).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${M} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[U,C]=t.match(u).slice(1),E=U.trim(),P=C.trim();if(l.test(E)&&l.test(P)){let M=E.match(l).slice(1,3).join("-"),N=P.match(l).slice(1,3).join("-");t=`${M} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,C,E]=t.match(h).slice(1),P=C.split(""),M=`${U}-${P[0]} ${P[1]}-${E}`;t=t.replace(h,M),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(C=>{let E=C.match(U).slice(2)[0];t=t.replace(C,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let C=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let C=" "+U.slice(1).split(" ").join("-");t=t.replace(U,C),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],C=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,C),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let I=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(I.test(t)){let U=t.match(I),C=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(P=>{let[M,N]=P.match(C).slice(1),R=`${M}-${N}`;E=E.replace(P,R)}),t=E,e.push("slashSetPattern")}let b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){let[U,C,E]=t.match(b).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${C}${E}`,e.push("spaceSeparatedSuperPattern"))}let D=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(D)||[]){let[C,E,P,M]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,R]=E.split("-").map(A=>parseInt(A));Math.abs(N-R)===1&&(t=t.replace(U,`${C}${E}(${P})${M}`),e.push("spaceSeparatedSetPattern"))}let w=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(w)||[]){let C=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,P,M]=U.match(C).slice(1),[N,R]=E.split("-").map(A=>parseInt(A));Math.abs(N-R)===1&&(t=t.replace(U,`${E}(${P})${M}`),e.push("floatingTiebreakPattern2"))}let S=/(^|\s)(\d \d)\(/g;for(let U of t.match(S)||[]){let C=/(^|\s)(\d \d)\(/,[E,P]=U.match(C).slice(1);t=t.replace(U,`${E}${P.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function oje({score:t,matchUpStatus:e}){var i;let n=t==null?void 0:t.split(" ");t=n.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(Dw(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(let l of t.match(r)){let c=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(Mn(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=rN(c.split(""),u)}}t=t.replace(l,`(${c})`)}n=t==null?void 0:t.split(" ");let a=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=n.length-1;t=n.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==o;if(a.test(l)&&u){let[d,p,h]=Array.from(l.match(a)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(l=>{if(a.test(l)){let[c,u]=Array.from(l.match(a)).slice(1);return Dw(c)?`${c}(${u})`:c}return l}).join(" "),n=t==null?void 0:t.split(" "),a=new RegExp(/^1-0\((\d+)\)$/),t=n.map(l=>{if(a.test(l)){let[c]=l.match(a).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let s=/\((\d)+0 /;if(s.test(t)){let l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}}function sje({score:t,attributes:e,identifier:i}){var n,r,a;if(typeof t!="string")return{score:t,identifier:i};let o=new RegExp(/\([\d,/ ]+\)/g),s=t.match(o);for(let h of s||[]){let f=(r=(n=h.match(/^\((.*)\)$/))==null?void 0:n.slice(1))==null?void 0:r[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(I=>parseInt(I));if(Math.abs(y[0]-y[1])===1)continue}let g=FY(f),v=gO(g);t=t.replace(h,`(${v})`).trim()}let l=new RegExp(/\[[\d,/ ]+\]/g);(a=t.match(l))==null||a.forEach(h=>{let f=FY(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let c=[")","]"],u=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&c.some(h=>t.endsWith(h))&&u.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(I=>(I.startsWith(",")&&(I=I.slice(1)),I.trim())),m=f.every(I=>I.includes(",")||pM(I)),g=f.every(I=>I.includes("/")||pM(I)),v=f.every(I=>I.includes("-")||pM(I)),y=m&&","||v&&"-"||g&&"/";if(y){let I;f.forEach(b=>{if(b.startsWith("("))if(I==="set"&&(h+=" "),b.includes(y))h+=b.slice(1).split(y).map(D=>D.trim()).join("-"),I="set";else{let D=b.slice(1);h+=`(${D}) `,I="tiebreak"}else if(b.startsWith("[")){let D=b.slice(1).split(y).map(S=>parseInt(S.trim())),w=Math.min(...D);I==="set"?h+=`(${w}) `:h+=`[${D.join("-")}] `,I="tiebreak"}}),t=h.trim()}}let d=qo(t.split(""));d["("]===1&&d[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),d["-"]===1&&Dw(t)&&Mn(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let p=/\(\)/g;return p.test(t)&&(t=t.replace(p,"").trim()),{score:t}}function rme({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],a=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let o=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=Mn(s)&&parseInt(s),c=n[0]!==void 0&&n[1]!==void 0;if(Mn(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,o())){i.push(a()),n=[void 0,void 0];continue}if(c&&e.length===1&&Mn(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(a()),n=[void 0,void 0]}c&&o()}}return{sets:i}}function xB(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=rN(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),a=rN(r,e-4);if(a)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${a}`}}function ame(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),a=r==null?void 0:r.every(s=>Mn(s)),o=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||a){e=e.toString().toLowerCase(),a&&(e=r.join(""));let s=a?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(rme({score:e}),s.length,e.length===3&&o(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&o(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&o(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&o(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(o(s.slice(0,2))===1&&o(s.slice(3,5))>1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))===1&&o(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(o(s.slice(0,2))>1&&o(s.slice(2,4))>1&&o(s.slice(4,6))===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=xB(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=jr(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(D=>parseInt(D)),I=Math.abs(v-y),b=v>y?1:2;return I>1&&b||b*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=qo(c),p=c.map(g=>Math.abs(g)),h=qo(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,I,b,D]=s,w=c.reduce((S,U,C)=>U<0?C:S,void 0);if(w===0){let S=Math.min(y,I);e=`${g}-${v}(${S}) ${b}-${D}`,i.push("chunkSplitTiebreak1")}else if(w===1){let S=Math.min(b,D);e=`${g}-${v} ${y}-${I}(${S})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${I}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,I,b,D,w,S]=s;f||m?s[5]===1&&(f?e=`${g}-${v}(${y}) ${I}-${b} [${D}${w}-${S}]`:e=`${g}-${v} ${y}-${I}(${b}) [${D}${w}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function ome(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let a=e[0]>e[1]&&1||e[1]>e[0]&&2,o=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:o,setWinners:i,totalSets:s,winningSide:a}}function lje({score:t,matchUpStatus:e,attributes:i}){let n=[],r,a=t.split(" "),o=a.length;t=a.map((u,d)=>{if(new RegExp(LU).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!Dw(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&Mn(u))return u.split("").join("-");u=gO(u);let p=new RegExp(`^${r4}$`).test(u)&&"super"||new RegExp(`^${LU}$`).test(u)&&"tiebreak"||new RegExp(`^${mO}$`).test(u)&&"standard"||"unknown";if(n.push(p),o>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let I=g.toString().split(""),b=I.find(D=>parseInt(D)>v||d&&parseInt(D)<=r)??I[0];b&&(u=y?[b,v].join("-"):[v,b].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=ome(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function cje({score:t}){let{setsTied:e,winningSide:i}=ome(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),a=r[r.length-1];if(!a.includes("-")||a.indexOf("(")>0)return{score:t};let o=a.split("(").join("").split(")").join("").split("-");if(!o.every(s=>Mn(s)))return{score:t};if(o[0]==="76"){let s=o[1].length===2?Math.min(...o[1].split("").map(l=>parseInt(l))):o[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{o=o.map(c=>parseInt(c));let s=Math.max(...o),l=Math.abs(o[0]-o[1]);if(s>=10){if(l>2&&o.every(c=>+c>=10)){let c=o.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(o=c)}t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${o.join("-")}]`].join(" "))}return{score:t}}function uje({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function dje({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function pje({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=rN(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:a}=ame({score:i,applied:[]});r!==i&&(i=r,e.push(...a))}}return i}).join(" "),{score:t,applied:e})}function hje({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&xB(t)?{score:xB(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function fje({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function mje({score:t,profile:e,applied:i}){var n;t=t==null?void 0:t.toString().toLowerCase();let r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){let[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let a=(n=e==null?void 0:e.matchUpStatuses)==null?void 0:n.retired,o=["rtd",...Array.isArray(a)?a:[a].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function gje({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function vje({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function yje({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,a]=t.match(n).slice(1);t=[r,a].join("-")}return{score:t}}function Ije({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function bje({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let a of n.match(r)){let[o,s]=a.match(/(\d+) (\d+)/).slice(1);n=n.replace(a,`${o}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Mn(i))&&e.length===4&&(t=e)}return{score:t}}function wje({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var Sje={handleTiebreakSlashSeparation:Ije,handleSetSlashSeparation:vje,punctuationAdjustments:ije,handleGameSeparation:yje,joinFloatingTiebreak:rje,handleBracketSpacing:nje,handleSpaceSeparator:bje,separateScoreBlocks:pje,matchKnownPatterns:aje,removeDanglingBits:gje,removeErroneous:hje,handleWalkover:fje,properTiebreak:oje,handleNumeric:ame,handleRetired:mje,containedSets:sje,sensibleSets:lje,stringScore:uje,superSquare:cje,setBuilder:rme,excisions:wje,replaceOh:dje},EL={},Tje=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],Uje=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function sme(t){if(!t.score)return{error:Ie};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:a,fullLog:o,profile:s}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=Sje[v]({profile:s,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),a&&(o||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(Tje);let m=LY(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(Uje),m=LY(h),m||(h="")),u.forEach(g=>{EL[g]||(EL[g]=0),EL[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var lme={};Ht(lme,{analyzeSet:()=>FU,checkScoreHasValue:()=>zr,checkSetIsComplete:()=>hO,getSetComplement:()=>o4,getTiebreakComplement:()=>vO,isValidMatchUpFormat:()=>Zo,parseScoreString:()=>aN,validateScore:()=>a4,validateTieFormat:()=>Po});function Dje({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){let a=(r==null?void 0:r.sets)??[],o=((a==null?void 0:a.filter(b=>b==null?void 0:b.winningSide))||[]).reduce((b,D)=>{let{winningSide:w}=D;if(!w)return b;let S=w-1;return b[S]++,b},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&o[s],u=l!==void 0&&o[l],d=e?go(e):void 0,p=Math.max(...o),h=qo(o)[p],f=d==null?void 0:d.bestOf,m=f&&Math.ceil(f/2)||1,g=i??t,v=g&&[mi,Na,Ci].includes(g),y=!d||!a.length||a.every((b,D)=>{let w=D+1,S=w===f,U=w===a.length,{side1Score:C,side2Score:E,side1TiebreakScore:P,side2TiebreakScore:M,winningSide:N}=b,R=Math.max(C??0,E??0),A=P??M,{finalSetFormat:_,setFormat:O}=d,x=S&&_||O;if(A){let{tiebreakTo:F,NoAD:$}=(x==null?void 0:x.tiebreakFormat)||{},V=Math.max(P??0,M??0);if($&&V>F||V<F&&N&&(U&&!v||!U))return!1}return x.setTo?!(!x.noTiebreak&&R>x.setTo+1):!0}),I=(!e||p===m)&&h===1&&o.indexOf(p)+1||void 0;return{valid:y&&(n&&c>u&&n===I||!n&&!I||v)}}function a4({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Ie};let{sets:a,scoreStringSide1:o,scoreStringSide2:s}=r,l="scoreString must be a string!";if(o!==void 0&&typeof o!="string")return{error:Ie,info:l};if(s!==void 0&&typeof s!="string")return{error:Ie,info:l};if(a!==void 0&&!Array.isArray(a))return{error:Ie,info:Ed("sets")};if(a!=null&&a.length){let c=a.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==$t(c).length)return{error:Ie,info:"setNumbers not unique"};for(let d of a){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:I}=d;if(![[p,h],[f,m],[g,v]].filter(b=>b.some(D=>D!==void 0)).every(b=>b.every(D=>Rt(D))))return{error:Ie,info:"non-numeric values"};if(![I,y].filter(b=>b!==void 0).every(b=>Rt(b)))return{error:Ie,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Ie,info:"winningSide must be 1 or 2"}}let{valid:u}=Dje({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:Yce,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var o4=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:a}=t;if(i===void 0)return!1;let o=St(i);(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&r<n&&o>r&&(o=r);let s;return a&&!r?(o>n&&(s=n),s=o<n?n:n-1):s=o+1<n&&n||r&&r<n&&o===r&&n||!r&&o+2||n+1,[e?o:s,e?s:o]},vO=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let a=typeof i=="string"?parseInt(i):i;(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&a>n-1&&(a=n-1);let o=Pje({lowValue:a,NoAD:r,tiebreakTo:n});return[e?a:o,e?o:a]};function Pje(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function aN({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let a=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),o=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!a&&o.split("-").map(m=>parseInt(m)),l=a?a[0]>a[1]&&1||a[0]<a[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,u=(c&&vO({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[h,f]=a||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:h,side2TiebreakScore:f,winningSide:l,setNumber:r}}}function Cje({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=fO({set:n});return hO({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function FU(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:dk};let{setNumber:n}=e||{},{bestOf:r}=i||{},a=!!(n&&r&&n===r),o=a&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(o!=null&&o.tiebreakSet),l=!!(o!=null&&o.timed),c=!s&&!l,u=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],h=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=h.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=h==null?void 0:h.filter(_=>!isNaN(_)).length,{tiebreakAt:I}=o||{},b=I&&d.filter(_=>_>=I).length===2,D=b&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),w=!!(y&&!v),S=!!(e!=null&&e.winningSide),{error:U,result:C}=Eje({setObject:e,setFormat:o,sideGameScores:d,sideTiebreakScores:h}),{error:E,result:P}=Mje({setObject:e,setFormat:o,sideTiebreakScores:h}),M=c&&!w&&C||s&&w&&P,N=u&&!(s&&!w)&&!(c&&w)&&(!S||M),R=Cje({isDecidingSet:a,isTiebreakSet:w,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:b,isCompletedSet:S,isDecidingSet:a,isTiebreakSet:w,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:M,leadingSide:D,setFormat:o,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:R};return(e==null?void 0:e.winningSide)!==void 0&&(w?(A.isValidTiebreakSetOutcome=P,P||(A.tiebreakSetError=E)):(A.isValidStandardSetOutcome=C,C||(A.standardSetError=U))),A}function Eje({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:dk};let r=!!(e!=null&&e.tiebreakSet),a=!!(e!=null&&e.timed);if(!e||r||a)return{result:!1,error:Ie};if((i==null?void 0:i.filter(S=>!isNaN(S)).length)!==2)return{result:!1,error:eB};let{setTo:o,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(o&&i!=null&&i.find(S=>S>=o)))return{result:!1,error:eB};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:pk};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(S=>!isNaN(S)).length)===2,y=n==null?void 0:n[d],I=n==null?void 0:n[p],b=s&&i.filter(S=>S>=s).length===2;if(g){let{NoAD:S,tiebreakTo:U}=l;if(b){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&n!=null&&n.find(N=>N>=U)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let C=s<o?o:o+1;if(h>C)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!I||y<I)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=S?1:2,P=y-I,M=I>=U-1;if(P&&M&&P<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>o&&!b)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let D=c?1:2,w=f>=o-1;return m&&w&&!b&&m<D?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>D&&h>o?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function Mje({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:dk};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let a=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!a)return{result:!1,error:pk};let{tiebreakSet:o}=e||{},{NoAD:s,tiebreakTo:l}=o||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=s?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var cme={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},ume={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},dme={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},pme={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},hme={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},fme={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},mme={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},gme={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},vme={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},yme={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},Ime={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},bme={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},wme={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Sme={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},Tme={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Ume={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Dme={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},LB="COLLEGE_DEFAULT",FB="COLLEGE_JUCO",$B="COLLEGE_D3",Pme="DOMINANT_DUO",Cme="DOMINANT_DUO_MIXED",Eme="LAVER_CUP",Mme="TEAM_DOUBLES_3_AGGREGATION",Rme="TIME_TENNIS_DUAL",Nme="TIME_TENNIS_PRO_CIRCUIT",Ame="USTA_BREWER_CUP",_me="USTA_OZAKI_CUP",kme="USTA_COLLEGE",Ome="USTA_GOLD_TEAM_CHALLENGE",xme="USTA_LEVEL_1",Lme="USTA_INTERSECTIONAL",Fme="USTA_SECTION_BATTLE",$me="USTA_SOUTHERN_LEVEL_5",Bme="USTA_TOC",Vme="USTA_WTT_ITT",jme="USTA_ZONAL",Rje={COLLEGE_D3:$B,COLLEGE_DEFAULT:LB,COLLEGE_JUCO:FB,DOMINANT_DUO:Pme,DOMINANT_DUO_MIXED:Cme,LAVER_CUP:Eme,TEAM_DOUBLES_3_AGGREGATION:Mme,TIME_TENNIS_DUAL:Rme,TIME_TENNIS_PRO_CIRCUIT:Nme,USTA_BREWER_CUP:Ame,USTA_OZAKI_CUP:_me,USTA_COLLEGE:kme,USTA_GOLD_TEAM_CHALLENGE:Ome,USTA_INTERSECTIONAL:Lme,USTA_LEVEL_1:xme,USTA_SECTION_BATTLE:Fme,USTA_SOUTHERN_LEVEL_5:$me,USTA_TOC:Bme,USTA_WTT_ITT:Vme,USTA_ZONAL:jme},Gme="STANDARD",$Y={[Gme]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[$B]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:xs,matchUpCount:6,matchUpValue:1},tieFormatName:$B,valueGoal:5},[LB]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:xs},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:xs},tieFormatName:LB,valueGoal:4},[FB]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:xs},tieFormatName:FB,valueGoal:5},[Eme]:Ume,[Pme]:Ime,[Cme]:mme,[Mme]:ume,[Rme]:gme,[Nme]:fme,[Ame]:vme,[_me]:yme,[kme]:bme,[Ome]:cme,[Lme]:hme,[xme]:wme,[Fme]:pme,[$me]:dme,[Vme]:Sme,[Bme]:Dme,[jme]:Tme},Nje=t=>{let e=t!=null&&t.namedFormat&&Object.keys($Y).includes(t.namedFormat)?t.namedFormat:Gme,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:a}=(t==null?void 0:t.event)??{},o=ot($Y[e],!1,!0),s=l=>{var c,u;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??xi();let d=(u=t==null?void 0:t.event)==null?void 0:u.eventId;return i.pop()??`${d}-COL-${l+1}`};return o.hydrate?(n={winCriteria:{valueGoal:o.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:whe,collectionName:"Doubles",matchUpType:qi,...o.doubles},{collectionId:s(1),matchUpFormat:xs,collectionName:"Singles",matchUpType:Un,...o.singles}]},o.tieFormatName&&(n.tieFormatName=o.tieFormatName)):(o.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),n=o),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),a&&!l.gender&&(l.gender=a)}),n},my=Nje;function Aje(t){var e,i,n;let{existingDrawDefinition:r,hydrateCollections:a,enforceGender:o,tieFormatName:s,matchUpType:l,eventType:c,isMock:u,event:d}=t,{tieFormat:p,matchUpFormat:h}=t;if(l===Ur&&c===Ur){let f=(i=(e=r==null?void 0:r.structures)==null?void 0:e.find(({stage:m})=>m===nt))==null?void 0:i.tieFormat;p=p||f||s&&((n=d==null?void 0:d.tieFormat)==null?void 0:n.tieFormatName)===s&&d.tieFormat||s&&my({namedFormat:s,hydrateCollections:a,isMock:u,event:d})||(d==null?void 0:d.tieFormat)||my({event:d,isMock:u,hydrateCollections:a}),h=void 0}else h||(p=void 0,d!=null&&d.matchUpFormat||(h=xs));if(p){let f=Po({gender:d==null?void 0:d.gender,enforceGender:o,tieFormat:p});if(f.error)return f}return{tieFormat:p,matchUpFormat:h}}function _je(t){var e,i,n,r,a;let o=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,drawEntries:l,appliedPolicies:c,structureId:u,idPrefix:d,isMock:p}=t,h=t.qualifyingProfiles,f=h!=null&&h.length?ofe({uuids:t.uuids,qualifyingProfiles:h,appliedPolicies:c,idPrefix:d,isMock:p}):void 0;if(f!=null&&f.error)return f;o.structures=(e=o.structures)==null?void 0:e.filter(({structureId:S})=>S!==s),o.links=(i=o.links)==null?void 0:i.filter(({source:S})=>S.structureId!==s);let{qualifiersCount:m,qualifyingDrawPositionsCount:g,qualifyingDetails:v}=f??{};g&&(f!=null&&f.structures&&((n=o.structures)==null||n.push(...f.structures)),f!=null&&f.links&&((r=o.links)==null||r.push(...f.links)));let y=(a=o.structures)==null?void 0:a.find(({stage:S,stageSequence:U})=>S===nt&&U===1),{qualifiersCount:I}=Q0({stageSequence:1,drawDefinition:o,structureId:u,stage:nt}),b=Math.max(m??0,I??0),D=dhe({qualifiersCount:b,drawDefinition:o,stage:nt});if(D.error||(D=JR({drawSize:g,stage:gt,drawDefinition:o}),D.error))return D;kje({drawDefinition:o,drawEntries:l});let w=Oje({mainStructure:y,qualifyingDetails:v,drawDefinition:o});return w.error?w:{drawDefinition:o,structureId:u}}function kje({drawDefinition:t,drawEntries:e}){for(let i of(e??[]).filter(({entryStage:n})=>n===gt)){let n={...i,entryStage:i.entryStage??nt,drawDefinition:t};Cpe(n)}}function Oje({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:a,finalQualifyingStructureId:o,roundTarget:s,finishingPositions:l,linkType:c}=r,u=t&&((n=EC({targetStructureId:t.structureId,sourceStructureId:o,sourceRoundNumber:a,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function Hme(t){var e,i;let{participantIds:n}=t,r=((i=(e=t.drawDefinition)==null?void 0:e.entries)==null?void 0:i.filter(a=>{let o=a.entryStatus;return!t.restrictEntryStatus||Yl.includes(o)}).map(Yt))??[];if(n){let a=n.filter(o=>!(r!=null&&r.includes(o)));if(a!=null&&a.length)return oe({result:{error:hu},info:{invalidParticipantIds:a}})}else n=r;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>n.length-1&&(!t.enableDoubleRobin||t.roundsCount>(n.length-1)*2)?{error:Ie,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Ie,info:"roundsCount must be less than 32"}:{participantIds:n}}function s4(t){var e;let i=[],{roundsCount:n=1,drawDefinition:r,matchUpsCount:a,structureId:o,idPrefix:s,isMock:l,event:c}=t,u,d=Hme(t);if(d.error)return d;for(let p of Xe(1,n+1)){let h=uO({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!u,newRound:!u,drawDefinition:r,matchUpsCount:a,structureId:o,roundNumber:u,idPrefix:s,isMock:l,event:c});if(h.error)return oe({result:h,info:{iteration:p}});(e=h.matchUps)!=null&&e.length&&i.push(...h.matchUps),u=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:i}}function xje(t){var e;let{tournamentRecord:i,participantIds:n,scaleName:r,eventType:a,adHocRatings:o={}}=t,s=t.scaleAccessor??((e=rs[r])==null?void 0:e.accessor),l=i.participants??[];for(let c of n??[]){let u=l==null?void 0:l.find(p=>p.participantId===c),d=BY({scaleName:`${r}.${ede}`,participant:u,eventType:a});!d&&r&&(d=BY({scaleAccessor:s,participant:u,scaleName:r,eventType:a})),d&&!o[c]&&(o[c]=d)}return o}function BY({scaleType:t=Tm,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var a,o;let s=(o=(a=i&&td({scaleAttributes:{eventType:r??uy,scaleType:t,scaleName:n},participant:i}))==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&on(s)?s[e]:s}function l4(t){var e,i;let n=Fje(t);if(n!=null&&n.error)return n;let r=Hme(t);if(r.error)return r;let a=Lje(t);if(a.error)return a;let o=xje(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),c=[],u=[],d;for(let p of Xe(1,(t.roundsCount??1)+1)){let h=Jq({...t,participantIds:r.participantIds,structure:a.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:o,roundNumber:d,eventType:l,isMock:s});if(h.error)return h;let{matchUps:f,...m}=h;u.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),d=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&c.push(...f)}return{...re,matchUps:c,roundResults:u}}function Lje(t){var e,i,n;if(t.structureId)return t.structureId;let r=t.drawDefinition,a=(i=(e=r==null?void 0:r.structures)==null?void 0:e.filter(s=>s.stageSequence===1))==null?void 0:i.reduce((s,l)=>{let c=l.stage&&cy[l.stage];return Yo({structure:l})&&c>(cy[s==null?void 0:s.stage]||1)?l:s},void 0),o=(n=r==null?void 0:r.structures)==null?void 0:n.find(s=>s.structureId===(a==null?void 0:a.structureId));return o?Yo({structure:o})?{structure:o}:{error:Cv}:{error:wn}}function Fje(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Ie,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==Ol?{error:Cv}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Ie,info:"Missing Entries"}:{error:void 0}}function $je(t){var e,i;let{tournamentRecord:n,drawDefinition:r,structureId:a,idPrefix:o,isMock:s,event:l}=t,c=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:h})=>(!p||p===nt)&&h&&Yl.includes(h)),u=c==null?void 0:c.map(Yt),d=c?Math.floor(c.length/2):0;if(t.automated)return Bje({...t,participantIds:u});{let p=s4({roundsCount:t.roundsCount,drawDefinition:r,matchUpsCount:d,idPrefix:o,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&aO({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:a,event:l})}return{...re}}function Bje(t){var e,i;let{restrictEntryStatus:n,generateMatchUps:r,structureId:a,matchUpIds:o,scaleName:s,scaleAccessor:l}=t.drawMatic??{},c=l4({...t,eventType:((e=t.drawMatic)==null?void 0:e.eventType)??t.matchUpType,generateMatchUps:r??!0,scaleAccessor:l??t.scaleAccessor,scaleName:s??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:n,structureId:a,matchUpIds:o});return c.error?c:((i=c==null?void 0:c.matchUps)!=null&&i.length&&aO({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:c.matchUps,event:t.event,structureId:a}),{...re})}function Vje({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,seedsCount:c}){var u,d;n=n??r;let p=Dt({drawDefinition:o,structureId:l});if(p.error)return p;let h=p.structure;if(!h)return{error:wn};let{positionAssignments:f}=Rr({structure:h}),m=(f==null?void 0:f.length)||0;if(c>m)return{error:Ece};let g=(u=h.structures)==null?void 0:u.length,v=Rt(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),y=(d=mq({roundRobinGroupsCount:g,drawSize:m}))==null?void 0:d.seedGroups,{seedsCount:I}=$C({policyDefinitions:a,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:m});return I&&a!=null&&a[fl]&&c>I&&e&&(c=I),h.seedLimit=c,h.seedAssignments=Xe(1,c+1).map(b=>{let D=y==null?void 0:y.find(U=>U.includes(b)),w=D&&Math.min(...D),S=v&&b>=v?w:b;return{participantId:void 0,seedNumber:b,seedValue:S}}),Ji({drawDefinition:o,structureIds:[l]}),{...re,seedLimit:c}}function II({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:a,event:o,stage:s}){if(!e)return{error:Ne};return a=a??(o==null?void 0:o.entries)??[],{scaledEntries:a.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&Yl.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=Tw({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function zme(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=Pd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],a=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!a)return oe({result:{error:wn},stack:e});let o=a==null?void 0:a.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=Yje({...t,structureId:o});(t.seededParticipants||t.event||t.seedingScaleName)&&Hje({...t,seedsCount:s,structure:a,structureId:o});let u=t.automated!==!1&&t.drawType!==Ol&&!(t.qualifyingOnly&&t.stage!==gt),d=((n==null?void 0:n.length)||0)>1,p=u?Gje({...t,multipleStructures:d,seedLimit:c,structureId:o}):{};return p!=null&&p.error?oe({result:p,stack:e}):{...p,stageEntries:l,structureId:o,seedsCount:s}}function jje({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var a,o;let s=(o=(a=jt({name:Cu,element:r}))==null?void 0:a.extension)==null?void 0:o.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!s||s===n)&&Mg.includes(r.entryStatus)})}function Gje(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=PC({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function Hje(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,a=n.map(Yt);e?zje({...t,enteredParticipantIds:a}):(r||i)&&Wje({...t,enteredParticipantIds:a})}function zje(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?mI({provisionalPositioning:e,appliedPolicies:a,drawDefinition:o,seedingProfile:s,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;tS({provisionalPositioning:e,tournamentRecord:r,drawDefinition:o,seedingProfile:s,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function Wje(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:a,tournamentRecord:o,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=qje({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&Kje({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,a||e).forEach((v,y)=>{let I=y+1,{participantId:b,scaleValue:D}=v,w=(r==null?void 0:r[I])||D||I;tS({provisionalPositioning:i,tournamentRecord:o,drawDefinition:s,seedingProfile:c,participantId:b,structureId:u,seedNumber:I,seedValue:w,event:d})})}function qje(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:a,event:o}=t,{categoryName:s,ageCategoryCode:l}=(o==null?void 0:o.category)||{},c=o==null?void 0:o.eventType,u={scaleName:i||s||l||o.eventId,scaleType:Qu,eventType:c};return II({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:a}).scaledEntries}function Kje(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:a}=t,{categoryName:o,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return II({scaleAttributes:{scaleName:o||s,scaleType:Qh,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:a}).scaledEntries}function Yje(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=jje(t);e>i.length&&(e=i.length);let{seedLimit:n}=Vje({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function Zje(t){var e;let i=Zq({...t,modifyOriginal:!1});if(i.error)return i;let n=i.drawDefinition,{ignoreStageSpace:r,appliedPolicies:a,qualifyingOnly:o,seedingProfile:s,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[],m=[],g=Xje({ignoreStageSpace:r,drawDefinition:n,drawEntries:c,drawType:p,entries:h});if(g.error)return g;let v=p===Pg?0:St(t.seedsCount??0),y=zme({...t,qualifyingOnly:!d||o,appliedPolicies:a,drawDefinition:n,seedingProfile:s,participants:l,stage:nt,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;(e=y.positioningReport)!=null&&e.length&&f.push({[nt]:y.positioningReport});let I=y.structureId;return y.conflicts&&(m=y.conflicts),p===Ol&&t.roundsCount&&$je({...t,drawDefinition:n,structureId:I}),{drawDefinition:n,positioningReports:f,conflicts:m,structureId:I}}function Xje(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:a}=t;for(let o of a){if(n&&o.entryStage&&o.entryStage!==nt)continue;let s={...o,ignoreStageSpace:e??r===Ol,entryStage:o.entryStage??nt,drawDefinition:i,drawType:r},l=Cpe(s);if(n&&l.error)return l}return{error:void 0}}var Jje=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),Qje=Jje;function eGe(t){let{drawId:e=xi(),processCodes:i,matchUpType:n,drawType:r}=t??{},a=Qje();return Object.assign(a,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function c4(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:a,matchUpId:o,event:s}=t,l=vi(t,[{[$c]:!0,[i3]:!0}]);if(l.error)return l;if(!Zo({matchUpFormat:r}))return{error:BP};let c="setMatchUpFormat";if(o){let u=an({drawDefinition:n,matchUpId:o,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===Ur)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:uo};d&&(d.matchUpFormat=r,si({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===Ur)return{error:Jh};for(let u of e){let d=Dt({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(a){if((s==null?void 0:s.eventType)===Ur)return{error:Jh};let u=Dt({drawDefinition:n,structureId:a});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(a?[a]:void 0),Ji({drawDefinition:n,structureIds:e}),{...re}}function tGe({tieFormat:t}){let e=Po({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=xi());return{tieFormat:t}}function iGe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:a}){if((i||r)&&!(i&&(a==null?void 0:a.matchUpFormat)===i||a!=null&&a.tieFormat&&r&&JSON.stringify(a.tieFormat)===JSON.stringify(r))){if(r){let o=tGe({tieFormat:r});if(o.error)return o;e.tieFormat=o.tieFormat??r}else if(i){let o=c4({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:a});if(o.error)return{info:"matchUpFormat or tieFormat error",error:o.error}}n&&(e.matchUpType=n)}return{error:void 0}}var Wme={};Ht(Wme,{attachPolicies:()=>Xm,findPolicy:()=>Rg,getAppliedPolicies:()=>Mi,getPolicyDefinitions:()=>Xp,mutate:()=>qme,query:()=>Yme,removePolicy:()=>Kme});var qme={};Ht(qme,{attachPolicies:()=>Xm,removePolicy:()=>Kme});function Kme(t){let e=vi(t,[{[ULe]:!0,_anyOf:{[Ta]:!1,[Ad]:!1,[$c]:!1,[$0]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return VY(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Ne};for(let a of r){let o=t.tournamentRecords[a],s=VY(t,o);if(s.error)return s;i=!0}}else return{error:Ne};return i?{...re}:{error:sw}}function VY(t,e){let i=Mi(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?ui({element:e,extension:{name:UU,value:i}}):Va({element:e,name:UU}),{...re}):{error:sw}}var Yme={};Ht(Yme,{findPolicy:()=>Rg,getAppliedPolicies:()=>Mi,getPolicyDefinitions:()=>Xp});var Zme={[fl]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Dd]:{positioning:Gm},[xl]:{positioning:Gm}},positioning:pFe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},BB=Zme;function nGe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return oe({info:"policyDefinitions must be an object",result:{error:Ie},stack:n});let r={[TU]:t==null?void 0:t[TU]};return e?rGe({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&Xm({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[fl])&&!(e!=null&&e[fl])&&(Xm({policyDefinitions:BB,drawDefinition:i}),t&&Object.assign(t,BB)),{error:void 0}}function rGe({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(Xm({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function aGe(t){var e,i,n,r,a;let{tournamentRecord:o,matchUpFormat:s,appliedPolicies:l,policyDefinitions:c,matchUpType:u,tieFormat:d,drawType:p,stack:h,event:f}=t,m=t.drawId?(e=f==null?void 0:f.drawDefinitions)==null?void 0:e.find(w=>w.drawId===t.drawId):void 0;m&&p!==m.drawType&&(m.drawType=p);let g=m??eGe({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=iGe({tournamentRecord:o,drawDefinition:g,matchUpFormat:s,matchUpType:u,tieFormat:d,event:f});if(v.error)return oe({result:v,stack:h});let y=nGe({appliedPolicies:l,policyDefinitions:c,drawDefinition:g,stack:h});if(y.error)return y;let I=(n=(i=m==null?void 0:m.structures)==null?void 0:i.find(w=>w.stage===nt&&w.stageSequence===1))==null?void 0:n.structureId,b=m?(r=m.structures)==null?void 0:r.filter(w=>w.stage===gt):[],D=(b==null?void 0:b.length)===1&&!((a=b[0].matchUps)!=null&&a.length)&&b[0].structureId;return{drawDefinition:g,structureId:I,existingDrawDefinition:m,existingQualifyingPlaceholderStructureId:D}}function oGe(t){var e,i;let n="generateOrGetExisting",r=[],a=[],o=aGe(t);if(o.error)return oe({result:o,stack:n});let s=o.existingDrawDefinition,l=o.drawDefinition??{},c=o.structureId,u=t.drawEntries??t.eventEntries??[],d=o.existingQualifyingPlaceholderStructureId&&_je({...t,...o})||Zje({...t,...o,entries:u});return d.error?oe({result:d,stack:n}):((e=d.positioningReports)!=null&&e.length&&r.push(...d.positioningReports??[]),(i=d.conflicts)!=null&&i.length&&a.push(...d.conflicts??[]),l=d.drawDefinition,c=d.structureId,{existingDrawDefinition:s,positioningReports:r,drawDefinition:l,structureId:c,conflicts:a,entries:u})}function sGe(t){var e,i,n;let{qualifyingPlaceholder:r,qualifyingProfiles:a,existingDrawDefinition:o,positioningReports:s,appliedPolicies:l,qualifyingOnly:c,drawDefinition:u,seedingProfile:d,participants:p,structureId:h,entries:f,stack:m}=t,g=r&&!(a!=null&&a.length)&&!o,v=[];if(a){let y=(w,S)=>w.stageSequence-S.stageSequence,I=(w,S)=>w.roundTarget-S.roundTarget,b=[],D=1;a.sort(I);for(let w of a){if(!Array.isArray(w.structureProfiles))return oe({info:Ed("structureProfiles"),result:{error:dt},stack:m});D=w.roundTarget||D;let S=((e=w.structureProfiles)==null?void 0:e.sort(y))||[],U=1;for(let C of S){let{qualifyingRoundNumber:E,qualifyingPositions:P,seededParticipants:M,seedingScaleName:N,seedsCount:R=0,seedByRanking:A,placeByes:_,drawSize:O}=C,x=zme({...t,seedingProfile:C.seedingProfile??d,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:b,qualifyingPositions:P,seededParticipants:M,stage:gt,seedingScaleName:N,appliedPolicies:l,drawDefinition:u,qualifyingOnly:c,seedByRanking:A,participants:p,roundTarget:D,seedsCount:R,placeByes:_,drawSize:O,entries:f});if(x.error)return x;x.structureId&&b.push(x.structureId),U+=1,(i=x.conflicts)!=null&&i.length&&v.push(...x.conflicts),(n=x.positioningReport)!=null&&n.length&&s.push({[gt]:x.positioningReport})}D+=1}}else if(h&&g){let y=Os({structureName:ia(gt),stage:gt}),{link:I}=EC({sourceStructureId:y.structureId,targetStructureId:h,sourceRoundNumber:0,linkType:Cp});u.structures||(u.structures=[]),u.structures.push(y),u.links||(u.links=[]),u.links.push(I)}return{qualifyingConflicts:v,error:void 0}}var Xme={};Ht(Xme,{addGoesTo:()=>Zm,allCompetitionMatchUps:()=>Nc,allDrawMatchUps:()=>ro,allEventMatchUps:()=>eh,allPlayoffPositionsFilled:()=>Sq,allTournamentMatchUps:()=>Hr,analyzeDraws:()=>LC,analyzeMatchUp:()=>BU,analyzeTournament:()=>y4,bulkUpdatePublishedEventIds:()=>w4,calculateWinCriteria:()=>wI,categoryCanContain:()=>iO,checkMatchUpIsComplete:()=>Um,checkValidEntries:()=>cO,compareTieFormats:()=>_p,competitionScheduleMatchUps:()=>HC,credits:()=>lGe,drawMatchUps:()=>O4,eventMatchUps:()=>EO,filterParticipants:()=>wC,findDrawDefinition:()=>Bq,findExtension:()=>jt,getAllDrawMatchUps:()=>lr,getAllEventData:()=>S4,getAllStructureMatchUps:()=>Ui,getAllowedDrawTypes:()=>yO,getAllowedMatchUpFormats:()=>m4,getAppliedPolicies:()=>Mi,getAssignedParticipantIds:()=>Og,getAvailableMatchUpsCount:()=>oO,getAvailablePlayoffProfiles:()=>MC,getCategoryAgeDetails:()=>_C,getCheckedInParticipantIds:()=>cI,getCompetitionDateRange:()=>bO,getCompetitionMatchUps:()=>$U,getCompetitionParticipants:()=>u4,getCompetitionPenalties:()=>g4,getCompetitionVenues:()=>BC,getCourtInfo:()=>Vk,getCourts:()=>x4,getDrawData:()=>wO,getDrawDefinitionTimeItem:()=>iq,getDrawParticipantRepresentativeIds:()=>Fq,getDrawTypeCoercion:()=>FC,getEligibleVoluntaryConsolationParticipants:()=>Lq,getEntriesAndSeedsCount:()=>PO,getEvent:()=>$4,getEventData:()=>SO,getEventMatchUpFormatTiming:()=>P4,getEventProperties:()=>L4,getEventPublishStatus:()=>tl,getEventStructures:()=>Zk,getEventTimeItem:()=>gC,getEvents:()=>F4,getFlightProfile:()=>Vn,getLinkedTournamentIds:()=>XP,getMatchUpCompetitiveProfile:()=>dC,getMatchUpContextIds:()=>N4,getMatchUpDailyLimits:()=>RO,getMatchUpDailyLimitsUpdate:()=>C4,getMatchUpDependencies:()=>Xl,getMatchUpFormat:()=>A4,getMatchUpFormatTiming:()=>hC,getMatchUpFormatTimingUpdate:()=>D4,getMatchUpScheduleDetails:()=>jk,getMatchUpType:()=>Gk,getMatchUpsMap:()=>da,getMatchUpsStats:()=>_4,getMaxEntryPosition:()=>U4,getModifiedMatchUpFormatTiming:()=>CO,getPairedParticipant:()=>Fl,getParticipantEventDetails:()=>d4,getParticipantIdFinishingPositions:()=>$q,getParticipantMembership:()=>p4,getParticipantResults:()=>AC,getParticipantScaleItem:()=>Tw,getParticipantSchedules:()=>h4,getParticipantSignInStatus:()=>f4,getParticipantTimeItem:()=>nq,getParticipants:()=>$n,getPersonRequests:()=>Fg,getPolicyDefinitions:()=>Xp,getPositionAssignments:()=>xU,getPositionsPlayedOff:()=>iS,getPredictiveAccuracy:()=>R4,getProfileRounds:()=>DO,getPublishState:()=>hI,getRoundMatchUps:()=>Za,getRounds:()=>k4,getScaleValues:()=>B0,getScaledEntries:()=>II,getScheduledRoundsDetails:()=>VC,getSchedulingProfile:()=>nh,getSchedulingProfileIssues:()=>T4,getSeedingThresholds:()=>gq,getSeedsCount:()=>$C,getStructureSeedAssignments:()=>Ks,getTeamLineUp:()=>Ym,getTieFormat:()=>b4,getTimeItem:()=>Mu,getTournamentIds:()=>YP,getTournamentInfo:()=>bI,getTournamentPenalties:()=>IO,getTournamentPersons:()=>v4,getTournamentStructures:()=>wq,getTournamentTimeItem:()=>vC,getValidGroupSizes:()=>UC,getVenueData:()=>bw,getVenuesAndCourts:()=>ih,isAdHoc:()=>Yo,isCompletedStructure:()=>sf,isValidForQualifying:()=>Kq,isValidMatchUpFormat:()=>Zo,matchUpActions:()=>lO,participantScaleItem:()=>td,participantScheduledMatchUps:()=>E4,positionActions:()=>qq,publicFindVenue:()=>X3,tallyParticipantResults:()=>nS,tieFormatGenderValidityCheck:()=>eO,tournamentMatchUps:()=>MO,validMatchUp:()=>$k,validMatchUps:()=>el,validateCollectionDefinition:()=>kC,validateLineUp:()=>Yk});function lGe(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Jme={};Ht(Jme,{filterParticipants:()=>wC,getCompetitionParticipants:()=>u4,getPairedParticipant:()=>Fl,getParticipantEventDetails:()=>d4,getParticipantMembership:()=>p4,getParticipantScaleItem:()=>Tw,getParticipantSchedules:()=>h4,getParticipantSignInStatus:()=>f4,getParticipantTimeItem:()=>nq,getParticipants:()=>$n,getScaleValues:()=>B0,participantScaleItem:()=>td,validateLineUp:()=>Yk});function u4(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Cn};let i=[],n={},r={},a={},o=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=$n({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(a,g),i.push(...h??[]),o.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:a,participantMap:n,mappedMatchUps:s,participants:i,...re,matchUps:o}}function d4({tournamentRecord:t,participantId:e}){if(!t)return{error:Ne};if(!e)return{error:vr};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[Gi,Ot].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(a=>a.participantId);return Ya(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function p4({tournamentRecord:t,participantId:e}){if(!t)return{error:Ne};if(!e)return{error:vr};let{participants:i}=$n({participantFilters:{participantTypes:[Gi,Ot,bs]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let a=r.participantType;return a&&(n[a]||(n[a]=[]),n[a].push(r)),n},{})}function h4({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Ne};if(typeof t!="object")return{error:Kp,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=Hr({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),a=n.filter(({schedule:l})=>l&&Object.keys(l).length),o=Xl({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of a){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);o[l.matchUpId]&&!u&&(u=(o[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...re}}function f4({tournamentRecord:t,participantId:e}){if(!t)return{error:Ne};if(!e)return{error:vr};let{participant:i}=kg({tournamentRecord:t,participantId:e});if(!i)return{error:Gn};let{timeItem:n}=Mu({itemType:nC,element:i});return n&&n.itemValue===RU&&RU}var Qme={};Ht(Qme,{analyzeDraws:()=>LC,analyzeTournament:()=>y4,getAllowedDrawTypes:()=>yO,getAllowedMatchUpFormats:()=>m4,getAppliedPolicies:()=>Mi,getCompetitionDateRange:()=>bO,getCompetitionPenalties:()=>g4,getPolicyDefinitions:()=>Xp,getTournamentInfo:()=>bI,getTournamentPenalties:()=>IO,getTournamentPersons:()=>v4,getTournamentStructures:()=>wq,getTournamentTimeItem:()=>vC});function m4({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:Ne};let{appliedPolicies:r}=Mi({tournamentRecord:t});return(((n=r==null?void 0:r[Sd])==null?void 0:n.matchUpFormats)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function yO({tournamentRecord:t,categoryName:e,categoryType:i}){var n;if(!t)return{error:Ne};let{appliedPolicies:r}=Mi({tournamentRecord:t});return(((n=r==null?void 0:r[$R])==null?void 0:n.allowedDrawTypes)||[]).filter(({categoryNames:a,categoryTypes:o})=>!e&&!o||e&&(a==null?void 0:a.includes(e))||i&&(o==null?void 0:o.includes(i)))}function IO({tournamentRecord:t}){if(!t)return{error:Ne};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(a=>{let{penaltyId:o}=a||{};i[o]?i[o].participants.push(r):i[o]={...a,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function g4({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let e=[];for(let i of Object.values(t)){let{penalties:n}=IO({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function ege({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:a,matchUpFormat:o,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var cGe={[j0]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},uGe=cGe;function bI(t){var e,i,n,r;let{tournamentRecord:a}=t??{};if(!a)return{error:Ne};let o=(({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:I,hostCountryCode:b,venues:D,notes:w,updatedAt:S})=>({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:I,hostCountryCode:b,venues:D,notes:w,updatedAt:S}))(a),s=$n({participantFilters:{participantRoles:[Mpe,lq,Rpe,Npe,_pe]},policyDefinitions:uGe,tournamentRecord:a}).participants;s&&(o.tournamentContacts=s);let l=((r=(n=(i=(e=hI({tournamentRecord:a}))==null?void 0:e.publishState)==null?void 0:i.tournament)==null?void 0:n.status)==null?void 0:r.publishedEventIds)||[],c=[];for(let u of a.events??[])if(!(t!=null&&t.usePublishState)||l.includes(u.eventId)){let d=ege({event:u}).eventInfo;d&&c.push(d)}return o.eventInfo=c,{tournamentInfo:ot(o,!1,!0),...re}}function bO({tournamentRecords:t}){if(!on(t))return{error:Cn};let e=Object.keys(t??{}).reduce((r,a)=>{let o=t[a],{tournamentInfo:{startDate:s,endDate:l}}=bI({tournamentRecord:o}),c=s&&new Date(Lt(s));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(Lt(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Lt(e.startDate.toISOString()),n=e.endDate&&Lt(e.endDate.toISOString());return!i||!n?{error:zce}:{startDate:i,endDate:n}}function v4({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Ne};let i=t.participants||[];e&&(i=wC({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=a=>{if(a.person){let{personId:o}=a.person;n[o]?n[o].participantIds.push(a.participantId):n[o]={...a.person,participantIds:[a.participantId]}}};return i.forEach(a=>{a.person&&r(a)}),{tournamentPersons:Object.values(n)}}function dGe(t){var e,i,n,r,a,o,s;let l=((i=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===Gi))==null?void 0:i.length)===2,c=((n=t.events)==null?void 0:n.length)===1&&t.events[0],u=((r=c==null?void 0:c.drawDefinitions)==null?void 0:r.length)===1&&c.drawDefinitions[0],d=((s=(o=((a=u==null?void 0:u.structures)==null?void 0:a.length)===1&&u.structures[0])==null?void 0:o.positionAssignments)==null?void 0:s.length)===2;return!!(c.tieFormat&&l&&d)}function y4({tournamentRecord:t}){if(!t)return{error:Ne};let{drawsAnalysis:e}=LC({tournamentRecord:t}),i={isDual:dGe(t),drawsAnalysis:e};return{...re,analysis:i}}var tge={};Ht(tge,{compareTieFormats:()=>_p,getTieFormat:()=>b4,tieFormatGenderValidityCheck:()=>eO,validateCollectionDefinition:()=>kC});function oN(t){var e;if(!t)return{};let i=[],n=t.tieFormatName,r=(e=t.collectionDefinitions)==null?void 0:e.map(a=>{let{matchUpType:o,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=a;i.includes(s)||i.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,o===zm?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function _p({considerations:t={},descendant:e,ancestor:i}){var n,r;let a={},o={},{matchUpFormats:s,tieFormatDesc:l}=oN(e),{matchUpFormats:c,tieFormatDesc:u}=oN(i),d=$t((s??[]).filter(S=>!(c??[]).includes(S)).concat((c??[]).filter(S=>!(s??[]).includes(S)))),p=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionName:S})=>S).join("|")),h=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")!==i.collectionDefinitions.map(({collectionOrder:S})=>S).join("|")),f=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(S=>({[S.collectionId]:S})));a.collectionIds=lY(Object.keys(f),Object.keys(m)),o.collectionIds=lY(Object.keys(m),Object.keys(f)),a.collectionsValue=jY(f),o.collectionsValue=jY(m),a.groupsCount=((n=i==null?void 0:i.collectionGroups)==null?void 0:n.length)??(0-(((r=e==null?void 0:e.collectionGroups)==null?void 0:r.length)??0)||0),o.groupsCount=a.groupsCount?-1*a.groupsCount:0;let g=a.collectionsValue.totalValue-o.collectionsValue.totalValue,v=a.collectionsValue.totalMatchUps-o.collectionsValue.totalMatchUps,y=o.collectionsValue.assignmentValues.length!==a.collectionsValue.assignmentValues.length,I=o.collectionsValue.assignmentValues.some((S,U)=>{let C=a.collectionsValue.assignmentValues[U];return!C||S.valueKey!==C.valueKey||S.value!==C.value?!0:Array.isArray(S.value)?S.value.every((E,P)=>C.value[P]===E):!1}),b=p||h||u!==l||y||I||g!==0,D=[...o.collectionsValue.invalidValues,...a.collectionsValue.invalidValues],w=D.length&&D;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:a,ancestorDifferences:o,orderDifference:h,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:u,...re,different:b,invalid:w}}function jY(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(Wk).reduce((r,a)=>{let o=t[a],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,h={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g]));f.length!==1&&e.push({collectionId:a});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):h[m];i.push({valueKey:m,value:g})}return n+=c,s?r+s.reduce((g,v)=>g+v.value,0):c?Rt(u)?r+u*c:Rt(d)?r+d*c:Rt(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function I4(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=ige(t);return{matchUp:ot(e,!0,!0),error:i}}function ige({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var p;if(!i)return{error:Ne};if(typeof s!="string")return{error:ua};if(!a||!d){let m=(Hr({tournamentRecord:i,nextMatchUps:o}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:wa};({eventId:c,drawId:u}=m),{event:d,drawDefinition:a}=po({tournamentRecord:i,eventId:c,drawId:u})}if(!a)return{error:zo};r&&!n&&(n=Qp({tournamentRecord:i,contextProfile:r}));let h={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:f=[]}=dI({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(o){let m=(ro({context:l?h:void 0,participants:f,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:a,nextMatchUps:o,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:wa};let g=(p=a==null?void 0:a.structures)==null?void 0:p.find(v=>v.structureId===m.structureId);return{drawDefinition:a,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=an({context:l?h:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:n,drawDefinition:a,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:a}}}function b4({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:a,drawId:o,event:s}){var l,c,u,d,p;if(!t)return{error:Ne};if(!o&&!s&&!i&&!n)return oe({result:{error:dt},stack:"getTieFormat"});a&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===a));let h=I4({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:o,event:s});if(n&&h!=null&&h.error)return h;if(!e&&h!=null&&h.drawDefinition&&(e=h==null?void 0:h.drawDefinition),r=r??(h==null?void 0:h.structure),!r&&i&&!n){if(!e)return{error:Fc};let y=Dt({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let f=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((c=Ea({structure:r,drawDefinition:e,event:s}))==null?void 0:c.tieFormat),m=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((u=Ea({drawDefinition:e,event:s}))==null?void 0:u.tieFormat),g=(d=Ea({event:s}))==null?void 0:d.tieFormat,v=(p=Ea({matchUp:h==null?void 0:h.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:p.tieFormat;return{...re,matchUp:h==null?void 0:h.matchUp,structureDefaultTieFormat:Jr(f),eventDefaultTieFormat:Jr(g),drawDefaultTieFormat:Jr(m),tieFormat:Jr(v),structure:r}}var nge={};Ht(nge,{bulkUpdatePublishedEventIds:()=>w4,getAllEventData:()=>S4,getCourtInfo:()=>Vk,getDrawData:()=>wO,getEventData:()=>SO,getEventPublishStatus:()=>tl,getPublishState:()=>hI,getVenueData:()=>bw});function w4({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:Ne};if(!(e!=null&&e.length))return{error:dt,info:"Missing outcomes"};let n=e.reduce((a,o)=>{let{drawId:s,eventId:l}=o;return l&&s&&(a[l]?a[l].includes(s)||a[l].push(s):a[l]=[s]),a},{}),r=Object.keys(n);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(a=>r.includes(a.eventId))).filter(a=>{let o=tl({event:a}),{drawDetails:s,drawIds:l}=o??{},{eventId:c}=a;return n[c].filter(u=>{let d=s?Object.keys(o.drawDetails).filter(p=>oq({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(a=>a.eventId),eventIdPublishedDrawIdsMap:n}}function rge({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let n=on(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(n))return n!=null&&n.length?!!n.filter(r=>!t.length||t.includes(r)).length:!1}function age({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var r;let a={...ot(n,t,!0),venueId:i.venueId},{extension:o}=jt({name:Tc,element:n});if(e&&o){let s=on(o.value)?(r=o.value)==null?void 0:r.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:a.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);a.dateAvailability=l}return{inContextCourt:a}}function ih(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,a=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},o=[],s=[],l=[],c=[];return Object.keys(a).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=a[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=jt({name:Tc,element:p});if(h!=null&&h.value)continue}o.includes(p.venueId)||(c.push(ot(p,e,!0)),o.push(p.venueId));for(let h of p.courts??[])if(!s.includes(h.courtId)){if(i){let{extension:m}=jt({name:Tc,element:h});if(rge({extension:m,dates:r}))continue}let{inContextCourt:f}=age({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),s.push(h.courtId)}}}),{courts:l,venues:c,...re}}function pGe({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:Cn};let r=ot(e.venues??[],t).filter(o=>{if(!i)return o;let{extension:s}=jt({name:Tc,element:o});return!(s!=null&&s.value)&&o}).filter(Boolean),a=r.reduce((o,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=jt({name:Tc,element:c});return rge({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=age({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?o.concat(l):o},[]);return{venues:r,courts:a}}function BC({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Cn}:Object.keys(t).reduce((n,r)=>{let a=t[r],{venues:o}=pGe({tournamentRecord:a,dates:i});return o==null||o.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function S4({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Ne};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=bI({tournamentRecord:t}),{venues:a}=ih({tournamentRecord:t}),o=i.map(s=>{let{eventId:l}=s,c=ege({event:s}).eventInfo,u=pC({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(h=>{let f=(({drawId:I,drawName:b,matchUpFormat:D,updatedAt:w})=>({matchUpFormat:D,updatedAt:w,drawName:b,drawId:I}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=J0({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:s});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=tl({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:a,eventsData:o}}}function oge({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function wO(t){var e,i;let{tournamentParticipants:n=[],includePositionAssignments:r,policyDefinitions:a,tournamentRecord:o,inContext:s=!0,usePublishState:l,status:c=Zl,drawDefinition:u,noDeepCopy:d,sortConfig:p,context:h,event:f}=t;if(!u)return{error:tt};let m=(({matchUpFormat:P,updatedAt:M,drawType:N,drawName:R,drawId:A})=>({matchUpFormat:P,updatedAt:M,drawName:R,drawType:N,drawId:A}))(u),g,v,{allStructuresLinked:y,sourceStructureIds:I,hasDrawFeedProfile:b,structureGroups:D}=Xk({drawDefinition:u});if(!y)return{error:Oce};let w=(t==null?void 0:t.publishStatus)??tl({event:f,status:c}),S=t.eventPublished??!!((i=(e=hI({event:f}).publishState)==null?void 0:e.status)!=null&&i.published),U=!1,C=!1,E=D.map(P=>{let M={},N=P.map(R=>{let{structure:A}=Dt({drawDefinition:u,structureId:R}),{seedAssignments:_}=Ks({drawDefinition:u,structure:A});return(A==null?void 0:A.stage)===nt&&A.stageSequence===1&&(g=_),(A==null?void 0:A.stage)===gt&&A.stageSequence===1&&(v=_),A}).sort((R,A)=>sI(R,A,p)).map(R=>{var A;if(!R)return;let _=R==null?void 0:R.structureId,O=[];R.stage&&[nt,oa,Nn].includes(R.stage)&&(O=g),(R==null?void 0:R.stage)===gt&&(O=v);let{matchUps:x,roundMatchUps:F,roundProfile:$}=Ui({seedAssignments:(A=R==null?void 0:R.seedAssignments)!=null&&A.length?void 0:O,context:{drawId:m.drawId,...h},tournamentParticipants:n,policyDefinitions:a,tournamentRecord:o,usePublishState:l,publishStatus:w,drawDefinition:u,inContext:s,structure:R,event:f}),{positionAssignments:V}=Vi({structure:R}),G=V==null?void 0:V.filter(Ko(yd)).map(H=>{let{drawPosition:K,participantId:q}=H,{extension:Y}=jt({element:H,name:tf});return C=!0,{participantResult:Y==null?void 0:Y.value,participantId:q,drawPosition:K}});if(!(G!=null&&G.length)&&x.length&&t.allParticipantResults){let{subOrderMap:H}=Mhe({positionAssignments:V}),K=nS({matchUpFormat:R.matchUpFormat,policyDefinitions:a,subOrderMap:H,matchUps:x});G=V==null?void 0:V.filter(Ko(yd)).map(q=>{let{drawPosition:Y,participantId:Z}=q;return C=!0,{participantResult:Z&&K.participantResults[Z],participantId:Z,drawPosition:Y}})}let j=R?(({stageSequence:H,structureName:K,structureType:q,matchUpFormat:Y,stage:Z})=>({stageSequence:H,structureName:K,structureType:q,matchUpFormat:Y,stage:Z}))(R):{};j.sourceStructureIds=I[_],j.hasDrawFeedProfile=b[_],j.positionAssignments=V,j.structureActive=x.reduce((H,K)=>{var q;let Y=[qn,Yp,mi,Na,Ci,ql,fr,er].includes(K.matchUpStatus);return H||Y||!!K.winningSide||!!((q=K.score)!=null&&q.scoreStringSide1)},!1);let z=x.reduce((H,K)=>H&&[wi,qn,Na,Ci,mi,ps].includes(K.matchUpStatus),!!x.length);return j.structureCompleted=z,M[_]=z,j.structureActive&&(U=!0),{...j,participantResults:G,seedAssignments:O,roundMatchUps:F,roundProfile:$,structureId:_}});return N.forEach(R=>{var A;r||delete R.positionAssignments,R.sourceStructuresComplete=(A=R.sourceStructureIds)==null?void 0:A.every(_=>M[_])}),N}).flat();return m.drawActive=U,m.participantPlacements=C,m.drawGenerated=E==null?void 0:E.reduce((P,M)=>P||!!(M!=null&&M.roundMatchUps),!1),m.drawCompleted=E==null?void 0:E.reduce((P,M)=>P&&M.structureCompleted,!0),m.drawPublished=l?S&&oge({publishStatus:w,drawId:m.drawId}):void 0,{structures:!l||m.drawPublished?d?E:ot(E,!1,!0):void 0,drawInfo:d?m:ot(m,!1,!0),...re}}function SO(t){var e,i;let{includePositionAssignments:n,participantsProfile:r,policyDefinitions:a,usePublishState:o,status:s=Zl,sortConfig:l}=t,c=vi(t,[{tournamentRecord:!0},{[s3]:{event:!1,eventId:!1}}]);if(c.error)return c;let u=ot(t.tournamentRecord,!1,!0),d=t.event?void 0:po({tournamentRecord:u,eventId:t.eventId}).event,p=t.event?ot(t.event,!1,!0):d&&ot(d,!1,!0)||void 0;if(!p)return{error:Wo};let{eventId:h}=p,{tournamentId:f,endDate:m}=u,g=tl({event:p,status:s}),v=hI({event:p}).publishState??{},y=!!((e=v==null?void 0:v.status)!=null&&e.published),{participants:I}=$n({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:a,...r,tournamentRecord:u}),b=({stage:R,drawId:A})=>{var _,O,x;if(!o)return!0;let F=(O=(_=g==null?void 0:g.drawDetails)==null?void 0:_[A])==null?void 0:O.stageDetails;return!F||!Object.keys(F).length?!0:(x=F[R])==null?void 0:x.published},D=({structureId:R,drawId:A})=>{var _,O,x;if(!o)return!0;let F=(O=(_=g==null?void 0:g.drawDetails)==null?void 0:_[A])==null?void 0:O.structureDetails;return!F||!Object.keys(F).length?!0:(x=F[R])==null?void 0:x.published},w=({drawId:R})=>o?oge({publishStatus:g,drawId:R}):!0,S=({drawId:R,structure:A})=>{var _,O,x,F;if(!o)return A;let $=(F=(x=(O=(_=g==null?void 0:g.drawDetails)==null?void 0:_[R])==null?void 0:O.structureDetails)==null?void 0:x[A.structureId])==null?void 0:F.roundLimit;if(Rt($)){let V=Xe(1,$+1),G={},j={};for(let z of V)A.roundMatchUps[z]&&(G[z]=A.roundMatchUps[z],j[z]=A.roundProfile[z]);A.roundMatchUps=G,A.roundProfile=j}return A},U=p.drawDefinitions||[],C=!o||y?U.filter(w).map(R=>(({drawInfo:A,structures:_})=>({...A,structures:_}))(wO({allParticipantResults:t.allParticipantResults,context:{eventId:h,tournamentId:f,endDate:m},includePositionAssignments:n,tournamentParticipants:I,noDeepCopy:!0,policyDefinitions:a,tournamentRecord:u,usePublishState:o,drawDefinition:R,publishStatus:g,sortConfig:l,event:p}))).map(({structures:R,...A})=>{let _=R==null?void 0:R.filter(({stage:O,structureId:x})=>D({structureId:x,drawId:A.drawId})&&b({stage:O,drawId:A.drawId})).map(O=>S({drawId:A.drawId,structure:O}));return{...A,structures:_}}).filter(R=>{var A;return(A=R.structures)==null?void 0:A.length}):void 0,{tournamentInfo:E}=bI({tournamentRecord:u}),P=(u.venues||[]).map(R=>(({venueData:A})=>({...A}))(bw({tournamentRecord:u,venueId:R.venueId}))),M=(({eventId:R,eventName:A,eventType:_,eventLevel:O,surfaceCategory:x,matchUpFormat:F,category:$,gender:V,startDate:G,endDate:j,ballType:z,discipline:H})=>({eventId:R,eventName:A,eventType:_,eventLevel:O,surfaceCategory:x,matchUpFormat:F,category:$,gender:V,startDate:G,endDate:j,ballType:z,discipline:H}))(p),N={tournamentInfo:E,venuesData:P,eventInfo:M,drawsData:C};return N.eventInfo.publishState=v,N.eventInfo.published=(i=v==null?void 0:v.status)==null?void 0:i.published,{...re,eventData:N,participants:I}}var sge={};Ht(sge,{getPersonRequests:()=>Fg,getProfileRounds:()=>DO,getScheduledRoundsDetails:()=>VC,getSchedulingProfile:()=>nh,getSchedulingProfileIssues:()=>T4});function TO({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:a,tournamentId:o,eventType:s,eventId:l}){if(!Zo({matchUpFormat:n}))return{error:BP};let c=Object.keys(i).filter(d=>!o||d===o),u;return c.forEach(d=>{var p;if(u)return;let h=i[d],f=l?(p=po({tournamentRecord:h,eventId:l}))==null?void 0:p.event:void 0;return u=hC({tournamentRecord:h,matchUpFormat:n,categoryName:r,categoryType:a,eventType:s,event:f}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function VC({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:a}){if(typeof i!="object")return{error:Cn};if(!Array.isArray(a))return{error:dt,info:Ed("rounds")};let o={},s=[];a.sort((p,h)=>(p.sortOrder??0)-(h.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>q0({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=Nc({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:a.flatMap(p=>{var h;let f=p.periodLength||n,m=[];e!=null&&e[p.structureId]?m.push(...e[p.structureId]):m.push(p.structureId);let g=r?lv({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:m,matchUps:r}).sort(pI):[],{segmentNumber:v,segmentsCount:y}=p.roundSegment||{};if(Rt(v)&&Rc(g==null?void 0:g.length)&&Rc(y)&&v>0&&v<=y&&y<(g==null?void 0:g.length)&&!((h=p.matchUpIds)!=null&&h.length)){let w=g.length/y,S=w*(v-1);g=g.slice(S,S+w)}let I=i[p.tournamentId],b=po({drawId:p.drawId,tournamentRecord:I}).event,D=[];for(let w of g){let S=w.matchUpFormat;S&&(o[S]||(o[S]=[],o[S].push(w)),D.push(S))}for(let w of D){let{eventType:S,category:U}=b??{},{categoryName:C,ageCategoryCode:E}=U??{},{typeChangeRecoveryMinutes:P,recoveryMinutes:M,averageMinutes:N,error:R}=TO({categoryName:C??E,categoryType:U==null?void 0:U.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:w,eventType:S});if(R)return{error:R,round:p};let A=g.filter(O=>(t||!Mr.includes(O.matchUpStatus))&&O.matchUpStatus!==wi).map(Cr);A.forEach(O=>{d[O]={typeChangeRecoveryMinutes:P,recoveryMinutes:M,averageMinutes:N},c[O]=M,u[O]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${f}`;return{roundPeriodLength:f,recoveryMinutes:M,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:o,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...re}}function lge({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],a=t==null?void 0:t.map(s=>{let l=Lt(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),o=r.length;return{updatedSchedulingProfile:a,modifications:o,issues:r}}function UO({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Ie};let{venueIds:i,tournamentsMap:n}=fGe({tournamentRecords:t}),r,a,o=e.every(s=>{let{scheduleDate:l,venues:c}=s;return ls(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(a="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var f,m,g,v;if(!h)return a="empty round",!1;let{roundSegment:y,tournamentId:I,structureId:b,roundNumber:D,eventId:w,drawId:S}=h,U=(v=(g=(m=(f=n==null?void 0:n[I])==null?void 0:f[w])==null?void 0:m[S])==null?void 0:g[b])==null?void 0:v.includes(D);U||(a="Invalid rounds");let{segmentNumber:C,segmentsCount:E}=y||{},P=!y||Rt(C)&&Rc(E)&&C<=E;return P||(a="Invalid segment"),U&&P}):(r=x0,!1):(a="rounds should be an array",!1)}):!1});return!o&&!r&&(r=Ie),{valid:!!o,error:r,info:a}}function hGe(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],a=[],o=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;o.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;s.push(h),i[c][d][h]={};let{structures:f}=Pd({drawDefinition:p});(f||[]).forEach(m=>{var g;let v=m.structureId,{matchUps:y}=Ui({structure:m}),{roundMatchUps:I}=Za({matchUps:y}),b=I&&Object.keys(I).map(D=>parseInt(D));i[c][d][h][v]=b,a.push(v),(g=m.structures)!=null&&g.length&&m.structures.forEach(D=>{a.push(D.structureId),i[c][d][h][D.structureId]=b})})})})),{tournamentMap:i,tournamentIds:r,structureIds:a,venueIds:l,eventIds:o,drawIds:s}}function fGe(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:a,structureIds:o,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=hGe({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:o,venueIds:n,eventIds:r,drawIds:a}}function nh({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let{extension:i}=jt({element:e,name:sy,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=BC({requireCourts:!0,tournamentRecords:t}),{eventIds:a,drawIds:o}=_q({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=lge({schedulingProfile:n,venueIds:r,eventIds:a,drawIds:o});if(l){n=s;let u=rS({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function rS({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=UO({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?ui({tournamentRecords:t,discover:!0,extension:{name:sy,value:i}}):Va({element:e,name:sy,tournamentRecords:t,discover:!0})}function jC(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=nh({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=BC({tournamentRecords:i}),{eventIds:r,drawIds:a}=_q({tournamentRecords:i}),{updatedSchedulingProfile:o,modifications:s,issues:l}=lge({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:a});return s?{...rS({schedulingProfile:o,tournamentRecords:i}),modifications:s,issues:l}:{...re,modifications:s,issues:l}}function T4(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:LP};if(!Array.isArray(e))return{error:Ie};if(!e.every(ls))return{error:Ka};let r=[],a=0,o={},{schedulingProfile:s}=nh({tournamentRecords:i});if(!s)return{issues:r,...re};let{matchUps:l}=Nc({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=VC({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=Xl({tournamentRecords:i,matchUps:l}),I=b=>{let D;return v==null||v.find((w,S)=>{let U=w.matchUpIds.includes(b);return U&&(D=S),U}),D};if(g==null||g.forEach((b,D)=>{var w;let S=g.slice(D+1),U=Ln(S,((w=y==null?void 0:y[b])==null?void 0:w.matchUpIds)||[]);U.length&&m.push({matchUpId:b,shouldBeAfter:U})}),m.length){a+=m.length;let b=m.map(({matchUpId:D,shouldBeAfter:w})=>{let S=I(D),U=$t(w.map(I));return o[d]||(o[d]={}),o[d][S]||(o[d][S]=[]),U.forEach(C=>{o[d][S].includes(C)||o[d][S].push(C)}),{matchUpId:D,matchUpRoundIndex:S,earlierRoundIndices:U,shouldBeAfter:w}});r.push(...b)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:a,profileIssues:c,roundIndexShouldBeAfter:o,...re}}function Fg(t){let{tournamentRecords:e,requestType:i}=t,n=vi(t,[{[Ta]:!0}]);if(n.error)return n;let r={};for(let a of Object.values(e)){let{extension:o}=jt({element:a,name:G0}),s=(o==null?void 0:o.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...re}}function VB(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:a,structureId:o,eventId:s,drawId:l}=t,c=n?e:o,u=[r,s,l,c,a].join("|");return ft({structureId:c,roundSegment:i,tournamentId:r,roundNumber:a,eventId:s,drawId:l,id:u})}function GY({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:a,category:o,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:c}=o||{},u=qo(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=TO({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:a});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function mGe(t){return(t||[]).reduce((e,i)=>{var n,r;let a=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((s,l)=>s+l,0),o=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).join("-")||"";return!e.minFinishingSum||a<e.minFinishingSum?{minFinishingSum:a,winnerFinishingPositionRange:o}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function HY(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||Mr.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==wi).length||0,a=e-i,o=a===n,s=a-r,l=a-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:a===r,isComplete:o,byeCount:i}}function DO({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:LP};t={[i.tournamentId]:i}}if(e){let a=UO({tournamentRecords:t,schedulingProfile:e});if(a.error)return a}if(!e&&t){let a=nh({tournamentRecords:t});if(a.error)return a;e=a.schedulingProfile}if(!e)return{error:Sa};let r={};return{profileRounds:e.map(({venues:a,scheduleDate:o})=>a.map(({rounds:s})=>s.map(l=>{var c;let u=VB(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(r[u.id]=u.roundSegment.segmentsCount),ft({id:n?u.id:void 0,scheduleDate:o,...u})}))).flat(1/0),segmentedRounds:r}}var cge={};Ht(cge,{getEntriesAndSeedsCount:()=>PO,getMaxEntryPosition:()=>U4});function PO({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:a}){if(!r)return{error:_i};let{entries:o,stageEntries:s}=Ope({drawDefinition:e,drawId:n,stage:a,event:r}),l=s.length,{drawSize:c}=afe({participantsCount:l}),u=$C({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return oe({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:o,seedsCount:d,stageEntries:s}}function U4(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>St(r||0)),0)}var uge={};Ht(uge,{allCompetitionMatchUps:()=>Nc,allDrawMatchUps:()=>ro,allEventMatchUps:()=>eh,allTournamentMatchUps:()=>Hr,analyzeMatchUp:()=>BU,calculateWinCriteria:()=>wI,checkMatchUpIsComplete:()=>Um,competitionScheduleMatchUps:()=>HC,drawMatchUps:()=>O4,eventMatchUps:()=>EO,getAllDrawMatchUps:()=>lr,getAllStructureMatchUps:()=>Ui,getCheckedInParticipantIds:()=>cI,getCompetitionMatchUps:()=>$U,getEventMatchUpFormatTiming:()=>P4,getMatchUpCompetitiveProfile:()=>dC,getMatchUpContextIds:()=>N4,getMatchUpDailyLimits:()=>RO,getMatchUpDailyLimitsUpdate:()=>C4,getMatchUpDependencies:()=>Xl,getMatchUpFormat:()=>A4,getMatchUpFormatTiming:()=>hC,getMatchUpFormatTimingUpdate:()=>D4,getMatchUpScheduleDetails:()=>jk,getMatchUpType:()=>Gk,getMatchUpsStats:()=>_4,getModifiedMatchUpFormatTiming:()=>CO,getParticipantResults:()=>AC,getPredictiveAccuracy:()=>R4,getRoundMatchUps:()=>Za,getRounds:()=>k4,isValidMatchUpFormat:()=>Zo,matchUpActions:()=>lO,participantScheduledMatchUps:()=>E4,tallyParticipantResults:()=>nS,tournamentMatchUps:()=>MO,validMatchUp:()=>$k,validMatchUps:()=>el});function dge({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let i=[],n;for(let r of Object.values(t)){let{extension:a}=jt({element:r,name:e});a&&!n&&(i.push({params:{extension:a,discover:!0},method:"addExtension"}),n=!0);let o=r.events??[];for(let s of o){let{eventId:l}=s,{extension:c}=jt({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function D4({tournamentRecords:t}){return dge({extensionName:Pp,tournamentRecords:t})}var ML="ADULT",RL="JUNIOR",zE="WHEELCHAIR",pge={[kf]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[qi]:30,default:60}}]},defaultDailyLimits:{[Un]:2,[qi]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[xs],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[zE],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[ML,zE],minutes:{default:60,[qi]:30}},{categoryTypes:[RL],minutes:{default:60,[qi]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[ML,zE],minutes:{default:30}},{categoryTypes:[RL],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[ML,RL],minutes:{default:30}},{categoryTypes:[zE],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},gGe=pge;function P4({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:_i};let r=[],a;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&Zo({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=Rg({policyType:Sd,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=jt({name:Pp,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=gGe[kf],r=$t([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),a="default scheduling policy in use"}}let{eventType:o,eventId:s,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:_i};let u=r.map(({matchUpFormat:d,description:p})=>{let h=hC({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:o,event:n});return{matchUpFormat:d,description:p,...h}});return ft({eventMatchUpFormatTiming:u,info:a})}function CO(t){let e=vi(t,[{[Ad]:!0},{[pc]:m=>Zo({matchUpFormat:m}),[Id]:BP,[i3]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:a}=jt({name:Pp,element:r}),o=a==null?void 0:a.value,{extension:s}=jt({element:i,name:Pp}),l=s==null?void 0:s.value,c=(o==null?void 0:o.matchUpAverageTimes)&&gT({...o,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&gT({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(o==null?void 0:o.matchUpRecoveryTimes)&&vT({...o,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&vT({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function C4({tournamentRecords:t}){return dge({extensionName:ZP,tournamentRecords:t})}var GC=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function E4({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!el(e))return{error:Nd};if(!Array.isArray(t))return{error:Ie};let i=e.filter(Boolean).filter(({schedule:n})=>GC({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:a}=r,o=Lt(a==null?void 0:a.scheduledDate),s=rn(a==null?void 0:a.scheduledTime);return o&&s&&(n[o]?n[o].push(r):n[o]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,a)=>{var o,s;return ide(rn((o=r.schedule)==null?void 0:o.scheduledTime),rn((s=a.schedule)==null?void 0:s.scheduledTime))})}),{...re,scheduledMatchUps:i}}function vGe({tournamentRecords:t}){var e;let i=[],n={};for(let r of Object.values(t))for(let a of r.events??[]){let o=tl({event:a}),s=o==null?void 0:o.drawDetails;on(s)?(Object.assign(n,s),i.push(...Object.keys(s).filter(l=>oq({drawId:l,drawDetails:s})))):(e=o==null?void 0:o.drawIds)!=null&&e.length&&i.push(...o.drawIds)}return{drawIds:i,detailsMap:n}}function sN({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],a={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&Lt(l.scheduledDate)||l.scheduledTime&&Lt(l.scheduledTime)||"noScheduledDate";a[c]||(a[c]=[]),a[c].push(s)}let o=Object.keys(a).sort();for(let s of o){let l=a[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&rn(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function M4({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Ie};let n=i==null?void 0:i.reduce((o,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>o?c:o},1),r=e?Math.max(e,n):n,a=Xe(0,r).map(o=>({matchUps:Xe(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:o+1,venueId:u,courtId:c}}})}));return i.forEach((o,s)=>{var l;for(let c of o.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(a[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:a.map((o,s)=>Object.assign({rowId:`rowId-${s+1}`},...o.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}function EO(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:I}=t;if(!I)return{error:_i};let{eventId:b,eventName:D,endDate:w,eventType:S,category:U,gender:C}=I??{},E={...y,...ft({surfaceCategory:I.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:I.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:w??(u==null?void 0:u.endDate),eventName:D,eventType:S,category:U,eventId:b,gender:C})},P;!e&&u&&({participants:e,participantMap:n,groupInfo:P}=dI({participantsProfile:o,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=Qp({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:I}));let M=tl({event:I});return{...(I.drawDefinitions??[]).reduce((N,R)=>{var A;let _=J0({context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:a,tournamentParticipants:e,participantsProfile:o,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:M,contextProfile:f,drawDefinition:R,nextMatchUps:m,inContext:v,event:I});return(A=Object.keys(_))==null||A.forEach(O=>{Array.isArray(_[O])&&(N[O]||(N[O]=[]),N[O]=N[O].concat(_[O]))}),N},{}),...re,groupInfo:P}}function MO(t){if(!(t!=null&&t.tournamentRecord))return{error:Ne};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:I}=dI({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=Qp({policyDefinitions:a,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:b}=Mi({tournamentRecord:s}),D=(u==null?void 0:u.eventIds)??[];return{...g.filter(w=>!D.includes(w.eventId)).map(w=>{var S,U,C;let E={eventDrawsCount:((U=(S=Vn({event:w}).flightProfile)==null?void 0:S.flights)==null?void 0:U.length)||((C=w.drawDefinitions)==null?void 0:C.length)||0,...f};return EO({context:E,tournamentAppliedPolicies:b,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:h,inContext:l,event:w})}).reduce((w,S)=>{var U;return(U=S&&Object.keys(S).filter(C=>!["success","matchUpsMap"].includes(C)))==null||U.forEach(C=>{Array.isArray(S[C])&&(w[C]||(w[C]=[]),w[C]=w[C].concat(S[C]),w.matchUpsCount+=S[C].length)}),w},{matchUpsCount:0}),groupInfo:I}}function $U({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Cn};let c=Object.keys(i).map(d=>{let p=i[d];return MO({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:a,contextFilters:o,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(h=>{Array.isArray(p[h])&&(d[h]||(d[h]=[]),d[h]=d[h].concat(p[h])),h==="groupInfo"&&Object.assign(u,p[h])}),d),{}),groupInfo:u}}function HC(t){var e,i,n,r,a,o,s,l;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Cn};let{courts:c,venues:u}=ih(t),d=nh(t).schedulingProfile,{sortDateMatchUps:p=!0,courtCompletedMatchUps:h,alwaysReturnCompleted:f,activeTournamentId:m,tournamentRecords:g,withCourtGridRows:v,minCourtGridRows:y,usePublishState:I,status:b=Zl,sortCourtsData:D}=t,w=I?(i=(e=vC({tournamentRecord:g[m??iI()],itemType:`${Ng}.${Ag}`}).timeItem)==null?void 0:e.itemValue)==null?void 0:i[b]:void 0,S=f?$U({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[qn]},contextFilters:t.contextFilters}).completedMatchUps:[];if(I&&(!w||!Object.keys(w).length))return{completedMatchUps:S,dateMatchUps:[],courtsData:[],venues:u};let U,C;I&&({drawIds:U,detailsMap:C}=vGe({tournamentRecords:g})),U!=null&&U.length&&(t.contextFilters||(t.contextFilters={}),(n=t.contextFilters)!=null&&n.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>U.includes(F)):t.contextFilters.drawIds=U),(r=w==null?void 0:w.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(a=t.matchUpFilters)!=null&&a.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>w.eventIds.includes(F)):t.matchUpFilters.eventIds=w.eventIds),(o=w==null?void 0:w.scheduledDates)!=null&&o.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>w.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=w.scheduledDates),f&&(t.matchUpFilters||(t.matchUpFilters={}),(l=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&l.length?t.matchUpFilters.excludeMatchUpStatuses.includes(qn)||t.matchUpFilters.excludeMatchUpStatuses.push(qn):t.matchUpFilters.excludeMatchUpStatuses=[qn]);let{completedMatchUps:E,upcomingMatchUps:P,pendingMatchUps:M,groupInfo:N}=$U({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),R=[...P??[],...M??[]];C&&Object.keys(C).length&&(R=R.filter(F=>{let{drawId:$,structureId:V,stage:G}=F;if(!C[$])return!1;if(C[$].stageDetails){let j=Object.keys(C[$].stageDetails),z=j.filter(K=>!C[$].stageDetails[K].published),H=j.filter(K=>C[$].stageDetails[K].published);return z.length&&z.includes(G)?!1:H.length&&H.includes(G)?!0:z.length&&!z.includes(G)&&!H.length}if(C[$].structureDetails){let j=Object.keys(C[$].structureDetails),z=j.filter(K=>!C[$].structureDetails[K].published),H=j.filter(K=>C[$].structureDetails[K].published);return z.length&&z.includes(V)?!1:H.length&&H.includes(V)?!0:z.length&&!z.includes(V)&&!H.length}return!0}));let A=p?sN({matchUps:R,schedulingProfile:d}):R,_=c==null?void 0:c.map(F=>{let $=x(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:$,...F}}),O={completedMatchUps:f?S:E,dateMatchUps:A,courtsData:_,groupInfo:N,venues:u};if(v){let{rows:F,courtPrefix:$}=M4({minRowsCount:y,courtsData:_});O.courtPrefix=$,O.rows=F}return{...O,...re};function x({courtId:F}){let $=(h?A.concat(E??[]):A).filter(V=>{var G,j,z;return((G=V.schedule)==null?void 0:G.courtId)===F||((z=(j=V.schedule)==null?void 0:j.allocatedCourts)==null?void 0:z.map(({courtId:H})=>H).includes(F))});return D?sN({matchUps:$,schedulingProfile:d}):$}}function RO({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Cn};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let a=t[r],{matchUpDailyLimits:o}=yGe({tournamentRecord:a});n=o}),{matchUpDailyLimits:n}}function yGe(t){var e;let i=vi(t,[{[Ad]:!0}]);if(i.error)return i;let{tournamentRecord:n}=t,{policy:r}=Rg({policyType:kf,tournamentRecord:n}),{extension:a}=jt({element:n,name:ZP}),o=(e=a==null?void 0:a.value)==null?void 0:e.dailyLimits,s=r==null?void 0:r.defaultDailyLimits;return{matchUpDailyLimits:o||s}}function R4(t){var e,i,n,r;let{matchUps:a}=t,{singlesForDoubles:o,tournamentRecord:s,drawDefinition:l,excludeMargin:c,exclusionRule:u,zoneDoubling:d,matchUpType:p,scaleName:h,eventId:f,zonePct:m,drawId:g,event:v}=t;if(!s&&!a)return{error:Ne};if(p&&![Un,qi].includes(p))return{error:Ie,info:{matchUpType:p}};if(a&&!el(a))return{error:Ie,context:{matchUps:a}};let y=rs[h],I=(y==null?void 0:y.ascending)??t.ascending??!1,b=(y==null?void 0:y.accessor)??t.valueAccessor,D=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,w=Rt(m)&&D?(m??0/100)*D:t.zoneMargin??D,S={withScaleValues:!0,withCompetitiveness:!0},U={matchUpTypes:p?[p]:[Un,qi]},C=s==null?void 0:s.participants;(e=a==null?void 0:a[0])!=null&&e.hasContext?g?a=a.filter(x=>x.drawId===g):f&&(a=a.filter(x=>x.eventId===f)):a===void 0&&(a=g&&!l&&[]||!g&&f&&!v&&[]||g&&((i=ro({inContext:!0,drawDefinition:l,contextFilters:U,contextProfile:S,participants:C}))==null?void 0:i.matchUps)||!g&&f&&((n=eh({inContext:!0,contextFilters:U,contextProfile:S,participants:C,event:v}))==null?void 0:n.matchUps)||((r=Hr({tournamentRecord:s,contextFilters:U,contextProfile:S}))==null?void 0:r.matchUps)||[]),p&&(a=a.filter(x=>x.matchUpType===p));let E=a.filter(({winningSide:x,score:F,sides:$,matchUpStatus:V})=>![Na,mi,Ci,H0,ps].includes(V??"")&&zr({score:F})&&($==null?void 0:$.length)===2&&x),P=bGe({matchUps:E,excludeMargin:c,exclusionRule:u,valueAccessor:b,ascending:I,scaleName:h}),M=!d||_n(Un)(p)?w:(w||0)*2,N=w?E.map(({competitiveProfile:x,matchUpType:F,score:$,sides:V})=>{let G=hge({singlesForDoubles:o,valueAccessor:b,matchUpType:F,scaleName:h,sides:V}),j=Math.abs(G[0].value-G[1].value);return{competitiveness:x==null?void 0:x.competitiveness,valuesGap:j,score:$}}).filter(({valuesGap:x})=>x<=M):[],R=IGe({zoneData:N}),A=R&&[].concat(Object.values(R)).flat().length,_=A&&Object.assign({},...Object.keys(R).map(x=>({[x]:Math.round(1e4*R[x].length/A)/100}))),O=E.length-((N==null?void 0:N.length)||0);return{...re,relevantMatchUps:E,zoneDistribution:_,zoneData:N,accuracy:P,nonZone:O}}function IGe({zoneData:t}){let e={[z3]:[],[NU]:[],[AU]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:a}=i;e[n]&&e[n].push({score:r,valuesGap:a})}return e}function hge({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:a}){let o=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=o[0]&&c<=o[1],exclusionValue:c}};return a.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=zY({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=zY({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=s(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function zY({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var a,o,s,l,c;let u=t?Un:i,d=(o=(a=n==null?void 0:n.rankings)==null?void 0:a[u])==null?void 0:o.find(f=>f.scaleName===r),p=(c=((l=(s=n==null?void 0:n.ratings)==null?void 0:s[u])==null?void 0:l.find(f=>f.scaleName===r))||d)==null?void 0:c.scaleValue,h=e?p==null?void 0:p[e]:p;return{scaleValue:p,value:h}}function bGe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:a}){let o={affirmative:[],negative:[],excluded:[]};for(let c of a){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:dt};let f=h-1,m=hge({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let D=m.map(({exclusionValues:w})=>w).flat();if(D.length){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:D,winningSide:h,sideValues:m});continue}}if(m.filter(D=>![void 0,"",null].includes(D.value)).length<2){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){o.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let I=n?g:g*-1,b=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;I>0?o.affirmative.push({winningScoreString:b,winningSide:h,sideValues:m,valuesGap:g,score:p}):o.negative.push({winningScoreString:b,winningSide:h,sideValues:m,valuesGap:g,score:p})}let s=o.affirmative.length+o.negative.length,l=s&&o.affirmative.length/s*100;return o.percent=l?Math.round(100*l)/100:0,o}function wI({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=Ahe({collectionGroups:e}),r;for(let a of t||[]){let{collectionValueProfiles:o,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h=s&&n.includes(s);if(Rt(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&Rt(l))i+=l;else if(o!=null&&o.length)for(let f of o)i+=f.matchUpValue;else typeof u=="number"&&Rt(u)&&(i+=(c??0)*u)}}for(let a of e)i+=a.groupValue??0;return r||!i?{aggregateValue:!0,...re}:{valueGoal:Math.floor(i/2)+1,...re}}function N4({matchUps:t,matchUpId:e}){if(!el(t))return{error:Ie};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:a,tournamentId:o}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:a,tournamentId:o}}function zC(t,e){if(!on(t))return{error:Ie};if(!Array.isArray(e))return{error:Ie};let i={};for(let{param:n,error:r,attr:a}of e){let o=wGe({params:t,param:n,attr:a,error:r});if(o!=null&&o.error)return o;i[n]=o}return i}function wGe({params:t,param:e,attr:i,error:n}){if(e===o3&&on(t.drawDefinition)&&co(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:a})=>a===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===Af){let r=ige({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:Sa,info:{param:e}}}function A4(t){var e,i;let{structureId:n,matchUpId:r,event:a}=t,o=t.drawDefinition,s=vi(t,[{[Ad]:!0},{[s3]:{[n3]:!1,[Dg]:!1,[Xue]:!1,[$0]:!1}}]);if(s[Ev])return s;let l=(e=zC(t,[{[qP]:Af,[Ev]:dt}]))==null?void 0:e.matchUp;if(r&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let c=l==null?void 0:l.structure;if(!c&&n&&!r){if(!o)return{error:Fc};let f=Dt({drawDefinition:o,structureId:n});if(f.error)return f;c=f.structure}let u=c==null?void 0:c.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=a==null?void 0:a.matchUpFormat,h=((i=l==null?void 0:l.matchUp)==null?void 0:i.matchUpFormat)||u||d||p;return{structureDefaultMatchUpFormat:u,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:h}}function _4({profileBands:t,tournamentRecord:e,matchUps:i}){if(!el(i))return{error:Nd};let n=!t&&Rg({policyType:Jd,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||W3[Jd].profileBands,a=i.filter(({winningSide:p})=>p),o=a.map(Hde),s=(p,h)=>{let f=Gde(h,r);return p[f]+=1,p},l=zde(o).reduce((p,h)=>s(p,h),{[z3]:0,[NU]:0,[AU]:0,[jde]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=a.filter(({matchUpStatus:p})=>p===dY).length;return u.push({[dY]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...re}}var{stageOrder:WY}=vFe;function SGe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(WY[t==null?void 0:t.stage]||0)-(WY[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function k4({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:a,tournamentRecord:o,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var h;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Ie,inContextMatchUps:n};if(o&&!r){if(typeof o!="object")return{error:LP};r={[o.tournamentId]:o}}let f=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!a&&(t||i||a||s))&&f)return{error:Cn};let m=Object.assign({},...Object.values(r??{}).map(({venues:S=[],tournamentId:U})=>({[U]:S==null?void 0:S.map(({venueId:C})=>C)}))),g=Object.values(r??{}).map(({events:S=[],tournamentId:U,startDate:C,endDate:E})=>S.map(P=>({...P,validVenueIds:m[U],startDate:P.startDate??C,endDate:P.endDate??E}))).flat(),{segmentedRounds:v,profileRounds:y}=r&&(t||i||a||s)&&DO({tournamentRecords:r,schedulingProfile:a})||{},I=t&&Object.assign({},...y.map(S=>({[S.id]:S}))),b=n||r&&((h=Nc({tournamentRecords:r,matchUpFilters:l}))==null?void 0:h.matchUps)||[],D=[],w=b&&Object.values(b.reduce((S,U)=>{var C;let E=VB(U).id,P=v==null?void 0:v[E],M=[...((C=S[E])==null?void 0:C.matchUps)??[],U],{containerStructureId:N,stageSequence:R,structureName:A,tournamentId:_,isRoundRobin:O,matchUpType:x,roundNumber:F,roundOffset:$,structureId:V,eventName:G,roundName:j,drawName:z,eventId:H,drawId:K}=U,q=O?N:V;return{...S,[E]:{id:u?E:void 0,structureId:q,stageSequence:R,segmentsCount:P,structureName:A,tournamentId:_,matchUpType:x,roundNumber:F,roundOffset:$,eventName:G,roundName:j,drawName:z,matchUps:M,eventId:H,drawId:K}}},{})).map(S=>{let{minFinishingSum:U,winnerFinishingPositionRange:C}=mGe(S.matchUps),E=S.segmentsCount;if(E){let x=S.matchUps.length/E;return jr(S.matchUps.sort((F,$)=>F.roundPosition-$.roundPosition),x).map((F,$)=>{let{unscheduledCount:V,incompleteCount:G,matchUpsCount:j,isScheduled:z,isComplete:H,byeCount:K}=HY(F),q=GY({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return ft({...S,...p,roundSegment:{segmentsCount:E,segmentNumber:$+1},winnerFinishingPositionRange:C,unscheduledCount:V,incompleteCount:G,minFinishingSum:U,matchUpsCount:j,isScheduled:z,roundTiming:q,isComplete:H,byeCount:K,matchUps:F})})}let{unscheduledCount:P,incompleteCount:M,matchUpsCount:N,isScheduled:R,isComplete:A,byeCount:_}=HY(S.matchUps),O=GY({matchUps:S.matchUps,tournamentRecords:r,events:g,round:S});return ft({...S,...p,winnerFinishingPositionRange:C,unscheduledCount:P,incompleteCount:M,minFinishingSum:U,matchUpsCount:N,isScheduled:R,roundTiming:O,isComplete:A,byeCount:_})}).flat().filter(S=>{if(t){let $=Lt(t),V=u?S.id:VB(S).id;if($&&I[V]&&Lt(I[V].scheduleDate)===$)return!1}let{isComplete:U,isScheduled:C}=S,E=!i||!U,P=!e||!C,M=d||c?g==null?void 0:g.find(({eventId:$})=>$===S.eventId):void 0,N=(M==null?void 0:M.startDate)??(o==null?void 0:o.startDate),R=(M==null?void 0:M.endDate)??(o==null?void 0:o.endDate),A=!c||!N||new Date(c)>=new Date(N),_=!c||!R||new Date(c)<=new Date(R),O=A&&_,x=!d||(M==null?void 0:M.validVenueIds.includes(d)),F=E&&P&&x&&O;return F||D.push(S),F}).sort(SGe)||[];return{...re,rounds:w,excludedRounds:D}}function BU(t){var e;let{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:a,isPointValue:o}=t||{},{matchUpFormat:s}=t||{};if(!i)return{error:Do};s=s||(i==null?void 0:i.matchUpFormat);let l=go(s),c=!!(i!=null&&i.winningSide),u=(e=i.score)==null?void 0:e.sets,d=u==null?void 0:u.length,p=r&&r-1,h=!!(u!=null&&u.find((H,K)=>H.setNumber===r&&K===p)),f=(u==null?void 0:u.filter(H=>H==null?void 0:H.winningSide))||[],m=(f==null?void 0:f.length)||0,g=r&&(u==null?void 0:u.slice(r))||[],v=!!(d&&r&&g!=null&&g.reduce((H,K)=>(!K||!K.side1Score&&!K.side2Score&&!K.side1TiebreakScore&&!K.side2TiebreakScore&&!K.side1PointScore&&!K.side2PointScore)&&H,!0)),y=r<=d&&u.find(H=>H.setNumber===r),I=y&&FU({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:b,sideGameScores:D,sideTiebreakScores:w}=I||{},S=!!(y&&!b&&v||r&&r===d+1&&!c),U=[1,2].includes(n),C=U?n-1:0,E=y&&U&&(!a&&!o&&D[C]!==void 0&&D[C]||a&&w[C]!==void 0&&w[C]),P=!!E,M=f==null?void 0:f.map(H=>FU({setObject:H,matchUpScoringFormat:l}).isValidSetOutcome).reduce((H,K)=>H&&K,!0),N=f.reduce((H,K)=>{let{winningSide:q}=K,Y=q-1;return H[Y]++,H},[0,0]),R=i==null?void 0:i.winningSide,A=R&&R-1,_=1-A,O=N[A],x=N[_],F=Math.max(...N),$=qo(N)[F],{bestOf:V}=l??{},G=V&&Math.ceil(V/2)||1,j=F===G&&$===1&&N.indexOf(F)+1||void 0,z=O>x&&R===j;return{completedSetsHaveValidOutcomes:M,validMatchUpWinningSide:z,calculatedWinningSide:j,matchUpScoringFormat:l,validMatchUpOutcome:j&&M&&z,isLastSetWithValues:v,completedSetsCount:m,isCompletedMatchUp:c,isValidSideNumber:U,hasExistingValue:P,existingValue:E,isExistingSet:h,isActiveSet:S,...I}}function O4({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:I,event:b}){let{eventId:D,eventName:w,endDate:S,eventType:U,category:C,gender:E}=b??{},P={...I,...ft({surfaceCategory:(b==null?void 0:b.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(b==null?void 0:b.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:S??(b==null?void 0:b.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:w,eventType:U,category:C,eventId:D,gender:E})},M;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:M}=dI({participantsProfile:n,policyDefinitions:a,useParticipantMap:o,tournamentRecord:s,contextProfile:f,inContext:y})),b&&f&&!u&&(u=Qp({policyDefinitions:a,tournamentRecord:s,contextProfile:f,drawDefinition:m,event:b})),{...J0({context:P,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:a,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:b}),groupInfo:M}}var fge={};Ht(fge,{getCompetitionVenues:()=>BC,getCourts:()=>x4,getVenuesAndCourts:()=>ih,publicFindVenue:()=>X3});function x4({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,a=ot(n.courts||[]);return a.forEach(o=>Object.assign(o,{venueId:r})),a}).flat()}:{error:Ne}}var mge={};Ht(mge,{categoryCanContain:()=>iO,getCategoryAgeDetails:()=>_C,getEvent:()=>$4,getEventProperties:()=>L4,getEventStructures:()=>Zk,getEventTimeItem:()=>gC,getEvents:()=>F4,getFlightProfile:()=>Vn,getScaledEntries:()=>II});function L4({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:Ne};if(!e)return{error:_i};let r=e.entries||[],a=t.participants||[],o=((i=e.category)==null?void 0:i.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:s}=e,l=r.map(h=>h.participantId),c=a.filter(h=>l.includes(h.participantId)),u,d,p;return{entryScaleAttributes:c.map(h=>{var f,m,g,v,y,I;let{participantId:b,participantName:D,name:w}=h,S={scaleType:Y3,eventType:s,scaleName:o},U=(m=(f=td({participant:h,scaleAttributes:S}))==null?void 0:f.scaleItem)==null?void 0:m.scaleValue;S={scaleType:tpe,eventType:s,scaleName:o};let C=(v=(g=td({participant:h,scaleAttributes:S}))==null?void 0:g.scaleItem)==null?void 0:v.scaleValue;S={scaleType:epe,eventType:s,scaleName:o};let E=(I=(y=td({participant:h,scaleAttributes:S}))==null?void 0:y.scaleItem)==null?void 0:I.scaleValue;return u=!!(u||U),d=!!(d||C),p=!!(p||E),{participantId:b,participantName:D||w,seed:U,ranking:C,rating:E}}),hasSeededParticipants:u,hasRankedParticipants:d,hasRatedParticipants:p}}function F4({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:a,context:o}){var s,l,c,u;if(!t)return{error:Ne};let{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var m;let g=(m=f.drawDefinitions)==null?void 0:m.map(DU);if(a!=null&&a.length&&!Ln(a,g).length)return;let v=ot(f);return n&&Object.assign(v,{tournamentId:d}),o&&Object.assign(v,o),v}).filter(Boolean),h={};if(e){let f=$n({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of p){let v=i??g.eventType,y=g.eventId;h[y]||(h[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let I=(g.entries??[]).filter(({entryStatus:E})=>Yl.includes(E)).map(Yt),b=E=>{var P,M,N,R,A,_;if((P=E==null?void 0:E.ratings)!=null&&P[v])for(let O of((M=E==null?void 0:E.ratings)==null?void 0:M[v])??[]){let x=O.scaleName;h[y].ratings[x]||(h[y].ratings[x]=[]);let F=(N=rs[x])==null?void 0:N.accessor;if(F){let $=parseFloat((R=O.scaleValue)==null?void 0:R[F]);$&&h[y].ratings[x].push($)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let O of((_=E==null?void 0:E.rankings)==null?void 0:_[v])??[]){let x=O.scaleName;h[y].ranking[x]||(h[y].ranking[x]=[]),O.scaleValue&&h[y].ranking[x].push(O.scaleValue)}};for(let E of I){let P=(s=f==null?void 0:f[E])==null?void 0:s.participant;if((P==null?void 0:P.participantType)!==Zt)for(let M of(P==null?void 0:P.individualParticipantIds)??[]){let N=(l=f==null?void 0:f[M])==null?void 0:l.participant;b(N)}else b(P)}let D=h[y].ratings;for(let E of Object.keys(D)){let P=D[E];if(!P.length)continue;let M=(c=sY(P))==null?void 0:c.toFixed(2);h[y].ratingsStats[E]={avg:parseFloat((m(P)/P.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...P),min:Math.min(...P)}}let w=(E,P)=>{var M,N;let R=A=>{var _,O,x,F,$,V,G,j,z,H;if((_=h[y].draws)!=null&&_[E]&&(O=A==null?void 0:A.ratings)!=null&&O[v])for(let K of((x=A==null?void 0:A.ratings)==null?void 0:x[v])??[]){let q=K.scaleName;(F=h[y].draws[E])!=null&&F.ratings[q]||(h[y].draws[E].ratings[q]=[]);let Y=($=rs[q])==null?void 0:$.accessor;if(Y){let Z=parseFloat((V=K.scaleValue)==null?void 0:V[Y]);Z&&h[y].draws[E].ratings[q].push(Z)}}if((G=h[y].draws)!=null&&G[E]&&(j=A==null?void 0:A.rankings)!=null&&j[v])for(let K of((z=A==null?void 0:A.rankings)==null?void 0:z[v])??[]){let q=K.scaleName;(H=h[y].draws[E])!=null&&H.ranking[q]||(h[y].draws[E].ranking[q]=[]);let Y=K.scaleValue;Y&&h[y].draws[E].ranking[q].push(Y)}};for(let A of P.filter(Boolean)){let _=(M=f==null?void 0:f[A])==null?void 0:M.participant;if((_==null?void 0:_.participantType)!==Zt)for(let O of(_==null?void 0:_.individualParticipantIds)??[]){let x=(N=f==null?void 0:f[O])==null?void 0:N.participant;R(x)}else R(_)}},S=[],U=E=>(a==null?void 0:a.length)&&a.includes(E)||S.includes(E);for(let E of g.drawDefinitions??[]){let P=E.drawId;if(U(P))continue;let M=Og({drawDefinition:E}).assignedParticipantIds??[];h[y].draws[P]||(h[y].draws[P]={ratingsStats:{},ratings:{},ranking:{}}),S.push(P),w(P,M)}let C=Vn({event:g}).flightProfile;for(let E of(C==null?void 0:C.flights)??[]){let P=E.drawId;if(U(P))continue;let M=E.drawEntries.map(Yt);w(P,M)}for(let E of S){let P=h[y].draws[E].ratings;for(let M of Object.keys(P)){let N=P[M];if(!N.length)continue;let R=(u=sY(N))==null?void 0:u.toFixed(2);h[y].draws[E].ratingsStats[M]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return ft({eventScaleValues:h,events:p,...re})}function $4({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var r;if(!t)return{error:Ne};if(!n)return{error:_i};let a=ot(n);i&&Object.assign(a,i);let o=e&&((r=a.drawDefinitions)==null?void 0:r.find(({drawId:s})=>e.drawId===s));return ft({drawDefinition:o,event:a})}function TGe(t){var e,i;let n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:a}=PGe(t),o=CGe({...t,policyDefinitions:a,appliedPolicies:r}),s=DGe(t),l=EGe({...t,consideredEntries:s,appliedPolicies:r});if(l!=null&&l.error)return oe({result:l,stack:n});let c=MGe({...t,consideredEntries:s}),u=UGe({...t,appliedPolicies:r,policyDefinitions:a,drawSize:c});if(u.error)return oe({result:u,stack:n});let d=u.drawType;if(isNaN(c)&&d!==Ol)return oe({result:{error:$P},stack:n});let p=(a==null?void 0:a[fl])??(r==null?void 0:r[fl]),h=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(a[fl]||(a[fl]={...BB[fl]}),a[fl].seedingProfile=h);let f=RGe({...t,drawType:d});return f!=null&&f.error?oe({result:f,stack:n}):{drawSize:c,drawType:d,enforceGender:o,seedingProfile:h,appliedPolicies:r,policyDefinitions:a}}function UGe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,a=t.drawTypeCoercion??FC({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),o=sfe({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:a,drawSize:r});return o.error?o:{drawType:o.drawType}}function gge(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...Yl,cC].includes(e.entryStatus))}function DGe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||gge(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===nt)}function PGe(t){let{tournamentRecord:e,event:i}=t,n=Mi({tournamentRecord:e,event:i}).appliedPolicies??{},r=ot(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function CGe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,a,o;return t??((r=(n=e==null?void 0:e[Or])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((o=(a=i==null?void 0:i[Or])==null?void 0:a.participants)==null?void 0:o.enforceGender)}function EGe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:a,participants:o,event:s}=t;return s&&o&&cO({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:a,enforceGender:r,participants:o,event:s})}function MGe(t){return!t.drawSize&&t.consideredEntries.length&&![Ol,JP,z0,xl,Dd].includes(t.drawType??"")&&F0(t.consideredEntries.length)||t.drawSize&&St(t.drawSize)||!1}function RGe(t){var e,i;let{tournamentRecord:n,event:r,ignoreAllowedDrawTypes:a,drawType:o}=t,s=!a&&n&&yO({tournamentRecord:n,categoryType:(e=r==null?void 0:r.category)==null?void 0:e.categoryType,categoryName:(i=r==null?void 0:r.category)==null?void 0:i.categoryName});return s!=null&&s.length&&!s.includes(o)?{error:TW}:{...re}}function NO(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:a,participantMap:o}=$n({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=gge(n==null?void 0:n.entries)??[],l=TGe({...t,participantMap:o,participants:a,eventEntries:s});if(l.error)return oe({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=Aje({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return oe({result:v,stack:r});let{matchUpFormat:y,tieFormat:I}=v;if(t.drawId&&typeof t.drawId!="string")return oe({result:{error:Ie},stack:r});let b=oGe({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:a,eventEntries:s,matchUpType:g,tieFormat:I,drawSize:d,drawType:p,event:n});if(b.error)return oe({result:b,stack:r});let{existingDrawDefinition:D,positioningReports:w,drawDefinition:S,structureId:U,conflicts:C,entries:E}=b;if(!S)return oe({result:{error:Ie},stack:r});let P=sGe({...t,existingDrawDefinition:D,positioningReports:w,appliedPolicies:c,drawDefinition:S,seedingProfile:f,participants:a,structureId:U,entries:E,params:t,stack:r});if(P.error)return P;let{qualifyingConflicts:M}=P;return S.drawName=t.drawName??(p&&ia(p)),d&&typeof e=="object"&&d>=4&&pq({...e,drawDefinition:S,matchUpType:g}),{existingDrawDefinition:!!D,qualifyingConflicts:M,positioningReports:w,drawDefinition:S,structureId:U,...re,conflicts:C}}function vge({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:dt,info:"missing scaleAttributes"};let a=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let o=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:a[s],eventType:t.eventType,scaleType:Qu,scaleName:r,scaleDate:o}],participantId:s}))}}function NGe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:a,drawId:o,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=PO({policyDefinitions:i,drawDefinition:e,drawSize:a,drawId:o,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Ie};let m=II({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=vge({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var yge={};Ht(yge,{addDrawEntries:()=>sq,addEventEntries:()=>id,addEventEntryPairs:()=>Tge,destroyPairEntries:()=>Lpe,destroyPairEntry:()=>dq,getEntriesAndSeedsCount:()=>PO,getMaxEntryPosition:()=>U4,modifyEntriesStatus:()=>KR,modifyEventEntries:()=>Uge,mutate:()=>Ige,promoteAlternate:()=>wge,promoteAlternates:()=>V4,query:()=>cge,removeDrawEntries:()=>Sge,removeEventEntries:()=>SC,setEntryPosition:()=>B4,setEntryPositions:()=>bge});var Ige={};Ht(Ige,{addDrawEntries:()=>sq,addEventEntries:()=>id,addEventEntryPairs:()=>Tge,destroyPairEntries:()=>Lpe,destroyPairEntry:()=>dq,modifyEntriesStatus:()=>KR,modifyEventEntries:()=>Uge,promoteAlternate:()=>wge,promoteAlternates:()=>V4,removeDrawEntries:()=>Sge,removeEventEntries:()=>SC,setEntryPosition:()=>B4,setEntryPositions:()=>bge});function B4({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:a}){let o="setEntryPositions";if(!t)return{error:Ne};if(!i)return oe({result:{error:vr},stack:o});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Ie,entryPosition:n};((a==null?void 0:a.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(a!=null&&a.entries&&(s(a),a.entries=Uc({entries:a.entries})),e!=null&&e.entries&&(s(e),e.entries=Uc({entries:e.entries}))),{...re}}function bge({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:Ne};if(!Array.isArray(e))return{error:Ie};for(let r of e){let{participantId:a,entryPosition:o}=r,s=B4({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:a,entryPosition:o,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=Uc({entries:n.entries})),i!=null&&i.entries&&(i.entries=Uc({entries:i.entries})),{...re}}function wge(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Ie,participantId:e}:V4({...t,participantIds:[e].filter(Boolean)})}function V4({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=nt,eventId:a,event:o}){if(!t)return{error:Ne};if(!Array.isArray(i))return{error:Ie,participantIds:i};if(!o)return{error:_i};let s="promoteAlternates";if(o){let l=qY({element:o,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=qY({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return a?oe({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...re},stack:s}):l}return{...re}}function qY({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Ul),a=(i.entries||[]).filter(d=>t.includes(d.participantId)),o=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),s=a.length?a:[o].filter(Boolean);if(!(s!=null&&s.length))return{error:rue};let l=s.filter(({entryStatus:d})=>d!==Ul);if(l.length)return{error:tB,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:Fxe,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:$xe,invalidStageSequence:u};for(let d of s){d.entryStatus=hs;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Ul&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===hs&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>St(f||0)),0);d.entryPosition=h||0}return{...re}}function Sge({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:a}){var o;if(!a)return{error:_i};if(!n)return{error:Fc};if(!(e!=null&&e.length))return{error:Rf};let s=Og({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(Ya(s,e))return{error:O0};let l=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:c}=Vn({event:a}),u=(o=c==null?void 0:c.flights)==null?void 0:o.find(d=>d.drawId===n);return u!=null&&u.drawEntries&&(u.drawEntries=u.drawEntries.filter(l),t&&(u.drawEntries=Uc({entries:u.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(l),t&&(i.entries=Uc({entries:i.entries}))),{...re}}function bu(t){var e,i,n,r,a;let o="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:c,pairOverride:u,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:Ne};if(!d)return oe({result:{error:tI},stack:o});d.participantId||(d.participantId=xi()),p.participants||(p.participants=[]);let{participantId:h,individualParticipantIds:f}=d;if(p.participants.reduce((b,D)=>D.participantId===h||b,!1))return{error:Qce};let{participantType:m,participantRole:g}=d;if(!m||!Object.keys(mT).includes(m))return{error:Mc,participantType:m};if(!g)return{error:Jce};let v=p.participants||[],y=v.filter(b=>b.participantType===Zt).map(b=>b.participantId);if(m!==Zt&&d.person)return{error:Ie,person:d.person};if(f&&!Array.isArray(f))return{error:Ie,individualParticipantIds:f};if(m===Ot){if(d.person)return{error:Ie,person:d.person};if(d.individualParticipantIds){if(d.individualParticipantIds.length!==2&&!u)return oe({info:"PAIR must be 2 individualParticipantIds",result:{error:Tl},stack:o});{let w=v.filter(S=>S.participantType===Zt).map(S=>S.participantId);if(!Array.isArray(d.individualParticipantIds))return oe({result:{error:Tl},stack:o});if(!d.individualParticipantIds.reduce((S,U)=>w.includes(U)&&S,!0))return oe({result:{error:Tl},stack:o})}}else return oe({result:{error:Rf},stack:o});let b=v.filter(w=>w.participantType===Ot).map(w=>({individualParticipantIds:w.individualParticipantIds,participant:w})),D=d.participantType===Ot&&b.find(w=>Ln(w.individualParticipantIds,d.individualParticipantIds).length===2);if(D&&!s)return{...re,existingParticipant:!0,participant:l&&ot(D.participant)};if(!d.participantName){let w=v.filter(U=>{var C;return(C=d.individualParticipantIds)==null?void 0:C.includes(U.participantId)}),S=w.map(U=>{var C;return(C=U.person)==null?void 0:C.standardFamilyName}).filter(Boolean).join("/");w.length===1&&(S+="/Unknown"),d.participantName=S}}else if(m===Zt){if(!((n=d.person)!=null&&n.standardFamilyName)||!((r=d.person)!=null&&r.standardGivenName))return{error:nue};if(!d.participantName){let b=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=b}}else if(m&&[Gi,bs].includes(m)){if(f||(d.individualParticipantIds=[]),(a=d.individualParticipantIds)==null?void 0:a.length)for(let b of d.individualParticipantIds){if(typeof b!="string")return oe({result:{participantId:b,error:Ie},stack:o});if(!y.includes(b))return oe({result:{participantId:b,error:Gn},stack:o})}}else return{error:Mc};p.participants.push(d),c||ti({payload:{tournamentId:p.tournamentId,participants:[d]},topic:nf});let I={participant:l&&ot(d),...re};return ft(I)}function Ac({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:Ne};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=xi())});let a=n.filter(d=>!r.includes(d.participantId)),o=n.filter(d=>r.includes(d.participantId)),s=a.filter(d=>d.participantType===Zt),l=a.filter(d=>d.participantType!==Zt),c=s.concat(...l),u=[];if(c.length){for(let p of c){let h=bu({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&ti({topic:nf,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&ot(u),addedCount:u.length,...re};return o.length&&Object.assign(d,{notAdded:o,info:fk}),ft(d)}else return{info:"No new participants to add",addedCount:0,...re}}function Tge({allowDuplicateParticipantIdPairs:t,entryStage:e=nt,entryStatus:i=Ul,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:a,event:o,uuids:s}){if(!r)return{error:Ne};if(!o)return{error:_i};if(o.eventType!==qi)return{error:Jh};let l=[],c=new Map;for(let y of r.participants??[]){let{participantType:I,participantId:b,person:D,individualParticipantIds:w}=y;I===Zt&&D!=null&&D.sex?c.set(b,D.sex):I===Ot&&w&&l.push(w)}let u=n.filter(y=>{if(y.length!==2||!c.has(y[0])||!c.has(y[1]))return!0;if(!o.gender||o.gender===vu)return!1;let I=y.map(D=>c.get(D)),b=o.gender===zi&&(I[0]!==zi||I[1]!==zi)||o.gender===gn&&(I[0]!==gn||I[1]!==gn);return o.gender===Fo&&(I.sort(Wk),(I[0]!==gn||I[1]!==zi)&&(b=!0)),b});if(u.length)return{error:Tl,invalidParticipantIdPairs:u};let d=n.map(y=>({participantId:(s==null?void 0:s.pop())??xi(),participantRole:va,individualParticipantIds:y,participantType:Ot})),p=t?d:d.filter(y=>!l.find(I=>Ln(I,y.individualParticipantIds).length===2)),h,f=[];if(p){let y=Ac({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(y.error)return y;f=y.participants||[],h=y.info}let m=n.map(y=>{let I=f.find(D=>Ln(D.individualParticipantIds,y).length===2);if(I)return I;let{participant:b}=Fl({tournamentRecord:r,participantIds:y});return b}).map(y=>y.participantId),g=id({participantIds:m,tournamentRecord:r,drawDefinition:a,entryStatus:i,entryStage:e,event:o});p.length&&ti({payload:{participants:p},topic:nf});let v=p.map(Yt);return{...g,info:h,newParticipantIds:v}}function Uge({entryStatus:t=hs,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=nt,tournamentRecord:r,event:a}){if(!r)return{error:Ne};if(!a)return{error:_i};let o=r.participants??[],s=o.filter(m=>m.participantType===Zt).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:Tl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:Tl,invalidParticipantIdPairs:c};let u=o.filter(m=>m.participantType===Ot).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>Ln(g,m).length===2)).map(m=>({participantType:Ot,participantRole:va,individualParticipantIds:m})),p=Ac({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=Fl({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:Kl,participantId:m,entryStage:n}));return a.entries=(a.entries??[]).filter(m=>m.entryStage===n),a.entries=a.entries.concat(...h,...f),{...re}}var Dge={};Ht(Dge,{addDrawDefinition:()=>kO,addEvent:()=>WC,addFlight:()=>xO,assignSeedPositions:()=>Oge,attachFlightProfile:()=>q4,categoryCanContain:()=>iO,deleteDrawDefinitions:()=>AO,deleteEvents:()=>Lge,deleteFlightAndFlightDraw:()=>_ge,deleteFlightProfileAndFlightDraws:()=>Mge,getCategoryAgeDetails:()=>_C,getEvent:()=>$4,getEventProperties:()=>L4,getEventStructures:()=>Zk,getEventTimeItem:()=>gC,getEvents:()=>F4,getFlightProfile:()=>Vn,getScaledEntries:()=>II,modifyEvent:()=>Fge,modifyEventMatchUpFormatTiming:()=>Rge,modifyPairAssignment:()=>kge,mutate:()=>Pge,query:()=>mge,refreshEventDrawOrder:()=>W4,removeEventMatchUpFormatTiming:()=>_O,removeScaleValues:()=>K4,removeSeeding:()=>xge,setEventDates:()=>Nge,setEventDisplay:()=>OO,setEventEndDate:()=>H4,setEventStartDate:()=>G4,updateDrawIdsOrder:()=>z4,validateCategory:()=>eN});var Pge={};Ht(Pge,{addDrawDefinition:()=>kO,addEvent:()=>WC,addFlight:()=>xO,assignSeedPositions:()=>Oge,attachFlightProfile:()=>q4,deleteDrawDefinitions:()=>AO,deleteEvents:()=>Lge,deleteFlightAndFlightDraw:()=>_ge,deleteFlightProfileAndFlightDraws:()=>Mge,modifyEvent:()=>Fge,modifyEventMatchUpFormatTiming:()=>Rge,modifyPairAssignment:()=>kge,refreshEventDrawOrder:()=>W4,removeEventMatchUpFormatTiming:()=>_O,removeScaleValues:()=>K4,removeSeeding:()=>xge,setEventDates:()=>Nge,setEventDisplay:()=>OO,setEventEndDate:()=>H4,setEventStartDate:()=>G4,updateDrawIdsOrder:()=>z4,validateCategory:()=>eN});function aS({removePriorValues:t=!0,status:e=Zl,statusObject:i,event:n}){if(!on(i))return{error:Ie};let r=tl({event:n,status:e}),a=`${Ng}.${Ag}`,o={itemValue:{[e]:{...r,...i}},itemType:a};return yI({timeItem:o,removePriorValues:t,event:n})}function oS(t){var e,i,n,r,a,o,s;let{includePositionAssignments:l,removePriorValues:c,tournamentRecord:u,status:d=Zl,event:p,drawIdsToRemove:h,drawIdsToAdd:f}=t;if(!u)return{error:Ne};if(!p)return{error:_i};let{appliedPolicies:m}=Mi({tournamentRecord:u,event:p}),g={...m,...t.policyDefinitions},v=((e=p.drawDefinitions)==null?void 0:e.map(({drawId:P})=>P))??[],y=t.drawDetails?Object.keys(t.drawDetails):[],I=y.length?[]:t.drawIds,b=(f??[]).concat(...h??[],...I??[],...y),D=b.filter(P=>!v.includes(P));if(D.length)return oe({result:{error:zo},context:{invalidDrawIds:D}});let w=tl({event:p,status:d}),S=Object.keys((w==null?void 0:w.drawDetails)||{}).filter(P=>v.includes(P)).reduce((P,M)=>(P[M]=w.drawDetails[M],P),{});for(let P of v)if((!b.length||b.includes(P))&&(h!=null&&h.includes(P)||I!=null&&I.length&&!I.includes(P)?S[P]={...S[P],publishingDetail:{published:!1}}:(f!=null&&f.includes(P)||I!=null&&I.includes(P)||!(I!=null&&I.length))&&(S[P]={...S[P],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[P]){let M=t.drawDetails[P],N=M.structureDetails??S[P].structureDetails,R=M.stageDetails??S[P].stageDetails??{},{structureIdsToRemove:A=[],structureIdsToAdd:_=[],publishingDetail:O={},stagesToRemove:x=[],stagesToAdd:F=[]}=M;if((_||F)&&(O.published=!0),S[P]={publishingDetail:O,structureDetails:N,stageDetails:R},_.length||A.length){let V=(((r=(n=p.drawDefinitions)==null?void 0:n.find(j=>j.drawId===P))==null?void 0:r.structures)??[]).map(({structureId:j})=>j),G=(_??[]).concat(A??[]).filter(j=>!V.includes(j));if(G.length)return oe({result:{error:wn},context:{invalidStructureIds:G}});N=N??{};for(let j of V)A.includes(j)?N[j]={published:!1}:N[j]={published:!0};S[P].structureDetails=N}let $=(((o=(a=p.drawDefinitions)==null?void 0:a.find(V=>V.drawId===P))==null?void 0:o.structures)??[]).map(({stage:V})=>V);if(F.length){for(let V of F)R[V]={published:!0};for(let V of $)R[V]||(R[V]={published:!1})}if(F.length||x.length){for(let V of x)R[V]={published:!1};for(let V of $)R[V]||(R[V]={published:!0})}(F.length||x.length)&&(S[P].stageDetails=R)}aS({statusObject:{drawDetails:S},removePriorValues:c,status:d,event:p});let{topics:U}=Wl(),C=U.includes(dB),E=C||t.returnEventData?(s=SO({includePositionAssignments:l,usePublishState:!0,tournamentRecord:u,policyDefinitions:g,event:p}))==null?void 0:s.eventData:void 0;return C&&ti({payload:{eventData:E,tournamentId:u.tournamentId},topic:dB}),{...re,eventData:E}}var Cge="deleteDrawDefinitions",Ege="autoSchedulingAudit",jB="deleteEvents",AGe={AUTO_SCHEDULING_AUDIT:Ege,DELETE_EVENTS:jB,DELETE_DRAW_DEFINITIONS:Cge};function AO(t){var e,i,n;if(!t.tournamentRecord)return{error:Ne};let r="deleteDrawDefinitions",a=t.drawIds??[],o=t.event,{autoPublish:s=!0,tournamentRecord:l,auditData:c,eventId:u,force:d}=t,{appliedPolicies:p}=Mi({tournamentRecord:l,event:o}),h={...p,...t.policyDefinitions},f=Array.isArray(a)?a[0]:void 0;if(!o){let P=po({tournamentRecord:l,eventId:u,drawId:f});if(P.error)return P;o=P.event}let m=[],g=[],v=[];if(!(o!=null&&o.drawDefinitions))return oe({info:"event has no drawDefinition",result:{...re},stack:r});let y=o.drawDefinitions.map(({drawId:P})=>P);if(a.length||(a=y),a=a.filter(P=>y.includes(P)),!a.length)return oe({info:"nothing to do; no matching drawIds in event.",result:{...re},stack:r});let I=ot(Vn({event:o}).flightProfile,!1,!0),b=({participantId:P,drawPosition:M,qualifier:N,bye:R})=>({bye:R,qualifier:N,drawPosition:M,participantId:P}),D=d??((i=(e=p==null?void 0:p[Sd])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),w=tl({event:o})??{},S=w.drawIds??(w.drawDetails&&Object.keys(w.drawDetails))??[],U,C=[],E=o.drawDefinitions.filter(P=>{var M,N,R,A,_,O,x,F;if(a.includes(P.drawId)){let $=((M=ro({event:o,drawDefinition:P}))==null?void 0:M.matchUps)??[];if($.some(({score:Q})=>zr({score:Q}))&&!D)return C.push(P.drawId),!0;let{drawId:V,drawType:G,drawName:j}=P,z=(N=I==null?void 0:I.flights)==null?void 0:N.find(Q=>Q.drawId===P.drawId);z&&(z.drawEntries=(R=z.drawEntries)==null?void 0:R.filter(Q=>Yl.includes(Q.entryStatus))),S.includes(V)&&(S=S.filter(Q=>Q!==V),U=!0);let H=(_=(A=Pd({stageSequence:1,drawDefinition:P,stage:nt}))==null?void 0:A.structures)==null?void 0:_[0],K=(x=(O=H?xU({structureId:H.structureId,tournamentRecord:l,drawDefinition:P}):void 0)==null?void 0:O.positionAssignments)==null?void 0:x.map(b),q=(F=Pd({stage:gt,drawDefinition:P}))==null?void 0:F.structures,Y=q!=null&&q.length?q.map(Q=>{var ie;let ue=Q.stageSequence;return{positionAssignments:(ie=xU({structureId:Q.structureId,tournamentRecord:l,drawDefinition:P}))==null?void 0:ie.positionAssignments.map(b),stageSequence:ue}}):void 0,Z={action:Cge,payload:{drawDefinitions:[P],eventId:u??(o==null?void 0:o.eventId),auditData:c}};v.push(Z),m.push(ft({tournamentId:l.tournamentId,eventId:u??(o==null?void 0:o.eventId),qualifyingPositionAssignments:Y,positionAssignments:K,auditData:c,drawType:G,drawName:j,drawId:V})),$==null||$.forEach(({matchUpId:Q})=>g.push(Q))}return!a.includes(P.drawId)});if(C.length&&!d)return oe({context:{drawIdsWithScoresPresent:C},result:{error:bk},stack:r});if(o.drawDefinitions=E,I&&Of({event:o,extension:{name:kl,value:I}}),jC({tournamentRecord:l}),U){let P={};for(let N of S)P[N]=((n=w.drawDetails)==null?void 0:n[N])??{published:!0};let M=aS({statusObject:{drawDetails:P},event:o});if(M.error)return{error:M.error}}if(v.length&&ti({topic:yw,payload:v}),g.length&&Zp({tournamentId:l==null?void 0:l.tournamentId,matchUpIds:g}),a.forEach(P=>{bFe({drawId:P})}),_Ge({event:o,deletedDrawsDetail:m,auditData:c}),s&&U){let P=oS({drawIdsToRemove:a,policyDefinitions:h,tournamentRecord:l,event:o});if(P.error)return{...re,info:P.error}}return{...re}}function _Ge({event:t,deletedDrawsDetail:e,auditData:i}){let{extension:n}=jt({name:VR,element:t}),r={...i,deletedDrawsDetail:e},a={name:VR,value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(r):[r]};ui({element:t,extension:a})}function Mge({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var a;if(!e)return{error:Ne};if(!n)return{error:_i};let{flightProfile:o}=Vn({event:n});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:c})=>c).filter(Boolean),l=AO({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:Pk({event:n,name:kl})}return{...re}}function j4(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:a}=t,o=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(o).length)return{error:Cn};let s=Object.keys(o).filter(c=>!r||r===c);if(r&&!s.includes(r))return{error:Ie};let l;for(let c of s){let u=o[c],{event:d}=po({tournamentRecord:u,eventId:a});a&&d&&(l=!0);let p=kGe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!a||l?{...re}:{error:Wo}}function kGe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:Ne};if(n&&!Array.isArray(n))return{error:Ie};if(e&&!Array.isArray(e))return{error:Ie};let a=Pp;if(r){let{extension:o}=jt({element:r,name:a}),s=(o==null?void 0:o.value)||{},l=KY({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});ui({element:r,extension:{name:a,value:l}})}else{let{extension:o}=jt({element:t,name:a}),s=(o==null?void 0:o.value)||{},l=KY({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});ui({extension:{name:a,value:l},element:t})}return{...re}}function KY(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:a}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let o=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});a=(a||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(a==null?void 0:a.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:a});return{matchUpAverageTimes:(o==null?void 0:o.length)&&o||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Rge(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:a,eventId:o,event:s}=t;if(!e)return{error:Ne};if(!Zo({matchUpFormat:r}))return{error:Ie};if(!s)return{error:_i};let{averageTimes:l=[],recoveryTimes:c=[]}=CO({tournamentRecord:e,matchUpFormat:r,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=I=>{var b,D;if((b=I.categoryTypes)!=null&&b.includes(a)&&console.log("encountered:",{categoryType:a}),!((D=I.categoryNames)!=null&&D.includes(d)&&(I.categoryNames=I.categoryNames.filter(w=>w!==d),p={minutes:I.minutes,categoryNames:[d]},!I.categoryNames.length)))return I},m=n&&!isNaN(St(n)),g=i&&!isNaN(St(i)),v=l.map(f).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length}),y=c.map(f).filter(I=>{var b;return(b=I==null?void 0:I.categoryNames)==null?void 0:b.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||Un]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(s==null?void 0:s.eventType)||Un]:i}),y.push(h)),!m&&!g?{error:Ie}:j4({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:o,event:s})}function _O(t){if(t.event)return YY({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=vi(t,[{[Ta]:!0,[Zue]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:a}=po({tournamentRecord:r,eventId:n});if(a)return YY({event:a})}}return{error:Wo}}function YY({event:t}){return Pk({event:t,name:Pp})}function G4({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Ne};if(!e)return{error:_i};if(!bd.test(i))return{error:Ka};let n=Age(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Lt(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ka};let s=e.endDate&&new Date(Lt(e.endDate)).getTime();return s&&o>s&&(e.endDate=i),e.startDate=i,{...re}}function H4({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:Ne};if(!e)return{error:_i};if(!bd.test(i))return{error:Ka};let n=Age(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:a}=n,o=new Date(Lt(i)).getTime();if(!r||!a||o<r||o>a)return{error:Ka};let s=e.startDate&&new Date(Lt(e.startDate)).getTime();return s&&o<s&&(e.startDate=i),e.endDate=i,{...re}}function Nge({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:Ne};if(!e)return{error:_i};if(!i&&!n)return{error:dt,info:"missing date"};if(i&&!bd.test(i))return{error:Ka};if(n&&!bd.test(n))return{error:Ka};if(i&&n){let r=new Date(Lt(i)).getTime(),a=new Date(Lt(n)).getTime();if(r>a)return{error:Ie}}if(i){let r=G4({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){let r=H4({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...re}}function Age(t){let{startDate:e,endDate:i}=t;return!bd.test(e)||!bd.test(i)?oe({result:{error:Kce},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Lt(e)).getTime(),tournamentEndDate:new Date(Lt(i)).getTime()}}function z4({event:t,orderedDrawIdsMap:e}){var i,n;if(typeof t!="object")return{error:_i};if(!e)return{error:dt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Ie,info:"orderedDrawIdsMap must be an object"};let r=Object.values(e);if(!r.every(o=>!isNaN(o)))return{error:Ie,info:"drawOrder must be numeric"};if($t(r).length!==r.length)return{error:Ie,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){let o=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Ln(o,s).length!==o.length)return{error:Ie,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:a}=Vn({event:t});return(n=a==null?void 0:a.flights)==null||n.forEach(o=>{o.flightNumber=e[o.drawId]}),{...re}}function W4({tournamentRecord:t,event:e}){var i;if(!t)return{error:Ne};if(!e)return{error:_i};let{flightProfile:n}=Vn({event:e}),r=(n==null?void 0:n.flights)&&Object.assign({},...n.flights.sort((a,o)=>a.flightNumber-o.flightNumber).map((a,o)=>({[a.drawId]:o+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((a,o)=>a.drawOrder-o.drawOrder).map((a,o)=>({[a.drawId]:o+1})))||void 0;return r?z4({event:e,orderedDrawIdsMap:r}):{...re}}function _ge({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:a}){var o,s;if(!e)return{error:Ne};if(!n)return{error:Fc};if(!r)return{error:_i};let{flightProfile:l}=Vn({event:r});if(l&&(o=l.flights)!=null&&o.find(c=>c.drawId===n)){let c=l.flights.filter(d=>d.drawId!==n),u={name:kl,value:{...l,flights:c}};Of({event:r,extension:u})}if((s=r.drawDefinitions)!=null&&s.find(c=>c.drawId===n)){let c=AO({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:a});if(c.error)return c}return W4({tournamentRecord:e,event:r})}function kge({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:a,uuids:o}){var s,l;if(!a)return{error:_i};if((a==null?void 0:a.eventType)!==Ll)return{error:Jh};if(o&&!Array.isArray(o))return{error:Ie};if(!i)return{error:Ne};if(![t,e,r].every(g=>typeof g=="string"))return{error:vr};if(!(((s=a==null?void 0:a.entries)==null?void 0:s.filter(({entryStatus:g})=>[Kl,Eg].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:hu};let c=(i.participants||[]).find(g=>g.participantId===r);if((c==null?void 0:c.participantType)!==Ot)return{error:k0,participant:c};let u=c.individualParticipantIds,d=[t,...u.filter(g=>g!==e)],{participant:p}=Fl({participantIds:d,tournamentRecord:i}),h;if(p)h=p.participantId;else{let g={participantId:o==null?void 0:o.pop(),participantRole:va,individualParticipantIds:d,participantType:Ot},v=bu({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;h=v.participant.participantId}let{flightProfile:f}=Vn({event:a});if(n){let g=(l=f==null?void 0:f.flights)==null?void 0:l.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:h}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:h}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:h}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(I=>I.participantId===r?{...I,participantId:h}:I)}a.entries=a.entries.map(g=>g.participantId===r&&{...g,participantId:h}||g.participantId===t&&{...g,participantId:e}||g);let m=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>a.eventId===v?y.some(({drawId:I,entries:b})=>I===(n==null?void 0:n.drawId)?!1:b==null?void 0:b.find(D=>D.participantId===r)):g==null?void 0:g.find(I=>I.participantId===r));if(!m){let g=fI({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...re,participantOtherEntries:m,newPairParticipantId:h}}function kO(t){var e,i,n,r,a,o,s,l,c,u,d,p;let{flight:h,suppressNotifications:f,modifyEventEntries:m,existingDrawCount:g,allowReplacement:v,checkEntryStatus:y,tournamentRecord:I,drawDefinition:b,event:D}=t;if(!b)return{error:tt};if(!D)return{error:_i};D.drawDefinitions||(D.drawDefinitions=[]);let{drawId:w,drawName:S,entries:U}=b,{entries:C}=D,E=0;if(g!==void 0&&g!==D.drawDefinitions.length)return{error:Ie,info:"drawDefintions count mismatch"};let{flightProfile:P}=Vn({event:D}),M=h&&((e=P==null?void 0:P.flights)==null?void 0:e.find(z=>z.flightNumber===h.flightNumber)),N=(r=(n=(i=P==null?void 0:P.links)==null?void 0:i.find(z=>{var H;return((H=z==null?void 0:z.target)==null?void 0:H.drawId)===w}))==null?void 0:n.source)==null?void 0:r.drawId;if(N&&!D.drawDefinitions.find(z=>z.drawId===N))return oe({result:{error:tt},info:{sourceDrawId:N}});if(M&&M.drawId!==b.drawId)return oe({result:{error:Cv},info:{relevantFlight:M}});let R=U==null?void 0:U.every(({participantId:z,entryStatus:H})=>{let K=M==null?void 0:M.drawEntries.find(q=>q.participantId===z);return!H||(K==null?void 0:K.entryStatus)===H}),A=!y||C&&(U==null?void 0:U.every(({participantId:z,entryStatus:H,entryStage:K})=>{var q;return((q=C.find(Y=>Y.participantId===z&&(!Y.entryStage||Y.entryStage===K)))==null?void 0:q.entryStatus)===H}));if(M&&!R)return oe({result:{error:Cv},context:{drawEntriesPresentInFlight:R,matchingEventEntries:A,relevantFlight:M},info:"Draw entries are not present in flight or do not match entryStatuses"});if(m&&(U==null||U.filter(Boolean).forEach(z=>{if(z!=null&&z.entryStatus&&Yl.includes(z==null?void 0:z.entryStatus)){let H=C==null?void 0:C.filter(Boolean).find(K=>K.participantId===z.participantId);H&&z.entryStatus&&(H==null?void 0:H.entryStatus)!==z.entryStatus&&(H.entryStatus=z.entryStatus,E+=1)}})),C&&!A)return oe({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:A,eventEntries:C},error:Cv}});let _=((o=(a=P==null?void 0:P.flights)==null?void 0:a.map(({flightNumber:z})=>!isNaN(z)&&St(z)))==null?void 0:o.filter(Boolean))||[],O=((s=D.drawDefinitions.map(({drawOrder:z})=>z&&St(z)))==null?void 0:s.filter(Boolean))||[],x=Math.max(0,...O,..._)+1,F=(l=P==null?void 0:P.flights)==null?void 0:l.find(z=>z.drawId===w),$;if(F){F.drawName=b.drawName,$={name:kl,value:{...P,flights:P.flights}};let z=F.flightNumber;z&&!O.includes(z)?x=z:F.flightNumber=x}else{let z=(P==null?void 0:P.flights)||[];z.push({manuallyAdded:!0,flightNumber:x,drawEntries:U,drawName:S,drawId:w}),$={name:kl,value:{...P||{},flights:z}}}Of({event:D,extension:$}),Object.assign(b,{drawOrder:x});let V=D.drawDefinitions.find(z=>z.drawId===w),G=I==null?void 0:I.tournamentId,j=D.eventId;if(V){if(!v)return{error:Pce};let z=((u=(c=ro({drawDefinition:V}))==null?void 0:c.matchUps)==null?void 0:u.map(Cr))??[],H=(d=ro({drawDefinition:b}))==null?void 0:d.matchUps;if(!f){z!=null&&z.length&&Zp({matchUpIds:z,action:"modifyDrawDefinition",tournamentId:G,eventId:j}),H!=null&&H.length&&rf({matchUps:H,tournamentId:G,eventId:j}),D.drawDefinitions=D.drawDefinitions.map(q=>q.drawId===w?b:q);let K=(p=b.structures)==null?void 0:p.map(({structureId:q})=>q);Ji({drawDefinition:b,tournamentId:G,structureIds:K,eventId:j})}}else if(D.drawDefinitions.push(b),!f){let{matchUps:z}=ro({drawDefinition:b,event:D});z&&rf({tournamentId:I==null?void 0:I.tournamentId,matchUps:z}),tC({drawDefinition:b,tournamentId:G,eventId:j})}return{...re,modifiedEventEntryStatusCount:E}}function Oge(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:CW};if(!n)return{error:Ne};if(!l)return{error:Fc};let d=Ks({provisionalPositioning:e,drawDefinition:r,structureId:o});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==Aue(g).length)return{error:Cce};for(let v of m){let y=tS({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:a,structureId:o,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...re,modifications:u}:{error:L0}}function q4({deleteExisting:t,event:e,flightProfile:i}){var n;let r="attachFlightProfile";if(!i)return oe({result:{error:dt},stack:r});if(!e)return oe({result:{error:_i},stack:r});let{flightProfile:a}=Vn({event:e});return a&&!t?oe({result:{error:WW},stack:r}):(n=e.drawDefinitions)!=null&&n.length?oe({result:{error:Tce},stack:r}):(Of({event:e,extension:{name:kl,value:i}}),{flightProfile:ot(i,!1,!0),...re})}function OGe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var n;if(!t)return{error:Ne};if(!i)return{error:Rf};if(!e)return{error:dt,info:"scaleAttributes required"};let{scaleType:r,eventType:a,scaleName:o}=e,s=[Qde,r,a,o].join(".");return(n=t.participants)==null||n.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==s))}),{...re}}function K4({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:a,stage:o}){var s;if(!a)return{error:_i};if(n&&!Array.isArray(n))return oe({result:{error:Ie},info:Ed("entryStatus"),stack:"removeScaleValues"});let l=a.entries;if(r){let{flightProfile:u}=Vn({event:a}),d=(s=u==null?void 0:u.flights)==null?void 0:s.find(p=>p.drawId===r);d?l=d.drawEntries:l=i==null?void 0:i.entries}let c=(l||[]).filter(u=>(!o||!u.entryStage||u.entryStage===o)&&(!n||n.includes(u.entryStatus))).map(Yt);return OGe({tournamentRecord:t,scaleAttributes:e,participantIds:c})}function OO({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=Zl,event:r}){if(!e)return oe({result:{error:Ne}});if(!r)return oe({result:{error:_i}});if(!on(i))return oe({result:{error:dt}});if(on(i.draws))for(let o of Object.keys(i.draws)){let s=i.draws[o].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>Txe(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[o].scheduleDetails=l}}let a=aS({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return a.error?a:{...re}}function xge({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:a,stage:o}){var s,l;if(!t)return{error:Ne};if(!a)return{error:_i};n=n||((s=a.category)==null?void 0:s.categoryName)||((l=a.category)==null?void 0:l.ageCategoryCode);let c={eventType:a.eventType,scaleType:Qu,scaleName:n};return K4({tournamentRecord:t,scaleAttributes:c,drawDefinition:e,entryStatuses:i,drawId:r,event:a,stage:o})}function Lge({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:Ne};if(!e.events)return{error:Wo};if(!Array.isArray(i))return{error:dt,info:Ed("drawIds")};let n=[],r=[],a=[],o=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let u={action:jB,payload:{events:[s]}};n.push(u),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===Ll?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Kl&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?o.push(...l):a.push(...l),!c}),t){let s=o.filter(l=>!a.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return jC({tournamentRecord:e}),n.length&&(ti({topic:yw,payload:n}),vI({tournamentRecord:e,timeItem:{itemType:jB,itemValue:r}})),{...re}}function Fge({tournamentRecord:t,eventUpdates:e,eventId:i,event:n}){var r;let a="modifyEvent";if(!t)return oe({result:{error:Ne},stack:a});if(!co(i))return oe({result:{error:_i},context:{eventId:i},stack:a});if(!on(e))return oe({result:{error:Ie},context:{eventUpdates:e},stack:a});let o=((r=n==null?void 0:n.entries)==null?void 0:r.filter(({entryStatus:h})=>{let f=h;return[...Yl,Ul].includes(f)}).map(({participantId:h})=>h))??[],s=o?$n({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],l=[],c=s.reduce((h,f)=>{var m,g;let v=(m=f.person)!=null&&m.sex?[f.person.sex]:((g=f.individualParticpants)==null?void 0:g.map(y=>{var I;return(I=y.person)==null?void 0:I.sex}))||[];return l.push(...v),h.includes(f.participantType)?h:h.concat(f.participantType)},[]),u=$t(l),d=!u.length||[Fo,vu].includes(e.gender??"")||u.length===1&&u[0]===e.gender;if(e.gender&&!d)return oe({context:{gender:e.gender,validGender:d},result:{error:Ie},stack:a});let p=(c.includes(Ur)&&[Ur]||c.includes(Zt)&&[Cd]||c.includes(Ot)&&[Ll]||[Ll,Cd,Ur]).includes(e.eventType??"");return e.eventType&&!p?oe({context:{participantType:e.eventType,validEventType:p},result:{error:Ie},stack:a}):(e.eventType&&(n.eventType=e.eventType),e.eventName&&(n.eventName=e.eventName),e.gender&&(n.gender=e.gender),{...re})}function xO({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:a}){var o,s,l;let c="addFlight";if(!r)return oe({result:{error:_i},stack:c});if(!i)return oe({result:{error:dt},stack:c});if(e!=null&&e.length){let g=(r.entries??[]).map(Yt),v=e.map(Yt);if(Ln(v,g).length!==v.length)return oe({result:{error:Ie},stack:c})}let u=(o=Vn({event:r}))==null?void 0:o.flightProfile,d=((l=(s=u==null?void 0:u.flights)==null?void 0:s.map(({flightNumber:g})=>!isNaN(g)&&St(g)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,h={drawId:n||xi(),flightNumber:p,drawEntries:e,drawName:i};if(a&&(h.stage=a),t&&(h.qualifyingPositions=t),((u==null?void 0:u.flights)||[]).find(({drawId:g})=>g===h.drawId))return oe({result:{error:Tue},stack:c});let f=((u==null?void 0:u.flights)||[]).concat(h),m={name:kl,value:{...u||{},flights:f}};return Of({event:r,extension:m})}var xGe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},LGe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},FGe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},$ge={COLLEGE_D3:xGe,COLLEGE_DEFAULT:LGe,COLLEGE_JUCO:FGe,DOMINANT_DUO:Ime,DOMINANT_DUO_MIXED:mme,LAVER_CUP:Ume,TEAM_DOUBLES_3_AGGREGATION:ume,TIME_TENNIS_DUAL:gme,TIME_TENNIS_PRO_CIRCUIT:fme,USTA_BREWER_CUP:vme,USTA_OZAKI_CUP:yme,USTA_COLLEGE:bme,USTA_GOLD_TEAM_CHALLENGE:cme,USTA_INTERSECTIONAL:hme,USTA_LEVEL_1:wme,USTA_SECTION_BATTLE:pme,USTA_SOUTHERN_LEVEL_5:dme,USTA_TOC:Dme,USTA_WTT_ITT:Sme,USTA_ZONAL:Tme};function WC({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var r,a,o,s;if(!e)return{error:Ne};if(e.events||(e.events=[]),!n)return{error:_i};let{startDate:l,endDate:c}=e;if(!i&&((r=n.entries)!=null&&r.length||(a=n.drawDefinitions)!=null&&a.length)){let d=ft({drawDefinitions:!!((o=n.drawDefinitions)!=null&&o.length),entries:!!((s=n.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:Ie,context:d}}let u={eventType:uy,drawDefinitions:[],entries:[],startDate:l,endDate:c,...n};if(n.eventType===Ys){if(n.tieFormat){let d=Po({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!$ge[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Ie};let d=my({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});u.tieFormat=d}}if(u.eventId||(u.eventId=xi()),e.events.reduce((d,p)=>d||p.eventId===u.eventId,void 0))return{error:xce};{let d=u;if(e.events.push(d),!t){let{topics:p}=Wl();if(p.includes(kk)){let h=eh({event:n}).matchUps??[];rf({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:h})}for(let h of n.drawDefinitions||[])tC({drawDefinition:h})}return{...re,event:u}}}var Bge={};Ht(Bge,{drawMatic:()=>l4,garman:()=>zge,generateAdHocMatchUps:()=>uO,generateAdHocRounds:()=>s4,generateAndPopulatePlayoffStructures:()=>kq,generateCourts:()=>Y4,generateDrawDefinition:()=>NO,generateDrawMaticRound:()=>Jq,generateDrawStructuresAndLinks:()=>Yq,generateDrawTypeAndModifyDrawDefinition:()=>Zq,generateFlightProfile:()=>VGe,generateLineUps:()=>Hge,generateQualifyingStructure:()=>Cq,generateSeedingScaleItems:()=>vge,generateVoluntaryConsolation:()=>vfe,roundRobinGroups:()=>eBe});var $Ge="splitLevelBased",Vge="splitWaterfall",jge="splitShuttle",BGe={SPLIT_LEVEL_BASED:$Ge,SPLIT_WATERFALL:Vge,SPLIT_SHUTTLE:jge};function VGe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,deleteExisting:o,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:_i};let f=p.entries??[],{flightProfile:m}=Vn({event:p});if(m&&i&&!o)return{error:WW};let g=t.scaledEntries??II({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:a,sortDescending:s,event:p,stage:h}).scaledEntries,v=g.map(Yt),y=Fa(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||Mg.includes(E.entryStatus)))),I=g.concat(...y),b=I.length,D=Math.ceil(b/c),w=jr(I,D);u===Vge?w=rB(I,c):u===jge&&(w=rB(I,c,!0));function S(E){return(E||[]).map(({participantId:P,scaleValue:M})=>{let N=f.find(R=>R.participantId===P);return N!=null&&N.scaleValue&&M&&(N.scaleValue=M),N}).sort((P,M)=>P.scaleValue-M.scaleValue).map((P,M)=>(P.scaleValue&&(P.seedNumber=M+1),P))}let U=Xe(0,c).map(E=>{let P=E+1;return{flightNumber:P,drawId:(d==null?void 0:d.pop())??xi(),drawEntries:S(w[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${P}`}}),C={scaleAttributes:r,splitMethod:u,flights:U};if(i){let E=q4({flightProfile:C,deleteExisting:o,event:p});return{splitEntries:qs()&&w||void 0,...E}}else return{flightProfile:C,...re}}var jGe="ASC",Gge="ASC",GGe="DESC",GB="DESC",HGe={ASC:jGe,ASCENDING:Gge,DESC:GGe,DESCENDING:GB};function Hge(t){var e,i,n,r,a;let{tieFormat:o}=t,{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:c,scaleAccessor:u,singlesOnly:d,attach:p,event:h}=t;if((h==null?void 0:h.eventType)!==Ys)return{error:Jh};if(!l)return{error:Ne};if(!o&&!c)return{error:zo};if(o=o??((e=Ea({drawDefinition:c,event:h}))==null?void 0:e.tieFormat),Po({tieFormat:o}).error)return{error:qd};if(typeof u!="object"&&!s)return{error:Ie,context:{scaleAccessor:u}};let f={},m=((c==null?void 0:c.entries)??(h==null?void 0:h.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===hs).map(Yt),{participants:g=[]}=$n({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:_})=>m.includes(_)),y=_=>_===Qh?"rankings":"ratings",I=((i=h==null?void 0:h.category)==null?void 0:i.categoryName)??((n=h==null?void 0:h.category)==null?void 0:n.ageCategoryCode),{scaleName:b=I,scaleType:D=Qh,sortOrder:w,accessor:S}=u||{},U=y(D),C=(_,O)=>{var x,F,$;let V=(x=_[U])==null?void 0:x[O];if(!V&&s&&(V=(F=_[U])==null?void 0:F[Mv]),Array.isArray(V)){let G=($=V.find(j=>j.scaleName===b))==null?void 0:$.scaleValue;if(Mn(G))return G;if(S&&typeof G=="object")return G[S]}return 0},E=(_,O,x)=>{let F=w===GB?O:_,$=w===GB?_:O;return C(F,x)-C($,x)},P=(_,O)=>E(_,O,Mv),M=(_,O)=>E(_,O,zm),N=[],R=(o==null?void 0:o.collectionDefinitions)??[];for(let _ of v){let O=((r=_.individualParticipants)==null?void 0:r.sort(P))??[],x=d?O:((a=_.individualParticipants)==null?void 0:a.sort(M))??[],F={};for(let V of R){let G=[],{collectionId:j,matchUpCount:z,matchUpType:H,gender:K}=V,q=_n(Mv)(H);Xe(0,z).forEach(Y=>{let Z=q?O:x??[],Q=Y+1,ie=[];Xe(0,q?1:2).forEach(ue=>{var J;let te=(J=Z==null?void 0:Z.find(se=>{var ee;let ce=K&&([zi,gn].includes(K)&&K||K===Fo&&[zi,gn][ue]);return(!ce||ce===((ee=se.person)==null?void 0:ee.sex))&&!G.includes(se.participantId)}))==null?void 0:J.participantId;te&&(ie.push(te),G.push(te),F[te]||(F[te]=[]),F[te].push({collectionPosition:Q,collectionId:j}))}),q||N.push(ie)})}let $=Object.keys(F).map(V=>({collectionAssignments:F[V],participantId:V}));f[_.participantId]=$}let A=[];for(let _ of N){let{participant:O}=Fl({tournamentParticipants:g,participantIds:_});if(!O){let x={individualParticipantIds:_,participantRole:va,participantType:Ot};A.push(x)}}if(p){for(;A.length;)bu({participant:A.pop(),tournamentRecord:l});ui({element:c,extension:{name:Dp,value:f}})}return{...re,lineUps:f,participantsToAdd:A}}function Y4(t){if(!t)return{error:dt};let e=vi(t,[{dates:!1,[pc]:o=>Array.isArray(o)&&o.every(ls)},{uuids:!1,[pc]:o=>Array.isArray(o)&&o.every(co)},{startTime:!1,endTime:!1,[pc]:c3},{idPrefix:!1,namePrefix:!1,[pc]:co},{count:!0,[pc]:Mn}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&uw(i,n)||[],a=Xe(1,t.count+1).map(o=>{var s,l;return ft({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${o}`)??xi(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${o}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...re,courts:a}}var zge={};Ht(zge,{default:()=>qGe,garman:()=>Kge});function qC({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>wd(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function sS(t){let e=vi(t,[{courtDate:!0,_ofType:Gd}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],a=Jn(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>LR(s.startTime).localeCompare(LR(l.startTime))).forEach(s=>{let l={startTime:rn(a.toISOString()),endTime:s.startTime};Jn(s.startTime)>a&&r.push(l),Jn(s.endTime)>a&&(a=Jn(s.endTime))});let o={startTime:rn(a.toISOString()),endTime:n.endTime};return Jn(n.endTime)>a&&r.push(o),{timeSlots:r}}function zGe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=o=>{var s;let{timeSlots:l}=sS({includeBookingTypes:e,courtDate:o});return!!((s=l==null?void 0:l.filter(a))!=null&&s.length)};function a(o){let s=Jn(o.startTime),l=Jn(o.endTime);return s>i||l<n?!1:KP(i,l)>=t}return{enoughTime:r}}function Wge(t){let e=vi(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Ao}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:a}=t,o=t.courts,s=Jn(r),l=u3(s,i),{enoughTime:c}=zGe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((o==null?void 0:o.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=qC({date:a,court:u});return!!(d&&c(d))}))||[]).length,...re}}function LO(t){var e;let{remainingScheduleTimes:i=[],clearScheduleDates:n,periodLength:r=30,scheduleDate:a,courts:o=[]}=t,{bookings:s=[]}=t;if(!Array.isArray(o)||!o.length)return{error:Ie,courts:o};if(!Array.isArray(s))return{error:AR};if(!ls(a))return{error:Ka};n&&(Array.isArray(n)?n.includes(a)&&(s=[]):s=[]);let{courtBookings:l,unassignedBookings:c}=s.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),u=o.map((h,f)=>{let{courtId:m,courtName:g}=h,v=l[m]||[],y=qC({date:a,court:h})||{},{bookings:I=[],startTime:b,endTime:D,date:w}=y,S=[i[f]&&{startTime:b,endTime:i[f]},...ot(I,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:S,startTime:b,endTime:D,date:w}}});c.sort((h,f)=>ri(h.startTime)-ri(f.startTime));let d=()=>u.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=sS({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),p=[];for(let h of c){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,I=ri(f),b=ri(m),D=d().reduce((w,{courtId:S,courtName:U,timeSlots:C})=>{let E;return C.find(({startTime:P,endTime:M})=>{E=ri(P)-I;let N=I>=ri(P);return b<=ri(M)&&w.startDifference!==0&&((E===0||E+r>=0)&&(w.startDifference===void 0||E<w.startDifference)||N)})?{courtName:U,courtId:S,startDifference:E}:w},{});if(D.courtId){let w={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};p.push(w),(e=u.find(({courtId:S})=>S===D.courtId))==null||e.dateAvailability.bookings.push(w)}else console.log({unassignedBooking:h})}return{virtualCourts:u.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:p}}function FO({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function qge(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return Xe(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function Pw({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((a,o)=>{let s=qC({date:t,court:o}),l=r&&((s==null?void 0:s[r])||o[r]);return l&&(!a||e&&ri(l)<ri(a)||i&&ri(l)>ri(a))?l:a},void 0)}function WGe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||Pw({courts:n,scheduleDate:r,startTime:!0}),i=i||Pw({courts:n,scheduleDate:r,endTime:!0});let a;if(e&&i){let o=Jn(e),s=Jn(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=qC({court:l,date:r}),{timeSlots:u}=sS({courtDate:c});u==null||u.forEach(d=>{let p=Jn(d.startTime),h=Jn(d.endTime);if(p>s||p<o||h<o)return!1;if(KP(p,h)>=t){let f=rn(p.toISOString());(!a||f<a)&&(a=f)}})}}return{firstTimeSlotStartTime:a}}function Z4(t){let e=vi(t,[{courts:!0,_ofType:Ao}]);if(e.error)return e;let{date:i=l3(),startTime:n="08:00",endTime:r="19:00",periodLength:a,courts:o}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;a=a||FO({averageMatchUpMinutes:c}),i=Lt(i),n=rn(n),r=rn(r);let h=0,f=0,m=0,g=0,v=0;!o&&d&&(o=qge({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=LO({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:a,bookings:p,courts:o}),{firstTimeSlotStartTime:I}=WGe({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});s&&I&&(n=I||n);let b=ri(n),D=ri(r)-b,w=Math.floor(D/a),S=Xe(0,w+1).map(U=>{let C=b+U*a,E=zLe(C),P=Wge({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(P.error)return{error:P.error};let{availableToScheduleCount:M=0}=P,N=M>f?M-f:0;v+=U?M:0;let R=U?v/U:M,A=a*R/c,_=U?A*(U-1)+R:R,O=M?f&&_-h||N:0;h=_,f=M,m+=O;let x=St(m)-g;return g+=x,{periodStart:E,add:x,availableToScheduleCount:M,newCourts:N,totalMatchUps:g}});return{scheduleTimes:S.reduce((U,C)=>{let E=Xe(0,C.add).map(()=>({scheduleTime:C.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:S,totalMatchUps:g}}var Kge={getCourtsAvailableAtPeriodStart:Wge,generateTimeSlots:sS,getScheduleTimes:Z4,courtGenerator:qge},qGe=Kge,Yge={};Ht(Yge,{isValid:()=>Zo,isValidMatchUpFormat:()=>Zo,parse:()=>go,stringify:()=>tO});var Zge={};Ht(Zge,{allCompetitionMatchUps:()=>Nc,allDrawMatchUps:()=>ro,allEventMatchUps:()=>eh,allTournamentMatchUps:()=>Hr,analyzeMatchUp:()=>BU,applyLineUps:()=>yve,assignMatchUpSideParticipant:()=>Jge,assignTieMatchUpParticipantId:()=>lN,bulkMatchUpStatusUpdate:()=>fve,calculateWinCriteria:()=>wI,checkInParticipant:()=>J4,checkMatchUpIsComplete:()=>Um,checkOutParticipant:()=>X4,competitionScheduleMatchUps:()=>HC,disableTieAutoCalc:()=>dve,drawMatchUps:()=>O4,enableTieAutoCalc:()=>lve,eventMatchUps:()=>EO,findMatchUp:()=>I4,getAllDrawMatchUps:()=>lr,getAllStructureMatchUps:()=>Ui,getCheckedInParticipantIds:()=>cI,getCompetitionMatchUps:()=>$U,getEventMatchUpFormatTiming:()=>P4,getMatchUpCompetitiveProfile:()=>dC,getMatchUpContextIds:()=>N4,getMatchUpDailyLimits:()=>RO,getMatchUpDailyLimitsUpdate:()=>C4,getMatchUpDependencies:()=>Xl,getMatchUpFormat:()=>A4,getMatchUpFormatTiming:()=>hC,getMatchUpFormatTimingUpdate:()=>D4,getMatchUpScheduleDetails:()=>jk,getMatchUpType:()=>Gk,getMatchUpsStats:()=>_4,getModifiedMatchUpFormatTiming:()=>CO,getParticipantResults:()=>AC,getPredictiveAccuracy:()=>R4,getRoundMatchUps:()=>Za,getRounds:()=>k4,isValidMatchUpFormat:()=>Zo,matchUpActions:()=>lO,mutate:()=>Xge,participantScheduledMatchUps:()=>E4,query:()=>uge,removeDelegatedOutcome:()=>cve,removeMatchUpSideParticipant:()=>t5,removeTieMatchUpParticipantId:()=>eve,replaceTieMatchUpParticipantId:()=>e5,resetAdHocMatchUps:()=>gve,resetMatchUpLineUps:()=>s5,resetScorecard:()=>c5,resetTieFormat:()=>l5,setDelegatedOutcome:()=>mve,setMatchUpFormat:()=>pve,setMatchUpStatus:()=>YC,setOrderOfFinish:()=>vve,substituteParticipant:()=>uve,tallyParticipantResults:()=>nS,toggleParticipantCheckInState:()=>$O,tournamentMatchUps:()=>MO,updateTieMatchUpScore:()=>th,validMatchUp:()=>$k,validMatchUps:()=>el});var Xge={};Ht(Xge,{applyLineUps:()=>yve,assignMatchUpSideParticipant:()=>Jge,assignTieMatchUpParticipantId:()=>lN,bulkMatchUpStatusUpdate:()=>fve,checkInParticipant:()=>J4,checkOutParticipant:()=>X4,disableTieAutoCalc:()=>dve,enableTieAutoCalc:()=>lve,findMatchUp:()=>I4,removeDelegatedOutcome:()=>cve,removeMatchUpSideParticipant:()=>t5,removeTieMatchUpParticipantId:()=>eve,replaceTieMatchUpParticipantId:()=>e5,resetAdHocMatchUps:()=>gve,resetMatchUpLineUps:()=>s5,resetScorecard:()=>c5,resetTieFormat:()=>l5,setDelegatedOutcome:()=>mve,setMatchUpFormat:()=>pve,setMatchUpStatus:()=>YC,setOrderOfFinish:()=>vve,substituteParticipant:()=>uve,toggleParticipantCheckInState:()=>$O,updateTieMatchUpScore:()=>th});function Jge({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:a}){var o,s;if(i&&typeof i!="string")return{error:hu};if(!e)return{error:tt};if(!r)return{error:ua};let l=n===void 0;if(l&&(n=1),![1,2].includes(n))return oe({result:{error:Ie,context:{sideNumber:n}}});let{matchUp:c,structure:u}=an({drawDefinition:e,matchUpId:r,event:a});if(!c)return{error:wa};if(!(!(u!=null&&u.structures)&&!(e.drawType&&e.drawType!==Ol)&&!((o=u==null?void 0:u.matchUps)!=null&&o.find(({roundPosition:d})=>!!d))))return{error:TW};if(!i&&((s=c==null?void 0:c.score)!=null&&s.scoreStringSide1||Mr.includes(c==null?void 0:c.matchUpstatus)||c!=null&&c.matchUpStatus&&[er,fr].includes(c.matchUpStatus)))return{error:hk,info:"matchUp has completed status or score"};if(c){if(c.sides=[1,2].map(d=>{var p;let h=((p=c.sides)==null?void 0:p.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...h,participantId:i}:h}),l)for(let d of c.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);si({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:c})}return{...re,sidesSwapped:l}}function fs({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:o,event:s}){let{matchUp:l}=an({drawDefinition:n,event:s,matchUpId:a});if(!l)return{error:wa};let c=Lf({removePriorValues:t,element:l,duplicateValues:i,timeItem:o});return r||si({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function X4(t){var e;let i=[{[Ad]:!0},{[$c]:!0},{[yd]:!0},{[Dg]:!0}],n=vi(t,i);if(n.error)return n;let r=zC(t,[{[qP]:Af,attr:{[a3]:!0}}]);if(r.error)return r;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,c=(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp,{matchUpStatus:u,score:d}=c??{};if(u&&b3.includes(u)||u&&Mr.includes(u)||zr({score:d}))return{error:Rce};let p=cI({matchUp:c});if(p!=null&&p.error)return p;let{checkedInParticipantIds:h,allRelevantParticipantIds:f}=p??{};if(!(f!=null&&f.includes(s)))return{error:hu};if(!(h!=null&&h.includes(s)))return{error:iue};let m=Wde({matchUp:c});if(m!=null&&m.error)return m;let{sideParticipantIds:g,nestedIndividualParticipantIds:v}=m??{},y=g==null?void 0:g.indexOf(s);return y!==void 0&&[0,1].includes(y)&&((v==null?void 0:v[y])??[]).forEach(I=>{fs({drawDefinition:o,matchUpId:l,timeItem:{itemType:zR,itemValue:I}})}),fs({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:zR}}),{...re,checkedOut:!0}}function J4(t){var e;let i=[{[Ad]:!0},{[$c]:!0},{[yd]:!0},{[Dg]:!0}],n=vi(t,i);if(n[Ev])return n;let r=zC(t,[{[qP]:Af,attr:{[a3]:!0}}]);if(r[Ev])return r;let{tournamentRecord:a,drawDefinition:o,participantId:s,matchUpId:l}=t,c=cI({matchUp:(e=r==null?void 0:r.matchUp)==null?void 0:e.matchUp});if(c!=null&&c.error)return c;let{checkedInParticipantIds:u,allRelevantParticipantIds:d}=c??{};if(!(d!=null&&d.includes(s)))return{[Ev]:hu};let p={...re,checkedIn:!0};return u!=null&&u.includes(s)||fs({tournamentRecord:a,drawDefinition:o,matchUpId:l,timeItem:{itemValue:s,itemType:HR}}),p}function $O(t){var e,i;let n=vi(t,[{[yd]:!0,[$c]:!0,[Dg]:!0}]);if(n.error)return n;let r=t.tournamentId??t.activeTournamentId,a=t.tournamentRecord??(r&&((e=t.tournamentRecords)==null?void 0:e[r]));if(!a)return{error:Ne};let o=(i=zC(t,[{[qP]:Af,attr:{[a3]:!0},[Ev]:wa}]).matchUp)==null?void 0:i.matchUp;if(!o)return{error:wa};let{checkedInParticipantIds:s=[]}=cI({matchUp:o}),{participantId:l,matchUpId:c,drawDefinition:u}=t;return l&&s.includes(l)?X4({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:o}):J4({tournamentRecord:a,drawDefinition:u,participantId:l,matchUpId:c,matchUp:o})}function Q4({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var r,a;if(!t)return{error:Ne};if(!e)return{error:Fc};if(!n)return{error:Wo};let o=da({drawDefinition:e}),{matchUp:s}=an({matchUpId:i,drawDefinition:e,matchUpsMap:o});if(!s)return{error:wa};let{matchUp:l,structure:c}=an({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:o,event:n});if(!l)return{error:wa};let{collectionPosition:u,drawPositions:d,collectionId:p,matchUpTieId:h,matchUpType:f}=l;if(f&&!Hk([Un,qi],f))return{error:uo};let{positionAssignments:m}=Vi({structure:c}),g=m==null?void 0:m.filter(U=>d==null?void 0:d.includes(U.drawPosition)),{matchUp:v}=an({matchUpId:h,drawDefinition:e,matchUpsMap:o}),y=((r=v==null?void 0:v.sides)==null?void 0:r.map(Yt))??[],I=(g==null?void 0:g.map(Yt))??[],b=[...y,...I],{participants:D}=$n({tournamentRecord:t,participantFilters:{participantTypes:[Gi],participantIds:b}}),{matchUp:w}=an({matchUpId:h,inContext:!0,drawDefinition:e,matchUpsMap:o}),S=(a=Ea({matchUp:v,drawDefinition:e,structure:c,event:n}))==null?void 0:a.tieFormat;return{inContextDualMatchUp:w,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:u,teamParticipants:D,collectionId:p,matchUpType:f,dualMatchUp:v,tieMatchUp:s,tieFormat:S,structure:c,...re}}function e5(t){var e,i,n,r,a,o,s,l,c,u,d,p,h,f,m,g;let v=Q4(t);if(v.error)return v;let y="replaceTieMatchUpParticipantid",{existingParticipantId:I,tournamentRecord:b,newParticipantId:D,drawDefinition:w,substitution:S,event:U}=t;if(!I||!D)return oe({result:{error:vr},stack:y});if(I===D)return{...re};let{inContextDualMatchUp:C,inContextTieMatchUp:E,collectionPosition:P,collectionId:M,dualMatchUp:N,tieMatchUp:R,tieFormat:A}=v,_=E==null?void 0:E.matchUpType,O=(e=E==null?void 0:E.sides)==null?void 0:e.find(te=>{var se,ee,ce;return((se=te.participant)==null?void 0:se.participantId)===I||((ce=(ee=te.participant)==null?void 0:ee.individualParticipantIds)==null?void 0:ce.includes(I))});if(!O)return{error:Gn};let x=((i=$n({tournamentRecord:b,participantFilters:{participantIds:[I,D]}}))==null?void 0:i.participants)??[];if(x.length!==2)return oe({result:{error:vr},stack:y});if(x[0].participantType!==x[1].participantType)return oe({result:{error:Mc},stack:y});let{appliedPolicies:F}=Mi({tournamentRecord:b,drawDefinition:w,event:U}),$=((n=t.policyDefinitions)==null?void 0:n[Or])??(F==null?void 0:F[Or])??eS[Or],V=x.find(({participantId:te})=>te===D);if((t.enforceGender??((r=$==null?void 0:$.participants)==null?void 0:r.enforceGender))!==!1&&[zi,gn].includes(E==null?void 0:E.gender)&&(E==null?void 0:E.gender)!==((a=V==null?void 0:V.person)==null?void 0:a.sex))return{error:k0,info:"Gender mismatch"};let G=(o=$==null?void 0:$.processCodes)==null?void 0:o.substitution;xC({tournamentId:b.tournamentId,eventId:U.eventId,inContextDualMatchUp:C,drawDefinition:w,dualMatchUp:N});let j=(s=N==null?void 0:N.sides)==null?void 0:s.find(({sideNumber:te})=>te===O.sideNumber);if(!j)return oe({result:{sideNumber:O.sideNumber,existingParticipantId:I,error:Sa},stack:y});if((c=(l=E==null?void 0:E.sides)==null?void 0:l.flatMap(te=>{var se,ee;return((se=te.participant)==null?void 0:se.individualParticipantIds)||((ee=te.participant)==null?void 0:ee.participantId)||[]}))!=null&&c.includes(D))return oe({result:{error:fk},stack:y});let z=(d=(u=C==null?void 0:C.sides)==null?void 0:u.find(({sideNumber:te})=>te===O.sideNumber))==null?void 0:d.participantId,H=j.lineUp,K=H==null?void 0:H.find(({participantId:te})=>D===te),q=H==null?void 0:H.reduce((te,se)=>se.substitutionOrder>te?se.substitutionOrder:te,0),Y=(H==null?void 0:H.map(te=>{var se;let ee=ot(te,!1,!0);if(![I,D].includes(ee.participantId))return ee;if(!S&&[I,D].includes(ee.participantId)&&(ee.collectionAssignments=(se=ee.collectionAssignments)==null?void 0:se.filter(ce=>!(ce.collectionPosition===P&&ce.collectionId===M))),S&&I===ee.participantId&&(ee.collectionAssignments=ee.collectionAssignments.map(ce=>ce.collectionPosition===P&&ce.collectionId===M&&ce.substitutionOrder===void 0?{...ce,substitutionOrder:q}:ce)),ee.participantId===D){ee.collectionAssignments||(ee.collectionAssignments=[]);let ce={collectionId:M,collectionPosition:P};S&&(ce.previousParticipantId=I,ce.substitutionOrder=(q??0)+1),ee.collectionAssignments.push(ce)}return ee}))??[];if(!K){let te={collectionId:M,collectionPosition:P};S&&(te.substitutionOrder=(q??0)+1,te.previousParticipantId=I);let se={collectionAssignments:[te],participantId:D};Y.push(se)}let Z=_===qi,{assignedParticipantIds:Q}=WR({lineUp:H,collectionPosition:P,collectionId:M}),{assignedParticipantIds:ie}=WR({lineUp:Y,collectionPosition:P,collectionId:M});if(j.lineUp=Y,z&&A){let te=gI({participantId:z,lineUp:Y,drawDefinition:w,tieFormat:A});if(te.error)return oe({result:te,stack:y})}else console.log("team participantId not found");let ue,J;if(Z){let{tournamentRecord:te}=t,se=Fl({participantIds:ie,tournamentRecord:te});if(!se.participant){let ce=bu({returnParticipant:!0,pairOverride:!0,tournamentRecord:te,participant:{participantRole:va,individualParticipantIds:ie,participantType:Ot}});if(ce.error)return oe({result:ce,stack:y});ue=(p=ce.participant)==null?void 0:p.participantId}se=Fl({participantIds:Q,tournamentRecord:te});let ee=(h=se.participant)==null?void 0:h.participantId;ee&&fI({participantIds:[ee],tournamentRecord:te}).success&&(J=ee)}if(S||((f=O.substitutions)==null?void 0:f.length)===1){if(S)G&&R&&(R.processCodes=$t([...(R==null?void 0:R.processCodes)??[],...G]));else for(let te of G||[]){let se=(m=R==null?void 0:R.processCodes)==null?void 0:m.lastIndexOf(te);se!==void 0&&((g=R==null?void 0:R.processCodes)==null||g.splice(se,1))}R&&si({tournamentId:b==null?void 0:b.tournamentId,matchUp:R,context:y,drawDefinition:w})}return N&&si({tournamentId:b==null?void 0:b.tournamentId,matchUp:N,context:y,drawDefinition:w}),{...re,modifiedLineUp:Y,participantRemoved:J,participantAdded:ue}}function Qge({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:a}){var o;if(!a||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Ie};let s=(i==null?void 0:i.lineUp)||((o=Ym({participantId:e,drawDefinition:n}))==null?void 0:o.lineUp),l=[],c=[];return{modifiedLineUp:(s==null?void 0:s.map(u=>{var d;if(!r.includes(u.participantId))return u;let p=(d=u.collectionAssignments)==null?void 0:d.filter(h=>{let f=h.collectionId===a&&h.collectionPosition===t;return f&&(h.previousParticipantId&&l.push(h.previousParticipantId),c.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:c,previousParticipantIds:l}}function KGe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var n,r;let a=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===Ur&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),o=s=>!t.includes(s.participantId);for(let s of a){s.entries=(s.entries||[]).filter(o);let{flightProfile:l}=Vn({event:s});(n=l==null?void 0:l.flights)==null||n.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(o)}),(r=s==null?void 0:s.drawDefinitions)==null||r.forEach(c=>{c.entries=(c.entries||[]).filter(o)})}return{...re}}function BO({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return oe({result:{error:Ne},stack:r});if(!e||!t)return oe({result:{error:dt},stack:r});let a=n.participants??[],o=a.find(d=>d.participantId===e);if(!o)return oe({result:{error:Gn},stack:r});if(o!=null&&o.participantType&&![Gi,bs].includes(o.participantType))return oe({context:{participantType:o.participantType},result:{error:Mc},stack:r});let s=t.filter(d=>{var p;return((p=a.find(h=>h.participantId===d))==null?void 0:p.participantType)!==Zt});if(s.length)return oe({result:{error:Tl,invalidParticipantIds:s},stack:r});o.individualParticipantIds||(o.individualParticipantIds=[]);let l=o.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&qk({individualParticipantIds:c,tournamentRecord:n}),o.individualParticipantIds=o.individualParticipantIds.concat(...c));let{topics:u}=Wl();if(u.includes(sa)){let d=a.find(({participantId:p})=>p===e);ti({topic:sa,payload:{participants:[d]}})}return KGe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:ot(o,!1,!0),added:c.length,...re}}function VO(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:a,participant:o}=t;if(!r)return{error:Ne};if(!o)return{error:tI};if(!o.participantId)return bu({tournamentRecord:r,participant:o});let{participant:s}=kg({participantId:o.participantId,tournamentRecord:r});if(!s)return bu({tournamentRecord:r,participant:o});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=o;if(h&&s.participantType!==h)return{error:Zce};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),d&&typeof d=="string"&&(v.participantName=d),u&&typeof u=="string"&&(v.participantOtherName=u),Array.isArray(c)){let{participants:y}=$n({participantFilters:{participantTypes:[Zt]},tournamentRecord:r}),I=y==null?void 0:y.map(Yt);if(I){let b=c.filter(D=>typeof D=="string"&&I.includes(D));([bs,Yi].includes(h||s.participantType)||h===Ot&&(b.length===2||a))&&(v.individualParticipantIds=b),s.participantType===mT.PAIR&&e&&(v.participantName=YGe({individualParticipants:y,newValues:v}))}}return Object.keys(cq).includes(p)&&(v.participantRole=p),Object.keys(mT).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===mT.INDIVIDUAL&&g&&ZGe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,ft(v)),i&&BO({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),ti({topic:sa,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:ot(s),...re}}function YGe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function ZGe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:a,standardGivenName:o,nationalityCode:s,personId:l,sex:c}=n;c&&Object.keys(tq).includes(c)&&(r.sex=c);let u;if(l&&typeof l=="string"&&(r.personId=l),s&&typeof s=="string"&&(XGe(s)||s==="")&&(r.nationalityCode=s),a&&typeof a=="string"&&a.length>1&&(r.standardFamilyName=a,u=!0),o&&typeof o=="string"&&o.length>1&&(r.standardGivenName=o,u=!0),u&&t){let d=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=d}Object.assign(e.person,r)}function XGe(t){return xh.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function lN(t){var e,i,n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,I,b;let D=Q4(t);if(D.error)return D;let w="assignTieMatchUpParticipantId",S=t.teamParticipantId,{tournamentRecord:U,drawDefinition:C,participantId:E,event:P}=t;if(!E)return oe({result:{error:vr},stack:w});if(t.sideNumber&&![1,2].includes(t.sideNumber))return oe({result:{error:kW},stack:w});let{inContextDualMatchUp:M,inContextTieMatchUp:N,relevantAssignments:R,collectionPosition:A,teamParticipants:_,collectionId:O,matchUpType:x,dualMatchUp:F,tieFormat:$}=D;if((i=(e=N==null?void 0:N.sides)==null?void 0:e.flatMap(he=>{var Se,Ce;return((Se=he.participant)==null?void 0:Se.individualParticipantIds)||((Ce=he.participant)==null?void 0:Ce.participantId)||[]}))!=null&&i.includes(E))return oe({result:{...re},stack:w});S=S??(t.sideNumber?(r=(n=M==null?void 0:M.sides)==null?void 0:n.find(he=>he.sideNumber===t.sideNumber))==null?void 0:r.participantId:void 0);let V=(o=(a=$n({participantFilters:{participantIds:[E]},tournamentRecord:U}))==null?void 0:a.participants)==null?void 0:o[0];if(!V)return oe({result:{error:Gn},stack:w});let{appliedPolicies:G}=Mi({tournamentRecord:U,drawDefinition:C,event:P}),j=((s=t.policyDefinitions)==null?void 0:s[Or])??(G==null?void 0:G[Or])??eS[Or];if((t.enforceGender??((l=j==null?void 0:j.participants)==null?void 0:l.enforceGender))!==!1&&[zi,gn].includes(N==null?void 0:N.gender)&&(N==null?void 0:N.gender)!==((c=V.person)==null?void 0:c.sex))return{error:k0,info:"Gender mismatch"};let{individualParticipantIds:z,participantType:H}=V;if(_n(Un)(x)&&H!==Zt)return{error:Mc};let K=H===Zt?[E]:z,q=S&&(_==null?void 0:_.find(({participantId:he})=>he===S))||(_==null?void 0:_.find(({individualParticipantIds:he})=>Ya(K,he)));if(!q)return{error:HW};if(S||(S=q.participantId),!S)return{error:Gn};let Y=(u=R==null?void 0:R.find(he=>he.participantId===(q==null?void 0:q.participantId)))==null?void 0:u.drawPosition,Z=(p=(d=F==null?void 0:F.sides)==null?void 0:d.find(he=>he.participantId===S))==null?void 0:p.sideNumber,Q=(f=(h=N==null?void 0:N.sides)==null?void 0:h.find(he=>Y&&he.drawPosition===Y))==null?void 0:f.sideNumber,ie=Z??Q??t.sideNumber;if(!$)return{error:VP};if(!((m=$.collectionDefinitions)!=null&&m.find(he=>he.collectionId===O)))return{error:jce};xC({tournamentId:U.tournamentId,eventId:P.eventId,inContextDualMatchUp:M,drawDefinition:C,dualMatchUp:F});let ue=(g=F==null?void 0:F.sides)==null?void 0:g.find(he=>he.sideNumber===ie),J=(v=N==null?void 0:N.sides)==null?void 0:v.find(he=>he.sideNumber===ie),te=(b=(I=(ue==null?void 0:ue.lineUp)??((y=Ym({participantId:S,drawDefinition:C}))==null?void 0:y.lineUp))==null?void 0:I.filter(he=>{var Se;return(Se=he.collectionAssignments)==null?void 0:Se.find(Ce=>Ce.collectionPosition===A&&Ce.collectionId===O&&!Ce.previousParticipantId)}))==null?void 0:b.map(he=>he==null?void 0:he.participantId),se=(te==null?void 0:te.length)>1&&te||(H===Ot?V.individualParticipantIds:[E]),ee=Qge({collectionPosition:A,teamParticipantId:S,dualMatchUpSide:ue,drawDefinition:C,participantIds:se,collectionId:O});if(ee.error)return oe({result:ee,stack:w});let{modifiedLineUp:ce}=ee,fe;if(x===qi){if(H!==Ot){let he=NL({collectionPosition:A,teamParticipantId:S,drawDefinition:C,modifiedLineUp:ce,participantId:E,collectionId:O,tieFormat:$});if(he!=null&&he.error)return oe({result:he,stack:w});if(he=ge({side:J}),he.error)return he;fe=he.deletedParticipantId,ue&&(ue.lineUp=ce),F&&si({tournamentId:U==null?void 0:U.tournamentId,matchUp:F,context:w,drawDefinition:C})}else if(H===Ot)for(let he of se)NL({collectionPosition:A,teamParticipantId:S,drawDefinition:C,modifiedLineUp:ce,participantId:he,collectionId:O,tieFormat:$})}else{let he=NL({collectionPosition:A,teamParticipantId:S,drawDefinition:C,modifiedLineUp:ce,participantId:E,collectionId:O,tieFormat:$});if(he!=null&&he.error)return he}if(ue&&(ue.lineUp=ce),F&&si({tournamentId:U==null?void 0:U.tournamentId,matchUp:F,context:w,drawDefinition:C}),fe){let{error:he}=fI({participantIds:[fe],tournamentRecord:U});he&&console.log("cleanup")}return{...re,modifiedLineUp:ce};function ge({side:he}){let Se;if(he.participant){let Ce=he.participant.individualParticipantIds||[];if(Ce.filter(Boolean).length===1){let{participant:Fe}=Fl({participantIds:Ce,tournamentRecord:U});Ce.push(E);let{participant:Je}=Fl({participantIds:Ce,tournamentRecord:U});if(!Je&&Fe){Fe.individualParticipantIds=Ce;let xe=VO({pairOverride:!0,tournamentRecord:U,participant:Fe});if(xe.error)return xe}else Se=Fe==null?void 0:Fe.participantId}}else{let Ce=bu({participant:{individualParticipantIds:[E],participantRole:va,participantType:Ot},pairOverride:!0,tournamentRecord:U});if(Ce.error)return Ce}return{...re,deletedParticipantId:Se}}}function NL({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:a,tieFormat:o}){var s,l;let c=(s=Ym({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,u=(l=n||c)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===r),d={collectionId:a,collectionPosition:t};if(u)u.collectionAssignments.push(d);else{let p={collectionAssignments:[d],participantId:r};n.push(p)}return gI({participantId:e,lineUp:n,drawDefinition:i,tieFormat:o})}function eve(t){var e,i,n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,I,b,D,w;let{tournamentRecord:S,drawDefinition:U,participantId:C,event:E}=t,P="removeTieMatchUpParticiapantId";if(!C)return oe({result:{error:vr},stack:P});let M=Q4(t);if(M.error)return M;let{appliedPolicies:N}=Mi({tournamentRecord:S,drawDefinition:U,event:E}),R=(n=(i=((e=t.policyDefinitions)==null?void 0:e[Or])??(N==null?void 0:N[Or])??eS[Or])==null?void 0:i.processCodes)==null?void 0:n.substitution,{inContextDualMatchUp:A,inContextTieMatchUp:_,relevantAssignments:O,collectionPosition:x,teamParticipants:F,collectionId:$,matchUpType:V,dualMatchUp:G,tieMatchUp:j,tieFormat:z}=M;if(!G)return oe({result:{error:Do},stack:P});let H=(r=_==null?void 0:_.sides)==null?void 0:r.find(ue=>{var J,te,se;return((J=ue.participant)==null?void 0:J.participantId)===C||((se=(te=ue.participant)==null?void 0:te.individualParticipantIds)==null?void 0:se.includes(C))});if(!H)return oe({result:{error:Gn},stack:P});if(!((a=H.substitutions)!=null&&a.length)&&(zr({score:_==null?void 0:_.score})||_!=null&&_.winningSide))return oe({result:{error:Uue},stack:P});let K=(s=(o=A==null?void 0:A.sides)==null?void 0:o.find(({sideNumber:ue})=>ue===H.sideNumber))==null?void 0:s.participantId;if(!K)return oe({result:{error:Gn},stack:P});let q=(c=(l=$n({participantFilters:{participantIds:[C]},tournamentRecord:S}))==null?void 0:l.participants)==null?void 0:c[0];if(!q)return oe({result:{error:Gn},stack:P});if(V===Un&&q.participantType===Ot)return oe({result:{error:k0},stack:P});let Y=q.participantType===Zt?[C]:q.individualParticipantIds;xC({tournamentId:S.tournamentId,eventId:E.eventId,inContextDualMatchUp:A,drawDefinition:U,dualMatchUp:G});let Z=(u=G.sides)==null?void 0:u.find(({sideNumber:ue})=>ue===H.sideNumber);if(!Z&&(((d=G.sides)==null?void 0:d.filter(({lineUp:ue})=>!ue).length)||0)<2){let ue=F==null?void 0:F.map(({participantId:J})=>{var te;return{drawPosition:(te=O==null?void 0:O.find(se=>se.participantId===J))==null?void 0:te.drawPosition,teamParticipantId:J}});Z=(p=G.sides)==null?void 0:p.find(J=>{var te;return((te=ue==null?void 0:ue.find(({drawPosition:se})=>se===J.drawPosition))==null?void 0:te.teamParticipantId)===K})}if(!Z)return oe({result:{error:Gn,context:{participantId:C}}});let{modifiedLineUp:Q,previousParticipantIds:ie}=Qge({collectionPosition:x,teamParticipantId:K,dualMatchUpSide:Z,participantIds:Y,drawDefinition:U,collectionId:$});if(Z.lineUp=Q,K&&z&&gI({participantId:K,lineUp:Q,drawDefinition:U,tieFormat:z}),V===qi&&q.participantType===Zt){let ue=(h=_==null?void 0:_.sides)==null?void 0:h.find(se=>se.sideNumber===(Z==null?void 0:Z.sideNumber)),{participantId:J}=ue??{},te=J&&((m=(f=$n({participantFilters:{participantIds:[J]},tournamentRecord:S,withDraws:!0}))==null?void 0:f.participants)==null?void 0:m[0]);if(te){let se=((g=te==null?void 0:te.individualParticipantIds)==null?void 0:g.filter(ee=>ee!==C))??[];if(ie&&se.push(...ie),se.length>2)return oe({result:{error:Tl},stack:P});if((v=te.draws)!=null&&v.length){if(se.length===1){let{participant:ee}=Fl({participantIds:se,tournamentRecord:S});if(!ee){let ce=bu({participant:{participantRole:va,individualParticipantIds:se,participantType:Ot},pairOverride:!0,tournamentRecord:S});if(ce.error)return oe({result:ce,stack:P})}}}else if(se.length){te.individualParticipantIds=se;let ee=VO({participant:te,pairOverride:!0,tournamentRecord:S});if(ee.error)return oe({result:ee,stack:P})}else{let ee=fI({participantIds:[J],tournamentRecord:S});ee.error&&console.log("cleanup",{result:ee})}}else return oe({result:{error:Gn},stack:P})}if(((y=H.substitutions)==null?void 0:y.length)===1&&!((D=(b=(I=_==null?void 0:_.sides)==null?void 0:I.find(ue=>ue.sideNumber!==H.sideNumber))==null?void 0:b.substitutions)!=null&&D.length)&&(w=j==null?void 0:j.processCodes)!=null&&w.length){for(let ue of R||[]){let J=j.processCodes.lastIndexOf(ue);j.processCodes.splice(J,1)}si({tournamentId:S==null?void 0:S.tournamentId,matchUp:j,context:P,drawDefinition:U})}return si({tournamentId:S==null?void 0:S.tournamentId,matchUp:G,context:P,drawDefinition:U}),{...re,modifiedLineUp:Q}}function t5(t){var e,i;let n=vi(t,[{[Ad]:!0,[$c]:!0,[Dg]:!0}]);if(n.error)return n;let{drawDefinition:r,sideNumber:a,matchUpId:o,event:s}=t;if(a&&![1,2].includes(a))return{error:Ie,sideNumber:a};let{matchUp:l,structure:c}=an({drawDefinition:r,matchUpId:o,event:s});return l?Yo({structure:c})?((e=l.sides)==null||e.forEach(u=>{(!a||u.sideNumber===a)&&delete u.participantId}),si({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,context:"assignSideParticipant",drawDefinition:r,matchUp:l}),{...re}):{error:TW}:{error:wa}}function JGe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:a,structure:o,matchUp:s,event:l,score:c}){var u;let d=ot(r,void 0,!0);for(let h of(d==null?void 0:d.tieMatchUps)||[])h.matchUpId===s.matchUpId&&(h.winningSide=n,h.score=c,!zr({score:c})&&!e?Object.assign(h,{...Qk}):e&&(h.matchUpStatus=e));a=a??((u=Ea({matchUp:s,structure:o,drawDefinition:t,event:l}))==null?void 0:u.tieFormat);let{winningSide:p}=OC({matchUp:d,drawDefinition:t,matchUpsMap:i,structure:o,tieFormat:a,event:l});return{projectedWinningSide:p}}function QGe({matchUpStatuses:t=[wi,Ci,mi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var r;let a=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(r=a==null?void 0:a.drawPositions)==null?void 0:r.find(d=>d!==i),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),l=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),c=Ya(s||[],t),u=Ya(l||[],t);return{sourceMatchUp:a,winnerHadMatchUpStatus:c,winnerMatchUpStatuses:s,loserHadMatchUpStatus:u,loserMatchUpStatuses:l}}function eHe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,structureId:o,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=Dt({drawDefinition:a,structureId:o});if((d==null?void 0:d.structureType)===eo)return{...re};c=c??da({drawDefinition:a});let p=((c==null?void 0:c.mappedMatchUps)||{})[o].matchUps,{initialRoundNumber:h}=dy({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Vi({drawDefinition:a,structureId:o});for(let g of f??[])tHe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:a,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...re}}function tHe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:o,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var d,p,h;let f="removeSubsequentDrawPosition";if(s){let g=(p=(d=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:d.find(y=>y.drawPosition===n))==null?void 0:p.sideNumber,v=(h=c.sides)==null?void 0:h.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let m=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=m&&wi||[mi,Ci].includes(c.matchUpStatus)&&c.matchUpStatus||Fn,[Ci,mi].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&Hpe({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:a,matchUpsMap:l,matchUp:c}),si({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${f}-${n}`,drawDefinition:o,matchUp:c}),{...re}}function lS(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:a,matchUpsMap:o,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Yo({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:FP};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:I,winnerMatchUp:b,byeMatchUp:D}}=l,w=eu({...t,matchUpStatus:a||Fn,removeWinningSide:!0});if(w.error)return w;let S;if(p){let{matchUpTieId:O,matchUpsMap:x}=t;if(S=th({appliedPolicies:t.appliedPolicies,matchUpId:O,tournamentRecord:n,drawDefinition:r,matchUpsMap:x,event:d}),!e&&!S.removeWinningSide)return{...re}}if(h)return{...re};let{matchUps:U}=Ui({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:o,structure:u}),{positionAssignments:C}=Rr({structure:u}),E=m-1,P=1-E,M=f[E],N=f[P],{winnerParticipantId:R,loserParticipantId:A}=(C==null?void 0:C.reduce((O,x)=>(x.drawPosition===N&&(O.loserParticipantId=x.participantId),x.drawPosition===M&&(O.winnerParticipantId=x.participantId),O),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=U.filter(O=>{var x;return(x=O.drawPositions)==null?void 0:x.includes(N)});if(b&&tve({sourceMatchUpStatus:a,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:M,winnerParticipantId:R,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:b,dualMatchUp:s,matchUpsMap:o}),I){let{winnerHadMatchUpStatus:O}=QGe({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:U}),x=g.linkCondition===Ud;if(O&&x){let $=Math.min(...I.drawPositions);HB({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:$,matchUpsMap:o,event:d})}let F=iHe({sourceMatchUpStatus:a,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:I,dualMatchUp:s,matchUpsMap:o,event:d});if(F.error)return F}if(D){let O=Math.min(...D.drawPositions);HB({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:O,matchUpsMap:o,event:d})}return{...re,...S&&{tieMatchUpResult:S}}}function tve({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:a,sourceMatchUpId:o,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var p,h;let{structureId:f,roundNumber:m}=l,g="removeDirectedWinner";if(a){let v=a.target.structureId,{structure:y}=Dt({drawDefinition:s,structureId:v});if(!y)return{error:wn};let{positionAssignments:I}=Rr({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(C=>C.participantId!==n);let b=(p=I==null?void 0:I.find(C=>C.participantId===n))==null?void 0:p.drawPosition,{matchUps:D}=Ui({drawDefinition:s,structure:y,event:d}),w=D.map(C=>C.drawPositions).flat(1/0).filter(Boolean),S=qo(w);if((b?S[b]:void 0)===1)I==null||I.forEach(C=>{C.participantId===n&&delete C.participantId});else{let C=D.filter(({drawPositions:E})=>E.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:C,winnerTargetLink:a})}let U=(h=c==null?void 0:c.drawMatchUps)==null?void 0:h.find(({matchUpId:C})=>C===l.matchUpId);U&&si({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:g,drawDefinition:s})}return m&&eHe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:m,structureId:f}),{...re}}function iHe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:a,loserMatchUp:o,matchUpsMap:s,dualMatchUp:l,event:c}){var u,d,p;let h="removeDirectedLoser",f=n.target.structureId,{structure:m}=Dt({drawDefinition:a,structureId:f});if(!m)return{error:wn};let{positionAssignments:g}=Rr({structure:m}),v=(u=g==null?void 0:g.find(y=>y.participantId===e))==null?void 0:u.drawPosition;if(g==null||g.forEach(y=>{y.participantId===e&&delete y.participantId}),m.seedAssignments=(m.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=o==null?void 0:o.sides.reduce((D,w,S)=>w.drawPosition===v?S:D,void 0),I=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(({matchUpId:D})=>D===o.matchUpId),b=(p=I==null?void 0:I.sides)==null?void 0:p[y];b&&(delete b.lineUp,si({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:I,context:h,drawDefinition:a}))}return{...re}}function HB({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:a,event:o}){let s=a.target.structureId;return bC({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:o}),{...re}}function nHe(t){var e,i;let{matchUpFormat:n,score:r}=t,a=(e=r==null?void 0:r.sets)==null?void 0:e.length,o=n&&go(n),{setFormat:s,finalSetFormat:l,bestOf:c}=o??{};return((i=c&&a===c&&l||s)==null?void 0:i.timed)||!1}function rHe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var r;let a="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return oe({result:{error:ow},context:{matchUpStatus:wi},stack:a});let{positionAssignments:o}=Rr({structure:i}),s=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(r=n.drawPositions)!=null&&r.some(l=>s==null?void 0:s.includes(l))?(n.matchUpStatus=wi,n.matchUpStatusCodes=[],si({tournamentId:t==null?void 0:t.tournamentId,context:a,drawDefinition:e,matchUp:n}),{...re}):oe({result:{error:Vce},info:"matchUp does not include BYE",stack:a})}function bT(t){var e;let{tournamentRecord:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,structure:s,event:l}=t,c="doubleExitAdvancement";if(s.structureType===eo)return oe({result:{...re},stack:c});let{matchUp:u,targetMatchUps:d,targetLinks:p}=o,{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:m}=d;if(h&&h.matchUpStatus!==wi){let{loserTargetLink:g}=p;if((e=n==null?void 0:n.progression)!=null&&e.doubleExitPropagateBye){let v=ive({loserTargetDrawPosition:m,tournamentRecord:i,loserTargetLink:g,drawDefinition:r,loserMatchUp:h,matchUpsMap:a,event:l});if(v.error)return oe({result:v,stack:c})}else{let{feedRound:v,drawPositions:y,matchUpId:I}=h,b=v?2:2-y.indexOf(m),D=ZY({...t,targetMatchUp:h,walkoverWinningSide:b,tournamentRecord:i,sourceMatchUp:u,matchUpId:I});if(D.error)return oe({result:D,stack:c})}}if(f){let g=ZY({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:i,sourceMatchUp:u});if(g.error)return oe({result:g,stack:c})}return oe({result:{...re},stack:c})}function ZY(t){var e,i,n;let{inContextDrawMatchUps:r,tournamentRecord:a,drawDefinition:o,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:c}=t,u=o.structures.find(({structureId:Y})=>Y===l.structureId),d=t.matchUpStatus===fr?fr:er,p=t.matchUpStatus===fr?mi:Ci,h="conditionallyAdvanceDrawPosition",f=c.drawMatchUps.find(Y=>Y.matchUpId===l.matchUpId);if(!f)return{error:Do};let m=(s==null?void 0:s.drawPositions)||[],g=(e=f.drawPositions)==null?void 0:e.filter(Boolean),v=(s==null?void 0:s.structureId)===l.structureId;if(v&&Ya(m,g)&&(g=g.filter(Y=>!m.includes(Y))),v&&g.length>1)return oe({result:{error:aw},stack:h});let{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:I}=jpe(t),b=Xa({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:o}),{targetMatchUps:D,targetLinks:w}=b,{loserTargetDrawPosition:S,winnerMatchUp:U,loserMatchUp:C}=D;if(C){let{loserTargetLink:Y}=w,Z=ive({loserTargetDrawPosition:S,loserMatchUp:C,tournamentRecord:a,loserTargetLink:Y,drawDefinition:o,matchUpsMap:c});if(Z.error)return oe({result:Z,stack:h})}let E=((i=f.drawPositions)==null?void 0:i.filter(Boolean))||[],P=E.length===1,M=t.walkoverWinningSide||P&&cM({drawPosition:E[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,N=[Ci,mi].includes(f.matchUpStatus)&&!E.length,R=f.finishingRound===1,A=N&&!R?d:p,_=r.find(Y=>Y.matchUpId===I.matchUpId),O=[],x;s&&((s==null?void 0:s.structureId)===(_==null?void 0:_.structureId)?s.roundPosition<(I==null?void 0:I.roundPosition)?x=1:x=2:l.feedRound?s.structureId===l.structureId?x=2:x=1:M&&(x=3-M));let F=t.matchUpStatus,$=I==null?void 0:I.matchUpStatus;x===1?O=[{matchUpStatus:WE(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:WE($),previousMatchUpStatus:$,sideNumber:2}]:x===2&&(O=[{matchUpStatus:WE($),previousMatchUpStatus:$,sideNumber:1},{matchUpStatus:WE(F),previousMatchUpStatus:F,sideNumber:2}]),O.length&&(O=O.map(Y=>ft(Y)));let V=eu({...t,winningSide:M,matchUp:f,matchUpStatusCodes:O,context:h,matchUpStatus:A});if(V.error)return oe({result:V,stack:h});if(N)return bT({...t,matchUpStatus:A,targetData:b});if(!U)return oe({result:{...re},stack:h});let G=g.length===2?g[M-1]:g[0],{positionAssignments:j}=Vi({structure:u}),z=j==null?void 0:j.find(Y=>Y.drawPosition===G),H=c.drawMatchUps.find(Y=>Y.matchUpId===U.matchUpId),K=(n=H==null?void 0:H.drawPositions)==null?void 0:n.filter(Boolean),q=K.length===1;if(G){if(z!=null&&z.bye){let Y=Xa({matchUpId:H.matchUpId,inContextDrawMatchUps:r,drawDefinition:o});if(q){let Z=K.filter(Boolean)[0],Q=cM({drawPosition:Z,matchUpId:H.matchUpId,inContextDrawMatchUps:r}),ie=eu({appliedPolicies:t.appliedPolicies,matchUpId:H.matchUpId,matchUp:H,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,context:h,drawDefinition:o,winningSide:Q});return ie.error?oe({result:ie,stack:h}):aq({drawPositionToAdvance:Z,matchUpId:H.matchUpId,inContextDrawMatchUps:r,drawDefinition:o,matchUpsMap:c})}else if([Ci,mi].includes(U.matchUpStatus)){let Z=bT({...t,matchUpId:H.matchUpId,matchUpStatus:A,targetData:Y});if(Z.error)return oe({result:Z,stack:h})}return oe({result:{...re},stack:h})}return Sw({matchUpId:U.matchUpId,drawPosition:G,inContextDrawMatchUps:r,drawDefinition:o})}else if(y){if(!H)return{error:Do};if(q){let Q=K[0],ie=cM({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:Q});console.log("existing drawPosition is winningSide",{walkoverWinningSide:ie})}let Y=[Ci,mi].includes(H.matchUpStatus)?p:d,Z=eu({matchUpId:H.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:H,matchUpStatusCodes:[],removeScore:!0,context:h,drawDefinition:o,matchUpStatus:Y});if(Z.error)return oe({result:Z,stack:h});if(Y===d){let Q=bT({...t,matchUpId:l.matchUpId,matchUpStatus:Y,targetData:b});if(Q.error)return Q}}return oe({result:{...re},stack:h})}function ive(t){var e;let{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:a,matchUpsMap:o,event:s}=t,l=(e=r==null?void 0:r.target)==null?void 0:e.structureId,{structure:c}=Dt({drawDefinition:a,structureId:l});return c?ws({drawPosition:i,tournamentRecord:n,drawDefinition:a,structureId:l,matchUpsMap:o,event:s}):{error:Mf}}function WE(t){return t===er?Ci:t===fr?mi:t}function aHe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:a}=t,o=!!(a.tieMatchUps&&!a.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===a.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===wi,c=a.winningSide,u=[er,fr].includes(n),d=yC({matchUpStatus:n}),p=yB({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>eu({...t,removeScore:[Yp,Ci].includes(n),matchUpStatus:n||Fn});return h&&{error:Q$}||f&&zB(t)||m&&oHe(t)||c&&lS(t)||p&&g()||l&&rHe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:a})||!d&&{error:Q$}||u&&sHe(t)||o&&zB(t)||oe({result:{error:ow},stack:s})}function oHe(t){let e=lS(t);return e.error?e:bT(t)}function sHe(t){let e=zB({...t,removeScore:!0});return e.error?e:bT(t)}function zB(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let a=lS(t);if(a.error)return oe({result:a,stack:i})}let n=!!t.matchUp.collectionId,r=eu({...t,context:i});if(n){let{matchUpTieId:a,drawDefinition:o,matchUpsMap:s}=t,l=th({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:a,event:t.event,drawDefinition:o,matchUpsMap:s});if(l.error)return oe({result:l,stack:i});Object.assign(r,{tieMatchUpResult:l})}return oe({result:r,stack:i})}function lHe({drawDefinition:t,structure:e,matchUp:i}){var n,r,a,o;let{drawPositions:s}=i,{positionAssignments:l}=Vi({drawDefinition:t,structure:e}),c=(n=l==null?void 0:l.filter(({drawPosition:p})=>s==null?void 0:s.includes(p)))==null?void 0:n.map(p=>{var h;let{extension:f}=jt({element:p,name:tf});return(h=f==null?void 0:f.value)==null?void 0:h.groupOrder}),{containerStructures:u}=q0({drawDefinition:t}),d=u[e.structureId];return{structureIds:(o=(a=(r=X0({drawDefinition:t,structureId:d}))==null?void 0:r.links)==null?void 0:a.source)==null?void 0:o.filter(p=>{var h;return Ya(c,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function nve({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===W0&&sf({drawDefinition:t,structure:e})){let{structureIds:r}=lHe({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function cHe(t){var e,i,n;let r,{inContextDrawMatchUps:a,inContextMatchUp:o,drawDefinition:s,winningSide:l}=t,c=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(c.target.feedProfile===hc){let u=o.sides.find(({sideNumber:p})=>p!==l).participantId,d=a.find(p=>p.structureId===c.target.structureId&&p.roundNumber===c.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===Fn){let p=Xa({matchUpId:d.matchUpId,inContextDrawMatchUps:a,drawDefinition:s});if(!Jm({inContextDrawMatchUps:a,drawDefinition:s,targetData:p})){let{structure:h}=Dt({structureId:d.structureId,drawDefinition:s}),f=Vi({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=o.sides.find(({sideNumber:v})=>v===l).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(i=y.positionAssignments)==null||i.forEach(I=>I.participantId=v[I.drawPosition])}af({tournamentId:(n=t.tournamentRecord)==null?void 0:n.tournamentId,event:t.event,drawDefinition:s,structure:h}),r=!0}}}}return{...re,qualifierReplaced:r}}function uHe(t){var e,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:c,winningSide:u}=t,d=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(d.target.feedProfile===hc){let p=(i=l.sides.find(({sideNumber:m})=>m===u))==null?void 0:i.participantId,h=s.filter(m=>m.structureId===d.target.structureId&&m.roundNumber===d.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=vl(h);if((f==null?void 0:f.matchUpStatus)===Fn){let m=Xa({matchUpId:f.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!Jm({inContextDrawMatchUps:s,drawDefinition:c,targetData:m})){let g=(n=f.sides.find(I=>I.qualifier&&!I.participantId))==null?void 0:n.drawPosition,{structure:v}=Dt({structureId:f.structureId,drawDefinition:c});if(!v)return{error:wn};let y=Vi({structure:v}).positionAssignments;for(let I of y||[])if(I.drawPosition===g&&!I.participantId){if(I.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let b=Object.assign({},...(y||[]).map(D=>({[D.drawPosition]:D.participantId})));for(let D of v.structures)(r=D.positionAssignments)==null||r.forEach(w=>w.participantId=b[w.drawPosition])}af({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:v}),o=!0}}}}return{...re,qualifierPlaced:o}}function dHe(t){var e,i;let n="attemptToSetWinningSide",r,{appliedPolicies:a,disableAutoCalc:o,drawDefinition:s,dualMatchUp:l,winningSide:c,structure:u,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&o!==!1)return Aq(t);if(d.winningSide&&d.winningSide!==c){let{connectedStructureIds:m}=nve({drawDefinition:s,structure:u,matchUp:d});m.length&&(console.log({connectedStructureIds:m}),r=!0);let g=lS(t);if(g.error)return g}let p=xhe(t);if(p.error)return oe({result:p,stack:n});let h,f;return t.qualifierChanging&&(e=a==null?void 0:a[SU])!=null&&e.autoReplaceQualifiers&&(h=cHe(t).qualifierReplaced),t.qualifierAdvancing&&(i=a==null?void 0:a[SU])!=null&&i.autoPlaceQualifiers&&(f=uHe(t).qualifierPlaced),oe({result:ft({...re,...p,connectedStructures:r,qualifierReplaced:h,qualifierPlaced:f}),stack:n})}var hM={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function rve(t){var e;let{inContextDrawMatchUps:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:a,targetData:o,matchUp:s}=t,{iteration:l=0}=t;l+=1;let c="removeDoubleExit";js({method:c,color:"brightyellow",iteration:l,keyColors:hM});let{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:h}}=o;if(p&&p.matchUpStatus!==wi){let{stage:f,roundNumber:m,roundPosition:g}=p;js({winner:"winner",stage:f,roundNumber:m,roundPosition:g,keyColors:hM}),XY({...t,targetMatchUp:p,sourceMatchUp:s,iteration:l})}if(d&&d.matchUpStatus!==wi){let f=i.find(({matchUpId:b})=>b===d.matchUpId),{structure:m}=Dt({drawDefinition:r,structureId:f.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:I}=d;if(js({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:hM,feedRound:I}),(e=n==null?void 0:n.progression)==null?void 0:e.doubleExitPropagateBye)HB({drawPosition:h,targetLink:u,inContextDrawMatchUps:i,drawDefinition:r,matchUpsMap:a});else{let b=XY({...t,structure:m,targetMatchUp:d,iteration:l});if(b.error)return oe({result:b,stack:c})}}return oe({result:{...re},stack:c})}function XY(t){var e,i,n,r,a,o;let{inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:c,sourceMatchUp:u,targetMatchUp:d,matchUpsMap:p,structure:h,iteration:f}=t,m="conditionallyRemoveDrawPosition";js({method:m});let g=Xa({matchUpId:d.matchUpId,inContextDrawMatchUps:s,drawDefinition:c}),{targetMatchUps:{winnerMatchUp:v}}=g,y=p==null?void 0:p.drawMatchUps.find(E=>E.matchUpId===d.matchUpId),I=[],b,D,w;if(d.feedRound)w=(i=(e=v==null?void 0:v.drawPositions)==null?void 0:e.filter(Boolean))==null?void 0:i.find(E=>d.drawPositions.includes(E));else if(!u)w=(n=Ln((d==null?void 0:d.drawPositions)||[],(v==null?void 0:v.drawPositions)||[]))==null?void 0:n[0];else if(D=(r=Gpe({structureId:h.structureId,matchUp:u,matchUpsMap:p}))==null?void 0:r.pairedPreviousMatchUp,b=[er,fr].includes(D==null?void 0:D.matchUpStatus),I=((a=D==null?void 0:D.drawPositions)==null?void 0:a.filter(Boolean))||[],[...Mr,wi].includes(D==null?void 0:D.matchUpStatus)||(D==null?void 0:D.winningSide)){let E=u.drawPositions||[],P=(o=d.drawPositions)==null?void 0:o.filter(Boolean);Ya(E,P)&&(P=P==null?void 0:P.filter(M=>!E.includes(M))),w=E.concat(I).find(M=>P==null?void 0:P.includes(M))}if(v&&w){let{stage:E,roundNumber:P,roundPosition:M}=v;js({method:"removeDirectedWinner",drawPositionToRemove:w,keyColors:hM,color:"brightgreen",stage:E,roundNumber:P,roundPosition:M}),tve({winningDrawPosition:w,winnerMatchUp:v,inContextDrawMatchUps:s,drawDefinition:c,matchUpsMap:p})}let S=rve({targetData:g,matchUp:d,inContextDrawMatchUps:s,appliedPolicies:l,drawDefinition:c,matchUpsMap:p,structure:h,iteration:f});if(S.error)return oe({result:S,stack:m});let U=pHe({pairedPreviousDoubleExit:b,noContextTargetMatchUp:y}),C=!b;return S=eu({...t,matchUpId:d.matchUpId,matchUp:y,removeWinningSide:!0,matchUpStatusCodes:[],context:m,matchUpStatus:U,removeScore:C,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),S.error?oe({result:S,stack:m}):{...re}}function pHe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===wi?wi:t?[fr,mi].includes(e==null?void 0:e.matchUpStatus)?mi:Ci:Fn}function hHe(t){var e,i,n,r,a;let o,{inContextDrawMatchUps:s,inContextMatchUp:l,drawDefinition:c}=t,u=(e=t.targetData.targetLinks)==null?void 0:e.winnerTargetLink;if(u.target.feedProfile===hc){let d=(n=(i=l.sides)==null?void 0:i.find(({sideNumber:h})=>h===l.winningSide))==null?void 0:n.participantId,p=s.find(h=>{var f;return h.structureId===u.target.structureId&&h.roundNumber===u.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Fn){let h=Xa({matchUpId:p.matchUpId,inContextDrawMatchUps:s,drawDefinition:c});if(!Jm({inContextDrawMatchUps:s,drawDefinition:c,targetData:h})){let{structure:f}=Dt({structureId:p.structureId,drawDefinition:c}),m=Vi({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(r=y.positionAssignments)==null||r.forEach(I=>I.participantId=v[I.drawPosition])}af({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,event:t.event,drawDefinition:c,structure:f}),o=!0}}}}return{qualifierRemoved:o}}function fHe(t){var e;let{matchUp:i,matchUpStatus:n,score:r,winningSide:a}=t,o="noDownStreamDependencies";if([er,fr].includes(i==null?void 0:i.matchUpStatus)&&![er,fr].includes(n)){let g=rve(t);if(g.error)return oe({result:g,stack:o})}let s=n===er,l=zr({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!a),c=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&nHe(t.inContextMatchUp),u=t.removeScore||!c&&![mu,ps].includes(n||mu),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!a&&!zr({score:r}),p=n&&n!==Fn,h=g=>{var v,y;let I,{structure:b,drawDefinition:D,dualMatchUp:w,disableAutoCalc:S}=t;if(w!=null&&w._disableAutoCalc&&S!==!1)return Aq(t);let{connectedStructureIds:U}=nve({drawDefinition:D,structure:b,matchUp:i});U.length&&(console.log({connectedStructureIds:U}),I=!0),Object.assign(t,{removeScore:g});let C=lS(t);if(C.error)return C;if(t.removingQualifier&&(y=(v=t.appliedPolicies)==null?void 0:v[SU])!=null&&y.autoRemoveQualifiers){let E=hHe(t);return{...re,connectedStructures:I,...E}}return{...re,connectedStructures:I}};if(d&&a&&t.isCollectionMatchUp)return JY(t);let f=[Yp,ps].includes(n)&&t.dualWinningSideChange,m=(a||f)&&dHe(t)||l&&h(u)||p&&aHe(t)||d&&h(u)||i&&JY({...t,removeScore:!0})||{...re};return oe({result:m,stack:o})}function JY(t){var e;let i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){let r=lS(t);if(r.error)return r}let n=eu({...t,context:i});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:a,event:o,matchUpsMap:s}=t,{removeWinningSide:l}=th({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:a,matchUpsMap:s,event:o});l&&console.log("REMOVE WINNING SIDE")}return oe({result:n,stack:i})}function $f(t){var e;let i="addMatchUpScheduledTime",n=t.matchUp,{removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,scheduledTime:l,matchUpId:c}=t;if(!c)return oe({result:{error:ua},stack:i});if(!V0(l))return oe({result:{error:ul},stack:i});if(!n){let f=an({drawDefinition:o,matchUpId:c});if(f.error)return oe({result:f,stack:i});n=f.matchUp}let u=Lt(l),d=Km({matchUp:n}).scheduledDate,p=u&&!d;if((e=Z3({matchUp:n}).timeModifiers||[])!=null&&e.length){let f=ave({disableNotice:!0,removePriorValues:r,tournamentRecord:a,timeModifiers:[],drawDefinition:o,matchUpId:c,matchUp:n});if(f!=null&&f.error)return oe({result:f,stack:i})}let h=rI(l,!0,p);return fs({duplicateValues:!1,removePriorValues:r,tournamentRecord:a,drawDefinition:o,disableNotice:s,matchUpId:c,timeItem:{itemType:Z0,itemValue:h}})}function ave({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:a,matchUp:o}){let s="addMatchUpTimeModifiers";if(!a)return oe({result:{error:ua},stack:s});if(r!==void 0&&!Array.isArray(r))return oe({info:Ed("timeModifiers"),result:{error:Ie},stack:s});if(!o){let d=an({drawDefinition:i,matchUpId:a});if(d.error)return oe({result:d,stack:s});o=d.matchUp}let l=Z3({matchUp:o}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...re};if(c.some(d=>hB.includes(d))){l=l.filter(p=>!hB.includes(p));let d=$f({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:a});if(d.error)return oe({result:d,stack:s})}let u=r!=null&&r.length?[...c,...l]:void 0;return fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:K3,itemValue:u}})}function jO({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtIds:s}){var l,c;if(!i&&!e)return{error:Ne};if(!o)return{error:ua};let u=an({drawDefinition:n,matchUpId:o});if(u.error)return u;if(((l=u==null?void 0:u.matchUp)==null?void 0:l.matchUpType)!==gu)return{error:uo};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:Ie,context:{courtIds:s}};let d;if(s){let p=e||i&&{[i.tournamentId]:i},h=ih({tournamentRecords:p});if(h.error)return h;let f=(c=h.courts)==null?void 0:c.filter(m=>s.includes(m.courtId));if((f==null?void 0:f.length)!==s.length)return{error:Ie,context:{courtIds:s}};d=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Np,itemDate:a,itemValue:d}})}function cS({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:o}){if(!i)return{error:Ne};if(!a)return{error:ua};if(o){let s=Jp({tournamentRecords:e,tournamentRecord:i,venueId:o});if(s.error)return s}return fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:K0,itemValue:o}})}function SI({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:a,matchUpId:o,courtId:s}){var l;if(!i&&!e)return{error:Ne};if(!o)return{error:ua};if(s){let c=uI({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;cS({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:u})}return fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:qm,itemDate:a,itemValue:s}})}function Kc(t,e){let i=tde.test(t)?t:rn(t),n=Lt(t)||Lt(e)||Sc(new Date);return new Date(`${n}T${i}`).getTime()}function GO({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,disableNotice:l,drawMatchUps:c,matchUpId:u,schedule:d,event:p}){var h;if(!d)return{error:dt,info:"Missing schedule"};if(!s)return{error:tt};if(!u)return{error:ua};let f="addMatchUpScheduleItems",m,g;if(c)m=c.find(N=>N.matchUpId===u);else{let N=an({drawDefinition:s,event:p,matchUpId:u});if(N.error)return N;m=N.matchUp}let{endTime:v,courtId:y,courtIds:I,courtOrder:b,resumeTime:D,scheduledDate:w,scheduledTime:S,startTime:U,stopTime:C,timeModifiers:E,venueId:P}=d;e&&(!i||!n)&&({matchUpDependencies:i,matchUps:n}=Xl({drawDefinition:s}));let M=(h=i==null?void 0:i[u])==null?void 0:h.matchUpIds;if(d.scheduledDate&&e&&M){let N=n==null?void 0:n.filter(R=>{var A,_;return(((A=R.schedule)==null?void 0:A.scheduledDate)||Lt((_=R.schedule)==null?void 0:_.scheduledTime))&&M.includes(R.matchUpId)}).map(({schedule:R})=>{let A=OR(R);return new Date(A).getTime()});if(N!=null&&N.length){let R=OR(d),A=new Date(R).getTime();if(Math.max(...N)>=A){if(t)return oe({result:{error:Z$},stack:f});g=Z$}}}if(w!==void 0){let N=HO({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledDate:w,matchUpId:u});if(N!=null&&N.error)return oe({result:N,stack:f,context:{scheduledDate:w}})}if(S!==void 0){let N=$f({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,scheduledTime:S,matchUpId:u,matchUp:m});if(N!=null&&N.error)return oe({result:N,stack:f,context:{scheduledTime:S}})}if(U!==void 0){let N=n5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,startTime:U,event:p});if(N!=null&&N.error)return oe({result:N,stack:f,context:{startTime:U}})}if(C!==void 0){let N=a5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,stopTime:C,event:p});if(N!=null&&N.error)return oe({result:N,stack:f,context:{stopTime:C}})}if(D!==void 0){let N=o5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,resumeTime:D,matchUpId:u,event:p});if(N!=null&&N.error)return oe({result:N,stack:f,context:{resumeTime:D}})}if(v!==void 0){let N=r5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,endTime:v,event:p});if(N!=null&&N.error)return oe({result:N,stack:f,context:{endTime:v}})}if(I!==void 0){let N=jO({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtIds:I});if(N!=null&&N.error)return oe({result:N,stack:f,context:{courtIds:I}})}if(y!==void 0&&w!==void 0){let N=SI({courtDayDate:w,disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,courtId:y});if(N!=null&&N.error)return oe({result:N,stack:f,context:{courtId:y}})}if(P!==void 0){let N=cS({disableNotice:!0,removePriorValues:r,tournamentRecords:a,tournamentRecord:o,drawDefinition:s,matchUpId:u,venueId:P});if(N!=null&&N.error)return oe({result:N,stack:f,context:{venueId:P}})}if(b!==void 0&&Rt(b)){let N=i5({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,courtOrder:b,matchUpId:u});if(N!=null&&N.error)return oe({result:N,stack:f,context:{courtOrder:b}})}if(E!==void 0){let N=ave({disableNotice:!0,removePriorValues:r,tournamentRecord:o,drawDefinition:s,timeModifiers:E,matchUpId:u,matchUp:m});if(N!=null&&N.error)return oe({result:N,stack:f,context:{timeModifiers:E}})}return l||si({tournamentId:o==null?void 0:o.tournamentId,eventId:p==null?void 0:p.eventId,context:f,drawDefinition:s,matchUp:m}),g?{...re,warnings:[g]}:{...re}}function HO({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a}){if(!a)return{error:ua};let o=t&&bd.test(t);if(t&&!o)return{error:Ka};let s={itemValue:Lt(t),itemType:Y0};return fs({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:s})}function i5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:a}){if(!a)return{error:ua};if(r&&!Rt(r))return{error:Ie,info:"courtOrder must be numeric"};let o=r&&St(r);return fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:{itemType:q3,itemValue:o}})}function ove({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:a,matchUpId:o}){if(!o)return{error:ua};if(!r)return{error:vr};if(e){let l=$n({tournamentRecord:e,participantFilters:{participantTypes:[Zt],participantRoles:[lq]}}).participants??[];if(!ef({tournamentParticipants:l,participantId:r}))return{error:Gn}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return a&&(s.itemSubTypes=[a]),fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:s})}function n5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:a,event:o}){if(!r)return{error:ua};if(!V0(a))return{error:ul};let{matchUp:s}=an({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Km({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[ap,ed,Ap].includes(u==null?void 0:u.itemType)).map(u=>Kc(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||Kc(a,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==fc));let u=rI(a,!0,!0);return fs({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:fc,itemValue:u}})}else return{error:fue}}function r5({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,endTime:o,event:s}){if(!a)return{error:ua};if(!V0(o))return{error:ul};let{matchUp:l}=an({drawDefinition:n,event:s,matchUpId:a}),{scheduledDate:c}=Km({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[fc,ed,ap].includes(d==null?void 0:d.itemType)).map(d=>Kc(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||Kc(o,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Ap));let d=rI(o,!0,!0);return fs({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Ap,itemValue:d}})}else return{error:pue}}function a5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:a,event:o}){if(!r)return{error:ua};if(!V0(a))return{error:ul};let{matchUp:s}=an({drawDefinition:i,event:o,matchUpId:r}),{scheduledDate:l}=Km({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Ap||f,void 0))return{error:BW};let u=c.filter(f=>[fc,ed,ap].includes(f==null?void 0:f.itemType)).sort((f,m)=>Kc(f.itemValue,l)-Kc(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===ap,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Kc(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Kc(a,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:rI(a,!0,!0),itemType:ap};return fs({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:hue}}function o5({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:a,event:o}){if(!a)return{error:ua};if(!V0(r))return{error:ul};let{matchUp:s}=an({drawDefinition:i,event:o,matchUpId:a}),{scheduledDate:l}=Km({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Ap||f,void 0))return{error:BW};let u=c.filter(f=>[fc,ed,ap].includes(f==null?void 0:f.itemType)).sort((f,m)=>Kc(f.itemValue,l)-Kc(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===ed,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>Kc(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(Kc(r,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:rI(r,!0,!0),itemType:ed};return fs({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:f})}else return{error:Bxe}}function mHe(t){var e;let{tournamentRecord:i,inContextMatchUp:n,structure:r,drawDefinition:a}=t,o=n.roundNumber,s=n.sides.find(w=>w.sideNumber===n.winningSide),l=n.sides.find(w=>w.sideNumber!==n.winningSide),{drawPosition:c,participantId:u}=s,{drawPosition:d,participantId:p}=l,h="swapWinnerLoser",{matchUps:f}=Ui(t),m=f.filter(({drawPositions:w,roundNumber:S})=>(w==null?void 0:w.includes(c))&&S>o);qs({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:m}),m.forEach(w=>{var S,U;w.drawPositions=((S=w.drawPositions)==null?void 0:S.map(C=>C===c?d:C))||[],si({tournamentId:i==null?void 0:i.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:h,drawDefinition:a,matchUp:w})});let{stage:g,stageSequence:v}=r,y=a.structures.filter(({stage:w,stageSequence:S})=>w===g&&S>v).map(({structureId:w})=>w),{targetLinks:{loserTargetLink:I,winnerTargetLink:b}}=t.targetData,D=[I==null?void 0:I.target.structureId,(e=b==null?void 0:b.target)==null?void 0:e.structureId].filter(Boolean);return a.structures.filter(({stage:w,structureId:S})=>w!==g&&D.includes(S)).forEach(({stage:w,stageSequence:S,structureId:U})=>{y.includes(U)||y.push(U),a.structures.filter(({stage:C,stageSequence:E})=>C===w&&E>S).forEach(({structureId:C})=>{y.includes(C)||y.push(C)})}),a.structures.filter(({structureId:w})=>y.includes(w)).forEach(w=>{let{positionAssignments:S}=Vi({structure:w}),U=S==null?void 0:S.find(({participantId:E})=>E===u),C=S==null?void 0:S.find(({participantId:E})=>E===p);U&&(U.participantId=p),C&&(C.participantId=u)}),eu({...t,context:h})}function KC(t){var e,i,n,r;let a="setMatchUpStatus";t.matchUpStatus&&[Ci,er].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:o,disableScoreValidation:s,tournamentRecords:l,tournamentRecord:c,disableAutoCalc:u,enableAutoCalc:d,drawDefinition:p,matchUpStatus:h,winningSide:f,matchUpId:m,event:g,score:v}=t;if(!p)return{error:tt};if(h&&[Yp,mu,ps,Fn].includes(h)&&f)return{error:Ie,winningSide:f,matchUpStatus:h};if(![void 0,...vde].includes(h))return oe({result:{error:ow},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let y=da({drawDefinition:p}),{matchUps:I}=lr({nextMatchUps:!0,tournamentRecord:c,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g}),b=y.drawMatchUps.find(q=>q.matchUpId===m),D=I==null?void 0:I.find(q=>q.matchUpId===m);if(!b||!I)return{error:wa};if((b.winningSide||f)&&h===wi)return{context:"Cannot have Bye with winningSide",error:Q1,matchUpStatus:h};let w=D==null?void 0:D.structureId,{structure:S}=Dt({drawDefinition:p,structureId:w}),U=_n(Yi)(b.matchUpType),C=(e=D==null?void 0:D.drawPositions)==null?void 0:e.filter(Boolean),E;if(U){if(u)ui({extension:{name:hw,value:!0},element:b});else if(d){let q=b.winningSide;Va({name:hw,element:b});let{winningSide:Y,scoreStringSide1:Z,scoreStringSide2:Q,set:ie}=OC({drawDefinition:p,matchUpsMap:y,structure:S,matchUp:b,event:g}),ue={scoreStringSide1:Z,scoreStringSide2:Q,sets:ie?[ie]:[]};E=Y!==q,Object.assign(t,{winningSide:Y,dualWinningSideChange:E,projectedWinningSide:Y,score:ue})}xC({tournamentId:c==null?void 0:c.tournamentId,inContextDualMatchUp:D,eventId:g==null?void 0:g.eventId,dualMatchUp:b,drawDefinition:p})}if(U&&h&&[aI].includes(h))return{error:Ie,info:"Not supported for matchUpType: TEAM"};let P=D==null?void 0:D.matchUpTieId,M=Xa({matchUpId:P||m,inContextDrawMatchUps:I,drawDefinition:p});if(v&&!U&&!s){let q=b.matchUpFormat??(S==null?void 0:S.matchUpFormat)??(p==null?void 0:p.matchUpFormat)??(g==null?void 0:g.matchUpFormat),Y=a4({existingMatchUpStatus:b.matchUpStatus,matchUpFormat:q,matchUpStatus:h,winningSide:f,score:v});if(Y.error)return Y}let N=b!=null&&b.sides?[]:Vi({drawDefinition:p,structureId:w}).positionAssignments,R=(i=D==null?void 0:D.sides)==null?void 0:i.map(q=>q.participantId).filter(Boolean).length,A=R&&R===2||b.collectionId&&Yo({structure:S})&&R&&R>=1||(C==null?void 0:C.length)===2&&(N==null?void 0:N.filter(q=>C.includes(q.drawPosition)).every(q=>q.participantId));if(h&&gde.includes(h)&&!A)return oe({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:h,requiredParticipants:A},result:{error:ow}});let _=((n=Mi({policyTypes:[SU,Sd],tournamentRecord:c,drawDefinition:p,event:g}))==null?void 0:n.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(_,t.policyDefinitions);let O=(D==null?void 0:D.stage)===gt&&D.finishingRound===1,x=O&&f,F=O&&b.winningSide&&!f&&(!t.matchUpStatus||t.matchUpStatus&&yB({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!zr({outcome:t.outcome})),$=x&&f!==b.winningSide&&b.winningSide;if(Object.assign(t,{inContextDrawMatchUps:I,qualifierAdvancing:x,qualifierChanging:$,removingQualifier:F,inContextMatchUp:D,appliedPolicies:_,matchUpTieId:P,matchUpsMap:y,targetData:M,structure:S,matchUp:b}),P){let{matchUp:q}=an({matchUpId:P,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g});if(q){let Y=(r=Ea({matchUp:q,drawDefinition:p,structure:S,event:g}))==null?void 0:r.tieFormat,{projectedWinningSide:Z}=JGe({drawDefinition:p,matchUpStatus:h,dualMatchUp:q,matchUpsMap:y,winningSide:f,tieFormat:Y,structure:S,matchUp:b,event:g,score:v}),Q=q.winningSide;E=Z!==Q,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:E,projectedWinningSide:Z,matchUpTieId:P,dualMatchUp:q,tieFormat:Y})}}let V=Jm(t),G=yC({matchUpStatus:h});if(!P){if(V&&!f&&(h&&yB({matchUpStatus:h})||h&&[er,fr].includes(h)))return{error:Q1,activeDownstream:V,winningSide:f};if(f&&f===b.winningSide&&h&&!G)return{context:"winningSide must include directing matchUpStatus",error:Q1,directingMatchUpStatus:G,matchUpStatus:h}}let{schedule:j}=t;if(j){let q=GO({disableNotice:!0,tournamentRecords:l,tournamentRecord:c,drawDefinition:p,matchUpId:m,schedule:j});if(q.error)return q}let z=!U&&!E&&f&&b.winningSide&&b.winningSide!==f;if(o&&z&&b.roundPosition)return mHe(t);let H=f&&!P||t.projectedWinningSide;js({activeDownstream:V,matchUpWinner:H,method:a,winningSide:f});let K=!V&&fHe(t)||H&&gHe(t)||G&&sve(t)||{error:Sue};return oe({result:K,stack:a})}function gHe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?sve(t):oe({stack:"winningSideWithDownstreamDependencies",result:{error:xW},context:{winningSide:i,matchUp:e}})}function sve(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!zr({score:t.score}),a=t.isCollectionMatchUp?t.matchUpStatus||r&&Fn||qn:t.matchUpStatus||qn,o=t.removeScore||[Yp,Ci].includes(a)&&![mu,ps].includes(a),s=eu({...t,matchUpStatus:a,removeWinningSide:r,context:"sms",removeScore:o});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=th({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function lve({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:tt};let{matchUp:r}=an({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==gu?{error:uo}:KC({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function cve({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:tt};if(!i)return{error:ua};let{matchUp:n}=an({drawDefinition:t,event:e,matchUpId:i});return n?Va({name:Ck,element:n}):{error:wa}}function vHe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:a,event:o}){var s,l,c,u,d;let p="substituteParticipant";if(!n)return{error:tt};if(!a)return{error:ua};if(!e||!t)return oe({result:{error:vr},stack:p});let{matchUp:h}=an({drawDefinition:n,matchUpId:a,event:o});if(!h)return{error:wa};if(!h.collectionId)return oe({result:{error:uo},stack:p});let f=da({drawDefinition:n}),{matchUps:m}=lr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:f}),g=m==null?void 0:m.find(y=>y.matchUpId===a),v=(l=(s=m==null?void 0:m.find(y=>y.matchUpId===(g==null?void 0:g.matchUpTieId)))==null?void 0:s.sides)==null?void 0:l.find(y=>y.participant.individualParticipants.some(({participantId:I})=>I===e));return!v||r&&v.sideNumber!==r?{error:hu}:(d=(u=(c=v.participant)==null?void 0:c.individualParticipants)==null?void 0:u.map(Yt).filter(y=>y!==e))!=null&&d.includes(t)?e5({newParticipantId:t,tieMatchUpId:a,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:o}):oe({result:{error:hu},stack:p})}function uve(t){return vHe(t)}function dve({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:tt};let{matchUp:n}=an({drawDefinition:t,matchUpId:e,event:i});return ui({extension:{name:hw,value:!0},element:n})}function pve(t){let e="setMatchUpFormat",i=vi(t,[{tournamentRecord:!0},{[pc]:D=>Zo({matchUpFormat:D}),[Id]:BP,matchUpFormat:!0}]);if(i.error)return oe({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:a,stageSequences:o,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(a&&!Array.isArray(a))return oe({result:{error:Ie,scheduledDates:a},stack:e});if(c&&!Hk([Cd,Ll],c))return oe({result:{error:Jh},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],I=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return oe({result:{error:tt},stack:e});if(h&&u&&r){let D=c4({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(D.error)return D;g+=1}let b=D=>{let w=[];for(let S of D.structures||[]){if(Array.isArray(p)&&!p.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||v!=null&&v.length&&!v.includes(S.structureId))continue;v!=null&&v.length&&S.matchUpFormat!==s&&(S.matchUpFormat=s,w.push(S.structureId),g+=1);let U=((m||a)&&Ui({matchUpFilters:{matchUpStatuses:[Fn]},structure:S}).matchUps)??[],C=(a&&Ui({matchUpFilters:{matchUpStatuses:[Fn]},contextFilters:{scheduledDates:a},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps)??[];if(U!=null&&U.length){let E=C?C.map(Cr):U.map(Cr);for(let P of U)E.includes(P.matchUpId)&&(P.matchUpFormat=a!=null&&a.length?s:void 0,si({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:D,matchUp:P}))}}return!w.length&&D.matchUpFormat!==s&&(D.matchUpFormat=s,g+=1),w};for(let D of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(D.eventId)||c&&c!==D.eventType||c===Ur))if(Array.isArray(o)||Array.isArray(p)||v!=null&&v.length||I!=null&&I.length)for(let w of D.drawDefinitions||[]){if(Array.isArray(I)&&!I.includes(w.drawId))continue;let S=b(w);Ji({structureIds:S,drawDefinition:w})}else D.matchUpFormat!==s&&(D.matchUpFormat=s,g+=1);return g?{...re,modificationsCount:g}:{...re,info:L0}}function s5({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var a,o;if(!i)return{error:tt};let s=(a=an({drawDefinition:i,matchUpId:n}))==null?void 0:a.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:uo};let l=(o=an({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:o.matchUp,c=0;return((s==null?void 0:s.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((l==null?void 0:l.sides)||[]).forEach(u=>{if(c+=1,t===!1){let d=l==null?void 0:l.tieFormat,p=u.participantId;d&&p&&gI({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}si({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:s})}),{...re,modificationsCount:c}}function hve(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let a=r.sets||[],o=nd({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:a}),s=nd({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:a}),l=nd({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:a}),c=o===l?s:o;return n&&(o=n===1?l:c,s=n===2?l:c),{score:{sets:a,scoreStringSide1:o,scoreStringSide2:s}}}function YC(t){var e;let i=vi(t,[{[Dg]:!0,[$c]:!0}]);if(i.error)return i;let n=Eu(t);if(!t.drawDefinition){let y=t.tournamentRecord??(t.tournamentId&&n[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=y);let I=po({eventId:t.eventId,drawId:t.drawId,tournamentRecord:y});if(I.error)return I;I.drawDefinition&&(t.drawDefinition=I.drawDefinition),t.event=I.event}let{disableScoreValidation:r,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:c,matchUpFormat:u,matchUpId:d,schedule:p,event:h,notes:f}=t,{policy:m}=Rg({policyType:Sd,tournamentRecord:o,event:h}),g=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(m==null?void 0:m.allowChangePropagation)!==void 0&&m.allowChangePropagation||void 0,{outcome:v}=t;if(v!=null&&v.winningSide&&![1,2].includes(v.winningSide))return{error:pk};if(u){let y=c4({tournamentRecord:o,drawDefinition:c,matchUpFormat:u,matchUpId:d,event:h});if(y.error)return y}if((e=v==null?void 0:v.score)!=null&&e.sets&&!v.score.scoreStringSide1){let{score:y}=hve(v);v.score=y,v.score.sets=v.score.sets.filter(I=>I.side1Score||I.side2Score||I.side1TiebreakScore||I.side2TiebreakScore)}return KC({matchUpStatusCodes:v==null?void 0:v.matchUpStatusCodes,matchUpStatus:v==null?void 0:v.matchUpStatus,winningSide:v==null?void 0:v.winningSide,allowChangePropagation:g,disableScoreValidation:r,score:v==null?void 0:v.score,tournamentRecords:n,policyDefinitions:a,tournamentRecord:o,disableAutoCalc:s,enableAutoCalc:l,drawDefinition:c,matchUpFormat:u,matchUpId:d,schedule:p,event:h,notes:f})}function fve(t){if(!(t!=null&&t.outcomes))return{error:dt};if(!Array.isArray(t.outcomes))return{error:dt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,a)=>r.includes(a.tournamentId)?r:r.concat(a.tournamentId),[]);for(let r of n){let a=e[r];if(!a)return{error:Ne};let o=i.filter(s=>s.tournamentId===r);if(o.length){let s=yHe({outcomes:o,tournamentRecord:a});if(s.error)return s}}return{...re}}function yHe(t){var e;let{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:a}=t,o={};r.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=po({tournamentRecord:n,eventId:s});for(let c of o[s]){let{drawId:u}=c,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=YC({schedule:c==null?void 0:c.schedule,tournamentRecords:i,policyDefinitions:a,tournamentRecord:n,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...re}}function IHe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,a;if(!n&&!t)return{error:tt};if(!i)return{error:dt,info:"missing outcome"};if(!n&&!e)return{error:Do};if(!n){let o=an({drawDefinition:t,matchUpId:e});if(o.error)return o;n=o.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((a=i.score)!=null&&a.scoreStringSide2)?{error:Ie}:ui({element:n,extension:{name:Ck,value:i}})}function mve(t){return IHe(t)}function l5(t){var e,i;let n="resetTieFormat",{drawDefinition:r,event:a,uuids:o}=t,s=vi(t,[{[Ad]:!0,[Dg]:!0}],n);if(s.error)return s;let l=zC(t,[{[qP]:Af}]);if(l[Ev])return l;let c=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:u,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(u!=null&&u.tieMatchUps))return oe({result:{error:uo},info:"Must be a TEAM matchUp",stack:n});if(!u.tieFormat)return{...re};let p=(i=Ea({structure:d,drawDefinition:r,event:a}))==null?void 0:i.tieFormat;if(!p)return oe({result:{error:Sa},info:"No inherited tieFormat",stack:n});let h=[],f=[],m=[],g=[];for(let v of p.collectionDefinitions){let{matchUpCount:y,collectionId:I}=v;f.push(I);let b=(u.tieMatchUps||[]).filter(D=>D.collectionId===I);if(b.length>y)b.sort((D,w)=>(D.matchUpStatus===Fn?1:0)-(w.matchUpStatus===Fn?1:0)),m.push(...b.slice(0,y)),h.push(...b.slice(3).map(Cr));else if(m.push(...b),b.length<y){let D=y-b.length,w=NC({collectionDefinition:v,matchUpsLimit:D,matchUp:u,uuids:o});g.push(...w)}}for(let v of(u==null?void 0:u.tieMatchUps)||[])v.collectionId&&!f.includes(v.collectionId)&&h.push(v.matchUpId);return g.length&&(m.push(...g),rf({eventId:a==null?void 0:a.eventId,matchUps:g,drawDefinition:r,tournamentId:c})),h.length&&Zp({matchUpIds:h,eventId:a==null?void 0:a.eventId,drawDefinition:r,tournamentId:c}),u&&(u.tieMatchUps=m,u.tieFormatId=void 0,u.tieFormat=void 0,si({structureId:d==null?void 0:d.structureId,eventId:a==null?void 0:a.eventId,context:n,drawDefinition:r,tournamentId:c,matchUp:u})),{...re,newMatchUps:g,deletedMatchUpIds:h}}function c5(t){var e,i,n;let{tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s}=t,l="resetScorecard";if(!a)return oe({result:{error:tt},stack:l});if(!o)return oe({result:{error:ua},stack:l});if(!co(o))return oe({result:{error:Ie,matchUpId:o},stack:l});let c=da({drawDefinition:a}),{matchUps:u}=lr({nextMatchUps:!0,inContext:!0,drawDefinition:a,matchUpsMap:c}),d=c.drawMatchUps.find(y=>y.matchUpId===o),p=u==null?void 0:u.find(y=>y.matchUpId===o);if(!d||!u)return{error:wa};if(d.matchUpType!==Ys)return{error:uo};let h=Xa({inContextDrawMatchUps:u,drawDefinition:a,matchUpId:o}),f=p==null?void 0:p.structureId,{structure:m}=Dt({drawDefinition:a,structureId:f});if(Object.assign(t,{inContextDrawMatchUps:u,inContextMatchUp:p,matchUpsMap:c,targetData:h,structure:m,matchUp:d}),Jm(t))return{error:xW};if((e=d.tieMatchUps)!=null&&e.length)for(let y of d.tieMatchUps){let I=KC({matchUpId:y.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:r,drawDefinition:a,event:s});if(I.error)return oe({result:I,stack:l})}let g=(i=Mi({tournamentRecord:r,drawDefinition:a,event:s}))==null?void 0:i.appliedPolicies,v=th({event:t.event,removeScore:!0,tournamentRecord:r,appliedPolicies:g,drawDefinition:a,matchUpsMap:c,matchUpId:o});if(v.error)return oe({result:v,stack:l});if(t.tiebreakReset&&!v.tieFormatRemoved){let y=(n=Ea({drawDefinition:a,structure:m,event:s}))==null?void 0:n.tieFormat;if(d.tieFormat&&y){let{matchUpCountDifference:I,descendantDifferences:b,ancestorDifferences:D,valueDifference:w}=_p({descendant:d.tieFormat,ancestor:y});if(b.collectionIds.length===1&&!D.collectionIds.length&&!D.groupsCount&&I===1&&w===1){let S=l5({tournamentRecord:r,drawDefinition:a,matchUpId:o,event:s});if(S.error)return S}}}return{...re}}function gve(t){let e=vi(t,[{[$c]:!0,[$0]:!0},{[bU]:{[WP]:!1,roundNumbers:!1},[Jue]:"At least one must be provided",[_f]:Ao}]);if(e.error)return e;let i=jhe(t);if(i.error)return i;let{matchUpIds:n}=i,r=_n(Ys)(t.event.eventType),{tournamentRecord:a,drawDefinition:o,event:s}=t;for(let l of n){if(r){let u=c5({tiebreakReset:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(u.error||t.removeAssignments&&s5({inheritance:!1,drawDefinition:o,matchUpId:l}).error)return u}let c=KC({winningSide:void 0,removeScore:!0,tournamentRecord:a,drawDefinition:o,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=t5({...t,matchUpId:l});if(u.error)return u}}return{...re}}function bHe({drawDefinition:t,finishingOrder:e}){var i;if(!t)return{error:tt};let n="setOrderOfFinish";if(!Array.isArray(e))return oe({info:Ed("finishingOrder"),result:{error:Ie},stack:n});let{completedMatchUps:r,matchUpsMap:a}=J0({inContext:!0,drawDefinition:t}),o=(r==null?void 0:r.map(Cr))??[],s=e.map(Cr),{matchUpTypes:l,roundNumbers:c,structureIds:u,matchUpTieIds:d}=(r??[]).filter(({matchUpId:y})=>s.includes(y)).reduce((y,I)=>{let{matchUpTieId:b,matchUpType:D,roundNumber:w,structureId:S}=I;return y.matchUpTypes.includes(D)||y.matchUpTypes.push(D),y.roundNumbers.includes(w)||y.roundNumbers.push(w),y.structureIds.includes(S)||y.structureIds.push(S),y.matchUpTieIds.includes(b)||y.matchUpTieIds.push(b),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(l.length>1||d.length>1||c.length>1||u.length>1)return oe({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Ie},stack:n});let p,h,f={},m=[],g=[];if(!e.every(({orderOfFinish:y,matchUpId:I})=>(m.push(I),y&&g.push(y),f[I]=y,p=o.includes(I),h=y===void 0||Rt(y)&&Math.floor(y)>0,p&&h)))return oe({result:{error:p?Ie:ow},info:!p&&"matchUps must be completed"||!h&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:n});let v=r==null?void 0:r.filter(y=>y.structureId===u[0]&&y.roundNumber===c[0]&&y.matchUpType===l[0]&&y.matchUpTieId===d[0]&&!m.includes(y.matchUpId));for(let y of v??[]){let{orderOfFinish:I}=y||{};if(I){if(!Rt(I))return oe({context:{orderOfFinish:I,matchUp:y},result:{error:Ie},stack:n});g.push(I)}}if(Aue(g).length!==g.length||Math.max(...g)>g.length)return oe({info:"Values not unique or greater than expected number of values",result:{error:Ie},stack:n});if(u.length){let y=zk({matchUpFilters:{matchUpIds:s},structureId:u[0],drawDefinition:t,matchUpsMap:a});if(y.error)return oe({result:y,stack:n});(i=y.completedMatchUps)==null||i.forEach(I=>I.orderOfFinish=f[I.matchUpId])}return{...re}}function vve(t){return bHe(t)}function yve({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:n,event:r}){var a,o,s,l;if(!t)return{error:Ne};if(!e)return{error:zo};if(typeof i!="string")return{error:uo};if(!Array.isArray(n))return{error:Ie,lineUps:n};let c="applyLineUps",u=t.participants||[],d=an({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpId:i});if(d.error)return d;if(!d.matchUp)return{error:wa};let{matchUp:p,structure:h}=d,{drawPositions:f,matchUpType:m}=p;if(m!==Yi)return{error:uo};if(!(f!=null&&f.length))return{error:FP};let g=(a=Ea({matchUp:p,drawDefinition:e,structure:h,event:r}))==null?void 0:a.tieFormat,v={};for(let I of n){if(!Array.isArray(I))return{error:Ie,lineUp:I};let b={},D=[];for(let E of I){if(typeof E!="object")return{error:Ie,lineUpAssignment:E};let{participantId:P,collectionAssignments:M=[]}=E;if(!Array.isArray(M))return{error:Ie,collectionAssignments:M};let N=u.find(A=>A.participantId===P);if(!N)return{error:Gn};if(N.participantType!==Zt)return{error:Mc};let R=(s=(o=p.sides)==null?void 0:o.find(A=>{var _,O;return(O=(_=A.participant)==null?void 0:_.individualParticipantIds)==null?void 0:O.includes(P)}))==null?void 0:s.sideNumber;R&&D.push(R);for(let A of M){if(typeof A!="object")return{error:Ie,collectionAssignment:A};let{collectionId:_,collectionPosition:O}=A,x=(l=g==null?void 0:g.collectionDefinitions)==null?void 0:l.find(V=>V.collectionId===_);if(!x)return{error:Ie,collectionId:_};let F=`${_}-${O}`;b[F]||(b[F]=[]);let $=b[F].length;if(_n(Un)(x.matchUpType)&&$||x.matchUpType===qi&&$>1)return{info:"Excessive collectionPosition assignments",error:Ie};b[F].push(P)}}let w=Object.values(b);for(let E of w)if(E.length===2){let{participant:P}=Fl({tournamentParticipants:u,participantIds:E});if(!P){let M=bu({participant:{participantType:Ot,participantRole:va,individualParticipantIds:E},pairOverride:!0,tournamentRecord:t});if(M.error)return M}}let S=qo(D),U=(S[1]||0)>(S[2]||0)&&1||(S[2]||0)>(S[1]||0)&&2||void 0,C=Object.keys(v).map(E=>parseInt(E));U&&!C.includes(U)&&(v[U]=I)}if(!Object.keys(v).length)return{error:zW};if(d=an({drawDefinition:e,matchUpId:i}),d.error)return d;if(!d.matchUp)return{error:wa};let{matchUp:y}=d;y.sides||(y.sides=[]);for(let I of[1,2]){let b=y.sides.find(w=>w.sideNumber===I),D=v[I];if(D)b?b.lineUp=D:y.sides.push({lineUp:D,sideNumber:I});else continue}return si({tournamentId:t==null?void 0:t.tournamentId,context:c,drawDefinition:e,matchUp:y}),{...re}}var u5={};Ht(u5,{anonymizeTournamentRecord:()=>Gve,generate:()=>Ive,generateEventWithDraw:()=>KO,generateOutcome:()=>v5,generateOutcomeFromScoreString:()=>d5,generateParticipants:()=>QC,generateTournamentRecord:()=>Vve,modifyTournamentRecord:()=>Hve,mutate:()=>jve});var Ive={};Ht(Ive,{generateEventWithDraw:()=>KO,generateOutcome:()=>v5,generateOutcomeFromScoreString:()=>d5,generateParticipants:()=>QC,generateTournamentRecord:()=>Vve});function d5(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...Qk,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Ie,winningSide:n};let a=r&&aN({scoreString:r}),o={},s=nd({sets:a,matchUpFormat:e}),l=nd({sets:a,reversed:!0,matchUpFormat:e});return n===2?(o.scoreStringSide1=l,o.scoreStringSide2=s):(o.scoreStringSide1=s,o.scoreStringSide2=l),o.sets=aN({scoreString:o.scoreStringSide1}),ft({outcome:{matchUpStatus:i,winningSide:n,score:o}})}function p5({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;let a=(((r=e==null?void 0:e[n.matchUpId])==null?void 0:r.matchUpIds)||[]).filter(o=>i.includes(o)).filter(o=>!t[o]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function Cw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,a,o,s;let{individualParticipantIds:l}=Fk(n);i=i??((r=n.schedule)==null?void 0:r.timeAfterRecovery);let c=h=>{t[h]||(t[h]=[]),t[h]=$t(t[h].concat(...l))},u=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},d=((a=n.winnerTo)==null?void 0:a.matchUpId)||n.winnerMatchUpId;d&&(i&&u(d),c(d));let p=((o=n.loserTo)==null?void 0:o.matchUpId)||n.loserMatchUpId;p&&(i&&u(p),c(p)),(s=n.sidesTo)!=null&&s.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&u(h),c(h))})}function ZC({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function wHe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function VU({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:a,recoveryMinutes:o=0,scheduleTime:s,matchUp:l}){var c,u;let d=rn((c=l==null?void 0:l.schedule)==null?void 0:c.endTime),p=d?So(d,St(o)):So(s,St(n)+St(o)),h=i&&(d?So(rn(d),i):So(s,St(n)+St(i))),f=((u=a==null?void 0:a[l.matchUpId])==null?void 0:u.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();f.forEach(g=>{ZC({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&h||p;m.includes(g)?wHe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),Cw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function bve({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var a,o,s,l,c;let u,d=(o=(a=r.minutesMap)==null?void 0:a[n])==null?void 0:o.recoveryMinutes,p=(((l=(s=r.minutesMap)==null?void 0:s[n])==null?void 0:l.averageMinutes)||0)+(d||0),h=So(i,p),f=((c=e==null?void 0:e[n])==null?void 0:c.dependentMatchUpIds)||[];if(f.length){let m=f.reduce((g,v)=>{let y=t[v];if(!y)return g;let I={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||ri(y)<ri(g.scheduleTime)?I:g},{});m.scheduleTime&&ri(h)>ri(m.scheduleTime)&&(u=m)}return{scheduledDependent:u}}function SHe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===qi&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var XC="DO_NOT_SCHEDULE",THe={DO_NOT_SCHEDULE:XC};function h5({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:a,matchUp:o}){let s=SHe(o).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((o==null?void 0:o.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);s.push(...h)}let l=s.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===XC&&wd(a,h.date)),c=[],u=o==null?void 0:o.matchUpId,d=Jn(rn(r),Lt(a)),p=rn(u3(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function WB({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:a}=Fk(i),o=(t[i.matchUpId]||[]).filter(s=>!Ya(s,a)).flat();[...a,...o].forEach(s=>{if(ZC({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Dl]?l[Dl]+=n:n>0&&(l[Dl]=n),o.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function UHe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:a,matchUpScheduleTimes:o,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var p,h;let f=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},I=v.matchUpStatus===wi;return I&&f.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!I&&GC({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map(Cr));let m=Array.isArray(l)?l.includes(c):l,g=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of g){WB({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){o[v.matchUpId]=y;let I=(h=u==null?void 0:u[v.matchUpId])==null?void 0:h.recoveryMinutes;VU({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:a,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:I,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:m}}function DHe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:a,clearDate:o,matchUps:s}){let l=Object.keys(r),c=a.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!o&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),h=[wi,mi,qn,ps,Na,Ci,er,fr].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!h}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:h,tournamentId:f}=p;return d.matchUpMap[f]||(d.matchUpMap[f]={}),d.matchUpMap[f][h]?d.matchUpMap[f][h].push(p):d.matchUpMap[f][h]=[p],Cw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function zO({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:a,scheduleDate:o,matchUps:s}){if(typeof n!="object")return{error:Cn};if(!el(s)&&!Array.isArray(i))return{error:Nd};a=a??FO({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=pC({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return GC({schedule:p})&&(!o||d.schedule.scheduledDate===o)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==wi);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:I}=Bk({timingDetails:v,eventType:g}),{courtId:b,venueId:D}=p,w=rn(p.scheduledTime),S=So(w,y);return{recoveryMinutes:I,averageMinutes:y,periodLength:a,startTime:w,courtId:b,endTime:S,venueId:D}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function PHe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:a,tournamentRecord:o,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(o&&!a&&(a={[o.tournamentId]:o}),typeof a!="object"||!Object.keys(a).length)return{error:Cn};s=s??FO({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=ih({dates:[l],ignoreDisabled:!0,tournamentRecords:a}),m=(h==null?void 0:h.filter(D=>!u||u.includes(D.venueId)))??[];c=c??Pw({courts:m,scheduleDate:l,startTime:!0}),p=p??Pw({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=zO({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:a,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:I}=Z4(y),b=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ko("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:I,venueId:b}}function CHe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],a,o,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:s,recoveryMinutes:o,roundPeriodLength:a,matchUpIds:r}),r=c.matchUpIds),s=i?e:c.averageMinutes,o=c.recoveryMinutes,a=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:a,recoveryMinutes:o,averageMinutes:s}),{groupedRounds:n}}function wve({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var m;let g={},v=[],y=[],I=[];for(let b of f){let{rounds:D=[],venueId:w}=b,{scheduledRoundsDetails:S,greatestAverageMinutes:U,orderedMatchUpIds:C,minutesMap:E}=VC({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:D});I.push(...C??[]);let{groupedRounds:P}=CHe({scheduledRoundsDetails:S,greatestAverageMinutes:U,garmanSinglePass:!0}),M,N,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=PHe({averageMatchUpMinutes:(m=P[0])==null?void 0:m.averageMinutes,scheduleDate:Lt(u),venueIds:[b.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let A=UHe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:M,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,matchUpDependencies:o,clearScheduleDates:s,scheduleDate:u,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:O}=A;_!=null&&_.length&&y.push(..._);let{matchUpsToSchedule:x,matchUpMap:F}=DHe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:M,matchUpNotBeforeTimes:r,matchUpScheduleTimes:a,orderedMatchUpIds:C,clearDate:O,matchUps:p}),$=h.filter(V=>V.venueId===w);g[w]={previousRemainingScheduleTimes:[],courtsCount:$.length,greatestAverageMinutes:U,scheduledRoundsDetails:S,dateScheduledMatchUps:N,matchUpsToSchedule:x,scheduleTimes:R,groupedRounds:P,venueCourts:$,minutesMap:E,matchUpMap:F},s||v.push(...M)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:I}}function EHe(t,e){let i=ri(t.scheduleTime),n=ri(t.timeAfterRecovery),r=ri(e.scheduleTime),a=ri(e.timeAfterRecovery),o=i===r||n===a,s=i>r&&i<a,l=r>i&&r<n,c=n>r&&n<a,u=a>i&&a<n;return ft({hasOverlap:o||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function f5({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:a}){var o,s,l,c,u;let d=(((o=i==null?void 0:i[r.matchUpId])==null?void 0:o.participantIds)||[]).flat(),p=((l=(s=a==null?void 0:a.minutesMap)==null?void 0:s[r.matchUpId])==null?void 0:l.averageMinutes)||0,h=((u=(c=a==null?void 0:a.minutesMap)==null?void 0:c[r.matchUpId])==null?void 0:u.recoveryMinutes)||0,f=d.every(v=>{var y;ZC({individualParticipantProfiles:t,participantId:v});let I=t[v];if(!I.timeAfterRecovery)return!0;let b=rn((y=r==null?void 0:r.schedule)==null?void 0:y.endTime),D=b?So(b,St(h)):So(n,St(p)+St(h));return![...Object.keys(I.potentialBookings).filter(w=>w!==r.drawId).map(w=>I.potentialBookings[w]).flat(),...I.bookings].find(w=>EHe({scheduleTime:n,timeAfterRecovery:D},w).hasOverlap)}),m=e[r.matchUpId],g=(m?KP(Jn(m),Jn(n),!1):0)>=0;return{enoughTime:f&&g}}function m5({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=Fk(n),{matchUpId:a,matchUpType:o}=n,s=(n.roundPosition&&e[a]||[]).flat(),l=$t(r.concat(...s));return l.forEach(c=>{ZC({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[o,Dl].find(d=>{var p;let h=((p=u.counters)==null?void 0:p[d])||0,f=i[d]||0;return h&&f&&h>=f})}),relevantParticipantIds:l}}function jU({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:a,tournamentRecords:o,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var d,p,h;if(!s)return{error:Ne};if(!l&&(!c||!Array.isArray(c)))return{error:_0};if(!l&&(!u||typeof u!="object"))return{error:gue};let f,m=[],g=0;if(n&&!r){let I=Xl({tournamentRecords:o,tournamentRecord:s});r=I.matchUpDependencies,f=I.matchUps}f||(f=((d=Hr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);let v=f.reduce((I,b)=>{let{matchUpId:D,drawId:w,matchUpStatus:S}=b;return(e||S!==wi)&&(t||!Mr.includes(S))&&(I[w]?I[w].push(D):I[w]=[D]),I},{}),y=l==null?void 0:l.map(I=>I.matchUpId);for(let I of Object.keys(v)){let{drawDefinition:b}=Ff({tournamentRecord:s,drawId:I});if(!b)continue;let D=v[I].filter(S=>(c==null?void 0:c.includes(S))??(y==null?void 0:y.includes(S))),w=ro({inContext:!1,drawDefinition:b}).matchUps;for(let S of D){let U=((p=l==null?void 0:l.find(E=>E.matchUpId===S))==null?void 0:p.schedule)||u,C=GO({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:a,inContextMatchUps:f,tournamentRecords:o,tournamentRecord:s,checkChronology:n,drawDefinition:b,drawMatchUps:w,matchUpId:S});if((h=C==null?void 0:C.warnings)!=null&&h.length&&m.push(...C.warnings),C!=null&&C.success&&(g+=1),C.error)return C}}return m.length?{...re,scheduled:g,warnings:m}:{...re,scheduled:g}}function JC(t){var e;let{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:a,removePriorValues:o,tournamentRecords:s,checkChronology:l,matchUpDetails:c,schedule:u}=t;if(t.matchUpIds&&!a)return jU(t);let d=vi(t,[{[Ta]:!0},{[bU]:{matchUpContextIds:!1,matchUpDetails:!1},[Id]:Ie,[_f]:Ao}]);if(d.error)return d;if((!c||a)&&!u)return{error:dt,info:"schedule is required"};let p=[],h=0,{matchUpDependencies:f}=Xl({tournamentRecords:s});for(let m of Object.values(s)){let{tournamentId:g}=m,v=a==null?void 0:a.filter(I=>I.tournamentId===g).map(Cr),y=c==null?void 0:c.filter(I=>(I==null?void 0:I.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let I=jU({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:o,tournamentRecords:s,tournamentRecord:m,checkChronology:l,matchUpIds:v,schedule:u});if((e=I.warnings)!=null&&e.length&&p.push(...I.warnings),I.scheduled&&(h+=I.scheduled),I.error)return I}}return p.length?{...re,scheduled:h,warnings:p}:{...re,scheduled:h}}function Sve({autoSchedulingAudit:t,tournamentRecords:e}){var i;ti({topic:yw,payload:t});let n=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),a={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:n(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:n(t==null?void 0:t.requestConflicts),profileRoundsCount:r},o={itemType:Ege,itemValue:a};for(let s of Object.values(e))vI({tournamentRecord:s,timeItem:o})}function MHe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var g,v,y,I,b,D,w;let S={},U={},C={},E={},P={},M={},N={},R={},A={},_={};for(let F of r){let $=Lt(F==null?void 0:F.scheduleDate),V=(F==null?void 0:F.venues)||[],G={},j={},z=(J,te)=>{J.forEach(se=>{let ee=j[se].counters;ee[te]?ee[te]+=1:ee[te]=1,ee[Dl]?ee[Dl]+=1:ee[Dl]=1})};C[$]={},E[$]={},S[$]={},U[$]={},N[$]=[],R[$]=[],A[$]=[],_[$]=[];let H={};h.forEach(J=>{var te;(te=J.schedule)!=null&&te.scheduledDate&&wd($,Lt(J.schedule.scheduledDate))&&Cw({matchUpPotentialParticipantIds:G,matchUpNotBeforeTimes:H,matchUp:J})});let{allDateScheduledByeMatchUpDetails:K,venueScheduledRoundDetails:q,allDateMatchUpIds:Y}=wve({matchUpPotentialParticipantIds:G,individualParticipantProfiles:j,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:H,matchUpScheduleTimes:M,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:$,matchUps:h,courts:f,venues:V}),Z=10,Q=0,ie,ue=10;for(;!ie;){for(let{venueId:J}of V){let te=0,se=q[J];for(;se.courtsCount&&(g=se.scheduleTimes)!=null&&g.length&&(v=se.matchUpsToSchedule)!=null&&v.length&&te<=se.courtsCount;){let{scheduleTime:ee,attempts:ce=0}=se.scheduleTimes.shift(),fe=se.matchUpsToSchedule.find(ge=>{var he,Se;let{matchUpId:Ce,matchUpType:Fe}=ge,{participantIdsAtLimit:Je,relevantParticipantIds:xe}=m5({matchUpPotentialParticipantIds:G,individualParticipantProfiles:j,matchUpDailyLimits:s,matchUp:ge});if(Je.length)return R[$].includes(Ce)||R[$].push(Ce),!1;let{scheduledDependent:st}=bve({matchUpScheduleTimes:M,matchUpDependencies:o,scheduleTime:ee,matchUpId:Ce,details:se});if(st)return!1;let{dependenciesScheduled:we,remainingDependencies:Oe}=p5({matchUpScheduleTimes:M,matchUpDependencies:o,allDateMatchUpIds:Y,matchUp:ge});if(!we)return E[$][Ce]||(E[$][Ce]=[]),E[$][Ce].push({scheduleTime:ee,remainingDependencies:Oe}),!1;let{enoughTime:ye}=f5({individualParticipantProfiles:j,matchUpNotBeforeTimes:H,matchUpDependencies:o,scheduleTime:ee,details:se,matchUp:ge});if(!ye)return C[$][Ce]||(C[$][Ce]=[]),C[$][Ce].push({scheduleTime:ee}),!1;let Be=se.greatestAverageMinutes,{conflicts:Ee}=h5({potentials:e,averageMatchUpMinutes:Be,requestConflicts:_,personRequests:d,scheduleTime:ee,scheduleDate:$,matchUp:ge});if(Ee!=null&&Ee.length)return P[$]||(P[$]=[]),P[$].push(...Ee),!1;z(xe,Fe);let qe=(Se=(he=se.minutesMap)==null?void 0:he[Ce])==null?void 0:Se.recoveryMinutes;return VU({matchUpPotentialParticipantIds:G,individualParticipantProfiles:j,matchUpNotBeforeTimes:H,averageMatchUpMinutes:Be,matchUpDependencies:o,recoveryMinutes:qe,scheduleTime:ee,matchUp:ge}),M[Ce]=ee,!0});se.matchUpsToSchedule=se.matchUpsToSchedule.filter(({matchUpId:ge})=>ge!==(fe==null?void 0:fe.matchUpId)),fe?te+=1:(U[$][J]||(U[$][J]=[]),U[$][J].push({scheduleTime:ee,attempts:ce+1}))}(y=se.matchUpsToSchedule)!=null&&y.length&&(U[$][J]=(I=U[$][J])==null?void 0:I.filter(ee=>{let ce=ee.attempts<Z;return ce&&se.scheduleTimes.push(ee),!ce})),(!((b=se.scheduleTimes)!=null&&b.length)||!((D=se.matchUpsToSchedule)!=null&&D.length))&&(se.complete=!0)}Q+=1,ie=V.every(({venueId:J})=>q[J].complete)||Q===ue}for(let{venueId:J}of V){let te=q[J].matchUpMap;Object.keys(te).forEach(se=>{let ee=c[se];ee&&Object.keys(te[se]).forEach(ce=>{let{drawDefinition:fe}=Ff({tournamentRecord:ee,drawId:ce});fe&&te[se][ce].forEach(({matchUpId:ge})=>{let he=M[ge];if(he){let Se=he.split(":").map(ks).join(":"),Ce=`${Lt($)}T${Se}`;m?N[$].push(ge):($f({drawDefinition:fe,scheduledTime:Ce,matchUpId:ge}).success&&N[$].push(ge),J&&cS({tournamentRecord:ee,drawDefinition:fe,matchUpId:ge,venueId:J}))}})})}),A[$]=q[J].matchUpsToSchedule.map(Cr),S[$][J]=q[J].scheduleTimes.sort((se,ee)=>ri(se.scheduleTime)-ri(ee.scheduleTime))}!m&&K!=null&&K.length&&JC({matchUpDetails:K,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of F.venues)for(let te of J.rounds){let se=(((w=te.matchUps)==null?void 0:w.map(({matchUpId:ce})=>ce))||[]).filter(ce=>N[$].includes(ce));te.canScheduledMatchUpIds=se;let ee=Math.round(se.length/te.matchUpsCount*1e4)/100;(ee===1/0||isNaN(ee))&&(ee=0),te.possibleToSchedulePct=ee,te.matchUpsCount===se.length&&(te.possibleToSchedule=!0)}}let O=r.map(({scheduleDate:F})=>F),x={timeStamp:Date.now(),overLimitMatchUpIds:R,scheduledMatchUpIds:N,schedulingProfile:u,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:O};return Sve({tournamentRecords:c,autoSchedulingAudit:x}),{...re,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:S,dateSchedulingProfiles:r,skippedScheduleTimes:U,recoveryTimeDeferredMatchUpIds:C,dependencyDeferredMatchUpIds:E,matchUpScheduleTimes:M,overLimitMatchUpIds:R,scheduledMatchUpIds:N,noTimeMatchUpIds:A,requestConflicts:_,scheduledDates:O}}function QY({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:dt,stack:"getEarliestCourtTime"};let a=Pw({scheduleDate:r,courts:[n],startTime:!0}),o=Pw({scheduleDate:r,courts:[n],endTime:!0});e=e||a,i=i||o;let s=qC({court:n,date:r}),{timeSlots:l}=sS({courtDate:s}),c=Jn(e),u=Jn(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=Jn(p.startTime),f=Jn(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(KP(m,f)>=t){let g=rn(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:a,courtEndTime:o}}function RHe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:a,matchUpDependencies:o,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var g,v;let y={},I={},b={},D={},w={},S={},U={},C={},E={};for(let N of r??[]){let R=Lt(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},O={},x=(J,te)=>{J.forEach(se=>{let ee=O[se].counters;ee[te]?ee[te]+=1:ee[te]=1,ee[Dl]?ee[Dl]+=1:ee[Dl]=1})};y[R]={},I[R]={},S[R]=[],U[R]=[],C[R]=[],E[R]=[];let F={};h==null||h.forEach(J=>{var te;(te=J.schedule)!=null&&te.scheduledDate&&wd(R,Lt(J.schedule.scheduledDate))&&Cw({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:F,matchUp:J})});let{allDateScheduledByeMatchUpDetails:$,allDateScheduledMatchUpIds:V,venueScheduledRoundDetails:G,allDateMatchUpIds:j}=wve({matchUpPotentialParticipantIds:_,individualParticipantProfiles:O,scheduleCompletedMatchUps:i,containedStructureIds:a,matchUpNotBeforeTimes:F,matchUpScheduleTimes:w,matchUpDependencies:o,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:R,matchUps:h,courts:f,venues:A}),z=h==null?void 0:h.filter(({matchUpId:J})=>V.includes(J)),{bookings:H}=zO({dateScheduledMatchUps:z,tournamentRecords:c,scheduleDate:R,periodLength:u}),{virtualCourts:K}=LO({scheduleDate:R,periodLength:u,bookings:H,courts:f}),q=K==null?void 0:K.reduce((J,te)=>{let{earliestCourtTime:se,courtEndTime:ee}=QY({date:R,averageMinutes:0,court:te});return(!J.startTime||Jn(se)<Jn(J.startTime))&&(J.startTime=se),(!J.endTime||Jn(ee)>Jn(J.endTime))&&(J.endTime=ee),J},{}),Y=q.startTime,Z=({courtId:J,booking:te})=>{var se;return(se=K==null?void 0:K.find(ee=>ee.courtId===J))==null?void 0:se.dateAvailability[0].bookings.push(te)},Q=10,ie=0,ue;for(;!ue;){for(let{venueId:J}of A){let te=G[J],se=te.matchUpsToSchedule.length,ee=[],ce=[],fe,ge=0;for(;!fe;){for(let he of te.matchUpsToSchedule){if(ce.length===te.courtsCount||ee.length===te.courtsCount){fe=!0;break}let{matchUpId:Se,matchUpType:Ce}=he,{participantIdsAtLimit:Fe,relevantParticipantIds:Je}=m5({matchUpPotentialParticipantIds:_,individualParticipantProfiles:O,matchUpDailyLimits:s,matchUp:he});if(Fe.length){U[R].includes(Se)||U[R].push(Se);continue}let{dependenciesScheduled:xe,remainingDependencies:st}=p5({matchUpScheduleTimes:w,matchUpDependencies:o,allDateMatchUpIds:j,matchUp:he});if(!xe){I[R][Se]||(I[R][Se]=[]),I[R][Se].push({remainingDependencies:st});continue}let we=[],Oe=K==null?void 0:K.reduce((ye,Be)=>{var Ee,qe,Ge,me;if(ce.includes(Be.courtId))return ye;let{earliestCourtTime:Me}=QY({averageMinutes:te.greatestAverageMinutes,startTime:Y,date:R,court:Be});if(ye.scheduleTime&&ri(Me)>=ri(ye.scheduleTime))return ye;let{scheduledDependent:De}=bve({matchUpScheduleTimes:w,matchUpDependencies:o,scheduleTime:Me,matchUpId:Se,details:te});if(De)return ye;let{enoughTime:Ae}=f5({individualParticipantProfiles:O,matchUpNotBeforeTimes:F,matchUpDependencies:o,scheduleTime:Me,details:te,matchUp:he});if(!Ae)return y[R][Se]||(y[R][Se]=[]),y[R][Se].includes(Me)||y[R][Se].push(Me),ye;let ze=((qe=(Ee=te.minutesMap)==null?void 0:Ee[Se])==null?void 0:qe.averageMinutes)||te.greatestAverageMinutes,{conflicts:de}=h5({potentials:e,averageMatchUpMinutes:ze,requestConflicts:E,personRequests:p,scheduleTime:Me,scheduleDate:R,matchUp:he});if(de!=null&&de.length)return we.push(...de),!1;x(Je,Ce);let pe=(me=(Ge=te.minutesMap)==null?void 0:Ge[Se])==null?void 0:me.recoveryMinutes;return VU({matchUpPotentialParticipantIds:_,individualParticipantProfiles:O,matchUpNotBeforeTimes:F,averageMatchUpMinutes:ze,matchUpDependencies:o,recoveryMinutes:pe,scheduleTime:Me,matchUp:he}),(!ye.scheduleTime||ri(Me)<ri(ye.scheduleTime))&&(ye.averageMatchUpMinutes=ze,ye.recoveryMinutes=pe,ye.scheduleTime=Me,ye.courtName=Be.courtName,ye.courtId=Be.courtId),ye},{});if(Oe.scheduleTime){let{averageMatchUpMinutes:ye,recoveryMinutes:Be,scheduleTime:Ee,courtId:qe}=Oe;w[Se]=Ee,D[Se]=qe,ee.push(Se),ce.push(qe);let Ge=Ee,me=So(Ge,ye);Z({courtId:qe,booking:{averageMatchUpMinutes:ye,recoveryMinutes:Be,periodLength:u,matchUpId:Se,startTime:Ge,courtId:qe,endTime:me,venueId:J}}),te.matchUpsToSchedule=te.matchUpsToSchedule.filter(Me=>Me.matchUpId!==Se)}else we!=null&&we.length&&(b[R]||(b[R]=[]),b[R].push(...we))}(ce.length===te.courtsCount||ee.length===te.courtsCount||!te.matchUpsToSchedule.length)&&(fe=!0),te.matchUpsToSchedule.length&&ee<te.courtsCount&&(Jn(Y)<Jn(q.endTime)?Y=So(Y,u):(fe=!0,te.complete=!0)),ge+=1,!fe&&ge>=se&&(fe=!0)}(g=te.matchUpsToSchedule)!=null&&g.length||(te.complete=!0)}ie+=1,ue=A.every(({venueId:J})=>G[J].complete)||ie===Q}for(let{venueId:J}of A){let te=G[J].matchUpMap;Object.keys(te).forEach(se=>{let ee=c[se];ee&&Object.keys(te[se]).forEach(ce=>{let{drawDefinition:fe}=Ff({tournamentRecord:ee,drawId:ce});fe&&te[se][ce].forEach(({matchUpId:ge})=>{let he=w[ge],Se=D[ge];if(he){let Ce=he.split(":").map(ks).join(":"),Fe=`${Lt(R)}T${Ce}`;m||($f({drawDefinition:fe,scheduledTime:Fe,matchUpId:ge}),SI({courtDayDate:R,tournamentRecords:c,tournamentRecord:ee,drawDefinition:fe,matchUpId:ge,courtId:Se})),S[R].push(ge)}})})}),C[R]=G[J].matchUpsToSchedule.map(Cr)}!m&&$!=null&&$.length&&JC({matchUpDetails:$,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let te of J.rounds){let se=(v=(te.matchUps??[]).map(({matchUpId:ce})=>ce))==null?void 0:v.filter(ce=>S[R].includes(ce));te.canScheduledMatchUpIds=se;let ee=Math.round(((se==null?void 0:se.length)||0)/te.matchUpsCount*1e4)/100;(ee===1/0||isNaN(ee))&&(ee=void 0),te.possibleToSchedulePct=ee,te.matchUpsCount===(se==null?void 0:se.length)&&(te.possibleToSchedule=!0)}}let P=(r??[]).map(({scheduleDate:N})=>N),M={timeStamp:Date.now(),overLimitMatchUpIds:U,scheduledMatchUpIds:S,schedulingProfile:d,noTimeMatchUpIds:C,requestConflicts:E,scheduledDates:P};return Sve({tournamentRecords:c,autoSchedulingAudit:M}),{...re,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:I,matchUpScheduleTimes:w,overLimitMatchUpIds:U,scheduledMatchUpIds:S,noTimeMatchUpIds:C,requestConflicts:E,scheduledDates:P}}function WO(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=Mr,scheduledDates:n,venueIds:r}=t,a=Eu(t),o=on(a)?Object.values(a).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(o!=null&&o.length))return{error:Cn};let s=0;for(let l of o){let c=a[l],u=NHe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...re,clearedScheduleCount:s}}function NHe({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=Mr,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:Ne};if(!Array.isArray(e)||!Array.isArray(r))return{error:Ie};r.length&&t.push("venueId");let a=Hr({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],o={};a.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&GC({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(o[d]||(o[d]=[]),o[d].push(p))});let s=i.tournamentId,l=0;for(let c in o){let{event:u,drawDefinition:d}=po({tournamentRecord:i,drawId:c}),p=ro({drawDefinition:d,matchUpFilters:{matchUpIds:o[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![Np,qm,K0,Y0,Z0].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(si({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:h}),l+=1)}}return{...re,clearedScheduleCount:l}}function qO(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:a,periodLength:o,useGarman:s,dryRun:l,pro:c}=t,u=vi(t,[{[Ta]:!0},{[pc]:C=>!C||Array.isArray(C)&&C.every(ls),[Wue]:!1,[_f]:Ao}]);if(u.error)return u;let d=nh({tournamentRecords:a});if(d.error)return d;if(!d.schedulingProfile.length)return{...re};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(a).map(C=>q0({tournamentRecord:C}).containedStructures)),g=r.map(C=>{if(ls(C))return Lt(C)}).filter(Boolean),v=f.map(C=>C.scheduleDate).map(C=>ls(C)&&Lt(C)).filter(C=>C&&(!r.length||g.includes(C)));if(!v.length)return{error:Wce};if(n&&!l){let C=Array.isArray(n)?n:[];WO({tournamentRecords:a,scheduledDates:C})}let y=ih({ignoreDisabled:!1,tournamentRecords:a}).courts,{matchUps:I}=Nc({matchUpFilters:{matchUpTypes:[Un,qi]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:a}),{matchUpDependencies:b}=Xl({includeParticipantDependencies:!0,tournamentRecords:a,matchUps:I}),{matchUpDailyLimits:D}=RO({tournamentRecords:a}),{personRequests:w}=Fg({requestType:XC,tournamentRecords:a}),S=f.filter(C=>{let E=Lt(C==null?void 0:C.scheduleDate);return v.includes(E)}).sort((C,E)=>new Date(C.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:S,containedStructureIds:m,matchUpDependencies:b,matchUpDailyLimits:D,clearScheduleDates:n,tournamentRecords:a,schedulingProfile:f,personRequests:w,periodLength:o,useGarman:s,matchUps:I,dryRun:l,courts:y};return c?RHe(U):MHe(U)}function Tve(t){let e=t||{};return e.tournamentId||(e.tournamentId=xi()),e.startDate&&!jm(e.startDate)&&!kR.test(e.startDate)?{error:Ka}:e.endDate&&!jm(e.endDate)&&!kR.test(e.endDate)?{error:Ka}:(e.extensions&&(e.extensions=e.extensions.filter(fu)),{...e})}function g5({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:a,uuids:o}){var s,l;if(!i)return{error:Ne};let c={},u=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===Zt&&v===va),d=0;for(let g of u){let v=a&&((s=Rv({element:g,accessor:a}))==null?void 0:s.value)||n&&((l=g.person)==null?void 0:l[n])||e&&g[e];if(v){if(!Object.keys(c).includes(v)){c[v]={participantName:(r==null?void 0:r[d])??v,participantId:(o==null?void 0:o.pop())??xi(),individualParticipantIds:[],participantRole:va,participantType:Gi};let y={value:n??e,name:lB};ui({element:c[v],extension:y}),d+=1}c[v].individualParticipantIds.push(g.participantId)}}let p=Object.keys(c),h=(i.participants??[]).map(g=>{if(g.participantType!==Gi||g.participantRole!==va)return;let{extension:v}=jt({name:lB,element:g}),y=v==null?void 0:v.value;if(p.includes(y))return g.participantId}).filter(Boolean),f=0,m=[];return Object.keys(c).forEach(g=>{let v=c[g],{participantId:y}=v;h.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),f++)}),t&&f?(ti({payload:{tournamentId:i.tournamentId,participants:m},topic:nf}),{...re,participantsAdded:f}):m.length?{...re,newParticipants:m}:{error:xxe}}var AHe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],_He=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Uve({count:t=1,participantsCount:e=32}={}){let i=Fa(_He),n=i.slice(0,t);return{cities:Xe(0,e).map(r=>r<Math.min(t,i.length)?n[r]:vl(n))}}function Dve({count:t=1,participantsCount:e=32}={}){let i=Fa(AHe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:Xe(0,e).map(r=>r<Math.min(t,i.length)?n[r]:vl(n))}}function Pve({count:t=1,participantsCount:e=32}={}){let i=Xe(0,t).map(()=>Xe(0,5).map(()=>Cs(0,9)).join(""));return{postalCodes:Xe(0,e).map(n=>n<t?i[n]:vl(i))}}function Cve(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:a}=t;return{postalCode:n==null?void 0:n[a],state:i==null?void 0:i[a],city:e==null?void 0:e[a],countryCode:r}}var kHe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function AL(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![zi,gn].includes(i))return{personData:[],error:Ie};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:a,firstMale:o}=kHe,s=xh.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/a.length),u=Math.ceil(n/o.length),d=Xe(0,l).flatMap(()=>{let m=ot(r,!1,!0);return Xe(0,r.length).map(()=>xo(m))}),p=Xe(0,c).flatMap(()=>{let m=ot(a,!1,!0);return Xe(0,a.length).map(()=>xo(m))}),h=Xe(0,u).flatMap(()=>{let m=ot(o,!1,!0);return Xe(0,o.length).map(()=>xo(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||vl([zi,gn]),y=v===zi?h.pop():p.pop(),I=vl(s);f[`${y}${g}`]={nationalityCode:I,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function Eve(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:a,personData:o,category:s,sex:l}=t||{};if(isNaN(e))return{error:Ie};let c=(a==null?void 0:a[zi])||l===zi&&e||0,u=(a==null?void 0:a[gn])||l===gn&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&AL({count:c,sex:zi}).personData||[],h=u&&AL({count:u,sex:gn}).personData||[],f=[...p,...h,...d&&AL({count:d}).personData||[]],m=f.filter(U=>!l||c&&u||U.sex===l),g=[];if(Array.isArray(o)){let U=o.filter(C=>typeof C.firstName!="string"||typeof C.lastName!="string"||C.sex&&![zi,gn].includes(C.sex)||C.nationalityCode&&(typeof C.nationalityCode!="string"||C.nationalityCode.length>3||!xh.find(({iso:E,ioc:P})=>[E,P].includes(C.nationalityCode)))?!1:(C.nationalityCode&&g.push(C.nationalityCode),!0));if(U.length)m=U;else return{error:Ie}}let v=o?m:Fa(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:C,femaleFirstNames:E,femaleLastNames:P,nationalityCodes:M}=f.reduce((N,R)=>{let{firstName:A,lastName:_,nationalityCode:O}=R;return R.sex===zi?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(O)||N.nationalityCodes.push(O),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});Xe(0,e-v.length).forEach(()=>{let N=l||vl([zi,gn]),R=vl(M),A=vl(N===zi?U:E),_=vl(N===zi?C:P),O={firstName:A,lastName:_,sex:N,nationalityCode:R};v.push(O)})}let{ageMinDate:y,ageMaxDate:I}=_C({consideredDate:n,category:s}),b=St((y==null?void 0:y.slice(0,4))||0)||St((I==null?void 0:I.slice(0,4))||0)-3,D=St((I==null?void 0:I.slice(0,4))||0)||St((y==null?void 0:y.slice(0,4))||0)+3,w=(y||I)&&[b,D],S=v.slice(0,e).map((U,C)=>{let[E,P]=w||[],M=w&&xo(Xe(E,P)),N=xo(Xe(0,365)),R=M&&ZLe(M,N);return Object.assign(ft({extensions:i||[{name:"regionCode",value:C+1}],birthDate:R,isMock:r}),U)});return{persons:S.length&&S||v[0],nationalityCodes:g}}var OHe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function qB({nameRoot:t="TEAM",count:e=1}={}){let i=Fa(OHe).slice(0,e);return i.length<e&&Xe(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function KB({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===Zt?"I":"P"}-${i}`:(n==null?void 0:n.pop())||xi()}function QC(t){let{rankingRange:e,scaledParticipantsCount:i}=t,{ratingsParameters:n=rs,valuesInstanceLimit:r,consideredDate:a,category:o,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:c,participantsCount:u=32,participantType:d,personIds:p,idPrefix:h,uuids:f,personExtensions:m,addressProps:g,gendersCount:v,matchUpType:y,personData:I,sex:b,inContext:D,withISO2:w,withIOC:S,scaleAllParticipants:U}=t,C=d===Ot||y===zm,E=d===Gi||y===Gi;e&&(!Array.isArray(e)||!e.every(ge=>Mn(ge))||e.length!==2)&&(e=void 0),i=U?u:i;let P=1e3,M=i&&i>P?i:P;e=e||[1,M],e[1]+=1;let N=u*(C?2:E?8:1),R=Eve({count:N,personExtensions:m,consideredDate:a,gendersCount:v,personData:I,category:o,sex:b});if(R.error)return R;let{nationalityCodes:A,persons:_}=R,O=[],x=[],F=[],$=[];if(typeof o=="object"){let{categoryName:ge,ageCategoryCode:he,ratingType:Se}=o;if((ge||he)&&!Se){let[Ce,Fe]=e||[];if(x=Fa(Xe(Ce,Fe)).slice(0,i||Cs(20,30)),[Ot,Gi].includes(d)){let[Je,xe]=e||[];O=Fa(Xe(Je,xe)).slice(0,i||Cs(20,30))}}if(Se&&n[Se]){let{ratingMax:Ce,ratingMin:Fe,ratingAttributes:Je}=o,xe={...n[Se],...Je||{}},{attributes:st={},decimalsCount:we,accessors:Oe,range:ye,step:Be}=xe,Ee=De=>{let Ae={},ze=Object.keys(De||{});for(let de of ze){let pe=De[de];if(typeof pe=="object"&&pe.generator){let{range:ke}=pe,[Ue,Te]=ke.slice().sort();Ae[de]=Cs(Ue,Te)}else Ae[de]=pe}return Ae},qe=ye[0]>ye[1]?2:.5,[Ge,me]=ye.slice().sort(),Me=()=>Xe(0,2e3).map(()=>Rue(Ge,me,qe,Be,we)).filter(De=>(!Ce||De<=Ce)&&(!Fe||De>=Fe)).slice(0,i||Cs(20,30)).map(De=>Oe?Object.assign({},...Oe.map(Ae=>({[Ae]:De})),Ee(st)):De);F=Me(),[Ot,Gi].includes(d)&&($=Me())}}let V=xh.filter(ge=>l==="IOC"&&ge.ioc||ge.iso);function G(ge){let he=Math.ceil(N/ge);return r&&he>r?Math.ceil(N/r):ge}let{postalCodesProfile:j,postalCodesCount:z,statesProfile:H,citiesProfile:K,citiesCount:q,statesCount:Y}=g||{},Z=ge=>Object.keys(ge).map(he=>Xe(0,H[he]).map(()=>he)).flat(),Q=K&&Z(K)||(g==null?void 0:g.cities)||Uve({count:q||N,participantsCount:N}).cities,ie=H&&Z(H)||(g==null?void 0:g.states)||Dve({count:Y||N,participantsCount:N}).states,ue=j&&Z(j)||(g==null?void 0:g.postalCodes)||Pve({count:z||N,participantsCount:N}).postalCodes,J={cities:Q,states:ie,postalCodes:ue},te=G(s),se=te?Fa(V).slice(0,s):c?V.filter(ge=>c.includes(ge.iso)):V,ee=Fa(Xe(0,Math.ceil(N/(te||1))).map(()=>se).flat(1/0)),ce=qB({count:u}).names;return{participants:Xe(0,u).map(ge=>{let he=C?2:E?8:1,Se=Xe(0,he).map(st=>{let we=ge*he+st;return fe(we)}),Ce=Se.map(st=>st.participantId),Fe=Se.map(st=>st.person.standardFamilyName).join("/"),Je=C?Ot:Gi,xe={participantId:KB({participantType:Je,idPrefix:h,index:ge,uuids:f}),participantRole:va,participantName:C?Fe:ce[ge],individualParticipantIds:Ce,participantType:Je};return D&&(xe.individualParticipants=Se),C||E?[xe,...Se]:Se}).flat(),...re};function fe(ge){let he=_[ge],{nationalityCode:Se,participantExtensions:Ce,participantTimeItems:Fe,extensions:Je,firstName:xe,birthDate:st,lastName:we,personId:Oe,sex:ye}=he||{},Be=xe||"GivenName",Ee=we||"FamilyName",qe=`${Be} ${Ee}`,Ge=ee[ge],me=(A==null?void 0:A.length)&&Se||Ge&&(l==="IOC"?Ge.ioc||Ge.iso:Ge.iso||Ge.ioc)||Se;ee!=null&&ee.length&&!me&&!Se&&console.log("%c Invalid Nationality Code",{participantIndex:ge,country:Ge});let Me=Cve({...J,participantIndex:ge,nationalityCode:me}),De=ft({participantId:KB({participantType:Zt,index:ge,idPrefix:h,uuids:f}),extensions:Ce,timeItems:Fe,participantRole:va,participantType:Zt,participantName:qe,person:{addresses:[Me],personId:Oe||(p==null?void 0:p.length)&&p[ge]||xi(),standardFamilyName:Ee,standardGivenName:Be,nationalityCode:me,extensions:Je,birthDate:ls(st)?st:void 0,sex:ye}});if(S&&me){let Ae=xh.find(({iso:ze})=>ze===me);Ae!=null&&Ae.ioc&&(De.person.iocNationalityCode=Ae.ioc),Ae!=null&&Ae.label&&(De.person.countryName=Ae.label)}if(w&&me){let Ae=xh.find(({iso:ze})=>ze===me);Ae!=null&&Ae.iso2&&(De.person.iso2NationalityCode=Ae.iso2),Ae!=null&&Ae.label&&(De.person.countryName=Ae.label)}if(o){let Ae=x[ge],ze=O[ge];qE({scaleValue:Ae,eventType:uy,scaleType:Qh,participant:De,category:o}),qE({scaleValue:ze,eventType:of,scaleType:Qh,participant:De,category:o});let de=F[ge],pe=$[ge];qE({scaleValue:de,eventType:uy,scaleType:Tm,participant:De,category:o}),qE({scaleValue:pe,eventType:of,scaleType:Tm,participant:De,category:o})}return De}}function qE({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let a=r.categoryName||r.ratingType||r.ageCategoryCode,o=[ry,n,i,a].join("."),s={itemValue:t,itemType:o};a&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function Mve({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:n}){var r;let a=0,o=0,s=0,l=0,c={},u={[zi]:0,[gn]:0,[Fo]:0,[cv]:0,[vu]:0};i=typeof i=="object"?i:my({namedFormat:e}),(r=i==null?void 0:i.collectionDefinitions)==null||r.filter(Boolean).forEach(f=>{let{category:m,collectionId:g,matchUpType:v,matchUpCount:y,gender:I}=f;if([zi,gn].includes(I)){let b=y*(v===qi?2:1);u[I]<b&&(u[I]=b)}else I===Fo&&(u[zi]<y&&(u[zi]=y),u[gn]<y&&(u[gn]=y));if(m){let b=JSON.stringify(m);c[b]=m}if(g||(f.collectionId=xi()),_n(qi)(v)){let b=y;l+=y,a=Math.max(a,b)}if(_n(Un)(v)){let b=y;s+=y,o=Math.max(o,b)}});let d=Object.keys(c).length?Math.max(s,l*2):Math.max(o,a*2),p=a*(n+t),h=o*(n+t);return{maxDoublesDraw:p,maxSinglesDraw:h,teamSize:d,genders:u}}function xHe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=Zt}=t||{},a=n||0,o={[gn]:0,[Fo]:0,[cv]:0,[zi]:0,[vu]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:I,category:b,gender:D,stage:w})=>{let S=y===Ll,U=y===Ur,C=!!(m||w===gt||b||D);if(U){u=Math.max(u,v+f),I=typeof I=="object"?I:my({namedFormat:g});let{teamSize:E,maxDoublesDraw:P,maxSinglesDraw:M,genders:N}=Mve({alternatesCount:f,tieFormatName:g,tieFormat:I,drawSize:v});c=Math.max(c,E),l=Math.max(l,M),C||(s=Math.max(s,P)),Object.keys(N).forEach(R=>o[R]+=N[R])}else if(S)if(C){let E=(v+f)*2;d+=E,D&&(o[D]+=E)}else v+f&&v+f>s&&(s=v+f);else if(C){let E=v+f;D&&(o[D]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:I,gender:b}=f;if(v)for(let D of v){let{tieFormatName:w,tieFormat:S}=D;p({...D,tieFormatName:w||m,tieFormat:S||g,eventType:y,category:I,gender:b})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,s*2,l);return s&&(r=Ot),(n||a)<h&&(n=h),n&&s&&[Ot,Ur].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<a&&(n=a),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:o}}function Rve({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:a}){let{participantsCount:o,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=xHe({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=QC({uuids:a,...t,consideredDate:r,participantsCount:o,participantType:s,gendersCount:u}).participants,h=0,f=Ac({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=g5({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===Zt).map(Yt),g=t!=null&&t.idPrefix?`${Gi}-${t.idPrefix}`:void 0,v=Xe(0,l).map(y=>{let I=m.slice(y*c,(y+1)*c),b=KB({index:y,participantType:s,idPrefix:g,uuids:a});return{participantName:`Team ${y+1}`,participantRole:va,individualParticipantIds:I,participantType:Gi,participantId:b}});return f=Ac({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...re})}function Nve({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((o,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=nt,drawSize:p=0}=s||{};Object.keys(o).includes(d)||(o[d]=0);let h=(c||p)-l;return u||i||e||d===gt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):o[d]=Math.max(o[d],h),o},{}),a=Object.keys(n);return a.forEach(o=>r[o]+=n[o]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:a}}function Ave({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[nt]||0,a=e[gt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(0,a),MAIN:n.filter(({participantType:o})=>o===i).filter(({participantId:o})=>!t.includes(o)).slice(a,a+r)}}}var LHe={[Ci]:2,[er]:1,[fr]:1,[Na]:1,[mi]:4};function v5(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=LHe,matchUpFormat:r=xs,pointsPerMinute:a=1,sideWeight:o=4}=t;if(!Zo({matchUpFormat:r}))return{error:MW};if(typeof n!="object")return{error:Ie};if(e>100&&(e=100),isNaN(e)||isNaN(a)||isNaN(o))return{error:Ie};let s=Object.keys(n).filter(U=>Object.keys(wde).includes(U)&&U!==qn);if(Object.keys(s).reduce((U,C)=>U+n[C],0)>100)return{error:Ie,matchUpStatusProfile:n};let l=s.reduce((U,C)=>(U.pointer=U.pointer+n[C],U.valueMap.push([U.pointer,C]),U),{pointer:0,valueMap:[]}),c=Cs(1,100),u=(l.valueMap.find(U=>c<=U[0])??[100,qn])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Ci,mi].includes(u)){i=i||Cs(1,2);let U={score:d,winningSide:i,matchUpStatus:u};if(!(u===mi&&Cs(1,100)>100-e))return{outcome:U}}else if([er,fr].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=go(r),{bestOf:h,setFormat:f,finalSetFormat:m}=p??{},g=[],v=Cs(0,1),y=i?[i-1]:[...Xe(0,o).map(()=>v),1-v],I=[Na,mi,mu,xf].includes(u)&&(xo(Xe(1,h))||1),b;for(let U of Xe(1,(h??0)+1)){let C=U===h,{set:E,incomplete:P,winningSideNumber:M}=FHe({incomplete:I===U,matchUpStatus:u,pointsPerMinute:a,setFormat:C&&m||f,setNumber:U,weightedRange:y});if(g.push(E),P){b=M;break}if(BU({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let D=BU({matchUp:{score:{sets:g},matchUpFormat:r}}),w=b?i||b:D.calculatedWinningSide,{score:S}=hve({score:{sets:g},winningSide:w,matchUpStatus:u});return{outcome:{score:S,winningSide:w,matchUpStatus:u}}}function FHe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:a}){let o={setNumber:a},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=Cs(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+xo([1,-1])*v,I=sLe(y,2),b=[I,y-I];f&&b.reverse(),m=t[h]+1;let D=b[0]>b[1]&&1||b[1]>b[0]&&2||0;if(n){let[U,C]=b;return Object.assign(o,{side1Score:U,side2Score:C}),Mr.includes(i)?{set:o,incomplete:n,winningSideNumber:m}:{set:o,incomplete:n}}D||(b[Cs(0,1)]+=1),D=b[0]>b[1]?1:2,D!==m&&b.reverse();let[w,S]=b;return Object.assign(o,{side1Score:w,side2Score:S,winningSide:m}),{set:o}}else{if(n)return o.side1Score=Cs(0,c),o.side2Score=Cs(0,c),Mr.includes(i)&&(m=t[h]+1),{set:o,incomplete:n,winningSideNumber:m};{let g=Xe(1,s+1).map(S=>Xe(0,s+2-S).map(()=>S)).flat(),v=g[Cs(0,g.length-1)],y=s&&o4({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),I=!y,b=t.length===1&&t[h]+1;if(!I){b?(y[0]>y[1]?1:2)!==b&&y.reverse():f&&y.reverse();let[S,U]=y;Object.assign(o,{side1Score:S,side2Score:U})}let D=FU({matchUpScoringFormat:{setFormat:r},setObject:o}),w;if(D.hasTiebreakCondition||I){let{NoAD:S,tiebreakTo:U}=l||u||{},C=Xe(1,U+1).map(M=>Xe(0,U+2-M).map(()=>M)).flat(),E=C[Cs(0,C.length-1)],P=vO({isSide1:!0,tiebreakNoAd:S,tiebreakTo:U,lowValue:E});if(P)if(I){let M=P[0]>P[1]?1:2;b?M!==b&&P.reverse():f&&P.reverse(),[o.side1TiebreakScore,o.side2TiebreakScore]=P,w=P[0]>P[1]&&1||P[1]>P[0]&&2||void 0}else D.leadingSide===2?[o.side1TiebreakScore,o.side2TiebreakScore]=P:[o.side2TiebreakScore,o.side1TiebreakScore]=P}o.winningSide=D.winningSide||D.leadingSide||b||w}}return{set:o}}function cN(t){var e,i,n;let{matchUpStatusProfile:r,completeAllMatchUps:a,randomWinningSide:o,tournamentRecord:s,completionGoal:l,drawDefinition:c,event:u}=t;if(!c)return{error:tt};let d=t.matchUpFormat||c.matchUpFormat||(u==null?void 0:u.matchUpFormat),p=c.structures.slice().sort(sI),h=0,{matchUps:f,matchUpsMap:m}=lr({contextFilters:{stages:[nt,gt]},matchUpFilters:{matchUpTypes:[Yi],roundNumbers:[1]},inContext:!0,drawDefinition:c});if(f!=null&&f.length){let y=((e=u==null?void 0:u.category)==null?void 0:e.ageCategoryCode)||((i=u==null?void 0:u.category)==null?void 0:i.categoryName);if(y){let I=Hge({singlesOnly:!0,tournamentRecord:s,drawDefinition:c,scaleAccessor:{scaleName:y,sortOrder:Gge,scaleType:Qh},event:u});if(I.error)return I;let{lineUps:b,participantsToAdd:D}=I;Ac({tournamentRecord:s,participants:D}),ui({element:c,extension:{name:Dp,value:b}})}else{let I=(n=f[0])==null?void 0:n.structureId,{positionAssignments:b}=Vi({drawDefinition:c,structureId:I});if(b!=null&&b.length){let{participants:D}=$n({participantFilters:{participantTypes:[Yi]},tournamentRecord:s}),w=S=>{let U=S.tieMatchUps.filter(_n(Un)),C=S.tieMatchUps.filter(_n(qi));U.forEach((E,P)=>{let M=E.matchUpId;E.sides.forEach(N=>{var R;let{drawPosition:A}=N,_=D==null?void 0:D.find(O=>{var x;let{participantId:F}=O;return((x=b.find($=>$.participantId===F))==null?void 0:x.drawPosition)===A});if(_){let O=(R=_.individualParticipantIds)==null?void 0:R[P];O&&lN({teamParticipantId:_.participantId,participantId:O,tournamentRecord:s,drawDefinition:c,tieMatchUpId:M,event:u})}})}),C.forEach((E,P)=>{let M=E.matchUpId;E.sides.forEach(N=>{var R,A;let{drawPosition:_}=N,O=D==null?void 0:D.find(x=>{var F;let{participantId:$}=x;return((F=b.find(V=>V.participantId===$))==null?void 0:F.drawPosition)===_});O&&((A=(R=O.individualParticipantIds)==null?void 0:R.slice(P*2,P*2+2))==null||A.forEach(x=>{lN({teamParticipantId:O.participantId,participantId:x,tournamentRecord:s,drawDefinition:c,tieMatchUpId:M,event:u})}))})})};f.forEach(w)}}}let g=typeof a=="string"&&a,v=g&&qn;for(let y of p){if(h>=l)break;let{matchUps:I}=Ui({matchUpFilters:{matchUpTypes:[qi,Un]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:y,event:u}),b=I.filter(({winningSide:D})=>!D).sort(pI).map(Cr);for(let D of b){if(!isNaN(l)&&h>=l)break;let{matchUps:w}=Ui({matchUpFilters:{matchUpTypes:[qi,Un]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:y,event:u}),S=w.find(C=>C.matchUpId===D),U=[er,fr].includes(S.matchUpStatus);if(S!=null&&S.readyToScore&&!U){let C=$He({winningSide:!o&&1,matchUpStatusProfile:r,tournamentRecord:s,drawDefinition:c,targetMatchUp:S,matchUpFormat:d,matchUpStatus:v,scoreString:g,event:u});if(C!=null&&C.error)return C;h+=1}}}return{...re,completedCount:h}}function _ve(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:a,matchUpStatus:o,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!a||a.matchUpStatus===wi)return;let{matchUpId:d}=a||{},{outcome:p}=d5({matchUpFormat:s,matchUpStatus:o,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),YC({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function $He(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:a,matchUpFormat:o,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||a)return _ve(t);let{matchUpId:d}=s||{},{outcome:p}=v5({matchUpStatusProfile:e,matchUpFormat:o,winningSide:c});return YC({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:o,matchUpId:d,outcome:p,event:u})}function kve({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:a}){var o,s,l,c;let u=Vn({event:a}).flightProfile,{eventName:d,eventType:p,category:h}=a,{startDate:f}=n,m=[],g=(h==null?void 0:h.categoryName)||(h==null?void 0:h.ageCategoryCode)||(h==null?void 0:h.ratingType),v=(o=a.drawDefinitions)==null?void 0:o.map(({drawId:y})=>y);if(Array.isArray(u==null?void 0:u.flights))for(let[y,I]of u.flights.entries()){let{drawId:b,stage:D,drawName:w,drawEntries:S}=I;m.push(I.drawId);let U=r[y],{seedsCount:C,generate:E=!0}=U||{};if(E){let P=S.filter(Ko(yd)).map(Ko(yd)),M=g||d;if(n&&C&&C<=P.length&&Xe(1,C+1).forEach((O,x)=>{let F={scaleValue:O,scaleName:M,scaleType:Qu,eventType:p,scaleDate:f},$=P[x];Uw({tournamentRecord:n,participantId:$,scaleItem:F})}),v==null?void 0:v.includes(b))break;let N=NO({...U,matchUpType:p,seedingScaleName:M,tournamentRecord:n,isMock:!0,drawEntries:S,drawName:w,drawId:b,event:a,stage:D});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:R}=N;if(!R)return{error:zo};let A=(s=r[y])==null?void 0:s.drawExtensions;if(Array.isArray(A)&&A.filter(fu).forEach(O=>ui({element:R,extension:O})),N=kO({suppressNotifications:!0,tournamentRecord:n,drawDefinition:R,event:a}),N.error)return{error:N.error,drawIds:[]};if(U!=null&&U.withPlayoffs){let O=(l=R.structures)==null?void 0:l[0].structureId,x=rO({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:n,drawDefinition:R,isMock:!0,structureId:O,event:a});if(x!=null&&x.error)return x}let _=U==null?void 0:U.completionGoal;if((U==null?void 0:U.automated)!==!1&&(e||_)){let O=U==null?void 0:U.matchUpFormat,x=cN({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:R,matchUpFormat:O,event:a});if(x.error)return{error:x.error,drawIds:[]};let F=x.completedCount;if((U==null?void 0:U.drawType)===Dd){let $=(c=R.structures)==null?void 0:c.find(j=>j.stage===nt);if(!$)return{error:wn};let V=CC({structureId:$.structureId,tournamentRecord:n,drawDefinition:R,event:a});if(V.error)return{error:V.error,drawIds:[]};let G=_?_-(F??0):void 0;if(V=cN({completeAllMatchUps:!_&&e,completionGoal:_?G:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:R,matchUpFormat:O,event:a}),V.error)return{error:V.error,drawIds:[]}}}}}return{...re,drawIds:m}}function Ove(t){var e,i;let{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:a,tournamentRecord:o,eventProfile:s,eventIndex:l,event:c,uuids:u}=t,{category:d,gender:p,eventType:h}=c,f=_n(Cd)(h)&&Zt||_n(Ll)(h)&&Ot||h,m=r[nt]||0,g=r[gt]||0,v=(e=s.drawProfiles)!=null&&e.length?m+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[zi,gn].includes(p)?p:void 0,I=n!=null&&n.idPrefix?`E-${l}-${n==null?void 0:n.idPrefix}`:void 0,{participants:b}=QC({uuids:s.uuids||u,...n,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:o==null?void 0:o.startDate,rankingRange:s.rankingRange,participantType:f,participantsCount:v,ratingsParameters:a,category:d,idPrefix:I,sex:y}),D=Ac({tournamentRecord:o,participants:b});if(D.error)return D;let w=b==null?void 0:b.filter(({participantType:U})=>U===f),S=b==null?void 0:b.map(Yt);return{uniqueDrawParticipants:w,uniqueParticipantIds:S}}function BHe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:a=Qc,qualifyingPositions:o=0,stage:s=nt,drawSize:l=0,drawName:c,drawId:u}=n,d=l-o,p=i.slice(0,d).map(Yt);if(p.length){let m=id({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:hs,entryStage:s,participantId:m})),f=xO({drawName:c||a,qualifyingPositions:o,drawEntries:h,drawId:u,event:r,stage:s});return f.error?f:{...re}}function xve({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:a,gender:o,event:s}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=nt,drawSize:h=0}=c,f=h-u,m=d||o||a||p===gt,g=m?t.slice(l,l+f):i[p||nt]||[];m&&(l+=f);let v=BHe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:s});if(v.error)return v}return{...re}}function Lve(t){var e;let{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:a,autoEntryPositions:o,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,publish:h,isMock:f,uuids:m}=t,g=d.gender,v=d.eventName,{eventType:y=Cd,policyDefinitions:I,drawProfiles:b=[],eventExtensions:D,surfaceCategory:w,tieFormatName:S,processCodes:U,discipline:C,eventLevel:E,timeItems:P,ballType:M,category:N}=d,R=d.eventId||xi(),A=d.tieFormat||(y===Ur?my({namedFormat:S,event:{eventId:R,category:N,gender:g},hydrateCollections:s,isMock:f}):void 0),_=u.participants;for(let Q of b)!g&&Q.gender&&(g=Q==null?void 0:Q.gender);let{stageParticipantsCount:O,uniqueParticipantsCount:x,uniqueParticipantStages:F}=Nve({drawProfiles:b,category:N,gender:g}),$=_n(Cd)(y)&&Zt||_n(Ll)(y)&&Ot||y,{uniqueDrawParticipants:V=[],uniqueParticipantIds:G=[]}=F?Ove({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:x,participantsProfile:r,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,uuids:m}):{},{eventAttributes:j}=d;typeof j!="object"&&(j={});let z=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||z||"Generated Event";let H={...j,surfaceCategory:w,processCodes:U,discipline:C,eventLevel:E,eventName:v,eventType:y,tieFormat:A,ballType:M,category:N,eventId:R,gender:g};if(D!=null&&D.length&&Array.isArray(D)){let Q=D.filter(fu);Q!=null&&Q.length&&Object.assign(H,{extensions:Q})}if(Array.isArray(P)&&P.forEach(Q=>yI({event:Y,timeItem:Q})),typeof I=="object")for(let Q of Object.keys(I))Xm({policyDefinitions:{[Q]:I[Q]},event:H});H.category&&(H.category.categoryName=z);let K,q=WC({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:H});if(q.error)return q;let Y=q==null?void 0:q.event,{stageParticipants:Z}=Ave({allUniqueParticipantIds:i,stageParticipantsCount:O,eventParticipantType:$,targetParticipants:_});if(b!=null&&b.length){let Q=xve({uniqueDrawParticipants:V,autoEntryPositions:o,stageParticipants:Z,tournamentRecord:u,drawProfiles:b,category:N,gender:g,event:Y});if(Q.error)return Q;let ie=kve({matchUpStatusProfile:n,completeAllMatchUps:a,randomWinningSide:l,tournamentRecord:u,drawProfiles:b,event:Y});if(ie.error)return ie;K=ie.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){let Q=V.map(Yt);if(Q.length){let ie=id({participantIds:Q,autoEntryPositions:o,tournamentRecord:u,entryStage:nt,event:Y});if(ie.error)return ie}}return h&&oS({tournamentRecord:u,event:Y}),{drawIds:K,eventId:R,uniqueParticipantIds:G}}function y5({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!ls(e))return{error:Ka};let r="addSchedulingProfileRound",{extension:a}=jt({name:sy,tournamentRecords:t,discover:!0}),o=(a==null?void 0:a.value)||[],s=o.find(p=>wd(e,p.scheduleDate));if(!s){let{startDate:p,endDate:h}=bO({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:Ka};s={scheduleDate:e,venues:[]},o.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>on(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return oe({result:{error:kce},stack:r});l.rounds.push(n);let d=rS({tournamentRecords:t,schedulingProfile:o});return d.error?d:{...re}}function VHe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Ie};let i=q0({tournamentRecord:e}).containedStructures,n=Hr({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,a=[];for(let o of t){let{scheduleDate:s,venues:l=[]}=o;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var y;let I=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(D=>+D),b=(y=v.finishingPositionRange)==null?void 0:y.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!I||Ln(b,I).length===2||$t(b).length===$t(I).length&&Ln(b,I).length===$t(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:I,structureName:b,roundName:D}=g,w=g.structureId;y&&!f&&(w=Object.keys(i).find(C=>i[C].includes(w))??w);let S={tournamentId:r,structureId:w,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=y5({tournamentRecords:{[r]:e},round:S,scheduleDate:s,venueId:d});if(U.error)return U;a.push({structureName:b,roundName:D,drawName:I,...S})}}}}return{scheduledRounds:a}}function KO(t){var e,i,n;let r=vi(t,[{drawProfile:!0,_ofType:Gd}]);if(r.error)return r;let{allUniqueParticipantIds:a=[],participantsProfile:o={},matchUpStatusProfile:s,completeAllMatchUps:l,autoEntryPositions:c,hydrateCollections:u,randomWinningSide:d,ratingsParameters:p,tournamentRecord:h,isMock:f=!0,drawProfile:m,startDate:g,drawIndex:v,uuids:y}=t,I=ot(m,!1,!0),{excessParticipantAlternates:b=!0,matchUpFormat:D=xs,drawType:w=Qc,tournamentAlternates:S=0,alternatesCount:U=0,qualifyingPositions:C,qualifyingProfiles:E,generate:P=!0,eventExtensions:M,drawExtensions:N,completionGoal:R,tieFormatName:A,seedsCount:_,timeItems:O,drawName:x,category:F,idPrefix:$,publish:V,gender:G,stage:j}=I,z=I.drawSize||(I.ignoreDefaults?void 0:32),H=I.eventId||xi(),K=m.eventType||m.matchUpType||Cd,q=K===Ll?Ot:Zt,Y=typeof m.tieFormat=="object"&&m.tieFormat||K===Gi&&my({event:{eventId:H,category:F,gender:G},namedFormat:A,hydrateCollections:u,isMock:f})||void 0,Z=(F==null?void 0:F.categoryName)||(F==null?void 0:F.ageCategoryCode)||(F==null?void 0:F.ratingType),Q=m.eventName||Z||`Generated ${K}`,ie=(h==null?void 0:h.participants)||[],ue=((E==null?void 0:E.map(we=>we.structureProfiles||[]).flat().reduce((we,Oe)=>{let ye=!Oe.participantsCount||Oe.participantsCount>Oe.drawSize?Oe.drawSize:Oe.participantsCount||0;return we+ye},0))||0)*(q===Ot?2:1),J=(!m.participantsCount||m.participantsCount>z?z:m.participantsCount)||0,te={eventName:Q,eventType:K,tieFormat:Y,category:F,eventId:H,gender:G};Array.isArray(O)&&O.forEach(we=>yI({event:te,timeItem:we}));let{eventAttributes:se}=m;if(typeof se!="object"&&(se={}),Object.assign(te,se),(M==null?void 0:M.length)&&Array.isArray(M)){let we=M.filter(fu);we!=null&&we.length&&Object.assign(te,{extensions:we})}let ee=[];if(ue||m.uniqueParticipants||!h||G||F){let we=(J||0)+U+ue,Oe=we,ye={[zi]:0,[gn]:0},Be,Ee;K===Gi&&({teamSize:Be,genders:Ee}=Mve({alternatesCount:U,tieFormatName:A,tieFormat:Y,drawSize:z}),Object.keys(Ee).forEach(me=>{[zi,gn].includes(me)&&Ee[me]&&(ye[me]=z*Ee[me])}),Oe=Be*((z||0)+ue));let qe=o!=null&&o.idPrefix?`D-${v}-${o==null?void 0:o.idPrefix}`:void 0,Ge=QC({...o,scaledParticipantsCount:m.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:Oe,consideredDate:h==null?void 0:h.startDate,sex:G||(o==null?void 0:o.sex),rankingRange:m.rankingRange,uuids:m.uuids||y,ratingsParameters:p,participantType:q,gendersCount:ye,idPrefix:qe,category:F}).participants;if(te.category&&(te.category.categoryName=Z),h){let me=Ac({participants:Ge,tournamentRecord:h});if(me.error)return me}if(Ge.forEach(({participantId:me})=>ee.push(me)),ie=Ge,K===Gi){let me=Ee[zi]?Ge.filter(({participantType:Te,person:rt})=>Te===Zt&&(rt==null?void 0:rt.sex)===zi).map(Yt):[],Me=Ee[gn]?Ge.filter(({participantType:Te,person:rt})=>Te===Zt&&(rt==null?void 0:rt.sex)===gn).map(Yt):[],De=Ge.filter(({participantType:Te})=>Te===Zt).map(Yt).filter(Te=>!me.includes(Te)&&!Me.includes(Te)),Ae=Be-(Ee[zi]+Ee[gn]),ze=0,de=0,pe=0,ke=Xe(0,we).map(Te=>{let rt=Me.slice(ze,ze+Ee[gn]),je=me.slice(de,de+Ee[zi]),Le=De.slice(pe,pe+Ae);return ze+=Ee[gn],de+=Ee[zi],pe+=Ae,{individualParticipantIds:[...rt,...je,...Le],participantOtherName:`TM${Te+1}`,participantName:`Team ${Te+1}`,participantRole:va,participantType:Gi,participantId:xi()}}),Ue=Ac({participants:ke,tournamentRecord:h});if(!Ue.success)return Ue;ie=ke}}let ce=we=>{let{participantType:Oe}=we;return _n(Cd)(K)&&Oe===Zt||_n(Ll)(K)&&Oe===Ot?!0:K===Gi&&Oe===Gi},fe=we=>{var Oe,ye;return!m.gender||((Oe=we.person)==null?void 0:Oe.sex)===m.gender?!0:(ye=we.individualParticipantIds)==null?void 0:ye.some(Be=>{let Ee=ie.find(qe=>qe.participantId===Be);return Ee&&fe(Ee)})},ge=ie.filter(ce).filter(fe).filter(({participantId:we})=>!a.includes(we)),he=ge.slice(0,J).map(we=>we.participantId);if(f&&he!=null&&he.length){let we=id({autoEntryPositions:c,entryStage:j,tournamentRecord:h,participantIds:he,event:te});if(we.error)return we}let Se=ue?ge.slice(J,J+ue).map(we=>we.participantId):0;if(f&&Se!=null&&Se.length){let we=0,Oe=1,ye=(Ee,qe)=>Ee.stageSequence-qe.stageSequence,Be=(Ee,qe)=>Ee.roundTarget-qe.roundTarget;for(let Ee of E.sort(Be)){Oe=Ee.roundTarget||Oe;let qe=1,Ge;for(let me of Ee.structureProfiles.sort(ye)){let Me=(me.drawSize||YW(me.participantsCount))-(Ge||0),De=Se.slice(we,we+Me),Ae=id({entryStage:gt,entryStageSequence:qe,autoEntryPositions:c,tournamentRecord:h,participantIds:De,roundTarget:Oe,event:te});if(Ae.error)return Ae;Ge=me.qualifyingPositions,we+=Me,qe+=1}Oe+=1}}let Ce=b&&((e=h==null?void 0:h.participants)==null?void 0:e.filter(({participantId:we})=>!he.includes(we)).filter(ce).filter(fe).slice(0,U||z-J||S).map(we=>we.participantId));if(f&&Ce!=null&&Ce.length){let we=id({participantIds:Ce,autoEntryPositions:!1,entryStatus:Ul,tournamentRecord:h,event:te});if(we.error)return we.error}let Fe=Z||Q;h&&_&&_<=he.length&&Xe(1,_+1).forEach((we,Oe)=>{let ye={scaleName:Fe,scaleDate:g,scaleType:Y3,scaleValue:we,eventType:K},Be=he[Oe];Uw({tournamentRecord:h,participantId:Be,scaleItem:ye})});let Je=NO({...ot(m,!1,!0),tournamentRecord:h,seedingScaleName:Fe,matchUpFormat:D,eventId:H,isMock:f,event:te});if(Je.error)return Je;if(!Je.drawDefinition)return{error:zo};let{drawDefinition:xe}=Je,st=xe.drawId;if(Array.isArray(N)&&N.filter(fu).forEach(we=>ui({element:xe,extension:we})),P){if(kO({drawDefinition:xe,event:te,suppressNotifications:!0}),m.withPlayoffs){let Oe=(i=xe.structures)==null?void 0:i[0].structureId,ye=rO({...m.withPlayoffs,tournamentRecord:h,drawDefinition:xe,structureId:Oe,idPrefix:$,isMock:f,event:te});if(ye!=null&&ye.error)return ye}let we=m.automated===!1;if(f&&!we){let Oe=ye=>{var Be;let Ee=cN({completeAllMatchUps:ye.completeAllMatchUps,completionGoal:ye.completionGoal,matchUpStatusProfile:s,randomWinningSide:d,tournamentRecord:h,drawDefinition:xe,matchUpFormat:D,event:te});if(Ee.error)return Ee;let qe=Ee.completedCount;if(w===Dd){let Ge=(Be=xe.structures)==null?void 0:Be.find(De=>De.stage===nt);if(!Ge)return{error:wn};CC({structureId:Ge.structureId,tournamentRecord:h,drawDefinition:xe,event:te});let me=R?R-(qe??0):void 0,Me=cN({completionGoal:R?me:void 0,matchUpStatusProfile:s,completeAllMatchUps:l,randomWinningSide:d,tournamentRecord:h,drawDefinition:xe,matchUpFormat:D,event:te});if(Me.error)return Me}};if(R&&Oe({completionGoal:R}),m.outcomes){let{matchUps:ye}=ro({inContext:!0,drawDefinition:xe,event:te});for(let Be of m.outcomes){let{matchUpStatus:Ee=qn,matchUpStatusCodes:qe,stageSequence:Ge=1,matchUpIndex:me=0,structureOrder:Me,matchUpFormat:De,drawPositions:Ae,roundPosition:ze,stage:de=nt,roundNumber:pe,winningSide:ke,scoreString:Ue}=Be,Te=(ye==null?void 0:ye.reduce((It,zt)=>{let{structureId:Jt,matchUpId:Yr}=zt;return It[Jt]?It[Jt].push(Yr):It[Jt]=[Yr],It},{}))??[],rt=Object.assign({},...Object.keys(Te).map((It,zt)=>({[It]:zt+1}))),je=(n=ye==null?void 0:ye.filter(It=>(!de||It.stage===de)&&(!Ge||It.stageSequence===Ge)&&(!pe||It.roundNumber===pe)&&(!ze||It.roundPosition===ze)&&(!Me||rt[It.structureId]===Me)&&(!Ae||Ln(Ae,It.drawPositions).length===2)))==null?void 0:n[me],Le=_ve({matchUpStatusCodes:qe,tournamentRecord:h,drawDefinition:xe,targetMatchUp:je,matchUpFormat:De,matchUpStatus:Ee,scoreString:Ue,winningSide:ke});if(Le!=null&&Le.error)return Le}}l&&Oe({completeAllMatchUps:l})}V&&oS({tournamentRecord:h,event:te})}else{let we=xO({drawEntries:xe.entries,drawName:x||w,qualifyingPositions:C,drawId:st,event:te,stage:j});if(we.error)return we}return{...re,event:ft(te),uniqueParticipantIds:ee,targetParticipants:ie,drawDefinition:xe,eventId:H,drawId:st}}var Fve=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),jHe=Fve;function uN(t){return parseInt(t)}function e8({startTime:t="",endTime:e=""}={}){if(!t||!e||!ym.test(t)||!ym.test(e))return!1;let[i,n]=t.split(":").map(uN),[r,a]=e.split(":").map(uN);return r<i?!1:!(i===r&&a<n)}function GHe(t,e){let[i,n]=t.startTime.split(":").map(uN),[r,a]=e.startTime.split(":").map(uN);return i<r?-1:i>r?1:n<a?-1:n>a?1:0}function $ve({dateAvailability:t}){if(!t)return{error:qce};if(!Array.isArray(t))return{error:eM};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:eM};let{date:r,startTime:a,endTime:o,bookings:s=[]}=n;if(!a||!o)return{error:eM};if(r&&!bd.test(r))return{error:Ka,dateAvailability:{date:r},info:e};if(!ym.test(a))return{error:ul,dateAvailability:{startTime:a},info:i};if(!ym.test(o))return{error:ul,dateAvailability:{endTime:o},info:i};if(a===o)return{error:ul,dateAvailability:{startTime:a,endTime:o},info:"startTime and endTime are equivalent"};if(!e8({startTime:a,endTime:o}))return{error:ul,dateAvailability:{startTime:a,endTime:o},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:AR};for(let l of s){if(typeof l!="object")return{error:AR};let{startTime:c,endTime:u}=l;if(!ym.test(c))return{error:ul,booking:{startTime:c},info:i};if(!ym.test(u))return{error:ul,booking:{endTime:u},info:i};if(c===u)return{error:ul,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!e8({startTime:c,endTime:u}))return{error:ul,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function YO({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:a}=Jp({tournamentRecord:t,venueId:i});if(!a)return{error:x0};a.courts||(a.courts=[]);let o={...Fve(),venueId:i,courtId:n};if(o.courtId||(o.courtId=xi()),a.courts.some(s=>s.courtId===o.courtId))return{error:uue};{let s=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:Lt(u.date),startTime:rn(u.startTime),endTime:rn(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:rn(p),endTime:rn(h),bookingType:f}))}}),l=Object.keys(o);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=$ve({dateAvailability:s});if(!d.valid&&d.error)return d;o.dateAvailability=s}else o[u]=r[u];let c=o;return a.courts.push(c),e||ti({payload:{venue:a,tournamentId:t.tournamentId},topic:Cg,key:a.venueId}),{...re,court:ot(o),venueId:i}}}function I5(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Nf};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],a;for(let o of Object.values(n)){let{venue:s}=Jp({tournamentRecord:o,venueId:i});if(s){let l=HHe({...t,tournamentRecord:o});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;a=!0}}return a?{...re,courtIds:r}:{error:x0}}function HHe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:a,courtsCount:o,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:Nf};let h=Jp({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Mn(o)||!r)return{error:cue};o=o??r.length;let m=Xe(0,o).map(g=>{let v=a==null?void 0:a[g],y=v?p.map(I=>({date:Sc(I),startTime:s,endTime:c,...v})):e;return v&&s&&c&&y.push({startTime:s,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return YO({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==o?oe({info:"not all courts could be generated",result:{error:Ie}}):(f&&ti({payload:{venue:f,tournamentId:n.tournamentId},topic:Cg,key:f.venueId}),{...re,courts:ot(m)})}function Bve({tournamentRecord:t,venueProfiles:e,uuids:i}){let{startDate:n,endDate:r}=t,a=[];for(let[o,s]of e.entries()){let{venueAbbreviation:l,venueId:c=(i==null?void 0:i.pop())??xi(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:h,courtsCount:f,courtNames:m,venueName:g,idPrefix:v,courtIds:y}=s,I={venueName:g||`Venue ${o+1}`,venueAbbreviation:l,venueId:c},b=fC({tournamentRecord:t,venue:I});if(b.error)return b;a.push(c);let D=uw(n,r),w=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(D.map(U=>({date:Sc(U),startTime:d,endTime:p}))),S=I5({dateAvailability:u||w,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:m,startTime:d,idPrefix:v,courtIds:y,endTime:p,venueId:c,dates:D});if(S.error)return S}return a}var zHe=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function Vve(t){let{tournamentAttributes:e,startDate:i,endDate:n}=t??{},{tournamentName:r=xo(zHe),ratingsParameters:a=rs,scheduleCompletedMatchUps:o,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:c,participantsProfile:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,policyDefinitions:f,schedulingProfile:m,periodLength:g,autoSchedule:v,eventProfiles:y,venueProfiles:I,drawProfiles:b,uuids:D}=t??{};if(i&&!ls(i)||n&&!ls(n))return{error:Ka};if(y&&!Array.isArray(y))return{error:Ie};if(!i){let R=new Date;i=Sc(n??R),n=Sc(R.setDate(R.getDate()+7))}if(!n){let R=new Date(i);n=Sc(R.setDate(R.getDate()+7))}typeof e!="object"&&(e={});let w=Tve({...e,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(s!=null&&s.length&&Array.isArray(s)){let R=s.filter(A=>fu({extension:A}));R!=null&&R.length&&Object.assign(w,{extensions:R,isMock:!0})}if(typeof f=="object")for(let R of Object.keys(f))Xm({policyDefinitions:{[R]:f[R]},tournamentRecord:w});let S=Rve({participantsProfile:u,tournamentRecord:w,eventProfiles:y,drawProfiles:b,startDate:i,uuids:D});if(!S.success)return S;let U=[],C=[],E=[];if(Array.isArray(b)){let R=0;for(let A of b){let _=KO({allUniqueParticipantIds:U,matchUpStatusProfile:l,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,participantsProfile:u,randomWinningSide:h,ratingsParameters:a,tournamentRecord:w,isMock:!0,drawProfile:A,startDate:i,drawIndex:R,uuids:D});if(_.error)return _;let{drawId:O,eventId:x,event:F,uniqueParticipantIds:$}=_;if(_=WC({suppressNotifications:!1,internalUse:!0,tournamentRecord:w,event:F}),_.error)return _;O&&E.push(O),C.push(x),$!=null&&$.length&&U.push(...$),R+=1}}if(y){let R=0;for(let A of y){let _=Lve({allUniqueParticipantIds:U,matchUpStatusProfile:l,participantsProfile:u,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,ratingsParameters:a,tournamentRecord:w,eventProfile:A,eventIndex:R,startDate:i,uuids:D});if(_.error)return _;let{eventId:O,drawIds:x,uniqueParticipantIds:F}=_;x&&E.push(...x),C.push(O),F!=null&&F.length&&U.push(...F),R+=1}}let P=I!=null&&I.length?Bve({tournamentRecord:w,venueProfiles:I,uuids:D}):[],M,N={};if(m){let R=VHe({schedulingProfile:m,tournamentRecord:w});if(R.error)return R;if(M=R.scheduledRounds,v){let{tournamentId:A}=w,_={[A]:w};N=qO({scheduleCompletedMatchUps:o,tournamentRecords:_,periodLength:g})}}return JW(),ft({...re,tournamentRecord:w,scheduledRounds:M,schedulerResult:N,eventIds:C,venueIds:P,drawIds:E})}var jve={};Ht(jve,{anonymizeTournamentRecord:()=>Gve,modifyTournamentRecord:()=>Hve});function Gve({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:a}){var o,s,l,c,u;if(!i)return{error:Ne};let d=Array.isArray(t)?uY.concat(...t):uY,p=j=>{var z;return Array.isArray(t)?(z=j==null?void 0:j.extensions)==null?void 0:z.filter(H=>d.includes(H.name)):j==null?void 0:j.extensions},h={};i.extensions=p(i);let f=a||xi();h[i.tournamentId]=f,i.tournamentId=f,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Sc(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let j of i.participants||[]){let z=xi();h[j.participantId]=z,j.participantId=z}for(let j of i.participants||[])Array.isArray(j.individualParticipantIds)&&(j.individualParticipantIds=j.individualParticipantIds.map(z=>h[z]));let m=0;for(let j of i.venues||[]){j.extensions=p(j),j.venueName=`Venue #${m}`,j.venueAbbreviation=`V${m}`;let z=xi();h[j.venueId]=z,j.isMock=!0,m+=1}let g=1;for(let j of i.events||[]){j.extensions=p(j),j.isMock=!0;let z=xi();h[j.eventId]=z,j.eventId=z;let H=((o=j.category)==null?void 0:o.categoryName)||((s=j.category)==null?void 0:s.ageCategoryCode)||((l=j.category)==null?void 0:l.ratingType)||j.gender;if(j.eventName=`Event ${g} ${H}`,Array.isArray(j.entries))for(let q of j.entries)q.participantId=h[q.participantId];for(let q of j.drawDefinitions||[]){q.extensions=p(q);let Y=xi();if(h[q.drawId]=Y,q.drawId=Y,q.isMock=!0,Array.isArray(q.entries))for(let Q of q.entries)Q.participantId=h[Q.participantId];let Z=Q=>{Q.extensions=p(Q);let ie=xi();h[Q.structureId]=ie,Q.structureId=ie;for(let ue of Q.positionAssignments||[])ue.participantId&&(ue.participantId=h[ue.participantId]);for(let ue of Q.seedAssignments||[])ue.participantId&&(ue.participantId=h[ue.participantId]);for(let ue of Q.matchUps||[]){ue.isMock=!0;for(let J of ue.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:te,collectionAssignments:se})=>({participantId:h[te],collectionAssignments:se})))}};for(let Q of q.structures||[])if(Z(Q),Array.isArray(Q.structures))for(let ie of Q.structures)Z(ie);for(let Q of q.links||[])Q.source.structureId=h[Q.source.structureId],Q.target.structureId=h[Q.target.structureId]}let{extension:K}=jt({name:kl,element:j});Array.isArray((c=K==null?void 0:K.value)==null?void 0:c.flights)&&((u=K==null?void 0:K.value.flights)==null||u.forEach(q=>{if(q.drawId=h[q.drawId],Array.isArray(q.drawEntries))for(let Y of q.drawEntries)Y.participantId=h[Y.participantId]})),g+=1}let v=i.startDate||Sc(new Date),y=(i.participants||[]).filter(({participantType:j})=>j===Zt),I=y.reduce((j,z)=>{var H;let K=(H=z.person)==null?void 0:H.sex;return[zi,gn].includes(K)?j[K]+=1:j[cv]+=1,j},{[zi]:0,[gn]:0,[cv]:0}),b=Object.assign({},...Object.keys(I).map(j=>{var z;return{[j]:((z=Eve({category:{ageCategoryCode:"O18"},count:I[j],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:j}))==null?void 0:z.persons)||[]}})),D={[zi]:0,[gn]:0,[cv]:0},w=y.length,S=y.reduce((j,z)=>{var H,K;let q=((K=(H=z.person)==null?void 0:H.addresses)==null?void 0:K[0])||{},{city:Y,state:Z,postalCode:Q}=q;return j.cities.includes(Y)||j.cities.push(Y),j.states.includes(Z)||j.states.push(Z),j.postalCodes.includes(Q)||j.postalCodes.push(Q),j},{cities:[],postalCodes:[],states:[]}),U=S.postalCodes.length,C=S.cities.length,E=S.states.length,{cities:P}=Uve({count:C||w,participantsCount:w}),{states:M}=Dve({count:E||w,participantsCount:w}),{postalCodes:N}=Pve({count:U||w,participantsCount:w}),R={cities:P,states:M,postalCodes:N};y.forEach((j,z)=>{var H,K;let q=j==null?void 0:j.person,Y=(q==null?void 0:q.sex)||cv,Z=(H=Lt(q==null?void 0:q.birthDate))==null?void 0:H.split("-")[0],Q=D[Y],ie=b[Y][Q];if(D[Y]+=1,Z){let[,ue,J]=((K=ie==null?void 0:ie.birthDate)==null?void 0:K.split("-"))||[],te=[Z,ue,J].join("-");ie.birthDate=te}if(q!=null&&q.addresses){let ue=Cve({...R,participantIndex:z,nationalityCode:ie.nationalityCode});ie.addresses=[ue]}ie.personId=(r==null?void 0:r[z])||xi(),e?(ie.standardFamilyName=ie.lastName,ie.standardGivenName=ie.firstName,j.participantName=`${ie.standardGivenName} ${ie.standardFamilyName}`):(ie.standardFamilyName=q==null?void 0:q.standardFamilyName,ie.standardGivenName=q==null?void 0:q.standardGivenName),delete ie.firstName,delete ie.lastName,ie.extensions=p(q),j.person=ie,h[q==null?void 0:q.personId]=ie.personId}),(i.participants||[]).filter(({participantType:j})=>j===Ot).forEach(j=>{let{individualParticipantIds:z}=j;j.participantName=WHe({individualParticipantIds:z,individualParticipants:y})});let A=(i.participants||[]).filter(({participantType:j})=>j===Gi),_=A.length,O=qB({count:_}).names;A.forEach((j,z)=>{j.participantName=O[z]});let x=(i.participants||[]).filter(({participantType:j})=>j===bs),F=x.length,$=qB({count:F,nameRoot:"Group"}).names;x.forEach((j,z)=>{j.participantName=$[z]});let{extension:V}=jt({element:i,name:sy});Array.isArray(V==null?void 0:V.value)&&(V==null||V.value.forEach(j=>{j.tournamentId=h[j.tournamentId],j.structureId=h[j.structureId],j.eventId=h[j.eventId],j.drawId=h[j.drawId]}));let{extension:G}=jt({element:i,name:G0});return Array.isArray(G==null?void 0:G.value)&&(G==null||G.value.forEach(j=>{j.personId=h[j.personId]})),{...re}}function WHe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function Hve(t){var e,i,n;let{ratingsParameters:r=rs,participantsProfile:a={},matchUpStatusProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,schedulingProfile:d,tournamentRecord:p,eventProfiles:h,periodLength:f,venueProfiles:m,autoSchedule:g,drawProfiles:v,uuids:y}=t;if(!p)return{error:Ne};let I=[],b=[],D=[];h==null||h.forEach(P=>{var M;let N=(M=p.events)==null?void 0:M.find((R,A)=>P.eventIndex!==void 0&&A===P.eventIndex||P.eventName&&R.eventName===P.eventName||P.eventId&&R.eventId===P.eventId);N!=null&&N.gender&&(P.gender=N.gender)});let w=((e=p.participants)==null?void 0:e.length)||void 0;w&&a!=null&&a.idPrefix&&(a.idPrefix=`${a.idPrefix}-${w}`);let S=Rve({startDate:p.startDate,participantsProfile:a,tournamentRecord:p,eventProfiles:h,drawProfiles:v,uuids:y});if(!S.success)return S;if(h){let P=((i=p.events)==null?void 0:i.length)||0;for(let M of h){let{ratingsParameters:N}=M,R=(n=p.events)==null?void 0:n.find((A,_)=>M.eventIndex!==void 0&&_===M.eventIndex||M.eventName&&A.eventName===M.eventName||M.eventId&&A.eventId===M.eventId);if(R){let{gender:A,category:_,eventType:O}=R,{drawProfiles:x,publish:F}=M,$=_n(Cd)(O)&&Zt||_n(Ll)(O)&&Ot||O;if(x){let{stageParticipantsCount:V,uniqueParticipantsCount:G,uniqueParticipantStages:j}=Nve({drawProfiles:x,category:_,gender:A}),{uniqueDrawParticipants:z=[],uniqueParticipantIds:H=[]}=j?Ove({event:{eventType:O,category:_,gender:A},uniqueParticipantsCount:G,participantsProfile:a,ratingsParameters:N,tournamentRecord:p,eventProfile:M,uuids:y}):{};I.push(...H);let{stageParticipants:K}=Ave({targetParticipants:p.participants||[],allUniqueParticipantIds:I,stageParticipantsCount:V,eventParticipantType:$}),q=xve({uniqueDrawParticipants:z,autoEntryPositions:l,stageParticipants:K,tournamentRecord:p,drawProfiles:x,category:_,gender:A,event:R});if(q.error||(q=kve({matchUpStatusProfile:o,completeAllMatchUps:s,randomWinningSide:u,tournamentRecord:p,drawProfiles:x,event:R}),q.error))return q;D.push(...q.drawIds)}F&&oS({tournamentRecord:p,event:R})}else{let A=Lve({startDate:p.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:u,ratingsParameters:N,tournamentRecord:p,eventProfile:M,eventIndex:P,uuids:y});if(A.error)return A;let{eventId:_,drawIds:O,uniqueParticipantIds:x}=A;O&&D.push(...O),b.push(_),x!=null&&x.length&&I.push(...x),P+=1}}}if(v){let P=(p.events||[]).map(M=>{var N;return((N=M.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((M,N)=>M+N,0);for(let M of v){let N=KO({startDate:p.startDate,allUniqueParticipantIds:I,matchUpStatusProfile:o,participantsProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,ratingsParameters:r,tournamentRecord:p,drawProfile:M,drawIndex:P,uuids:y});if(N.error)return N;let{drawId:R,eventId:A,event:_,uniqueParticipantIds:O}=N;if(N=WC({tournamentRecord:p,event:_,internalUse:!0}),N.error)return N;R&&D.push(R),b.push(A),O!=null&&O.length&&I.push(...O),P+=1}}let U=m!=null&&m.length?Bve({tournamentRecord:p,venueProfiles:m}):[],C,E={};if(d!=null&&d.length){let P={[p.tournamentId]:p},M=rS({tournamentRecords:P,schedulingProfile:d});if(M.error)return M;if(g){let{tournamentId:N}=p,R={[N]:p};E=qO({tournamentRecords:R,periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:C,schedulerResult:E,...re,eventIds:b,venueIds:U,drawIds:D}}var zve={};Ht(zve,{addIndividualParticipantIds:()=>BO,addParticipant:()=>bu,addParticipants:()=>Ac,addPenalty:()=>dye,addPersonRequests:()=>Xve,addPersons:()=>pye,createGroupParticipant:()=>nye,createTeamsFromParticipantAttributes:()=>g5,deleteParticipants:()=>fI,filterParticipants:()=>wC,findParticipant:()=>iye,getCompetitionParticipants:()=>u4,getPairedParticipant:()=>Fl,getParticipantEventDetails:()=>d4,getParticipantMembership:()=>p4,getParticipantScaleItem:()=>Tw,getParticipantSchedules:()=>h4,getParticipantSignInStatus:()=>f4,getParticipantTimeItem:()=>nq,getParticipants:()=>$n,getScaleValues:()=>B0,mergeParticipants:()=>uye,modifyIndividualParticipantIds:()=>Jve,modifyParticipant:()=>VO,modifyParticipantName:()=>rye,modifyParticipantOtherName:()=>eye,modifyParticipantsSignInStatus:()=>Qve,modifyPenalty:()=>lye,modifyPersonRequests:()=>Yve,mutate:()=>Wve,participantScaleItem:()=>td,query:()=>Jme,regenerateParticipantNames:()=>tye,removeIndividualParticipantIds:()=>uq,removeParticipantIdsFromAllTeams:()=>qk,removePenalty:()=>oye,removePersonRequests:()=>Zve,scaledTeamAssignment:()=>aye,setParticipantScaleItem:()=>Uw,setParticipantScaleItems:()=>cfe,validateLineUp:()=>Yk});var Wve={};Ht(Wve,{addIndividualParticipantIds:()=>BO,addParticipant:()=>bu,addParticipants:()=>Ac,addPenalty:()=>dye,addPersonRequests:()=>Xve,addPersons:()=>pye,createGroupParticipant:()=>nye,createTeamsFromParticipantAttributes:()=>g5,deleteParticipants:()=>fI,findParticipant:()=>iye,mergeParticipants:()=>uye,modifyIndividualParticipantIds:()=>Jve,modifyParticipant:()=>VO,modifyParticipantName:()=>rye,modifyParticipantOtherName:()=>eye,modifyParticipantsSignInStatus:()=>Qve,modifyPenalty:()=>lye,modifyPersonRequests:()=>Yve,regenerateParticipantNames:()=>tye,removeIndividualParticipantIds:()=>uq,removeParticipantIdsFromAllTeams:()=>qk,removePenalty:()=>oye,removePersonRequests:()=>Zve,scaledTeamAssignment:()=>aye,setParticipantScaleItem:()=>Uw,setParticipantScaleItems:()=>cfe});function qve(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Kve({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:a,startTime:o,endTime:s}=r;return r.requestType===XC&&(a=Lt(a),o=rn(o),s=rn(s),a&&o&&s)?{date:a,startTime:o,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=qve(),t[e].push(r);return{mergeCount:n.length}}function b5(t){let{tournamentRecords:e,personRequests:i}=t,n=vi(t,[{[Ta]:!0}]);if(n.error)return n;if(!i)return{...re};let r=Object.values(e);for(let a of r){let o=a.participants??[],s=[];for(let l of Object.keys(i))if(ef({tournamentParticipants:o,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&ui({element:a,extension:{value:s,name:G0}})}return{...re}}function Yve(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=vi(t,[{[Ta]:!0},{requests:!0,[_f]:Ao,[Id]:Ie}]);if(r.error)return r;let a=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:o}=Fg({tournamentRecords:e}),s=c=>{o&&(o[c]=o[c].map(u=>{if(!a.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&o!=null&&o[n])s(n);else if(o)for(let c of Object.keys(o))s(c);let l=i.filter(c=>!c.requestId);return l.length&&Kve({personRequests:o,personId:n,requests:l}),b5({tournamentRecords:e,personRequests:o})}function Zve(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:a}=t,o=vi(t,[{[Ta]:!0}]);if(o.error)return o;let{personRequests:s}=Fg({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!a||p.date!==a)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!n&&!r&&!a;if(!c){if(r&&s!=null&&s[r])l(r);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?Va({name:G0,tournamentRecords:e,discover:!0}):b5({tournamentRecords:e,personRequests:s})}function Xve(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=vi(t,[{[Ta]:!0,[DLe]:!0},{requests:!0,[_f]:Ao,[Id]:Ie}]);if(r.error)return r;let{personRequests:a}=Fg({tournamentRecords:e}),{mergeCount:o}=Kve({personRequests:a,personId:i,requests:n});return o&&a?b5({tournamentRecords:e,personRequests:a}):{error:Ie}}function Jve({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return oe({result:{error:Ne},stack:n});if(!e||!t)return oe({result:{error:dt},stack:n});let r=i.participants||[],a=r.find(h=>h.participantId===e);if(!a)return oe({result:{error:Gn},stack:n});if(![Gi,bs].includes(a.participantType))return oe({result:{error:Mc},context:{participantType:a.participantType},stack:n});let o=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==Zt});if(o.length)return oe({result:{error:Tl,invalidParticipantIds:o},stack:n});let s=a.individualParticipantIds||[],l=t.filter(h=>!s.includes(h)),c=s.filter(h=>!t.includes(h)),u=BO({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return oe({result:u,stack:n});let d=uq({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return oe({result:d,stack:n});let{topics:p}=Wl();if(p.includes(sa)){let h=r.find(({participantId:f})=>f===e);ti({topic:sa,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function Qve({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Ne};if(!Array.isArray(e))return{error:dt};if(![RU,$de].includes(i))return{error:Ie,signInState:i};let n=t.participants||[];if(!n.length)return{error:jP};let r=n.map(Yt),a=e.filter(c=>!r.includes(c));if(a.length)return{error:Ie,context:{invalidParticipantIds:a}};let o=[],s=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=Tq({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:nC,itemValue:i,createdAt:s}});if(d.error)return d;o.push(c)}}let{topics:l}=Wl();return o.length&&l.includes(sa)&&ti({topic:sa,payload:{tournamentId:t.tournamentId,participants:o}}),{...re}}function eye({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Ne};if(!e)return{error:vr};let{participant:n}=kg({tournamentRecord:t,participantId:e});if(!n)return{error:Gn};n.participantOtherName=i;let{topics:r}=Wl();return r.includes(sa)&&ti({topic:sa,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...re}}function t8({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),a=m=>/^[LAST]{4}/.test(i(m)),o=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=bB((e==null?void 0:e.standardGivenName)??""),h=bB((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!s(t)&&!o(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):a(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:o(t)&&(s(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function qHe({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:a}=e,o=n&&i[n];if(n!==Vs&&o){let{personFormat:s,doublesJoiner:l}=o;n===Zt&&(e.participantName=t8({person:a,personFormat:s})),n===Ot&&(e.participantName=r==null?void 0:r.map(c=>{var u;let d=(u=t[c])==null?void 0:u.person;return t8({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function tye({tournamentRecord:t,formats:e}){if(!t)return{error:Ne};if(!on(e))return{error:dt};let i=t.participants??[],n=wce(i,"participantId");for(let r of i)qHe({participant:r,participantMap:n,formats:e});return{...re}}function iye(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}=t,o=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof a!="string")return{error:dt,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(o)){l=c.tournamentId;let u=c.participants||[];if(s=ef({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:a}),s)break}return{participant:s,tournamentId:l,...re}}function nye({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Ape,tournamentRecord:n,participantId:r,groupName:a}){if(!n)return{error:Ne};if(!a)return{error:dt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Ie};let o=($n({participantFilters:{participantTypes:[Zt]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!o.includes(u))return{error:Mc,participantId:u};let s=ft({participantId:r||xi(),participantRoleResponsibilities:e,participantName:a,individualParticipantIds:t,participantType:bs,participantRole:i}),l=bu({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:c}=Wl();return c.includes(nf)&&ti({topic:nf,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...re,participant:ot(s)}}function rye({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Ne};if(!i)return{error:vr};if(!e)return{error:dt,info:"Missing participantName"};let{participant:n}=kg({tournamentRecord:t,participantId:i});if(!n)return{error:Gn};n.participantName=e;let{topics:r}=Wl();return r.includes(sa)&&ti({topic:sa,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...re}}function aye({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:a,tournamentRecord:o,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var p,h,f,m,g;if(!o)return{error:Ne};if(!Array.isArray(a)&&!Rt(c)&&!u||!Rt(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:Ie};if(!s&&!r.length||!r&&!(e&&s))return{error:dt,info:"Missing scaling details"};if(u&&!a){if((d==null?void 0:d.eventType)!==Ys)return{error:Jh};a=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:w})=>w===hs).map(Yt)}if(!(a!=null&&a.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:dt};let v=e??r.map(({participantId:w})=>w);i&&(a==null||a.reverse(),n+=1),n>((a==null?void 0:a.length)||0)-1&&(n=0);let y=(a==null?void 0:a.slice(n).concat(...a.slice(0,n)))??[],I=[];for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(y.includes(S)){if(U!==Vs)return{error:Mc,participant:w};I.push(w)}}if(c&&I.length<c){let w=c-((I==null?void 0:I.length)||0),S=l??"Team",U=Xe(0,w).map(M=>({participantName:`${S} ${M+1}`,participantType:Vs,participantRole:va})),{participants:C=[]}=Ac({participants:U,returnParticipants:!0,tournamentRecord:o}),E=C.map(Yt),P=((h=o.participants)==null?void 0:h.filter(({participantId:M})=>E.includes(M)))??[];I.push(...P)}if(!I.length)return{error:HW};if(t)for(let w of I)w.individualParticipantIds=[];else{let w=I.map(S=>S).flat();e!=null&&e.length?v=v.filter(S=>!w.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!w.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:gk,info:"Nothing to be done"};if(!r.length){for(let w of o.participants??[]){let{participantId:S,participantType:U}=w;if(!v.includes(S))continue;if(U!==Zt)return{error:Mc,participant:w};let C=(f=td({scaleAttributes:s,participant:w}))==null?void 0:f.scaleItem,E=s!=null&&s.accessor?(m=C==null?void 0:C.scaleValue)==null?void 0:m[s==null?void 0:s.accessor]:C==null?void 0:C.scaleValue,P={participantId:S,scaleValue:E};r.push(P)}if(!r.length)return{error:Gn}}r.sort((w,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((w==null?void 0:w.scaleValue)||0):((w==null?void 0:w.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(let w of r)if(!w.participantId)return{error:Ie,scaledParticipant:w};let b=0;for(;b<r.length;){for(let w of I){if(b+1>r.length)break;let S=r[b];w.individualParticipantIds.push(S.participantId),b++}I.reverse()}let D=I.map(Yt);for(let w of o.events??[]){if(w.eventType!==Ys)continue;let S=(w.entries??[]).filter(U=>D.includes(U.participantId));for(let U of S){let C=U.participantId,E=(g=I.find(M=>M.participantId===C))==null?void 0:g.individualParticipantIds;w.entries=(w.entries??[]).filter(M=>!E.includes(M.participantId)),(w.drawDefinitions??[]).forEach(M=>{M.entries=(M.entries??[]).filter(N=>!E.includes(N.participantId))});let{flightProfile:P}=Vn({event:w});((P==null?void 0:P.flights)||[]).forEach(M=>{M.drawEntries=(M.drawEntries||[]).filter(N=>!E.includes(N.participantId))})}}return{...re,scaledParticipants:r}}function oye(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=KHe({...t,tournamentRecord:i});if(n.error&&n.error!==lw)return n}return{...re}}function KHe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Ne};if(!e)return{error:$W};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,a;return i.forEach(o=>{let s=!1;o.penalties=(o.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(a=l,r=!0)),s&&n.push(o),l.penaltyId!==e))}),a&&ti({topic:sa,payload:{tournamentId:t.tournamentId,participants:n}}),a?{...re,penalty:a}:{error:lw}}var YHe=({penaltyId:t=xi()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),sye=YHe;function lye(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=ZHe({...t,tournamentRecord:i});if(n.error&&n.error!==lw||n.success)return n}return{error:lw}}function ZHe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Ne};if(!e)return{error:Ie,modifications:e};if(!i)return{error:$W};let n=(t==null?void 0:t.participants)??[],r=Object.keys(sye()).filter(l=>l!=="penaltyId"),a=Object.keys(e).filter(l=>r.includes(l));if(!a.length)return{error:vk};let o,s=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,a.forEach(d=>Object.assign(u,{[d]:e[d]})),o||(o=u)),u)),c&&s.push(l)}),o&&ti({topic:sa,payload:{tournamentId:t.tournamentId,participants:s}}),o?{...re,penalty:o}:{error:lw}}function cye(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:$t(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let a=$t(t[r].map(o=>JSON.stringify(o)).concat(e[r].map(o=>JSON.stringify(o)))).map(o=>JSON.parse(o));n[r]=a}else n[r]=e[r];else typeof t[r]=="object"?n[r]=cye(t[r],e[r],i):n[r]=e[r];return n},{})}function uye({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Ne};e.participants||(e.participants=[]);let n=t.filter(Ko(yd)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),a=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=cye(c,r[c.participantId],i);return a.push(u),u}return c});let o=e.participants.map(Ko(yd))||[],s=t.filter(({participantId:c})=>!o.includes(c)),{topics:l}=Wl();return s.length&&(e.participants=e.participants.concat(...s),l.includes(nf)&&ti({topic:nf,payload:{participants:s}})),a.length&&l.includes(sa)&&ti({topic:sa,payload:{tournamentId:e.tournamentId,participants:a}}),{modifiedParticipantsCount:a.length,newParticipantsCount:s.length,...re}}function dye(t){var e;let{tournamentRecord:i,participantIds:n}=t,r=t.tournamentRecords??(i&&{[i.tournamentId]:i})??{},a;for(let o of Object.values(r)){let s=(e=$n({tournamentRecord:o}).participants??[])==null?void 0:e.map(Yt).filter(l=>n.includes(l));s.length&&(a=XHe({...t,penaltyId:t.penaltyId??a,tournamentRecord:o,participantIds:s}).penaltyId)}return a?{...re,penaltyId:a}:{error:Gn}}function XHe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:a,penaltyId:o,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:Ne};if(!i)return{error:vr};if(!r)return{error:lue};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:Gn};let d=new Date().toISOString(),p=Object.assign(sye({penaltyId:o}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(a)&&a.forEach(h=>ui({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),ti({topic:sa,payload:{tournamentId:e.tournamentId,participants:u}}),{...re,penaltyId:p.penaltyId}}function pye({participantRole:t=va,tournamentRecord:e,persons:i}){var n;if(!e)return{error:Ne};if(!Array.isArray(i))return{error:Ie};if(!Object.keys(cq).includes(t))return{error:Xce};let r=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),a=[],o=i.filter(m=>m&&(!m.personId||!r.includes(m.personId))).map(m=>(m.personId||(m.personId=xi()),a.push(m.personId),m)),s=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),l=o.map(m=>ft({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:Zt,participantRole:t,person:s(m,["participantExtensions","participantTimeItems","pairedPersons"])})),c=0,u=0,d=Ac({participants:l,tournamentRecord:e});if(d.error)return d;u=d.addedCount||0;let p=[],h=((n=$n({participantFilters:{participantTypes:[Zt]},tournamentRecord:e}))==null?void 0:n.participants)??[];if(t===va&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(I=>ef({tournamentParticipants:h,personId:I})).filter(Boolean);if(y.length===2){let I=y.map(Yt);p.push(ft({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:va,individualParticipantIds:I,participantType:Ot}))}})}),p.length){if(d=Ac({participants:p,tournamentRecord:e}),d.error)return d;c=d.addedCount||0}let f=u+c;return{...re,addedCount:f,newPersonIds:a}}var hye={};Ht(hye,{bulkUpdatePublishedEventIds:()=>w4,getAllEventData:()=>S4,getCourtInfo:()=>Vk,getDrawData:()=>wO,getEventData:()=>SO,getEventPublishStatus:()=>tl,getPublishState:()=>hI,getVenueData:()=>bw,mutate:()=>fye,publishEvent:()=>oS,publishEventSeeding:()=>mye,publishOrderOfPlay:()=>yye,query:()=>nge,setEventDisplay:()=>OO,unPublishEvent:()=>Iye,unPublishEventSeeding:()=>gye,unPublishOrderOfPlay:()=>vye});var fye={};Ht(fye,{publishEvent:()=>oS,publishEventSeeding:()=>mye,publishOrderOfPlay:()=>yye,setEventDisplay:()=>OO,unPublishEvent:()=>Iye,unPublishEventSeeding:()=>gye,unPublishOrderOfPlay:()=>vye});function mye({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=Zl,drawIds:a=[],event:o}){var s,l,c,u;if(!n)return{error:Ne};if(!o)return{error:_i};let d=tl({event:o,status:r}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i},h=(((c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames)||e)&&{...(u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames,...e},f=ft({stageSeedingScaleNames:h,seedingScaleNames:p,published:!0,drawIds:a});return aS({statusObject:{seeding:f},removePriorValues:t,status:r,event:o}),ti({topic:kde,payload:{tournamentId:n.tournamentId,eventId:o.eventId,drawIds:a}}),{...re}}function gye({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=Zl,drawIds:r,stages:a,event:o}){var s,l;if(!i)return{error:Ne};if(!o)return{error:_i};let c=tl({event:o});if(c){let u=c.seeding;if(Array.isArray(a)&&u.stageSeedingScaleNames)for(let d of a)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&u!=null&&u.seedingScaleNames&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&u!=null&&u.drawIds&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((s=u.seedingScaleNames)!=null&&s.length)&&!((l=u.drawIds)!=null&&l.length)||!a&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),aS({statusObject:{seeding:u},removePriorValues:t,status:n,event:o})}return ti({topic:$3,payload:{tournamentId:i.tournamentId,eventId:o.eventId}}),{...re}}function vye(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=JHe({tournamentRecord:i,...t});if(n.error)return n}return{...re}}function JHe({removePriorValues:t=!0,tournamentRecord:e,status:i=Zl}){if(!e)return{error:Ne};let n=`${Ng}.${Ag}`,{timeItem:r}=Mu({element:e,itemType:n}),a=(r==null?void 0:r.itemValue)||{[i]:{}};return a[i]&&delete a[i].orderOfPlay,Lf({timeItem:{itemValue:a,itemType:n},element:e,removePriorValues:t}),ti({topic:B3,payload:{tournamentId:e.tournamentId}}),{...re}}function yye(t){let e=Eu(t);if(!Object.keys(e).length)return{error:Cn};for(let i of Object.values(e)){let n=QHe({tournamentRecord:i,...t});if(n.error)return n}return{...re}}function QHe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=Zl,eventIds:r=[]}){if(!i)return{error:Ne};let a=`${Ng}.${Ag}`,{timeItem:o}=Mu({element:i,itemType:a}),s=(o==null?void 0:o.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},Lf({timeItem:{itemValue:s,itemType:a},element:i,removePriorValues:e}),ti({topic:Ode,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...re}}function Iye({removePriorValues:t=!0,tournamentRecord:e,status:i=Zl,event:n}){if(!e)return{error:Ne};if(!n)return{error:_i};let r=`${Ng}.${Ag}`,{timeItem:a}=gC({itemType:r,event:n}),o=(a==null?void 0:a.itemValue)||{[i]:{}};return delete o[i].structureIds,delete o[i].drawDetails,delete o[i].drawIds,yI({event:n,timeItem:{itemValue:o,itemType:r},removePriorValues:t}),aS({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),ti({topic:F3,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...re}}var bye={};Ht(bye,{getEntryStatusReports:()=>tze,getParticipantStats:()=>eze,getStructureReports:()=>nze,getVenuesReport:()=>aze});function eze({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:a,tallyPolicy:o,matchUps:s}){var l,c,u,d,p;if(!r)return{error:Ne};if(s&&!Array.isArray(s))return{error:uo};if(s=s??Hr({tournamentRecord:r,participantsProfile:a?{withScaleValues:a}:void 0}).matchUps,!(s!=null&&s.length))return{error:Nd};let h=[];e&&h.push(e),n&&h.push(n);let f=h.length?{participantIds:h}:{participantTypes:[Vs]},m=$n({participantFilters:f,tournamentRecord:r}).participants??[];if(!m.every(({participantType:M})=>M===Vs))return{error:Tl};h.length||h.push(...m.map(Yt));let g=new Map,v=new Map,y=new Map,I=new Map,b=(M,N="")=>v.get(M)||v.set(M,{participantName:N,participantId:M,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&v.get(M);for(let M of m){let{participantId:N,individualParticipantIds:R}=M;I.set(N,R??[]),b(N,M.participantName)}if(n&&!I.get(n))return oe({result:{error:Gn},context:{teamParticipantId:n}});if(e&&!I.get(e))return oe({result:{error:Gn},context:{opponentParticipantId:e}});let D=[],w=M=>{let N=[[],[]];for(let A of M){let _=A.participant;if(_!=null&&_.participantName){g.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let O=v.get(_.participantId);O&&(O.participantName=_.participantName)}}let R=({side:A,individualParticipantIds:_})=>{var O,x,F,$,V;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((x=(O=A.participant)==null?void 0:O.individualParticipantIds)==null?void 0:x.length)&&(!(_!=null&&_.length)||Ln(_,(F=A.participant)==null?void 0:F.individualParticipantIds).length===((V=($=A.participant)==null?void 0:$.individualParticipantIds)==null?void 0:V.length))&&A.participant.individualParticipantIds};if(I.size){let A=(_,O)=>{for(let x of M){if(!x.participant)continue;let F=R({individualParticipantIds:O,side:x});if(F!=null&&F.length){let $=x.sideNumber;if(!$)continue;let V=[_];i&&V.push(...F),N[$-1]=V;let G=v.get(_);for(let j of F.filter(Boolean))G&&!G.competitorIds.includes(j)&&G.competitorIds.push(j)}}};if(n)(!e||M.every(_=>_.participant&&(R({individualParticipantIds:I.get(n),side:_})||R({individualParticipantIds:I.get(e),side:_}))))&&A(n,I.get(n));else for(let[_,O]of I)A(_,O)}else if(i)for(let A of M){if(!A.participant)continue;let _=R({individualParticipantIds:[],side:A}),O=A.sideNumber;O&&(N[O-1]=_)}return N};for(let M of s){if(!on(M))return{error:uo};let{matchUpStatus:N,matchUpFormat:R,matchUpType:A,winningSide:_,score:O,sides:x}=M;if(!x||!O||A===gu||N===wi)continue;let F=w(x);if(!F.filter(Boolean).length)continue;let $=t&&_&&((l=dC({matchUp:M}))==null?void 0:l.competitiveness);D.push(M);let V=Mq({matchUpStatus:N,matchUpFormat:R,tallyPolicy:o,winningSide:_,score:O}),G=She({matchUpStatus:N,matchUpFormat:R,tallyPolicy:o,winningSide:_,score:O}),{pointsTally:j,tiebreaksTally:z}=The({matchUpFormat:R,score:O});F.forEach((H,K)=>{var q;for(let Y of H){let Z=(q=g.get(Y))==null?void 0:q.participantName,Q=b(Y,Z);if(Q){let ie=(ee,ce)=>ce.forEach((fe,ge)=>Q[ee][ge]+=fe),ue=K?[...z].reverse():z,J=K?[...j].reverse():j,te=K?[...G].reverse():G,se=K?[...V].reverse():V;if(ie("tiebreaks",ue),ie("points",J),ie("games",te),ie("sets",se),_){let ee=_-1===K?0:1;Q.matchUps[ee]+=1}if($){let ee=$.toLowerCase();Q.competitiveness[ee]||(Q.competitiveness[ee]=[0,0]),Q.competitiveness[ee][K]+=1}if(N){let ee=N.toLowerCase();Q.matchUpStatuses[ee]||(Q.matchUpStatuses[ee]=0),Q.matchUpStatuses[ee]+=1}}}})}let S=["tiebreaks","matchUps","points","games","sets"],U=["competitive","routine","decisive"],C=new Map,E=(M,N)=>(M??0)+(N??0);for(let[M,N]of v.entries()){for(let R of S){let A=N[R].reduce(E);if(A){let _=N[R][0]/A,O=`${R}Ratio`,x=parseFloat(_.toFixed(2));N[O]=x,y.set(M,!0),C.has(O)||C.set(O,[]),(c=C.get(O))==null||c.push(x)}}for(let R of U){let A=(d=(u=N.competitiveness)==null?void 0:u[R])==null?void 0:d.reduce(E);if(A){let _=N.competitiveness[R][0]/A,O=`${R}Ratio`,x=parseFloat(_.toFixed(2));N[O]=x}}}if(!n){let M=(N,R)=>R-N;for(let N of v.values())for(let R of S){let A=`${R}Ratio`;if(typeof N[A]=="number"){let _=(p=C.get(A))==null?void 0:p.sort(M).indexOf(N[A]);if(typeof _=="number"&&_>=0){let O=`${R}Rank`;N[O]=_+1}}}}let P={relevantMatchUps:D,...re};return n?(P.teamStats=v.get(n),e&&(P.opponentStats=v.get(e))):P.participatingTeamsCount=y.size,P.allParticipantStats=[...v.values()],P}function dN({participant:t,eventType:e}){var i,n,r,a,o,s;let l=(i=t==null?void 0:t.person)==null?void 0:i.personId,c=(r=(n=t==null?void 0:t.person)==null?void 0:n.personOtherIds)==null?void 0:r[0],u=(a=t==null?void 0:t.person)==null?void 0:a.tennisId,d=(s=(o=t==null?void 0:t.ratings)==null?void 0:o[e])==null?void 0:s.find(({scaleName:m})=>m===Xq),p=d==null?void 0:d.scaleValue,{wtnRating:h,confidence:f}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:c,confidence:f,wtnRating:h,personId:l,tennisId:u}}function tze({tournamentRecord:t}){if(!t)return{error:Ne};let e=t.tournamentId,{participantMap:i}=$n({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Hr({matchUpFilters:{matchUpTypes:[Mv,zm]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===zm?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],a={},o={},s={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var v;let{qualifyingSeeding:y,mainSeeding:I,entryStatus:b,entryStage:D,drawId:w}=f;a[h]||(a[h]=[]);let{participant:S,events:U}=(i==null?void 0:i[h])??{},C=dN({participant:S,eventType:g}),E=(v=U==null?void 0:U[m])==null?void 0:v.ranking;b===Gq&&r.push(h),a[h].push({participantType:S==null?void 0:S.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:w,entryStatus:b,entryStage:D,...C,ranking:E,mainSeeding:I,qualifyingSeeding:y})};for(let h of t.events??[]){let f={},m=S=>{f[S]||(f[S]={count:0}),f[S].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,I=g.flatMap(S=>{let{drawId:U,entries:C}=S;l+=1;let E=({stage:R,stageSequence:A})=>R===nt&&A===1||R===gt,P=(S.structures??[]).filter(E).flatMap(({positionAssignments:R})=>R).filter(Boolean).map(({participantId:R})=>R),M=({participantId:R})=>P.includes(R),N=R=>{var A,_,O,x,F,$,V,G;let{participantId:j,entryStatus:z,entryStage:H}=R;m(z);let K=(x=(O=(_=(A=i==null?void 0:i[j])==null?void 0:A.draws)==null?void 0:_[U])==null?void 0:O.seedAssignments)==null?void 0:x[nt];return{qualifyingSeeding:(G=(V=($=(F=i==null?void 0:i[j])==null?void 0:F.draws)==null?void 0:$[U])==null?void 0:V.seedAssignments)==null?void 0:G[gt],participantId:j,mainSeeding:K,entryStatus:z,entryStage:H,drawId:U}};return C==null?void 0:C.filter(M).map(N)}),b=S=>{var U;let C=S.participantId,E=(U=i==null?void 0:i[C].participant.individualParticipantIds)==null?void 0:U.filter(P=>n.includes(P));return C&&{[C]:{individualParticipantIds:E}}};v===of?(()=>{let S=Object.assign({},...I.map(b).filter(Boolean)),U=C=>{S[C.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:C})})};I.forEach(U)})():I.forEach(S=>{c({id:S==null?void 0:S.participantId,eventType:v,eventId:y,entry:S})});let D=Object.values(f).reduce((S,U)=>S+U.count,0);Object.keys(f).forEach(S=>{f[S].pct=f[S].count/D*100}),s[y]={tournamentId:e,eventId:y,entries:I,entryStatuses:f};let w=Object.assign({},...Yl.flatMap(S=>{var U,C;return[{[S+"_count"]:(U=f[S])==null?void 0:U.count},{[S+"_pct"]:(C=f[S])==null?void 0:C.pct}]}));o[y]={tournamentId:e,eventId:y,...w}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===Zt&&f===va),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(o).flat(),participantEntryReports:Object.values(a).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function ize({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},a=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},o=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(a(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),s=Object.values(o),l=s.map(f=>dN({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(s.length-l.length)/s.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function nze({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var n;if(!i)return{error:rw};let r={},a=Object.assign({},...(e??[]).map(({name:u,label:d,accessor:p})=>{var h,f,m;let g=(f=(h=jt({element:i,name:u}))==null?void 0:h.extension)==null?void 0:f.value,v=p?(m=Rv({element:g,accessor:p}))==null?void 0:m.value:g;return{[d||u]:v}})),o=i==null?void 0:i.tournamentId,s=Hr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],l=u=>{var d,p,h;return(h=(p=(d=Mu({itemType:E3,itemSubTypes:[Qu],element:{timeItems:u}}))==null?void 0:d.timeItem)==null?void 0:p.itemValue)==null?void 0:h.scaleBasis},c=(n=i==null?void 0:i.events)==null?void 0:n.flatMap(({timeItems:u,drawDefinitions:d=[],extensions:p,eventType:h,eventId:f,category:m})=>{var g,v,y,I,b;let D=(y=(v=(g=p==null?void 0:p.find(P=>P.name===kl))==null?void 0:g.value)==null?void 0:v.flights)==null?void 0:y.map(P=>({[P.drawId]:P.flightNumber})),w=D&&Object.assign({},...D),S=((b=(I=p==null?void 0:p.find(P=>P.name===VR))==null?void 0:I.value)==null?void 0:b.length)||0,U=Object.values(w),C=w&&Math.min(...U),E=l(u);return r[f]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:S,seedingBasis:E?JSON.stringify(E):void 0,tournamentId:o,eventId:f},d.filter(P=>!t||!D||w[P.drawId]===C).flatMap(P=>{let{matchUpFormat:M,tieFormat:N,timeItems:R,extensions:A,structures:_,drawType:O,drawId:x}=P,{matchUpFormatCounts:F,matchUpsCount:$,avgConfidence:V,pctNoRating:G,avgWTN:j}=ize({eventType:h,matchUps:s,drawId:x}),z=l(R)||E,H=rze({extensions:A}),K=(H==null?void 0:H.length)||0;return r[f].totalPositionManipulations+=K,r[f].generatedDrawsCount+=1,K>r[f].maxPositionManipulations&&(r[f].maxPositionManipulations=K),_==null?void 0:_.filter(q=>q.stageSequence===1&&[gt,nt,oa,Nn].includes(q.stage)).map(q=>{var Y,Z,Q;let ie=[nt,Nn].includes(q.stage)?s.find(pe=>pe.structureId===q.structureId&&pe.finishingRound===1&&pe.winningSide):void 0,ue=(Z=(Y=ie==null?void 0:ie.sides)==null?void 0:Y.find(pe=>pe.sideNumber===ie.winningSide))==null?void 0:Z.participant,J=(ue==null?void 0:ue.participantType)===Vs&&ue.participantId,te=(ue==null?void 0:ue.participantType)===Ot?ue.individualParticipants:[],se=dN({participant:(te==null?void 0:te[0])||ue,eventType:h}),{personId:ee,personOtherId:ce,tennisId:fe,confidence:ge,wtnRating:he}=se||{},Se=dN({participant:te==null?void 0:te[1],eventType:h}),{personId:Ce,personOtherId:Fe,tennisId:Je,confidence:xe,wtnRating:st}=Se||{},{ageCategoryCode:we,categoryName:Oe,subType:ye}=m??{},Be=q.matchUpFormat||M,Ee=(F[Be]||0)/$*100,{tieFormatName:qe,tieFormatDesc:Ge}=oN(N),{tieFormatName:me,tieFormatDesc:Me}=oN(q.tieFormat),De=Ge===Me,Ae=!De&&me,ze=q.tieFormat&&!De&&Me,de=((Q=H==null?void 0:H.filter(pe=>pe.structureId===q.structureId))==null?void 0:Q.length)||0;return{...a,tournamentId:o,eventId:f,structureId:q.structureId,drawId:x,eventType:h,category:ye,categoryName:Oe,ageCategoryCode:we,flightNumber:w[x],drawType:O,stage:q.stage,seedingBasis:z?JSON.stringify(z):void 0,winningPersonId:ee,winningPersonOtherId:ce,winningPersonTennisId:fe,winningPersonWTNrating:he,winningPersonWTNconfidence:ge,winningPerson2Id:Ce,winningPerson2OtherId:Fe,winningPerson2TennisId:Je,winningPerson2WTNrating:st,winningPerson2WTNconfidence:xe,winningTeamId:J,positionManipulations:de,pctNoRating:G,matchUpFormat:Be,pctInitialMatchUpFormat:Ee,matchUpsCount:$,drawTieFormatName:qe,drawTieFormatDesc:Ge,tieFormatName:Ae,tieFormatDesc:ze,avgConfidence:V,avgWTN:j}})})});return{eventStructureReports:Object.values(r),structureReports:c}}function rze({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===BR))==null?void 0:e.value)==null?void 0:i.slice(1)}function aze({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var a,o;if(!Array.isArray(r))return{error:Ie,dates:r};if(!Array.isArray(n))return{error:Ie,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Cn};if(!r.every(ls))return{error:Ka};let s=ih({tournamentRecords:e,ignoreDisabled:t,dates:r});if(s.error)return s;let l=(a=s==null?void 0:s.venues)==null?void 0:a.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),c=(o=s.courts)==null?void 0:o.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),u={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Nc({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:u});return{venuesReport:l==null?void 0:l.map(p=>oze(c,p,d))}}function oze(t,e,i){let{venueId:n,courts:r,venueName:a}=e,o={};return t.forEach(s=>{var l;let c=0,u=0,d=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===s),g=(l=m&&sS({courtDate:m}).timeSlots)==null?void 0:l.reduce((v,y)=>{let{startTime:I,endTime:b}=y,D=ri(b)-ri(I);return v+D},0);g&&(d+=1),c+=g}let p=i.filter(({schedule:f})=>f.venueId===n&&wd(s,f.scheduledDate));p.forEach(({schedule:f})=>{let m=rn(f.scheduledTime),g=So(m,f.averageMinutes),v=ri(g)-ri(m);u+=v});let h=c?(u/c*100).toFixed(2):"100";o[s]={scheduledMatchUpsCount:p.length,availableCourts:d,availableMinutes:c,scheduledMinutes:u,percentUtilization:h}}),{venueId:n,venueName:a,venueReport:o}}var wye={};Ht(wye,{addMatchUpCourtOrder:()=>i5,addMatchUpEndTime:()=>r5,addMatchUpOfficial:()=>ove,addMatchUpResumeTime:()=>o5,addMatchUpScheduleItems:()=>GO,addMatchUpScheduledDate:()=>HO,addMatchUpScheduledTime:()=>$f,addMatchUpStartTime:()=>n5,addMatchUpStopTime:()=>a5,addSchedulingProfileRound:()=>y5,allocateTeamMatchUpCourts:()=>jO,assignMatchUpCourt:()=>SI,assignMatchUpVenue:()=>cS,bulkRescheduleMatchUps:()=>Mye,bulkScheduleMatchUps:()=>JC,bulkScheduleTournamentMatchUps:()=>jU,bulkUpdateCourtAssignments:()=>Dye,calculateScheduleTimes:()=>w5,clearMatchUpSchedule:()=>Nye,clearScheduledMatchUps:()=>WO,courtGridRows:()=>M4,findMatchUpFormatTiming:()=>TO,findVenue:()=>Jp,generateBookings:()=>zO,generateVirtualCourts:()=>LO,getPersonRequests:()=>Fg,getProfileRounds:()=>DO,getScheduledRoundsDetails:()=>VC,getSchedulingProfile:()=>nh,getSchedulingProfileIssues:()=>T4,matchUpScheduleChange:()=>Rye,modifyMatchUpFormatTiming:()=>j4,mutate:()=>Sye,proAutoSchedule:()=>Uye,proConflicts:()=>Cye,publicFindCourt:()=>upe,query:()=>sge,removeEventMatchUpFormatTiming:()=>_O,removeMatchUpCourtAssignment:()=>Tye,reorderUpcomingMatchUps:()=>Eye,scheduleMatchUps:()=>Pye,scheduleProfileRounds:()=>qO,setMatchUpDailyLimits:()=>Aye,setSchedulingProfile:()=>rS,toggleParticipantCheckInState:()=>$O,validateSchedulingProfile:()=>UO});var Sye={};Ht(Sye,{addMatchUpCourtOrder:()=>i5,addMatchUpEndTime:()=>r5,addMatchUpOfficial:()=>ove,addMatchUpResumeTime:()=>o5,addMatchUpScheduleItems:()=>GO,addMatchUpScheduledDate:()=>HO,addMatchUpScheduledTime:()=>$f,addMatchUpStartTime:()=>n5,addMatchUpStopTime:()=>a5,addSchedulingProfileRound:()=>y5,allocateTeamMatchUpCourts:()=>jO,assignMatchUpCourt:()=>SI,assignMatchUpVenue:()=>cS,bulkRescheduleMatchUps:()=>Mye,bulkScheduleMatchUps:()=>JC,bulkScheduleTournamentMatchUps:()=>jU,bulkUpdateCourtAssignments:()=>Dye,calculateScheduleTimes:()=>w5,clearMatchUpSchedule:()=>Nye,clearScheduledMatchUps:()=>WO,courtGridRows:()=>M4,findMatchUpFormatTiming:()=>TO,findVenue:()=>Jp,generateBookings:()=>zO,generateVirtualCourts:()=>LO,matchUpScheduleChange:()=>Rye,modifyMatchUpFormatTiming:()=>j4,proAutoSchedule:()=>Uye,proConflicts:()=>Cye,publicFindCourt:()=>upe,removeEventMatchUpFormatTiming:()=>_O,removeMatchUpCourtAssignment:()=>Tye,reorderUpcomingMatchUps:()=>Eye,scheduleMatchUps:()=>Pye,scheduleProfileRounds:()=>qO,setMatchUpDailyLimits:()=>Aye,setSchedulingProfile:()=>rS,toggleParticipantCheckInState:()=>$O,validateSchedulingProfile:()=>UO});function w5({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:a,periodLength:o,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof a!="object"||!Object.keys(a).length)return{error:Cn};o=o??FO({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=ih({dates:[s],ignoreDisabled:!0,tournamentRecords:a}),h=d==null?void 0:d.filter(E=>!c||c.includes(E.venueId));l||(l=h==null?void 0:h.reduce((E,P)=>{var M,N;let R=((N=(M=P.dateAvailability)==null?void 0:M.find(A=>!A.date||wd(s,A.date)))==null?void 0:N.startTime)??P.startTime;return R&&(!E||ri(R)<ri(E))?R:E},void 0)),u||(u=h==null?void 0:h.reduce((E,P)=>{var M,N;let R=((N=(M=P.dateAvailability)==null?void 0:M.find(A=>!A.date||wd(s,A.date)))==null?void 0:N.endTime)??P.endTime;return R&&(!E||ri(R)>ri(E))?R:E},void 0));let f=Object.values(a),m=Object.assign({},...f.map(E=>(E.events??[]).map(P=>{let{scheduleTiming:M}=pC({tournamentRecord:E,event:P});return{[P.eventId]:{event:P,scheduleTiming:M}}})).flat()),g=HC({sortDateMatchUps:!1,tournamentRecords:a,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],I=[];I.push(...v),I.push(...y);let b={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},D=I==null?void 0:I.map(({eventId:E,schedule:P,matchUpFormat:M})=>{let{event:N,scheduleTiming:R}=m[E],A=N==null?void 0:N.eventType,_={...R,defaultTiming:b,matchUpFormat:M},{averageMinutes:O,recoveryMinutes:x}=Bk({eventType:A,timingDetails:_}),{courtId:F,venueId:$}=P,V=rn(P.scheduledTime),G=So(V,O);return{recoveryMinutes:x,averageMinutes:O,periodLength:o,startTime:V,endTime:G,courtId:F,venueId:$}}),w={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:o,startTime:l,endTime:u,bookings:D,courts:h},{scheduleTimes:S}=Z4(w),U=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,C=I.map(Cr);return{venueId:U,scheduleTimes:S,dateScheduledMatchUpIds:C}}function Tye(t){var e;let i=vi(t,[{[Ta]:!0}]);if(i.error)return i;let{removePriorValues:n,tournamentRecords:r,tournamentId:a,courtDayDate:o,matchUpId:s,courtId:l,drawId:c}=t,u=r[a];if(!u)return{error:Ne};let{drawDefinition:d,event:p}=Ff({tournamentRecord:u,drawId:c});if(!d)return{error:tt};let h=an({drawDefinition:d,event:p,matchUpId:s});if(h.error)return h;if(((e=h==null?void 0:h.matchUp)==null?void 0:e.matchUpType)===gu){let{itemValue:f}=_g({timeItems:h.matchUp.timeItems??[],itemType:Np}),m=l&&f.filter(g=>g.courtId!==l);return fs({duplicateValues:!1,removePriorValues:n,tournamentRecord:u,drawDefinition:d,matchUpId:s,timeItem:{itemType:Np,itemValue:m}})}else return SI({tournamentRecord:u,drawDefinition:d,courtDayDate:o,courtId:"",matchUpId:s})}function Uye({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!el(n))return{error:Ie};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:mk};let r=HC({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:a}=r,o=[],s=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=a==null?void 0:a.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(on(y)&&(y.matchUpId&&(m.push(y.matchUpId),o.push(y)),y.sides)){let I=s(y);g.push(...I)}});let v=Object.values(f).filter(y=>on(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==wi&&(t||!Mr.includes(h))).sort(pI);let c=Xl({matchUps:n.concat(o),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),I=v&&m.some(U=>c[v].matchUpIds.includes(U)),b=v&&d.some(U=>c[v].dependentMatchUpIds.includes(U)),D=h.matchUpIds.some(U=>y.includes(U)),w=s(g),S=h.participantIds.some(U=>w.includes(U));if(g&&!D&&!I&&!S&&!b){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),u.push(g),h.participantIds.push(...w),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=JC({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function Dye(t){let{courtDayDate:e}=t,i=vi(t,[{courtAssignments:!0,[_f]:Ao,[Id]:dt},{[Ta]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((a,o)=>{let{tournamentId:s}=o;return a[s]||(a[s]=[]),a[s].push(o),a},{}),r;return Object.keys(n).every(a=>{let o=t[Ta][a];if(!o)return r={error:Ne},!1;let s=n[a].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=po({tournamentRecord:o,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=SI({tournamentRecord:o,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:yue}}),!0):(r={error:tt},!1)})}),r||re}function Pye(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:a,matchUpPotentialParticipantIds:o={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:I}=t,b=vi(t,[{[Ta]:!0,[WP]:!0},{[pc]:ls,[Id]:Ka,[TLe]:!0},{[pc]:H=>!H||!isNaN(H),[CLe]:!1,[Id]:Ie,[ELe]:!1,[MLe]:!1}]);if(b.error)return b;let D=t.competitionMatchUps??Nc({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],w=t.matchUpDependencies??Xl({includeParticipantDependencies:!0,matchUps:D,tournamentRecords:e}).matchUpDependencies;D.forEach(H=>{var K;(K=H.schedule)!=null&&K.scheduledDate&&wd(f,Lt(H.schedule.scheduledDate))&&Cw({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:H})});let S=m.map(H=>D.find(K=>K.matchUpId===H)).filter(Boolean),{venueId:U,scheduleTimes:C,dateScheduledMatchUpIds:E}=w5({tournamentRecords:e,remainingScheduleTimes:d,startTime:rn(v),endTime:rn(y),scheduleDate:Lt(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),P={},M=[],N={},R={},A={};D.filter(({matchUpId:H})=>E==null?void 0:E.includes(H)).forEach(H=>{var K;WB({matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUp:H,value:1});let q=(K=H.schedule)==null?void 0:K.scheduledTime;if(q){N[H.matchUpId]=q;let Y=a==null?void 0:a[H.matchUpId];VU({recoveryMinutes:Y||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:q,matchUp:H})}});let _=S.filter(H=>{let K=E==null?void 0:E.includes(H.matchUpId),q=[wi,mi,qn,ps,Na,Ci].includes(H==null?void 0:H.matchUpStatus);return!K&&!H.winningSide&&!q}),{matchUpMap:O,overLimitMatchUpIds:x,participantIdsAtLimit:F}=_.reduce((H,K)=>{let{drawId:q,tournamentId:Y,matchUpType:Z}=K,{participantIdsAtLimit:Q,relevantParticipantIds:ie}=m5({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,matchUpDailyLimits:c,matchUp:K});return Q!=null&&Q.length?(H.overLimitMatchUpIds.push(K.matchUpId),H.participantIdsAtLimit.push(...Q),H):(ie.forEach(ue=>{ZC({individualParticipantProfiles:s,participantId:ue});let J=s[ue].counters;J[Z]?J[Z]+=1:J[Z]=1,J[Dl]?J[Dl]+=1:J[Dl]=1}),H.matchUpMap[Y]||(H.matchUpMap[Y]={}),H.matchUpMap[Y][q]?H.matchUpMap[Y][q].push(K):H.matchUpMap[Y][q]=[K],Cw({matchUpPotentialParticipantIds:o,matchUpNotBeforeTimes:l,matchUp:K}),H)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:H})=>!x.includes(H));let $=0,V=(C==null?void 0:C.length)??0,{personRequests:G}=Fg({tournamentRecords:e,requestType:XC});for(;C!=null&&C.length&&_.length&&$<=V;){$++;let{scheduleTime:H}=C.shift(),K=_.find(q=>{let{matchUpId:Y}=q,{dependenciesScheduled:Z,remainingDependencies:Q}=p5({matchUpScheduleTimes:N,matchUpDependencies:w,allDateMatchUpIds:i,matchUp:q});if(!Z)return A[Y]||(A[Y]=[]),A[Y].push({scheduleTime:H,remainingDependencies:Q}),!1;let{enoughTime:ie}=f5({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:w,scheduleTime:H,matchUp:q});if(!ie)return R[Y]||(R[Y]=[]),R[Y].push({scheduleTime:H}),!1;let{conflicts:ue}=h5({potentials:u,averageMatchUpMinutes:n,requestConflicts:P,personRequests:G,scheduleTime:H,scheduleDate:f,matchUp:q});if(ue!=null&&ue.length)return!1;let J=a==null?void 0:a[q.matchUpId];return VU({recoveryMinutes:J||r,matchUpPotentialParticipantIds:o,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:w,scheduleTime:H,matchUp:q}),N[q.matchUpId]=H,!0});_=_.filter(({matchUpId:q})=>q!==(K==null?void 0:K.matchUpId)),K||M.push(H)}_.forEach(H=>{WB({individualParticipantProfiles:s,matchUpPotentialParticipantIds:o,value:-1,matchUp:H})});let j=[];Object.keys(O).forEach(H=>{let K=e[H];K&&Object.keys(O[H]).forEach(q=>{let{drawDefinition:Y}=Ff({tournamentRecord:K,drawId:q});Y&&O[H][q].forEach(({matchUpId:Z})=>{let Q=N[Z];if(Q){let ie=Q.split(":").map(ks).join(":"),ue=`${Lt(f)}T${ie}`;I?j.push(Z):($f({drawDefinition:Y,matchUpId:Z,scheduledTime:ue}).success&&j.push(Z),U&&cS({tournamentRecords:e,tournamentRecord:K,drawDefinition:Y,matchUpId:Z,venueId:U}))}})})});let z=y3(_);return{...re,requestConflicts:Object.values(P),remainingScheduleTimes:C==null?void 0:C.map(({scheduleTime:H})=>H),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:M,overLimitMatchUpIds:x,scheduledMatchUpIds:j,noTimeMatchUpIds:z,recoveryTimeDeferred:R,dependencyDeferred:A}}function Cye({tournamentRecords:t,matchUps:e}){if(!el(e))return{error:Nd};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:mk};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>St(h))),n=Xe(1,i+1).map(h=>e.filter(f=>{var m;return St((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},a={},o={};n.flat().filter(Boolean).sort(pI).forEach(({schedule:h})=>delete h[oM]);let s=$t(e.map(({drawId:h})=>h)),l=Xl({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:I,schedule:b,sides:D,potentialParticipants:w}=g,S=b==null?void 0:b.courtId;r[v]=f,a[S]=[],m.matchUpIds.push(v),o[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let C=(D==null?void 0:D.map(P=>{var M;return[(M=P.participant)==null?void 0:M.individualParticipantIds,P.participantId]}).flat().filter(Boolean))??[],E=(w==null?void 0:w.flat().map(({individualParticipantIds:P,participantId:M})=>[P,M]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...C),y&&m.targetMatchUpIds.push(y),I&&m.targetMatchUpIds.push(I),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!o[h].schedule[oM]){o[h].schedule[oM]=f,o[h].schedule[ope]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=o[h].schedule.courtId;a[v]||(a[v]=[]),a[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=qo(h.participantIds),I=Object.keys(y).filter(w=>y[w]>1),b=h.matchUpIds.filter(w=>l[w].participantIds.some(S=>I.includes(S)));b.forEach(w=>{v[w]||(v[w]={}),v[w][rm]||(v[w][rm]=b.filter(S=>S!==w))});let D=m&&h.participantIds.filter(w=>m.participantIds.includes(w));D&&D.forEach(w=>{let S=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(w));S.forEach(U=>{v[U]||(v[U]={}),v[U][am]||(v[U][am]=S.filter(C=>C!==U))})}),h.matchUpIds.forEach(w=>{var S,U,C,E;let P=l[w].matchUpIds;for(let N of g){let R=N.matchUpIds.filter(A=>P.includes(A));R!=null&&R.length&&(R.forEach(A=>p(A,mB,Th,[w])),p(w,mB,Th,R))}if((S=v[w])!=null&&S[rm]&&p(w,rm,fB,v[w][rm]),h.sourceMatchUpIds.includes(w)){let N=h.matchUpIds.filter(R=>l[R].matchUpIds.includes(w));p(w,rm,Th,N),h.matchUpIds.filter(R=>l[R].matchUpIds.includes(w)).forEach(R=>p(R,rm,Th,[w]))}let M=(U=m==null?void 0:m.matchUpIds)==null?void 0:U.filter(N=>u(w,N)>1);if(M!=null&&M.length&&(p(w,gB,Th,M),M.forEach(N=>p(N,gB,Th,[w]))),(C=v[w])!=null&&C[am]&&p(w,am,fB,v[w][am]),(E=m==null?void 0:m.targetMatchUpIds)==null?void 0:E.includes(w)){let N=o[w].schedule.courtId,R=P.filter(A=>m.matchUpIds.includes(A));R.some(A=>o[A].schedule.courtId===N)||(R.forEach(A=>p(A,am,Th,[w])),p(w,am,Th,R))}})}),{courtIssues:a,rowIssues:d}}function Eye(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return oe({result:{error:Cn},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return oe({result:{error:dt},stack:e});let a=n==null?void 0:n.length;if(!a)return{...re};let o=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=a-1),h===a&&(h=0);let f=n[h].schedule.scheduledTime,m=s({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)o++;else return m}),o===a?re:oe({result:{error:vue},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=Ff({tournamentRecord:p,drawId:d});return h?$f({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:zo}}}function Mye(t){var e,i;let{scheduleChange:n,matchUpIds:r,dryRun:a}=t;if(!r||!Array.isArray(r))return{error:_0};if(typeof n!="object")return{error:Ie};let o=Eu(t),s=[],l=[];for(let u of Object.values(o)){let d=sze({tournamentRecord:u,scheduleChange:n,matchUpIds:r,dryRun:a});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);let p=y3(d.notRescheduled),h=[];(e=d.rescheduled)==null||e.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),s.push(f)}),h.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:f})=>!h.includes(f)))||[])}let c=!!(s.length&&!l.length);return{...re,rescheduled:s,notRescheduled:l,allRescheduled:c}}function sze({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var r;if(!t)return{error:Ne};if(!i||!Array.isArray(i))return{error:_0};if(typeof e!="object")return{error:Ie};let a=[],o=[],{minutesChange:s,daysChange:l}=e;if(!s&&!l)return{...re};if(s&&isNaN(s))return{error:Ie};if(l&&isNaN(l))return{error:Ie};let{matchUps:c}=Hr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),u=({matchUpStatus:D})=>!Mr.includes(D),d=c==null?void 0:c.filter(D=>GC({schedule:D.schedule})).filter(D=>u({matchUpStatus:D.matchUpStatus}));if(!(d!=null&&d.length))return{...re};let{tournamentInfo:p}=bI({tournamentRecord:t}),{startDate:h,endDate:f}=p,m=d==null?void 0:d.reduce((D,w)=>{let{matchUpId:S,drawId:U}=w;return D[U]?D[U].push(S):D[U]=[S],D},{}),g=1440;for(let D of Object.keys(m)){let w=Ff({tournamentRecord:t,drawId:D});if(w.error)return w;let S=w.drawDefinition,U=m[D].filter(C=>i.includes(C));for(let C of U)if(C&&S){let E=(r=d.find(_=>_.matchUpId===C))==null?void 0:r.schedule,{scheduledTime:P,scheduledDate:M}=E,N,R,A;if(!N&&l&&M){let _=Lt(M);A=qS(_,l),N=new Date(A)<new Date(h)||new Date(A)>new Date(f)}if(s&&P){let _=Lt(P),O=ri(rn(P))+s;if(N=O<0||O>g,!N){let x=So(P,s),F=_&&A||M===_&&_;R=F?`${F}T${x}`:x}}if(N)o.push(C);else{if(!n){if(R){let _=$f({scheduledTime:R,drawDefinition:S,matchUpId:C});if(_.error)return _}if(A){let _=HO({scheduledDate:A,drawDefinition:S,matchUpId:C});if(_.error)return _}}(R||A)&&a.push(C)}}}let v=Hr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],y=v.filter(({matchUpId:D})=>a.includes(D)),I=v.filter(({matchUpId:D})=>o.includes(D)),b=y.length&&!I.length;return{...re,rescheduled:y,notRescheduled:I,allRescheduled:b}}function Rye(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Cn};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:a,targetCourtId:o,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return oe({result:{error:dt},stack:e});let{matchUps:f}=Nc({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:b})=>b===c),g=f==null?void 0:f.find(({matchUpId:b})=>b===p),v=0;if(o&&c&&!p){let b=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return oe({result:b,stack:e})}else if(a&&o&&c&&p){let b=y({tournamentId:u,matchUpId:c,courtId:o,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:a,courtDayDate:s});if(b.success&&v++,b.error)return oe({result:b,stack:e,info:"source"});let D=y({tournamentId:h,sourceCourtId:o,matchUpId:p,matchUp:g,courtId:a,drawId:d,tournamentRecords:i,courtDayDate:s});if(D.success&&v++,D.error)return oe({result:D,stack:e,info:"target"})}else return{error:dt};return v?re:oe({result:{error:L0},stack:e});function y(b){let{tournamentRecords:D,tournamentId:w,matchUp:S,drawId:U}=b,C=D[w],{drawDefinition:E}=Ff({tournamentRecord:C,drawId:U});return S.matchUpType===Yi?I({...b,tournamentRecord:C,drawDefinition:E}):SI({...b,tournamentRecord:C,drawDefinition:E})}function I({removePriorValues:b,tournamentRecords:D,tournamentRecord:w,drawDefinition:S,sourceCourtId:U,courtDayDate:C,matchUpId:E,matchUp:P,courtId:M}){let N=[M].concat(P.schedule.allocatedCourts.map(({courtId:R})=>R).filter(R=>R!==U));return jO({removePriorValues:b,tournamentRecords:D,tournamentRecord:w,drawDefinition:S,courtDayDate:C,matchUpId:E,courtIds:N})}}function Nye({scheduleAttributes:t=[Np,qm,K0,Y0,Z0,fc,Ap,ed,ap],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var r,a;let o="clearMatchUpSchedule",s=i?(r=ro({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:r[0]:(a=Hr({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:a[0];if(!s)return{error:wa};let l=(s.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return s.timeItems=l,si({tournamentId:e.tournamentId,context:o,drawDefinition:i,matchUp:s}),{...re}}function Aye(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Cn};if(typeof n!="object")return{error:Kp};let a=Object.keys(r).filter(o=>!i||i===o);if(i&&!a.includes(i))return{error:Ie};for(let o of a){let s=r[o],l=ui({element:s,extension:{name:ZP,value:{dailyLimits:n}}});if(l.error)return l}return{...re}}var _ye={};Ht(_ye,{addCollectionDefinition:()=>U5,addCollectionGroup:()=>$ye,aggregateTieFormats:()=>Vye,compareTieFormats:()=>_p,getTieFormat:()=>b4,modifyCollectionDefinition:()=>S5,modifyTieFormat:()=>Bye,mutate:()=>kye,orderCollectionDefinitions:()=>Lye,query:()=>tge,removeCollectionDefinition:()=>T5,removeCollectionGroup:()=>xye,tieFormatGenderValidityCheck:()=>eO,validateCollectionDefinition:()=>kC});var kye={};Ht(kye,{addCollectionDefinition:()=>U5,addCollectionGroup:()=>$ye,aggregateTieFormats:()=>Vye,modifyCollectionDefinition:()=>S5,modifyTieFormat:()=>Bye,orderCollectionDefinitions:()=>Lye,removeCollectionDefinition:()=>T5,removeCollectionGroup:()=>xye});function eg({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:a,event:o}){var s;let l="getTieFormat",c;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:tt};if(a&&o)c=Ph(o);else if(i){if(t&&(!r||!n)){let u=an({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((s=u.matchUp)==null?void 0:s.matchUpType)!==gu)return oe({result:{error:uo},stack:l});n||(n=u.structure),r||(r=u.matchUp)}c=yT({item:r,drawDefinition:t,structure:n,event:o})||yT({item:n,drawDefinition:t,structure:n,event:o})||Ph(t)||Ph(o)}else if(t&&e){if(!n){let u=Dt({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}c=yT({item:n,drawDefinition:t,structure:n,event:o})||Ph(t)||Ph(o)}else c=Ph(t)||Ph(o);return c?{...re,structure:n,tieFormat:c,matchUp:r}:oe({result:{error:VP},stack:l})}function pN({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Mr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==ql&&!zr(t))}function _L({from:t,to:e}){let i=Object.keys(t),n=Ln(i,Object.keys(e)).length===i.length,r=i.filter(o=>t[o]!==e[o]).map(o=>({countChange:e[o]-t[o],collectionId:o})),a=i.every(o=>t[o]===e[o]);return{equivalent:n&&a,matchUpsCountChanges:r}}function lze({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:a,matchUp:o,event:s,uuids:l}){var c,u,d,p;let h="updateTieFormat",f=e==null?void 0:e.tournamentId,m=0,g=0,v=0,y=0,I=r==null?void 0:r.collectionDefinitions.reduce((E,P)=>(E[P.collectionId]=(E[P.collectionId]||0)+P.matchUpCount,E),{}),b=({tieFormat:E})=>{let P=E==null?void 0:E.collectionDefinitions.reduce((M,N)=>(M[N.collectionId]=(M[N.collectionId]||0)+N.matchUpCount,M),{});return _L({from:P,to:I}).equivalent},D=(c=eg({drawDefinition:i}))==null?void 0:c.tieFormat,w=(u=eg({event:s}))==null?void 0:u.tieFormat;if(s&&a){for(let E of s.drawDefinitions??[])S({drawDefinition:E});s.tieFormat=Jr(r),y+=1}else if(o){if(!o.tieMatchUps)return oe({result:{error:uo},stack:h});let E=qo((d=o.tieMatchUps)==null?void 0:d.map(({collectionId:A})=>A)),P=_L({to:I,from:E}),{changes:M,changesArePossible:N,cannotChangeReaon:R}=i8({matchUp:o,check:P});if(P.equivalent)if(pN({matchUp:o,updateInProgressMatchUps:t}))o.tieFormat=Jr(r),y+=1;else return oe({result:{error:OW},info:"matchUp is IN_PROGRESS or COMPLETE",stack:h});else if(N)C({tieFormat:r,matchUp:o,changes:M,uuids:l});else return oe({context:{collectionMap:I,matchUpMap:E},result:{error:qd},info:R||"specified changes not possible",stack:h});g+=1,si({eventId:s==null?void 0:s.eventId,context:h,drawDefinition:i,tournamentId:f,matchUp:o})}else if(n){let E=(p=U({inheritedTieFormat:D??w,structure:n}))==null?void 0:p.modifiedMatchUpsCount;E&&(g+=E,m+=1,y+=1);let P=!n.tieFormat||_p({ancestor:n.tieFormat,descendant:r}).different;P&&(n.tieFormat=Jr(r),m+=1,y+=1),(E||P)&&i&&Ji({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)S({drawDefinition:i}),i.tieFormat=Jr(r),y+=1;else return{error:tt};return{modifiedStructuresCount:m,modifiedMatchUpsCount:g,addedMatchUpsCount:v,modifiedCount:y,...re,tieFormat:r};function S({drawDefinition:E}){var P;let M=E.structures||[],N=[];for(let R of M){if(R.tieFormat)continue;let A=(P=U({inheritedTieFormat:w,structure:R}))==null?void 0:P.modifiedMatchUpsCount;if(A){m+=1,g+=A;let _=R.structureId;N.push(_)}}return Ji({structureIds:N,eventId:s==null?void 0:s.eventId,drawDefinition:E}),N.length}function U({inheritedTieFormat:E,structure:P}){var M,N;let R=0,A=((M=Ui({matchUpFilters:{matchUpTypes:[Yi]},structure:P}))==null?void 0:M.matchUps)||[];for(let _ of A){let O=pN({matchUp:_,updateInProgressMatchUps:t}),x=!1,F=qo((N=_.tieMatchUps)==null?void 0:N.map(({collectionId:V})=>V)),$=_L({from:F,to:I});if($.equivalent)_.tieFormat&&b(_)&&O&&(_.tieFormat=Jr(r),x=!0);else{let{changes:V,changesArePossible:G}=i8({matchUp:_,check:$});if(G&&!_.tieFormat)C({changes:V,matchUp:_,tieFormat:r,uuids:l});else if(E)(!_.tieFormat||_p({ancestor:E,descendant:_.tieFormat}).different)&&(_.tieFormat=E,x=!0);else return oe({result:{error:VP},stack:h})}x&&(R+=1,si({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:h,eventId:a,matchUp:_}))}return{modifiedMatchUpsCount:R}}function C({uuids:E,matchUp:P,tieFormat:M,changes:N}){P.tieFormat=Jr(M);let R=[],A=[];return N.forEach(_=>{if(_.countChange>0){let O=Math.max(0,...P.tieMatchUps.filter($=>$.collectionId===_.collectionId).map(Ko("collectionPosition"))),x=M.collectionDefinitions.find($=>$.collectionId===_.collectionId),F=NC({matchUpsLimit:_.countChange,collectionPositionOffset:O,collectionDefinition:x,matchUp:P,uuids:E});A.push(...ot(F,!1,!0)),v+=A.length,P.tieMatchUps.push(...F)}else{let O=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",O.length),R.push(...O),P.tieMatchUps=P.tieMatchUps.filter(({matchUpId:x})=>!O.includes(x))}}),A.length&&rf({matchUps:A,drawDefinition:i,tournamentId:f,eventId:a}),R.length&&Zp({matchUpIds:R,action:"updateTieFormat",drawDefinition:i,tournamentId:f,eventId:a}),{matchUpIdsRemoved:R,matchUpsAdded:A}}}function i8({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:a})=>{let o=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Fn).map(Ko("matchUpId")),s=o.length+a>=0||a>0;return!s&&a<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:o,collectionId:r,countChange:a}),s}),changes:n,cannotChangeReaon:i}}function ZO({drawDefinition:t,auditData:e}){let{extension:i}=jt({name:ly,element:t}),n={name:ly,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]};ui({element:t,extension:n})}function S5({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:a,matchUpFormat:o,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b}){var D;let w="modifyCollectionDefinition";if(o&&!Zo({matchUpFormat:o}))return oe({result:{error:Ie},context:{matchUpFormat:o},stack:w});if(n&&typeof n!="string")return oe({result:{error:Ie},context:{collectionName:n},stack:w});if(f&&!Object.values(tq).includes(f))return oe({result:{error:Ie},context:{gender:f},stack:w});if(p&&typeof p!="object")return oe({result:{error:Ie},context:{category:p},stack:w});let S={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:I,setValue:b};if(!Object.values(S).filter(Boolean).length&&!i&&!n&&!o&&!s&&!c)return oe({result:{error:dt},stack:w});if(Object.values(S).filter(Boolean).length>1)return oe({info:"Only one value assignment allowed per collectionDefinition",result:{error:Ie},stack:w});let U=eg({drawDefinition:a,structureId:u,matchUpId:d,eventId:h,event:m});if(U.error)return oe({result:U,stack:w});let{matchUp:C,structure:E,tieFormat:P}=U,M=Jr(P),N=P==null?void 0:P.collectionDefinitions.find(z=>z.collectionId===l),R=M==null?void 0:M.collectionDefinitions.find(z=>z.collectionId===l);if(!N)return oe({info:"source collectionDefinition",result:{error:Sa},context:{collectionId:l},stack:w});let A=v??y??I??b;if(g){let z=_he({matchUpCount:s??(N==null?void 0:N.matchUpCount)??0,collectionValueProfiles:g});if(z.errors)return oe({result:{error:Ie},info:z.errors,stack:w})}else if(A&&!Rt(A))return oe({result:{error:Ie},info:"value is not an integer",context:{value:A},stack:w});let _=(z,H)=>Ln(Object.keys(z),Object.keys(H)).length===Object.keys(z).length&&Ln(Object.values(z),Object.values(H)).length===Object.values(z).length,O=g&&(!N.collectionValueProfiles||!_(N.collectionValueProfiles,g)),x=Rt(v)&&N.collectionValue!==v||Rt(y)&&N.matchUpValue!==y||Rt(I)&&N.scoreValue!==I||Rt(b)&&N.setValue!==b||O,F=[];if(x&&(R.collectionValueProfiles=void 0,R.collectionValue=void 0,R.matchUpValue=void 0,R.scoreValue=void 0,R.setValue=void 0,Object.assign(R,S),F.push({collectionId:l,...ft(S)})),(Rt(I)||Rt(b))&&R.collectionGroupNumber){let z=R.collectionGroupNumber;M.collectionDefinitions=M.collectionDefinitions.map(H=>{let{collectionGroupNumber:K,...q}=H;return K===z?q:H}),M.collectionGroups=M.collectionGroups.filter(({groupNumber:H})=>H!==z),F.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:$,valueGoal:V}=wI(M),G=ft({aggregateValue:$,valueGoal:V});if((G.aggregateValue!==(P==null?void 0:P.winCriteria.aggregateValue)||G.valueGoal!==(P==null?void 0:P.winCriteria.valueGoal))&&(M.winCriteria=G,F.push({collectionId:l,winCriteria:G})),Rt(i)&&N.collectionOrder!==i&&(R.collectionOrder=i,F.push({collectionId:l,collectionOrder:i})),n&&N.collectionName!==n&&(R.collectionName=n,F.push({collectionId:l,collectionName:n})),o&&N.matchUpFormat!==o&&(R.matchUpFormat=o,F.push({collectionId:l,matchUpFormat:o})),Rt(s)&&N.matchUpCount!==s&&(R.matchUpCount=s,F.push({collectionId:l,matchUpCount:s})),c&&N.matchUpType!==c)return oe({result:{error:yk},context:{matchUpType:c},stack:w});p&&N.category!==p&&(R.category=p,F.push({collectionId:l,category:p})),f&&N.gender!==f&&(R.gender=f,F.push({collectionId:l,gender:f}));let j=ft(M);if(U=Po({tieFormat:j}),U.error)return oe({result:U,stack:w});if(!F.length)return oe({result:{...re,modifications:F}});if((P==null?void 0:P.tieFormatName)!==r?(j.tieFormatName=r,F.push({tieFormatName:r})):F.length&&(delete j.tieFormatName,F.push("tieFormatName removed: modifications without new tieFormatName")),U=lze({tieFormat:j,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:a,structure:E,eventId:h,matchUp:C,event:m}),!U.error){let{appliedPolicies:z}=Mi({tournamentRecord:e});if((D=z==null?void 0:z.audit)!=null&&D[ly]){let H=ft({collectionDefinition:R,drawId:a==null?void 0:a.drawId,action:w,structureId:u,matchUpId:d,eventId:h});ZO({drawDefinition:a,auditData:H})}}return oe({result:{...U,modifications:F},stack:w})}function cze({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:a}){var o,s;let l=[];return r&&a?l=[a]:i&&n?l=((o=Ui({matchUpFilters:{matchUpTypes:[Yi]},structure:n}))==null?void 0:o.matchUps)??[]:e&&(l=((s=ro({matchUpFilters:{matchUpTypes:[Yi]},drawDefinition:e}))==null?void 0:s.matchUps)??[]),{targetMatchUps:l.filter(c=>!c.winningSide&&c.matchUpStatus!==qn&&(t||c.matchUpStatus!==ql&&!zr(c)))}}function uze({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:a}){for(let o of n){let s=!!o.tieFormat;s&&(o.tieFormat=Jr(r));let l;if(t){let c=Mi({tournamentRecord:e,drawDefinition:i,event:a}).appliedPolicies,u=th({matchUpId:o.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:a});if(u.error)return u;l=u.score}s&&!l&&si({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:a==null?void 0:a.eventId,matchUp:o,drawDefinition:i})}return{...re}}function Oye({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:a,structureId:o,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=wI(l);l.winCriteria=ft({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=cze({updateInProgressMatchUps:t,drawDefinition:a,structureId:o,structure:s,matchUpId:c,matchUp:u});uze({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:a,tieFormat:l,event:p});let g=ft(l),v=Po({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(a)a.tieFormat=g;else if(!u||!a)return{error:tt};return Ji({drawDefinition:a,eventId:p==null?void 0:p.eventId}),{...re}}function xye({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,matchUpId:o,matchUp:s,eventId:l,event:c}){var u;if(!e)return{error:dt};if(isNaN(e))return{error:Ie};let d="removeCollectionGroup",p=s?void 0:eg({drawDefinition:n,structureId:a,matchUpId:o,eventId:l,event:c});if(p!=null&&p.error)return oe({result:p,stack:d});let h=p==null?void 0:p.structure;s=s??(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=f==null?void 0:f.winCriteria.aggregateValue,v=Jr(f);if(p=Po({tieFormat:v}),p.error)return oe({result:p,stack:d});let y=[];if(v.collectionDefinitions=v.collectionDefinitions.map(I=>{let{collectionGroupNumber:b,...D}=I;return b!==e?I:(y.push(I.collectionId),D)}),v.collectionGroups=v.collectionGroups.filter(({groupNumber:I})=>I!==e),p=Oye({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:g,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:a,structure:h,tieFormat:v,matchUpId:o,matchUp:s,eventId:l,event:c}),!p.error){let{appliedPolicies:I}=Mi({tournamentRecord:i});if((u=I==null?void 0:I.audit)!=null&&u[ly]){let b=ft({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:d,structureId:a,matchUpId:o,eventId:l});ZO({drawDefinition:n,auditData:b})}}return oe({result:{...p,modifiedCollectionIds:y},stack:d})}function Ew({tieFormat:t,orderMap:e}){let i=Jr(t);return i.collectionDefinitions.forEach(n=>{let r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions.sort((n,r)=>cw(n.collectionOrder)-cw(r.collectionOrder)),i}function Lye({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:a,matchUp:o,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>Rt(l)))return oe({result:{error:Ie},context:{orderMap:r}});if(a&&s!=null&&s.tieFormat)n8({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&an({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(o=l.matchUp,!o)return{error:Do};o!=null&&o.tieFormat&&(o.tieFormat=Ew({tieFormat:o.tieFormat,orderMap:r}),si({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:o}))}else if(i){let l=Dt({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=Ew({tieFormat:c.tieFormat,orderMap:r}),Fye({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),Ji({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)YB({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)n8({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:Sa}}else if(e!=null&&e.tieFormat)YB({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:Sa};return{...re}}function n8({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=Ew({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let a of n.drawDefinitions??[])YB({tournamentRecord:t,drawDefinition:a,structureIds:e,orderMap:i,event:n})}function YB({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let a=e.tieFormat??(r==null?void 0:r.tieFormat),o=Ew({tieFormat:a,orderMap:n});i!=null&&i.length||(e.tieFormat=o);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=Ew({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),Fye({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));Ji({drawDefinition:e,structureIds:s})}function Fye({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var a;let o=(a=Ui({matchUpFilters:{matchUpTypes:[Yi]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=Ew({tieFormat:s.tieFormat,orderMap:n}),si({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function T5({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:a,structureId:o,matchUpId:s,eventId:l,matchUp:c,event:u}){var d,p,h,f,m,g;let v="removeCollectionDefinition",y=c?void 0:eg({drawDefinition:n,structureId:o,matchUpId:s,eventId:l,event:u});if(y!=null&&y.error)return oe({result:y,stack:v});let I=y==null?void 0:y.structure;c=c??(y==null?void 0:y.matchUp);let b=y==null?void 0:y.tieFormat,D=Jr(b);if(y=Po({tieFormat:D}),y.error)return oe({result:y,stack:v});let w=(d=D==null?void 0:D.collectionDefinitions)==null?void 0:d.find(_=>_.collectionId===a);if(!w)return oe({result:{error:Sa,collectionId:a}});D.collectionDefinitions=D.collectionDefinitions.filter(_=>_.collectionId!==a),w.collectionGroupNumber&&(D.collectionDefinitions=D.collectionDefinitions.map(_=>{let{collectionGroupNumber:O,...x}=_;return x}),D.collectionGroups=D.collectionGroups.filter(({groupNumber:_})=>_!==w.collectionGroupNumber));let{aggregateValue:S,valueGoal:U}=wI(D);D.winCriteria=ft({aggregateValue:S,valueGoal:U});let C=b==null?void 0:b.winCriteria.valueGoal,E=b==null?void 0:b.winCriteria.aggregateValue;(C&&C!==U||S&&!E)&&(r?D.tieFormatName=r:delete D.tieFormatName);let P=[];s&&c?P=[c]:o&&I?P=((p=Ui({matchUpFilters:{matchUpTypes:[Yi]},structure:I}))==null?void 0:p.matchUps)??[]:n?P=((h=ro({matchUpFilters:{matchUpTypes:[Yi]},drawDefinition:n}))==null?void 0:h.matchUps)??[]:u&&(P=((f=eh({matchUpFilters:{matchUpTypes:[Yi]},drawDefinition:n}))==null?void 0:f.matchUps)??[]);let M=(P||[]).filter(_=>{var O,x,F;let $=(x=(O=_.tieMatchUps)==null?void 0:O.filter(G=>G.collectionId===a))==null?void 0:x.some(zr),V=e&&_.tieFormat?(F=_p({descendant:_.tieFormat,ancestor:D}))==null?void 0:F.different:!1;return t&&!$||!_.winningSide&&_.matchUpStatus!==qn&&(t||_.matchUpStatus!==ql&&!zr(_)&&!V)});if(!M.length)return{error:L0};let{appliedPolicies:N}=Mi({tournamentRecord:i});if(s&&c&&t){let _=(m=c.tieMatchUps)==null?void 0:m.filter(O=>O.collectionId===a);for(let O of _??[]){let x=KC({matchUpId:O.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:u});if(x.error||(x=an({drawDefinition:n,matchUpId:s}),x.error))return x;c=x==null?void 0:x.matchUp}}let R=[];for(let _ of M){for(let O of(_==null?void 0:_.sides)??[])O.lineUp=(O.lineUp??[]).map(x=>({participantId:x.participantId,collectionAssignments:((x==null?void 0:x.collectionAssignments)??[]).filter(F=>F.collectionId!==a)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(O=>{let x=O.collectionId===a;return x&&R.push(O.matchUpId),!x}),_.tieFormat&&(_.tieFormat=Jr(D)),t){let O=th({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:N,drawDefinition:n,event:u});if(O.error)return O}si({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:v,matchUp:_})}R.length&&Zp({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:R,eventId:u==null?void 0:u.eventId,drawDefinition:n});let A=ft(D);if(y=Po({tieFormat:A}),y.error)return oe({result:y,stack:v});if(l&&u)u.tieFormat=A;else if(s&&c)c.tieFormat=A;else if(I)I.tieFormat=A;else if(n)n.tieFormat=A;else if(!c||!n)return{error:tt};if(Ji({drawDefinition:n,eventId:u==null?void 0:u.eventId}),(g=N==null?void 0:N.audit)==null?void 0:g[ly]){let _=ft({drawId:n==null?void 0:n.drawId,action:v,collectionId:a,structureId:o,matchUpId:s,eventId:l});ZO({drawDefinition:n,auditData:_})}return{tieFormat:A,deletedMatchUpIds:R,targetMatchUps:M,...re}}function $ye({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:a,structureId:o,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return oe({result:{error:dt},stack:d});let p=l?void 0:eg({drawDefinition:n,structureId:o,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return oe({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=Jr(f);if(p=Po({tieFormat:g}),p.error)return oe({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:I,collectionGroupNumber:b}=y;if(b&&r.includes(I))return oe({info:"collectionIds cannot be part of other collectionGroups",result:{error:Ie},stack:d})}let v=(g.collectionGroups||[]).reduce((y,I)=>I.groupNumber>y?I.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],Oye({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:a,structureId:o,structure:h,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function U5({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:a,referenceGender:o,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var g,v,y;let I="addCollectionDefinition",b=Mi({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},D=(r==null?void 0:r[Or])??(b==null?void 0:b[Or]);a=a??((g=D==null?void 0:D.participants)==null?void 0:g.enforceCategory);let w=(c??((v=D==null?void 0:D.participants)==null?void 0:v.enforceGender))!==!1,S=!!((i??(m==null?void 0:m.category))&&a!==!1),U=!!((o??(m==null?void 0:m.gender))&&w),C=kC({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:o,checkCategory:S,checkGender:U,event:m});if(C.error)return oe({result:C,stack:I});let E=p!=null&&p.tieFormat?void 0:eg({drawDefinition:s,structureId:u,matchUpId:d,eventId:h,event:m});if(E!=null&&E.error)return oe({result:{error:E.error},stack:I});let P=E==null?void 0:E.structure;p=p??(E==null?void 0:E.matchUp);let M=(p==null?void 0:p.tieFormat)??(E==null?void 0:E.tieFormat),N=Jr(M);if(E=Po({tieFormat:N}),E==null?void 0:E.error)return oe({result:{error:E.error},stack:I});if(!e.collectionId)e.collectionId=xi();else if(N.collectionDefinitions.map(({collectionId:G})=>G).includes(e.collectionId))return oe({context:{collectionId:e.collectionId},result:{error:wue}});N.collectionDefinitions.push(e),N.collectionDefinitions.sort((G,j)=>(G.collectionOrder||0)-(j.collectionOrder||0)).forEach((G,j)=>G.collectionOrder=j+1);let{aggregateValue:R,valueGoal:A}=wI(N);N.winCriteria=ft({aggregateValue:R,valueGoal:A});let _=M==null?void 0:M.winCriteria.valueGoal,O=M==null?void 0:M.winCriteria.aggregateValue;(_&&_!==A||R&&!O)&&(l?N.tieFormatName=l:delete N.tieFormatName);let x=[],F=[],$=[],V=ft(N);if(E=Po({tieFormat:V}),E==null?void 0:E.error)return oe({result:{error:E.error},stack:I});if(h&&m){m.tieFormat=V;for(let G of m.drawDefinitions??[])if(!G.tieFormat)for(let j of G.structures??[]){if(j.tieFormat)continue;let z=kL({updateInProgressMatchUps:t,collectionDefinition:e,structure:j,uuids:f});F.push(...z.newMatchUps),$.push(...z.targetMatchUps),x.push(j.structureId)}KE({modifiedMatchUps:$,eventId:m==null?void 0:m.eventId,modifiedStructureIds:x,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:I})}else if(u&&P){P.tieFormat=V;let G=kL({updateInProgressMatchUps:t,collectionDefinition:e,structure:P,uuids:f});F.push(...G.newMatchUps),$=G.targetMatchUps,KE({modifiedMatchUps:$,eventId:m==null?void 0:m.eventId,modifiedStructureIds:x,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:I})}else if(d&&p){if(!pN({matchUp:p,updateInProgressMatchUps:t}))return oe({result:{error:OW},stack:I});p.tieFormat=V;let G=NC({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...G),F.push(...G),KE({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:x,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:I})}else if(s){s.tieFormat=V;for(let G of s.structures??[]){let j=kL({updateInProgressMatchUps:t,collectionDefinition:e,structure:G,uuids:f});x.push(G.structureId),F.push(...j.newMatchUps),$.push(...j.targetMatchUps)}KE({modifiedMatchUps:$,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:I})}else return{error:tt};if((y=b==null?void 0:b.audit)!=null&&y[ly]){let G=ft({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:I,structureId:u,matchUpId:d,eventId:h});ZO({drawDefinition:s,auditData:G})}return{tieFormat:V,targetMatchUps:$,addedMatchUps:F,...re}}function kL({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var r;let a=[],o=((r=Ui({matchUpFilters:{matchUpTypes:[Yi]},structure:i}))==null?void 0:r.matchUps).filter(s=>pN({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=NC({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),a.push(...l)}return{newMatchUps:a,targetMatchUps:o}}function KE({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:a,stack:o}){rf({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:a}),i==null||i.forEach(s=>{si({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:o,matchUp:s,eventId:a})}),Ji({structureIds:t,drawDefinition:n,eventId:a})}function Bye({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,uuids:l,event:c}){let u="modifyTieFormat";if(!Po({tieFormat:i}).valid)return oe({result:{error:qd},info:"falied validation",stack:u});let d=eg({drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:c});if(d.error)return oe({result:d,stack:u});let{matchUp:p,tieFormat:h}=d,f=Jr(h),m=_p({descendant:i,ancestor:f});if(m.invalid)return oe({context:{invalid:m.invalid},result:{error:qd},stack:u});if(!(m!=null&&m.different))return oe({result:{...re},info:"Nothing to do",stack:u});let g=f.collectionDefinitions.map(({collectionId:U})=>U),v=i.collectionDefinitions.map(({collectionId:U})=>U),y=g.filter(U=>!v.includes(U)),I=i.collectionDefinitions.filter(({collectionId:U})=>!g.includes(U)),b=I.map(Ko("collectionId")),D=[],w,S=i.tieFormatName;for(let U of i.collectionDefinitions){if(b.includes(U.collectionId))continue;let C=S5({updateInProgressMatchUps:t,...U,tournamentRecord:n,tieFormatName:S,drawDefinition:r,structureId:a,matchUpId:o,eventId:s,event:c});if(C.modifications&&D.push(...C.modifications),C.error)return oe({result:C,stack:u});C.tieFormat&&(w=C.tieFormat)}for(let U of I){let C=U5({updateInProgressMatchUps:t,collectionDefinition:U,tournamentRecord:n,drawDefinition:r,tieFormatName:S,structureId:a,matchUpId:o,matchUp:p,eventId:s,uuids:l,event:c});if(C.error)return oe({result:C,stack:u});C.tieFormat&&(w=C.tieFormat)}for(let U of y){let C=T5({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:r,tieFormatName:S,collectionId:U,structureId:a,matchUpId:o,eventId:s,matchUp:p,event:c});if(C.error)return oe({result:C,stack:u});C.tieFormat&&(w=C.tieFormat)}return(h==null?void 0:h.tieFormatName)!==S?(w.tieFormatName=S,D.push({tieFormatName:S})):(D.length||b.length||y.length)&&(delete w.tieFormatName,D.push("tieFormatName removed: modifications without new tieFormatName")),w.collectionDefinitions=w.collectionDefinitions.sort((U,C)=>cw(U.collectionOrder)-cw(C.collectionOrder)).map((U,C)=>({...U,collectionOrder:C+1})),{processedTieFormat:Jr(w),modifications:D,...re}}function Vye({tournamentRecord:t}){if(!t)return{error:Ne};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)_p({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=ot(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=xi()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},a=i.eventType;r({tieFormat:i.tieFormat,eventType:a});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:a});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:a})}let o=(u,d)=>{var p;let h=(p=l.matchUps)==null?void 0:p.find(f=>f.matchUpId===u);h&&(h.tieFormatId=d,delete h.tieFormat,si({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:h}))},s=u=>{let d=ot(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=xi()),n.push(d),e+=1,o(u.matchUpId,d.tieFormatId)},l=eh({matchUpFilters:{matchUpTypes:[gu]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&_p({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?o(u.matchUpId,d):s(u)}n.length&&(i.tieFormats=n)}return{...re,addedCount:e}}var jye={};Ht(jye,{addDrawDefinitionExtension:()=>Dk,addEventExtension:()=>Of,addEventTimeItem:()=>yI,addExtension:()=>ui,addNotes:()=>Jk,addOnlineResource:()=>Wye,addParticipantExtension:()=>rde,addParticipantTimeItem:()=>Tq,addTimeItem:()=>Lf,addTournamentExtension:()=>f3,addTournamentTimeItem:()=>vI,analyzeDraws:()=>LC,analyzeTournament:()=>y4,getAllowedDrawTypes:()=>yO,getAllowedMatchUpFormats:()=>m4,getAppliedPolicies:()=>Mi,getCompetitionDateRange:()=>bO,getCompetitionPenalties:()=>g4,getPolicyDefinitions:()=>Xp,getTournamentInfo:()=>bI,getTournamentPenalties:()=>IO,getTournamentPersons:()=>v4,getTournamentStructures:()=>wq,getTournamentTimeItem:()=>vC,mutate:()=>Gye,query:()=>Qme,removeDrawDefinitionExtension:()=>ade,removeEventExtension:()=>Pk,removeExtension:()=>Va,removeNotes:()=>Nhe,removeParticipantExtension:()=>ode,removeTournamentExtension:()=>m3,setTournamentCategories:()=>Yye,setTournamentDates:()=>XO,setTournamentEndDate:()=>Xye,setTournamentName:()=>qye,setTournamentNotes:()=>Kye,setTournamentStartDate:()=>Zye,setTournamentStatus:()=>zye});var Gye={};Ht(Gye,{addDrawDefinitionExtension:()=>Dk,addEventExtension:()=>Of,addEventTimeItem:()=>yI,addExtension:()=>ui,addNotes:()=>Jk,addOnlineResource:()=>Wye,addParticipantExtension:()=>rde,addParticipantTimeItem:()=>Tq,addTimeItem:()=>Lf,addTournamentExtension:()=>f3,addTournamentTimeItem:()=>vI,removeDrawDefinitionExtension:()=>ade,removeEventExtension:()=>Pk,removeExtension:()=>Va,removeNotes:()=>Nhe,removeParticipantExtension:()=>ode,removeTournamentExtension:()=>m3,setTournamentCategories:()=>Yye,setTournamentDates:()=>XO,setTournamentEndDate:()=>Xye,setTournamentName:()=>qye,setTournamentNotes:()=>Kye,setTournamentStartDate:()=>Zye,setTournamentStatus:()=>zye});var dze="ABANDONED",pze="ACTIVE",hze="CANCELLED",fze="COMPLETED",mze="IN_PROGRESS",Hye={ABANDONED:dze,ACTIVE:pze,CANCELLED:hze,COMPLETED:fze,IN_PROGRESS:mze};function zye({tournamentRecord:t,status:e}){return t?e&&!Object.keys(Hye).includes(e)?{error:Ie,info:"Unknown status"}:(t.tournamentStatus=e,{...re}):{error:Ne}}function Wye({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:n,personId:r,courtId:a,venueId:o}){var s,l,c;if(!t)return{error:Ne};if(!on(e))return{error:dt};if(Ln(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return oe({result:{error:Kp},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return oe({result:{error:Sa}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(n||r){let u=(t.participants??[]).find(d=>{var p;return r&&((p=d.person)==null?void 0:p.personId)===r||d.participantId===n});if(!u)return oe(r?{result:{error:Sa}}:{result:{error:Gn}});if(r){if(((l=u.person)==null?void 0:l.personId)!==r)return oe({result:{error:k0}});u.person.onlineResources||(u.person.onlineResources=[]),u.person.onlineResources.push(e)}else u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(a){let u=(c=(t.venues??[]).filter(d=>!o||d.venueId===o).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===a)))==null?void 0:c[0];if(!u)return oe({result:{error:GP}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(o){let u=(t.venues??[]).find(d=>d.venueId===o);if(!u)return oe({result:{error:x0}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...re}}function qye({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...re}):{error:Ne}}function Kye({tournamentRecord:t,notes:e}){return t?Jk({element:t,notes:e}):{error:Ne}}function Yye({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...re}):{error:Ne}}function gze({tournamentRecord:t}){var e,i;if(!t)return{error:Ne};let{startDate:n,endDate:r}=t,a=uw(n,r),o=[];for(let s of t.venues||[])(e=s==null?void 0:s.courts)!=null&&e.length&&o.push(...s.courts);for(let s of o){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,h)=>{let f=ri(p.startTime),m=ri(p.endTime);return h.startTime&&ri(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&ri(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=a.map(p=>{var h;return((h=s.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(i=s.dateAvailability)==null?void 0:i.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...re}}function XO(t){var e;let{tournamentRecord:i,startDate:n,endDate:r}=t,a=vi(t,[{tournamentRecord:!0},{[s3]:{startDate:!1,endDate:!1},[Id]:Ka,[pc]:p=>bd.test(p)}]);if(a.error)return a;if(r&&n&&new Date(r)<new Date(n))return{error:Ie};let o;(n&&i.startDate&&new Date(n)>new Date(i.startDate)||r&&i.endDate&&new Date(r)<new Date(i.endDate))&&(o=!0);let s=uw(i.startDate,i.endDate);n&&(i.startDate=n),r&&(i.endDate=r);let l=uw(i.startDate,i.endDate),c=s.filter(p=>!l.includes(p)),u=l.filter(p=>!s.includes(p));for(let p of i.events??[])n&&p.startDate&&new Date(n)>new Date(p.startDate)&&(p.startDate=n),r&&p.endDate&&new Date(r)<new Date(p.endDate)&&(p.endDate=r);n&&i.endDate&&new Date(n)>new Date(i.endDate)&&(i.endDate=n),r&&i.startDate&&new Date(r)<new Date(i.startDate)&&(i.startDate=r);let d=o&&((e=vze({tournamentRecord:i}))==null?void 0:e.unscheduledMatchUpIds);return gze({tournamentRecord:i}),ti({topic:_de,payload:{startDate:n,endDate:r}}),{...re,unscheduledMatchUpIds:d,datesAdded:u,datesRemoved:c}}function Zye({tournamentRecord:t,startDate:e}){return XO({tournamentRecord:t,startDate:e})}function Xye({tournamentRecord:t,endDate:e}){return XO({tournamentRecord:t,endDate:e})}function vze({tournamentRecord:t}){let e=Hr({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],a=[];for(let o of e){let{schedule:s,matchUpId:l}=o;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||n&&c>n)&&(a.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!WO({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:Uce}:{unscheduledMatchUpIds:a}}var Jye={};Ht(Jye,{addCourt:()=>YO,addCourts:()=>I5,addVenue:()=>fC,deleteCourt:()=>sIe,deleteVenue:()=>E5,deleteVenues:()=>iIe,disableCourts:()=>nIe,disableVenues:()=>rIe,enableCourts:()=>aIe,enableVenues:()=>oIe,generate:()=>Qye,generateCourts:()=>Y4,getCompetitionVenues:()=>BC,getCourts:()=>x4,getVenuesAndCourts:()=>ih,modifyCourt:()=>M5,modifyCourtAvailability:()=>P5,modifyVenue:()=>lIe,mutate:()=>eIe,publicFindVenue:()=>X3,query:()=>fge});var Qye={};Ht(Qye,{generateCourts:()=>Y4});var eIe={};Ht(eIe,{addCourt:()=>YO,addCourts:()=>I5,addVenue:()=>fC,deleteCourt:()=>sIe,deleteVenue:()=>E5,deleteVenues:()=>iIe,disableCourts:()=>nIe,disableVenues:()=>rIe,enableCourts:()=>aIe,enableVenues:()=>oIe,modifyCourt:()=>M5,modifyCourtAvailability:()=>P5,modifyVenue:()=>lIe});function D5(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:Ne};if(!(t!=null&&t.courtId))return{error:eI};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:a}=t,{schedulingProfile:o}=nh({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:a})};let{matchUps:s}=Hr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:a})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var h,f,m;let g=(f=(h=p.schedule)==null?void 0:h.allocatedCourts)==null?void 0:f.map(({courtId:v})=>v);return((m=p.schedule)==null?void 0:m.courtId)===u||(g==null?void 0:g.includes(u))});return sN({matchUps:d,schedulingProfile:o})}}function yze({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:Ne};if(!n)return{error:Nf};let{schedulingProfile:r}=nh({tournamentRecord:e}),{matchUps:a}=Hr({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:o({matchUps:a,venueId:n})};function o({matchUps:s,venueId:l}){let c=s.filter(u=>{var d,p,h;let f=(p=(d=u.schedule)==null?void 0:d.allocatedCourts)==null?void 0:p.map(({venueId:m})=>m);return((h=u.schedule)==null?void 0:h.venueId)===l||(f==null?void 0:f.includes(l))});return sN({matchUps:c,schedulingProfile:r})}}function P5({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:a}){var o,s,l;if(!t)return{error:Ne};if(!r)return{error:eI};let c=$ve({dateAvailability:e});if(c.error)return c;let{updatedDateAvailability:u,totalMergeCount:d}=Ize(e);e=u;let p=uI({tournamentRecord:t,courtId:r});if(p.error)return p;let{court:h,venue:f}=p,{matchUps:m}=D5({tournamentRecord:t,venueMatchUps:n,courtId:r});if(m!=null&&m.length){let g=(o=Mi({tournamentRecord:t}))==null?void 0:o.appliedPolicies,v=a??((l=(s=g==null?void 0:g[kf])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return h&&(h.dateAvailability=e,!i&&f&&ti({payload:{venue:f,tournamentId:t.tournamentId},topic:Cg,key:f.venueId})),{...re,totalMergeCount:d}}function Ize(t){let e=0,i=t.reduce((r,a)=>{let{date:o,startTime:s,endTime:l,bookings:c}=a;return r[o]||(r[o]=[]),r[o].push({startTime:s,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(GHe);let{mergedAvailability:a,mergeCount:o}=bze(i[r]);n.push(...a.map(s=>({date:r,...s}))),e+=o}),{updatedDateAvailability:n,totalMergeCount:e}}function bze(t){let e,i,n,r=t.length,a=0,o=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(KP(Jn(i),Jn(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),o.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,a+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),o.push(s),{mergedAvailability:o,mergeCount:a}}function C5({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:Pue,info:e}}function tIe({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:ua};if(!e&&!n)return{error:Fc};let a;if(!e){if(!t)return{error:Ne};({drawDefinition:e}=po({tournamentRecord:t,drawId:n}))}if(e)({matchUp:a}=an({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Ne};let o=Hr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:a}=Rhe({matchUps:o,matchUpId:i}))}return a?(a.timeItems&&a.timeItems.find(o=>[qm,Np].includes(o.itemType))&&(a.timeItems=a.timeItems.filter(({itemType:o})=>![qm,Np].includes(o)),si({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:a})),{...re}):{error:wa}}function E5(t){var e,i,n;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Nf};let{tournamentRecord:r,venueId:a,force:o}=t,s=t.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(s).length)return{error:Ne};let l=Nc({tournamentRecords:s,contextFilters:{venueIds:[a]}}).matchUps??[],c=(e=Mi({tournamentRecord:r}))==null?void 0:e.appliedPolicies,u=o??((n=(i=c==null?void 0:c[kf])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:n.venues);if(!l.length||u)for(let d of Object.values(s)){for(let h of l){let f=tIe({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==a?!0:(p=!0,!1)),p&&ti({payload:{venueId:a,tournamentId:d.tournamentId},topic:N3,key:a})}else return C5({matchUpsCount:l.length});return jC({tournamentRecords:s}),{...re}}function iIe({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Ne};if(!Array.isArray(e))return{error:Ie};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:a}=n,o=E5({tournamentRecord:t,venueId:a,force:i});if(o.error)return o}}return{...re}}function nIe(t){let{courtIds:e,dates:i}=t,n=Eu(t),r=[{[Ta]:!0,[Tk]:!0}],a=vi(t,r);if(a.error)return a;for(let o of Object.values(n))wze({tournamentRecord:o,courtIds:e,dates:i});return{...re}}function wze({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=a=>ui({extension:{value:n,name:Tc},creationTime:!1,element:a});for(let a of t.venues||[])for(let o of a.courts||[])if(e!=null&&e.includes(o.courtId)){let s=r(o);if(s.error)return s}return{...re}}function rIe(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[Ta]:!0,[Uk]:!0}],a=vi(t,r);if(a.error)return a;let o=Object.keys(e).filter(s=>!i||s===i);for(let s of o){let l=e[s];Sze({tournamentRecord:l,venueIds:n})}return{...re}}function Sze({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=ui({creationTime:!1,element:i,extension:{name:Tc,value:!0}});if(n.error)return n}return{...re}}function aIe(t){let e=Eu(t),i=[{[Ta]:!0}];!t.enableAll&&i.push({[Tk]:!0});let n=vi(t,i);if(n.error)return n;let{enableAll:r,courtIds:a,dates:o}=t;for(let s of Object.values(e))Tze({tournamentRecord:s,courtIds:a,enableAll:r,dates:o});return{...re}}function Tze({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let a of r.courts||[])if(i||e!=null&&e.includes(a.courtId))if(Array.isArray(n)){let{extension:o}=jt({element:a,name:Tc});if(o){let s=o.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),ui({extension:{name:Tc,value:s},creationTime:!1,element:a})}}else Va({element:a,name:Tc});return{...re}}function oIe(t){let e=Eu(t),i=[{[Ta]:!0}];!t.enableAll&&i.push({[Uk]:!0});let n=vi(t,i);if(n.error)return n;let{venueIds:r,enableAll:a}=t;for(let o of Object.values(e))for(let s of o.venues||[])(a||r!=null&&r.includes(s.venueId))&&Va({element:s,name:Tc});return{...re}}function sIe(t){let{courtId:e,disableNotice:i,force:n}=t,r=Eu(t),a=vi(t,[{[Ta]:!0,[Yue]:!0}]);if(a.error)return a;let o,s;for(let l of Object.values(r)){if(s=Uze({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==GP)return s;s.success&&(o=!0)}return o?{...re}:s}function Uze({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var r,a,o;let s=uI({tournamentRecord:t,courtId:i});if(s.error)return s;let l=s.venue,{matchUps:c}=D5({tournamentRecord:t,courtId:i}),u=(r=Mi({tournamentRecord:t}))==null?void 0:r.appliedPolicies,d=n??((o=(a=u==null?void 0:u[kf])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.courts);if(!(c!=null&&c.length)||d){for(let p of c??[]){let h=tIe({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||ti({payload:{venue:l,tournamentId:t.tournamentId},topic:Cg,key:l.venueId}))}else return C5({matchUpsCount:c.length});return{...re}}function M5(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:a}=t,o=Eu(t);if(!Object.keys(o).length)return{error:Cn};let s,l;for(let c of Object.values(o)){let u=Dze({tournamentRecord:c,disableNotice:e,venueMatchUps:a,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;s=!0}return s?{...re}:l}function Dze({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:a}){if(!t)return{error:Ne};if(!r)return{error:eI};if(!n||typeof n!="object")return{error:Kp};let o=uI({tournamentRecord:t,courtId:r});if(o.error)return o;let{venue:s,court:l}=o,c=Object.keys(jHe()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:vk};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=P5({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:a});if(p.error)return p}return e||ti({payload:{venue:s,tournamentId:t.tournamentId},topic:Cg,key:s==null?void 0:s.venueId}),{...re,court:ot(l)}}var Pze=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),Cze=Pze;function lIe(t){let{modifications:e,venueId:i,force:n}=t,r=Eu(t);if(!Object.keys(r).length)return{error:Cn};if(typeof i!="string")return{error:Nf};let a,o;for(let s of Object.values(r)){let l=Eze({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(o=!0),l.error&&(a=l.error),l.error&&l.error!==x0)return l}return jC({tournamentRecords:r}),o?{...re}:{error:a}}function Eze({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,a,o,s,l,c,u,d;if(!t)return{error:Ne};if(!e||typeof e!="object")return{error:Kp};if(!i)return{error:Nf};let p=(r=Mi({tournamentRecord:t}))==null?void 0:r.appliedPolicies,h=n??((o=(a=p==null?void 0:p[kf])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:o.venues),{matchUps:f}=yze({tournamentRecord:t,venueId:i}),m=Jp({tournamentRecord:t,venueId:i});if(m.error)return m;let g=m.venue,v=Object.keys(Cze()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>v.includes(U)).length)return{error:vk};let y=v.filter(U=>!["courts","onlineResources"].includes(U)),I=Object.keys(e).filter(U=>y.includes(U));g&&I.forEach(U=>Object.assign(g,{[U]:e[U]}));let b=((s=g==null?void 0:g.courts)==null?void 0:s.map(U=>U.courtId))??[],D=((l=e.courts)==null?void 0:l.map(U=>U.courtId))||[],w=D.length?b.filter(U=>!D.includes(U)):(e==null?void 0:e.courts)&&b,S=[];if(w!=null&&w.length){let U=(u=(c=g==null?void 0:g.courts)==null?void 0:c.filter(C=>w.includes(C.courtId)))==null?void 0:u.map(C=>{var E;let P=D5({courtId:C.courtId,tournamentRecord:t,venueMatchUps:f});for(let M of P.matchUps??[])S.push({matchUpId:M.matchUpId,drawId:M.drawId});return((E=P.matchUps)==null?void 0:E.length)??0}).reduce((C,E)=>C+E);if(g&&(!U||h))g.courts=(d=g.courts)==null?void 0:d.filter(C=>D.includes(C.courtId)),jU({schedule:{courtId:"",scheduledDate:""},matchUpDetails:S,removePriorValues:!0,tournamentRecord:t});else return C5({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:C}=U||{},E=M5({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:f,courtId:C,force:n});if(E.error===GP&&(E=YO({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return jC({tournamentRecord:t}),g&&ti({payload:{venue:g,tournamentId:t.tournamentId},topic:Cg,key:g==null?void 0:g.venueId}),{...re,venue:ot(g)}}var R5={};Ht(R5,{JSON2CSV:()=>kze,UUID:()=>xi,UUIDS:()=>t$e,allNumeric:()=>kue,attributeFilter:()=>ay,chunkArray:()=>jr,chunkByNth:()=>rB,chunkSizeProfile:()=>_ue,constantToString:()=>ia,countValues:()=>uLe,createMap:()=>wce,dateTime:()=>XLe,definedAttributes:()=>ft,dehydrateMatchUps:()=>Rze,extractAttributes:()=>Fde,flattenJSON:()=>N5,generateDateRange:()=>uw,generateHashCode:()=>Dxe,generateRange:()=>Xe,generateTimeCode:()=>qve,groupValues:()=>Nue,hasAttributeValues:()=>Uxe,instanceCount:()=>qo,intersection:()=>Ln,isConvertableInteger:()=>Rt,isNumeric:()=>Mn,isOdd:()=>Mue,isPowerOf2:()=>Rc,makeDeepCopy:()=>ot,matchUpSort:()=>pI,nearestPowerOf2:()=>ZW,nextPowerOf2:()=>F0,noNulls:()=>cLe,noNumeric:()=>Oue,numericSort:()=>or,occurrences:()=>pLe,overlap:()=>Ya,randomMember:()=>vl,randomPop:()=>xo,shuffleArray:()=>Fa,structureSort:()=>sI,subSort:()=>hLe,undefinedToNull:()=>K$,unique:()=>$t,visualizeScheduledMatchUps:()=>Mze});function Mze({scheduledMatchUps:t,showGlobalLog:e}){O$e();let i=t==null?void 0:t.reduce((r,{structureId:a})=>r.includes(a)?r:r.concat(a),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:a,matchUpType:o}=t.find(s=>s.structureId===r);return{[r]:`${a} ${o}`}})};i==null||i.forEach(r=>{var a;js({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===r),s=((a=Za({matchUps:o}))==null?void 0:a.roundMatchUps)||[];Object.keys(s).forEach(l=>{js({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:c,schedule:u})=>{let d=rn(u.scheduledTime);js({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&k$e()}function Rze({tournamentRecord:t}){if(!t)return{error:Ne};if(typeof t!="object"||!t.tournamentId)return{error:Ie};let{matchUps:e}=Hr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=Nze({tournamentRecord:t});_ze(e,i)}return{...re}}function Nze({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let a of r.structures||[])a.matchUpFormat&&(e[a.structureId]=a.matchUpFormat)}}}return e}var Aze=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function _ze(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:a}=i,o=e[n]||e[r]||e[a],s=i.matchUpFormat===o?void 0:i.matchUpFormat;for(let l of Object.keys(i))Aze.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function kze(t,e){if(e&&typeof e!="object")return{error:Ie};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:a,removeEmptyColumns:o,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Ie};i=Object.assign({},...Object.keys(i).reverse().map(R=>({[R]:Array.isArray(i[R])?i[R]:[typeof i[R]=="string"&&i[R]].filter(Boolean)})));let v=t.filter(Boolean).map(R=>N5(R,g)),y=Object.values(i).flat();n&&l.push(...y);let I=v.reduce((R,A)=>Object.keys(A).every(_=>!R.includes(_)&&R.push(_)||!0)&&R,[]).filter(R=>!(l!=null&&l.length)||l.includes(R)),b=Object.assign({},...Object.keys(i).reverse().map(R=>i[R].map(A=>({[A]:R})).flat()).flat()),D=(R,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(R)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(R)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,w=I.reduce((R,A)=>{let _=b[A];return _?R.includes(_)||R.push(_):R.push(A),R},[]).sort(D);Object.keys(u).forEach(R=>!w.includes(R)&&w.unshift(R)),Object.keys(i).forEach(R=>!w.includes(R)&&w.unshift(R)),typeof p=="object"&&Object.keys(p).forEach(R=>!w.includes(R)&&w.unshift(R));let S=w.map(R=>u[R]||R);if(s)return[S];let U=R=>`${h}${R}${h}`,C=[],E=R=>Object.values(w.reduce((A,_,O)=>{var x;let F=i[_],$=(F!=null&&F.length?R[F.find(j=>R[j])]:R[_])||(p==null?void 0:p[_])||"",V=((x=d[_])==null?void 0:x[$])||$,G=ko(c[_])?c[_](V):V;return A[_]=U(G),G&&(C[O]=(C[O]||0)+1),A},{})),P=v.map(E),M=o&&[...C].map((R,A)=>!R&&A).filter(Mn).reverse();if(M){let R=A=>A.filter((_,O)=>!M.includes(O));P=P.map(R),S=R(S)}let N=P.map(R=>R.join(f));return a?N.map(R=>{let A=R.split(f);return Object.assign({},...A.map((_,O)=>({[S[O]]:_})))}):r?[S.map(U).join(f),...N].join(m):N.join(m)}function N5(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,N5(t[r],e,i.concat(r))),{})}var{FACTORY:r8}=lde;function Oze({tournamentRecord:t,value:e}){let{extension:i}=jt({element:t,name:r8}),n={name:r8,value:{...i==null?void 0:i.value,...e}};ui({element:t,extension:n})}function cIe({timeStamp:t}){let e=nI(),i=JW();return i&&Object.values(e).forEach(n=>{Oze({tournamentRecord:n,value:{version:sk(),timeStamp:t}})}),i}function uIe({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var a,o;let s=qs();if(typeof s!="object")return;let l={method:e},c=(r==null?void 0:r.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),u=Array.isArray(s.params)&&((a=s.params)==null?void 0:a.includes(e)),d=s.params&&!Array.isArray(s.params)||u,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),!p&&(c||d)&&(l.params=n),!p&&(c||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||u)||Array.isArray(s.result)&&(o=s.result)!=null&&o.includes(e))&&(l.result=r),Object.keys(l).length>1&&Hue(l,t)}function A5({methodName:t,params:e,start:i}){let n={error:Ik,methodName:t},r=i?Date.now()-i:0;return uIe({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function xze(t,e){var i;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Ne};let n=e.drawId||((i=e.matchUp)==null?void 0:i.drawId);if(n){let{event:o,drawDefinition:s,tournamentId:l}=po({tournamentRecords:t,drawId:n});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),o&&(e.event=o)}if(e.eventId&&!e.event){let{event:o,tournamentId:s}=po({eventId:e.eventId,tournamentRecords:t});if(!o)return{error:Wo};e.tournamentId=s,e.event=o}let r=e.tournamentId??iI();if(!r&&e)return e;let a=t[r];return r&&!a?{error:Ne}:(a&&(e.tournamentRecord=a),e)}function _5(t,e,i,n,r){delete t.success,delete t.error;let a=Date.now(),o=iI();i&&(i.activeTournamentId=o);let s=(i==null?void 0:i.tournamentRecord)||e3(o),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||nI(),c=i?ot(i,void 0,!0):void 0,u=i?xze(l,i):void 0;if(u!=null&&u.error)return u;let d=Lze({params:u,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-a;return uIe({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function Lze({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(qs())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(a){return Sk({engineName:"engine",methodName:n,params:i,err:a})}}function JO(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:a}=Wl();for(let o of[...a].sort(Fze)){let s=Vue({topic:o});s!=null&&s.length&&aB({topic:o,notices:s})}e&&r&&a.includes(uB)&&aB({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:uB})}var a8={[$3]:5,[F3]:5,[B3]:5,[L3]:5,[x3]:5,[k3]:5,[Nde]:5,[Ade]:5,[O3]:1,[Ok]:1,[sa]:5,[Cg]:5,[_3]:4,[R3]:4,[N3]:4,[A3]:4,[kk]:3,[C3]:2};function Fze(t,e){return(a8[e]||0)-(a8[t]||0)}function $ze({convertExtensions:t,removeExtensions:e}){let i=nI();return{tournamentId:iI(),tournamentRecords:ot(i,t,!1,e)}}function Bze(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??iI();if(typeof n!="string")return{};let r=e3(n);return{tournamentRecord:ot(r,e,!1,i)}}function Vze(){var t;let e=nI(),{extension:i}=jt({name:oy,tournamentRecords:e,discover:!0}),n=((t=i==null?void 0:i.value)==null?void 0:t.tournamentIds)||[];return Object.keys(e).forEach(r=>{n.includes(r)||delete e[r]}),wk(e)}function o8(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Kp}:t!=null&&t.tournamentId?jue(e?ot(t):t):{error:Ie}}function QO(t,e=!0){if(typeof t!="object")return{error:Kp};if(IU(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:X$};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},IU(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:X$};return wk(e?ot(t):t)}function jze(t,e,i,n,r,a){let o=zue(i,n,r,a);if(o.error)return o;let s=o.methods??[];return Object.keys(s).filter(l=>ko(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(qs())return u();try{return u()}catch(d){Sk({engineName:"engine",methodName:l,params:c,err:d})}}}),{...re,...t}}function jI(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function dIe(t,e){t.importMethods=(i,n,r,a)=>jze(t,e,i,n,r,a),t.getTournament=i=>Bze(i),t.getState=i=>$ze({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>sk(),t.reset=()=>(wk({}),jI(t)),t.devContext=i=>(vU(i),jI(t)),t.getDevContext=i=>qs(i),t.newTournamentRecord=(i={})=>{let n=Tve(i),r=n.tournamentId;return n.error?n:(o8(n),IU(r),{...re,tournamentId:r})},t.setState=(i,n,r)=>{yU(n,r);let a=QO(i,n);return jI(t,a)},t.setTournamentId=i=>IU(i),t.getTournamentId=()=>iI(),t.setTournamentRecord=(i,n,r)=>{yU(n,r);let a=o8(i,n);return jI(t,a)},t.removeTournamentRecord=i=>{let n=Gue(i);return jI(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=Vze();return jI(t,i)}}function Gze(t,e,i){if(!Array.isArray(e))return{error:Ie,message:"directives must be an array"};let n=Bue(),r=Date.now(),a=i&&ot(nI(),!1,!0),o=[];for(let c of e){if(typeof c!="object")return{error:Ie,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Ie,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return A5({methodName:u,start:r,params:p});if(d){let f=o[o.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=_5(t,n[u],p,u,"sync");if(h!=null&&h.error)return a&&QO(a),{...h,rolledBack:!!a};o.push({...h,methodName:u})}let s=Date.now(),l=cIe({timeStamp:s});return JO({directives:e,mutationStatus:l,timeStamp:s}),zP(),{success:o.every(c=>c.success),results:o}}function s8(t,e){if(!on(e))return{error:Ie,message:"args must be an object"};let i=Object.values(e).filter(ko).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ie};let n=i?Object.keys(e).find(h=>ko(e[h])):co(e.method)&&e.method;if(!n)return{error:Ik};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=o.rollbackOnError&&ot(nI(),!1,!0),l=r||t[n]||KW()[n];if(!l)return A5({methodName:n,params:o});let c=_5(t,l,o,n,"sync")??{};c!=null&&c.error&&s&&QO(s);let u=Date.now(),d=cIe({timeStamp:u}),p=(c==null?void 0:c.success)&&(o==null?void 0:o.delayNotify)!==!0&&(o==null?void 0:o.doNotNotify)!==!0;return p&&JO({directives:[{method:l,params:o}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||o!=null&&o.doNotNotify)&&zP(),c}var Hze=(()=>{let t={executionQueue:(e,i)=>Gze(t,e,i),execute:e=>s8(t,e)};return dIe(t,s8),t})(),k5=Hze;function l8(t,e){if(!on(e))return{error:Ie,message:"args must be an object"};let i=Object.values(e).filter(ko).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Ie};let n=i?Object.keys(e).find(l=>ko(e[l])):co(e.method)&&e.method;if(!n)return{error:Ik};let{[n]:r,...a}=e,o=e!=null&&e.params?{...e.params}:{...a},s=r||t[n]||KW()[n];return s?_5(t,s,o,n,"ask"):A5({methodName:n,params:o})}(()=>{let t={execute:e=>l8(t,e)};return dIe(t,l8),t})();var xv={},Mh;function c8(t,e=!0){if(!t)return{error:dt};if(typeof t!="object")return{error:Kp};if(t.matchUpId)Mh=t.matchUpId,xv[Mh]=e?ot(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(xv[i.matchUpId]=e?ot(i):i,Mh||(Mh=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(xv[i.matchUpId]=e?ot(i):i,Mh||(Mh=i.matchUpId));return e?ot(t):t}function zze(){return xv[Mh]}function Wze(){return Object.values(xv)}function qze(){Mh=void 0,xv={}}function Kze(t){return ot(xv[Mh],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}(()=>{let t={getState:r=>Kze(r),version:()=>sk(),reset:()=>(qze(),{...re}),drawId:void 0,error:void 0,success:!1,devContext:r=>(vU(r),t),setState:(r,a,o)=>{yU(a,o);let s=c8(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([Qq]),t;function i(r){r.forEach(a=>{Object.keys(a).forEach(o=>{t[o]=s=>{if(qs())return n({params:s,governor:a,methodName:o});try{return n({params:s,governor:a,methodName:o})}catch(l){Sk({engineName:"matchUpEngine",methodName:o,params:s,err:l})}}})})}function n({params:r,governor:a,methodName:o}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||zze(),l=(r==null?void 0:r.matchUps)||Wze(),c=(r==null?void 0:r.rollbackOnError)&&ot(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=a[o](r);if(u!=null&&u.error)return c&&c8(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&JO(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&zP(),u}})();var OL=!1;(()=>{let t={version:()=>sk(),setDeepCopy:(n,r)=>(yU(n,r),t),devContext:n=>(vU(n),OL=!0,t)};return i([u5]),t;function e(n,r){let a=n({...r});return a!=null&&a.error||JO(),zP(),OL&&(vU(!1),OL=!1),a}function i(n){n.forEach(r=>{Object.keys(r).forEach(a=>{t[a]=o=>{try{let s=e(r[a],o);return!(s!=null&&s.error)&&o!=null&&o.setState&&s!=null&&s.tournamentRecord&&QO(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(o),method:a,error:l})}}})})}})();k5.importMethods(yce,!0,1);var pIe=k5;function hIe(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function Yze(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:a,drawType:o,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,I,b,D,w,S,U;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(o)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(a))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((I=f.levels)!=null&&I.length)||f.levels.includes(c))&&(!f.maxDrawSize||a<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===a)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((D=(b=f.flights)==null?void 0:b.flightNumbers)!=null&&D.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((w=f.category)!=null&&w.ageCategoryCodes)||f.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=f.eventTypes)!=null&&S.length)||((U=f.eventTypes)==null?void 0:U.includes(r)))})}}function u8({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:a}){var o,s;let l=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(I=>I.flight===g||I.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},c=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(Rt(g)?g:0),I=hIe(a,g==null?void 0:g.level);return{value:l(v,I)||Rt(I)&&I||y}},u=0,d,p,h,f,m=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(I=>{var b;return I.drawSize===n||((b=I.drawSizes)==null?void 0:b.includes(n))}),v=i.find(I=>I.drawSize&&I.threshold&&n>I.drawSize),y=i.find(I=>{var b;return!I.drawSize&&!((b=I.drawSizes)!=null&&b.length)});m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m],y=y==null?void 0:y[m]),p=c(g,e).value,h=c(v,e).value,f=c(y,e).value,u=p||h||f,d=p&&g.requireWin||h&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(o=i==null?void 0:i.drawSizes)==null?void 0:o[n],v=i;m!==void 0&&(g=g==null?void 0:g[m],v=v==null?void 0:v[m]),p=c(g,e).value,f=c(v,e).value,u=p||f,d=p?g.requireWin:v==null?void 0:v.requireWin}else Rt(i)&&m===void 0&&(u=i);return e&&(s=r==null?void 0:r.pct)!=null&&s[e]&&(u=Math.round(u*r.pct[e])),{awardPoints:u,requireWin:d}}function Zze({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var r;if(!i)return{error:Ne};let{policyDefinitions:a}=Xp({policyTypes:[nM],tournamentRecord:i}),o=(e==null?void 0:e[nM])??(a==null?void 0:a[nM]);if(!o)return{error:uk};let s=o.awardProfiles,l=o.requireWinFirstRound,c=o.requireWinForPoints,{participants:u,derivedEventInfo:d,derivedDrawInfo:p,mappedMatchUps:h}=$n({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),f=u==null?void 0:u.filter(y=>{var I;return(I=y.draws)==null?void 0:I.length}),m={},g={},v={};for(let y of f??[]){let{participantType:I,participantId:b,person:D,draws:w}=y;for(let S of w){let{drawId:U,structureParticipation:C,eventId:E}=S,P=d[E],M=p[U],N=M==null?void 0:M.drawType,{category:R,eventType:A}=P||{},_=S.startDate||P.startDate||i.startDate,O=S.endDate||P.endDate||i.endDate;if(A===Ys&&b!==Vs)continue;let x;if(s){let F=c,$=0,V=0,G=0,j;for(let z of C){let{finishingPositionRange:H,participationOrder:K,participantWon:q,flightNumber:Y,rankingStage:Z,winCount:Q}=z;$+=Q||0;let ie=M==null?void 0:M.drawSize,{awardProfile:ue}=Yze({awardProfiles:s,participation:z,eventType:A,startDate:_,category:R,drawSize:ie,drawType:N,endDate:O,level:n});if(ue){if(!ie)continue;let J=Array.isArray(H)&&Math.max(...H),te=$t(H||[]).join("-"),se=J&&Z!==gt&&(H==null?void 0:H.includes(ie));ue.requireWinForPoints!==void 0&&(F=ue.requireWinForPoints),ue.requireWinFirstRound!==void 0&&(l=ue.requireWinFirstRound);let{finishingPositionPoints:ee={},finishingPositionRanges:ce,finishingRound:fe,pointsPerWin:ge,flights:he}=ue,Se=Array.isArray(ue.perWinPoints)?(r=ue.perWinPoints)==null?void 0:r.find(xe=>{var st;return(st=xe.participationOrders)==null?void 0:st.includes(K)}):ue.perWinPoints,Ce=ee.participationOrders,Fe=0,Je;if((!Ce||Ce.includes(K))&&ce&&J){let xe=ce[J];xe&&({awardPoints:Fe,requireWin:Je}=u8({flightNumber:Y,valueObj:xe,drawSize:ie,flights:he,level:n}))}if(!Fe&&fe&&K===1&&J){let xe=fe[J];xe&&({awardPoints:Fe,requireWin:Je}=u8({participantWon:q,flightNumber:Y,valueObj:xe,drawSize:ie,flights:he,level:n}))}if(se&&l!==void 0&&(F=l),Je!==void 0&&(F=Je),Fe>V&&(!F||Q)&&(V=Fe,j=J),!Fe&&ge&&Q&&(G+=Q*ge,j=te),!Fe&&Q&&Se){let xe=hIe(n,Se==null?void 0:Se.level);xe?G+=Q*xe:Se.value&&(G+=Q*Se.value)}}if(x=V+G,I===Vs){let J=(y.matchUps||[]).filter(({structureId:te})=>te===z.structureId);for(let{matchUpId:te}of J){let se=h[te],ee=se.sides.find(ce=>ce.participantId===b).sideNumber;if(se.winningSice===ee)for(let ce of se.tieMatchUps)ce.winningSide}}}if(G||V){let z={winCount:$,positionPoints:V,rangeAccessor:j,perWinPoints:G,eventType:A,drawId:U,points:x},H=D==null?void 0:D.personId;H?(m[H]||(m[H]=[]),m[H].push(z)):I===Ot?(v[b]||(v[b]=[]),v[b].push(z)):I===Vs&&(g[b]||(g[b]=[]),g[b].push(z))}}}}return{participantsWithOutcomes:f,personPoints:m,pairPoints:v,teamPoints:g,...re}}var Xze={getTournamentPoints:Zze},Jze=Xze,Qze={calculateNewRatings:ffe,generateDynamicRatings:mfe},eWe=Qze,tWe={...Jze,...eWe};k5.importMethods(tWe);var iWe={[TU]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},nWe={[Up]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[Av,IT]}},rWe={[Up]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[Av,OU,hy],disabledActions:[]}]}},aWe={[Up]:{policyName:"positionActionsDisabled",enabledStructures:!1}},oWe={[j0]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},sWe={[Sd]:{defaultMatchUpFormat:xs,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[nt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},lWe={[Sd]:{requireAllPositionsAssigned:!1,stage:{[nt]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:xs,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:xs,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},cWe={[fl]:{seedingProfile:{positioning:Rk},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},uWe={POLICY_AVOIDANCE_COUNTRY:iWe,POLICY_POSITION_ACTIONS_DEFAULT:Khe,POLICY_POSITION_ACTIONS_DISABLED:aWe,POLICY_POSITION_ACTIONS_NO_MOVEMENT:rWe,POLICY_POSITION_ACTIONS_UNRESTRICTED:nWe,POLICY_PRIVACY_DEFAULT:oWe,POLICY_ROUND_NAMING_DEFAULT:Q3,POLICY_SCHEDULING_DEFAULT:pge,POLICY_SCORING_DEFAULT:sWe,POLICY_SCORING_USTA:lWe,POLICY_SEEDING_ITF:cWe,POLICY_SEEDING_DEFAULT:Zme},dWe={ratingsParameters:rs,matchUpFormats:p2e,countryToFlag:vpe,tieFormats:$ge,countries:xh,policies:uWe,flagIOC:U$e},pWe={};Ht(pWe,{activeMatchUpStatuses:()=>b3,auditConstants:()=>AGe,completedMatchUpStatuses:()=>Mr,directingMatchUpStatuses:()=>yde,drawDefinitionConstants:()=>Mde,entryStatusConstants:()=>UFe,errorConditionConstants:()=>Vxe,eventConstants:()=>ZFe,extensionConstants:()=>lde,flightConstants:()=>BGe,genderConstants:()=>tq,keyValueConstants:()=>FVe,matchUpActionConstants:()=>q2e,matchUpStatusConstants:()=>wde,matchUpTypes:()=>wFe,nonDirectingMatchUpStatuses:()=>Ide,particicipantsRequiredMatchUpStatuses:()=>gde,participantConstants:()=>SFe,participantRoles:()=>cq,participantTypes:()=>mT,penaltyConstants:()=>RWe,policyConstants:()=>eFe,positionActionConstants:()=>G2e,ratingConstants:()=>pVe,recoveryTimeRequiredMatchUpStatuses:()=>uFe,requestConstants:()=>THe,resultConstants:()=>Cxe,scaleConstants:()=>FLe,scheduleConstants:()=>WFe,sortingConstants:()=>HGe,surfaceConstants:()=>xWe,tieFormatConstants:()=>Rje,timeItemConstants:()=>GFe,topicConstants:()=>yFe,tournamentConstants:()=>Hye,upcomingMatchUpStatuses:()=>bde,validMatchUpStatuses:()=>vde,venueConstants:()=>$We});var hWe="Coaching",fWe="Ball Abuse",mWe="Racket Abuse",gWe="Verbal Abuse",vWe="INELIGIBILITY",yWe="Physical Abuse",IWe="Unsportmanlike Conduct",bWe="Dress Code Violation",wWe="Equipment Violation",SWe="Leaving the court",TWe="Failure to complete",UWe="No Show",DWe="Other",PWe="REFUSAL_TO_PLAY",CWe="PROHIBITED_SUBSTANCE",EWe="Puncuality",MWe="Failure to sign in",RWe={COACHING:hWe,BALL_ABUSE:fWe,RACKET_ABUSE:mWe,VERBAL_ABUSE:gWe,PHYSICAL_ABUSE:yWe,INELIGIBILITY:vWe,UNSPORTSMANLIKE_CONDUCT:IWe,PROHIBITED_SUBSTANCE:CWe,DRESS_CODE_VIOLATION:bWe,EQUIMENT_VIOLATION:wWe,LEAVING_THE_COURT:SWe,REFUSAL_TO_PLAY:PWe,FAILURE_TO_COMPLETE:TWe,NO_SHOW:UWe,OTHER:DWe,PUNCTUALITY:EWe,FAILUIRE_TO_SIGN_IN:MWe},NWe="CLAY",AWe="HARD",_We="GRASS",kWe="CARPET",OWe="ARTIFICIAL",xWe={CLAY:NWe,HARD:AWe,GRASS:_We,CARPET:kWe,ARTIFICIAL:OWe},LWe="INDOOR",FWe="OUTDOOR",$We={INDOOR:LWe,OUTDOOR:FWe};const BWe=Di({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function VWe({matchUp:t,individualParticipant:e,spacer:i}){var n,r,a;const o=((n=e==null?void 0:e.person)==null?void 0:n.iso2NationalityCode)||"",s=o?(r=dWe.countryToFlag(o))==null?void 0:r.slice(0,4):"",l=document.createElement("span"),c=(a=t==null?void 0:t.matchUpType)==null?void 0:a.toLowerCase();return i||(l.className=BWe({variant:c})),l.innerHTML=i?"":s,l}function xL({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r,side:a,type:o}){if(o==="scale")return bxe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return o==="flag"&&s.flags&&VWe({className:i,matchUp:n,individualParticipant:t,spacer:r})||o==="seeding"&&yxe({className:i,composition:e,matchUp:n,side:a})||l}const jWe="Qualifier",GWe="BYE",HWe="TBD";function d8(t){var e,i,n,r;const{isWinningSide:a,side:o,sideNumber:s,individualParticipant:l,matchUp:c,composition:u}=t||{},d=a?"winner":void 0,p=t.eventHandlers||{},h=u==null?void 0:u.configuration,f={QUALIFIER:((e=h==null?void 0:h.placeHolders)==null?void 0:e.qualifier)||jWe,BYE:((i=h==null?void 0:h.placeHolders)==null?void 0:i.bye)||GWe,TBD:((n=h==null?void 0:h.placeHolders)==null?void 0:n.tbd)||HWe},m=l==null?void 0:l.participantName,g=S=>{gc(p==null?void 0:p.participantClick)&&(S.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:S,matchUp:c,side:o}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=JOe({variant:d});const I=(h==null?void 0:h.flags)&&xL({...t,type:"flag"});if(I)y.appendChild(I);else{const S=xL({type:"scale",...t});S&&y.appendChild(S)}const b=document.createElement("div");if(b.className=QOe({variant:d}),m){const S=document.createElement("span");if(a&&h!=null&&h.winnerColor)S.style.color=typeof h.winnerColor=="string"?h.winnerColor:"green";else if(h!=null&&h.genderColor){const U=(r=l==null?void 0:l.person)==null?void 0:r.sex,C=U==="MALE"&&"#2E86C1"||U==="FEMALE"&&"#AA336A"||"";S.style.color=typeof h.genderColor=="string"?h.genderColor:C}S.innerHTML=m,b.appendChild(S)}else{const S=document.createElement("abbr");S.className=XOe({variant:h.showAddress?"showAddress":""}),S.innerHTML=(o==null?void 0:o.bye)&&f.BYE||(o==null?void 0:o.qualifier)&&f.QUALIFIER||f.TBD,b.appendChild(S)}const D=xL({...t,className:vxe(),type:"seeding"});D&&b.appendChild(D),y.appendChild(b),v.appendChild(y);const w=gxe(t);return v.appendChild(w),{element:v}}const zWe=Di({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function WWe({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",n=document.createElement("div");n.className=zWe({variant:e});const r=document.createElement("abbr");return r.setAttribute("title",t),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}function qWe(t){return t instanceof Element||t}const KWe=Di({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function YWe({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=KWe(),e}const ZWe=Di({flexDirection:"column",position:"relative",display:"flex"}),XWe=Di({alignItems:"stretch",display:"flex"}),JWe=Di({marginInlineEnd:".25rem",color:"green"});function QWe({dim:t="20px"}={}){const e=JWe();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function fIe({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:n,participant:r,placeholder:a,sideNumber:o,matchUp:s}){var l,c,u;const{winningSide:d,matchUpType:p,isRoundRobin:h,matchUpStatus:f}=s||{},m=n==null?void 0:n.configuration;let g;const v=o?(l=s==null?void 0:s.sides)==null?void 0:l.find(R=>R.sideNumber===o):void 0;r||(r=v==null?void 0:v.participant,g=m!=null&&m.allDrawPositions||m!=null&&m.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||h)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",I=y?(c=r==null?void 0:r.individualParticipants)==null?void 0:c[0]:r,b=y&&((u=r==null?void 0:r.individualParticipants)==null?void 0:u[1]),D=o===d||f==="BYE"&&r,w=(m==null?void 0:m.winnerChevron)&&D,S=m==null?void 0:m.teamLogo,U=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!D,C=m==null?void 0:m.gameScoreOnly,E=document.createElement("div");if(E.className=i&&txe({drawPosition:g,sideNumber:o}),E.classList.add("tmx-p"),E.setAttribute("id",r==null?void 0:r.participantId),S){const R=YWe({teamLogo:S});E.appendChild(R)}const P=document.createElement("div");P.className=exe({variant:y?"doubles":"singles"});const M=document.createElement("div");M.className=ixe({winnerChevron:w,isDoubles:y});const N=d8({individualParticipant:I,eventHandlers:e,isWinningSide:D,composition:n,sideNumber:o,matchUp:s,side:v}).element;if(M.appendChild(N),b){const R=d8({individualParticipant:b,eventHandlers:e,isWinningSide:D,composition:n,sideNumber:o,matchUp:s,side:v}).element;M.appendChild(R)}else y&&a&&qWe(a)&&M.appendChild(a);if(P.appendChild(M),E.appendChild(P),i){const R=document.createElement("div");if(D&&!C){const A=QWe();typeof A=="string"?R.innerHTML=A:R.appendChild(A)}else if(U){const A=WWe({matchUpStatus:f});R.appendChild(A)}E.appendChild(R)}return E}const e3e=Di({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",width:"460px",height:"1.5em"});function t3e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:n,context:r}){var a;const o=document.createElement("div");o.className=e3e(),o.classList.add("tmx-rh"),o.setAttribute("roundNumber",n);const s=gc(t==null?void 0:t.roundHeaderClick);s&&(o.onclick=d=>t.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:e,context:r,pointerEvent:d}));const l=s?"⋮":"",c=(a=i==null?void 0:i[n])==null?void 0:a.roundName,u=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${c}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return o.innerHTML=u||"",o}const mIe=Di({flexDirection:"column",display:"flex"}),i3e=Di({flexDirection:"row",display:"flex"}),gIe=Di({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",width:"460px",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),n3e=Di({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),r3e=Di({fontWeight:"bold",color:"blue",height:"1em"}),p8=Di({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),a3e=Di({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function o3e(){return Di({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const s3e=Di({});function l3e({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return Di(e)}function c3e({variant:t}){return Di({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const u3e=Di({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),d3e=Di({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),h8=Di({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function p3e({eventHandlers:t,entryStatus:e,sideNumber:i,className:n,matchUp:r}){const a=document.createElement("div");gc(t==null?void 0:t.centerInfoClick)&&(a.onclick=u=>t.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:u})),a.className=Tg(c3e({variant:i}),n),a.classList.add("tmx-ci"),a.setAttribute("sideNumber",i);const o=document.createElement("div");o.className=u3e();const s=document.createElement("div");s.className=d3e();const l=document.createElement("div");l.className=h8(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const c=document.createElement("div");return c.className=h8(),c.innerHTML=e||"",s.appendChild(c),o.appendChild(s),a.appendChild(o),{element:a}}const wT={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function h3e({composition:t,isDoubles:e,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(t==null?void 0:t.configuration)||{},a=(r==null?void 0:r.connectorWidth)||16,o=r.centerInfo?wT.centerInfo*n:0,s=r.scheduleInfo?wT.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(e?1.3:1)+o,c=l*i,u=(l+s)*i;return Di({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-a,width:a,position:"absolute",borderRadius:2,top:-1},"&::after":{width:a,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const vIe=t=>Di({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),f3e=Di({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),yIe=Di({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),m3e=Di({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function g3e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=yIe(),e.value=t,e}function v3e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:n}){const r=n===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,a=n===2?i.side2Score:i.side1Score,o=i.side2TiebreakScore||i.side1TiebreakScore,s=n===2?i.side2TiebreakScore:i.side1TiebreakScore,l=a===void 0&&s,c=l||a,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===n:void 0;let p;if(d)p=g3e({value:c});else if(p=document.createElement("p"),p.className=yIe({variant:r}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const h=document.createElement("span");h.className=f3e(),h.innerHTML=o&&!l?s:"",p.appendChild(h)}return p}function y3e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:r}){var a,o,s,l;const c=(a=i==null?void 0:i.configuration)==null?void 0:a.winnerChevron,u=(o=i==null?void 0:i.configuration)==null?void 0:o.gameScoreOnly,d=((s=r==null?void 0:r.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,h=n===2?t:t-1,f=vIe(h),m=y=>{gc(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:r}))},g=document.createElement("div");g.className=f({sideNumber:!p&&n,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=m;const v=document.createElement("div");v.className=m3e();for(const y of d||[]){const I=v3e({gameScoreOnly:u,scoreStripes:c,sideNumber:n,set:y});v.appendChild(I)}return g.appendChild(v),g}const I3e=Di({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var IIe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(nxe,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",o="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(R){var A=["th","st","nd","rd"],_=R%100;return"["+R+(A[(_-20)%10]||A[_]||A[0])+"]"}},I=function(R,A,_){var O=String(R);return!O||O.length>=A?R:""+Array(A+1-O.length).join(_)+R},b={s:I,z:function(R){var A=-R.utcOffset(),_=Math.abs(A),O=Math.floor(_/60),x=_%60;return(A<=0?"+":"-")+I(O,2,"0")+":"+I(x,2,"0")},m:function R(A,_){if(A.date()<_.date())return-R(_,A);var O=12*(_.year()-A.year())+(_.month()-A.month()),x=A.clone().add(O,d),F=_-x<0,$=A.clone().add(O+(F?-1:1),d);return+(-(O+(_-x)/(F?x-$:$-x))||0)},a:function(R){return R<0?Math.ceil(R)||0:Math.floor(R)},p:function(R){return{M:d,y:h,w:u,d:c,D:f,h:l,m:s,s:o,ms:a,Q:p}[R]||String(R||"").toLowerCase().replace(/s$/,"")},u:function(R){return R===void 0}},D="en",w={};w[D]=y;var S="$isDayjsObject",U=function(R){return R instanceof M||!(!R||!R[S])},C=function R(A,_,O){var x;if(!A)return D;if(typeof A=="string"){var F=A.toLowerCase();w[F]&&(x=F),_&&(w[F]=_,x=F);var $=A.split("-");if(!x&&$.length>1)return R($[0])}else{var V=A.name;w[V]=A,x=V}return!O&&x&&(D=x),x||!O&&D},E=function(R,A){if(U(R))return R.clone();var _=typeof A=="object"?A:{};return _.date=R,_.args=arguments,new M(_)},P=b;P.l=C,P.i=U,P.w=function(R,A){return E(R,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var M=function(){function R(_){this.$L=C(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[S]=!0}var A=R.prototype;return A.parse=function(_){this.$d=function(O){var x=O.date,F=O.utc;if(x===null)return new Date(NaN);if(P.u(x))return new Date;if(x instanceof Date)return new Date(x);if(typeof x=="string"&&!/Z$/i.test(x)){var $=x.match(g);if($){var V=$[2]-1||0,G=($[7]||"0").substring(0,3);return F?new Date(Date.UTC($[1],V,$[3]||1,$[4]||0,$[5]||0,$[6]||0,G)):new Date($[1],V,$[3]||1,$[4]||0,$[5]||0,$[6]||0,G)}}return new Date(x)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return P},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,O){var x=E(_);return this.startOf(O)<=x&&x<=this.endOf(O)},A.isAfter=function(_,O){return E(_)<this.startOf(O)},A.isBefore=function(_,O){return this.endOf(O)<E(_)},A.$g=function(_,O,x){return P.u(_)?this[O]:this.set(x,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,O){var x=this,F=!!P.u(O)||O,$=P.p(_),V=function(Z,Q){var ie=P.w(x.$u?Date.UTC(x.$y,Q,Z):new Date(x.$y,Q,Z),x);return F?ie:ie.endOf(c)},G=function(Z,Q){return P.w(x.toDate()[Z].apply(x.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(Q)),x)},j=this.$W,z=this.$M,H=this.$D,K="set"+(this.$u?"UTC":"");switch($){case h:return F?V(1,0):V(31,11);case d:return F?V(1,z):V(0,z+1);case u:var q=this.$locale().weekStart||0,Y=(j<q?j+7:j)-q;return V(F?H-Y:H+(6-Y),z);case c:case f:return G(K+"Hours",0);case l:return G(K+"Minutes",1);case s:return G(K+"Seconds",2);case o:return G(K+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,O){var x,F=P.p(_),$="set"+(this.$u?"UTC":""),V=(x={},x[c]=$+"Date",x[f]=$+"Date",x[d]=$+"Month",x[h]=$+"FullYear",x[l]=$+"Hours",x[s]=$+"Minutes",x[o]=$+"Seconds",x[a]=$+"Milliseconds",x)[F],G=F===c?this.$D+(O-this.$W):O;if(F===d||F===h){var j=this.clone().set(f,1);j.$d[V](G),j.init(),this.$d=j.set(f,Math.min(this.$D,j.daysInMonth())).$d}else V&&this.$d[V](G);return this.init(),this},A.set=function(_,O){return this.clone().$set(_,O)},A.get=function(_){return this[P.p(_)]()},A.add=function(_,O){var x,F=this;_=Number(_);var $=P.p(O),V=function(z){var H=E(F);return P.w(H.date(H.date()+Math.round(z*_)),F)};if($===d)return this.set(d,this.$M+_);if($===h)return this.set(h,this.$y+_);if($===c)return V(1);if($===u)return V(7);var G=(x={},x[s]=n,x[l]=r,x[o]=i,x)[$]||1,j=this.$d.getTime()+_*G;return P.w(j,this)},A.subtract=function(_,O){return this.add(-1*_,O)},A.format=function(_){var O=this,x=this.$locale();if(!this.isValid())return x.invalidDate||m;var F=_||"YYYY-MM-DDTHH:mm:ssZ",$=P.z(this),V=this.$H,G=this.$m,j=this.$M,z=x.weekdays,H=x.months,K=x.meridiem,q=function(Q,ie,ue,J){return Q&&(Q[ie]||Q(O,F))||ue[ie].slice(0,J)},Y=function(Q){return P.s(V%12||12,Q,"0")},Z=K||function(Q,ie,ue){var J=Q<12?"AM":"PM";return ue?J.toLowerCase():J};return F.replace(v,function(Q,ie){return ie||function(ue){switch(ue){case"YY":return String(O.$y).slice(-2);case"YYYY":return P.s(O.$y,4,"0");case"M":return j+1;case"MM":return P.s(j+1,2,"0");case"MMM":return q(x.monthsShort,j,H,3);case"MMMM":return q(H,j);case"D":return O.$D;case"DD":return P.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return q(x.weekdaysMin,O.$W,z,2);case"ddd":return q(x.weekdaysShort,O.$W,z,3);case"dddd":return z[O.$W];case"H":return String(V);case"HH":return P.s(V,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return Z(V,G,!0);case"A":return Z(V,G,!1);case"m":return String(G);case"mm":return P.s(G,2,"0");case"s":return String(O.$s);case"ss":return P.s(O.$s,2,"0");case"SSS":return P.s(O.$ms,3,"0");case"Z":return $}return null}(Q)||$.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,O,x){var F,$=this,V=P.p(O),G=E(_),j=(G.utcOffset()-this.utcOffset())*n,z=this-G,H=function(){return P.m($,G)};switch(V){case h:F=H()/12;break;case d:F=H();break;case p:F=H()/3;break;case u:F=(z-j)/6048e5;break;case c:F=(z-j)/864e5;break;case l:F=z/r;break;case s:F=z/n;break;case o:F=z/i;break;default:F=z}return x?F:P.a(F)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,O){if(!_)return this.$L;var x=this.clone(),F=C(_,O,!0);return F&&(x.$L=F),x},A.clone=function(){return P.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},R}(),N=M.prototype;return E.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(R){N[R[1]]=function(A){return this.$g(A,R[0],R[1])}}),E.extend=function(R,A){return R.$i||(R(A,M,E),R.$i=!0),E},E.locale=C,E.isDayjs=U,E.unix=function(R){return E(1e3*R)},E.en=w[D],E.Ls=w,E.p={},E})})(IIe);var b3e=IIe.exports;const w3e=gce(b3e);function S3e({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:a}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:o,extractTime:s}}=R5,l=s(i);let c=o(n),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=n?w3e(c).format(u):"Not scheduled",p=r&&(a==null?void 0:a.toString().startsWith(r))&&a||r&&a&&`${r} ${a}`||a||r||"",h=document.createElement("div");h.className=I3e(),h.classList.add("tmx-sch"),gc(e==null?void 0:e.scheduleClick)&&(h.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const f=document.createElement("div");f.innerHTML=d,h.append(f);const m=y=>{gc(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),h.append(g),h.onclick){const y=document.createElement("div");y.innerHTML="⋮",g.append(y)}return h}function f8({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:n,className:r,matchUp:a}){var o,s;const l=(i==null?void 0:i.configuration)||{},c=l==null?void 0:l.scheduleInfo,u=(o=a==null?void 0:a.score)==null?void 0:o.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&u,p=(a==null?void 0:a.readyToScore)&&(e==null?void 0:e.scoreClick)&&!pIe.checkScoreHasValue({matchUp:a}),h=document.createElement("div");if(h.className=Tg(ZWe(),r),h.classList.add("tmx-sd"),h.setAttribute("sideNumber",n),c&&n===1){const g=S3e({matchUp:a,eventHandlers:e});h.appendChild(g)}const f=document.createElement("div");f.className=XWe();const m=fIe({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:a});if(f.appendChild(m),d){const g=document.createElement("div");g.style.border="1px solid lightgray",f.appendChild(g)}if(u){const g=y3e({eventHandlers:e,composition:i,sideNumber:n,matchUp:a});f.appendChild(g)}if(p){const g=vIe(),v=I=>{gc(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:I,matchUp:a}))},y=document.createElement("div");y.className=g({sideNumber:!d&&n,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",f.appendChild(y)}return h.appendChild(f),h}function T3e(t){const{composition:e,initialRoundNumber:i=1,matchUp:n,moeity:r,selectedMatchUpId:a,searchActive:o}=t,{roundFactor:s,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=n,h=t.isFinalRound||parseInt(c)===1,f=p==="QUALIFYING"&&h,m=h,g=parseInt(l)===i,v=u==="DOUBLES",y=(o||n.isRoundRobin||n.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(f||d)&&"m0"||r&&"m1"||"m2",I=h3e({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),b=(e==null?void 0:e.configuration)||{},{resultsInfo:D,centerInfo:w}=b||{},S=t.eventHandlers||{},U=R=>{gc(S==null?void 0:S.matchUpClick)&&S.matchUpClick({pointerEvent:R,matchUp:n})},C=document.createElement("div");C.className=Tg(e.theme,t==null?void 0:t.className,"matchup",s3e()),C.classList.add("tmx-m"),C.setAttribute("id",n==null?void 0:n.matchUpId),C.onclick=U;const E=document.createElement("div");E.className=l3e({configuration:b});const P=({sideNumber:R})=>{var A,_,O;const x=(O=(_=(A=n==null?void 0:n.sides.find(F=>F.sideNumber===R))==null?void 0:A.participant)==null?void 0:_.entryStatus)==null?void 0:O.replace("_"," ");return p3e({eventHandlers:S,entryStatus:x,sideNumber:R,className:R===2&&I,matchUp:n})},M=f8({initialRoundNumber:i,eventHandlers:S,sideNumber:1,composition:e,matchUp:n}),N=f8({className:!w&&I,initialRoundNumber:i,eventHandlers:S,sideNumber:2,composition:e,matchUp:n});if(E.appendChild(M),w){const R=P({sideNumber:1}),A=P({sideNumber:2});E.appendChild(R.element),E.appendChild(A.element)}if(E.appendChild(N),D){const R=U3e({score:n.score});E.appendChild(R)}if(C.appendChild(E),a===n.matchUpId){const R=document.createElement("div");R.className=o3e(),C.appendChild(R)}return C}function U3e({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((o,s)=>(o.setNumber||0)-(s.setNumber||0)),n=i==null?void 0:i[i.length-1],r=(n==null?void 0:n.side1PointsScore)||(n==null?void 0:n.side2PointsScore),a=document.createElement("div");if(a.className=a3e(),r){const o=document.createElement("div");o.className=p8({variant:"points"}),o.innerHTML="PTS",a.appendChild(o)}for(const o of i||[]){const s=document.createElement("div");s.setAttribute("key",o.setNumber),s.className=p8({variant:"set"}),s.innerHTML=o.setNumber,a.appendChild(s)}return a}function D3e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:a,composition:o,roundFactor:s,roundNumber:l,roundProfile:c,matchUps:u,context:d,isLucky:p}){const h=u.filter(C=>C.roundNumber===l).sort((C,E)=>(C.roundPosition||0)-(E.roundPosition||0)),f=h.every(({roundPosition:C,drawPositions:E})=>!C&&!E),m=(o==null?void 0:o.configuration)||{},g=document.createElement("div");if(g.className=mIe(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",l),m.roundHeader){const C=t3e({roundProfile:c,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:d});g.appendChild(C)}const v=document.createElement("div");v.className=gIe({variant:f?"adHoc":void 0});let y,I,b;if(r){const C=P=>P.reduce((M,N)=>N+M,0);h.sort((P,M)=>{const N=C(P.drawPositions)-C(M.drawPositions),R=Math.min(...P.drawPositions??[])-Math.min(...M.drawPositions??[]);return N||R});const E=h.reduce((P,M)=>(P[M.structureId]=M.structureName,P),{});y=Object.values(E),I=Object.keys(E),b=Object.keys(R5.instanceCount(h.map(({structureId:P})=>P))).length}else f&&h.sort((C,E)=>(C.roundOrder??0)-(E.roundOrder??0));const D=b&&h.length/b,w=Object.keys(c).map(C=>parseInt(C)),S=w.indexOf(l),U=S===0&&"first"||S===w.length-1&&"last";return h.forEach((C,E)=>{const P=D&&!(E%D),M=D&&Math.floor(E/D),N=D&&y[M];if(P){const _=document.createElement("div");_.className=n3e({variant:M,roundOrder:U}),v.appendChild(_);const O=document.createElement("div");if(O.className=r3e(),gc(i==null?void 0:i.groupHeaderClick)){const{drawId:x,containerStructureId:F}=h[0];v.onclick=$=>i.groupHeaderClick({drawId:x,structureId:I[M],containerStructureId:F,pointerEvent:$})}l===t&&(O.innerHTML=N),v.appendChild(O)}const R=E%2===0;s?C.roundFactor=s:t>1&&(C.roundFactor=Math.pow(2,l-t));const A=T3e({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,searchActive:a,composition:o,isAdHoc:f,isLucky:p,matchUp:C,moeity:R});v.appendChild(A)}),g.appendChild(v),g}function P3e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:n,composition:r,structureId:a,finalColumn:o,matchUps:s,context:l}){var c;const{roundNumbers:u,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:h}=pIe.getRoundMatchUps({matchUps:s});a=a||(l==null?void 0:l.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const f=s.some(({isRoundRobin:y})=>y),m=p||h,g=document.createElement("div");g.className=i3e(),g.classList.add("tmx-str"),g.setAttribute("id",a);const v=Math.max(...u);for(const y of u){if(y<t)continue;const I=D3e({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:y===v,isRoundRobin:f,searchActive:n,composition:r,roundNumber:y,roundProfile:d,matchUps:s,context:l,isLucky:m});g.appendChild(I)}if(o){const y=document.createElement("div");y.className=mIe();const I=document.createElement("div");I.className=gIe(),I.appendChild(o),y.appendChild(I),g.appendChild(y)}return g}const m8=Di({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function C3e({content:t,theme:e}){const i=document.createElement("div");return i.className=e?Tg(m8(),e):m8(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:TI}=mce({theme:{lineHeights:{scheduleInfo:`${wT.scheduleInfo}rem`,centerInfo:`${wT.centerInfo}rem`,gameScore:`${wT.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),g8=TI("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),E3e=TI("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),M3e=TI("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),R3e=TI("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),v8=TI("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),N3e=TI("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),A3e=TI("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),YE={Australian:{configuration:{flags:!0},theme:g8},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:v8},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:v8},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:M3e},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:E3e},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:R3e},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:A3e},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:g8},Night:{configuration:{flags:!0},theme:N3e}};function Mw(){NR.close()}function ir(t){const{title:e,content:i,buttons:n,footer:r,onClose:a}=t,s={padding:!e&&!n?"":".5",maxWidth:500};return NR.open({title:e,content:i,footer:r,buttons:n,config:s,onClose:a})}function _3e(){const{tournamentRecord:t}=$e.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:mW,intent:"is-warning",onClick:SOe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?bOe(`${t.tournamentId}.tods.json`,t):ai({message:"Error"})},close:!0}],n=`${Nr.tr("phrases.export")}: ${Nr.tr("trn")}`;ir({title:n,content:t.tournamentName,buttons:i})}function hN(t){var n,r,a,o,s;const e=((n=t.tournamentName)==null?void 0:n.toLowerCase())||"Error",i=(a=(r=t.onlineResources)==null?void 0:r.find(({name:l,resourceType:c})=>l==="tournamentImage"&&c==="URL"))==null?void 0:a.identifier;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:(o=new Date(t.startDate).toISOString())==null?void 0:o.split("T")[0],endDate:(s=new Date(t.endDate).toISOString())==null?void 0:s.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i}}}const UI=t=>{let e;const i=Array.isArray(t)?t:[t];return n=>{if(e&&i.forEach(r=>r.removeFilter(e)),n){const r=n==null?void 0:n.toLowerCase();e=a=>{var o;return(o=a.searchText)==null?void 0:o.includes(r)},i.forEach(a=>a.addFilter(e))}else e=void 0}};function k3e({callback:t,autoClose:e=!0}={}){const i=s=>{const l=s.name.split(".").reverse()[0];let c=new FileReader;c.onload=function(u){if(u.target.error){console.log("file error",u.target.error);return}let d=u.target.result;d.length&&(pt(t)?t(d):console.log(d))},["csv","json"].includes(l)?c.readAsText(s):console.log("not loaded")},n=document.createElement("div");n.className="dzx-dropzone",n.id="tmxDropzone";const r=document.createElement("label");r.className="dzx-inputLabel",r.innerHTML="Drag and Drop files into this zone";const a=document.createElement("input");a.className="dzx-input",a.setAttribute("type","file"),a.setAttribute("accept","application/json"),r.appendChild(a),n.appendChild(r),ir({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:n}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(s=>{n.addEventListener(s,function(l){l.preventDefault(),l.stopPropagation()})});const o="dropone-dragging";n.addEventListener("dragover",function(){this.classList.add(o)},!1),n.addEventListener("dragleave",function(){this.classList.remove(o)},!1),n.addEventListener("drop",function(s){const l=a.getAttribute("multiple");this.classList.remove(o);const c=s.dataTransfer.files,u=new DataTransfer;Array.prototype.forEach.call(c,p=>{if(u.items.add(p),!l)return!1});const d=u.files;Array.from(d).forEach(i),e&&Mw()},!1)}const Ar=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ja=Object.keys,os=Array.isArray;function Zs(t,e){return typeof e!="object"||ja(e).forEach(function(i){t[i]=e[i]}),t}typeof Promise>"u"||Ar.Promise||(Ar.Promise=Promise);const GU=Object.getPrototypeOf,O3e={}.hasOwnProperty;function _c(t,e){return O3e.call(t,e)}function Rw(t,e){typeof e=="function"&&(e=e(GU(t))),(typeof Reflect>"u"?ja:Reflect.ownKeys)(e).forEach(i=>{Fh(t,i,e[i])})}const bIe=Object.defineProperty;function Fh(t,e,i,n){bIe(t,e,Zs(i&&_c(i,"get")&&typeof i.get=="function"?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},n))}function Tb(t){return{from:function(e){return t.prototype=Object.create(e.prototype),Fh(t.prototype,"constructor",t),{extend:Rw.bind(null,t.prototype)}}}}const x3e=Object.getOwnPropertyDescriptor;function O5(t,e){let i;return x3e(t,e)||(i=GU(t))&&O5(i,e)}const L3e=[].slice;function fN(t,e,i){return L3e.call(t,e,i)}function wIe(t,e){return e(t)}function KS(t){if(!t)throw new Error("Assertion Failed")}function SIe(t){Ar.setImmediate?setImmediate(t):setTimeout(t,0)}function TIe(t,e){return t.reduce((i,n,r)=>{var a=e(n,r);return a&&(i[a[0]]=a[1]),i},{})}function $h(t,e){if(typeof e=="string"&&_c(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var i=[],n=0,r=e.length;n<r;++n){var a=$h(t,e[n]);i.push(a)}return i}var o=e.indexOf(".");if(o!==-1){var s=t[e.substr(0,o)];return s===void 0?void 0:$h(s,e.substr(o+1))}}function ad(t,e,i){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){KS(typeof i!="string"&&"length"in i);for(var n=0,r=e.length;n<r;++n)ad(t,e[n],i[n])}else{var a=e.indexOf(".");if(a!==-1){var o=e.substr(0,a),s=e.substr(a+1);if(s==="")i===void 0?os(t)&&!isNaN(parseInt(o))?t.splice(o,1):delete t[o]:t[o]=i;else{var l=t[o];l&&_c(t,o)||(l=t[o]={}),ad(l,s,i)}}else i===void 0?os(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=i}}function UIe(t){var e={};for(var i in t)_c(t,i)&&(e[i]=t[i]);return e}const F3e=[].concat;function DIe(t){return F3e.apply([],t)}const PIe="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(DIe([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>Ar[t]),$3e=PIe.map(t=>Ar[t]);TIe(PIe,t=>[t,!0]);let um=null;function eE(t){um=typeof WeakMap<"u"&&new WeakMap;const e=ZB(t);return um=null,e}function ZB(t){if(!t||typeof t!="object")return t;let e=um&&um.get(t);if(e)return e;if(os(t)){e=[],um&&um.set(t,e);for(var i=0,n=t.length;i<n;++i)e.push(ZB(t[i]))}else if($3e.indexOf(t.constructor)>=0)e=t;else{const a=GU(t);for(var r in e=a===Object.prototype?{}:Object.create(a),um&&um.set(t,e),t)_c(t,r)&&(e[r]=ZB(t[r]))}return e}const{toString:B3e}={};function XB(t){return B3e.call(t).slice(8,-1)}const JB=typeof Symbol<"u"?Symbol.iterator:"@@iterator",V3e=typeof JB=="symbol"?function(t){var e;return t!=null&&(e=t[JB])&&e.apply(t)}:function(){return null},ab={};function Nh(t){var e,i,n,r;if(arguments.length===1){if(os(t))return t.slice();if(this===ab&&typeof t=="string")return[t];if(r=V3e(t)){for(i=[];!(n=r.next()).done;)i.push(n.value);return i}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(i=new Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=new Array(e);e--;)i[e]=arguments[e];return i}const x5=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var rh=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function CIe(t,e){rh=t,EIe=e}var EIe=()=>!0;const j3e=!new Error("").stack;function DI(){if(j3e)try{throw DI.arguments,new Error}catch(t){return t}return new Error}function QB(t,e){var i=t.stack;return i?(e=e||0,i.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),i.split(`
`).slice(e).filter(EIe).map(n=>`
`+n).join("")):""}var MIe=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],L5=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(MIe),G3e={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function Ub(t,e){this._e=DI(),this.name=t,this.message=e}function RIe(t,e){return t+". Errors: "+Object.keys(e).map(i=>e[i].toString()).filter((i,n,r)=>r.indexOf(i)===n).join(`
`)}function mN(t,e,i,n){this._e=DI(),this.failures=e,this.failedKeys=n,this.successCount=i,this.message=RIe(t,e)}function ST(t,e){this._e=DI(),this.name="BulkError",this.failures=Object.keys(e).map(i=>e[i]),this.failuresByPos=e,this.message=RIe(t,e)}Tb(Ub).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+QB(this._e,2))}},toString:function(){return this.name+": "+this.message}}),Tb(mN).from(Ub),Tb(ST).from(Ub);var F5=L5.reduce((t,e)=>(t[e]=e+"Error",t),{});const H3e=Ub;var li=L5.reduce((t,e)=>{var i=e+"Error";function n(r,a){this._e=DI(),this.name=i,r?typeof r=="string"?(this.message=`${r}${a?`
 `+a:""}`,this.inner=a||null):typeof r=="object"&&(this.message=`${r.name} ${r.message}`,this.inner=r):(this.message=G3e[e]||i,this.inner=null)}return Tb(n).from(H3e),t[e]=n,t},{});li.Syntax=SyntaxError,li.Type=TypeError,li.Range=RangeError;var y8=MIe.reduce((t,e)=>(t[e+"Error"]=li[e],t),{}),fM=L5.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=li[e]),t),{});function ur(){}function HU(t){return t}function z3e(t,e){return t==null||t===HU?e:function(i){return e(t(i))}}function gy(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function W3e(t,e){return t===ur?e:function(){var i=t.apply(this,arguments);i!==void 0&&(arguments[0]=i);var n=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?gy(n,this.onsuccess):n),r&&(this.onerror=this.onerror?gy(r,this.onerror):r),a!==void 0?a:i}}function q3e(t,e){return t===ur?e:function(){t.apply(this,arguments);var i=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?gy(i,this.onsuccess):i),n&&(this.onerror=this.onerror?gy(n,this.onerror):n)}}function K3e(t,e){return t===ur?e:function(i){var n=t.apply(this,arguments);Zs(i,n);var r=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?gy(r,this.onsuccess):r),a&&(this.onerror=this.onerror?gy(a,this.onerror):a),n===void 0?o===void 0?void 0:o:Zs(n,o)}}function Y3e(t,e){return t===ur?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function $5(t,e){return t===ur?e:function(){var i=t.apply(this,arguments);if(i&&typeof i.then=="function"){for(var n=this,r=arguments.length,a=new Array(r);r--;)a[r]=arguments[r];return i.then(function(){return e.apply(n,a)})}return e.apply(this,arguments)}}fM.ModifyError=mN,fM.DexieError=Ub,fM.BulkError=ST;var zU={};const NIe=100,[e2,gN,t2]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,GU(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,GU(e),t]})(),AIe=gN&&gN.then,mM=e2&&e2.constructor,B5=!!t2;var i2=!1,Z3e=t2?()=>{t2.then(ZE)}:Ar.setImmediate?setImmediate.bind(null,ZE):Ar.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{ZE(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(ZE,0)},TT=function(t,e){YS.push([t,e]),vN&&(Z3e(),vN=!1)},n2=!0,vN=!0,Lv=[],gM=[],r2=null,a2=HU,Db={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:w8,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{w8(t[0],t[1])}catch{}})}},Wt=Db,YS=[],Fv=0,vM=[];function Tt(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=ur,this._lib=!1;var e=this._PSD=Wt;if(rh&&(this._stackHolder=DI(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==zU)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&s2(this,this._value))}this._state=null,this._value=null,++e.ref,kIe(this,t)}const o2={get:function(){var t=Wt,e=yN;function i(n,r){var a=!t.global&&(t!==Wt||e!==yN);const o=a&&!cf();var s=new Tt((l,c)=>{V5(this,new _Ie(IN(n,t,a,o),IN(r,t,a,o),l,c,t))});return rh&&LIe(s,this),s}return i.prototype=zU,i},set:function(t){Fh(this,"then",t&&t.prototype===zU?o2:{get:function(){return t},set:o2.set})}};function _Ie(t,e,i,n,r){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=i,this.reject=n,this.psd=r}function kIe(t,e){try{e(i=>{if(t._state===null){if(i===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&tE();i&&typeof i.then=="function"?kIe(t,(r,a)=>{i instanceof Tt?i._then(r,a):i.then(r,a)}):(t._state=!0,t._value=i,OIe(t)),n&&iE()}},s2.bind(null,t))}catch(i){s2(t,i)}}function s2(t,e){if(gM.push(e),t._state===null){var i=t._lib&&tE();e=a2(e),t._state=!1,t._value=e,rh&&e!==null&&typeof e=="object"&&!e._promise&&function(n,r,a){try{n.apply(null,a)}catch(o){r&&r(o)}}(()=>{var n=O5(e,"stack");e._promise=t,Fh(e,"stack",{get:()=>i2?n&&(n.get?n.get.apply(e):n.value):t.stack})}),function(n){Lv.some(r=>r._value===n._value)||Lv.push(n)}(t),OIe(t),i&&iE()}}function OIe(t){var e=t._listeners;t._listeners=[];for(var i=0,n=e.length;i<n;++i)V5(t,e[i]);var r=t._PSD;--r.ref||r.finalize(),Fv===0&&(++Fv,TT(()=>{--Fv==0&&j5()},[]))}function V5(t,e){if(t._state!==null){var i=t._state?e.onFulfilled:e.onRejected;if(i===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Fv,TT(X3e,[i,t,e])}else t._listeners.push(e)}function X3e(t,e,i){try{r2=e;var n,r=e._value;e._state?n=t(r):(gM.length&&(gM=[]),n=t(r),gM.indexOf(r)===-1&&function(a){for(var o=Lv.length;o;)if(Lv[--o]._value===a._value)return void Lv.splice(o,1)}(e)),i.resolve(n)}catch(a){i.reject(a)}finally{r2=null,--Fv==0&&j5(),--i.psd.ref||i.psd.finalize()}}function xIe(t,e,i){if(e.length===i)return e;var n="";if(t._state===!1){var r,a,o=t._value;o!=null?(r=o.name||"Error",a=o.message||o,n=QB(o,0)):(r=o,a=""),e.push(r+(a?": "+a:"")+n)}return rh&&((n=QB(t._stackHolder,2))&&e.indexOf(n)===-1&&e.push(n),t._prev&&xIe(t._prev,e,i)),e}function LIe(t,e){var i=e?e._numPrev+1:0;i<100&&(t._prev=e,t._numPrev=i)}function ZE(){tE()&&iE()}function tE(){var t=n2;return n2=!1,vN=!1,t}function iE(){var t,e,i;do for(;YS.length>0;)for(t=YS,YS=[],i=t.length,e=0;e<i;++e){var n=t[e];n[0].apply(null,n[1])}while(YS.length>0);n2=!0,vN=!0}function j5(){var t=Lv;Lv=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=vM.slice(0),i=e.length;i;)e[--i]()}function XE(t){return new Tt(zU,!1,t)}function Kr(t,e){var i=Wt;return function(){var n=tE(),r=Wt;try{return ig(i,!0),t.apply(this,arguments)}catch(a){e&&e(a)}finally{ig(r,!1),n&&iE()}}}Rw(Tt.prototype,{then:o2,_then:function(t,e){V5(this,new _Ie(null,null,t,e,Wt))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],i=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?i(n):XE(n)):this.then(null,n=>n&&n.name===e?i(n):XE(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),XE(e)))},stack:{get:function(){if(this._stack)return this._stack;try{i2=!0;var t=xIe(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{i2=!1}}},timeout:function(t,e){return t<1/0?new Tt((i,n)=>{var r=setTimeout(()=>n(new li.Timeout(e)),t);this.then(i,n).finally(clearTimeout.bind(null,r))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&Fh(Tt.prototype,Symbol.toStringTag,"Dexie.Promise"),Db.env=FIe(),Rw(Tt,{all:function(){var t=Nh.apply(null,arguments).map(JE);return new Tt(function(e,i){t.length===0&&e([]);var n=t.length;t.forEach((r,a)=>Tt.resolve(r).then(o=>{t[a]=o,--n||e(t)},i))})},resolve:t=>{if(t instanceof Tt)return t;if(t&&typeof t.then=="function")return new Tt((i,n)=>{t.then(i,n)});var e=new Tt(zU,!0,t);return LIe(e,r2),e},reject:XE,race:function(){var t=Nh.apply(null,arguments).map(JE);return new Tt((e,i)=>{t.map(n=>Tt.resolve(n).then(e,i))})},PSD:{get:()=>Wt,set:t=>Wt=t},totalEchoes:{get:()=>yN},newPSD:tg,usePSD:dS,scheduler:{get:()=>TT,set:t=>{TT=t}},rejectionMapper:{get:()=>a2,set:t=>{a2=t}},follow:(t,e)=>new Tt((i,n)=>tg((r,a)=>{var o=Wt;o.unhandleds=[],o.onunhandled=a,o.finalize=gy(function(){(function(s){function l(){s(),vM.splice(vM.indexOf(l),1)}vM.push(l),++Fv,TT(()=>{--Fv==0&&j5()},[])})(()=>{this.unhandleds.length===0?r():a(this.unhandleds[0])})},o.finalize),t()},e,i,n))}),mM&&(mM.allSettled&&Fh(Tt,"allSettled",function(){const t=Nh.apply(null,arguments).map(JE);return new Tt(e=>{t.length===0&&e([]);let i=t.length;const n=new Array(i);t.forEach((r,a)=>Tt.resolve(r).then(o=>n[a]={status:"fulfilled",value:o},o=>n[a]={status:"rejected",reason:o}).then(()=>--i||e(n)))})}),mM.any&&typeof AggregateError<"u"&&Fh(Tt,"any",function(){const t=Nh.apply(null,arguments).map(JE);return new Tt((e,i)=>{t.length===0&&i(new AggregateError([]));let n=t.length;const r=new Array(n);t.forEach((a,o)=>Tt.resolve(a).then(s=>e(s),s=>{r[o]=s,--n||i(new AggregateError(r))}))})}));const as={awaits:0,echoes:0,id:0};var J3e=0,yM=[],LL=0,yN=0,Q3e=0;function tg(t,e,i,n){var r=Wt,a=Object.create(r);a.parent=r,a.ref=0,a.global=!1,a.id=++Q3e;var o=Db.env;a.env=B5?{Promise:Tt,PromiseProp:{value:Tt,configurable:!0,writable:!0},all:Tt.all,race:Tt.race,allSettled:Tt.allSettled,any:Tt.any,resolve:Tt.resolve,reject:Tt.reject,nthen:I8(o.nthen,a),gthen:I8(o.gthen,a)}:{},e&&Zs(a,e),++r.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=dS(a,t,i,n);return a.ref===0&&a.finalize(),s}function uS(){return as.id||(as.id=++J3e),++as.awaits,as.echoes+=NIe,as.id}function cf(){return!!as.awaits&&(--as.awaits==0&&(as.id=0),as.echoes=as.awaits*NIe,!0)}function JE(t){return as.echoes&&t&&t.constructor===mM?(uS(),t.then(e=>(cf(),e),e=>(cf(),ao(e)))):t}function eqe(t){++yN,as.echoes&&--as.echoes!=0||(as.echoes=as.id=0),yM.push(Wt),ig(t,!0)}function tqe(){var t=yM[yM.length-1];yM.pop(),ig(t,!1)}function ig(t,e){var i=Wt;if((e?!as.echoes||LL++&&t===Wt:!LL||--LL&&t===Wt)||$Ie(e?eqe.bind(null,t):tqe),t!==Wt&&(Wt=t,i===Db&&(Db.env=FIe()),B5)){var n=Db.env.Promise,r=t.env;gN.then=r.nthen,n.prototype.then=r.gthen,(i.global||t.global)&&(Object.defineProperty(Ar,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any&&(n.any=r.any))}}function FIe(){var t=Ar.Promise;return B5?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(Ar,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:gN.then,gthen:t.prototype.then}:{}}function dS(t,e,i,n,r){var a=Wt;try{return ig(t,!0),e(i,n,r)}finally{ig(a,!1)}}function $Ie(t){AIe.call(e2,t)}function IN(t,e,i,n){return typeof t!="function"?t:function(){var r=Wt;i&&uS(),ig(e,!0);try{return t.apply(this,arguments)}finally{ig(r,!1),n&&$Ie(cf)}}}function I8(t,e){return function(i,n){return t.call(this,IN(i,e),IN(n,e))}}(""+AIe).indexOf("[native code]")===-1&&(uS=cf=ur);const b8="unhandledrejection";function w8(t,e){var i;try{i=e.onuncatched(t)}catch{}if(i!==!1)try{var n,r={promise:e,reason:t};if(Ar.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(b8,!0,!0),Zs(n,r)):Ar.CustomEvent&&Zs(n=new CustomEvent(b8,{detail:r}),r),n&&Ar.dispatchEvent&&(dispatchEvent(n),!Ar.PromiseRejectionEvent&&Ar.onunhandledrejection))try{Ar.onunhandledrejection(n)}catch{}rh&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var ao=Tt.reject;function l2(t,e,i,n){if(t.idbdb&&(t._state.openComplete||Wt.letThrough||t._vip)){var r=t._createTransaction(e,i,t._dbSchema);try{r.create(),t._state.PR1398_maxLoop=3}catch(a){return a.name===F5.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>l2(t,e,i,n))):ao(a)}return r._promise(e,(a,o)=>tg(()=>(Wt.trans=r,n(a,o,r)))).then(a=>r._completion.then(()=>a))}if(t._state.openComplete)return ao(new li.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return ao(new li.DatabaseClosed);t.open().catch(ur)}return t._state.dbReadyPromise.then(()=>l2(t,e,i,n))}const S8="3.2.5",uv="￿",c2=-1/0,yh="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",BIe="String expected.",UT=[],ex=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),iqe=ex,nqe=ex,VIe=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),tx="__dbnames",FL="readonly",$L="readwrite";function vy(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const jIe={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function QE(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=eE(e))[t],e)}class rqe{_trans(e,i,n){const r=this._tx||Wt.trans,a=this.name;function o(l,c,u){if(!u.schema[a])throw new li.NotFound("Table "+a+" not part of transaction");return i(u.idbtrans,u)}const s=tE();try{return r&&r.db===this.db?r===Wt.trans?r._promise(e,o,n):tg(()=>r._promise(e,o,n),{trans:r,transless:Wt.transless||Wt}):l2(this.db,e,[this.name],o)}finally{s&&iE()}}get(e,i){return e&&e.constructor===Object?this.where(e).first(i):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(r=>this.hook.reading.fire(r))).then(i)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(os(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const i=ja(e);if(i.length===1)return this.where(i[0]).equals(e[i[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(c=>{if(c.compound&&i.every(u=>c.keyPath.indexOf(u)>=0)){for(let u=0;u<i.length;++u)if(i.indexOf(c.keyPath[u])===-1)return!1;return!0}return!1}).sort((c,u)=>c.keyPath.length-u.keyPath.length)[0];if(n&&this.db._maxKey!==uv){const c=n.keyPath.slice(0,i.length);return this.where(c).equals(c.map(u=>e[u]))}!n&&rh&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${i.join("+")}]`);const{idxByName:r}=this.schema,a=this.db._deps.indexedDB;function o(c,u){try{return a.cmp(c,u)===0}catch{return!1}}const[s,l]=i.reduce(([c,u],d)=>{const p=r[d],h=e[d];return[c||p,c||!p?vy(u,p&&p.multi?f=>{const m=$h(f,d);return os(m)&&m.some(g=>o(h,g))}:f=>o(h,$h(f,d))):u]},[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(l):n?this.filter(l):this.where(i).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,os(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const i=n=>{if(!n)return n;const r=Object.create(e.prototype);for(var a in n)if(_c(n,a))try{r[a]=n[a]}catch{}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),e}defineClass(){return this.mapToClass(function(e){Zs(this,e)})}add(e,i){const{auto:n,keyPath:r}=this.schema.primKey;let a=e;return r&&n&&(a=QE(r)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"add",keys:i!=null?[i]:null,values:[a]})).then(o=>o.numFailures?Tt.reject(o.failures[0]):o.lastResult).then(o=>{if(r)try{ad(e,r,o)}catch{}return o})}update(e,i){if(typeof e!="object"||os(e))return this.where(":id").equals(e).modify(i);{const n=$h(e,this.schema.primKey.keyPath);if(n===void 0)return ao(new li.InvalidArgument("Given object does not contain its primary key"));try{typeof i!="function"?ja(i).forEach(r=>{ad(e,r,i[r])}):i(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(i)}}put(e,i){const{auto:n,keyPath:r}=this.schema.primKey;let a=e;return r&&n&&(a=QE(r)(e)),this._trans("readwrite",o=>this.core.mutate({trans:o,type:"put",values:[a],keys:i!=null?[i]:null})).then(o=>o.numFailures?Tt.reject(o.failures[0]):o.lastResult).then(o=>{if(r)try{ad(e,r,o)}catch{}return o})}delete(e){return this._trans("readwrite",i=>this.core.mutate({trans:i,type:"delete",keys:[e]})).then(i=>i.numFailures?Tt.reject(i.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:jIe})).then(e=>e.numFailures?Tt.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",i=>this.core.getMany({keys:e,trans:i}).then(n=>n.map(r=>this.hook.reading.fire(r))))}bulkAdd(e,i,n){const r=Array.isArray(i)?i:void 0,a=(n=n||(r?void 0:i))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:s,keyPath:l}=this.schema.primKey;if(l&&r)throw new li.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new li.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let u=l&&s?e.map(QE(l)):e;return this.core.mutate({trans:o,type:"add",keys:r,values:u,wantResults:a}).then(({numFailures:d,results:p,lastResult:h,failures:f})=>{if(d===0)return a?p:h;throw new ST(`${this.name}.bulkAdd(): ${d} of ${c} operations failed`,f)})})}bulkPut(e,i,n){const r=Array.isArray(i)?i:void 0,a=(n=n||(r?void 0:i))?n.allKeys:void 0;return this._trans("readwrite",o=>{const{auto:s,keyPath:l}=this.schema.primKey;if(l&&r)throw new li.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new li.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let u=l&&s?e.map(QE(l)):e;return this.core.mutate({trans:o,type:"put",keys:r,values:u,wantResults:a}).then(({numFailures:d,results:p,lastResult:h,failures:f})=>{if(d===0)return a?p:h;throw new ST(`${this.name}.bulkPut(): ${d} of ${c} operations failed`,f)})})}bulkDelete(e){const i=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:r,failures:a})=>{if(n===0)return r;throw new ST(`${this.name}.bulkDelete(): ${n} of ${i} operations failed`,a)})}}function DT(t){var e={},i=function(o,s){if(s){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[o].subscribe.apply(null,c),t}if(typeof o=="string")return e[o]};i.addEventType=a;for(var n=1,r=arguments.length;n<r;++n)a(arguments[n]);return i;function a(o,s,l){if(typeof o!="object"){var c;s||(s=Y3e),l||(l=ur);var u={subscribers:[],fire:l,subscribe:function(d){u.subscribers.indexOf(d)===-1&&(u.subscribers.push(d),u.fire=s(u.fire,d))},unsubscribe:function(d){u.subscribers=u.subscribers.filter(function(p){return p!==d}),u.fire=u.subscribers.reduce(s,l)}};return e[o]=i[o]=u,u}ja(c=o).forEach(function(d){var p=c[d];if(os(p))a(d,c[d][0],c[d][1]);else{if(p!=="asap")throw new li.InvalidArgument("Invalid event config");var h=a(d,HU,function(){for(var f=arguments.length,m=new Array(f);f--;)m[f]=arguments[f];h.subscribers.forEach(function(g){SIe(function(){g.apply(null,m)})})})}})}}function CS(t,e){return Tb(e).from({prototype:t}),e}function GI(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function BL(t,e){t.filter=vy(t.filter,e)}function VL(t,e,i){var n=t.replayFilter;t.replayFilter=n?()=>vy(n(),e()):e,t.justLimit=i&&!n}function IM(t,e){if(t.isPrimKey)return e.primaryKey;const i=e.getIndexByKeyPath(t.index);if(!i)throw new li.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return i}function T8(t,e,i){const n=IM(t,e.schema);return e.openCursor({trans:i,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function e1(t,e,i,n){const r=t.replayFilter?vy(t.filter,t.replayFilter()):t.filter;if(t.or){const a={},o=(s,l,c)=>{if(!r||r(l,c,p=>l.stop(p),p=>l.fail(p))){var u=l.primaryKey,d=""+u;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(u)),_c(a,d)||(a[d]=!0,e(s,l,c))}};return Promise.all([t.or._iterate(o,i),U8(T8(t,n,i),t.algorithm,o,!t.keysOnly&&t.valueMapper)])}return U8(T8(t,n,i),vy(t.algorithm,r),e,!t.keysOnly&&t.valueMapper)}function U8(t,e,i,n){var r=Kr(n?(a,o,s)=>i(n(a),o,s):i);return t.then(a=>{if(a)return a.start(()=>{var o=()=>a.continue();e&&!e(a,s=>o=s,s=>{a.stop(s),o=ur},s=>{a.fail(s),o=ur})||r(a.value,a,s=>o=s),o()})})}function Ms(t,e){try{const i=D8(t),n=D8(e);if(i!==n)return i==="Array"?1:n==="Array"?-1:i==="binary"?1:n==="binary"?-1:i==="string"?1:n==="string"?-1:i==="Date"?1:n!=="Date"?NaN:-1;switch(i){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(r,a){const o=r.length,s=a.length,l=o<s?o:s;for(let c=0;c<l;++c)if(r[c]!==a[c])return r[c]<a[c]?-1:1;return o===s?0:o<s?-1:1}(P8(t),P8(e));case"Array":return function(r,a){const o=r.length,s=a.length,l=o<s?o:s;for(let c=0;c<l;++c){const u=Ms(r[c],a[c]);if(u!==0)return u}return o===s?0:o<s?-1:1}(t,e)}}catch{}return NaN}function D8(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const i=XB(t);return i==="ArrayBuffer"?"binary":i}function P8(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class aqe{_read(e,i){var n=this._ctx;return n.error?n.table._trans(null,ao.bind(null,n.error)):n.table._trans("readonly",e).then(i)}_write(e){var i=this._ctx;return i.error?i.table._trans(null,ao.bind(null,i.error)):i.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var i=this._ctx;i.algorithm=vy(i.algorithm,e)}_iterate(e,i){return e1(this._ctx,e,i,this._ctx.table.core)}clone(e){var i=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&Zs(n,e),i._ctx=n,i}raw(){return this._ctx.valueMapper=null,this}each(e){var i=this._ctx;return this._read(n=>e1(i,e,n,i.table.core))}count(e){return this._read(i=>{const n=this._ctx,r=n.table.core;if(GI(n,!0))return r.count({trans:i,query:{index:IM(n,r.schema),range:n.range}}).then(o=>Math.min(o,n.limit));var a=0;return e1(n,()=>(++a,!1),i,r).then(()=>a)}).then(e)}sortBy(e,i){const n=e.split(".").reverse(),r=n[0],a=n.length-1;function o(c,u){return u?o(c[n[u]],u-1):c[r]}var s=this._ctx.dir==="next"?1:-1;function l(c,u){var d=o(c,a),p=o(u,a);return d<p?-s:d>p?s:0}return this.toArray(function(c){return c.sort(l)}).then(i)}toArray(e){return this._read(i=>{var n=this._ctx;if(n.dir==="next"&&GI(n,!0)&&n.limit>0){const{valueMapper:r}=n,a=IM(n,n.table.core.schema);return n.table.core.query({trans:i,limit:n.limit,values:!0,query:{index:a,range:n.range}}).then(({result:o})=>r?o.map(r):o)}{const r=[];return e1(n,a=>r.push(a),i,n.table.core).then(()=>r)}},e)}offset(e){var i=this._ctx;return e<=0||(i.offset+=e,GI(i)?VL(i,()=>{var n=e;return(r,a)=>n===0||(n===1?(--n,!1):(a(()=>{r.advance(n),n=0}),!1))}):VL(i,()=>{var n=e;return()=>--n<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),VL(this._ctx,()=>{var i=e;return function(n,r,a){return--i<=0&&r(a),i>=0}},!0),this}until(e,i){return BL(this._ctx,function(n,r,a){return!e(n.value)||(r(a),i)}),this}first(e){return this.limit(1).toArray(function(i){return i[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var i,n;return BL(this._ctx,function(r){return e(r.value)}),i=this._ctx,n=e,i.isMatch=vy(i.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(n,r){e(r.key,r)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(n,r){e(r.primaryKey,r)})}keys(e){var i=this._ctx;i.keysOnly=!i.isMatch;var n=[];return this.each(function(r,a){n.push(a.key)}).then(function(){return n}).then(e)}primaryKeys(e){var i=this._ctx;if(i.dir==="next"&&GI(i,!0)&&i.limit>0)return this._read(r=>{var a=IM(i,i.table.core.schema);return i.table.core.query({trans:r,values:!1,limit:i.limit,query:{index:a,range:i.range}})}).then(({result:r})=>r).then(e);i.keysOnly=!i.isMatch;var n=[];return this.each(function(r,a){n.push(a.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(i){return i[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,i=e.index&&e.table.schema.idxByName[e.index];if(!i||!i.multi)return this;var n={};return BL(this._ctx,function(r){var a=r.primaryKey.toString(),o=_c(n,a);return n[a]=!0,!o}),this}modify(e){var i=this._ctx;return this._write(n=>{var r;if(typeof e=="function")r=e;else{var a=ja(e),o=a.length;r=function(m){for(var g=!1,v=0;v<o;++v){var y=a[v],I=e[y];$h(m,y)!==I&&(ad(m,y,I),g=!0)}return g}}const s=i.table.core,{outbound:l,extractKey:c}=s.schema.primaryKey,u=this.db._options.modifyChunkSize||200,d=[];let p=0;const h=[],f=(m,g)=>{const{failures:v,numFailures:y}=g;p+=m-y;for(let I of ja(v))d.push(v[I])};return this.clone().primaryKeys().then(m=>{const g=v=>{const y=Math.min(u,m.length-v);return s.getMany({trans:n,keys:m.slice(v,v+y),cache:"immutable"}).then(I=>{const b=[],D=[],w=l?[]:null,S=[];for(let C=0;C<y;++C){const E=I[C],P={value:eE(E),primKey:m[v+C]};r.call(P,P.value,P)!==!1&&(P.value==null?S.push(m[v+C]):l||Ms(c(E),c(P.value))===0?(D.push(P.value),l&&w.push(m[v+C])):(S.push(m[v+C]),b.push(P.value)))}const U=GI(i)&&i.limit===1/0&&(typeof e!="function"||e===jL)&&{index:i.index,range:i.range};return Promise.resolve(b.length>0&&s.mutate({trans:n,type:"add",values:b}).then(C=>{for(let E in C.failures)S.splice(parseInt(E),1);f(b.length,C)})).then(()=>(D.length>0||U&&typeof e=="object")&&s.mutate({trans:n,type:"put",keys:w,values:D,criteria:U,changeSpec:typeof e!="function"&&e}).then(C=>f(D.length,C))).then(()=>(S.length>0||U&&e===jL)&&s.mutate({trans:n,type:"delete",keys:S,criteria:U}).then(C=>f(S.length,C))).then(()=>m.length>v+y&&g(v+u))})};return g(0).then(()=>{if(d.length>0)throw new mN("Error modifying one or more objects",d,p,h);return m.length})})})}delete(){var e=this._ctx,i=e.range;return GI(e)&&(e.isPrimKey&&!nqe||i.type===3)?this._write(n=>{const{primaryKey:r}=e.table.core.schema,a=i;return e.table.core.count({trans:n,query:{index:r,range:a}}).then(o=>e.table.core.mutate({trans:n,type:"deleteRange",range:a}).then(({failures:s,lastResult:l,results:c,numFailures:u})=>{if(u)throw new mN("Could not delete some values",Object.keys(s).map(d=>s[d]),o-u);return o-u}))}):this.modify(jL)}}const jL=(t,e)=>e.value=null;function oqe(t,e){return t<e?-1:t===e?0:1}function sqe(t,e){return t>e?-1:t===e?0:1}function oc(t,e,i){var n=t instanceof HIe?new t.Collection(t):t;return n._ctx.error=i?new i(e):new TypeError(e),n}function HI(t){return new t.Collection(t,()=>GIe("")).limit(0)}function lqe(t,e,i,n,r,a){for(var o=Math.min(t.length,n.length),s=-1,l=0;l<o;++l){var c=e[l];if(c!==n[l])return r(t[l],i[l])<0?t.substr(0,l)+i[l]+i.substr(l+1):r(t[l],n[l])<0?t.substr(0,l)+n[l]+i.substr(l+1):s>=0?t.substr(0,s)+e[s]+i.substr(s+1):null;r(t[l],c)<0&&(s=l)}return o<n.length&&a==="next"?t+i.substr(t.length):o<t.length&&a==="prev"?t.substr(0,i.length):s<0?null:t.substr(0,s)+n[s]+i.substr(s+1)}function t1(t,e,i,n){var r,a,o,s,l,c,u,d=i.length;if(!i.every(m=>typeof m=="string"))return oc(t,BIe);function p(m){r=function(v){return v==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(m),a=function(v){return v==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(m),o=m==="next"?oqe:sqe;var g=i.map(function(v){return{lower:a(v),upper:r(v)}}).sort(function(v,y){return o(v.lower,y.lower)});s=g.map(function(v){return v.upper}),l=g.map(function(v){return v.lower}),c=m,u=m==="next"?"":n}p("next");var h=new t.Collection(t,()=>om(s[0],l[d-1]+n));h._ondirectionchange=function(m){p(m)};var f=0;return h._addAlgorithm(function(m,g,v){var y=m.key;if(typeof y!="string")return!1;var I=a(y);if(e(I,l,f))return!0;for(var b=null,D=f;D<d;++D){var w=lqe(y,I,s[D],l[D],o,c);w===null&&b===null?f=D+1:(b===null||o(b,w)>0)&&(b=w)}return g(b!==null?function(){m.continue(b+u)}:v),!1}),h}function om(t,e,i,n){return{type:2,lower:t,upper:e,lowerOpen:i,upperOpen:n}}function GIe(t){return{type:1,lower:t,upper:t}}class HIe{get Collection(){return this._ctx.table.db.Collection}between(e,i,n,r){n=n!==!1,r=r===!0;try{return this._cmp(e,i)>0||this._cmp(e,i)===0&&(n||r)&&(!n||!r)?HI(this):new this.Collection(this,()=>om(e,i,!n,!r))}catch{return oc(this,yh)}}equals(e){return e==null?oc(this,yh):new this.Collection(this,()=>GIe(e))}above(e){return e==null?oc(this,yh):new this.Collection(this,()=>om(e,void 0,!0))}aboveOrEqual(e){return e==null?oc(this,yh):new this.Collection(this,()=>om(e,void 0,!1))}below(e){return e==null?oc(this,yh):new this.Collection(this,()=>om(void 0,e,!1,!0))}belowOrEqual(e){return e==null?oc(this,yh):new this.Collection(this,()=>om(void 0,e))}startsWith(e){return typeof e!="string"?oc(this,BIe):this.between(e,e+uv,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):t1(this,(i,n)=>i.indexOf(n[0])===0,[e],uv)}equalsIgnoreCase(e){return t1(this,(i,n)=>i===n[0],[e],"")}anyOfIgnoreCase(){var e=Nh.apply(ab,arguments);return e.length===0?HI(this):t1(this,(i,n)=>n.indexOf(i)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Nh.apply(ab,arguments);return e.length===0?HI(this):t1(this,(i,n)=>n.some(r=>i.indexOf(r)===0),e,uv)}anyOf(){const e=Nh.apply(ab,arguments);let i=this._cmp;try{e.sort(i)}catch{return oc(this,yh)}if(e.length===0)return HI(this);const n=new this.Collection(this,()=>om(e[0],e[e.length-1]));n._ondirectionchange=a=>{i=a==="next"?this._ascending:this._descending,e.sort(i)};let r=0;return n._addAlgorithm((a,o,s)=>{const l=a.key;for(;i(l,e[r])>0;)if(++r,r===e.length)return o(s),!1;return i(l,e[r])===0||(o(()=>{a.continue(e[r])}),!1)}),n}notEqual(e){return this.inAnyRange([[c2,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Nh.apply(ab,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return oc(this,yh)}const i=e.reduce((n,r)=>n?n.concat([[n[n.length-1][1],r]]):[[c2,r]],null);return i.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,i){const n=this._cmp,r=this._ascending,a=this._descending,o=this._min,s=this._max;if(e.length===0)return HI(this);if(!e.every(y=>y[0]!==void 0&&y[1]!==void 0&&r(y[0],y[1])<=0))return oc(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",li.InvalidArgument);const l=!i||i.includeLowers!==!1,c=i&&i.includeUppers===!0;let u,d=r;function p(y,I){return d(y[0],I[0])}try{u=e.reduce(function(y,I){let b=0,D=y.length;for(;b<D;++b){const w=y[b];if(n(I[0],w[1])<0&&n(I[1],w[0])>0){w[0]=o(w[0],I[0]),w[1]=s(w[1],I[1]);break}}return b===D&&y.push(I),y},[]),u.sort(p)}catch{return oc(this,yh)}let h=0;const f=c?y=>r(y,u[h][1])>0:y=>r(y,u[h][1])>=0,m=l?y=>a(y,u[h][0])>0:y=>a(y,u[h][0])>=0;let g=f;const v=new this.Collection(this,()=>om(u[0][0],u[u.length-1][1],!l,!c));return v._ondirectionchange=y=>{y==="next"?(g=f,d=r):(g=m,d=a),u.sort(p)},v._addAlgorithm((y,I,b)=>{for(var D=y.key;g(D);)if(++h,h===u.length)return I(b),!1;return!!function(w){return!f(w)&&!m(w)}(D)||(this._cmp(D,u[h][1])===0||this._cmp(D,u[h][0])===0||I(()=>{d===r?y.continue(u[h][0]):y.continue(u[h][1])}),!1)}),v}startsWithAnyOf(){const e=Nh.apply(ab,arguments);return e.every(i=>typeof i=="string")?e.length===0?HI(this):this.inAnyRange(e.map(i=>[i,i+uv])):oc(this,"startsWithAnyOf() only works with strings")}}function Hd(t){return Kr(function(e){return WU(e),t(e.target.error),!1})}function WU(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const qU="storagemutated",gm="x-storagemutated-1",ng=DT(null,qU);class cqe{_lock(){return KS(!Wt.global),++this._reculock,this._reculock!==1||Wt.global||(Wt.lockOwnerFor=this),this}_unlock(){if(KS(!Wt.global),--this._reculock==0)for(Wt.global||(Wt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dS(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&Wt.lockOwnerFor!==this}create(e){if(!this.mode)return this;const i=this.db.idbdb,n=this.db._state.dbOpenError;if(KS(!this.idbtrans),!e&&!i)switch(n&&n.name){case"DatabaseClosedError":throw new li.DatabaseClosed(n);case"MissingAPIError":throw new li.MissingAPI(n.message,n);default:throw new li.OpenFailed(n)}if(!this.active)throw new li.TransactionInactive;return KS(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):i.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=Kr(r=>{WU(r),this._reject(e.error)}),e.onabort=Kr(r=>{WU(r),this.active&&this._reject(new li.Abort(e.error)),this.active=!1,this.on("abort").fire(r)}),e.oncomplete=Kr(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&ng.storagemutated.fire(e.mutatedParts)}),this}_promise(e,i,n){if(e==="readwrite"&&this.mode!=="readwrite")return ao(new li.ReadOnly("Transaction is readonly"));if(!this.active)return ao(new li.TransactionInactive);if(this._locked())return new Tt((a,o)=>{this._blockedFuncs.push([()=>{this._promise(e,i,n).then(a,o)},Wt])});if(n)return tg(()=>{var a=new Tt((o,s)=>{this._lock();const l=i(o,s,this);l&&l.then&&l.then(o,s)});return a.finally(()=>this._unlock()),a._lib=!0,a});var r=new Tt((a,o)=>{var s=i(a,o,this);s&&s.then&&s.then(a,o)});return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var i=this._root();const n=Tt.resolve(e);if(i._waitingFor)i._waitingFor=i._waitingFor.then(()=>n);else{i._waitingFor=n,i._waitingQueue=[];var r=i.idbtrans.objectStore(i.storeNames[0]);(function o(){for(++i._spinCount;i._waitingQueue.length;)i._waitingQueue.shift()();i._waitingFor&&(r.get(-1/0).onsuccess=o)})()}var a=i._waitingFor;return new Tt((o,s)=>{n.then(l=>i._waitingQueue.push(Kr(o.bind(null,l))),l=>i._waitingQueue.push(Kr(s.bind(null,l)))).finally(()=>{i._waitingFor===a&&(i._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new li.Abort))}table(e){const i=this._memoizedTables||(this._memoizedTables={});if(_c(i,e))return i[e];const n=this.schema[e];if(!n)throw new li.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),i[e]=r,r}}function u2(t,e,i,n,r,a,o){return{name:t,keyPath:e,unique:i,multi:n,auto:r,compound:a,src:(i&&!o?"&":"")+(n?"*":"")+(r?"++":"")+zIe(e)}}function zIe(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function WIe(t,e,i){return{name:t,primKey:e,indexes:i,mappedClass:null,idxByName:TIe(i,n=>[n.name,n])}}let KU=t=>{try{return t.only([[]]),KU=()=>[[]],[[]]}catch{return KU=()=>uv,uv}};function d2(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>$h(n,e)}(t):e=>$h(e,t)}function C8(t){return[].slice.call(t)}let uqe=0;function PT(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function dqe(t,e,i){function n(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:u,lowerOpen:d,upperOpen:p}=l;return c===void 0?u===void 0?null:e.upperBound(u,!!p):u===void 0?e.lowerBound(c,!!d):e.bound(c,u,!!d,!!p)}const{schema:r,hasGetAll:a}=function(l,c){const u=C8(l.objectStoreNames);return{schema:{name:l.name,tables:u.map(d=>c.objectStore(d)).map(d=>{const{keyPath:p,autoIncrement:h}=d,f=os(p),m=p==null,g={},v={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:f,keyPath:p,autoIncrement:h,unique:!0,extractKey:d2(p)},indexes:C8(d.indexNames).map(y=>d.index(y)).map(y=>{const{name:I,unique:b,multiEntry:D,keyPath:w}=y,S={name:I,compound:os(w),keyPath:w,unique:b,multiEntry:D,extractKey:d2(w)};return g[PT(w)]=S,S}),getIndexByKeyPath:y=>g[PT(y)]};return g[":id"]=v.primaryKey,p!=null&&(g[PT(p)]=v.primaryKey),v})},hasGetAll:u.length>0&&"getAll"in c.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,i),o=r.tables.map(l=>function(c){const u=c.name;return{name:u,schema:c,mutate:function({trans:d,type:p,keys:h,values:f,range:m}){return new Promise((g,v)=>{g=Kr(g);const y=d.objectStore(u),I=y.keyPath==null,b=p==="put"||p==="add";if(!b&&p!=="delete"&&p!=="deleteRange")throw new Error("Invalid operation type: "+p);const{length:D}=h||f||{length:1};if(h&&f&&h.length!==f.length)throw new Error("Given keys array must have same length as given values array.");if(D===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let w;const S=[],U=[];let C=0;const E=M=>{++C,WU(M)};if(p==="deleteRange"){if(m.type===4)return g({numFailures:C,failures:U,results:[],lastResult:void 0});m.type===3?S.push(w=y.clear()):S.push(w=y.delete(n(m)))}else{const[M,N]=b?I?[f,h]:[f,null]:[h,null];if(b)for(let R=0;R<D;++R)S.push(w=N&&N[R]!==void 0?y[p](M[R],N[R]):y[p](M[R])),w.onerror=E;else for(let R=0;R<D;++R)S.push(w=y[p](M[R])),w.onerror=E}const P=M=>{const N=M.target.result;S.forEach((R,A)=>R.error!=null&&(U[A]=R.error)),g({numFailures:C,failures:U,results:p==="delete"?h:S.map(R=>R.result),lastResult:N})};w.onerror=M=>{E(M),P(M)},w.onsuccess=P})},getMany:({trans:d,keys:p})=>new Promise((h,f)=>{h=Kr(h);const m=d.objectStore(u),g=p.length,v=new Array(g);let y,I=0,b=0;const D=S=>{const U=S.target;v[U._pos]=U.result,++b===I&&h(v)},w=Hd(f);for(let S=0;S<g;++S)p[S]!=null&&(y=m.get(p[S]),y._pos=S,y.onsuccess=D,y.onerror=w,++I);I===0&&h(v)}),get:({trans:d,key:p})=>new Promise((h,f)=>{h=Kr(h);const m=d.objectStore(u).get(p);m.onsuccess=g=>h(g.target.result),m.onerror=Hd(f)}),query:function(d){return p=>new Promise((h,f)=>{h=Kr(h);const{trans:m,values:g,limit:v,query:y}=p,I=v===1/0?void 0:v,{index:b,range:D}=y,w=m.objectStore(u),S=b.isPrimaryKey?w:w.index(b.name),U=n(D);if(v===0)return h({result:[]});if(d){const C=g?S.getAll(U,I):S.getAllKeys(U,I);C.onsuccess=E=>h({result:E.target.result}),C.onerror=Hd(f)}else{let C=0;const E=g||!("openKeyCursor"in S)?S.openCursor(U):S.openKeyCursor(U),P=[];E.onsuccess=M=>{const N=E.result;return N?(P.push(g?N.value:N.primaryKey),++C===v?h({result:P}):void N.continue()):h({result:P})},E.onerror=Hd(f)}})}(a),openCursor:function({trans:d,values:p,query:h,reverse:f,unique:m}){return new Promise((g,v)=>{g=Kr(g);const{index:y,range:I}=h,b=d.objectStore(u),D=y.isPrimaryKey?b:b.index(y.name),w=f?m?"prevunique":"prev":m?"nextunique":"next",S=p||!("openKeyCursor"in D)?D.openCursor(n(I),w):D.openKeyCursor(n(I),w);S.onerror=Hd(v),S.onsuccess=Kr(U=>{const C=S.result;if(!C)return void g(null);C.___id=++uqe,C.done=!1;const E=C.continue.bind(C);let P=C.continuePrimaryKey;P&&(P=P.bind(C));const M=C.advance.bind(C),N=()=>{throw new Error("Cursor not stopped")};C.trans=d,C.stop=C.continue=C.continuePrimaryKey=C.advance=()=>{throw new Error("Cursor not started")},C.fail=Kr(v),C.next=function(){let R=1;return this.start(()=>R--?this.continue():this.stop()).then(()=>this)},C.start=R=>{const A=new Promise((O,x)=>{O=Kr(O),S.onerror=Hd(x),C.fail=x,C.stop=F=>{C.stop=C.continue=C.continuePrimaryKey=C.advance=N,O(F)}}),_=()=>{if(S.result)try{R()}catch(O){C.fail(O)}else C.done=!0,C.start=()=>{throw new Error("Cursor behind last entry")},C.stop()};return S.onsuccess=Kr(O=>{S.onsuccess=_,_()}),C.continue=E,C.continuePrimaryKey=P,C.advance=M,_(),A},g(C)},v)})},count({query:d,trans:p}){const{index:h,range:f}=d;return new Promise((m,g)=>{const v=p.objectStore(u),y=h.isPrimaryKey?v:v.index(h.name),I=n(f),b=I?y.count(I):y.count();b.onsuccess=Kr(D=>m(D.target.result)),b.onerror=Hd(g)})}}}(l)),s={};return o.forEach(l=>s[l.name]=l),{stack:"dbcore",transaction:t.transaction.bind(t),table(l){if(!s[l])throw new Error(`Table '${l}' not found`);return s[l]},MIN_KEY:-1/0,MAX_KEY:KU(e),schema:r}}function p2({_novip:t},e){const i=e.db,n=function(r,a,{IDBKeyRange:o,indexedDB:s},l){return{dbcore:function(u,d){return d.reduce((p,{create:h})=>({...p,...h(p)}),u)}(dqe(a,o,l),r.dbcore)}}(t._middlewares,i,t._deps,e);t.core=n.dbcore,t.tables.forEach(r=>{const a=r.name;t.core.schema.tables.some(o=>o.name===a)&&(r.core=t.core.table(a),t[a]instanceof t.Table&&(t[a].core=r.core))})}function bN({_novip:t},e,i,n){i.forEach(r=>{const a=n[r];e.forEach(o=>{const s=O5(o,r);(!s||"value"in s&&s.value===void 0)&&(o===t.Transaction.prototype||o instanceof t.Transaction?Fh(o,r,{get(){return this.table(r)},set(l){bIe(this,r,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):o[r]=new t.Table(r,a))})})}function h2({_novip:t},e){e.forEach(i=>{for(let n in i)i[n]instanceof t.Table&&delete i[n]})}function pqe(t,e){return t._cfg.version-e._cfg.version}function hqe(t,e,i,n){const r=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,r);a.create(i),a._completion.catch(n);const o=a._reject.bind(a),s=Wt.transless||Wt;tg(()=>{Wt.trans=a,Wt.transless=s,e===0?(ja(r).forEach(l=>{GL(i,l,r[l].primKey,r[l].indexes)}),p2(t,i),Tt.follow(()=>t.on.populate.fire(a)).catch(o)):function({_novip:l},c,u,d){const p=[],h=l._versions;let f=l._dbSchema=m2(l,l.idbdb,d),m=!1;const g=h.filter(y=>y._cfg.version>=c);function v(){return p.length?Tt.resolve(p.shift()(u.idbtrans)).then(v):Tt.resolve()}return g.forEach(y=>{p.push(()=>{const I=f,b=y._cfg.dbschema;g2(l,I,d),g2(l,b,d),f=l._dbSchema=b;const D=qIe(I,b);D.add.forEach(S=>{GL(d,S[0],S[1].primKey,S[1].indexes)}),D.change.forEach(S=>{if(S.recreate)throw new li.Upgrade("Not yet support for changing primary key");{const U=d.objectStore(S.name);S.add.forEach(C=>f2(U,C)),S.change.forEach(C=>{U.deleteIndex(C.name),f2(U,C)}),S.del.forEach(C=>U.deleteIndex(C))}});const w=y._cfg.contentUpgrade;if(w&&y._cfg.version>c){p2(l,d),u._memoizedTables={},m=!0;let S=UIe(b);D.del.forEach(P=>{S[P]=I[P]}),h2(l,[l.Transaction.prototype]),bN(l,[l.Transaction.prototype],ja(S),S),u.schema=S;const U=x5(w);let C;U&&uS();const E=Tt.follow(()=>{if(C=w(u),C&&U){var P=cf.bind(null,null);C.then(P,P)}});return C&&typeof C.then=="function"?Tt.resolve(C):E.then(()=>C)}}),p.push(I=>{(!m||!iqe)&&function(b,D){[].slice.call(D.db.objectStoreNames).forEach(w=>b[w]==null&&D.db.deleteObjectStore(w))}(y._cfg.dbschema,I),h2(l,[l.Transaction.prototype]),bN(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),u.schema=l._dbSchema})}),v().then(()=>{var y,I;I=d,ja(y=f).forEach(b=>{I.db.objectStoreNames.contains(b)||GL(I,b,y[b].primKey,y[b].indexes)})})}(t,e,a,i).catch(o)})}function qIe(t,e){const i={del:[],add:[],change:[]};let n;for(n in t)e[n]||i.del.push(n);for(n in e){const r=t[n],a=e[n];if(r){const o={name:n,def:a,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(a.primKey.keyPath||"")||r.primKey.auto!==a.primKey.auto&&!ex)o.recreate=!0,i.change.push(o);else{const s=r.idxByName,l=a.idxByName;let c;for(c in s)l[c]||o.del.push(c);for(c in l){const u=s[c],d=l[c];u?u.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&i.change.push(o)}}else i.add.push([n,a])}return i}function GL(t,e,i,n){const r=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return n.forEach(a=>f2(r,a)),r}function f2(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function m2(t,e,i){const n={};return fN(e.objectStoreNames,0).forEach(r=>{const a=i.objectStore(r);let o=a.keyPath;const s=u2(zIe(o),o||"",!1,!1,!!a.autoIncrement,o&&typeof o!="string",!0),l=[];for(let u=0;u<a.indexNames.length;++u){const d=a.index(a.indexNames[u]);o=d.keyPath;var c=u2(d.name,o,!!d.unique,!!d.multiEntry,!1,o&&typeof o!="string",!1);l.push(c)}n[r]=WIe(r,s,l)}),n}function g2({_novip:t},e,i){const n=i.db.objectStoreNames;for(let r=0;r<n.length;++r){const a=n[r],o=i.objectStore(a);t._hasGetAll="getAll"in o;for(let s=0;s<o.indexNames.length;++s){const l=o.indexNames[s],c=o.index(l).keyPath,u=typeof c=="string"?c:"["+fN(c).join("+")+"]";if(e[a]){const d=e[a].idxByName[u];d&&(d.name=l,delete e[a].idxByName[u],e[a].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Ar.WorkerGlobalScope&&Ar instanceof Ar.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class fqe{_parseStoresSpec(e,i){ja(e).forEach(n=>{if(e[n]!==null){var r=e[n].split(",").map((o,s)=>{const l=(o=o.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return u2(l,c||null,/\&/.test(o),/\*/.test(o),/\+\+/.test(o),os(c),s===0)}),a=r.shift();if(a.multi)throw new li.Schema("Primary key cannot be multi-valued");r.forEach(o=>{if(o.auto)throw new li.Schema("Only primary key can be marked as autoIncrement (++)");if(!o.keyPath)throw new li.Schema("Index must have a name and cannot be an empty string")}),i[n]=WIe(n,a,r)}})}stores(e){const i=this.db;this._cfg.storesSource=this._cfg.storesSource?Zs(this._cfg.storesSource,e):e;const n=i._versions,r={};let a={};return n.forEach(o=>{Zs(r,o._cfg.storesSource),a=o._cfg.dbschema={},o._parseStoresSpec(r,a)}),i._dbSchema=a,h2(i,[i._allTables,i,i.Transaction.prototype]),bN(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],ja(a),a),i._storeNames=ja(a),this}upgrade(e){return this._cfg.contentUpgrade=$5(this._cfg.contentUpgrade||ur,e),this}}function G5(t,e){let i=t._dbNamesDB;return i||(i=t._dbNamesDB=new op(tx,{addons:[],indexedDB:t,IDBKeyRange:e}),i.version(1).stores({dbnames:"name"})),i.table("dbnames")}function H5(t){return t&&typeof t.databases=="function"}function v2(t){return tg(function(){return Wt.letThrough=!0,t()})}function mqe(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function gqe(t){const e=t._state,{indexedDB:i}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?ao(e.dbOpenError):t);rh&&(e.openCanceller._stackHolder=DI()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function r(){if(e.openCanceller!==n)throw new li.DatabaseClosed("db.open() was cancelled")}let a=e.dbReadyResolve,o=null,s=!1;const l=()=>new Tt((c,u)=>{if(r(),!i)throw new li.MissingAPI;const d=t.name,p=e.autoSchema?i.open(d):i.open(d,Math.round(10*t.verno));if(!p)throw new li.MissingAPI;p.onerror=Hd(u),p.onblocked=Kr(t._fireOnBlocked),p.onupgradeneeded=Kr(h=>{if(o=p.transaction,e.autoSchema&&!t._options.allowEmptyDB){p.onerror=WU,o.abort(),p.result.close();const m=i.deleteDatabase(d);m.onsuccess=m.onerror=Kr(()=>{u(new li.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{o.onerror=Hd(u);var f=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;s=f<1,t._novip.idbdb=p.result,hqe(t,f/10,o,u)}},u),p.onsuccess=Kr(()=>{o=null;const h=t._novip.idbdb=p.result,f=fN(h.objectStoreNames);if(f.length>0)try{const g=h.transaction((m=f).length===1?m[0]:m,"readonly");e.autoSchema?function({_novip:v},y,I){v.verno=y.version/10;const b=v._dbSchema=m2(0,y,I);v._storeNames=fN(y.objectStoreNames,0),bN(v,[v._allTables],ja(b),b)}(t,h,g):(g2(t,t._dbSchema,g),function(v,y){const I=qIe(m2(0,v.idbdb,y),v._dbSchema);return!(I.add.length||I.change.some(b=>b.add.length||b.change.length))}(t,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),p2(t,g)}catch{}var m;UT.push(t),h.onversionchange=Kr(g=>{e.vcFired=!0,t.on("versionchange").fire(g)}),h.onclose=Kr(g=>{t.on("close").fire(g)}),s&&function({indexedDB:g,IDBKeyRange:v},y){!H5(g)&&y!==tx&&G5(g,v).put({name:y}).catch(ur)}(t._deps,d),c()},u)}).catch(c=>c&&c.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l()):Tt.reject(c));return Tt.race([n,(typeof navigator>"u"?Tt.resolve():mqe()).then(l)]).then(()=>(r(),e.onReadyBeingFired=[],Tt.resolve(v2(()=>t.on.ready.fire(t.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce($5,ur);return e.onReadyBeingFired=[],Tt.resolve(v2(()=>u(t.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(c=>{e.dbOpenError=c;try{o&&o.abort()}catch{}return n===e.openCanceller&&t._close(),ao(c)}).finally(()=>{e.openComplete=!0,a()})}function y2(t){var e=a=>t.next(a),i=r(e),n=r(a=>t.throw(a));function r(a){return o=>{var s=a(o),l=s.value;return s.done?l:l&&typeof l.then=="function"?l.then(i,n):os(l)?Promise.all(l).then(i,n):i(l)}}return r(e)()}function vqe(t,e,i){var n=arguments.length;if(n<2)throw new li.InvalidArgument("Too few arguments");for(var r=new Array(n-1);--n;)r[n-1]=arguments[n];return i=r.pop(),[t,DIe(r),i]}function KIe(t,e,i,n,r){return Tt.resolve().then(()=>{const a=Wt.transless||Wt,o=t._createTransaction(e,i,t._dbSchema,n),s={trans:o,transless:a};if(n)o.idbtrans=n.idbtrans;else try{o.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===F5.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>KIe(t,e,i,null,r))):ao(d)}const l=x5(r);let c;l&&uS();const u=Tt.follow(()=>{if(c=r.call(o,o),c)if(l){var d=cf.bind(null,null);c.then(d,d)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=y2(c))},s);return(c&&typeof c.then=="function"?Tt.resolve(c).then(d=>o.active?d:ao(new li.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(d=>(n&&o._resolve(),o._completion.then(()=>d))).catch(d=>(o._reject(d),ao(d)))})}function i1(t,e,i){const n=os(t)?t.slice():[t];for(let r=0;r<i;++r)n.push(e);return n}const yqe={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const i=t.table(e),{schema:n}=i,r={},a=[];function o(u,d,p){const h=PT(u),f=r[h]=r[h]||[],m=u==null?0:typeof u=="string"?1:u.length,g=d>0,v={...p,isVirtual:g,keyTail:d,keyLength:m,extractKey:d2(u),unique:!g&&p.unique};return f.push(v),v.isPrimaryKey||a.push(v),m>1&&o(m===2?u[0]:u.slice(0,m-1),d+1,p),f.sort((y,I)=>y.keyTail-I.keyTail),v}const s=o(n.primaryKey.keyPath,0,n.primaryKey);r[":id"]=[s];for(const u of n.indexes)o(u.keyPath,0,u);function l(u){const d=u.query.index;return d.isVirtual?{...u,query:{index:d,range:(p=u.query.range,h=d.keyTail,{type:p.type===1?2:p.type,lower:i1(p.lower,p.lowerOpen?t.MAX_KEY:t.MIN_KEY,h),lowerOpen:!0,upper:i1(p.upper,p.upperOpen?t.MIN_KEY:t.MAX_KEY,h),upperOpen:!0})}}:u;var p,h}return{...i,schema:{...n,primaryKey:s,indexes:a,getIndexByKeyPath:function(u){const d=r[PT(u)];return d&&d[0]}},count:u=>i.count(l(u)),query:u=>i.query(l(u)),openCursor(u){const{keyTail:d,isVirtual:p,keyLength:h}=u.query.index;return p?i.openCursor(l(u)).then(f=>f&&function(m){return Object.create(m,{continue:{value:function(v){v!=null?m.continue(i1(v,u.reverse?t.MAX_KEY:t.MIN_KEY,d)):u.unique?m.continue(m.key.slice(0,h).concat(u.reverse?t.MIN_KEY:t.MAX_KEY,d)):m.continue()}},continuePrimaryKey:{value(v,y){m.continuePrimaryKey(i1(v,t.MAX_KEY,d),y)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const v=m.key;return h===1?v[0]:v.slice(0,h)}},value:{get:()=>m.value}})}(f)):i.openCursor(u)}}}}}};function z5(t,e,i,n){return i=i||{},n=n||"",ja(t).forEach(r=>{if(_c(e,r)){var a=t[r],o=e[r];if(typeof a=="object"&&typeof o=="object"&&a&&o){const s=XB(a);s!==XB(o)?i[n+r]=e[r]:s==="Object"?z5(a,o,i,n+r+"."):a!==o&&(i[n+r]=e[r])}else a!==o&&(i[n+r]=e[r])}else i[n+r]=void 0}),ja(e).forEach(r=>{_c(t,r)||(i[n+r]=e[r])}),i}const Iqe={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const i=t.table(e),{primaryKey:n}=i.schema;return{...i,mutate(a){const o=Wt.trans,{deleting:s,creating:l,updating:c}=o.table(e).hook;switch(a.type){case"add":if(l.fire===ur)break;return o._promise("readwrite",()=>u(a),!0);case"put":if(l.fire===ur&&c.fire===ur)break;return o._promise("readwrite",()=>u(a),!0);case"delete":if(s.fire===ur)break;return o._promise("readwrite",()=>u(a),!0);case"deleteRange":if(s.fire===ur)break;return o._promise("readwrite",()=>function(p){return d(p.trans,p.range,1e4)}(a),!0)}return i.mutate(a);function u(p){const h=Wt.trans,f=p.keys||function(m,g){return g.type==="delete"?g.keys:g.keys||g.values.map(m.extractKey)}(n,p);if(!f)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?{...p,keys:f}:{...p}).type!=="delete"&&(p.values=[...p.values]),p.keys&&(p.keys=[...p.keys]),function(m,g,v){return g.type==="add"?Promise.resolve([]):m.getMany({trans:g.trans,keys:v,cache:"immutable"})}(i,p,f).then(m=>{const g=f.map((v,y)=>{const I=m[y],b={onerror:null,onsuccess:null};if(p.type==="delete")s.fire.call(b,v,I,h);else if(p.type==="add"||I===void 0){const D=l.fire.call(b,v,p.values[y],h);v==null&&D!=null&&(v=D,p.keys[y]=v,n.outbound||ad(p.values[y],n.keyPath,v))}else{const D=z5(I,p.values[y]),w=c.fire.call(b,D,v,I,h);if(w){const S=p.values[y];Object.keys(w).forEach(U=>{_c(S,U)?S[U]=w[U]:ad(S,U,w[U])})}}return b});return i.mutate(p).then(({failures:v,results:y,numFailures:I,lastResult:b})=>{for(let D=0;D<f.length;++D){const w=y?y[D]:f[D],S=g[D];w==null?S.onerror&&S.onerror(v[D]):S.onsuccess&&S.onsuccess(p.type==="put"&&m[D]?p.values[D]:w)}return{failures:v,results:y,numFailures:I,lastResult:b}}).catch(v=>(g.forEach(y=>y.onerror&&y.onerror(v)),Promise.reject(v)))})}function d(p,h,f){return i.query({trans:p,values:!1,query:{index:n,range:h},limit:f}).then(({result:m})=>u({type:"delete",keys:m,trans:p}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):m.length<f?{failures:[],numFailures:0,lastResult:void 0}:d(p,{...h,lower:m[m.length-1],lowerOpen:!0},f)))}}}}})};function YIe(t,e,i){try{if(!e||e.keys.length<t.length)return null;const n=[];for(let r=0,a=0;r<e.keys.length&&a<t.length;++r)Ms(e.keys[r],t[a])===0&&(n.push(i?eE(e.values[r]):e.values[r]),++a);return n.length===t.length?n:null}catch{return null}}const bqe={stack:"dbcore",level:-1,create:t=>({table:e=>{const i=t.table(e);return{...i,getMany:n=>{if(!n.cache)return i.getMany(n);const r=YIe(n.keys,n.trans._cache,n.cache==="clone");return r?Tt.resolve(r):i.getMany(n).then(a=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?eE(a):a},a))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),i.mutate(n))}}})};function W5(t){return!("from"in t)}const Rh=function(t,e){if(!this){const i=new Rh;return t&&"d"in t&&Zs(i,t),i}Zs(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function YU(t,e,i){const n=Ms(e,i);if(isNaN(n))return;if(n>0)throw RangeError();if(W5(t))return Zs(t,{from:e,to:i,d:1});const r=t.l,a=t.r;if(Ms(i,t.from)<0)return r?YU(r,e,i):t.l={from:e,to:i,d:1,l:null,r:null},E8(t);if(Ms(e,t.to)>0)return a?YU(a,e,i):t.r={from:e,to:i,d:1,l:null,r:null},E8(t);Ms(e,t.from)<0&&(t.from=e,t.l=null,t.d=a?a.d+1:1),Ms(i,t.to)>0&&(t.to=i,t.r=null,t.d=t.l?t.l.d+1:1);const o=!t.r;r&&!t.l&&wN(t,r),a&&o&&wN(t,a)}function wN(t,e){W5(e)||function i(n,{from:r,to:a,l:o,r:s}){YU(n,r,a),o&&i(n,o),s&&i(n,s)}(t,e)}function wqe(t,e){const i=I2(e);let n=i.next();if(n.done)return!1;let r=n.value;const a=I2(t);let o=a.next(r.from),s=o.value;for(;!n.done&&!o.done;){if(Ms(s.from,r.to)<=0&&Ms(s.to,r.from)>=0)return!0;Ms(r.from,s.from)<0?r=(n=i.next(s.from)).value:s=(o=a.next(r.from)).value}return!1}function I2(t){let e=W5(t)?null:{s:0,n:t};return{next(i){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&Ms(i,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||Ms(i,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function E8(t){var e,i;const n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((i=t.l)===null||i===void 0?void 0:i.d)||0),r=n>1?"r":n<-1?"l":"";if(r){const a=r==="r"?"l":"r",o={...t},s=t[r];t.from=s.from,t.to=s.to,t[r]=s[r],o[r]=s[a],t[a]=o,o.d=M8(o)}t.d=M8(t)}function M8({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Rw(Rh.prototype,{add(t){return wN(this,t),this},addKey(t){return YU(this,t,t),this},addKeys(t){return t.forEach(e=>YU(this,e,e)),this},[JB](){return I2(this)}});const Sqe={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,i=new Rh(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{const r=t.table(n),{schema:a}=r,{primaryKey:o}=a,{extractKey:s,outbound:l}=o,c={...r,mutate:p=>{const h=p.trans,f=h.mutatedParts||(h.mutatedParts={}),m=w=>{const S=`idb://${e}/${n}/${w}`;return f[S]||(f[S]=new Rh)},g=m(""),v=m(":dels"),{type:y}=p;let[I,b]=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[];const D=p.trans._cache;return r.mutate(p).then(w=>{if(os(I)){y!=="delete"&&(I=w.results),g.addKeys(I);const S=YIe(I,D);S||y==="add"||v.addKeys(I),(S||b)&&function(U,C,E,P){function M(N){const R=U(N.name||"");function A(O){return O!=null?N.extractKey(O):null}const _=O=>N.multiEntry&&os(O)?O.forEach(x=>R.addKey(x)):R.addKey(O);(E||P).forEach((O,x)=>{const F=E&&A(E[x]),$=P&&A(P[x]);Ms(F,$)!==0&&(F!=null&&_(F),$!=null&&_($))})}C.indexes.forEach(M)}(m,a,S,b)}else if(I){const S={from:I.lower,to:I.upper};v.add(S),g.add(S)}else g.add(i),v.add(i),a.indexes.forEach(S=>m(S.name).add(i));return w})}},u=({query:{index:p,range:h}})=>{var f,m;return[p,new Rh((f=h.lower)!==null&&f!==void 0?f:t.MIN_KEY,(m=h.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},d={get:p=>[o,new Rh(p.key)],getMany:p=>[o,new Rh().addKeys(p.keys)],count:u,query:u,openCursor:u};return ja(d).forEach(p=>{c[p]=function(h){const{subscr:f}=Wt;if(f){const m=b=>{const D=`idb://${e}/${n}/${b}`;return f[D]||(f[D]=new Rh)},g=m(""),v=m(":dels"),[y,I]=d[p](h);if(m(y.name||"").add(I),!y.isPrimaryKey){if(p!=="count"){const b=p==="query"&&l&&h.values&&r.query({...h,values:!1});return r[p].apply(this,arguments).then(D=>{if(p==="query"){if(l&&h.values)return b.then(({result:S})=>(g.addKeys(S),D));const w=h.values?D.result.map(s):D.result;h.values?g.addKeys(w):v.addKeys(w)}else if(p==="openCursor"){const w=D,S=h.values;return w&&Object.create(w,{key:{get:()=>(v.addKey(w.primaryKey),w.key)},primaryKey:{get(){const U=w.primaryKey;return v.addKey(U),U}},value:{get:()=>(S&&g.addKey(w.primaryKey),w.value)}})}return D})}v.add(i)}}return r[p].apply(this,arguments)}}),c}}}};class op{constructor(e,i){this._middlewares={},this.verno=0;const n=op.dependencies;this._options=i={addons:op.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...i},this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange};const{addons:r}=i;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const a={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:ur,dbReadyPromise:null,cancelOpen:ur,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var o;a.dbReadyPromise=new Tt(s=>{a.dbReadyResolve=s}),a.openCanceller=new Tt((s,l)=>{a.cancelOpen=l}),this._state=a,this.name=e,this.on=DT(this,"populate","blocked","versionchange","close",{ready:[$5,ur]}),this.on.ready.subscribe=wIe(this.on.ready.subscribe,s=>(l,c)=>{op.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||Tt.resolve().then(l),c&&s(l);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(l),c&&s(l);else{s(l);const d=this;c||s(function p(){d.on.ready.unsubscribe(l),d.on.ready.unsubscribe(p)})}})}),this.Collection=(o=this,CS(aqe.prototype,function(s,l){this.db=o;let c=jIe,u=null;if(l)try{c=l()}catch(f){u=f}const d=s._ctx,p=d.table,h=p.hook.reading.fire;this._ctx={table:p,index:d.index,isPrimKey:!d.index||p.schema.primKey.keyPath&&d.index===p.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:d.or,valueMapper:h!==HU?h:null}})),this.Table=function(s){return CS(rqe.prototype,function(l,c,u){this.db=s,this._tx=u,this.name=l,this.schema=c,this.hook=s._allTables[l]?s._allTables[l].hook:DT(null,{creating:[W3e,ur],reading:[z3e,HU],updating:[K3e,ur],deleting:[q3e,ur]})})}(this),this.Transaction=function(s){return CS(cqe.prototype,function(l,c,u,d,p){this.db=s,this.mode=l,this.storeNames=c,this.schema=u,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=DT(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Tt((h,f)=>{this._resolve=h,this._reject=f}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},h=>{var f=this.active;return this.active=!1,this.on.error.fire(h),this.parent?this.parent._reject(h):f&&this.idbtrans&&this.idbtrans.abort(),ao(h)})})}(this),this.Version=function(s){return CS(fqe.prototype,function(l){this.db=s,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(s){return CS(HIe.prototype,function(l,c,u){this.db=s,this._ctx={table:l,index:c===":id"?null:c,or:u};const d=s._deps.indexedDB;if(!d)throw new li.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(p,h)=>d.cmp(h,p),this._max=(p,h)=>d.cmp(p,h)>0?p:h,this._min=(p,h)=>d.cmp(p,h)<0?p:h,this._IDBKeyRange=s._deps.IDBKeyRange})}(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=KU(i.IDBKeyRange),this._createTransaction=(s,l,c,u)=>new this.Transaction(s,l,c,this._options.chromeTransactionDurability,u),this._fireOnBlocked=s=>{this.on("blocked").fire(s),UT.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(s))},this.use(yqe),this.use(Iqe),this.use(Sqe),this.use(bqe),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new li.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new li.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const i=this._versions;var n=i.filter(r=>r._cfg.version===e)[0];return n||(n=new this.Version(e),i.push(n),i.sort(pqe),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||Wt.letThrough||this._vip)?e():new Tt((i,n)=>{if(this._state.openComplete)return n(new li.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new li.DatabaseClosed);this.open().catch(ur)}this._state.dbReadyPromise.then(i,n)}).then(e)}use({stack:e,create:i,level:n,name:r}){r&&this.unuse({stack:e,name:r});const a=this._middlewares[e]||(this._middlewares[e]=[]);return a.push({stack:e,create:i,level:n??10,name:r}),a.sort((o,s)=>o.level-s.level),this}unuse({stack:e,name:i,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(r=>n?r.create!==n:!!i&&r.name!==i)),this}open(){return gqe(this)}_close(){const e=this._state,i=UT.indexOf(this);if(i>=0&&UT.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new Tt(n=>{e.dbReadyResolve=n}),e.openCanceller=new Tt((n,r)=>{e.cancelOpen=r})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new li.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,i=this._state;return new Tt((n,r)=>{const a=()=>{this.close();var o=this._deps.indexedDB.deleteDatabase(this.name);o.onsuccess=Kr(()=>{(function({indexedDB:s,IDBKeyRange:l},c){!H5(s)&&c!==tx&&G5(s,l).delete(c).catch(ur)})(this._deps,this.name),n()}),o.onerror=Hd(r),o.onblocked=this._fireOnBlocked};if(e)throw new li.InvalidArgument("Arguments not allowed in db.delete()");i.isBeingOpened?i.dbReadyPromise.then(a):a()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ja(this._allTables).map(e=>this._allTables[e])}transaction(){const e=vqe.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,i,n){let r=Wt.trans;r&&r.db===this&&e.indexOf("!")===-1||(r=null);const a=e.indexOf("?")!==-1;let o,s;e=e.replace("!","").replace("?","");try{if(s=i.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===FL)o=FL;else{if(e!="rw"&&e!=$L)throw new li.InvalidArgument("Invalid transaction mode: "+e);o=$L}if(r){if(r.mode===FL&&o===$L){if(!a)throw new li.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach(c=>{if(r&&r.storeNames.indexOf(c)===-1){if(!a)throw new li.SubTransaction("Table "+c+" not included in parent transaction.");r=null}}),a&&r&&!r.active&&(r=null)}}catch(c){return r?r._promise(null,(u,d)=>{d(c)}):ao(c)}const l=KIe.bind(null,this,o,s,r,n);return r?r._promise(o,l,"lock"):Wt.trans?dS(Wt.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!_c(this._allTables,e))throw new li.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const Tqe=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class Uqe{constructor(e){this._subscribe=e}subscribe(e,i,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:i,complete:n})}[Tqe](){return this}}function ZIe(t,e){return ja(e).forEach(i=>{wN(t[i]||(t[i]=new Rh),e[i])}),t}function Dqe(t){let e,i=!1;const n=new Uqe(r=>{const a=x5(t);let o=!1,s={},l={};const c={get closed(){return o},unsubscribe:()=>{o=!0,ng.storagemutated.unsubscribe(h)}};r.start&&r.start(c);let u=!1,d=!1;function p(){return ja(l).some(m=>s[m]&&wqe(s[m],l[m]))}const h=m=>{ZIe(s,m),p()&&f()},f=()=>{if(u||o)return;s={};const m={},g=function(v){a&&uS();const y=()=>tg(t,{subscr:v,trans:null}),I=Wt.trans?dS(Wt.transless,y):y();return a&&I.then(cf,cf),I}(m);d||(ng(qU,h),d=!0),u=!0,Promise.resolve(g).then(v=>{i=!0,e=v,u=!1,o||(p()?f():(s={},l=m,r.next&&r.next(v)))},v=>{u=!1,i=!1,r.error&&r.error(v),c.unsubscribe()})};return f(),c});return n.hasValue=()=>i,n.getValue=()=>e,n}let b2;try{b2={indexedDB:Ar.indexedDB||Ar.mozIndexedDB||Ar.webkitIndexedDB||Ar.msIndexedDB,IDBKeyRange:Ar.IDBKeyRange||Ar.webkitIDBKeyRange}}catch{b2={indexedDB:null,IDBKeyRange:null}}const qg=op;function bM(t){let e=_h;try{_h=!0,ng.storagemutated.fire(t)}finally{_h=e}}Rw(qg,{...fM,delete:t=>new qg(t,{addons:[]}).delete(),exists:t=>new qg(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:i}){return H5(e)?Promise.resolve(e.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==tx)):G5(e,i).toCollection().primaryKeys()}(qg.dependencies).then(t)}catch{return ao(new li.MissingAPI)}},defineClass:()=>function(t){Zs(this,t)},ignoreTransaction:t=>Wt.trans?dS(Wt.transless,t):t(),vip:v2,async:function(t){return function(){try{var e=y2(t.apply(this,arguments));return e&&typeof e.then=="function"?e:Tt.resolve(e)}catch(i){return ao(i)}}},spawn:function(t,e,i){try{var n=y2(t.apply(i,e||[]));return n&&typeof n.then=="function"?n:Tt.resolve(n)}catch(r){return ao(r)}},currentTransaction:{get:()=>Wt.trans||null},waitFor:function(t,e){const i=Tt.resolve(typeof t=="function"?qg.ignoreTransaction(t):t).timeout(e||6e4);return Wt.trans?Wt.trans.waitFor(i):i},Promise:Tt,debug:{get:()=>rh,set:t=>{CIe(t,t==="dexie"?()=>!0:VIe)}},derive:Tb,extend:Zs,props:Rw,override:wIe,Events:DT,on:ng,liveQuery:Dqe,extendObservabilitySet:ZIe,getByKeyPath:$h,setByKeyPath:ad,delByKeyPath:function(t,e){typeof e=="string"?ad(t,e,void 0):"length"in e&&[].map.call(e,function(i){ad(t,i,void 0)})},shallowClone:UIe,deepClone:eE,getObjectDiff:z5,cmp:Ms,asap:SIe,minKey:c2,addons:[],connections:UT,errnames:F5,dependencies:b2,semVer:S8,version:S8.split(".").map(t=>parseInt(t)).reduce((t,e,i)=>t+e/Math.pow(10,2*i))}),qg.maxKey=KU(qg.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(ng(qU,t=>{if(!_h){let e;ex?(e=document.createEvent("CustomEvent"),e.initCustomEvent(gm,!0,!0,t)):e=new CustomEvent(gm,{detail:t}),_h=!0,dispatchEvent(e),_h=!1}}),addEventListener(gm,({detail:t})=>{_h||bM(t)}));let _h=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(gm);typeof t.unref=="function"&&t.unref(),ng(qU,e=>{_h||t.postMessage(e)}),t.onmessage=e=>{e.data&&bM(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){ng(qU,e=>{try{_h||(typeof localStorage<"u"&&localStorage.setItem(gm,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(i=>i.postMessage({type:gm,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===gm){const i=JSON.parse(e.newValue);i&&bM(i.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===gm&&bM(e.changedParts)})}Tt.rejectionMapper=function(t,e){if(!t||t instanceof Ub||t instanceof TypeError||t instanceof SyntaxError||!t.name||!y8[t.name])return t;var i=new y8[t.name](e||t.message,t);return"stack"in t&&Fh(i,"stack",{get:function(){return this.inner.stack}}),i},CIe(rh,VIe);const Gs=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new op("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(n){return i(n)}}),t.resetDB=e=>{t.dex.close(),op.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{const r=t.dex[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.dex[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,n)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>{t.findWhere(e,i,n).then(o=>r(o!=null&&o.length?o[0]:void 0),a)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((n,r)=>t.dex[e].put(i).then(n,r).catch(a=>{alert("try again:",a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.dex[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return a("exists");t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,n,r,a)=>new Promise((o,s)=>{t.dex[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(o,l=>{console.log("error:",l),s()})}),t}();async function q5(t){var i;const e=(t==null?void 0:t.tournamentRecord)??((i=$e.getTournament())==null?void 0:i.tournamentRecord);await Gs.addTournament(e),pt(t==null?void 0:t.callback)&&t.callback()}function Pqe(t){const e=t.getData().map(i=>i.tournamentId);k3e({callback:i=>{const n=vW({data:i});if(n){let r,a;n.tournamentId&&n.startDate?a=n:n.tuid&&n.start&&ai({message:"TMX Classic file not converted"}),r=$e.setState(a),r.success?ix({tournamentRecord:a,tournamentIds:e,table:t}):console.log(r)}}})}function ix({tournamentRecord:t,tournamentIds:e,table:i,callback:n}){const r=hN(t);(e==null?void 0:e.includes(t.tournamentId))?i==null||i.updateOrAddData([r],!0):i==null||i.addData([r],!0),Cqe({tournamentRecord:t}),pt(n)&&n()}function Cqe({tournamentRecord:t}){q5({tournamentRecord:t,callback:()=>{}})}function XIe(t,e){return function(){return t.apply(e,arguments)}}const{toString:Eqe}=Object.prototype,{getPrototypeOf:K5}=Object,nx=(t=>e=>{const i=Eqe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),ah=t=>(t=t.toLowerCase(),e=>nx(e)===t),rx=t=>e=>typeof e===t,{isArray:pS}=Array,ZU=rx("undefined");function Mqe(t){return t!==null&&!ZU(t)&&t.constructor!==null&&!ZU(t.constructor)&&tu(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const JIe=ah("ArrayBuffer");function Rqe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&JIe(t.buffer),e}const Nqe=rx("string"),tu=rx("function"),QIe=rx("number"),ax=t=>t!==null&&typeof t=="object",Aqe=t=>t===!0||t===!1,wM=t=>{if(nx(t)!=="object")return!1;const e=K5(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},_qe=ah("Date"),kqe=ah("File"),Oqe=ah("Blob"),xqe=ah("FileList"),Lqe=t=>ax(t)&&tu(t.pipe),Fqe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||tu(t.append)&&((e=nx(t))==="formdata"||e==="object"&&tu(t.toString)&&t.toString()==="[object FormData]"))},$qe=ah("URLSearchParams"),Bqe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nE(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),pS(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const a=i?Object.getOwnPropertyNames(t):Object.keys(t),o=a.length;let s;for(n=0;n<o;n++)s=a[n],e.call(null,t[s],s,t)}}function ebe(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const tbe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ibe=t=>!ZU(t)&&t!==tbe;function w2(){const{caseless:t}=ibe(this)&&this||{},e={},i=(n,r)=>{const a=t&&ebe(e,r)||r;wM(e[a])&&wM(n)?e[a]=w2(e[a],n):wM(n)?e[a]=w2({},n):pS(n)?e[a]=n.slice():e[a]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&nE(arguments[n],i);return e}const Vqe=(t,e,i,{allOwnKeys:n}={})=>(nE(e,(r,a)=>{i&&tu(r)?t[a]=XIe(r,i):t[a]=r},{allOwnKeys:n}),t),jqe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Gqe=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},Hqe=(t,e,i,n)=>{let r,a,o;const s={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),a=r.length;a-- >0;)o=r[a],(!n||n(o,t,e))&&!s[o]&&(e[o]=t[o],s[o]=!0);t=i!==!1&&K5(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},zqe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},Wqe=t=>{if(!t)return null;if(pS(t))return t;let e=t.length;if(!QIe(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},qqe=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&K5(Uint8Array)),Kqe=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const a=r.value;e.call(t,a[0],a[1])}},Yqe=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},Zqe=ah("HTMLFormElement"),Xqe=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),R8=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),Jqe=ah("RegExp"),nbe=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};nE(i,(r,a)=>{let o;(o=e(r,a,t))!==!1&&(n[a]=o||r)}),Object.defineProperties(t,n)},Qqe=t=>{nbe(t,(e,i)=>{if(tu(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(tu(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},e4e=(t,e)=>{const i={},n=r=>{r.forEach(a=>{i[a]=!0})};return pS(t)?n(t):n(String(t).split(e)),i},t4e=()=>{},i4e=(t,e)=>(t=+t,Number.isFinite(t)?t:e),HL="abcdefghijklmnopqrstuvwxyz",N8="0123456789",rbe={DIGIT:N8,ALPHA:HL,ALPHA_DIGIT:HL+HL.toUpperCase()+N8},n4e=(t=16,e=rbe.ALPHA_DIGIT)=>{let i="";const{length:n}=e;for(;t--;)i+=e[Math.random()*n|0];return i};function r4e(t){return!!(t&&tu(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const a4e=t=>{const e=new Array(10),i=(n,r)=>{if(ax(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const a=pS(n)?[]:{};return nE(n,(o,s)=>{const l=i(o,r+1);!ZU(l)&&(a[s]=l)}),e[r]=void 0,a}}return n};return i(t,0)},o4e=ah("AsyncFunction"),s4e=t=>t&&(ax(t)||tu(t))&&tu(t.then)&&tu(t.catch),He={isArray:pS,isArrayBuffer:JIe,isBuffer:Mqe,isFormData:Fqe,isArrayBufferView:Rqe,isString:Nqe,isNumber:QIe,isBoolean:Aqe,isObject:ax,isPlainObject:wM,isUndefined:ZU,isDate:_qe,isFile:kqe,isBlob:Oqe,isRegExp:Jqe,isFunction:tu,isStream:Lqe,isURLSearchParams:$qe,isTypedArray:qqe,isFileList:xqe,forEach:nE,merge:w2,extend:Vqe,trim:Bqe,stripBOM:jqe,inherits:Gqe,toFlatObject:Hqe,kindOf:nx,kindOfTest:ah,endsWith:zqe,toArray:Wqe,forEachEntry:Kqe,matchAll:Yqe,isHTMLForm:Zqe,hasOwnProperty:R8,hasOwnProp:R8,reduceDescriptors:nbe,freezeMethods:Qqe,toObjectSet:e4e,toCamelCase:Xqe,noop:t4e,toFiniteNumber:i4e,findKey:ebe,global:tbe,isContextDefined:ibe,ALPHABET:rbe,generateString:n4e,isSpecCompliantForm:r4e,toJSONObject:a4e,isAsyncFn:o4e,isThenable:s4e};function yn(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}He.inherits(yn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:He.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const abe=yn.prototype,obe={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{obe[t]={value:t}});Object.defineProperties(yn,obe);Object.defineProperty(abe,"isAxiosError",{value:!0});yn.from=(t,e,i,n,r,a)=>{const o=Object.create(abe);return He.toFlatObject(t,o,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),yn.call(o,t.message,e,i,n,r),o.cause=t,o.name=t.name,a&&Object.assign(o,a),o};const l4e=null;function S2(t){return He.isPlainObject(t)||He.isArray(t)}function sbe(t){return He.endsWith(t,"[]")?t.slice(0,-2):t}function A8(t,e,i){return t?t.concat(e).map(function(r,a){return r=sbe(r),!i&&a?"["+r+"]":r}).join(i?".":""):e}function c4e(t){return He.isArray(t)&&!t.some(S2)}const u4e=He.toFlatObject(He,{},null,function(e){return/^is[A-Z]/.test(e)});function ox(t,e,i){if(!He.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=He.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!He.isUndefined(g[m])});const n=i.metaTokens,r=i.visitor||u,a=i.dots,o=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&He.isSpecCompliantForm(e);if(!He.isFunction(r))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(He.isDate(f))return f.toISOString();if(!l&&He.isBlob(f))throw new yn("Blob is not supported. Use a Buffer instead.");return He.isArrayBuffer(f)||He.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,m,g){let v=f;if(f&&!g&&typeof f=="object"){if(He.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(He.isArray(f)&&c4e(f)||(He.isFileList(f)||He.endsWith(m,"[]"))&&(v=He.toArray(f)))return m=sbe(m),v.forEach(function(I,b){!(He.isUndefined(I)||I===null)&&e.append(o===!0?A8([m],b,a):o===null?m:m+"[]",c(I))}),!1}return S2(f)?!0:(e.append(A8(g,m,a),c(f)),!1)}const d=[],p=Object.assign(u4e,{defaultVisitor:u,convertValue:c,isVisitable:S2});function h(f,m){if(!He.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),He.forEach(f,function(v,y){(!(He.isUndefined(v)||v===null)&&r.call(e,v,He.isString(y)?y.trim():y,m,p))===!0&&h(v,m?m.concat(y):[y])}),d.pop()}}if(!He.isObject(t))throw new TypeError("data must be an object");return h(t),e}function _8(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function Y5(t,e){this._pairs=[],t&&ox(t,this,e)}const lbe=Y5.prototype;lbe.append=function(e,i){this._pairs.push([e,i])};lbe.toString=function(e){const i=e?function(n){return e.call(this,n,_8)}:_8;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function d4e(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function cbe(t,e,i){if(!e)return t;const n=i&&i.encode||d4e,r=i&&i.serialize;let a;if(r?a=r(e,i):a=He.isURLSearchParams(e)?e.toString():new Y5(e,i).toString(n),a){const o=t.indexOf("#");o!==-1&&(t=t.slice(0,o)),t+=(t.indexOf("?")===-1?"?":"&")+a}return t}class k8{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){He.forEach(this.handlers,function(n){n!==null&&e(n)})}}const ube={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},p4e=typeof URLSearchParams<"u"?URLSearchParams:Y5,h4e=typeof FormData<"u"?FormData:null,f4e=typeof Blob<"u"?Blob:null,m4e={isBrowser:!0,classes:{URLSearchParams:p4e,FormData:h4e,Blob:f4e},protocols:["http","https","file","blob","url","data"]},dbe=typeof window<"u"&&typeof document<"u",g4e=(t=>dbe&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),v4e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",y4e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:dbe,hasStandardBrowserEnv:g4e,hasStandardBrowserWebWorkerEnv:v4e},Symbol.toStringTag,{value:"Module"})),Qd={...y4e,...m4e};function I4e(t,e){return ox(t,new Qd.classes.URLSearchParams,Object.assign({visitor:function(i,n,r,a){return Qd.isNode&&He.isBuffer(i)?(this.append(n,i.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function b4e(t){return He.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function w4e(t){const e={},i=Object.keys(t);let n;const r=i.length;let a;for(n=0;n<r;n++)a=i[n],e[a]=t[a];return e}function pbe(t){function e(i,n,r,a){let o=i[a++];if(o==="__proto__")return!0;const s=Number.isFinite(+o),l=a>=i.length;return o=!o&&He.isArray(r)?r.length:o,l?(He.hasOwnProp(r,o)?r[o]=[r[o],n]:r[o]=n,!s):((!r[o]||!He.isObject(r[o]))&&(r[o]=[]),e(i,n,r[o],a)&&He.isArray(r[o])&&(r[o]=w4e(r[o])),!s)}if(He.isFormData(t)&&He.isFunction(t.entries)){const i={};return He.forEachEntry(t,(n,r)=>{e(b4e(n),r,i,0)}),i}return null}function S4e(t,e,i){if(He.isString(t))try{return(e||JSON.parse)(t),He.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const Z5={transitional:ube,adapter:["xhr","http"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,a=He.isObject(e);if(a&&He.isHTMLForm(e)&&(e=new FormData(e)),He.isFormData(e))return r?JSON.stringify(pbe(e)):e;if(He.isArrayBuffer(e)||He.isBuffer(e)||He.isStream(e)||He.isFile(e)||He.isBlob(e))return e;if(He.isArrayBufferView(e))return e.buffer;if(He.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return I4e(e,this.formSerializer).toString();if((s=He.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return ox(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return a||r?(i.setContentType("application/json",!1),S4e(e)):e}],transformResponse:[function(e){const i=this.transitional||Z5.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(e&&He.isString(e)&&(n&&!this.responseType||r)){const o=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(o)throw s.name==="SyntaxError"?yn.from(s,yn.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Qd.classes.FormData,Blob:Qd.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};He.forEach(["delete","get","head","post","put","patch"],t=>{Z5.headers[t]={}});const X5=Z5,T4e=He.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),U4e=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(o){r=o.indexOf(":"),i=o.substring(0,r).trim().toLowerCase(),n=o.substring(r+1).trim(),!(!i||e[i]&&T4e[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},O8=Symbol("internals");function ES(t){return t&&String(t).trim().toLowerCase()}function SM(t){return t===!1||t==null?t:He.isArray(t)?t.map(SM):String(t)}function D4e(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const P4e=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function zL(t,e,i,n,r){if(He.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!He.isString(e)){if(He.isString(n))return e.indexOf(n)!==-1;if(He.isRegExp(n))return n.test(e)}}function C4e(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function E4e(t,e){const i=He.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,a,o){return this[n].call(this,e,r,a,o)},configurable:!0})})}class sx{constructor(e){e&&this.set(e)}set(e,i,n){const r=this;function a(s,l,c){const u=ES(l);if(!u)throw new Error("header name must be a non-empty string");const d=He.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||l]=SM(s))}const o=(s,l)=>He.forEach(s,(c,u)=>a(c,u,l));return He.isPlainObject(e)||e instanceof this.constructor?o(e,i):He.isString(e)&&(e=e.trim())&&!P4e(e)?o(U4e(e),i):e!=null&&a(i,e,n),this}get(e,i){if(e=ES(e),e){const n=He.findKey(this,e);if(n){const r=this[n];if(!i)return r;if(i===!0)return D4e(r);if(He.isFunction(i))return i.call(this,r,n);if(He.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=ES(e),e){const n=He.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||zL(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let r=!1;function a(o){if(o=ES(o),o){const s=He.findKey(n,o);s&&(!i||zL(n,n[s],s,i))&&(delete n[s],r=!0)}}return He.isArray(e)?e.forEach(a):a(e),r}clear(e){const i=Object.keys(this);let n=i.length,r=!1;for(;n--;){const a=i[n];(!e||zL(this,this[a],a,e,!0))&&(delete this[a],r=!0)}return r}normalize(e){const i=this,n={};return He.forEach(this,(r,a)=>{const o=He.findKey(n,a);if(o){i[o]=SM(r),delete i[a];return}const s=e?C4e(a):String(a).trim();s!==a&&delete i[a],i[s]=SM(r),n[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return He.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=e&&He.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[O8]=this[O8]={accessors:{}}).accessors,r=this.prototype;function a(o){const s=ES(o);n[s]||(E4e(r,o),n[s]=!0)}return He.isArray(e)?e.forEach(a):a(e),this}}sx.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);He.reduceDescriptors(sx.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});He.freezeMethods(sx);const Bh=sx;function WL(t,e){const i=this||X5,n=e||i,r=Bh.from(n.headers);let a=n.data;return He.forEach(t,function(s){a=s.call(i,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function hbe(t){return!!(t&&t.__CANCEL__)}function rE(t,e,i){yn.call(this,t??"canceled",yn.ERR_CANCELED,e,i),this.name="CanceledError"}He.inherits(rE,yn,{__CANCEL__:!0});function M4e(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new yn("Request failed with status code "+i.status,[yn.ERR_BAD_REQUEST,yn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const R4e=Qd.hasStandardBrowserEnv?{write(t,e,i,n,r,a){const o=[t+"="+encodeURIComponent(e)];He.isNumber(i)&&o.push("expires="+new Date(i).toGMTString()),He.isString(n)&&o.push("path="+n),He.isString(r)&&o.push("domain="+r),a===!0&&o.push("secure"),document.cookie=o.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function N4e(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function A4e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function fbe(t,e){return t&&!N4e(e)?A4e(t,e):e}const _4e=Qd.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let n;function r(a){let o=a;return e&&(i.setAttribute("href",o),o=i.href),i.setAttribute("href",o),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=r(window.location.href),function(o){const s=He.isString(o)?r(o):o;return s.protocol===n.protocol&&s.host===n.host}}():function(){return function(){return!0}}();function k4e(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function O4e(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,a=0,o;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=n[a];o||(o=c),i[r]=l,n[r]=c;let d=a,p=0;for(;d!==r;)p+=i[d++],d=d%t;if(r=(r+1)%t,r===a&&(a=(a+1)%t),c-o<e)return;const h=u&&c-u;return h?Math.round(p*1e3/h):void 0}}function x8(t,e){let i=0;const n=O4e(50,250);return r=>{const a=r.loaded,o=r.lengthComputable?r.total:void 0,s=a-i,l=n(s),c=a<=o;i=a;const u={loaded:a,total:o,progress:o?a/o:void 0,bytes:s,rate:l||void 0,estimated:l&&o&&c?(o-a)/l:void 0,event:r};u[e?"download":"upload"]=!0,t(u)}}const x4e=typeof XMLHttpRequest<"u",L4e=x4e&&function(t){return new Promise(function(i,n){let r=t.data;const a=Bh.from(t.headers).normalize();let{responseType:o,withXSRFToken:s}=t,l;function c(){t.cancelToken&&t.cancelToken.unsubscribe(l),t.signal&&t.signal.removeEventListener("abort",l)}let u;if(He.isFormData(r)){if(Qd.hasStandardBrowserEnv||Qd.hasStandardBrowserWebWorkerEnv)a.setContentType(!1);else if((u=a.getContentType())!==!1){const[m,...g]=u?u.split(";").map(v=>v.trim()).filter(Boolean):[];a.setContentType([m||"multipart/form-data",...g].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";a.set("Authorization","Basic "+btoa(m+":"+g))}const p=fbe(t.baseURL,t.url);d.open(t.method.toUpperCase(),cbe(p,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function h(){if(!d)return;const m=Bh.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),v={data:!o||o==="text"||o==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:m,config:t,request:d};M4e(function(I){i(I),c()},function(I){n(I),c()},v),d=null}if("onloadend"in d?d.onloadend=h:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(h)},d.onabort=function(){d&&(n(new yn("Request aborted",yn.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new yn("Network Error",yn.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const v=t.transitional||ube;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),n(new yn(g,v.clarifyTimeoutError?yn.ETIMEDOUT:yn.ECONNABORTED,t,d)),d=null},Qd.hasStandardBrowserEnv&&(s&&He.isFunction(s)&&(s=s(t)),s||s!==!1&&_4e(p))){const m=t.xsrfHeaderName&&t.xsrfCookieName&&R4e.read(t.xsrfCookieName);m&&a.set(t.xsrfHeaderName,m)}r===void 0&&a.setContentType(null),"setRequestHeader"in d&&He.forEach(a.toJSON(),function(g,v){d.setRequestHeader(v,g)}),He.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),o&&o!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",x8(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",x8(t.onUploadProgress)),(t.cancelToken||t.signal)&&(l=m=>{d&&(n(!m||m.type?new rE(null,t,d):m),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(l),t.signal&&(t.signal.aborted?l():t.signal.addEventListener("abort",l)));const f=k4e(p);if(f&&Qd.protocols.indexOf(f)===-1){n(new yn("Unsupported protocol "+f+":",yn.ERR_BAD_REQUEST,t));return}d.send(r||null)})},T2={http:l4e,xhr:L4e};He.forEach(T2,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const L8=t=>`- ${t}`,F4e=t=>He.isFunction(t)||t===null||t===!1,mbe={getAdapter:t=>{t=He.isArray(t)?t:[t];const{length:e}=t;let i,n;const r={};for(let a=0;a<e;a++){i=t[a];let o;if(n=i,!F4e(i)&&(n=T2[(o=String(i)).toLowerCase()],n===void 0))throw new yn(`Unknown adapter '${o}'`);if(n)break;r[o||"#"+a]=n}if(!n){const a=Object.entries(r).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let o=e?a.length>1?`since :
`+a.map(L8).join(`
`):" "+L8(a[0]):"as no adapter specified";throw new yn("There is no suitable adapter to dispatch the request "+o,"ERR_NOT_SUPPORT")}return n},adapters:T2};function qL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new rE(null,t)}function F8(t){return qL(t),t.headers=Bh.from(t.headers),t.data=WL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),mbe.getAdapter(t.adapter||X5.adapter)(t).then(function(n){return qL(t),n.data=WL.call(t,t.transformResponse,n),n.headers=Bh.from(n.headers),n},function(n){return hbe(n)||(qL(t),n&&n.response&&(n.response.data=WL.call(t,t.transformResponse,n.response),n.response.headers=Bh.from(n.response.headers))),Promise.reject(n)})}const $8=t=>t instanceof Bh?t.toJSON():t;function Nw(t,e){e=e||{};const i={};function n(c,u,d){return He.isPlainObject(c)&&He.isPlainObject(u)?He.merge.call({caseless:d},c,u):He.isPlainObject(u)?He.merge({},u):He.isArray(u)?u.slice():u}function r(c,u,d){if(He.isUndefined(u)){if(!He.isUndefined(c))return n(void 0,c,d)}else return n(c,u,d)}function a(c,u){if(!He.isUndefined(u))return n(void 0,u)}function o(c,u){if(He.isUndefined(u)){if(!He.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function s(c,u,d){if(d in e)return n(c,u);if(d in t)return n(void 0,c)}const l={url:a,method:a,data:a,baseURL:o,transformRequest:o,transformResponse:o,paramsSerializer:o,timeout:o,timeoutMessage:o,withCredentials:o,withXSRFToken:o,adapter:o,responseType:o,xsrfCookieName:o,xsrfHeaderName:o,onUploadProgress:o,onDownloadProgress:o,decompress:o,maxContentLength:o,maxBodyLength:o,beforeRedirect:o,transport:o,httpAgent:o,httpsAgent:o,cancelToken:o,socketPath:o,responseEncoding:o,validateStatus:s,headers:(c,u)=>r($8(c),$8(u),!0)};return He.forEach(Object.keys(Object.assign({},t,e)),function(u){const d=l[u]||r,p=d(t[u],e[u],u);He.isUndefined(p)&&d!==s||(i[u]=p)}),i}const gbe="1.6.7",J5={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{J5[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const B8={};J5.transitional=function(e,i,n){function r(a,o){return"[Axios v"+gbe+"] Transitional option '"+a+"'"+o+(n?". "+n:"")}return(a,o,s)=>{if(e===!1)throw new yn(r(o," has been removed"+(i?" in "+i:"")),yn.ERR_DEPRECATED);return i&&!B8[o]&&(B8[o]=!0,console.warn(r(o," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(a,o,s):!0}};function $4e(t,e,i){if(typeof t!="object")throw new yn("options must be an object",yn.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const a=n[r],o=e[a];if(o){const s=t[a],l=s===void 0||o(s,a,t);if(l!==!0)throw new yn("option "+a+" must be "+l,yn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new yn("Unknown option "+a,yn.ERR_BAD_OPTION)}}const U2={assertOptions:$4e,validators:J5},Zf=U2.validators;class SN{constructor(e){this.defaults=e,this.interceptors={request:new k8,response:new k8}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Nw(this.defaults,i);const{transitional:n,paramsSerializer:r,headers:a}=i;n!==void 0&&U2.assertOptions(n,{silentJSONParsing:Zf.transitional(Zf.boolean),forcedJSONParsing:Zf.transitional(Zf.boolean),clarifyTimeoutError:Zf.transitional(Zf.boolean)},!1),r!=null&&(He.isFunction(r)?i.paramsSerializer={serialize:r}:U2.assertOptions(r,{encode:Zf.function,serialize:Zf.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let o=a&&He.merge(a.common,a[i.method]);a&&He.forEach(["delete","get","head","post","put","patch","common"],f=>{delete a[f]}),i.headers=Bh.concat(o,a);const s=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,s.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,p;if(!l){const f=[F8.bind(this),void 0];for(f.unshift.apply(f,s),f.push.apply(f,c),p=f.length,u=Promise.resolve(i);d<p;)u=u.then(f[d++],f[d++]);return u}p=s.length;let h=i;for(d=0;d<p;){const f=s[d++],m=s[d++];try{h=f(h)}catch(g){m.call(this,g);break}}try{u=F8.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Nw(this.defaults,e);const i=fbe(e.baseURL,e.url);return cbe(i,e.params,e.paramsSerializer)}}He.forEach(["delete","get","head","options"],function(e){SN.prototype[e]=function(i,n){return this.request(Nw(n||{},{method:e,url:i,data:(n||{}).data}))}});He.forEach(["post","put","patch"],function(e){function i(n){return function(a,o,s){return this.request(Nw(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:o}))}}SN.prototype[e]=i(),SN.prototype[e+"Form"]=i(!0)});const TM=SN;class Q5{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(a){i=a});const n=this;this.promise.then(r=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](r);n._listeners=null}),this.promise.then=r=>{let a;const o=new Promise(s=>{n.subscribe(s),a=s}).then(r);return o.cancel=function(){n.unsubscribe(a)},o},e(function(a,o,s){n.reason||(n.reason=new rE(a,o,s),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new Q5(function(r){e=r}),cancel:e}}}const B4e=Q5;function V4e(t){return function(i){return t.apply(null,i)}}function j4e(t){return He.isObject(t)&&t.isAxiosError===!0}const D2={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(D2).forEach(([t,e])=>{D2[e]=t});const G4e=D2;function vbe(t){const e=new TM(t),i=XIe(TM.prototype.request,e);return He.extend(i,TM.prototype,e,{allOwnKeys:!0}),He.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return vbe(Nw(t,r))},i}const Ja=vbe(X5);Ja.Axios=TM;Ja.CanceledError=rE;Ja.CancelToken=B4e;Ja.isCancel=hbe;Ja.VERSION=gbe;Ja.toFormData=ox;Ja.AxiosError=yn;Ja.Cancel=Ja.CanceledError;Ja.all=function(e){return Promise.all(e)};Ja.spread=V4e;Ja.isAxiosError=j4e;Ja.mergeConfig=Nw;Ja.AxiosHeaders=Bh;Ja.formToJSON=t=>pbe(He.isHTMLForm(t)?new FormData(t):t);Ja.getAdapter=mbe.getAdapter;Ja.HttpStatusCode=G4e;Ja.default=Ja;const ybe=cce(),H4e=window.location.host.includes("localhost")||window.location.hostname==="127.0.0.1";var XJ;const z4e=(XJ=window.dev)!=null&&XJ.baseURL||H4e?"http://localhost:8383":"https://courthive.net",aE=Ja.create({baseURL:z4e});aE.interceptors.request.use(t=>{const e=localStorage.getItem(ybe);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));aE.interceptors.response.use(t=>{var e;return(e=t.data)!=null&&e.error&&ai({message:t.data.error,intent:"is-danger"}),t},t=>{var e;if(t.message==="Network Error"&&ai({message:t.message,intent:"is-danger"}),t.response){((e=t.response)==null?void 0:e.status)===401&&Ibe();const i=t.response.data.message||t.response.data.error||t.response.data;ai({message:i,intent:"is-danger"})}});const W4e=()=>{const t=localStorage.getItem(ybe);aE.defaults.headers.common.Authorization=`Bearer ${t}`},Ibe=()=>{aE.defaults.headers.common.Authorization=void 0},$g={...aE,addAuthorization:W4e,removeAuthorization:Ibe};async function e6({tournamentId:t}){return await $g.post("/factory/fetch",{tournamentId:t})}async function q4e({providerId:t}){return await $g.post("/provider/detail",{providerId:t})}async function K4e({providerAbbr:t}){return await $g.post("/provider/calendar",{providerAbbr:t})}async function P2(){return await $g.post("/provider/allProviders",{})}async function Y4e({tournamentRecord:t}){return await $g.post("/factory/save",{tournamentRecord:t})}const $l=(t,e)=>i=>i.length>=t&&(!e||e&&i.length<=e);function PI(t,e,i){if(!t)return;const n={};for(const r of e||[]){if(!(r!=null&&r.label)||r.hide)continue;const a=document.createElement("button");r.id&&(n[r.id]=a,a.id=r.id),a.style="margin-right: .5em;",a.className="button font-medium",r.intent&&a.classList.add(r.intent),a.innerHTML=r.label,a.onclick=o=>{o.stopPropagation(),!r.disabled&&pt(r.onClick)&&r.onClick(),pt(i)&&i()},t.appendChild(a)}return{elements:n}}function t6(t){return t[t.length-1]}function oE(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function V8(t,e){return t?t.split(e):[]}function i6(t,e,i){const n=e===void 0||t>=e,r=i===void 0||t<=i;return n&&r}function bbe(t,e,i){return t<e?e:t>i?i:t}function Aw(t,e,i={},n=0,r=""){const a=Object.keys(i).reduce((s,l)=>{let c=i[l];return typeof c=="function"&&(c=c(n)),`${s} ${l}="${c}"`},t);r+=`<${a}></${t}>`;const o=n+1;return o<e?Aw(t,e,i,o,r):r}function n6(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function C2(t){return new Date(t).setHours(0,0,0,0)}function CI(){return new Date().setHours(0,0,0,0)}function _w(...t){switch(t.length){case 0:return CI();case 1:return C2(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function XU(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function Z4e(t,e){return XU(t,e*7)}function TN(t,e){const i=new Date(t),n=i.getMonth()+e;let r=n%12;r<0&&(r+=12);const a=i.setMonth(n);return i.getMonth()!==r?i.setDate(0):a}function JU(t,e){const i=new Date(t),n=i.getMonth(),r=i.setFullYear(i.getFullYear()+e);return n===1&&i.getMonth()===2?i.setDate(0):r}function j8(t,e){return(t-e+7)%7}function $v(t,e,i=0){const n=new Date(t).getDay();return XU(t,j8(e,i)-j8(n,i))}function wbe(t,e){return Math.round((t-e)/6048e5)+1}function X4e(t){const e=$v(t,4,1),i=$v(new Date(e).setMonth(0,4),4,1);return wbe(e,i)}function Sbe(t,e){const i=$v(new Date(t).setMonth(0,1),e,e),n=$v(t,e,e),r=wbe(n,i);if(r<53)return r;const a=$v(new Date(t).setDate(32),e,e);return n===a?1:r}function J4e(t){return Sbe(t,0)}function Q4e(t){return Sbe(t,6)}function zI(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Dm(t,e,i){if(e!==1&&e!==2)return t;const n=new Date(t);return e===1?i?n.setMonth(n.getMonth()+1,0):n.setDate(1):i?n.setFullYear(n.getFullYear()+1,0,0):n.setMonth(0,1),n.setHours(0,0,0,0)}const E2=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,e5e=/[\s!-/:-@[-`{-~年月日]+/;let KL={};const G8={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const n=new Date(t);let r=parseInt(e,10)-1;if(isNaN(r)){if(!e)return NaN;const a=e.toLowerCase(),o=s=>s.toLowerCase().startsWith(a);if(r=i.monthsShort.findIndex(o),r<0&&(r=i.months.findIndex(o)),r<0)return NaN}return n.setMonth(r),n.getMonth()!==Tbe(r)?n.setDate(0):n.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},t5e={d(t){return t.getDate()},dd(t){return n1(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return n1(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return n1(t.getFullYear(),2).slice(-2)},yyyy(t){return n1(t.getFullYear(),4)}};function Tbe(t){return t>-1?t%12:Tbe(t+12)}function n1(t,e){return t.toString().padStart(e,"0")}function Ube(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in KL)return KL[t];const e=t.split(E2),i=t.match(new RegExp(E2,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const n=i.map(a=>t5e[a]),r=Object.keys(G8).reduce((a,o)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===o)&&a.push(o),a),[]);return KL[t]={parser(a,o){const s=a.split(e5e).reduce((l,c,u)=>{if(c.length>0&&i[u]){const d=i[u][0];d==="M"?l.m=c:d!=="D"&&(l[d]=c)}return l},{});return r.reduce((l,c)=>{const u=G8[c](l,s[c],o);return isNaN(u)?l:u},CI())},formatter(a,o){let s=n.reduce((l,c,u)=>l+=`${e[u]}${c(a,o)}`,"");return s+=t6(e)}}}function yy(t,e,i){if(t instanceof Date||typeof t=="number"){const n=C2(t);return isNaN(n)?void 0:n}if(t){if(t==="today")return CI();if(e&&e.toValue){const n=e.toValue(t,e,i);return isNaN(n)?void 0:C2(n)}return Ube(e).parser(t,i)}}function sE(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const n=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(n,e,i):Ube(e).formatter(n,i)}const i5e=document.createRange();function uf(t){return i5e.createContextualFragment(t)}function Dbe(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function lx(t){return t.getRootNode().activeElement===t}function CT(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function ET(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function UN(t){t.firstChild&&(t.removeChild(t.firstChild),UN(t))}function n5e(t,e){UN(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(uf(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const DN=new WeakMap,{addEventListener:r5e,removeEventListener:a5e}=EventTarget.prototype;function PN(t,e){let i=DN.get(t);i||(i=[],DN.set(t,i)),e.forEach(n=>{r5e.call(...n),i.push(n)})}function Pbe(t){let e=DN.get(t);e&&(e.forEach(i=>{a5e.call(...i)}),DN.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let n;return e.parentNode?n=e.parentNode:e.host?n=e.host:e.defaultView&&(n=e.defaultView),n?t(n,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function Cbe(t,e,i){const[n,...r]=t;if(e(n))return n;if(!(n===i||n.tagName==="HTML"||r.length===0))return Cbe(r,e,i)}function Ebe(t,e){const i=typeof e=="function"?e:n=>n instanceof Element&&n.matches(e);return Cbe(t.composedPath(),i,t.currentTarget)}const MS={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},r6={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"»",orientation:"auto",pickLevel:0,prevArrow:"«",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:YL,format:o5e,weekStart:s5e}=r6;function H8(t,e){return t.length<6&&e>=0&&e<7?oE(t,e):t}function Mbe(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return X4e;case 2:return J4e;case 3:return Q4e}}function z8(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Mbe(4,t)),t}function W8(t,e,i,n){const r=yy(t,e,i);return r!==void 0?r:n}function ZL(t,e,i=3){const n=parseInt(t,10);return n>=0&&n<=i?n:e}function r1(t,e,i,n=void 0){e in t&&(i in t||(t[i]=n?n(t[e]):t[e]),delete t[e])}function XL(t,e){const i=Object.assign({},t),n={},r=e.constructor.locales,a=!!e.rangeSideIndex;let{datesDisabled:o,format:s,language:l,locale:c,maxDate:u,maxView:d,minDate:p,pickLevel:h,startView:f,weekNumbers:m,weekStart:g}=e.config||{};if(r1(i,"calendarWeeks","weekNumbers",w=>w?1:0),r1(i,"clearBtn","clearButton"),r1(i,"todayBtn","todayButton"),r1(i,"todayBtnMode","todayButtonMode"),i.language){let w;if(i.language!==l&&(r[i.language]?w=i.language:(w=i.language.split("-")[0],r[w]||(w=!1))),delete i.language,w){l=n.language=w;const S=c||r[YL];c=Object.assign({format:o5e,weekStart:s5e},r[YL]),l!==YL&&Object.assign(c,r[l]),n.locale=c,s===S.format&&(s=n.format=c.format),g===S.weekStart&&(g=z8(c.weekStart,n,m))}}if(i.format){const w=typeof i.format.toDisplay=="function",S=typeof i.format.toValue=="function",U=E2.test(i.format);(w&&S||U)&&(s=n.format=i.format),delete i.format}let v=h;"pickLevel"in i&&(v=ZL(i.pickLevel,h,2),delete i.pickLevel),v!==h&&(v>h&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),o&&!i.datesDisabled&&(i.datesDisabled=[]),h=n.pickLevel=v);let y=p,I=u;if("minDate"in i){const w=_w(0,0,1);y=i.minDate===null?w:W8(i.minDate,s,c,y),y!==w&&(y=Dm(y,h,!1)),delete i.minDate}if("maxDate"in i&&(I=i.maxDate===null?void 0:W8(i.maxDate,s,c,I),I!==void 0&&(I=Dm(I,h,!0)),delete i.maxDate),I<y?(p=n.minDate=I,u=n.maxDate=y):(p!==y&&(p=n.minDate=y),u!==I&&(u=n.maxDate=I)),i.datesDisabled){const w=i.datesDisabled;if(typeof w=="function")n.datesDisabled=null,n.checkDisabled=(S,U)=>w(new Date(S),U,a);else{const S=n.datesDisabled=w.reduce((U,C)=>{const E=yy(C,s,c);return E!==void 0?oE(U,Dm(E,h,a)):U},[]);n.checkDisabled=U=>S.includes(U)}delete i.datesDisabled}if("defaultViewDate"in i){const w=yy(i.defaultViewDate,s,c);w!==void 0&&(n.defaultViewDate=w),delete i.defaultViewDate}if("weekStart"in i){const w=Number(i.weekStart)%7;isNaN(w)||(g=z8(w,n,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(n.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(H8,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(n.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(H8,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let w=i.weekNumbers;if(w){const S=typeof w=="function"?(U,C)=>w(new Date(U),C):Mbe(w=parseInt(w,10),g);S&&(m=n.weekNumbers=w,n.getWeekNumber=S)}else m=n.weekNumbers=0,n.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const w=parseInt(i.maxNumberOfDates,10);w>=0&&(n.maxNumberOfDates=w,n.multidate=w!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(n.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let b=d;"maxView"in i&&(b=ZL(i.maxView,d),delete i.maxView),b=h>b?h:b,b!==d&&(d=n.maxView=b);let D=f;if("startView"in i&&(D=ZL(i.startView,D),delete i.startView),D<h?D=h:D>d&&(D=d),D!==f&&(n.startView=D),i.prevArrow){const w=uf(i.prevArrow);w.childNodes.length>0&&(n.prevArrow=w.childNodes),delete i.prevArrow}if(i.nextArrow){const w=uf(i.nextArrow);w.childNodes.length>0&&(n.nextArrow=w.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(n.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const w=i.orientation.toLowerCase().split(/\s+/g);n.orientation={x:w.find(S=>S==="left"||S==="right")||"auto",y:w.find(S=>S==="top"||S==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:n.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([w,S])=>{S!==void 0&&w in r6&&(n[w]=S)}),n}const q8={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function l5e(t){return Object.keys(q8).reduce((e,i)=>{const n=t[i]===void 0?q8[i]:t[i],r=n&&n.key;if(!r||typeof r!="string")return e;const a={key:r,ctrlOrMetaKey:!!(n.ctrlOrMetaKey||n.ctrlKey||n.metaKey)};return r.length>1&&(a.altKey=!!n.altKey,a.shiftKey=!!n.shiftKey),e[i]=a,e},{})}const K8=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),c5e=n6(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${K8(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${K8(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),u5e=n6(`<div class="days">
  <div class="days-of-week">${Aw("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${Aw("span",42)}</div>
</div>`),d5e=n6(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${Aw("span",6,{class:"week"})}</div>
</div>`);let a6=class{constructor(e,i){Object.assign(this,i,{picker:e,element:uf('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,n){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(i),r.setNextButtonDisabled(n)}setDisabled(e,i){i.add("disabled"),oE(this.disabled,e)}performBeforeHook(e,i){let n=this.beforeShow(new Date(i));switch(typeof n){case"boolean":n={enabled:n};break;case"string":n={classes:n}}if(n){const r=e.classList;if(n.enabled===!1&&this.setDisabled(i,r),n.classes){const a=n.classes.split(/\s+/);r.add(...a),a.includes("disabled")&&this.setDisabled(i,r)}n.content&&n5e(e,n.content)}}renderCell(e,i,n,r,{selected:a,range:o},s,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=r);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,n<this.first?c.add("prev"):n>this.last&&c.add("next"),c.add(...l),(s||this.checkDisabled(r,this.id))&&this.setDisabled(r,c),o){const[u,d]=o;n>u&&n<d&&c.add("range"),n===u&&c.add("range-start"),n===d&&c.add("range-end")}a.includes(n)&&c.add("selected"),n===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,i,n,[r,a]){const o=e.classList;o.remove("range","range-start","range-end","selected","focused"),i>r&&i<a&&o.add("range"),i===r&&o.add("range-start"),i===a&&o.add("range-end"),n.includes(i)&&o.add("selected"),i===this.focused&&o.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class p5e extends a6{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const n=uf(u5e).firstChild;this.dow=n.firstChild,this.grid=n.lastChild,this.element.appendChild(n)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const n=uf(d5e).firstChild;this.weekNumbers={element:n,dow:n.firstChild,weeks:n.lastChild},this.element.insertBefore(n,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(ET(this.dow),this.weekNumbers&&ET(this.weekNumbers.dow)):(CT(this.dow),this.weekNumbers&&CT(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((n,r)=>{const a=(this.weekStart+r)%7;n.textContent=this.dayNames[a],n.className=this.daysOfWeekDisabled.includes(a)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),n=e.getMonth(),r=_w(i,n,1),a=$v(r,this.weekStart,this.weekStart);this.first=r,this.last=_w(i,n+1,0),this.start=a,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?CI():void 0,this.prepareForRender(sE(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=$v(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((n,r)=>{const a=Z4e(i,r);n.textContent=this.getWeekNumber(a,e),r>3&&n.classList[a>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const n=XU(this.start,i),r=new Date(n),a=r.getDay(),o=[];this.today===n&&o.push("today"),this.daysOfWeekHighlighted.includes(a)&&o.push("highlighted"),this.renderCell(e,r.getDate(),n,n,this,n<this.minDate||n>this.maxDate||this.daysOfWeekDisabled.includes(a),o)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function Y8(t,e){if(!t||!t[0]||!t[1])return;const[[i,n],[r,a]]=t;if(!(i>e||r<e))return[i===e?n:-1,r===e?a:12]}class h5e extends a6{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(uf(Aw("span",12,{"data-month":n=>n}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=_w(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>{const a=new Date(r),o=a.getFullYear(),s=a.getMonth();return n[o]===void 0?n[o]=[s]:oE(n[o],s),n},{}),i&&i.dates&&(this.range=i.dates.map(n=>{const r=new Date(n);return isNaN(r)?void 0:[r.getFullYear(),r.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,r=this.year===this.maxYear,a=Y8(this.range,this.year);Array.from(this.grid.children).forEach((o,s)=>{const l=Dm(new Date(this.year,s,1),1,this.isRangeEnd);this.renderCell(o,this.monthNames[s],s,l,{selected:e,range:a},i||n&&s<this.minMonth||r&&s>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=Y8(this.range,this.year)||[];Array.from(this.grid.children).forEach((n,r)=>{this.refreshCell(n,r,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function f5e(t){return[...t].reduce((e,i,n)=>e+=n?i:i.toUpperCase(),"")}class Z8 extends a6{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${f5e(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(uf(Aw("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=zI(e.minDate,this.step),this.minDate=_w(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=zI(e.maxDate,this.step),this.maxDate=_w(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=zI(e,this.navStep),n=i+9*this.step;this.first=i,this.last=n,this.start=i-this.step,this.focused=zI(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>oE(n,zI(r,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(n=>{if(n!==void 0)return zI(n,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const n=this.start+i*this.step,r=Dm(new Date(n,0,1),2,this.isRangeEnd);e.dataset.year=n,this.renderCell(e,n,n,r,this,n<this.minYear||n>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function ob(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function CN(t,e){const{config:i,picker:n}=t,{currentView:r,viewDate:a}=n;let o;switch(r.id){case 0:o=TN(a,e);break;case 1:o=JU(a,e);break;default:o=JU(a,e*r.navStep)}o=bbe(o,i.minDate,i.maxDate),n.changeFocus(o).render()}function Rbe(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function Nbe(t){t.setDate({clear:!0})}function Abe(t){const e=CI();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function _be(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;lx(i)?i.addEventListener("blur",e,{once:!0}):e()}function X8(t,e){const i=t.picker,n=new Date(i.viewDate),r=i.currentView.id,a=r===1?TN(n,e-n.getMonth()):JU(n,e-n.getFullYear());i.changeFocus(a).changeView(r-1).render()}function m5e(t){Rbe(t)}function g5e(t){CN(t,-1)}function v5e(t){CN(t,1)}function y5e(t,e){const i=Ebe(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:n,isMinView:r}=t.picker.currentView,a=i.dataset;r?t.setDate(Number(a.date)):n===1?X8(t,Number(a.month)):X8(t,Number(a.year))}function I5e(t){t.preventDefault()}const JL=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),J8=t=>t&&`${t}px`;function Q8(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,ET(t.controls.title)):(t.controls.title.textContent="",CT(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;UN(i),e.prevArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;UN(i),e.nextArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?ET(t.controls.todayButton):CT(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:n}=t.datepicker.config;t.controls.todayButton.disabled=!i6(CI(),i,n)}"clearButton"in e&&(e.clearButton?ET(t.controls.clearButton):CT(t.controls.clearButton))}function e9(t){const{dates:e,config:i,rangeSideIndex:n}=t,r=e.length>0?t6(e):Dm(i.defaultViewDate,i.pickLevel,n);return bbe(r,i.minDate,i.maxDate)}function t9(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:n,first:r,last:a}=t.currentView,o=new Date(e).getFullYear();switch(i){case 0:return e<r||e>a;case 1:return o!==n;default:return o<r||o>a}}function QL(t){return window.getComputedStyle(t).direction}function kbe(t){const e=Dbe(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:kbe(e)}class b5e{constructor(e){const{config:i,inputField:n}=this.datepicker=e,r=c5e.replace(/%buttonClass%/g,i.buttonClass),a=this.element=uf(r).firstChild,[o,s,l]=a.firstChild.children,c=o.firstElementChild,[u,d,p]=o.lastElementChild.children,[h,f]=l.firstChild.children,m={title:c,prevButton:u,viewSwitch:d,nextButton:p,todayButton:h,clearButton:f};this.main=s,this.controls=m;const g=n?"dropdown":"inline";a.classList.add(`datepicker-${g}`),Q8(this,i),this.viewDate=e9(e),PN(e,[[a,"mousedown",I5e],[s,"click",y5e.bind(null,e)],[m.viewSwitch,"click",m5e.bind(null,e)],[m.prevButton,"click",g5e.bind(null,e)],[m.nextButton,"click",v5e.bind(null,e)],[m.todayButton,"click",Abe.bind(null,e)],[m.clearButton,"click",Nbe.bind(null,e)]]),this.views=[new p5e(this),new h5e(this),new Z8(this,{id:2,name:"years",cellClass:"year",step:1}),new Z8(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):n.after(this.element)}setOptions(e){Q8(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,n=e.inputField;if(n){const r=QL(n);r!==QL(Dbe(i))?i.dir=r:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&n.blur()}else i.classList.add("active");this.active=!0,ob(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,ob(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:n,height:r}=this.element.getBoundingClientRect(),a=this.element.offsetParent;i.display="";const{config:o,inputField:s}=this.datepicker,{left:l,top:c,right:u,bottom:d,width:p,height:h}=s.getBoundingClientRect();let{x:f,y:m}=o.orientation,g=l,v=c;if(a===document.body||!a)g+=window.scrollX,v+=window.scrollY;else{const U=a.getBoundingClientRect();g-=U.left-a.scrollLeft,v-=U.top-a.scrollTop}const y=kbe(s);let I=0,b=0,{clientWidth:D,clientHeight:w}=document.documentElement;if(y){const U=y.getBoundingClientRect();U.top>0&&(b=U.top),U.left>0&&(I=U.left),U.right<D&&(D=U.right),U.bottom<w&&(w=U.bottom)}let S=0;f==="auto"&&(l<I?(f="left",S=I-l):l+n>D?(f="right",D<u&&(S=D-u)):QL(s)==="rtl"?f=u-n<I?"left":"right":f="left"),f==="right"&&(g+=p-n),g+=S,m==="auto"&&(c-r>b?m=d+r>w?"top":"bottom":m="bottom"),m==="top"?v-=r:v+=h,e.remove(...Object.values(JL)),e.add(JL[f],JL[m]),i.left=J8(g),i.top=J8(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=t9(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?e9(this.datepicker):e;return this._renderMethod=t9(this,i)?"render":"refresh",this.views.forEach(n=>{n.updateFocus(),n.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:n,_oldView:r}=this,a=new Date(this._oldViewDate),o=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[o](),r&&(this.main.replaceChild(i.element,r.element),ob(n,"changeView")),!isNaN(a)){const s=new Date(this.viewDate);s.getFullYear()!==a.getFullYear()&&ob(n,"changeYear"),s.getMonth()!==a.getMonth()&&ob(n,"changeMonth")}}}function Obe(t,e,i,n,r,a){if(i6(t,r,a)){if(n(t)){const o=e(t,i);return Obe(o,e,i,n,r,a)}return t}}function w5e(t,e,i){const n=t.picker,r=n.currentView,a=r.step||1;let o=n.viewDate,s;switch(r.id){case 0:o=XU(o,i?e*7:e),s=XU;break;case 1:o=TN(o,i?e*4:e),s=TN;break;default:o=JU(o,e*(i?4:1)*a),s=JU}o=Obe(o,s,e<0?-a:a,l=>r.disabled.includes(l),r.minDate,r.maxDate),o!==void 0&&n.changeFocus(o).render()}function S5e(t,e){const{config:i,picker:n,editMode:r}=t,a=n.active,{key:o,altKey:s,shiftKey:l}=e,c=e.ctrlKey||e.metaKey,u=()=>{e.preventDefault(),e.stopPropagation()};if(o==="Tab"){_be(t);return}if(o==="Enter"){if(!a)t.update();else if(r)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=n.currentView;m.isMinView?t.setDate(n.viewDate):(n.changeView(m.id-1).render(),u())}return}const d=i.shortcutKeys,p={key:o,ctrlOrMetaKey:c,altKey:s,shiftKey:l},h=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(h){let m;if(h==="toggle"?m=h:r?h==="exitEditMode"&&(m=h):a?h==="hide"?m=h:h==="prevButton"?m=[CN,[t,-1]]:h==="nextButton"?m=[CN,[t,1]]:h==="viewSwitch"?m=[Rbe,[t]]:i.clearButton&&h==="clearButton"?m=[Nbe,[t]]:i.todayButton&&h==="todayButton"&&(m=[Abe,[t]]):h==="show"&&(m=h),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),u();return}}if(!a||r)return;const f=(m,g)=>{l||c||s?t.enterEditMode():(w5e(t,m,g),e.preventDefault())};o==="ArrowLeft"?f(-1,!1):o==="ArrowRight"?f(1,!1):o==="ArrowUp"?f(-1,!0):o==="ArrowDown"?f(1,!0):(o==="Backspace"||o==="Delete"||o&&o.length===1&&!c)&&t.enterEditMode()}function T5e(t){t.config.showOnFocus&&!t._showing&&t.show()}function U5e(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=lx(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function D5e(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function P5e(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function C5e(t,e){const{element:i,picker:n}=t;if(!n.active&&!lx(i))return;const r=n.element;Ebe(e,a=>a===i||a===r)||_be(t)}function xbe(t,e){return t.map(i=>sE(i,e.format,e.locale)).join(e.dateDelimiter)}function Lbe(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:n,dates:r,rangeSideIndex:a}=t,{pickLevel:o,maxNumberOfDates:s}=n;let l=e.reduce((c,u)=>{let d=yy(u,n.format,n.locale);return d===void 0||(d=Dm(d,o,a),i6(d,n.minDate,n.maxDate)&&!c.includes(d)&&!n.checkDisabled(d,o)&&(o>0||!n.daysOfWeekDisabled.includes(new Date(d).getDay()))&&c.push(d)),c},[]);if(l.length!==0)return n.multidate&&!i&&(l=l.reduce((c,u)=>(r.includes(u)||c.push(u),c),r.filter(c=>!l.includes(c)))),s&&l.length>s?l.slice(s*-1):l}function EN(t,e=3,i=!0,n=void 0){const{config:r,picker:a,inputField:o}=t;if(e&2){const s=a.active?r.pickLevel:r.startView;a.update(n).changeView(s).render(i)}e&1&&o&&(o.value=xbe(t.dates,r))}function i9(t,e,i){const n=t.config;let{clear:r,render:a,autohide:o,revert:s,forceRefresh:l,viewDate:c}=i;a===void 0&&(a=!0),a?o===void 0&&(o=n.autohide):o=l=!1,c=yy(c,n.format,n.locale);const u=Lbe(t,e,r);!u&&!s||(u&&u.toString()!==t.dates.toString()?(t.dates=u,EN(t,a?3:1,!0,c),ob(t,"changeDate")):EN(t,l?3:1,!0,c),o&&t.hide())}function n9(t,e){return e?i=>sE(i,e,t.config.locale):i=>new Date(i)}class Fbe{constructor(e,i={},n=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:CI(),maxDate:void 0,minDate:void 0},XL(r6,this));let a;if(e.tagName==="INPUT"?(a=this.inputField=e,a.classList.add("datepicker-input"),i.container&&(r.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):r.container=e,n){const u=n.inputs.indexOf(a),d=n.datepickers;if(u<0||u>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[u]=this,this.rangepicker=n,this.rangeSideIndex=u}this._options=i,Object.assign(r,XL(i,this)),r.shortcutKeys=l5e(i.shortcutKeys||{});const o=V8(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const s=Lbe(this,o);s&&s.length>0&&(this.dates=s),a&&(a.value=xbe(this.dates,r));const l=this.picker=new b5e(this),c=[e,"keydown",S5e.bind(null,this)];a?PN(this,[c,[a,"focus",T5e.bind(null,this)],[a,"mousedown",U5e.bind(null,this)],[a,"click",D5e.bind(null,this)],[a,"paste",P5e.bind(null,this)],[document,"mousedown",C5e.bind(null,this)],[window,"resize",l.place.bind(l)]]):(PN(this,[c]),this.show())}static formatDate(e,i,n){return sE(e,i,n&&MS[n]||MS.en)}static parseDate(e,i,n){return yy(e,i,n&&MS[n]||MS.en)}static get locales(){return MS}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=XL(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),EN(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!lx(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),Pbe(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=n9(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],n={},r=t6(e);r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(n,i.pop());const a=Array.isArray(i[0])?i[0]:i;i9(this,a,n)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),n=V8(this.inputField.value,this.config.dateDelimiter);i9(this,n,i)}getFocusedDate(e=void 0){return n9(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:n,picker:r,active:a,rangeSideIndex:o}=this,s=n.pickLevel,l=yy(e,n.format,n.locale);l!==void 0&&(r.changeFocus(Dm(l,s,o)),a&&i&&r.changeView(s),r.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let n;e==="picker"?n=2:e==="input"?n=1:n=3,EN(this,n,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function r9(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function E5e(t,e,i,n){PN(t,[[i,"changeDate",e]]),new Fbe(i,n,t)}function RS(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const n=t.datepickers,[r,a]=n,o={render:!1},s=t.inputs.indexOf(i),l=s===0?1:0,c=n[s].dates[0],u=n[l].dates[0];c!==void 0&&u!==void 0?s===0&&c>u?(r.setDate(u,o),a.setDate(c,o)):s===1&&c<u&&(r.setDate(c,o),a.setDate(u,o)):t.allowOneSidedRange||(c!==void 0||u!==void 0)&&(o.clear=!0,n[l].setDate(n[s].dates,o)),n.forEach(d=>{d.picker.update().render()}),delete t._updating}class M5e{constructor(e,i={}){let n=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(n.length<2)return;e.rangepicker=this,this.element=e,this.inputs=n=n.slice(0,2),Object.freeze(n),this.allowOneSidedRange=!!i.allowOneSidedRange;const r=RS.bind(null,this),a=r9(i),o=this.datepickers=[];n.forEach(s=>{E5e(this,r,s,a)}),Object.freeze(o),Object.defineProperty(this,"dates",{get(){return o.map(s=>s.dates[0])}}),o[0].dates.length>0?RS(this,{target:n[0]}):o[1].dates.length>0&&RS(this,{target:n[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=r9(e);this.datepickers.forEach(n=>{n.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),Pbe(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?n=>sE(n,e,this.datepickers[0].config.locale):n=>new Date(n);return this.dates.map(n=>n===void 0?n:i(n))}setDates(e,i){const{datepickers:[n,r],inputs:[a,o],dates:[s,l]}=this;this._updating=!0,n.setDate(e),r.setDate(i),delete this._updating,r.dates[0]!==l?RS(this,{target:o}):n.dates[0]!==s&&RS(this,{target:a})}}var $be=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function o6(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function R5e(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var i=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}),i}var Bbe={exports:{}};(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=a(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},n(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1},c),this.index=-1,this.container=this.container(l),this.ul=a.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container}),this.status=a.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:this.minChars!=0?"Type "+this.minChars+" or more characters for results.":"Begin typing for results."}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected?(d.preventDefault(),u.select(void 0,void 0,d)):p===9&&u.selected&&u.tabSelect?u.select(void 0,void 0,d):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},a.bind(this.input,this._events.input),a.bind(this.input.form,this._events.form),a.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=a(l),l&&l.children){var c=[];r.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,h=u.label||d;p!==""&&c.push({label:h,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),a.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),a.fire(this.input,"awesomplete-open")},destroy:function(){if(a.unbind(this.input,this._events.input),a.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.status.textContent=c[l].textContent+", list item "+(l+1)+" of "+c.length,this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,a.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=a.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=a.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),a.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent="No results found",this.close({reason:"nomatches"})):(this.open(),this.status.textContent=this.ul.children.length+" results found")):(this.close({reason:"nomatches"}),this.status.textContent="No results found")}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(a.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+a.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return a.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(a.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return a.create("li",{innerHTML:d,role:"option","aria-selected":"false",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function n(l,c,u){for(var d in c){var p=c[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var r=Array.prototype.slice;function a(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function o(l,c){return r.call((c||document).querySelectorAll(l))}a.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")a(p).appendChild(u);else if(d==="around"){var h=a(p);h.parentNode.insertBefore(u,h),u.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},a.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},a.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},a.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},a.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},a.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function s(){o("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?s():document.addEventListener("DOMContentLoaded",s)),e.$=a,e.$$=o,t.exports&&(t.exports=e),e})()})(Bbe);var N5e=Bbe.exports;const A5e=o6(N5e);function _5e({list:t,element:e,callback:i,currentValue:n,withCatchTab:r,onChange:a}){var c;const o=new A5e(e,{list:t});let s=!1;const l=u=>{s=!0,pt(i)&&i(u.text.value),e.value=u.text.label,o.suggestions=[]};if(r){const u=d=>d.which===9&&d.preventDefault();e.addEventListener("keydown",u,!1),e.addEventListener("keyup",u,!1)}if(typeof a=="function"&&e.addEventListener("change",a),e.setAttribute("autocomplete","cc-number"),e.addEventListener("awesomplete-selectcomplete",u=>l(u),!1),e.addEventListener("keyup",function(u){var d;(u.which===13||u.which===9)&&!s&&((d=o.suggestions)!=null&&d.length)&&(o.next(),o.select(0)),s=!1}),n){const u=(c=t.find(d=>d.value===n))==null?void 0:c.label;u&&(e.value=u)}return{typeAhead:o}}function Vbe(t,e,i,n,r){if(r){const a=e.target.value;r(a)?(n.innerHTML="",n.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(n.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),n.classList.add("is-danger"))}}function s6(t,e){for(const i of e.options){if(i.hide)continue;const n=document.createElement("option");n.className="font-medium",i.value&&n.setAttribute("value",i.value),(i.selected||e.value===i.value)&&n.setAttribute("selected","true"),i.disabled&&n.setAttribute("disabled","true"),n.innerHTML=i.label,t.appendChild(n)}}function MT(t){var a,o;const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style=`width: ${t.width}`:e.style="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,n;const r=document.createElement("div");if(r.className="control font-medium",t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,r.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const l of t.options??[]){const c=document.createElement("label");c.className="radio";const u=document.createElement("input");u.name=t.id,u.type="radio",u.value=l.text,l.checked&&(u.checked=!0),c.appendChild(u),s.appendChild(c);const d=document.createElement("span");d.style.marginLeft=".25em",d.style.marginRight="1em",d.innerHTML=l.text,s.appendChild(d)}r.appendChild(s),i=s}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style="width: 100%";const l=document.createElement("select");if(t.id&&(s.id=t.id),t.disabled&&(l.disabled=!0),l.style="width: 100%",s6(l,t),s.appendChild(l),r.appendChild(s),t.help){const c=document.createElement("p");c.className="help font-medium is-info",c.innerHTML=(a=t.help)==null?void 0:a.text,c.style.display=(o=t.help)!=null&&o.visible?"":ct,r.appendChild(c)}i=l,pt(t.onChange)&&l.addEventListener("change",c=>t.onChange(c,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow field nowrap",s.style.display="inline-block";const l=document.createElement("input");i=l;const c=t.intent??"is-success";l.className=`is-checkradio ${c}`,l.type="checkbox",l.id=t.id,t.checked&&(l.checked=!0),s.appendChild(l);const u=document.createElement("label");u.setAttribute("for",t.id),t.color&&(u.style.color=t.color),u.innerHTML=t.label,s.appendChild(u),r.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"cc-number"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled",!0),t.id&&s.setAttribute("id",t.id),r.appendChild(s),t.iconLeft){r.classList.add("has-icons-left");const c=document.createElement("span");c.className="icon is-small is-left font-medium";const u=document.createElement("i");u.className=t.iconLeft,c.appendChild(u),r.appendChild(c)}if(t.type==="password"){r.classList.add("has-icons-right");const c=document.createElement("span");c.className="icon is-small is-right font-medium";const u=document.createElement("i");u.className=t.iconRight,c.appendChild(u),r.appendChild(c)}i=s;const l=document.createElement("p");l.className="help font-medium",r.appendChild(l),t.validator&&s.addEventListener("input",c=>Vbe(t,c,s,l,t.validator)),t.date?n=new Fbe(i,{format:"yyyy-mm-dd",autohide:!0}):t.typeAhead?_5e({...t.typeAhead,element:s}):(pt(t.onKeyDown)&&s.addEventListener("keydown",c=>t.onKeyDown(c,t)),pt(t.onChange)&&s.addEventListener("change",c=>t.onChange(c,t)),pt(t.onInput)&&s.addEventListener("input",c=>t.onInput(c,t)),pt(t.onKeyUp)&&s.addEventListener("keyup",c=>t.onKeyUp(c,t)),t.value!==void 0&&(s.value=t.value)),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(r),t.visible===!1&&(e.style.display=ct),{field:e,inputElement:i,datepicker:n}}function Wr(t,e,i){const n=document.createElement("div");n.style="display: flex; width: 100%;",n.classList.add("flexcol");const r={},a={};let o;for(const s of e){if((s.text||s.html)&&!s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const c=document.createElement("div");c.className="flexaligncenter",c.style="height: 2.5em; padding-right: 1em;";const u=document.createElement("div");if(s.id&&(u.id=s.id),u.className="content",u.innerHTML=s.text,c.appendChild(u),l){l.appendChild(c);const{field:d,inputElement:p,datepicker:h}=MT(s.fieldPair);h&&(r[`${s.field}.date`]=h),p&&(r[s.fieldPair.field]=p),a[s.fieldPair.field]=d,l.appendChild(d),n.appendChild(l)}else n.appendChild(c);continue}if(s.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),n.appendChild(l);continue}if(s.spacer){const l=document.createElement("div"),c=typeof s.spacer=="number"&&`${s.spacer}em`||typeof s.spacer=="string"&&s.spacer||"1em";l.style.marginBlockEnd=c,n.appendChild(l);continue}if(!(!s.label&&!s.field||s.hide)&&s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:c,inputElement:u,datepicker:d}=MT(s);if(d&&(r[`${s.field}.date`]=d),s.focus&&(o=u),r[s.field]=u,a[s.field]=c,l){l.appendChild(c);const{field:p,inputElement:h,datepicker:f}=MT(s.fieldPair);f&&(r[`${s.field}.date`]=f),h&&(r[s.fieldPair.field]=h),a[s.fieldPair.field]=p,l.appendChild(p),n.appendChild(l)}else n.appendChild(c)}}if(o&&setTimeout(()=>o.focus(),200),t.appendChild(n),i!=null&&i.length)for(const s of i){if(s.dateRange&&Array.isArray(s.fields)){const[l,c]=s.fields,u=new M5e(r[l],{inputs:[r[l],r[c]],format:"yyyy-mm-dd",autohide:!0});r[`${l}.date`]=u}s.control&&(pt(s.onChange)&&r[s.control].addEventListener("change",l=>s.onChange({e:l,inputs:r,fields:a})),pt(s.onInput)&&r[s.control]&&r[s.control].addEventListener("input",l=>s.onInput({e:l,inputs:r,fields:a})))}return r}const Ye={tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{schedule_day:null,draw_event:null},columns:{}};function k5e({table:t}){let e;const i=[{error:"minimum of 5 characters",placeholder:"Tournament name",validator:$l(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"}],n=[{fields:["startDate","endDate"],dateRange:!0}],r=u=>{e=Wr(u,i,n)},s=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-primary",onClick:()=>{const u=e.tournamentName.value,d=e.startDate.value,p=e.endDate.value;if($e.newTournamentRecord({tournamentName:u,startDate:d,endDate:p}).success){const f=Bc(),{tournamentRecord:m}=$e.getTournament();if(f!=null&&f.providerId){const g=v=>{var I;const y=(I=v.data)==null?void 0:I.provider;if(m.parentOrganisation=y,y){const b=D=>console.log("sendTournament",D);Y4e({tournamentRecord:m}).then(b,b)}a9({tournamentRecord:m,table:t})};q4e({providerId:f.providerId}).then(g)}else a9({tournamentRecord:m,table:t})}},close:()=>$l(5)(e.drawName.value)}],l="New tournament",c=(u,d)=>PI(u,s,d);Ye.drawer.open({title:l,content:r,footer:c,side:vt,width:"300px"})}function a9({tournamentRecord:t,table:e}){ix({tournamentRecord:t,callback:()=>e==null?void 0:e.addData([hN(t)],!0)})}function O5e({table:t}){const e=t.getData().map(s=>s.tournamentId);let i;const n=s=>i=Wr(s,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),r=()=>{ai({onClose:()=>Ye.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},a=s=>{var d;const l=i.tournamentId.value,c=(d=s.data.tournamentRecords)==null?void 0:d[l];ix({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};ir({title:"Login",content:n,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const s=i.tournamentId.value;e6({tournamentId:s}).then(a,r)},close:!0}]})}const eF="font-medium";function M2({target:t,button:e,stateChange:i}){var v;let n=0;const r=()=>(n+=1,`Item${n}`),a=document.createElement("div");e.class&&a.classList.add(e.class),a.classList.add("dropdown"),e.id&&(a.id=e.id),e.align===vt?(a.classList.add("is-right"),a.style="margin-left: 1em"):a.style="margin-right: 1em";const o=y=>y.classList.contains("is-active"),s=()=>{o(a)&&a.classList.remove("is-active")},l=y=>{if(o(y))y.classList.remove("is-active");else return y.classList.add("is-active"),!0};a.onmouseleave=s,a.onclick=()=>l(a);const c=document.createElement("div");c.classList.add("dropdown-trigger");const u=document.createElement("button");u.className="button font-medium",e.intent&&u.classList.add(e.intent),u.setAttribute("aria-haspopup","true");const d=document.createElement("span");pt(e.onClick)&&(d.onclick=e.onClick),d.style="margin-right: 1em",d.innerHTML=e.label,u.appendChild(d);const p=document.createElement("span");pt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,u.appendChild(p),c.appendChild(u),a.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.zIndex=99998;const f=document.createElement("div");f.classList.add("dropdown-content");const m=()=>{const y=h.querySelectorAll(".dropdown-item");for(const I of Array.from(y))I.classList.remove("is-active")},g=y=>{const I=document.createElement("a");I.className=eF;const b=y.disabled?"0.4":"1";return I.style=`text-decoration: none; opacity: ${b};`,y.color&&(I.style.color=y.color),I.classList.add("dropdown-item"),y.isActive&&I.classList.add("is-active"),y.value&&(I.value=y.value),y.class&&I.classList.add(y.class),I.onclick=D=>{if(y.disabled)return;y.value&&(u.value=y.value,a.value=y.value),D.stopPropagation(),pt(y.onClick)&&(pt(i)&&i(),y.onClick(D)),y.close&&s();const w=o(I);m(),w?d.innerHTML=e.label:(e.selection&&l(I),e.modifyLabel&&y.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${(y==null?void 0:y.label)||r()}`))},I.innerHTML=(y==null?void 0:y.label)||r(),I};for(const y of e.options||[])if(y.heading){const I=document.createElement("div");I.style="font-weight: bold",I.classList.add("dropdown-item"),I.classList.add(eF),I.innerHTML=y.heading,f.appendChild(I)}else if(y.divider){const I=document.createElement("hr");I.classList.add("dropdown-divider"),I.classList.add(eF),f.appendChild(I)}else y.hide||f.appendChild(g(y));return(v=e.options)!=null&&v.length&&(e.options[0].value&&(a.value=e.options[0].value),h.appendChild(f)),a.appendChild(h),t&&t.appendChild(a),a}class il{constructor(e){this.table=e}reloadData(e,i,n){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,n)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,n){return this.table.deprecationAdvisor.check(e,i,n)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Lr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,n){var r=e?i.split(e):[i],a=r.length,o;for(let s=0;s<a&&(n=n[r[s]],o=n,!!n);s++);return o}static deepClone(e,i,n=[]){var r={}.__proto__,a=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var o in e){let s=e[o],l,c;s!=null&&typeof s=="object"&&(s.__proto__===r||s.__proto__===a)&&(l=n.findIndex(u=>u.subject===s),l>-1?i[o]=n[l].copy:(c=Object.assign(Array.isArray(s)?[]:{},s),n.unshift({subject:s,copy:c}),i[o]=this.deepClone(s,c,n)))}return i}}let x5e=class jbe extends il{constructor(e,i,n){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=n,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),n=i?e.touches[0].pageX:e.pageX,r=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let a=Lr.elOffset(this.container);n-=a.left,r-=a.top}return{x:n,y:r}}elementPositionCoords(e,i="right"){var n=Lr.elOffset(e),r,a,o;switch(this.container!==document.body&&(r=Lr.elOffset(this.container),n.left-=r.left,n.top-=r.top),i){case"right":a=n.left+e.offsetWidth,o=n.top-1;break;case"bottom":a=n.left,o=n.top+e.offsetHeight;break;case"left":a=n.left,o=n.top-1;break;case"top":a=n.left,o=n.top;break;case"center":a=n.left+e.offsetWidth/2,o=n.top+e.offsetHeight/2;break}return{x:a,y:o,offset:n}}show(e,i){var n,r,a,o,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(a=e,s=this.elementPositionCoords(e,i),o=s.offset,n=s.x,r=s.y):typeof e=="number"?(o={top:0,left:0},n=e,r=i):(s=this.containerEventCoords(e),n=s.x,r=s.y,this.reversedX=!1),this.element.style.top=r+"px",this.element.style.left=n+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(n,r,a,o,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,n,r,a){var o=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",n?this.element.style.right=this.container.offsetWidth-r.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),i+this.element.offsetHeight>Math.max(this.container.offsetHeight,o?this.container.scrollHeight:0))if(n)switch(a){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-n.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+n.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new jbe(this.table,e,this),this.childPopup}};class Qi extends il{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...n)=>(this.table.initGuard(e),i(...n)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,n){return this.table.componentFunctionBinder.bind(e,i,n)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,n;if(this._handler&&(n=this.table.rowManager.displayPipeline.findIndex(r=>r.handler===this._handler),n>-1&&(i=n)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new x5e(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var L5e={};class kw extends Qi{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="accessor"+(r.charAt(0).toUpperCase()+r.slice(1)),o;e.definition[a]&&(o=this.lookupAccessor(e.definition[a]),o&&(i=!0,n[a]={accessor:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.accessor=n)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":kw.accessors[e]?i=kw.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var n="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),r=e.getComponent(),a=Lr.deepClone(e.data||{});return this.table.columnManager.traverse(function(o){var s,l,c,u;o.modules.accessor&&(l=o.modules.accessor[n]||o.modules.accessor.accessor||!1,l&&(s=o.getFieldValue(a),s!="undefined"&&(u=o.getComponent(),c=typeof l.params=="function"?l.params(s,a,i,u,r):l.params,o.setFieldValue(a,l.accessor(s,a,i,c,u,r)))))}),a}}kw.moduleName="accessor";kw.accessors=L5e;var F5e={method:"GET"};function R2(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(R2(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(R2(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}function $5e(t){var e=R2(t),i=[];return e.forEach(function(n){i.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}),i.join("&")}function Gbe(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+$5e(i)),t}function B5e(t,e,i){var n;return new Promise((r,a)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(n=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],n){for(var o in n.headers)e.headers||(e.headers={}),typeof e.headers[o]>"u"&&(e.headers[o]=n.headers[o]);e.body=n.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{r(l)}).catch(l=>{a(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),a(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),a(s)})):(console.warn("Ajax Load Error - No URL Set"),r([]))})}function N2(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,a)=>{i=i.concat(N2(r,e?e+"["+a+"]":a))});else if(typeof t=="object")for(var n in t)i=i.concat(N2(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}var V5e={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var n=N2(i),r=new FormData;return n.forEach(function(a){r.append(a.key,a.value)}),r}}};class Hu extends Qi{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=Hu.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||Hu.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||Hu.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,n,r){var a=this.table.options.ajaxParams;return a&&(typeof a=="function"&&(a=a.call(this.table)),r=Object.assign(Object.assign({},a),r)),r}requestDataCheck(e,i,n,r){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,n,r,a){var o;return!a&&this.requestDataCheck(e)?(e&&this.setUrl(e),o=this.generateConfig(n),this.sendRequest(this.url,i,o)):a}setDefaultConfig(e={}){this.config=Object.assign({},Hu.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,n){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,n,i).then(r=>(this.table.options.ajaxResponse&&(r=this.table.options.ajaxResponse.call(this.table,e,i,r)),r)):Promise.reject()}}Hu.moduleName="ajax";Hu.defaultConfig=F5e;Hu.defaultURLGenerator=Gbe;Hu.defaultLoaderPromise=B5e;Hu.contentTypeFormatters=V5e;var j5e={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)},range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,n=!1,r,a,o,s,l;return l=t.length,i&&(r=i.getBounds(),a=r.start,r.start===r.end&&(n=!0),a&&(e=this.table.rowManager.activeRows.slice(),o=e.indexOf(a.row),n?s=t.length:s=e.indexOf(r.end.row)-o+1,o>-1&&(this.table.blockRedraw(),e=e.slice(o,o+s),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},G5e={table:function(t){var e=[],i=!0,n=this.table.columnManager.columns,r=[],a=[];return t=t.split(`
`),t.forEach(function(o){e.push(o.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(o){var s=n.find(function(l){return o&&l.definition.title&&o.trim()&&l.definition.title.trim()===o.trim()});s?r.push(s):i=!1}),i||(i=!0,r=[],e[0].forEach(function(o){var s=n.find(function(l){return o&&l.field&&o.trim()&&l.field.trim()===o.trim()});s?r.push(s):i=!1}),i||(r=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(o){var s={};o.forEach(function(l,c){r[c]&&(s[r[c].field]=l)}),a.push(s)}),a):!1},range:function(t){var e=[],i=[],n=this.table.modules.selectRange.activeRange,r=!1,a,o,s,l,c;return n&&(a=n.getBounds(),o=a.start,a.start===a.end&&(r=!0),o&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(o.column),c>-1)))?(r?s=e[0].length:s=l.indexOf(a.end.column)-c+1,l=l.slice(c,c+s),e.forEach(u=>{var d={},p=u.length;l.forEach(function(h,f){d[h.field]=u[f%p]}),i.push(d)}),i):!1}};class Iy extends Qi{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,n,r;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(r=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),n=this.table.modules.export.generateHTMLTable(r),i=n?this.generatePlainContent(r):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),n=this.table.options.clipboardCopyFormatter("html",n))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),n&&e.clipboardData.setData("text/html",n)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),n&&e.originalEvent.clipboardData.setData("text/html",n)),this.dispatchExternal("clipboardCopied",i,n),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(n=>{var r=[];n.columns.forEach(a=>{var o="";if(a)if(n.type==="group"&&(a.value=a.component.getKey()),a.value===null)o="";else switch(typeof a.value){case"object":o=JSON.stringify(a.value);break;case"undefined":o="";break;default:o=a.value}r.push(o)}),i.push(r.join("	"))}),i.join(`
`)}copy(e,i){var n,r;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),n=window.getSelection(),n.toString()&&i&&(this.customSelection=n.toString()),n.removeAllRanges(),n.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(r=document.body.createTextRange(),r.moveToElementText(this.table.element),r.select()),document.execCommand("copy"),n&&n.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=Iy.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=Iy.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,n,r;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),n=this.pasteParser.call(this,i),n?(e.preventDefault(),this.table.modExists("mutator")&&(n=this.mutateData(n)),r=this.pasteAction.call(this,n),this.dispatchExternal("clipboardPasted",i,n,r)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,n=this.confirm("clipboard-paste",[e]);return(n||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}}Iy.moduleName="clipboard";Iy.pasteActions=j5e;Iy.pasteParsers=G5e;class H5e{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class Hbe{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,n)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class lE extends il{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}_configureCell(){var e=this.element,i=this.column.getField(),n={top:"flex-start",bottom:"flex-end",middle:"center"},r={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=n[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=r[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var a=this.column.definition.cssClass.split(" ");a.forEach(o=>{e.classList.add(o)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,n){var r=this.setValueProcessData(e,i,n);r&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,n){var r=!1;return(this.value!==e||n)&&(r=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),r&&this.dispatch("cell-value-changed",this),r}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new Hbe(this)),this.component}}class zbe{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._column.table.componentFunctionBinder.handle("column",i._column,n)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.parent instanceof sp?this._column.parent.getComponent():!1}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var n=this._column.table.columnManager.findColumn(e);n?this._column.table.columnManager.moveColumn(this._column,n,i):console.warn("Move Error - No matching column found:",n)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var Wbe={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class sp extends il{constructor(e,i){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.isGroup=!1,this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,r)=>{var a=new sp(n,this);this.attachColumn(a)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(sp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{sp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(n=>{this.element.classList.add(n)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor"),n.addEventListener("click",r=>{r.stopPropagation(),n.focus()}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{e.title=n.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(n),e.field?this.langBind("columns|"+e.field,r=>{n.value=r||e.title||"&nbsp;"}):n.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,r=>{this._formatColumnHeaderTitle(i,r||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var n=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof n){case"object":n instanceof Node?e.appendChild(n):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=n}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,n=this.fieldStructure,r=n.length,a;for(let o=0;o<r&&(i=i[n[o]],a=i,!!i);o++);return a}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var n=e,r=this.fieldStructure,a=r.length;for(let o=0;o<a;o++)if(o==a-1)n[r[o]]=i;else{if(!n[r[o]])if(typeof i<"u")n[r[o]]={};else break;n=n[r[o]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var n=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=n+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=n-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(r){r.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(n){i.push(n.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(r){r.delete()}),this.dispatch("column-delete",this);var n=this.cells.length;for(let r=0;r<n;r++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new lE(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(r=>{r.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(r=>{var a=r.getWidth();a>i&&(i=a)}),i)){var n=i+1;this.maxInitialWidth&&!e&&(n=Math.min(n,this.maxInitialWidth)),this.setWidthActual(n)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(n=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>n.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new zbe(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}}sp.defaultOptionList=Wbe;class cx{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Es extends il{constructor(e,i,n="row"){super(i.table),this.parent=i,this.data={},this.type=n,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,n;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(n=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach(function(r){var a=r.getHeight();a>i&&(i=a)}),e?this.height=Math.max(i,n):this.height=this.manualHeight?this.height:Math.max(i,n)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Lr.elVisible(this.element),n={},r;return new Promise((a,o)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,e)),r=this.chain("row-data-changing",[this,n,e],null,e);for(let s in r)this.data[s]=r[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(r);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),a()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(n){return n.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var n=this.table.rowManager.findRow(e);n?(this.table.rowManager.moveRowActual(this,n,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new cx(this)),this.component}}var z5e={avg:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:2;return t.length&&(n=t.reduce(function(a,o){return Number(a)+Number(o)}),n=n/t.length,n=r!==!1?n.toFixed(r):n),parseFloat(n).toString()},max:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a>n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},min:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(a){a=Number(a),(a<n||n===null)&&(n=a)}),n!==null?r!==!1?n.toFixed(r):n:""},sum:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(a){a=Number(a),n+=isNaN(a)?0:Number(a)}),r!==!1?n.toFixed(r):n},concat:function(t,e,i){var n=0;return t.length&&(n=t.reduce(function(r,a){return String(r)+String(a)})),n},count:function(t,e,i){var n=0;return t.length&&t.forEach(function(r){r&&n++}),n},unique:function(t,e,i){var n=t.filter((r,a)=>(t||r===0)&&t.indexOf(r)===a);return n.length}};class Im extends Qi{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new sp({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,n={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":Im.calculations[i.topCalc]?n.topCalc=Im.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":n.topCalc=i.topCalc;break}n.topCalc&&(e.modules.columnCalcs=n,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":Im.calculations[i.bottomCalc]?n.botCalc=Im.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":n.botCalc=i.bottomCalc;break}n.botCalc&&(e.modules.columnCalcs=n,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,n;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),n=this.generateRow("top",i),this.topRow=n;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(n.getElement()),n.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),n=this.generateRow("bottom",i),this.botRow=n;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(n.getElement()),n.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,n;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),n=this.generateRowData("bottom",i),e.calcs.bottom.updateData(n),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),n=this.generateRowData("top",i),e.calcs.top.updateData(n),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[];return e.forEach(n=>{if(i.push(n.getData()),this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs&&n.modules.dataTree&&n.modules.dataTree.open){var r=this.rowsToData(this.table.modules.dataTree.getFilteredTreeChildren(n));i=i.concat(r)}}),i}generateRow(e,i){var n=this.generateRowData(e,i),r;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),r=new Es(n,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),r.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),r.component=!1,r.getComponent=()=>(r.component||(r.component=new H5e(r)),r.component),r.generateCells=()=>{var a=[];this.table.columnManager.columnsByIndex.forEach(o=>{this.genColumn.setField(o.getField()),this.genColumn.hozAlign=o.hozAlign,o.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(o.definition[e+"CalcFormatter"]),params:o.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=o.definition.cssClass;var s=new lE(this.genColumn,r);s.getElement(),s.column=o,s.setWidth(),o.cells.push(s),a.push(s),o.visible||s.hide()}),r.cells=a},r}generateRowData(e,i){var n={},r=e=="top"?this.topCalcs:this.botCalcs,a=e=="top"?"topCalc":"botCalc",o,s;return r.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[a]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),s=a+"Params",o=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](c,i):l.modules.columnCalcs[s],l.setFieldValue(n,l.modules.columnCalcs[a](c,i,o)))}),n}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(n=>{e[n.getKey()]=this.getGroupResults(n)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),n=e.getSubGroups(),r={},a={};return n.forEach(o=>{r[o.getKey()]=this.getGroupResults(o)}),a={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:r},a}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}Im.moduleName="columnCalcs";Im.calculations=z5e;class qbe extends Qi{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(n,r){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(n,r){return i.dataTreeStartExpanded[r]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(n=>{this.reinitializeRowChildren(n)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,n){this.redrawNeeded(n)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],n=Array.isArray(i),r=n||!n&&typeof i=="object"&&i!==null;!r&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!r&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:r?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&r?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&r?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:r}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(n){n.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],n=i.getElement(),r=e.modules.dataTree;r.branchEl&&(r.branchEl.parentNode&&r.branchEl.parentNode.removeChild(r.branchEl),r.branchEl=!1),r.controlEl&&(r.controlEl.parentNode&&r.controlEl.parentNode.removeChild(r.controlEl),r.controlEl=!1),this.generateControlElement(e,n),e.getElement().classList.add("tabulator-tree-level-"+r.index),r.index&&(this.branchEl?(r.branchEl=this.branchEl.cloneNode(!0),n.insertBefore(r.branchEl,n.firstChild),this.table.rtl?r.branchEl.style.marginRight=(r.branchEl.offsetWidth+r.branchEl.style.marginLeft)*(r.index-1)+r.index*this.indent+"px":r.branchEl.style.marginLeft=(r.branchEl.offsetWidth+r.branchEl.style.marginRight)*(r.index-1)+r.index*this.indent+"px"):this.table.rtl?n.style.paddingRight=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-right"))+r.index*this.indent+"px":n.style.paddingLeft=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-left"))+r.index*this.indent+"px")}generateControlElement(e,i){var n=e.modules.dataTree,r=n.controlEl;i=i||e.getCells()[0].getElement(),n.children!==!1&&(n.open?(n.controlEl=this.collapseEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.collapseRow(e)})):(n.controlEl=this.expandEl.cloneNode(!0),n.controlEl.addEventListener("click",a=>{a.stopPropagation(),this.expandRow(e)})),n.controlEl.addEventListener("mousedown",a=>{a.stopPropagation()}),r&&r.parentNode===i?r.parentNode.replaceChild(n.controlEl,r):i.insertBefore(n.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((n,r)=>{var a,o;i.push(n),n instanceof Es&&(n.create(),a=n.modules.dataTree,!a.index&&a.children!==!1&&(o=this.getChildren(n),o.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i){var n=e.modules.dataTree,r=[],a=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(n.children):r=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(r),r.forEach(o=>{a.push(o);var s=this.getChildren(o);s.forEach(l=>{a.push(l)})})),a}generateChildren(e){var i=[],n=e.getData()[this.field];return Array.isArray(n)||(n=[n]),n.forEach(r=>{var a=new Es(r||{},this.table.rowManager);a.create(),a.modules.dataTree.index=e.modules.dataTree.index+1,a.modules.dataTree.parent=e,a.modules.dataTree.children&&(a.modules.dataTree.open=this.startOpen(a.getComponent(),a.modules.dataTree.index)),i.push(a)}),i}expandRow(e,i){var n=e.modules.dataTree;n.children!==!1&&(n.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,n=[],r;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(i.children):r=i.children,r.forEach(a=>{a instanceof Es&&n.push(a)})),n}rowDelete(e){var i=e.modules.dataTree.parent,n;i&&(n=this.findChildIndex(e,i),n!==!1&&i.data[this.field].splice(n,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,n,r){var a=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof r<"u"&&(a=this.findChildIndex(r,e),a!==!1&&e.data[this.field].splice(n?a:a+1,0,i)),a===!1&&(n?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var n=!1;return typeof e=="object"?e instanceof Es?n=e.data:e instanceof cx?n=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(n=i.modules.dataTree.children.find(r=>r instanceof Es?r.element===e:!1),n&&(n=n.data)):e===null&&(n=!1):typeof e>"u"?n=!1:n=i.data[this.field].find(r=>r.data[this.table.options.index]==e),n&&(Array.isArray(i.data[this.field])&&(n=i.data[this.field].indexOf(n)),n==-1&&(n=!1)),n}getTreeChildren(e,i,n){var r=e.modules.dataTree,a=[];return r&&r.children&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),r.children.forEach(o=>{o instanceof Es&&(a.push(i?o.getComponent():o),n&&(a=a.concat(this.getTreeChildren(o,i,n))))})),a}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}qbe.moduleName="dataTree";function W5e(t,e={},i){var n=e.delimiter?e.delimiter:",",r=[],a=[];t.forEach(o=>{var s=[];switch(o.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":o.columns.forEach((l,c)=>{l&&l.depth===1&&(a[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":o.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),r.push(s.join(n));break}}),a.length&&r.unshift(a.join(n)),r=r.join(`
`),e.bom&&(r="\uFEFF"+r),i(r,"text/csv")}function q5e(t,e,i){var n=[];t.forEach(r=>{var a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),n.push(a);break}}),n=JSON.stringify(n,null,"	"),i(n,"application/json")}function K5e(t,e={},i){var n=[],r=[],a={},o=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":n.push(u(p));break;case"group":r.push(u(p,o));break;case"calc":r.push(u(p,s));break;case"row":r.push(u(p));break}});function u(p,h){var f=[];return p.columns.forEach(m=>{var g;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}g={content:m.value,colSpan:m.width,rowSpan:m.height},h&&(g.styles=h),f.push(g)}}),f}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?a=e.autoTable(d)||{}:a=e.autoTable),c&&(a.didDrawPage=function(p){d.text(c,40,30)}),a.head=n,a.body=r,d.autoTable(a),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function Y5e(t,e,i){var n=this,r=e.sheetName||"Sheet1",a=XLSX.utils.book_new(),o=new il(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},c;l.type="binary",a.SheetNames=[],a.Sheets={};function u(){var h=[],f=[],m={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var I=[];v.columns.forEach(function(b,D){b?(I.push(!(b.value instanceof Date)&&typeof b.value=="object"?JSON.stringify(b.value):b.value),(b.width>1||b.height>-1)&&(b.height>1||b.width>1)&&f.push({s:{r:y,c:D},e:{r:y+b.height-1,c:D+b.width-1}})):I.push("")}),h.push(I)}),XLSX.utils.sheet_add_aoa(m,h),m["!ref"]=XLSX.utils.encode_range(g),f.length&&(m["!merges"]=f),m}if(e.sheetOnly){i(u());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(a.SheetNames.push(d),a.Sheets[d]=u()):(a.SheetNames.push(d),o.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(h){a.Sheets[d]=h}}));else a.SheetNames.push(r),a.Sheets[r]=u();e.documentProcessing&&(a=e.documentProcessing(a));function p(h){for(var f=new ArrayBuffer(h.length),m=new Uint8Array(f),g=0;g!=h.length;++g)m[g]=h.charCodeAt(g)&255;return f}c=XLSX.write(a,l),i(p(c),"application/octet-stream")}function Z5e(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function X5e(t,e,i){const n=[];t.forEach(r=>{const a={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(o=>{o&&(a[o.component.getTitleDownload()||o.component.getField()]=o.value)}),n.push(JSON.stringify(a));break}}),i(n.join(`
`),"application/x-ndjson")}var J5e={csv:W5e,json:q5e,jsonLines:X5e,pdf:K5e,xlsx:Y5e,html:Z5e};class Ow extends Qi{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,n){return new Blob([i],{type:n})}),this.registerTableOption("downloadReady",void 0),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("downloadReady","downloadEncoder")}downloadToTab(e,i,n,r){this.download(e,i,n,r,!0)}download(e,i,n,r,a){var o=!1;function s(c,u){a?a===!0?this.triggerDownload(c,u,e,i,!0):a(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?o=e:Ow.downloaders[e]?o=Ow.downloaders[e]:console.warn("Download Error - No such download type found: ",e),o){var l=this.generateExportList(r);o.call(this.table,l,n||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),n=this.table.options.groupHeaderDownload;return n&&!Array.isArray(n)&&(n=[n]),i.forEach(r=>{var a;r.type==="group"&&(a=r.columns[0],n&&n[r.indent]&&(a.value=n[r.indent](a.value,r.component._group.getRowCount(),r.component._group.getData(),r.component)))}),i}triggerDownload(e,i,n,r,a){var o=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(a?window.open(window.URL.createObjectURL(s)):(r=r||"Tabulator."+(typeof n=="function"?"txt":n),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,r):(o.setAttribute("href",window.URL.createObjectURL(s)),o.setAttribute("download",r),o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,n){switch(i){case"intercept":this.download(n.type,"",n.options,n.active,n.intercept);break}}}Ow.moduleName="download";Ow.downloaders=J5e;function ux(t,e){var i=e.mask,n=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",r=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",a=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function o(s){var l=i[s];typeof l<"u"&&l!==a&&l!==n&&l!==r&&(t.value=t.value+""+l,o(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,c=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case n:if(c.toUpperCase()==c.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case r:if(isNaN(c))return s.preventDefault(),s.stopPropagation(),!1;break;case a:break;default:if(c!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&o(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&o(t.value.length)}function Q5e(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type",r.search?"search":"text"),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+r.elementAttributes["+"+l])):o.setAttribute(l,r.elementAttributes[l]);o.value=typeof a<"u"?a:"",e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%",r.selectContents&&o.select())});function s(l){(a===null||typeof a>"u")&&o.value!==""||o.value!==a?i(o.value)&&(a=o.value):n()}return o.addEventListener("change",s),o.addEventListener("blur",s),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break;case 35:case 36:l.stopPropagation();break}}),r.mask&&ux(o,r),o}function e6e(t,e,i,n,r){var a=t.getValue(),o=r.verticalNavigation||"hybrid",s=String(a!==null&&typeof a<"u"?a:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",r.elementAttributes&&typeof r.elementAttributes=="object")for(let d in r.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+r.elementAttributes["+"+d])):l.setAttribute(d,r.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),r.selectContents&&l.select())});function u(d){(a===null||typeof a>"u")&&l.value!==""||l.value!==a?(i(l.value)&&(a=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):n()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&r.shiftEnterSubmit&&u();break;case 27:n();break;case 38:(o=="editor"||o=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(o=="editor"||o=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),r.mask&&ux(l,r),l}function t6e(t,e,i,n,r){var a=t.getValue(),o=r.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof r.max<"u"&&s.setAttribute("max",r.max),typeof r.min<"u"&&s.setAttribute("min",r.min),typeof r.step<"u"&&s.setAttribute("step",r.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let u in r.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),s.setAttribute(u,s.getAttribute(u)+r.elementAttributes["+"+u])):s.setAttribute(u,r.elementAttributes[u]);s.value=a;var l=function(u){c()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),r.selectContents&&s.select())});function c(){var u=s.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==a?i(u)&&(a=u):n()}return s.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:n();break;case 38:case 40:o=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),r.mask&&ux(s,r),s}function i6e(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input");if(o.setAttribute("type","range"),typeof r.max<"u"&&o.setAttribute("max",r.max),typeof r.min<"u"&&o.setAttribute("min",r.min),typeof r.step<"u"&&o.setAttribute("step",r.step),o.style.padding="4px",o.style.width="100%",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),o.setAttribute(l,o.getAttribute(l)+r.elementAttributes["+"+l])):o.setAttribute(l,r.elementAttributes[l]);o.value=a,e(function(){t.getType()==="cell"&&(o.focus({preventScroll:!0}),o.style.height="100%")});function s(){var l=o.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=a?i(l)&&(a=l):n()}return o.addEventListener("blur",function(l){s()}),o.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break}}),o}function n6e(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var h;return s.isDateTime(p)?h=p:a==="iso"?h=s.fromISO(String(p)):h=s.fromFormat(String(p),a),h.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.max&&c.setAttribute("max",a?u(r.max):r.max),r.min&&c.setAttribute("min",a?u(r.min):r.min),r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);l=typeof l<"u"?l:"",a&&(s?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,h;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&a)switch(h=s.fromFormat(String(p),"yyyy-MM-dd"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(l=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function r6e(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(s?(s.isDateTime(c)?l=c:a==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),a),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),console.log("val",c),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=s.fromFormat(String(p),"hh:mm"),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function a6e(t,e,i,n,r){var a=r.format,o=r.verticalNavigation||"editor",s=a?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",a&&(s?(s.isDateTime(c)?l=c:a==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),a),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&a)switch(h=s.fromISO(String(p)),a){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(a)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:o=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}class l6{constructor(e,i,n,r,a,o){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(o),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:r,cancel:a},this._deprecatedOptionsCheck(),this._initializeValue(),n(this._onRendered.bind(this))}_deprecatedOptionsCheck(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(n){n.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let n in e)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,i.getAttribute(n)+e["+"+n])):i.setAttribute(n,e[n]);return this.params.mask&&ux(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],n;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",n=Object.keys(e).filter(r=>i.includes(r)).length,n?n>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var n=this.displayItems.find(r=>typeof r.label<"u"&&r.label.toLowerCase().startsWith(this.filterTerm));n&&this._focusItem(n),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],n=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(r=>this.listIteration===n?this._parseList(r):Promise.reject(n))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var n=this.params.filterRemote?{term:i}:{};return e=Gbe(e,{},n),fetch(e).then(r=>r.ok?r.json().catch(a=>(console.warn("List Ajax Load Error - Invalid JSON returned",a),Promise.reject(a))):(console.error("List Ajax Load Error - Connection Error: "+r.status,r.statusText),Promise.reject(r))).catch(r=>(console.error("List Ajax Load Error - Connection Error: ",r),Promise.reject(r)))}_uniqueColumnValues(e){var i={},n=this.table.getData(this.params.valuesLookup),r;return e?r=this.table.columnManager.getColumnByField(e):r=this.cell.getColumn()._getSelf(),r?n.forEach(a=>{var o=r.getFieldValue(a);o!==null&&typeof o<"u"&&o!==""&&(i[o]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([n,r])=>({label:r,value:n}))),e.forEach(n=>{typeof n!="object"&&(n={label:n,value:n}),this._parseListItem(n,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,n){var r={};e.options?r=this._parseListGroup(e,n+1):(r={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:n,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(r,!0)),i.push(r)}_parseListGroup(e,i){var n={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(r=>{this._parseListItem(r,n.options,i)}),n}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((n,r)=>e(n.label,r.label,n.value,r.value,n.original,r.original)),i.forEach(n=>{n.group&&this._sortGroup(e,n.options)})}_defaultSortFunction(e,i){var n,r,a,o,s=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(n=String(e).toLowerCase(),r=String(i).toLowerCase(),n===r)return 0;if(!(u.test(n)&&u.test(r)))return n>r?1:-1;for(n=n.match(c),r=r.match(c),l=n.length>r.length?r.length:n.length;s<l;)if(a=n[s],o=r[s++],a!==o)return isFinite(a)&&isFinite(o)?(a.charAt(0)==="0"&&(a="."+a),o.charAt(0)==="0"&&(o="."+o),a-o):a>o?1:-1;return n.length>r.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(n=>{this._filterItem(e,i,n)})):this.filtered=!1,this.data}_filterItem(e,i,n){var r=!1;return n.group?(n.options.forEach(a=>{this._filterItem(e,i,a)&&(r=!0)}),n.visible=r):n.visible=e(i,n.label,n.value,n.original),n.visible}_defaultFilterFunc(e,i,n,r){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(n).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,n;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,n=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,n instanceof HTMLElement?i.appendChild(n):i.innerHTML=n,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let r in e.elementAttributes)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,this.input.getAttribute(r)+e.elementAttributes["+"+r])):i.setAttribute(r,e.elementAttributes[r]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(r=>{this._buildItem(r)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var n;this.typing=!1,this.params.multiselect?(n=this.currentItems.indexOf(e),n>-1?(this.currentItems.splice(n,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(r=>r.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,n;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(r=>r.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(n=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,n===null||typeof n>"u"||n===""?i=n:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}}function o6e(t,e,i,n,r){this.deprecationMsg("The select editor has been deprecated, please use the new list editor");var a=new l6(this,t,e,i,n,r);return a.input}function s6e(t,e,i,n,r){var a=new l6(this,t,e,i,n,r);return a.input}function l6e(t,e,i,n,r){this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),r.autocomplete=!0;var a=new l6(this,t,e,i,n,r);return a.input}function c6e(t,e,i,n,r){var a=this,o=t.getElement(),s=t.getValue(),l=o.getElementsByTagName("svg").length||5,c=o.getElementsByTagName("svg")[0]?o.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function h(v){u.forEach(function(y,I){I<v?(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(a.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function f(v){var y=document.createElement("span"),I=p.cloneNode(!0);u.push(I),y.addEventListener("mouseenter",function(b){b.stopPropagation(),b.stopImmediatePropagation(),h(v)}),y.addEventListener("mousemove",function(b){b.stopPropagation(),b.stopImmediatePropagation()}),y.addEventListener("click",function(b){b.stopPropagation(),b.stopImmediatePropagation(),i(v),o.blur()}),y.appendChild(I),d.appendChild(y)}function m(v){s=v,h(v)}if(o.style.whiteSpace="nowrap",o.style.overflow="hidden",o.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",r.elementAttributes&&typeof r.elementAttributes=="object")for(let v in r.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+r.elementAttributes["+"+v])):d.setAttribute(v,r.elementAttributes[v]);for(var g=1;g<=l;g++)f(g);return s=Math.min(parseInt(s),l),h(s),d.addEventListener("mousemove",function(v){h(0)}),d.addEventListener("click",function(v){i(0)}),o.addEventListener("blur",function(v){n()}),o.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(s+1);break;case 37:m(s-1);break;case 13:i(s);break;case 27:n();break}}),d}function u6e(t,e,i,n,r){var a=t.getElement(),o=typeof r.max>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("max")||100:r.max,s=typeof r.min>"u"?a.getElementsByTagName("div")[0]&&a.getElementsByTagName("div")[0].getAttribute("min")||0:r.min,l=(o-s)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,h;function f(){var m=window.getComputedStyle(a,null),g=l*Math.round(d.offsetWidth/((a.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+s;i(g),a.setAttribute("aria-valuenow",g),a.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",r.elementAttributes&&typeof r.elementAttributes=="object")for(let m in r.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+r.elementAttributes["+"+m])):d.setAttribute(m,r.elementAttributes[m]);return a.style.padding="4px 4px",c=Math.min(parseFloat(c),o),c=Math.max(parseFloat(c),s),c=Math.round((c-s)/l),d.style.width=c+"%",a.setAttribute("aria-valuemin",s),a.setAttribute("aria-valuemax",o),d.appendChild(u),u.addEventListener("mousedown",function(m){p=m.screenX,h=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),a.addEventListener("mousemove",function(m){p&&(d.style.width=h+m.screenX-p+"px")}),a.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,h=!1,f())}),a.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+a.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-a.clientWidth/100+"px";break;case 9:case 13:f();break;case 27:n();break}}),a.addEventListener("blur",function(){n()}),d}function d6e(t,e,i,n,r){var a=t.getValue(),o=document.createElement("input"),s=r.tristate,l=typeof r.indeterminateValue>"u"?null:r.indeterminateValue,c=!1,u=Object.keys(r).includes("trueValue"),d=Object.keys(r).includes("falseValue");if(o.setAttribute("type","checkbox"),o.style.marginTop="5px",o.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let h in r.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),o.setAttribute(h,o.getAttribute(h)+r.elementAttributes["+"+h])):o.setAttribute(h,r.elementAttributes[h]);o.value=a,s&&(typeof a>"u"||a===l||a==="")&&(c=!0,o.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&o.focus({preventScroll:!0})}),o.checked=u?a===r.trueValue:a===!0||a==="true"||a==="True"||a===1;function p(h){var f=o.checked;return u&&f?f=r.trueValue:d&&!f&&(f=r.falseValue),s?h?c?l:f:o.checked&&!c?(o.checked=!1,o.indeterminate=!0,c=!0,l):(c=!1,f):f}return o.addEventListener("change",function(h){i(p())}),o.addEventListener("blur",function(h){i(p(!0))}),o.addEventListener("keydown",function(h){h.keyCode==13&&i(p()),h.keyCode==27&&n()}),o}var p6e={input:Q5e,textarea:e6e,number:t6e,range:i6e,date:n6e,time:r6e,datetime:a6e,select:o6e,list:s6e,autocomplete:l6e,star:c6e,progress:u6e,tickCross:d6e};class cE extends Qi{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.editors=cE.editors,this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableOption("editTriggerEvent","focus"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,n=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||n&&(i.getElement().firstChild.blur(),this.invalidEdit||(n===!0?n=this.table.addRow({}):typeof n=="function"?n=this.table.addRow(n(i.row.getComponent())):n=this.table.addRow(Object.assign({},n)),n.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateLeft(),n)return!0;if(r=this.table.rowManager.prevDisplayRow(e.row,!0),r&&(n=this.findPrevEditableCell(r,r.cells.length),n))return n.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateRight(),n)return!0;if(r=this.table.rowManager.nextDisplayRow(e.row,!0),r&&(n=this.findNextEditableCell(r,-1),n))return n.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findPrevEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findNextEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.prevDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.nextDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var n=!1;if(i<e.cells.length-1)for(var r=i+1;r<e.cells.length;r++){let a=e.cells[r];if(a.column.modules.edit&&Lr.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}findPrevEditableCell(e,i){var n=!1;if(i>0)for(var r=i-1;r>=0;r--){let a=e.cells[r];if(a.column.modules.edit&&Lr.elVisible(a.getElement())&&this.allowEdit(a)){n=a;break}}return n}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{}};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?i.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":i.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?i.editor=this.editors[e.definition.formatter]:i.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}i.editor&&(e.modules.edit=i)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,n;if(this.invalidEdit=!1,i){for(this.currentCell=!1,n=i.getElement(),this.dispatch("edit-editor-clear",i,e),n.classList.remove("tabulator-editing");n.firstChild;)n.removeChild(n.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,n=e.getElement(!0);this.updateCellClass(e),n.setAttribute("tabindex",0),n.addEventListener("mousedown",function(r){r.button===2?r.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&n.addEventListener("dblclick",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&n.addEventListener("click",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),this.options("editTriggerEvent")==="focus"&&n.addEventListener("focus",function(r){i.recursionBlock||i.edit(e,r,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,n=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,r=e.row.getElement();r.offsetTop<i?this.table.rowManager.element.scrollTop-=i-r.offsetTop:r.offsetTop+r.offsetHeight>n&&(this.table.rowManager.element.scrollTop+=r.offsetTop+r.offsetHeight-n);var a=this.table.rowManager.element.scrollLeft,o=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(a+=parseInt(this.table.modules.frozenColumns.leftMargin||0),o-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(a-=parseInt(this.table.columnManager.renderer.vDomPadLeft),o-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<a?this.table.rowManager.element.scrollLeft-=a-s.offsetLeft:s.offsetLeft+s.offsetWidth>o&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-o)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,n){var r=this,a=!0,o=function(){},s=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(r.currentCell===e&&!l){var y=r.chain("edit-success",[e,v],!0,!0);return y===!0||r.table.options.validationMode==="highlight"?(l=!0,r.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,r.editedCells.indexOf(e)==-1&&r.editedCells.push(e),e.setValue(v,!0),y===!0):(l=!0,r.invalidEdit=!0,r.focusCellNoEvent(e,!0),o(),setTimeout(()=>{l=!1},10),!1)}}function h(){r.currentCell===e&&!l&&r.cancelEdit()}function f(v){o=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),a=this.allowEdit(e),a||n){if(r.cancelEdit(),r.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(r,u,f,p,h,d),this.currentCell&&c!==!1)if(c instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(c),o();for(var m=s.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}cE.moduleName="edit";cE.editors=p6e;class o9{constructor(e,i,n,r){this.type=e,this.columns=i,this.component=n||!1,this.indent=r||0}}class tF{constructor(e,i,n,r,a){this.value=e,this.component=i||!1,this.width=n,this.height=r,this.depth=a}}class Kbe extends Qi{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,n,r){this.cloneTableStyle=i,this.config=e||{},this.colVisProp=r;var a,o;if(n==="range"){var s=this.table.modules.selectRange.selectedColumns();a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],o=this.bodyToExportRows(this.rowLookup(n),this.table.modules.selectRange.selectedColumns(!0))}else a=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders()):[],o=this.bodyToExportRows(this.rowLookup(n));return a.concat(o)}generateTable(e,i,n,r){var a=this.generateExportList(e,i,n,r);return this.generateTableElement(a)}rowLookup(e){var i=[];if(typeof e=="function")e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)});else switch(e){case!0:case"visible":i=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":i=this.table.rowManager.rows;break;case"selected":i=this.table.modules.selectRow.selectedRows;break;case"range":i=this.table.modules.selectRange.selectedRows();break;case"active":default:this.table.options.pagination?i=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):i=this.table.rowManager.getDisplayRows()}return Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(n=>{var r=this.processColumnGroup(n);r&&i.push(r)}),i}processColumnGroup(e){var i=e.columns,n=0,r=e.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||e.definition.title,a={title:r,column:e,depth:1};if(i.length){if(a.subGroups=[],a.width=0,i.forEach(o=>{var s=this.processColumnGroup(o);s&&(a.width+=s.width,a.subGroups.push(s),s.depth>n&&(n=s.depth))}),a.depth+=n,!a.width)return!1}else if(this.columnVisCheck(e))a.width=1;else return!1;return a}columnVisCheck(e){var i=e.definition[this.colVisProp];return typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i!==!1&&(e.visible||!e.visible&&i)}headersToExportRows(e){var i=[],n=0,r=[];function a(o,s){var l=n-s;if(typeof i[s]>"u"&&(i[s]=[]),o.height=o.subGroups?1:l-o.depth+1,i[s].push(o),o.height>1)for(let c=1;c<o.height;c++)typeof i[s+c]>"u"&&(i[s+c]=[]),i[s+c].push(!1);if(o.width>1)for(let c=1;c<o.width;c++)i[s].push(!1);o.subGroups&&o.subGroups.forEach(function(c){a(c,s+1)})}return e.forEach(function(o){o.depth>n&&(n=o.depth)}),e.forEach(function(o){a(o,0)}),i.forEach(o=>{var s=[];o.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;s.push(new tF(c,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),r.push(new o9("header",s))}),r}bodyToExportRows(e,i=[]){var n=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(r=>{this.columnVisCheck(r)&&i.push(r.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(r=>{switch(r.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&r.modules.dataTree.parent)}return!0}),e.forEach((r,a)=>{var o=r.getData(this.colVisProp),s=[],l=0;switch(r.type){case"group":l=r.level,s.push(new tF(r.key,r.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{s.push(new tF(c._column.getFieldValue(o),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=r.modules.dataTree.index);break}n.push(new o9(r.type,s,r.getComponent(),l))}),n}generateTableElement(e){var i=document.createElement("table"),n=document.createElement("thead"),r=document.createElement("tbody"),a=this.lookupTableStyles(),o=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],s={};return s.rowFormatter=o!==null?o:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),n,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":n.appendChild(this.generateHeaderElement(l,s,a));break;case"group":r.appendChild(this.generateGroupElement(l,s,a));break;case"calc":r.appendChild(this.generateCalcElement(l,s,a));break;case"row":u=this.generateRowElement(l,s,a),this.mapElementStyles(c%2&&a.evenRow?a.evenRow:a.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r.appendChild(u);break}}),n.innerHTML&&i.appendChild(n),i.appendChild(r),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,n){var r=document.createElement("tr");return e.columns.forEach(a=>{if(a){var o=document.createElement("th"),s=a.component._column.definition.cssClass?a.component._column.definition.cssClass.split(" "):[];o.colSpan=a.width,o.rowSpan=a.height,o.innerHTML=a.value,this.cloneTableStyle&&(o.style.boxSizing="border-box"),s.forEach(function(l){o.classList.add(l)}),this.mapElementStyles(a.component.getElement(),o,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(a.component._column.contentElement,o,["padding-top","padding-left","padding-right","padding-bottom"]),a.component._column.visible?this.mapElementStyles(a.component.getElement(),o,["width"]):a.component._column.definition.width&&(o.style.width=a.component._column.definition.width+"px"),a.component._column.parent&&this.mapElementStyles(a.component._column.parent.groupElement,o,["border-top"]),r.appendChild(o)}}),r}generateGroupElement(e,i,n){var r=document.createElement("tr"),a=document.createElement("td"),o=e.columns[0];return r.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?o.value=i.groupHeader[e.indent](o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(o.value=e.component._group.generator(o.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),a.colSpan=o.width,a.innerHTML=o.value,r.classList.add("tabulator-print-table-group"),r.classList.add("tabulator-group-level-"+e.indent),o.component.isVisible()&&r.classList.add("tabulator-group-visible"),this.mapElementStyles(n.firstGroup,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(n.firstGroup,a,["padding-top","padding-left","padding-right","padding-bottom"]),r.appendChild(a),r}generateCalcElement(e,i,n){var r=this.generateRowElement(e,i,n);return r.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(n.calcRow,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r}generateRowElement(e,i,n){var r=document.createElement("tr");if(r.classList.add("tabulator-print-table-row"),e.columns.forEach((a,o)=>{if(a){var s=document.createElement("td"),l=a.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=a.value,p,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return h},column:l},f=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(f.forEach(function(m){s.classList.add(m)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,p=n.styleCells&&n.styleCells[u]?n.styleCells[u]:n.firstCell,p&&(this.mapElementStyles(p,s,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&o==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),r.appendChild(s),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let a=Object.assign(e.component);a.getElement=function(){return r},i.rowFormatter(e.component)}return r}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,n,r){var a=this.generateExportList(n||this.table.options.htmlOutputConfig,i,e,r||"htmlOutput");return this.generateHTMLTable(a)}mapElementStyles(e,i,n){if(this.cloneTableStyle&&e&&i){var r={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var a=window.getComputedStyle(e);n.forEach(function(o){i.style[r[o]]||(i.style[r[o]]=a.getPropertyValue(o))})}}}}Kbe.moduleName="export";var h6e={"=":function(t,e,i,n){return e==t},"<":function(t,e,i,n){return e<t},"<=":function(t,e,i,n){return e<=t},">":function(t,e,i,n){return e>t},">=":function(t,e,i,n){return e>=t},"!=":function(t,e,i,n){return e!=t},regex:function(t,e,i,n){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,n){var r=t.toLowerCase().split(typeof n.separator>"u"?" ":n.separator),a=String(e===null||typeof e>"u"?"":e).toLowerCase(),o=[];return r.forEach(s=>{a.includes(s)&&o.push(!0)}),n.matchAll?o.length===r.length:!!o.length},starts:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,n){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Ah extends Qi{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,n,r){return r.filter=this.getFilters(!0,!0),r}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,n,r){this.setFilter(e,i,n,r),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,n,r){this.addFilter(e,i,n,r),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var n=this.table.columnManager.findColumn(e);if(n)this.setHeaderFilterValue(n,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,n){this.removeFilter(e,i,n),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,n){return this.search("rows",e,i,n)}searchData(e,i,n){return this.search("data",e,i,n)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var n=this,r=e.getField();function a(o){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==o){if(e.modules.filter.prevSuccess=o,e.modules.filter.emptyFunc(o))delete n.headerFilters[r];else{switch(e.modules.filter.value=o,typeof e.definition.headerFilterFunc){case"string":Ah.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(o,h,d):p,Ah.filters[e.definition.headerFilterFunc](o,h,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(o,h,d):p,e.definition.headerFilterFunc(o,h,d,p)},l=u;break}if(!u)switch(s){case"partial":u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(o).toLowerCase())>-1:!1},l="like";break;default:u=function(d){return e.getFieldValue(d)==o},l="="}n.headerFilters[r]={value:o,func:u,type:l}}e.modules.filter.value=o,c=JSON.stringify(n.headerFilters),n.prevHeaderFilterChangeCheck!==c&&(n.prevHeaderFilterChangeCheck=c,n.trackChanges(),n.refreshFilter())}return!0}e.modules.filter={success:a,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,n){var r=this,a=e.modules.filter.success,o=e.getField(),s,l,c,u,d,p,h,f;e.modules.filter.value=i;function m(){}function g(v){f=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),o){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":r.table.modules.edit.editors[e.definition.headerFilter]?(l=r.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&r.table.modules.edit.editors[e.definition.formatter]?(l=r.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=r.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},h=e.definition.headerFilterParams||{},h=typeof h=="function"?h.call(r.table,u):h,c=l.call(this.table.modules.edit,u,g,a,m,h),!c){console.warn("Filter Error - Cannot add filter to "+o+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+o+" column, editor should return an instance of Node, the editor returned:",c);return}r.langBind("headerFilters|columns|"+e.definition.field,function(v){c.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||r.langText("headerFilters|default"))}),c.addEventListener("click",function(v){v.stopPropagation(),c.focus()}),c.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,I=this.table.rowManager.element.scrollLeft;y!==I&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){a(c.value)},r.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(v){a(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(c),e.contentElement.appendChild(s),n||r.headerFilterColumns.push(e),f&&f()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,n,r){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),this.addFilter(e)}addFilter(e,i,n,r){var a=!1;Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),e.forEach(o=>{o=this.findFilter(o),o&&(this.filterList.push(o),a=!0)}),a&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var n=!1;return typeof e.field=="function"?n=function(r){return e.field(r,e.type||{})}:Ah.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?n=function(r){return Ah.filters[e.type](e.value,i.getFieldValue(r),r,e.params||{})}:n=function(r){return Ah.filters[e.type](e.value,r[e.field],r,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=n,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(n=>{n=this.findFilter(n),n&&i.push(n)}),i.length?i:!1}getFilters(e,i){var n=[];return e&&(n=this.getHeaderFilters()),i&&n.forEach(function(r){typeof r.type=="function"&&(r.type="function")}),n=n.concat(this.filtersToArray(this.filterList,i)),n}filtersToArray(e,i){var n=[];return e.forEach(r=>{var a;Array.isArray(r)?n.push(this.filtersToArray(r,i)):(a={field:r.field,type:r.type,value:r.value},i&&typeof a.type=="function"&&(a.type="function"),n.push(a))}),n}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,n){Array.isArray(e)||(e=[{field:e,type:i,value:n}]),e.forEach(r=>{var a=-1;typeof r.field=="object"?a=this.filterList.findIndex(o=>r===o):a=this.filterList.findIndex(o=>r.field===o.field&&r.type===o.type&&r.value===o.value),a>-1?this.filterList.splice(a,1):console.warn("Filter Error - No matching filter type found, ignoring: ",r.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,n,r){var a=[],o=[];return Array.isArray(i)||(i=[{field:i,type:n,value:r}]),i.forEach(s=>{s=this.findFilter(s),s&&o.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;o.forEach(c=>{this.filterRecurse(c,s.getData())||(l=!1)}),l&&a.push(e==="data"?s.getData("data"):s.getComponent())}),a}filter(e,i){var n=[],r=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(a=>{this.filterRow(a)&&n.push(a)}):n=e.slice(0),this.subscribedExternal("dataFiltered")&&(n.forEach(a=>{r.push(a.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),r)),n}filterRow(e,i){var n=!0,r=e.getData();this.filterList.forEach(o=>{this.filterRecurse(o,r)||(n=!1)});for(var a in this.headerFilters)this.headerFilters[a].func(r)||(n=!1);return n}filterRecurse(e,i){var n=!1;return Array.isArray(e)?e.forEach(r=>{this.filterRecurse(r,i)&&(n=!0)}):n=e.func(i),n}}Ah.moduleName="filter";Ah.filters=h6e;function f6e(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function m6e(t,e,i){return t.getValue()}function g6e(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function v6e(t,e,i){var n=parseFloat(t.getValue()),r="",a,o,s,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",h=e.symbol||"",f=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(n))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(n<0&&(n=Math.abs(n),r=p),a=m!==!1?n.toFixed(m):n,a=String(a).split("."),o=a[0],s=a.length>1?u+a[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(o);)o=o.replace(l,"$1"+d+"$2");return c=o+s,r===!0?(c="("+c+")",f?c+h:h+c):f?r+c+h:r+h+c}function y6e(t,e,i){var n=t.getValue(),r=e.urlPrefix||"",a=e.download,o=n,s=document.createElement("a"),l;function c(u,d){var p=u.shift(),h=d[p];return u.length&&typeof h=="object"?c(u,h):h}if(e.labelField&&(l=t.getData(),o=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":o=e.label;break;case"function":o=e.label(t);break}if(o){if(e.urlField&&(l=t.getData(),n=Lr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":n=e.url;break;case"function":n=e.url(t);break}return s.setAttribute("href",r+n),e.target&&s.setAttribute("target",e.target),e.download&&(typeof a=="function"?a=a(t):a=a===!0?"":a,s.setAttribute("download",a)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(o)),s}else return"&nbsp;"}function I6e(t,e,i){var n=document.createElement("img"),r=t.getValue();switch(e.urlPrefix&&(r=e.urlPrefix+t.getValue()),e.urlSuffix&&(r=r+e.urlSuffix),n.setAttribute("src",r),typeof e.height){case"number":n.style.height=e.height+"px";break;case"string":n.style.height=e.height;break}switch(typeof e.width){case"number":n.style.width=e.width+"px";break;case"string":n.style.width=e.width;break}return n.addEventListener("load",function(){t.getRow().normalizeHeight()}),n}function b6e(t,e,i){var n=t.getValue(),r=t.getElement(),a=e.allowEmpty,o=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&n===e.trueValue||!s&&(o&&n||n===!0||n==="true"||n==="True"||n===1||n==="1")?(r.setAttribute("aria-checked",!0),l||""):a&&(n==="null"||n===""||n===null||typeof n>"u")?(r.setAttribute("aria-checked","mixed"),""):(r.setAttribute("aria-checked",!1),c||"")}function w6e(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=e.outputFormat||"dd/MM/yyyy HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof n<"u"){var l;return n.isDateTime(s)?l=s:r==="iso"?l=n.fromISO(String(s)):l=n.fromFormat(String(s),r),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(a)):o===!0||!s?s:typeof o=="function"?o(s):o}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function S6e(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",o=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:n.now(),u=t.getValue();if(typeof n<"u"){var d;return n.isDateTime(u)?d=u:r==="iso"?d=n.fromISO(String(u)):d=n.fromFormat(String(u),r),d.isValid?l?d.diff(c,s).toHuman()+(o?" "+o:""):parseInt(d.diff(c,s)[s])+(o?" "+o:""):a===!0?u:typeof a=="function"?a(u):a}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function T6e(t,e,i){var n=t.getValue();return typeof e[n]>"u"?(console.warn("Missing display value for "+n),n):e[n]}function U6e(t,e,i){var n=t.getValue(),r=t.getElement(),a=e&&e.stars?e.stars:5,o=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';o.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",n=n&&!isNaN(n)?parseInt(n):0,n=Math.max(0,Math.min(n,a));for(var u=1;u<=a;u++){var d=s.cloneNode(!0);d.innerHTML=u<=n?l:c,o.appendChild(d)}return r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.setAttribute("aria-label",n),o}function D6e(t,e,i){var n=this.sanitizeHTML(t.getValue())||0,r=document.createElement("span"),a=e&&e.max?e.max:100,o=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(n)||typeof t.getValue()>"u")){switch(r.classList.add("tabulator-traffic-light"),u=parseFloat(n)<=a?parseFloat(n):a,u=parseFloat(u)>=o?parseFloat(u):o,c=(a-o)/100,u=Math.round((u-o)/c),typeof s){case"string":l=s;break;case"function":l=s(n);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(u/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return r.style.backgroundColor=l,r}}function P6e(t,e={},i){var n=this.sanitizeHTML(t.getValue())||0,r=t.getElement(),a=e.max?e.max:100,o=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(n)<=a?parseFloat(n):a,c=parseFloat(c)>=o?parseFloat(c):o,l=(a-o)/100,c=Math.round((c-o)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(n);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(c/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),u=e.color[v];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(n);break;case"boolean":d=n;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(n);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(c/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}r.style.minWidth="30px",r.style.position="relative",r.setAttribute("aria-label",c);var h=document.createElement("div");h.style.display="inline-block",h.style.width=c+"%",h.style.backgroundColor=u,h.style.height="100%",h.setAttribute("data-max",a),h.setAttribute("data-min",o);var f=document.createElement("div");if(f.style.position="relative",f.style.width="100%",f.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=s,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof Hbe)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",r.appendChild(g),r=g}r.appendChild(f),f.appendChild(h),d&&f.appendChild(m)}),""}function C6e(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function E6e(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function M6e(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function R6e(t,e,i){var n=document.createElement("span"),r=t.getRow(),a=t.getTable();return r.watchPosition(o=>{e.relativeToPage&&(o+=a.modules.page.getPageSize()*(a.modules.page.getPage()-1)),n.innerText=o}),n}function N6e(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function A6e(t,e,i){var n=document.createElement("div"),r=t.getRow()._row.modules.responsiveLayout;n.classList.add("tabulator-responsive-collapse-toggle"),n.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function a(o){var s=r.element;r.open=o,s&&(r.open?(n.classList.add("open"),s.style.display=""):(n.classList.remove("open"),s.style.display="none"))}return n.addEventListener("click",function(o){o.stopImmediatePropagation(),a(!r.open),t.getTable().rowManager.adjustTableSize()}),a(r.open),n}function _6e(t,e,i){var n=document.createElement("input"),r=!1;if(n.type="checkbox",n.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(n.addEventListener("click",o=>{o.stopPropagation()}),typeof t.getRow=="function"){var a=t.getRow();a instanceof cx?(n.addEventListener("change",o=>{this.table.options.selectableRowsRangeMode==="click"&&r?r=!1:a.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&n.addEventListener("click",o=>{r=!0,this.table.modules.selectRow.handleComplexRowClick(a._row,o)}),n.checked=a.isSelected&&a.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(a,n)):n=""}else n.addEventListener("change",o=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(n);return n}var k6e={plaintext:f6e,html:m6e,textarea:g6e,money:v6e,link:y6e,image:I6e,tickCross:b6e,datetime:w6e,datetimediff:S6e,lookup:T6e,star:U6e,traffic:D6e,progress:P6e,color:C6e,buttonTick:E6e,buttonCross:M6e,rownum:R6e,handle:N6e,responsiveCollapse:A6e,rowSelection:_6e};class zc extends Qi{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var n={params:e.definition["formatter"+i+"Params"]||{}},r=e.definition["formatter"+i];switch(typeof r){case"string":zc.formatters[r]?n.formatter=zc.formatters[r]:(console.warn("Formatter Error - No such formatter found: ",r),n.formatter=zc.formatters.plaintext);break;case"function":n.formatter=r;break;default:n.formatter=zc.formatters.plaintext;break}return n}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,n){var r,a,o,s;return e.definition.titleFormatter?(r=this.getFormatter(e.definition.titleFormatter),o=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return n},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},a=e.definition.titleFormatterParams||{},a=typeof a=="function"?a():a,r.call(this,s,a,o)):i}formatValue(e){var i=e.getComponent(),n=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function r(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,n,r)}formatExportValue(e,i){var n=e.column.modules.format[i],r;if(n){let a=function(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1};return r=typeof n.params=="function"?n.params(e.getComponent()):n.params,n.formatter.call(this,e.getComponent(),r,a)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(n){return i[n]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":zc.formatters[e]?e=zc.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=zc.formatters.plaintext);break;case"function":break;default:e=zc.formatters.plaintext;break}return e}}zc.moduleName="format";zc.formatters=k6e;class Ybe extends Qi{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],n=0,r=0;this.leftColumns.forEach((a,o)=>{if(a.modules.frozen.marginValue=n,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(n+=a.getWidth()),o==this.leftColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup){var s=this.getColGroupParentElement(a);i.includes(s)||(this.layoutElement(s,a),i.push(s)),s.classList.toggle("tabulator-frozen-left",a.modules.frozen.edge&&a.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",a.modules.frozen.edge&&a.modules.frozen.position==="right")}else this.layoutElement(a.getElement(),a);e&&a.cells.forEach(l=>{this.layoutElement(l.getElement(!0),a)})}),this.rightColumns.forEach((a,o)=>{a.modules.frozen.marginValue=r,a.modules.frozen.margin=a.modules.frozen.marginValue+"px",a.visible&&(r+=a.getWidth()),o==this.rightColumns.length-1?a.modules.frozen.edge=!0:a.modules.frozen.edge=!1,a.parent.isGroup?this.layoutElement(this.getColGroupParentElement(a),a):this.layoutElement(a.getElement(),a),e&&a.cells.forEach(s=>{this.layoutElement(s.getElement(!0),a)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));i.forEach(n=>{n.deinitialize()}),e.forEach(n=>{n.type==="row"&&this.layoutRow(n)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)}),this.rightColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)})}layoutElement(e,i){var n;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?n=i.modules.frozen.position==="left"?"right":"left":n=i.modules.frozen.position,e.style[n]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}_calcSpace(e,i){var n=0;for(let r=0;r<i;r++)e[r].visible&&(n+=e[r].getWidth());return n}}Ybe.moduleName="frozenColumns";class Zbe extends Qi{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,n=typeof i;n==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):n==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(n=>{i.push(n)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(n){var r=i.indexOf(n);r>-1&&i.splice(r,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var n=e.getElement();n.parentNode&&n.parentNode.removeChild(n),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,n)=>{this.table.rowManager.styleRow(i,n)})}}Zbe.moduleName="frozenRows";class O6e{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,n)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class mb{constructor(e,i,n,r,a,o,s){this.groupManager=e,this.parent=i,this.key=r,this.level=n,this.field=a,this.hasSubGroups=n<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=o,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[n]<"u"?e.startOpen[n]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var n=i+"_"+e,r=new mb(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[n]:!1);this.groups[n]=r,this.groupList.push(r)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var n=this.groupManager.groupIDLookups[i].func(e.getData()),r=i+"_"+n;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[r]&&this.groups[r].addRow(e):(this.groups[r]||this._createGroup(n,i),this.groups[r].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,n){var r=this.conformRowData({});e.updateData(r);var a=this.rows.indexOf(i);a>-1?n?this.rows.splice(a+1,0,e):this.rows.splice(a,0,e):n?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),n=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(n.parentNode&&n.parentNode.removeChild(n),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var n=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(r=>{n.push(r.getData(i||"data"))}),n}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(n=>{n.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var n=i.getHeadersAndRows();n.forEach(r=>{var a=r.getElement();e.parentNode.insertBefore(a,e.nextSibling),r.initialize(),e=a})}):this.rows.forEach(i=>{var n=i.getElement();e.parentNode.insertBefore(n,e.nextSibling),i.initialize(),e=n}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(n){var r=n.getRowGroup(e);r&&(i=r)}):this.rows.find(function(n){return n===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getRows(e,i){var n=[];return i&&this.groupList.length?this.groupList.forEach(r=>{n=n.concat(r.getRows(e,i))}):this.rows.forEach(function(r){n.push(e?r.getComponent():r)}),n}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(n){e.push(n.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Lr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new O6e(this)),this.component}}class Xbe extends Qi{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,n=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(n)&&e.length>n.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(a,o)=>{this.headerGenerator[0]=(s,l,c)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?a:o.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var r=this.table.columnManager.getRealColumns();r.forEach(a=>{a.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),a.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((a,o)=>{var s,l;typeof a=="function"?s=a:(l=this.table.columnManager.getColumnByField(a),l?s=function(c){return l.getFieldValue(c)}:s=function(c){return c[a]}),this.groupIDLookups.push({field:typeof a=="function"?!1:a,func:s,values:this.allowedValues?this.allowedValues[o]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(a=>{}),this.startOpen=i),n&&(this.headerGenerator=Array.isArray(n)?n:[n])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var n=this.getGroups(!1)[0];i.push(n.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(n=>n.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,n){if(this.table.options.groupBy){this.assignRowToGroup(e);var r=e.modules.group.rows;return r.length>1&&(!i||i&&r.indexOf(i)==-1?n?r[0]!==e&&(i=r[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):r[r.length-1]!==e&&(i=r[r.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,n){if(this.table.options.groupBy){!n&&i instanceof mb&&(i=this.table.rowManager.prevDisplayRow(e)||i);var r=i instanceof mb?i:i.modules.group,a=e instanceof mb?e:e.modules.group;r===a?this.table.rowManager.moveRowInArray(r.rows,e,i,n):(a&&a.removeRow(e),r.insertRow(e,i,n))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(n=>{n.groupList.length?i=i.concat(this.getChildGroups(n)):i.push(n)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(n=>{var r={};r.level=0,r.rowCount=0,r.headerContent="";var a=[];n.hasSubGroups?(a=this.pullGroupListData(n.groupList),r.level=n.level,r.rowCount=a.length-n.groupList.length,r.headerContent=n.generator(n.key,r.rowCount,n.rows,n),i.push(r),i=i.concat(a)):(r.level=n.level,r.headerContent=n.generator(n.key,n.rows.length,n.rows,n),r.rowCount=n.getRows().length,i.push(r),n.getRows().forEach(o=>{i.push(o.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(n=>{var r=n.getRowGroup(e);r&&(i=r)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(n=>{this.createGroup(n,0,i)}),e.forEach(n=>{this.assignRowToExistingGroup(n,i)})):e.forEach(n=>{this.assignRowToGroup(n,i)}),Object.values(i).forEach(n=>{n.wipe(!0)})}createGroup(e,i,n){var r=i+"_"+e,a;n=n||[],a=new mb(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],n[r]),this.groups[r]=a,this.groupList.push(a)}assignRowToExistingGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r="0_"+n;this.groups[r]&&this.groups[r].addRow(e)}assignRowToGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r=!this.groups["0_"+n];return r&&this.createGroup(n,0,i),this.groups["0_"+n].addRow(e),!r}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,n=i.getPath(),r=this.getExpectedPath(e),a;a=n.length==r.length&&n.every((o,s)=>o===r[s]),a||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],n=e.getData();return this.groupIDLookups.forEach(r=>{i.push(r.func(n))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(n=>{i=i.concat(n.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((n,r)=>{this.table.rowManager.styleRow(n,r),e.appendChild(n.getElement()),n.initialize(!0),n.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}Xbe.moduleName="groupRows";var x6e={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},L6e={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}};class by extends Qi{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,n){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:n})}rowAdded(e,i,n,r){this.action("rowAdd",e,{data:i,pos:n,index:r})}rowDeleted(e){var i,n;this.table.options.groupBy?(n=e.getComponent().getGroup()._getSelf().rows,i=n.indexOf(e),i&&(i=n[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,n){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:n}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(n){return n.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return by.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return by.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(n){if(n.component instanceof Es)n.component===e&&(n.component=i);else if(n.component instanceof lE&&n.component.row===e){var r=n.component.column.getField();r&&(n.component=i.getCell(r))}})}}by.moduleName="history";by.undoers=x6e;by.redoers=L6e;class Jbe extends Qi{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,n=e.getElementsByTagName("th"),r=e.getElementsByTagName("tbody")[0],a=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),r=r?r.getElementsByTagName("tr"):[],this._extractOptions(e,i),n.length?this._extractHeaders(n,r):this._generateBlankHeaders(n,r);for(var o=0;o<r.length;o++){var s=r[o],l=s.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=o);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}a.push(c)}i.data=a,this.dispatchExternal("htmlImported")}_extractOptions(e,i,n){var r=e.attributes,a=Object.keys(n||i),o={};a.forEach(u=>{o[u.toLowerCase()]=u});for(var s in r){var l=r[s],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof o[c]<"u"&&(i[o[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(n=>n.title===e);return i||!1}_extractHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a=!1,o=this._findCol(r.textContent),s;o?a=!0:o={title:r.textContent.trim()},o.field||(o.field=r.textContent.trim().toLowerCase().replaceAll(" ","_")),s=r.getAttribute("width"),s&&!o.width&&(o.width=s),this._extractOptions(r,o,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[n]=o.field,o.field==this.table.options.index&&(this.hasIndex=!0),a||this.table.options.columns.push(o)}}_generateBlankHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],a={title:"",field:"col"+n};this.fieldIndex[n]=a.field;var o=r.getAttribute("width");o&&(a.width=o),this.table.options.columns.push(a)}}}Jbe.moduleName="htmlTableImport";function F6e(t){var e=[],i=0,n=0,r=!1;for(let a=0;a<t.length;a++){let o=t[a],s=t[a+1];if(e[i]||(e[i]=[]),e[i][n]||(e[i][n]=""),o=='"'&&r&&s=='"'){e[i][n]+=o,a++;continue}if(o=='"'){r=!r;continue}if(o==","&&!r){n++;continue}if(o=="\r"&&s==`
`&&!r){n=0,i++,a++;continue}if((o=="\r"||o==`
`)&&!r){n=0,i++;continue}e[i][n]+=o}return e}function $6e(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function B6e(t){return t}var V6e={csv:F6e,json:$6e,array:B6e};class uE extends Qi{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,n,r,a){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(o=>(console.error("Import Error:",o||"Unable to import data"),Promise.reject(o)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=uE.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i){var n=this.lookupImporter(e);if(n)return this.pickFile(i).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(r=>(console.error("Import Error:",r||"Unable to import file"),Promise.reject(r)))}pickFile(e){return new Promise((i,n)=>{var r=document.createElement("input");r.type="file",r.accept=e,r.addEventListener("change",a=>{var o=r.files[0],s=new FileReader;switch(this.table.options.importReader){case"buffer":s.readAsArrayBuffer(o);break;case"binary":s.readAsBinaryString(o);break;case"url":s.readAsDataURL(o);break;case"text":default:s.readAsText(o)}s.onload=l=>{i(s.result)},s.onerror=l=>{console.warn("File Load Error - Unable to read file"),n()}}),r.click()})}importData(e,i){var n=e.call(this.table,i);return n instanceof Promise?n:n?Promise.resolve(n):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),n=e.map(r=>{var a={};return i.forEach((o,s)=>{a[o]=r[s]}),a});return n}structureArrayToColumns(e){var i=[],n=this.table.getColumns();return n[0]&&e[0][0]&&n[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(r=>{var a={};r.forEach((o,s)=>{var l=n[s];l&&(a[l.getField()]=o)}),i.push(a)}),i}setData(e){return this.table.setData(e)}}uE.moduleName="import";uE.importers=V6e;class Qbe extends Qi{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let n in i)i[n]=null})}cellContentsSelectionFixer(e,i){var n;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(n=document.body.createTextRange(),n.moveToElementText(i.getElement()),n.select()):window.getSelection&&(n=document.createRange(),n.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(n))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,n=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let r in this.eventMap)this.eventMap[r]===n&&this.subscribers[r]&&(i=!1);i&&(this.unsubscribe(n+"-touchstart",this.touchSubscribers[n+"-touchstart"]),this.unsubscribe(n+"-touchend",this.touchSubscribers[n+"-touchend"]),delete this.touchSubscribers[n+"-touchstart"],delete this.touchSubscribers[n+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let n in this.eventMap)i[n]&&(this.subscriptionChanged(n,!0),this.columnSubscribers[n]||(this.columnSubscribers[n]=[]),this.columnSubscribers[n].push(e))}handle(e,i,n){this.dispatchEvent(e,i,n)}handleTouch(e,i,n,r){var a=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":a.tap=!0,clearTimeout(a.tapHold),a.tapHold=setTimeout(()=>{clearTimeout(a.tapHold),a.tapHold=null,a.tap=null,clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"TapHold",n,r)},1e3);break;case"end":a.tap&&(a.tap=null,this.dispatchEvent(e+"Tap",n,r)),a.tapDbl?(clearTimeout(a.tapDbl),a.tapDbl=null,this.dispatchEvent(e+"DblTap",n,r)):a.tapDbl=setTimeout(()=>{clearTimeout(a.tapDbl),a.tapDbl=null},300),clearTimeout(a.tapHold),a.tapHold=null;break}}dispatchEvent(e,i,n){var r=n.getComponent(),a;this.columnSubscribers[e]&&(n instanceof lE?a=n.column.definition[e]:n instanceof sp&&(a=n.definition[e]),a&&a(i,r)),this.dispatchExternal(e,i,r)}}Qbe.moduleName="interaction";var j6e={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 67"],rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},G6e={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,n=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=n?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)},rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)},undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}};class Pm extends Qi{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,Pm.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)Pm.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(n=>{var r=Array.isArray(n)?n:[n];r.forEach(a=>{this.mapBinding(i,a)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var n={action:Pm.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},r=i.toString().toLowerCase().split(" ").join("").split("+");r.forEach(a=>{switch(a){case"ctrl":n.ctrl=!0;break;case"shift":n.shift=!0;break;case"meta":n.meta=!0;break;default:a=isNaN(a)?a.toUpperCase().charCodeAt(0):parseInt(a),n.keys.push(a),this.watchKeys[a]||(this.watchKeys[a]=[]),this.watchKeys[a].push(n)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];r&&(e.pressedKeys.push(n),r.forEach(function(a){e.checkBinding(i,a)}))},this.keydownBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];if(r){var a=e.pressedKeys.indexOf(n);a>-1&&e.pressedKeys.splice(a,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var n=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(r=>{var a=this.pressedKeys.indexOf(r);a==-1&&(n=!1)}),n&&i.action.call(this,e),!0):!1}}Pm.moduleName="keybindings";Pm.bindings=j6e;Pm.actions=G6e;class ewe extends Qi{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("menuContainer",void 0),this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadMenuEvent(n.column.definition[e],i,n)}loadMenuTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadMenuEvent(n.definition[e],i,n)}loadMenuEvent(e,i,n){n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent()):e,this.loadMenu(i,n,e)}loadMenu(e,i,n,r,a){var o=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),o||e.preventDefault(),!(!n||!n.length)){if(r)l=a.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}n.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",h=>{h.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",h=>{h.stopPropagation(),this.loadMenu(h,i,c.menu,u,l)}):c.action&&u.addEventListener("click",h=>{c.action(h,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),s.appendChild(u)}),s.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(r||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",n,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",n,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}ewe.moduleName="menu";class twe extends Qi{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,n={},r;!e.modules.frozen&&!e.isGroup&&(r=e.getElement(),n.mousemove=(function(a){e.parent===i.moving.parent&&((i.touchMove?a.touches[0].pageX:a.pageX)-Lr.elOffset(r).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r),i.moveColumn(e,!1)))}).bind(i),r.addEventListener("mousedown",function(a){i.touchMove=!1,a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=n}bindTouchEvents(e){var i=e.getElement(),n=!1,r,a,o,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextColumn(),o=r?r.getWidth()/2:0,a=e.prevColumn(),s=a?a.getWidth()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),n||(n=u.touches[0].pageX),d=u.touches[0].pageX-n,d>0?r&&d-l>o&&(p=r,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):a&&-d-c>s&&(p=a,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(r=p.nextColumn(),l=o,o=r?r.getWidth()/2:0,a=p.prevColumn(),c=s,s=a?a.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var n=i.getElement(),r=this.table.columnManager.getContentsElement(),a=this.table.columnManager.getHeadersElement();this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Lr.elOffset(n).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),r.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=r.clientHeight-a.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var n=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(r,a){var o=r.getElement(!0);o.parentNode&&n[a]&&o.parentNode.insertBefore(n[a].getElement(),o.nextSibling)}):e.getCells().forEach(function(r,a){var o=r.getElement(!0);o.parentNode&&n[a]&&o.parentNode.insertBefore(n[a].getElement(),o)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),n=i.scrollLeft,r=(this.touchMove?e.touches[0].pageX:e.pageX)-Lr.elOffset(i).left+n,a;this.hoverElement.style.left=r-this.startX+"px",r-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.max(0,n-5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1))),n+i.clientWidth-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{a=Math.min(i.clientWidth,n+5),this.table.rowManager.getElement().scrollLeft=a,this.autoScrollTimeout=!1},1)))}}twe.moduleName="moveColumn";class dx extends Qi{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,n={};n.mouseup=(function(r){i.tableRowDrop(r,e)}).bind(i),n.mousemove=(function(r){var a;r.pageY-Lr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a=e.getElement(),a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a=e.getElement(),a.previousSibling&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=n}initializeRow(e){var i=this,n={},r;n.mouseup=(function(a){i.tableRowDrop(a,e)}).bind(i),n.mousemove=(function(a){var o=e.getElement();a.pageY-Lr.elOffset(o).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1))}).bind(i),this.hasHandle||(r=e.getElement(),r.addEventListener("mousedown",function(a){a.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(a,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(a){a.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=n}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,n=e.getElement(!0);n.addEventListener("mousedown",function(r){r.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(r,e.row)},i.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,n)}}bindTouchEvents(e,i){var n=!1,r,a,o,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextRow(),o=r?r.getHeight()/2:0,a=e.prevRow(),s=a?a.getHeight()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),n||(n=u.touches[0].pageY),d=u.touches[0].pageY-n,d>0?r&&d-l>o&&(p=r,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):a&&-d-c>s&&(p=a,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(r=p.nextRow(),l=o,o=r?r.getHeight()/2:0,a=p.prevRow(),c=s,s=a?a.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var n=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n)),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var n=this.touchMove?e.touches[0].pageX:e.pageX,r=this.touchMove?e.touches[0].pageY:e.pageY,a,o;a=i.getElement(),this.connection?(o=a.getBoundingClientRect(),this.startX=o.left-n+window.pageXOffset,this.startY=o.top-r+window.pageYOffset):this.startY=r-a.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),n=i.scrollTop,r=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+n;this.hoverElement.style.top=Math.min(r-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,n){this.dispatchExternal("movableRowsElementDrop",e,i,n?n.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(n=>{typeof n=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(n))):this.connectionElements.push(n)}),this.connectionElements.forEach(n=>{var r=a=>{this.elementRowDrop(a,n,this.moving)};n.addEventListener("mouseup",r),n.tabulatorElementDropEvent=r,n.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(n=>{n.type==="row"&&n.modules.moveRow&&n.modules.moveRow.mouseup&&n.getElement().addEventListener("mouseup",n.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,n){var r=!1;if(n){switch(typeof this.table.options.movableRowsSender){case"string":r=this.senders[this.table.options.movableRowsSender];break;case"function":r=this.table.options.movableRowsSender;break}r?r.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var n=!1,r=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":n=this.receivers[this.table.options.movableRowsReceiver];break;case"function":n=this.table.options.movableRowsReceiver;break}n?r=n.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),r?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:r})}commsReceived(e,i,n){switch(i){case"connect":return this.connect(e,n.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,n.row,n.success)}}}dx.prototype.receivers={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};dx.prototype.senders={delete:function(t,e,i){t.delete()}};dx.moduleName="moveRow";var H6e={};class xw extends Qi{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,n){return this.transformRow(i,"data",n)}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var a="mutator"+(r.charAt(0).toUpperCase()+r.slice(1)),o;e.definition[a]&&(o=this.lookupMutator(e.definition[a]),o&&(i=!0,n[a]={mutator:o,params:e.definition[a+"Params"]||{}}))}),i&&(e.modules.mutate=n)}lookupMutator(e){var i=!1;switch(typeof e){case"string":xw.mutators[e]?i=xw.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,n){var r="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),a;return this.enabled&&this.table.columnManager.traverse(o=>{var s,l,c;o.modules.mutate&&(s=o.modules.mutate[r]||o.modules.mutate.mutator||!1,s&&(a=o.getFieldValue(typeof n<"u"?n:e),(i=="data"&&!n||typeof a<"u")&&(c=o.getComponent(),l=typeof s.params=="function"?s.params(a,e,i,c):s.params,o.setFieldValue(e,s.mutator(a,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var n=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,r={};if(n)return r=Object.assign(r,e.row.getData()),e.column.setFieldValue(r,i),n.mutator(i,r,"edit",n.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=e.row.getCell(n);r&&r.setValue(r.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}xw.moduleName="mutator";xw.mutators=H6e;function z6e(t,e,i,n,r){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),n?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,n)+" ",c.innerHTML=" "+n+" ",a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(c),a.appendChild(u)):(s.innerHTML=" 0 ",a.appendChild(o),a.appendChild(s),a.appendChild(u)),a}function W6e(t,e,i,n,r){var a=document.createElement("span"),o=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{o.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+r+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),a.appendChild(o),a.appendChild(s),a.appendChild(l),a.appendChild(c),a.appendChild(u),a}var q6e={rows:z6e,pages:W6e};class dE extends Qi{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var n=this.table.rowManager,r=n.getDisplayRows(),a;return i?r.length?a=r[0]:n.activeRows.length&&(a=n.activeRows[n.activeRows.length-1],i=!1):r.length&&(a=r[r.length-1],i=!(r.length<this.size)),{index:a,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,n,r){return this.initialLoad||(this.progressiveLoad&&!n||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),r.page=this.page,this.size&&(r.size=this.size),r}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var n,r,a;!i&&!this.table.dataLoader.loading&&(n=this.table.rowManager.getElement(),r=n.scrollHeight-n.clientHeight-e,a=this.table.options.progressiveLoadScrollMargin||n.clientHeight*2,r<a&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var n=document.createElement("option");n.value=i,i===!0?this.langBind("pagination|all",function(r){n.innerHTML=r}):n.innerHTML=i,this.pageSizeSelect.appendChild(n)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=dE.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,n;e||(this.langBind("pagination|first",r=>{this.firstBut.innerHTML=r}),this.langBind("pagination|first_title",r=>{this.firstBut.setAttribute("aria-label",r),this.firstBut.setAttribute("title",r)}),this.langBind("pagination|prev",r=>{this.prevBut.innerHTML=r}),this.langBind("pagination|prev_title",r=>{this.prevBut.setAttribute("aria-label",r),this.prevBut.setAttribute("title",r)}),this.langBind("pagination|next",r=>{this.nextBut.innerHTML=r}),this.langBind("pagination|next_title",r=>{this.nextBut.setAttribute("aria-label",r),this.nextBut.setAttribute("title",r)}),this.langBind("pagination|last",r=>{this.lastBut.innerHTML=r}),this.langBind("pagination|last_title",r=>{this.lastBut.setAttribute("aria-label",r),this.lastBut.setAttribute("title",r)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",r=>{this.pageSizeSelect.setAttribute("aria-label",r),this.pageSizeSelect.setAttribute("title",r),i.innerHTML=r}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",r=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(n=document.querySelector(this.table.options.paginationCounterElement),n?n.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),n=i.indexOf(e);if(n>-1){var r=this.size===!0?1:Math.ceil((n+1)/this.size);return this.setPage(r)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,n){var r;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,n=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),r=this.pageCounter.call(this,i,n,this.page,e,this.max),typeof r){case"object":if(r instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(r)}else this.pageCounterElement.innerHTML="",r!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",r);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=r}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),n=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),r=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let a=n;a<=r;a++)a>0&&a<=this.max&&this.pagesElement.appendChild(this._generatePageButton(a));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",n=>{i.setAttribute("aria-label",n+" "+e),i.setAttribute("title",n+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",n=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,n,r,a,o,s=e.filter(l=>l.type==="row");if(this.mode=="local"){n=[],this.setMaxRows(e.length),this.size===!0?(r=0,a=e.length):(r=this.size*(this.page-1),a=r+parseInt(this.size)),this._setPageButtons();for(let l=r;l<a;l++){let c=e[l];c&&(n.push(c),c.type==="row"&&(o||(o=c),i++))}return this._setPageCounter(s.length,i,o?s.indexOf(o)+1:0),n}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}dE.moduleName="page";dE.pageCounters=q6e;var K6e={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,n=t+"-"+e,r=i.indexOf(n+"="),a,o;return r>-1&&(i=i.slice(r),a=i.indexOf(";"),a>-1&&(i=i.slice(0,a)),o=i.replace(n+"=","")),o?JSON.parse(o):!1}},Y6e={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var n=new Date;n.setDate(n.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+n.toUTCString()}};class dl extends Qi{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,n;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:dl.readers[this.table.options.persistenceReaderFunc]?this.readFunc=dl.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):dl.readers[this.mode]?this.readFunc=dl.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:dl.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=dl.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):dl.writers[this.mode]?this.writeFunc=dl.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(n=this.retrieveData("page"),n&&(typeof n.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=n.paginationSize),typeof n.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=n.paginationInitialPage))),this.config.group&&(n=this.retrieveData("group"),n&&(typeof n.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=n.groupBy),typeof n.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=n.groupStartOpen),typeof n.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=n.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,n;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(n=this.load("headerFilter"),n&&(this.table.options.initialHeaderFilter=n))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,n;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),n=this.config.columns===!0?Object.keys(i):this.config.columns,n.forEach(r=>{var a=Object.getOwnPropertyDescriptor(i,r),o=i[r];a&&Object.defineProperty(i,r,{set:s=>{o=s,this.defWatcherBlock||this.save("columns"),a.set&&a.set(s)},get:()=>(a.get&&a.get(),o)})}),this.defWatcherBlock=!1)}load(e,i){var n=this.retrieveData(e);return i&&(n=n?this.mergeDefinition(i,n):i),n}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,n){var r=[];return i=i||[],i.forEach((a,o)=>{var s=this._findColumn(e,a),l;s&&(n?l=Object.keys(a):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof a[c]<"u"&&(s[c]=a[c])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,a.columns)),r.push(s))}),e.forEach((a,o)=>{var s=this._findColumn(i,a);s||(r.length>o?r.splice(o,0,a):r.push(a))}),r}_findColumn(e,i){var n=i.columns?"group":i.field?"field":"object";return e.find(function(r){switch(n){case"group":return r.title===i.title&&r.columns.length===i.columns.length;case"field":return r.field===i.field;case"object":return r===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],n=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(r=>{var a={},o=r.getDefinition(),s;r.isGroup?(a.title=o.title,a.columns=this.parseColumns(r.getColumns())):(a.field=r.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(o),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":a.width=r.getWidth();break;case"visible":a.visible=r.visible;break;default:typeof o[l]!="function"&&n.indexOf(l)===-1&&(a[l]=o[l])}})),i.push(a)}),i}}dl.moduleName="persistence";dl.moduleInitOrder=-10;dl.readers=K6e;dl.writers=Y6e;let iwe=class extends Qi{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,n){this.loadPopupEvent(i,null,e,n)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadPopupEvent(n.column.definition[e],i,n)}loadPopupTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadPopupEvent(n.definition[e],i,n)}loadPopupEvent(e,i,n,r){var a;function o(s){a=s}n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent(),o):e,this.loadPopup(i,n,e,a,r)}loadPopup(e,i,n,r,a){var o=!(e instanceof MouseEvent),s,l;n instanceof HTMLElement?s=n:(s=document.createElement("div"),s.innerHTML=n),s.classList.add("tabulator-popup"),s.addEventListener("click",c=>{c.stopPropagation()}),o||e.preventDefault(),l=this.popup(s),typeof r=="function"&&l.renderCallback(r),e?l.show(e):l.show(i.getElement(),a||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}};iwe.moduleName="popup";class nwe extends Qi{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,n){var r=window.scrollX,a=window.scrollY,o=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof n<"u"?n:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(o.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?o.innerHTML=c:o.appendChild(c),this.element.appendChild(o)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(r,a),this.manualBlock=!1}}nwe.moduleName="print";class rwe extends Qi{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,n;this.currentVersion++,n=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-push"),r.forEach(o=>{i.table.rowManager.addRowActual(o,!1)}),a=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),a}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a;return!i.blocked&&n===i.currentVersion&&(i.block("data-unshift"),r.forEach(o=>{i.table.rowManager.addRowActual(o,!0)}),a=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),a}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-shift"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[0]),r&&r.deleteActual()),a=i.origFuncs.shift.call(e),i.unblock("data-shift")),a}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var r,a;return!i.blocked&&n===i.currentVersion&&(i.block("data-pop"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),r&&r.deleteActual()),a=i.origFuncs.pop.call(e),i.unblock("data-pop")),a}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),a=r[0]<0?e.length+r[0]:r[0],o=r[1],s=r[2]?r.slice(2):!1,l,c;if(!i.blocked&&n===i.currentVersion){if(i.block("data-splice"),s&&(l=e[a]?i.table.rowManager.getRowFromDataObject(e[a]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),o!==0){var u=e.slice(a,typeof r[1]>"u"?r[1]:a+o);u.forEach((d,p)=>{var h=i.table.rowManager.getRowFromDataObject(d);h&&h.deleteActual(p!==u.length-1)})}(s||o!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var n in i)this.watchKey(e,i,n);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,n=e.getData()[this.table.options.dataTreeChildField],r={};n&&(r.push=n.push,Object.defineProperty(n,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var a=r.push.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-push")}return a}}),r.unshift=n.unshift,Object.defineProperty(n,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var a=r.unshift.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return a}}),r.shift=n.shift,Object.defineProperty(n,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var a=r.shift.call(n);this.rebuildTree(e),i.unblock("tree-shift")}return a}}),r.pop=n.pop,Object.defineProperty(n,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var a=r.pop.call(n);this.rebuildTree(e),i.unblock("tree-pop")}return a}}),r.splice=n.splice,Object.defineProperty(n,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var a=r.splice.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return a}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,n){var r=this,a=Object.getOwnPropertyDescriptor(i,n),o=i[n],s=this.currentVersion;Object.defineProperty(i,n,{set:l=>{if(o=l,!r.blocked&&s===r.currentVersion){r.block("key");var c={};c[n]=l,e.updateData(c),r.unblock("key")}a.set&&a.set(l)},get:()=>(a.get&&a.get(),o)})}unwatchRow(e){var i=e.getData();for(var n in i)Object.defineProperty(i,n,{value:i[n]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}rwe.moduleName="reactiveData";class awe extends Qi{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(n=>{n.modules.resize&&n.modules.resize.handleEl&&(i&&(n.modules.resize.handleEl.style[e.modules.frozen.position]=i,n.modules.resize.handleEl.style["z-index"]=11),n.element.after(n.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,n,r){var a=this,o=!1,s=n.definition.resizable,l={},c=n.getLastColumn();if(e==="header"&&(o=n.definition.formatter=="textarea"||n.definition.variableHeight,l={variableHeight:o}),(s===!0||s==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){a.startColumn=n,a.initialNextColumn=a.nextColumn=c.nextColumn(),a._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var h=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),h!==c.getWidth()&&(a.dispatch("column-resized",c),a.table.externalEvents.dispatch("columnResized",c.getComponent()))}),n.modules.frozen&&(u.style.position="sticky",u.style[n.modules.frozen.position]=this.frozenColumnOffset(n)),l.handleEl=u,r.parentNode&&n.visible&&r.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,n){var r=this;r.table.element.classList.add("tabulator-block-select");function a(s){var l=typeof s.screenX>"u"?s.touches[0].screenX:s.screenX,c=l-r.startX,u=l-r.latestX,d,p;if(r.latestX=l,r.table.rtl&&(c=-c,u=-u),d=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(r.startWidth+c),p=i.width==i.minWidth||i.width==i.maxWidth,u<0&&(r.nextColumn=r.initialNextColumn),r.table.options.resizableColumnFit&&r.nextColumn&&!(d&&p)){let h=r.nextColumn.getWidth();u>0&&h<=r.nextColumn.minWidth&&(r.nextColumn=r.nextColumn.nextColumn()),r.nextColumn&&r.nextColumn.setWidth(r.nextColumn.getWidth()-u)}r.table.columnManager.rerenderColumns(!0),!r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}function o(s){r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!1),r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",a),n.removeEventListener("touchmove",a),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.startWidth!==i.getWidth()&&(r.table.columnManager.verticalAlignHeaders(),r.dispatch("column-resized",i),r.table.externalEvents.dispatch("columnResized",i.getComponent()))}e.stopPropagation(),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!0),r.startX=typeof e.screenX>"u"?e.touches[0].screenX:e.screenX,r.latestX=r.startX,r.startWidth=i.getWidth(),document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",a,{passive:!0}),n.addEventListener("touchend",o)}}awe.moduleName="resizeColumns";class owe extends Qi{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,n=e.getElement(),r=document.createElement("div");r.className="tabulator-row-resize-handle";var a=document.createElement("div");a.className="tabulator-row-resize-handle prev",r.addEventListener("click",function(l){l.stopPropagation()});var o=function(l){i.startRow=e,i._mouseDown(l,e,r)};r.addEventListener("mousedown",o),r.addEventListener("touchstart",o,{passive:!0}),a.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,a))};a.addEventListener("mousedown",s),a.addEventListener("touchstart",s,{passive:!0}),n.appendChild(r),n.appendChild(a)}_mouseDown(e,i,n){var r=this;r.table.element.classList.add("tabulator-block-select");function a(s){i.setHeight(r.startHeight+((typeof s.screenY>"u"?s.touches[0].screenY:s.screenY)-r.startY))}function o(s){document.body.removeEventListener("mouseup",a),document.body.removeEventListener("mousemove",a),n.removeEventListener("touchmove",a),n.removeEventListener("touchend",o),r.table.element.classList.remove("tabulator-block-select"),r.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),r.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,r.startHeight=i.getHeight(),document.body.addEventListener("mousemove",a),document.body.addEventListener("mouseup",o),n.addEventListener("touchmove",a,{passive:!0}),n.addEventListener("touchend",o)}}owe.moduleName="resizeRows";class swe extends Qi{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.tableHeight!=r||this.tableWidth!=a)&&(this.tableHeight=r,this.tableWidth=a,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),a=Math.floor(n[0].contentRect.width);(this.containerHeight!=r||this.containerWidth!=a)&&(this.containerHeight=r,this.containerWidth=a,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}swe.moduleName="resizeTable";class lwe extends Qi{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((i,n)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=n,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,n)=>{var r=n.modules.responsive.order-i.modules.responsive.order;return r||n.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),n=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(n<0){let r=this.columns[this.index];r?(this.hideColumn(r),this.index++):e=!1}else{let r=this.columns[this.index-1];r&&n>0&&n>=r.getWidth()?(this.showColumn(r),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,n;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);n=this.collapseFormatter(this.generateCollapsedRowData(e)),n&&i.appendChild(n)}}generateCollapsedRowData(e){var i=e.getData(),n=[],r;return this.hiddenColumns.forEach(a=>{var o=a.getFieldValue(i);if(a.definition.title&&a.field)if(a.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};r={value:!1,data:{},getValue:function(){return o},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return a.getComponent()},getTable:()=>this.table},n.push({field:a.field,title:a.definition.title,value:a.modules.format.formatter.call(this.table.modules.format,r,a.modules.format.params,s)})}else n.push({field:a.field,title:a.definition.title,value:o})}),n}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(function(n){var r=document.createElement("tr"),a=document.createElement("td"),o=document.createElement("td"),s,l=document.createElement("strong");a.appendChild(l),this.langBind("columns|"+n.field,function(c){l.innerHTML=c||n.title}),n.value instanceof Node?(s=document.createElement("div"),s.appendChild(n.value),o.appendChild(s)):o.innerHTML=n.value,r.appendChild(a),r.appendChild(o),i.appendChild(r)},this),Object.keys(e).length?i:""}}lwe.moduleName="responsiveLayout";class cwe extends Qi{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,n){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){this.deprecationCheck("selectable","selectableRows",!0),this.deprecationCheck("selectableRollingSelection","selectableRowsRollingSelection",!0),this.deprecationCheck("selectableRangeMode","selectableRowsRangeMode",!0),this.deprecationCheck("selectablePersistence","selectableRowsPersistence",!0),this.deprecationCheck("selectableCheck","selectableRowsCheck",!0)}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,n=i.checkRowSelectability(e),r=e.getElement(),a=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",a)};e.modules.select={selected:!1},r.classList.toggle("tabulator-selectable",n),r.classList.toggle("tabulator-unselectable",!n),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?r.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(r.addEventListener("click",function(o){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),r.addEventListener("mousedown",function(o){if(o.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",a),document.body.addEventListener("keyup",a),i.toggleRow(e),!1}),r.addEventListener("mouseenter",function(o){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),r.addEventListener("mouseout",function(o){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var n=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),r=this.table.rowManager.getDisplayRowIndex(e),a=n<=r?n:r,o=n>=r?n:r,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(a,o-a+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],n,r;switch(typeof e){case"undefined":n=this.table.rowManager.rows;break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(a=>{r=this._selectRow(a,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(!1,i)):n&&this._selectRow(n,!1,!0)}_selectRow(e,i,n){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!n&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var r=this.table.rowManager.findRow(e);if(r){if(this.selectedRows.indexOf(r)==-1)return r.getElement().classList.add("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!0,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!0),this.selectedRows.push(r),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!0),this.dispatchExternal("rowSelected",r.getComponent()),this._rowSelectionChanged(i,r),r}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var n=[],r,a;switch(typeof e){case"undefined":r=Object.assign([],this.selectedRows);break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(o=>{a=this._deselectRow(o,!0,!0),a&&n.push(a)}),this._rowSelectionChanged(i,[],n)):r&&this._deselectRow(r,i,!0)}_deselectRow(e,i){var n=this,r=n.table.rowManager.findRow(e),a,o;if(r){if(a=n.selectedRows.findIndex(function(s){return s==r}),a>-1)return o=r.getElement(),o&&o.classList.remove("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!1,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!1),n.selectedRows.splice(a,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!1),this.dispatchExternal("rowDeselected",r.getComponent()),n._rowSelectionChanged(i,void 0,r),r}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],n=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(r=>r.getComponent()),Array.isArray(n)||(n=[n]),n=n.map(r=>r.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,n))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var n=this.table.modules.dataTree.getChildren(e,!0);if(i)for(let r of n)this._selectRow(r,!0);else for(let r of n)this._deselectRow(r,!0)}}cwe.moduleName="selectRow";function Z6e(t,e,i,n,r,a,o){var s=o.alignEmptyValues,l=o.decimalSeparator,c=o.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(u*=-1),u}function X6e(t,e,i,n,r,a,o){var s=o.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof o.locale){case"boolean":o.locale&&(c=this.langLocale());break;case"string":c=o.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(s==="top"&&a==="desc"||s==="bottom"&&a==="asc")&&(l*=-1),l}function c6(t,e,i,n,r,a,o){var s=window.DateTime||luxon.DateTime,l=o.format||"dd/MM/yyyy HH:mm:ss",c=o.alignEmptyValues,u=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&a==="desc"||c==="bottom"&&a==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function J6e(t,e,i,n,r,a,o){return o.format||(o.format="dd/MM/yyyy"),c6.call(this,t,e,i,n,r,a,o)}function Q6e(t,e,i,n,r,a,o){return o.format||(o.format="HH:mm"),c6.call(this,t,e,i,n,r,a,o)}function e7e(t,e,i,n,r,a,o){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function t7e(t,e,i,n,r,a,o){var s=o.type||"length",l=o.alignEmptyValues,c=0;function u(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(h,f){return h+f});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(h,f){return h+f})/d.length;break}return p}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return u(e)-u(t);return(l==="top"&&a==="desc"||l==="bottom"&&a==="asc")&&(c*=-1),c}function i7e(t,e,i,n,r,a,o){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function n7e(t,e,i,n,r,a,o){var s,l,c,u,d=0,p,h=/(\d+)|(\D+)/g,f=/\d/,m=o.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(f.test(s)&&f.test(l)))return s>l?1:-1;for(s=s.match(h),l=l.match(h),p=s.length>l.length?l.length:s.length;d<p;)if(c=s[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return s.length>l.length}return(m==="top"&&a==="desc"||m==="bottom"&&a==="asc")&&(g*=-1),g}var r7e={number:Z6e,string:X6e,date:J6e,time:Q6e,datetime:c6,boolean:e7e,array:t7e,exists:i7e,alphanum:n7e};class Bv extends Qi{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,n,r){var a=this.getSort();return a.forEach(o=>{delete o.column}),r.sort=a,r}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,n,r;switch(typeof e.definition.sorter){case"string":Bv.sorters[e.definition.sorter]?i=Bv.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(n=e.getElement(),n.classList.add("tabulator-sortable"),r=document.createElement("div"),r.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":r.classList.add("tabulator-col-sorter-element");break;case"header":n.classList.add("tabulator-col-sorter-element");break;default:n.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":r.appendChild(this.table.options.headerSortElement);break;default:r.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(r),e.modules.sort.element=r,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&r.addEventListener("mousedown",a=>{a.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?r:n).addEventListener("click",a=>{var o="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?o=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?o=e.modules.sort.dir=="asc"?"desc":"asc":o="none";else switch(e.modules.sort.dir){case"asc":o="desc";break;case"desc":o="asc";break;default:o=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(a.shiftKey||a.ctrlKey)?(s=this.getSort(),l=s.findIndex(c=>c.field===e.getField()),l>-1?(s[l].dir=o,l=s.splice(l,1)[0],o!="none"&&s.push(l)):o!="none"&&s.push({column:e,dir:o}),this.setSort(s)):o=="none"?this.clear():this.setSort(e,o),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(n){n.column&&i.push({column:n.column.getComponent(),field:n.column.getField(),dir:n.dir})}),i}setSort(e,i){var n=this,r=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(a){var o;o=n.table.columnManager.findColumn(a.column),o?(a.column=o,r.push(a),n.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",a.column)}),n.sortList=r,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],n="string",r,a;if(i&&(i=i.getData(),r=e.getField(),r))switch(a=e.getFieldValue(i),typeof a){case"undefined":n="string";break;case"boolean":n="boolean";break;default:!isNaN(a)&&a!==""?n="number":a.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(n="alphanum");break}return Bv.sorters[n]}sort(e){var i=this,n=this.table.options.sortOrderReverse?i.sortList.slice().reverse():i.sortList,r=[],a=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",i.getSort()),i.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(o,s){var l;o.column&&(l=o.column.modules.sort,l&&(l.sorter||(l.sorter=i.findSorter(o.column)),o.params=typeof l.params=="function"?l.params(o.column.getComponent(),o.dir):l.params,r.push(o)),i.setColumnHeader(o.column,o.dir))}),r.length&&i._sortItems(e,r)):n.forEach(function(o,s){i.setColumnHeader(o.column,o.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(o=>{a.push(o.getComponent())}),this.dispatchExternal("dataSorted",i.getSort(),a)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var n=e.modules.sort.element,r;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;n.firstChild;)n.removeChild(n.firstChild);r=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof r=="object"?n.appendChild(r):n.innerHTML=r}}_sortItems(e,i){var n=i.length-1;e.sort((r,a)=>{for(var o,s=n;s>=0;s--){let l=i[s];if(o=this._sortRow(r,a,l.column,l.dir,l.params),o!==0)break}return o})}_sortRow(e,i,n,r,a){var o,s,l=r=="asc"?e:i,c=r=="asc"?i:e;return e=n.getFieldValue(l.getData()),i=n.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",o=l.getComponent(),s=c.getComponent(),n.modules.sort.sorter.call(this,e,i,o,s,n.getComponent(),r,a)}}Bv.moduleName="sort";Bv.sorters=r7e;class a7e{constructor(e){return this._range=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._range.table.componentFunctionBinder.handle("range",i._range,n)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class o7e extends il{constructor(e,i,n,r){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(n,r)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,n){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(n)}setStartBound(e){var i,n;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,n=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,n))}setEndBound(e){var i=this._getTableRows().length,n,r,a;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(n=e.row.position-1,r=e.column.getPosition()-1,a=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(n,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&a?this.setEnd(n,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,r):this.setEnd(n,r))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows()}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,n=this.table.columnManager.renderer.leftCol,r=this.table.columnManager.renderer.rightCol,a,o,s,l,c,u;e==null&&(e=0),i==null&&(i=1/0),n==null&&(n=0),r==null&&(r=1/0),this.overlaps(n,e,r,i)&&(a=Math.max(this.top,e),o=Math.min(this.bottom,i),s=Math.max(this.left,n),l=Math.min(this.right,r),c=this.rangeManager.getCell(a,s),u=this.rangeManager.getCell(o,l),this.element.classList.add("tabulator-range-active"),this.element.style.left=c.row.getElement().offsetLeft+c.getElement().offsetLeft+"px",this.element.style.top=c.row.getElement().offsetTop+"px",this.element.style.width=u.getElement().offsetLeft+u.getElement().offsetWidth-c.getElement().offsetLeft+"px",this.element.style.height=u.row.getElement().offsetTop+u.row.getElement().offsetHeight-c.row.getElement().offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,n,r){return!(this.left>n||e>this.right||this.top>r||i>this.bottom)}getData(){var e=[],i=this.getRows(),n=this.getColumns();return i.forEach(r=>{var a=r.getData(),o={};n.forEach(s=>{o[s.field]=a[s.field]}),e.push(o)}),e}getCells(e,i){var n=[],r=this.getRows(),a=this.getColumns();return e?n=r.map(o=>{var s=[];return o.getCells().forEach(l=>{a.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):r.forEach(o=>{o.getCells().forEach(s=>{a.includes(s.column)&&n.push(i?s.getComponent():s)})}),n}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(n=>{n.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),n={start:null,end:null};return i.length?(n.start=i[0],n.end=i[i.length-1]):console.warn("No bounds defined on range"),n}getComponent(){return this.component||(this.component=new a7e(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}class uwe extends Qi{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior")))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(n=>n.occupiesRow(e.row)):i=this.ranges.filter(n=>n.occupies(e)),i.map(n=>n.getComponent())}rowGetRanges(e){var i=this.ranges.filter(n=>n.occupiesRow(e));return i.map(n=>n.getComponent())}colGetRanges(e){var i=this.ranges.filter(n=>n.occupiesColumn(e));return i.map(n=>n.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(n=>n.occupiesColumn(e)),i&&this.ranges.forEach(n=>{var r=n.getColumns(!0);r.forEach(a=>{a!==e&&a.setWidth(e.width)})}))}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),n=this.ranges.findIndex(r=>r.occupies(e));i.classList.toggle("tabulator-range-selected",n!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=n}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e)&&i.preventDefault()}keyNavigateRange(e,i,n,r){this.navigate(n,r,i)&&e.preventDefault()}navigate(e,i,n){var r=!1,a,o,s,l,c,u;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),a=this.activeRange,o=i?a.end:a.start,s=o.row,l=o.col,e)switch(n){case"left":l=this.findJumpCellLeft(a.start.row,o.col);break;case"right":l=this.findJumpCellRight(a.start.row,o.col);break;case"up":s=this.findJumpCellUp(o.row,a.start.col);break;case"down":s=this.findJumpCellDown(o.row,a.start.col);break}else{if(i&&(this.selecting==="row"&&(n==="left"||n==="right")||this.selecting==="column"&&(n==="up"||n==="down")))return;switch(n){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(r=l!==o.col||s!==o.row,i||a.setStart(s,l),a.setEnd(s,l),i||(this.selecting="cell"),r)return c=this.getRowByRangePos(a.end.row),u=this.getColumnByRangePos(a.end.col),(n==="left"||n==="right")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):(n==="up"||n==="down")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):this.autoScroll(a,c.getElement(),u.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpCell(e,i,n,r){var a;i&&(e=e.reverse());for(let o of e){let s=o.getValue();if(n){if(a=o,s)break}else if(r){if(a=o,s)break}else if(s)a=o;else break}return a}findJumpCellLeft(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(u=>u.column.visible),a=!r[i].getValue(),o=r[i]?!r[i].getValue():!1,s=i,l=this.rowHeader?r.slice(1,i):r.slice(0,i),c=this.findJumpCell(l,!0,a,o);return c&&(s=c.column.getPosition()-1),s}findJumpCellRight(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(c=>c.column.visible),a=!r[i].getValue(),o=r[i+1]?!r[i+1].getValue():!1,s=i,l=this.findJumpCell(r.slice(i+1,r.length),!1,a,o);return l&&(s=l.column.getPosition()-1),s}findJumpCellUp(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),a=!r[e].getValue(),o=r[e-1]?!r[e-1].getValue():!1,s=e,l=this.findJumpCell(r.slice(0,s),!0,a,o);return l&&(s=l.row.position-1),s}findJumpCellDown(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),a=!r[e].getValue(),o=r[e+1]?!r[e+1].getValue():!1,s=e,l=this.findJumpCell(r.slice(s+1,r.length),!1,a,o);return l&&(s=l.row.position-1),s}newSelection(e,i){var n;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){n=this.resetRanges(),this.selecting="all";var r,a=this.getCell(-1,-1);this.rowHeader?r=this.getCell(0,1):r=this.getCell(0,0),n.setBounds(r,a);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,n){var r=this.table.rowManager.element,a,o,s,l,c;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof n>"u"&&(n=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(a=this.rowHeader.getElement()),o={left:n.offsetLeft,right:n.offsetLeft+n.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:r.scrollLeft,right:Math.ceil(r.scrollLeft+r.clientWidth),top:r.scrollTop,bottom:r.scrollTop+r.offsetHeight-this.table.rowManager.scrollbarWidth},a&&(s.left+=a.offsetWidth),l=s.left<o.left&&o.left<s.right&&s.left<o.right&&o.right<s.right,c=s.top<o.top&&o.top<s.bottom&&s.top<o.bottom&&o.bottom<s.bottom,l||(o.left<s.left?(r.scrollLeft=o.left,a&&(r.scrollLeft-=a.offsetWidth)):o.right>s.right&&(r.scrollLeft=o.right-r.clientWidth)),c||(o.top<s.top?r.scrollTop=o.top:o.bottom>s.bottom&&(r.scrollTop=o.bottom-r.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(n=>{n.type==="row"&&(this.layoutRow(n),n.cells.forEach(r=>this.renderCell(r)))}),this.getTableColumns().forEach(n=>{this.layoutColumn(n)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesRow(e));this.selecting==="row"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutColumn(e){var i=e.getElement(),n=!1,r=this.ranges.some(a=>a.occupiesColumn(e));this.selecting==="column"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutRanges(){var e;this.table.initialized&&(e=this.getActiveCell(),e&&(this.activeRangeCellElement.style.left=e.row.getElement().offsetLeft+e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.top=e.row.getElement().offsetTop+"px",this.activeRangeCellElement.style.width=e.getElement().offsetLeft+e.getElement().offsetWidth-e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.height=e.row.getElement().offsetTop+e.row.getElement().offsetHeight-e.row.getElement().offsetTop+"px",this.ranges.forEach(i=>i.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var n;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),n=this.table.rowManager.getRowFromPosition(e+1),n?n.getCells(!1,!0).filter(r=>r.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows()}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var n;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),n=new o7e(this.table,this,e,i),this.activeRange=n,this.ranges.push(n),this.rangeContainer.appendChild(n.element),n}resetRanges(){var e,i;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(i=this.table.rowManager.activeRows[0].cells[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}}uwe.moduleName="selectRange";class dwe extends Qi{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipGenerationMode",void 0),this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,n){var r=e==="tooltip"?n.column.definition.tooltip:n.definition.headerTooltip;r&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,n,r),this.table.options.tooltipDelay))}mouseoutCheck(e,i,n){this.popupInstance||this.clearPopup()}clearPopup(e,i,n){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,n){var r,a,o;function s(l){a=l}typeof n=="function"&&(n=n(e,i.getComponent(),s)),n instanceof HTMLElement?r=n:(r=document.createElement("div"),n===!0&&(i instanceof lE?n=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{r.innerHTML=n=l||i.definition.title}):n=i.definition.title),r.innerHTML=n),(n||n===0||n===!1)&&(r.classList.add("tabulator-tooltip"),r.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(r),typeof a=="function"&&this.popupInstance.renderCallback(a),o=this.popupInstance.containerEventCoords(e),this.popupInstance.show(o.x+15,o.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}dwe.moduleName="tooltip";var s7e={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(/^[a-z0-9]+$/i);return n.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(i);return n.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=!0,r=t.getData(),a=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(o){var s=o.getData();s!==r&&e==a.getFieldValue(s)&&(n=!1)}),n},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class pE extends Qi{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,n){var r=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return r!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,r)}),r}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(n=>{n=n.getComponent();var r=n.validate();r!==!0&&(i=i.concat(r))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,n=[],r;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(a=>{r=i._extractValidator(a),r&&n.push(r)}):(r=this._extractValidator(e.definition.validator),r&&n.push(r)),e.modules.validate=n.length?n:!1)}_extractValidator(e){var i,n,r;switch(typeof e){case"string":return r=e.indexOf(":"),r>-1?(i=e.substring(0,r),n=e.substring(r+1)):i=e,this._buildValidator(i,n);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var n=typeof e=="function"?e:pE.validators[e];return n?{type:typeof e=="function"?"function":e,func:n,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,n){var r=this,a=[],o=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(r,i.getComponent(),n,s.params)||a.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),a.length?(i.modules.validate.invalid=a,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),o==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),o>-1&&this.invalidCells.splice(o,1)),a.length?a:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}pE.moduleName="validate";pE.validators=s7e;var l7e=Object.freeze({__proto__:null,AccessorModule:kw,AjaxModule:Hu,ClipboardModule:Iy,ColumnCalcsModule:Im,DataTreeModule:qbe,DownloadModule:Ow,EditModule:cE,ExportModule:Kbe,FilterModule:Ah,FormatModule:zc,FrozenColumnsModule:Ybe,FrozenRowsModule:Zbe,GroupRowsModule:Xbe,HistoryModule:by,HtmlTableImportModule:Jbe,ImportModule:uE,InteractionModule:Qbe,KeybindingsModule:Pm,MenuModule:ewe,MoveColumnsModule:twe,MoveRowsModule:dx,MutatorModule:xw,PageModule:dE,PersistenceModule:dl,PopupModule:iwe,PrintModule:nwe,ReactiveDataModule:rwe,ResizeColumnsModule:awe,ResizeRowsModule:owe,ResizeTableModule:swe,ResponsiveLayoutModule:lwe,SelectRowModule:cwe,SortModule:Bv,SelectRangeModule:uwe,TooltipModule:dwe,ValidateModule:pE}),c7e={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class pwe{constructor(e,i,n={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},n)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var n=Object.assign({},this.registeredDefaults),r=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(n,e);for(let a in i)n.hasOwnProperty(a)||(r&&console.warn("Invalid "+this.msgType+" option:",a),n[a]=i.key);for(let a in n)a in i?n[a]=i[a]:Array.isArray(n[a])?n[a]=Object.assign([],n[a]):typeof n[a]=="object"&&n[a]!==null?n[a]=Object.assign({},n[a]):typeof n[a]>"u"&&delete n[a];return n}}class px extends il{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,n){var r=this.rows().indexOf(e),a=e.getElement(),o=0;return new Promise((s,l)=>{if(r>-1){if(typeof n>"u"&&(n=this.table.options.scrollToRowIfVisible),!n&&Lr.elVisible(a)&&(o=Lr.elOffset(a).top-Lr.elOffset(this.elementVertical).top,o>0&&o<this.elementVertical.clientHeight-a.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(a.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-a.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-a.offsetTop)+a.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+a.offsetHeight;break;case"top":this.elementVertical.scrollTop=a.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class u7e extends px{constructor(e){super(e)}renderRowCells(e,i){const n=document.createDocumentFragment();e.cells.forEach(r=>{n.appendChild(r.getElement())}),e.element.appendChild(n),i||e.cells.forEach(r=>{r.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class d7e extends px{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var n=i.getWidth();n>e&&(e=n)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var n={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},r=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(a=>{var o={},s;a.visible&&(a.modules.frozen||(s=a.getWidth(),o.leftPos=r,o.rightPos=r+s,o.width=s,this.isFitData&&(o.fitDataCheck=a.modules.vdomHoz?a.modules.vdomHoz.fitDataCheck:!0),r+s>this.vDomScrollPosLeft&&r<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=r),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(a),a.modules.vdomHoz=o,r+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(n))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),e.cells.forEach(n=>{n.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,n;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(r=>{!r.definition.width&&r.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){n=i.getElement(),i.generateCells(),this.tableElement.appendChild(n);for(let r=0;r<i.cells.length;r++){let a=i.cells[r];n.appendChild(a.getElement()),a.column.reinitializeWidth()}n.parentNode.removeChild(n),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((n,r)=>{n!==this.columns[r]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));e.forEach(n=>{this.reinitializeRow(n,!0)}),i.forEach(n=>{n.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,n){for(let r=e;r<i;r++){let a=this.columns[r];a.modules.vdomHoz.leftPos+=n,a.modules.vdomHoz.rightPos+=n}}addColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol+1];n&&n.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);r.getElement().insertBefore(a.getElement(),r.getCell(this.columns[this.rightCol]).getElement().nextSibling),a.cellRendered()}}),this.fitDataColActualWidthCheck(n),this.rightCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=n.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol-1];if(n)if(n.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(a=>{if(a.type!=="group"){var o=a.getCell(n);a.getElement().insertBefore(o.getElement(),a.getCell(this.columns[this.leftCol]).getElement()),o.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(a=>{a.type!=="group"&&(a.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=n.getWidth();let r=this.fitDataColActualWidthCheck(n);r&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+r,this.vDomPadRight-=r)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol];n&&n.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColRight",o.message)}}}),this.vDomPadRight+=n.getWidth(),this.rightCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol];n&&n.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var a=r.getCell(n);try{r.getElement().removeChild(a.getElement())}catch(o){console.warn("Could not removeColLeft",o.message)}}}),this.vDomPadLeft+=n.getWidth(),this.leftCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,n;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),n=i-e.modules.vdomHoz.width,n&&(e.modules.vdomHoz.rightPos+=n,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,n)),e.modules.vdomHoz.fitDataCheck=!1),n}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let n=e.getCell(i);e.getElement().appendChild(n.getElement()),n.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var n=e.getElement();n.firstChild;)n.removeChild(n.firstChild);this.initializeRow(e)}}}class p7e extends il{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new pwe(this.table,"column definition",Wbe),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:d7e,basic:u7e};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],n=this.table.options.autoColumnsDefinitions,r,a;if(e&&e.length){r=e[0];for(var o in r){let s={field:o,title:o},l=r[o];switch(typeof l){case"undefined":a="string";break;case"boolean":a="boolean";break;case"object":Array.isArray(l)?a="array":a="string";break;default:!isNaN(l)&&l!==""?a="number":l.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?a="alphanum":a="string";break}s.sorter=a,i.push(s)}if(n)switch(typeof n){case"function":this.table.options.columns=n.call(this.table,i);break;case"object":Array.isArray(n)?i.forEach(s=>{var l=n.find(c=>c.field===s.field);l&&Object.assign(s,l)}):i.forEach(s=>{n[s.field]&&Object.assign(s,n[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),e.forEach((n,r)=>{this._addColumn(n)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,n){var r=new sp(e,this),a=r.getElement(),o=n&&this.findColumnIndex(n);if(n&&o>-1){var s=n.getTopColumn(),l=this.columns.indexOf(s),c=s.getElement();i?(this.columns.splice(l,0,r),c.parentNode.insertBefore(a,c)):(this.columns.splice(l+1,0,r),c.parentNode.insertBefore(a,c.nextSibling))}else i?(this.columns.unshift(r),this.headersElement.insertBefore(r.getElement(),this.headersElement.firstChild)):(this.columns.push(r),this.headersElement.appendChild(r.getElement()));return r.columnRendered(),r}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var n=i.getHeight();n>e&&(e=n)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof sp)return e;if(e instanceof zbe)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}),i.find(r=>r.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(n=>{var r=this.table.options.nestedFieldSeparator?n.split(this.table.options.nestedFieldSeparator)[0]:n;r===e&&i.push(this.columnsByField[n])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,n)=>{e(i,n)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(n=>{(!e||e&&n.visible)&&i.push(n.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],n=e?this.columns:this.columnsByIndex;return n.forEach(r=>{i.push(r.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,n){i.element.parentNode.insertBefore(e.element,i.element),n&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,n),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,n){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,n):this._moveColumnInArray(this.columns,e,i,n),this._moveColumnInArray(this.columnsByIndex,e,i,n,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,n),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,n,r,a){var o=e.indexOf(i),s,l=[];o>-1&&(e.splice(o,1),s=e.indexOf(n),s>-1?r&&(s=s+1):s=o,e.splice(s,0,i),a&&(l=this.chain("column-moving-rows",[i,n,r],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(o,1)[0];c.cells.splice(s,0,u)}})))}scrollToColumn(e,i,n){var r=0,a=e.getLeftOffset(),o=0,s=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof n>"u"&&(n=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":o=-this.element.clientWidth/2;break;case"right":o=s.clientWidth-this.headersElement.clientWidth;break}if(!n&&a>0&&a+s.offsetWidth<this.element.clientWidth)return!1;r=a+o,r=Math.max(Math.min(r,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(r),this.scrollHorizontal(r),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(n=>{i.push(n.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(n){var r,a,o;n.visible&&(r=n.definition.width||0,a=parseInt(n.minWidth),typeof r=="string"?r.indexOf("%")>-1?o=e/100*parseInt(r):o=parseInt(r):o=r,i+=o>a?o:a)}),i}addColumn(e,i,n){return new Promise((r,a)=>{var o=this._addColumn(e,i,n);this._reIndexColumns(),this.dispatch("column-add",e,i,n),this.layoutMode()!="fitColumns"&&o.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),r(o)})}deregisterColumn(e){var i=e.getField(),n;i&&delete this.columnsByField[i],n=this.columnsByIndex.indexOf(e),n>-1&&this.columnsByIndex.splice(n,1),n=this.columns.indexOf(e),n>-1&&this.columns.splice(n,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Lr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class h7e extends px{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,n=document.createDocumentFragment(),r=this.rows();r.forEach((a,o)=>{this.styleRow(a,o),a.initialize(!1,!0),a.type!=="group"&&(i=!1),n.appendChild(a.getElement())}),e.appendChild(n),r.forEach(a=>{a.rendered(),a.heightInitialized||a.calcHeight(!0)}),r.forEach(a=>{a.heightInitialized||a.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Lr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Lr.elOffset(i).top-Lr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class f7e extends px{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,n=!1,r=!1,a=this.table.rowManager.scrollLeft,o=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(o[s]){var l=i-o[s].getElement().offsetTop;if(r===!1||Math.abs(l)<r)r=l,n=s;else break}o.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(n===!1?this.rows.length-1:n,!0,r||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(a)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var n=e-this.vDomScrollPosTop,r=e-this.vDomScrollPosBottom,a=this.vDomWindowBuffer*2,o=this.rows();if(this.scrollTop=e,-n>a||r>a){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*o.length)),this.scrollColumns(s)}else i?(n<0&&this._addTopRow(o,-n),r<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(o,-r):this.vDomScrollPosBottom=this.scrollTop)):(r>=0&&this._addBottomRow(o,r),n>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(o,n):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,n=this.elementVertical.clientHeight+i,r=!1,a=0,o=0,s=this.rows();if(e)a=this.vDomTop,o=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(r)if(n-s[l].getElement().offsetTop>=0)o=l;else break;else if(i-s[l].getElement().offsetTop>=0)a=l;else if(r=!0,n-s[l].getElement().offsetTop>=0)o=l;else break;return s.slice(a,o+1)}_virtualRenderFill(e,i,n){var r=this.tableElement,a=this.elementVertical,o=0,s=0,l=0,c=0,u=0,d=0,p=this.rows(),h=p.length,f=0,m,g,v=[],y=0,I=0,b=this.table.rowManager.fixedHeight,D=this.elementVertical.clientHeight,w=this.table.options.rowHeight,S=!0;if(e=e||0,n=n||0,!e)this.clear();else{for(;r.firstChild;)r.removeChild(r.firstChild);c=(h-e+1)*this.vDomRowHeight,c<D&&(e-=Math.ceil((D-c)/this.vDomRowHeight),e<0&&(e=0)),o=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=o}if(h&&Lr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,b||this.table.options.maxHeight?(w&&(I=D/w+this.vDomWindowBuffer/w),I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(I))):I=h;(I==h||s<=D+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<h-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<I&&this.vDomBottom<h-1;)f=this.vDomBottom+1,m=p[f],this.styleRow(m,f),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;r.appendChild(g),v.forEach(U=>{U.rendered(),U.heightInitialized||U.calcHeight(!0)}),v.forEach(U=>{U.heightInitialized||U.setCellHeight()}),v.forEach(U=>{l=U.getHeight(),y<o?u+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),S=this.table.rowManager.adjustTableSize(),D=this.elementVertical.clientHeight,S&&(b||this.table.options.maxHeight)&&(w=s/y,I=Math.max(this.vDomWindowMinTotalRows,Math.ceil(D/w+this.vDomWindowBuffer/w)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+n:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==h-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+u)/y),this.vDomBottomPad=this.vDomRowHeight*(h-this.vDomBottom-1),this.vDomScrollHeight=u+s+this.vDomBottomPad-D),r.style.paddingTop=this.vDomTopPad+"px",r.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+n-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-D:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-D),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-D),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,a.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var n=this.tableElement,r=[],a=0,o=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let c=e[o],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,o),n.insertBefore(c.getElement(),n.firstChild),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomTop--,o--,s++):l=!1):l=!1}else l=!1;for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomTopPad-=a,this.vDomTopPad<0&&(this.vDomTopPad=o*this.vDomRowHeight),o<1&&(this.vDomTopPad=0),n.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=a)}_removeTopRow(e,i){for(var n=[],r=0,a=0,o=!0;o;){let s=e[this.vDomTop],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,r+=l,n.push(s),a++):o=!1):o=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomTopPad+=r,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?r:r+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var n=this.tableElement,r=[],a=0,o=this.vDomBottom+1,s=0,l=!0;l;){let c=e[o],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,o),n.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,a+=u,this.vDomBottom++,o++,s++):l=!1):l=!1}for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),a&&(this.vDomBottomPad-=a,(this.vDomBottomPad<0||o==e.length-1)&&(this.vDomBottomPad=0),n.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=a)}_removeBottomRow(e,i){for(var n=[],r=0,a=0,o=!0;o;){let s=e[this.vDomBottom],l;s&&a<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,r+=l,n.push(s),a++):o=!1):o=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomBottomPad+=r,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=r)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class m7e extends il{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let n=document.createElement("div");n.classList.add("tabulator-placeholder-contents"),n.innerHTML=e,i.appendChild(n),this.placeholderContents=n}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,n=this.element.scrollTop,r=this.scrollTop>n;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=n&&(this.scrollTop=n,this.renderer.scrollRows(n,r),this.dispatch("scroll-vertical",n,r),this.dispatchExternal("scrollVertical",n,r))})}findRow(e){if(typeof e=="object"){if(e instanceof Es)return e;if(e instanceof cx)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(n=>n.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(n=>n.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(n=>n.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,n){return this.renderer.scrollToRowPosition(e,i,n)}setData(e,i,n){return new Promise((r,a)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&n&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),r()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((n,r)=>{if(n&&typeof n=="object"){var a=new Es(n,this);this.rows.push(a)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",n)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var n=this.rows.indexOf(e),r=this.activeRows.indexOf(e);r>-1&&this.activeRows.splice(r,1),n>-1&&this.rows.splice(n,1),this.setActiveRows(this.activeRows),this.displayRowIterator(a=>{var o=a.indexOf(e);o>-1&&a.splice(o,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,n,r){var a=this.addRowActual(e,i,n,r);return a}addRows(e,i,n,r){var a=[];return new Promise((o,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof n>"u"&&i||typeof n<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,n,!0);a.push(u),this.dispatch("row-added",u,l,i,n)}),this.refreshActiveData(r?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),o(a)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,n,r){var a=e instanceof Es?e:new Es(e||{},this),o=this.findAddRowPos(i),s=-1,l,c;return n||(c=this.chain("row-adding-position",[a,o],null,{index:n,top:o}),n=c.index,o=c.top),typeof n<"u"&&(n=this.findRow(n)),n=this.chain("row-adding-index",[a,n,o],null,n),n&&(s=this.rows.indexOf(n)),n&&s>-1?(l=this.activeRows.indexOf(n),this.displayRowIterator(function(u){var d=u.indexOf(n);d>-1&&u.splice(o?d:d+1,0,a)}),l>-1&&this.activeRows.splice(o?l:l+1,0,a),this.rows.splice(o?s:s+1,0,a)):o?(this.displayRowIterator(function(u){u.unshift(a)}),this.activeRows.unshift(a),this.rows.unshift(a)):(this.displayRowIterator(function(u){u.push(a)}),this.activeRows.push(a),this.rows.push(a)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",a.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r||this.reRenderInPosition(),a}moveRow(e,i,n){this.dispatch("row-move",e,i,n),this.moveRowActual(e,i,n),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,n),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,n){this.moveRowInArray(this.rows,e,i,n),this.moveRowInArray(this.activeRows,e,i,n),this.displayRowIterator(r=>{this.moveRowInArray(r,e,i,n)}),this.dispatch("row-moving",e,i,n)}moveRowInArray(e,i,n,r){var a,o,s,l;if(i!==n&&(a=e.indexOf(i),a>-1&&(e.splice(a,1),o=e.indexOf(n),o>-1?r?e.splice(o+1,0,i):e.splice(o,0,i):e.splice(a,0,i)),e===this.getDisplayRows())){s=a<o?a:o,l=o>a?o:a+1;for(let c=s;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n!==!1&&n<this.displayRowsCount-1&&(r=this.getDisplayRows()[n+1]),r&&(!(r instanceof Es)||r.type!="row")?this.nextDisplayRow(r,i):r}prevDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n&&(r=this.getDisplayRows()[n-1]),i&&r&&(!(r instanceof Es)||r.type!="row")?this.prevDisplayRow(r,i):r}findRowIndex(e,i){var n;return e=this.findRow(e),e&&(n=i.indexOf(e),n>-1)?n:!1}getData(e,i){var n=[],r=this.getRows(e);return r.forEach(function(a){a.type=="row"&&n.push(a.getData(i||"data"))}),n}getComponents(e){var i=[],n=this.getRows(e);return n.forEach(function(r){i.push(r.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,n){var r=this.table,a="",o=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(o=this.dataPipeline.findIndex(l=>l.handler===e),o>-1)a="dataPipeline",i&&(o==this.dataPipeline.length-1?a="display":o++);else if(o=this.displayPipeline.findIndex(l=>l.handler===e),o>-1)a="displayPipeline",i&&(o==this.displayPipeline.length-1?a="end":o++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else a=e||"all",o=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===a&&o<this.redrawBlockRestoreConfig.index||s.indexOf(a)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:n,stage:a,index:o});return}else Lr.elVisible(this.element)?n?this.reRenderInPosition(this.refreshPipelines.bind(this,e,a,o,n)):(this.refreshPipelines(e,a,o,n),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),r.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,a,o,n),this.dispatch("data-refreshed")}}refreshPipelines(e,i,n,r){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let a=n;a<this.dataPipeline.length;a++){let o=this.dataPipeline[a].handler(this.activeRowsPipeline[a].slice(0));this.activeRowsPipeline[a+1]=o||this.activeRowsPipeline[a].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":n=0,this.resetDisplayRows();case"displayPipeline":for(let a=n;a<this.displayPipeline.length;a++){let o=this.displayPipeline[a].handler((a?this.getDisplayRows(a-1):this.activeRows).slice(0),r);this.setDisplayRows(o||this.getDisplayRows(a-1).slice(0),a)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(n=>{n.type==="row"&&(n.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var n=Object.assign([],this.renderer.visibleRows(!i));return e&&(n=this.chain("rows-visible",[i],n,n)),n}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:f7e,basic:h7e};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,n=!1;if(this.renderer.verticalFillMode==="fill"){let r=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const a="calc(100% - "+r+"px)";this.element.style.minHeight=i||"calc(100% - "+r+"px)",this.element.style.height=a,this.element.style.maxHeight=a}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-r+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(n=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),n}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class g7e extends il{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class v7e extends il{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,n){this.pseudoTrackers[e].target!==n&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=n,this.dispatch(e+"-mouseenter",i,n))}pseudoMouseLeave(e,i){var n=Object.keys(this.pseudoTrackers),r={row:["cell"],cell:["row"]};n=n.filter(a=>{var o=r[e];return a!==e&&(!o||o&&!o.includes(a))}),n.forEach(a=>{var o=this.pseudoTrackers[a].target;this.pseudoTrackers[a].target&&(this.dispatch(a+"-mouseleave",i,o),this.pseudoTrackers[a].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let n of i)for(let r of e){let a=n+"-"+r;this.subscriptionChange(a,this.subscriptionChanged.bind(this,n,r))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,n){var r=this.listeners[i].components,a=r.indexOf(e),o=!1;n?a===-1&&(r.push(e),o=!0):this.subscribed(e+"-"+i)||a>-1&&(r.splice(a,1),o=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),o&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var n=i.composedPath&&i.composedPath()||i.path,r=this.findTargets(n);r=this.bindComponents(e,r),this.triggerEvents(e,i,r),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(r).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let n=Object.keys(this.componentMap);for(let r of e){let a=r.classList?[...r.classList]:[];if(a.filter(l=>this.abortClasses.includes(l)).length)break;let s=a.filter(l=>n.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=r)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var n=Object.keys(i).reverse(),r=this.listeners[e],a={},o={};for(let s of n){let l,c=i[s],u=this.previousTargets[s];if(u&&u.target===c)l=u.component;else switch(s){case"row":case"group":(r.components.includes("row")||r.components.includes("cell")||r.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":r.components.includes("column")&&(l=this.table.columnManager.findColumn(c));break;case"cell":r.components.includes("cell")&&(a.row instanceof Es?l=a.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(a[s]=l,o[s]={target:c,component:l})}return this.previousTargets=o,a}triggerEvents(e,i,n){var r=this.listeners[e];for(let a in n)n[a]&&r.components.includes(a)&&this.dispatch(a+"-"+e,i,n[a])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class y7e{constructor(e){this.table=e,this.bindings={}}bind(e,i,n){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,n):this.bindings[e][i]=n}handle(e,i,n){if(this.bindings[e]&&this.bindings[e][n]&&typeof this.bindings[e][n].bind=="function")return this.bindings[e][n].bind(null,i);n!=="then"&&typeof n=="string"&&!n.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+n+" function, have you checked that you have the correct Tabulator module installed?")}}class I7e extends il{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,n,r,a,o){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,n,a])){this.loading=!0,a||this.alertLoader(),i=this.chain("data-params",[e,n,a],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,n,a],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",c,null,c);s==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,r,typeof o>"u"?!r:o))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),a||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,r,typeof o>"u"?!r:o),Promise.resolve()}mapParams(e,i){var n={};for(let r in e)n[i.hasOwnProperty(r)?i[r]:r]=e[r];return n}objectInvert(e){var i={};for(let n in e)i[e[n]]=n;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class b7e{constructor(e,i,n){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=n?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=n}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e])if(i)if(n=this.events[e].findIndex(r=>r===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),n;return this.events[i]&&this.events[i].forEach((r,a)=>{let o=r.apply(this.table,e);a||(n=o)}),n}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class w7e{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,n=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:n}),this.events[e].sort((r,a)=>r.priority-a.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e]){if(i)if(n=this.events[e].findIndex(r=>r.callback===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,n,r){var a=n;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((o,s)=>{a=o.callback.apply(this,i.concat([a]))}),a):typeof r=="function"?r():r}_confirm(e,i){var n=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((r,a)=>{r.callback.apply(this,i)&&(n=!0)}),n}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(n=>{n.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class S7e extends il{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,n){var r="";return typeof this.options(e)<"u"?(r="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(r=r+", Please use the %c"+i+"%c option instead",this._warnUser(r,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),n&&(this.table.options[i]=this.table.options[e])):this._warnUser(r,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class lc{static register(e){lc.tables.push(e)}static deregister(e){var i=lc.tables.indexOf(e);i>-1&&lc.tables.splice(i,1)}static lookupTable(e,i){var n=[],r,a;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length)for(var o=0;o<r.length;o++)a=lc.matchElement(r[o]),a&&n.push(a)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof wy?(a=lc.matchElement(e),a&&n.push(a)):Array.isArray(e)?e.forEach(function(s){n=n.concat(lc.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return n}static matchElement(e){return lc.tables.find(function(i){return e instanceof wy?i===e:i.element===e})}}lc.tables=[];function T7e(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function s9(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function U7e(t,e){var i=0,n=this.table.rowManager.element.clientWidth,r=0,a=!1;t.forEach((o,s)=>{o.widthFixed||o.reinitializeWidth(),(this.table.options.responsiveLayout?o.modules.responsive.visible:o.visible)&&(a=o),o.visible&&(i+=o.getWidth())}),a?(r=n-i+a.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(a.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?a.setWidth(r):a.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function D7e(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,n=0,r=0,a=0,o=0,s=[],l=[],c=0,u=0,d=0;function p(f){var m;return typeof f=="string"?f.indexOf("%")>-1?m=i/100*parseInt(f):m=parseInt(f):m=f,m}function h(f,m,g,v){var y=[],I=0,b=0,D=0,w=a,S=0,U=0,C=[];function E(M){return g*(M.column.definition.widthGrow||1)}function P(M){return p(M.width)-g*(M.column.definition.widthShrink||0)}return f.forEach(function(M,N){var R=v?P(M):E(M);M.column.minWidth>=R?y.push(M):M.column.maxWidth&&M.column.maxWidth<R?(M.width=M.column.maxWidth,m-=M.column.maxWidth,w-=v?M.column.definition.widthShrink||1:M.column.definition.widthGrow||1,w&&(g=Math.floor(m/w))):(C.push(M),U+=v?M.column.definition.widthShrink||1:M.column.definition.widthGrow||1)}),y.length?(y.forEach(function(M){I+=v?M.width-M.column.minWidth:M.column.minWidth,M.width=M.column.minWidth}),b=m-I,D=U?Math.floor(b/U):b,S=h(C,b,D,v)):(S=U?m-Math.floor(m/U)*U:m,C.forEach(function(M){M.width=v?P(M):E(M)})),S}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(f){var m,g,v;f.visible&&(m=f.definition.width,g=parseInt(f.minWidth),m?(v=p(m),n+=v>g?v:g,f.definition.widthShrink&&(l.push({column:f,width:v>g?v:g}),c+=f.definition.widthShrink)):(s.push({column:f,width:0}),a+=f.definition.widthGrow||1))}),r=i-n,o=Math.floor(r/a),d=h(s,r,o,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(f){r-=f.width}),u=Math.abs(d)+r,u>0&&c&&(d=h(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(f){f.column.setWidth(f.width)}),l.forEach(function(f){f.column.setWidth(f.width)})}var P7e={fitData:T7e,fitDataFill:s9,fitDataTable:s9,fitDataStretch:U7e,fitColumns:D7e};class Lw extends Qi{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;Lw.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),Lw.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}}Lw.moduleName="layout";Lw.modes=P7e;var C7e={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class hE extends Qi{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Lr.deepClone(hE.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let n in i)e[n]&&typeof e[n]=="object"?this._setLangProp(e[n],i[n]):e[n]=i[n]}setLocale(e){e=e||"default";function i(n,r){for(var a in n)typeof n[a]=="object"?(r[a]||(r[a]={}),i(n[a],r[a])):r[a]=n[a]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let n=e.split("-")[0];this.langList[n]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,n),e=n):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Lr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var n=i?e+"|"+i:e,r=n.split("|"),a=this._getLangElement(r,this.locale);return a||""}_getLangElement(e,i){var n=this.lang;return e.forEach(function(r){var a;n&&(a=n[r],typeof a<"u"?n=a:n=!1)}),n}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}hE.moduleName="localize";hE.langs=C7e;class hwe extends Qi{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],n;return n=lc.lookupTable(e),n.forEach(r=>{this.table!==r&&i.push(r)}),i}send(e,i,n,r){var a=this.getConnections(e);a.forEach(o=>{o.tableComms(this.table.element,i,n,r)}),!a.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,n,r){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,n,r);console.warn("Inter-table Comms Error - no such module:",i)}}hwe.moduleName="comms";var E7e=Object.freeze({__proto__:null,LayoutModule:Lw,LocalizeModule:hE,CommsModule:hwe});class fwe{constructor(e,i){this.bindStaticFunctionality(e),this.bindModules(e,E7e,!0),i&&this.bindModules(e,i)}bindStaticFunctionality(e){e.moduleBindings={},e.extendModule=function(i,n,r){if(e.moduleBindings[i]){var a=e.moduleBindings[i][n];if(a)if(typeof r=="object")for(let o in r)a[o]=r[o];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",n)}else console.warn("Module Error - module does not exist:",i)},e.registerModule=function(i){Array.isArray(i)||(i=[i]),i.forEach(n=>{e.registerModuleBinding(n)})},e.registerModuleBinding=function(i){e.moduleBindings[i.moduleName]=i},e.findTable=function(i){var n=lc.lookupTable(i,!0);return Array.isArray(n)&&!n.length?!1:n},e.prototype.bindModules=function(){var i=[],n=[],r=[];this.modules={};for(var a in e.moduleBindings){let o=e.moduleBindings[a],s=new o(this);this.modules[a]=s,o.prototype.moduleCore?this.modulesCore.push(s):o.moduleInitOrder?o.moduleInitOrder<0?i.push(s):n.push(s):r.push(s)}i.sort((o,s)=>o.moduleInitOrder>s.moduleInitOrder?1:-1),n.sort((o,s)=>o.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=i.concat(r.concat(n))}}bindModules(e,i,n){var r=Object.values(i);n&&r.forEach(a=>{a.prototype.moduleCore=!0}),e.registerModule(r)}}class M7e extends il{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class wy{constructor(e,i){this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new y7e(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new S7e(this),this.optionsList=new pwe(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),lc.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new p7e(this),this.rowManager=new m7e(this),this.footerManager=new g7e(this),this.dataLoader=new I7e(this),this.alertManager=new M7e(this),this.bindModules(),this.options=this.optionsList.generate(wy.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new b7e(this,this.options,this.options.debugEventsExternal),this.eventBus=new w7e(this.options.debugEventsInternal),this.interactionMonitor=new v7e(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,n;if(e.tagName==="TABLE"){this.originalElement=this.element,n=document.createElement("div");var r=e.attributes;for(var a in r)typeof r[a]=="object"&&n.setAttribute(r[a].name,r[a].value);e.parentNode.replaceChild(n,e),this.element=e=n}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(n=>{n.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(n=>{n.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){this.dataLoader.load(this.options.data),this.columnManager.verticalAlignHeaders()}destroy(){var e=this.element;for(this.destroyed=!0,lc.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var n,r;return this.options.debugInitialization&&!this.initialized&&(e||(n=new Error().stack.split(`
`),r=n[0]=="Error"?n[2]:n[1],r[0]==" "?e=r.trim().split(" ")[1].split(".")[1]:e=r.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,n){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,n,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,n){return this.initGuard(),this.dataLoader.load(e,i,n,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var o=this.rowManager.findRow(a[this.options.index]);o?(i++,o.updateData(a).then(()=>{i--,i||n()}).catch(s=>{r("Update Error - Unable to update row",a,s)})):r("Update Error - Unable to find row",a)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}addData(e,i,n){return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,n).then(o=>{var s=[];o.forEach(function(l){s.push(l.getComponent())}),r(s)}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}updateOrAddData(e){var i=[],n=0;return this.initGuard(),new Promise((r,a)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var s=this.rowManager.findRow(o[this.options.index]);n++,s?s.updateData(o).then(()=>{n--,i.push(s.getComponent()),n||r(i)}):this.rowManager.addRows(o).then(l=>{n--,i.push(l[0].getComponent()),n||r(i)})}):(console.warn("Update Error - No data provided"),a("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let n of e){let r=this.rowManager.findRow(n,!0);if(r)i.push(r);else return console.error("Delete Error - No matching row found:",n),Promise.reject("Delete Error - No matching row found")}return i.sort((n,r)=>this.rowManager.rows.indexOf(n)>this.rowManager.rows.indexOf(r)?1:-1),i.forEach(n=>{n.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,n){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,n,!0).then(r=>r[0].getComponent())}updateOrAddRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>n.getComponent()):this.rowManager.addRows(i).then(r=>r[0].getComponent())}updateRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>Promise.resolve(n.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,n){var r=this.rowManager.findRow(e);return r?this.rowManager.scrollToRow(r,i,n):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,n){var r=this.rowManager.findRow(e);this.initGuard(),r?r.moveToRow(i,n):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,n){var r=this.columnManager.findColumn(n);return this.initGuard(),this.columnManager.addColumn(e,i,r).then(a=>a.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var n=this.columnManager.findColumn(e);return this.initGuard(),n?n.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,n){var r=this.columnManager.findColumn(e),a=this.columnManager.findColumn(i);this.initGuard(),r?a?this.columnManager.moveColumn(r,a,n):console.warn("Move Error - No matching column found:",a):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,n){return new Promise((r,a)=>{var o=this.columnManager.findColumn(e);return o?this.columnManager.scrollToColumn(o,i,n):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}wy.defaultOptions=c7e;new fwe(wy);class na extends wy{}new fwe(na,l7e);const{MALE:R7e,FEMALE:N7e}=Du;function A7e(t){var o;const e=t.getValue(),i=t.getRow().getData(),n=i.sex||((o=i.person)==null?void 0:o.sex),r=(n==null?void 0:n.toUpperCase())===R7e&&"#2E86C1"||(n==null?void 0:n.toUpperCase())===N7e&&"#AA336A"||"",a=document.createElement("div");return a.style.color=r,a.innerHTML=e,a}function _7e(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:A7e,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function mwe({selectedParticipantIds:t,selectionLimit:e=1,targetAttribute:i,placeholder:n,onSelected:r,data:a=[],anchorId:o}){a.some(d=>d.participant)&&(a=a.map(({participant:d,...p})=>({...p,participantName:"BYE",...d}))),a.forEach(d=>{var p;return d.searchText=(p=d.participantName)==null?void 0:p.toLowerCase()});const l=_7e(a),c=document.getElementById(o),u=new na(c,{placeholder:n||"No options",index:i,selectable:e,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:l,data:a});return Ye.tables||(Ye.tables={}),Ye.tables.selectionTable=u,u.on("tableBuilt",()=>{t!=null&&t.length&&u.selectRow(t)}),u.on("rowSelectionChanged",(d,p)=>{const h=p==null?void 0:p.map(f=>f.getData());pt(r)&&r(h)}),{table:u}}function gwe({title:t,placeholder:e,options:i,selectionLimit:n}){const r="selectionControl",a="selectionTable",o=[{label:"Cancel",intent:"is-none",close:!0}],s=()=>{const f=Ye.tables.selectionTable;f==null||f.destroy(),delete Ye.tables.selectionTable},l=`
    <div style='min-height: 420px'>
      <div id='${r}'></div>
      <div id='${a}'></div>
    </div>
  `;ir({title:t,content:l,buttons:o,onClose:s});const c=f=>{var m;(m=f==null?void 0:f[0])!=null&&m.onClick&&(f[0].onClick(),Mw())},{table:u}=mwe({targetAttribute:"participantid",selectionLimit:n,data:i,placeholder:e,onSelected:c,anchorId:a}),d=UI(u),p=[{onKeyDown:f=>f.keyCode===8&&f.target.value.length===1&&d(""),onChange:f=>d(f.target.value),onKeyUp:f=>d(f.target.value),clearSearch:()=>d(""),placeholder:"Search",location:Et,search:!0}],h=document.getElementById(r);ho({table:u,target:h,items:p})}var Pl="top",wu="bottom",Su="right",Cl="left",u6="auto",fE=[Pl,wu,Su,Cl],Fw="start",QU="end",k7e="clippingParents",vwe="viewport",NS="popper",O7e="reference",l9=fE.reduce(function(t,e){return t.concat([e+"-"+Fw,e+"-"+QU])},[]),ywe=[].concat(fE,[u6]).reduce(function(t,e){return t.concat([e,e+"-"+Fw,e+"-"+QU])},[]),x7e="beforeRead",L7e="read",F7e="afterRead",$7e="beforeMain",B7e="main",V7e="afterMain",j7e="beforeWrite",G7e="write",H7e="afterWrite",z7e=[x7e,L7e,F7e,$7e,B7e,V7e,j7e,G7e,H7e];function kp(t){return t?(t.nodeName||"").toLowerCase():null}function kc(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function Sy(t){var e=kc(t).Element;return t instanceof e||t instanceof Element}function iu(t){var e=kc(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function d6(t){if(typeof ShadowRoot>"u")return!1;var e=kc(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function W7e(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},a=e.elements[i];!iu(a)||!kp(a)||(Object.assign(a.style,n),Object.keys(r).forEach(function(o){var s=r[o];s===!1?a.removeAttribute(o):a.setAttribute(o,s===!0?"":s)}))})}function q7e(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],a=e.attributes[n]||{},o=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),s=o.reduce(function(l,c){return l[c]="",l},{});!iu(r)||!kp(r)||(Object.assign(r.style,s),Object.keys(a).forEach(function(l){r.removeAttribute(l)}))})}}const Iwe={name:"applyStyles",enabled:!0,phase:"write",fn:W7e,effect:q7e,requires:["computeStyles"]};function lp(t){return t.split("-")[0]}var Vv=Math.max,MN=Math.min,$w=Math.round;function A2(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function bwe(){return!/^((?!chrome|android).)*safari/i.test(A2())}function Bw(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,a=1;e&&iu(t)&&(r=t.offsetWidth>0&&$w(n.width)/t.offsetWidth||1,a=t.offsetHeight>0&&$w(n.height)/t.offsetHeight||1);var o=Sy(t)?kc(t):window,s=o.visualViewport,l=!bwe()&&i,c=(n.left+(l&&s?s.offsetLeft:0))/r,u=(n.top+(l&&s?s.offsetTop:0))/a,d=n.width/r,p=n.height/a;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function p6(t){var e=Bw(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function wwe(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&d6(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function df(t){return kc(t).getComputedStyle(t)}function K7e(t){return["table","td","th"].indexOf(kp(t))>=0}function Bg(t){return((Sy(t)?t.ownerDocument:t.document)||window.document).documentElement}function hx(t){return kp(t)==="html"?t:t.assignedSlot||t.parentNode||(d6(t)?t.host:null)||Bg(t)}function c9(t){return!iu(t)||df(t).position==="fixed"?null:t.offsetParent}function Y7e(t){var e=/firefox/i.test(A2()),i=/Trident/i.test(A2());if(i&&iu(t)){var n=df(t);if(n.position==="fixed")return null}var r=hx(t);for(d6(r)&&(r=r.host);iu(r)&&["html","body"].indexOf(kp(r))<0;){var a=df(r);if(a.transform!=="none"||a.perspective!=="none"||a.contain==="paint"||["transform","perspective"].indexOf(a.willChange)!==-1||e&&a.willChange==="filter"||e&&a.filter&&a.filter!=="none")return r;r=r.parentNode}return null}function mE(t){for(var e=kc(t),i=c9(t);i&&K7e(i)&&df(i).position==="static";)i=c9(i);return i&&(kp(i)==="html"||kp(i)==="body"&&df(i).position==="static")?e:i||Y7e(t)||e}function h6(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function RT(t,e,i){return Vv(t,MN(e,i))}function Z7e(t,e,i){var n=RT(t,e,i);return n>i?i:n}function Swe(){return{top:0,right:0,bottom:0,left:0}}function Twe(t){return Object.assign({},Swe(),t)}function Uwe(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var X7e=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,Twe(typeof e!="number"?e:Uwe(e,fE))};function J7e(t){var e,i=t.state,n=t.name,r=t.options,a=i.elements.arrow,o=i.modifiersData.popperOffsets,s=lp(i.placement),l=h6(s),c=[Cl,Su].indexOf(s)>=0,u=c?"height":"width";if(!(!a||!o)){var d=X7e(r.padding,i),p=p6(a),h=l==="y"?Pl:Cl,f=l==="y"?wu:Su,m=i.rects.reference[u]+i.rects.reference[l]-o[l]-i.rects.popper[u],g=o[l]-i.rects.reference[l],v=mE(a),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,I=m/2-g/2,b=d[h],D=y-p[u]-d[f],w=y/2-p[u]/2+I,S=RT(b,w,D),U=l;i.modifiersData[n]=(e={},e[U]=S,e.centerOffset=S-w,e)}}function Q7e(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||wwe(e.elements.popper,r)&&(e.elements.arrow=r))}const eKe={name:"arrow",enabled:!0,phase:"main",fn:J7e,effect:Q7e,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Vw(t){return t.split("-")[1]}var tKe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function iKe(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:$w(i*r)/r||0,y:$w(n*r)/r||0}}function u9(t){var e,i=t.popper,n=t.popperRect,r=t.placement,a=t.variation,o=t.offsets,s=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=o.x,h=p===void 0?0:p,f=o.y,m=f===void 0?0:f,g=typeof u=="function"?u({x:h,y:m}):{x:h,y:m};h=g.x,m=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),I=Cl,b=Pl,D=window;if(c){var w=mE(i),S="clientHeight",U="clientWidth";if(w===kc(i)&&(w=Bg(i),df(w).position!=="static"&&s==="absolute"&&(S="scrollHeight",U="scrollWidth")),w=w,r===Pl||(r===Cl||r===Su)&&a===QU){b=wu;var C=d&&w===D&&D.visualViewport?D.visualViewport.height:w[S];m-=C-n.height,m*=l?1:-1}if(r===Cl||(r===Pl||r===wu)&&a===QU){I=Su;var E=d&&w===D&&D.visualViewport?D.visualViewport.width:w[U];h-=E-n.width,h*=l?1:-1}}var P=Object.assign({position:s},c&&tKe),M=u===!0?iKe({x:h,y:m},kc(i)):{x:h,y:m};if(h=M.x,m=M.y,l){var N;return Object.assign({},P,(N={},N[b]=y?"0":"",N[I]=v?"0":"",N.transform=(D.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",N))}return Object.assign({},P,(e={},e[b]=y?m+"px":"",e[I]=v?h+"px":"",e.transform="",e))}function nKe(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,a=i.adaptive,o=a===void 0?!0:a,s=i.roundOffsets,l=s===void 0?!0:s,c={placement:lp(e.placement),variation:Vw(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,u9(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,u9(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const rKe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:nKe,data:{}};var a1={passive:!0};function aKe(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,a=r===void 0?!0:r,o=n.resize,s=o===void 0?!0:o,l=kc(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return a&&c.forEach(function(u){u.addEventListener("scroll",i.update,a1)}),s&&l.addEventListener("resize",i.update,a1),function(){a&&c.forEach(function(u){u.removeEventListener("scroll",i.update,a1)}),s&&l.removeEventListener("resize",i.update,a1)}}const oKe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:aKe,data:{}};var sKe={left:"right",right:"left",bottom:"top",top:"bottom"};function UM(t){return t.replace(/left|right|bottom|top/g,function(e){return sKe[e]})}var lKe={start:"end",end:"start"};function d9(t){return t.replace(/start|end/g,function(e){return lKe[e]})}function f6(t){var e=kc(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function m6(t){return Bw(Bg(t)).left+f6(t).scrollLeft}function cKe(t,e){var i=kc(t),n=Bg(t),r=i.visualViewport,a=n.clientWidth,o=n.clientHeight,s=0,l=0;if(r){a=r.width,o=r.height;var c=bwe();(c||!c&&e==="fixed")&&(s=r.offsetLeft,l=r.offsetTop)}return{width:a,height:o,x:s+m6(t),y:l}}function uKe(t){var e,i=Bg(t),n=f6(t),r=(e=t.ownerDocument)==null?void 0:e.body,a=Vv(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),o=Vv(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-n.scrollLeft+m6(t),l=-n.scrollTop;return df(r||i).direction==="rtl"&&(s+=Vv(i.clientWidth,r?r.clientWidth:0)-a),{width:a,height:o,x:s,y:l}}function g6(t){var e=df(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function Dwe(t){return["html","body","#document"].indexOf(kp(t))>=0?t.ownerDocument.body:iu(t)&&g6(t)?t:Dwe(hx(t))}function NT(t,e){var i;e===void 0&&(e=[]);var n=Dwe(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),a=kc(n),o=r?[a].concat(a.visualViewport||[],g6(n)?n:[]):n,s=e.concat(o);return r?s:s.concat(NT(hx(o)))}function _2(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function dKe(t,e){var i=Bw(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function p9(t,e,i){return e===vwe?_2(cKe(t,i)):Sy(e)?dKe(e,i):_2(uKe(Bg(t)))}function pKe(t){var e=NT(hx(t)),i=["absolute","fixed"].indexOf(df(t).position)>=0,n=i&&iu(t)?mE(t):t;return Sy(n)?e.filter(function(r){return Sy(r)&&wwe(r,n)&&kp(r)!=="body"}):[]}function hKe(t,e,i,n){var r=e==="clippingParents"?pKe(t):[].concat(e),a=[].concat(r,[i]),o=a[0],s=a.reduce(function(l,c){var u=p9(t,c,n);return l.top=Vv(u.top,l.top),l.right=MN(u.right,l.right),l.bottom=MN(u.bottom,l.bottom),l.left=Vv(u.left,l.left),l},p9(t,o,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Pwe(t){var e=t.reference,i=t.element,n=t.placement,r=n?lp(n):null,a=n?Vw(n):null,o=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(r){case Pl:l={x:o,y:e.y-i.height};break;case wu:l={x:o,y:e.y+e.height};break;case Su:l={x:e.x+e.width,y:s};break;case Cl:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var c=r?h6(r):null;if(c!=null){var u=c==="y"?"height":"width";switch(a){case Fw:l[c]=l[c]-(e[u]/2-i[u]/2);break;case QU:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function eD(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,a=i.strategy,o=a===void 0?t.strategy:a,s=i.boundary,l=s===void 0?k7e:s,c=i.rootBoundary,u=c===void 0?vwe:c,d=i.elementContext,p=d===void 0?NS:d,h=i.altBoundary,f=h===void 0?!1:h,m=i.padding,g=m===void 0?0:m,v=Twe(typeof g!="number"?g:Uwe(g,fE)),y=p===NS?O7e:NS,I=t.rects.popper,b=t.elements[f?y:p],D=hKe(Sy(b)?b:b.contextElement||Bg(t.elements.popper),l,u,o),w=Bw(t.elements.reference),S=Pwe({reference:w,element:I,strategy:"absolute",placement:r}),U=_2(Object.assign({},I,S)),C=p===NS?U:w,E={top:D.top-C.top+v.top,bottom:C.bottom-D.bottom+v.bottom,left:D.left-C.left+v.left,right:C.right-D.right+v.right},P=t.modifiersData.offset;if(p===NS&&P){var M=P[r];Object.keys(E).forEach(function(N){var R=[Su,wu].indexOf(N)>=0?1:-1,A=[Pl,wu].indexOf(N)>=0?"y":"x";E[N]+=M[A]*R})}return E}function fKe(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,a=i.rootBoundary,o=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?ywe:l,u=Vw(n),d=u?s?l9:l9.filter(function(f){return Vw(f)===u}):fE,p=d.filter(function(f){return c.indexOf(f)>=0});p.length===0&&(p=d);var h=p.reduce(function(f,m){return f[m]=eD(t,{placement:m,boundary:r,rootBoundary:a,padding:o})[lp(m)],f},{});return Object.keys(h).sort(function(f,m){return h[f]-h[m]})}function mKe(t){if(lp(t)===u6)return[];var e=UM(t);return[d9(t),e,d9(e)]}function gKe(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,a=r===void 0?!0:r,o=i.altAxis,s=o===void 0?!0:o,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,h=i.flipVariations,f=h===void 0?!0:h,m=i.allowedAutoPlacements,g=e.options.placement,v=lp(g),y=v===g,I=l||(y||!f?[UM(g)]:mKe(g)),b=[g].concat(I).reduce(function(z,H){return z.concat(lp(H)===u6?fKe(e,{placement:H,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:m}):H)},[]),D=e.rects.reference,w=e.rects.popper,S=new Map,U=!0,C=b[0],E=0;E<b.length;E++){var P=b[E],M=lp(P),N=Vw(P)===Fw,R=[Pl,wu].indexOf(M)>=0,A=R?"width":"height",_=eD(e,{placement:P,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),O=R?N?Su:Cl:N?wu:Pl;D[A]>w[A]&&(O=UM(O));var x=UM(O),F=[];if(a&&F.push(_[M]<=0),s&&F.push(_[O]<=0,_[x]<=0),F.every(function(z){return z})){C=P,U=!1;break}S.set(P,F)}if(U)for(var $=f?3:1,V=function(H){var K=b.find(function(q){var Y=S.get(q);if(Y)return Y.slice(0,H).every(function(Z){return Z})});if(K)return C=K,"break"},G=$;G>0;G--){var j=V(G);if(j==="break")break}e.placement!==C&&(e.modifiersData[n]._skip=!0,e.placement=C,e.reset=!0)}}const vKe={name:"flip",enabled:!0,phase:"main",fn:gKe,requiresIfExists:["offset"],data:{_skip:!1}};function h9(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function f9(t){return[Pl,Su,wu,Cl].some(function(e){return t[e]>=0})}function yKe(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,a=e.modifiersData.preventOverflow,o=eD(e,{elementContext:"reference"}),s=eD(e,{altBoundary:!0}),l=h9(o,n),c=h9(s,r,a),u=f9(l),d=f9(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const IKe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:yKe};function bKe(t,e,i){var n=lp(t),r=[Cl,Pl].indexOf(n)>=0?-1:1,a=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,o=a[0],s=a[1];return o=o||0,s=(s||0)*r,[Cl,Su].indexOf(n)>=0?{x:s,y:o}:{x:o,y:s}}function wKe(t){var e=t.state,i=t.options,n=t.name,r=i.offset,a=r===void 0?[0,0]:r,o=ywe.reduce(function(u,d){return u[d]=bKe(d,e.rects,a),u},{}),s=o[e.placement],l=s.x,c=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[n]=o}const SKe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:wKe};function TKe(t){var e=t.state,i=t.name;e.modifiersData[i]=Pwe({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const UKe={name:"popperOffsets",enabled:!0,phase:"read",fn:TKe,data:{}};function DKe(t){return t==="x"?"y":"x"}function PKe(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,a=r===void 0?!0:r,o=i.altAxis,s=o===void 0?!1:o,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,h=p===void 0?!0:p,f=i.tetherOffset,m=f===void 0?0:f,g=eD(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=lp(e.placement),y=Vw(e.placement),I=!y,b=h6(v),D=DKe(b),w=e.modifiersData.popperOffsets,S=e.rects.reference,U=e.rects.popper,C=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,E=typeof C=="number"?{mainAxis:C,altAxis:C}:Object.assign({mainAxis:0,altAxis:0},C),P=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,M={x:0,y:0};if(w){if(a){var N,R=b==="y"?Pl:Cl,A=b==="y"?wu:Su,_=b==="y"?"height":"width",O=w[b],x=O+g[R],F=O-g[A],$=h?-U[_]/2:0,V=y===Fw?S[_]:U[_],G=y===Fw?-U[_]:-S[_],j=e.elements.arrow,z=h&&j?p6(j):{width:0,height:0},H=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Swe(),K=H[R],q=H[A],Y=RT(0,S[_],z[_]),Z=I?S[_]/2-$-Y-K-E.mainAxis:V-Y-K-E.mainAxis,Q=I?-S[_]/2+$+Y+q+E.mainAxis:G+Y+q+E.mainAxis,ie=e.elements.arrow&&mE(e.elements.arrow),ue=ie?b==="y"?ie.clientTop||0:ie.clientLeft||0:0,J=(N=P==null?void 0:P[b])!=null?N:0,te=O+Z-J-ue,se=O+Q-J,ee=RT(h?MN(x,te):x,O,h?Vv(F,se):F);w[b]=ee,M[b]=ee-O}if(s){var ce,fe=b==="x"?Pl:Cl,ge=b==="x"?wu:Su,he=w[D],Se=D==="y"?"height":"width",Ce=he+g[fe],Fe=he-g[ge],Je=[Pl,Cl].indexOf(v)!==-1,xe=(ce=P==null?void 0:P[D])!=null?ce:0,st=Je?Ce:he-S[Se]-U[Se]-xe+E.altAxis,we=Je?he+S[Se]+U[Se]-xe-E.altAxis:Fe,Oe=h&&Je?Z7e(st,he,we):RT(h?st:Ce,he,h?we:Fe);w[D]=Oe,M[D]=Oe-he}e.modifiersData[n]=M}}const CKe={name:"preventOverflow",enabled:!0,phase:"main",fn:PKe,requiresIfExists:["offset"]};function EKe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function MKe(t){return t===kc(t)||!iu(t)?f6(t):EKe(t)}function RKe(t){var e=t.getBoundingClientRect(),i=$w(e.width)/t.offsetWidth||1,n=$w(e.height)/t.offsetHeight||1;return i!==1||n!==1}function NKe(t,e,i){i===void 0&&(i=!1);var n=iu(e),r=iu(e)&&RKe(e),a=Bg(e),o=Bw(t,r,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&((kp(e)!=="body"||g6(a))&&(s=MKe(e)),iu(e)?(l=Bw(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):a&&(l.x=m6(a))),{x:o.left+s.scrollLeft-l.x,y:o.top+s.scrollTop-l.y,width:o.width,height:o.height}}function AKe(t){var e=new Map,i=new Set,n=[];t.forEach(function(a){e.set(a.name,a)});function r(a){i.add(a.name);var o=[].concat(a.requires||[],a.requiresIfExists||[]);o.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&r(l)}}),n.push(a)}return t.forEach(function(a){i.has(a.name)||r(a)}),n}function _Ke(t){var e=AKe(t);return z7e.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function kKe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function OKe(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var m9={placement:"bottom",modifiers:[],strategy:"absolute"};function g9(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function xKe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,a=r===void 0?m9:r;return function(s,l,c){c===void 0&&(c=a);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},m9,a),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,h={state:u,setOptions:function(v){var y=typeof v=="function"?v(u.options):v;m(),u.options=Object.assign({},a,u.options,y),u.scrollParents={reference:Sy(s)?NT(s):s.contextElement?NT(s.contextElement):[],popper:NT(l)};var I=_Ke(OKe([].concat(n,u.options.modifiers)));return u.orderedModifiers=I.filter(function(b){return b.enabled}),f(),h.update()},forceUpdate:function(){if(!p){var v=u.elements,y=v.reference,I=v.popper;if(g9(y,I)){u.rects={reference:NKe(y,mE(I),u.options.strategy==="fixed"),popper:p6(I)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(E){return u.modifiersData[E.name]=Object.assign({},E.data)});for(var b=0;b<u.orderedModifiers.length;b++){if(u.reset===!0){u.reset=!1,b=-1;continue}var D=u.orderedModifiers[b],w=D.fn,S=D.options,U=S===void 0?{}:S,C=D.name;typeof w=="function"&&(u=w({state:u,options:U,name:C,instance:h})||u)}}}},update:kKe(function(){return new Promise(function(g){h.forceUpdate(),g(u)})}),destroy:function(){m(),p=!0}};if(!g9(s,l))return h;h.setOptions(c).then(function(g){!p&&c.onFirstUpdate&&c.onFirstUpdate(g)});function f(){u.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,I=y===void 0?{}:y,b=g.effect;if(typeof b=="function"){var D=b({state:u,name:v,instance:h,options:I}),w=function(){};d.push(D||w)}})}function m(){d.forEach(function(g){return g()}),d=[]}return h}}var LKe=[oKe,UKe,rKe,Iwe,SKe,vKe,CKe,eKe,IKe],FKe=xKe({defaultModifiers:LKe}),$Ke="tippy-box",Cwe="tippy-content",BKe="tippy-backdrop",Ewe="tippy-arrow",Mwe="tippy-svg-arrow",iv={passive:!0,capture:!0},Rwe=function(){return document.body};function iF(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function v6(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function Nwe(t,e){return typeof t=="function"?t.apply(void 0,e):t}function v9(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function VKe(t){return t.split(/\s+/).filter(Boolean)}function sb(t){return[].concat(t)}function y9(t,e){t.indexOf(e)===-1&&t.push(e)}function jKe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function GKe(t){return t.split("-")[0]}function RN(t){return[].slice.call(t)}function I9(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function AT(){return document.createElement("div")}function fx(t){return["Element","Fragment"].some(function(e){return v6(t,e)})}function HKe(t){return v6(t,"NodeList")}function zKe(t){return v6(t,"MouseEvent")}function WKe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function qKe(t){return fx(t)?[t]:HKe(t)?RN(t):Array.isArray(t)?t:RN(document.querySelectorAll(t))}function nF(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function b9(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function KKe(t){var e,i=sb(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function YKe(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var a=r.popperRect,o=r.popperState,s=r.props,l=s.interactiveBorder,c=GKe(o.placement),u=o.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,h=c==="right"?u.left.x:0,f=c==="left"?u.right.x:0,m=a.top-n+d>l,g=n-a.bottom-p>l,v=a.left-i+h>l,y=i-a.right-f>l;return m||g||v||y})}function rF(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function w9(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var zd={isTouch:!1},S9=0;function ZKe(){zd.isTouch||(zd.isTouch=!0,window.performance&&document.addEventListener("mousemove",Awe))}function Awe(){var t=performance.now();t-S9<20&&(zd.isTouch=!1,document.removeEventListener("mousemove",Awe)),S9=t}function XKe(){var t=document.activeElement;if(WKe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function JKe(){document.addEventListener("touchstart",ZKe,iv),window.addEventListener("blur",XKe)}var QKe=typeof window<"u"&&typeof document<"u",eYe=QKe?!!window.msCrypto:!1,tYe={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},iYe={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},zu=Object.assign({appendTo:Rwe,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},tYe,iYe),nYe=Object.keys(zu),rYe=function(e){var i=Object.keys(e);i.forEach(function(n){zu[n]=e[n]})};function _we(t){var e=t.plugins||[],i=e.reduce(function(n,r){var a=r.name,o=r.defaultValue;if(a){var s;n[a]=t[a]!==void 0?t[a]:(s=zu[a])!=null?s:o}return n},{});return Object.assign({},t,i)}function aYe(t,e){var i=e?Object.keys(_we(Object.assign({},zu,{plugins:e}))):nYe,n=i.reduce(function(r,a){var o=(t.getAttribute("data-tippy-"+a)||"").trim();if(!o)return r;if(a==="content")r[a]=o;else try{r[a]=JSON.parse(o)}catch{r[a]=o}return r},{});return n}function T9(t,e){var i=Object.assign({},e,{content:Nwe(e.content,[t])},e.ignoreAttributes?{}:aYe(t,e.plugins));return i.aria=Object.assign({},zu.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var oYe=function(){return"innerHTML"};function k2(t,e){t[oYe()]=e}function U9(t){var e=AT();return t===!0?e.className=Ewe:(e.className=Mwe,fx(t)?e.appendChild(t):k2(e,t)),e}function D9(t,e){fx(e.content)?(k2(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?k2(t,e.content):t.textContent=e.content)}function O2(t){var e=t.firstElementChild,i=RN(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(Cwe)}),arrow:i.find(function(n){return n.classList.contains(Ewe)||n.classList.contains(Mwe)}),backdrop:i.find(function(n){return n.classList.contains(BKe)})}}function kwe(t){var e=AT(),i=AT();i.className=$Ke,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=AT();n.className=Cwe,n.setAttribute("data-state","hidden"),D9(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(a,o){var s=O2(e),l=s.box,c=s.content,u=s.arrow;o.theme?l.setAttribute("data-theme",o.theme):l.removeAttribute("data-theme"),typeof o.animation=="string"?l.setAttribute("data-animation",o.animation):l.removeAttribute("data-animation"),o.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof o.maxWidth=="number"?o.maxWidth+"px":o.maxWidth,o.role?l.setAttribute("role",o.role):l.removeAttribute("role"),(a.content!==o.content||a.allowHTML!==o.allowHTML)&&D9(c,t.props),o.arrow?u?a.arrow!==o.arrow&&(l.removeChild(u),l.appendChild(U9(o.arrow))):l.appendChild(U9(o.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:r}}kwe.$$tippy=!0;var sYe=1,o1=[],aF=[];function lYe(t,e){var i=T9(t,Object.assign({},zu,_we(I9(e)))),n,r,a,o=!1,s=!1,l=!1,c=!1,u,d,p,h=[],f=v9(te,i.interactiveDebounce),m,g=sYe++,v=null,y=jKe(i.plugins),I={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},b={id:g,reference:t,popper:AT(),popperInstance:v,props:i,state:I,plugins:y,clearDelayTimeouts:st,setProps:we,setContent:Oe,show:ye,hide:Be,hideWithInteractivity:Ee,enable:Je,disable:xe,unmount:qe,destroy:Ge};if(!i.render)return b;var D=i.render(b),w=D.popper,S=D.onUpdate;w.setAttribute("data-tippy-root",""),w.id="tippy-"+b.id,b.popper=w,t._tippy=b,w._tippy=b;var U=y.map(function(me){return me.fn(b)}),C=t.hasAttribute("aria-expanded");return ie(),$(),O(),x("onCreate",[b]),i.showOnCreate&&Ce(),w.addEventListener("mouseenter",function(){b.props.interactive&&b.state.isVisible&&b.clearDelayTimeouts()}),w.addEventListener("mouseleave",function(){b.props.interactive&&b.props.trigger.indexOf("mouseenter")>=0&&R().addEventListener("mousemove",f)}),b;function E(){var me=b.props.touch;return Array.isArray(me)?me:[me,0]}function P(){return E()[0]==="hold"}function M(){var me;return!!((me=b.props.render)!=null&&me.$$tippy)}function N(){return m||t}function R(){var me=N().parentNode;return me?KKe(me):document}function A(){return O2(w)}function _(me){return b.state.isMounted&&!b.state.isVisible||zd.isTouch||u&&u.type==="focus"?0:iF(b.props.delay,me?0:1,zu.delay)}function O(me){me===void 0&&(me=!1),w.style.pointerEvents=b.props.interactive&&!me?"":"none",w.style.zIndex=""+b.props.zIndex}function x(me,Me,De){if(De===void 0&&(De=!0),U.forEach(function(ze){ze[me]&&ze[me].apply(ze,Me)}),De){var Ae;(Ae=b.props)[me].apply(Ae,Me)}}function F(){var me=b.props.aria;if(me.content){var Me="aria-"+me.content,De=w.id,Ae=sb(b.props.triggerTarget||t);Ae.forEach(function(ze){var de=ze.getAttribute(Me);if(b.state.isVisible)ze.setAttribute(Me,de?de+" "+De:De);else{var pe=de&&de.replace(De,"").trim();pe?ze.setAttribute(Me,pe):ze.removeAttribute(Me)}})}}function $(){if(!(C||!b.props.aria.expanded)){var me=sb(b.props.triggerTarget||t);me.forEach(function(Me){b.props.interactive?Me.setAttribute("aria-expanded",b.state.isVisible&&Me===N()?"true":"false"):Me.removeAttribute("aria-expanded")})}}function V(){R().removeEventListener("mousemove",f),o1=o1.filter(function(me){return me!==f})}function G(me){if(!(zd.isTouch&&(l||me.type==="mousedown"))){var Me=me.composedPath&&me.composedPath()[0]||me.target;if(!(b.props.interactive&&w9(w,Me))){if(sb(b.props.triggerTarget||t).some(function(De){return w9(De,Me)})){if(zd.isTouch||b.state.isVisible&&b.props.trigger.indexOf("click")>=0)return}else x("onClickOutside",[b,me]);b.props.hideOnClick===!0&&(b.clearDelayTimeouts(),b.hide(),s=!0,setTimeout(function(){s=!1}),b.state.isMounted||K())}}}function j(){l=!0}function z(){l=!1}function H(){var me=R();me.addEventListener("mousedown",G,!0),me.addEventListener("touchend",G,iv),me.addEventListener("touchstart",z,iv),me.addEventListener("touchmove",j,iv)}function K(){var me=R();me.removeEventListener("mousedown",G,!0),me.removeEventListener("touchend",G,iv),me.removeEventListener("touchstart",z,iv),me.removeEventListener("touchmove",j,iv)}function q(me,Me){Z(me,function(){!b.state.isVisible&&w.parentNode&&w.parentNode.contains(w)&&Me()})}function Y(me,Me){Z(me,Me)}function Z(me,Me){var De=A().box;function Ae(ze){ze.target===De&&(rF(De,"remove",Ae),Me())}if(me===0)return Me();rF(De,"remove",d),rF(De,"add",Ae),d=Ae}function Q(me,Me,De){De===void 0&&(De=!1);var Ae=sb(b.props.triggerTarget||t);Ae.forEach(function(ze){ze.addEventListener(me,Me,De),h.push({node:ze,eventType:me,handler:Me,options:De})})}function ie(){P()&&(Q("touchstart",J,{passive:!0}),Q("touchend",se,{passive:!0})),VKe(b.props.trigger).forEach(function(me){if(me!=="manual")switch(Q(me,J),me){case"mouseenter":Q("mouseleave",se);break;case"focus":Q(eYe?"focusout":"blur",ee);break;case"focusin":Q("focusout",ee);break}})}function ue(){h.forEach(function(me){var Me=me.node,De=me.eventType,Ae=me.handler,ze=me.options;Me.removeEventListener(De,Ae,ze)}),h=[]}function J(me){var Me,De=!1;if(!(!b.state.isEnabled||ce(me)||s)){var Ae=((Me=u)==null?void 0:Me.type)==="focus";u=me,m=me.currentTarget,$(),!b.state.isVisible&&zKe(me)&&o1.forEach(function(ze){return ze(me)}),me.type==="click"&&(b.props.trigger.indexOf("mouseenter")<0||o)&&b.props.hideOnClick!==!1&&b.state.isVisible?De=!0:Ce(me),me.type==="click"&&(o=!De),De&&!Ae&&Fe(me)}}function te(me){var Me=me.target,De=N().contains(Me)||w.contains(Me);if(!(me.type==="mousemove"&&De)){var Ae=Se().concat(w).map(function(ze){var de,pe=ze._tippy,ke=(de=pe.popperInstance)==null?void 0:de.state;return ke?{popperRect:ze.getBoundingClientRect(),popperState:ke,props:i}:null}).filter(Boolean);YKe(Ae,me)&&(V(),Fe(me))}}function se(me){var Me=ce(me)||b.props.trigger.indexOf("click")>=0&&o;if(!Me){if(b.props.interactive){b.hideWithInteractivity(me);return}Fe(me)}}function ee(me){b.props.trigger.indexOf("focusin")<0&&me.target!==N()||b.props.interactive&&me.relatedTarget&&w.contains(me.relatedTarget)||Fe(me)}function ce(me){return zd.isTouch?P()!==me.type.indexOf("touch")>=0:!1}function fe(){ge();var me=b.props,Me=me.popperOptions,De=me.placement,Ae=me.offset,ze=me.getReferenceClientRect,de=me.moveTransition,pe=M()?O2(w).arrow:null,ke=ze?{getBoundingClientRect:ze,contextElement:ze.contextElement||N()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(je){var Le=je.state;if(M()){var It=A(),zt=It.box;["placement","reference-hidden","escaped"].forEach(function(Jt){Jt==="placement"?zt.setAttribute("data-placement",Le.placement):Le.attributes.popper["data-popper-"+Jt]?zt.setAttribute("data-"+Jt,""):zt.removeAttribute("data-"+Jt)}),Le.attributes.popper={}}}},Te=[{name:"offset",options:{offset:Ae}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!de}},Ue];M()&&pe&&Te.push({name:"arrow",options:{element:pe,padding:3}}),Te.push.apply(Te,(Me==null?void 0:Me.modifiers)||[]),b.popperInstance=FKe(ke,w,Object.assign({},Me,{placement:De,onFirstUpdate:p,modifiers:Te}))}function ge(){b.popperInstance&&(b.popperInstance.destroy(),b.popperInstance=null)}function he(){var me=b.props.appendTo,Me,De=N();b.props.interactive&&me===Rwe||me==="parent"?Me=De.parentNode:Me=Nwe(me,[De]),Me.contains(w)||Me.appendChild(w),b.state.isMounted=!0,fe()}function Se(){return RN(w.querySelectorAll("[data-tippy-root]"))}function Ce(me){b.clearDelayTimeouts(),me&&x("onTrigger",[b,me]),H();var Me=_(!0),De=E(),Ae=De[0],ze=De[1];zd.isTouch&&Ae==="hold"&&ze&&(Me=ze),Me?n=setTimeout(function(){b.show()},Me):b.show()}function Fe(me){if(b.clearDelayTimeouts(),x("onUntrigger",[b,me]),!b.state.isVisible){K();return}if(!(b.props.trigger.indexOf("mouseenter")>=0&&b.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(me.type)>=0&&o)){var Me=_(!1);Me?r=setTimeout(function(){b.state.isVisible&&b.hide()},Me):a=requestAnimationFrame(function(){b.hide()})}}function Je(){b.state.isEnabled=!0}function xe(){b.hide(),b.state.isEnabled=!1}function st(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(a)}function we(me){if(!b.state.isDestroyed){x("onBeforeUpdate",[b,me]),ue();var Me=b.props,De=T9(t,Object.assign({},Me,I9(me),{ignoreAttributes:!0}));b.props=De,ie(),Me.interactiveDebounce!==De.interactiveDebounce&&(V(),f=v9(te,De.interactiveDebounce)),Me.triggerTarget&&!De.triggerTarget?sb(Me.triggerTarget).forEach(function(Ae){Ae.removeAttribute("aria-expanded")}):De.triggerTarget&&t.removeAttribute("aria-expanded"),$(),O(),S&&S(Me,De),b.popperInstance&&(fe(),Se().forEach(function(Ae){requestAnimationFrame(Ae._tippy.popperInstance.forceUpdate)})),x("onAfterUpdate",[b,me])}}function Oe(me){b.setProps({content:me})}function ye(){var me=b.state.isVisible,Me=b.state.isDestroyed,De=!b.state.isEnabled,Ae=zd.isTouch&&!b.props.touch,ze=iF(b.props.duration,0,zu.duration);if(!(me||Me||De||Ae)&&!N().hasAttribute("disabled")&&(x("onShow",[b],!1),b.props.onShow(b)!==!1)){if(b.state.isVisible=!0,M()&&(w.style.visibility="visible"),O(),H(),b.state.isMounted||(w.style.transition="none"),M()){var de=A(),pe=de.box,ke=de.content;nF([pe,ke],0)}p=function(){var Te;if(!(!b.state.isVisible||c)){if(c=!0,w.offsetHeight,w.style.transition=b.props.moveTransition,M()&&b.props.animation){var rt=A(),je=rt.box,Le=rt.content;nF([je,Le],ze),b9([je,Le],"visible")}F(),$(),y9(aF,b),(Te=b.popperInstance)==null||Te.forceUpdate(),x("onMount",[b]),b.props.animation&&M()&&Y(ze,function(){b.state.isShown=!0,x("onShown",[b])})}},he()}}function Be(){var me=!b.state.isVisible,Me=b.state.isDestroyed,De=!b.state.isEnabled,Ae=iF(b.props.duration,1,zu.duration);if(!(me||Me||De)&&(x("onHide",[b],!1),b.props.onHide(b)!==!1)){if(b.state.isVisible=!1,b.state.isShown=!1,c=!1,o=!1,M()&&(w.style.visibility="hidden"),V(),K(),O(!0),M()){var ze=A(),de=ze.box,pe=ze.content;b.props.animation&&(nF([de,pe],Ae),b9([de,pe],"hidden"))}F(),$(),b.props.animation?M()&&q(Ae,b.unmount):b.unmount()}}function Ee(me){R().addEventListener("mousemove",f),y9(o1,f),f(me)}function qe(){b.state.isVisible&&b.hide(),b.state.isMounted&&(ge(),Se().forEach(function(me){me._tippy.unmount()}),w.parentNode&&w.parentNode.removeChild(w),aF=aF.filter(function(me){return me!==b}),b.state.isMounted=!1,x("onHidden",[b]))}function Ge(){b.state.isDestroyed||(b.clearDelayTimeouts(),b.unmount(),ue(),delete t._tippy,b.state.isDestroyed=!0,x("onDestroy",[b]))}}function pf(t,e){e===void 0&&(e={});var i=zu.plugins.concat(e.plugins||[]);JKe();var n=Object.assign({},e,{plugins:i}),r=qKe(t),a=r.reduce(function(o,s){var l=s&&lYe(s,n);return l&&o.push(l),o},[]);return fx(t)?a[0]:a}pf.defaultProps=zu;pf.setDefaultProps=rYe;pf.currentInput=zd;Object.assign({},Iwe,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});pf.setDefaultProps({render:kwe});function P9(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===vt?e.style="margin-left: 1em":e.style="margin-right: 1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&pf(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=ct),e}const y6=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":tw;const i=(n,r,a)=>{const o=t.getElementsByClassName(`options_${n}`)[0];o&&(o.style.display=e!=null&&e.length?r:a)};i(dr,jE,ct),i(Et,ct,jE),i(At,ct,jE),i(vt,ct,jE)};function ho({table:t,target:e,targetClassName:i,items:n=[],onSelection:r}){var g;const a=!!e;if(e=e||i&&((g=document.getElementsByClassName(i))==null?void 0:g[0]),!e)return;let o=0,s=0;const l={},c={};let u;if(a){lo(e);const v=cYe();Object.assign(l,v.elements),e.appendChild(v.anchor)}const d=Object.assign({},...[dr,Et,At,vt,PR].map(v=>{var I;const y=(I=e.getElementsByClassName(`options_${v}`))==null?void 0:I[0];return lo(y),{[v]:y}}).filter(Boolean)),p=y6({table:t,target:e}),h=(v,y)=>{pt(y.onClick)&&(v.stopPropagation(),!y.disabled&&y.onClick(v,t),y.stateChange&&p())},f={onClick:()=>{},location:vt};for(const v of n){const y={...f};ru(v)&&Object.assign(y,v);const I=d[y.location];if(!I){console.log(y.location,d);continue}if(y.location===dr&&(o+=1),y.location===PR){if(pt(y.headerClick)){const b=e.getElementsByClassName("panelHeader")[0];b&&(b.onclick=y.headerClick)}s+=1}if(!y.hide&&(y.input||y.placeholder||y.search)){const b=document.createElement("p");b.style="margin-right: 1em",b.className=`control ${y.search?"has-icons-left has-icons-right":""}`;const D=document.createElement("input");if(y.focus&&(u=D),D.className="input font-medium",D.setAttribute("type","text"),D.setAttribute("autocomplete","cc-number"),D.setAttribute("placeholder",v.placeholder||tw),y.id&&(c[y.id]=D),y.id&&D.setAttribute("id",y.id),y.onKeyDown&&D.addEventListener("keydown",w=>y.onKeyDown(w,y)),y.onChange&&D.addEventListener("change",w=>y.onChange(w,y)),y.onKeyUp&&D.addEventListener("keyup",w=>{y.clearSearch&&w.key==="Escape"&&(w.stopPropagation(),D.value="",y.clearSearch()),y.onKeyUp(w,y)}),y.class&&D.classList.add(y.class),y.visible===!1&&(b.style.display=ct),y.value&&(D.value=y.value),b.appendChild(D),y.search){const w=document.createElement("span");if(w.className="icon is-small is-left font-medium",w.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',b.appendChild(w),pt(y.clearSearch)){const S=document.createElement("span");S.className="icon is-small is-right font-medium",S.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',S.onclick=U=>{U.stopPropagation(),D.value="",y.clearSearch()},b.appendChild(S)}}if(v.validator){const w=document.createElement("p");w.className="help font-medium",b.appendChild(w),D.addEventListener("input",S=>Vbe(v,S,D,w,v.validator))}y.id&&(l[y.id]=b,b.id=y.id),I==null||I.appendChild(b);continue}if(!y.hide&&y.text){const b=document.createElement("div");b.className="font-medium",y.id&&(l[y.id]=b,b.id=y.id),b.innerHTML=y.text,b.onclick=D=>h(D,y),I==null||I.appendChild(b);continue}if(!(!y.id&&(!(y!=null&&y.label)||y.hide))){if(y.options){const b=M2({target:I,button:y,stateChange:p});y.visible===!1&&(b.style.display=ct),y.id&&(l[y.id]=b)}else if(ru(y.selection)){const{selection:{options:b,actions:D},actionPlacement:w,threshold:S=8,...U}=y;if((b==null?void 0:b.length)<S){b.length&&(w===XK?b.unshift({divider:!0}):b.push({divider:!0})),D.forEach(P=>{const{label:M,...N}=P,R={...N,label:`<p style="font-weight: bold">${M}</p>`};w===XK?b.unshift(R):b.push(R)});const C={...U,options:b},E=M2({target:I,button:C,stateChange:p});C.visible===!1&&(E.style.display=ct),C.id&&(l[y.id]=E)}else{const C=P9(y);C.onclick=E=>{E.stopPropagation(),gwe({title:"Select team",options:b})},y.id&&(l[y.id]=C),I==null||I.appendChild(C)}}else{const b=P9(y);b.onclick=D=>h(D,y),y.id&&(l[y.id]=b),I==null||I.appendChild(b)}(!(y!=null&&y.label)||y.hide)&&(l[y.id].style.display=ct)}}const m=e.getElementsByClassName("panelHeader")[0];return m&&(m.style.display=s?tw:ct),t==null||t.on("rowSelectionChanged",(v,y)=>{pt(r)&&r(y),o&&p(y)}),p(),u&&setTimeout(()=>u.focus(),200),{elements:l,inputs:c}}function cYe(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=ct,t.appendChild(e);const i=document.createElement("div");i.className=tce,i.style="flex-wrap: wrap-reverse;";const n={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};n.optionsOverlay.className="options_overlay",n.optionsCenter.className="options_center",n.optionsRight.className="options_right",n.optionsLeft.className="options_left";for(const r of Object.values(n))i.appendChild(r);return t.appendChild(i),{elements:n,anchor:t,header:e}}const{FIRST_MATCH_LOSER_CONSOLATION:uYe,COMPASS:dYe,ROUND_ROBIN:pYe}=tr,{MALE:hYe,FEMALE:fYe}=mo.genderConstants,{DOUBLES:C9}=mo.eventConstants,{WTN:s1}=mo.ratingConstants;function mYe(t){const e=t.getData().map(n=>n.tournamentId),i=gYe();for(const n of i)ix({tournamentRecord:n,tournamentIds:e,table:t});return{..._P}}function gYe(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},tournamentName:"CourtHive Challenge",participantsProfile:{scaledParticipantsCount:200},drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventType:C9,gender:hYe,seedsCount:4,drawSize:16},{drawType:uYe,category:{categoryName:"U16"},eventName:"U16 Girls Singles",gender:fYe,seedsCount:8,drawSize:32},{category:{ratingType:s1,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,seedsCount:8,drawSize:32},{category:{ratingType:s1,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventType:C9,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:s1,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,drawType:dYe,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:s1,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:pYe,seedsCount:4,drawSize:16}],venueProfiles:e}].map(n=>ik.generateTournamentRecord(n).tournamentRecord)}function vYe(t){var s;const e=Bc(),i=(s=e==null?void 0:e.roles)==null?void 0:s.includes(rk),n=[{label:"Create new tournament",onClick:()=>k5e({table:t})},{label:"Import tournament",onClick:()=>Pqe(t)},i&&{label:"Load by ID",onClick:()=>O5e({table:t})},{divider:!0},{divider:!0},{label:"Example Tournaments",onClick:()=>mYe(t),close:!0}].filter(Boolean),r=UI(t),a=[{label:"Actions",options:n,align:vt},{onKeyDown:l=>l.keyCode===8&&l.target.value.length===1&&r(""),onChange:l=>r(l.target.value),onKeyUp:l=>r(l.target.value),clearSearch:()=>r(""),placeholder:"Search tournaments",location:Et,search:!0}],o=document.getElementById(ece);ho({target:o,items:a})}function yYe(t){const e=document.createElement("span"),i=document.createElement("table"),n=t.getValue();i.style.width="400px";const r="4em",a=document.createElement("tr"),o=n.tournamentImageURL?`<img src='${n.tournamentImageURL}' style='width: ${r}' alt=''>`:"",s=`<td style='min-width: ${r}'>${o}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${n.tournamentName}</strong></div><div style='margin-left: 1em'>${n.startDate} / ${n.endDate}</div></td>`;return a.innerHTML=s,i.appendChild(a),e.appendChild(i),e}function IYe({providerId:t,tournamentId:e}){const i=()=>Ye.router.navigate(`/tournaments/${e}`),n=r=>{r&&(r.calendar=r.calendar.filter(a=>a.tournamentId!==e),Gs.addProvider(r).then(i))};Gs.findProvider(t).then(n)}function Owe(t,e,i){if(!t)return;const n=document.createElement("aside");n.classList.add("menu");const r={},a=d=>i&&d.close!==!1?p=>{p.stopPropagation(),i(),d.onClick()}:p=>{p.stopPropagation(),d.onClick()};let o=0;const s=()=>(o+=1,o),l=d=>(d==null?void 0:d.heading)||(d==null?void 0:d.text)||(d==null?void 0:d.label)||`Item ${s()}`,c=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style=d.style),d.onClick){const h=d.fontSize||"1em";if(d.divider){const f=document.createElement("hr");f.classList.add("dropdown-divider"),p.appendChild(f)}else{const f=document.createElement("a"),m=d.disabled?"0.4":"1";f.style=`text-decoration: none; opacity: ${m}; font-size: ${h}`,d.class&&f.classList.add(d.class),d.color&&(f.style.color=d.color),d.heading&&(f.style.fontWeight="bold"),d.disabled||(f.onclick=a(d)),f.innerHTML=l(d),p.appendChild(f)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let u;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const h=document.createElement("p");h.className="menu-label font-medium",h.innerHTML=d.text,n.appendChild(h)}const p=document.createElement("ul");p.className="menu-list";for(const h of d.items)h.hide||p.appendChild(c(h));n.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:h}=MT(d);d.focus&&(u=h),r[d.field]=h,n.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),n.appendChild(p)}}return t.appendChild(n),{focusElement:u}}let Kd;function vc(t){Kd&&(Kd==null||Kd.destroy(!0),Kd=void 0),t!=null&&t.remove&&t.remove()}function nl({title:t,options:e,items:i,menuItems:n=[],target:r,coords:a,callback:o,config:s}){var u;if(!(e!=null&&e.length)&&!(i!=null&&i.length)&&!n)return;vc();const l=document.createElement("div"),c=()=>{i=(i==null?void 0:i.filter(h=>!h.hide&&!h.disabled).map(h=>({...h,onClick:()=>{vc(l),typeof h.onClick=="function"&&h.onClick()}})))||(e==null?void 0:e.filter(h=>!h.hide&&!h.disabled).map(h=>({text:typeof h=="object"?h.option:h,style:h.style,onClick:()=>{h.subMenu?Kd.setContent("IMPLEMENT SUB MENU"):typeof h.onClick=="function"?(vc(l),h.onClick()):typeof o=="function"&&(vc(l),o(typeof h=="object"?{...h,coords:a}:h))}})));const d=[{text:t,items:i},...n],{focusElement:p}=Owe(l,d);return p&&p.focus(),l};return r=r||((u=a==null?void 0:a.evt)==null?void 0:u.target),r&&(Kd=pf(r,{content:c,theme:"light-border",trigger:"click",...s}),Kd.show(),Kd.setProps({interactive:!0})),Kd}function bYe(t){const e=document.createElement("span");e.style.width="100%";const i=t.getValue(),n=()=>{Gs.deleteTournament(i).then(s,l=>console.log(l));function s(){var u;t.getRow().delete();const c=(u=Bc())==null?void 0:u.providerId;c&&IYe({tournamentId:i,providerId:c})}},r=()=>{const c=`<div style='font-size: 2em'>${t.getTable().getData().find(d=>d.tournamentId===i).tournament.tournamentName} will be deleted!</div>`,u=[{onClick:n,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];ir({title:Nr.tr("actions.delete_tournament"),buttons:u,content:c})},a=()=>{console.log("tournament Edit");const s=l=>{console.log("edit:",{tournamentRecord:l})};Gs.findTournament(i).then(s,l=>console.log(l))},o=document.createElement("span");return o.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",e.onclick=s=>{s.stopPropagation(),nl({target:o,items:[{text:"Delete",onClick:r},{text:"Edit",onClick:a}],config:{placement:Ef}})},e.appendChild(o),e}function wYe(){const t=(e,i)=>{const n=i.getRow().getData().tournamentId;if(n){$e.reset();const r=`/${xa}/${n}`;Ye.router.navigate(r)}};return[{formatter:"responsiveCollapse",hozAlign:At,headerSort:!1,resizable:!1,minWidth:50,width:50},{formatter:yYe,cellClick:t,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{title:"Open",vertAlign:"middle",formatter:()=>'<div class="button font-medium">Open</div>',cellClick:t,width:90},{formatter:bYe,field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:vt,width:10}]}function oh({anchorId:t}){const e=na.findTable(`#${t}`)[0];e&&e.destroy()}function mx(){var t;if(Ye.tables)for(const e of Object.keys(Ye.tables))(t=Ye.tables[e])==null||t.destroy(),delete Ye.tables[e];for(;(Ye.collectionTables||[]).length;)Ye.collectionTables.pop().destroy()}function xwe(){const t=d=>console.log("db Error",{error:d});let e,i;const n=()=>{setTimeout(()=>{const p=h=>e.replaceData(h.map(hN));Gs.findAllTournaments().then(p,t)},i?0:1e3)},r=wYe(),a=d=>{oh({anchorId:H$});const p=document.getElementById(H$);e=new na(p,{responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,placeholder:"No tournaments",responsiveLayout:"collapse",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:d,columns:r}),e.on("scrollVertical",vc),e.on("tableBuilt",()=>{vYe(e),i=!0})},o=d=>{d.sort((p,h)=>new Date(h.startDate||h.start)-new Date(p.startDate||p.start)),a(d.map(hN))},s=d=>{d.sort((p,h)=>new Date(h.tournament.startDate)-new Date(p.tournament.startDate)),a(d)},l=Bc(),c=(l==null?void 0:l.provider)||(Ye==null?void 0:Ye.provider),u=()=>Gs.findAllTournaments().then(o,t);if(c!=null&&c.organisationAbbreviation){const d=p=>{var h;(h=p==null?void 0:p.data)!=null&&h.calendar?s(p.data.calendar.tournaments):u()};K4e({providerAbbr:c.organisationAbbreviation}).then(d)}else u();return{table:e,replaceTableData:n}}const NN=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{const n="&puid, hash, cuid, &id, [last_name+first_name], last_name, birthdate",r="&muid, *puids, format, date, tournament.category, tournament.tuid",a="[puid+tuid+format+round], puid, tuid, muid, date",o="&tuid, name, start, end, category, cuid",s="&hash, date, type",l="&uuid, name",c="[hash+ioc]",u="&uuid, name",d="category",p="&id, &code",h="&alias",f="key",m="ioc",g={calculations:s,clubs:p,idioms:m,matches:r,players:n,points:a,rankings:d,settings:f,tournaments:o};t.db=new op("CourtHiveTournaments",{autoOpen:!1}),t.db.version(1).stores({aliases:h,ignored:c,...g}),t.db.version(2).stores({aliases:h,ignored:c,...g,idioms:m}),t.db.version(3).stores({teams:u,themes:l,idioms:m,...g}),t.db.open().then(e,i)}),t.resetDB=e=>{t.db.close(),op.delete("CourtHiveTournaments").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{let r=t.db[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findWhere=(e,i,n)=>new Promise((r,a)=>t.db[e].where(i).equals(n).toArray(r,a).catch(a)),t.deleteTournament=e=>new Promise((i,n)=>{t.db.tournaments.where("tuid").equals(e).delete().then(r,n);function r(){t.deleteTournamentMatches(e).then(a,n)}function a(){t.deleteTournamentPoints(e).then(i,n)}}),t.deleteAllTournamentAttr=e=>t.db.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,a)=>t.findWhere(e,i,n).then(o=>r(o&&o.length?o[0]:void 0),a)),t.findTournament=e=>t.findUnique("tournaments","tuid",e),t.addItem=(e,i)=>new Promise((n,r)=>t.db[e].put(i).then(n,r).catch(a=>{alert("try again:",a),r(a)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.db[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return a("exists");t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tuid",e.tuid,e),t.replaceOrAddUnique=(e,i,n,r)=>new Promise((a,o)=>{t.db[e].where(i).equals(n).delete().then(()=>{t.addItem(e,r).then(a,o)},s=>{console.log({err:s}),o(s)})}),t.modify=(e,i,n,r,a)=>new Promise((o,s)=>{t.db[e].where(i).equals(n).modify(l=>{Object.assign(a,{item:l}),r(a)}).then(o,l=>{console.log("error:",l),s()})}),t}(),Lwe="leaveTournament",SYe="providerCalendar",TYe="processDirective",UYe="tmxDirective",DYe="tmxMessage",PYe="add idiom";function Fwe(t){const e=vW({data:t}),{directive:i,content:n}=e||{};i&&(i===SYe&&n.calendar&&ai({action:{onClick:()=>CYe({providerId:n.providerId,calendar:n.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&Ye.ee.emit("sendKey",i.subKey),i===PYe&&n&&(Nr.define(n),NN.addIdiom(n).then(r,a=>console.log("error:",a))));function r(){Ye.ee.emit("changeIdiom",{ioc:n.ioc})}}function CYe({providerId:t,calendar:e}){const i=()=>xwe();t&&e&&Gs.addProvider({providerId:t,calendar:e}).then(i)}const I6="@VERSION@",Op=Object.create(null);Op.open="0";Op.close="1";Op.ping="2";Op.pong="3";Op.message="4";Op.upgrade="5";Op.noop="6";const DM=Object.create(null);Object.keys(Op).forEach(t=>{DM[Op[t]]=t});const x2={type:"error",data:"parser error"},$we=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Bwe=typeof ArrayBuffer=="function",Vwe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,b6=({type:t,data:e},i,n)=>$we&&e instanceof Blob?i?n(e):E9(e,n):Bwe&&(e instanceof ArrayBuffer||Vwe(e))?i?n(e):E9(new Blob([e]),n):n(Op[t]+(e||"")),E9=(t,e)=>{const i=new FileReader;return i.onload=function(){const n=i.result.split(",")[1];e("b"+(n||""))},i.readAsDataURL(t)};function M9(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let oF;function EYe(t,e){if($we&&t.data instanceof Blob)return t.data.arrayBuffer().then(M9).then(e);if(Bwe&&(t.data instanceof ArrayBuffer||Vwe(t.data)))return e(M9(t.data));b6(t,!1,i=>{oF||(oF=new TextEncoder),e(oF.encode(i))})}const R9="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",ZS=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<R9.length;t++)ZS[R9.charCodeAt(t)]=t;const MYe=t=>{let e=t.length*.75,i=t.length,n,r=0,a,o,s,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(n=0;n<i;n+=4)a=ZS[t.charCodeAt(n)],o=ZS[t.charCodeAt(n+1)],s=ZS[t.charCodeAt(n+2)],l=ZS[t.charCodeAt(n+3)],u[r++]=a<<2|o>>4,u[r++]=(o&15)<<4|s>>2,u[r++]=(s&3)<<6|l&63;return c},RYe=typeof ArrayBuffer=="function",w6=(t,e)=>{if(typeof t!="string")return{type:"message",data:jwe(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:NYe(t.substring(1),e)}:DM[i]?t.length>1?{type:DM[i],data:t.substring(1)}:{type:DM[i]}:x2},NYe=(t,e)=>{if(RYe){const i=MYe(t);return jwe(i,e)}else return{base64:!0,data:t}},jwe=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},Gwe="",AYe=(t,e)=>{const i=t.length,n=new Array(i);let r=0;t.forEach((a,o)=>{b6(a,!1,s=>{n[o]=s,++r===i&&e(n.join(Gwe))})})},_Ye=(t,e)=>{const i=t.split(Gwe),n=[];for(let r=0;r<i.length;r++){const a=w6(i[r],e);if(n.push(a),a.type==="error")break}return n};function kYe(){return new TransformStream({transform(t,e){EYe(t,i=>{const n=i.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(i)})}})}let sF;function l1(t){return t.reduce((e,i)=>e+i.length,0)}function c1(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let n=0;for(let r=0;r<e;r++)i[r]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function OYe(t,e){sF||(sF=new TextDecoder);const i=[];let n=0,r=-1,a=!1;return new TransformStream({transform(o,s){for(i.push(o);;){if(n===0){if(l1(i)<1)break;const l=c1(i,1);a=(l[0]&128)===128,r=l[0]&127,r<126?n=3:r===126?n=1:n=2}else if(n===1){if(l1(i)<2)break;const l=c1(i,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(l1(i)<8)break;const l=c1(i,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,21)-1){s.enqueue(x2);break}r=u*Math.pow(2,32)+c.getUint32(4),n=3}else{if(l1(i)<r)break;const l=c1(i,r);s.enqueue(w6(a?l:sF.decode(l),e)),n=0}if(r===0||r>t){s.enqueue(x2);break}}}})}const Hwe=4;function $a(t){if(t)return xYe(t)}function xYe(t){for(var e in $a.prototype)t[e]=$a.prototype[e];return t}$a.prototype.on=$a.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};$a.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};$a.prototype.off=$a.prototype.removeListener=$a.prototype.removeAllListeners=$a.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+t],this};$a.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n)i[n].apply(this,e)}return this};$a.prototype.emitReserved=$a.prototype.emit;$a.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};$a.prototype.hasListeners=function(t){return!!this.listeners(t).length};const Wc=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function zwe(t,...e){return e.reduce((i,n)=>(t.hasOwnProperty(n)&&(i[n]=t[n]),i),{})}const LYe=Wc.setTimeout,FYe=Wc.clearTimeout;function gx(t,e){e.useNativeTimers?(t.setTimeoutFn=LYe.bind(Wc),t.clearTimeoutFn=FYe.bind(Wc)):(t.setTimeoutFn=Wc.setTimeout.bind(Wc),t.clearTimeoutFn=Wc.clearTimeout.bind(Wc))}const $Ye=1.33;function BYe(t){return typeof t=="string"?VYe(t):Math.ceil((t.byteLength||t.size)*$Ye)}function VYe(t){let e=0,i=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}function jYe(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function GYe(t){let e={},i=t.split("&");for(let n=0,r=i.length;n<r;n++){let a=i[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class HYe extends Error{constructor(e,i,n){super(e),this.description=i,this.context=n,this.type="TransportError"}}class S6 extends $a{constructor(e){super(),this.writable=!1,gx(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,i,n){return super.emitReserved("error",new HYe(e,i,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=w6(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=jYe(e);return i.length?"?"+i:""}}const Wwe="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),L2=64,zYe={};let N9=0,u1=0,A9;function _9(t){let e="";do e=Wwe[t%L2]+e,t=Math.floor(t/L2);while(t>0);return e}function qwe(){const t=_9(+new Date);return t!==A9?(N9=0,A9=t):t+"."+_9(N9++)}for(;u1<L2;u1++)zYe[Wwe[u1]]=u1;let Kwe=!1;try{Kwe=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const WYe=Kwe;function Ywe(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||WYe))return new XMLHttpRequest}catch{}if(!e)try{return new Wc[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function qYe(){}const KYe=function(){return new Ywe({xdomain:!1}).responseType!=null}();class YYe extends S6{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}const i=e&&e.forceBase64;this.supportsBinary=KYe&&!i,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||i()})),this.writable||(n++,this.once("drain",function(){--n||i()}))}else i()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};_Ye(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,AYe(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=qwe()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new cp(this.uri(),e)}doWrite(e,i){const n=this.request({method:"POST",data:e});n.on("success",i),n.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,n)=>{this.onError("xhr poll error",i,n)}),this.pollXhr=e}}class cp extends $a{constructor(e,i){super(),gx(this,i),this.opts=i,this.method=i.method||"GET",this.uri=e,this.data=i.data!==void 0?i.data:null,this.create()}create(){var e;const i=zwe(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const n=this.xhr=new Ywe(i);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var r;n.readyState===3&&((r=this.opts.cookieJar)===null||r===void 0||r.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=cp.requestsCount++,cp.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=qYe,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete cp.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}cp.requestsCount=0;cp.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",k9);else if(typeof addEventListener=="function"){const t="onpagehide"in Wc?"pagehide":"unload";addEventListener(t,k9,!1)}}function k9(){for(let t in cp.requests)cp.requests.hasOwnProperty(t)&&cp.requests[t].abort()}const T6=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),d1=Wc.WebSocket||Wc.MozWebSocket,O9=!0,ZYe="arraybuffer",x9=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class XYe extends S6{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),i=this.opts.protocols,n=x9?{}:zwe(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=O9&&!x9?i?new d1(e,i):new d1(e):new d1(e,i,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;b6(n,this.supportsBinary,a=>{const o={};try{O9&&this.ws.send(a)}catch{}r&&T6(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=qwe()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}check(){return!!d1}}class JYe extends S6{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const i=OYe(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(i).getReader(),r=kYe();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const a=()=>{n.read().then(({done:s,value:l})=>{s||(this.onPacket(l),a())}).catch(s=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this.writer.write(o).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;this.writer.write(n).then(()=>{r&&T6(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const QYe={websocket:XYe,webtransport:JYe,polling:YYe},e8e=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,t8e=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function F2(t){if(t.length>2e3)throw"URI too long";const e=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let r=e8e.exec(t||""),a={},o=14;for(;o--;)a[t8e[o]]=r[o]||"";return i!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=i8e(a,a.path),a.queryKey=n8e(a,a.query),a}function i8e(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function n8e(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,a){r&&(i[r]=a)}),i}let Zwe=class lb extends $a{constructor(e,i={}){super(),this.binaryType=ZYe,this.writeBuffer=[],e&&typeof e=="object"&&(i=e,e=null),e?(e=F2(e),i.hostname=e.host,i.secure=e.protocol==="https"||e.protocol==="wss",i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=F2(i.host).host),gx(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=GYe(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=Hwe,i.transport=e,this.id&&(i.sid=this.id);const n=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new QYe[e](n)}open(){let e;if(this.opts.rememberUpgrade&&lb.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(e){let i=this.createTransport(e),n=!1;lb.priorWebsocketSuccess=!1;const r=()=>{n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;lb.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(u(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function a(){n||(n=!0,u(),i.close(),i=null)}const o=d=>{const p=new Error("probe error: "+d);p.transport=i.name,a(),this.emitReserved("upgradeError",p)};function s(){o("transport closed")}function l(){o("socket closed")}function c(d){i&&d.name!==i.name&&a()}const u=()=>{i.removeListener("open",r),i.removeListener("error",o),i.removeListener("close",s),this.off("close",l),this.off("upgrading",c)};i.once("open",r),i.once("error",o),i.once("close",s),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||i.open()},200):i.open()}onOpen(){if(this.readyState="open",lb.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const i=this.upgrades.length;for(;e<i;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=e.data,this.onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(i+=BYe(r)),n>0&&i>this.maxPayload)return this.writeBuffer.slice(0,n);i+=2}return this.writeBuffer}write(e,i,n){return this.sendPacket("message",e,i,n),this}send(e,i,n){return this.sendPacket("message",e,i,n),this}sendPacket(e,i,n,r){if(typeof i=="function"&&(r=i,i=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:i,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},n=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){lb.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,i){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const i=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&i.push(e[n]);return i}};Zwe.protocol=Hwe;function r8e(t,e="",i){let n=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),n=F2(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(i&&i.port===n.port?"":":"+n.port),n}const a8e=typeof ArrayBuffer=="function",o8e=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Xwe=Object.prototype.toString,s8e=typeof Blob=="function"||typeof Blob<"u"&&Xwe.call(Blob)==="[object BlobConstructor]",l8e=typeof File=="function"||typeof File<"u"&&Xwe.call(File)==="[object FileConstructor]";function U6(t){return a8e&&(t instanceof ArrayBuffer||o8e(t))||s8e&&t instanceof Blob||l8e&&t instanceof File}function PM(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,n=t.length;i<n;i++)if(PM(t[i]))return!0;return!1}if(U6(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return PM(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&PM(t[i]))return!0;return!1}function c8e(t){const e=[],i=t.data,n=t;return n.data=$2(i,e),n.attachments=e.length,{packet:n,buffers:e}}function $2(t,e){if(!t)return t;if(U6(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=$2(t[n],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=$2(t[n],e));return i}return t}function u8e(t,e){return t.data=B2(t.data,e),delete t.attachments,t}function B2(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=B2(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=B2(t[i],e));return t}const d8e=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],p8e=5;var pn;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(pn||(pn={}));class h8e{constructor(e){this.replacer=e}encode(e){return(e.type===pn.EVENT||e.type===pn.ACK)&&PM(e)?this.encodeAsBinary({type:e.type===pn.EVENT?pn.BINARY_EVENT:pn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===pn.BINARY_EVENT||e.type===pn.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=c8e(e),n=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(n),r}}function L9(t){return Object.prototype.toString.call(t)==="[object Object]"}class D6 extends $a{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const n=i.type===pn.BINARY_EVENT;n||i.type===pn.BINARY_ACK?(i.type=n?pn.EVENT:pn.ACK,this.reconstructor=new f8e(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(U6(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const n={type:Number(e.charAt(0))};if(pn[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===pn.BINARY_EVENT||n.type===pn.BINARY_ACK){const a=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const o=e.substring(a,i);if(o!=Number(o)||e.charAt(i)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(i+1)==="/"){const a=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););n.nsp=e.substring(a,i)}else n.nsp="/";const r=e.charAt(i+1);if(r!==""&&Number(r)==r){const a=i+1;for(;++i;){const o=e.charAt(i);if(o==null||Number(o)!=o){--i;break}if(i===e.length)break}n.id=Number(e.substring(a,i+1))}if(e.charAt(++i)){const a=this.tryParse(e.substr(i));if(D6.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case pn.CONNECT:return L9(i);case pn.DISCONNECT:return i===void 0;case pn.CONNECT_ERROR:return typeof i=="string"||L9(i);case pn.EVENT:case pn.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&d8e.indexOf(i[0])===-1);case pn.ACK:case pn.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class f8e{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=u8e(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const m8e=Object.freeze(Object.defineProperty({__proto__:null,Decoder:D6,Encoder:h8e,get PacketType(){return pn},protocol:p8e},Symbol.toStringTag,{value:"Module"}));function $u(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const g8e=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Jwe extends $a{constructor(e,i,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[$u(e,"open",this.onopen.bind(this)),$u(e,"packet",this.onpacket.bind(this)),$u(e,"error",this.onerror.bind(this)),$u(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){if(g8e.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const n={type:pn.EVENT,data:i};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const o=this.ids++,s=i.pop();this._registerAckCallback(o,s),n.id=o}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,i){var n;const r=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(r===void 0){this.acks[e]=i;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let o=0;o<this.sendBuffer.length;o++)this.sendBuffer[o].id===e&&this.sendBuffer.splice(o,1);i.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...o)=>{this.io.clearTimeoutFn(a),i.apply(this,[null,...o])}}emitWithAck(e,...i){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((r,a)=>{i.push((o,s)=>n?o?a(o):r(s):r(o)),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...a)=>n!==this._queue[0]?void 0:(r!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:pn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case pn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case pn.EVENT:case pn.BINARY_EVENT:this.onevent(e);break;case pn.ACK:case pn.BINARY_ACK:this.onack(e);break;case pn.DISCONNECT:this.ondisconnect();break;case pn.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const n of i)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let n=!1;return function(...r){n||(n=!0,i.packet({type:pn.ACK,id:e,data:r}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(i.apply(this,e.data),delete this.acks[e.id])}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:pn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const n of i)n.apply(this,e.data)}}}function hS(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}hS.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+i:t-i}return Math.min(t,this.max)|0};hS.prototype.reset=function(){this.attempts=0};hS.prototype.setMin=function(t){this.ms=t};hS.prototype.setMax=function(t){this.max=t};hS.prototype.setJitter=function(t){this.jitter=t};class V2 extends $a{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,gx(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((n=i.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new hS({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const r=i.parser||m8e;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Zwe(this.uri,this.opts);const i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=$u(i,"open",function(){n.onopen(),e&&e()}),a=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),e?e(s):this.maybeReconnectOnOpen()},o=$u(i,"error",a);if(this._timeout!==!1){const s=this._timeout,l=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),i.close()},s);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push($u(e,"ping",this.onping.bind(this)),$u(e,"data",this.ondata.bind(this)),$u(e,"error",this.onerror.bind(this)),$u(e,"close",this.onclose.bind(this)),$u(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){T6(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Jwe(this,e,i),this.nsps[e]=n),n}_destroy(e){const i=Object.keys(this.nsps);for(const n of i)if(this.nsps[n].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let n=0;n<i.length;n++)this.engine.write(i[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,i){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},i);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const AS={};function CM(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=r8e(t,e.path||"/socket.io"),n=i.source,r=i.id,a=i.path,o=AS[r]&&a in AS[r].nsps,s=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let l;return s?l=new V2(n,e):(AS[r]||(AS[r]=new V2(n,e)),l=AS[r]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(CM,{Manager:V2,Socket:Jwe,io:CM,connect:CM});const cn={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!0,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},first_time_user:!1,version:I6,version_check:void 0,format_version:"1.2",ioc:"gbr",orientation:void 0,locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},calendar:{start:void 0,end:void 0,category:void 0,first_day:0},scoring:{delegationOfficial:!1,delegation:!0},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};function v8e(){const t=dce();return t?{authorization:`Bearer ${t}`}:void 0}const Pa={timestampOffset:0,socket:void 0},dm={},j2=[];function y8e(t){console.log("tmxMessage:",{data:t})}function P6(t){const e={transportOptions:{polling:{extraHeaders:v8e()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if(Pa.socket)console.log("socket exists");else{const i=window.location.host.includes("localhost")||window.location.hostname==="127.0.0.1",r=`${cn.socketPath||i?"http://127.0.0.1:8383":"https://courthive.net"}/tmx`;Pa.socket=CM.connect(r,e),Pa.socket.on("ack",S8e),Pa.socket.on(DYe,y8e),Pa.socket.on(UYe,Fwe),Pa.socket.on("connect",()=>b8e(t)),Pa.socket.on("disconnect",()=>console.log("disconnect")),Pa.socket.on("timestamp",a=>Pa.timestampOffset=new Date().getTime()-a.timestamp),Pa.socket.on("connect_error",a=>{console.log("connection error:",{data:a}),gE()})}}function I8e(){return!!Pa.socket}function gE(){Pa!=null&&Pa.socket&&Pa.socket.disconnect(),setTimeout(()=>delete Pa.socket,1e3)}function C6({data:t,ackCallback:e}){const i=Bc(),{email:n}=i||{},r=t.type??"tmx",a=()=>{if(e&&pt(e)){const s=hi.UUID();t.payload&&Object.assign(t.payload,{ackId:s}),w8e({ackId:s,callback:e})}const o=Pa.timestampOffset?new Date().getTime()+Pa.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:Yw(),tmxVersion:I6,timestamp:o,userId:n}),Qwe(r,t)};if(Pa.socket)a();else try{P6(a)}catch{j2.push({header:r,data:t,ackCallback:e})}}function Qwe(t,e){Pa.socket.connected?Pa.socket.emit(t,e):console.log("socket not connected")}function b8e(t){for(console.log("** connected"),C6({data:{type:"timestamp"}});j2.length;){const e=j2.pop();Qwe(e.header,e.data)}pt(t)&&t()}function w8e({ackId:t,uuid:e,callback:i}){t&&(dm[t]=i),e&&(dm[e]=i)}function S8e(t){t.ackId&&dm[t.ackId]&&(dm[t.ackId](t),delete dm[t.ackId]),t.uuid&&dm[t.uuid]&&(dm[t.uuid](t),delete dm[t.uuid])}function e0e({tournamentRecord:t,callback:e}){var n;const i=(n=Bc())==null?void 0:n.provider;i&&!t.parentOrganisation&&(t.parentOrganisation=i),q5({tournamentRecord:t,callback:e})}function T8e(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function Ty(t,e){return Array.from(t.classList).indexOf(e)>=0?t:ms(t,e)}function ms(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function _S(t,e,i){const n=ms(t,e);return n==null?void 0:n.getAttribute(i)}function hf(t,e){const i=[];function n(r){r.childNodes.forEach(a=>{a.childNodes.length>0&&n(a),a.classList&&Array.from(a.classList).indexOf(e)>=0&&i.push(a)})}return n(t),i}function vx({e:t,table:e,classNames:i,className:n,visible:r,columns:a}){const o=ms(t.target,"options_right"),s=r?"":ct,l=r?ct:"";for(const c of o.children){const u=n?Array.from(c.classList).includes(n):Array.from(c.classList).some(d=>i.includes(d));c.style.display=u?s:l}for(const c of a)e.updateColumnDefinition(c,{formatter:r?T8e:void 0,editable:r})}function U8e(t,e){vx({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t})}const t0e=t=>{const e=document.createElement("ul");return t.forEach(i=>{let n=document.createElement("li");if(i.field==="sex")n.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(ru(i.value)){if(i.value){let r=document.createElement("div");r.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,n.appendChild(r),n.appendChild(i.value)}}else n.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(n)}),Object.keys(t).length?e:""},D8e=(t,e)=>{var i,n;return(n=(i=t.groups)==null?void 0:i.find(r=>{var a;return(a=r.participantRoleResponsibilities)==null?void 0:a.includes(e)}))==null?void 0:n.participantName},P8e=t=>D8e(t,"CLUB"),i0e=(t,e)=>(t.events||[]).map(({eventId:i})=>e==null?void 0:e[i]),n0e=t=>{var e;return((e=ew.countries.find(i=>i.ioc===t||i.iso===t))==null?void 0:e.label)||""},C8e=/[\p{Lu}]/u,E8e=/[\p{Ll}]/u,F9=/^[\p{Lu}](?![\p{Lu}])/gu,r0e=/([\p{Alpha}\p{N}_]|$)/u,E6=/[_.\- ]+/,M8e=new RegExp("^"+E6.source),$9=new RegExp(E6.source+r0e.source,"gu"),B9=new RegExp("\\d+"+r0e.source,"gu"),R8e=(t,e,i,n)=>{let r=!1,a=!1,o=!1,s=!1;for(let l=0;l<t.length;l++){const c=t[l];s=l>2?t[l-3]==="-":!0,r&&C8e.test(c)?(t=t.slice(0,l)+"-"+t.slice(l),r=!1,o=a,a=!0,l++):a&&o&&E8e.test(c)&&(!s||n)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),o=a,a=!1,r=!0):(r=e(c)===c&&i(c)!==c,o=a,a=i(c)===c&&e(c)!==c)}return t},N8e=(t,e)=>(F9.lastIndex=0,t.replaceAll(F9,i=>e(i))),A8e=(t,e)=>($9.lastIndex=0,B9.lastIndex=0,t.replaceAll(B9,(i,n,r)=>["_","-"].includes(t.charAt(r+i.length))?i:e(i)).replaceAll($9,(i,n)=>e(n)));function _8e(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(a=>a.trim()).filter(a=>a.length).join("-"):t=t.trim(),t.length===0)return"";const i=e.locale===!1?a=>a.toLowerCase():a=>a.toLocaleLowerCase(e.locale),n=e.locale===!1?a=>a.toUpperCase():a=>a.toLocaleUpperCase(e.locale);return t.length===1?E6.test(t)?"":e.pascalCase?n(t):i(t):(t!==i(t)&&(t=R8e(t,i,n,e.preserveConsecutiveUppercase)),t=t.replace(M8e,""),t=e.preserveConsecutiveUppercase?N8e(t,i):i(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),A8e(t,n))}const{WTN:k8e,UTR:O8e}=mo.ratingConstants,{SINGLES:V9}=mo.eventConstants,x8e=(t,e)=>{var h,f,m,g,v,y,I,b,D;const{participantId:i,participantName:n,participantType:r,person:a}=t,{standardFamilyName:o,standardGivenName:s}=a||{},l=(f=(h=t.person)==null?void 0:h.addresses)==null?void 0:f[0],c=l!=null&&l.city&&(l!=null&&l.state)?`${l.city}, ${l.state}`:void 0,u=(v=(g=(m=t.ratings)==null?void 0:m[V9])==null?void 0:g.find(w=>w.scaleName===O8e))==null?void 0:v.scaleValue,p={wtn:(b=(I=(y=t.ratings)==null?void 0:y[V9])==null?void 0:I.find(w=>w.scaleName===k8e))==null?void 0:b.scaleValue,utr:u};return{searchText:`${n} ${s} ${o}`.toLowerCase(),sex:_8e(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:w})=>w),ioc:n0e((D=t.person)==null?void 0:D.nationalityCode),events:i0e(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:o,firstName:s,club:P8e(t),teams:t.teams,participantName:n,participantType:r,participantId:i,participant:t,cityState:c,ratings:p}},sh=t=>(e,i)=>{const n=e.getDefinition();return t.includes(n.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:L8e,FEMALE:F8e}=Du,{PAIR:$8e}=Ua,EI=t=>(e,i,n)=>{var d;const r=e.getColumn().getDefinition(),a=r.field==="side1"&&1||r.field==="side2"&&2,o=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,c=e.getValue(),u=s.participant||c.participant||s.person&&s;if(u){const p=cn.scales[cn.activeScale],h=m=>fIe({eventHandlers:{participantClick:g=>pt(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{flag:!1,genderColor:!0,participantDetail:"TEAM",scaleAttributes:p}},matchUp:s.matchUp,participant:m,placeholder:i,sideNumber:a}),f=m=>{const g=document.createElement("div");return g.className="flexrow flexjustifystart",m.individualParticipants.forEach((v,y)=>{if(g.appendChild(h(v)),!y){const I=document.createElement("span");I.style.width="1em",I.innerHTML="&nbsp;",g.appendChild(I)}}),g};return n==="sideBySide"&&u.participantType===$8e?f(u):h(u)}if(l){const p=r.field===s.winningSide;o.style=p?"color: green":"color: red"}else{const p=(c==null?void 0:c.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),h=p===L8e&&"#2E86C1"||p===F8e&&"#AA336A"||"";o.style.color=h}return o.innerHTML=(ru(c)?c.participantName:c)||"",o};function B8e(t){const e=t.getValue();return(e==null?void 0:e.length)||0}function jw(t,e){var r,a,o,s;const i=(t==null?void 0:t.person)||((r=t==null?void 0:t.participant)==null?void 0:r.person),n=(e==null?void 0:e.person)||((a=e==null?void 0:e.participant)==null?void 0:a.person);return i||n?i!=null&&i.standardFamilyName&&!(n!=null&&n.standardFamilyName)||n!=null&&n.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(n!=null&&n.standardFamilyName)?1:(o=i.standardFamilyName)==null?void 0:o.localeCompare(n==null?void 0:n.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}var a0e={exports:{}};(function(t,e){(function(i,n){t.exports=n()})($be,function(){var i=1e3,n=6e4,r=36e5,a="millisecond",o="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(R){var A=["th","st","nd","rd"],_=R%100;return"["+R+(A[(_-20)%10]||A[_]||A[0])+"]"}},I=function(R,A,_){var O=String(R);return!O||O.length>=A?R:""+Array(A+1-O.length).join(_)+R},b={s:I,z:function(R){var A=-R.utcOffset(),_=Math.abs(A),O=Math.floor(_/60),x=_%60;return(A<=0?"+":"-")+I(O,2,"0")+":"+I(x,2,"0")},m:function R(A,_){if(A.date()<_.date())return-R(_,A);var O=12*(_.year()-A.year())+(_.month()-A.month()),x=A.clone().add(O,d),F=_-x<0,$=A.clone().add(O+(F?-1:1),d);return+(-(O+(_-x)/(F?x-$:$-x))||0)},a:function(R){return R<0?Math.ceil(R)||0:Math.floor(R)},p:function(R){return{M:d,y:h,w:u,d:c,D:f,h:l,m:s,s:o,ms:a,Q:p}[R]||String(R||"").toLowerCase().replace(/s$/,"")},u:function(R){return R===void 0}},D="en",w={};w[D]=y;var S="$isDayjsObject",U=function(R){return R instanceof M||!(!R||!R[S])},C=function R(A,_,O){var x;if(!A)return D;if(typeof A=="string"){var F=A.toLowerCase();w[F]&&(x=F),_&&(w[F]=_,x=F);var $=A.split("-");if(!x&&$.length>1)return R($[0])}else{var V=A.name;w[V]=A,x=V}return!O&&x&&(D=x),x||!O&&D},E=function(R,A){if(U(R))return R.clone();var _=typeof A=="object"?A:{};return _.date=R,_.args=arguments,new M(_)},P=b;P.l=C,P.i=U,P.w=function(R,A){return E(R,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var M=function(){function R(_){this.$L=C(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[S]=!0}var A=R.prototype;return A.parse=function(_){this.$d=function(O){var x=O.date,F=O.utc;if(x===null)return new Date(NaN);if(P.u(x))return new Date;if(x instanceof Date)return new Date(x);if(typeof x=="string"&&!/Z$/i.test(x)){var $=x.match(g);if($){var V=$[2]-1||0,G=($[7]||"0").substring(0,3);return F?new Date(Date.UTC($[1],V,$[3]||1,$[4]||0,$[5]||0,$[6]||0,G)):new Date($[1],V,$[3]||1,$[4]||0,$[5]||0,$[6]||0,G)}}return new Date(x)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return P},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,O){var x=E(_);return this.startOf(O)<=x&&x<=this.endOf(O)},A.isAfter=function(_,O){return E(_)<this.startOf(O)},A.isBefore=function(_,O){return this.endOf(O)<E(_)},A.$g=function(_,O,x){return P.u(_)?this[O]:this.set(x,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,O){var x=this,F=!!P.u(O)||O,$=P.p(_),V=function(Z,Q){var ie=P.w(x.$u?Date.UTC(x.$y,Q,Z):new Date(x.$y,Q,Z),x);return F?ie:ie.endOf(c)},G=function(Z,Q){return P.w(x.toDate()[Z].apply(x.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(Q)),x)},j=this.$W,z=this.$M,H=this.$D,K="set"+(this.$u?"UTC":"");switch($){case h:return F?V(1,0):V(31,11);case d:return F?V(1,z):V(0,z+1);case u:var q=this.$locale().weekStart||0,Y=(j<q?j+7:j)-q;return V(F?H-Y:H+(6-Y),z);case c:case f:return G(K+"Hours",0);case l:return G(K+"Minutes",1);case s:return G(K+"Seconds",2);case o:return G(K+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,O){var x,F=P.p(_),$="set"+(this.$u?"UTC":""),V=(x={},x[c]=$+"Date",x[f]=$+"Date",x[d]=$+"Month",x[h]=$+"FullYear",x[l]=$+"Hours",x[s]=$+"Minutes",x[o]=$+"Seconds",x[a]=$+"Milliseconds",x)[F],G=F===c?this.$D+(O-this.$W):O;if(F===d||F===h){var j=this.clone().set(f,1);j.$d[V](G),j.init(),this.$d=j.set(f,Math.min(this.$D,j.daysInMonth())).$d}else V&&this.$d[V](G);return this.init(),this},A.set=function(_,O){return this.clone().$set(_,O)},A.get=function(_){return this[P.p(_)]()},A.add=function(_,O){var x,F=this;_=Number(_);var $=P.p(O),V=function(z){var H=E(F);return P.w(H.date(H.date()+Math.round(z*_)),F)};if($===d)return this.set(d,this.$M+_);if($===h)return this.set(h,this.$y+_);if($===c)return V(1);if($===u)return V(7);var G=(x={},x[s]=n,x[l]=r,x[o]=i,x)[$]||1,j=this.$d.getTime()+_*G;return P.w(j,this)},A.subtract=function(_,O){return this.add(-1*_,O)},A.format=function(_){var O=this,x=this.$locale();if(!this.isValid())return x.invalidDate||m;var F=_||"YYYY-MM-DDTHH:mm:ssZ",$=P.z(this),V=this.$H,G=this.$m,j=this.$M,z=x.weekdays,H=x.months,K=x.meridiem,q=function(Q,ie,ue,J){return Q&&(Q[ie]||Q(O,F))||ue[ie].slice(0,J)},Y=function(Q){return P.s(V%12||12,Q,"0")},Z=K||function(Q,ie,ue){var J=Q<12?"AM":"PM";return ue?J.toLowerCase():J};return F.replace(v,function(Q,ie){return ie||function(ue){switch(ue){case"YY":return String(O.$y).slice(-2);case"YYYY":return P.s(O.$y,4,"0");case"M":return j+1;case"MM":return P.s(j+1,2,"0");case"MMM":return q(x.monthsShort,j,H,3);case"MMMM":return q(H,j);case"D":return O.$D;case"DD":return P.s(O.$D,2,"0");case"d":return String(O.$W);case"dd":return q(x.weekdaysMin,O.$W,z,2);case"ddd":return q(x.weekdaysShort,O.$W,z,3);case"dddd":return z[O.$W];case"H":return String(V);case"HH":return P.s(V,2,"0");case"h":return Y(1);case"hh":return Y(2);case"a":return Z(V,G,!0);case"A":return Z(V,G,!1);case"m":return String(G);case"mm":return P.s(G,2,"0");case"s":return String(O.$s);case"ss":return P.s(O.$s,2,"0");case"SSS":return P.s(O.$ms,3,"0");case"Z":return $}return null}(Q)||$.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,O,x){var F,$=this,V=P.p(O),G=E(_),j=(G.utcOffset()-this.utcOffset())*n,z=this-G,H=function(){return P.m($,G)};switch(V){case h:F=H()/12;break;case d:F=H();break;case p:F=H()/3;break;case u:F=(z-j)/6048e5;break;case c:F=(z-j)/864e5;break;case l:F=z/r;break;case s:F=z/n;break;case o:F=z/i;break;default:F=z}return x?F:P.a(F)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return w[this.$L]},A.locale=function(_,O){if(!_)return this.$L;var x=this.clone(),F=C(_,O,!0);return F&&(x.$L=F),x},A.clone=function(){return P.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},R}(),N=M.prototype;return E.prototype=N,[["$ms",a],["$s",o],["$m",s],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(R){N[R[1]]=function(A){return this.$g(A,R[0],R[1])}}),E.extend=function(R,A){return R.$i||(R(A,M,E),R.$i=!0),E},E.locale=C,E.isDayjs=U,E.unix=function(R){return E(1e3*R)},E.en=w[D],E.Ls=w,E.p={},E})})(a0e);var V8e=a0e.exports;const AN=o6(V8e);async function Pt({methods:t,engine:e=vL,callback:i}){var p,h,f;const n=m=>{pt(i)?i(m):console.log({result:m})};if(!Array.isArray(t))return n();const r=Ole[e];if(!r)return n();const a=m=>{var g;return(g=m==null?void 0:m.parentOrganisation)==null?void 0:g.organisationId},o=((p=r.getState())==null?void 0:p.tournamentRecords)??{},s=e===vL?[r.getTournamentId()]:(h=Object.values(o))==null?void 0:h.map(m=>m.tournamentId),l=hi.unique(e===vL?[a(r.getTournament().tournamentRecord)]:(f=Object.values(o))==null?void 0:f.map(a)).filter(Boolean);if(l.length>1)return ai({message:"Multiple providers",intent:"is-danger"});const c=new Date().getTime(),u=Object.values(o).every(m=>{const g=AN(m.startDate).startOf("day").valueOf(),v=AN(m.endDate).endOf("day").valueOf();return g&&v&&g<=c&&v>=c}),d=m=>G8e({methods:t,factoryEngine:r,tournamentIds:s,completion:n,saveLocal:m});return u?l.length?o0e({providerIds:l,mutate:d}):d():j8e({providerIds:l,mutate:d})}function j8e({providerIds:t,mutate:e}){return ai({action:{onClick:()=>t!=null&&t.length?o0e({providerIds:t,mutate:e}):e(),text:"Modify?"},message:"Not in date range",intent:"is-danger"})}function o0e({providerIds:t,mutate:e}){var o,s,l,c;const i=Bc();if(!i)return ai({message:"Not logged in",intent:"is-warning"});const n=!!((o=i==null?void 0:i.providerIds)!=null&&o.includes(t[0])||((s=i==null?void 0:i.provider)==null?void 0:s.organisationId)===t[0]),r=(l=i==null?void 0:i.roles)==null?void 0:l.includes(rk),a=((c=Ye.provider)==null?void 0:c.organisationId)===t[0];return!n&&!r?ai({message:"Not authorized",intent:"is-danger"}):!n&&r&&!a?ai({action:{onClick:()=>(Ye.provider={organisationId:t[0]},e(!1)),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"}):e(!n&&!(r&&a))}function j9({factoryEngine:t,methods:e}){return console.log("%c executing locally","color: lightgreen"),t.executionQueue(e)||{}}async function G9(t){(t||cn.saveLocal)&&(console.log("%c localSave","color: yellow"),await q5())}async function G8e({methods:t,completion:e,factoryEngine:i,tournamentIds:n,saveLocal:r=!0}){var o,s;if((o=window.dev)!=null&&o.params)for(const l of t)window.dev.params[l.method]&&(l.params={...l.params,...window.dev.params[l.method]});(s=window==null?void 0:window.dev)!=null&&s.getContext().internal&&console.log({methods:t});let a;if(!cn.serverFirst&&(a=j9({factoryEngine:i,methods:t}),a.error))return e(a);if(a!=null&&a.success||cn.serverFirst){const l=async c=>{if(cn.serverFirst&&(c!=null&&c.success))return a=j9({factoryEngine:i,methods:t}),a.error||await G9(r),e(a)};console.log("%c invoking remote","color: lightblue"),C6({data:{type:"executionQueue",payload:{methods:t,tournamentIds:n}},ackCallback:l}),cn.serverFirst||await G9(r)}return cn.serverFirst?e({success:!0}):e(a)}const H8e="addCourts",z8e="addFlight",W8e="addDrawDefinition",s0e="addAdHocMatchUps",q8e="addDrawEntries",K8e="addEvent",M6="addEventEntries",Y8e="addEventEntryPairs",l0e="addIndividualParticipantIds",G2="addMatchUpScheduleItems",vE="addParticipants",H9="addParticipantTimeItem",c0e="addPlayoffStructures",Z8e="addTournamentExtension",X8e="addVenue",J8e="attachQualifyingStructure",Q8e="attachPolicies",e9e="automatedPlayoffPositioning",u0e="bulkScheduleMatchUps",d0e="deleteAdHocMatchUps",p0e="deleteFlightAndFlightDraw",t9e="deleteEvents",i9e="deleteParticipants",n9e="deleteVenues",r9e="destroyPairEntries",a9e="modifyCourt",o9e="modifyEvent",h0e="modifyEntriesStatus",z9="modifyParticipant",R6="modifyParticipantsSignInStatus",s9e="modifyVenue",l9e="proAutoSchedule",c9e="publishEvent",u9e="removeIndividualParticipantIds",d9e="removeStructure",p9e="renameStructures",h9e="resetDrawDefinition",f0e="resetScorecard",f9e="setMatchUpFormat",N6="setMatchUpStatus",m9e="setParticipantScaleItems",g9e="unPublishEvent",{COMPETITOR:v9e,OFFICIAL:W9}=Uf,{INDIVIDUAL:y9e}=Ua;function m0e({participant:t,view:e,refresh:i}){var p,h,f,m;const n=ew.countries.map(g=>({label:ew.countryToFlag(g.iso||"")+" "+g.label,value:g.ioc})),r={nationalityCode:(p=t==null?void 0:t.person)==null?void 0:p.nationalityCode,firstName:(h=t==null?void 0:t.person)==null?void 0:h.standardGivenName,lastName:(f=t==null?void 0:t.person)==null?void 0:f.standardFamilyName,sex:(m=t==null?void 0:t.person)==null?void 0:m.sex};let a;const o=g=>r.nationalityCode=g,s=(g,v)=>console.log(v.field,g.target.value),l=g=>{a=Wr(g,[{placeholder:"Given name",value:r.firstName||"",label:"First name",field:"firstName",error:"Please enter a name of at least 3 characters",validator:$l(3),onChange:s,focus:!0},{placeholder:"Family name",value:r.lastName||"",label:"Last name",field:"lastName",error:"Please enter a name of at least 3 characters",validator:$l(3),onChange:s},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!r.sex},{label:"Male",value:"MALE",selected:r.sex==="MALE"},{label:"Female",value:"FEMALE",selected:r.sex==="FEMALE"}],onChange:s},{placeholder:"Birthday",value:r.birthDate||"",label:"Date of birth",onChange:s,field:"birthday",date:!0},{typeAhead:{list:n,callback:o},placeholder:"Country of origin",value:r.nationalityCode||"",field:"nationalityCode",label:"Country"}])},c=(g,v)=>PI(g,[{label:"Cancel",close:!0},{label:"Save",onClick:u,close:!0,intent:"is-info"}],v);Ye.drawer.open({title:"<b style='larger'>New participant</b>",callback:()=>console.log("drawer callback"),width:"300px",side:vt,content:l,footer:c});function u(){t!=null&&t.participantId?console.log("update existing"):d()}function d(){const g=a.firstName.value,v=a.lastName.value,y=a.sex.value,I={participantType:y9e,participantRole:e===W9?W9:v9e,person:{nationalityCode:r.nationalityCode,standardGivenName:g,standardFamilyName:v,sex:y}};Pt({methods:[{method:vE,params:{participants:[I]}}],callback:w=>{w.success?pt(i)&&i():console.log(w)}})}return{..._P}}function I9e({participantId:t}){var i;const e=(i=$e.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants)==null?void 0:i[0];if(e)return m0e({participant:e})}async function g0e({participantIds:t,participantId:e,callback:i}){(e||t)&&Pt({methods:[{params:{participantIds:t||[e]},method:i9e}],callback:a=>{a.success?pt(i)&&i(a):console.log({result:a})}})}function EM(t,e){const i=Array.from(document.querySelectorAll(".tippy-content"));if(i.length){i.forEach(c=>c.remove());return}const n=t.target.getElementsByClassName("fa-ellipsis-vertical")[0],r=e.getRow(),a=r.getData(),{participantId:o,participantType:s}=a;nl({items:[{hide:s!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>{var c;return console.log("Participant profile",(c=e.getData())==null?void 0:c.participant)}},{hide:s!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{I9e({participantId:o,callback:u=>u.participantId&&r.update(u)})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{g0e({participantId:o,callback:u=>{if(u.success)r.delete();else{const d=e.getTable();d.alert(u.error.message||"Cannot Remove Participant"),setTimeout(()=>d.clearAlert(),2500)}}})}}],target:n||t.target,config:{placement:Ef}})}const{SINGLES:b9e}=Xo,v0e=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=e.getRow().getData(),{participantId:o}=a,s=(l,c)=>{var u;return(u=l==null?void 0:l.eventName)==null?void 0:u.localeCompare(c==null?void 0:c.eventName)};return r.sort(s).forEach(l=>{const c=y0e({def:i,participantId:o,event:l,eventClick:t});n.appendChild(c)}),n};function y0e({matchUpId:t,participantId:e,event:i,eventClick:n}){var a,o;const r=document.createElement("span");return pt(n)&&(r.onclick=()=>n({eventId:i.eventId,participantId:e,matchUpId:t})),r.className="tag event-pill",(a=i.gender)!=null&&a.toLowerCase().includes("female")?r.classList.add("is-danger"):(o=i.gender)!=null&&o.toLowerCase().includes("male")?r.classList.add("is-link"):r.classList.add("is-primary"),i.eventType===b9e&&r.classList.add("is-light"),r.innerHTML=i.eventName,r}const w9e=t=>e=>{const i=e.getColumn().getDefinition(),n=e.getRow().getData(),{matchUpId:r}=n,a=document.createElement("div");a.className="tags";const o=y0e({def:i,matchUpId:r,event:n,eventClick:t});return a.append(o),a},S9e=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),a=(o,s)=>{var l;return(l=o==null?void 0:o.participantName)==null?void 0:l.localeCompare(s==null?void 0:s.participantName)};return r.sort(a).forEach(o=>{const s=T9e({def:i,team:o,teamClick:t});n.appendChild(s)}),n};function T9e({matchUpId:t,team:e,teamClick:i}){const n=document.createElement("span"),{participantId:r,participantName:a}=e;return pt(i)&&(n.onclick=()=>i({participantId:r,matchUpId:t})),n.className="tag event-pill",n.innerHTML=a,n}const H2=({maxValue:t,decimals:e,field:i})=>(n,r,a)=>{const o=e?/[^0-9.]/g:/[^0-9]/g,s=document.createElement("input");s.style.backgroundColor="lightyellow",s.style.boxSizing="border-box",s.style.textAlign="center",s.style.padding="3px",s.style.height="100%",s.style.width="100%",s.value=n.getValue()||"",r(()=>{s.focus(),s.select()});function l(){let c=s.value;e&&(c=parseFloat(c).toFixed(2)),a(isNaN(c)?void 0:c)}return s.addEventListener("keydown",c=>{c.key==="Tab"&&(c.preventDefault(),c.stopPropagation())}),s.addEventListener("keyup",c=>{const u=c.target.value.replace(o,"")||"";if(c.target.value=u>t?"":u,c.key==="Tab"&&c.shiftKey&&i){const p=ms(c.target,"tabulator-row").previousSibling,h=p&&hf(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}else if((c.key==="Enter"||c.key==="Tab")&&i){const p=ms(c.target,"tabulator-row").nextSibling,h=p&&hf(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}}),s.addEventListener("blur",l),s},q9=t=>Ye.columns[t]!==!1;function zn({eventId:t,drawId:e,structureId:i,renderDraw:n,participantId:r,matchUpId:a,view:o}){var d,p,h,f;const s=(p=(d=$e.getTournament())==null?void 0:d.tournamentRecord)==null?void 0:p.tournamentId,l=t&&$e.getEvent({eventId:t,drawId:e}).event,c=((h=l==null?void 0:l.drawDefinitions)==null?void 0:h.length)===1&&l.drawDefinitions[0];r&&c&&(e=c.drawId,n=!0),a&&(e=(f=l.drawDefinitions.find(({drawId:m})=>$e.allDrawMatchUps({drawId:m,inContext:!1}).matchUps.find(v=>v.matchUpId===a)))==null?void 0:f.drawId,n=!!e);let u=`/${xa}/${s}/${ev}/${t}`;n&&e?(u+=`/${zS}/${e}`,i&&(u+=`/${j$}/${i}`),[z$,nw,iw].includes(o)&&(u+=`/${G$}/${o}`)):e&&(u+=`/${Gle}/${e}`),Ye.router.navigate(u)}const Bf=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:U9e,SIGNED_OUT:D9e}=Ua;function P9e(t,e){const i=e.getRow().getData().participantId,n=!e.getValue();Pt({methods:[{params:{signInState:n?U9e:D9e,participantIds:[i]},method:R6}],callback:s=>{s.success&&e.setValue(n)}})}const lF="fa-check-square",lh=t=>(e,i)=>{const n=i.getTable(),r=n.getColumns(),a=[];for(let o of r){const s=o.getDefinition();if(s.title){let l=document.createElement("i");l.classList.add("fas"),l.classList.add(o.isVisible()?lF:"fa-square");let c=document.createElement("span"),u=document.createElement("span");const d=(t==null?void 0:t[s.field])||s.displayTitle||s.title;u.textContent=" "+d,c.appendChild(l),c.appendChild(u),a.push({label:c,action:function(p){p.stopPropagation(),o.toggle(),Ye.columns[o.getField()]=o.isVisible(),n.redraw(),o.isVisible()?(l.classList.remove("fa-square"),l.classList.add(lF)):(l.classList.remove(lF),l.classList.add("fa-square"))}})}}return a},C9e=({field:t})=>(e,i,n)=>{const r=document.createElement("input");r.style.backgroundColor="lightyellow",r.style.boxSizing="border-box",r.style.textAlign="center",r.style.padding="3px",r.style.height="100%",r.style.width="100%",r.value=e.getValue()||"",i(()=>{r.focus(),r.select()});function a(){const o=r.value;n(o)}return r.addEventListener("keydown",o=>{o.key==="Tab"&&(o.preventDefault(),o.stopPropagation())}),r.addEventListener("keyup",o=>{if(o.key==="Tab"&&o.shiftKey&&t){const l=ms(o.target,"tabulator-row").previousSibling,c=l&&hf(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}else if((o.key==="Enter"||o.key==="Tab")&&t){const l=ms(o.target,"tabulator-row").nextSibling,c=l&&hf(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}}),r.addEventListener("blur",a),r},{WTN:E9e,UTR:M9e}=mo.ratingConstants,{FEMALE:R9e,MALE:N9e}=Du,K9="ratings.utr.utrRating",Y9="ratings.wtn.wtnRating";function A9e(t){const e=t.some(a=>a.cityState),i=t.some(a=>a.tennisId),n=t.some(a=>{var o;return(o=a.ratings)==null?void 0:o.utr}),r=t.some(a=>{var o;return(o=a.ratings)==null?void 0:o.wtn});return[{cellClick:(a,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{headerMenu:lh({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,resizable:!1,hozAlign:At,width:50},{formatter:EI(({event:a,cell:o,...s})=>EM(a,o)),cellClick:EM,sorter:jw,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:C9e({field:"tennisId"}),visible:i,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:Et,editor:"list",width:80,editorParams:{itemFormatter:(a,o)=>o,values:{Male:N9e,Female:R9e,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:P9e,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:Et,tooltip:!1,width:40},{sorter:(a,o)=>(a.length||0)-((o==null?void 0:o.length)||0),formatter:B8e,title:"Penalties",field:"penalties",hozAlign:Et,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:Et,minWidth:70,editor:!1,visible:!1},{formatter:v0e(zn),visible:q9("events"),sorter:(a,o)=>a&&o,title:"Events",field:"events",hozAlign:Et,minWidth:200,editor:!1,widthGrow:2},{formatter:S9e(()=>console.log("boo")),visible:q9("teams"),sorter:(a,o)=>a&&o,title:"Teams",field:"teams",hozAlign:Et,minWidth:200,editor:!1,widthGrow:2},{visible:!!e,title:"City/State",field:"cityState",minWidth:110},{editor:H2({maxValue:40,decimals:!0,field:Y9}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:Y9,editable:!1,visible:!!r,title:E9e,width:70},{editor:H2({maxValue:16,decimals:!0,field:K9}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:K9,editable:!1,visible:!!n,title:M9e,width:70},{cellClick:EM,formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,maxWidth:40}]}const{INDIVIDUAL:_9e,GROUP:k9e,TEAM:O9e}=Ua,{OFFICIAL:Z9,COMPETITOR:x9e}=Uf;function L9e({view:t}={}){let e,i,n,r,a,o;const s={participantRoles:[t===Z9?Z9:x9e]},l=()=>{({participants:i,derivedEventInfo:n}=$e.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:s,withEvents:!0,withISO2:!0}));const m=i.filter(({participantType:v})=>v===_9e);o=i.filter(({participantType:v})=>v===k9e),a=i.filter(({participantType:v})=>v===O9e);const g=hi.unique(m.flatMap(({ratings:v})=>{var y;return(y=v==null?void 0:v.SINGLES)==null?void 0:y.map(({scaleName:I})=>I)}).filter(Boolean));return cn.activeScale=g.includes("WTN")&&"wtn"||g.includes("UTR")&&"utr"||"wtn",(m==null?void 0:m.map(v=>x8e(v,n)))||[]},c=()=>{setTimeout(()=>e.replaceData(l()),r?0:1e3)},u=l(),d=A9e(u),p=(f,m)=>(hi.isNumeric(f)&&f||0)+(hi.isNumeric(m)&&m||0);return(f=>{var y;oh({anchorId:wR});const m=document.getElementById(wR),g=(y=ms(m,"section"))==null?void 0:y.querySelector(".tabHeader");e=new na(m,{headerSortElement:sh(["sex","signedIn","events","teams","cityState","tennisId","ratings.wtn.wtnRating","ratings.utr.utrRating"]),responsiveLayoutCollapseFormatter:t0e,responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.86,placeholder:"No participants",responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:f});const v=I=>`Participants (${I.length})`;e.on("dataChanged",I=>g&&(g.innerHTML=v(I))),e.on("dataFiltered",(I,b)=>{g&&(g.innerHTML=v(b));const D=[],w=[];for(const P of b){const M=P.getData(),{wtn:N,utr:R}=M.ratings;hi.isNumeric(R==null?void 0:R.utrRating)&&w.push(parseFloat(R.utrRating)),hi.isNumeric(N==null?void 0:N.wtnRating)&&D.push(parseFloat(N.wtnRating))}const S=w.reduce(p,0),U=D.reduce(p,0),C=(w.length?S/w.length:0).toFixed(2),E=(D.length?U/D.length:0).toFixed(2);console.log(`UTR ${C}x̄`),console.log(`WTN ${E}x̄`)}),e.on("scrollVertical",vc),e.on("tableBuilt",()=>r=!0)})(u),{table:e,replaceTableData:c,teamParticipants:a,groupParticipants:o}}function F9e(t,e){vx({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!1,table:e,e:t});const n=e.getData().flatMap(a=>{var f,m,g;const o=(f=a.ratings)==null?void 0:f.wtn,s=o==null?void 0:o.wtnRating,l=o!=null&&o.confidence||s?50:0;let c=l?{...o,wtnRating:s,confidence:l}:void 0;const u={method:H9,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:c}}},d=(g=(m=a.ratings)==null?void 0:m.utr)==null?void 0:g.utrRating,p=d?50:0;c=p?{utrRating:d,confidence:p}:void 0;const h={method:H9,params:{participantId:a.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:c}}};return[u,h]});Pt({methods:n,callback:a=>{a.success||console.log(a)}})}const{COMPETITOR:$9e,OTHER:B9e}=Uf,{TEAM:X9}=Ua;function I0e({individualParticipantIds:t,participantType:e=X9,title:i="Edit team",participant:n,refresh:r}){const a="participantName",o={[a]:n==null?void 0:n[a]};let s;const l=()=>{},c=h=>{s=Wr(h,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:o[a]||"",validator:$l(3),field:a,onChange:l,label:"Name"}])},u=(h,f)=>PI(h,[{label:"Cancel",close:!0},{label:"Save",onClick:d,close:!0,intent:"is-info"}],f);Ye.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>console.log("drawer callback"),width:"300px",side:vt,content:c,footer:u});function d(){n!=null&&n.participantId?console.log("update existing"):p()}function p(){var v;const h=e===X9?$9e:B9e,f={individualParticipantIds:t||(n==null?void 0:n.individualParticipantIds)||[],participantName:(v=s[a])==null?void 0:v.value,participantRole:h,participantType:e};Pt({methods:[{params:{participants:[f]},method:vE}],callback:y=>{y.success?pt(r)&&r():console.log({result:y})}})}return{..._P}}const{TEAM:cF}=Ua;function J9({participants:t,table:e,replaceTableData:i,participantType:n=cF}){const r=({team:s})=>{const c=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const u=[{method:l0e,params:{groupingParticipantId:s.participantId,individualParticipantIds:c}}];Pt({methods:u,callback:p=>{p.success&&i()}})},a=()=>{const s=n===cF?"New team":"New Group",c=e.getSelectedData().map(({participantId:u})=>u);e.deselectRow(),I0e({refresh:i,individualParticipantIds:c,participantType:n,title:s})},o=n===cF?"Create new team":"Create new group";return{options:t.map(s=>({onClick:()=>r({team:s}),label:s.participantName,participant:s,close:!0})),actions:[{onClick:()=>a(),close:!0,label:o}]}}const V9e=t=>e=>{if(e.key==="Enter"){const n=t.getSelectedData().map(({participantId:s})=>s),o=t.getData("active").map(({participantId:s})=>s).filter(s=>!n.includes(s));o.length===1&&(t.selectRow(o),e.target.value="",t.clearFilter())}};function b0e(t){let e;const i=s=>{var l;return(l=s==null?void 0:s.eventIds)==null?void 0:l.includes(e)},n=s=>{t.removeFilter(i),e=s,s&&t.addFilter(i)},r=$e.getEvents().events||[];return{eventOptions:[{label:`<span style='font-weight: bold'>${ty}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(s=>({onClick:()=>n(s.eventId),label:s.eventName,close:!0}))),events:r}}const{WTN:j9e}=mo.ratingConstants,{FEMALE:G9e,MALE:H9e,MIXED:z9e,ANY:W9e}=Du;function q9e({callback:t}={}){let e;ir({title:"Generate mock players",content:a=>e=Wr(a,[{options:[{label:"Any",value:W9e,close:!0},{label:"Female",value:G9e,close:!0},{label:"Male",value:H9e,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const a=e.participantsCount.value,o=e.gender.value,s=o===z9e?void 0:o,{participants:l}=ik.generateParticipants({category:{ratingType:j9e,ratingMin:14,ratingMax:19.99},participantsCount:parseInt(a),scaleAllParticipants:!0,sex:s});Pt({methods:[{method:vE,params:{participants:l}}],callback:t})}}]})}function K9e({callback:t}){let e=r=>{let a=r==null?void 0:r.players;a!=null&&a.length?Y9e(a):a&&!a.length&&Ye.modal.inform({message:"Sheet Empty: No Player Rows"}),pt(t)&&t()};const{extension:i}=$e.findExtension({discover:!0,name:"REGISTRATION"});(i==null?void 0:i.value)||q9e({callback:e})}function Y9e(t){console.log({registeredPlayers:t})}function w0e(t){const i=t.getSelectedData().filter(r=>{var a;return!((a=r.events)!=null&&a.length)}).map(({participantId:r})=>r),n=()=>{g0e({participantIds:i,callback:a=>{a.success&&t.deleteRow(i)&&t.deselectRow()}})};ir({content:`Delete ${i.length} participants?`,onClose:()=>t.deselectRow(),title:"Delete participants",buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:n}]})}const{FEMALE:Q9,MALE:eZ,ANY:tZ}=Du;function Z9e(t){let e;const i=l=>{var c,u;return((u=(c=l.participant)==null?void 0:c.person)==null?void 0:u.sex)===e},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=[eZ,Q9],a={[eZ]:"Male",[Q9]:"Female",[tZ]:zke};return{sexOptions:[{label:`<span style='font-weight: bold'>${a[tZ]}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(l=>({onClick:()=>n(l),label:a[l],close:!0}))),genders:a}}const{SIGNED_IN:X9e}=Ua;function J9e(t){const e=t.getSelectedData(),i=e.map(({participantId:a})=>a);Pt({methods:[{params:{signInState:X9e,participantIds:i},method:R6}],callback:a=>{a.success&&(e.forEach(o=>o.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:Q9e,SIGNED_OUT:eZe}=Ua;function tZe(t){const i=$e.getParticipants({participantFilters:{participantTypes:[Q9e]},withSignInStatus:!0,withEvents:!0}).participants.filter(a=>a.signedIn&&!a.events.length).map(a=>a.participantId);Pt({methods:[{params:{signInState:eZe,participantIds:i},method:R6}],callback:a=>{a.success&&t()}})}function iZe(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e}const Ih={participantName:["full name","name"],participantId:["id","participantid"],person:{address:{city:["city"],state:["state"]},standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],birthDate:["*birth"],sex:["gender","sex"]}};function nZe({data:t,sheetId:e,callback:i}){const r=$e.getParticipants().participants.map(({participantId:c})=>c),a=ew.countries.map(c=>[c.ioc,c.iso]).flat().filter(Boolean),o=[],s=c=>c.map(u=>[u.toLowerCase(),u.toLowerCase().split(" ").join("")]).flat(),l=c=>(u=[])=>{const d=Object.keys(c),p=s(u),h=p.reduce((m,g)=>c[g]||m,void 0),f=!h&&d.filter(m=>p.find(g=>g.startsWith("*")&&m.toLowerCase().includes(g.slice(1))));return h||c[f]};for(const c of t||[]){const u=Object.assign({},...Object.keys(c).map(S=>({[S.toLowerCase()]:c[S]}))),d=l(u),p={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};p.participantName=d(Ih.participantName);const h=d(Ih.person.standardFamilyName),f=d(Ih.person.standardGivenName);if(h&&f)p.person.standardFamilyName=h,p.person.standardGivenName=f,p.participantName=`${f} ${h}`;else continue;const m=d(Ih.person.address.state),g=d(Ih.person.address.city);(g||m)&&(p.person.addresses=[{city:g,state:m}]);const v=d(Ih.person.nationalityCode);v&&a.includes(v.toUpperCase())&&(p.person.nationalityCode=v);const y=d(Ih.person.birthDate);if(y!=null&&y.startsWith("Date")){const S=new RegExp(/Date\((\d+),(\d+),(\d+)\)/),U=y.match(S);if(U){const[C,E,P]=U.slice(1,4);p.person.birthDate=`${C}-${E+1}-${P}`}}const I=d(Ih.person.sex);if(I){const S=I.toUpperCase();["MALE","FEMALE"].includes(S)?p.person.sex=S:["F","W","G"].includes(I[0])?p.person.sex="FEMALE":["M","B"].includes(I[0])&&(p.person.sex="MALE")}const b=d(["utr"]);if(b){p.timeItems||(p.timeItems=[]);const S={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:b}};p.timeItems.push(S)}const D=d(["wtn"]);if(D){p.timeItems||(p.timeItems=[]);const S={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:D}};p.timeItems.push(S)}p.participantId=d(Ih.participantId)||`XXX-${iZe(p.participantName)}`,r.includes(p.participantId)||o.push(hi.definedAttributes(p))}o.length?Pt({methods:[{method:vE,params:{participants:o}},{method:Z8e,params:{extension:{name:Vle,value:e}}}],callback:d=>{d.success?(ai({message:`Added ${d.results[0].addedCount} participant(s)`,intent:"is-success"}),pt(i)&&i()):console.log(d)}}):ai({message:"No new participants found",intent:"is-primary"}),pt(i)&&i()}function rZe(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var z2={exports:{}},p1={exports:{}};const aZe={},oZe=Object.freeze(Object.defineProperty({__proto__:null,default:aZe},Symbol.toStringTag,{value:"Module"})),sZe=R5e(oZe);var iZ;function lZe(){if(iZ)return p1.exports;iZ=1;const t=sZe,e=async i=>new Promise((n,r)=>{const a=t.request(i,o=>{const s=[];let l=!1;o.on("data",c=>{if(!l&&!String(c).startsWith("/*O_o*/"))return n(null);l=!0,s.push(c)}),o.on("end",()=>{n({ok:!0,text:()=>Buffer.concat(s).toString()})})});a.on("error",r),a.end()});return p1.exports=e,p1.exports.default=e,p1.exports}const S0e=typeof rZe>"u",cZe=S0e?window.fetch:lZe();class uF{constructor(e,i){this.id=e,this.parseSheetInfo(i)}parseSheetInfo(e){e&&(typeof e=="string"?(this.sheetName=e,this.sheetId=null):typeof e=="object"&&(this.sheetName=e.sheetName,this.sheetId=e.sheetId))}getSpreadsheetDataUsingFetch(){if(!this.id)return null;let e=`https://docs.google.com/spreadsheets/d/${this.id}/gviz/tq?`;return this.sheetId?e=e.concat(`gid=${this.sheetId}`):this.sheetName&&(e=e.concat(`sheet=${this.sheetName}`)),cZe(e).then(i=>i&&i.ok&&i.text?i.text():null).catch(i=>null)}normalizeRow(e){return e.map(i=>i&&i.v!==null&&i.v!==void 0?i:{})}applyHeaderIntoRows(e,i){return i.map(({c:n})=>this.normalizeRow(n)).map(n=>n.reduce((r,a,o)=>a.v?Object.assign(r,{[e[o]]:a.v}):r,{}))}getItems(e){let i=[];try{const n=JSON.parse(e.split(`
`)[1].replace(/google.visualization.Query.setResponse\(|\);/g,""));if(n.table.cols.some(({label:a})=>!!a)){const a=n.table.cols.map(({label:o})=>o);i=this.applyHeaderIntoRows(a,n.table.rows)}else{const[a,...o]=n.table.rows,s=this.normalizeRow(a.c).map(l=>l.v);i=this.applyHeaderIntoRows(s,o)}}catch{}return i}async parse(e,i){if(e&&(this.id=e),i&&this.parseSheetInfo(i),!this.id)throw new Error("SpreadsheetId is required.");const n=await this.getSpreadsheetDataUsingFetch();return n===null?[]:this.getItems(n)}}S0e?window.PublicGoogleSheetsParser=uF:(z2.exports=uF,z2.exports.default=uF);var uZe=z2.exports;const dZe=o6(uZe);function pZe({callback:t}){const{extension:e}=$e.findExtension({discover:!0,name:Vle}),i=e==null?void 0:e.value;let n;ir({title:"Import participants",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Submit",intent:"is-primary",onClick:()=>{const s=n.url.value;if(s){const l=s.split("/"),c=l.reduce((h,f)=>!h||f.length>h.length?f:h,void 0),u=!i||i&&c!==i,d=i||l.indexOf("docs.google.com")>0&&l.indexOf("spreadsheets")>0,p=u?c:i;if(d)d?new dZe(p).parse().then(f=>nZe({data:f,sheetId:p,callback:t})):ai({message:"URL unchanged",intent:"is-info"});else{const h=Nr.tr("phrases.invalidsheeturl");ai({message:h,intent:"is-danger"}),n.url.value=""}}},close:!0}],content:s=>{n=Wr(s,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])}})}const{ALTERNATE:hZe,WILDCARD:fZe,DIRECT_ACCEPTANCE:nZ,UNGROUPED:mZe}=Gl,{MAIN:rZ,QUALIFYING:gZe}=tr,{INDIVIDUAL:vZe}=Ua,{TEAM:aZ,DOUBLES:yZe}=Xo;function IZe({callback:t,eventName:e,eventType:i,participantType:n,participantIds:r}={}){const a=[aZ,yZe].includes(i)&&n===vZe;if(!(r!=null&&r.length)){ai({message:"Nothing to do",intent:"is-info"});return}const s=[{label:"Main",value:rZ,selected:!0},{label:"Qualifying",value:gZe}].map(({label:p,value:h,selected:f})=>({selected:f,label:p,value:h})),l=[{hide:a,label:"Direct Acceptance",value:nZ,selected:!0},{hide:a,label:"Alternate",value:hZe},{hide:a,label:"Wildcard",value:fZe},{hide:n===aZ,label:"Ungrouped",value:mZe,selected:a}];let c;ir({title:"Add to event",content:p=>c=Wr(p,[{text:`Add ${r.length} participant to ${e}`},{options:s,label:"Event stage",field:"entryStage",value:rZ},{options:l,value:nZ,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=c.entryStatus.value,h=c.entryStage.value;pt(t)&&t({entryStatus:p,entryStage:h})}}]})}function T0e({event:t,participantType:e,table:i,callback:n}){const r=i.getSelectedData(),{eventId:a,eventName:o,eventType:s}=t,l=r.filter(u=>!u.events.map(d=>d.eventId).includes(a)).map(({participantId:u})=>u);IZe({callback:({entryStatus:u,entryStage:d}={})=>{i.deselectRow(),Pt({methods:[{params:{eventId:a,participantIds:l,entryStatus:u,entryStage:d},method:M6}],callback:f=>{f.success?pt(n)&&n():(console.log({result:f}),f.misMatchedGender&&ai({intent:"is-danger",message:"Invalid gender"}))}})},eventName:o,participantType:e,eventType:s,participantIds:l})}const{ALTERNATE:bZe,DIRECT_ACCEPTANCE:wZe,UNGROUPED:SZe,STRUCTURE_SELECTED_STATUSES:TZe}=Gl,{ANY:Kg,FEMALE:WI,MALE:qI,MIXED:KI}=Du,{DOUBLES:Xf,SINGLES:YI,TEAM:Jf}=Xo,{INDIVIDUAL:h1,PAIR:oZ}=Ua,{MAIN:UZe}=tr;function yx({event:t,participants:e,callback:i}={}){var v,y;const n=((v=$e.getEvents().events)==null?void 0:v.length)||0,r={eventType:(t==null?void 0:t.eventType)||YI,eventName:(t==null?void 0:t.eventName)||`Event ${n+1}`,gender:(t==null?void 0:t.gender)||Kg},a=(y=t==null?void 0:t.entries)==null?void 0:y.filter(({entryStatus:I})=>[...TZe,bZe].includes(I)).map(({participantId:I})=>I),o=a?$e.getParticipants({participantFilters:{participantIds:a},withIndividualParticipants:!0}).participants:[],s=[],l=o.reduce((I,b)=>{var w,S;const D=(w=b.person)!=null&&w.sex?[b.person.sex]:((S=b.individualParticpants)==null?void 0:S.map(U=>{var C;return(C=U.person)==null?void 0:C.sex}))||[];return s.push(D),I.includes(b.participantType)?I:I.concat(b.participantType)},[]);let c,u;const d=e==null?void 0:e[0].participantType;if(e!=null&&e.length){r.eventType=d===h1&&YI||d===oZ&&Xf||Jf,d===h1&&(c=[YI,Xf,Jf]),d===oZ&&(c=[Xf]),d===Jf&&(c=[Jf]),u=[Kg];const I=d===h1&&hi.unique(e.map(b=>{var D,w;return(w=(D=b.participant)==null?void 0:D.person)==null?void 0:w.sex})).filter(Boolean);I.length===1&&(I[0]===WI&&u.push(WI),I[0]===qI&&u.push(qI),r.gender=I[0])}if(s.length){u=[Kg],t.gender&&!t.gender===Kg&&u.push(t.gender),t.eventType===Xf&&!u.includes(KI)&&u.push(KI);const I=hi.unique(...s);I.length===1&&!u.includes(I[0])&&u.push(...I)}else t&&(u=[Kg,qI,KI,WI]);const p=()=>{},h=I=>Wr(I,[{error:"minimum of 5 characters",validator:$l(5),placeholder:"Event name",value:r.eventName,onChange:p,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:l.length,value:r.eventType,field:"eventType",label:"Format",options:[{hide:c&&!c.includes(YI),selected:r.eventType===YI,label:"Singles",value:YI},{hide:c&&!c.includes(Xf),selected:r.eventType===Xf,label:"Doubles",value:Xf},{hide:c&&!c.includes(Jf),selected:r.eventType===Jf,label:"Team",value:Jf}],onChange:p},{value:r.gender,label:"Gender",field:"gender",options:[{hide:u&&!u.includes(qI),selected:r.gender===qI,label:"Male",value:qI},{hide:u&&!u.includes(WI),selected:r.gender===WI,label:"Female",value:WI},{selected:r.gender===Kg,label:"Any",value:Kg},{hide:u&&!u.includes(KI),selected:r.gender===KI,label:"Mixed",value:KI}],onChange:p},{hide:t||e,divider:!0}]),f=()=>{const I=Ye.drawer.attributes.content.eventName.value,b=Ye.drawer.attributes.content.eventType.value,D=Ye.drawer.attributes.content.gender.value,w={eventName:I,eventType:b,gender:D},S=U=>{var C,E;if(U.success){const P=(E=(C=U.results)==null?void 0:C[0])==null?void 0:E.event;pt(i)&&i({...U,event:P,eventUpdates:w})}else console.log({result:U})};if(t){const U=t.eventId;Pt({methods:[{method:o9e,params:{eventId:U,eventUpdates:w}}],callback:S})}else{const U=hi.UUID(),C=[{method:K8e,params:{event:{eventId:U,eventName:I,eventType:b,gender:D}}}];if(e!=null&&e.length){const E=e.map(({participantId:N})=>N),P=d===h1&&[Xf,Jf].includes(b)?SZe:wZe,M={params:{eventId:U,participantIds:E,entryStatus:P,entryStage:UZe},method:M6};C.push(M)}Pt({methods:C,callback:S})}},m=(I,b)=>PI(I,[{label:"Cancel",close:!0},{label:"Save",onClick:f,close:!0,intent:"is-info"}],b),g=t!=null&&t.eventId?"Edit event":"Add event";Ye.drawer.open({title:`<b style='larger'>${g}</b>`,width:"300px",side:vt,content:h,footer:m})}const _N=(t,e)=>{const i=t.getSelectedData(),n=t.getData("active").map(o=>o.participantId),r=i.filter(o=>n.includes(o.participantId));yx({callback:o=>{var s,l;if(t.deselectRow(),o!=null&&o.success){const c=(l=(s=o==null?void 0:o.results[0])==null?void 0:s.event)==null?void 0:l.eventId;pt(e)?e({eventId:c}):c&&zn({eventId:c})}},participants:r})},{INDIVIDUAL:sZ,TEAM:lZ,GROUP:cZ}=Ua,{OFFICIAL:uZ}=Uf,U0e=t=>[{label:"Individuals",value:sZ,isActive:t===sZ,close:!0},{label:"Officials",value:uZ,isActive:t===uZ,close:!0},{label:"Groups",value:cZ,isActive:t===cZ,close:!0},{label:"Teams",value:lZ,isActive:t===lZ,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const n=`/tournament/${$e.getTournament().tournamentRecord.tournamentId}/${Tp}/${e.value}`;Ye.router.navigate(n)}}})),{INDIVIDUAL:DZe,GROUP:PZe}=Ua,{OFFICIAL:CZe}=Uf,{MIXED:EZe}=Du;function MZe({view:t}){const{table:e,replaceTableData:i,teamParticipants:n,groupParticipants:r}=L9e({view:t}),a=UI(e),{eventOptions:o,events:s}=b0e(e),{sexOptions:l,genders:c}=Z9e(e),u=()=>pZe({callback:i}),d=()=>{K9e({callback:i,showNotice:!0})},p=t===CZe?"Officials":"Individuals",h=[{onClick:()=>tZe(i),label:"Sign out players not approved for events",close:!0},{label:"Edit ratings",onClick:b=>U8e(b,e),close:!0},{divider:!0},{heading:"Add participants"},{label:"Generate mock participants",onClick:d,close:!0},{label:"Import from Google sheet",onClick:u,close:!0},{onClick:()=>m0e({refresh:i,view:t}),label:"New participant",close:!0}],f=s.map(b=>({onClick:()=>T0e({event:b,participantType:DZe,table:e,callback:i}),label:b.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>_N(e,i),close:!0}]),m=J9({participants:r,participantType:PZe,replaceTableData:i,table:e}),g=J9({participants:n,table:e,replaceTableData:i}),v=V9e(e),y=[{onKeyDown:b=>{b.keyCode===8&&b.target.value.length===1&&a(""),v(b)},onChange:b=>a(b.target.value),onKeyUp:b=>a(b.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:dr,search:!0},{options:f,label:"Add to event",hide:!s.length,intent:"is-none",location:dr},{onClick:()=>_N(e),label:"Create event",hide:s.length,intent:"is-info",location:dr},{selection:g,label:"Add to team",intent:"is-none",location:dr},{selection:m,label:"Add to group",intent:"is-none",location:dr},{onClick:()=>J9e(e),intent:"is-primary",location:dr,label:"Sign in"},{onClick:()=>w0e(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{onKeyDown:b=>{b.keyCode===8&&b.target.value.length===1&&a(""),v(b)},onChange:b=>a(b.target.value),onKeyUp:b=>a(b.target.value),clearSearch:()=>a(""),placeholder:"Search participants",location:Et,search:!0},{hide:(s||[]).length<1,options:o,label:ty,modifyLabel:!0,location:Et,selection:!0},{options:l,label:c[EZe],modifyLabel:!0,location:Et,selection:!0},{options:U0e(t),label:p,intent:"is-info",modifyLabel:!0,location:vt,selection:!0,align:vt},{options:h,label:"Actions",selection:!1,location:vt,align:vt},{onClick:b=>F9e(b,e),label:"Save ratings",intent:"is-primary",class:"saveRatings",location:vt,visible:!1}],I=document.getElementById(nW);ho({table:e,target:I,items:y})}function RZe(t,e){const{individualParticipantIds:i,individualParticipants:n,participantName:r,participantType:a,participantId:o,representing:s}=t,l=(i==null?void 0:i.length)||0;return{events:i0e(t,e),eventIds:t.events.map(({eventId:c})=>c),searchText:r.toLowerCase(),representing:n0e(s),individualParticipants:n,participantName:r,participantType:a,participantId:o,membersCount:l}}function NZe({table:t,team:e}){const n=t.getSelectedData().map(({participantId:o})=>o);t.deselectRow();const r=[{method:u9e,params:{groupingParticipantId:e.participantId,individualParticipantIds:n,suppressErrors:!0}}];Pt({methods:r,callback:o=>{o.success&&t.deleteRow(n)}})}const{ALTERNATE_PARTICIPANT:AZe,ASSIGN_PARTICIPANT:_Ze,QUALIFYING_PARTICIPANT:kZe,SWAP_PARTICIPANTS:OZe}=Ky,xZe={[AZe]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[_Ze]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[kZe]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[OZe]:{selections:"availableAssignments",targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function yE({title:t="Select participant",selectedParticipantIds:e,selectionLimit:i,activeOnEnter:n,selectOnEnter:r,onSelection:a,update:o,action:s}){const l=xZe[s.type];if(!(l!=null&&l.targetAttribute))return;let c,u;const d=()=>{var M;const C=l.targetAttribute,E=l.param||l.targetAttribute,P=Array.isArray(c)?(M=c[0])==null?void 0:M[C]:c==null?void 0:c[C];P&&(s.type==="SWAP"?(s.payload.drawPositions.push(P),a({[E]:s.payload.drawPositions})):a({[E]:P,selected:c}))},p="selectionControl",h="selectionTable",f=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:d,close:!0}],m=()=>{const C=Ye.tables.selectionTable;C==null||C.destroy(),delete Ye.tables.selectionTable},g=`
    <div style='min-height: 420px'>
      <div id='${p}'></div>
      <div id='${h}'></div>
    </div>
  `;o?o({title:t,content:g,buttons:f,onClose:m}):ir({title:t,content:g,buttons:f,onClose:m});const v=C=>{c=C,i&&(c==null?void 0:c.length)===i&&(Mw(),d())},y=s[l.selections],{table:I}=mwe({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:v,anchorId:h,data:y}),b=UI(I),D=()=>{const C=I.getData("active");if(C.length===1){if(r)c=C[0],Mw(),d();else if(n){const E=(c==null?void 0:c.map(M=>M.participantId))||[],P=C[0].participantId;E.includes(P)||(Array.isArray(c)?c.push(C[0]):c=C,I.selectRow([P]),u.participantSearch.value="")}}},S=[{onKeyDown:C=>{C.keyCode===8&&C.target.value.length===1&&b(""),C.key==="Enter"&&D()},onChange:C=>b(C.target.value),onKeyUp:C=>b(C.target.value),clearSearch:()=>b(""),placeholder:"Search entries",id:"participantSearch",location:Et,search:!0,focus:!0}],U=document.getElementById(p);u=ho({table:I,target:U,items:S}).inputs}const{ASSIGN_PARTICIPANT:LZe}=Ky,dF=hi.extractAttributes,FZe=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const n="1px solid #333",r=document.createElement("div");r.style.backgroundColor="white",r.style.border=n,r.style.width="99%",e.className=ok,e.style.display=ct,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBotom=n,e.appendChild(r),t.getElement().appendChild(e);const a=t.getData(),o=d=>{const p={};return d==null?void 0:d.map(h=>{var m;const f=((m=h.person)==null?void 0:m.sex)||"OTHER";return p[f]||(p[f]=0),p[f]+=1,{...h,order:p[f]}})},s=o(a.individualParticipants),l=new na(r,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:s,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:EI()},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",vc),l.on("rowMoved",d=>{const p=d.getTable(),f=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:a.participantId,individualParticipantIds:f}},method:z9}];Pt({methods:m,callback:v=>{if(v.success){const y=p.getRows(),I=y.map(D=>D.getData()),b=o(I);y.forEach((D,w)=>D.update(b[w]))}}})}),ho({table:l,target:i,items:[{onClick:()=>NZe({table:l,team:a}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{onClick:()=>{var g;const d=v=>{if(v.participantId){const y=v.selected,I=(v.selected?v.selected.map(dF("participantId")):[v.participantId]).filter(Boolean),b=(a.individualParticipants??[]).map(dF("participantId")).concat(I);if(I!=null&&I.length){const D=[{method:l0e,params:{groupingParticipantId:a.participantId,individualParticipantIds:I}},{params:{participant:{participantId:a.participantId,individualParticipantIds:b}},method:z9}];Pt({methods:D,callback:S=>{S.success&&(a.individualParticipants=(a.individualParticipants??[]).concat(y),a.membersCount=a.individualParticipants.length,t.update(a),t.getTable().redraw(!0))}})}}},p=((g=a.individualParticipants)==null?void 0:g.map(dF("participantId")))||[],{participants:h}=$e.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),f=h.filter(({participantId:v})=>!p.includes(v));yE({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:LZe,participantsAvailable:f}})},label:"Add players",intent:"is-primary",location:vt}]})},A6="&#9660;",D0e=" &#9654;",ep="&#8964;",P0e=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${A6} </span>`,C0e=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${D0e} </span>`,E0e=ok;function jv(t,e){const i=e.getRow(),n=i._row.element.getElementsByClassName(E0e)[0];if(n){const r=n.style.display!==ct;n.style.display=r?ct:"";const o=i.getCells().find(s=>s.getColumn().getDefinition().field===rce)._cell.element;return o&&(o.innerHTML=r?C0e:P0e),{open:!r}}}function _6(t){const i=t.getRow()._row.element.getElementsByClassName(E0e)[0];return(i==null?void 0:i.style.display)!==ct?C0e:P0e}const{GROUP:$Ze}=Ua;function BZe({view:t}){const e=(i,n)=>{jv(i,n).open};return console.log({view:t}),[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:Et,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:At,resizable:!1,headerSort:!1},{headerMenu:lh({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{cellClick:(i,n)=>e(i,n),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(i,n)=>{var r,a,o;return(o=(r=i==null?void 0:i[0])==null?void 0:r.eventName)==null?void 0:o.localeCompare((a=n==null?void 0:n[0])==null?void 0:a.eventName)},formatter:v0e(zn),visible:t!==$Ze,hozAlign:Et,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:At,field:"membersCount",hozAlign:At,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:At,field:"matchUpsCount",hozAlign:At,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:At,field:"winLoss",hozAlign:At,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:(i,n)=>e(i,n),formatter:_6,responsive:!1,headerSort:!1,hozAlign:vt,field:rce,width:20},{cellClick:EM,formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,width:20}]}const{TEAM:pF}=Ua;function VZe({view:t}={}){let e,i,n,r;const a=()=>({participants:i,derivedEventInfo:n}=$e.getParticipants({participantFilters:{participantTypes:[t||pF]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(u=>RZe(u,n))),o=()=>{setTimeout(()=>e.replaceData(a()),r?0:1e3)},s=BZe({view:t});return(c=>{var p;oh({anchorId:UR});const u=document.getElementById(UR),d=(p=ms(u,"section"))==null?void 0:p.querySelector(".tabHeader");e=new na(u,{headerSortElement:sh(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:t0e,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:FZe,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:c,columns:s}),e.on("dataChanged",h=>{const f=t===pF?"Teams":"Groups";d&&(d.innerHTML=`${f} (${h.length})`)}),e.on("dataFiltered",(h,f)=>{const m=t===pF?"Teams":"Groups";d&&(d.innerHTML=`${m} (${f.length})`)}),e.on("scrollVertical",vc),e.on("tableBuilt",()=>r=!0)})(a()),{table:e,replaceTableData:o}}const jZe={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function GZe({callback:t}={}){const e=[{label:Nr.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";ir({title:"Create Team",content:a=>Wr(a,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:a})=>{const o=a==null?void 0:a.selection.value;if(!o||o===i)return;const s=jZe[o],l=$e.createTeamsFromParticipantAttributes({...s,addParticipants:!1});if(l.newParticipants){const c=[{params:{participants:l.newParticipants},method:vE}];Pt({methods:c,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:dZ}=Ua;function HZe({view:t}){const{table:e,replaceTableData:i}=VZe({view:t}),n=UI(e),{eventOptions:r,events:a}=b0e(e),o=[{label:"New team",onClick:()=>I0e({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>GZe({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>_N(e),close:!0},{divider:!0}].concat(a.filter(({eventType:p})=>p===dZ).map(p=>({onClick:()=>T0e({event:p,participantType:dZ,table:e,callback:i}),label:p.eventName,close:!0}))),c=t==="GROUP"?"Groups":"Teams",u=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:dr,search:!0},{options:l,label:"Add to event",hide:!a.length,intent:"is-none",location:dr},{onClick:()=>_N(e),label:"Create event",hide:a.length,intent:"is-info",location:dr},{onClick:()=>w0e(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:Et,search:!0},{hide:r.length<2,options:r,modifyLabel:!0,label:ty,location:Et,selection:!0},{options:U0e(t),label:c,modifyLabel:!0,intent:"is-info",location:vt,selection:!0,align:vt},{options:o,label:"Actions",selection:!1,location:vt,align:vt}],d=document.getElementById(cW);ho({table:e,target:d,items:u})}const{INDIVIDUAL:zZe,TEAM:WZe,GROUP:qZe}=Ua;function KZe({participantView:t=zZe}={}){const e=t.toUpperCase(),i=[WZe,qZe].includes(e),n=document.getElementById("individuals"),r=document.getElementById("participantGroupings");i?(n.style.display=ct,r.style.display=""):(r.style.display=ct,n.style.display=""),i?HZe({view:e}):MZe({view:e})}const{TEAM:YZe}=Xo,fS=t=>{var A,_,O,x,F;const{potentialParticipants:e,matchUpType:i,matchUpId:n,eventName:r,roundName:a,schedule:o,eventId:s,drawId:l,gender:c,sides:u,...d}=t,{scheduledDate:p,scheduledTime:h,courtName:f}=o||{},m=$=>{var V;return((V=$.person)==null?void 0:V.standardFamilyName)||$.participantName},g=(e==null?void 0:e.map($=>({participantName:$.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((_=u==null?void 0:u[1])==null?void 0:_.participant)||g.shift(),I={participantName:v==null?void 0:v.participantName,sex:(O=v==null?void 0:v.person)==null?void 0:O.sex,participant:v},b={participantName:y==null?void 0:y.participantName,sex:(x=y==null?void 0:y.person)==null?void 0:x.sex,participant:y},D=u.flatMap(({participant:$})=>{var V;return(V=$==null?void 0:$.individualParticipantIds)!=null&&V.length?$.individualParticipantIds:$==null?void 0:$.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),C=(F=d.score)==null?void 0:F.scoreStringSide1,E=u.flatMap($=>{var G,j,z;const V=(G=$.participant)==null?void 0:G.person;return V?[V.standardGivenName,V.standardFamilyName]:(z=(j=$.participant)==null?void 0:j.individualParticipants)==null?void 0:z.map(({person:H})=>[H.standardGivenName,H.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=pce([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),M=t.collectionId?YZe:i,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,R={score:C,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:D,flight:t.drawName,competitiveProfile:N,scheduledDate:p,readyToScore:U,scheduledTime:h,matchUpType:i,scoreDetail:R,winningSide:w,searchText:P,courtName:f,eventName:r,eventType:M,matchUpId:n,roundName:a,complete:S,eventId:s,matchUp:t,gender:c,drawId:l,side1:I,side2:b,score:C}};function M0e(t,e){const i=t.target.id;t.dataTransfer.setData("itemid",i),e&&(t.dataTransfer.setData("itemtype",Yke),t.dataTransfer.setDragImage(Ye.dragMatch,10,10)),t.dataTransfer.effectAllowed="move"}const{MALE:ZZe,FEMALE:XZe}=Du;function JZe(t){function e(a){const o=document.createElement("div"),s=a.getValue(),l=ru(s)&&(s==null?void 0:s.sex)===ZZe&&"#2E86C1"||(s==null?void 0:s.sex)===XZe&&"#AA336A"||"";return o.style.color=l,o.innerHTML=(ru(s)?s.participantName:s)||"",o}function i(a){const o=document.createElement("div");return o.innerHTML=a.getValue(),o}function n(a){const o=a.getElement();return o.classList.add("tag"),o.classList.add("is-info"),o.classList.add("is-light"),(t==null?void 0:t.length)||0}const r=(a,o)=>{var s;return a.participantName&&!o.participantName||o.participantName&&!a.participantName||!(a!=null&&a.participantName)&&!(o!=null&&o.participantName)?1:(s=a==null?void 0:a.participantName)==null?void 0:s.localeCompare(o==null?void 0:o.participantName)};return[{titleFormatter:n,formatter:"rownum",headerSort:!1,hozAlign:At,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const pZ=Object.keys(zle);function QZe(t,e){return pZ.indexOf(t.issue)-pZ.indexOf(e.issue)}function kN(t){var o;const e=t.getData(),i=e.flatMap(s=>Object.values(s).filter(ru)).filter(s=>s.matchUpId),{courtIssues:n,rowIssues:r}=Sg.proConflicts({matchUps:i});n&&((o=Object.keys(n))!=null&&o.length),t.updateData(e);const a=t.getColumns()[0].getCells();r!=null&&r.length&&r.forEach((s,l)=>{const c=l+1,u=a.find(d=>d.getData().rowNumber===c);if(u){u.getElement().classList.forEach(p=>{p.startsWith("matchup")&&u.getElement().classList.remove(p)});const d=u.getData();if(s.length){const p=s.sort(QZe);d.issues=p;const h=zle[p[0].issue];u.getElement().classList.add(h)}else u.getElement().style.backgroundColor="white",d.issues=[]}else console.log("control cell not found",{rowNumber:c})})}function eXe(t,e){var m;t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=na.findTable("#tournamentSchedule")[0],a=n.getData().flatMap(g=>Object.values(g).filter(v=>v.matchUpId)).find(g=>g.matchUpId===i)||{};if(!((m=a==null?void 0:a.schedule)!=null&&m.courtId))return;let o;const s=n.getData().find(g=>(o=Object.keys(g).find(v=>{if(ru(g[v]))return g[v].matchUpId===i}),o)),{courtId:l,courtOrder:c,venueId:u}=a.schedule;s[o]={schedule:{courtOrder:c,courtId:l,venueId:u}},n.updateData([s]),delete a.schedule.scheduledDate,delete a.schedule.scheduledTime,delete a.schedule.courtOrder,delete a.schedule.courtId,delete a.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:G2,params:{tournamentId:a.tournamentId,matchUpId:a.matchUpId,schedule:d,drawId:a.drawId}}];Pt({methods:p,engine:bR,callback:g=>!g.success&&console.log({result:g})}),a.schedule=d;const f=fS(a);e.addRow(f,!0),kN(n)}const{SINGLES:tXe,DOUBLES:iXe}=Xo;function nXe({scheduledDate:t}={}){let e=t,i,n,r;function a(d){const p=d.getElement(),f=d.getData().matchUp.matchUpId;p.id=f,p.addEventListener("dragstart",m=>M0e(m,!0)),p.draggable=!0}function o({scheduledDate:d}){var m;const p=((m=Sg.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:mo.upcomingMatchUpStatuses,matchUpTypes:[tXe,iXe]},nextMatchUps:!0}).matchUps)==null?void 0:m.filter(g=>{var v,y;return!((v=g.schedule)!=null&&v.courtId)&&!((y=g.sides)!=null&&y.some(({bye:I})=>I))}))||[],h=d||e;return i=p.filter(g=>{var v;return!((v=g.schedule)!=null&&v.scheduledDate)||g.schedule.scheduledDate===h}),{rowMatchUps:i.map(fS)}}function s({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:h=[]}=o({scheduledDate:d});r&&r.replaceData(h)},n?0:1e3),{unscheduledMatchUps:i}}const l=JZe(i);oh({anchorId:Dv});const c=document.getElementById(Dv),{rowMatchUps:u=[]}=o({scheduledDate:e});return r=new na(c,{placeholder:"No unscheduled matches",rowFormatter:a,layout:"fitDataStretch",index:"matchUpId",data:u,height:250,columns:l}),r.on("tableBuilt",()=>{n=!0;const d=c.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>eXe(p,r)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),r.on("dataChanged",d=>{const p=r.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),r.on("dataFiltered",(d,p)=>{const h=r.getColumns()[0]._getSelf().titleElement;h.innerHTML=`${p.length}`}),r.on("rowClick",(d,p)=>{const h=p.getData();console.log({matchUp:h})}),{table:r,replaceTableData:s,unscheduledMatchUps:i}}function k6(t,e){return t?hi.dateTime.convertTime(t,e):""}function rXe(t){const e=k6(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function hZ(t){return t.toString()[1]?t:"0"+t}function aXe(t,e){let i=Math.floor(t/3600),n=Math.floor((t-i*(60*60))/60);return e&&(n=0,i+=1,i>23&&(i=0)),`${hZ(i)}:${hZ(n)}`}function fZ(t,e,i,n){return new(i||(i=Promise))(function(r,a){function o(c){try{l(n.next(c))}catch(u){a(u)}}function s(c){try{l(n.throw(c))}catch(u){a(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof i?u:new i(function(d){d(u)})).then(o,s)}l((n=n.apply(t,e||[])).next())})}const mZ=(t,e)=>{const{touches:i}=t,{clientX:n,clientY:r}=t;if(!e)return;const{left:a,top:o}=e.getBoundingClientRect();let s={x:0,y:0};if(i===void 0)s={x:n-a,y:r-o};else if(i!==void 0&&i.length>0&&Object.keys(i).length>0){const{clientX:l,clientY:c}=i[0];s={x:l-a,y:c-o}}return Object.keys(s).length!==0||s.constructor!==Object?s:void 0},Li=(t,e)=>!!t&&t.classList.contains(e),Gc=(t,e,i)=>{if(!t)return;const n=new CustomEvent(e,{detail:i});t.dispatchEvent(n)},hF=(t,e,i)=>((n,r)=>Math.round(n/r)*r)(t,e*i),f1=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(t)+n),fF=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(e)-n).reverse(),m1=t=>{t&&typeof t=="function"&&t()},mF=(t="")=>{const e=t.replace(/(AM|PM|am|pm)/,n=>` ${n}`),i=new Date(`September 20, 2000 ${e}`);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`},ac=(t,e,i,n)=>{if(!t)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const{value:r}=t;if(i){if(typeof i=="boolean"&&i){const[d,p]=new Date().toLocaleTimeString().split(":");if(/[a-z]/i.test(p)&&e==="12h"){const[h,f]=p.split(" ");return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:h,type:f}}return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:p,type:void 0}}{const{time:d,locales:p,preventClockType:h}=i;let f=d;if(d||(f=new Date),h&&n){const[v,y]=new Date(f).toLocaleTimeString().split(":");if(/[a-z]/i.test(y)){const[I,b]=y.split(" ");return{hour:v,minutes:I,type:b}}return{hour:Number(v)<=9?`0${Number(v)}`:v,minutes:y,type:void 0}}const[m,g]=new Date(f).toLocaleTimeString(p,{timeStyle:"short"}).split(":");if(/[a-z]/i.test(g)&&e==="12h"){const[v,y]=g.split(" ");return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:v,type:y}}if(e==="12h"){const[v,y]=new Date(`1970-01-01T${m}:${g}Z`).toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}).split(":"),[I,b]=y.split(" ");return{hour:Number(v)<=9?`0${Number(v)}`:m,minutes:I,type:b}}return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:g,type:void 0}}}if(r===""||!r)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const[a,o]=r.split(" "),[s,l]=a.split(":");if(/[a-z]/i.test(a))return{error:"The input contains invalid letters or whitespace."};if(r.includes(" ")){if(!o)return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 5), currentLength: ${r.length}.`,currentLength:r.length};if(r.length>8||o!=="AM"&&o!=="PM")return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 8), currentLength: ${r.length} or invalid type (PM or AM), currentType: ${o}.`,currentLength:r.length,currentType:o}}let c=Number(l);const u=Number(s);return c<10?c=`0${c}`:c===0&&(c="00"),e==="12h"?u>12||c>59||c<0||u===0||o!=="AM"&&o!=="PM"?{error:`The input contains invalid letters or numbers. Problem is with hour which should be less than 13 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)} or invalid type (PM or AM), currentType: ${o}.`,currentHour:u,currentMin:c,currentType:o}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString(),type:o}:u<0||u>23||c>59?{error:`The input contains invalid numbers. Problem is with hour which should be less than 24 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)}`,currentHour:u,currentMin:c}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString()}},pm=(t,e,i)=>{const n=Number(t);return e==="hour"?i!=="24h"?n>0&&n<=12:n>=0&&n<=23:e==="minutes"?n>=0&&n<=59:void 0},g1=(t,e,i,n)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(r=>pm(r,e,i)).some(r=>r===!1);if(typeof t=="string"||typeof t=="number"){const r=pm(t,e,i),a=n==null?void 0:n.map(Number).includes(Number(t));return!(!r||a)}}};function Ix(t,e){e===void 0&&(e={});var i=e.insertAt;if(t&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",i==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}Ix(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui * {
  box-sizing: border-box !important;
}
.timepicker-ui-modal {
  font-family: "Roboto", sans-serif;
  position: fixed;
  opacity: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(156, 155, 155, 0.6);
  z-index: 5000;
  pointer-events: none;
}
.timepicker-ui-modal.show {
  pointer-events: auto;
}
.timepicker-ui-modal.removed {
  top: auto;
  bottom: auto;
  left: auto;
  right: auto;
  background-color: transparent;
}
.timepicker-ui-measure {
  position: absolute;
  top: -9999px;
  width: 3.125rem;
  height: 3.125rem;
  overflow: scroll;
}
.timepicker-ui-wrapper, .timepicker-ui-wrapper.mobile {
  position: fixed;
  z-index: 5001;
  width: 328px;
  height: 500px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  outline: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    flex-direction: row;
    height: 360px;
    width: 584px;
  }
}
@media screen and (max-width: 330px) and (orientation: portrait) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    width: 315px;
  }
}
.timepicker-ui-wrapper.mobile {
  height: 218px;
}
@media screen and (max-width: 330px) {
  .timepicker-ui-wrapper.mobile {
    width: 315px;
  }
}
.timepicker-ui-header, .timepicker-ui-header.mobile {
  padding-top: 52px;
  padding-bottom: 36px;
  padding-right: 24px;
  padding-left: 24px;
  height: 104px;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  position: relative;
  height: 100%;
}
.timepicker-ui-header.mobile {
  padding-bottom: 0;
  padding-top: 35px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-header:not(.timepicker-ui-header + .mobile) {
    height: auto;
    flex-direction: column;
  }
}
.timepicker-ui-select-time, .timepicker-ui-select-time.mobile {
  text-transform: uppercase;
  position: absolute;
  top: 16px;
  left: 24px;
  font-size: 12px;
  color: #a9a9a9;
}
.timepicker-ui-body {
  height: 256px;
  width: 256px;
  margin: 0 auto;
  position: relative;
  border-radius: 100%;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-body {
    padding-right: 0;
    padding-left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 23px;
  }
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-landspace {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
}
.timepicker-ui-footer, .timepicker-ui-footer-mobile {
  height: 76px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-footer:not(.timepicker-ui-footer + .mobile) {
    justify-content: flex-end;
  }
}
.timepicker-ui-footer.mobile {
  align-items: flex-start;
}
.timepicker-ui-clock-face {
  background-color: #e0e0e0;
  height: 100%;
  width: 100%;
  border-radius: 100%;
  position: relative;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-clock-face {
    height: 256px;
    width: 256px;
    top: 15px;
  }
}
.timepicker-ui-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  user-select: none;
  touch-action: none;
  transform: translate(-50%, -50%);
  background-color: #6200ee;
  height: 8px;
  width: 8px;
  border-radius: 100%;
}
.timepicker-ui-tips-wrapper {
  height: 100%;
  width: 100%;
}
.timepicker-ui-tips-wrapper-24h {
  position: absolute;
  height: 160px;
  width: 160px;
  z-index: 0;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  border-radius: 50%;
}
.timepicker-ui-tips-wrapper-24h-disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12, .timepicker-ui-minutes-time, .timepicker-ui-hour-time-24 {
  position: absolute;
  width: 32px;
  height: 32px;
  text-align: center;
  cursor: pointer;
  font-size: 17.6px;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 span, .timepicker-ui-minutes-time span, .timepicker-ui-hour-time-24 span {
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 {
  display: block;
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-wrapper-time, .timepicker-ui-wrapper-time.mobile {
  display: flex;
  margin-right: 10px;
  height: 100%;
  justify-content: center;
  align-items: center;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-time:not(.timepicker-ui-wrapper-time + .mobile) {
    margin-right: 0;
    height: auto;
  }
}
.timepicker-ui-wrapper-time-24h {
  margin-right: 0px;
}
.timepicker-ui-wrapper-time.mobile {
  position: relative;
}
.timepicker-ui-hour, .timepicker-ui-minutes, .timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 51.2px;
  background-color: #e4e4e4;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.3s ease;
  outline: none;
  border: 2px solid transparent;
  padding: 10px;
  width: 96px;
  text-align: center;
}
.timepicker-ui-hour:focus-visible, .timepicker-ui-minutes:focus-visible, .timepicker-ui-hour.mobile:focus-visible, .timepicker-ui-minutes.mobile:focus-visible {
  outline: auto;
}
.timepicker-ui-hour:hover, .timepicker-ui-hour.active, .timepicker-ui-minutes:hover, .timepicker-ui-minutes.active, .timepicker-ui-hour.mobile:hover, .timepicker-ui-hour.mobile.active, .timepicker-ui-minutes.mobile:hover, .timepicker-ui-minutes.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-hour::-webkit-outer-spin-button, .timepicker-ui-hour::-webkit-inner-spin-button, .timepicker-ui-minutes::-webkit-outer-spin-button, .timepicker-ui-minutes::-webkit-inner-spin-button, .timepicker-ui-hour.mobile::-webkit-outer-spin-button, .timepicker-ui-hour.mobile::-webkit-inner-spin-button, .timepicker-ui-minutes.mobile::-webkit-outer-spin-button, .timepicker-ui-minutes.mobile::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}
.timepicker-ui-hour[type=number], .timepicker-ui-minutes[type=number], .timepicker-ui-hour.mobile[type=number], .timepicker-ui-minutes.mobile[type=number] {
  -moz-appearance: textfield !important;
}
.timepicker-ui-hour, .timepicker-ui-minutes {
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour[contenteditable=true]:focus, .timepicker-ui-hour[contenteditable=true]:active, .timepicker-ui-minutes[contenteditable=true]:focus, .timepicker-ui-minutes[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  height: 70px;
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour.mobile[contenteditable=true]:focus, .timepicker-ui-hour.mobile[contenteditable=true]:active, .timepicker-ui-minutes.mobile[contenteditable=true]:focus, .timepicker-ui-minutes.mobile[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-dots, .timepicker-ui-dots.mobile {
  padding-left: 5px;
  padding-right: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 57.6px;
  user-select: none;
  touch-action: none;
}
.timepicker-ui-wrapper-type-time, .timepicker-ui-wrapper-type-time.mobile {
  display: flex;
  flex-direction: column;
  height: 80px;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #787878;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-type-time {
    flex-direction: row;
    width: 100%;
  }
}
.timepicker-ui-wrapper-type-time.mobile {
  height: 70px;
}
.timepicker-ui-am, .timepicker-ui-pm, .timepicker-ui-am.mobile, .timepicker-ui-pm.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #d6d6d6;
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.timepicker-ui-am:hover, .timepicker-ui-am.active, .timepicker-ui-pm:hover, .timepicker-ui-pm.active, .timepicker-ui-am.mobile:hover, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile:hover, .timepicker-ui-pm.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-am.active, .timepicker-ui-pm.active, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile.active {
  pointer-events: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile), .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-am, .timepicker-ui-am.mobile {
  border-top-left-radius: 7px;
  border-top-right-radius: 7px;
  border-bottom-width: 0.3752px;
}
.timepicker-ui-am.mobile {
  border-bottom-left-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile) {
    border-top-left-radius: 7px;
    border-bottom-left-radius: 7px;
    border-top-right-radius: 0;
    border-top-width: 1.5008px;
    border-right-width: 0.3752px;
  }
}
.timepicker-ui-pm, .timepicker-ui-pm.mobile {
  border-bottom-left-radius: 7px;
  border-bottom-right-radius: 7px;
  border-top-width: 0.3752px;
  width: 54px;
}
.timepicker-ui-pm.mobile {
  border-top-right-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    border-bottom-right-radius: 7px;
    border-top-right-radius: 7px;
    border-bottom-left-radius: 0;
    border-bottom-width: 1.5008px;
    border-left-width: 0.3752px;
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-cancel-btn, .timepicker-ui-ok-btn, .timepicker-ui-cancel-btn.mobile, .timepicker-ui-ok.btn-mobile {
  color: #6200ee;
  text-transform: uppercase;
  border-radius: 7px;
  background-color: transparent;
  text-align: center;
  font-size: 15.2px;
  padding-top: 9px;
  padding-bottom: 9px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
}
.timepicker-ui-cancel-btn:hover, .timepicker-ui-ok-btn:hover, .timepicker-ui-cancel-btn.mobile:hover, .timepicker-ui-ok.btn-mobile:hover {
  background-color: #d6d6d6;
}
.timepicker-ui-cancel-btn, .timepicker-ui-cancel-btn.mobile {
  width: 72px;
  margin-right: 4px;
}
.timepicker-ui-ok-btn, .timepicker-ui-ok-btn.mobile {
  width: 64px;
  margin-left: 4px;
}
.timepicker-ui-wrapper-btn, .timepicker-ui-keyboard-icon, .timepicker-ui-wrapper-btn-mobile, .timepicker-ui-keyboard-icon-mobile {
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
  width: 44px;
  height: 44px;
  position: relative;
  bottom: -26px;
  left: 12px;
  transition: all 0.3s ease;
}
.timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #d6d6d6;
  border-radius: 7px;
}
.timepicker-ui-keyboard-icon-wrapper.mobile {
  bottom: -5px;
}
.timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon.mobile {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #4e545a;
  height: 44px;
  width: 44px;
}
.timepicker-ui-keyboard-icon:hover, .timepicker-ui-keyboard-icon.mobile:hover {
  color: #6200ee;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
    position: absolute;
    bottom: 8px;
  }
}
.timepicker-ui-wrapper-btn, .timepicker-ui-wrapper-btn.mobile {
  margin-right: 8px;
  position: relative;
  bottom: -14px;
}
.timepicker-ui-hour-text, .timepicker-ui-minute-text, .timepicker-ui-hour-text.mobile, .timepicker-ui-minute-text.mobile {
  position: absolute;
  bottom: 6px;
  font-size: 12.8px;
  color: #a9a9a9;
  left: 0;
}
.timepicker-ui-minute-text, .timepicker-ui-minute-text.mobile {
  left: 120px;
}
.timepicker-ui-clock-hand {
  position: absolute;
  background-color: #6200ee;
  bottom: 50%;
  height: 40%;
  left: calc(50% - 1px);
  transform-origin: center bottom 0;
  width: 2px;
}
.timepicker-ui-clock-hand-24h {
  height: 23%;
}
.timepicker-ui-circle-hand {
  position: absolute;
  transform: translate(-48%, -50%);
  width: 4px;
  height: 4px;
  border-radius: 100%;
  transition: all 0.2s ease;
  height: 46px;
  width: 46px;
  box-sizing: border-box !important;
  background-color: #6200ee;
}
.timepicker-ui-circle-hand.small-circle {
  height: 36px;
  width: 36px;
  box-sizing: border-box !important;
}
.timepicker-ui-circle-hand-24h {
  transform: translate(-50%, -50%);
  height: 32px;
  width: 32px;
  top: 4px;
  left: 1px;
}
.timepicker-ui-value-tips, .timepicker-ui-value-tips-24h {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s ease color;
  border-radius: 50%;
  outline: none;
}
.timepicker-ui-value-tips:focus, .timepicker-ui-value-tips-24h:focus {
  background: rgba(143, 143, 143, 0.315);
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.timepicker-ui-value-tips.active, .timepicker-ui-value-tips-24h.active {
  color: #fff;
  transition: none;
}
.timepicker-ui-clock-animation {
  animation: clockanimation 350ms linear;
}
.timepicker-ui-open-element.disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-tips-animation {
  transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, height 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.timepicker-ui-tips-disabled {
  color: rgba(156, 155, 155, 0.6);
  pointer-events: none;
}

.opacity {
  transition: opacity 0.15s linear;
}
.opacity.show {
  opacity: 1;
}

.invalid-value {
  border-color: #d50000 !important;
  color: #d50000 !important;
}
.invalid-value:hover, .invalid-value:focus, .invalid-value:active {
  border-color: #d50000 !important;
  color: #d50000 !important;
}

@keyframes clockanimation {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.timepicker-ui-invalid-format {
  border: 2px solid red;
  color: red;
}

.timepicker-ui-invalid-text {
  color: red;
}`);Ix(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-wrapper.crane-straight, .timepicker-ui-wrapper.mobile.crane-straight {
  border-radius: 0;
  background-color: #4e0d3a;
  color: #fff;
}
.timepicker-ui-wrapper.crane-straight.radius, .timepicker-ui-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-select-time.crane-straight, .timepicker-ui-select-time.mobile.crane-straight {
  color: #e5e5e5;
}
.timepicker-ui-clock-face.crane-straight, .timepicker-ui-clock-face.mobile.crane-straight {
  background-color: #71135c;
}
.timepicker-ui-dot.crane-straight, .timepicker-ui-dot.mobile.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-hour.crane-straight, .timepicker-ui-minutes.crane-straight, .timepicker-ui-hour.mobile.crane-straight, .timepicker-ui-minutes.mobile.crane-straight {
  background-color: #71135c;
  border-radius: 0;
  color: #fff;
}
.timepicker-ui-hour.crane-straight.radius, .timepicker-ui-minutes.crane-straight.radius, .timepicker-ui-hour.mobile.crane-straight.radius, .timepicker-ui-minutes.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-hour.crane-straight:hover, .timepicker-ui-hour.crane-straight.active, .timepicker-ui-minutes.crane-straight:hover, .timepicker-ui-minutes.crane-straight.active, .timepicker-ui-hour.mobile.crane-straight:hover, .timepicker-ui-hour.mobile.crane-straight.active, .timepicker-ui-minutes.mobile.crane-straight:hover, .timepicker-ui-minutes.mobile.crane-straight.active {
  background-color: #f7363e;
}
.timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:active, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:active {
  border-color: #fff;
  outline-color: #fff;
}
.timepicker-ui-dots.crane-straight, .timepicker-ui-dots.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-wrapper-type-time.crane-straight, .timepicker-ui-wrapper-type-time.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-am.crane-straight, .timepicker-ui-pm.crane-straight, .timepicker-ui-am.mobile.crane-straight, .timepicker-ui-pm.mobile.crane-straight {
  border: 0.125rem solid transparent;
  border-radius: 0;
  background-color: #71135c;
}
.timepicker-ui-am:hover.crane-straight, .timepicker-ui-am.active.crane-straight, .timepicker-ui-pm:hover.crane-straight, .timepicker-ui-pm.active.crane-straight, .timepicker-ui-am.mobile:hover.crane-straight, .timepicker-ui-am.mobile.active.crane-straight, .timepicker-ui-pm.mobile:hover.crane-straight, .timepicker-ui-pm.mobile.active.crane-straight {
  color: #fff;
  background-color: #f7363e;
}
.timepicker-ui-am.crane-straight.radius {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.timepicker-ui-pm.crane-straight.radius {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile).crane-straight.radius {
    border-bottom-left-radius: 1.25rem;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile).crane-straight.radius {
    border-bottom-right-radius: 1.25rem;
    border-top-right-radius: 1.25rem;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-am.mobile.crane-straight.radius {
    border-bottom-left-radius: 0rem;
    border-bottom-right-radius: 0rem;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-pm.mobile.crane-straight.radius {
    border-top-left-radius: 0rem;
    border-top-right-radius: 0rem;
  }
}
.timepicker-ui-cancel-btn.crane-straight, .timepicker-ui-ok-btn.crane-straight, .timepicker-ui-cancel-btn.mobile.crane-straight, .timepicker-ui-ok-btn.mobile.crane-straight {
  color: #fff;
  border-radius: 0rem;
}
.timepicker-ui-cancel-btn.crane-straight.radius, .timepicker-ui-ok-btn.crane-straight.radius, .timepicker-ui-cancel-btn.mobile.crane-straight.radius, .timepicker-ui-ok-btn.mobile.crane-straight.radius {
  border-radius: 0.8125rem;
}
.timepicker-ui-cancel-btn:hover.crane-straight, .timepicker-ui-ok-btn:hover.crane-straight, .timepicker-ui-cancel-btn.mobile:hover.crane-straight, .timepicker-ui-ok-btn.mobile:hover.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #f7363e;
  color: #fff;
  border-radius: 0;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile {
  border-radius: 0.875rem;
}
.timepicker-ui-keyboard-icon.crane-straight:hover, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover {
  color: #fff;
}
.timepicker-ui-keyboard-icon.crane-straight:hover.radius, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-clock-hand.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-circle-hand.crane-straight {
  border-color: #f7363e;
  background-color: #f7363e;
}
.timepicker-ui-value-tips.crane-straight {
  color: #fff;
}`);Ix(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-hour-time-12.m3, .timepicker-ui-hour-time-24.m3 {
  color: #1a1c18;
}
.timepicker-ui-wrapper.m3 {
  border-radius: 35px;
  background-color: #e5eadc;
  box-shadow: unset;
}
.timepicker-ui-hour.active.m3, .timepicker-ui-minutes.active.m3 {
  background-color: #b8f397;
  color: #042100;
}
.timepicker-ui-minutes.m3, .timepicker-ui-hour.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-minutes:hover.m3, .timepicker-ui-hour:hover.m3 {
  color: #386a20;
}
.timepicker-ui-clock-face.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-clock-hand.m3, .timepicker-ui-dot.m3, .timepicker-ui-circle-hand.m3 {
  background-color: #386a20 !important;
}
.timepicker-ui-cancel-btn.m3, .timepicker-ui-ok-btn.m3 {
  color: #386a20;
}
.timepicker-ui-cancel-btn:hover.m3, .timepicker-ui-ok-btn:hover.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-wrapper-type-time.m3 {
  color: #6b7165;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3, .timepicker-ui-pm.m3, .timepicker-ui-pm.m3 {
  border-color: #74796e;
  border-width: 1px;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3 {
  border-bottom-width: 0px;
}
.timepicker-ui-am:hover.m3, .timepicker-ui-am.active.m3, .timepicker-ui-pm:hover.m3, .timepicker-ui-pm.active.m3 {
  background-color: #bbebeb;
  color: #002021;
}
.timepicker-ui-hour.mobile:hover.m3, .timepicker-ui-minutes.mobile:hover.m3 {
  background-color: #dfe4d6;
}`);var XS=`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}`;Ix(XS);const oXe={amLabel:"AM",animation:!0,appendModalSelector:"",backdrop:!0,cancelLabel:"CANCEL",editable:!1,enableScrollbar:!1,enableSwitchIcon:!1,mobileTimeLabel:"Enter Time",focusInputAfterCloseModal:!1,hourMobileLabel:"Hour",iconTemplate:'<i class="material-icons timepicker-ui-keyboard-icon">keyboard</i>',iconTemplateMobile:'<i class="material-icons timepicker-ui-keyboard-icon">schedule</i>',incrementHours:1,incrementMinutes:1,minuteMobileLabel:"Minute",mobile:!1,okLabel:"OK",pmLabel:"PM",timeLabel:"Select Time",switchToMinutesAfterSelectHour:!1,theme:"basic",clockType:"12h",disabledTime:void 0,currentTime:void 0,focusTrap:!0,delayHandler:300},gF="mousedown mouseup mousemove mouseleave mouseover touchstart touchmove touchend",gZ=["00","13","14","15","16","17","18","19","20","21","22","23"],ZI=["12","1","2","3","4","5","6","7","8","9","10","11"],Yg=["00","05","10","15","20","25","30","35","40","45","50","55"];class bh{constructor(e){this.clean=()=>{var i,n;const r=(i=this.tipsWrapper)===null||i===void 0?void 0:i.querySelectorAll("span.timepicker-ui-hour-time-12"),a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-minutes-time");this._removeClasses(r),this._removeClasses(a)},this.create=()=>{var i;if(!(this.clockFace&&this.array&&this.classToAdd&&this.tipsWrapper))return;const n=(this.clockFace.offsetWidth-32)/2,r=(this.clockFace.offsetHeight-32)/2,a=n-9;this.tipsWrapper.innerHTML="",(i=this.array)===null||i===void 0||i.forEach((o,s)=>{var l,c,u,d,p,h;const f=s*(360/this.array.length)*(Math.PI/180),m=document.createElement("span"),g=document.createElement("span");g.innerHTML=o,this.disabledTime&&(Array.isArray(this.disabledTime)&&(!((l=this.disabledTime)===null||l===void 0)&&l.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled")),this.hour===this.disabledTime.removedStartedHour&&(!((u=(c=this.disabledTime)===null||c===void 0?void 0:c.startMinutes)===null||u===void 0)&&u.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1),this.hour===this.disabledTime.removedEndHour&&(!((p=(d=this.disabledTime)===null||d===void 0?void 0:d.endMinutes)===null||p===void 0)&&p.includes(o))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1)),this.clockType==="24h"?(g.classList.add("timepicker-ui-value-tips-24h"),Li(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)):(g.classList.add("timepicker-ui-value-tips"),Li(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)),m.classList.add(this.classToAdd),this.theme==="crane-straight"&&(m.classList.add("crane-straight"),g.classList.add("crane-straight")),this.theme==="m3"&&(m.classList.add("m3"),g.classList.add("m3")),m.style.left=n+Math.sin(f)*a-m.offsetWidth+"px",m.style.bottom=r+Math.cos(f)*a-m.offsetHeight+"px",m.appendChild(g),(h=this.tipsWrapper)===null||h===void 0||h.appendChild(m)})},this.updateDisable=i=>{var n,r;const a=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-hour-time-12"),o=(r=this.tipsWrapper)===null||r===void 0?void 0:r.querySelectorAll("span.timepicker-ui-minutes-time");if(this._removeClasses(a),this._removeClasses(o),i!=null&&i.hoursToUpdate&&a&&this._addClassesWithIncludes(a,i.hoursToUpdate),(i==null?void 0:i.minutesToUpdate)&&o){const{actualHour:s,removedEndHour:l,removedStartedHour:c,startMinutes:u,endMinutes:d}=i.minutesToUpdate;l===s&&d.length>0?this._addClassesWithIncludes(o,d):Number(s)>Number(c)&&Number(s)<Number(l)&&this._addClasses(o),c===s&&u.length>0?this._addClassesWithIncludes(o,u):Number(s)>Number(c)&&Number(s)<Number(l)&&this._addClasses(o)}if(i){const{amHours:s,pmHours:l,activeMode:c,startMinutes:u,endMinutes:d,removedAmHour:p,removedPmHour:h,actualHour:f}=i.minutesToUpdate;if(!s||!l)return;a&&(s&&c==="AM"&&this._addClassesWithIncludes(a,s),l&&c==="PM"&&this._addClassesWithIncludes(a,l)),o&&u&&d&&(c==="AM"&&(d[0]==="00"&&d.length===1&&u.length===0&&Number(f)>=Number(s[0])&&this._addClasses(o),u.length===0&&d.length>1&&Number(f)>=Number(p)&&this._addClasses(o),u.length>0&&d.length>1&&d[0]==="00"&&(Number(p)===Number(f)?this._addClassesWithIncludes(o,u):Number(f)>Number(p)&&this._addClasses(o)),d[0]==="00"&&d.length===1&&u.length>0&&(Number(p)===Number(f)?this._addClassesWithIncludes(o,u):Number(f)>Number(p)&&this._addClasses(o))),c==="PM"&&(f<Number(h)&&this._addClasses(o),f===h&&this._addClassesWithIncludes(o,d),d.length>0&&Number(f)===h-1&&this._addClassesWithIncludes(o,d)))}},this._removeClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.remove("timepicker-ui-tips-disabled"),r[0].classList.remove("timepicker-ui-tips-disabled"),r[0].tabIndex=0})},this._addClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.add("timepicker-ui-tips-disabled"),r[0].classList.add("timepicker-ui-tips-disabled"),r[0].tabIndex=-1})},this._addClassesWithIncludes=(i,n)=>{i==null||i.forEach(({classList:r,children:a,textContent:o})=>{n!=null&&n.includes(o)&&(r.add("timepicker-ui-tips-disabled"),a[0].classList.add("timepicker-ui-tips-disabled"),a[0].tabIndex=-1)})},this.array=e==null?void 0:e.array,this.classToAdd=e==null?void 0:e.classToAdd,this.clockFace=e==null?void 0:e.clockFace,this.tipsWrapper=e==null?void 0:e.tipsWrapper,this.theme=e==null?void 0:e.theme,this.clockType=e==null?void 0:e.clockType,this.disabledTime=e==null?void 0:e.disabledTime,this.hour=e==null?void 0:e.hour}}const vZ=(t,e)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{t(...n)},e)}};class sXe{constructor(e,i){var n,r,a;this.create=()=>{this._updateInputValueWithCurrentTimeOnStart(),this._checkDisabledValuesOnStart(),this._setTimepickerClassToElement(),this._setInputClassToInputElement(),this._setDataOpenToInputIfDosentExistInWrapper(),this._setClassTopOpenElement(),this._handleOpenOnEnterFocus(),this._handleOpenOnClick(),this._getDisableTime()},this.open=o=>{this.create(),this._eventsBundle(),m1(o)},this.close=()=>vZ((...o)=>{var s;if(o.length>2||!this.modalElement)return;const[l]=o.filter(u=>typeof u=="boolean"),[c]=o.filter(u=>typeof u=="function");l&&(this._handleOkButton(),(s=this.okButton)===null||s===void 0||s.click()),this._isTouchMouseMove=!1,gF.split(" ").map(u=>document.removeEventListener(u,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),document.removeEventListener("keypress",this._handleEscClick),this.wrapper.removeEventListener("keydown",this._focusTrapHandler),this._options.enableSwitchIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._removeAnimationToClose(),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{var u;this._options.focusInputAfterCloseModal&&((u=this.input)===null||u===void 0||u.focus()),this.modalElement!==null&&(this.modalElement.remove(),this._isModalRemove=!0)},300),m1(c)},this._options.delayHandler||300),this.destroy=o=>{gF.split(" ").map(s=>document.removeEventListener(s,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),this._options.enableSwitchIcon&&this.keyboardClockIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._cloned=this._element.cloneNode(!0),this._element.after(this._cloned),this._element.remove(),this._element=null,this._element===null&&m1(o),this._element=this._cloned},this.update=(o,s)=>{this._options=Object.assign(Object.assign({},this._options),o.options),this._checkMobileOption(),o.create&&this.create(),m1(s)},this._preventClockTypeByCurrentTime=()=>{var o,s,l,c,u;if(typeof((o=this._options)===null||o===void 0?void 0:o.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.preventClockType)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{currentTime:d,clockType:p}=this._options,{type:h}=ac(this.input,p,d,!0);this._options.clockType=h?"12h":"24h"}},this._updateInputValueWithCurrentTimeOnStart=()=>{var o,s,l,c,u;if(typeof((o=this._options)===null||o===void 0?void 0:o.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.updateInput)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{hour:d,minutes:p,type:h}=ac(this.input,this._options.clockType,this._options.currentTime);this.input.value=h?`${d}:${p} ${h}`:`${d}:${p}`}},this._setTheme=()=>{var o,s;const l=(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("div"),c=[...(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("input"),...l],{theme:u}=this._options;u==="crane-straight"?c.forEach(d=>d.classList.add("crane-straight")):u==="crane-radius"?c.forEach(d=>d.classList.add("crane-straight","radius")):u==="m3"&&c.forEach(d=>d.classList.add("m3"))},this._setInputClassToInputElement=()=>{var o;Li(this.input,"timepicker-ui-input")||(o=this.input)===null||o===void 0||o.classList.add("timepicker-ui-input")},this._setDataOpenToInputIfDosentExistInWrapper=()=>{var o;this.openElementData===null&&((o=this.input)===null||o===void 0||o.setAttribute("data-open","timepicker-ui-input"))},this._setClassTopOpenElement=()=>{this.openElement.forEach(o=>o==null?void 0:o.classList.add("timepicker-ui-open-element"))},this._removeBackdrop=()=>{var o;this._options.backdrop||((o=this.modalElement)===null||o===void 0||o.classList.add("removed"),this.openElement.forEach(s=>s==null?void 0:s.classList.add("disabled")))},this._setNormalizeClass=()=>{var o,s;const l=(o=this.modalElement)===null||o===void 0?void 0:o.querySelectorAll("div");(s=this.modalElement)===null||s===void 0||s.classList.add("timepicker-ui-normalize"),l==null||l.forEach(c=>c.classList.add("timepicker-ui-normalize"))},this._setFlexEndToFooterIfNoKeyboardIcon=()=>{!this._options.enableSwitchIcon&&this.footer&&(this.footer.style.justifyContent="flex-end")},this._eventsBundle=()=>{var o,s,l,c,u,d,p,h,f,m,g,v,y;if(this._isModalRemove){if(this._handleEscClick(),this._setErrorHandler(),this._removeErrorHandler(),this.openElement.forEach(I=>I==null?void 0:I.classList.add("disabled")),(o=this.input)===null||o===void 0||o.blur(),this._setScrollbarOrNot(),this._setModalTemplate(),this._setNormalizeClass(),this._removeBackdrop(),this._setBgColorToCirleWithHourTips(),this._setOnStartCSSClassesIfClockType24h(),this._setClassActiveToHourOnOpen(),this.clockFace!==null){const I=new bh({array:ZI,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,clockType:"12h",hour:this.hour.value});I.create(),this._options.clockType==="24h"?new bh({array:gZ,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:!((h=(p=this._disabledTime)===null||p===void 0?void 0:p.value)===null||h===void 0)&&h.isInterval?(f=this._disabledTime)===null||f===void 0?void 0:f.value.rangeArrHour:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.hours,hour:this.hour.value}).create():(((v=this._disabledTime)===null||v===void 0?void 0:v.value.startType)===((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)?setTimeout(()=>{var b,D,w,S,U,C,E,P;((b=this._disabledTime)===null||b===void 0?void 0:b.value.startType)===((D=this.activeTypeMode)===null||D===void 0?void 0:D.textContent)&&I.updateDisable({hoursToUpdate:(S=(w=this._disabledTime)===null||w===void 0?void 0:w.value)===null||S===void 0?void 0:S.rangeArrHour,minutesToUpdate:{endMinutes:(U=this._disabledTime)===null||U===void 0?void 0:U.value.endMinutes,removedEndHour:(C=this._disabledTime)===null||C===void 0?void 0:C.value.removedEndHour,removedStartedHour:(E=this._disabledTime)===null||E===void 0?void 0:E.value.removedStartedHour,actualHour:this.hour.value,startMinutes:(P=this._disabledTime)===null||P===void 0?void 0:P.value.startMinutes}})},300):setTimeout(()=>{var b,D,w;I.updateDisable({minutesToUpdate:{actualHour:this.hour.value,pmHours:(b=this._disabledTime)===null||b===void 0?void 0:b.value.pmHours,amHours:(D=this._disabledTime)===null||D===void 0?void 0:D.value.amHours,activeMode:(w=this.activeTypeMode)===null||w===void 0?void 0:w.textContent}})},300),I.updateDisable())}this._setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this._setTheme()},0),this._setAnimationToOpen(),this._getInputValueOnOpenAndSet(),this._toggleClassActiveToValueTips(this.hour.value),this._isMobileView||(this._setTransformToCircleWithSwitchesHour(this.hour.value),this._handleAnimationClock()),this._handleMinutesEvents(),this._handleHourEvents(),this._options.clockType!=="24h"&&(this._handleAmClick(),this._handlePmClick()),this.clockFace&&this._handleMoveHand(),this._handleCancelButton(),this._handleOkButton(),this.modalElement&&(this._setShowClassToBackdrop(),this._handleBackdropClick()),this._handleIconChangeView(),this._handleClickOnHourMobile(),this._options.focusTrap&&this._focusTrapHandler()}},this._handleOpenOnClick=()=>{this.openElement.forEach(o=>this._clickTouchEvents.forEach(s=>o==null?void 0:o.addEventListener(s,()=>this._eventsBundle())))},this._getInputValueOnOpenAndSet=()=>{var o,s;const l=ac(this.input,this._options.clockType,this._options.currentTime);if(l===void 0)return this.hour.value="12",this.minutes.value="00",Gc(this._element,"show",{hour:this.hour.value,minutes:this.minutes.value,type:(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),void(this._options.clockType!=="24h"&&this.AM.classList.add("active"));let[c,u,d]=this.input.value.split(":").join(" ").split(" ");this.input.value.length===0&&(c=l.hour,u=l.minutes,d=l.type),this.hour.value=c,this.minutes.value=u;const p=document.querySelector(`[data-type='${d}']`);this._options.clockType!=="24h"&&p&&p.classList.add("active"),Gc(this._element,"show",Object.assign(Object.assign({},l),{type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}))},this._handleCancelButton=()=>{this._clickTouchEvents.forEach(o=>{this.cancelButton.addEventListener(o,()=>{var s;const l=ac(this.input,this._options.clockType);Gc(this._element,"cancel",Object.assign(Object.assign({},l),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})})},this._handleOkButton=()=>{this._clickTouchEvents.forEach(o=>{var s;(s=this.okButton)===null||s===void 0||s.addEventListener(o,()=>{var l,c,u;const{clockType:d,disabledTime:p}=this._options,h=pm(this.hour.value,"hour",d),f=pm(this.minutes.value,"minutes",d);let m;const g=g1(this.hour.value,"hour",d,p==null?void 0:p.hours),v=g1(this.minutes.value,"minutes",d,p==null?void 0:p.minutes);if(p!=null&&p.interval&&(m=((y,I,b,D)=>{const w=b?mF(`${y}:${I} ${b}`.trim()):`${y}:${I}`.trim();let S,U;if(b){const[C,E]=D.trim().split("-").map(P=>P.trim());S=mF(C),U=mF(E)}else{const[C,E]=D.trim().split("-"),P=M=>M.trim().split(":").map(N=>Number(N)<=9?`0${Number(N)}`:N).join(":");S=P(C),U=P(E)}return w<S||w>U})(this.hour.value,this.minutes.value,(l=this.activeTypeMode)===null||l===void 0?void 0:l.textContent,p.interval)),m===!1||h===!1||f===!1||g===!1||v===!1)return m!==!1&&f&&v||this.minutes.classList.add("invalid-value"),void(m!==!1&&h&&g||this.hour.classList.add("invalid-value"));this.input.value=`${this.hour.value}:${this.minutes.value} ${this._options.clockType==="24h"?"":(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type}`.trimEnd(),Gc(this._element,"accept",{hour:this.hour.value,minutes:this.minutes.value,type:(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.close()()})})},this._setShowClassToBackdrop=()=>{this._options.backdrop&&setTimeout(()=>{this.modalElement.classList.add("show")},300)},this._handleBackdropClick=()=>{var o;(o=this.modalElement)===null||o===void 0||o.addEventListener("click",s=>{var l;const c=s.target;if(!Li(c,"timepicker-ui-modal"))return;const u=ac(this.input,this._options.clockType);Gc(this._element,"cancel",Object.assign(Object.assign({},u),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(l=this.activeTypeMode)===null||l===void 0?void 0:l.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})},this._setBgColorToCirleWithHourTips=()=>{if(!this._options)return;const{mobile:o,theme:s}=this._options;o||this.circle===null||(this.circle.style.backgroundColor=s==="crane-straight"||s==="crane-radius"?XS.cranered400:XS.purple)},this._setBgColorToCircleWithMinutesTips=()=>{const{theme:o}=this._options;this.minutes.value&&Yg.includes(this.minutes.value)&&(this.circle.style.backgroundColor=o==="crane-straight"||o==="crane-radius"?XS.cranered400:XS.purple,this.circle.classList.remove("small-circle"))},this._removeBgColorToCirleWithMinutesTips=()=>{this.minutes.value&&Yg.includes(this.minutes.value)||(this.circle.style.backgroundColor="",this.circle.classList.add("small-circle"))},this._setTimepickerClassToElement=()=>{var o;(o=this._element)===null||o===void 0||o.classList.add("timepicker-ui")},this._setClassActiveToHourOnOpen=()=>{var o;this._options.mobile||this._isMobileView||(o=this.hour)===null||o===void 0||o.classList.add("active")},this._setMinutesToClock=o=>{var s,l,c,u,d;this.clockFace!==null&&this._setTransformToCircleWithSwitchesMinutes(o),this._removeBgColorToCirleWithMinutesTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.minutes?(u=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||u===void 0?void 0:u.minutes:(d=this._disabledTime)===null||d===void 0?void 0:d.value,h=new bh({array:Yg,classToAdd:"timepicker-ui-minutes-time",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,hour:this.hour.value,clockType:this._options.clockType});h.create(),this._options.clockType==="12h"&&h.updateDisable(),this._toggleClassActiveToValueTips(o),this._options.clockType==="24h"&&(this.tipsWrapperFor24h.innerHTML="")},this._setHoursToClock=o=>{var s,l,c,u,d;if(this.clockFace!==null){this._setTransformToCircleWithSwitchesHour(o),this._setBgColorToCirleWithHourTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,h=new bh({array:ZI,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,clockType:"12h",hour:this.hour.value});h.create(),this._options.clockType==="24h"?new bh({array:gZ,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:p,hour:this.hour.value}).create():h.updateDisable(),this._toggleClassActiveToValueTips(o)}},this._setTransformToCircleWithSwitchesHour=o=>{const s=Number(o);let l=s>12?30*s-360:30*s;l===360&&(l=0),l>360||(this.clockHand.style.transform=`rotateZ(${l}deg)`)},this._setTransformToCircleWithSwitchesMinutes=o=>{const s=6*Number(o);s>360||(this.clockHand.style.transform=`rotateZ(${s}deg)`)},this._handleAmClick=()=>{this._clickTouchEvents.forEach(o=>{this.AM.addEventListener(o,s=>{var l,c,u,d;if(s.target.classList.add("active"),this.PM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new bh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Li(this.hour,"active")?ZI:Yg});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300),p.updateDisable()}Gc(this._element,"selectamtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handlePmClick=()=>{this._clickTouchEvents.forEach(o=>{this.PM.addEventListener(o,s=>{var l,c,u,d;if(s.target.classList.add("active"),this.AM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new bh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Li(this.hour,"active")?ZI:Yg});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Gc(this._element,"selectpmtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handleAnimationClock=()=>{this._options.animation&&setTimeout(()=>{var o;(o=this.clockFace)===null||o===void 0||o.classList.add("timepicker-ui-clock-animation"),setTimeout(()=>{var s;(s=this.clockFace)===null||s===void 0||s.classList.remove("timepicker-ui-clock-animation")},600)},150)},this._handleAnimationSwitchTipsMode=()=>{this.clockHand.classList.add("timepicker-ui-tips-animation"),setTimeout(()=>{var o;(o=this.clockHand)===null||o===void 0||o.classList.remove("timepicker-ui-tips-animation")},401)},this._handleClasses24h=(o,s)=>{var l;const c=o.target;this.hourTips&&this._options.clockType==="24h"&&(Number(c.textContent)>12||Number(c.textContent)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(l=this.tipsWrapperFor24h)===null||l===void 0||l.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),c&&s&&(s.value=c.value.replace(/\D+/g,""),s.click())},this._handleHourEvents=()=>{var o,s;this._inputEvents.forEach(l=>{var c;(c=this.hour)===null||c===void 0||c.addEventListener(l,u=>{var d,p,h,f,m;const g=u.target;if(this.clockFace!==null&&this._handleAnimationSwitchTipsMode(),this._options.clockType==="24h"&&(Number(g.value)>12||Number(g.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(d=this.tipsWrapperFor24h)===null||d===void 0||d.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),this._setHoursToClock(g.value),g.classList.add("active"),this.minutes.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new bh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Li(this.hour,"active")?ZI:Yg});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,I,b,D;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((I=this.activeTypeMode)===null||I===void 0?void 0:I.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(D=(b=this._disabledTime)===null||b===void 0?void 0:b.value)===null||D===void 0?void 0:D.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Gc(this._element,"selecthourmode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.clockFace!==null&&this.circle.classList.remove("small-circle")})}),(o=this.hour)===null||o===void 0||o.addEventListener("blur",l=>this._handleClasses24h(l,this.hour)),(s=this.hour)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.hour))},this._handleMinutesEvents=()=>{var o,s;this._inputEvents.forEach(l=>{this.minutes.addEventListener(l,c=>{var u,d,p,h,f,m;const g=c.target;if(this.clockFace!==null&&(this._handleAnimationSwitchTipsMode(),this._setMinutesToClock(g.value)),this._options.clockType==="24h"&&(this._removeCircleClockClasses24h(),this._options.mobile||(u=this.tipsWrapperFor24h)===null||u===void 0||u.classList.add("timepicker-ui-tips-wrapper-24h-disabled")),g.classList.add("active"),(d=this.hour)===null||d===void 0||d.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new bh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Li(this.hour,"active")?ZI:Yg});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,I,b;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((I=this.activeTypeMode)===null||I===void 0?void 0:I.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(b=this._disabledTime)===null||b===void 0?void 0:b.value.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}Gc(this._element,"selectminutemode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})}),(o=this.minutes)===null||o===void 0||o.addEventListener("blur",l=>this._handleClasses24h(l,this.minutes)),(s=this.minutes)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.minutes))},this._handleEventToMoveHand=o=>{var s,l,c,u,d,p,h,f,m,g,v,y,I,b,D,w,S,U,C,E,P,M,N,R,A,_,O,x,F,$,V,G,j,z,H,K,q,Y,Z,Q,ie,ue,J,te,se,ee,ce,fe,ge,he,Se,Ce,Fe,Je,xe,st,we,Oe,ye,Be,Ee,qe;const{target:Ge,type:me,touches:Me}=o,De=Ge,{incrementMinutes:Ae,incrementHours:ze,switchToMinutesAfterSelectHour:de}=this._options;if(!mZ(o,this.clockFace))return;const pe=mZ(o,this.clockFace),ke=this.clockFace.offsetWidth/2,Ue=pe&&Math.atan2(pe.y-ke,pe.x-ke);if(me==="mouseup"||me==="touchend")return this._isTouchMouseMove=!1,void(de&&(Li(De,"timepicker-ui-value-tips")||Li(De,"timepicker-ui-value-tips-24h")||Li(De,"timepicker-ui-tips-wrapper"))&&this.minutes.click());if(me!=="mousedown"&&me!=="mousemove"&&me!=="touchmove"&&me!=="touchstart"||me!=="mousedown"&&me!=="touchstart"&&me!=="touchmove"||((Li(De,"timepicker-ui-clock-face")||Li(De,"timepicker-ui-circle-hand")||Li(De,"timepicker-ui-hour-time-12")||Li(De,"timepicker-ui-minutes-time")||Li(De,"timepicker-ui-clock-hand")||Li(De,"timepicker-ui-value-tips")||Li(De,"timepicker-ui-value-tips-24h")||Li(De,"timepicker-ui-tips-wrapper")||Li(De,"timepicker-ui-tips-wrapper-24h"))&&!Li(De,"timepicker-ui-tips-disabled")?(o.preventDefault(),this._isTouchMouseMove=!0):this._isTouchMouseMove=!1),!this._isTouchMouseMove)return;if(this.minutesTips!==null){this.minutes.classList.add("active");let je,Le=Ue&&hF(Math.trunc(180*Ue/Math.PI)+90,Ae,6);if(Le===void 0)return;if(Le<0?(je=Math.round(360+Le/6)%60,Le=360+6*Math.round(Le/6)):(je=Math.round(Le/6)%60,Le=6*Math.round(Le/6)),(s=this._disabledTime)===null||s===void 0?void 0:s.value.isInterval){if(((d=this._disabledTime)===null||d===void 0?void 0:d.value.endType)===((p=this._disabledTime)===null||p===void 0?void 0:p.value.startType)){if(!((m=(f=(h=this._disabledTime)===null||h===void 0?void 0:h.value)===null||f===void 0?void 0:f.endMinutes)===null||m===void 0)&&m.includes(je<=9?`0${je}`:`${je}`)&&this.hour.value===((v=(g=this._disabledTime)===null||g===void 0?void 0:g.value)===null||v===void 0?void 0:v.removedEndHour)&&((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)===((I=this.activeTypeMode)===null||I===void 0?void 0:I.textContent)||!((w=(D=(b=this._disabledTime)===null||b===void 0?void 0:b.value)===null||D===void 0?void 0:D.startMinutes)===null||w===void 0)&&w.includes(je<=9?`0${je}`:`${je}`)&&this.hour.value===((U=(S=this._disabledTime)===null||S===void 0?void 0:S.value)===null||U===void 0?void 0:U.removedStartedHour)&&((C=this._disabledTime)===null||C===void 0?void 0:C.value.startType)===((E=this.activeTypeMode)===null||E===void 0?void 0:E.textContent))return}else if(((P=this.activeTypeMode)===null||P===void 0?void 0:P.textContent)===((M=this._disabledTime)===null||M===void 0?void 0:M.value.endType)&&(!((A=(R=(N=this._disabledTime)===null||N===void 0?void 0:N.value)===null||R===void 0?void 0:R.endMinutes)===null||A===void 0)&&A.includes(je<=9?`0${je}`:`${je}`)&&((_=this._disabledTime)===null||_===void 0?void 0:_.value.removedPmHour)===this.hour.value||!((O=this._disabledTime)===null||O===void 0)&&O.value.pmHours.map(Number).includes(Number(this.hour.value)))||((x=this.activeTypeMode)===null||x===void 0?void 0:x.textContent)===((F=this._disabledTime)===null||F===void 0?void 0:F.value.startType)&&(!((G=(V=($=this._disabledTime)===null||$===void 0?void 0:$.value)===null||V===void 0?void 0:V.startMinutes)===null||G===void 0)&&G.includes(je<=9?`0${je}`:`${je}`)&&((j=this._disabledTime)===null||j===void 0?void 0:j.value.removedAmHour)===this.hour.value||!((z=this._disabledTime)===null||z===void 0)&&z.value.amHours.map(Number).includes(Number(this.hour.value))))return}else if(!((u=(c=(l=this._disabledTime)===null||l===void 0?void 0:l.value)===null||c===void 0?void 0:c.minutes)===null||u===void 0)&&u.includes(je<=9?`0${je}`:`${je}`))return;this.minutes.value=je>=10?`${je}`:`0${je}`,this.clockHand.style.transform=`rotateZ(${Le}deg)`,this._degreesMinutes=Le,this._toggleClassActiveToValueTips(this.minutes.value),this._removeBgColorToCirleWithMinutesTips(),this._setBgColorToCircleWithMinutesTips(),Gc(this._element,"update",Object.assign(Object.assign({},ac(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:me,type:(H=this.activeTypeMode)===null||H===void 0?void 0:H.dataset.type}))}const Te=Me?Me[0]:void 0,rt=Me&&Te?document.elementFromPoint(Te.clientX,Te.clientY):null;if(this.hourTips!==null){if((K=this.hour)===null||K===void 0||K.classList.add("active"),!Li(rt||De,"timepicker-ui-value-tips-24h")&&!Li(rt||De,"timepicker-ui-tips-disabled")&&(Li(rt||De,"timepicker-ui-value-tips")||Li(rt||De,"timepicker-ui-tips-wrapper"))){let je,Le=Ue&&hF(Math.trunc(180*Ue/Math.PI)+90,ze,30);if(this._degreesHours=Le,Le===void 0)return;Le<0?(je=Math.round(360+Le/30)%12,Le=360+Le):(je=Math.round(Le/30)%12,(je===0||je>12)&&(je=12));const It=!((q=this._disabledTime)===null||q===void 0)&&q.value.isInterval?"rangeArrHour":"hours";if(((Y=this._disabledTime)===null||Y===void 0?void 0:Y.value.endType)===((Q=(Z=this._disabledTime)===null||Z===void 0?void 0:Z.value)===null||Q===void 0?void 0:Q.startType)){if(typeof((ue=(ie=this._disabledTime)===null||ie===void 0?void 0:ie.value)===null||ue===void 0?void 0:ue.endType)=="string"){if(((te=(J=this._disabledTime)===null||J===void 0?void 0:J.value)===null||te===void 0?void 0:te.endType)===((se=this.activeTypeMode)===null||se===void 0?void 0:se.textContent)&&((ce=(ee=this._disabledTime)===null||ee===void 0?void 0:ee.value)===null||ce===void 0?void 0:ce.startType)===((fe=this.activeTypeMode)===null||fe===void 0?void 0:fe.textContent)&&(!((he=(ge=this._disabledTime)===null||ge===void 0?void 0:ge.value[It])===null||he===void 0)&&he.includes(je.toString())))return}else if(!((Ce=(Se=this._disabledTime)===null||Se===void 0?void 0:Se.value[It])===null||Ce===void 0)&&Ce.includes(je.toString()))return}else if(((Fe=this._disabledTime)===null||Fe===void 0?void 0:Fe.value.startType)===((Je=this.activeTypeMode)===null||Je===void 0?void 0:Je.textContent)&&(!((xe=this._disabledTime)===null||xe===void 0)&&xe.value.amHours.includes(je.toString()))||((st=this._disabledTime)===null||st===void 0?void 0:st.value.endType)===((we=this.activeTypeMode)===null||we===void 0?void 0:we.textContent)&&(!((Oe=this._disabledTime)===null||Oe===void 0)&&Oe.value.pmHours.includes(je.toString())))return;this.clockHand.style.transform=`rotateZ(${Le}deg)`,this.hour.value=je>9?`${je}`:`0${je}`,this._removeCircleClockClasses24h(),this._toggleClassActiveToValueTips(je)}if((Li(rt||De,"timepicker-ui-value-tips-24h")||Li(rt||De,"timepicker-ui-tips-wrapper-24h"))&&!Li(rt||De,"timepicker-ui-tips-disabled")){let je,Le=Ue&&hF(Math.trunc(180*Ue/Math.PI)+90,ze,30);if(this._degreesHours=Le,Le===void 0)return;Le<0?(je=Math.round(360+Le/30)%24,Le=360+Le):(je=Math.round(Le/30)+12,je===12&&(je="00"));const It=!((ye=this._disabledTime)===null||ye===void 0)&&ye.value.isInterval?"rangeArrHour":"hours";if(!((Ee=(Be=this._disabledTime)===null||Be===void 0?void 0:Be.value[It])===null||Ee===void 0)&&Ee.includes(je.toString()))return;this._setCircleClockClasses24h(),this.clockHand.style.transform=`rotateZ(${Le}deg)`,this.hour.value=`${je}`,this._toggleClassActiveToValueTips(je)}Gc(this._element,"update",Object.assign(Object.assign({},ac(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:me,type:(qe=this.activeTypeMode)===null||qe===void 0?void 0:qe.dataset.type}))}},this._toggleClassActiveToValueTips=o=>{const s=this.allValueTips.find(l=>Number(l.innerText)===Number(o));this.allValueTips.map(l=>l.classList.remove("active")),s!==void 0&&s.classList.add("active")},this._handleMoveHand=()=>{this._options.mobile||this._isMobileView||gF.split(" ").forEach(o=>{o==="touchstart"||o==="touchmove"||o==="touchend"?document.addEventListener(o,this._mutliEventsMoveHandler,{passive:!1}):document.addEventListener(o,this._mutliEventsMoveHandler,!1)})},this._setModalTemplate=()=>{if(!this._options)return;const{appendModalSelector:o}=this._options;if(o!==""&&o){const s=document==null?void 0:document.querySelector(o);s==null||s.insertAdjacentHTML("beforeend",this.modalTemplate)}else document.body.insertAdjacentHTML("afterend",this.modalTemplate)},this._setScrollbarOrNot=()=>{this._options.enableScrollbar?setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400):(document.body.style.paddingRight=`${(()=>{const o=document.createElement("div");o.className="timepicker-ui-measure",document.body.appendChild(o);const s=o.getBoundingClientRect().width-o.clientWidth;return document.body.removeChild(o),s})()}px`,document.body.style.overflowY="hidden")},this._setAnimationToOpen=()=>{var o,s;(o=this.modalElement)===null||o===void 0||o.classList.add("opacity"),this._options.animation?setTimeout(()=>{var l;(l=this.modalElement)===null||l===void 0||l.classList.add("show")},150):(s=this.modalElement)===null||s===void 0||s.classList.add("show")},this._removeAnimationToClose=()=>{var o;this.modalElement&&(this._options.animation?setTimeout(()=>{var s;(s=this.modalElement)===null||s===void 0||s.classList.remove("show")},150):(o=this.modalElement)===null||o===void 0||o.classList.remove("show"))},this._handlerViewChange=()=>vZ(()=>{var o,s,l,c;const{clockType:u}=this._options;if(Li(this.modalElement,"mobile")){const d=pm(this.hour.value,"hour",u),p=pm(this.minutes.value,"minutes",u);if(d===!1||p===!1)return p||this.minutes.classList.add("invalid-value"),void(d||(s=this.hour)===null||s===void 0||s.classList.add("invalid-value"));d===!0&&p===!0&&(p&&this.minutes.classList.remove("invalid-value"),d&&((l=this.hour)===null||l===void 0||l.classList.remove("invalid-value"))),this.close()(),this._isMobileView=!1,this._options.mobile=!1;const h=this.hour.value,f=this.minutes.value,m=(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!1}}),setTimeout(()=>{if(this.open(),this.hour.value=h,this.minutes.value=f,this._options.clockType==="12h"){const g=m==="PM"?"AM":"PM";this[m==="PM"?"PM":"AM"].classList.add("active"),this[g].classList.remove("active")}this._setTransformToCircleWithSwitchesHour(this.hour.value),this._toggleClassActiveToValueTips(this.hour.value),Number(this.hour.value)>12||Number(this.hour.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h()},300)},300)}else{this.close()(),this._isMobileView=!0,this._options.mobile=!0;const d=this.hour.value,p=this.minutes.value,h=(o=this.activeTypeMode)===null||o===void 0?void 0:o.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!0}}),setTimeout(()=>{if(this.open(),this.hour.value=d,this.minutes.value=p,this._options.clockType==="12h"){const f=h==="PM"?"AM":"PM";this[h==="PM"?"PM":"AM"].classList.add("active"),this[f].classList.remove("active")}},300)},300)}},this._options.delayHandler||300),this._handleIconChangeView=()=>fZ(this,void 0,void 0,function*(){this._options.enableSwitchIcon&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.keyboardClockIcon.addEventListener("touchstart",this._handlerViewChange()):this.keyboardClockIcon.addEventListener("click",this._handlerViewChange()))}),this._handlerClickHourMinutes=o=>fZ(this,void 0,void 0,function*(){var s,l;if(!this.modalElement)return;const{clockType:c,editable:u}=this._options,d=o.target,p=pm(this.hour.value,"hour",c),h=pm(this.minutes.value,"minutes",c);u&&(Li(d,"timepicker-ui-hour")||Li(d,"timepicker-ui-minutes")?p!==!1&&h!==!1||(h||this.minutes.classList.add("invalid-value"),p||(l=this.hour)===null||l===void 0||l.classList.add("invalid-value")):p===!0&&h===!0&&(h&&this.minutes.classList.remove("invalid-value"),p&&((s=this.hour)===null||s===void 0||s.classList.remove("invalid-value"))))}),this._handleClickOnHourMobile=()=>{document.addEventListener("mousedown",this._eventsClickMobileHandler),document.addEventListener("touchstart",this._eventsClickMobileHandler)},this._handleKeyPress=o=>{o.key==="Escape"&&this.modalElement&&this.close()()},this._handleEscClick=()=>{document.addEventListener("keydown",this._handleKeyPress)},this._focusTrapHandler=()=>{setTimeout(()=>{var o,s;const l=(o=this.wrapper)===null||o===void 0?void 0:o.querySelectorAll('div[tabindex="0"]:not([disabled])'),c=(s=this.wrapper)===null||s===void 0?void 0:s.querySelectorAll('input[tabindex="0"]:not([disabled])');if(!l||l.length<=0||c.length<=0)return;const u=[...c,...l],d=u[0],p=u[u.length-1];this.wrapper.focus(),this.wrapper.addEventListener("keydown",({key:h,shiftKey:f,target:m})=>{const g=m;if(h==="Tab"&&(f?document.activeElement===d&&p.focus():document.activeElement===p&&d.focus()),h==="Enter"&&(Li(g,"timepicker-ui-minutes")&&this.minutes.click(),Li(g,"timepicker-ui-hour")&&this.hour.click(),Li(g,"timepicker-ui-cancel-btn")&&this.cancelButton.click(),Li(g,"timepicker-ui-ok-btn")&&this.okButton.click(),Li(g,"timepicker-ui-keyboard-icon-wrapper")&&this.keyboardClockIcon.click(),Li(g,"timepicker-ui-am")&&this.AM.click(),Li(g,"timepicker-ui-pm")&&this.PM.click(),Li(g,"timepicker-ui-value-tips")||Li(g,"timepicker-ui-value-tips-24h"))){const{left:v,top:y,x:I,y:b,width:D,height:w}=g.getBoundingClientRect(),S=document.elementFromPoint(I,b);(()=>{var C;const E=new MouseEvent("mousedown",{clientX:v+D/2,clientY:y+w/2,cancelable:!0,bubbles:!0});Li(S,"timepicker-ui-value-tips-24h")?S==null||S.dispatchEvent(E):(C=S==null?void 0:S.childNodes[0])===null||C===void 0||C.dispatchEvent(E),this._isTouchMouseMove=!1})()}setTimeout(()=>{this.wrapper.addEventListener("mousedown",()=>document.activeElement.blur())},100)})},301)},this._handleOpenOnEnterFocus=()=>{this.input.addEventListener("keydown",({target:o,key:s})=>{o.disabled||s==="Enter"&&this.open()})},this._element=e,this._cloned=null,this._options=((o,s)=>Object.assign(Object.assign({},s),o))(Object.assign(Object.assign({},i),(o=>{if(!o)return;const s=JSON.parse(JSON.stringify(o)),l=Object.keys(s);return Object.values(s).reduce((c,u,d)=>(Number(u)?c[l[d]]=Number(u):c[l[d]]=u==="true"||u==="false"?JSON.parse(u):u,c),{})})((n=this._element)===null||n===void 0?void 0:n.dataset)),oXe),this._isTouchMouseMove=!1,this._degreesHours=30*Number(ac((r=this._element)===null||r===void 0?void 0:r.querySelector("input"),this._options.clockType).hour),this._degreesMinutes=6*Number(ac((a=this._element)===null||a===void 0?void 0:a.querySelector("input"),this._options.clockType).minutes),this._isMobileView=!1,this._mutliEventsMove=o=>this._handleEventToMoveHand(o),this._mutliEventsMoveHandler=this._mutliEventsMove.bind(this),this._eventsClickMobile=o=>this._handlerClickHourMinutes(o),this._eventsClickMobileHandler=this._eventsClickMobile.bind(this),this._checkMobileOption(),this._clickTouchEvents=["click","mousedown","touchstart"],this._inputEvents=["change",...this._clickTouchEvents],this._disabledTime=null,this._preventClockTypeByCurrentTime(),this._isModalRemove=!0}get modalTemplate(){return this._options.mobile&&this._isMobileView?(e=>{const{mobileTimeLabel:i,amLabel:n,pmLabel:r,cancelLabel:a,okLabel:o,iconTemplateMobile:s,minuteMobileLabel:l,hourMobileLabel:c,enableSwitchIcon:u,animation:d,clockType:p}=e;return`
  <div class="timepicker-ui-modal normalize mobile" role="dialog" style='transition:${d?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper mobile" tabindex="0">
      <div class="timepicker-ui-header mobile">
        <div class="timepicker-ui-select-time mobile">${i}</div>
        <div class="timepicker-ui-wrapper-time mobile">
          <input class="timepicker-ui-hour mobile" tabindex="0" type="number" min="0" max="${p==="12h"?"12":"23"}" />
          <div class="timepicker-ui-hour-text mobile">${c}</div>
          <div class="timepicker-ui-dots mobile">:</div>  
          <div class="timepicker-ui-minute-text mobile">${l}</div>
          <input class="timepicker-ui-minutes mobile" tabindex="0" type="number" min="0" max="59" /> 
        </div>
  ${p!=="24h"?`<div class="timepicker-ui-wrapper-type-time mobile">
          <div class="timepicker-ui-type-mode timepicker-ui-am mobile" data-type="AM" tabindex="0">${n}</div>    
          <div class="timepicker-ui-type-mode timepicker-ui-pm mobile" data-type="PM" tabindex="0">${r}</div>    
        </div>`:""}
      </div>
      <div class="timepicker-ui-footer mobile" data-view="mobile">
      ${u?`
      <div class="timepicker-ui-keyboard-icon-wrapper mobile" role="button" aria-pressed="false" data-view="desktop" tabindex="0">
      ${s}
      </div>`:""}
      <div class="timepicker-ui-wrapper-btn mobile">
        <div class="timepicker-ui-cancel-btn mobile" role="button" aria-pressed="false" tabindex="0">${a}</div>
        <div class="timepicker-ui-ok-btn mobile" role="button" aria-pressed="false" tabindex="0">${o}</div>
      </div>
      </div>
    </div>  
  </div>`})(this._options):(e=>{const{iconTemplate:i,timeLabel:n,amLabel:r,pmLabel:a,cancelLabel:o,okLabel:s,enableSwitchIcon:l,animation:c,clockType:u,editable:d}=e;return`
  <div class="timepicker-ui-modal normalize" role="dialog" style='transition:${c?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper" tabindex="0">
      <div class="timepicker-ui-header">
        <div class="timepicker-ui-select-time">${n}</div>
        <div class="timepicker-ui-wrapper-time ${u==="24h"?"timepicker-ui-wrapper-time-24h":""}">
          <input ${d?"":"readonly"} class="timepicker-ui-hour" tabindex="0" type="number" min="0" max="${u==="12h"?"12":"23"}" />
          <div class="timepicker-ui-dots">:</div>    
          <input ${d?"":"readonly"} class="timepicker-ui-minutes" tabindex="0" type="number" min="0" max="59" /> 
        </div>
      ${u!=="24h"?`
      <div class="timepicker-ui-wrapper-type-time">
        <div class="timepicker-ui-type-mode timepicker-ui-am" tabindex="0" role="button" data-type="AM">${r}</div>    
        <div class="timepicker-ui-type-mode timepicker-ui-pm" tabindex="0" role="button" data-type="PM">${a}</div>    
      </div>
      `:""}
      </div>
      <div class="timepicker-ui-wrapper-landspace">
        <div class="timepicker-ui-body">
          <div class="timepicker-ui-clock-face">
            <div class="timepicker-ui-dot"></div>
            <div class="timepicker-ui-clock-hand">
              <div class="timepicker-ui-circle-hand"></div>
            </div>
            <div class="timepicker-ui-tips-wrapper"></div>
            ${u==="24h"?'<div class="timepicker-ui-tips-wrapper-24h"></div>':""}
          </div>
        </div>
        <div class="timepicker-ui-footer">
        ${l?`
      <div class="timepicker-ui-keyboard-icon-wrapper" tabindex="0" role="button" aria-pressed="false" data-view="desktop">
        ${i}
      </div>`:""}
        <div class="timepicker-ui-wrapper-btn" >
          <div class="timepicker-ui-cancel-btn" tabindex="0" role="button" aria-pressed="false">${o}</div>
          <div class="timepicker-ui-ok-btn" tabindex="0" role="button" aria-pressed="false">${s}</div>
        </div>
        </div>
      </div>
    </div>  
  </div>`})(this._options)}get modalElement(){return document.querySelector(".timepicker-ui-modal")}get clockFace(){return document.querySelector(".timepicker-ui-clock-face")}get input(){var e;return(e=this._element)===null||e===void 0?void 0:e.querySelector("input")}get clockHand(){return document.querySelector(".timepicker-ui-clock-hand")}get circle(){return document.querySelector(".timepicker-ui-circle-hand")}get tipsWrapper(){return document.querySelector(".timepicker-ui-tips-wrapper")}get tipsWrapperFor24h(){return document.querySelector(".timepicker-ui-tips-wrapper-24h")}get minutes(){return document.querySelector(".timepicker-ui-minutes")}get hour(){return document.querySelector(".timepicker-ui-hour")}get AM(){return document.querySelector(".timepicker-ui-am")}get PM(){return document.querySelector(".timepicker-ui-pm")}get minutesTips(){return document.querySelector(".timepicker-ui-minutes-time")}get hourTips(){return document.querySelector(".timepicker-ui-hour-time-12")}get allValueTips(){return[...document.querySelectorAll(".timepicker-ui-value-tips"),...document.querySelectorAll(".timepicker-ui-value-tips-24h")]}get openElementData(){var e;const i=(e=this._element)===null||e===void 0?void 0:e.querySelectorAll("[data-open]");if((i==null?void 0:i.length)>0){const n=[];return i.forEach(({dataset:r})=>{var a;return n.push((a=r.open)!==null&&a!==void 0?a:"")}),[...new Set(n)]}return null}get openElement(){var e,i;return this.openElementData===null?((e=this.input)===null||e===void 0||e.setAttribute("data-open","timepicker-ui-input"),[this.input]):(i=this.openElementData.map(n=>{var r;return(r=this._element)===null||r===void 0?void 0:r.querySelectorAll(`[data-open='${n}']`)})[0])!==null&&i!==void 0?i:""}get cancelButton(){return document.querySelector(".timepicker-ui-cancel-btn")}get okButton(){return document.querySelector(".timepicker-ui-ok-btn")}get activeTypeMode(){return document.querySelector(".timepicker-ui-type-mode.active")}get keyboardClockIcon(){return document.querySelector(".timepicker-ui-keyboard-icon-wrapper")}get footer(){return document.querySelector(".timepicker-ui-footer")}get wrapper(){return document.querySelector(".timepicker-ui-wrapper")}_checkDisabledValuesOnStart(){if(!this._options.disabledTime||this._options.disabledTime.interval)return;const{disabledTime:{hours:e,minutes:i},clockType:n}=this._options,r=!e||g1(e,"hour",n),a=!i||g1(i,"minutes",n);if(!r||!a)throw new Error("You set wrong hours or minutes in disabled option")}_checkMobileOption(){this._isMobileView=!!this._options.mobile,this._options.mobile&&(this._options.editable=!0)}_getDisableTime(){this._disabledTime=(e=>{if(!e)return;const{disabledTime:i,clockType:n}=e;if(!i||Object.keys(i).length<=0||i.constructor.name!=="Object")return;const{hours:r,interval:a,minutes:o}=i;if(a){delete i.hours,delete i.minutes;const[s,l]=a.toString().split("-"),{hour:c,minutes:u,type:d}=ac({value:s.trimEnd()},n),{hour:p,minutes:h,type:f}=ac({value:l.trimEnd().trimStart()},n);let m=f1(c,p).map(I=>I==="00"||Number(I)===0?`0${Number(I)}`:`${Number(I)}`);const g=[],v=Number(u),y=Number(h);if(f===d)return v>0&&y<=0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y<59&&y>0&&v<=0?(g.push(void 0,m[m.length-1]),m=m.slice(0,-1)):y>0&&v>0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y===0&&v===0&&(g.push(void 0,m[m.length-1]),m.pop()),{value:{removedStartedHour:Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:m,isInterval:!0,startMinutes:f1(u,59).map(I=>Number(I)<=9?`0${I}`:`${I}`),endMinutes:fF(0,h).map(I=>Number(I)<=9?`0${I}`:`${I}`),endType:f,startType:d}};{const I=f1(c,12).map(String),b=fF(1,p).map(String),D=[],w=[];return v>0&&y<=0?(D.push(b[b.length-1]),w.push(I[0]),b.splice(-1,1),I.splice(0,1)):y<59&&y>0&&v<=0?(w.push(I[0]),D.push(b[b.length-1]),b.splice(-1,1)):y>0&&v>0?(D.push(b[b.length-1]),w.push(I[0]),b.splice(-1,1),I.splice(0,1)):y===0&&v===0&&(D.push(b[b.length-1]),w.push(I[0]),b.pop()),{value:{isInterval:!0,endType:f,startType:d,pmHours:b,amHours:I,startMinutes:Number(u)===0?[]:f1(u,59).map(S=>Number(S)<=9?`0${S}`:`${S}`),endMinutes:fF(0,h).map(S=>Number(S)<=9?`0${S}`:`${S}`),removedAmHour:Number(w[0])<=9?`0${w[0]}`:w[0],removedPmHour:Number(D[0])<=9?`0${D[0]}`:D[0]}}}}return r==null||r.forEach(s=>{if(n==="12h"&&Number(s)>12)throw new Error("The disabled hours value has to be less than 13");if(n==="24h"&&Number(s)>23)throw new Error("The disabled hours value has to be less than 24")}),o==null||o.forEach(s=>{if(Number(s)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r==null?void 0:r.map(s=>s==="00"||Number(s)===0?`0${Number(s)}`:`${Number(s)}`),minutes:o==null?void 0:o.map(s=>Number(s)<=9?`0${s}`:`${s}`)}}})(this._options)}_removeCircleClockClasses24h(){var e,i;(e=this.circle)===null||e===void 0||e.classList.remove("timepicker-ui-circle-hand-24h"),(i=this.clockHand)===null||i===void 0||i.classList.remove("timepicker-ui-clock-hand-24h")}_setCircleClockClasses24h(){var e,i;this.circle&&((e=this.circle)===null||e===void 0||e.classList.add("timepicker-ui-circle-hand-24h")),this.clockHand&&((i=this.clockHand)===null||i===void 0||i.classList.add("timepicker-ui-clock-hand-24h"))}_setErrorHandler(){var e,i,n,r;const{error:a,currentHour:o,currentMin:s,currentType:l,currentLength:c}=ac(this.input,this._options.clockType);if(a){const u=document.createElement("div");throw(e=this.input)===null||e===void 0||e.classList.add("timepicker-ui-invalid-format"),u.classList.add("timepicker-ui-invalid-text"),u.innerHTML="<b>Invalid Time Format</b>",!((i=this.input)===null||i===void 0)&&i.parentElement&&((n=this.input)===null||n===void 0?void 0:n.parentElement.querySelector(".timepicker-ui-invalid-text"))===null&&((r=this.input)===null||r===void 0||r.after(u)),Gc(this._element,"geterror",{error:a,currentHour:o,currentMin:s,currentType:l,currentLength:c}),new Error(`Invalid Time Format: ${a}`)}}_removeErrorHandler(){var e,i;(e=this.input)===null||e===void 0||e.classList.remove("timepicker-ui-invalid-format");const n=(i=this._element)===null||i===void 0?void 0:i.querySelector(".timepicker-ui-invalid-text");n&&n.remove()}_setOnStartCSSClassesIfClockType24h(){if(this._options.clockType==="24h"){let{hour:e}=ac(this.input,this._options.clockType,this._options.currentTime);this.input.value.length>0&&(e=this.input.value.split(":")[0]),(Number(e)>12||Number(e)===0)&&this._setCircleClockClasses24h()}}_getDestructuringObj(e){var i;const{endMinutes:n,removedEndHour:r,removedStartedHour:a,startMinutes:o,pmHours:s,amHours:l,removedAmHour:c,removedPmHour:u}=this._disabledTime.value;return e?{minutesToUpdate:{actualHour:this.hour.value,pmHours:s,amHours:l,activeMode:(i=this.activeTypeMode)===null||i===void 0?void 0:i.textContent,startMinutes:o,endMinutes:n,removedAmHour:c,removedPmHour:u}}:{minutesToUpdate:{endMinutes:n,removedEndHour:r,removedStartedHour:a,actualHour:this.hour.value,startMinutes:o}}}}function lXe({time:t,options:e,callback:i}={}){const n=document.getElementById("timepicker"),r=document.getElementById("timevalue");r.value=cXe(t);const a=new sXe(document.getElementById("timepicker"),{switchToMinutesAfterSelectHour:!0,clockType:"12h",...e});a.create(),a.open(),n.addEventListener("accept",()=>{const o=r.value;pt(i)&&i({time:o}),a.destroy()})}function cXe(t,e){var n;let i=uXe(t||((n=e==null?void 0:e.schedule)==null?void 0:n.default_time));return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function uXe(t){t=t||"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t&&t.split(" ")||"",{0:i.hours,1:i.minutes}=e.time&&e.time.split(":")||"",i.ampm=e.ampm,i}const{AFTER_REST:yZ,FOLLOWED_BY:IZ,NEXT_AVAILABLE:bZ,NOT_BEFORE:wZ,TO_BE_ANNOUNCED:SZ}=$A;function R0e({e:t,cell:e,callback:i,matchUpId:n}={}){const r=e.getRow().getData(),a=h=>{const f=Object.values(r).filter(y=>y==null?void 0:y.matchUpId),g=[{params:{matchUpIds:n?[n]:f.map(({matchUpId:y})=>y),schedule:h},method:u0e}];Pt({methods:g,callback:y=>{y.success&&pt(i)&&i(h)}})},o=()=>a({scheduledTime:"",timeModifiers:[]}),s=({time:h})=>{const m=hi.dateTime.convertTime(h,!0);a({scheduledTime:m})},l=()=>{const f=e.getTable().getData();let m;const g=f.flatMap((b,D)=>{if(!m&&!(b.rowId===r.rowId&&(m=D+1,D)))return Object.values(b).flatMap(w=>{var S;return(S=w==null?void 0:w.schedule)==null?void 0:S.scheduledTime})}).filter(Boolean).map(rXe),v=Math.max(...g,0),y=m>1,I=v&&aXe(v,y)||"8:00 AM";lXe({time:I,callback:s})},c=h=>a({timeModifiers:[h]}),d=[{option:n?"Set match time":"Set match times",onClick:l},{option:DS[IZ],onClick:()=>c(IZ)},{option:DS[bZ],onClick:()=>c(bZ)},{option:DS[wZ],onClick:()=>c(wZ)},{option:DS[yZ],onClick:()=>c(yZ)},{option:DS[SZ],onClick:()=>c(SZ)},{option:"Clear time settings",onClick:o}],p=t.target;nl({options:d,target:p,config:{placement:vt}})}function dXe({courtInfo:t}){ir({title:"Rename Court",content:n=>Wr(n,[{value:t.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:n})=>{const r=n==null?void 0:n.courtName.value;r&&r!==t.courtName&&console.log({newValue:r})},close:!0}]})}function pXe(t,e,i){const r=[{option:`${Nr.tr("remove")} court identifiers`,onClick:o},{option:Nr.tr("rename"),onClick:()=>dXe({courtInfo:i})}],a=t.target;nl({options:r,target:a});function o(){console.log("toggle court identifiers",{cell:e})}}function hXe(t,e){t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=e.getTable(),r=n.getData(),a=e.getRow().getData();let o=n.getData().flatMap(C=>Object.values(C).filter(E=>E.matchUpId)),s=o.find(C=>C.matchUpId===i);s||(s=na.findTable(`#${Dv}`)[0].getData().map(P=>P.matchUp).find(P=>P.matchUpId===i)||{});const l=document.getElementById(Wle).value,{courtOrder:c,courtId:u,venueId:d}=s.schedule||{},p=t.currentTarget,h=p.id;if(i===h)return;const f=s.schedule,m=h&&o.find(C=>C.matchUpId===h),g=p.getAttribute("venueId"),v=p.getAttribute("courtId"),y=p.getAttribute("courtOrder"),I=Object.keys(a).find(C=>{var R;if(!ru(a[C]))return;const E=((R=a[C])==null?void 0:R.schedule)||{},{courtOrder:P,courtId:M,venueId:N}=E;return(P==null?void 0:P.toString())===y.toString()&&N===g&&M===v});let b;const D=r.find(C=>(b=Object.keys(C).find(E=>{var A;if(!ru(C[E]))return;const P=((A=C[E])==null?void 0:A.schedule)||{},{courtOrder:M,courtId:N,venueId:R}=P;return M===c&&R===d&&N===u}),b)),w=({scheduledTime:C="",timeModifiers:E=[]}={})=>{const P={courtOrder:y,scheduledDate:l,venueId:g,courtId:v,scheduledTime:C,timeModifiers:E},M=[{method:G2,params:{tournamentId:s==null?void 0:s.tournamentId,matchUpId:s==null?void 0:s.matchUpId,schedule:P,drawId:s==null?void 0:s.drawId}}];Pt({methods:M,engine:bR,callback:R=>!R.success&&console.log({result:R})}),s.schedule=P},S={scheduledDate:f==null?void 0:f.scheduledDate,scheduledTime:f==null?void 0:f.scheduledTime,timeModifiers:f==null?void 0:f.timeModifiers,courtOrder:c,venueId:d,courtId:u},U=()=>{const C=[{method:G2,params:{tournamentId:m==null?void 0:m.tournamentId,matchUpId:m==null?void 0:m.matchUpId,schedule:S,drawId:m==null?void 0:m.drawId}}];Pt({methods:C,engine:bR,callback:P=>!P.success&&console.log({result:P})}),m?m.schedule=S:console.log("missing targetMatchUp")};if(h==="")D?(w(),D[b]={schedule:{courtOrder:c,venueId:d,courtId:u}},D.rowId==a.rowId?(D[I]=s,n.updateData([D])):(a[I]=s,n.updateData([D,a]))):(na.findTable(`#${Dv}`)[0].deleteRow(i),w(),a[I]=s,n.updateData([a]));else if(!D&&m){const C=na.findTable(`#${Dv}`)[0];C.deleteRow(i),w(),a[I]=s,n.updateData([a]),C.addRow(fS(m),!0),U()}else{const C=m==null?void 0:m.schedule;w({scheduledTime:C==null?void 0:C.scheduledTime,timeModifiers:C==null?void 0:C.timeModifiers}),U(),D.rowId==a.rowId?(D[b]=m,D[I]=s,n.updateData([D])):(D[b]=m,a[I]=s,n.updateData([D,a]))}kN(n)}const{SCHEDULE_STATE:fXe,SCHEDULE_ERROR:mXe,SCHEDULE_WARNING:gXe,SCHEDULE_CONFLICT:vXe}=mo.scheduleConstants;function N0e(t){var N;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const n=t.getValue(),{potentialParticipants:r,eventName:a="",roundName:o="",schedule:s={},matchUpStatus:l,winningSide:c,matchUpId:u,sides:d}=n||{},{courtOrder:p="",scheduledTime:h="",courtId:f="",timeModifiers:m,venueId:g=""}=s;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",f),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=R=>R.preventDefault(),u)if(e.draggable=!0,e.id=u,c)e.classList.add("matchup-complete");else{const R=s[fXe];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):R===vXe?e.classList.add("matchup-conflict"):R===Hle?e.classList.add("matchup-issue"):R===gXe?e.classList.add("matchup-warning"):R===mXe&&e.classList.add("matchup-error")}if(e.addEventListener("drop",R=>hXe(R,t)),e.addEventListener("dragstart",M0e),!u)return e;const v=`${a} ${o}`,y=R=>{var A,_;return((_=(A=R.person)==null?void 0:A.standardFamilyName)==null?void 0:_.toUpperCase())||R.participantName},I=r==null?void 0:r.map(R=>R==null?void 0:R.map(A=>`<span class='potential nowrap'>${y(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),b=R=>{var _,O;const A=(O=(_=d==null?void 0:d.find(x=>R===x.sideNumber))==null?void 0:_.participant)==null?void 0:O.participantName;if(A)return c===R?`<span style='font-weight: bold'>${A}</span>`:A},D=b(1)||(I==null?void 0:I.shift())||"Unkown",w=b(2)||(I==null?void 0:I.shift())||"Unknown";e.id=u;const S=document.createElement("div");S.className="header flexrow",S.innerHTML=((m==null?void 0:m[0])&&Qke[m[0]]+"&nbsp;"||"")+k6(h),e.appendChild(S);const U=document.createElement("div");U.className="catround",U.innerHTML=v,e.appendChild(U);const C=document.createElement("div");C.className="scheduled_teams";const E=document.createElement("div");E.className="scheduled_team",E.style="font-size: 1em",E.innerHTML=D,C.appendChild(E);const P=document.createElement("div");P.className="divider",P.innerHTML="vs.",C.appendChild(P);const M=document.createElement("div");if(M.className="scheduled_team",M.style="font-size: 1em",M.innerHTML=w,C.appendChild(M),c){const R=document.createElement("div");R.innerHTML=((N=n.score)==null?void 0:N.scoreStringSide1)||"",C.appendChild(R)}return e.appendChild(C),e}function yXe({values:t,valueChange:e,isValid:i}){const n=(o,s)=>l=>l.length>=o&&(!s||s&&l.length<=s),r=o=>!isNaN(o),a=o=>e(o);return[{placeholder:"Venue name",value:t.venueName||"",label:"Venue name",field:"venueName",error:"Please enter a name of at least 5 characters",validator:n(5),focus:!0,onChange:a},{value:t.venueAbbreviation||"",label:"Abbreviation",field:"venueAbbreviation",error:"Please enter an abbreviation of 2-6 characters",validator:n(2,6),onChange:a},{value:t.courtsCount||"",label:"Number of courts",field:"courtsCount",error:"Must be a whole number",validator:r,onChange:a}]}function IXe(t){return{venueAbbreviation:t==null?void 0:t.venueAbbreviation.value,courtsCount:t==null?void 0:t.courtsCount.value,venueName:t==null?void 0:t.venueName.value}}const bXe=t=>{const e=IXe(Ye.drawer.attributes.content),{venueName:i,venueAbbreviation:n,courtsCount:r}=e,a=hi.UUID();if(!i||!n||!r){ai({message:"Invalid values",intent:"is-danger"});return}const o=[{params:{venue:{venueName:i,venueAbbreviation:n,venueId:a},returnDetails:!0},method:X8e},{params:{courtsCount:parseInt(r),venueId:a,venueAbbreviationRoot:!0},method:H8e}];Pt({methods:o,callback:l=>{if(l!=null&&l.success&&pt(t)){const{venue:c}=$e.findVenue({venueId:a});c&&t({...l,venue:c})}}})};function A0e(t){const e=()=>{},i=r=>Wr(r,yXe({values:{},valueChange:e})),n=(r,a)=>PI(r,[{label:"Cancel",close:!0},{label:"Save",onClick:()=>bXe(t),close:!0,intent:"is-info"}],a);Ye.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:vt,content:i,footer:n})}function wXe({courtsData:t,count:e}){const i=r=>{r.stopPropagation(),r.preventDefault(),A0e(_0e)},n=r=>{if(!r)return t.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>"};return e>0?hi.generateRange(0,e).map(r=>({headerClick:a=>r===0&&i(a),title:n(r),headerHozAlign:At,formatter:N0e,headerSort:!1,resizable:!1,minWidth:150})):[]}function SXe({notice:t,notes:e,callback:i}){let n;ir({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const s=n.notice.value,l=n.notes.value;typeof i=="function"&&i({notice:s,notes:l})},close:!0}],content:s=>{n=Wr(s,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:TZ}=$A;function TXe(t,e){var r;const i=e.getRow().getData(),n=Object.values(i).filter(a=>a==null?void 0:a.matchUpId);(r=i.issues)!=null&&r.length&&console.log({issues:i.issues}),n.length&&R0e({e:t,cell:e,rowData:i,callback:o=>{if(ru(o)){const s=e.getTable(),l=s.getData().find(c=>c.rowId===i.rowId);Object.values(l).forEach(c=>{var u;c.matchUpId&&(o.scheduledTime&&(c.schedule.scheduledTime=k6(o.scheduledTime),((u=c.schedule.timeModifiers)==null?void 0:u[0])!==TZ&&(c.schedule.timeModifiers=[])),o.timeModifiers&&(c.schedule.scheduledTime&&o.timeModifiers[0]!==TZ&&(c.schedule.scheduledTime=""),c.schedule.timeModifiers=o.timeModifiers))}),s.updateData([l])}}})}function UXe(){function t(n){const r=n.getElement();return r.classList.add("tag"),r.classList.add("is-info"),r.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(n){n.getElement().style.backgroundColor="white";const r=document.createElement("span"),a=n.getRow().getData();return r.innerHTML=a.rowNumber,r}return{titleFormatter:t,formatter:e,headerClick:()=>{SXe({notes:"",notice:"",callback:n});function n(r){console.log({result:r})}},cellClick:TXe,headerSort:!1,resizable:!1,hozAlign:At,frozen:!0,width:55}}function DXe({courtsData:t,courtPrefix:e}){const i=(l,c)=>{const u=c.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=c.getData()[u];R0e({e:l,cell:c,matchUpId:p,callback:()=>{var v,y;const f=(y=(v=$e.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0}))==null?void 0:v.matchUps)==null?void 0:y[0],m=c.getRow().getData();m[u]=f,c.getTable().updateData([m])}})},n=Zke-t.length,r=n<=0?1:n,a=wXe({courtsData:t,count:r}),o=UXe(),s=(l,c)=>({headerClick:(u,d)=>pXe(u,d,l),cellClick:i,field:`${e}${c}`,title:l.courtName,headerHozAlign:At,formatter:N0e,headerSort:!1,resizable:!1,hozAlign:At,minWidth:150});return[o].concat(t.map(s),a)}function PXe({scheduledDate:t}={}){let e,i,n,r=[];const a=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},h=Sg.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:f=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:I}=h,b=f.concat(...m),D=DXe({courtsData:g,courtPrefix:v});return y.forEach((w,S)=>{w.rowId=`rowId-${S+1}`,w.rowNumber=S+1}),{rows:y,columns:D,matchUps:b,courtsCount:g.length,courtsData:g,groupInfo:I}},o=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:h,matchUps:f,columns:m,courtsData:g}=a({scheduledDate:d}),v=g==null?void 0:g.map(I=>I.courtId);hi.intersection(r,v).length===(v==null?void 0:v.length)||(i.setColumns(m),r=v),n=!0,i==null||i.replaceData(h),i.matchUps=f},e?0:1e3)};oh({anchorId:TR});const s=document.getElementById(TR),{rows:l=[],columns:c=[],courtsCount:u}=a({scheduledDate:t});return r=c.map(({courtId:d})=>d).filter(Boolean),i=new na(s,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:c}),i.on("scrollVertical",vc),i.on("tableBuilt",()=>{kN(i),e=!0}),i.on("dataProcessed",()=>{n&&(n=!1,kN(i))}),{table:i,replaceTableData:o,courtsCount:u}}function CXe({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:n}){const a=[{params:{matchUps:n.getData("active").map(s=>s.matchUp),scheduledDate:i},method:l9e}];Pt({methods:a,callback:s=>{s.success&&(t(),e())},engine:bR})}function EXe({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:n,callback:r}){const a=Sg.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:o=[],completedMatchUps:s=[]}=a,c=o.concat(...s).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),u=c.filter(({schedule:m})=>m.scheduledDate===t);let d=[{option:"Clear scheduled matches",disabled:!u.length,onClick:f},{option:"Clear all matches",disabled:!u.length,onClick:h},{option:"Clear all days",disabled:!c.length,onClick:p}];d.filter(m=>!m.disabled).length&&nl({target:e,options:d,config:{placement:Ef}});function p(){f({all:!0})}function h(){f({completed:!0})}function f({all:m,completed:g}={}){let v=c.filter(({schedule:w})=>w.scheduledDate===t).filter(({roundName:w})=>!i||i===w).filter(({eventId:w})=>!n||n===w);g||(v=v==null?void 0:v.filter(({matchUpStatus:w,winningSide:S})=>w!=="COMPLETED"&&!S));const I=(m?c:v).map(w=>w.matchUpId);Pt({methods:[{method:u0e,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},matchUpIds:I}}],callback:w=>{w.success&&pt(r)&&r()}})}}const UZ="All events",DZ="All rounds";function MXe({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,roundNameFilter:n,controlAnchor:r,eventIdFilter:a,scheduledDate:o,matchUps:s=[],table:l}){const c=C=>C.eventId===a,u=C=>{l.removeFilter(c),a=C,C&&l.addFilter(c)},d=$e.getEvents().events||[],h=[{label:UZ,onClick:()=>u(),close:!0}].concat(d.map(C=>({onClick:()=>u(C.eventId),label:C.eventName,close:!0}))),f=C=>C.roundName===n,m=hi.unique(s.map(C=>C.roundName)),g=C=>{l.removeFilter(f),n=C,C&&l.addFilter(f)},y=[{label:DZ,onClick:()=>g(),close:!0}].concat(m.map(C=>({onClick:()=>g(C),label:C,close:!0}))),I=()=>{t()&&e(),console.log("clear filters ?")},b=C=>{const E=ms(C.target,"dropdown");EXe({target:E||(C==null?void 0:C.target),callback:I,roundNameFilter:n,eventIdFilter:a,scheduledDate:o,eventFilter:c,roundFilter:f})},D=UI(l),S=[{onClick:()=>CXe({scheduledDate:o,table:l,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:b,intent:"is-warning",id:"clearSchedule",close:!0}],U=[{onKeyDown:C=>C.keyCode===8&&C.target.value.length===1&&D(""),onChange:C=>D(C.target.value),onKeyUp:C=>D(C.target.value),clearSearch:()=>D(""),placeholder:"Search participants",location:Et,search:!0},{hide:h.length<2,options:h,id:"eventOptions",label:UZ,modifyLabel:!0,location:Et,selection:!0},{hide:y.length<2,options:y,id:"roundOptions",label:DZ,modifyLabel:!0,location:Et,selection:!0},{options:S,label:"Actions",selection:!1,location:vt,align:vt},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];ho({target:r,items:U}).elements}function RXe({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:n,courtsCount:r,setDate:a}={}){if(!i)return;let o;const s=f=>AN(f).format("dddd MMM D"),{startDate:l,endDate:c}=Sg.getCompetitionDateRange(),d=hi.generateDateRange(l,c).map(f=>({onClick:()=>pt(a)&&a(f),isActive:f===n,label:s(f),value:f,close:!0})),p=()=>{},h=[{clearSearch:()=>p(),placeholder:"Search participants",id:"searchParticipants",visible:!!r,location:Et,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!r,id:"highlightTeam",location:Et,align:Et},{visible:!!r&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:vt},{label:s(n||l),value:n||l,id:Wle,options:d,modifyLabel:!0,intent:"is-info",location:vt,align:vt}];return o=ho({target:i,items:h}).elements,{elements:o}}function _0e({scheduledDate:t}){let e;const i=document.getElementById(Qle),n=document.getElementById(rW),r=document.getElementById(aW);n.style.paddingBottom="1em",r.style.paddingBottom="1em";let a=Ye.state.schedulingActive;i.style.display=a?"":ct,t=t||Sg.getCompetitionDateRange().startDate;const{replaceTableData:o,table:s,unscheduledMatchUps:l}=nXe({scheduledDate:t}),c=()=>{a=!a,Ye.state.schedulingActive=a,i.style.display=a?"":ct,e!=null&&e.scheduleMatchUps&&(e.scheduleMatchUps.style.display=a?ct:"")},{replaceTableData:u,table:d,courtsCount:p}=PXe({scheduledDate:t});MXe({controlAnchor:n,matchUps:l,table:s,updateUnscheduledTable:o,updateScheduleTable:u,toggleUnscheduled:c,scheduledDate:t}),e=RXe({table:d,unscheduledMatchUps:l,updateScheduleTable:u,toggleUnscheduled:c,schedulingActive:a,controlAnchor:r,scheduledDate:t,courtsCount:p,setDate:f=>{Ye.displayed.schedule_day=f,o({scheduledDate:f}),u({scheduledDate:f})}}).elements}const{SUBSTITUTION:PZ,PENALTY:CZ,REMOVE_PARTICIPANT:EZ,REPLACE_PARTICIPANT:MZ}=YG,{POLICY_TYPE_MATCHUP_ACTIONS:NXe}=lg,{ASSIGN_PARTICIPANT:W2}=Ky,{TEAM:AXe,DOUBLES:k0e}=Xo,_Xe=hi.extractAttributes;function tD(t,e,i,n){var v;if(!e)return;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(y=>y.remove());return}const o=e.getRow().getData(),s=e.getColumn().getDefinition(),l=o.matchUpType===k0e,c=o.eventType===AXe,{matchUpId:u,drawId:d}=o,p=s.field==="side1"&&1||s.field==="side2"&&2,{validActions:h}=$e.matchUpActions({matchUpId:u,drawId:d,sideNumber:p,policyDefinitions:{[NXe]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),f=(v=n==null?void 0:n.individualParticipant)==null?void 0:v.participantId,m={[W2]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l},text:"Assign participant",method:vF},[CZ]:{onClick:()=>console.log({data:o}),text:"Assess penalty"},[EZ]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Remove participant",method:kXe},[MZ]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Replace participant",method:vF},[PZ]:{params:{data:o,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},method:vF,text:"Substitution"}},g=h.filter(({type:y})=>[W2,CZ,EZ,MZ,PZ].includes(y)).map(y=>{const I=m[y.type];return{onClick:()=>{pt(I.method)?I.method({...I.params,action:y}):pt(I.onClick)&&I.onClick()},text:I.text}});g.length===1?g[0].onClick():g.length>0&&(t!=null&&t.target)&&nl({items:g,target:t.target,config:{placement:Ef}})}function kXe(t){const{action:e,callback:i,clickedParticipantId:n}=t;e.payload.participantId=n;const r=[{method:e.method,params:e.payload}];Pt({methods:r,callback:o=>pt(i)&&i(o)})}function vF(t){var m;const{sideNumber:e,callback:i,isTeam:n,isDoubles:r,data:a}=t,o=t.action.availableParticipants,s=a.matchUp.matchUpType,l=a.matchUp.sides.find(g=>e===g.sideNumber),c=(m=l==null?void 0:l.participant)==null?void 0:m.individualParticipantIds,u=t.clickedParticipantId;yE({selectedParticipantIds:c,selectOnEnter:!0,selectionLimit:s===k0e&&!u?2:1,onSelection:g=>{if(g.participantId||g.selected){const v=[];(Array.isArray(g.selected)?g.selected.map(_Xe("participantId")):[g.participantId]).filter(Boolean).forEach(b=>{v.push({params:{...t.action.payload,substituteParticipantId:b,newParticipantId:b,existingParticipantId:u,participantId:b},method:t.action.method})}),Pt({methods:v,callback:b=>{pt(i)&&i(b)}})}},action:{type:W2,participantsAvailable:o},title:n&&r?"Doubles: Select participants":void 0})}function O0e(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function x0e(t){var o;const e=t.getRow().getData();if(!((o=e.competitiveProfile)!=null&&o.competitiveness))return;const{competitiveProfile:i,score:n}=e,r=document.createElement("span"),a={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:s}=i;r.style="font-size: smaller",r.style.color=a[s],r.innerHTML=s}return r}function O6(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",n=document.createElement("span");return n.classList.add("scoreCell"),e.score?(n.style="font-size: smaller",n.innerHTML=e.score):i?n.innerHTML="WO":(n.style="color: blue; font-size: smaller",n.innerHTML="Enter score"),n}function RZ(t){const e=document.createElement("div");return e.style="font-weight: bold",e.innerHTML=t.getValue(),e}function x6({pointerEvent:t,cell:e,matchUp:i,callback:n}){const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(u=>u.remove());return}const a=!(i!=null&&i.roundPosition)&&!(i!=null&&i.drawPositions),o=e&&t.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=(e==null?void 0:e.getRow().getData())||i,l=()=>{pt(n)&&n(s)},c=[{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];a&&c.push({onClick:()=>OXe({...i,callback:l}),text:"Delete match",color:"red"}),nl({items:c,target:o||t.target,config:{placement:Ef}})}function OXe({drawId:t,structureId:e,matchUpId:i,callback:n}){Pt({methods:[{method:d0e,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:o=>{o.success?pt(n)&&n():console.log({postMutationError:o.error})}})}const NZ=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&EI(t)(e,i))??i},v1=t=>({cell:e,event:i,...n})=>{tD(i,e,a=>{if(a.success){const o=e.getRow(),{drawId:s,matchUpId:l}=t,c=$e.findMatchUp({drawId:s,matchUpId:l}).matchUp,u=o.getData().matchUp.collectionId,p=c.tieMatchUps.filter(f=>f.collectionId===u).map(f=>fS({...f,dualMatchUp:t})),h=e.getTable();h.updateData(p),h.redraw(!0)}},n)},ON=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let n={};const r=(d,p)=>d.filter(h=>p.indexOf(h)!==-1).filter((h,f,m)=>m.indexOf(h)===f);e.reset=()=>(n={},e),e.register=(d,p,h,f)=>(typeof h=="function"&&(n[p]||(n[p]={},i[p]=[]),n[p][d]={fx:h,delay:f},i[p]=Object.keys(n[p])),e),e.deRegister=(d,p)=>(n[p]&&(delete n[p][d],i[p]=Object.keys(n[p])),e),e.call=(d,p,...h)=>{var f,m;return(m=(f=n==null?void 0:n[p])==null?void 0:f[d])==null?void 0:m.fx(...h)},e.trigger=(d,p,h,f)=>n[p][d].fx(h,f,p),e.list=()=>console.log(n);const a="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(a,d=>s({evt:d,evnt:"tap"})),document.addEventListener("change",d=>s({evt:d,evnt:"change"})),document.addEventListener("click",d=>s({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>s({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>s({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>s({evt:d,evnt:"keyup",stopPropagation:!1}));let o=0;function s({evt:d,evnt:p,stopPropagation:h=!0}){h&&d.stopPropagation();const f={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let m=Array.from(d.target.classList),g=m.length&&i[p]?r(m,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-o,o=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:f})})}}function l({cls:d,evt:p,evnt:h,mouse:f}){let m=p.target;n[h][d].fx(m,f,h,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){u()},e.holdTime))},!1),document.addEventListener("touchend",function(){c()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&c()},!1);function c(){clearTimeout(t)}function u(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,h="";function f(){clearTimeout(p),d=!0,h!=="can-touch"&&(h="can-touch",document.documentElement.classList.add(h)),p=setTimeout(function(){d=!1},500)}function m(){!d&&h==="can-touch"&&(d=!1,h="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",f,!1),document.addEventListener("mouseover",m,!1)}(),e}(),xXe=""+new URL("completed-DD-jSIm6.png",import.meta.url).href;function L0e(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}const LXe=function(){let t={};t.display=({muid:l,teams:c})=>{let u={scoreboard:"sbId"},{ids:d,html:p}=e({muid:l,teams:c});return ir({content:p,config:{maxWidth:450}}),Object.assign(d,u),L0e(d)};function e({muid:l,teams:c,round_name:u,match:d}){let p={root:"sb-root",actions:"sb-actions",favorite:"sb-favorite",scoring:"sb-scoring",delegate:"sb-delegate",docs:"sb-docs",clear:"sb-clear",cancel:"sb-cancel",accept:"sb-accept",p1action:"sb-p1action",p2action:"sb-p2action",p1scores:"sb-p1scores",p2scores:"sb-p2score",round_name:"sb-round-name",p1scores_e:"sb-p1scores-e",p2scores_e:"sb-p2scores-e",p1selector:"sb-p1selector",p2selector:"sb-p2selector",p1tiebreak:"sb-p1tiebreak",p2tiebreak:"sb-p2tiebreak",details:"sb-details"},h=i();Object.assign(p,h.ids);let f=`
         <div id="${p.root}" class="scoreboard noselect muid ${p.root}" muid='${l}'>
            <div class='scorebox'>
               <div class='info'>
                  <span class="info-text">
                     <span class="round_name" id='${p.round_name}'>${u||""}</span>
                  </span>
                  <div id='${p.favorite}' class='fav favoriteMatch' style='display: none'></div>
                  <div id='${p.scoring}' class='options' style='display: none'>-</div>
               </div>
               <div class='sbox'>
                  <div class='sbcol flexgrow'> 
                     <div class="opponent opponent0">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${o({team:c[0],index:0})}
                              ${o({team:c[0],index:1})}
                           </div>
                        </div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${o({team:c[1],index:0})}
                              ${o({team:c[1],index:1})}
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class='sbcol'> 
                     <div class="opponent opponent0">
                        <div id="${p.p1scores}" class="opponent-scores"></div>
                        <div id="${p.p1selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p1tiebreak}"> </div>
                        <div id="${p.p1scores_e}" class="opponent-scores"></div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div id="${p.p2scores}" class="opponent-scores"></div>
                        <div id="${p.p2selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p2tiebreak}"> </div>
                        <div id="${p.p2scores_e}" class="opponent-scores"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">
                        <div id="${p.p1action}" class="score-action"></div>
                     </div>
                     <div class="opponent opponent1">
                        <div id="${p.p2action}" class="score-action"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">&nbsp;</div>
                     <div class="opponent opponent1">&nbsp;</div>
                  </div>

               </div>
               <div class="info">
                  <span class="info-text"> <span id="${p.details}" class="court">${r(d)}</span> </span>
                  <div id='${p.delegate}' class='options' style='display: none'>&#x25B7;</div>
               </div>
            </div>

            ${h.html}

            <div id='${p.actions}' class="scoreboard-action">
               <div class="edit flexcol">
                  <div class="frame">
                     <div class="scoreboard-actions">
                        <button id='${p.cancel}' class='btn dismiss'>${Nr.tr("actions.cancel")}</button>
                        <button id='${p.clear}' class='btn dismiss'>${Nr.tr("clr")}</button>
                        <button id='${p.accept}' class='btn accept'>${Nr.tr("apt")}</button>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      `;return{ids:p,html:f}}function i(){let l={edit_scoring:"sbcfg-edit",bestof:"sbcfg-bestof",setsto:"sbcfg-setsto",tiebreaksat:"sbcfg-tiebreasat",tiebreaksto:"sbcfg-tiebreaksto",finalset:"sbcfg-finalset",supertiebreakto:"sbcfg-supertbto",stb2:"sbcfg-stb2"},c=`
            <div id='${l.edit_scoring}' class="scoreboard-config scoreboard-action">
               <div class="edit configure sb_flexrow">
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Nr.tr("scoring_format.bestof")}</div>
                     <div style='text-align: right'>${Nr.tr("scoring_format.tbat")}</div>
                     <div style='text-align: right'>${Nr.tr("scoring_format.finalset")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.bestof}" class="score-selector"></div>
                     <div id="${l.tiebreaksat}" class="score-selector"></div>
                     <div id="${l.finalset}" class="score-selector"></div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Nr.tr("scoring_format.setsto")}</div>
                     <div style='text-align: right'>${Nr.tr("scoring_format.tbto")}</div>
                     <div id='${l.stb2}' style='text-align: right'>${Nr.tr("scoring_format.superto")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.setsto}" class="score-selector"></div>
                     <div id="${l.tiebreaksto}" class="score-selector"></div>
                     <div id="${l.supertiebreakto}" class="score-selector"></div>
                  </div>
               </div>
            </div>
      `;return{ids:l,html:c}}const n=(l,c)=>{let u=parseInt(l,10),d=Math.floor(u/3600),p=Math.floor((u-d*3600)/60),h=u-d*3600-p*60,f=!c||(c==null?void 0:c.display_seconds),m=!c||(c==null?void 0:c.pad_hours);return d<10&&m&&(d="0"+d),p<10&&(p="0"+p),h<10&&(h="0"+h),f?d+":"+p+":"+h:d+":"+p};function r(l){if(!l)return"";if(l.status)return l.status;if(!l.schedule)return"";let c=a(l.schedule);if(c)return`Duration ${c}`;let u=`${l.schedule.time_prefix||""}${l.schedule.time||""}`,d=`${l.schedule.court||""}${u?" / "+u:""}`;return l.winner_index===void 0?d:""}function a(l){if(!l.start||!l.end)return"";let c=s(l.end)-s(l.start);return n(c,{pad_hours:!1,display_seconds:!1})}function o({team:l,index:c=0}){var p,h;if(c===1)return"";const u=(p=l.person)==null?void 0:p.nationalityCode;return`
         <div class="team_player">
            <span class="pad">${u?(h=ew.countryToFlag(u))==null?void 0:h.slice(0,4):""}</span>
            <span class="pad">${l.participantName}</span>
            <span class="pad"></span>
         </div>
      `}function s(l){let c=l.split(":");return c[0]*60*60+c[1]*60}return t}();function F0e(t,e){if(!t||!e)return;let i=Object.keys(t),n=Object.keys(e);for(let r of i)if(n.indexOf(r)>=0){let a=e[r],o=t[r];typeof a=="object"&&typeof o!="function"&&a.constructor!==Array?F0e(t[r],e[r]):e[r]=t[r]}}function $0e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function FXe(t){return t.length===1&&(t=$Xe(t)),{left:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)<0?n=a+1:r=a}return n},right:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var a=n+r>>>1;t(e[a],i)>0?r=a:n=a+1}return n}}}function $Xe(t){return function(e,i){return $0e(t(e),i)}}FXe($0e);var BXe={value:function(){}};function B0e(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new MM(i)}function MM(t){this._=t}function VXe(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}MM.prototype=B0e.prototype={constructor:MM,on:function(t,e){var i=this._,n=VXe(t+"",i),r,a=-1,o=n.length;if(arguments.length<2){for(;++a<o;)if((r=(t=n[a]).type)&&(r=jXe(i[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++a<o;)if(r=(t=n[a]).type)i[r]=AZ(i[r],t.name,e);else if(e==null)for(r in i)i[r]=AZ(i[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new MM(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,a;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(a=this._[t],n=0,r=a.length;n<r;++n)a[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,a=n.length;r<a;++r)n[r].value.apply(e,i)}};function jXe(t,e){for(var i=0,n=t.length,r;i<n;++i)if((r=t[i]).name===e)return r.value}function AZ(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=BXe,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var q2="http://www.w3.org/1999/xhtml";const _Z={svg:"http://www.w3.org/2000/svg",xhtml:q2,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function bx(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),_Z.hasOwnProperty(e)?{space:_Z[e],local:t}:t}function GXe(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===q2&&e.documentElement.namespaceURI===q2?e.createElement(t):e.createElementNS(i,t)}}function HXe(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function V0e(t){var e=bx(t);return(e.local?HXe:GXe)(e)}function zXe(){}function L6(t){return t==null?zXe:function(){return this.querySelector(t)}}function WXe(t){typeof t!="function"&&(t=L6(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=new Array(o),l,c,u=0;u<o;++u)(l=a[u])&&(c=t.call(l,l.__data__,u,a))&&("__data__"in l&&(c.__data__=l.__data__),s[u]=c);return new Oc(n,this._parents)}function qXe(){return[]}function j0e(t){return t==null?qXe:function(){return this.querySelectorAll(t)}}function KXe(t){typeof t!="function"&&(t=j0e(t));for(var e=this._groups,i=e.length,n=[],r=[],a=0;a<i;++a)for(var o=e[a],s=o.length,l,c=0;c<s;++c)(l=o[c])&&(n.push(t.call(l,l.__data__,c,o)),r.push(l));return new Oc(n,r)}function G0e(t){return function(){return this.matches(t)}}function YXe(t){typeof t!="function"&&(t=G0e(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=[],l,c=0;c<o;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&s.push(l);return new Oc(n,this._parents)}function H0e(t){return new Array(t.length)}function ZXe(){return new Oc(this._enter||this._groups.map(H0e),this._parents)}function xN(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}xN.prototype={constructor:xN,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function XXe(t){return function(){return t}}var kZ="$";function JXe(t,e,i,n,r,a){for(var o=0,s,l=e.length,c=a.length;o<c;++o)(s=e[o])?(s.__data__=a[o],n[o]=s):i[o]=new xN(t,a[o]);for(;o<l;++o)(s=e[o])&&(r[o]=s)}function QXe(t,e,i,n,r,a,o){var s,l,c={},u=e.length,d=a.length,p=new Array(u),h;for(s=0;s<u;++s)(l=e[s])&&(p[s]=h=kZ+o.call(l,l.__data__,s,e),h in c?r[s]=l:c[h]=l);for(s=0;s<d;++s)h=kZ+o.call(t,a[s],s,a),(l=c[h])?(n[s]=l,l.__data__=a[s],c[h]=null):i[s]=new xN(t,a[s]);for(s=0;s<u;++s)(l=e[s])&&c[p[s]]===l&&(r[s]=l)}function eJe(t,e){if(!t)return h=new Array(this.size()),c=-1,this.each(function(w){h[++c]=w}),h;var i=e?QXe:JXe,n=this._parents,r=this._groups;typeof t!="function"&&(t=XXe(t));for(var a=r.length,o=new Array(a),s=new Array(a),l=new Array(a),c=0;c<a;++c){var u=n[c],d=r[c],p=d.length,h=t.call(u,u&&u.__data__,c,n),f=h.length,m=s[c]=new Array(f),g=o[c]=new Array(f),v=l[c]=new Array(p);i(u,d,m,g,v,h,e);for(var y=0,I=0,b,D;y<f;++y)if(b=m[y]){for(y>=I&&(I=y+1);!(D=g[I])&&++I<f;);b._next=D||null}}return o=new Oc(o,n),o._enter=s,o._exit=l,o}function tJe(){return new Oc(this._exit||this._groups.map(H0e),this._parents)}function iJe(t,e,i){var n=this.enter(),r=this,a=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),i==null?a.remove():i(a),n&&r?n.merge(r).order():r}function nJe(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var l=e[s],c=i[s],u=l.length,d=o[s]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;s<n;++s)o[s]=e[s];return new Oc(o,this._parents)}function rJe(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],r=n.length-1,a=n[r],o;--r>=0;)(o=n[r])&&(a&&o.compareDocumentPosition(a)^4&&a.parentNode.insertBefore(o,a),a=o);return this}function aJe(t){t||(t=oJe);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,n=i.length,r=new Array(n),a=0;a<n;++a){for(var o=i[a],s=o.length,l=r[a]=new Array(s),c,u=0;u<s;++u)(c=o[u])&&(l[u]=c);l.sort(e)}return new Oc(r,this._parents).order()}function oJe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function sJe(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function lJe(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function cJe(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,a=n.length;r<a;++r){var o=n[r];if(o)return o}return null}function uJe(){var t=0;return this.each(function(){++t}),t}function dJe(){return!this.node()}function pJe(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r=e[i],a=0,o=r.length,s;a<o;++a)(s=r[a])&&t.call(s,s.__data__,a,r);return this}function hJe(t){return function(){this.removeAttribute(t)}}function fJe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function mJe(t,e){return function(){this.setAttribute(t,e)}}function gJe(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function vJe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function yJe(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function IJe(t,e){var i=bx(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?fJe:hJe:typeof e=="function"?i.local?yJe:vJe:i.local?gJe:mJe)(i,e))}function z0e(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function bJe(t){return function(){this.style.removeProperty(t)}}function wJe(t,e,i){return function(){this.style.setProperty(t,e,i)}}function SJe(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function TJe(t,e,i){return arguments.length>1?this.each((e==null?bJe:typeof e=="function"?SJe:wJe)(t,e,i??"")):Gw(this.node(),t)}function Gw(t,e){return t.style.getPropertyValue(e)||z0e(t).getComputedStyle(t,null).getPropertyValue(e)}function UJe(t){return function(){delete this[t]}}function DJe(t,e){return function(){this[t]=e}}function PJe(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function CJe(t,e){return arguments.length>1?this.each((e==null?UJe:typeof e=="function"?PJe:DJe)(t,e)):this.node()[t]}function W0e(t){return t.trim().split(/^|\s+/)}function F6(t){return t.classList||new q0e(t)}function q0e(t){this._node=t,this._names=W0e(t.getAttribute("class")||"")}q0e.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function K0e(t,e){for(var i=F6(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function Y0e(t,e){for(var i=F6(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function EJe(t){return function(){K0e(this,t)}}function MJe(t){return function(){Y0e(this,t)}}function RJe(t,e){return function(){(e.apply(this,arguments)?K0e:Y0e)(this,t)}}function NJe(t,e){var i=W0e(t+"");if(arguments.length<2){for(var n=F6(this.node()),r=-1,a=i.length;++r<a;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof e=="function"?RJe:e?EJe:MJe)(i,e))}function AJe(){this.textContent=""}function _Je(t){return function(){this.textContent=t}}function kJe(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function OJe(t){return arguments.length?this.each(t==null?AJe:(typeof t=="function"?kJe:_Je)(t)):this.node().textContent}function xJe(){this.innerHTML=""}function LJe(t){return function(){this.innerHTML=t}}function FJe(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function $Je(t){return arguments.length?this.each(t==null?xJe:(typeof t=="function"?FJe:LJe)(t)):this.node().innerHTML}function BJe(){this.nextSibling&&this.parentNode.appendChild(this)}function VJe(){return this.each(BJe)}function jJe(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function GJe(){return this.each(jJe)}function HJe(t){var e=typeof t=="function"?t:V0e(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function zJe(){return null}function WJe(t,e){var i=typeof t=="function"?t:V0e(t),n=e==null?zJe:typeof e=="function"?e:L6(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function qJe(){var t=this.parentNode;t&&t.removeChild(this)}function KJe(){return this.each(qJe)}function YJe(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function ZJe(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function XJe(t){return this.select(t?ZJe:YJe)}function JJe(t){return arguments.length?this.property("__data__",t):this.node().__data__}var Z0e={};if(typeof document<"u"){var QJe=document.documentElement;"onmouseenter"in QJe||(Z0e={mouseenter:"mouseover",mouseleave:"mouseout"})}function eQe(t,e,i){return t=X0e(t,e,i),function(n){var r=n.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,n)}}function X0e(t,e,i){return function(n){try{t.call(this,this.__data__,e,i)}finally{}}}function tQe(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function iQe(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,r=e.length,a;i<r;++i)a=e[i],(!t.type||a.type===t.type)&&a.name===t.name?this.removeEventListener(a.type,a.listener,a.capture):e[++n]=a;++n?e.length=n:delete this.__on}}}function nQe(t,e,i){var n=Z0e.hasOwnProperty(t.type)?eQe:X0e;return function(r,a,o){var s=this.__on,l,c=n(e,a,o);if(s){for(var u=0,d=s.length;u<d;++u)if((l=s[u]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=i),l.value=e;return}}this.addEventListener(t.type,c,i),l={type:t.type,name:t.name,value:e,listener:c,capture:i},s?s.push(l):this.__on=[l]}}function rQe(t,e,i){var n=tQe(t+""),r,a=n.length,o;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,c=s.length,u;l<c;++l)for(r=0,u=s[l];r<a;++r)if((o=n[r]).type===u.type&&o.name===u.name)return u.value}return}for(s=e?nQe:iQe,i==null&&(i=!1),r=0;r<a;++r)this.each(s(n[r],e,i));return this}function J0e(t,e,i){var n=z0e(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function aQe(t,e){return function(){return J0e(this,t,e)}}function oQe(t,e){return function(){return J0e(this,t,e.apply(this,arguments))}}function sQe(t,e){return this.each((typeof e=="function"?oQe:aQe)(t,e))}var Q0e=[null];function Oc(t,e){this._groups=t,this._parents=e}function IE(){return new Oc([[document.documentElement]],Q0e)}Oc.prototype=IE.prototype={constructor:Oc,select:WXe,selectAll:KXe,filter:YXe,data:eJe,enter:ZXe,exit:tJe,join:iJe,merge:nJe,order:rJe,sort:aJe,call:sJe,nodes:lJe,node:cJe,size:uJe,empty:dJe,each:pJe,attr:IJe,style:TJe,property:CJe,classed:NJe,text:OJe,html:$Je,raise:VJe,lower:GJe,append:HJe,insert:WJe,remove:KJe,clone:XJe,datum:JJe,on:rQe,dispatch:sQe};function eSe(t){return typeof t=="string"?new Oc([[document.querySelector(t)]],[document.documentElement]):new Oc([[t]],Q0e)}function $6(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function tSe(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function bE(){}var iD=.7,LN=1/iD,Pb="\\s*([+-]?\\d+)\\s*",nD="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",up="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",lQe=/^#([0-9a-f]{3,8})$/,cQe=new RegExp("^rgb\\("+[Pb,Pb,Pb]+"\\)$"),uQe=new RegExp("^rgb\\("+[up,up,up]+"\\)$"),dQe=new RegExp("^rgba\\("+[Pb,Pb,Pb,nD]+"\\)$"),pQe=new RegExp("^rgba\\("+[up,up,up,nD]+"\\)$"),hQe=new RegExp("^hsl\\("+[nD,up,up]+"\\)$"),fQe=new RegExp("^hsla\\("+[nD,up,up,nD]+"\\)$"),OZ={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};$6(bE,rD,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:xZ,formatHex:xZ,formatHsl:mQe,formatRgb:LZ,toString:LZ});function xZ(){return this.rgb().formatHex()}function mQe(){return iSe(this).formatHsl()}function LZ(){return this.rgb().formatRgb()}function rD(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=lQe.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?FZ(e):i===3?new yc(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?y1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?y1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=cQe.exec(t))?new yc(e[1],e[2],e[3],1):(e=uQe.exec(t))?new yc(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=dQe.exec(t))?y1(e[1],e[2],e[3],e[4]):(e=pQe.exec(t))?y1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=hQe.exec(t))?VZ(e[1],e[2]/100,e[3]/100,1):(e=fQe.exec(t))?VZ(e[1],e[2]/100,e[3]/100,e[4]):OZ.hasOwnProperty(t)?FZ(OZ[t]):t==="transparent"?new yc(NaN,NaN,NaN,0):null}function FZ(t){return new yc(t>>16&255,t>>8&255,t&255,1)}function y1(t,e,i,n){return n<=0&&(t=e=i=NaN),new yc(t,e,i,n)}function gQe(t){return t instanceof bE||(t=rD(t)),t?(t=t.rgb(),new yc(t.r,t.g,t.b,t.opacity)):new yc}function K2(t,e,i,n){return arguments.length===1?gQe(t):new yc(t,e,i,n??1)}function yc(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}$6(yc,K2,tSe(bE,{brighter:function(t){return t=t==null?LN:Math.pow(LN,t),new yc(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?iD:Math.pow(iD,t),new yc(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:$Z,formatHex:$Z,formatRgb:BZ,toString:BZ}));function $Z(){return"#"+yF(this.r)+yF(this.g)+yF(this.b)}function BZ(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function yF(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function VZ(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Yd(t,e,i,n)}function iSe(t){if(t instanceof Yd)return new Yd(t.h,t.s,t.l,t.opacity);if(t instanceof bE||(t=rD(t)),!t)return new Yd;if(t instanceof Yd)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),a=Math.max(e,i,n),o=NaN,s=a-r,l=(a+r)/2;return s?(e===a?o=(i-n)/s+(i<n)*6:i===a?o=(n-e)/s+2:o=(e-i)/s+4,s/=l<.5?a+r:2-a-r,o*=60):s=l>0&&l<1?0:o,new Yd(o,s,l,t.opacity)}function vQe(t,e,i,n){return arguments.length===1?iSe(t):new Yd(t,e,i,n??1)}function Yd(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}$6(Yd,vQe,tSe(bE,{brighter:function(t){return t=t==null?LN:Math.pow(LN,t),new Yd(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?iD:Math.pow(iD,t),new Yd(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new yc(IF(t>=240?t-240:t+120,r,n),IF(t,r,n),IF(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function IF(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function nSe(t){return function(){return t}}function yQe(t,e){return function(i){return t+i*e}}function IQe(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function bQe(t){return(t=+t)==1?rSe:function(e,i){return i-e?IQe(e,i,t):nSe(isNaN(e)?i:e)}}function rSe(t,e){var i=e-t;return i?yQe(t,i):nSe(isNaN(t)?e:t)}const jZ=function t(e){var i=bQe(e);function n(r,a){var o=i((r=K2(r)).r,(a=K2(a)).r),s=i(r.g,a.g),l=i(r.b,a.b),c=rSe(r.opacity,a.opacity);return function(u){return r.r=o(u),r.g=s(u),r.b=l(u),r.opacity=c(u),r+""}}return n.gamma=t,n}(1);function hm(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var Y2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,bF=new RegExp(Y2.source,"g");function wQe(t){return function(){return t}}function SQe(t){return function(e){return t(e)+""}}function TQe(t,e){var i=Y2.lastIndex=bF.lastIndex=0,n,r,a,o=-1,s=[],l=[];for(t=t+"",e=e+"";(n=Y2.exec(t))&&(r=bF.exec(e));)(a=r.index)>i&&(a=e.slice(i,a),s[o]?s[o]+=a:s[++o]=a),(n=n[0])===(r=r[0])?s[o]?s[o]+=r:s[++o]=r:(s[++o]=null,l.push({i:o,x:hm(n,r)})),i=bF.lastIndex;return i<e.length&&(a=e.slice(i),s[o]?s[o]+=a:s[++o]=a),s.length<2?l[0]?SQe(l[0].x):wQe(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)s[(d=l[u]).i]=d.x(c);return s.join("")})}var GZ=180/Math.PI,Z2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function aSe(t,e,i,n,r,a){var o,s,l;return(o=Math.sqrt(t*t+e*e))&&(t/=o,e/=o),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,o=-o),{translateX:r,translateY:a,rotate:Math.atan2(e,t)*GZ,skewX:Math.atan(l)*GZ,scaleX:o,scaleY:s}}var kS,wF,HZ,I1;function UQe(t){return t==="none"?Z2:(kS||(kS=document.createElement("DIV"),wF=document.documentElement,HZ=document.defaultView),kS.style.transform=t,t=HZ.getComputedStyle(wF.appendChild(kS),null).getPropertyValue("transform"),wF.removeChild(kS),t=t.slice(7,-1).split(","),aSe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function DQe(t){return t==null||(I1||(I1=document.createElementNS("http://www.w3.org/2000/svg","g")),I1.setAttribute("transform",t),!(t=I1.transform.baseVal.consolidate()))?Z2:(t=t.matrix,aSe(t.a,t.b,t.c,t.d,t.e,t.f))}function oSe(t,e,i,n){function r(c){return c.length?c.pop()+" ":""}function a(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push("translate(",null,e,null,i);f.push({i:m-4,x:hm(c,d)},{i:m-2,x:hm(u,p)})}else(d||p)&&h.push("translate("+d+e+p+i)}function o(c,u,d,p){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),p.push({i:d.push(r(d)+"rotate(",null,n)-2,x:hm(c,u)})):u&&d.push(r(d)+"rotate("+u+n)}function s(c,u,d,p){c!==u?p.push({i:d.push(r(d)+"skewX(",null,n)-2,x:hm(c,u)}):u&&d.push(r(d)+"skewX("+u+n)}function l(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push(r(h)+"scale(",null,",",null,")");f.push({i:m-4,x:hm(c,d)},{i:m-2,x:hm(u,p)})}else(d!==1||p!==1)&&h.push(r(h)+"scale("+d+","+p+")")}return function(c,u){var d=[],p=[];return c=t(c),u=t(u),a(c.translateX,c.translateY,u.translateX,u.translateY,d,p),o(c.rotate,u.rotate,d,p),s(c.skewX,u.skewX,d,p),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,p),c=u=null,function(h){for(var f=-1,m=p.length,g;++f<m;)d[(g=p[f]).i]=g.x(h);return d.join("")}}}var PQe=oSe(UQe,"px, ","px)","deg)"),CQe=oSe(DQe,", ",")",")"),Hw=0,JS=0,OS=0,sSe=1e3,FN,QS,$N=0,Uy=0,wx=0,aD=typeof performance=="object"&&performance.now?performance:Date,lSe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Sx(){return Uy||(lSe(EQe),Uy=aD.now()+wx)}function EQe(){Uy=0}function BN(){this._call=this._time=this._next=null}BN.prototype=cSe.prototype={constructor:BN,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?Sx():+i)+(e==null?0:+e),!this._next&&QS!==this&&(QS?QS._next=this:FN=this,QS=this),this._call=t,this._time=i,X2()},stop:function(){this._call&&(this._call=null,this._time=1/0,X2())}};function cSe(t,e,i){var n=new BN;return n.restart(t,e,i),n}function MQe(){Sx(),++Hw;for(var t=FN,e;t;)(e=Uy-t._time)>=0&&t._call.call(null,e),t=t._next;--Hw}function zZ(){Uy=($N=aD.now())+wx,Hw=JS=0;try{MQe()}finally{Hw=0,NQe(),Uy=0}}function RQe(){var t=aD.now(),e=t-$N;e>sSe&&(wx-=e,$N=t)}function NQe(){for(var t,e=FN,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:FN=i);QS=t,X2(n)}function X2(t){if(!Hw){JS&&(JS=clearTimeout(JS));var e=t-Uy;e>24?(t<1/0&&(JS=setTimeout(zZ,t-aD.now()-wx)),OS&&(OS=clearInterval(OS))):(OS||($N=aD.now(),OS=setInterval(RQe,sSe)),Hw=1,lSe(zZ))}}function WZ(t,e,i){var n=new BN;return e=e==null?0:+e,n.restart(function(r){n.stop(),t(r+e)},e,i),n}var AQe=B0e("start","end","cancel","interrupt"),_Qe=[],uSe=0,qZ=1,J2=2,RM=3,KZ=4,Q2=5,NM=6;function Tx(t,e,i,n,r,a){var o=t.__transition;if(!o)t.__transition={};else if(i in o)return;kQe(t,i,{name:e,index:n,group:r,on:AQe,tween:_Qe,time:a.time,delay:a.delay,duration:a.duration,ease:a.ease,timer:null,state:uSe})}function B6(t,e){var i=_d(t,e);if(i.state>uSe)throw new Error("too late; already scheduled");return i}function Vf(t,e){var i=_d(t,e);if(i.state>RM)throw new Error("too late; already running");return i}function _d(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function kQe(t,e,i){var n=t.__transition,r;n[e]=i,i.timer=cSe(a,0,i.time);function a(c){i.state=qZ,i.timer.restart(o,i.delay,i.time),i.delay<=c&&o(c-i.delay)}function o(c){var u,d,p,h;if(i.state!==qZ)return l();for(u in n)if(h=n[u],h.name===i.name){if(h.state===RM)return WZ(o);h.state===KZ?(h.state=NM,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete n[u]):+u<e&&(h.state=NM,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete n[u])}if(WZ(function(){i.state===RM&&(i.state=KZ,i.timer.restart(s,i.delay,i.time),s(c))}),i.state=J2,i.on.call("start",t,t.__data__,i.index,i.group),i.state===J2){for(i.state=RM,r=new Array(p=i.tween.length),u=0,d=-1;u<p;++u)(h=i.tween[u].value.call(t,t.__data__,i.index,i.group))&&(r[++d]=h);r.length=d+1}}function s(c){for(var u=c<i.duration?i.ease.call(null,c/i.duration):(i.timer.restart(l),i.state=Q2,1),d=-1,p=r.length;++d<p;)r[d].call(t,u);i.state===Q2&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=NM,i.timer.stop(),delete n[e];for(var c in n)return;delete t.__transition}}function OQe(t,e){var i=t.__transition,n,r,a=!0,o;if(i){e=e==null?null:e+"";for(o in i){if((n=i[o]).name!==e){a=!1;continue}r=n.state>J2&&n.state<Q2,n.state=NM,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[o]}a&&delete t.__transition}}function xQe(t){return this.each(function(){OQe(this,t)})}function LQe(t,e){var i,n;return function(){var r=Vf(this,t),a=r.tween;if(a!==i){n=i=a;for(var o=0,s=n.length;o<s;++o)if(n[o].name===e){n=n.slice(),n.splice(o,1);break}}r.tween=n}}function FQe(t,e,i){var n,r;if(typeof i!="function")throw new Error;return function(){var a=Vf(this,t),o=a.tween;if(o!==n){r=(n=o).slice();for(var s={name:e,value:i},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}a.tween=r}}function $Qe(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=_d(this.node(),i).tween,r=0,a=n.length,o;r<a;++r)if((o=n[r]).name===t)return o.value;return null}return this.each((e==null?LQe:FQe)(i,t,e))}function V6(t,e,i){var n=t._id;return t.each(function(){var r=Vf(this,n);(r.value||(r.value={}))[e]=i.apply(this,arguments)}),function(r){return _d(r,n).value[e]}}function dSe(t,e){var i;return(typeof e=="number"?hm:e instanceof rD?jZ:(i=rD(e))?(e=i,jZ):TQe)(t,e)}function BQe(t){return function(){this.removeAttribute(t)}}function VQe(t){return function(){this.removeAttributeNS(t.space,t.local)}}function jQe(t,e,i){var n,r=i+"",a;return function(){var o=this.getAttribute(t);return o===r?null:o===n?a:a=e(n=o,i)}}function GQe(t,e,i){var n,r=i+"",a;return function(){var o=this.getAttributeNS(t.space,t.local);return o===r?null:o===n?a:a=e(n=o,i)}}function HQe(t,e,i){var n,r,a;return function(){var o,s=i(this),l;return s==null?void this.removeAttribute(t):(o=this.getAttribute(t),l=s+"",o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s)))}}function zQe(t,e,i){var n,r,a;return function(){var o,s=i(this),l;return s==null?void this.removeAttributeNS(t.space,t.local):(o=this.getAttributeNS(t.space,t.local),l=s+"",o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s)))}}function WQe(t,e){var i=bx(t),n=i==="transform"?CQe:dSe;return this.attrTween(t,typeof e=="function"?(i.local?zQe:HQe)(i,n,V6(this,"attr."+t,e)):e==null?(i.local?VQe:BQe)(i):(i.local?GQe:jQe)(i,n,e))}function qQe(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function KQe(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function YQe(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&KQe(t,a)),i}return r._value=e,r}function ZQe(t,e){var i,n;function r(){var a=e.apply(this,arguments);return a!==n&&(i=(n=a)&&qQe(t,a)),i}return r._value=e,r}function XQe(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=bx(t);return this.tween(i,(n.local?YQe:ZQe)(n,e))}function JQe(t,e){return function(){B6(this,t).delay=+e.apply(this,arguments)}}function QQe(t,e){return e=+e,function(){B6(this,t).delay=e}}function eet(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?JQe:QQe)(e,t)):_d(this.node(),e).delay}function tet(t,e){return function(){Vf(this,t).duration=+e.apply(this,arguments)}}function iet(t,e){return e=+e,function(){Vf(this,t).duration=e}}function net(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?tet:iet)(e,t)):_d(this.node(),e).duration}function ret(t,e){if(typeof e!="function")throw new Error;return function(){Vf(this,t).ease=e}}function aet(t){var e=this._id;return arguments.length?this.each(ret(e,t)):_d(this.node(),e).ease}function oet(t){typeof t!="function"&&(t=G0e(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var a=e[r],o=a.length,s=n[r]=[],l,c=0;c<o;++c)(l=a[c])&&t.call(l,l.__data__,c,a)&&s.push(l);return new ff(n,this._parents,this._name,this._id)}function set(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,a=Math.min(n,r),o=new Array(n),s=0;s<a;++s)for(var l=e[s],c=i[s],u=l.length,d=o[s]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;s<n;++s)o[s]=e[s];return new ff(o,this._parents,this._name,this._id)}function cet(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function uet(t,e,i){var n,r,a=cet(e)?B6:Vf;return function(){var o=a(this,t),s=o.on;s!==n&&(r=(n=s).copy()).on(e,i),o.on=r}}function det(t,e){var i=this._id;return arguments.length<2?_d(this.node(),i).on.on(t):this.each(uet(i,t,e))}function pet(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function het(){return this.on("end.remove",pet(this._id))}function fet(t){var e=this._name,i=this._id;typeof t!="function"&&(t=L6(t));for(var n=this._groups,r=n.length,a=new Array(r),o=0;o<r;++o)for(var s=n[o],l=s.length,c=a[o]=new Array(l),u,d,p=0;p<l;++p)(u=s[p])&&(d=t.call(u,u.__data__,p,s))&&("__data__"in u&&(d.__data__=u.__data__),c[p]=d,Tx(c[p],e,i,p,c,_d(u,i)));return new ff(a,this._parents,e,i)}function met(t){var e=this._name,i=this._id;typeof t!="function"&&(t=j0e(t));for(var n=this._groups,r=n.length,a=[],o=[],s=0;s<r;++s)for(var l=n[s],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var p=t.call(u,u.__data__,d,l),h,f=_d(u,i),m=0,g=p.length;m<g;++m)(h=p[m])&&Tx(h,e,i,m,p,f);a.push(p),o.push(u)}return new ff(a,o,e,i)}var get=IE.prototype.constructor;function vet(){return new get(this._groups,this._parents)}function yet(t,e){var i,n,r;return function(){var a=Gw(this,t),o=(this.style.removeProperty(t),Gw(this,t));return a===o?null:a===i&&o===n?r:r=e(i=a,n=o)}}function pSe(t){return function(){this.style.removeProperty(t)}}function Iet(t,e,i){var n,r=i+"",a;return function(){var o=Gw(this,t);return o===r?null:o===n?a:a=e(n=o,i)}}function bet(t,e,i){var n,r,a;return function(){var o=Gw(this,t),s=i(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(t),Gw(this,t))),o===l?null:o===n&&l===r?a:(r=l,a=e(n=o,s))}}function wet(t,e){var i,n,r,a="style."+e,o="end."+a,s;return function(){var l=Vf(this,t),c=l.on,u=l.value[a]==null?s||(s=pSe(e)):void 0;(c!==i||r!==u)&&(n=(i=c).copy()).on(o,r=u),l.on=n}}function Tet(t,e,i){var n=(t+="")=="transform"?PQe:dSe;return e==null?this.styleTween(t,yet(t,n)).on("end.style."+t,pSe(t)):typeof e=="function"?this.styleTween(t,bet(t,n,V6(this,"style."+t,e))).each(wet(this._id,t)):this.styleTween(t,Iet(t,n,e),i).on("end.style."+t,null)}function Uet(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function Det(t,e,i){var n,r;function a(){var o=e.apply(this,arguments);return o!==r&&(n=(r=o)&&Uet(t,o,i)),n}return a._value=e,a}function Pet(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,Det(t,e,i??""))}function Cet(t){return function(){this.textContent=t}}function Eet(t){return function(){var e=t(this);this.textContent=e??""}}function Met(t){return this.tween("text",typeof t=="function"?Eet(V6(this,"text",t)):Cet(t==null?"":t+""))}function Ret(t){return function(e){this.textContent=t.call(this,e)}}function Net(t){var e,i;function n(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&Ret(r)),e}return n._value=t,n}function Aet(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,Net(t))}function _et(){for(var t=this._name,e=this._id,i=hSe(),n=this._groups,r=n.length,a=0;a<r;++a)for(var o=n[a],s=o.length,l,c=0;c<s;++c)if(l=o[c]){var u=_d(l,e);Tx(l,t,i,c,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ff(n,this._parents,t,i)}function ket(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(a,o){var s={value:o},l={value:function(){--r===0&&a()}};i.each(function(){var c=Vf(this,n),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),c.on=e})})}var Oet=0;function ff(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function hSe(){return++Oet}var XI=IE.prototype;ff.prototype={constructor:ff,select:fet,selectAll:met,filter:oet,merge:set,selection:vet,transition:_et,call:XI.call,nodes:XI.nodes,node:XI.node,size:XI.size,empty:XI.empty,each:XI.each,on:det,attr:WQe,attrTween:XQe,style:Tet,styleTween:Pet,text:Met,textTween:Aet,remove:het,tween:$Qe,delay:eet,duration:net,ease:aet,end:ket};function xet(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var eV={time:null,delay:0,duration:250,ease:xet};function Let(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return eV.time=Sx(),eV;return i}function Fet(t){var e,i;t instanceof ff?(e=t._id,t=t._name):(e=hSe(),(i=eV).time=Sx(),t=t==null?null:t+"");for(var n=this._groups,r=n.length,a=0;a<r;++a)for(var o=n[a],s=o.length,l,c=0;c<s;++c)(l=o[c])&&Tx(l,t,e,c,o,i||Let(l,e));return new ff(n,this._parents,t,e)}IE.prototype.interrupt=xQe;IE.prototype.transition=Fet;var Hc="$";function VN(){}VN.prototype=fSe.prototype={constructor:VN,has:function(t){return Hc+t in this},get:function(t){return this[Hc+t]},set:function(t,e){return this[Hc+t]=e,this},remove:function(t){var e=Hc+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===Hc&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===Hc&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===Hc&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===Hc&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===Hc&&++t;return t},empty:function(){for(var t in this)if(t[0]===Hc)return!1;return!0},each:function(t){for(var e in this)e[0]===Hc&&t(this[e],e.slice(1),this)}};function fSe(t,e){var i=new VN;if(t instanceof VN)t.each(function(s,l){i.set(l,s)});else if(Array.isArray(t)){var n=-1,r=t.length,a;if(e==null)for(;++n<r;)i.set(n,t[n]);else for(;++n<r;)i.set(e(a=t[n],n,t),a)}else if(t)for(var o in t)i.set(o,t[o]);return i}function YZ(){}var Zg=fSe.prototype;YZ.prototype={constructor:YZ,has:Zg.has,add:function(t){return t+="",this[Hc+t]=t,this},remove:Zg.remove,clear:Zg.clear,values:Zg.keys,size:Zg.size,empty:Zg.empty,each:Zg.each};function mS(){return Math.random()}(function t(e){function i(n,r){return n=n==null?0:+n,r=r==null?1:+r,arguments.length===1?(r=n,n=0):r-=n,function(){return e()*r+n}}return i.source=t,i})(mS);const $et=function t(e){function i(n,r){var a,o;return n=n==null?0:+n,r=r==null?1:+r,function(){var s;if(a!=null)s=a,a=null;else do a=e()*2-1,s=e()*2-1,o=a*a+s*s;while(!o||o>1);return n+r*s*Math.sqrt(-2*Math.log(o)/o)}}return i.source=t,i}(mS);(function t(e){function i(){var n=$et.source(e).apply(this,arguments);return function(){return Math.exp(n())}}return i.source=t,i})(mS);const Bet=function t(e){function i(n){return function(){for(var r=0,a=0;a<n;++a)r+=e();return r}}return i.source=t,i}(mS);(function t(e){function i(n){var r=Bet.source(e)(n);return function(){return r()/n}}return i.source=t,i})(mS);(function t(e){function i(n){return function(){return-Math.log(1-e())/n}}return i.source=t,i})(mS);function jN(){this._=null}function Ux(t){t.U=t.C=t.L=t.R=t.P=t.N=null}jN.prototype={constructor:jN,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=ZZ(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(xS(this,i),t=i,i=t.U),i.C=!1,n.C=!0,LS(this,n))):(r=n.L,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(LS(this,i),t=i,i=t.U),i.C=!1,n.C=!0,xS(this,n))),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,i,n=t.L,r=t.R,a,o;if(n?r?a=ZZ(r):a=n:a=r,e?e.L===t?e.L=a:e.R=a:this._=a,n&&r?(o=a.C,a.C=t.C,a.L=n,n.U=a,a!==r?(e=a.U,a.U=t.U,t=a.R,e.L=t,a.R=r,r.U=a):(a.U=e,e=a,t=a.R)):(o=t.C,t=a),t&&(t.U=e),!o){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(i=e.R,i.C&&(i.C=!1,e.C=!0,xS(this,e),i=e.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,LS(this,i),i=e.R),i.C=e.C,e.C=i.R.C=!1,xS(this,e),t=this._;break}}else if(i=e.L,i.C&&(i.C=!1,e.C=!0,LS(this,e),i=e.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,xS(this,i),i=e.L),i.C=e.C,e.C=i.L.C=!1,LS(this,e),t=this._;break}i.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function xS(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function LS(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function ZZ(t){for(;t.L;)t=t.L;return t}function eT(t,e,i,n){var r=[null,null],a=is.push(r)-1;return r.left=t,r.right=e,i&&GN(r,t,e,i),n&&GN(r,e,t,n),mc[t.index].halfedges.push(a),mc[e.index].halfedges.push(a),r}function FS(t,e,i){var n=[e,i];return n.left=t,n}function GN(t,e,i,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=i):t.left===i?t[1]=n:t[0]=n}function Vet(t,e,i,n,r){var a=t[0],o=t[1],s=a[0],l=a[1],c=o[0],u=o[1],d=0,p=1,h=c-s,f=u-l,m;if(m=e-s,!(!h&&m>0)){if(m/=h,h<0){if(m<d)return;m<p&&(p=m)}else if(h>0){if(m>p)return;m>d&&(d=m)}if(m=n-s,!(!h&&m<0)){if(m/=h,h<0){if(m>p)return;m>d&&(d=m)}else if(h>0){if(m<d)return;m<p&&(p=m)}if(m=i-l,!(!f&&m>0)){if(m/=f,f<0){if(m<d)return;m<p&&(p=m)}else if(f>0){if(m>p)return;m>d&&(d=m)}if(m=r-l,!(!f&&m<0)){if(m/=f,f<0){if(m>p)return;m>d&&(d=m)}else if(f>0){if(m<d)return;m<p&&(p=m)}return!(d>0)&&!(p<1)||(d>0&&(t[0]=[s+d*h,l+d*f]),p<1&&(t[1]=[s+p*h,l+p*f])),!0}}}}}function jet(t,e,i,n,r){var a=t[1];if(a)return!0;var o=t[0],s=t.left,l=t.right,c=s[0],u=s[1],d=l[0],p=l[1],h=(c+d)/2,f=(u+p)/2,m,g;if(p===u){if(h<e||h>=n)return;if(c>d){if(!o)o=[h,i];else if(o[1]>=r)return;a=[h,r]}else{if(!o)o=[h,r];else if(o[1]<i)return;a=[h,i]}}else if(m=(c-d)/(p-u),g=f-m*h,m<-1||m>1)if(c>d){if(!o)o=[(i-g)/m,i];else if(o[1]>=r)return;a=[(r-g)/m,r]}else{if(!o)o=[(r-g)/m,r];else if(o[1]<i)return;a=[(i-g)/m,i]}else if(u<p){if(!o)o=[e,m*e+g];else if(o[0]>=n)return;a=[n,m*n+g]}else{if(!o)o=[n,m*n+g];else if(o[0]<e)return;a=[e,m*e+g]}return t[0]=o,t[1]=a,!0}function Get(t,e,i,n){for(var r=is.length,a;r--;)(!jet(a=is[r],t,e,i,n)||!Vet(a,t,e,i,n)||!(Math.abs(a[0][0]-a[1][0])>qr||Math.abs(a[0][1]-a[1][1])>qr))&&delete is[r]}function Het(t){return mc[t.index]={site:t,halfedges:[]}}function zet(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function mSe(t,e){return e[+(e.left!==t.site)]}function Wet(t,e){return e[+(e.left===t.site)]}function qet(){for(var t=0,e=mc.length,i,n,r,a;t<e;++t)if((i=mc[t])&&(a=(n=i.halfedges).length)){var o=new Array(a),s=new Array(a);for(r=0;r<a;++r)o[r]=r,s[r]=zet(i,is[n[r]]);for(o.sort(function(l,c){return s[c]-s[l]}),r=0;r<a;++r)s[r]=n[o[r]];for(r=0;r<a;++r)n[r]=s[r]}}function Ket(t,e,i,n){var r=mc.length,a,o,s,l,c,u,d,p,h,f,m,g,v=!0;for(a=0;a<r;++a)if(o=mc[a]){for(s=o.site,c=o.halfedges,l=c.length;l--;)is[c[l]]||c.splice(l,1);for(l=0,u=c.length;l<u;)f=Wet(o,is[c[l]]),m=f[0],g=f[1],d=mSe(o,is[c[++l%u]]),p=d[0],h=d[1],(Math.abs(m-p)>qr||Math.abs(g-h)>qr)&&(c.splice(l,0,is.push(FS(s,f,Math.abs(m-t)<qr&&n-g>qr?[t,Math.abs(p-t)<qr?h:n]:Math.abs(g-n)<qr&&i-m>qr?[Math.abs(h-n)<qr?p:i,n]:Math.abs(m-i)<qr&&g-e>qr?[i,Math.abs(p-i)<qr?h:e]:Math.abs(g-e)<qr&&m-t>qr?[Math.abs(h-e)<qr?p:t,e]:null))-1),++u);u&&(v=!1)}if(v){var y,I,b,D=1/0;for(a=0,v=null;a<r;++a)(o=mc[a])&&(s=o.site,y=s[0]-t,I=s[1]-e,b=y*y+I*I,b<D&&(D=b,v=o));if(v){var w=[t,e],S=[t,n],U=[i,n],C=[i,e];v.halfedges.push(is.push(FS(s=v.site,w,S))-1,is.push(FS(s,S,U))-1,is.push(FS(s,U,C))-1,is.push(FS(s,C,w))-1)}}for(a=0;a<r;++a)(o=mc[a])&&(o.halfedges.length||delete mc[a])}var gSe=[],j6;function Yet(){Ux(this),this.x=this.y=this.arc=this.site=this.cy=null}function gb(t){var e=t.P,i=t.N;if(!(!e||!i)){var n=e.site,r=t.site,a=i.site;if(n!==a){var o=r[0],s=r[1],l=n[0]-o,c=n[1]-s,u=a[0]-o,d=a[1]-s,p=2*(l*d-c*u);if(!(p>=-ett)){var h=l*l+c*c,f=u*u+d*d,m=(d*h-c*f)/p,g=(l*f-u*h)/p,v=gSe.pop()||new Yet;v.arc=t,v.site=r,v.x=m+o,v.y=(v.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,I=oD._;I;)if(v.y<I.y||v.y===I.y&&v.x<=I.x)if(I.L)I=I.L;else{y=I.P;break}else if(I.R)I=I.R;else{y=I;break}oD.insert(y,v),y||(j6=v)}}}}function Cb(t){var e=t.circle;e&&(e.P||(j6=e.N),oD.remove(e),gSe.push(e),Ux(e),t.circle=null)}var vSe=[];function Zet(){Ux(this),this.edge=this.site=this.circle=null}function XZ(t){var e=vSe.pop()||new Zet;return e.site=t,e}function SF(t){Cb(t),Eb.remove(t),vSe.push(t),Ux(t)}function Xet(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],a=t.P,o=t.N,s=[t];SF(t);for(var l=a;l.circle&&Math.abs(i-l.circle.x)<qr&&Math.abs(n-l.circle.cy)<qr;)a=l.P,s.unshift(l),SF(l),l=a;s.unshift(l),Cb(l);for(var c=o;c.circle&&Math.abs(i-c.circle.x)<qr&&Math.abs(n-c.circle.cy)<qr;)o=c.N,s.push(c),SF(c),c=o;s.push(c),Cb(c);var u=s.length,d;for(d=1;d<u;++d)c=s[d],l=s[d-1],GN(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=eT(l.site,c.site,null,r),gb(l),gb(c)}function Jet(t){for(var e=t[0],i=t[1],n,r,a,o,s=Eb._;s;)if(a=ySe(s,i)-e,a>qr)s=s.L;else if(o=e-Qet(s,i),o>qr){if(!s.R){n=s;break}s=s.R}else{a>-qr?(n=s.P,r=s):o>-qr?(n=s,r=s.N):n=r=s;break}Het(t);var l=XZ(t);if(Eb.insert(n,l),!(!n&&!r)){if(n===r){Cb(n),r=XZ(n.site),Eb.insert(l,r),l.edge=r.edge=eT(n.site,l.site),gb(n),gb(r);return}if(!r){l.edge=eT(n.site,l.site);return}Cb(n),Cb(r);var c=n.site,u=c[0],d=c[1],p=t[0]-u,h=t[1]-d,f=r.site,m=f[0]-u,g=f[1]-d,v=2*(p*g-h*m),y=p*p+h*h,I=m*m+g*g,b=[(g*y-h*I)/v+u,(p*I-m*y)/v+d];GN(r.edge,c,f,b),l.edge=eT(c,t,null,b),r.edge=eT(t,f,null,b),gb(n),gb(r)}}function ySe(t,e){var i=t.site,n=i[0],r=i[1],a=r-e;if(!a)return n;var o=t.P;if(!o)return-1/0;i=o.site;var s=i[0],l=i[1],c=l-e;if(!c)return s;var u=s-n,d=1/a-1/c,p=u/c;return d?(-p+Math.sqrt(p*p-2*d*(u*u/(-2*c)-l+c/2+r-a/2)))/d+n:(n+s)/2}function Qet(t,e){var i=t.N;if(i)return ySe(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var qr=1e-6,ett=1e-12,Eb,mc,oD,is;function ttt(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function itt(t,e){return e[1]-t[1]||e[0]-t[0]}function JZ(t,e){var i=t.sort(itt).pop(),n,r,a;for(is=[],mc=new Array(t.length),Eb=new jN,oD=new jN;;)if(a=j6,i&&(!a||i[1]<a.y||i[1]===a.y&&i[0]<a.x))(i[0]!==n||i[1]!==r)&&(Jet(i),n=i[0],r=i[1]),i=t.pop();else if(a)Xet(a.arc);else break;if(qet(),e){var o=+e[0][0],s=+e[0][1],l=+e[1][0],c=+e[1][1];Get(o,s,l,c),Ket(o,s,l,c)}this.edges=is,this.cells=mc,Eb=oD=is=mc=null}JZ.prototype={constructor:JZ,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(n){return mSe(e,t[n])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(s=(a=i.halfedges).length)for(var r=i.site,a,o=-1,s,l,c=e[a[s-1]],u=c.left===r?c.right:c.left;++o<s;)l=u,c=e[a[o]],u=c.left===r?c.right:c.left,l&&u&&n<l.index&&n<u.index&&ttt(r,l,u)<0&&t.push([r.data,l.data,u.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n=this,r,a=n._found||0,o=n.cells.length,s;!(s=n.cells[a]);)if(++a>=o)return null;var l=t-s.site[0],c=e-s.site[1],u=l*l+c*c;do s=n.cells[r=a],a=null,s.halfedges.forEach(function(d){var p=n.edges[d],h=p.left;if(!((h===s.site||!h)&&!(h=p.right))){var f=t-h[0],m=e-h[1],g=f*f+m*m;g<u&&(u=g,a=h.index)}});while(a!==null);return n._found=r,i==null||u<=i*i?s.site:null}};function tT(t,e,i){this.k=t,this.x=e,this.y=i}tT.prototype={constructor:tT,scale:function(t){return t===1?this:new tT(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new tT(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};tT.prototype;const ntt=function(){let t={};t.jsonTODS=i=>{let n={bestOf:e(i.max_sets)};if(i.max_sets&&parseInt(i.max_sets)===1&&i.final_set_supertiebreak)n.setFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}};else{const r=e(i.games_for_set),a=e(i.tiereaks_at),o=a>r?r:a;n.setFormat={setTo:r,tiebreakAt:o,tiebreakFormat:{tiebreakTo:e(i.tiebreak_to)}},i.final_set_supertiebreak&&(n.finalSetFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}})}return n};function e(i){return!isNaN(Number(i))&&Number(i)}return t}(),ISe=function(){let t={};function e(o,s){let l=parseInt(o);return isNaN(l)?s:l}function i({source:o={},objects:s=[]}){let l=Object.assign({},o);return s&&!Array.isArray(s)&&(s=[s]),s=s.filter(c=>c),s.forEach(c=>{if(typeof c!="object")return;Object.keys(c).forEach(d=>l[d]=l[d]!==void 0?l[d]:c[d])}),l}t.setsToWin=o=>o&&Math.ceil(o/2)||1,t.tiebreakTo=(o,s)=>{var u,d,p,h;let l=(d=(u=o==null?void 0:o.setFormat)==null?void 0:u.tiebreakFormat)==null?void 0:d.tiebreakTo,c=(h=(p=o==null?void 0:o.finalSetFormat)==null?void 0:p.tiebreakFormat)==null?void 0:h.tiebreakTo;return s?c:l},t.matchFormat=n;function n(o){return(o||"SET3-S:6/TB7").slice(3)}t.getExistingScores=({match:o})=>{if(o!=null&&o.score)return r({string_score:o.score,winner_index:o.winner_index,matchFormat:o.matchFormat})},t.generateMatchFormat=({cfg_obj:o})=>{let s=o.bestof.ddlb.getValue(),l=e(s),c=ISe.setsToWin(l),u={max_sets:l,sets_to_win:c,games_for_set:e(o.setsto.ddlb.getValue()),tiebreaks_at:e(o.tiebreaksat.ddlb.getValue())||"",tiebreak_to:e(o.tiebreaksto.ddlb.getValue()),supertiebreak_to:e(o.supertiebreakto.ddlb.getValue()),final_set_supertiebreak:o.finalset.ddlb.getValue()!=="N"};return{matchFormat:wp.stringify(ntt.jsonTODS(u)),score_format:u}},t.getScoringFormat=({e:o,match:s})=>{var u,d;let l=(s==null?void 0:s.format)||((o==null?void 0:o.format)==="D"?"doubles":"singles"),c=[s==null?void 0:s.score_format,(u=s==null?void 0:s.match)==null?void 0:u.score_format,(d=o.scoring_format)==null?void 0:d[l],o.score_format];return i({objects:c})},t.defaultMatchFormat=({format:o,category:s,env:l})=>{let c=l.scoreboard.matchFormats,u={S:"singles",D:"doubles"};return Object.keys(u).indexOf(o)>=0&&(o=u[o]),o&&s&&c.categories[s]&&c.categories[s][o]?c.categories[s][o]:o&&c[o]?c[o]:c.singles},t.convertStringScore=r;function r({string_score:o,winner_index:s,split:l=" ",matchFormat:c}){if(!o)return[];o=s?a(o):o;let u=null,d=/(\d+)/,p=/(\d+)\((\d+)\)/,h=wp.parse(c),f=o.split(l).filter(m=>m).map(m=>{if(m.indexOf("/")>0){let y=m.split("/").map(I=>d.exec(I)?{games:+d.exec(I)[1]}:void 0).filter(I=>I);if(y.length===2)return y}let g=null,v=m.split("-").map(y=>{let I;return p.test(y)?(g=+p.exec(y)[2],I={games:+p.exec(y)[1]}):d.test(y)?I={games:+d.exec(y)[1]}:u=y,I||void 0});if(v=v.filter(y=>y),g!==null){let y=Math.min(...v.map(I=>I.games));v.forEach(I=>{+I.games==+y?I.tiebreak=g:I.spacer=g})}return v});if(f=f.filter(m=>m&&m.length===2),f.forEach(m=>{var y;let g=h&&(h.finalSetFormat||h.setFormat),v=(y=g==null?void 0:g.tiebreakSet)==null?void 0:y.tiebreakTo;(m[0].games>=v||m[1].games>=v)&&(m[0].supertiebreak=m[0].games,m[1].supertiebreak=m[1].games,delete m[0].games,delete m[1].games)}),s!==void 0&&(f.winner_index=s),u){if(u==="Cancelled"&&(f.cancelled=!0),u==="Abandoned"&&(f.abandoned=!0),u==="INC."&&(f.incomplete=!0),u==="INT."&&(f.interrupted=!0),u==="LIVE"&&(f.live=!0),u==="TIME"&&(f.time=!0),u==="DEF."&&(f.default=!0),u==="W.O."&&(f.walkover=!0),!f.length)return f;s!==void 0&&(f[f.length-1][1-s].outcome=u,f[f.length-1].outcome=u,f.outome=u)}return f}t.reverseScore=a;function a(o,s=" "){let l=null;if(o){let d=o.split(s).map(c).join(s);return l?`${l} ${d}`:d}function c(d){let p=d.indexOf("/")>0?"/":"-",h=d.split(p).map(u).reverse().filter(y=>y),f=h.map(y=>y.games),m=h.map(y=>y.tiebreak).filter(y=>y),g=m.length===1?`(${m[0]})`:"";return`${m.length<2?f.join(p):f.map((y,I)=>`${y}(${m[I]})`).join(p)}${g}`}function u(d){let p=/(\d+)/,h=/(\d+)\((\d+)\)/;if(h.test(d))return{games:h.exec(d)[1],tiebreak:h.exec(d)[2]};if(p.test(d))return{games:p.exec(d)[1]};l=d}}return t}(),ka=function(){let t={};function e(l,c){let u=1;if(Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};for(;l.parentNode;){if(l=l.parentNode,l.classList&&Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};u+=1}return{elem:null,depth:0}}const i="span:first-of-type";t.DropDown=n;function n({element:l,onChange:c,css_class:u,id:d,locked:p,max:h,maxFx:f,value_attribute:m=!0,background:g}){var v,y,I,b,D;!l&&d&&(l=document.getElementById(d)),this.id=d,this.val="",this.max=h,this.maxFx=f,this.el=l,this.locked=p,this.background=g||"",this.bordercolor="",this.labelcolor="#000",this.class=u,this.value_attribute=m,this.list=(v=this.el)==null?void 0:v.querySelector(".dd_state"),this.options=(y=this.el)==null?void 0:y.querySelector(".options"),this.label=(I=this.el)==null?void 0:I.querySelector("div:first-of-type"),this.opts=((b=this.list)==null?void 0:b.querySelectorAll("li"))||[],this.selection=((D=this.list)==null?void 0:D.querySelector(i))||void 0,typeof c=="function"&&(this.onChange=c),this.initEvents()}function r(l){l.el&&(l.el.ddclick||(l.el.ddclick=!0,l.el.addEventListener("click",c=>{if(l.locked)return;let{elem:u,depth:d}=e(c.target,"dd_state"),{elem:p,depth:h}=e(c.target,"dd_option"),f=u&&Array.from(u.classList).indexOf("active")>=0;if(l.max&&!p&&l.opts&&l.opts.length>l.max&&l.maxFx&&typeof l.maxFx=="function"){l.maxFx(l.options);return}t.closeAllDropDowns(l.class),u&&(!h||d<h)&&u.classList[f?"remove":"add"]("active"),c.stopPropagation()})))}function a(l){Array.from(l.opts).forEach(c=>{c.addEventListener("click",()=>{l.list.classList.remove("active");let u=c.querySelector(i),d=u.getAttribute("value");l.selection.innerHTML=u.innerHTML;let p=l.val!=d;l.val=d,p&&l.onChange&&(l.onChange(d),l.selectionBackground(),l.labelColor())})})}function o(l,c){return`<li class='dd_option' title='${l.title||""}'><span value="${l.value}" style="${c||""}">${l.key}</span></li>`}n.prototype={initEvents(){let l=this;r(l),a(l)},getLabel(){return this.selection.innerHTML},getValue(){return this.val},setId(l){this.id=l},getId(){return this.id},lock(){this.locked=!0},unlock(){this.locked=!1},setOptions(l,c=""){if(!Array.isArray(l)||!l.length||!this.list)return;let u=this.list.querySelector("ul");if(u)return this.max&&l&&l.length>this.max&&t.closeAllDropDowns(this.class),u.innerHTML=l.map(d=>o(d,c)).join(""),this.options=l,this.opts=this.list.querySelectorAll("li"),a(this),this},getOptions(){return Array.from(this.opts).map(l=>{let c=l.querySelector(i);return{key:c.innerHTML,value:c.getAttribute("value")}})},setLabel(l,c,u,d){this.selection&&(this.selection.innerHTML=l,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},setValue(l,c,u,d){let p=Array.from(this.opts).filter(f=>f.querySelector(i).getAttribute("value")==l),h=p.length?p[0].querySelector("span").innerHTML:l;this.val=l,this.selection&&(this.selection.innerHTML=h,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},selectionBackground(l){this.selection&&(l&&(this.background=l),this.background?(this.selection.classList.remove("novalue"),this.selection.classList.remove("hasvalue"),this.selection.style.background=this.background):this.locked?(this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):this.val?(this.selection.style.background="",this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):(this.selection.style.background="",this.selection.classList.add("novalue"),this.selection.classList.remove("hasvalue")))},labelColor(l){l&&(this.labelcolor=l),this.label.style.color=this.labelcolor},borderColor(l){l&&(this.bordercolor=l),this.bordercolor&&this.options&&this.options.style&&(this.options.style.border=`1px solid ${this.bordercolor}`)}};let s=(l,c=[],u,d=!0,p,h)=>{let f=u!==void 0&&c[u]?c[u].key:"",m=d?"style='border: 1px solid #000;'":"",g=c.map(v=>o(v,p)).join("");return`
         <div class='dd-label'>${l}</div>
         <div class='options' ${m}>
            <ul>
               <li class='dd_state'>
                  <span class='active'>${f}</span>
                  <div>
                     <ul class='${h?"floatleft":""}'>
                     ${g}
                     </ul>
                  </div>
               </li>
            </ul>
         </div>`};return t.attachDropDown=({element:l,id:c,label:u="",options:d,selected:p=0,css_class:h,border:f,style:m,floatleft:g,display:v="flex"})=>{!c&&!l||(l=l||document.getElementById(c),l&&(l.style.display=v,l.classList.add(h||"dd"),l.innerHTML=s(u,d,p,f,m,g)))},t.closeAllDropDowns=()=>{let l=document.querySelectorAll("li.dd_state.active");Array.from(l).forEach(c=>{c.classList.remove("active")})},document.addEventListener("click",()=>t.closeAllDropDowns()),t}(),QZ=(t,e)=>{let i=parseInt(t);return isNaN(i)?e:i},eX=1500;function tX({elem:t,type:e,duration:i=800,height:n=80,visible:r}){let a=eSe(t);o();function o(){let s=a.select("."+e),l=s.style("display"),c=l==="none"?"flex":"none";r===!0&&l==="none"||r===void 0&&c==="flex"?(s.style("height","0px"),s.style("display",c).transition().duration(i).style("height",`${n}px`)):(r===!1&&l==="flex"||r===void 0&&c==="none")&&s.transition().duration(i).style("height","0px").transition().duration(0).style("display","none")}}const rtt=function(){let t={numericFx:void 0,enterFx:void 0};document.addEventListener("keyup",a=>{if(a.key&&a.key==="Enter"&&t.enterFx&&typeof t.enterFx=="function"&&t.enterFx(),a.key&&t.numericFx&&typeof t.numericFx=="function"){let o=["0","1","2","3","4","5","6","7","8","9"].indexOf(a.key),s=[")","!","@","#","$","%","^","&","*",")"].indexOf(a.key);o>=0?t.numericFx(o):s>=0&&t.numericFx(s,1)}});let e={};ON.register("setClick","tap",i);function i(a){let o=Ty(a,"set_number");if(!o)return;let s=o.getAttribute("setnum"),l=Ty(a,"muid").getAttribute("muid");e[l]&&typeof e[l]=="function"&&e[l](s)}let n={auto_score:!0},r={bestof:[1,3,5],setsto:[4,6,8],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]};return t.options=a=>{if(!a)return r;F0e(a,r)},t.setMatchScore=({muid:a,lock:o,match:s,teams:l,grouped:c,callback:u,round_name:d,matchFormat:p,existing_scores:h,auto_score:f=!0})=>{var Ge,me,Me,De,Ae,ze;n.auto_score=f;let m={...n},g=wp.parse(p||"SET3-S:6/TB7");if(!g)return;let v=(Ge=g==null?void 0:g.setFormat)==null?void 0:Ge.tiebreakAt,y=(me=g==null?void 0:g.setFormat)==null?void 0:me.setTo,I=g.bestOf,b=ISe.setsToWin(I),D=g.finalSetFormat||g.setFormat,w=(Me=D==null?void 0:D.tiebreakSet)==null?void 0:Me.tiebreakTo,S=(Ae=(De=g==null?void 0:g.setFormat)==null?void 0:De.tiebreakFormat)==null?void 0:Ae.tiebreakTo,U=(ze=g==null?void 0:g.finalSetFormat)==null?void 0:ze.tiebreakSet,C,E,P,M,N,R=LXe.display({muid:a,teams:l});R.details.element.style.display="none",d&&(R.round_name.element.innerHTML=d),R.details.element.innerHTML=att(s),R.scoring.element.style.display=o?"none":"inline",R.favorite.element.style.display=o?"inline":"none",a&&(e[a]=de=>{o||(M.length-de>1&&(M=M.slice(0,M.length-1),de=M.length-1,he()),we({selected_set:de}),A(!0),x(),R.scoring.element.style.display="inline",R.edit_scoring.element.style.display="inline")});let A=de=>{let pe=de&&!o;N=pe,tX({elem:R.actions.element,type:"edit",height:50,visible:pe}),R.scoring.element.style.display=N||o?"none":"inline",R.edit_scoring.element.style.display=N?"none":"inline"};qe({sobj:R,changeFx:$}),H(),j(),K(),O();function _(){return[]}function O(){if(M=h?_():[],N=!1,P=!1,t.enterFx=()=>{N&&G()},x(),z(),C=Ce(!c)!==void 0?M.length:Math.max(0,M.length-1),h&&(Object.keys(h).length||h.length||h.walkover||h.default)){let pe=M.length?M[M.length-1]:void 0;if(M.interrupted)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("interrupted"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),pe&&ie(pe[0].games,pe[1].games)&&(C+=1);else if(M.abandoned)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("abandoned"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0);else if(M.cancelled)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("cancelled"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0);else if(M.incomplete)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("incomplete"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),pe&&ie(pe[0].games,pe[1].games)&&(C+=1);else if(M.live)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("live"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),pe&&ie(pe[0].games,pe[1].games)&&(C+=1),m.auto_score=!1;else if(M.retired){let ke=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(ke===0?"retired":"winner"),R.p2action.ddlb.setValue(ke===1?"retired":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!1),F(1-ke)}else if(M.time){let ke=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(ke===0?"time":"winner"),R.p2action.ddlb.setValue(ke===1?"time":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!1),F(1-ke)}else if(M.default){let ke=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(ke===0?"defaulted":"winner"),R.p2action.ddlb.setValue(ke===1?"defaulted":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!1),F(1-ke)}else if(M.walkover){let ke=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(ke===0?"walkover":"winner"),R.p2action.ddlb.setValue(ke===1?"walkover":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),F(1-ke)}else A(!1)}else R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" ");(M.time||M.retired||M.default||M.walkover)&&(C=void 0),we({selected_set:C,actions:!c})}function x(){Array.from(R.root.element.querySelectorAll(".victor")).forEach(pe=>pe.classList.remove("victor")),o||he()}function F(de){Array.from(R.root.element.querySelectorAll(`.opponent${de}`)).forEach(Ue=>Ue.classList.add("victor")),Array.from(R.root.element.querySelectorAll(`.opponent${de} .hasvalue`)).forEach(Ue=>Ue.classList.add("victor"))}function $(){x(),C=0,M=[],Be(),ye(),z(),t.enterFx=void 0,R.p2action.ddlb.setValue(" "),R.p1action.ddlb.setValue(" "),m.auto_score=n.auto_score,we({selected_set:C})}function V(de){let pe={bestOf:I,setFormat:{setTo:y,tiebreakAt:v,tiebreakFormat:{tiebreakTo:S}}};U&&(pe.finalSetFormat={tiebreakSet:{tiebreakTo:w}});const ke=wp.stringify(pe);if(de){const Ue=M.map((Te,rt)=>hi.definedAttributes({side1TiebreakScore:Te[0].supertiebreak,side2TiebreakScore:Te[1].supertiebreak,side1score:Te[0].games,side2score:Te[1].games,setNumber:rt+1}));de.sets=Ue,de.set_scores=M,de.matchUpFormat=ke}de&&typeof u=="function"&&u(de),t.numericFx=void 0,t.enterFx=void 0,document.body.style.overflow=null,eSe(R.scoreboard.element).remove()}function G(){t.numericFx=void 0,t.enterFx=void 0,Ce(),V(Oe())}function j(){R.cancel.element.addEventListener("click",()=>V(),!1),R.accept.element.addEventListener("click",G,!1),R.clear.element.addEventListener("click",$,!1),R.scoring.element.addEventListener("click",de,!1);function de(){let ke=R.scoring.element.innerHTML==="-";ke||(R.edit_scoring.element.style.overflow="hidden"),R.scoring.element.innerHTML=ke?"&#x25A2;":"-",pe(R.edit_scoring.element,ke)}function pe(ke,Ue){let Te=800;tX({elem:ke,type:"edit",height:100,visible:Ue,duration:Te}),Ue&&setTimeout(function(){ke.style.overflow="visible"},Te)}}function z(){let de=[{key:"-",value:""}],pe=y===v?y+2:y+1;hi.generateRange(0,pe).forEach(je=>de.push({key:je,value:je}));let ke=je=>J(0,je),Ue=je=>J(1,je);ka.attachDropDown({id:R.p1selector.id,options:de,border:!1}),ka.attachDropDown({id:R.p2selector.id,options:de,border:!1}),R.p1selector.ddlb=new ka.DropDown({element:R.p1selector.element,onChange:ke,id:R.p1selector.id,value_attribute:!1}),R.p2selector.ddlb=new ka.DropDown({element:R.p2selector.element,onChange:Ue,id:R.p2selector.id,value_attribute:!1}),o&&(R.p1selector.ddlb.lock(),R.p2selector.ddlb.lock()),R.p1selector.ddlb.selectionBackground(),R.p2selector.ddlb.selectionBackground();let Te;t.numericFx=(je,Le=0)=>{Te=new Date().getTime(),R.p1tiebreak.element.style.display==="none"&&je<pe?(Le?R.p1selector.ddlb.setValue(je):R.p2selector.ddlb.setValue(je),J(1-Le,je)):setTimeout(function(){rt()},eX)};function rt(){if(new Date().getTime()-Te>eX){let Le=+R.p1tiebreak.element.value,It=+R.p2tiebreak.element.value;(Le!=""||It!="")&&(E?Z(Le,It,!0):Y(Le,It,!0))}}}function H(){let de=[{key:" ",value:""},{key:"-",value:" "},{key:"RET.",value:"retired"},{key:"TIME",value:"time"},{key:"W.O.",value:"walkover"},{key:"DEF.",value:"defaulted"},{key:"INT.",value:"interrupted"},{key:"INC.",value:"incomplete"},{key:"CCL",value:"cancelled"},{key:"ABD",value:"abandoned"},{key:"LIVE",value:"live"},{key:`<div class='link'><img src='${xXe}' class='completed_icon'></div>`,value:"winner"}],pe=Ue=>Ee(0,Ue),ke=Ue=>Ee(1,Ue);ka.attachDropDown({id:R.p1action.id,options:de,border:!1,floatleft:!0}),ka.attachDropDown({id:R.p2action.id,options:de,border:!1,floatleft:!0}),R.p1action.ddlb=new ka.DropDown({element:R.p1action.element,onChange:pe,id:R.p1action.id}),R.p2action.ddlb=new ka.DropDown({element:R.p2action.element,onChange:ke,id:R.p2action.id}),o&&(R.p1action.ddlb.lock(),R.p2action.ddlb.lock()),R.p1action.ddlb.selectionBackground(),R.p2action.ddlb.selectionBackground()}function K(){let de=ke=>q(ke,0),pe=ke=>q(ke,1);R.p1tiebreak.element.addEventListener("keyup",de,!1),R.p2tiebreak.element.addEventListener("keyup",pe,!1)}function q(de,pe,ke){let Ue=+R.p1tiebreak.element.value,Te=+R.p2tiebreak.element.value;(de.which===13||ke)&&(Ue!=""||Te!="")&&(E?Z(Ue,Te,!0):Y(Ue,Te,!0));let rt=R[pe?"p2tiebreak":"p1tiebreak"].element.value.match(/-?\d+\.?\d*/),je=rt&&!isNaN(rt[0])?parseInt(rt[0].toString().slice(-2)):void 0,Le=E?w:S,It=je===void 0||je==""||je+2<Le?Le:je+2;R[pe?"p2tiebreak":"p1tiebreak"].element.value=je!==void 0?je:"",m.auto_score&&!ce()&&(R[pe?"p1tiebreak":"p2tiebreak"].element.value=It)}function Y(de,pe,ke){let Ue=M.length,Te=Ue>C?Ue-1:C-1;M!=null&&M[Te]&&(M[Te][0][de<pe?"tiebreak":"spacer"]=de<pe?de:pe,M[Te][1][pe<de?"tiebreak":"spacer"]=pe<de?pe:de,ke&&Q())}function Z(de,pe,ke){if(de<w&&pe<w)return;let Ue=[{supertiebreak:de},{supertiebreak:pe}],Te=M.length;Te&&M[Te-1][0].supertiebreak!==void 0?M[Te-1]=Ue:M.push(Ue),ke&&Q()}function Q(){Be(),Ce()!==void 0&&A(!0),we({selected_set:C})}function ie(de,pe){let ke=Math.abs(de-pe);return!v&&(+de===y||+pe===y)?!0:ke>=2&&(+de>=y||+pe>=y)}function ue(de,pe){return v?+de===v+1&&+pe===v||+de===v&&+pe===v+1:!1}function J(de,pe){if(pe===""){R.p1selector.ddlb.setValue(""),R.p2selector.ddlb.setValue(""),M[C]=[{games:0},{games:0}];return}fe()&&he();let ke=!1;Be(),se()&&(C=M.length-1,R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" "),ye());let Ue=R.p1selector.ddlb.getValue(),Te=R.p2selector.ddlb.getValue();m.auto_score?de===0&&Te===""?(Te=je(pe),R.p2selector.ddlb.setValue(Te)):de===1&&Ue===""?(Ue=je(pe),R.p1selector.ddlb.setValue(Ue)):v?(+Ue===v+1&&+Te===v+1&&rt(v),+Ue===v+1&&+Te<v-1&&rt(v),+Te===v+1&&+Ue<v-1&&rt(v)):+Ue===y&&+Te===y&&rt(y-1):de===0&&!Te?(Te=0,R.p2selector.ddlb.setValue(Te)):de===1&&!Ue&&(Ue=0,R.p1selector.ddlb.setValue(Ue)),M[C]=[{games:QZ(Ue)||0},{games:QZ(Te)||0}],!ie(Ue,Te)&&!ue(Ue,Te)?(M=M.slice(0,C+1),we({selected_set:C})):(ue(Ue,Te)&&(ke=!0),Ce(),te(Ue,Te,ke));function rt(Le){de?(Ue=Le,R.p1selector.ddlb.setValue(Ue)):(Te=Le,R.p2selector.ddlb.setValue(Te))}function je(Le){return Le===""?"":v?((+Le===v||+Le===v+1)&&(ke=!0),+Le===v-1||+Le===v?parseInt(v||0)+1:+Le<v?y:v):+Le===y?y-1:(+Le===y-1,y)}}function te(de,pe,ke){ke&&!o&&(R.p1tiebreak.element.style.display="inline",R.p2tiebreak.element.style.display="inline",R[de>pe?"p1tiebreak":"p2tiebreak"].element.disabled=!0,R[de>pe?"p2tiebreak":"p1tiebreak"].element.disabled=!1,R[de>pe?"p2tiebreak":"p1tiebreak"].element.focus(),A(!1));let Ue=de!==""&&pe!=="",Te=Ce()===void 0&&ce()===void 0;Ue&&Te&&C+1<I&&(C+=1),we({selected_set:C,tiebreak:ke})}function se(){let de=R.p1action.ddlb.getValue(),pe=R.p2action.ddlb.getValue();return de==="winner"||pe==="winner"}function ee(){let de=R.p1action.ddlb.getValue(),pe=R.p2action.ddlb.getValue();if(["cancelled","incomplete","abandoned"].indexOf(de)>=0||["cancelled","incomplete","abandoned"].indexOf(pe)>=0)return!1}function ce(){let de=R.p1action.ddlb.getValue(),pe=R.p2action.ddlb.getValue();if(["time","retired","defaulted","walkover"].indexOf(de)>=0)return 0;if(["time","retired","defaulted","walkover"].indexOf(pe)>=0)return 1}function fe(){let de=R.p1action.ddlb.getValue(),pe=R.p2action.ddlb.getValue();return["interrupted"].indexOf(de)>=0||["interrupted"].indexOf(pe)>=0}function ge(){let de=R.p1action.ddlb.getValue(),pe=R.p2action.ddlb.getValue();return["live"].indexOf(de)>=0||["live"].indexOf(pe)>=0}function he(){ge()||(R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" ")),R.p1action.ddlb.unlock(),R.p2action.ddlb.unlock()}function Se(){return M.length?M.map(pe=>{let ke=isNaN(pe[0].games)?pe[0].games:+pe[0].games,Ue=isNaN(pe[1].games)?pe[1].games:+pe[1].games;if(ke!==void 0&&Ue!==void 0&&ke!==""&&Ue!==""){if(ue(ke,Ue)&&pe[0].tiebreak===void 0&&pe[1].tiebreak===void 0)return[0,0];const Te=+ke===y&&+ke==+Ue+1,rt=+Ue===y&&+Ue==+ke+1;if(v)if(!v||y===v){if(Te)return[0,0];if(+Ue===y&&+Ue==+ke+1)return[0,0]}else{if(Te)return[1,0];if(rt)return[0,1]}else{if(+ke===y&&+ke==+Ue+1)return[1,0];if(+Ue===y&&+Ue==+ke+1)return[0,1]}if(ke>Ue&&ke>=y)return[1,0];if(Ue>ke&&Ue>=y)return[0,1]}else if(pe[0].supertiebreak!==void 0&&pe[1].supertiebreak!==void 0){if(pe[0].supertiebreak>pe[1].supertiebreak+1&&pe[0].supertiebreak>=w)return[1,0];if(pe[1].supertiebreak>pe[0].supertiebreak+1&&pe[1].supertiebreak>=w)return[0,1]}return[0,0]}).reduce((pe,ke)=>[pe[0]+ke[0],pe[1]+ke[1]]):[0,0]}function Ce(de=!0){if(!M.length)return;let pe=Se();if(+pe[0]==+pe[1]&&!ge()&&!fe()&&!ee()&&ce()===void 0)return;let ke=Math.max(...pe),Ue=Math.max(b,Math.floor(M.length/2)+1);if(ke<Ue)return;const Te=pe[0]>=Ue&&1||(pe[1]>=Ue?2:void 0);if(Te===void 0&&!ge()&&!fe()&&!ee()&&ce()===void 0){A(!1);return}return R.p1tiebreak.element.style.display!=="inline"&&de&&A(!0),R[Te===1?"p1action":"p2action"].ddlb.setValue("winner"),R[Te===2?"p1action":"p2action"].ddlb.setValue(""),R[Te===2?"p1action":"p2action"].ddlb.lock(),F(Te-1),C=M.length,Te-1}function Fe(de){let pe=M.length;return+de===M.length-1&&pe&&M[pe-1][0].supertiebreak!==void 0?M[pe-1]:!1}function Je(de,pe){return U?Ce(pe)!==void 0&&Fe(de)?!0:xe(de):!1}function xe(de){let pe=Se();if(+pe[0]==+pe[1]&&+pe[0]+1===b&&+de==+M.length)return!0}function st(de,pe,ke){return pe||P||de===void 0?!1:M.length===0?!0:!((Ce(ke)!==void 0||ce()!==void 0)&&(de===void 0||+de===M.length))}function we({selected_set:de,tiebreak:pe,actions:ke}){E=Je(de,ke);let Ue=st(de,pe||E,ke);if(!Ue&&!E&&(de=M.length),C=Math.min(I-1,+de),Ue&&Be(),E&&!o){let zt=xe(de);R.p1tiebreak.element.style.display="inline",R.p2tiebreak.element.style.display="inline",R.p1tiebreak.element.disabled=!1,R.p2tiebreak.element.disabled=!1,zt||(R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" "),A(!1));let Jt=Fe(de);Jt&&(R.p1tiebreak.element.value=Jt[0].supertiebreak,R.p2tiebreak.element.value=Jt[1].supertiebreak)}let Te=M[de],rt=o?M:M.slice(0,+de),je=M.slice(+de+1);o&&!M.length&&(rt=[[{games:0},{games:0}]]);let Le=rt.map((zt,Jt)=>b1({setnum:Jt,score:zt[0]})).join(""),It=rt.map((zt,Jt)=>b1({setnum:Jt,score:zt[1]})).join("");R.p1scores.element.innerHTML=Le,R.p2scores.element.innerHTML=It,R.p1selector.ddlb.setValue(Te?Te[0].games+"":""),R.p2selector.ddlb.setValue(Te?Te[1].games+"":""),R.p1selector.element.style.display=Ue&&!P&&!o?"flex":"none",R.p2selector.element.style.display=Ue&&!P&&!o?"flex":"none",Le=je.map((zt,Jt)=>b1({setnum:+de+1+Jt,score:zt[0]})).join(""),It=je.map((zt,Jt)=>b1({setnum:+de+1+Jt,score:zt[1]})).join(""),R.p1scores_e.element.innerHTML=Le,R.p2scores_e.element.innerHTML=It}function Oe(){const de=R.p1action.ddlb.getValue(),pe=R.p2action.ddlb.getValue(),ke=de==="winner"&&1||pe==="winner"&&2||void 0;let Ue=[1,2].includes(ke),Te=M.map(je=>{if(je[0].supertiebreak)return`[${je[0].supertiebreak}-${je[1].supertiebreak}]`;let Le=je[0].tiebreak,It=je[1].tiebreak,zt=Le!==void 0||It!==void 0?`(${[Le,It].filter(Jt=>Jt>=0).join("-")})`:"";return`${je[0].games}-${je[1].games}${zt}`}).join(" "),rt;return[1,2].includes(ke)&&(rt="COMPLETED"),(de==="retired"||pe==="retired")&&(rt="RETIRED"),(de==="time"||pe==="time")&&(Te+=" TIME"),(de==="walkover"||pe==="walkover")&&(rt="WALKOVER",Ue=!0),(de==="defaulted"||pe==="defaulted")&&(rt="DEFAULTED",Ue=!0),(de==="abandoned"||pe==="abandoned")&&(rt="ABANDONED",Ue=!0,Te=""),(de==="interrupted"||pe==="interrupted")&&(rt="SUSPENDED",Ue=!1),(de==="live"||pe==="live")&&(rt="IN_PROGRESS",Ue=!1),(de==="cancelled"||pe==="cancelled")&&(rt="CANCELLED",Ue=!1),(de==="incomplete"||pe==="incomplete")&&(rt="ABANDONED",Ue=!1),{matchUpStatus:rt,winningSide:ke,complete:Ue,score:Te}}function ye(){P=!1,R.p1selector.ddlb.unlock(),R.p2selector.ddlb.unlock(),R.p1action.ddlb.unlock(),R.p2action.ddlb.unlock()}function Be(){R.p1tiebreak.element.value="",R.p2tiebreak.element.value="",R.p1tiebreak.element.style.display="none",R.p2tiebreak.element.style.display="none"}function Ee(de,pe){let ke=R.p1action.ddlb.getValue(),Ue=R.p2action.ddlb.getValue(),Te=Ce(),rt=de?ke:Ue;if(m.auto_score=n.auto_score,pe===""){Te!==void 0&&(M=[],C=0,R[de?"p2action":"p1action"].ddlb.setValue(" ")),R[de?"p1action":"p2action"].ddlb.setValue(" "),ye();let je=M.length;if(je){let Le=M[je-1];!ue(Le[0].games,Le[1].games)&&!ie(Le[0].games,Le[1].games)&&(C=je-1)}we({selected_set:C})}else["interrupted","cancelled","incomplete","abandoned"].indexOf(pe)>=0?(R[de?"p1action":"p2action"].ddlb.setValue(" "),we({selected_set:C}),A(!0)):pe==="live"?(m.auto_score=!1,R[de?"p1action":"p2action"].ddlb.setValue(" "),we({selected_set:C}),A(!0)):pe==="winner"&&rt==="winner"?(Te===void 0&&R[de?"p1action":"p2action"].ddlb.setValue("retired"),we({selected_set:C}),A(!0)):["time","retired","walkover","defaulted"].indexOf(pe)>=0?(A(!0),Te!==void 0?(R[Te?"p2action":"p1action"].ddlb.setValue("winner"),R[Te?"p1action":"p2action"].ddlb.setValue(" "),R[Te?"p2action":"p1action"].ddlb.unlock(),R[Te?"p1action":"p2action"].ddlb.lock()):(R.p1tiebreak.element.disabled=!1,R.p2tiebreak.element.disabled=!1,R[de?"p1action":"p2action"].ddlb.setValue("winner"),R[de?"p1action":"p2action"].ddlb.unlock(),R[de?"p2action":"p1action"].ddlb.lock(),(pe==="time"||pe==="retired"||pe==="defaulted")&&(Te!==void 0&&R[de?"p2action":"p1action"].ddlb.setValue(" "),C=M.length),(pe==="time"||pe==="retired")&&!M.length&&R[de?"p2action":"p1action"].ddlb.setValue("walkover"),pe==="walkover"&&(M=[],C=0),we({selected_set:C}))):pe==="winner"&&(Te===void 0?R[de?"p1action":"p2action"].ddlb.setValue(M.length?"retired":"walkover"):R[de?"p1action":"p2action"].ddlb.setValue(" "),R[de?"p1action":"p2action"].ddlb.lock(),P=!0,R.p1selector.ddlb.lock(),R.p2selector.ddlb.lock(),we({selected_set:C}))}function qe({sobj:de,changeFx:pe}){ka.attachDropDown({id:de.bestof.id,options:Te(r.bestof)}),de.bestof.ddlb=new ka.DropDown({element:de.bestof.element,id:de.bestof.id,onChange:rt}),de.bestof.ddlb.setValue(I,"white"),ka.attachDropDown({id:de.setsto.id,options:Te(r.setsto)}),de.setsto.ddlb=new ka.DropDown({element:de.setsto.element,id:de.setsto.id,onChange:It}),de.setsto.ddlb.setValue(y,"white");let ke=y,Ue=Le(ke);ka.attachDropDown({id:de.tiebreaksat.id,options:Ue}),de.tiebreaksat.ddlb=new ka.DropDown({element:de.tiebreaksat.element,id:de.tiebreaksat.id,onChange:zt}),de.tiebreaksat.ddlb.setValue(v&&v<ke?v:ke,"white"),de.tiebreaksat.ddlb.setValue(v||"","white"),ka.attachDropDown({id:de.tiebreaksto.id,options:Te(r.tiebreaksto)}),de.tiebreaksto.ddlb=new ka.DropDown({element:de.tiebreaksto.element,id:de.tiebreaksto.id,onChange:Jt}),de.tiebreaksto.ddlb.setValue(S,"white"),ka.attachDropDown({id:de.finalset.id,options:[{key:Nr.tr("scoring.normal"),value:"N"},{key:Nr.tr("scoring.supertiebreak"),value:"S"}]}),de.finalset.ddlb=new ka.DropDown({element:de.finalset.element,id:de.finalset.id,onChange:Yr}),de.finalset.ddlb.selectionBackground(),de.finalset.ddlb.setValue(U?"S":"N","white"),ka.attachDropDown({id:de.supertiebreakto.id,options:Te(r.supertiebreakto)}),de.supertiebreakto.ddlb=new ka.DropDown({element:de.supertiebreakto.element,id:de.supertiebreakto.id,onChange:Eo}),de.supertiebreakto.ddlb.selectionBackground(),de.supertiebreakto.ddlb.setValue(w||10,"white"),je(U);function Te(Qt){return!Qt||!Array.isArray(Qt)?{}:Qt.map(yr=>({key:yr,value:yr}))}function rt(Qt){I=parseInt(Qt),b=Math.ceil(Qt/2),U=!1,de.finalset.ddlb.setValue("N","white"),je(U),typeof pe=="function"&&pe()}function je(Qt){de.stb2.element.style.opacity=Qt?1:0,de.supertiebreakto.element.style.opacity=Qt?1:0}function Le(Qt){return[{key:Nr.tr("none"),value:""},{key:`${Qt-1}-${Qt-1}`,value:Qt-1},{key:`${Qt}-${Qt}`,value:Qt}]}function It(Qt){y=parseInt(Qt),v=parseInt(Qt);let yr=Le(Qt);de.tiebreaksat.ddlb.setOptions(yr),de.tiebreaksat.ddlb.setValue(Qt,"white"),typeof pe=="function"&&pe()}function zt(Qt){v=parseInt(Qt),typeof pe=="function"&&pe()}function Jt(Qt){S=parseInt(Qt),typeof pe=="function"&&pe()}function Yr(Qt){w=de.supertiebreakto.ddlb.getValue()||10,U=Qt==="S"?{tiebreakTo:w}:!1,je(U),typeof pe=="function"&&pe()}function Eo(Qt){w=parseInt(Qt),typeof pe=="function"&&pe()}}},t}();function b1({setnum:t,score:e={games:0}}){let i=e.tiebreak!==void 0&&e.tiebreak||e.spacer!==void 0&&e.spacer||"",n=e.supertiebreak!==void 0?e.supertiebreak:e.games;return`
      <div class="set score set_number setClick" setnum="${t!==void 0?t:""}">
         <div class="setscore setClick">${n}</div>
         <div class="tbscore" ${e.spacer!==void 0?'style="opacity: 0"':""}>${i}</div>
      </div>
   `}function att(t){if(!t)return"";if(t.status)return t.status;if(!t.schedule)return"";let e=stt(t.schedule);if(e)return`Duration ${e}`;let i=`${t.schedule.time_prefix||""}${t.schedule.time||""}`,n=`${t.schedule.court||""}${i?" / "+i:""}`;return t.winner_index===void 0?n:""}const ott=(t,e)=>{let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),a=i-n*3600-r*60,o=!e||(e==null?void 0:e.display_seconds),s=!e||(e==null?void 0:e.pad_hours);return n<10&&s&&(n="0"+n),r<10&&(r="0"+r),a<10&&(a="0"+a),o?n+":"+r+":"+a:n+":"+r};function stt(t){if(!t.start||!t.end)return"";let e=iX(t.end)-iX(t.start);return ott(e,{pad_hours:!1,display_seconds:!1})}function iX(t){let e=t.split(":");return e[0]*60*60+e[1]*60}function Dx({matchUpId:t,callback:e}){var o;const{matchUp:i}=$e.findMatchUp({matchUpId:t}),n=s=>{const{matchUpStatus:l,winningSide:c,score:u}=s,d=u&&$e.parseScoreString({scoreString:u}),p=[{method:N6,params:{drawId:i.drawId,outcome:{score:{sets:d},matchUpStatus:l,winningSide:c},matchUpId:t}}];Pt({methods:p,callback:f=>{Mw(),pt(e)&&e({...f,outcome:s})}})},r=i.sides.map(s=>s.participant),a=((o=i.score)==null?void 0:o.sets)||[];rtt.setMatchScore({delegation:cn.scoring.delegation,round_name:i.roundName||"",matchFormat:i.matchUpFormat,callback:n,muid:i.matchUpId,existing_scores:a,teams:r})}function ltt(t,e){const i=e.getRow(),n=i.getData(),{matchUpId:r,readyToScore:a}=n;a&&Dx({matchUpId:r,callback:s=>{var l;if(s.success){const{matchUpStatus:c,sets:u,matchUpFormat:d,score:p,winningSide:h}=s.outcome;Object.assign(n,{matchUpStatus:c,sets:u,matchUpFormat:d,score:p}),n.winningSide=h&&`side${h}`,i.update(n),e.getTable().redraw(!0);const m=(l=s.results.find(({methodName:g})=>g===N6))==null?void 0:l.tieMatchUpResult;wtt(m)}else console.log({result:s})}})}function ctt({matchUp:t}){var r,a,o,s,l,c;const e=((o=(a=(r=t.sides)==null?void 0:r.find(u=>u.sideNumber===1))==null?void 0:a.participant)==null?void 0:o.participantName)||"Side 1",i=((c=(l=(s=t.sides)==null?void 0:s.find(u=>u.sideNumber===2))==null?void 0:l.participant)==null?void 0:c.participantName)||"Side 2",n=(u,d)=>{var p;return(p=u==null?void 0:u.participantName)==null?void 0:p.localeCompare(d==null?void 0:d.participantName)};return[{formatter:NZ(v1(t)),cellClick:(u,d)=>v1(t)({event:u,cell:d}),sorter:n,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:NZ(v1(t)),cellClick:(u,d)=>v1(t)({event:u,cell:d}),sorter:n,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:O6,cellClick:ltt,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function utt({matchUp:t,tableElement:e,collectionMatchUps:i}){const n=i.map(o=>fS({...o,dualMatchUp:t})),r=ctt({matchUp:t});return{table:new na(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:r,data:n})}}function bSe({side1:t,side2:e,side1Score:i,side2Score:n}){const r=document.createElement("div");r.className="overlay-content-overview";const a=document.createElement("div");a.className="overlay-content-body";const o=dtt({side1Score:i,side2Score:n});return a.appendChild(t),a.appendChild(o),a.appendChild(e),r.appendChild(a),r}function HN({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const n=document.createElement("div");return n.className="side-name",n.innerHTML=t,i.appendChild(n),i}function dtt({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const n=document.createElement("div");n.className="score-flex";const r=document.createElement("div");return r.className="score-vs",r.innerHTML="vs",n.appendChild(t),n.appendChild(r),n.appendChild(e),i.appendChild(n),i}function zN({winningSide:t,sets:e,sideNumber:i,id:n}){var l;const r=`side${i}Score`,a=((l=e==null?void 0:e[0])==null?void 0:l[r])||0,o=document.createElement("span");return n&&(o.id=n),o.className="side-score",i===1?o.style.paddingLeft="1rem":o.style.paddingRight="1rem",i===t&&o.classList.add("has-text-success"),o.innerHTML=a,o}let wSe;function SSe({title:t,content:e,footer:i}={}){if(!e||!i)return;const n=document.getElementById(mU);n&&lo(n);const r=document.createElement("div");r.className="overlay noselect",r.id=mU;const a=document.createElement("div");a.className="overlay-center-align",r.appendChild(a);const o=document.createElement("div");if(o.className="overlay-root",a.appendChild(o),t){const u=htt({title:t});o.appendChild(u)}const s=document.createElement("div");s.className="overlay-content",typeof e=="string"?s.innerHTML=e:e&&s.appendChild(e),o.appendChild(s);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),o.appendChild(l),document.body.appendChild(r),wSe=window.scrollY||document.documentElement.scrollTop;const c=document.getElementById("root");c.style.display=ct}function ptt({content:t}){var i,n;const e=(n=(i=document.getElementById(mU))==null?void 0:i.getElementsByClassName("overlay-content"))==null?void 0:n[0];e&&(lo(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function htt({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function TSe(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:wSe});let e=document.getElementById(mU);lo(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(mU)}const USe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}];let Xg,fa;const AM="Timed set",iT="Tiebreak",tV="No-Ad",pl="Set",_T="Ad",ts={setFormat:{descriptor:"Best of",bestOf:3,advantage:_T,what:pl,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:_T,what:pl,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function nX(t){var a;const e=t?"finalSetFormat":"setFormat",i=ts[e].what,n={setTo:ts[e].setTo};return i===pl&&ts[e].advantage===tV&&(n.NoAD=!0),i===pl&&((a=document.getElementById(t?"finalSetTiebreak":"setTiebreak"))==null?void 0:a.checked)&&(n.tiebreakAt=ts[e].tiebreakAt,n.tiebreakFormat={tiebreakTo:ts[e].tiebreakTo},i===pl&&ts[e].winBy===1&&(n.tiebreakFormat.NoAD=!0)),i===AM&&(n.minutes=ts[e].minutes,n.timed=!0),i===iT&&(n.tiebreakSet={tiebreakTo:ts[e].tiebreakTo},ts[e].winBy===1&&(n.tiebreakSet.NoAD=!0)),n}function DSe(){var o;const t=nX();fa={bestOf:ts.setFormat.bestOf,setFormat:t},((o=document.getElementById("finalSetOption"))==null?void 0:o.checked)&&(fa.finalSetFormat=nX(1));const i=aA.scoreGovernor.stringifyMatchUpFormat(fa),n=!!USe.find(s=>s.format===i),r=document.getElementById("matchUpFormatSelector"),a=r==null?void 0:r.querySelectorAll("option");return Array.from(a).forEach(s=>{s.selected=!n&&s.value==="Custom"||s.value===i}),i}function nT(t){const e=t||DSe(),i=document.getElementById("matchUpFormatString");i.innerHTML=e}const Jg=(t,e)=>e&&t.finalSetFormat||t.setFormat,cb=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",value:3},{getValue:(t,e)=>{const i=Jg(t,e),n=i!=null&&i.NoAD?tV:_T;return i!=null&&i.timed||i!=null&&i.tiebreakSet?void 0:n},options:[_T,tV],defaultValue:_T,id:"advantage",whats:[pl]},{getValue:(t,e)=>{const i=Jg(t,e);return i||console.log({pmf:t}),i!=null&&i.timed?AM:i!=null&&i.tiebreakSet?iT:pl},options:[pl,iT,AM],finalSetLabel:`${pl}${ep}`,onChange:"changeWhat",pluralize:!0,id:"what"},{getValue:(t,e)=>Jg(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[pl],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{var n,r;const i=Jg(t,e);return((n=i.tiebreakFormat)==null?void 0:n.tiebreakTo)||((r=i.tiebreakSet)==null?void 0:r.tiebreakTo)},options:[5,7,9,10,12],whats:[pl,iT],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>Jg(t,e).tiebreakAt,options:t=>{const e=ts[t?"finalSetFormat":"setFormat"].setTo;return e>1?[e-1,e]:[]},id:"tiebreakAt",defaultValue:6,whats:[pl],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{var n;const i=Jg(t,e);if(i.tiebreakFormat)return(n=i.tiebreakFormat)!=null&&n.NoAD?1:2},whats:[pl,iT],prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=Jg(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],whats:[AM],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],rX={changeWhat:(t,e,i)=>{const n=i===pl,r=e?"finalSetTiebreakToggle":"setTiebreakToggle",a=document.getElementById(r);a.style.display=n?"":ct,cb.forEach(o=>{if(o.whats){const{prefix:s="",suffix:l="",pluralize:c}=o,u=o.whats.includes(i),d=e?`${o.id}-${e}`:o.id,p=document.getElementById(d);if(p.style.display===ct&&u){const h=fa.bestOf,f=!e&&c&&h>1?"s":"",m=o.defaultValue;p.innerHTML=`${s}${m}${f}${l}${ep}`}p.style.display=u?"":ct}})},changeCount:(t,e,i)=>{const n=e?`tiebreakAt-${e}`:"tiebreakAt";ts[e?"finalSetFormat":"setFormat"].tiebreakAt=i;const r=document.getElementById(n);r.innerHTML=`@${i}${ep}`},pluralize:(t,e,i)=>{const n=ts[e?"finalSetFormat":"setFormat"].what,r=e?`what-${e}`:"what",a=document.getElementById(r),o=i>1?"s":"";a.innerHTML=`${n}${o}${ep}`}};function G6({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e}={}){var D;Xg=t,fa=wp.parse(Xg),console.log({parsedMatchUpFormat:fa});const i=()=>{const w=DSe();pt(e)&&e(w)};let n,r,a,o,s;const l=[{onClick:()=>e(),label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:i}],c="switch is-rounded is-danger",u=document.createElement("div"),d=document.createElement("div");d.id="matchUpFormatString",d.innerHTML=Xg,d.style.fontSize="1.5em",d.style.color="blue",d.style.marginBottom="1em",u.appendChild(d);const p=document.createElement("div");p.style.marginBlockEnd="1em";const h={id:"matchUpFormatSelector",options:USe.map(w=>({selected:w.format===Xg,value:w.format,label:w.name}))},{field:f,inputElement:m}=MT(h);m.onchange=w=>{Xg=w.target.value,nT(Xg),fa=wp.parse(Xg);const S=fa.finalSetFormat;n.style.display=S?"":ct,r.style.display=S?"":ct,a.checked=S,s.checked=!!(S!=null&&S.tiebreakFormat),o.checked=fa.setFormat.tiebreakFormat,cb.forEach(U=>{if(U.getValue){const C=U.getValue(fa),E=document.getElementById(U.id);if(E&&C){const{prefix:P="",suffix:M="",pluralize:N}=U,R=fa.bestOf,A=N&&R>1?"s":"";E.innerHTML=`${P}${C}${A}${M}${ep}`,E.style.display=""}else E&&(E.style.display=ct);if(S){const P=U.getValue(fa,!0),M=document.getElementById(`${U.id}-1`);if(M&&P){const{prefix:N="",suffix:R="",pluralize:A}=U,_=fa.bestOf,O=A&&_>1?"s":"";M.innerHTML=`${N}${P}${O}${R}${ep}`,M.style.display=""}else M&&(M.style.display=ct)}}})},p.appendChild(f),u.appendChild(p);const g=document.createElement("div");cb.map(w=>{const S=w.getValue(fa);return aX({...w,value:S})}).forEach(w=>g.appendChild(w)),g.id="setFormat",u.appendChild(g);const v=document.createElement("div");v.className="field",v.style.fontSize="1em",o=document.createElement("input"),o.className=c,o.name="setTiebreak",o.id="setTiebreak",o.type="checkbox",o.checked=fa.tiebreakFormat,o.onchange=w=>{const S=w.target.checked;cb.filter(({tb:U})=>U).forEach(U=>{const C=document.getElementById(U.id);if(C.style.display===ct&&S){const{prefix:E="",suffix:P="",pluralize:M,defaultValue:N}=U,R=fa.bestOf,A=M&&R>1?"s":"";C.innerHTML=`${E}${N}${A}${P}${ep}`}C.style.display=S?"":ct}),nT()},v.appendChild(o);const y=document.createElement("label");y.setAttribute("for","setTiebreak"),y.id="setTiebreakToggle",y.innerHTML="Tiebreak",y.style.marginRight="1em",v.appendChild(y),a=document.createElement("input"),a.className="switch is-rounded is-info",a.type="checkbox",a.name="finalSetOption",a.checked=!!fa.finalSetFormat,a.id="finalSetOption",a.onchange=w=>{const S=w.target.checked;n.style.display=S?"":ct,r.style.display=S?"":ct,nT()},v.appendChild(a);const I=document.createElement("label");I.setAttribute("for","finalSetOption"),I.innerHTML="Final set",v.appendChild(I),u.appendChild(v),n=document.createElement("div"),n.style.display=fa.finalSetFormat?"":ct,n.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[]}].concat(cb.map(w=>{const S=w.getValue(fa,!0);return{...w,value:S}})).filter(w=>w.finalSet!==!1).map(w=>aX({...w,index:1})).forEach(w=>n.appendChild(w)),u.appendChild(n),r=document.createElement("div"),r.style.display=fa.finalSetFormat?"":ct,r.className="field",r.style.fontSize="1em",s=document.createElement("input"),s.className=c,s.name="finalSetTiebreak",s.id="finalSetTiebreak",s.type="checkbox",s.checked=(D=fa.finalSetFormat)==null?void 0:D.tiebreakFormat,r.onchange=w=>{const S=w.target.checked;cb.filter(({tb:U})=>U).forEach(U=>{const C=document.getElementById(`${U.id}-1`);if(C.style.display===ct&&S){const{prefix:E="",suffix:P="",pluralize:M,defaultValue:N}=U,R=fa.bestOf,A=M&&R>1?"s":"";C.innerHTML=`${E}${N}${A}${P}${ep}`}C.style.display=S?"":ct}),nT()},r.appendChild(s);const b=document.createElement("label");b.setAttribute("for","finalSetTiebreak"),b.id="finalSetTiebreakToggle",b.innerHTML="Tiebreak",b.style.marginRight="1em",r.appendChild(b),u.appendChild(r),ir({title:"Score format",content:u,buttons:l})}function ftt({index:t,finalSetLabel:e,label:i,prefix:n="",suffix:r="",value:a,pluralize:o}){const s=!t&&o&&ts.setFormat.bestOf>1?"s":"";return i||t&&e||`${n}${a}${s}${r}${ep}`}function aX(t){const{id:e,initiallyHidden:i,index:n,value:r}=t,a=document.createElement("button");return a.className="mfcButton",a.id=n?`${e}-${n}`:e,a.innerHTML=ftt(t),a.onclick=o=>mtt({e:o,button:a,...t}),a.style.display=r||t.label?"":ct,i&&(a.style.display=ct),a}function mtt(t){const{e,id:i,button:n,pluralize:r,options:a,onChange:o,index:s,prefix:l="",suffix:c=""}=t,u=ts.setFormat.bestOf,d=!s&&r&&u>1?"s":"",h=(pt(a)?a(s):a).map(f=>({text:`${f}${d}`,onClick:()=>{n.innerHTML=`${l}${f}${d}${c}${ep}`,o&&pt(rX[o])&&rX[o](e,s,f),ts[s?"finalSetFormat":"setFormat"][i]=f,nT()}}));nl({items:h,target:e.target,config:{arrow:!1,offset:[0,0]}})}function gtt(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:Et,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:At,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const n=i.getRow(),r=n.getData();G6({callback:o=>{o&&(Object.assign(r,{matchUpFormat:o}),n.update(r),i.getTable().redraw(!0))},existingMatchUpFormat:r.matchUpFormat})},title:"Score format",field:fW,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[uW,dW,hW,pW]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function oX(t){return(t==null?void 0:t[0].toUpperCase())+(t==null?void 0:t.substring(1).toLowerCase())||""}function vtt({tableElement:t,tieFormat:e}){const i=((e==null?void 0:e.collectionDefinitions)||[]).map(a=>{const{collectionValue:o,matchUpValue:s,scoreValue:l,setValue:c,matchUpType:u,gender:d}=a,p=hi.isConvertableInteger(o)&&uW||hi.isConvertableInteger(l)&&pW||hi.isConvertableInteger(c)&&hW||dW,h=o??l??c??s;return{...a,matchUpType:oX(u),gender:oX(d),awardValue:h,awardType:p}}),n=gtt();return{table:new na(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:n,data:i})}}function PSe(t){var r,a,o;const e=(r=t==null?void 0:t.winCriteria)==null?void 0:r.valueGoal,i=(a=t==null?void 0:t.collectionDefinitions)!=null&&a.length?((o=t==null?void 0:t.winCriteria)==null?void 0:o.aggregateValue)&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function CSe({title:t,tieFormat:e,onClose:i}){const{content:n,inputs:r,elements:a,table:o}=ytt({tieFormat:e}),s=u=>{const d=r.tieFormatName.value,p=u.map(f=>hi.definedAttributes({collectionValue:f.awardType===uW?f.awardValue:void 0,matchUpValue:f.awardType===dW?f.awardValue:void 0,scoreValue:f.awardType===pW?f.awardValue:void 0,setValue:f.awardType===hW?f.awardValue:void 0,matchUpType:f.matchUpType.toUpperCase(),collectionName:f.collectionName,matchUpFormat:f.matchUpFormat,gender:f.gender.toUpperCase(),collectionId:f.collectionId,matchUpCount:f.matchUpCount})),h=$e.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:h}};o.on("dataChanged",()=>{const u=s(o.getData());a.winCriteria.innerHTML=PSe(u)});const c=btt({table:o,onClose:u=>{var p;const d=s(u);pt(i)&&i(((p=d==null?void 0:d.collectionDefinitions)==null?void 0:p.length)&&d)}});return SSe({title:t,content:n,footer:c})}function ytt({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:n}=vtt({tieFormat:t,tableElement:i}),r=Itt();e.appendChild(r);const a=document.createElement("div");e.appendChild(a),e.appendChild(i);const o=()=>{const u=n==null?void 0:n.getSelectedData().map(({collectionId:d})=>d);n==null||n.deleteRow(u)},s=[{value:(t==null?void 0:t.tieFormatName)||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:$l(5),field:"tieFormatName",id:"tieFormatName",location:Et},{text:PSe(t),id:"winCriteria",location:Et},{onClick:o,label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{onClick:()=>{const d={collectionName:`Collection ${n.getData().length+1}`,collectionId:hi.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};n.addRow(d)},label:"Add collection",intent:"is-info",location:vt}],{elements:l,inputs:c}=ho({table:n,target:a,items:s});return{content:e,table:n,elements:l,inputs:c}}function Itt(t){const e=document.createElement("div");e.className="overlay-content-overview";const i=document.createElement("div");return i.className="overlay-content-body",e.appendChild(i),e}function btt({table:t,onClose:e}){const i=()=>{t.destroy(),TSe()},n=document.createElement("button");n.className="button is-warning is-light",n.onclick=i,n.innerHTML="Cancel";const r=document.createElement("button");r.className="button is-info button-spacer",r.onclick=o=>{o.preventDefault(),o.stopPropagation();const s=t.getData();i(),pt(e)&&e(s)},r.innerHTML="Done";const a=document.createElement("div");return a.className="overlay-footer-wrap",a.appendChild(n),a.appendChild(r),a}function ESe({matchUpId:t,structureId:e,eventId:i,drawId:n,callback:r}){const{tieFormat:a}=$e.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:n});CSe({title:"Edit scorecard",tieFormat:a,onClose:s=>{var l,c;if(s){if((l=s.collectionDefinitions)==null||l.forEach((h,f)=>h.collectionOrder=f+1),!((c=hi.compareTieFormats({considerations:{collectionName:!0,collectionOrder:!0},descendant:s,ancestor:a}))==null?void 0:c.different)){ai({intent:"is-info",message:"No changes"});return}Pt({methods:[{method:"modifyTieFormat",params:{modifiedTieFormat:s,structureId:e,matchUpId:t,drawId:n}}],callback:h=>{var f;h.success?(ai({intent:"is-success",message:"Scorecard updated"}),pt(r)&&r()):ai({intent:"is-danger",message:((f=h.error)==null?void 0:f.message)||"Error"})}})}}})}const w1="has-text-success",MSe="tieSide1",RSe="tieSide2";function Px({title:t,drawId:e,matchUpId:i,onClose:n}){var l;const r=$e.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),a=r.matchUp;if(!a||r.error||!t||!Array.isArray((l=a==null?void 0:a.tieFormat)==null?void 0:l.collectionDefinitions))return;const o=Cx({matchUp:a}),s=Stt({title:t,drawId:e,matchUpId:i,onClose:n});return SSe({title:t,content:o,footer:s})}function Cx({matchUp:t}){const e=document.createElement("div");e.className="overlay-content-container";const i=HN({participantName:sX({matchUp:t,sideNumber:1}),justify:"end"}),n=HN({participantName:sX({matchUp:t,sideNumber:2}),justify:"start"}),{winningSide:r,sets:a}=t,o=zN({winningSide:r,sets:a,sideNumber:1,id:MSe}),s=zN({winningSide:r,sets:a,sideNumber:2,id:RSe}),l=bSe({side1:i,side2:n,side1Score:o,side2Score:s});e.appendChild(l),Ye.collectionTables||(Ye.collectionTables=[]);const c=t.tieFormat.collectionDefinitions;for(const u of c){const d=t.tieMatchUps.filter(g=>g.collectionId===u.collectionId),p=document.createElement("div");p.className="collection";const h=document.createElement("div");h.className="title is-4",h.innerHTML=u.collectionName,p.appendChild(h);const f=document.createElement("div");p.appendChild(f);const{table:m}=utt({matchUp:t,tableElement:f,collectionMatchUps:d});Ye.collectionTables.push(m),e.appendChild(p)}return e}function wtt(t){var r,a;const e=(a=(r=t==null?void 0:t.score)==null?void 0:r.sets)==null?void 0:a[0];if(!e)return;const i=document.getElementById(MSe),n=document.getElementById(RSe);i.classList.remove(w1),n.classList.remove(w1),i.innerHTML=e.side1Score,n.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(w1),t.winningSide===2&&n.classList.add(w1)}function sX({matchUp:t,sideNumber:e}){var i,n;return(n=(i=t.sides.find(r=>r.sideNumber===e))==null?void 0:i.participant)==null?void 0:n.participantName}function Stt({title:t,drawId:e,matchUpId:i,onClose:n}){const r=document.createElement("button");r.className="button is-warning is-light",r.onclick=()=>{ESe({matchUpId:i,drawId:e,callback:()=>{Px({title:t,drawId:e,matchUpId:i})}})},r.innerHTML="Edit scorecard";const a=u=>{var d;if(u.success){const p=(d=$e.findMatchUp({drawId:e,matchUpId:i}))==null?void 0:d.matchUp,h=Cx({matchUp:p});ptt({content:h})}},o=document.createElement("button");o.className="button is-warning is-light button-spacer",o.innerHTML="Remove players",o.onclick=()=>{Pt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:"resetMatchUpLineUps"}],callback:a})};const s=document.createElement("button");s.className="button is-info is-light button-spacer",s.innerHTML="Clear results",s.onclick=()=>{Pt({methods:[{params:{drawId:e,matchUpId:i},method:f0e}],callback:a})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=u=>{for(u.preventDefault(),u.stopPropagation();Ye.collectionTables.length;)Ye.collectionTables.pop().destroy();TSe(),pt(n)&&n()},l.innerHTML="Done";const c=document.createElement("div");return c.className="overlay-footer-wrap",c.appendChild(r),c.appendChild(o),c.appendChild(s),c.appendChild(l),c}const{TEAM:Ttt}=Ua,Utt=(t,e)=>(i,n)=>{var u;const r=n.getRow().getData(),{matchUpId:a,readyToScore:o,matchUpType:s,drawId:l,eventName:c}=r.matchUp;if(s===Ttt)Px({title:c,matchUpId:a,drawId:l,onClose:()=>t()});else if(o||(u=r.matchUp.score)!=null&&u.scoreStringSide1)if(cn.hotkeys){e({e:i,cell:n,replaceTableData:t});const d=document.querySelectorAll(".activeScoreCell");for(const p of Array.from(d))p.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else Dx({matchUpId:a,callback:t})};function NSe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function Dtt({data:t,replaceTableData:e,setFocusData:i}){const n=(l,c)=>{var f,m;const d=c.getRow().getData(),{courtName:p,scheduledDate:h}=d;if(p&&h){const g=(m=(f=$e.getTournament())==null?void 0:f.tournamentRecord)==null?void 0:m.tournamentId,v=`/${xa}/${g}/${iy}/${h}`;Ye.router.navigate(v)}},r=()=>e(),a=t.some(l=>l.courtName),o=(l,c)=>tD(l,c,r),s=l=>{const c=document.createElement("div");c.className="has-text-warning-dark",c.innerHTML="Select participant";const u=({event:p,...h})=>{tD(p,l,r,h)};return l.getValue().participantName&&EI(u)(l,c)};return[{cellClick:(l,c)=>c.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:At,minWidth:50,width:50},{headerMenu:lh({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{formatter:w9e(zn),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:RZ,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:RZ,minWidth:90},{cellClick:n,field:"scheduledDate",title:"Date",width:110},{cellClick:n,visible:!!a,field:"courtName",title:"Court",width:100},{cellClick:n,field:"scheduledTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:o,sorter:jw,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:o,sorter:jw,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Utt(e,i),formatter:O6,sorter:NSe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:O0e,formatter:x0e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Et,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(l,c)=>x6({pointerEvent:l,...c.getData()}),formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,widthGrow:0,width:50}]}const TF=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function UF(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent("on".concat(e),i)}function $S(t,e,i,n){t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent("on".concat(e),i)}function ASe(t,e){const i=e.slice(0,e.length-1);for(let n=0;n<i.length;n++)i[n]=t[i[n].toLowerCase()];return i}function _Se(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function Ptt(t,e){const i=t.length>=e.length?t:e,n=t.length>=e.length?e:t;let r=!0;for(let a=0;a<i.length;a++)n.indexOf(i[a])===-1&&(r=!1);return r}const sD={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":TF?173:189,"=":TF?61:187,";":TF?59:186,"'":222,"[":219,"]":221,"\\":220},xp={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},iV={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Ro={16:!1,18:!1,17:!1,91:!1},Qr={};for(let t=1;t<20;t++)sD["f".concat(t)]=111+t;let Sr=[],kT=null,kSe="all";const Ch=new Map,wE=t=>sD[t.toLowerCase()]||xp[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),Ctt=t=>Object.keys(sD).find(e=>sD[e]===t),Ett=t=>Object.keys(xp).find(e=>xp[e]===t);function OSe(t){kSe=t||"all"}function lD(){return kSe||"all"}function Mtt(){return Sr.slice(0)}function Rtt(){return Sr.map(t=>Ctt(t)||Ett(t)||String.fromCharCode(t))}function Ntt(){const t=[];return Object.keys(Qr).forEach(e=>{Qr[e].forEach(i=>{let{key:n,scope:r,mods:a,shortcut:o}=i;t.push({scope:r,shortcut:o,mods:a,keys:n.split("+").map(s=>wE(s))})})}),t}function Att(t){const e=t.target||t.srcElement,{tagName:i}=e;let n=!0;const r=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(r||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(n=!1),n}function _tt(t){return typeof t=="string"&&(t=wE(t)),Sr.indexOf(t)!==-1}function ktt(t,e){let i,n;t||(t=lD());for(const r in Qr)if(Object.prototype.hasOwnProperty.call(Qr,r))for(i=Qr[r],n=0;n<i.length;)i[n].scope===t?i.splice(n,1).forEach(o=>{let{element:s}=o;return H6(s)}):n++;lD()===t&&OSe(e||"all")}function Ott(t){let e=t.keyCode||t.which||t.charCode;const i=Sr.indexOf(e);if(i>=0&&Sr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&Sr.splice(0,Sr.length),(e===93||e===224)&&(e=91),e in Ro){Ro[e]=!1;for(const n in xp)xp[n]===e&&(tp[n]=!1)}}function xSe(t){if(typeof t>"u")Object.keys(Qr).forEach(r=>{Array.isArray(Qr[r])&&Qr[r].forEach(a=>S1(a)),delete Qr[r]}),H6(null);else if(Array.isArray(t))t.forEach(r=>{r.key&&S1(r)});else if(typeof t=="object")t.key&&S1(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];let[r,a]=i;typeof r=="function"&&(a=r,r=""),S1({key:t,scope:r,method:a,splitKey:"+"})}}const S1=t=>{let{key:e,scope:i,method:n,splitKey:r="+"}=t;_Se(e).forEach(o=>{const s=o.split(r),l=s.length,c=s[l-1],u=c==="*"?"*":wE(c);if(!Qr[u])return;i||(i=lD());const d=l>1?ASe(xp,s):[],p=[];Qr[u]=Qr[u].filter(h=>{const m=(n?h.method===n:!0)&&h.scope===i&&Ptt(h.mods,d);return m&&p.push(h.element),!m}),p.forEach(h=>H6(h))})};function lX(t,e,i,n){if(e.element!==n)return;let r;if(e.scope===i||e.scope==="all"){r=e.mods.length>0;for(const a in Ro)Object.prototype.hasOwnProperty.call(Ro,a)&&(!Ro[a]&&e.mods.indexOf(+a)>-1||Ro[a]&&e.mods.indexOf(+a)===-1)&&(r=!1);(e.mods.length===0&&!Ro[16]&&!Ro[18]&&!Ro[17]&&!Ro[91]||r||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Sr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function cX(t,e){const i=Qr["*"];let n=t.keyCode||t.which||t.charCode;if(!tp.filter.call(this,t))return;if((n===93||n===224)&&(n=91),Sr.indexOf(n)===-1&&n!==229&&Sr.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=iV[s];t[s]&&Sr.indexOf(l)===-1?Sr.push(l):!t[s]&&Sr.indexOf(l)>-1?Sr.splice(Sr.indexOf(l),1):s==="metaKey"&&t[s]&&Sr.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Sr=Sr.slice(Sr.indexOf(l))))}),n in Ro){Ro[n]=!0;for(const s in xp)xp[s]===n&&(tp[s]=!0);if(!i)return}for(const s in Ro)Object.prototype.hasOwnProperty.call(Ro,s)&&(Ro[s]=t[iV[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Sr.indexOf(17)===-1&&Sr.push(17),Sr.indexOf(18)===-1&&Sr.push(18),Ro[17]=!0,Ro[18]=!0);const r=lD();if(i)for(let s=0;s<i.length;s++)i[s].scope===r&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&lX(t,i[s],r,e);if(!(n in Qr))return;const a=Qr[n],o=a.length;for(let s=0;s<o;s++)if((t.type==="keydown"&&a[s].keydown||t.type==="keyup"&&a[s].keyup)&&a[s].key){const l=a[s],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(wE(u[p]));d.sort().join("")===Sr.sort().join("")&&lX(t,l,r,e)}}function tp(t,e,i){Sr=[];const n=_Se(t);let r=[],a="all",o=document,s=0,l=!1,c=!0,u="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(a=e.scope),e.element&&(o=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(a=e),p&&xSe(t,a);s<n.length;s++)t=n[s].split(u),r=[],t.length>1&&(r=ASe(xp,t)),t=t[t.length-1],t=t==="*"?"*":wE(t),t in Qr||(Qr[t]=[]),Qr[t].push({keyup:l,keydown:c,scope:a,mods:r,shortcut:n[s],method:i,key:n[s],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Ch.has(o)){const h=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return cX(m,o)},f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;cX(m,o),Ott(m)};Ch.set(o,{keydownListener:h,keyupListenr:f,capture:d}),UF(o,"keydown",h,d),UF(o,"keyup",f,d)}if(!kT){const h=()=>{Sr=[]};kT={listener:h,capture:d},UF(window,"focus",h,d)}}}function xtt(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Qr).forEach(i=>{Qr[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function H6(t){const e=Object.values(Qr).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:a}=Ch.get(t)||{};n&&r&&($S(t,"keyup",r,a),$S(t,"keydown",n,a),Ch.delete(t))}if((e.length<=0||Ch.size<=0)&&(Object.keys(Ch).forEach(r=>{const{keydownListener:a,keyupListenr:o,capture:s}=Ch.get(r)||{};a&&o&&($S(r,"keyup",o,s),$S(r,"keydown",a,s),Ch.delete(r))}),Ch.clear(),Object.keys(Qr).forEach(r=>delete Qr[r]),kT)){const{listener:r,capture:a}=kT;$S(window,"focus",r,a),kT=null}}const DF={getPressedKeyString:Rtt,setScope:OSe,getScope:lD,deleteScope:ktt,getPressedKeyCodes:Mtt,getAllKeyCodes:Ntt,isPressed:_tt,filter:Att,trigger:xtt,unbind:xSe,keyMap:sD,modifier:xp,modifierMap:iV};for(const t in DF)Object.prototype.hasOwnProperty.call(DF,t)&&(tp[t]=DF[t]);if(typeof window<"u"){const t=window.hotkeys;tp.noConflict=e=>(e&&window.hotkeys===tp&&(window.hotkeys=t),tp),window.hotkeys=tp}const{HOTKEYS:Ltt,SIDE1KEYS:Ftt,MODIFIERS:$tt}=aH;function Btt(){let t,e;const i=n=>{e=void 0,t=n};return tp(Ltt+",esc",(n,r)=>{if(t){const a=t.cell.getElement(),o=a.classList.contains("tabulator-cell")?a.firstChild:a;n.preventDefault();const s=t.cell.getRow().getData();e||(e=s.matchUp);const l=tp.shift,c=l?r.key.split(r.splitKey)[1]:r.key;c==="esc"&&(t.replaceTableData(),t=void 0);const u=Ftt.some(d=>d===c)&&(l?2:1)||void 0;if(u||$tt.includes(c)){const{matchUpFormat:d,matchUpStatus:p,score:h,sets:f,winningSide:m}=e,{matchUpStatus:g,scoreString:v,winningSide:y,sets:I,updated:b}=wv.keyValueScore({scoreString:h==null?void 0:h.scoreStringSide1,shiftFirst:!0,sets:f||[],matchUpStatus:p,matchUpFormat:d,winningSide:m,lowSide:u,value:c});b&&(e={matchUpId:s.matchUp.matchUpId,drawId:s.matchUp.drawId,score:{scoreStringSide1:v},matchUpStatus:g,winningSide:y,sets:I,matchUpFormat:d,updated:b},o.innerText=v||"Enter score")}}if(t&&r.key==="enter"){const a=wv.generateScoreString({sets:e.sets,reversed:!0}),o=wv.generateScoreString({sets:e.sets}),s={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:o,scoreStringSide2:a}};Vtt({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:s}),t=void 0}}),{setFocusData:i}}function Vtt({outcome:t,callback:e,matchUpId:i,drawId:n}){const{matchUpStatus:r,winningSide:a,score:o}=t;Pt({methods:[{method:N6,params:{outcome:{matchUpStatus:r,winningSide:a,score:o},matchUpId:i,drawId:n}}],callback:c=>{pt(e)&&e({...c,outcome:t})}})}function jtt(){let t;const{setFocusData:e}=Btt(),i=()=>($e.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(fS),n=()=>{t.replaceData(i())},r=i(),a=Dtt({data:r,replaceTableData:n,setFocusData:e});return(s=>{var u;oh({anchorId:SR});const l=document.getElementById(SR),c=(u=ms(l,"section"))==null?void 0:u.querySelector(".tabHeader");t=new na(l,{headerSortElement:sh(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:a,data:s}),t.on("dataFiltered",(d,p)=>{var y,I;const h=p.map(b=>b.getData().matchUp);c&&(c.innerHTML=`Matches (${h.length})`);const f=document.getElementById("wtnPredictiveAccuracy"),m=$e.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:h});(y=m==null?void 0:m.accuracy)!=null&&y.percent?(f.style.display="",f.innerHTML=`WTN ${m.accuracy.percent}%`):f.style.display=ct;const g=document.getElementById("utrPredictiveAccuracy"),v=$e.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:h});(I=v==null?void 0:v.accuracy)!=null&&I.percent?(g.style.display="",g.innerHTML=`UTR ${v.accuracy.percent}%`):g.style.display=ct})})(r),{table:t,replaceTableData:n}}const{TEAM:Gtt}=Ua;function Htt(){let t,e,i,n,r;const{table:a,replaceTableData:o}=jtt(),s=$e.getEvents().events||[],l=document.getElementById(Zz);l.style.display=ct;const c=O=>O.drawId===e,u=O=>{a==null||a.removeFilter(c),e=O,O&&(a==null||a.addFilter(c))},d={label:`<span style='font-weight: bold'>${gL}</span>`,onClick:()=>u(),close:!0},p=O=>{var x;return(x=O.drawDefinitions)==null?void 0:x.map(({drawId:F,drawName:$})=>({onClick:()=>u(F),label:$,close:!0}))},h=[d,{divider:!0}].concat(s.flatMap(p)).filter(Boolean),f=O=>O.eventId===t,m=O=>{if(a==null||a.removeFilter(f),t=O,a==null||a.removeFilter(c),e=void 0,O){a==null||a.addFilter(f);const F={options:[d,{divider:!0}].concat(p(s.find(V=>O===V.eventId))).filter(Boolean),label:gL,id:"flightOptions",modifyLabel:!0,selection:!0,location:Et},$=M2({button:F});r.flightOptions.replaceWith($),r.flightOptions=$}else r.flightOptions.style.display=ct},v=[{label:`<span style='font-weight: bold'>${ty}</span>`,onClick:()=>m(),close:!0},{divider:!0}].concat(s.map(O=>({onClick:()=>m(O.eventId),label:O.eventName,close:!0}))),y=O=>{if(n==="readyToScore")return O.scoreDetail.readyToScore&&!O.scoreDetail.score&&!O.scoreDetail.winningSide;if(n==="complete")return O.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(O.scoreDetail.matchUpStatus)},I=O=>{a==null||a.removeFilter(y),n=O,n&&(a==null||a.addFilter(y))},D=[{label:`<span style='font-weight: bold'>${YK}</span>`,onClick:()=>I(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>I("readyToScore")},{label:"Complete",close:!0,onClick:()=>I("complete")}];let w;const S=O=>{var x;return(x=O.searchText)==null?void 0:x.includes(w)},U=O=>{O||a==null||a.removeFilter(S),w=O,O&&(a==null||a.addFilter(S))},C=$e.getParticipants({participantFilters:{participantTypes:[Gtt]}}).participants||[],E=Object.assign({},...C.map(O=>({[O.participantId]:O.individualParticipantIds}))),P=O=>O.individualParticipantIds.some(x=>{var F;return(F=E[i])==null?void 0:F.includes(x)}),M=O=>{if(i&&(a==null||a.removeFilter(P)),i=O,O){a==null||a.addFilter(P);const{teamStats:x}=$e.getParticipantStats({teamParticipantId:O});if(x!=null&&x.participantName){l.style.display="";const F=HN({participantName:x.participantName,justify:"end"}),$=HN({participantName:"Opponents",justify:"start"}),V=[{side1Score:x.matchUps[0],side2Score:x.matchUps[1]}],G=zN({sets:V,sideNumber:1}),j=zN({sets:V,sideNumber:2});lo(l),l.appendChild(bSe({side1:F,side2:$,side1Score:G,side2Score:j}))}}else l.style.display=ct},R=[{label:`<span style='font-weight: bold'>${ZK}</span>`,onClick:()=>M(),close:!0},{divider:!0}].concat(C.sort((O,x)=>{var F;return(F=O==null?void 0:O.participantName)==null?void 0:F.localeCompare(x==null?void 0:x.participantName)}).map(O=>({onClick:()=>M(O.participantId),label:O.participantName,close:!0}))),A=[{onClick:()=>a==null?void 0:a.deselectRow(),label:"Schedule",stateChange:!0,location:dr},{onKeyDown:O=>O.keyCode===8&&O.target.value.length===1&&U(""),onKeyUp:O=>U(O.target.value),clearSearch:()=>{a==null||a.removeFilter(S),w="",a==null||a.removeFilter()},placeholder:"Search matches",location:Et,search:!0},{hide:v.length<3,options:v,id:"eventOptions",label:ty,modifyLabel:!0,selection:!0,location:Et},{options:h,label:gL,id:"flightOptions",modifyLabel:!0,selection:!0,location:Et,hide:!0},{hide:R.length<3,options:R,modifyLabel:!0,label:ZK,location:Et,selection:!0},{options:D,label:YK,modifyLabel:!0,selection:!0,location:Et},{onClick:()=>{cn.activeScale="wtn",o()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:vt,text:"WTN %",hide:!0},{onClick:()=>{cn.activeScale="utr",o()},id:"utrPredictiveAccuracy",intent:"is-info",location:vt,text:"UTR %",hide:!0}],_=document.getElementById(oW);r=ho({table:a,target:_,items:A}).elements}async function ztt(t,e){return $g.post("/auth/login",{password:e,email:t})}async function Wtt(t,e,i,n,r){return $g.post("/auth/register",{preferredFamilyName:t,preferredGivenName:e,inviteKey:i,password:r,email:n})}function z6(t){let e;ir({title:"Login",content:r=>e=Wr(r,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Login",intent:"is-primary",onClick:()=>{const r=e.email.value,a=e.password.value,o=s=>{!s&&Nx(),(s==null?void 0:s.status)===200&&fat({data:s.data,callback:t})};ztt(r,a).then(o,s=>console.log({err:s}))},close:!0}]})}const qtt=(t,e,i)=>{const n=Bc(),r=I8e();Owe(t,[{text:"Server connection",items:[{hide:r,text:"Connect",onClick:P6},{hide:!r,text:"Disconnect",onClick:gE},{hide:n,text:"Log in",onClick:z6},{hide:!n,text:"Log out",onClick:Nx}]}],e)};function Ktt(){const{tournamentInfo:t}=$e.getTournamentInfo(),e=Bc(),i=document.getElementById("mainMenu");i&&(i.onclick=a=>{var o;a.stopPropagation(),Ye.drawer.open({title:((o=e==null?void 0:e.provider)==null?void 0:o.providerName)||"TMX",content:qtt,width:"200px",side:vt})});const n=document.getElementById("provider");n&&(n.onclick=()=>Ye.router.navigate("/tournaments"));const r=document.getElementById("pageTitle");r&&(lo(r),r.innerHTML=`<div class='tmx-title'>${t==null?void 0:t.tournamentName}</div>`)}function LSe(t){var o;const{venueName:e,venueAbbreviation:i,addresses:n,venueId:r,courts:a}=t;return{hasLocation:(o=n==null?void 0:n[0])==null?void 0:o.longitude,courtsCount:(a==null?void 0:a.length)||0,scheduledMatchUpsCount:0,address:n==null?void 0:n[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:r,courts:a,venue:t}}function Ytt(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{headerMenu:lh({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:At,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,width:50}]}function Ztt(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{label:"Add courts",location:vt,align:vt}];e.appendChild(i);const r="1px solid #333",a=document.createElement("div");a.style.backgroundColor="white",a.style.border=r,a.style.width="99%",e.className=ok,e.style.display=ct,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(a),t.getElement().appendChild(e);const o=Ytt(),s=new na(a,{headerSortElement:sh(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:o});ho({table:s,target:i,items:n}),s.on("scrollVertical",vc),s.on("cellEdited",l=>{const c=l.getRow().getData(),u=l.getValue();if(u.length){const d=h=>{h.success?console.log("success",{result:h}):console.log({result:h})},p=[{method:a9e,params:{courtId:c.courtId,modifications:{courtName:u}}}];Pt({methods:p,callback:d})}else console.log("INVALID VALUE")})}const W6=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function Xtt(t){let e=t.split("/");if(e[2]==="www.openstreetmap.org"){let i=e.slice(4).join(",");return W6.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function Jtt(t){const i=t.split("/").reduce((o,s)=>s&&s[0]==="@"?s:o,void 0),n=i==null?void 0:i.split(","),r=n==null?void 0:n[0].slice(1),a=n==null?void 0:n[1];return{latitude:r,longitude:a}}function Qtt(t){let e=t.split(",");return W6.test(t)?{latitude:e[0],longitude:e[1]}:{}}function eit(t){let e=t.split("=");if(e.length>1){let i=e[1].split(","),n=[i[0],i[1]].join(",");return W6.test(n)?{latitude:i[0],longitude:i[1]}:{}}return{}}var nV={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,n){n(e)})($be,function(i){var n="1.9.4";function r(T){var k,B,W,X;for(B=1,W=arguments.length;B<W;B++){X=arguments[B];for(k in X)T[k]=X[k]}return T}var a=Object.create||function(){function T(){}return function(k){return T.prototype=k,new T}}();function o(T,k){var B=Array.prototype.slice;if(T.bind)return T.bind.apply(T,B.call(arguments,1));var W=B.call(arguments,2);return function(){return T.apply(k,W.length?W.concat(B.call(arguments)):arguments)}}var s=0;function l(T){return"_leaflet_id"in T||(T._leaflet_id=++s),T._leaflet_id}function c(T,k,B){var W,X,le,be;return be=function(){W=!1,X&&(le.apply(B,X),X=!1)},le=function(){W?X=arguments:(T.apply(B,arguments),setTimeout(be,k),W=!0)},le}function u(T,k,B){var W=k[1],X=k[0],le=W-X;return T===W&&B?T:((T-X)%le+le)%le+X}function d(){return!1}function p(T,k){if(k===!1)return T;var B=Math.pow(10,k===void 0?6:k);return Math.round(T*B)/B}function h(T){return T.trim?T.trim():T.replace(/^\s+|\s+$/g,"")}function f(T){return h(T).split(/\s+/)}function m(T,k){Object.prototype.hasOwnProperty.call(T,"options")||(T.options=T.options?a(T.options):{});for(var B in k)T.options[B]=k[B];return T.options}function g(T,k,B){var W=[];for(var X in T)W.push(encodeURIComponent(B?X.toUpperCase():X)+"="+encodeURIComponent(T[X]));return(!k||k.indexOf("?")===-1?"?":"&")+W.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(T,k){return T.replace(v,function(B,W){var X=k[W];if(X===void 0)throw new Error("No value provided for variable "+B);return typeof X=="function"&&(X=X(k)),X})}var I=Array.isArray||function(T){return Object.prototype.toString.call(T)==="[object Array]"};function b(T,k){for(var B=0;B<T.length;B++)if(T[B]===k)return B;return-1}var D="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function w(T){return window["webkit"+T]||window["moz"+T]||window["ms"+T]}var S=0;function U(T){var k=+new Date,B=Math.max(0,16-(k-S));return S=k+B,window.setTimeout(T,B)}var C=window.requestAnimationFrame||w("RequestAnimationFrame")||U,E=window.cancelAnimationFrame||w("CancelAnimationFrame")||w("CancelRequestAnimationFrame")||function(T){window.clearTimeout(T)};function P(T,k,B){if(B&&C===U)T.call(k);else return C.call(window,o(T,k))}function M(T){T&&E.call(window,T)}var N={__proto__:null,extend:r,create:a,bind:o,get lastId(){return s},stamp:l,throttle:c,wrapNum:u,falseFn:d,formatNum:p,trim:h,splitWords:f,setOptions:m,getParamString:g,template:y,isArray:I,indexOf:b,emptyImageUrl:D,requestFn:C,cancelFn:E,requestAnimFrame:P,cancelAnimFrame:M};function R(){}R.extend=function(T){var k=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},B=k.__super__=this.prototype,W=a(B);W.constructor=k,k.prototype=W;for(var X in this)Object.prototype.hasOwnProperty.call(this,X)&&X!=="prototype"&&X!=="__super__"&&(k[X]=this[X]);return T.statics&&r(k,T.statics),T.includes&&(A(T.includes),r.apply(null,[W].concat(T.includes))),r(W,T),delete W.statics,delete W.includes,W.options&&(W.options=B.options?a(B.options):{},r(W.options,T.options)),W._initHooks=[],W.callInitHooks=function(){if(!this._initHooksCalled){B.callInitHooks&&B.callInitHooks.call(this),this._initHooksCalled=!0;for(var le=0,be=W._initHooks.length;le<be;le++)W._initHooks[le].call(this)}},k},R.include=function(T){var k=this.prototype.options;return r(this.prototype,T),T.options&&(this.prototype.options=k,this.mergeOptions(T.options)),this},R.mergeOptions=function(T){return r(this.prototype.options,T),this},R.addInitHook=function(T){var k=Array.prototype.slice.call(arguments,1),B=typeof T=="function"?T:function(){this[T].apply(this,k)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(B),this};function A(T){if(!(typeof L>"u"||!L||!L.Mixin)){T=I(T)?T:[T];for(var k=0;k<T.length;k++)T[k]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _={on:function(T,k,B){if(typeof T=="object")for(var W in T)this._on(W,T[W],k);else{T=f(T);for(var X=0,le=T.length;X<le;X++)this._on(T[X],k,B)}return this},off:function(T,k,B){if(!arguments.length)delete this._events;else if(typeof T=="object")for(var W in T)this._off(W,T[W],k);else{T=f(T);for(var X=arguments.length===1,le=0,be=T.length;le<be;le++)X?this._off(T[le]):this._off(T[le],k,B)}return this},_on:function(T,k,B,W){if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}if(this._listens(T,k,B)===!1){B===this&&(B=void 0);var X={fn:k,ctx:B};W&&(X.once=!0),this._events=this._events||{},this._events[T]=this._events[T]||[],this._events[T].push(X)}},_off:function(T,k,B){var W,X,le;if(this._events&&(W=this._events[T],!!W)){if(arguments.length===1){if(this._firingCount)for(X=0,le=W.length;X<le;X++)W[X].fn=d;delete this._events[T];return}if(typeof k!="function"){console.warn("wrong listener type: "+typeof k);return}var be=this._listens(T,k,B);if(be!==!1){var Pe=W[be];this._firingCount&&(Pe.fn=d,this._events[T]=W=W.slice()),W.splice(be,1)}}},fire:function(T,k,B){if(!this.listens(T,B))return this;var W=r({},k,{type:T,target:this,sourceTarget:k&&k.sourceTarget||this});if(this._events){var X=this._events[T];if(X){this._firingCount=this._firingCount+1||1;for(var le=0,be=X.length;le<be;le++){var Pe=X[le],_e=Pe.fn;Pe.once&&this.off(T,_e,Pe.ctx),_e.call(Pe.ctx||this,W)}this._firingCount--}}return B&&this._propagateEvent(W),this},listens:function(T,k,B,W){typeof T!="string"&&console.warn('"string" type argument expected');var X=k;typeof k!="function"&&(W=!!k,X=void 0,B=void 0);var le=this._events&&this._events[T];if(le&&le.length&&this._listens(T,X,B)!==!1)return!0;if(W){for(var be in this._eventParents)if(this._eventParents[be].listens(T,k,B,W))return!0}return!1},_listens:function(T,k,B){if(!this._events)return!1;var W=this._events[T]||[];if(!k)return!!W.length;B===this&&(B=void 0);for(var X=0,le=W.length;X<le;X++)if(W[X].fn===k&&W[X].ctx===B)return X;return!1},once:function(T,k,B){if(typeof T=="object")for(var W in T)this._on(W,T[W],k,!0);else{T=f(T);for(var X=0,le=T.length;X<le;X++)this._on(T[X],k,B,!0)}return this},addEventParent:function(T){return this._eventParents=this._eventParents||{},this._eventParents[l(T)]=T,this},removeEventParent:function(T){return this._eventParents&&delete this._eventParents[l(T)],this},_propagateEvent:function(T){for(var k in this._eventParents)this._eventParents[k].fire(T.type,r({layer:T.target,propagatedFrom:T.target},T),!0)}};_.addEventListener=_.on,_.removeEventListener=_.clearAllEventListeners=_.off,_.addOneTimeEventListener=_.once,_.fireEvent=_.fire,_.hasEventListeners=_.listens;var O=R.extend(_);function x(T,k,B){this.x=B?Math.round(T):T,this.y=B?Math.round(k):k}var F=Math.trunc||function(T){return T>0?Math.floor(T):Math.ceil(T)};x.prototype={clone:function(){return new x(this.x,this.y)},add:function(T){return this.clone()._add($(T))},_add:function(T){return this.x+=T.x,this.y+=T.y,this},subtract:function(T){return this.clone()._subtract($(T))},_subtract:function(T){return this.x-=T.x,this.y-=T.y,this},divideBy:function(T){return this.clone()._divideBy(T)},_divideBy:function(T){return this.x/=T,this.y/=T,this},multiplyBy:function(T){return this.clone()._multiplyBy(T)},_multiplyBy:function(T){return this.x*=T,this.y*=T,this},scaleBy:function(T){return new x(this.x*T.x,this.y*T.y)},unscaleBy:function(T){return new x(this.x/T.x,this.y/T.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=F(this.x),this.y=F(this.y),this},distanceTo:function(T){T=$(T);var k=T.x-this.x,B=T.y-this.y;return Math.sqrt(k*k+B*B)},equals:function(T){return T=$(T),T.x===this.x&&T.y===this.y},contains:function(T){return T=$(T),Math.abs(T.x)<=Math.abs(this.x)&&Math.abs(T.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function $(T,k,B){return T instanceof x?T:I(T)?new x(T[0],T[1]):T==null?T:typeof T=="object"&&"x"in T&&"y"in T?new x(T.x,T.y):new x(T,k,B)}function V(T,k){if(T)for(var B=k?[T,k]:T,W=0,X=B.length;W<X;W++)this.extend(B[W])}V.prototype={extend:function(T){var k,B;if(!T)return this;if(T instanceof x||typeof T[0]=="number"||"x"in T)k=B=$(T);else if(T=G(T),k=T.min,B=T.max,!k||!B)return this;return!this.min&&!this.max?(this.min=k.clone(),this.max=B.clone()):(this.min.x=Math.min(k.x,this.min.x),this.max.x=Math.max(B.x,this.max.x),this.min.y=Math.min(k.y,this.min.y),this.max.y=Math.max(B.y,this.max.y)),this},getCenter:function(T){return $((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,T)},getBottomLeft:function(){return $(this.min.x,this.max.y)},getTopRight:function(){return $(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(T){var k,B;return typeof T[0]=="number"||T instanceof x?T=$(T):T=G(T),T instanceof V?(k=T.min,B=T.max):k=B=T,k.x>=this.min.x&&B.x<=this.max.x&&k.y>=this.min.y&&B.y<=this.max.y},intersects:function(T){T=G(T);var k=this.min,B=this.max,W=T.min,X=T.max,le=X.x>=k.x&&W.x<=B.x,be=X.y>=k.y&&W.y<=B.y;return le&&be},overlaps:function(T){T=G(T);var k=this.min,B=this.max,W=T.min,X=T.max,le=X.x>k.x&&W.x<B.x,be=X.y>k.y&&W.y<B.y;return le&&be},isValid:function(){return!!(this.min&&this.max)},pad:function(T){var k=this.min,B=this.max,W=Math.abs(k.x-B.x)*T,X=Math.abs(k.y-B.y)*T;return G($(k.x-W,k.y-X),$(B.x+W,B.y+X))},equals:function(T){return T?(T=G(T),this.min.equals(T.getTopLeft())&&this.max.equals(T.getBottomRight())):!1}};function G(T,k){return!T||T instanceof V?T:new V(T,k)}function j(T,k){if(T)for(var B=k?[T,k]:T,W=0,X=B.length;W<X;W++)this.extend(B[W])}j.prototype={extend:function(T){var k=this._southWest,B=this._northEast,W,X;if(T instanceof H)W=T,X=T;else if(T instanceof j){if(W=T._southWest,X=T._northEast,!W||!X)return this}else return T?this.extend(K(T)||z(T)):this;return!k&&!B?(this._southWest=new H(W.lat,W.lng),this._northEast=new H(X.lat,X.lng)):(k.lat=Math.min(W.lat,k.lat),k.lng=Math.min(W.lng,k.lng),B.lat=Math.max(X.lat,B.lat),B.lng=Math.max(X.lng,B.lng)),this},pad:function(T){var k=this._southWest,B=this._northEast,W=Math.abs(k.lat-B.lat)*T,X=Math.abs(k.lng-B.lng)*T;return new j(new H(k.lat-W,k.lng-X),new H(B.lat+W,B.lng+X))},getCenter:function(){return new H((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new H(this.getNorth(),this.getWest())},getSouthEast:function(){return new H(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(T){typeof T[0]=="number"||T instanceof H||"lat"in T?T=K(T):T=z(T);var k=this._southWest,B=this._northEast,W,X;return T instanceof j?(W=T.getSouthWest(),X=T.getNorthEast()):W=X=T,W.lat>=k.lat&&X.lat<=B.lat&&W.lng>=k.lng&&X.lng<=B.lng},intersects:function(T){T=z(T);var k=this._southWest,B=this._northEast,W=T.getSouthWest(),X=T.getNorthEast(),le=X.lat>=k.lat&&W.lat<=B.lat,be=X.lng>=k.lng&&W.lng<=B.lng;return le&&be},overlaps:function(T){T=z(T);var k=this._southWest,B=this._northEast,W=T.getSouthWest(),X=T.getNorthEast(),le=X.lat>k.lat&&W.lat<B.lat,be=X.lng>k.lng&&W.lng<B.lng;return le&&be},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(T,k){return T?(T=z(T),this._southWest.equals(T.getSouthWest(),k)&&this._northEast.equals(T.getNorthEast(),k)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function z(T,k){return T instanceof j?T:new j(T,k)}function H(T,k,B){if(isNaN(T)||isNaN(k))throw new Error("Invalid LatLng object: ("+T+", "+k+")");this.lat=+T,this.lng=+k,B!==void 0&&(this.alt=+B)}H.prototype={equals:function(T,k){if(!T)return!1;T=K(T);var B=Math.max(Math.abs(this.lat-T.lat),Math.abs(this.lng-T.lng));return B<=(k===void 0?1e-9:k)},toString:function(T){return"LatLng("+p(this.lat,T)+", "+p(this.lng,T)+")"},distanceTo:function(T){return Y.distance(this,K(T))},wrap:function(){return Y.wrapLatLng(this)},toBounds:function(T){var k=180*T/40075017,B=k/Math.cos(Math.PI/180*this.lat);return z([this.lat-k,this.lng-B],[this.lat+k,this.lng+B])},clone:function(){return new H(this.lat,this.lng,this.alt)}};function K(T,k,B){return T instanceof H?T:I(T)&&typeof T[0]!="object"?T.length===3?new H(T[0],T[1],T[2]):T.length===2?new H(T[0],T[1]):null:T==null?T:typeof T=="object"&&"lat"in T?new H(T.lat,"lng"in T?T.lng:T.lon,T.alt):k===void 0?null:new H(T,k,B)}var q={latLngToPoint:function(T,k){var B=this.projection.project(T),W=this.scale(k);return this.transformation._transform(B,W)},pointToLatLng:function(T,k){var B=this.scale(k),W=this.transformation.untransform(T,B);return this.projection.unproject(W)},project:function(T){return this.projection.project(T)},unproject:function(T){return this.projection.unproject(T)},scale:function(T){return 256*Math.pow(2,T)},zoom:function(T){return Math.log(T/256)/Math.LN2},getProjectedBounds:function(T){if(this.infinite)return null;var k=this.projection.bounds,B=this.scale(T),W=this.transformation.transform(k.min,B),X=this.transformation.transform(k.max,B);return new V(W,X)},infinite:!1,wrapLatLng:function(T){var k=this.wrapLng?u(T.lng,this.wrapLng,!0):T.lng,B=this.wrapLat?u(T.lat,this.wrapLat,!0):T.lat,W=T.alt;return new H(B,k,W)},wrapLatLngBounds:function(T){var k=T.getCenter(),B=this.wrapLatLng(k),W=k.lat-B.lat,X=k.lng-B.lng;if(W===0&&X===0)return T;var le=T.getSouthWest(),be=T.getNorthEast(),Pe=new H(le.lat-W,le.lng-X),_e=new H(be.lat-W,be.lng-X);return new j(Pe,_e)}},Y=r({},q,{wrapLng:[-180,180],R:6371e3,distance:function(T,k){var B=Math.PI/180,W=T.lat*B,X=k.lat*B,le=Math.sin((k.lat-T.lat)*B/2),be=Math.sin((k.lng-T.lng)*B/2),Pe=le*le+Math.cos(W)*Math.cos(X)*be*be,_e=2*Math.atan2(Math.sqrt(Pe),Math.sqrt(1-Pe));return this.R*_e}}),Z=6378137,Q={R:Z,MAX_LATITUDE:85.0511287798,project:function(T){var k=Math.PI/180,B=this.MAX_LATITUDE,W=Math.max(Math.min(B,T.lat),-B),X=Math.sin(W*k);return new x(this.R*T.lng*k,this.R*Math.log((1+X)/(1-X))/2)},unproject:function(T){var k=180/Math.PI;return new H((2*Math.atan(Math.exp(T.y/this.R))-Math.PI/2)*k,T.x*k/this.R)},bounds:function(){var T=Z*Math.PI;return new V([-T,-T],[T,T])}()};function ie(T,k,B,W){if(I(T)){this._a=T[0],this._b=T[1],this._c=T[2],this._d=T[3];return}this._a=T,this._b=k,this._c=B,this._d=W}ie.prototype={transform:function(T,k){return this._transform(T.clone(),k)},_transform:function(T,k){return k=k||1,T.x=k*(this._a*T.x+this._b),T.y=k*(this._c*T.y+this._d),T},untransform:function(T,k){return k=k||1,new x((T.x/k-this._b)/this._a,(T.y/k-this._d)/this._c)}};function ue(T,k,B,W){return new ie(T,k,B,W)}var J=r({},Y,{code:"EPSG:3857",projection:Q,transformation:function(){var T=.5/(Math.PI*Q.R);return ue(T,.5,-T,.5)}()}),te=r({},J,{code:"EPSG:900913"});function se(T){return document.createElementNS("http://www.w3.org/2000/svg",T)}function ee(T,k){var B="",W,X,le,be,Pe,_e;for(W=0,le=T.length;W<le;W++){for(Pe=T[W],X=0,be=Pe.length;X<be;X++)_e=Pe[X],B+=(X?"L":"M")+_e.x+" "+_e.y;B+=k?yt.svg?"z":"x":""}return B||"M0 0"}var ce=document.documentElement.style,fe="ActiveXObject"in window,ge=fe&&!document.addEventListener,he="msLaunchUri"in navigator&&!("documentMode"in document),Se=Kn("webkit"),Ce=Kn("android"),Fe=Kn("android 2")||Kn("android 3"),Je=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),xe=Ce&&Kn("Google")&&Je<537&&!("AudioNode"in window),st=!!window.opera,we=!he&&Kn("chrome"),Oe=Kn("gecko")&&!Se&&!st&&!fe,ye=!we&&Kn("safari"),Be=Kn("phantom"),Ee="OTransition"in ce,qe=navigator.platform.indexOf("Win")===0,Ge=fe&&"transition"in ce,me="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Fe,Me="MozPerspective"in ce,De=!window.L_DISABLE_3D&&(Ge||me||Me)&&!Ee&&!Be,Ae=typeof orientation<"u"||Kn("mobile"),ze=Ae&&Se,de=Ae&&me,pe=!window.PointerEvent&&window.MSPointerEvent,ke=!!(window.PointerEvent||pe),Ue="ontouchstart"in window||!!window.TouchEvent,Te=!window.L_NO_TOUCH&&(Ue||ke),rt=Ae&&st,je=Ae&&Oe,Le=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,It=function(){var T=!1;try{var k=Object.defineProperty({},"passive",{get:function(){T=!0}});window.addEventListener("testPassiveEventSupport",d,k),window.removeEventListener("testPassiveEventSupport",d,k)}catch{}return T}(),zt=function(){return!!document.createElement("canvas").getContext}(),Jt=!!(document.createElementNS&&se("svg").createSVGRect),Yr=!!Jt&&function(){var T=document.createElement("div");return T.innerHTML="<svg/>",(T.firstChild&&T.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Eo=!Jt&&function(){try{var T=document.createElement("div");T.innerHTML='<v:shape adj="1"/>';var k=T.firstChild;return k.style.behavior="url(#default#VML)",k&&typeof k.adj=="object"}catch{return!1}}(),Qt=navigator.platform.indexOf("Mac")===0,yr=navigator.platform.indexOf("Linux")===0;function Kn(T){return navigator.userAgent.toLowerCase().indexOf(T)>=0}var yt={ie:fe,ielt9:ge,edge:he,webkit:Se,android:Ce,android23:Fe,androidStock:xe,opera:st,chrome:we,gecko:Oe,safari:ye,phantom:Be,opera12:Ee,win:qe,ie3d:Ge,webkit3d:me,gecko3d:Me,any3d:De,mobile:Ae,mobileWebkit:ze,mobileWebkit3d:de,msPointer:pe,pointer:ke,touch:Te,touchNative:Ue,mobileOpera:rt,mobileGecko:je,retina:Le,passiveEvents:It,canvas:zt,svg:Jt,vml:Eo,inlineSvg:Yr,mac:Qt,linux:yr},cr=yt.msPointer?"MSPointerDown":"pointerdown",Jo=yt.msPointer?"MSPointerMove":"pointermove",Qo=yt.msPointer?"MSPointerUp":"pointerup",vo=yt.msPointer?"MSPointerCancel":"pointercancel",Od={touchstart:cr,touchmove:Jo,touchend:Qo,touchcancel:vo},Aa={touchstart:di,touchmove:to,touchend:to,touchcancel:to},es={},Ql=!1;function Vg(T,k,B){return k==="touchstart"&&tc(),Aa[k]?(B=Aa[k].bind(this,B),T.addEventListener(Od[k],B,!1),B):(console.warn("wrong event specified:",k),d)}function uh(T,k,B){if(!Od[k]){console.warn("wrong event specified:",k);return}T.removeEventListener(Od[k],B,!1)}function Ru(T){es[T.pointerId]=T}function Nu(T){es[T.pointerId]&&(es[T.pointerId]=T)}function ec(T){delete es[T.pointerId]}function tc(){Ql||(document.addEventListener(cr,Ru,!0),document.addEventListener(Jo,Nu,!0),document.addEventListener(Qo,ec,!0),document.addEventListener(vo,ec,!0),Ql=!0)}function to(T,k){if(k.pointerType!==(k.MSPOINTER_TYPE_MOUSE||"mouse")){k.touches=[];for(var B in es)k.touches.push(es[B]);k.changedTouches=[k],T(k)}}function di(T,k){k.MSPOINTER_TYPE_TOUCH&&k.pointerType===k.MSPOINTER_TYPE_TOUCH&&Mo(k),to(T,k)}function jf(T){var k={},B,W;for(W in T)B=T[W],k[W]=B&&B.bind?B.bind(T):B;return T=k,k.type="dblclick",k.detail=2,k.isTrusted=!1,k._simulated=!0,k}var Gf=200;function Hf(T,k){T.addEventListener("dblclick",k);var B=0,W;function X(le){if(le.detail!==1){W=le.detail;return}if(!(le.pointerType==="mouse"||le.sourceCapabilities&&!le.sourceCapabilities.firesTouchEvents)){var be=o7(le);if(!(be.some(function(_e){return _e instanceof HTMLLabelElement&&_e.attributes.for})&&!be.some(function(_e){return _e instanceof HTMLInputElement||_e instanceof HTMLSelectElement}))){var Pe=Date.now();Pe-B<=Gf?(W++,W===2&&k(jf(le))):W=1,B=Pe}}}return T.addEventListener("click",X),{dblclick:k,simDblclick:X}}function We(T,k){T.removeEventListener("dblclick",k.dblclick),T.removeEventListener("click",k.simDblclick)}var Xt=Ii(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),Yn=Ii(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Da=Yn==="webkitTransition"||Yn==="OTransition"?Yn+"End":"transitionend";function ic(T){return typeof T=="string"?document.getElementById(T):T}function Au(T,k){var B=T.style[k]||T.currentStyle&&T.currentStyle[k];if((!B||B==="auto")&&document.defaultView){var W=document.defaultView.getComputedStyle(T,null);B=W?W[k]:null}return B==="auto"?null:B}function sn(T,k,B){var W=document.createElement(T);return W.className=k||"",B&&B.appendChild(W),W}function nr(T){var k=T.parentNode;k&&k.removeChild(T)}function dh(T){for(;T.firstChild;)T.removeChild(T.firstChild)}function _u(T){var k=T.parentNode;k&&k.lastChild!==T&&k.appendChild(T)}function sl(T){var k=T.parentNode;k&&k.firstChild!==T&&k.insertBefore(T,k.firstChild)}function ln(T,k){if(T.classList!==void 0)return T.classList.contains(k);var B=br(T);return B.length>0&&new RegExp("(^|\\s)"+k+"(\\s|$)").test(B)}function yi(T,k){if(T.classList!==void 0)for(var B=f(k),W=0,X=B.length;W<X;W++)T.classList.add(B[W]);else if(!ln(T,k)){var le=br(T);pi(T,(le?le+" ":"")+k)}}function Ir(T,k){T.classList!==void 0?T.classList.remove(k):pi(T,h((" "+br(T)+" ").replace(" "+k+" "," ")))}function pi(T,k){T.className.baseVal===void 0?T.className=k:T.className.baseVal=k}function br(T){return T.correspondingElement&&(T=T.correspondingElement),T.className.baseVal===void 0?T.className:T.className.baseVal}function lt(T,k){"opacity"in T.style?T.style.opacity=k:"filter"in T.style&&_t(T,k)}function _t(T,k){var B=!1,W="DXImageTransform.Microsoft.Alpha";try{B=T.filters.item(W)}catch{if(k===1)return}k=Math.round(k*100),B?(B.Enabled=k!==100,B.Opacity=k):T.style.filter+=" progid:"+W+"(opacity="+k+")"}function Ii(T){for(var k=document.documentElement.style,B=0;B<T.length;B++)if(T[B]in k)return T[B];return!1}function dn(T,k,B){var W=k||new x(0,0);T.style[Xt]=(yt.ie3d?"translate("+W.x+"px,"+W.y+"px)":"translate3d("+W.x+"px,"+W.y+"px,0)")+(B?" scale("+B+")":"")}function Nt(T,k){T._leaflet_pos=k,yt.any3d?dn(T,k):(T.style.left=k.x+"px",T.style.top=k.y+"px")}function Ri(T){return T._leaflet_pos||new x(0,0)}var pa,nc,rc;if("onselectstart"in document)pa=function(){ki(window,"selectstart",Mo)},nc=function(){wr(window,"selectstart",Mo)};else{var xd=Ii(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);pa=function(){if(xd){var T=document.documentElement.style;rc=T[xd],T[xd]="none"}},nc=function(){xd&&(document.documentElement.style[xd]=rc,rc=void 0)}}function zf(){ki(window,"dragstart",Mo)}function Wf(){wr(window,"dragstart",Mo)}var qf,kx;function Ox(T){for(;T.tabIndex===-1;)T=T.parentNode;T.style&&(TE(),qf=T,kx=T.style.outlineStyle,T.style.outlineStyle="none",ki(window,"keydown",TE))}function TE(){qf&&(qf.style.outlineStyle=kx,qf=void 0,kx=void 0,wr(window,"keydown",TE))}function r7(T){do T=T.parentNode;while((!T.offsetWidth||!T.offsetHeight)&&T!==document.body);return T}function xx(T){var k=T.getBoundingClientRect();return{x:k.width/T.offsetWidth||1,y:k.height/T.offsetHeight||1,boundingClientRect:k}}var HTe={__proto__:null,TRANSFORM:Xt,TRANSITION:Yn,TRANSITION_END:Da,get:ic,getStyle:Au,create:sn,remove:nr,empty:dh,toFront:_u,toBack:sl,hasClass:ln,addClass:yi,removeClass:Ir,setClass:pi,getClass:br,setOpacity:lt,testProp:Ii,setTransform:dn,setPosition:Nt,getPosition:Ri,get disableTextSelection(){return pa},get enableTextSelection(){return nc},disableImageDrag:zf,enableImageDrag:Wf,preventOutline:Ox,restoreOutline:TE,getSizedParentNode:r7,getScale:xx};function ki(T,k,B,W){if(k&&typeof k=="object")for(var X in k)Fx(T,X,k[X],B);else{k=f(k);for(var le=0,be=k.length;le<be;le++)Fx(T,k[le],B,W)}return this}var Ld="_leaflet_events";function wr(T,k,B,W){if(arguments.length===1)a7(T),delete T[Ld];else if(k&&typeof k=="object")for(var X in k)$x(T,X,k[X],B);else if(k=f(k),arguments.length===2)a7(T,function(Pe){return b(k,Pe)!==-1});else for(var le=0,be=k.length;le<be;le++)$x(T,k[le],B,W);return this}function a7(T,k){for(var B in T[Ld]){var W=B.split(/\d/)[0];(!k||k(W))&&$x(T,W,null,null,B)}}var Lx={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Fx(T,k,B,W){var X=k+l(B)+(W?"_"+l(W):"");if(T[Ld]&&T[Ld][X])return this;var le=function(Pe){return B.call(W||T,Pe||window.event)},be=le;!yt.touchNative&&yt.pointer&&k.indexOf("touch")===0?le=Vg(T,k,le):yt.touch&&k==="dblclick"?le=Hf(T,le):"addEventListener"in T?k==="touchstart"||k==="touchmove"||k==="wheel"||k==="mousewheel"?T.addEventListener(Lx[k]||k,le,yt.passiveEvents?{passive:!1}:!1):k==="mouseenter"||k==="mouseleave"?(le=function(Pe){Pe=Pe||window.event,Vx(T,Pe)&&be(Pe)},T.addEventListener(Lx[k],le,!1)):T.addEventListener(k,be,!1):T.attachEvent("on"+k,le),T[Ld]=T[Ld]||{},T[Ld][X]=le}function $x(T,k,B,W,X){X=X||k+l(B)+(W?"_"+l(W):"");var le=T[Ld]&&T[Ld][X];if(!le)return this;!yt.touchNative&&yt.pointer&&k.indexOf("touch")===0?uh(T,k,le):yt.touch&&k==="dblclick"?We(T,le):"removeEventListener"in T?T.removeEventListener(Lx[k]||k,le,!1):T.detachEvent("on"+k,le),T[Ld][X]=null}function jg(T){return T.stopPropagation?T.stopPropagation():T.originalEvent?T.originalEvent._stopped=!0:T.cancelBubble=!0,this}function Bx(T){return Fx(T,"wheel",jg),this}function yS(T){return ki(T,"mousedown touchstart dblclick contextmenu",jg),T._leaflet_disable_click=!0,this}function Mo(T){return T.preventDefault?T.preventDefault():T.returnValue=!1,this}function Gg(T){return Mo(T),jg(T),this}function o7(T){if(T.composedPath)return T.composedPath();for(var k=[],B=T.target;B;)k.push(B),B=B.parentNode;return k}function s7(T,k){if(!k)return new x(T.clientX,T.clientY);var B=xx(k),W=B.boundingClientRect;return new x((T.clientX-W.left)/B.x-k.clientLeft,(T.clientY-W.top)/B.y-k.clientTop)}var zTe=yt.linux&&yt.chrome?window.devicePixelRatio:yt.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function l7(T){return yt.edge?T.wheelDeltaY/2:T.deltaY&&T.deltaMode===0?-T.deltaY/zTe:T.deltaY&&T.deltaMode===1?-T.deltaY*20:T.deltaY&&T.deltaMode===2?-T.deltaY*60:T.deltaX||T.deltaZ?0:T.wheelDelta?(T.wheelDeltaY||T.wheelDelta)/2:T.detail&&Math.abs(T.detail)<32765?-T.detail*20:T.detail?T.detail/-32765*60:0}function Vx(T,k){var B=k.relatedTarget;if(!B)return!0;try{for(;B&&B!==T;)B=B.parentNode}catch{return!1}return B!==T}var WTe={__proto__:null,on:ki,off:wr,stopPropagation:jg,disableScrollPropagation:Bx,disableClickPropagation:yS,preventDefault:Mo,stop:Gg,getPropagationPath:o7,getMousePosition:s7,getWheelDelta:l7,isExternalTarget:Vx,addListener:ki,removeListener:wr},c7=O.extend({run:function(T,k,B,W){this.stop(),this._el=T,this._inProgress=!0,this._duration=B||.25,this._easeOutPower=1/Math.max(W||.5,.2),this._startPos=Ri(T),this._offset=k.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=P(this._animate,this),this._step()},_step:function(T){var k=+new Date-this._startTime,B=this._duration*1e3;k<B?this._runFrame(this._easeOut(k/B),T):(this._runFrame(1),this._complete())},_runFrame:function(T,k){var B=this._startPos.add(this._offset.multiplyBy(T));k&&B._round(),Nt(this._el,B),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(T){return 1-Math.pow(1-T,this._easeOutPower)}}),vn=O.extend({options:{crs:J,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(T,k){k=m(this,k),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(T),this._initLayout(),this._onResize=o(this._onResize,this),this._initEvents(),k.maxBounds&&this.setMaxBounds(k.maxBounds),k.zoom!==void 0&&(this._zoom=this._limitZoom(k.zoom)),k.center&&k.zoom!==void 0&&this.setView(K(k.center),k.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=Yn&&yt.any3d&&!yt.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),ki(this._proxy,Da,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(T,k,B){if(k=k===void 0?this._zoom:this._limitZoom(k),T=this._limitCenter(K(T),k,this.options.maxBounds),B=B||{},this._stop(),this._loaded&&!B.reset&&B!==!0){B.animate!==void 0&&(B.zoom=r({animate:B.animate},B.zoom),B.pan=r({animate:B.animate,duration:B.duration},B.pan));var W=this._zoom!==k?this._tryAnimatedZoom&&this._tryAnimatedZoom(T,k,B.zoom):this._tryAnimatedPan(T,B.pan);if(W)return clearTimeout(this._sizeTimer),this}return this._resetView(T,k,B.pan&&B.pan.noMoveStart),this},setZoom:function(T,k){return this._loaded?this.setView(this.getCenter(),T,{zoom:k}):(this._zoom=T,this)},zoomIn:function(T,k){return T=T||(yt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+T,k)},zoomOut:function(T,k){return T=T||(yt.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-T,k)},setZoomAround:function(T,k,B){var W=this.getZoomScale(k),X=this.getSize().divideBy(2),le=T instanceof x?T:this.latLngToContainerPoint(T),be=le.subtract(X).multiplyBy(1-1/W),Pe=this.containerPointToLatLng(X.add(be));return this.setView(Pe,k,{zoom:B})},_getBoundsCenterZoom:function(T,k){k=k||{},T=T.getBounds?T.getBounds():z(T);var B=$(k.paddingTopLeft||k.padding||[0,0]),W=$(k.paddingBottomRight||k.padding||[0,0]),X=this.getBoundsZoom(T,!1,B.add(W));if(X=typeof k.maxZoom=="number"?Math.min(k.maxZoom,X):X,X===1/0)return{center:T.getCenter(),zoom:X};var le=W.subtract(B).divideBy(2),be=this.project(T.getSouthWest(),X),Pe=this.project(T.getNorthEast(),X),_e=this.unproject(be.add(Pe).divideBy(2).add(le),X);return{center:_e,zoom:X}},fitBounds:function(T,k){if(T=z(T),!T.isValid())throw new Error("Bounds are not valid.");var B=this._getBoundsCenterZoom(T,k);return this.setView(B.center,B.zoom,k)},fitWorld:function(T){return this.fitBounds([[-90,-180],[90,180]],T)},panTo:function(T,k){return this.setView(T,this._zoom,{pan:k})},panBy:function(T,k){if(T=$(T).round(),k=k||{},!T.x&&!T.y)return this.fire("moveend");if(k.animate!==!0&&!this.getSize().contains(T))return this._resetView(this.unproject(this.project(this.getCenter()).add(T)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new c7,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),k.noMoveStart||this.fire("movestart"),k.animate!==!1){yi(this._mapPane,"leaflet-pan-anim");var B=this._getMapPanePos().subtract(T).round();this._panAnim.run(this._mapPane,B,k.duration||.25,k.easeLinearity)}else this._rawPanBy(T),this.fire("move").fire("moveend");return this},flyTo:function(T,k,B){if(B=B||{},B.animate===!1||!yt.any3d)return this.setView(T,k,B);this._stop();var W=this.project(this.getCenter()),X=this.project(T),le=this.getSize(),be=this._zoom;T=K(T),k=k===void 0?be:k;var Pe=Math.max(le.x,le.y),_e=Pe*this.getZoomScale(be,k),Ke=X.distanceTo(W)||1,bt=1.42,ii=bt*bt;function en(_a){var OE=_a?-1:1,kUe=_a?_e:Pe,OUe=_e*_e-Pe*Pe+OE*ii*ii*Ke*Ke,xUe=2*kUe*ii*Ke,Jx=OUe/xUe,G7=Math.sqrt(Jx*Jx+1)-Jx,LUe=G7<1e-9?-18:Math.log(G7);return LUe}function Ts(_a){return(Math.exp(_a)-Math.exp(-_a))/2}function yo(_a){return(Math.exp(_a)+Math.exp(-_a))/2}function jc(_a){return Ts(_a)/yo(_a)}var ll=en(0);function LI(_a){return Pe*(yo(ll)/yo(ll+bt*_a))}function RUe(_a){return Pe*(yo(ll)*jc(ll+bt*_a)-Ts(ll))/ii}function NUe(_a){return 1-Math.pow(1-_a,1.5)}var AUe=Date.now(),V7=(en(1)-ll)/bt,_Ue=B.duration?1e3*B.duration:1e3*V7*.8;function j7(){var _a=(Date.now()-AUe)/_Ue,OE=NUe(_a)*V7;_a<=1?(this._flyToFrame=P(j7,this),this._move(this.unproject(W.add(X.subtract(W).multiplyBy(RUe(OE)/Ke)),be),this.getScaleZoom(Pe/LI(OE),be),{flyTo:!0})):this._move(T,k)._moveEnd(!0)}return this._moveStart(!0,B.noMoveStart),j7.call(this),this},flyToBounds:function(T,k){var B=this._getBoundsCenterZoom(T,k);return this.flyTo(B.center,B.zoom,k)},setMaxBounds:function(T){return T=z(T),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),T.isValid()?(this.options.maxBounds=T,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(T){var k=this.options.minZoom;return this.options.minZoom=T,this._loaded&&k!==T&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(T):this},setMaxZoom:function(T){var k=this.options.maxZoom;return this.options.maxZoom=T,this._loaded&&k!==T&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(T):this},panInsideBounds:function(T,k){this._enforcingBounds=!0;var B=this.getCenter(),W=this._limitCenter(B,this._zoom,z(T));return B.equals(W)||this.panTo(W,k),this._enforcingBounds=!1,this},panInside:function(T,k){k=k||{};var B=$(k.paddingTopLeft||k.padding||[0,0]),W=$(k.paddingBottomRight||k.padding||[0,0]),X=this.project(this.getCenter()),le=this.project(T),be=this.getPixelBounds(),Pe=G([be.min.add(B),be.max.subtract(W)]),_e=Pe.getSize();if(!Pe.contains(le)){this._enforcingBounds=!0;var Ke=le.subtract(Pe.getCenter()),bt=Pe.extend(le).getSize().subtract(_e);X.x+=Ke.x<0?-bt.x:bt.x,X.y+=Ke.y<0?-bt.y:bt.y,this.panTo(this.unproject(X),k),this._enforcingBounds=!1}return this},invalidateSize:function(T){if(!this._loaded)return this;T=r({animate:!1,pan:!0},T===!0?{animate:!0}:T);var k=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var B=this.getSize(),W=k.divideBy(2).round(),X=B.divideBy(2).round(),le=W.subtract(X);return!le.x&&!le.y?this:(T.animate&&T.pan?this.panBy(le):(T.pan&&this._rawPanBy(le),this.fire("move"),T.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(o(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:k,newSize:B}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(T){if(T=this._locateOptions=r({timeout:1e4,watch:!1},T),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var k=o(this._handleGeolocationResponse,this),B=o(this._handleGeolocationError,this);return T.watch?this._locationWatchId=navigator.geolocation.watchPosition(k,B,T):navigator.geolocation.getCurrentPosition(k,B,T),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(T){if(this._container._leaflet_id){var k=T.code,B=T.message||(k===1?"permission denied":k===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:k,message:"Geolocation error: "+B+"."})}},_handleGeolocationResponse:function(T){if(this._container._leaflet_id){var k=T.coords.latitude,B=T.coords.longitude,W=new H(k,B),X=W.toBounds(T.coords.accuracy*2),le=this._locateOptions;if(le.setView){var be=this.getBoundsZoom(X);this.setView(W,le.maxZoom?Math.min(be,le.maxZoom):be)}var Pe={latlng:W,bounds:X,timestamp:T.timestamp};for(var _e in T.coords)typeof T.coords[_e]=="number"&&(Pe[_e]=T.coords[_e]);this.fire("locationfound",Pe)}},addHandler:function(T,k){if(!k)return this;var B=this[T]=new k(this);return this._handlers.push(B),this.options[T]&&B.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),nr(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var T;for(T in this._layers)this._layers[T].remove();for(T in this._panes)nr(this._panes[T]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(T,k){var B="leaflet-pane"+(T?" leaflet-"+T.replace("Pane","")+"-pane":""),W=sn("div",B,k||this._mapPane);return T&&(this._panes[T]=W),W},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var T=this.getPixelBounds(),k=this.unproject(T.getBottomLeft()),B=this.unproject(T.getTopRight());return new j(k,B)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(T,k,B){T=z(T),B=$(B||[0,0]);var W=this.getZoom()||0,X=this.getMinZoom(),le=this.getMaxZoom(),be=T.getNorthWest(),Pe=T.getSouthEast(),_e=this.getSize().subtract(B),Ke=G(this.project(Pe,W),this.project(be,W)).getSize(),bt=yt.any3d?this.options.zoomSnap:1,ii=_e.x/Ke.x,en=_e.y/Ke.y,Ts=k?Math.max(ii,en):Math.min(ii,en);return W=this.getScaleZoom(Ts,W),bt&&(W=Math.round(W/(bt/100))*(bt/100),W=k?Math.ceil(W/bt)*bt:Math.floor(W/bt)*bt),Math.max(X,Math.min(le,W))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new x(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(T,k){var B=this._getTopLeftPoint(T,k);return new V(B,B.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(T){return this.options.crs.getProjectedBounds(T===void 0?this.getZoom():T)},getPane:function(T){return typeof T=="string"?this._panes[T]:T},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(T,k){var B=this.options.crs;return k=k===void 0?this._zoom:k,B.scale(T)/B.scale(k)},getScaleZoom:function(T,k){var B=this.options.crs;k=k===void 0?this._zoom:k;var W=B.zoom(T*B.scale(k));return isNaN(W)?1/0:W},project:function(T,k){return k=k===void 0?this._zoom:k,this.options.crs.latLngToPoint(K(T),k)},unproject:function(T,k){return k=k===void 0?this._zoom:k,this.options.crs.pointToLatLng($(T),k)},layerPointToLatLng:function(T){var k=$(T).add(this.getPixelOrigin());return this.unproject(k)},latLngToLayerPoint:function(T){var k=this.project(K(T))._round();return k._subtract(this.getPixelOrigin())},wrapLatLng:function(T){return this.options.crs.wrapLatLng(K(T))},wrapLatLngBounds:function(T){return this.options.crs.wrapLatLngBounds(z(T))},distance:function(T,k){return this.options.crs.distance(K(T),K(k))},containerPointToLayerPoint:function(T){return $(T).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(T){return $(T).add(this._getMapPanePos())},containerPointToLatLng:function(T){var k=this.containerPointToLayerPoint($(T));return this.layerPointToLatLng(k)},latLngToContainerPoint:function(T){return this.layerPointToContainerPoint(this.latLngToLayerPoint(K(T)))},mouseEventToContainerPoint:function(T){return s7(T,this._container)},mouseEventToLayerPoint:function(T){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(T))},mouseEventToLatLng:function(T){return this.layerPointToLatLng(this.mouseEventToLayerPoint(T))},_initContainer:function(T){var k=this._container=ic(T);if(k){if(k._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");ki(k,"scroll",this._onScroll,this),this._containerId=l(k)},_initLayout:function(){var T=this._container;this._fadeAnimated=this.options.fadeAnimation&&yt.any3d,yi(T,"leaflet-container"+(yt.touch?" leaflet-touch":"")+(yt.retina?" leaflet-retina":"")+(yt.ielt9?" leaflet-oldie":"")+(yt.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var k=Au(T,"position");k!=="absolute"&&k!=="relative"&&k!=="fixed"&&k!=="sticky"&&(T.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var T=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Nt(this._mapPane,new x(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(yi(T.markerPane,"leaflet-zoom-hide"),yi(T.shadowPane,"leaflet-zoom-hide"))},_resetView:function(T,k,B){Nt(this._mapPane,new x(0,0));var W=!this._loaded;this._loaded=!0,k=this._limitZoom(k),this.fire("viewprereset");var X=this._zoom!==k;this._moveStart(X,B)._move(T,k)._moveEnd(X),this.fire("viewreset"),W&&this.fire("load")},_moveStart:function(T,k){return T&&this.fire("zoomstart"),k||this.fire("movestart"),this},_move:function(T,k,B,W){k===void 0&&(k=this._zoom);var X=this._zoom!==k;return this._zoom=k,this._lastCenter=T,this._pixelOrigin=this._getNewPixelOrigin(T),W?B&&B.pinch&&this.fire("zoom",B):((X||B&&B.pinch)&&this.fire("zoom",B),this.fire("move",B)),this},_moveEnd:function(T){return T&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(T){Nt(this._mapPane,this._getMapPanePos().subtract(T))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(T){this._targets={},this._targets[l(this._container)]=this;var k=T?wr:ki;k(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&k(window,"resize",this._onResize,this),yt.any3d&&this.options.transform3DLimit&&(T?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=P(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var T=this._getMapPanePos();Math.max(Math.abs(T.x),Math.abs(T.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(T,k){for(var B=[],W,X=k==="mouseout"||k==="mouseover",le=T.target||T.srcElement,be=!1;le;){if(W=this._targets[l(le)],W&&(k==="click"||k==="preclick")&&this._draggableMoved(W)){be=!0;break}if(W&&W.listens(k,!0)&&(X&&!Vx(le,T)||(B.push(W),X))||le===this._container)break;le=le.parentNode}return!B.length&&!be&&!X&&this.listens(k,!0)&&(B=[this]),B},_isClickDisabled:function(T){for(;T&&T!==this._container;){if(T._leaflet_disable_click)return!0;T=T.parentNode}},_handleDOMEvent:function(T){var k=T.target||T.srcElement;if(!(!this._loaded||k._leaflet_disable_events||T.type==="click"&&this._isClickDisabled(k))){var B=T.type;B==="mousedown"&&Ox(k),this._fireDOMEvent(T,B)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(T,k,B){if(T.type==="click"){var W=r({},T);W.type="preclick",this._fireDOMEvent(W,W.type,B)}var X=this._findEventTargets(T,k);if(B){for(var le=[],be=0;be<B.length;be++)B[be].listens(k,!0)&&le.push(B[be]);X=le.concat(X)}if(X.length){k==="contextmenu"&&Mo(T);var Pe=X[0],_e={originalEvent:T};if(T.type!=="keypress"&&T.type!=="keydown"&&T.type!=="keyup"){var Ke=Pe.getLatLng&&(!Pe._radius||Pe._radius<=10);_e.containerPoint=Ke?this.latLngToContainerPoint(Pe.getLatLng()):this.mouseEventToContainerPoint(T),_e.layerPoint=this.containerPointToLayerPoint(_e.containerPoint),_e.latlng=Ke?Pe.getLatLng():this.layerPointToLatLng(_e.layerPoint)}for(be=0;be<X.length;be++)if(X[be].fire(k,_e,!0),_e.originalEvent._stopped||X[be].options.bubblingMouseEvents===!1&&b(this._mouseEvents,k)!==-1)return}},_draggableMoved:function(T){return T=T.dragging&&T.dragging.enabled()?T:this,T.dragging&&T.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var T=0,k=this._handlers.length;T<k;T++)this._handlers[T].disable()},whenReady:function(T,k){return this._loaded?T.call(k||this,{target:this}):this.on("load",T,k),this},_getMapPanePos:function(){return Ri(this._mapPane)||new x(0,0)},_moved:function(){var T=this._getMapPanePos();return T&&!T.equals([0,0])},_getTopLeftPoint:function(T,k){var B=T&&k!==void 0?this._getNewPixelOrigin(T,k):this.getPixelOrigin();return B.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(T,k){var B=this.getSize()._divideBy(2);return this.project(T,k)._subtract(B)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(T,k,B){var W=this._getNewPixelOrigin(B,k);return this.project(T,k)._subtract(W)},_latLngBoundsToNewLayerBounds:function(T,k,B){var W=this._getNewPixelOrigin(B,k);return G([this.project(T.getSouthWest(),k)._subtract(W),this.project(T.getNorthWest(),k)._subtract(W),this.project(T.getSouthEast(),k)._subtract(W),this.project(T.getNorthEast(),k)._subtract(W)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(T){return this.latLngToLayerPoint(T).subtract(this._getCenterLayerPoint())},_limitCenter:function(T,k,B){if(!B)return T;var W=this.project(T,k),X=this.getSize().divideBy(2),le=new V(W.subtract(X),W.add(X)),be=this._getBoundsOffset(le,B,k);return Math.abs(be.x)<=1&&Math.abs(be.y)<=1?T:this.unproject(W.add(be),k)},_limitOffset:function(T,k){if(!k)return T;var B=this.getPixelBounds(),W=new V(B.min.add(T),B.max.add(T));return T.add(this._getBoundsOffset(W,k))},_getBoundsOffset:function(T,k,B){var W=G(this.project(k.getNorthEast(),B),this.project(k.getSouthWest(),B)),X=W.min.subtract(T.min),le=W.max.subtract(T.max),be=this._rebound(X.x,-le.x),Pe=this._rebound(X.y,-le.y);return new x(be,Pe)},_rebound:function(T,k){return T+k>0?Math.round(T-k)/2:Math.max(0,Math.ceil(T))-Math.max(0,Math.floor(k))},_limitZoom:function(T){var k=this.getMinZoom(),B=this.getMaxZoom(),W=yt.any3d?this.options.zoomSnap:1;return W&&(T=Math.round(T/W)*W),Math.max(k,Math.min(B,T))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Ir(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(T,k){var B=this._getCenterOffset(T)._trunc();return(k&&k.animate)!==!0&&!this.getSize().contains(B)?!1:(this.panBy(B,k),!0)},_createAnimProxy:function(){var T=this._proxy=sn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(T),this.on("zoomanim",function(k){var B=Xt,W=this._proxy.style[B];dn(this._proxy,this.project(k.center,k.zoom),this.getZoomScale(k.zoom,1)),W===this._proxy.style[B]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){nr(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var T=this.getCenter(),k=this.getZoom();dn(this._proxy,this.project(T,k),this.getZoomScale(k,1))},_catchTransitionEnd:function(T){this._animatingZoom&&T.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(T,k,B){if(this._animatingZoom)return!0;if(B=B||{},!this._zoomAnimated||B.animate===!1||this._nothingToAnimate()||Math.abs(k-this._zoom)>this.options.zoomAnimationThreshold)return!1;var W=this.getZoomScale(k),X=this._getCenterOffset(T)._divideBy(1-1/W);return B.animate!==!0&&!this.getSize().contains(X)?!1:(P(function(){this._moveStart(!0,B.noMoveStart||!1)._animateZoom(T,k,!0)},this),!0)},_animateZoom:function(T,k,B,W){this._mapPane&&(B&&(this._animatingZoom=!0,this._animateToCenter=T,this._animateToZoom=k,yi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:T,zoom:k,noUpdate:W}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(o(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Ir(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function qTe(T,k){return new vn(T,k)}var ku=R.extend({options:{position:"topright"},initialize:function(T){m(this,T)},getPosition:function(){return this.options.position},setPosition:function(T){var k=this._map;return k&&k.removeControl(this),this.options.position=T,k&&k.addControl(this),this},getContainer:function(){return this._container},addTo:function(T){this.remove(),this._map=T;var k=this._container=this.onAdd(T),B=this.getPosition(),W=T._controlCorners[B];return yi(k,"leaflet-control"),B.indexOf("bottom")!==-1?W.insertBefore(k,W.firstChild):W.appendChild(k),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(nr(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(T){this._map&&T&&T.screenX>0&&T.screenY>0&&this._map.getContainer().focus()}}),IS=function(T){return new ku(T)};vn.include({addControl:function(T){return T.addTo(this),this},removeControl:function(T){return T.remove(),this},_initControlPos:function(){var T=this._controlCorners={},k="leaflet-",B=this._controlContainer=sn("div",k+"control-container",this._container);function W(X,le){var be=k+X+" "+k+le;T[X+le]=sn("div",be,B)}W("top","left"),W("top","right"),W("bottom","left"),W("bottom","right")},_clearControlPos:function(){for(var T in this._controlCorners)nr(this._controlCorners[T]);nr(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var u7=ku.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(T,k,B,W){return B<W?-1:W<B?1:0}},initialize:function(T,k,B){m(this,B),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var W in T)this._addLayer(T[W],W);for(W in k)this._addLayer(k[W],W,!0)},onAdd:function(T){this._initLayout(),this._update(),this._map=T,T.on("zoomend",this._checkDisabledLayers,this);for(var k=0;k<this._layers.length;k++)this._layers[k].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(T){return ku.prototype.addTo.call(this,T),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var T=0;T<this._layers.length;T++)this._layers[T].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(T,k){return this._addLayer(T,k),this._map?this._update():this},addOverlay:function(T,k){return this._addLayer(T,k,!0),this._map?this._update():this},removeLayer:function(T){T.off("add remove",this._onLayerChange,this);var k=this._getLayer(l(T));return k&&this._layers.splice(this._layers.indexOf(k),1),this._map?this._update():this},expand:function(){yi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var T=this._map.getSize().y-(this._container.offsetTop+50);return T<this._section.clientHeight?(yi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=T+"px"):Ir(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Ir(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var T="leaflet-control-layers",k=this._container=sn("div",T),B=this.options.collapsed;k.setAttribute("aria-haspopup",!0),yS(k),Bx(k);var W=this._section=sn("section",T+"-list");B&&(this._map.on("click",this.collapse,this),ki(k,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var X=this._layersLink=sn("a",T+"-toggle",k);X.href="#",X.title="Layers",X.setAttribute("role","button"),ki(X,{keydown:function(le){le.keyCode===13&&this._expandSafely()},click:function(le){Mo(le),this._expandSafely()}},this),B||this.expand(),this._baseLayersList=sn("div",T+"-base",W),this._separator=sn("div",T+"-separator",W),this._overlaysList=sn("div",T+"-overlays",W),k.appendChild(W)},_getLayer:function(T){for(var k=0;k<this._layers.length;k++)if(this._layers[k]&&l(this._layers[k].layer)===T)return this._layers[k]},_addLayer:function(T,k,B){this._map&&T.on("add remove",this._onLayerChange,this),this._layers.push({layer:T,name:k,overlay:B}),this.options.sortLayers&&this._layers.sort(o(function(W,X){return this.options.sortFunction(W.layer,X.layer,W.name,X.name)},this)),this.options.autoZIndex&&T.setZIndex&&(this._lastZIndex++,T.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;dh(this._baseLayersList),dh(this._overlaysList),this._layerControlInputs=[];var T,k,B,W,X=0;for(B=0;B<this._layers.length;B++)W=this._layers[B],this._addItem(W),k=k||W.overlay,T=T||!W.overlay,X+=W.overlay?0:1;return this.options.hideSingleBase&&(T=T&&X>1,this._baseLayersList.style.display=T?"":"none"),this._separator.style.display=k&&T?"":"none",this},_onLayerChange:function(T){this._handlingClick||this._update();var k=this._getLayer(l(T.target)),B=k.overlay?T.type==="add"?"overlayadd":"overlayremove":T.type==="add"?"baselayerchange":null;B&&this._map.fire(B,k)},_createRadioElement:function(T,k){var B='<input type="radio" class="leaflet-control-layers-selector" name="'+T+'"'+(k?' checked="checked"':"")+"/>",W=document.createElement("div");return W.innerHTML=B,W.firstChild},_addItem:function(T){var k=document.createElement("label"),B=this._map.hasLayer(T.layer),W;T.overlay?(W=document.createElement("input"),W.type="checkbox",W.className="leaflet-control-layers-selector",W.defaultChecked=B):W=this._createRadioElement("leaflet-base-layers_"+l(this),B),this._layerControlInputs.push(W),W.layerId=l(T.layer),ki(W,"click",this._onInputClick,this);var X=document.createElement("span");X.innerHTML=" "+T.name;var le=document.createElement("span");k.appendChild(le),le.appendChild(W),le.appendChild(X);var be=T.overlay?this._overlaysList:this._baseLayersList;return be.appendChild(k),this._checkDisabledLayers(),k},_onInputClick:function(){if(!this._preventClick){var T=this._layerControlInputs,k,B,W=[],X=[];this._handlingClick=!0;for(var le=T.length-1;le>=0;le--)k=T[le],B=this._getLayer(k.layerId).layer,k.checked?W.push(B):k.checked||X.push(B);for(le=0;le<X.length;le++)this._map.hasLayer(X[le])&&this._map.removeLayer(X[le]);for(le=0;le<W.length;le++)this._map.hasLayer(W[le])||this._map.addLayer(W[le]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var T=this._layerControlInputs,k,B,W=this._map.getZoom(),X=T.length-1;X>=0;X--)k=T[X],B=this._getLayer(k.layerId).layer,k.disabled=B.options.minZoom!==void 0&&W<B.options.minZoom||B.options.maxZoom!==void 0&&W>B.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var T=this._section;this._preventClick=!0,ki(T,"click",Mo),this.expand();var k=this;setTimeout(function(){wr(T,"click",Mo),k._preventClick=!1})}}),KTe=function(T,k,B){return new u7(T,k,B)},jx=ku.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(T){var k="leaflet-control-zoom",B=sn("div",k+" leaflet-bar"),W=this.options;return this._zoomInButton=this._createButton(W.zoomInText,W.zoomInTitle,k+"-in",B,this._zoomIn),this._zoomOutButton=this._createButton(W.zoomOutText,W.zoomOutTitle,k+"-out",B,this._zoomOut),this._updateDisabled(),T.on("zoomend zoomlevelschange",this._updateDisabled,this),B},onRemove:function(T){T.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(T){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(T.shiftKey?3:1))},_zoomOut:function(T){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(T.shiftKey?3:1))},_createButton:function(T,k,B,W,X){var le=sn("a",B,W);return le.innerHTML=T,le.href="#",le.title=k,le.setAttribute("role","button"),le.setAttribute("aria-label",k),yS(le),ki(le,"click",Gg),ki(le,"click",X,this),ki(le,"click",this._refocusOnMap,this),le},_updateDisabled:function(){var T=this._map,k="leaflet-disabled";Ir(this._zoomInButton,k),Ir(this._zoomOutButton,k),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||T._zoom===T.getMinZoom())&&(yi(this._zoomOutButton,k),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||T._zoom===T.getMaxZoom())&&(yi(this._zoomInButton,k),this._zoomInButton.setAttribute("aria-disabled","true"))}});vn.mergeOptions({zoomControl:!0}),vn.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new jx,this.addControl(this.zoomControl))});var YTe=function(T){return new jx(T)},d7=ku.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(T){var k="leaflet-control-scale",B=sn("div",k),W=this.options;return this._addScales(W,k+"-line",B),T.on(W.updateWhenIdle?"moveend":"move",this._update,this),T.whenReady(this._update,this),B},onRemove:function(T){T.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(T,k,B){T.metric&&(this._mScale=sn("div",k,B)),T.imperial&&(this._iScale=sn("div",k,B))},_update:function(){var T=this._map,k=T.getSize().y/2,B=T.distance(T.containerPointToLatLng([0,k]),T.containerPointToLatLng([this.options.maxWidth,k]));this._updateScales(B)},_updateScales:function(T){this.options.metric&&T&&this._updateMetric(T),this.options.imperial&&T&&this._updateImperial(T)},_updateMetric:function(T){var k=this._getRoundNum(T),B=k<1e3?k+" m":k/1e3+" km";this._updateScale(this._mScale,B,k/T)},_updateImperial:function(T){var k=T*3.2808399,B,W,X;k>5280?(B=k/5280,W=this._getRoundNum(B),this._updateScale(this._iScale,W+" mi",W/B)):(X=this._getRoundNum(k),this._updateScale(this._iScale,X+" ft",X/k))},_updateScale:function(T,k,B){T.style.width=Math.round(this.options.maxWidth*B)+"px",T.innerHTML=k},_getRoundNum:function(T){var k=Math.pow(10,(Math.floor(T)+"").length-1),B=T/k;return B=B>=10?10:B>=5?5:B>=3?3:B>=2?2:1,k*B}}),ZTe=function(T){return new d7(T)},XTe='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Gx=ku.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(yt.inlineSvg?XTe+" ":"")+"Leaflet</a>"},initialize:function(T){m(this,T),this._attributions={}},onAdd:function(T){T.attributionControl=this,this._container=sn("div","leaflet-control-attribution"),yS(this._container);for(var k in T._layers)T._layers[k].getAttribution&&this.addAttribution(T._layers[k].getAttribution());return this._update(),T.on("layeradd",this._addAttribution,this),this._container},onRemove:function(T){T.off("layeradd",this._addAttribution,this)},_addAttribution:function(T){T.layer.getAttribution&&(this.addAttribution(T.layer.getAttribution()),T.layer.once("remove",function(){this.removeAttribution(T.layer.getAttribution())},this))},setPrefix:function(T){return this.options.prefix=T,this._update(),this},addAttribution:function(T){return T?(this._attributions[T]||(this._attributions[T]=0),this._attributions[T]++,this._update(),this):this},removeAttribution:function(T){return T?(this._attributions[T]&&(this._attributions[T]--,this._update()),this):this},_update:function(){if(this._map){var T=[];for(var k in this._attributions)this._attributions[k]&&T.push(k);var B=[];this.options.prefix&&B.push(this.options.prefix),T.length&&B.push(T.join(", ")),this._container.innerHTML=B.join(' <span aria-hidden="true">|</span> ')}}});vn.mergeOptions({attributionControl:!0}),vn.addInitHook(function(){this.options.attributionControl&&new Gx().addTo(this)});var JTe=function(T){return new Gx(T)};ku.Layers=u7,ku.Zoom=jx,ku.Scale=d7,ku.Attribution=Gx,IS.layers=KTe,IS.zoom=YTe,IS.scale=ZTe,IS.attribution=JTe;var Fd=R.extend({initialize:function(T){this._map=T},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Fd.addTo=function(T,k){return T.addHandler(k,this),this};var QTe={Events:_},p7=yt.touch?"touchstart mousedown":"mousedown",Kf=O.extend({options:{clickTolerance:3},initialize:function(T,k,B,W){m(this,W),this._element=T,this._dragStartTarget=k||T,this._preventOutline=B},enable:function(){this._enabled||(ki(this._dragStartTarget,p7,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(Kf._dragging===this&&this.finishDrag(!0),wr(this._dragStartTarget,p7,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(T){if(this._enabled&&(this._moved=!1,!ln(this._element,"leaflet-zoom-anim"))){if(T.touches&&T.touches.length!==1){Kf._dragging===this&&this.finishDrag();return}if(!(Kf._dragging||T.shiftKey||T.which!==1&&T.button!==1&&!T.touches)&&(Kf._dragging=this,this._preventOutline&&Ox(this._element),zf(),pa(),!this._moving)){this.fire("down");var k=T.touches?T.touches[0]:T,B=r7(this._element);this._startPoint=new x(k.clientX,k.clientY),this._startPos=Ri(this._element),this._parentScale=xx(B);var W=T.type==="mousedown";ki(document,W?"mousemove":"touchmove",this._onMove,this),ki(document,W?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(T){if(this._enabled){if(T.touches&&T.touches.length>1){this._moved=!0;return}var k=T.touches&&T.touches.length===1?T.touches[0]:T,B=new x(k.clientX,k.clientY)._subtract(this._startPoint);!B.x&&!B.y||Math.abs(B.x)+Math.abs(B.y)<this.options.clickTolerance||(B.x/=this._parentScale.x,B.y/=this._parentScale.y,Mo(T),this._moved||(this.fire("dragstart"),this._moved=!0,yi(document.body,"leaflet-dragging"),this._lastTarget=T.target||T.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),yi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(B),this._moving=!0,this._lastEvent=T,this._updatePosition())}},_updatePosition:function(){var T={originalEvent:this._lastEvent};this.fire("predrag",T),Nt(this._element,this._newPos),this.fire("drag",T)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(T){Ir(document.body,"leaflet-dragging"),this._lastTarget&&(Ir(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),wr(document,"mousemove touchmove",this._onMove,this),wr(document,"mouseup touchend touchcancel",this._onUp,this),Wf(),nc();var k=this._moved&&this._moving;this._moving=!1,Kf._dragging=!1,k&&this.fire("dragend",{noInertia:T,distance:this._newPos.distanceTo(this._startPos)})}});function h7(T,k,B){var W,X=[1,4,2,8],le,be,Pe,_e,Ke,bt,ii,en;for(le=0,bt=T.length;le<bt;le++)T[le]._code=Hg(T[le],k);for(Pe=0;Pe<4;Pe++){for(ii=X[Pe],W=[],le=0,bt=T.length,be=bt-1;le<bt;be=le++)_e=T[le],Ke=T[be],_e._code&ii?Ke._code&ii||(en=UE(Ke,_e,ii,k,B),en._code=Hg(en,k),W.push(en)):(Ke._code&ii&&(en=UE(Ke,_e,ii,k,B),en._code=Hg(en,k),W.push(en)),W.push(_e));T=W}return T}function f7(T,k){var B,W,X,le,be,Pe,_e,Ke,bt;if(!T||T.length===0)throw new Error("latlngs not passed");Vc(T)||(console.warn("latlngs are not flat! Only the first ring will be used"),T=T[0]);var ii=K([0,0]),en=z(T),Ts=en.getNorthWest().distanceTo(en.getSouthWest())*en.getNorthEast().distanceTo(en.getNorthWest());Ts<1700&&(ii=Hx(T));var yo=T.length,jc=[];for(B=0;B<yo;B++){var ll=K(T[B]);jc.push(k.project(K([ll.lat-ii.lat,ll.lng-ii.lng])))}for(Pe=_e=Ke=0,B=0,W=yo-1;B<yo;W=B++)X=jc[B],le=jc[W],be=X.y*le.x-le.y*X.x,_e+=(X.x+le.x)*be,Ke+=(X.y+le.y)*be,Pe+=be*3;Pe===0?bt=jc[0]:bt=[_e/Pe,Ke/Pe];var LI=k.unproject($(bt));return K([LI.lat+ii.lat,LI.lng+ii.lng])}function Hx(T){for(var k=0,B=0,W=0,X=0;X<T.length;X++){var le=K(T[X]);k+=le.lat,B+=le.lng,W++}return K([k/W,B/W])}var eUe={__proto__:null,clipPolygon:h7,polygonCenter:f7,centroid:Hx};function m7(T,k){if(!k||!T.length)return T.slice();var B=k*k;return T=nUe(T,B),T=iUe(T,B),T}function g7(T,k,B){return Math.sqrt(bS(T,k,B,!0))}function tUe(T,k,B){return bS(T,k,B)}function iUe(T,k){var B=T.length,W=typeof Uint8Array<"u"?Uint8Array:Array,X=new W(B);X[0]=X[B-1]=1,zx(T,X,k,0,B-1);var le,be=[];for(le=0;le<B;le++)X[le]&&be.push(T[le]);return be}function zx(T,k,B,W,X){var le=0,be,Pe,_e;for(Pe=W+1;Pe<=X-1;Pe++)_e=bS(T[Pe],T[W],T[X],!0),_e>le&&(be=Pe,le=_e);le>B&&(k[be]=1,zx(T,k,B,W,be),zx(T,k,B,be,X))}function nUe(T,k){for(var B=[T[0]],W=1,X=0,le=T.length;W<le;W++)rUe(T[W],T[X])>k&&(B.push(T[W]),X=W);return X<le-1&&B.push(T[le-1]),B}var v7;function y7(T,k,B,W,X){var le=W?v7:Hg(T,B),be=Hg(k,B),Pe,_e,Ke;for(v7=be;;){if(!(le|be))return[T,k];if(le&be)return!1;Pe=le||be,_e=UE(T,k,Pe,B,X),Ke=Hg(_e,B),Pe===le?(T=_e,le=Ke):(k=_e,be=Ke)}}function UE(T,k,B,W,X){var le=k.x-T.x,be=k.y-T.y,Pe=W.min,_e=W.max,Ke,bt;return B&8?(Ke=T.x+le*(_e.y-T.y)/be,bt=_e.y):B&4?(Ke=T.x+le*(Pe.y-T.y)/be,bt=Pe.y):B&2?(Ke=_e.x,bt=T.y+be*(_e.x-T.x)/le):B&1&&(Ke=Pe.x,bt=T.y+be*(Pe.x-T.x)/le),new x(Ke,bt,X)}function Hg(T,k){var B=0;return T.x<k.min.x?B|=1:T.x>k.max.x&&(B|=2),T.y<k.min.y?B|=4:T.y>k.max.y&&(B|=8),B}function rUe(T,k){var B=k.x-T.x,W=k.y-T.y;return B*B+W*W}function bS(T,k,B,W){var X=k.x,le=k.y,be=B.x-X,Pe=B.y-le,_e=be*be+Pe*Pe,Ke;return _e>0&&(Ke=((T.x-X)*be+(T.y-le)*Pe)/_e,Ke>1?(X=B.x,le=B.y):Ke>0&&(X+=be*Ke,le+=Pe*Ke)),be=T.x-X,Pe=T.y-le,W?be*be+Pe*Pe:new x(X,le)}function Vc(T){return!I(T[0])||typeof T[0][0]!="object"&&typeof T[0][0]<"u"}function I7(T){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Vc(T)}function b7(T,k){var B,W,X,le,be,Pe,_e,Ke;if(!T||T.length===0)throw new Error("latlngs not passed");Vc(T)||(console.warn("latlngs are not flat! Only the first ring will be used"),T=T[0]);var bt=K([0,0]),ii=z(T),en=ii.getNorthWest().distanceTo(ii.getSouthWest())*ii.getNorthEast().distanceTo(ii.getNorthWest());en<1700&&(bt=Hx(T));var Ts=T.length,yo=[];for(B=0;B<Ts;B++){var jc=K(T[B]);yo.push(k.project(K([jc.lat-bt.lat,jc.lng-bt.lng])))}for(B=0,W=0;B<Ts-1;B++)W+=yo[B].distanceTo(yo[B+1])/2;if(W===0)Ke=yo[0];else for(B=0,le=0;B<Ts-1;B++)if(be=yo[B],Pe=yo[B+1],X=be.distanceTo(Pe),le+=X,le>W){_e=(le-W)/X,Ke=[Pe.x-_e*(Pe.x-be.x),Pe.y-_e*(Pe.y-be.y)];break}var ll=k.unproject($(Ke));return K([ll.lat+bt.lat,ll.lng+bt.lng])}var aUe={__proto__:null,simplify:m7,pointToSegmentDistance:g7,closestPointOnSegment:tUe,clipSegment:y7,_getEdgeIntersection:UE,_getBitCode:Hg,_sqClosestPointOnSegment:bS,isFlat:Vc,_flat:I7,polylineCenter:b7},Wx={project:function(T){return new x(T.lng,T.lat)},unproject:function(T){return new H(T.y,T.x)},bounds:new V([-180,-90],[180,90])},qx={R:6378137,R_MINOR:6356752314245179e-9,bounds:new V([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(T){var k=Math.PI/180,B=this.R,W=T.lat*k,X=this.R_MINOR/B,le=Math.sqrt(1-X*X),be=le*Math.sin(W),Pe=Math.tan(Math.PI/4-W/2)/Math.pow((1-be)/(1+be),le/2);return W=-B*Math.log(Math.max(Pe,1e-10)),new x(T.lng*k*B,W)},unproject:function(T){for(var k=180/Math.PI,B=this.R,W=this.R_MINOR/B,X=Math.sqrt(1-W*W),le=Math.exp(-T.y/B),be=Math.PI/2-2*Math.atan(le),Pe=0,_e=.1,Ke;Pe<15&&Math.abs(_e)>1e-7;Pe++)Ke=X*Math.sin(be),Ke=Math.pow((1-Ke)/(1+Ke),X/2),_e=Math.PI/2-2*Math.atan(le*Ke)-be,be+=_e;return new H(be*k,T.x*k/B)}},oUe={__proto__:null,LonLat:Wx,Mercator:qx,SphericalMercator:Q},sUe=r({},Y,{code:"EPSG:3395",projection:qx,transformation:function(){var T=.5/(Math.PI*qx.R);return ue(T,.5,-T,.5)}()}),w7=r({},Y,{code:"EPSG:4326",projection:Wx,transformation:ue(1/180,1,-1/180,.5)}),lUe=r({},q,{projection:Wx,transformation:ue(1,0,-1,0),scale:function(T){return Math.pow(2,T)},zoom:function(T){return Math.log(T)/Math.LN2},distance:function(T,k){var B=k.lng-T.lng,W=k.lat-T.lat;return Math.sqrt(B*B+W*W)},infinite:!0});q.Earth=Y,q.EPSG3395=sUe,q.EPSG3857=J,q.EPSG900913=te,q.EPSG4326=w7,q.Simple=lUe;var Ou=O.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(T){return T.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(T){return T&&T.removeLayer(this),this},getPane:function(T){return this._map.getPane(T?this.options[T]||T:this.options.pane)},addInteractiveTarget:function(T){return this._map._targets[l(T)]=this,this},removeInteractiveTarget:function(T){return delete this._map._targets[l(T)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(T){var k=T.target;if(k.hasLayer(this)){if(this._map=k,this._zoomAnimated=k._zoomAnimated,this.getEvents){var B=this.getEvents();k.on(B,this),this.once("remove",function(){k.off(B,this)},this)}this.onAdd(k),this.fire("add"),k.fire("layeradd",{layer:this})}}});vn.include({addLayer:function(T){if(!T._layerAdd)throw new Error("The provided object is not a Layer.");var k=l(T);return this._layers[k]?this:(this._layers[k]=T,T._mapToAdd=this,T.beforeAdd&&T.beforeAdd(this),this.whenReady(T._layerAdd,T),this)},removeLayer:function(T){var k=l(T);return this._layers[k]?(this._loaded&&T.onRemove(this),delete this._layers[k],this._loaded&&(this.fire("layerremove",{layer:T}),T.fire("remove")),T._map=T._mapToAdd=null,this):this},hasLayer:function(T){return l(T)in this._layers},eachLayer:function(T,k){for(var B in this._layers)T.call(k,this._layers[B]);return this},_addLayers:function(T){T=T?I(T)?T:[T]:[];for(var k=0,B=T.length;k<B;k++)this.addLayer(T[k])},_addZoomLimit:function(T){(!isNaN(T.options.maxZoom)||!isNaN(T.options.minZoom))&&(this._zoomBoundLayers[l(T)]=T,this._updateZoomLevels())},_removeZoomLimit:function(T){var k=l(T);this._zoomBoundLayers[k]&&(delete this._zoomBoundLayers[k],this._updateZoomLevels())},_updateZoomLevels:function(){var T=1/0,k=-1/0,B=this._getZoomSpan();for(var W in this._zoomBoundLayers){var X=this._zoomBoundLayers[W].options;T=X.minZoom===void 0?T:Math.min(T,X.minZoom),k=X.maxZoom===void 0?k:Math.max(k,X.maxZoom)}this._layersMaxZoom=k===-1/0?void 0:k,this._layersMinZoom=T===1/0?void 0:T,B!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var AI=Ou.extend({initialize:function(T,k){m(this,k),this._layers={};var B,W;if(T)for(B=0,W=T.length;B<W;B++)this.addLayer(T[B])},addLayer:function(T){var k=this.getLayerId(T);return this._layers[k]=T,this._map&&this._map.addLayer(T),this},removeLayer:function(T){var k=T in this._layers?T:this.getLayerId(T);return this._map&&this._layers[k]&&this._map.removeLayer(this._layers[k]),delete this._layers[k],this},hasLayer:function(T){var k=typeof T=="number"?T:this.getLayerId(T);return k in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(T){var k=Array.prototype.slice.call(arguments,1),B,W;for(B in this._layers)W=this._layers[B],W[T]&&W[T].apply(W,k);return this},onAdd:function(T){this.eachLayer(T.addLayer,T)},onRemove:function(T){this.eachLayer(T.removeLayer,T)},eachLayer:function(T,k){for(var B in this._layers)T.call(k,this._layers[B]);return this},getLayer:function(T){return this._layers[T]},getLayers:function(){var T=[];return this.eachLayer(T.push,T),T},setZIndex:function(T){return this.invoke("setZIndex",T)},getLayerId:function(T){return l(T)}}),cUe=function(T,k){return new AI(T,k)},ph=AI.extend({addLayer:function(T){return this.hasLayer(T)?this:(T.addEventParent(this),AI.prototype.addLayer.call(this,T),this.fire("layeradd",{layer:T}))},removeLayer:function(T){return this.hasLayer(T)?(T in this._layers&&(T=this._layers[T]),T.removeEventParent(this),AI.prototype.removeLayer.call(this,T),this.fire("layerremove",{layer:T})):this},setStyle:function(T){return this.invoke("setStyle",T)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var T=new j;for(var k in this._layers){var B=this._layers[k];T.extend(B.getBounds?B.getBounds():B.getLatLng())}return T}}),uUe=function(T,k){return new ph(T,k)},_I=R.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(T){m(this,T)},createIcon:function(T){return this._createIcon("icon",T)},createShadow:function(T){return this._createIcon("shadow",T)},_createIcon:function(T,k){var B=this._getIconUrl(T);if(!B){if(T==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var W=this._createImg(B,k&&k.tagName==="IMG"?k:null);return this._setIconStyles(W,T),(this.options.crossOrigin||this.options.crossOrigin==="")&&(W.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),W},_setIconStyles:function(T,k){var B=this.options,W=B[k+"Size"];typeof W=="number"&&(W=[W,W]);var X=$(W),le=$(k==="shadow"&&B.shadowAnchor||B.iconAnchor||X&&X.divideBy(2,!0));T.className="leaflet-marker-"+k+" "+(B.className||""),le&&(T.style.marginLeft=-le.x+"px",T.style.marginTop=-le.y+"px"),X&&(T.style.width=X.x+"px",T.style.height=X.y+"px")},_createImg:function(T,k){return k=k||document.createElement("img"),k.src=T,k},_getIconUrl:function(T){return yt.retina&&this.options[T+"RetinaUrl"]||this.options[T+"Url"]}});function dUe(T){return new _I(T)}var wS=_I.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(T){return typeof wS.imagePath!="string"&&(wS.imagePath=this._detectIconPath()),(this.options.imagePath||wS.imagePath)+_I.prototype._getIconUrl.call(this,T)},_stripUrl:function(T){var k=function(B,W,X){var le=W.exec(B);return le&&le[X]};return T=k(T,/^url\((['"])?(.+)\1\)$/,2),T&&k(T,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var T=sn("div","leaflet-default-icon-path",document.body),k=Au(T,"background-image")||Au(T,"backgroundImage");if(document.body.removeChild(T),k=this._stripUrl(k),k)return k;var B=document.querySelector('link[href$="leaflet.css"]');return B?B.href.substring(0,B.href.length-11-1):""}}),S7=Fd.extend({initialize:function(T){this._marker=T},addHooks:function(){var T=this._marker._icon;this._draggable||(this._draggable=new Kf(T,T,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),yi(T,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Ir(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(T){var k=this._marker,B=k._map,W=this._marker.options.autoPanSpeed,X=this._marker.options.autoPanPadding,le=Ri(k._icon),be=B.getPixelBounds(),Pe=B.getPixelOrigin(),_e=G(be.min._subtract(Pe).add(X),be.max._subtract(Pe).subtract(X));if(!_e.contains(le)){var Ke=$((Math.max(_e.max.x,le.x)-_e.max.x)/(be.max.x-_e.max.x)-(Math.min(_e.min.x,le.x)-_e.min.x)/(be.min.x-_e.min.x),(Math.max(_e.max.y,le.y)-_e.max.y)/(be.max.y-_e.max.y)-(Math.min(_e.min.y,le.y)-_e.min.y)/(be.min.y-_e.min.y)).multiplyBy(W);B.panBy(Ke,{animate:!1}),this._draggable._newPos._add(Ke),this._draggable._startPos._add(Ke),Nt(k._icon,this._draggable._newPos),this._onDrag(T),this._panRequest=P(this._adjustPan.bind(this,T))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(T){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=P(this._adjustPan.bind(this,T)))},_onDrag:function(T){var k=this._marker,B=k._shadow,W=Ri(k._icon),X=k._map.layerPointToLatLng(W);B&&Nt(B,W),k._latlng=X,T.latlng=X,T.oldLatLng=this._oldLatLng,k.fire("move",T).fire("drag",T)},_onDragEnd:function(T){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",T)}}),DE=Ou.extend({options:{icon:new wS,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(T,k){m(this,k),this._latlng=K(T)},onAdd:function(T){this._zoomAnimated=this._zoomAnimated&&T.options.markerZoomAnimation,this._zoomAnimated&&T.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(T){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&T.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(T){var k=this._latlng;return this._latlng=K(T),this.update(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},setZIndexOffset:function(T){return this.options.zIndexOffset=T,this.update()},getIcon:function(){return this.options.icon},setIcon:function(T){return this.options.icon=T,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var T=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(T)}return this},_initIcon:function(){var T=this.options,k="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),B=T.icon.createIcon(this._icon),W=!1;B!==this._icon&&(this._icon&&this._removeIcon(),W=!0,T.title&&(B.title=T.title),B.tagName==="IMG"&&(B.alt=T.alt||"")),yi(B,k),T.keyboard&&(B.tabIndex="0",B.setAttribute("role","button")),this._icon=B,T.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&ki(B,"focus",this._panOnFocus,this);var X=T.icon.createShadow(this._shadow),le=!1;X!==this._shadow&&(this._removeShadow(),le=!0),X&&(yi(X,k),X.alt=""),this._shadow=X,T.opacity<1&&this._updateOpacity(),W&&this.getPane().appendChild(this._icon),this._initInteraction(),X&&le&&this.getPane(T.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&wr(this._icon,"focus",this._panOnFocus,this),nr(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&nr(this._shadow),this._shadow=null},_setPos:function(T){this._icon&&Nt(this._icon,T),this._shadow&&Nt(this._shadow,T),this._zIndex=T.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(T){this._icon&&(this._icon.style.zIndex=this._zIndex+T)},_animateZoom:function(T){var k=this._map._latLngToNewLayerPoint(this._latlng,T.zoom,T.center).round();this._setPos(k)},_initInteraction:function(){if(this.options.interactive&&(yi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),S7)){var T=this.options.draggable;this.dragging&&(T=this.dragging.enabled(),this.dragging.disable()),this.dragging=new S7(this),T&&this.dragging.enable()}},setOpacity:function(T){return this.options.opacity=T,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var T=this.options.opacity;this._icon&&lt(this._icon,T),this._shadow&&lt(this._shadow,T)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var T=this._map;if(T){var k=this.options.icon.options,B=k.iconSize?$(k.iconSize):$(0,0),W=k.iconAnchor?$(k.iconAnchor):$(0,0);T.panInside(this._latlng,{paddingTopLeft:W,paddingBottomRight:B.subtract(W)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function pUe(T,k){return new DE(T,k)}var Yf=Ou.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(T){this._renderer=T.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(T){return m(this,T),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&T&&Object.prototype.hasOwnProperty.call(T,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),PE=Yf.extend({options:{fill:!0,radius:10},initialize:function(T,k){m(this,k),this._latlng=K(T),this._radius=this.options.radius},setLatLng:function(T){var k=this._latlng;return this._latlng=K(T),this.redraw(),this.fire("move",{oldLatLng:k,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(T){return this.options.radius=this._radius=T,this.redraw()},getRadius:function(){return this._radius},setStyle:function(T){var k=T&&T.radius||this._radius;return Yf.prototype.setStyle.call(this,T),this.setRadius(k),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var T=this._radius,k=this._radiusY||T,B=this._clickTolerance(),W=[T+B,k+B];this._pxBounds=new V(this._point.subtract(W),this._point.add(W))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(T){return T.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function hUe(T,k){return new PE(T,k)}var Kx=PE.extend({initialize:function(T,k,B){if(typeof k=="number"&&(k=r({},B,{radius:k})),m(this,k),this._latlng=K(T),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(T){return this._mRadius=T,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var T=[this._radius,this._radiusY||this._radius];return new j(this._map.layerPointToLatLng(this._point.subtract(T)),this._map.layerPointToLatLng(this._point.add(T)))},setStyle:Yf.prototype.setStyle,_project:function(){var T=this._latlng.lng,k=this._latlng.lat,B=this._map,W=B.options.crs;if(W.distance===Y.distance){var X=Math.PI/180,le=this._mRadius/Y.R/X,be=B.project([k+le,T]),Pe=B.project([k-le,T]),_e=be.add(Pe).divideBy(2),Ke=B.unproject(_e).lat,bt=Math.acos((Math.cos(le*X)-Math.sin(k*X)*Math.sin(Ke*X))/(Math.cos(k*X)*Math.cos(Ke*X)))/X;(isNaN(bt)||bt===0)&&(bt=le/Math.cos(Math.PI/180*k)),this._point=_e.subtract(B.getPixelOrigin()),this._radius=isNaN(bt)?0:_e.x-B.project([Ke,T-bt]).x,this._radiusY=_e.y-be.y}else{var ii=W.unproject(W.project(this._latlng).subtract([this._mRadius,0]));this._point=B.latLngToLayerPoint(this._latlng),this._radius=this._point.x-B.latLngToLayerPoint(ii).x}this._updateBounds()}});function fUe(T,k,B){return new Kx(T,k,B)}var hh=Yf.extend({options:{smoothFactor:1,noClip:!1},initialize:function(T,k){m(this,k),this._setLatLngs(T)},getLatLngs:function(){return this._latlngs},setLatLngs:function(T){return this._setLatLngs(T),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(T){for(var k=1/0,B=null,W=bS,X,le,be=0,Pe=this._parts.length;be<Pe;be++)for(var _e=this._parts[be],Ke=1,bt=_e.length;Ke<bt;Ke++){X=_e[Ke-1],le=_e[Ke];var ii=W(T,X,le,!0);ii<k&&(k=ii,B=W(T,X,le))}return B&&(B.distance=Math.sqrt(k)),B},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return b7(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(T,k){return k=k||this._defaultShape(),T=K(T),k.push(T),this._bounds.extend(T),this.redraw()},_setLatLngs:function(T){this._bounds=new j,this._latlngs=this._convertLatLngs(T)},_defaultShape:function(){return Vc(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(T){for(var k=[],B=Vc(T),W=0,X=T.length;W<X;W++)B?(k[W]=K(T[W]),this._bounds.extend(k[W])):k[W]=this._convertLatLngs(T[W]);return k},_project:function(){var T=new V;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,T),this._bounds.isValid()&&T.isValid()&&(this._rawPxBounds=T,this._updateBounds())},_updateBounds:function(){var T=this._clickTolerance(),k=new x(T,T);this._rawPxBounds&&(this._pxBounds=new V([this._rawPxBounds.min.subtract(k),this._rawPxBounds.max.add(k)]))},_projectLatlngs:function(T,k,B){var W=T[0]instanceof H,X=T.length,le,be;if(W){for(be=[],le=0;le<X;le++)be[le]=this._map.latLngToLayerPoint(T[le]),B.extend(be[le]);k.push(be)}else for(le=0;le<X;le++)this._projectLatlngs(T[le],k,B)},_clipPoints:function(){var T=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(T))){if(this.options.noClip){this._parts=this._rings;return}var k=this._parts,B,W,X,le,be,Pe,_e;for(B=0,X=0,le=this._rings.length;B<le;B++)for(_e=this._rings[B],W=0,be=_e.length;W<be-1;W++)Pe=y7(_e[W],_e[W+1],T,W,!0),Pe&&(k[X]=k[X]||[],k[X].push(Pe[0]),(Pe[1]!==_e[W+1]||W===be-2)&&(k[X].push(Pe[1]),X++))}},_simplifyPoints:function(){for(var T=this._parts,k=this.options.smoothFactor,B=0,W=T.length;B<W;B++)T[B]=m7(T[B],k)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(T,k){var B,W,X,le,be,Pe,_e=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(T))return!1;for(B=0,le=this._parts.length;B<le;B++)for(Pe=this._parts[B],W=0,be=Pe.length,X=be-1;W<be;X=W++)if(!(!k&&W===0)&&g7(T,Pe[X],Pe[W])<=_e)return!0;return!1}});function mUe(T,k){return new hh(T,k)}hh._flat=I7;var kI=hh.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return f7(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(T){var k=hh.prototype._convertLatLngs.call(this,T),B=k.length;return B>=2&&k[0]instanceof H&&k[0].equals(k[B-1])&&k.pop(),k},_setLatLngs:function(T){hh.prototype._setLatLngs.call(this,T),Vc(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Vc(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var T=this._renderer._bounds,k=this.options.weight,B=new x(k,k);if(T=new V(T.min.subtract(B),T.max.add(B)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(T))){if(this.options.noClip){this._parts=this._rings;return}for(var W=0,X=this._rings.length,le;W<X;W++)le=h7(this._rings[W],T,!0),le.length&&this._parts.push(le)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(T){var k=!1,B,W,X,le,be,Pe,_e,Ke;if(!this._pxBounds||!this._pxBounds.contains(T))return!1;for(le=0,_e=this._parts.length;le<_e;le++)for(B=this._parts[le],be=0,Ke=B.length,Pe=Ke-1;be<Ke;Pe=be++)W=B[be],X=B[Pe],W.y>T.y!=X.y>T.y&&T.x<(X.x-W.x)*(T.y-W.y)/(X.y-W.y)+W.x&&(k=!k);return k||hh.prototype._containsPoint.call(this,T,!0)}});function gUe(T,k){return new kI(T,k)}var fh=ph.extend({initialize:function(T,k){m(this,k),this._layers={},T&&this.addData(T)},addData:function(T){var k=I(T)?T:T.features,B,W,X;if(k){for(B=0,W=k.length;B<W;B++)X=k[B],(X.geometries||X.geometry||X.features||X.coordinates)&&this.addData(X);return this}var le=this.options;if(le.filter&&!le.filter(T))return this;var be=CE(T,le);return be?(be.feature=RE(T),be.defaultOptions=be.options,this.resetStyle(be),le.onEachFeature&&le.onEachFeature(T,be),this.addLayer(be)):this},resetStyle:function(T){return T===void 0?this.eachLayer(this.resetStyle,this):(T.options=r({},T.defaultOptions),this._setLayerStyle(T,this.options.style),this)},setStyle:function(T){return this.eachLayer(function(k){this._setLayerStyle(k,T)},this)},_setLayerStyle:function(T,k){T.setStyle&&(typeof k=="function"&&(k=k(T.feature)),T.setStyle(k))}});function CE(T,k){var B=T.type==="Feature"?T.geometry:T,W=B?B.coordinates:null,X=[],le=k&&k.pointToLayer,be=k&&k.coordsToLatLng||Yx,Pe,_e,Ke,bt;if(!W&&!B)return null;switch(B.type){case"Point":return Pe=be(W),T7(le,T,Pe,k);case"MultiPoint":for(Ke=0,bt=W.length;Ke<bt;Ke++)Pe=be(W[Ke]),X.push(T7(le,T,Pe,k));return new ph(X);case"LineString":case"MultiLineString":return _e=EE(W,B.type==="LineString"?0:1,be),new hh(_e,k);case"Polygon":case"MultiPolygon":return _e=EE(W,B.type==="Polygon"?1:2,be),new kI(_e,k);case"GeometryCollection":for(Ke=0,bt=B.geometries.length;Ke<bt;Ke++){var ii=CE({geometry:B.geometries[Ke],type:"Feature",properties:T.properties},k);ii&&X.push(ii)}return new ph(X);case"FeatureCollection":for(Ke=0,bt=B.features.length;Ke<bt;Ke++){var en=CE(B.features[Ke],k);en&&X.push(en)}return new ph(X);default:throw new Error("Invalid GeoJSON object.")}}function T7(T,k,B,W){return T?T(k,B):new DE(B,W&&W.markersInheritOptions&&W)}function Yx(T){return new H(T[1],T[0],T[2])}function EE(T,k,B){for(var W=[],X=0,le=T.length,be;X<le;X++)be=k?EE(T[X],k-1,B):(B||Yx)(T[X]),W.push(be);return W}function Zx(T,k){return T=K(T),T.alt!==void 0?[p(T.lng,k),p(T.lat,k),p(T.alt,k)]:[p(T.lng,k),p(T.lat,k)]}function ME(T,k,B,W){for(var X=[],le=0,be=T.length;le<be;le++)X.push(k?ME(T[le],Vc(T[le])?0:k-1,B,W):Zx(T[le],W));return!k&&B&&X.length>0&&X.push(X[0].slice()),X}function OI(T,k){return T.feature?r({},T.feature,{geometry:k}):RE(k)}function RE(T){return T.type==="Feature"||T.type==="FeatureCollection"?T:{type:"Feature",properties:{},geometry:T}}var Xx={toGeoJSON:function(T){return OI(this,{type:"Point",coordinates:Zx(this.getLatLng(),T)})}};DE.include(Xx),Kx.include(Xx),PE.include(Xx),hh.include({toGeoJSON:function(T){var k=!Vc(this._latlngs),B=ME(this._latlngs,k?1:0,!1,T);return OI(this,{type:(k?"Multi":"")+"LineString",coordinates:B})}}),kI.include({toGeoJSON:function(T){var k=!Vc(this._latlngs),B=k&&!Vc(this._latlngs[0]),W=ME(this._latlngs,B?2:k?1:0,!0,T);return k||(W=[W]),OI(this,{type:(B?"Multi":"")+"Polygon",coordinates:W})}}),AI.include({toMultiPoint:function(T){var k=[];return this.eachLayer(function(B){k.push(B.toGeoJSON(T).geometry.coordinates)}),OI(this,{type:"MultiPoint",coordinates:k})},toGeoJSON:function(T){var k=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(k==="MultiPoint")return this.toMultiPoint(T);var B=k==="GeometryCollection",W=[];return this.eachLayer(function(X){if(X.toGeoJSON){var le=X.toGeoJSON(T);if(B)W.push(le.geometry);else{var be=RE(le);be.type==="FeatureCollection"?W.push.apply(W,be.features):W.push(be)}}}),B?OI(this,{geometries:W,type:"GeometryCollection"}):{type:"FeatureCollection",features:W}}});function U7(T,k){return new fh(T,k)}var vUe=U7,NE=Ou.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(T,k,B){this._url=T,this._bounds=z(k),m(this,B)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(yi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){nr(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(T){return this.options.opacity=T,this._image&&this._updateOpacity(),this},setStyle:function(T){return T.opacity&&this.setOpacity(T.opacity),this},bringToFront:function(){return this._map&&_u(this._image),this},bringToBack:function(){return this._map&&sl(this._image),this},setUrl:function(T){return this._url=T,this._image&&(this._image.src=T),this},setBounds:function(T){return this._bounds=z(T),this._map&&this._reset(),this},getEvents:function(){var T={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(T.zoomanim=this._animateZoom),T},setZIndex:function(T){return this.options.zIndex=T,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var T=this._url.tagName==="IMG",k=this._image=T?this._url:sn("img");if(yi(k,"leaflet-image-layer"),this._zoomAnimated&&yi(k,"leaflet-zoom-animated"),this.options.className&&yi(k,this.options.className),k.onselectstart=d,k.onmousemove=d,k.onload=o(this.fire,this,"load"),k.onerror=o(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(k.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),T){this._url=k.src;return}k.src=this._url,k.alt=this.options.alt},_animateZoom:function(T){var k=this._map.getZoomScale(T.zoom),B=this._map._latLngBoundsToNewLayerBounds(this._bounds,T.zoom,T.center).min;dn(this._image,B,k)},_reset:function(){var T=this._image,k=new V(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),B=k.getSize();Nt(T,k.min),T.style.width=B.x+"px",T.style.height=B.y+"px"},_updateOpacity:function(){lt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var T=this.options.errorOverlayUrl;T&&this._url!==T&&(this._url=T,this._image.src=T)},getCenter:function(){return this._bounds.getCenter()}}),yUe=function(T,k,B){return new NE(T,k,B)},D7=NE.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var T=this._url.tagName==="VIDEO",k=this._image=T?this._url:sn("video");if(yi(k,"leaflet-image-layer"),this._zoomAnimated&&yi(k,"leaflet-zoom-animated"),this.options.className&&yi(k,this.options.className),k.onselectstart=d,k.onmousemove=d,k.onloadeddata=o(this.fire,this,"load"),T){for(var B=k.getElementsByTagName("source"),W=[],X=0;X<B.length;X++)W.push(B[X].src);this._url=B.length>0?W:[k.src];return}I(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(k.style,"objectFit")&&(k.style.objectFit="fill"),k.autoplay=!!this.options.autoplay,k.loop=!!this.options.loop,k.muted=!!this.options.muted,k.playsInline=!!this.options.playsInline;for(var le=0;le<this._url.length;le++){var be=sn("source");be.src=this._url[le],k.appendChild(be)}}});function IUe(T,k,B){return new D7(T,k,B)}var P7=NE.extend({_initImage:function(){var T=this._image=this._url;yi(T,"leaflet-image-layer"),this._zoomAnimated&&yi(T,"leaflet-zoom-animated"),this.options.className&&yi(T,this.options.className),T.onselectstart=d,T.onmousemove=d}});function bUe(T,k,B){return new P7(T,k,B)}var $d=Ou.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(T,k){T&&(T instanceof H||I(T))?(this._latlng=K(T),m(this,k)):(m(this,T),this._source=k),this.options.content&&(this._content=this.options.content)},openOn:function(T){return T=arguments.length?T:this._source._map,T.hasLayer(this)||T.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(T){return this._map?this.close():(arguments.length?this._source=T:T=this._source,this._prepareOpen(),this.openOn(T._map)),this},onAdd:function(T){this._zoomAnimated=T._zoomAnimated,this._container||this._initLayout(),T._fadeAnimated&&lt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),T._fadeAnimated&&lt(this._container,1),this.bringToFront(),this.options.interactive&&(yi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(T){T._fadeAnimated?(lt(this._container,0),this._removeTimeout=setTimeout(o(nr,void 0,this._container),200)):nr(this._container),this.options.interactive&&(Ir(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(T){return this._latlng=K(T),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(T){return this._content=T,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var T={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(T.zoomanim=this._animateZoom),T},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&_u(this._container),this},bringToBack:function(){return this._map&&sl(this._container),this},_prepareOpen:function(T){var k=this._source;if(!k._map)return!1;if(k instanceof ph){k=null;var B=this._source._layers;for(var W in B)if(B[W]._map){k=B[W];break}if(!k)return!1;this._source=k}if(!T)if(k.getCenter)T=k.getCenter();else if(k.getLatLng)T=k.getLatLng();else if(k.getBounds)T=k.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(T),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var T=this._contentNode,k=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof k=="string")T.innerHTML=k;else{for(;T.hasChildNodes();)T.removeChild(T.firstChild);T.appendChild(k)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var T=this._map.latLngToLayerPoint(this._latlng),k=$(this.options.offset),B=this._getAnchor();this._zoomAnimated?Nt(this._container,T.add(B)):k=k.add(T).add(B);var W=this._containerBottom=-k.y,X=this._containerLeft=-Math.round(this._containerWidth/2)+k.x;this._container.style.bottom=W+"px",this._container.style.left=X+"px"}},_getAnchor:function(){return[0,0]}});vn.include({_initOverlay:function(T,k,B,W){var X=k;return X instanceof T||(X=new T(W).setContent(k)),B&&X.setLatLng(B),X}}),Ou.include({_initOverlay:function(T,k,B,W){var X=B;return X instanceof T?(m(X,W),X._source=this):(X=k&&!W?k:new T(W,this),X.setContent(B)),X}});var AE=$d.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(T){return T=arguments.length?T:this._source._map,!T.hasLayer(this)&&T._popup&&T._popup.options.autoClose&&T.removeLayer(T._popup),T._popup=this,$d.prototype.openOn.call(this,T)},onAdd:function(T){$d.prototype.onAdd.call(this,T),T.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Yf||this._source.on("preclick",jg))},onRemove:function(T){$d.prototype.onRemove.call(this,T),T.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Yf||this._source.off("preclick",jg))},getEvents:function(){var T=$d.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(T.preclick=this.close),this.options.keepInView&&(T.moveend=this._adjustPan),T},_initLayout:function(){var T="leaflet-popup",k=this._container=sn("div",T+" "+(this.options.className||"")+" leaflet-zoom-animated"),B=this._wrapper=sn("div",T+"-content-wrapper",k);if(this._contentNode=sn("div",T+"-content",B),yS(k),Bx(this._contentNode),ki(k,"contextmenu",jg),this._tipContainer=sn("div",T+"-tip-container",k),this._tip=sn("div",T+"-tip",this._tipContainer),this.options.closeButton){var W=this._closeButton=sn("a",T+"-close-button",k);W.setAttribute("role","button"),W.setAttribute("aria-label","Close popup"),W.href="#close",W.innerHTML='<span aria-hidden="true">&#215;</span>',ki(W,"click",function(X){Mo(X),this.close()},this)}},_updateLayout:function(){var T=this._contentNode,k=T.style;k.width="",k.whiteSpace="nowrap";var B=T.offsetWidth;B=Math.min(B,this.options.maxWidth),B=Math.max(B,this.options.minWidth),k.width=B+1+"px",k.whiteSpace="",k.height="";var W=T.offsetHeight,X=this.options.maxHeight,le="leaflet-popup-scrolled";X&&W>X?(k.height=X+"px",yi(T,le)):Ir(T,le),this._containerWidth=this._container.offsetWidth},_animateZoom:function(T){var k=this._map._latLngToNewLayerPoint(this._latlng,T.zoom,T.center),B=this._getAnchor();Nt(this._container,k.add(B))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var T=this._map,k=parseInt(Au(this._container,"marginBottom"),10)||0,B=this._container.offsetHeight+k,W=this._containerWidth,X=new x(this._containerLeft,-B-this._containerBottom);X._add(Ri(this._container));var le=T.layerPointToContainerPoint(X),be=$(this.options.autoPanPadding),Pe=$(this.options.autoPanPaddingTopLeft||be),_e=$(this.options.autoPanPaddingBottomRight||be),Ke=T.getSize(),bt=0,ii=0;le.x+W+_e.x>Ke.x&&(bt=le.x+W-Ke.x+_e.x),le.x-bt-Pe.x<0&&(bt=le.x-Pe.x),le.y+B+_e.y>Ke.y&&(ii=le.y+B-Ke.y+_e.y),le.y-ii-Pe.y<0&&(ii=le.y-Pe.y),(bt||ii)&&(this.options.keepInView&&(this._autopanning=!0),T.fire("autopanstart").panBy([bt,ii]))}},_getAnchor:function(){return $(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),wUe=function(T,k){return new AE(T,k)};vn.mergeOptions({closePopupOnClick:!0}),vn.include({openPopup:function(T,k,B){return this._initOverlay(AE,T,k,B).openOn(this),this},closePopup:function(T){return T=arguments.length?T:this._popup,T&&T.close(),this}}),Ou.include({bindPopup:function(T,k){return this._popup=this._initOverlay(AE,this._popup,T,k),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(T){return this._popup&&(this instanceof ph||(this._popup._source=this),this._popup._prepareOpen(T||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(T){return this._popup&&this._popup.setContent(T),this},getPopup:function(){return this._popup},_openPopup:function(T){if(!(!this._popup||!this._map)){Gg(T);var k=T.layer||T.target;if(this._popup._source===k&&!(k instanceof Yf)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(T.latlng);return}this._popup._source=k,this.openPopup(T.latlng)}},_movePopup:function(T){this._popup.setLatLng(T.latlng)},_onKeyPress:function(T){T.originalEvent.keyCode===13&&this._openPopup(T)}});var _E=$d.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(T){$d.prototype.onAdd.call(this,T),this.setOpacity(this.options.opacity),T.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(T){$d.prototype.onRemove.call(this,T),T.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var T=$d.prototype.getEvents.call(this);return this.options.permanent||(T.preclick=this.close),T},_initLayout:function(){var T="leaflet-tooltip",k=T+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=sn("div",k),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(T){var k,B,W=this._map,X=this._container,le=W.latLngToContainerPoint(W.getCenter()),be=W.layerPointToContainerPoint(T),Pe=this.options.direction,_e=X.offsetWidth,Ke=X.offsetHeight,bt=$(this.options.offset),ii=this._getAnchor();Pe==="top"?(k=_e/2,B=Ke):Pe==="bottom"?(k=_e/2,B=0):Pe==="center"?(k=_e/2,B=Ke/2):Pe==="right"?(k=0,B=Ke/2):Pe==="left"?(k=_e,B=Ke/2):be.x<le.x?(Pe="right",k=0,B=Ke/2):(Pe="left",k=_e+(bt.x+ii.x)*2,B=Ke/2),T=T.subtract($(k,B,!0)).add(bt).add(ii),Ir(X,"leaflet-tooltip-right"),Ir(X,"leaflet-tooltip-left"),Ir(X,"leaflet-tooltip-top"),Ir(X,"leaflet-tooltip-bottom"),yi(X,"leaflet-tooltip-"+Pe),Nt(X,T)},_updatePosition:function(){var T=this._map.latLngToLayerPoint(this._latlng);this._setPosition(T)},setOpacity:function(T){this.options.opacity=T,this._container&&lt(this._container,T)},_animateZoom:function(T){var k=this._map._latLngToNewLayerPoint(this._latlng,T.zoom,T.center);this._setPosition(k)},_getAnchor:function(){return $(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),SUe=function(T,k){return new _E(T,k)};vn.include({openTooltip:function(T,k,B){return this._initOverlay(_E,T,k,B).openOn(this),this},closeTooltip:function(T){return T.close(),this}}),Ou.include({bindTooltip:function(T,k){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(_E,this._tooltip,T,k),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(T){if(!(!T&&this._tooltipHandlersAdded)){var k=T?"off":"on",B={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?B.add=this._openTooltip:(B.mouseover=this._openTooltip,B.mouseout=this.closeTooltip,B.click=this._openTooltip,this._map?this._addFocusListeners():B.add=this._addFocusListeners),this._tooltip.options.sticky&&(B.mousemove=this._moveTooltip),this[k](B),this._tooltipHandlersAdded=!T}},openTooltip:function(T){return this._tooltip&&(this instanceof ph||(this._tooltip._source=this),this._tooltip._prepareOpen(T)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(T){return this._tooltip&&this._tooltip.setContent(T),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(T){var k=typeof T.getElement=="function"&&T.getElement();k&&(ki(k,"focus",function(){this._tooltip._source=T,this.openTooltip()},this),ki(k,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(T){var k=typeof T.getElement=="function"&&T.getElement();k&&k.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(T){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var k=this;this._map.once("moveend",function(){k._openOnceFlag=!1,k._openTooltip(T)});return}this._tooltip._source=T.layer||T.target,this.openTooltip(this._tooltip.options.sticky?T.latlng:void 0)}},_moveTooltip:function(T){var k=T.latlng,B,W;this._tooltip.options.sticky&&T.originalEvent&&(B=this._map.mouseEventToContainerPoint(T.originalEvent),W=this._map.containerPointToLayerPoint(B),k=this._map.layerPointToLatLng(W)),this._tooltip.setLatLng(k)}});var C7=_I.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(T){var k=T&&T.tagName==="DIV"?T:document.createElement("div"),B=this.options;if(B.html instanceof Element?(dh(k),k.appendChild(B.html)):k.innerHTML=B.html!==!1?B.html:"",B.bgPos){var W=$(B.bgPos);k.style.backgroundPosition=-W.x+"px "+-W.y+"px"}return this._setIconStyles(k,"icon"),k},createShadow:function(){return null}});function TUe(T){return new C7(T)}_I.Default=wS;var SS=Ou.extend({options:{tileSize:256,opacity:1,updateWhenIdle:yt.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(T){m(this,T)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(T){T._addZoomLimit(this)},onRemove:function(T){this._removeAllTiles(),nr(this._container),T._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(_u(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(sl(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(T){return this.options.opacity=T,this._updateOpacity(),this},setZIndex:function(T){return this.options.zIndex=T,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var T=this._clampZoom(this._map.getZoom());T!==this._tileZoom&&(this._tileZoom=T,this._updateLevels()),this._update()}return this},getEvents:function(){var T={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),T.move=this._onMove),this._zoomAnimated&&(T.zoomanim=this._animateZoom),T},createTile:function(){return document.createElement("div")},getTileSize:function(){var T=this.options.tileSize;return T instanceof x?T:new x(T,T)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(T){for(var k=this.getPane().children,B=-T(-1/0,1/0),W=0,X=k.length,le;W<X;W++)le=k[W].style.zIndex,k[W]!==this._container&&le&&(B=T(B,+le));isFinite(B)&&(this.options.zIndex=B+T(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!yt.ielt9){lt(this._container,this.options.opacity);var T=+new Date,k=!1,B=!1;for(var W in this._tiles){var X=this._tiles[W];if(!(!X.current||!X.loaded)){var le=Math.min(1,(T-X.loaded)/200);lt(X.el,le),le<1?k=!0:(X.active?B=!0:this._onOpaqueTile(X),X.active=!0)}}B&&!this._noPrune&&this._pruneTiles(),k&&(M(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=sn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var T=this._tileZoom,k=this.options.maxZoom;if(T!==void 0){for(var B in this._levels)B=Number(B),this._levels[B].el.children.length||B===T?(this._levels[B].el.style.zIndex=k-Math.abs(T-B),this._onUpdateLevel(B)):(nr(this._levels[B].el),this._removeTilesAtZoom(B),this._onRemoveLevel(B),delete this._levels[B]);var W=this._levels[T],X=this._map;return W||(W=this._levels[T]={},W.el=sn("div","leaflet-tile-container leaflet-zoom-animated",this._container),W.el.style.zIndex=k,W.origin=X.project(X.unproject(X.getPixelOrigin()),T).round(),W.zoom=T,this._setZoomTransform(W,X.getCenter(),X.getZoom()),d(W.el.offsetWidth),this._onCreateLevel(W)),this._level=W,W}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var T,k,B=this._map.getZoom();if(B>this.options.maxZoom||B<this.options.minZoom){this._removeAllTiles();return}for(T in this._tiles)k=this._tiles[T],k.retain=k.current;for(T in this._tiles)if(k=this._tiles[T],k.current&&!k.active){var W=k.coords;this._retainParent(W.x,W.y,W.z,W.z-5)||this._retainChildren(W.x,W.y,W.z,W.z+2)}for(T in this._tiles)this._tiles[T].retain||this._removeTile(T)}},_removeTilesAtZoom:function(T){for(var k in this._tiles)this._tiles[k].coords.z===T&&this._removeTile(k)},_removeAllTiles:function(){for(var T in this._tiles)this._removeTile(T)},_invalidateAll:function(){for(var T in this._levels)nr(this._levels[T].el),this._onRemoveLevel(Number(T)),delete this._levels[T];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(T,k,B,W){var X=Math.floor(T/2),le=Math.floor(k/2),be=B-1,Pe=new x(+X,+le);Pe.z=+be;var _e=this._tileCoordsToKey(Pe),Ke=this._tiles[_e];return Ke&&Ke.active?(Ke.retain=!0,!0):(Ke&&Ke.loaded&&(Ke.retain=!0),be>W?this._retainParent(X,le,be,W):!1)},_retainChildren:function(T,k,B,W){for(var X=2*T;X<2*T+2;X++)for(var le=2*k;le<2*k+2;le++){var be=new x(X,le);be.z=B+1;var Pe=this._tileCoordsToKey(be),_e=this._tiles[Pe];if(_e&&_e.active){_e.retain=!0;continue}else _e&&_e.loaded&&(_e.retain=!0);B+1<W&&this._retainChildren(X,le,B+1,W)}},_resetView:function(T){var k=T&&(T.pinch||T.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),k,k)},_animateZoom:function(T){this._setView(T.center,T.zoom,!0,T.noUpdate)},_clampZoom:function(T){var k=this.options;return k.minNativeZoom!==void 0&&T<k.minNativeZoom?k.minNativeZoom:k.maxNativeZoom!==void 0&&k.maxNativeZoom<T?k.maxNativeZoom:T},_setView:function(T,k,B,W){var X=Math.round(k);this.options.maxZoom!==void 0&&X>this.options.maxZoom||this.options.minZoom!==void 0&&X<this.options.minZoom?X=void 0:X=this._clampZoom(X);var le=this.options.updateWhenZooming&&X!==this._tileZoom;(!W||le)&&(this._tileZoom=X,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),X!==void 0&&this._update(T),B||this._pruneTiles(),this._noPrune=!!B),this._setZoomTransforms(T,k)},_setZoomTransforms:function(T,k){for(var B in this._levels)this._setZoomTransform(this._levels[B],T,k)},_setZoomTransform:function(T,k,B){var W=this._map.getZoomScale(B,T.zoom),X=T.origin.multiplyBy(W).subtract(this._map._getNewPixelOrigin(k,B)).round();yt.any3d?dn(T.el,X,W):Nt(T.el,X)},_resetGrid:function(){var T=this._map,k=T.options.crs,B=this._tileSize=this.getTileSize(),W=this._tileZoom,X=this._map.getPixelWorldBounds(this._tileZoom);X&&(this._globalTileRange=this._pxBoundsToTileRange(X)),this._wrapX=k.wrapLng&&!this.options.noWrap&&[Math.floor(T.project([0,k.wrapLng[0]],W).x/B.x),Math.ceil(T.project([0,k.wrapLng[1]],W).x/B.y)],this._wrapY=k.wrapLat&&!this.options.noWrap&&[Math.floor(T.project([k.wrapLat[0],0],W).y/B.x),Math.ceil(T.project([k.wrapLat[1],0],W).y/B.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(T){var k=this._map,B=k._animatingZoom?Math.max(k._animateToZoom,k.getZoom()):k.getZoom(),W=k.getZoomScale(B,this._tileZoom),X=k.project(T,this._tileZoom).floor(),le=k.getSize().divideBy(W*2);return new V(X.subtract(le),X.add(le))},_update:function(T){var k=this._map;if(k){var B=this._clampZoom(k.getZoom());if(T===void 0&&(T=k.getCenter()),this._tileZoom!==void 0){var W=this._getTiledPixelBounds(T),X=this._pxBoundsToTileRange(W),le=X.getCenter(),be=[],Pe=this.options.keepBuffer,_e=new V(X.getBottomLeft().subtract([Pe,-Pe]),X.getTopRight().add([Pe,-Pe]));if(!(isFinite(X.min.x)&&isFinite(X.min.y)&&isFinite(X.max.x)&&isFinite(X.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var Ke in this._tiles){var bt=this._tiles[Ke].coords;(bt.z!==this._tileZoom||!_e.contains(new x(bt.x,bt.y)))&&(this._tiles[Ke].current=!1)}if(Math.abs(B-this._tileZoom)>1){this._setView(T,B);return}for(var ii=X.min.y;ii<=X.max.y;ii++)for(var en=X.min.x;en<=X.max.x;en++){var Ts=new x(en,ii);if(Ts.z=this._tileZoom,!!this._isValidTile(Ts)){var yo=this._tiles[this._tileCoordsToKey(Ts)];yo?yo.current=!0:be.push(Ts)}}if(be.sort(function(ll,LI){return ll.distanceTo(le)-LI.distanceTo(le)}),be.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var jc=document.createDocumentFragment();for(en=0;en<be.length;en++)this._addTile(be[en],jc);this._level.el.appendChild(jc)}}}},_isValidTile:function(T){var k=this._map.options.crs;if(!k.infinite){var B=this._globalTileRange;if(!k.wrapLng&&(T.x<B.min.x||T.x>B.max.x)||!k.wrapLat&&(T.y<B.min.y||T.y>B.max.y))return!1}if(!this.options.bounds)return!0;var W=this._tileCoordsToBounds(T);return z(this.options.bounds).overlaps(W)},_keyToBounds:function(T){return this._tileCoordsToBounds(this._keyToTileCoords(T))},_tileCoordsToNwSe:function(T){var k=this._map,B=this.getTileSize(),W=T.scaleBy(B),X=W.add(B),le=k.unproject(W,T.z),be=k.unproject(X,T.z);return[le,be]},_tileCoordsToBounds:function(T){var k=this._tileCoordsToNwSe(T),B=new j(k[0],k[1]);return this.options.noWrap||(B=this._map.wrapLatLngBounds(B)),B},_tileCoordsToKey:function(T){return T.x+":"+T.y+":"+T.z},_keyToTileCoords:function(T){var k=T.split(":"),B=new x(+k[0],+k[1]);return B.z=+k[2],B},_removeTile:function(T){var k=this._tiles[T];k&&(nr(k.el),delete this._tiles[T],this.fire("tileunload",{tile:k.el,coords:this._keyToTileCoords(T)}))},_initTile:function(T){yi(T,"leaflet-tile");var k=this.getTileSize();T.style.width=k.x+"px",T.style.height=k.y+"px",T.onselectstart=d,T.onmousemove=d,yt.ielt9&&this.options.opacity<1&&lt(T,this.options.opacity)},_addTile:function(T,k){var B=this._getTilePos(T),W=this._tileCoordsToKey(T),X=this.createTile(this._wrapCoords(T),o(this._tileReady,this,T));this._initTile(X),this.createTile.length<2&&P(o(this._tileReady,this,T,null,X)),Nt(X,B),this._tiles[W]={el:X,coords:T,current:!0},k.appendChild(X),this.fire("tileloadstart",{tile:X,coords:T})},_tileReady:function(T,k,B){k&&this.fire("tileerror",{error:k,tile:B,coords:T});var W=this._tileCoordsToKey(T);B=this._tiles[W],B&&(B.loaded=+new Date,this._map._fadeAnimated?(lt(B.el,0),M(this._fadeFrame),this._fadeFrame=P(this._updateOpacity,this)):(B.active=!0,this._pruneTiles()),k||(yi(B.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:B.el,coords:T})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),yt.ielt9||!this._map._fadeAnimated?P(this._pruneTiles,this):setTimeout(o(this._pruneTiles,this),250)))},_getTilePos:function(T){return T.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(T){var k=new x(this._wrapX?u(T.x,this._wrapX):T.x,this._wrapY?u(T.y,this._wrapY):T.y);return k.z=T.z,k},_pxBoundsToTileRange:function(T){var k=this.getTileSize();return new V(T.min.unscaleBy(k).floor(),T.max.unscaleBy(k).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var T in this._tiles)if(!this._tiles[T].loaded)return!1;return!0}});function UUe(T){return new SS(T)}var xI=SS.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(T,k){this._url=T,k=m(this,k),k.detectRetina&&yt.retina&&k.maxZoom>0?(k.tileSize=Math.floor(k.tileSize/2),k.zoomReverse?(k.zoomOffset--,k.minZoom=Math.min(k.maxZoom,k.minZoom+1)):(k.zoomOffset++,k.maxZoom=Math.max(k.minZoom,k.maxZoom-1)),k.minZoom=Math.max(0,k.minZoom)):k.zoomReverse?k.minZoom=Math.min(k.maxZoom,k.minZoom):k.maxZoom=Math.max(k.minZoom,k.maxZoom),typeof k.subdomains=="string"&&(k.subdomains=k.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(T,k){return this._url===T&&k===void 0&&(k=!0),this._url=T,k||this.redraw(),this},createTile:function(T,k){var B=document.createElement("img");return ki(B,"load",o(this._tileOnLoad,this,k,B)),ki(B,"error",o(this._tileOnError,this,k,B)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(B.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(B.referrerPolicy=this.options.referrerPolicy),B.alt="",B.src=this.getTileUrl(T),B},getTileUrl:function(T){var k={r:yt.retina?"@2x":"",s:this._getSubdomain(T),x:T.x,y:T.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var B=this._globalTileRange.max.y-T.y;this.options.tms&&(k.y=B),k["-y"]=B}return y(this._url,r(k,this.options))},_tileOnLoad:function(T,k){yt.ielt9?setTimeout(o(T,this,null,k),0):T(null,k)},_tileOnError:function(T,k,B){var W=this.options.errorTileUrl;W&&k.getAttribute("src")!==W&&(k.src=W),T(B,k)},_onTileRemove:function(T){T.tile.onload=null},_getZoomForUrl:function(){var T=this._tileZoom,k=this.options.maxZoom,B=this.options.zoomReverse,W=this.options.zoomOffset;return B&&(T=k-T),T+W},_getSubdomain:function(T){var k=Math.abs(T.x+T.y)%this.options.subdomains.length;return this.options.subdomains[k]},_abortLoading:function(){var T,k;for(T in this._tiles)if(this._tiles[T].coords.z!==this._tileZoom&&(k=this._tiles[T].el,k.onload=d,k.onerror=d,!k.complete)){k.src=D;var B=this._tiles[T].coords;nr(k),delete this._tiles[T],this.fire("tileabort",{tile:k,coords:B})}},_removeTile:function(T){var k=this._tiles[T];if(k)return k.el.setAttribute("src",D),SS.prototype._removeTile.call(this,T)},_tileReady:function(T,k,B){if(!(!this._map||B&&B.getAttribute("src")===D))return SS.prototype._tileReady.call(this,T,k,B)}});function E7(T,k){return new xI(T,k)}var M7=xI.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(T,k){this._url=T;var B=r({},this.defaultWmsParams);for(var W in k)W in this.options||(B[W]=k[W]);k=m(this,k);var X=k.detectRetina&&yt.retina?2:1,le=this.getTileSize();B.width=le.x*X,B.height=le.y*X,this.wmsParams=B},onAdd:function(T){this._crs=this.options.crs||T.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var k=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[k]=this._crs.code,xI.prototype.onAdd.call(this,T)},getTileUrl:function(T){var k=this._tileCoordsToNwSe(T),B=this._crs,W=G(B.project(k[0]),B.project(k[1])),X=W.min,le=W.max,be=(this._wmsVersion>=1.3&&this._crs===w7?[X.y,X.x,le.y,le.x]:[X.x,X.y,le.x,le.y]).join(","),Pe=xI.prototype.getTileUrl.call(this,T);return Pe+g(this.wmsParams,Pe,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+be},setParams:function(T,k){return r(this.wmsParams,T),k||this.redraw(),this}});function DUe(T,k){return new M7(T,k)}xI.WMS=M7,E7.wms=DUe;var mh=Ou.extend({options:{padding:.1},initialize:function(T){m(this,T),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),yi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var T={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(T.zoomanim=this._onAnimZoom),T},_onAnimZoom:function(T){this._updateTransform(T.center,T.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(T,k){var B=this._map.getZoomScale(k,this._zoom),W=this._map.getSize().multiplyBy(.5+this.options.padding),X=this._map.project(this._center,k),le=W.multiplyBy(-B).add(X).subtract(this._map._getNewPixelOrigin(T,k));yt.any3d?dn(this._container,le,B):Nt(this._container,le)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var T in this._layers)this._layers[T]._reset()},_onZoomEnd:function(){for(var T in this._layers)this._layers[T]._project()},_updatePaths:function(){for(var T in this._layers)this._layers[T]._update()},_update:function(){var T=this.options.padding,k=this._map.getSize(),B=this._map.containerPointToLayerPoint(k.multiplyBy(-T)).round();this._bounds=new V(B,B.add(k.multiplyBy(1+T*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),R7=mh.extend({options:{tolerance:0},getEvents:function(){var T=mh.prototype.getEvents.call(this);return T.viewprereset=this._onViewPreReset,T},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){mh.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var T=this._container=document.createElement("canvas");ki(T,"mousemove",this._onMouseMove,this),ki(T,"click dblclick mousedown mouseup contextmenu",this._onClick,this),ki(T,"mouseout",this._handleMouseOut,this),T._leaflet_disable_events=!0,this._ctx=T.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,nr(this._container),wr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var T;this._redrawBounds=null;for(var k in this._layers)T=this._layers[k],T._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){mh.prototype._update.call(this);var T=this._bounds,k=this._container,B=T.getSize(),W=yt.retina?2:1;Nt(k,T.min),k.width=W*B.x,k.height=W*B.y,k.style.width=B.x+"px",k.style.height=B.y+"px",yt.retina&&this._ctx.scale(2,2),this._ctx.translate(-T.min.x,-T.min.y),this.fire("update")}},_reset:function(){mh.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(T){this._updateDashArray(T),this._layers[l(T)]=T;var k=T._order={layer:T,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=k),this._drawLast=k,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(T){this._requestRedraw(T)},_removePath:function(T){var k=T._order,B=k.next,W=k.prev;B?B.prev=W:this._drawLast=W,W?W.next=B:this._drawFirst=B,delete T._order,delete this._layers[l(T)],this._requestRedraw(T)},_updatePath:function(T){this._extendRedrawBounds(T),T._project(),T._update(),this._requestRedraw(T)},_updateStyle:function(T){this._updateDashArray(T),this._requestRedraw(T)},_updateDashArray:function(T){if(typeof T.options.dashArray=="string"){var k=T.options.dashArray.split(/[, ]+/),B=[],W,X;for(X=0;X<k.length;X++){if(W=Number(k[X]),isNaN(W))return;B.push(W)}T.options._dashArray=B}else T.options._dashArray=T.options.dashArray},_requestRedraw:function(T){this._map&&(this._extendRedrawBounds(T),this._redrawRequest=this._redrawRequest||P(this._redraw,this))},_extendRedrawBounds:function(T){if(T._pxBounds){var k=(T.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new V,this._redrawBounds.extend(T._pxBounds.min.subtract([k,k])),this._redrawBounds.extend(T._pxBounds.max.add([k,k]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var T=this._redrawBounds;if(T){var k=T.getSize();this._ctx.clearRect(T.min.x,T.min.y,k.x,k.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var T,k=this._redrawBounds;if(this._ctx.save(),k){var B=k.getSize();this._ctx.beginPath(),this._ctx.rect(k.min.x,k.min.y,B.x,B.y),this._ctx.clip()}this._drawing=!0;for(var W=this._drawFirst;W;W=W.next)T=W.layer,(!k||T._pxBounds&&T._pxBounds.intersects(k))&&T._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(T,k){if(this._drawing){var B,W,X,le,be=T._parts,Pe=be.length,_e=this._ctx;if(Pe){for(_e.beginPath(),B=0;B<Pe;B++){for(W=0,X=be[B].length;W<X;W++)le=be[B][W],_e[W?"lineTo":"moveTo"](le.x,le.y);k&&_e.closePath()}this._fillStroke(_e,T)}}},_updateCircle:function(T){if(!(!this._drawing||T._empty())){var k=T._point,B=this._ctx,W=Math.max(Math.round(T._radius),1),X=(Math.max(Math.round(T._radiusY),1)||W)/W;X!==1&&(B.save(),B.scale(1,X)),B.beginPath(),B.arc(k.x,k.y/X,W,0,Math.PI*2,!1),X!==1&&B.restore(),this._fillStroke(B,T)}},_fillStroke:function(T,k){var B=k.options;B.fill&&(T.globalAlpha=B.fillOpacity,T.fillStyle=B.fillColor||B.color,T.fill(B.fillRule||"evenodd")),B.stroke&&B.weight!==0&&(T.setLineDash&&T.setLineDash(k.options&&k.options._dashArray||[]),T.globalAlpha=B.opacity,T.lineWidth=B.weight,T.strokeStyle=B.color,T.lineCap=B.lineCap,T.lineJoin=B.lineJoin,T.stroke())},_onClick:function(T){for(var k=this._map.mouseEventToLayerPoint(T),B,W,X=this._drawFirst;X;X=X.next)B=X.layer,B.options.interactive&&B._containsPoint(k)&&(!(T.type==="click"||T.type==="preclick")||!this._map._draggableMoved(B))&&(W=B);this._fireEvent(W?[W]:!1,T)},_onMouseMove:function(T){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var k=this._map.mouseEventToLayerPoint(T);this._handleMouseHover(T,k)}},_handleMouseOut:function(T){var k=this._hoveredLayer;k&&(Ir(this._container,"leaflet-interactive"),this._fireEvent([k],T,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(T,k){if(!this._mouseHoverThrottled){for(var B,W,X=this._drawFirst;X;X=X.next)B=X.layer,B.options.interactive&&B._containsPoint(k)&&(W=B);W!==this._hoveredLayer&&(this._handleMouseOut(T),W&&(yi(this._container,"leaflet-interactive"),this._fireEvent([W],T,"mouseover"),this._hoveredLayer=W)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,T),this._mouseHoverThrottled=!0,setTimeout(o(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(T,k,B){this._map._fireDOMEvent(k,B||k.type,T)},_bringToFront:function(T){var k=T._order;if(k){var B=k.next,W=k.prev;if(B)B.prev=W;else return;W?W.next=B:B&&(this._drawFirst=B),k.prev=this._drawLast,this._drawLast.next=k,k.next=null,this._drawLast=k,this._requestRedraw(T)}},_bringToBack:function(T){var k=T._order;if(k){var B=k.next,W=k.prev;if(W)W.next=B;else return;B?B.prev=W:W&&(this._drawLast=W),k.prev=null,k.next=this._drawFirst,this._drawFirst.prev=k,this._drawFirst=k,this._requestRedraw(T)}}});function N7(T){return yt.canvas?new R7(T):null}var TS=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(T){return document.createElement("<lvml:"+T+' class="lvml">')}}catch{}return function(T){return document.createElement("<"+T+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),PUe={_initContainer:function(){this._container=sn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(mh.prototype._update.call(this),this.fire("update"))},_initPath:function(T){var k=T._container=TS("shape");yi(k,"leaflet-vml-shape "+(this.options.className||"")),k.coordsize="1 1",T._path=TS("path"),k.appendChild(T._path),this._updateStyle(T),this._layers[l(T)]=T},_addPath:function(T){var k=T._container;this._container.appendChild(k),T.options.interactive&&T.addInteractiveTarget(k)},_removePath:function(T){var k=T._container;nr(k),T.removeInteractiveTarget(k),delete this._layers[l(T)]},_updateStyle:function(T){var k=T._stroke,B=T._fill,W=T.options,X=T._container;X.stroked=!!W.stroke,X.filled=!!W.fill,W.stroke?(k||(k=T._stroke=TS("stroke")),X.appendChild(k),k.weight=W.weight+"px",k.color=W.color,k.opacity=W.opacity,W.dashArray?k.dashStyle=I(W.dashArray)?W.dashArray.join(" "):W.dashArray.replace(/( *, *)/g," "):k.dashStyle="",k.endcap=W.lineCap.replace("butt","flat"),k.joinstyle=W.lineJoin):k&&(X.removeChild(k),T._stroke=null),W.fill?(B||(B=T._fill=TS("fill")),X.appendChild(B),B.color=W.fillColor||W.color,B.opacity=W.fillOpacity):B&&(X.removeChild(B),T._fill=null)},_updateCircle:function(T){var k=T._point.round(),B=Math.round(T._radius),W=Math.round(T._radiusY||B);this._setPath(T,T._empty()?"M0 0":"AL "+k.x+","+k.y+" "+B+","+W+" 0,"+65535*360)},_setPath:function(T,k){T._path.v=k},_bringToFront:function(T){_u(T._container)},_bringToBack:function(T){sl(T._container)}},kE=yt.vml?TS:se,US=mh.extend({_initContainer:function(){this._container=kE("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=kE("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){nr(this._container),wr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){mh.prototype._update.call(this);var T=this._bounds,k=T.getSize(),B=this._container;(!this._svgSize||!this._svgSize.equals(k))&&(this._svgSize=k,B.setAttribute("width",k.x),B.setAttribute("height",k.y)),Nt(B,T.min),B.setAttribute("viewBox",[T.min.x,T.min.y,k.x,k.y].join(" ")),this.fire("update")}},_initPath:function(T){var k=T._path=kE("path");T.options.className&&yi(k,T.options.className),T.options.interactive&&yi(k,"leaflet-interactive"),this._updateStyle(T),this._layers[l(T)]=T},_addPath:function(T){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(T._path),T.addInteractiveTarget(T._path)},_removePath:function(T){nr(T._path),T.removeInteractiveTarget(T._path),delete this._layers[l(T)]},_updatePath:function(T){T._project(),T._update()},_updateStyle:function(T){var k=T._path,B=T.options;k&&(B.stroke?(k.setAttribute("stroke",B.color),k.setAttribute("stroke-opacity",B.opacity),k.setAttribute("stroke-width",B.weight),k.setAttribute("stroke-linecap",B.lineCap),k.setAttribute("stroke-linejoin",B.lineJoin),B.dashArray?k.setAttribute("stroke-dasharray",B.dashArray):k.removeAttribute("stroke-dasharray"),B.dashOffset?k.setAttribute("stroke-dashoffset",B.dashOffset):k.removeAttribute("stroke-dashoffset")):k.setAttribute("stroke","none"),B.fill?(k.setAttribute("fill",B.fillColor||B.color),k.setAttribute("fill-opacity",B.fillOpacity),k.setAttribute("fill-rule",B.fillRule||"evenodd")):k.setAttribute("fill","none"))},_updatePoly:function(T,k){this._setPath(T,ee(T._parts,k))},_updateCircle:function(T){var k=T._point,B=Math.max(Math.round(T._radius),1),W=Math.max(Math.round(T._radiusY),1)||B,X="a"+B+","+W+" 0 1,0 ",le=T._empty()?"M0 0":"M"+(k.x-B)+","+k.y+X+B*2+",0 "+X+-B*2+",0 ";this._setPath(T,le)},_setPath:function(T,k){T._path.setAttribute("d",k)},_bringToFront:function(T){_u(T._path)},_bringToBack:function(T){sl(T._path)}});yt.vml&&US.include(PUe);function A7(T){return yt.svg||yt.vml?new US(T):null}vn.include({getRenderer:function(T){var k=T.options.renderer||this._getPaneRenderer(T.options.pane)||this.options.renderer||this._renderer;return k||(k=this._renderer=this._createRenderer()),this.hasLayer(k)||this.addLayer(k),k},_getPaneRenderer:function(T){if(T==="overlayPane"||T===void 0)return!1;var k=this._paneRenderers[T];return k===void 0&&(k=this._createRenderer({pane:T}),this._paneRenderers[T]=k),k},_createRenderer:function(T){return this.options.preferCanvas&&N7(T)||A7(T)}});var _7=kI.extend({initialize:function(T,k){kI.prototype.initialize.call(this,this._boundsToLatLngs(T),k)},setBounds:function(T){return this.setLatLngs(this._boundsToLatLngs(T))},_boundsToLatLngs:function(T){return T=z(T),[T.getSouthWest(),T.getNorthWest(),T.getNorthEast(),T.getSouthEast()]}});function CUe(T,k){return new _7(T,k)}US.create=kE,US.pointsToPath=ee,fh.geometryToLayer=CE,fh.coordsToLatLng=Yx,fh.coordsToLatLngs=EE,fh.latLngToCoords=Zx,fh.latLngsToCoords=ME,fh.getFeature=OI,fh.asFeature=RE,vn.mergeOptions({boxZoom:!0});var k7=Fd.extend({initialize:function(T){this._map=T,this._container=T._container,this._pane=T._panes.overlayPane,this._resetStateTimeout=0,T.on("unload",this._destroy,this)},addHooks:function(){ki(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){wr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){nr(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(T){if(!T.shiftKey||T.which!==1&&T.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),pa(),zf(),this._startPoint=this._map.mouseEventToContainerPoint(T),ki(document,{contextmenu:Gg,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(T){this._moved||(this._moved=!0,this._box=sn("div","leaflet-zoom-box",this._container),yi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(T);var k=new V(this._point,this._startPoint),B=k.getSize();Nt(this._box,k.min),this._box.style.width=B.x+"px",this._box.style.height=B.y+"px"},_finish:function(){this._moved&&(nr(this._box),Ir(this._container,"leaflet-crosshair")),nc(),Wf(),wr(document,{contextmenu:Gg,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(T){if(!(T.which!==1&&T.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(o(this._resetState,this),0);var k=new j(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(k).fire("boxzoomend",{boxZoomBounds:k})}},_onKeyDown:function(T){T.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});vn.addInitHook("addHandler","boxZoom",k7),vn.mergeOptions({doubleClickZoom:!0});var O7=Fd.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(T){var k=this._map,B=k.getZoom(),W=k.options.zoomDelta,X=T.originalEvent.shiftKey?B-W:B+W;k.options.doubleClickZoom==="center"?k.setZoom(X):k.setZoomAround(T.containerPoint,X)}});vn.addInitHook("addHandler","doubleClickZoom",O7),vn.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var x7=Fd.extend({addHooks:function(){if(!this._draggable){var T=this._map;this._draggable=new Kf(T._mapPane,T._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),T.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),T.on("zoomend",this._onZoomEnd,this),T.whenReady(this._onZoomEnd,this))}yi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Ir(this._map._container,"leaflet-grab"),Ir(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var T=this._map;if(T._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var k=z(this._map.options.maxBounds);this._offsetLimit=G(this._map.latLngToContainerPoint(k.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(k.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;T.fire("movestart").fire("dragstart"),T.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(T){if(this._map.options.inertia){var k=this._lastTime=+new Date,B=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(B),this._times.push(k),this._prunePositions(k)}this._map.fire("move",T).fire("drag",T)},_prunePositions:function(T){for(;this._positions.length>1&&T-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var T=this._map.getSize().divideBy(2),k=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=k.subtract(T).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(T,k){return T-(T-k)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var T=this._draggable._newPos.subtract(this._draggable._startPos),k=this._offsetLimit;T.x<k.min.x&&(T.x=this._viscousLimit(T.x,k.min.x)),T.y<k.min.y&&(T.y=this._viscousLimit(T.y,k.min.y)),T.x>k.max.x&&(T.x=this._viscousLimit(T.x,k.max.x)),T.y>k.max.y&&(T.y=this._viscousLimit(T.y,k.max.y)),this._draggable._newPos=this._draggable._startPos.add(T)}},_onPreDragWrap:function(){var T=this._worldWidth,k=Math.round(T/2),B=this._initialWorldOffset,W=this._draggable._newPos.x,X=(W-k+B)%T+k-B,le=(W+k+B)%T-k-B,be=Math.abs(X+B)<Math.abs(le+B)?X:le;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=be},_onDragEnd:function(T){var k=this._map,B=k.options,W=!B.inertia||T.noInertia||this._times.length<2;if(k.fire("dragend",T),W)k.fire("moveend");else{this._prunePositions(+new Date);var X=this._lastPos.subtract(this._positions[0]),le=(this._lastTime-this._times[0])/1e3,be=B.easeLinearity,Pe=X.multiplyBy(be/le),_e=Pe.distanceTo([0,0]),Ke=Math.min(B.inertiaMaxSpeed,_e),bt=Pe.multiplyBy(Ke/_e),ii=Ke/(B.inertiaDeceleration*be),en=bt.multiplyBy(-ii/2).round();!en.x&&!en.y?k.fire("moveend"):(en=k._limitOffset(en,k.options.maxBounds),P(function(){k.panBy(en,{duration:ii,easeLinearity:be,noMoveStart:!0,animate:!0})}))}}});vn.addInitHook("addHandler","dragging",x7),vn.mergeOptions({keyboard:!0,keyboardPanDelta:80});var L7=Fd.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(T){this._map=T,this._setPanDelta(T.options.keyboardPanDelta),this._setZoomDelta(T.options.zoomDelta)},addHooks:function(){var T=this._map._container;T.tabIndex<=0&&(T.tabIndex="0"),ki(T,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),wr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var T=document.body,k=document.documentElement,B=T.scrollTop||k.scrollTop,W=T.scrollLeft||k.scrollLeft;this._map._container.focus(),window.scrollTo(W,B)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(T){var k=this._panKeys={},B=this.keyCodes,W,X;for(W=0,X=B.left.length;W<X;W++)k[B.left[W]]=[-1*T,0];for(W=0,X=B.right.length;W<X;W++)k[B.right[W]]=[T,0];for(W=0,X=B.down.length;W<X;W++)k[B.down[W]]=[0,T];for(W=0,X=B.up.length;W<X;W++)k[B.up[W]]=[0,-1*T]},_setZoomDelta:function(T){var k=this._zoomKeys={},B=this.keyCodes,W,X;for(W=0,X=B.zoomIn.length;W<X;W++)k[B.zoomIn[W]]=T;for(W=0,X=B.zoomOut.length;W<X;W++)k[B.zoomOut[W]]=-T},_addHooks:function(){ki(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){wr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(T){if(!(T.altKey||T.ctrlKey||T.metaKey)){var k=T.keyCode,B=this._map,W;if(k in this._panKeys){if(!B._panAnim||!B._panAnim._inProgress)if(W=this._panKeys[k],T.shiftKey&&(W=$(W).multiplyBy(3)),B.options.maxBounds&&(W=B._limitOffset($(W),B.options.maxBounds)),B.options.worldCopyJump){var X=B.wrapLatLng(B.unproject(B.project(B.getCenter()).add(W)));B.panTo(X)}else B.panBy(W)}else if(k in this._zoomKeys)B.setZoom(B.getZoom()+(T.shiftKey?3:1)*this._zoomKeys[k]);else if(k===27&&B._popup&&B._popup.options.closeOnEscapeKey)B.closePopup();else return;Gg(T)}}});vn.addInitHook("addHandler","keyboard",L7),vn.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var F7=Fd.extend({addHooks:function(){ki(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){wr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(T){var k=l7(T),B=this._map.options.wheelDebounceTime;this._delta+=k,this._lastMousePos=this._map.mouseEventToContainerPoint(T),this._startTime||(this._startTime=+new Date);var W=Math.max(B-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(o(this._performZoom,this),W),Gg(T)},_performZoom:function(){var T=this._map,k=T.getZoom(),B=this._map.options.zoomSnap||0;T._stop();var W=this._delta/(this._map.options.wheelPxPerZoomLevel*4),X=4*Math.log(2/(1+Math.exp(-Math.abs(W))))/Math.LN2,le=B?Math.ceil(X/B)*B:X,be=T._limitZoom(k+(this._delta>0?le:-le))-k;this._delta=0,this._startTime=null,be&&(T.options.scrollWheelZoom==="center"?T.setZoom(k+be):T.setZoomAround(this._lastMousePos,k+be))}});vn.addInitHook("addHandler","scrollWheelZoom",F7);var EUe=600;vn.mergeOptions({tapHold:yt.touchNative&&yt.safari&&yt.mobile,tapTolerance:15});var $7=Fd.extend({addHooks:function(){ki(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){wr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(T){if(clearTimeout(this._holdTimeout),T.touches.length===1){var k=T.touches[0];this._startPos=this._newPos=new x(k.clientX,k.clientY),this._holdTimeout=setTimeout(o(function(){this._cancel(),this._isTapValid()&&(ki(document,"touchend",Mo),ki(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",k))},this),EUe),ki(document,"touchend touchcancel contextmenu",this._cancel,this),ki(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function T(){wr(document,"touchend",Mo),wr(document,"touchend touchcancel",T)},_cancel:function(){clearTimeout(this._holdTimeout),wr(document,"touchend touchcancel contextmenu",this._cancel,this),wr(document,"touchmove",this._onMove,this)},_onMove:function(T){var k=T.touches[0];this._newPos=new x(k.clientX,k.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(T,k){var B=new MouseEvent(T,{bubbles:!0,cancelable:!0,view:window,screenX:k.screenX,screenY:k.screenY,clientX:k.clientX,clientY:k.clientY});B._simulated=!0,k.target.dispatchEvent(B)}});vn.addInitHook("addHandler","tapHold",$7),vn.mergeOptions({touchZoom:yt.touch,bounceAtZoomLimits:!0});var B7=Fd.extend({addHooks:function(){yi(this._map._container,"leaflet-touch-zoom"),ki(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Ir(this._map._container,"leaflet-touch-zoom"),wr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(T){var k=this._map;if(!(!T.touches||T.touches.length!==2||k._animatingZoom||this._zooming)){var B=k.mouseEventToContainerPoint(T.touches[0]),W=k.mouseEventToContainerPoint(T.touches[1]);this._centerPoint=k.getSize()._divideBy(2),this._startLatLng=k.containerPointToLatLng(this._centerPoint),k.options.touchZoom!=="center"&&(this._pinchStartLatLng=k.containerPointToLatLng(B.add(W)._divideBy(2))),this._startDist=B.distanceTo(W),this._startZoom=k.getZoom(),this._moved=!1,this._zooming=!0,k._stop(),ki(document,"touchmove",this._onTouchMove,this),ki(document,"touchend touchcancel",this._onTouchEnd,this),Mo(T)}},_onTouchMove:function(T){if(!(!T.touches||T.touches.length!==2||!this._zooming)){var k=this._map,B=k.mouseEventToContainerPoint(T.touches[0]),W=k.mouseEventToContainerPoint(T.touches[1]),X=B.distanceTo(W)/this._startDist;if(this._zoom=k.getScaleZoom(X,this._startZoom),!k.options.bounceAtZoomLimits&&(this._zoom<k.getMinZoom()&&X<1||this._zoom>k.getMaxZoom()&&X>1)&&(this._zoom=k._limitZoom(this._zoom)),k.options.touchZoom==="center"){if(this._center=this._startLatLng,X===1)return}else{var le=B._add(W)._divideBy(2)._subtract(this._centerPoint);if(X===1&&le.x===0&&le.y===0)return;this._center=k.unproject(k.project(this._pinchStartLatLng,this._zoom).subtract(le),this._zoom)}this._moved||(k._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var be=o(k._move,k,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=P(be,this,!0),Mo(T)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,M(this._animRequest),wr(document,"touchmove",this._onTouchMove,this),wr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});vn.addInitHook("addHandler","touchZoom",B7),vn.BoxZoom=k7,vn.DoubleClickZoom=O7,vn.Drag=x7,vn.Keyboard=L7,vn.ScrollWheelZoom=F7,vn.TapHold=$7,vn.TouchZoom=B7,i.Bounds=V,i.Browser=yt,i.CRS=q,i.Canvas=R7,i.Circle=Kx,i.CircleMarker=PE,i.Class=R,i.Control=ku,i.DivIcon=C7,i.DivOverlay=$d,i.DomEvent=WTe,i.DomUtil=HTe,i.Draggable=Kf,i.Evented=O,i.FeatureGroup=ph,i.GeoJSON=fh,i.GridLayer=SS,i.Handler=Fd,i.Icon=_I,i.ImageOverlay=NE,i.LatLng=H,i.LatLngBounds=j,i.Layer=Ou,i.LayerGroup=AI,i.LineUtil=aUe,i.Map=vn,i.Marker=DE,i.Mixin=QTe,i.Path=Yf,i.Point=x,i.PolyUtil=eUe,i.Polygon=kI,i.Polyline=hh,i.Popup=AE,i.PosAnimation=c7,i.Projection=oUe,i.Rectangle=_7,i.Renderer=mh,i.SVG=US,i.SVGOverlay=P7,i.TileLayer=xI,i.Tooltip=_E,i.Transformation=ie,i.Util=N,i.VideoOverlay=D7,i.bind=o,i.bounds=G,i.canvas=N7,i.circle=fUe,i.circleMarker=hUe,i.control=IS,i.divIcon=TUe,i.extend=r,i.featureGroup=uUe,i.geoJSON=U7,i.geoJson=vUe,i.gridLayer=UUe,i.icon=dUe,i.imageOverlay=yUe,i.latLng=K,i.latLngBounds=z,i.layerGroup=cUe,i.map=qTe,i.marker=pUe,i.point=$,i.polygon=gUe,i.polyline=mUe,i.popup=wUe,i.rectangle=CUe,i.setOptions=m,i.stamp=l,i.svg=A7,i.svgOverlay=bUe,i.tileLayer=E7,i.tooltip=SUe,i.transformation=ue,i.version=n,i.videoOverlay=IUe;var MUe=window.L;i.noConflict=function(){return window.L=MUe,this},window.L=i})})(nV,nV.exports);var _M=nV.exports;function tit(){try{return navigator||window.navigator}catch{return}}function iit({coords:t,callback:e}){let i=16;(!(t!=null&&t.latitude)||!(t!=null&&t.longitude))&&(t={latitude:0,longitude:0},i=2);let n={map:"latLongMap",link:"latLonglink"},a=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${Nr.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${n.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${n.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `;ir({content:a,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?u():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&u(),pt(e)&&e(t)},intent:"is-info",label:"Submit",close:!0}]});const c=L0e(n),u=()=>{const g=c.link.element.value,v=Jtt(g)||Qtt(g)||Xtt(g)||eit(g);v.latitude?m(v):g&&v.latitude===void 0&&ai({message:"Invalid URL"})},d=g=>{g.which===13&&u()};let{map:p,marker:h}=nit({successElement:c.map.element,mapElementId:c.map.id,coords:t,zoom:i});c.link.element.value="",c.link.element.focus(),c.link.element.addEventListener("keyup",d),p&&(p.on("click",g=>f({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function f({latitude:g,longitude:v}){t={latitude:g,longitude:v};let y=new _M.LatLng(g,v);h.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){if(g&&v)return t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0;t={latitude:0,longitude:0},p.fitWorld()}}function nit({successElement:t,mapElementId:e,coords:i,zoom:n}){let r=tit();if(!(r!=null&&r.onLine))return{};if(n=n===void 0?16:n,i.latitude!==void 0&&i.longitude!==void 0)return t&&(t.style.display="inline"),a(i.latitude,i.longitude,n);return{};function a(o,s,l){if(isNaN(o)||isNaN(s))return{};let c=cn.locations.map_view||"map",u=_M.tileLayer(cn.leaflet[c].tileLayer,{attribution:cn.leaflet[c].attribution,maxZoom:cn.leaflet[c].maxZoom}),d=_M.map(e).fitWorld().addLayer(u);o&&s&&d.setView([+o,+s],l);let p=_M.marker([+o,+s]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function rit(t,e){const i=e.getRow().getData(),{latitude:n,longitude:r}=(i==null?void 0:i.address)||{};iit({coords:{latitude:n,longitude:r},callback:(o={})=>{i.address||(i.address={});const s=i.venue;s.addresses||(s.addresses=[]),s.addresses.length?Object.assign(s.addresses[0],{latitude:o.latitude,longitude:o.longitude}):s.addresses.push({latitude:o.latitude,longitude:o.longitude});const l=u=>{var d,p;if(console.log({result:u}),(p=(d=u.results)==null?void 0:d[0])!=null&&p.success){const h=e.getTable();i.address.latitude=o.latitude,i.address.longitude=o.longitude,i.hasLocation=o.latitude&&o.longitude,h.updateData([i])}},c=[{method:s9e,params:{venueId:i.venueId,modifications:{addresses:s.addresses}}}];console.log({methods:c}),Pt({methods:c,callback:l})}})}function ait(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{headerMenu:lh({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:At,width:55},{cellClick:jv,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:jv,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:At,field:"courtsCount",hozAlign:At,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:At,headerSort:!0,hozAlign:At,visible:!0,minWidth:120},{title:"Time",headerHozAlign:At,field:"availableTime",headerSort:!0,hozAlign:At,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:At,cellClick:rit,field:"hasLocation",headerSort:!1,hozAlign:At,visible:!0,width:50},{cellClick:jv,formatter:_6,responsive:!1,headerSort:!1,hozAlign:vt,field:"isOpen",width:20},{cellClick:t,formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,width:50}]}function oit({table:t}={}){const e=()=>{const{venues:r}=Sg.getVenuesAndCourts();return{rows:r.map(LSe)}},i=()=>{const{rows:r}=e();t==null||t.replaceData(r)},n=ait();if(t)i();else{oh({anchorId:DR});const r=document.getElementById(DR),{rows:a}=e();t=new na(r,{headerSortElement:sh(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:Ztt,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:n,data:a}),t.on("scrollVertical",vc),t.on("cellEdited",o=>{const s=o.getColumn().getDefinition(),l=o.getRow().getData(),c=o.getValue();console.log({cell:o,row:l,value:c,def:s})})}return{table:t,replaceTableData:i}}function sit({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?ho({table:t,target:i,items:[{onClick:()=>{const a=t.getSelectedData().map(({venueId:l})=>l);Pt({methods:[{method:n9e,params:{venueIds:a,force:!0}}],callback:l=>l.success&&t.deleteRow(a)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{label:"Add venue",onClick:()=>A0e(e),location:vt,id:"addVenue",intent:"none"}]}).elements:void 0}function lit(){const t=document.getElementById(sW),{table:e}=oit();sit({table:e,controlAnchor:t,updateVenueRow:({venue:n})=>{e.updateOrAddData([LSe(n)])}})}const{POLICY_TYPE_AVOIDANCE:uX}=lg;function FSe({eventId:t,drawId:e}){var i,n,r;return(r=(n=(i=$e.getPolicyDefinitions({policyTypes:[uX],eventId:t,drawId:e}))==null?void 0:i.policyDefinitions)==null?void 0:n[uX])==null?void 0:r.policyAttributes}const rV={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function cit({event:t}){const e=FSe({eventId:t.eventId}),i=(e==null?void 0:e.map(r=>Object.keys(rV).find(a=>rV[a].some(s=>s.directive&&s.directive===r.directive||s.key&&s.key===r.key))).filter(Boolean))??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i==null?void 0:i.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function $Se({eventId:t}){const e=$e.getEvent({eventId:t}).event;if(!e)return;const{items:i}=cit({event:e});let n;const r=!0,a=u=>n=Wr(u,i),s=[{label:"Cancel",intent:ct,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(n).filter(f=>n[f].checked).flatMap(f=>rV[f]).filter(Boolean);Pt({methods:[{method:Q8e,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:f=>{if(f.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else ai({message:"Error",intent:"is-danger"})}})},close:r}],l="Set avoidances",c=(u,d)=>PI(u,s,d);Ye.drawer.open({title:l,content:a,footer:c,side:vt,width:"300px"})}const{WTN:uit,UTR:dit}=mo.ratingConstants,{TEAM:pit}=mo.eventConstants,{QUALIFYING:dX}=tr;function Ex({entry:t,derivedDrawInfo:e,participants:i,participant:n,eventType:r,eventId:a}){var g,v,y,I,b,D,w,S,U,C,E,P;n=n||(i==null?void 0:i.find(M=>M.participantId===t.participantId));const o=(g=n==null?void 0:n.draws)==null?void 0:g.filter(M=>M.eventId===a).map(M=>({...M,drawName:e[M.drawId].drawName})),s=(y=(v=n==null?void 0:n.person)==null?void 0:v.addresses)==null?void 0:y[0],l=s?`${s.city}, ${s.state}`:void 0,c=r===pit?"AVERAGE":r,u=(D=(b=(I=n==null?void 0:n.ratings)==null?void 0:I[c])==null?void 0:b.find(M=>M.scaleName===uit))==null?void 0:D.scaleValue,d=(U=(S=(w=n==null?void 0:n.ratings)==null?void 0:w[c])==null?void 0:S.find(M=>M.scaleName===dit))==null?void 0:U.scaleValue,p={wtn:u,utr:d},h=t.entryStage===dX?`${a}${dX}`:a,f=(P=(E=(C=n==null?void 0:n.seedings)==null?void 0:C[r])==null?void 0:E.find(M=>M.scaleName===h))==null?void 0:P.scaleValue,m=ace[t.entryStatus];return{searchText:n==null?void 0:n.participantName.toLowerCase(),participant:n,seedNumber:f,cityState:l,...t,ratings:p,flights:o,status:m}}function Bu(t){return hi.isConvertableInteger(t)&&parseInt(t)>=0}const BSe=(t,e)=>i=>Bu(i)&&i>=t&&i<=e,{ORGANISER_ACCEPTANCE:hit,DIRECT_ACCEPTANCE:fit,SPECIAL_EXEMPT:mit,JUNIOR_EXEMPT:git,WILDCARD:vit}=Gl,{MAIN:yit}=tr,WN=(t=yit)=>[`${t}.${fit}`,`${t}.${hit}`,`${t}.${mit}`,`${t}.${git}`,`${t}.${vit}`],{MAIN:pX}=tr;function aV(t,e=pX){return t.entries.filter(({entryStage:i=pX,entryStatus:n})=>WN(e).includes(`${i}.${n}`)).length}const{FEED_IN:Iit,LUCKY_DRAW:bit,MAIN:wit,QUALIFYING:Sit,ROUND_ROBIN:hX,ROUND_ROBIN_WITH_PLAYOFF:T1}=tr;function Tit({event:t,isQualifying:e,maxQualifiers:i}){const n=e?Sit:wit,r=({fields:p,inputs:h})=>{var D;const f=h[lm].value||0,m=Bu(f)?parseInt(f):0,g=aV(t,n),v=h.qualifiersCount.value||0,y=Bu(v)?parseInt(v):0,I=i||e&&m<g||m<g+y;I&&(h[Ps].value=Yz);const b=(D=hf(p[Ps],"help"))==null?void 0:D[0];b.style.display=I?"":ct;for(const w of h[Ps].options)w.label===Ps&&(w.disabled=I)},a=({drawType:p,fields:h,inputs:f})=>{const m=i?f[lm].value:aV(t,n),g=f.qualifiersCount.value||1,v=Bu(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,I=(i||[bit,Iit,hX,T1].includes(p))&&y||hi.nextPowerOf2(y);return f[lm].value=I,r({fields:h,inputs:f}),I},o=({fields:p,inputs:h})=>{let f=parseInt(h[lm].value);const m=h.qualifiersCount.value;Bu(m)&&parseInt(m)<1&&(h.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g.disabled=!1,i&&Bu(v)&&parseInt(v)>i)h.qualifiersCount.value=i;else if(!i){const y=h[Gu].value;f=a({drawType:y,fields:p,inputs:h})}v=h.qualifiersCount.value,g&&(!Bu(v)||f<=parseInt(v))&&(g.disabled=!0)},s=({e:p,fields:h,inputs:f})=>{const m=f[pT].value,g=p.target.value;i||a({drawType:g,fields:h,inputs:f}),r({fields:h,inputs:f}),h[nb].style.display=g===T1&&m===hT?"":ct,h[pT].style.display=g===T1?"":ct;const v=[hX,T1].includes(g);h[Xd].style.display=v?"":ct},l=({fields:p,inputs:h})=>{const f=document.getElementById("generateDraw"),m=h[lm].value||0,g=BSe(2,128)(m);f.disabled=!g;const v=Bu(m)?parseInt(m):0,{validGroupSizes:y}=$e.getValidGroupSizes({drawSize:v,groupSizeLimit:8}),I=y.map(w=>({label:w,value:w})),b=h[Xd],D=y.includes(v)?4:y[0];lo(b),s6(b,{options:I,value:D}),r({fields:p,inputs:h})},c=({e:p,fields:h})=>{const f=p.target.value;h[nb].style.display=f===hT?"":ct,h[RR].style.display=f===hT?"":ct},u=({inputs:p})=>{const h=parseInt(p[Xd].value),f=p[nb].options,m=Array.from(f).map(v=>parseInt(v.value)),g=Math.max(...m);g>h?hi.generateRange(h+1,g+1).reverse().forEach(v=>{p[nb].remove(v-2)}):g<h&&hi.generateRange(g+1,h+1).forEach(v=>p[nb].add(new Option(v,v)))},d=({inputs:p,name:h})=>{const f=p[h].value,m=document.getElementById("generateDraw"),g=$l(4)(f);m.disabled=!g};return[{onInput:({inputs:p})=>d({inputs:p,name:ny}),control:ny},{onInput:({inputs:p})=>d({inputs:p,name:gU}),control:gU},{onChange:u,control:Xd},{onChange:s,control:Gu},{onChange:c,control:pT},{onInput:l,control:lm},{onInput:o,control:MR}]}const{AD_HOC:Uit,COMPASS:Dit,CURTIS:Pit,DOUBLE_ELIMINATION:Cit,FEED_IN_CHAMPIONSHIP:Eit,FEED_IN:Mit,FIRST_MATCH_LOSER_CONSOLATION:Rit,FIRST_ROUND_LOSER_CONSOLATION:Nit,LUCKY_DRAW:Ait,OLYMPIC:_it,PLAY_OFF:kit,ROUND_ROBIN:Oit,ROUND_ROBIN_WITH_PLAYOFF:xit,SINGLE_ELIMINATION:Lit}=tr;function VSe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:Uit,hide:e},{label:"Compass",value:Dit,hide:e},{label:"Curtis consolation",value:Pit,hide:e},{label:"Double elimination",value:Cit,hide:t||e},{label:"Elimination: fed consolation",value:Eit,hide:e},{label:"First match loser consolation",value:Rit,hide:e},{label:"First round loser consolation",value:Nit,hide:e},{label:"Lucky",value:Ait,hide:t||e},{label:"Olympic",value:_it,hide:e},{label:"Playoff",value:kit,hide:e},{label:"Round robin w/ playoff",value:xit,hide:t||e},{label:"Round robin",value:Oit},{label:"Single elimination",value:Lit},{label:"Staggered Entry",value:Mit,hide:t||e}]}const{POLICY_TYPE_SCORING:Fit}=lg,{MAIN:$it}=tr,Bit={[Fit]:{requireAllPositionsAssigned:!1,stage:{[$it]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"}]}},{ROUND_ROBIN:Vit,ROUND_ROBIN_WITH_PLAYOFF:fX,SINGLE_ELIMINATION:jit,QUALIFYING:Git,MAIN:mX}=tr,{DOMINANT_DUO:Hit,TIME_TENNIS_DUAL:zit,TIME_TENNIS_PRO_CIRCUIT:Wit}=mo.tieFormatConstants,{POLICY_TYPE_SCORING:qit}=lg,{TEAM:gX}=Xo,{ENTRY_PROFILE:Kit}=mo.extensionConstants;function Yit({event:t,drawId:e,isQualifying:i,structureId:n}){var w,S,U,C,E,P;const r=i?Git:mX,a=((w=t.drawDefinitions)==null?void 0:w.length)||0;let o=jit;const s=e&&((S=t.drawDefinitions)==null?void 0:S.find(M=>M.drawId===e)),l=n&&((U=$e.getPositionAssignments({drawId:e,structureId:n}))==null?void 0:U.positionAssignments),c=(E=(C=$e.findExtension({element:s,name:Kit}))==null?void 0:C.extension)==null?void 0:E.value,u=n?1:0,d=!n&&((P=c==null?void 0:c[mX])==null?void 0:P.qualifiersCount)||u,p="Qualifying",h=(l==null?void 0:l.length)||hi.nextPowerOf2(aV(t,r)),f=[{label:"Custom",value:ER}].concat(Bit[qit].matchUpFormats.map(({matchUpFormat:M,description:N})=>({selected:M==="SET3-S:6/TB7",value:M,label:N}))),m=[{label:"Time Tennis Pro Circuit",value:Wit},{label:"Time Tennis",value:zit},{label:"Dominant Duo",value:Hit,selected:!0},{label:"Custom",value:ER}],{validGroupSizes:g}=$e.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),v=g.map(M=>({label:M,value:M})),y=[{label:"Group winners",value:eOe},{label:"Group positions",value:oce},{label:"Top finishers",value:hT}],I=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],b=[{label:Ps,value:Ps,selected:!n,disabled:!!n},{label:Yz,value:!1,selected:n}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:$l(4),label:"Structure name",value:p,field:gU,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${a+1}`,validator:$l(4),selectOnFocus:!0,hide:i,label:"Draw name",field:ny,focus:!0},{options:VSe({isQualifying:i}),label:"Draw Type",field:Gu,value:o},{error:"Must be in range 2-128",validator:BSe(2,128),selectOnFocus:!0,label:"Draw size",value:h,field:lm},{visible:[Vit,fX].includes(o),options:v,label:"Group size",field:Xd,value:4},{visible:[fX].includes(o),options:y,label:"Playoff Type",field:pT},{label:"Advance per group",options:I,field:nb,visible:!1},{label:"2nd playoff from remaining",field:RR,id:RR,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:b,label:"Creation",field:Ps,value:""},{hide:t.eventType===gX,options:f,field:fW,label:"Score format",value:""},{hide:t.eventType!==gX,options:m,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!n,validator:Bu,field:MR,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function vX({eventId:t,drawOptions:e,callback:i}){var a;const n={scaleAccessor:"wtnRating",scaleName:"WTN"},r=$e.generateDrawDefinition({...e,...n,ignoreStageSpace:!0});if(r.success){const o=r.drawDefinition;Pt({methods:[{method:W8e,params:{eventId:t,drawDefinition:o,allowReplacement:!0}}],callback:c=>pt(i)&&i({drawDefinition:o,...c})})}else r.error&&ai({message:((a=r.error)==null?void 0:a.message)||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:Zit}=lg,{SEPARATE:Xit}=tr,{SEEDING:Jit}=a0,jSe={[Zit]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:Xit,policyName:Jit,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:Qit,FEED_IN:ent,LUCKY_DRAW:tnt,MAIN:int,QUALIFYING:nnt,ROUND_ROBIN:yX,ROUND_ROBIN_WITH_PLAYOFF:IX}=tr,{TIME_TENNIS_PRO_CIRCUIT:rnt}=mo.tieFormatConstants,{DIRECT_ENTRY_STATUSES:bX}=Gl,{POLICY_TYPE_ROUND_NAMING:ant}=lg;function wX({drawName:t,matchUpFormat:e,isQualifying:i,structureId:n,callback:r,inputs:a,drawId:o,event:s}){var P,M,N,R,A,_,O,x,F;const l=a[Gu].options[a[Gu].selectedIndex].getAttribute("value");e=e||((P=a[fW])==null?void 0:P.value);const c=(M=a[gU])==null?void 0:M.value,u=(N=a.tieFormatName)==null?void 0:N.value,d=(R=a[ny])==null?void 0:R.value,p=a[lm].value||0,h=parseInt(a[Xd].value),f=hi.isConvertableInteger(p)&&parseInt(p),m=[tnt,ent,yX,IX].includes(l)&&f||hi.nextPowerOf2(f),g=s.entries.filter(({entryStage:$,entryStatus:V})=>$===nnt&&bX.includes(V)),v=i&&g.length?g:s.entries.filter(({entryStage:$,entryStatus:V})=>(!$||$===int)&&bX.includes(V)),y=m<v.length?!1:a[Ps].value===Ps,I=s.eventId,b={drawEntries:v,automated:y,eventId:I,drawId:o},D=parseInt(((A=a.advancePerGroup)==null?void 0:A.value)||0),w=(_=a[RR])==null?void 0:_.checked,S=(O=a[pT])==null?void 0:O.value;let U;if(l===IX){const $=[];if(S===hT){const V=[hi.generateRange(1,D+1)];if(w){const G=hi.generateRange(D+1,h+1);G.length&&V.push(G)}V.forEach((G,j)=>{$.push({structureName:`Playoff ${j+1}`,finishingPositions:G})})}else S===oce&&hi.generateRange(1,h+1).forEach(V=>{$.push({structureName:`Playoff ${V}`,finishingPositions:[V]})});U={groupSize:h},$.length&&(U.playoffGroups=$)}else l===yX?U={groupSize:h}:l===Qit&&Object.assign(b,{roundsCount:1});const C=(x=$e.getSeedsCount({participantsCount:v==null?void 0:v.length,policyDefinitions:jSe,drawSizeProgression:!0}))==null?void 0:x.seedsCount,E=Bu(a[MR].value)&&parseInt((F=a[MR])==null?void 0:F.value)||0;if(n){const $=$e.generateQualifyingStructure({qualifyingPositions:E,targetStructureId:n,structureOptions:U,matchUpFormat:e,structureName:c,automated:y,drawSize:m,drawType:l,drawId:o});if($.success){const V=[{method:J8e,params:{structure:$.structure,link:$.link,eventId:I,drawId:o}}];Pt({methods:V,callback:j=>{var z;return pt(r)&&r({...$,...(z=j.results)==null?void 0:z[0]})}})}return}if(i?(b.drawName=t,b.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:E,structureOptions:U,matchUpFormat:e,structureName:c,seedsCount:C,drawSize:m,drawType:l}]}]):(E&&(b.qualifiersCount=E,b.qualifyingPlaceholder=!0),Object.assign(b,{seedingScaleName:I,structureOptions:U,matchUpFormat:e,seedsCount:C,drawName:d,drawSize:m,drawType:l})),f)if(u===ER)CSe({title:"Custom scorecard",onClose:V=>{V&&(b.tieFormat=V,vX({drawOptions:b,eventId:I,callback:r}))}});else{if(b.tieFormatName=u,u===rnt){const $={[ant]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};b.policyDefinitions={...$}}vX({drawOptions:b,eventId:I,callback:r})}else ai({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function zw({eventId:t,callback:e,drawId:i,drawName:n,structureId:r,isQualifying:a}){const o=$e.getEvent({eventId:t}).event;if(!o)return;const{items:s,structurePositionAssignments:l}=Yit({event:o,drawId:i,isQualifying:a,structureId:r}),c=Tit({maxQualifiers:l==null?void 0:l.length,isQualifying:a,event:o});let u;const d=v=>{u=Wr(v,s,c)},p=()=>a?$l(4)(u[gU].value):$l(4)(u[ny].value),f=[{label:"Cancel",intent:ct,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{var v;p()?((v=u.matchUpFormat)==null?void 0:v.value)===ER?G6({callback:I=>{I&&wX({event:o,inputs:u,callback:e,structureId:r,matchUpFormat:I,drawId:i,drawName:n,isQualifying:a})}}):wX({event:o,inputs:u,callback:e,structureId:r,drawId:i,drawName:n,isQualifying:a}):ai({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>PI(v,f,y);Ye.drawer.open({title:m,content:d,footer:g,side:vt,width:"300px"})}const{SINGLES:ont}=Xo,snt=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=l=>t({...l,renderDraw:!0}),a=e.getValue(),o=e.getRow().getData(),{participantId:s}=o;return a==null||a.forEach(l=>{const c=lnt({def:i,participantId:s,flight:l,flightClick:r});n.appendChild(c)}),n};function lnt({flight:t,flightClick:e}){var n,r;const i=document.createElement("span");return pt(e)&&(i.onclick=()=>e(t)),i.className="tag event-pill",(n=t.gender)!=null&&n.toLowerCase().includes("female")?i.classList.add("is-danger"):(r=t.gender)!=null&&r.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===ont&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:cnt,QUALIFYING:PF}=tr,{DIRECT_ACCEPTANCE:SX}=Gl;function GSe({participantIds:t,group:e,eventId:i,drawId:n,callback:r}){Pt({methods:[{method:h0e,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===sc&&SX||e===PF&&SX||e,entryStage:e===PF?PF:cnt,eventId:i,drawId:n}}],callback:r})}const{ALTERNATE:TX,DIRECT_ACCEPTANCE:UX,WITHDRAWN:DX,UNGROUPED:unt}=Gl,{QUALIFYING:PX}=tr,dnt=(t,e,i)=>(n,r)=>{const{participant:a}=r.getRow().getData(),o=c=>()=>{const u=p=>{var h;if(p.success){const f=r.getRow(),m=c===sc?UX:c;(h=Ye.tables[m])==null||h.addRow(f.getData()),f.delete()}else console.log({result:p})},d=[a.participantId];GSe({participantIds:d,callback:u,eventId:e,drawId:i,group:c})},s=()=>{const c=$e.destroyPairEntry({participantIds:[a.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:c})};let l=[{onClick:o(UX),option:"Move to accepted",action:sc},{onClick:o(PX),option:"Move to qualifying",action:PX},{onClick:o(TX),option:"Move to alternates",action:TX},{onClick:s,option:"Unpair players",action:unt},{onClick:o(DX),option:"Withdraw participant",action:DX}].filter(c=>t.includes(c.action));if(l.length){const c=n.target;nl({options:l,target:c,config:{placement:Ef}})}},{WTN:pnt,UTR:hnt}=mo.ratingConstants;function fnt({entries:t,exclude:e=[],eventId:i,drawId:n,actions:r=[],drawCreated:a}={}){const o=t.find(d=>{var p;return(p=d.ratings)==null?void 0:p.utr}),s=t.find(d=>{var p;return(p=d.ratings)==null?void 0:p.wtn}),l=t.find(d=>d.cityState),c=t.find(d=>d.seedNumber),u=t.find(d=>d.ranking);return[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!a,headerSort:!1,responsive:!1,hozAlign:Et,width:5},{headerMenu:lh(),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:At,resizable:!1,width:50},{formatter:d=>EI()(d,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!u,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{sorterParams:{alignEmptyValues:"bottom"},field:"ratings.wtn.wtnRating",visible:!!s,resizable:!1,sorter:"number",title:pnt,width:70},{sorterParams:{alignEmptyValues:"bottom"},field:"ratings.utr.utrRating",visible:!!o,resizable:!1,sorter:"number",title:hnt,width:70},{visible:!!l,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:H2({maxValue:(t==null?void 0:t.length)||0,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!c,field:"seedNumber",hozAlign:At,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:snt(zn),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:dnt(r,i,n),formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,maxWidth:40}].filter(({field:d})=>Array.isArray(e)&&!(e!=null&&e.includes(d)))}function HSe(){const t=$e.getTournament().tournamentRecord.tournamentId,e=`/${xa}/${t}/${Vu}`;Ye.router.navigate(e)}function zSe(t,e){vx({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:mnt}=a0;function WSe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:n}){Pt({methods:[{method:m9e,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:mnt},scaleBasis:{scaleType:e},eventId:i}}}],callback:o=>{o.success&&pt(n)&&n()}})}const{QUALIFYING:CX}=tr,{SEEDING:gnt,MANUAL:vnt}=a0;function qSe({event:t,rows:e,callback:i}){const{eventId:n,eventType:r}=t,a=e.map(({entryStage:o,participantId:s,seedNumber:l})=>{const c=o===CX?`${n}${CX}`:n;return{participantId:s,scaleItems:[{scaleValue:l,scaleType:gnt,scaleName:c,eventType:r}]}});WSe({scaleItemsWithParticipantIds:a,scaleBasis:vnt,eventId:n,callback:i})}function KSe({table:t}){const e=t.getRows();let i;for(const n of e){const r=n.getData();i=r.entryStage,r.seedNumber=void 0,n.update(r)}return i}function ynt({event:t,table:e}){KSe({table:e});const i=e.getData();qSe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:Int}=Gl,{QUALIFYING:EX}=tr,MX=t=>e=>{const i=t==null?void 0:t.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:vt,label:"Cancel",visible:!1,onClick:r=>{var f,m;zSe(r,e);const a=KSe({table:e}),o=(f=$e.getEvent({eventId:i}))==null?void 0:f.event,l=((m=o.entries)==null?void 0:m.filter(g=>g.entryStage===a&&g.entryStatus===Int)).map(({participantId:g})=>g),{participants:c}=$e.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),u=a===EX?`${i}${EX}`:i,d=c.map(g=>{var y,I,b;const v=(b=(I=(y=g==null?void 0:g.seedings)==null?void 0:y[o.eventType])==null?void 0:I.find(D=>D.scaleName===u))==null?void 0:b.scaleValue;if(v)return{participantId:g.participantId,seedNumber:v}}).filter(Boolean),p=Object.assign({},...d.map(g=>({[g.participantId]:g}))),h=e.getRows();for(const g of h){const v=g.getData(),y=v.participantId;p[y]&&(v.seedNumber=p[y].seedNumber,g.update(v))}}}};function bnt(t,e){vx({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t})}const{QUALIFYING:U1,MAIN:wnt}=tr,{SEEDING:Snt,RATING:Tnt}=a0,BS={high:[80,100],medium:[60,80],low:[40,60]};function Unt({event:t,group:e,table:i,field:n}){const{eventId:r,eventType:a}=t,{seedsCount:o,stageEntries:s}=$e.getEntriesAndSeedsCount({stage:e===U1?U1:wnt,policyDefinitions:jSe,eventId:r}),c=n==="ratings.wtn.wtnRating"&&((I,b)=>CF(I).wtnRating-CF(b).wtnRating),u=i.getData(),d={high:[],medium:[],low:[]};let p=0;for(const I of u){const b=CF(I);b.wtnRating&&(p+=1),b.confidence>=BS.high[0]?d.high.push(I):b.confidence>=BS.medium[0]&&b.confidence<BS.medium[1]?d.medium.push(I):b.confidence>=BS.low[0]&&b.confidence<BS.low[1]&&d.low.push(I)}const f=(pt(c)&&[].concat(d.high.sort(c),d.medium.sort(c),d.low.sort(c))).slice(0,Math.min(p,o)),m=e===U1?`${r}${U1}`:r,g={scaleType:Snt,scaleName:m,eventType:a},{scaleItemsWithParticipantIds:v}=$e.generateSeedingScaleItems({scaleAttributes:g,scaledEntries:f,stageEntries:s,seedsCount:o,scaleName:m});WSe({scaleItemsWithParticipantIds:v,scaleBasis:Tnt,eventId:r,callback:()=>{const I=Object.assign({},...f.map((D,w)=>({[D.participantId]:w+1}))),b=i.getRows();for(const D of b){const w=D.getData(),S=I[w.participantId];S&&(w.seedNumber=S,D.update(w))}}})}function CF(t){var e;return((e=t.ratings)==null?void 0:e.wtn)||{confidence:0,wtnRating:1/0}}const RX=(t,e)=>i=>{const n={ranking:"Seed by ranking","ratings.wtn.wtnRating":"Seed by WTN"},r=i.getColumns().map(o=>o.getDefinition()).filter(o=>["ranking","ratings.wtn.wtnRating"].includes(o.field)),a=[{label:"Manual seeding",onClick:o=>bnt(o,i),close:!0},{label:"Clear seeding",onClick:()=>ynt({event:t,table:i}),close:!0}].concat(...r.map(o=>({onClick:()=>Unt({event:t,group:e,table:i,field:o.field}),label:n[o.field],value:o.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:vt,align:vt,options:a}},Dnt=(t,e,i,n)=>{const a=t.getSelectedData().filter(u=>{var d;return!((d=u.events)!=null&&d.length)}).map(({participantId:u})=>u),[o,s]=e.split(".");Pt({methods:[{method:h0e,params:{ignoreAssignment:!0,participantIds:a,entryStatus:s,entryStage:o,eventId:i,drawId:n}}],callback:u=>{if(t.deselectRow(),u.success){const d=t.getRows();for(const p of d){const h=p.getData();a.includes(h.participantId)&&(h.status=ace[s],p.update(h))}}else console.log(u.error)}})},Pnt=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>Dnt(n,a,e,i),label:a,value:a,close:!0}));return{location:dr,label:"Change status",options:r}},Cnt=(t,e=0)=>{const i=`${t} <span class='${qle}'>${e}</span>`;return{location:PR,text:i}},ub=({target:t,table:e,close:i})=>{var r,a,o;if(!t)return;const n=ms(t,nv);if(n){const s=(r=n.getElementsByClassName("toggle"))==null?void 0:r[0],l=(a=n.getElementsByClassName(tce))==null?void 0:a[0],c=(o=n.getElementsByClassName(ice))==null?void 0:o[0];if(s){const u=i||s.innerHTML.charCodeAt(0)===9660;l.style.display=u?ct:tw,c.style.display=u?ct:tw,s.parentNode.innerHTML=`<span class='toggle' style='color: white'>${u?D0e:A6}</span>`,u||e.redraw(!0)}}},Ent=t=>{const e=i=>ub({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${A6}</span>`,location:PR,onClick:e}},VS=({heading:t,count:e})=>[Cnt(t,e),i=>Ent(i)],Mnt=(t,e,i)=>(n,r="Search participants")=>{let a,o;const s=l=>{var u;const c=e&&Ty(n.element,"tableClass");if(c){const d=(u=hf(c,"controlBar"))==null?void 0:u[0];if(d){const p=hf(d,"search");Array.from(p).forEach(h=>h.value=l)}}a=e&&n.getSelectedData().map(d=>d[e]),n.removeFilter(o),o=d=>{var p;return((p=d.searchText)==null?void 0:p.includes(l==null?void 0:l.toLowerCase()))||(a==null?void 0:a.length)&&a.includes(d[e])},l&&n.addFilter(o)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&s(""),(l.key==="Enter"||l.keyCode===13)&&pt(i)&&i(n)&&s("")},onChange:l=>s(l.target.value),onKeyUp:l=>s(l.target.value),location:t||Et,class:"search",search:!0,placeholder:r}},NX=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:vt,visible:!1,onClick:n=>{zSe(n,e);const r=e.getData();qSe({event:t,rows:r})}}),{UNGROUPED:AX}=Gl,{DOUBLES:Rnt}=Xo,Nnt=(t,e)=>i=>{const n=r=>{const a=r.getSelectedData(),o=a.filter(c=>{var u;return!((u=c.events)!=null&&u.length)}).map(({participantId:c})=>c);Pt({methods:[{method:r9e,params:{removeGroupParticipant:!0,participantIds:o,eventId:t,drawId:e}}],callback:c=>{var u;if(c!=null&&c.error)r.deselectRow();else{r.deleteRow(o);const p=(u=Ty(r.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:u[0];p&&setTimeout(()=>y6({table:r,target:p})(),100);const h=a.flatMap(({participant:g})=>g==null?void 0:g.individualParticipantIds),{participants:f}=$e.getParticipants({participantFilters:{participantIds:h}}),m=f.map(g=>Ex({entry:{participantId:g.participantId,entryStatus:AX},eventType:Rnt,participant:g}));Ye.tables[AX].updateOrAddData(m)}}})};return{onClick:()=>n(i),label:"Destroy pairs",intent:"is-danger",location:dr}},Ant=(t,e)=>{const n=t.getSelectedData().map(({participantId:s})=>s),r=e.entries.filter(({participantId:s})=>n.includes(s)),a=[{method:z8e,params:{eventId:e.eventId,drawName:"Flight",drawEntries:r}}];Pt({methods:a,callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},_nt=(t,e)=>i=>({onClick:()=>Ant(i,t),label:"Add flight",location:dr,hide:e}),knt=(t,e,i,n)=>{const a=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);GSe({participantIds:a,group:e,eventId:i,drawId:n,callback:s=>{if(s!=null&&s.success){const c=t.getData().filter(({participantId:u})=>a.includes(u));Ye.tables[e].updateOrAddData(c),t.deleteRow(a)}else t.deselectRow()}})},D1=(t,e,i)=>n=>{const r=t.map(a=>({onClick:()=>knt(n,a,e,i),stateChange:!0,label:a,value:a,close:!0}));return{label:"Move participants",location:dr,options:r}},{ASSIGN_PARTICIPANT:Ont}=Ky,EF=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:vt,onClick:()=>{const{entries:r=[],eventId:a,eventType:o}=t,s=(r||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",c=$e.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!s.includes(p.participantId));yE({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!(p!=null&&p.length))return;const h=p.map(({participantId:y})=>y),f=e===kP?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";Pt({methods:[{params:{eventId:a,participantIds:h,entryStatus:m,entryStage:f},method:M6}],callback:y=>{if(y.success){const{participants:I,derivedDrawInfo:b}=$e.getParticipants({participantFilters:{participantIds:h},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),D=h.map(w=>Ex({entry:{participantId:w,entryStage:f,entryStatus:m},derivedDrawInfo:b,participants:I,eventType:o,eventId:a}));i.addRow(D)}}})},action:{type:Ont,participantsAvailable:c}})}}),{ALTERNATE:MF,UNGROUPED:xnt}=Gl,{MAIN:Lnt}=tr,{DOUBLES:_X}=Xo,Fnt=(t,e=!0)=>{const{eventId:i,eventType:n}=t,r=(s,l)=>{const c=l.getSelectedData().map(p=>p.participantId);if(c.length!==2)return;const u=[{method:Y8e,params:{participantIdPairs:[c],entryStatus:MF,entryStage:Lnt,eventId:i}}];Pt({methods:u,callback:p=>{var h,f;if(p.success){l.deleteRow(c),l.clearFilter();const m=Ty(l.element,"tableClass");if(m){const y=(h=hf(m,"controlBar"))==null?void 0:h[0];if(y){const I=hf(y,"search");Array.from(I).forEach(b=>b.value="")}}const g=p.results[0].newParticipantIds,{participants:[v]}=$e.getParticipants({participantFilters:{participantIds:g},withISO2:!0});if(v){const y=Ex({entry:{participantId:v.participantId,entryStatus:MF},eventType:_X,participant:v});Ye.tables[MF].updateOrAddData([y]),o();const b=(f=Ty(s.target,"tableClass").getElementsByClassName("controlBar"))==null?void 0:f[0];b&&setTimeout(()=>y6({table:l,target:b})(),100)}else console.log("participant not found",{participantIds:g,methods:u,result:p})}else console.log({methods:u,result:p})}})},a={hide:n!==_X,label:"Create pair",onClick:r,intent:"is-info",location:dr,id:"create-pair",visible:!1},o=s=>{const l=(s==null?void 0:s.length)===2;if(l&&e){const c=Ye.tables[xnt];r({target:c.element},c)}else{const c=document.getElementById("create-pair");c&&(c.style.display=l?"":ct)}};return{createPairButton:a,createPairFromSelected:o}},{DIRECT_ACCEPTANCE:$nt}=Gl,{MAIN:Bnt}=tr,Vnt=(t,e,i)=>{const r=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);Pt({methods:[{method:q8e,params:{entryStatus:$nt,ignoreStageSpace:!0,entryStage:Bnt,participantIds:r,eventId:e,drawId:i}}],callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},jnt=(t,e)=>i=>{var r;const n=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:a,drawId:o})=>({onClick:()=>Vnt(i,t.eventId,o),stateChange:!0,label:a,value:o,close:!0}));return{hide:!((r=t.drawDefinitions)!=null&&r.length)||e,label:"Add to draw",location:dr,options:n}},{DIRECT_ACCEPTANCE:Gnt,ALTERNATE:Bd,UNGROUPED:kX,WITHDRAWN:Vd}=Gl,{MAIN:JI,QUALIFYING:Qf}=tr,{SINGLES:Hnt,DOUBLES:OX}=Xo;function znt({drawDefinition:t,event:e,entryData:i,hasFlights:n}){const r=v=>i.filter(({entryStage:y=JI,entryStatus:I})=>v.includes(`${y}.${I}`)),a=!!t,o=t==null?void 0:t.drawId,s=e==null?void 0:e.eventId,l={[sc]:[Bd,Vd],[Qf]:[sc,Bd,Vd],[Bd]:[sc,Qf,Vd],[Vd]:[Bd]},{createPairFromSelected:c}=Fnt(e),u=n?[]:["flights"],d=v=>{const y=v.getData("active"),I=y.map(({participantId:b})=>b);if(y.length===1)return v.selectRow(I),!0;y.length===2&&v.selectRow(I)},p=r(WN(JI)),h=r([`${Qf}.${Gnt}`]),f=r([`${JI}.${Bd}`]),m=r([`${JI}.${kX}`]),g=r([`${JI}.${Vd}`]);return[{placeholder:"No accepted participants",items:[D1(l[sc],s,o),Pnt(WN(JI),s,o),jnt(e,o),_nt(e,o),...VS({heading:"Accepted",count:p.length}),!a&&RX(e,sc),MX(e),NX(e),!a&&EF(e,sc)],actions:l[sc],anchorId:Jz,entries:p,group:sc,excludeColumns:u,drawCreated:a,togglePanel:ub},{placeholder:"No qualifying participants",items:[...VS({heading:"Qualifying",count:h.length}),D1(l[Qf],s,o),!a&&RX(e,Qf),MX(e),NX(e),!a&&EF(e,Qf)],actions:[sc,Bd,Vd],anchorId:eW,entries:h,group:Qf,excludeColumns:u,drawCreated:a,togglePanel:ub},{items:[...VS({heading:"Alternates",count:f.length}),D1(l[Bd],s,o),(e==null?void 0:e.eventType)===OX&&Nnt(s,o),!a&&EF(e,Bd)],actions:[sc,Qf,Vd],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:Qz,entries:f,group:Bd,drawCreated:a,togglePanel:ub},{hide:!!([Hnt].includes(e==null?void 0:e.eventType)||a),items:[...VS({heading:"Ungrouped",count:m.length}),Mnt(Et,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:(e==null?void 0:e.eventType)===OX&&c,anchorId:tW,entries:m,actions:[Vd],group:kX,drawCreated:a,togglePanel:ub},{items:[...VS({heading:"Withdrawn",count:g.length}),!a&&D1(l[Vd],s,o)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:iW,entries:g,actions:[Bd],hide:a,group:Vd,collapsed:!0,drawCreated:a,togglePanel:ub}]}function xX({eventId:t,drawId:e,headerElement:i}){var l,c,u,d,p;(!t||t==="undefined")&&Ye.router.navigate("/");let n;const r=h=>{n&&Object.values(Ye.tables).forEach(m=>m.removeFilter(n));const f=h==null?void 0:h.toLowerCase();n=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(f)},h?Object.values(Ye.tables).forEach(m=>m.addFilter(n)):n=void 0},a=()=>{var b;const{event:h,drawDefinition:f}=$e.getEvent({eventId:t,drawId:e});if(i.innerHTML=h==null?void 0:h.eventName,!h)return{error:"EVENT_NOT_FOUND"};const{participants:m,derivedDrawInfo:g}=$e.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},v=((b=h==null?void 0:h.drawDefinitions)==null?void 0:b.length)>1,y=((f==null?void 0:f.entries)||(h==null?void 0:h.entries)||[]).map(D=>Ex({entry:D,derivedDrawInfo:g,participants:m,eventType:h.eventType,eventId:t})),{events:I}=$e.getEvents();return{tableData:znt({event:h,drawDefinition:f,participants:m,entryData:y,hasFlights:v}),events:I,event:h}},o=h=>{for(const f of h){const{entries:m,group:g,anchorId:v,placeholder:y,excludeColumns:I,actions:b,drawCreated:D}=f,w=document.getElementById(v);if(w){w.style.display=f.hide?ct:tw,lo(w);const S=document.createElement("div");S.className=`${Jke} flexcol flexcenter`,w.appendChild(S);const U=document.createElement("div");U.className=`${ice} flexcol flexcenter`,w.appendChild(U);const C=new na(U,{headerSortElement:sh(["ratings.utr.utrRating","ratings.wtn.wtnRating","seedNumber","ranking","cityState","status","flights"]),columns:fnt({actions:b,exclude:I,entries:m,eventId:t,drawId:e,drawCreated:D}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:m,placeholder:y});Ye.tables[g]=C;const E=ms(w,nv);C.on("tableBuilt",()=>{var M;const P=(M=f.items)==null?void 0:M.map(N=>pt(N)?N(C):N);ho({target:S,table:C,items:P,onSelection:f.onSelection}),!m.length&&f.togglePanel&&f.togglePanel({target:E,table:C,close:!0})}),C.on("dataChanged",()=>{var A,_;const N=(_=((A=Ty(C.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:A[0]).getElementsByClassName(qle))==null?void 0:_[0],R=C.getData().length;f.togglePanel&&!R&&f.togglePanel({target:E,table:C,close:!0}),N&&(N.innerHTML=R||0)})}}},s=a();if(!s.error){const h="All entries",f=document.getElementById(OP),m={label:h,onClick:()=>zn({eventId:t}),close:!0},g=(s.event.drawDefinitions||[]).map(E=>({onClick:()=>zn({eventId:t,drawId:E.drawId}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},m]),v={label:ty,onClick:HSe,close:!0},y=s.events.map(E=>({onClick:()=>zn({eventId:E.eventId}),label:E.eventName,close:!0})).concat([{divider:!0},v]),I=E=>{var P;E.success&&zn({eventId:t,drawId:(P=E.drawDefinition)==null?void 0:P.drawId,renderDraw:!0})},b={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>zw({eventId:t,callback:I})},D=(l=s.event.drawDefinitions)==null?void 0:l.map(E=>({onClick:()=>zn({eventId:t,drawId:E==null?void 0:E.drawId,renderDraw:!0}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},b]),w=(d=(u=(c=s.event)==null?void 0:c.drawDefinitions)==null?void 0:u.find(E=>(E==null?void 0:E.drawId)===e))==null?void 0:d.drawName,S=({eventId:E})=>{console.log("generateFlights",{eventId:E})},U=(p=FSe({eventId:t}))!=null&&p.length?"is-success":ct,C=[{onKeyDown:E=>E.keyCode===8&&E.target.value.length===1&&r(""),onChange:E=>r(E.target.value),onKeyUp:E=>r(E.target.value),clearSearch:()=>r(""),placeholder:"Search entries",location:Et,search:!0},{label:s.event.eventName,options:y.length>1&&y,location:Et},{label:w||h,options:g,location:Et},{onClick:()=>zn({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:vt,hide:!e},{onClick:()=>$Se({eventId:t}),intent:U,id:"editAvoidances",label:"Avoidances",location:vt},{onClick:()=>S({eventId:t,callback:()=>{}}),label:"Flights",location:vt,hide:e,intent:ct},{options:(D==null?void 0:D.length)>2&&D,hide:((D==null?void 0:D.length)||0)<3||e,intent:"is-info",location:vt,label:"Draws",align:vt},{onClick:()=>zw({eventId:t,callback:I}),hide:(D==null?void 0:D.length)>2||e,intent:"is-info",label:"Add draw",location:vt}];ho({target:f,items:C}),o(s.tableData)}}function Wnt({drawId:t,callback:e}){var c,u;const i=(u=(c=$e.getEvent({drawId:t}))==null?void 0:c.drawDefinition)==null?void 0:u.structures;if(!(i!=null&&i.length))return;const n=i.map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:$l(4),placeholder:d,field:p,id:p}}));let r;const a=()=>{const d=i.map(({structureId:f})=>{var m;return((m=r[f])==null?void 0:m.value)&&{structureId:f,structureName:r[f].value.trim()}}).filter(Boolean);Pt({methods:[{params:{drawId:t,structureDetails:d},method:p9e}],callback:f=>{f.success&&(ai({message:"Structure renamed",intent:"is-success"}),pt(e)&&e())}})},o=()=>{const d=i.map(({structureId:m})=>{var g;return(g=r[m])==null?void 0:g.value}).filter(Boolean),p=d.every($l(4)),h=document.getElementById("renameStructures"),f=d.length&&p;h&&(h.disabled=!f)},s=i.map(({structureId:d})=>({control:d,onInput:o}));ir({title:"Edit structure names",content:d=>r=Wr(d,n,s),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:a}]})}const{ROUND_ROBIN:LX,SINGLE_ELIMINATION:qnt}=tr;function Knt({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:n}){const r=S=>`finishingPosition-${S}`,a=n.map(({finishingPosition:S,finishingPositionRange:U})=>({field:r(S),id:r(S),label:S,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${U}`,width:"400px"}}));if(!a||a.length<1){ai({message:"No playoff positions available",intent:"is-danger"});return}const o={value:CR,label:"Playoff name",field:"structureName",id:"structureName"},s=VSe({isPlayoff:!0}),l={value:qnt,options:s,label:"Draw type",field:Gu,id:Gu},{validGroupSizes:c}=$e.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:c.map(S=>({label:S,value:S})),label:"Group size",field:Xd,visible:!1,value:4},p="Positions to be played off:",h={text:`${p} None`,id:"selectedPlayoffRange"},m=[o,l,d,h,{text:"Select group finishing positions. Selections must be sequential"}].concat(a);let g;const v=()=>{const U=n.filter(({finishingPosition:R})=>{var A;return(A=g[r(R)])==null?void 0:A.checked}).map(({finishingPosition:R})=>R),C=g.structureName.value,E=g[Gu].value,P={finishingPositions:U,structureName:C,drawType:E};if(E===LX){const R=parseInt(g[Xd].value);P.structureOptions={groupSize:R}}Pt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[P],playoffStructureNameBase:CR},method:c0e}],callback:R=>{var A;R.success?(ai({message:"Structure added",intent:"is-success"}),pt(t)&&t()):(console.log({result:R}),ai({message:((A=R.error)==null?void 0:A.message)||"Error",intent:"is-danger"}))}})},y=S=>`${Math.min(...S)}-${Math.max(...S)}`,I=()=>{const S=n.filter(({finishingPosition:F})=>{var $;return($=g[r(F)])==null?void 0:$.checked}).map(({finishingPositions:F})=>F).flat(),U=n.map(({finishingPosition:F})=>g[r(F)].checked),C=n.map(({finishingPosition:F})=>g[r(F)].checked&&F).filter(Boolean),E=C.map((F,$)=>(C[$+1]||F)-F).every(F=>F<2),P=U.filter(Boolean).length,M=document.getElementById("addStructure"),N=P&&E;M&&(M.disabled=!N);const R=document.getElementById("selectedPlayoffRange");if(R){const F=N?y(S):"None";R.innerHTML=`${p} ${F}`}const{validGroupSizes:A}=$e.getValidGroupSizes({drawSize:(S==null?void 0:S.length)||4,groupSizeLimit:8}),_=A.map(F=>({label:F,value:F})),O=g[Xd],x=A.includes(4)?4:A[0];lo(O),s6(O,{options:_,value:x})},b=({e:S,fields:U})=>{const C=S.target.value,E=[LX].includes(C);U[Xd].style.display=E?"":ct},D=n.map(({finishingPosition:S})=>({control:r(S),onChange:I})).concat([{onChange:b,control:Gu}]);ir({title:"Add playoff structure",content:S=>g=Wr(S,m,D),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function Ynt({drawId:t,structureId:e,callback:i}){var f,m;const n=$e.getAvailablePlayoffProfiles({drawId:t,structureId:e}),r=g=>g.finishingPositions.reduce((v,y)=>(v||0)+(y||0));if(!n.playoffRoundsRanges&&((f=n.finishingPositionsAvailable)!=null&&f.length))return Knt({...n,drawId:t,structureId:e,callback:i});const a=(m=n.playoffRoundsRanges)==null?void 0:m.sort((g,v)=>r(g)-r(v)).map(({finishingPositionRange:g})=>({label:g,field:g,id:g,checkbox:!0,fieldPair:{field:`${g}-name`,placeholder:`${CR} ${g}`,id:`${g}-name`,width:"350px"}}));if(!a||a.length<1){ai({message:"No playoff positions available",intent:"is-danger"});return}const o=g=>{a.forEach(({label:v,fieldPair:y})=>{const I=document.getElementById(y.id);I&&(I.placeholder=`${g} ${v}`)})},l=[{onChange:g=>o(g.target.value),onKeyDown:g=>g.key==="Tab"&&o(g.target.value),value:CR,label:"Name base",field:"nameBase",id:"nameBase"}].concat(a);let c;const u=()=>{const g=n.playoffRoundsRanges.filter(w=>{var S;return(S=c[w.finishingPositionRange])==null?void 0:S.checked}),v=c.nameBase.value,y={},I=g.map(({roundNumber:w,finishingPositionRange:S})=>{var C;const U=(C=c[`${S}-name`])==null?void 0:C.value;return U&&(y[`0-${w}`]={name:U}),{[w]:1}});Pt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:y,roundProfiles:I,playoffStructureNameBase:v},method:c0e}],callback:w=>{var S;w.success?(ai({message:"Structure(s) added",intent:"is-success"}),pt(i)&&i()):ai({message:((S=w.error)==null?void 0:S.message)||"Error",intent:"is-danger"})}})},d=()=>{const g=n.playoffRoundsRanges.filter(y=>{var I;return(I=c[y.finishingPositionRange])==null?void 0:I.checked}),v=document.getElementById("addStructure");v&&(v.disabled=!g.length)},p=n.playoffRoundsRanges.map(({finishingPositionRange:g})=>({control:g,onChange:d}));ir({title:"Add playoff structures",content:g=>c=Wr(g,l,p),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:u}]})}const{FINISHING_POSITIONS:Znt}=tr;function Xnt({drawData:t,eventId:e,structureId:i,updateControlBar:n}){var l,c,u;const r=t.drawId,a=(c=(l=$e.getAvailablePlayoffProfiles({drawId:r,structureId:i}))==null?void 0:l.playoffRounds)==null?void 0:c.length,o=(u=$e.isValidForQualifying({drawId:r,structureId:i}))==null?void 0:u.valid,s=()=>{zw({callback:d=>{if(d.success){const p=d.structure.structureId;zn({eventId:e,drawId:r,structureId:p,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:r})};return t.structures.sort((d,p)=>hi.structureSort(d,p,{mode:Znt})).map(d=>({onClick:()=>{zn({eventId:e,drawId:r,structureId:d.structureId,renderDraw:!0})},label:d.structureName,close:!0})).concat([{divider:!0},{onClick:()=>Wnt({drawId:r,callback:()=>n(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>s(),hide:!o,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>Ynt({drawId:r,structureId:i,callback:()=>n(!0)}),hide:!a,label:"Add playoffs",modifyLabel:!1,close:!0}])}const qN=(t,e)=>i=>{const n=(i||"").trim().split(" ").length;return n>=t&&(!e||e&&n<=e)};function YSe({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let a;const o=()=>{const p={auditReason:a.drawDeletionReason.value},h=e.map(m=>({params:{eventId:i,drawId:m,auditData:p,force:!0},method:p0e}));Pt({methods:h,callback:m=>m.success&&zn({eventId:i})})},s=[{text:"Please provide a reason for draw deletion."},{placeholder:"Explanation",field:"drawDeletionReason",validator:qN(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],c=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const h=p.drawDeletionReason.value,f=qN(5)(h),m=document.getElementById("deleteDraw");m&&(m.disabled=!f)}}];ir({title:r,content:p=>a=Wr(p,s,c),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:o}]})}function Jnt({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let a;const o=()=>{const p={auditReason:a.drawDeletionReason.value},h=e.map(m=>({params:{eventId:i,drawId:m,auditData:p},method:h9e}));Pt({methods:h,callback:m=>m.success&&zn({eventId:i,drawId:e[0]})})},s=[{text:"Please provide a reason for resetting draws."},{placeholder:"Explanation",field:"drawDeletionReason",validator:qN(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],c=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const h=p.drawDeletionReason.value,f=qN(5)(h),m=document.getElementById("deleteDraw");m&&(m.disabled=!f)}}];ir({title:r,content:p=>a=Wr(p,s,c),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:o}]})}function Qnt({structureId:t,drawId:e}){const i=$e.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;G6({callback:r=>{r&&(r===i?ai({message:"No changes",intent:"is-warning"}):Pt({methods:[{params:{matchUpFormat:r,structureId:t,drawId:e},method:f9e}],callback:s=>s.success&&ai({message:"Scoring changed"})}))},existingMatchUpFormat:i})}function ert({drawId:t,eventId:e,structureId:i}){const n=[{params:{drawId:t,structureId:i,force:!0},method:d9e}],r=l=>{var c;l.success?zn({eventId:e,drawId:t,renderDraw:!0}):ai({message:((c=l.error)==null?void 0:c.message)||"Error",intent:"is-danger "})};ir({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>Pt({methods:n,callback:r}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:FX}=Xo;function trt({eventData:t,drawData:e,drawId:i,structureId:n,structureName:r,dualMatchUp:a}){var u,d;const o=(u=e.structures)==null?void 0:u.find(p=>p.stage===kP),s=(d=e.structures)==null?void 0:d.find(p=>p.structureId===n),l=t.eventInfo.eventId,c=[{hide:t.eventInfo.eventType!==FX,onClick:()=>ESe({structureId:n,eventId:l,drawId:i}),label:"Edit scorecard",close:!0},{hide:t.eventInfo.eventType===FX,onClick:()=>Qnt({structureId:n,eventId:l,drawId:i}),label:`Edit ${r} scoring`,close:!0},{hide:(s==null?void 0:s.stage)==="MAIN"&&s.stageSequence===1&&!o,onClick:()=>ert({drawId:i,eventId:l,structureId:n}),label:"Remove structure",close:!0},{onClick:()=>YSe({eventData:t,drawIds:[i]}),label:"Delete draw"},{onClick:()=>Jnt({eventData:t,drawIds:[i]}),label:"Reset draw"}];if(a){const p=a.matchUpId;c.push({divider:!0});const h=y=>{var I;if(y.success){const b=(I=$e.findMatchUp({drawId:i,matchUpId:p}))==null?void 0:I.matchUp,D=Cx({matchUp:b}),w=document.getElementById(vd);lo(w),w.appendChild(D)}},m={label:"Remove players",onClick:()=>{var b;((b=$e.findMatchUp({matchUpId:p,drawId:i}).matchUp.tieMatchUps)==null?void 0:b.some($e.checkScoreHasValue))?ai({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):Pt({methods:[{params:{drawId:i,matchUpId:p,inheritance:!1},method:"resetMatchUpLineUps"}],callback:h})},close:!0};c.push(m);const v={label:"Clear results",onClick:()=>{Pt({methods:[{params:{drawId:i,matchUpId:p},method:f0e}],callback:h})},close:!0};c.push(v)}return c}function irt({eventData:t}){const e=t.drawsData.map(({drawId:s,drawName:l})=>({label:l,checkbox:!0,field:s,id:s}));let i;const n=()=>{const s=t.drawsData.filter(({drawId:l})=>{var c;return(c=i[l])==null?void 0:c.checked}).map(({drawId:l})=>l);setTimeout(()=>YSe({eventData:t,drawIds:s}),200)},r=()=>{const s=t.drawsData.filter(({drawId:c})=>{var u;return(u=i[c])==null?void 0:u.checked}).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!s)},a=t.drawsData.map(({drawId:s})=>({onChange:r,control:s}));ir({title:"Delete flights",content:s=>i=Wr(s,e,a),buttons:[{label:"Cancel",intent:ct,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:n}]})}function nrt({eventData:t,drawId:e}){const i=()=>{const o=s=>{var l,c;if(s.drawDefinition){const u=(c=(l=s.drawDefinition.structures)==null?void 0:l[0])==null?void 0:c.structureId,d=t.eventInfo.eventId,p=s.drawDefinition.drawId;zn({eventId:d,drawId:p,structureId:u,renderDraw:!0})}};zw({eventId:t.eventInfo.eventId,callback:o})},n=()=>irt({eventData:t}),r=t.drawsData.length>1&&{onClick:n,label:"Delete flights",modifyLabel:!1,close:!0},a=t.drawsData.length&&{onClick:()=>zn({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(o=>({onClick:()=>{var u,d;const s=(d=(u=o.structures)==null?void 0:u[0])==null?void 0:d.structureId,l=t.eventInfo.eventId,c=o.drawId;zn({eventId:l,drawId:c,structureId:s,renderDraw:!0})},label:o.drawName,close:!0})).concat([{divider:!0},a,r,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function rrt(){return{eventOptions:($e.getEvents().events??[]).map(i=>({onClick:()=>{var r,a,o,s;const n=$e.getEventData({eventId:i.eventId});if(!((a=(r=n==null?void 0:n.eventData)==null?void 0:r.drawsData)!=null&&a.length))zn({eventId:i.eventId});else{const l=(s=(o=n.eventData.drawsData)==null?void 0:o[0])==null?void 0:s.drawId;zn({eventId:n.eventData.eventInfo.eventId,drawId:l,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${ty}</div>`,onClick:HSe,close:!0}])}}const{TEAM:art}=Xo;function ZSe({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:n,matchUps:r,eventId:a,drawId:o}){var f,m,g;const{eventOptions:s}=rrt(),l=nrt({eventData:n,drawId:o}),c=(f=n==null?void 0:n.drawsData)==null?void 0:f.find(v=>v.drawId===o),u=(g=(m=c==null?void 0:c.structures)==null?void 0:m.find(v=>v.structureId===i))==null?void 0:g.structureName,d=(r==null?void 0:r.length)===1&&n.eventInfo.eventType===art,p=Xnt({updateControlBar:e,structureId:i,drawData:c,eventId:a}),h=trt({dualMatchUp:d&&r[0],structureName:u,structureId:i,eventData:n,drawData:c,drawId:o});return[{onKeyDown:v=>v.keyCode===8&&v.target.value.length===1&&t(""),onChange:v=>t(v.target.value),onKeyUp:v=>t(v.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:Et,search:!0},{options:s.length>1?s:void 0,label:n.eventInfo.eventName,modifyLabel:!0,location:Et},{options:l.length>1?l:void 0,label:c.drawName,modifyLabel:!0,location:Et},{options:p.length>1?p:void 0,label:u,modifyLabel:!0,location:Et},{options:h,intent:"is-info",label:"Actions",location:vt,align:vt}]}function q6({eventId:t,drawId:e,structureId:i,updateDisplay:n}){var m,g;const r=$e.getEventData({eventId:t}).eventData,a=(m=r==null?void 0:r.drawsData)==null?void 0:m.find(v=>v.drawId===e),o=(a==null?void 0:a.structures)||[];i=i||((g=o==null?void 0:o[0])==null?void 0:g.structureId);const s=o.find(v=>v.structureId===i),{roundMatchUps:l}=hi.makeDeepCopy(s||{}),c=Object.values(l||{}).flat();let u;const d=v=>{var y;return(y=v.searchText)==null?void 0:y.includes(u)},h=ZSe({updateControlBar:q6,updateParticipantFilter:v=>{v||Object.values(Ye.tables).filter(Boolean).forEach(y=>y.clearFilter()),u=v==null?void 0:v.toLowerCase(),v&&Object.values(Ye.tables).filter(Boolean).forEach(y=>y.addFilter(d)),typeof n=="function"&&n({participantFilter:u})},structureId:i,eventData:r,drawData:a,matchUps:c,eventId:t,drawId:e}),f=document.getElementById(OP);ho({target:f,items:h})}function ort(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function srt(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}const{CONTAINER:lrt}=tr;function crt({callback:t,structure:e,existingView:i}){const n=s=>i!==s&&t({refresh:!0,view:s}),r=(e==null?void 0:e.structureType)===lrt,a=$e.isAdHoc({structure:e}),o=[];return i!==z$&&o.push({onClick:()=>n(z$),label:a?"Columns":"Draw",close:!0}),i!==nw&&o.push({onClick:()=>n(nw),label:"Table view",close:!0}),(a||r)&&i!==iw&&o.push({onClick:()=>n(iw),label:"Statistics",close:!0}),{label:"Display",options:o,selection:!1,location:vt,align:vt}}function XSe({drawId:t,roundNumber:e,structure:i,structureId:n,callback:r}={}){n=n||(i==null?void 0:i.structureId);const a=$e.allDrawMatchUps({matchUpFilters:{structureIds:[n]},drawId:t}).matchUps||[],o=a.reduce((f,m)=>{const g=m.roundNumber;return g&&!f.includes(g)&&f.push(g),f},[]);if(e=e||o.length&&o[o.length-1],!e)return;let s;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const f=a.filter(v=>{if(v.roundNumber===e)return v.winningSide&&s.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&s.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&s.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:s.completed.checked,removeIncomplete:s.unscored.checked,removeUnassigned:s.empties.checked,structureId:n,matchUpIds:f,drawId:t},method:d0e}],g=v=>{v.success?pt(r)&&r({refresh:!0}):console.log({postMutationError:v.error})};f.length&&Pt({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:o.map(f=>({label:f,value:f})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];ir({title:"Delete matches",content:f=>s=Wr(f,p),buttons:c})}function JSe({drawId:t,structure:e,structureId:i,roundNumber:n,callback:r}={}){i=i||(e==null?void 0:e.structureId);const a=$e.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],o=a.reduce((v,y)=>{const I=y.roundNumber;return I&&!v.includes(I)&&v.push(I),v},[]),s=Math.max(...o,1);a.length?o.push(s+1):o.length||o.push(1);let l;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{var w;const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),I=$e.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!((w=I.matchUps)!=null&&w.length))return;const b=[{method:s0e,params:{matchUps:I.matchUps,structureId:i,drawId:t}}];Pt({methods:b,callback:S=>{S.success?pt(r)&&r({refresh:!0}):console.log(S.error)}})}}],p={text:"Round number:",fieldPair:{options:o.map(v=>({label:v,value:v})),field:"roundNumber",value:n,id:"roundNumber"}},f={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},f];ir({title:"Add matches",content:v=>l=Wr(v,m),buttons:u})}const{ASSIGN_PARTICIPANT:urt}=Ky;function K6({drawId:t,structure:e,structureId:i,callback:n}={}){i=i||(e==null?void 0:e.structureId);let r,a;const o=$e.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=o.reduce((v,y)=>{const I=y.roundNumber;return I&&!v.includes(I)&&v.push(I),v},[]),l=s[s.length-1],c=Math.max(...s,1);o.length&&s.push(c+1);const u=v=>{Pt({methods:[{method:s0e,params:{structureId:i,matchUps:v,drawId:t}}],callback:b=>{b.success?pt(n)&&n({refresh:!0}):console.log(b.error)}})},d=v=>{var D;const{scaleAccessor:y,scaleName:I}=cn.scales[cn.activeScale],b=$e.drawMatic({participantIds:v,scaleAccessor:y,scaleName:I,drawId:t});(D=b.matchUps)!=null&&D.length&&u(b.matchUps)},p=({participantIds:v})=>{const y=$e.getParticipants({participantFilters:{participantIds:v}}).participants,I=l?o.filter(({roundNumber:S,sides:U})=>S===l&&(U==null?void 0:U.some(({participantId:C})=>C))).map(({sides:S})=>S.map(({participantId:U})=>U)).flat():[],b=I.length?I:v;yE({title:"Confirm player selection",selectedParticipantIds:b,activeOnEnter:!0,selectionLimit:99,onSelection:S=>{var C;const U=(C=S.selected)==null?void 0:C.map(({participantId:E})=>E);d(U)},action:{type:urt,participantsAvailable:y},update:r})},f=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{var v;if(a[Ps].value===Ps){const{drawDefinition:y}=$e.getEvent({drawId:t}),I=y.entries.filter(({entryStatus:b,entryStage:D})=>!["WITHDRAWN","UNGROUPED"].includes(b)&&(!D||D===e.stage)).map(({participantId:b})=>b);p({participantIds:I})}else{Mw();const y=$e.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(console.log({result:y}),!((v=y.matchUps)!=null&&v.length))return;u(y.matchUps)}}}],m=[{field:Ps,value:Ps,options:[{label:Ps,value:Ps,selected:!0},{label:Yz,value:!1}]}];r=ir({title:"Add round",content:v=>a=Wr(v,m),buttons:f}).update}const QSe="Delete matches",eTe="Add matches",tTe="Add round";function drt({structure:t,drawId:e,callback:i}){if(!$e.isAdHoc({structure:t}))return{};const n=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>JSe({drawId:e,structure:t,callback:n}),label:eTe,color:"blue"},{onClick:()=>K6({drawId:e,structure:t,newRound:!0,callback:n}),label:tTe,color:"blue"},{label:QSe,color:"red",onClick:()=>XSe({drawId:e,structure:t,callback:n})}],selection:!1,location:vt,align:vt}}const{MAIN:prt,QUALIFYING:hrt,VOLUNTARY_CONSOLATION:frt}=tr;function Y6({updateDisplay:t,callback:e,structure:i,drawId:n,existingView:r}){var h;const a=document.getElementById(Xz),{sourceStructuresComplete:o,hasDrawFeedProfile:s}=i??{},l=!((i==null?void 0:i.stage)===prt&&(i==null?void 0:i.stageSequence)===1)&&(i==null?void 0:i.stage)!==hrt&&s,c=$e.isAdHoc({structure:i}),u=[];if(l){const f=()=>{const g={params:{structureId:i.sourceStructureIds[0],drawId:n},method:e9e};Pt({methods:[g],callback:y=>{y.success&&typeof t=="function"&&t()}})},m=(h=i.positionAssignments)==null?void 0:h.filter(({participantId:g})=>g).length;u.push({intent:o?"is-primary":ct,disabled:o!==!0,visible:!m,onClick:f,label:"Auto position",location:vt})}const p=crt({structure:i,drawId:n,existingView:r,callback:({refresh:f,view:m})=>typeof e=="function"&&e({refresh:f,view:m})});if(p!=null&&p.options.length&&u.push(p),c){const f=drt({structure:i,drawId:n,callback:e});u.push(f)}(i==null?void 0:i.stage)===frt&&console.log("voluntary controlBar with [View participants]"),u.length&&ho({target:a,items:u})}function Mx(){[Xz,Yle,Zle].forEach(t=>{const e=document.getElementById(t);e&&lo(e)})}function $X({participantResult:t,drawPosition:e,participantId:i,participantMap:n}={}){const r=`${(t==null?void 0:t.setsWon)||0}/${(t==null?void 0:t.setsLost)||0}`,a=`${(t==null?void 0:t.gamesWon)||0}/${(t==null?void 0:t.gamesLost)||0}`,o=(t==null?void 0:t.groupOrder)||(t==null?void 0:t.provisionalOrder),s=n[i];return{participantName:s.participantName,groupName:s.groupName,...t,participantId:i,drawPosition:e,participant:s,gamesResult:a,setsResult:r,order:o}}function RF(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function mrt(){return[{cellClick:(t,e)=>e.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{headerMenu:lh({}),field:"drawPosition",headerSort:!1,hozAlign:Et,width:55},{formatter:"responsiveCollapse",hozAlign:At,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:EI(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:jw,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:At,headerWordWrap:!0,title:"Match W/L",hozAlign:At,maxWidth:80,field:"result"},{formatter:RF,headerHozAlign:At,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:At,maxWidth:80},{headerHozAlign:At,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:At,maxWidth:80},{formatter:RF,headerHozAlign:At,headerWordWrap:!0,title:"Set Win%",hozAlign:At,field:"setsPct",maxWidth:80},{headerHozAlign:At,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:At,maxWidth:80},{formatter:RF,headerHozAlign:At,headerWordWrap:!0,title:"Game Win%",hozAlign:At,field:"gamesPct",maxWidth:80},{headerHozAlign:At,hozAlign:At,title:"Order",field:"order",maxWidth:80},{title:"Group",field:"groupName",visible:!1}]}async function iTe({eventId:t,drawId:e,structureId:i}){let n,r,a,o;const s=y=>(y??[]).reduce((I,b)=>(I[b.participantId]=b,I),{}),l={},c=()=>{var w,S;const{participants:y,eventData:I}=$e.getEventData({eventId:t,allParticipantResults:!0}),b=(w=I==null?void 0:I.drawsData)==null?void 0:w.find(U=>U.drawId===e);return r=(S=b==null?void 0:b.structures)==null?void 0:S.find(U=>U.structureId===i),o||(o=s(y)),(r!=null&&r.roundMatchUps?Object.values(r.roundMatchUps).flat():[]).forEach(({sides:U,structureName:C,structureId:E})=>{l[E]=C,U.forEach(P=>{P.participantId&&(o[P.participantId].groupName=C)})}),((r==null?void 0:r.participantResults)??[]).filter(U=>{var E;const C=o[U.participantId];return!a||((E=C==null?void 0:C.participantName)==null?void 0:E.toLowerCase().includes(a==null?void 0:a.toLowerCase()))})},u=c(),d=()=>u==null?void 0:u.map(y=>$X({...y,participantMap:o})),p=()=>c().map($X),h=y=>{y.participantFilter&&(a=y.participantFilter),n.replaceData(p())},f=d(),m=mrt();return(y=>{oh({anchorId:vd});const I=document.getElementById(vd),b=Object.values(l).length>1?["groupName"]:void 0;n=new na(I,{headerSortElement:sh(["participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[D=>D],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:b,columns:m,data:y})})(f),Y6({structure:r,drawId:e,existingView:iw,callback:({refresh:y,view:I}={})=>{Mx(),I?zn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:I}):cD({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:I})}}),q6({eventId:t,drawId:e,structureId:i,updateDisplay:h}),{table:n,replaceTableData:h}}function grt({structure:t,drawId:e,callback:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=o=>{o.stopPropagation(),o.preventDefault(),K6({newRound:!0,structure:t,callback:i,drawId:e})},r.className="button is-info",r.innerHTML="Generate round",n.appendChild(r);const a=document.getElementById(vd);a&&a.appendChild(n)}function vrt({drawData:t,eventId:e,drawId:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=o=>{o.stopPropagation(),o.preventDefault();const s=t.drawName;zw({callback:l=>{var u,d,p;const c=(p=(d=(u=l.drawDefinition)==null?void 0:u.structures)==null?void 0:d.find(({stage:h})=>h===kP))==null?void 0:p.structureId;zn({eventId:e,drawId:i,structureId:c,renderDraw:!0})},isQualifying:!0,drawName:s,eventId:e,drawId:i})},r.className="button is-info",r.innerHTML="Generate qualifying",n.appendChild(r);const a=document.getElementById(vd);a&&a.appendChild(n)}const BX={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function yrt({pointerEvent:t,actions:e,callback:i}){const n=t.target,r=o=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(o.type)&&Irt({action:o,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER"].includes(o.type)&&brt({action:o,callback:i}),["SEED_VALUE"].includes(o.type)&&wrt({target:n,action:o,callback:i})},a=e==null?void 0:e.filter(({type:o})=>BX[o]).map(o=>({option:BX[o.type]||o.type,onClick:()=>r(o)}));a!=null&&a.length&&nl({options:a,target:n,config:{arrow:!1,offset:[0,0]}})}function Irt({action:t,callback:e}){const i=r=>r.success?e():console.log({result:r}),n=[{method:t.method,params:t.payload}];Pt({methods:n,callback:i})}function brt({action:t,callback:e}){yE({action:t,onSelection:n=>{const r=o=>o.success?e():console.log({result:o}),a=[{params:{...t.payload,...n},method:t.method}];Pt({methods:a,callback:r})},selectOnEnter:!0})}function wrt({target:t,action:e,callback:i}){let n;function r(o){if((o==null?void 0:o.key)==="Enter"){const s=o.target.value;if(hi.isConvertableInteger(s)){const l=u=>u.success?i():console.log({result:u}),c=[{params:{...e.payload,seedValue:s},method:e.method}];Pt({methods:c,callback:l})}n.destroy()}}n=nl({menuItems:[{label:"Assign seed number ",validator:Bu,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:r}],target:t,config:{arrow:!1,offset:[0,0]}})}function Srt(t){var a,o,s,l;const{structureId:e,drawId:i}=(t==null?void 0:t.context)??t,n=(l=(s=(o=(a=t.eventData)==null?void 0:a.drawsData)==null?void 0:o.find(c=>c.drawId===i))==null?void 0:s.structures)==null?void 0:l.find(c=>c.structureId===e),r=[];if($e.isAdHoc({structure:n})){const c=[{onClick:()=>JSe({...t}),text:eTe,color:"blue"},{onClick:()=>K6({...t,roundNumber:void 0,newRound:!0}),text:tTe,color:"blue"},{onClick:()=>XSe({...t}),text:QSe,color:"red"}];r.push(...c)}t!=null&&t.pointerEvent&&r.length&&nl({items:r,target:t.pointerEvent.target,config:{placement:Ef}})}const{TEAM:Trt}=Ua;function Urt({callback:t,drawId:e,eventData:i}){var u;const n=(u=i==null?void 0:i.drawsData)==null?void 0:u.flatMap(({structures:d})=>d.flatMap(p=>{var h;return[(h=p.structures)==null?void 0:h.flatMap(f=>Object.values(f.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]}).filter(Boolean)),r=hi.createMap(n,"matchUpId"),a=d=>{const p=_S(d.pointerEvent.target,"tmx-m","id");return r[p]},o=d=>parseInt(_S(d.pointerEvent.target,"tmx-sd","sideNumber")),s=d=>_S(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(_S(d.pointerEvent.target,"tmx-rd","roundNumber"));return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),h=s(d);return Srt({pointerEvent:d.pointerEvent,roundNumber:p,structureId:h,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d!=null&&d.pointerEvent){d.pointerEvent.stopPropagation();const p=_S(d.pointerEvent.target,"tmx-m","id"),h=r[p];x6({pointerEvent:d.pointerEvent,matchUp:h,callback:t})}},venueClick:d=>{var h,f,m,g;const p=a(d);if(d!=null&&d.pointerEvent&&((h=p==null?void 0:p.schedule)!=null&&h.venueId)){const v=p.schedule.venueId,y=(g=(m=(f=$e.findVenue({venueId:v}))==null?void 0:f.venue)==null?void 0:m.addresses)==null?void 0:g[0],{latitude:I,longitude:b}=y||{};if(!I||!b)return;const D=`https://www.google.com/maps/@?api=1&map_action=map&center=${I}%2C${b}&zoom=18&basemap=satellite`,w=`https://bing.com/maps/default.aspx?cp=${I}~${b}&lvl=17&style=h`,S=C=>{const E=C&&I&&b&&(C==="google"&&D||w);E&&window.open(E,"_blank")};nl({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>S("google"),hide:!I||!b,text:"Open in Google Maps"},{onClick:()=>S("bing"),hide:!I||!b,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:Ef}})}},matchUpClick:d=>console.log("matchUpClick",d),scoreClick:d=>{var g;const p=o(d),h=a(d),{validActions:f}=$e.matchUpActions({matchUpId:h.matchUpId,drawId:h.drawId,sideNumber:p})||{},m=f==null?void 0:f.find(({type:v})=>v==="SCORE");if(m)if(h.matchUpType===Trt){const v=()=>t(),y=(g=i==null?void 0:i.eventInfo)==null?void 0:g.eventName,{matchUpId:I,drawId:b}=h;Px({title:y,drawId:b,matchUpId:I,onClose:v})}else Dx({matchUpId:m.payload.matchUpId,callback:t})},participantClick:d=>{var g;const p=a(d),h=o(d),f=d.side||((g=p.sides)==null?void 0:g.find(v=>v.sideNumber===h)),{validActions:m}=p.drawId&&$e.positionActions({sideNumber:h||(f==null?void 0:f.sideNumber),structureId:p==null?void 0:p.structureId,drawPosition:f==null?void 0:f.drawPosition,matchUpId:p==null?void 0:p.matchUpId,drawId:p==null?void 0:p.drawId,policyDefinitions:{positionActions:{}}})||{};yrt({...d,actions:m,callback:t})}}}var VX=11;function Drt(t,e){var i=e.attributes,n,r,a,o,s;if(!(e.nodeType===VX||t.nodeType===VX)){for(var l=i.length-1;l>=0;l--)n=i[l],r=n.name,a=n.namespaceURI,o=n.value,a?(r=n.localName||r,s=t.getAttributeNS(a,r),s!==o&&(n.prefix==="xmlns"&&(r=n.name),t.setAttributeNS(a,r,o))):(s=t.getAttribute(r),s!==o&&t.setAttribute(r,o));for(var c=t.attributes,u=c.length-1;u>=0;u--)n=c[u],r=n.name,a=n.namespaceURI,a?(r=n.localName||r,e.hasAttributeNS(a,r)||t.removeAttributeNS(a,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var P1,Prt="http://www.w3.org/1999/xhtml",El=typeof document>"u"?void 0:document,Crt=!!El&&"content"in El.createElement("template"),Ert=!!El&&El.createRange&&"createContextualFragment"in El.createRange();function Mrt(t){var e=El.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function Rrt(t){P1||(P1=El.createRange(),P1.selectNode(El.body));var e=P1.createContextualFragment(t);return e.childNodes[0]}function Nrt(t){var e=El.createElement("body");return e.innerHTML=t,e.childNodes[0]}function Art(t){return t=t.trim(),Crt?Mrt(t):Ert?Rrt(t):Nrt(t)}function C1(t,e){var i=t.nodeName,n=e.nodeName,r,a;return i===n?!0:(r=i.charCodeAt(0),a=n.charCodeAt(0),r<=90&&a>=97?i===n.toUpperCase():a<=90&&r>=97?n===i.toUpperCase():!1)}function _rt(t,e){return!e||e===Prt?El.createElement(t):El.createElementNS(e,t)}function krt(t,e){for(var i=t.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}return e}function NF(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var jX={OPTION:function(t,e){var i=t.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}NF(t,e,"selected")},INPUT:function(t,e){NF(t,e,"checked"),NF(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var n=t.firstChild;if(n){var r=n.nodeValue;if(r==i||!i&&r==t.placeholder)return;n.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,n=0,r=t.firstChild,a,o;r;)if(o=r.nodeName&&r.nodeName.toUpperCase(),o==="OPTGROUP")a=r,r=a.firstChild;else{if(o==="OPTION"){if(r.hasAttribute("selected")){i=n;break}n++}r=r.nextSibling,!r&&a&&(r=a.nextSibling,a=null)}t.selectedIndex=i}}},jS=1,GX=11,HX=3,zX=8;function em(){}function Ort(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function xrt(t){return function(i,n,r){if(r||(r={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var a=n;n=El.createElement("html"),n.innerHTML=a}else n=Art(n);else n.nodeType===GX&&(n=n.firstElementChild);var o=r.getNodeKey||Ort,s=r.onBeforeNodeAdded||em,l=r.onNodeAdded||em,c=r.onBeforeElUpdated||em,u=r.onElUpdated||em,d=r.onBeforeNodeDiscarded||em,p=r.onNodeDiscarded||em,h=r.onBeforeElChildrenUpdated||em,f=r.skipFromChildren||em,m=r.addChild||function(O,x){return O.appendChild(x)},g=r.childrenOnly===!0,v=Object.create(null),y=[];function I(O){y.push(O)}function b(O,x){if(O.nodeType===jS)for(var F=O.firstChild;F;){var $=void 0;x&&($=o(F))?I($):(p(F),F.firstChild&&b(F,x)),F=F.nextSibling}}function D(O,x,F){d(O)!==!1&&(x&&x.removeChild(O),p(O),b(O,F))}function w(O){if(O.nodeType===jS||O.nodeType===GX)for(var x=O.firstChild;x;){var F=o(x);F&&(v[F]=x),w(x),x=x.nextSibling}}w(i);function S(O){l(O);for(var x=O.firstChild;x;){var F=x.nextSibling,$=o(x);if($){var V=v[$];V&&C1(x,V)?(x.parentNode.replaceChild(V,x),C(V,x)):S(x)}else S(x);x=F}}function U(O,x,F){for(;x;){var $=x.nextSibling;(F=o(x))?I(F):D(x,O,!0),x=$}}function C(O,x,F){var $=o(x);$&&delete v[$],!(!F&&(c(O,x)===!1||(t(O,x),u(O),h(O,x)===!1)))&&(O.nodeName!=="TEXTAREA"?E(O,x):jX.TEXTAREA(O,x))}function E(O,x){var F=f(O,x),$=x.firstChild,V=O.firstChild,G,j,z,H,K;e:for(;$;){for(H=$.nextSibling,G=o($);!F&&V;){if(z=V.nextSibling,$.isSameNode&&$.isSameNode(V)){$=H,V=z;continue e}j=o(V);var q=V.nodeType,Y=void 0;if(q===$.nodeType&&(q===jS?(G?G!==j&&((K=v[G])?z===K?Y=!1:(O.insertBefore(K,V),j?I(j):D(V,O,!0),V=K,j=o(V)):Y=!1):j&&(Y=!1),Y=Y!==!1&&C1(V,$),Y&&C(V,$)):(q===HX||q==zX)&&(Y=!0,V.nodeValue!==$.nodeValue&&(V.nodeValue=$.nodeValue))),Y){$=H,V=z;continue e}j?I(j):D(V,O,!0),V=z}if(G&&(K=v[G])&&C1(K,$))F||m(O,K),C(K,$);else{var Z=s($);Z!==!1&&(Z&&($=Z),$.actualize&&($=$.actualize(O.ownerDocument||El)),m(O,$),S($))}$=H,V=z}U(O,V,j);var Q=jX[O.nodeName];Q&&Q(O,x)}var P=i,M=P.nodeType,N=n.nodeType;if(!g){if(M===jS)N===jS?C1(i,n)||(p(i),P=krt(i,_rt(n.nodeName,n.namespaceURI))):P=n;else if(M===HX||M===zX){if(N===M)return P.nodeValue!==n.nodeValue&&(P.nodeValue=n.nodeValue),P;P=n}}if(P===n)p(i);else{if(n.isSameNode&&n.isSameNode(P))return;if(C(P,n,g),y)for(var R=0,A=y.length;R<A;R++){var _=v[y[R]];_&&D(_,_.parentNode,!1)}}return!g&&P!==i&&i.parentNode&&(P.actualize&&(P=P.actualize(i.ownerDocument||El)),i.parentNode.replaceChild(P,i)),P}}var Lrt=xrt(Drt);const{DOUBLES:Frt,TEAM:WX}=Xo;function cD({eventId:t,drawId:e,structureId:i,compositionName:n,roundsView:r,redraw:a}){var E,P;const o=$e.getEvents().events;if(!(o!=null&&o.length))return;ON.register("tmx-tm","mouseover",ort),ON.register("tmx-tm","mouseout",srt);let s,l,c,u,d,p,h,f,m;const g=()=>{var M,N,R,A;l=(M=$e.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t}))==null?void 0:M.eventData,c=(N=l==null?void 0:l.eventInfo)==null?void 0:N.eventType,u=(R=l==null?void 0:l.drawsData)==null?void 0:R.find(_=>_.drawId===e),d=(u==null?void 0:u.structures)||[],i=i||((A=d==null?void 0:d[0])==null?void 0:A.structureId),p=d.find(_=>_.structureId===i),{roundMatchUps:f,stage:h}=hi.makeDeepCopy(p||{}),m=Object.values(f||{}).flat()};mx(),g();const v=({refresh:M,view:N}={})=>{const R=M||s;Mx(),N?zn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:N}):cD({eventId:t,drawId:e,structureId:i,redraw:R,roundsView:N})},y=(m==null?void 0:m.length)===1&&l.eventInfo.eventType===WX,I=Urt({eventData:l,callback:v,drawId:e}),b=(YE==null?void 0:YE[n])||YE[c===Frt&&"National"||c===WX&&"Basic"||"National"];b.configuration.scaleAttributes&&(b.configuration.scaleAttributes=cn.scales[cn.activeScale]),b.configuration.showAddress=void 0,b.configuration.participantDetail="_ustaSection.name",b.configuration.allDrawPositions=!0,b.configuration.drawPositions=!0,b.configuration.roundHeader=!0;const D=document.getElementById(vd);a&&lo(D);const w=$e.isAdHoc({structure:p}),S=()=>{var N,R;if(y)return;Y6({updateDisplay:()=>{g(),S()},drawId:e,structure:p,existingView:r,callback:v});for(const A of Object.keys((p==null?void 0:p.roundMatchUps)??{}))p.roundMatchUps[A]=(N=f==null?void 0:f[A])==null?void 0:N.filter(({sides:_})=>(_==null?void 0:_.some(({participant:x})=>x==null?void 0:x.participantName.toLowerCase().includes(s)))||!s);if(m.length)if(r===nw)nTe({matchUps:m,eventData:l});else if(r===iw)iTe({eventId:t,drawId:e,structureId:i,eventData:l});else{const A=Object.values(p.roundMatchUps||{}).flat(),_=C3e({content:P3e({context:{drawId:e,structureId:i},searchActive:s,matchUps:A,eventHandlers:I,composition:b,structure:p}),theme:b.theme}),O=F=>{var $;return($=F==null?void 0:F.classList)!=null&&$.contains("tmx-p")?F:ms(F,"tmx-p")},x=D.firstChild;x?Lrt(x,_,{addChild:function(F,$){var V,G,j,z,H,K,q;if($.classList){const Y=F.firstChild,Z=$.getAttribute("id"),Q=![null,"undefined",void 0].includes(Z),ie=(G=(V=F.firstChild)==null?void 0:V.getAttribute)==null?void 0:G.call(V,"id"),ue=![null,"undefined",void 0].includes(ie);try{if(!Q&&!ue){cn.renderLog&&console.log("condition 0");const J=(j=O(Y))==null?void 0:j.nextSibling;J!=null&&J.getAttribute("id")&&((z=O(Y))!=null&&z.getAttribute("id"))&&J.parentElement.removeChild(J)}else Q&&ue&&Z&&ie&&Z!==ie?(cn.renderLog&&console.log("condition 1"),F.removeChild(F.firstChild)):(H=$.classList)!=null&&H.contains("tmx-p")&&!ue?(cn.renderLog&&console.log("condition 2"),F.removeChild(F.firstChild)):(q=(K=F.firstChild)==null?void 0:K.classList)!=null&&q.contains("tmx-p")&&F.firstChild.getAttribute("id")!=="undefined"&&$.getAttribute("id")==="undefined"?(cn.renderLog&&console.log("condition 3"),F.removeChild(F.firstChild)):!Q&&ue?cn.renderLog&&console.log("condition 4"):console.log({incomingId:Q,existingId:ue,incomingIdValue:Z,existingIdValue:ie})}catch(J){console.log({err:J})}}F.appendChild($)}}):D.appendChild(_)}else if(h===kP)vrt({drawData:u,drawId:e,eventId:t});else if(w)grt({structure:p,drawId:e,callback:v});else{const A=(R=d==null?void 0:d[0])==null?void 0:R.structureId;return cD({eventId:t,drawId:e,structureId:A,redraw:!0})}},U=document.getElementById(OP),C=M=>{M&&g();const N=_=>{var O;return(O=_.searchText)==null?void 0:O.includes(s)},A=ZSe({updateParticipantFilter:_=>{_||Object.values(Ye.tables).filter(Boolean).forEach(O=>O.clearFilter()),s=_==null?void 0:_.toLowerCase(),_&&Object.values(Ye.tables).filter(Boolean).forEach(O=>O.addFilter(N)),lo(D),S()},updateControlBar:C,structureId:i,eventData:l,drawData:u,matchUps:m,eventId:t,drawId:e});ho({target:U,items:A})};if(!u){console.log("no draw data",{eventData:l,drawData:u});return}if(i=i||((P=(E=u.structures)==null?void 0:E[0])==null?void 0:P.structureId),!i){console.log("structure not found");return}if(y){const M=Cx({matchUp:m[0],participantFilter:s});M&&D.appendChild(M)}else S();C()}function $rt(t,e,i,n){const r=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${r})</span>`}const{TEAM:Brt}=Ua,Vrt=t=>(e,i)=>{var c;const n=i.getRow().getData(),{matchUpId:r,readyToScore:a,matchUpType:o,drawId:s,eventName:l}=n.matchUp;o===Brt?Px({title:l,matchUpId:r,drawId:s,onClose:()=>t()}):(a||(c=n.matchUp.score)!=null&&c.scoreStringSide1)&&Dx({matchUpId:r,callback:t})};function jrt({data:t,replaceTableData:e}){const i=(s,l)=>{var h,f;const u=l.getRow().getData(),{courtName:d,scheduledDate:p}=u;if(d&&p){const m=(f=(h=$e.getTournament())==null?void 0:h.tournamentRecord)==null?void 0:f.tournamentId,g=`/${xa}/${m}/${iy}/${p}`;Ye.router.navigate(g)}},n=()=>e(),r=t.some(s=>s.courtName),a=(s,l)=>tD(s,l,n),o=s=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const c=({event:d,...p})=>{tD(d,s,n,p)};return s.getValue().participantName&&EI(c)(s,l)};return[{cellClick:(s,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:At,minWidth:50,width:50},{headerMenu:lh({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:Et,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!r,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:o,cellClick:a,sorter:jw,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:o,cellClick:a,sorter:jw,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:Vrt(e),formatter:O6,sorter:NSe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:O0e,formatter:x0e,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Et,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(s,l)=>x6({pointerEvent:s,...l.getData()}),formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,widthGrow:0,width:50}]}const{TEAM:Grt}=Xo,qX=t=>{var A,_,O,x,F;const{potentialParticipants:e,structureName:i,matchUpType:n,roundNumber:r,matchUpId:a,roundName:o,schedule:s,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:h,courtName:f}=s||{},m=$=>{var V;return((V=$.person)==null?void 0:V.standardFamilyName)||$.participantName},g=(e==null?void 0:e.map($=>({participantName:$.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((_=u==null?void 0:u[1])==null?void 0:_.participant)||g.shift(),I={participantName:v==null?void 0:v.participantName,sex:(O=v==null?void 0:v.person)==null?void 0:O.sex,participant:v},b={participantName:y==null?void 0:y.participantName,sex:(x=y==null?void 0:y.person)==null?void 0:x.sex,participant:y},D=u.flatMap(({participant:$})=>{var V;return(V=$==null?void 0:$.individualParticipantIds)!=null&&V.length?$.individualParticipantIds:$==null?void 0:$.participantId}).filter(Boolean),w=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,S=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),C=(F=d.score)==null?void 0:F.scoreStringSide1,E=u.flatMap($=>{var G,j,z;const V=(G=$.participant)==null?void 0:G.person;return V?[V.standardGivenName,V.standardFamilyName]:(z=(j=$.participant)==null?void 0:j.individualParticipants)==null?void 0:z.map(({person:H})=>[H.standardGivenName,H.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),P=pce([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),M=t.collectionId?Grt:n,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,R={score:C,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:S,winningSide:w};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:D,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:U,scheduleTime:h,matchUpType:n,scoreDetail:R,winningSide:w,roundNumber:r,searchText:P,courtName:f,eventType:M,matchUpId:a,roundName:o,complete:S,eventId:l,matchUp:t,drawId:c,side1:I,side2:b,score:C}},{CONTAINER:Hrt}=tr;async function nTe({eventId:t,drawId:e,structureId:i,matchUps:n,eventData:r}){let a,o,s,l;const c=()=>{var b,D;const y=$e.getEventData({eventId:t}).eventData,I=(b=y==null?void 0:y.drawsData)==null?void 0:b.find(w=>w.drawId===e);return o=(D=I==null?void 0:I.structures)==null?void 0:D.find(w=>w.structureId===i),l=(o==null?void 0:o.structureType)===Hrt,($e.allTournamentMatchUps({matchUpFilters:{drawIds:[e],structureIds:[i]},participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:w})=>w!=="BYE").filter(({sides:w})=>!s||w.find(S=>{var U,C;return(C=(U=S.participant)==null?void 0:U.participantName)==null?void 0:C.toLowerCase().includes(s==null?void 0:s.toLowerCase())}))};n||(n=await c()),r&&n.forEach(y=>y.eventName=r.eventInfo.eventName);const u=()=>n.map(qX),d=()=>c().map(qX),p=y=>{y.participantFilter&&(s=y.participantFilter),a.replaceData(d())},h=u(),f=jrt({data:h,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{oh({anchorId:vd});const I=document.getElementById(vd);a=new na(I,{groupHeader:[$rt,b=>b],headerSortElement:sh(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:f,data:y})})(h),Y6({structure:o,drawId:e,existingView:nw,callback:({refresh:y,view:I}={})=>{Mx(),I?zn({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:I}):cD({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:I})}}),q6({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:a,replaceTableData:p}}function E1({eventId:t,renderDraw:e}={}){const i=document.getElementById(Xle),n=document.getElementById(Kle),r=document.getElementById(vd),a=document.getElementById(Jle);a&&(a.style.display=t||e?"":ct),i&&(i.style.display=t&&!e?"":ct),n&&(n.style.display=t||e?ct:""),r&&(r.style.display=e?"":ct)}function zrt({eventId:t,drawId:e,headerElement:i}){const{event:n,drawDefinition:r}=$e.getEvent({eventId:t,drawId:e});return n&&r?(i.innerHTML=n.eventName,{success:!0}):{}}const KX={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},rTe=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href,dv={"o-route":AP,"p-route":Tp,"e-route":Vu,"m-route":qz,"s-route":iy,"v-route":Kz},YX={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function Wrt(){var s,l,c,u;const e=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <li id='o-route' class="features-item tournaments">
        <i class="nav-icon fa-solid fa-trophy" style="font-size: larger"> <span class="status"></span> </i>
          <span class="features-item-text">Overview</span>
      </li>
      <li id='p-route' class="features-item participants">
        <i class="nav-icon fa-solid fa-user-group" style="font-size: larger"></i>
        <span class="features-item-text">Participants</span>
      </li>
      <li id='e-route' class="features-item events">
        <i class="nav-icon fa-solid fa-diagram-project" style='font-size: larger'></i>
        <span class="features-item-text">Events</span>
      </li>
      <li id='m-route' class="features-item matches">
        <img src="${rTe}" class='nav-image' srcset=""/>
        <span class="features-item-text">Matches</span>
      </li>
      <li id='s-route' class="features-item schedule">
        <i class="nav-icon fa-solid fa-clock" style='font-size: larger'></i>
        <span class="features-item-text">Schedule</span>
      </li>
      <li id='v-route' class="features-item venues">
        <i class="nav-icon fa-solid fa-location-dot" style='font-size: larger'></i>
        <span class="features-item-text">Venues</span>
      </li>
    </ul>
  </div>
`,i=document.getElementById("sideNav");i.innerHTML=e;const n=Object.keys(dv),r=(u=(c=(l=(s=Ye.router)==null?void 0:s.current)==null?void 0:l[0])==null?void 0:c.data)==null?void 0:u.selectedTab,a=d=>document.querySelector(".side-bar").classList.contains("collapse")?d:"",o=document.getElementById("o-route");o.onclick=()=>{console.log("tournament information")},pf(o,{dynContent:()=>a(YX["o-route"]),onShow:d=>!!d.props.content,plugins:[KX],placement:vt,arrow:!1}),n.forEach(d=>{const p=document.getElementById(d);pf(p,{dynContent:()=>a(YX[d]),onShow:h=>!!h.props.content,plugins:[KX],placement:vt,arrow:!1}),(r===dv[d]||!r&&dv[d]===Tp)&&p.classList.add("active"),p.onclick=()=>{var m;document.querySelectorAll(".features-item").forEach(g=>g.classList.remove("active")),p.classList.add("active");const h=(m=$e.getTournament())==null?void 0:m.tournamentRecord.tournamentId,f=`/${xa}/${h}/${dv[d]}`;Ye.router.navigate(f)}})}function aTe(t){document.querySelectorAll(".features-item").forEach(i=>i.classList.remove("active")),Object.keys(dv).forEach(i=>{const n=document.getElementById(i);(t===dv[i]||!t&&dv[i]===Tp)&&n.classList.add("active")})}const oTe=t=>({drawDefinition:e,scaleValues:i})=>{var d,p,h,f,m,g;const{drawId:n,drawName:r,drawType:a,entries:o,matchUpFormat:s,tieFormat:l}=e,c=(d=o==null?void 0:o.filter(({entryStatus:v})=>v!=="WITHDRAWN"))==null?void 0:d.length,u=(p=$e.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds)==null?void 0:p.filter(Boolean);return{entries:(u==null?void 0:u.length)??c??0,matchUpFormat:s,tieFormat:l,utrAvg:(f=(h=i==null?void 0:i.ratingsStats)==null?void 0:h.UTR)==null?void 0:f.avg,wtnAvg:(g=(m=i==null?void 0:i.ratingsStats)==null?void 0:m.WTN)==null?void 0:g.avg,drawName:r,drawType:a,eventId:t,drawId:n}},{MAIN:ZX}=tr;function sTe({event:t,scaleValues:e}){var m,g,v;const{drawDefinitions:i=[],eventName:n,entries:r,eventId:a}=t,o=$e.allEventMatchUps({inContext:!0,eventId:a}).matchUps,s=X_.getPublishState({event:t}).publishState,l=i.length,c=((m=r.filter(({entryStage:y=ZX,entryStatus:I})=>WN(ZX).includes(`${y}.${I}`)))==null?void 0:m.length)||0,u=(o==null?void 0:o.length)||0,d=((g=o==null?void 0:o.filter(({winningSide:y,schedule:I})=>!y&&(I==null?void 0:I.scheduledTime)))==null?void 0:g.length)||0,p=((v=o.filter(({winningSide:y})=>y))==null?void 0:v.length)||0,h=i.map(y=>{var I;return oTe(a)({drawDefinition:y,scaleValues:(I=e==null?void 0:e.draws)==null?void 0:I[y.drawId]})}),f=[n].concat(i.map(({drawName:y})=>y||"")).join(" ").toLowerCase();return{published:s==null?void 0:s.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:u,entriesCount:c,drawsCount:l,searchText:f,drawDefs:h,eventId:a,event:t}}function qrt(t){const e=()=>{console.log("drawActions")},i=(a,o)=>{const{eventId:s,drawId:l}=o.getRow().getData();zn({eventId:s,drawId:l,renderDraw:!0})},n=t.find(a=>a.utrAvg),r=t.find(a=>a.wtnAvg);return[{cellClick:(a,o)=>o.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Et,width:5},{headerMenu:lh({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:At,width:55},{title:"Draw Name",field:ny,cellClick:i},{title:"Draw Type",field:Gu,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!r,field:"wtnAvg",title:tOe,width:80},{visible:!!n,field:"utrAvg",title:mW,width:80},{cellClick:e,formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt}]}function Krt(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=t.getData().drawDefs;e.appendChild(i);const r="1px solid #333",a=document.createElement("div");a.style.display=n.length?"":ct,a.style.backgroundColor="white",a.style.border=r,a.style.width="99%",e.className=ok,e.style.display=ct,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(a),t.getElement().appendChild(e);const o=qrt(n),s=new na(a,{headerSortElement:sh(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:o,data:n});s.on("scrollVertical",vc);const l=t.getData().event,c=l.eventId,u=()=>{const m=s.getSelectedData().map(({drawId:y})=>y),g=m.map(y=>({method:p0e,params:{eventId:c,drawId:y}}));Pt({methods:g,callback:y=>{y.success&&s.deleteRow(m);const I=t==null?void 0:t.getData();if(I){const b=$e.allEventMatchUps({inContext:!1,eventId:c}).matchUps;I.drawDefs=I.drawDefs.filter(D=>!m.includes(D.drawId)),I.matchUpsCount=(b==null?void 0:b.length)||0,I.drawsCount-=1}s.getData().length||(a.style.display=ct)}})},d=f=>{var m;if(f.success){s==null||s.addRow(oTe(c)({drawDefinition:f.drawDefinition}));const g=t==null?void 0:t.getData();if(a.style.display="",g)if(!g.matchUpsCount)zn({eventId:c,drawId:(m=f.drawDefinition)==null?void 0:m.drawId,renderDraw:!0});else{const v=$e.allDrawMatchUps({drawId:f.drawDefinition.drawId,inContext:!1,eventId:c}).matchUps;g.matchUpsCount+=(v==null?void 0:v.length)||0,g.drawsCount+=1}}},p=({success:f,eventUpdates:m})=>{if(f){const g=t==null?void 0:t.getData();Object.assign(g.event,m),t.update(g)}};ho({table:s,target:i,items:[{onClick:u,label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{onClick:()=>zn({eventId:c}),label:"View entries",intent:"is-info",location:Et},{onClick:()=>$Se({eventId:c}),id:"editAvoidances",label:"Avoidances",location:Et},{onClick:()=>yx({event:l,callback:p}),label:"Edit event",location:vt},{onClick:()=>zw({eventId:c,callback:d}),intent:"is-primary",label:"Add draw",location:vt}]})}function Yrt(t,e){const i=e.getRow().getData(),r=[{method:i.published?g9e:c9e,params:{eventId:i.eventId}}];Pt({methods:r,callback:o=>{o!=null&&o.success?e.getRow().update({published:!i.published}):ai({message:o.error.message,intent:"is-danger"})}})}const Zrt=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function Xrt(t,e){const i=Array.from(document.querySelectorAll(".tippy-content"));if(i.length){i.forEach(s=>s.remove());return}const n=t.target.getElementsByClassName("fa-ellipsis-vertical")[0],r=e.getRow().getData(),a=({success:s,eventUpdates:l})=>{if(s){const c=e.getRow(),u=c==null?void 0:c.getData();Object.assign(u.event,l),c.update(u)}};nl({items:[{onClick:()=>console.log("Delete",r),text:"Delete"},{onClick:()=>yx({event:r.event,callback:a}),text:"Edit"}],target:n||t.target,config:{placement:Ef}})}function Jrt(){const t=(i,n)=>{i.stopPropagation();const r=n.getRow().getData().eventId;zn({eventId:r})},e=(i,n)=>{const r=n.getRow().getData();if(r.drawDefs.length===1){const a=r.eventId,o=r.drawDefs[0].drawId;zn({eventId:a,drawId:o,renderDraw:!0})}else jv(i,n)};return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:Et,width:5},{headerMenu:lh({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:At,width:55},{title:'<i class="fa-solid fa-eye"></i>',formatter:Zrt,cellClick:Yrt,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:e,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:jv,headerHozAlign:At,field:"drawsCount",hozAlign:At,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:At,field:"entriesCount",cellClick:t,hozAlign:At,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:At,field:"matchUpsCount",hozAlign:At,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:At,hozAlign:At,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:At,hozAlign:At,headerSort:!0,visible:!0,width:50},{cellClick:jv,formatter:_6,responsive:!1,headerSort:!1,hozAlign:vt,field:"isOpen",width:20},{cellClick:Xrt,formatter:Bf,responsive:!1,headerSort:!1,hozAlign:vt,width:20}]}function Qrt(){let t;const e=()=>{var o;const a=$e.getEvents({withScaleValues:!0});return(o=a==null?void 0:a.events)==null?void 0:o.map(s=>{var l;return sTe({event:s,scaleValues:(l=a.eventScaleValues)==null?void 0:l[s.eventId]})})},i=()=>{t.replaceData(e())},n=Jrt();return(a=>{var l;oh({anchorId:fU});const o=document.getElementById(fU),s=(l=ms(o,"section"))==null?void 0:l.querySelector(".tabHeader");s&&(s.innerHTML=`Events (${a.length})`),t=new na(o,{columnDefaults:{},headerSortElement:sh(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),responsiveLayoutCollapseStartOpen:!1,rowFormatter:Krt,height:window.innerHeight*.8,responsiveLayout:"collapse",placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:n,data:a}),t.on("scrollVertical",vc),t.on("dataChanged",c=>{s&&(s.innerHTML=`Events (${c.length})`)}),t.on("dataFiltered",(c,u)=>{s&&(s.innerHTML=`Events (${u.length})`)})})(e()),{table:t,replaceTableData:i}}function eat(){const{table:t}=Qrt(),e=o=>{if(o!=null&&o.event){const s=sTe({event:o.event});t==null||t.updateOrAddData([s])}},i=UI(t),r=[{onClick:()=>{const o=t==null?void 0:t.getSelectedData().map(({eventId:l})=>l);Pt({methods:[{method:t9e,params:{eventIds:o}}],callback:l=>l.success&&(t==null?void 0:t.deleteRow(o))})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:dr},{onKeyDown:o=>o.keyCode===8&&o.target.value.length===1&&i(""),onChange:o=>i(o.target.value),onKeyUp:o=>i(o.target.value),clearSearch:()=>i(""),placeholder:"Search events",location:Et,search:!0},{onClick:()=>yx({callback:e}),label:"Add event",location:vt}],a=document.getElementById(lW);ho({table:t,target:a,items:r})}function tat({eventId:t,drawId:e,structureId:i,renderDraw:n,roundsView:r}={}){var a;if(aTe(Vu),mx(),Mx(),t||e){const o=document.getElementById(fU),s=(a=ms(o,"section"))==null?void 0:a.querySelector(".tabHeader");e&&n?zrt({eventId:t,drawId:e,headerElement:s}).success?(r===nw?nTe({eventId:t,drawId:e,structureId:i}):r===iw?iTe({eventId:t,drawId:e,structureId:i}):cD({eventId:t,drawId:e,structureId:i,redraw:!0,roundsView:r}),E1({renderDraw:n})):(xX({eventId:t,drawId:e}),E1({eventId:t})):(xX({eventId:t,drawId:e,headerElement:s}),E1({eventId:t}))}else eat(),E1({eventId:t})}function iat(){var n;const t=document.getElementById(AP);t.style.minHeight=`${window.innerHeight*.9}px`,lo(t);const e=document.createElement("div");e.style.fontWeight="bold",e.className="block",e.innerHTML="Tournament Overview",t.appendChild(e);const i=(n=$e.getTournament().tournamentRecord)==null?void 0:n.notes;if(i){const r=document.createElement("div");r.innerHTML=i,t.appendChild(r)}}let rg;function Rx(t){M1(IR,t),M1(hU,t),M1(Sp,t),M1(ak,t);const e=document.getElementById("sideNav");t===IR?e.style.display="":e.style.display=ct}function M1(t,e){const i=t===e,n=document.getElementById(t);n&&(n.style.display=i?"flex":"none")}const nat=t=>t?t===rg:rg,AF=()=>{const t=document.getElementById(nk);t.style.display=ct,rg=hU,Rx(hU)},rat=t=>{const e=document.getElementById(nk);e.style.display="",rg=t,Rx(IR)},aat=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>");const e=document.getElementById(nk);e.style.display="",rg=Sp,Rx(rg)},oat=()=>{rg=ak,Rx(rg)};function sat({config:t}={}){const{tournamentRecord:e}=$e.getTournament();(e==null?void 0:e.tournamentId)===t.tournamentId?lTe(t):(Ye.ee.emit(Lwe,Ye.tournamentId),Gs.findTournament(t.tournamentId).then(i=>cTe({tournamentRecord:i,config:t})))}function _F({config:t}){rat(xa),Ktt(),aTe(t.selectedTab),lTe(t)}function lTe(t){const{selectedTab:e=Tp}=t;sce(e)&&(e===Tp&&KZe({participantView:t.participantView}),e===iy&&_0e({scheduledDate:t.scheduledDate}),e===AP&&iat(),e===Vu&&tat(t),e===qz&&Htt(),e===Kz&&lit())}function cTe({tournamentRecord:t,config:e}){const i=Bc(),n=(i==null?void 0:i.provider)||(Ye==null?void 0:Ye.provider),r=()=>{ai({message:"Tournament not found",onClose:()=>{Ye.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})},a=o=>{var l,c;const s=(c=(l=o==null?void 0:o.data)==null?void 0:l.tournamentRecords)==null?void 0:c[e.tournamentId];s?($e.setState(s),_F({config:e})):r()};if(n){const o=()=>{t?($e.setState(t),_F({config:e})):r()};e6({tournamentId:e.tournamentId}).then(a,o)}else $e.setState(t),_F({config:e})}function ha(t,e){return typeof window.dev[t]=="function"?window.dev[t](e):(window.dev.allSubscriptions||window.dev[t])&&console.log(t,e)}const lat={addDrawDefinition:t=>ha("addDrawDefinition",t),addMatchUps:t=>ha("addMatchUps",t),addParticipants:t=>ha("addParticipants",t),addVenue:t=>ha("addVenue",t),deletedDrawIds:t=>ha("deletedDrawIds",t),deletedMatchUpIds:t=>ha("deletedMatchUpIds",t),deleteVenue:t=>ha("deleteVenue",t),modifyDrawDefinition:t=>ha("modifyDrawDefinition",t),modifyDrawEntries:t=>ha("modifyDrawEntries",t),modifyEventEntries:t=>ha("modifyEventEntries",t),modifyMatchUp:t=>ha("modifyMatchUp",t),modifyParticipants:t=>ha("modifyParticipants",t),modifyPositionAssignments:t=>ha("modifyPositionAssignments",t),modifySeedAssignments:t=>ha("modifySeedAssignments",t),modifyVenue:t=>ha("modifyVenue",t),publishEvent:t=>ha("publishEvent",t),publishEventSeeding:t=>ha("publishEventSeeding",t),publishOrderOfPlay:t=>ha("publishOrderOfPlay",t),unPublishEvent:t=>ha("unPublishEvent",t),unPublishEventSeeding:t=>ha("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>ha("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>ha("updateInContextMatchUp",t)};function uTe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=n=>{var a;if(!Array.isArray(n)){ai({message:"missing methods array",intent:"is-danger"});return}((a=$e.getTournament().tournamentRecord)==null?void 0:a.tournamentId)?Pt({methods:n,callback:s=>{var l;if(s!=null&&s.success){ai({message:"success",intent:"is-success"});const c=$e.getTournament().tournamentRecord;e0e({tournamentRecord:c,callback:()=>cTe({tournamentRecord:c,config:{selectedTab:xa}})})}else ai({message:((l=s==null?void 0:s.error)==null?void 0:l.message)??"error",intent:"is-danger"}),console.log({result:s})}}):ai({message:"missing tournament",intent:"is-danger"})},i=n=>{e6({tournamentId:n}).then(r=>{var a,o;if(r!=null&&r.error)console.log({error:r.error});else{const s=(o=(a=r==null?void 0:r.data)==null?void 0:a.tournamentRecords)==null?void 0:o[n];s&&Z6(s)}})};R1({getProviders:()=>P2().then(n=>{var r;return console.log((r=n==null?void 0:n.data)==null?void 0:r.providers)}),getProvider:n=>P2().then(r=>{var a;return console.log((a=r==null?void 0:r.data)==null?void 0:a.providers.find(o=>o.value.organisationName.toLowerCase().includes(n.toLowerCase())))}),getTournament:()=>{var n;return(n=$e.getTournament())==null?void 0:n.tournamentRecord},getContext:oT.getDevContext,tournamentEngine:$e,context:oT.setDevContext,generateMockTournament:uat,modifyTournament:e,fetchTournament:i,getLoginState:Bc,factory:Ole,baseApi:$g,dayjs:AN,help:t}),R1({connectSocket:P6,disconnectSocket:gE,emitTmx:C6}),R1({tmx2db:Gs,load:cat,exportTournamentRecord:_3e}),R1({env:cn,tournamentContext:Ye}),oT.setSubscriptions({subscriptions:lat})}function R1(t){if(ru(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function cat(t){if(typeof t=="object"){const e=t.tournamentRecord||t;(e==null?void 0:e.tournamentId)&&Z6(e)}}function uat(t){const{tournamentRecord:e,error:i}=ik.generateTournamentRecord(t);i?console.log({error:i}):Z6(e)}function Z6(t){const e=t==null?void 0:t.tournamentId;e0e({tournamentRecord:t,callback:()=>Ye.router.navigate(`/${xa}/${e}`)})}class rT extends Error{}rT.prototype.name="InvalidTokenError";function dat(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function pat(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return dat(e)}catch{return atob(e)}}function hat(t,e){if(typeof t!="string")throw new rT("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,n=t.split(".")[i];if(typeof n!="string")throw new rT(`Invalid token specified: missing part #${i+1}`);let r;try{r=pat(n)}catch(a){throw new rT(`Invalid token specified: invalid base64 for part #${i+1} (${a.message})`)}try{return JSON.parse(r)}catch(a){throw new rT(`Invalid token specified: invalid json for part #${i+1} (${a.message})`)}}function dTe(t){var r,a;if(!t||t==="undefined"){lce();return}let e;try{e=hat(t)}catch{uce();return}const i=new Date;return(e==null?void 0:e.exp)<i.getTime()/1e3?Nx():(((r=e==null?void 0:e.permissions)!=null&&r.includes("devMode")||(a=e==null?void 0:e.roles)!=null&&a.includes("develope"))&&uTe(),e)}function pTe(t){var r;const e=document.getElementById("login"),i=Ye==null?void 0:Ye.provider,n=(r=t==null?void 0:t.roles)==null?void 0:r.includes(rk);e.style.color=i&&"red"||n&&"green"||"blue"}function Bc(){const t=dce(),e=dTe(t);return e&&pTe(e),e}function Nx(){uce(),lce(),gE(),Ye.provider=void 0,Ye.router.navigate(`/${Sp}/logout`);const t=document.getElementById("login");t.style.color=""}function fat({data:t,callback:e}){var n;const i=dTe(t.token);i&&(yOe(t.token),ai({intent:"is-success",message:"Login successful"}),gE(),$e.reset(),pTe(i),pt(e)&&e(),Ye.router.navigate(`/${Sp}/${(n=i.provider)==null?void 0:n.organisationAbbreviation}`))}function mat(){P2().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.providers)==null?void 0:i.map(({value:n})=>({onClick:()=>{Ye.provider=n,Ye.router.navigate(`/${Sp}/${n.organisationAbbreviation}`)},participantName:n.organisationName}));e&&gwe({title:"Select Provider",options:e,selectionLimit:1})})}function gat(){Ye.provider=void 0,Ye.router.navigate(`/${Sp}/superadmin`)}function vat(){const t=document.getElementById("login");t&&t.addEventListener("click",()=>{var a;const e=Bc(),i=(a=e==null?void 0:e.roles)==null?void 0:a.includes(rk),n=Ye==null?void 0:Ye.provider;nl({target:t,title:"Authorization",items:[{text:"Log in",hide:e,onClick:()=>z6()},{style:"text-decoration: line-through;",onClick:gat,text:"Impersonate",hide:!i||!n},{onClick:mat,text:"Impersonate",hide:!i||n},{text:"Log out",hide:!e,onClick:Nx}]})})}/*!
 * EventEmitter v5.2.6 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */const yat=function(){function t(){}let e=t.prototype;function i(a,o){let s=a.length;for(;s--;)if(a[s].listener===o)return s;return-1}function n(a){return function(){return this[a].apply(this,arguments)}}e.getListeners=function(o){let s=this._getEvents(),l,c;if(o instanceof RegExp){l={};for(c in s)s.hasOwnProperty(c)&&o.test(c)&&(l[c]=s[c])}else l=s[o]||(s[o]=[]);return l},e.flattenListeners=function(o){let s=[],l;for(l=0;l<o.length;l+=1)s.push(o[l].listener);return s},e.getListenersAsObject=function(o){let s=this.getListeners(o),l;return s instanceof Array&&(l={},l[o]=s),l||s};function r(a){return typeof a=="function"||a instanceof RegExp?!0:a&&typeof a=="object"?r(a.listener):!1}return e.addListener=function(o,s){if(!r(s))throw new TypeError("listener must be a function");let l=this.getListenersAsObject(o),c=typeof s=="object",u;for(u in l)l.hasOwnProperty(u)&&i(l[u],s)===-1&&l[u].push(c?s:{listener:s,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(o,s){return this.addListener(o,{listener:s,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(o){return this.getListeners(o),this},e.defineEvents=function(o){for(let s=0;s<o.length;s+=1)this.defineEvent(o[s]);return this},e.removeListener=function(o,s){let l=this.getListenersAsObject(o),c,u;for(u in l)l.hasOwnProperty(u)&&(c=i(l[u],s),c!==-1&&l[u].splice(c,1));return this},e.off=n("removeListener"),e.addListeners=function(o,s){return this.manipulateListeners(!1,o,s)},e.removeListeners=function(o,s){return this.manipulateListeners(!0,o,s)},e.manipulateListeners=function(o,s,l){let c,u,d=o?this.removeListener:this.addListener,p=o?this.removeListeners:this.addListeners;if(typeof s=="object"&&!(s instanceof RegExp))for(c in s)s.hasOwnProperty(c)&&(u=s[c])&&(typeof u=="function"?d.call(this,c,u):p.call(this,c,u));else for(c=l.length;c--;)d.call(this,s,l[c]);return this},e.removeEvent=function(o){let s=typeof o,l=this._getEvents(),c;if(s==="string")delete l[o];else if(o instanceof RegExp)for(c in l)l.hasOwnProperty(c)&&o.test(c)&&delete l[c];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(o,s){let l=this.getListenersAsObject(o),c,u,d,p,h;for(p in l)if(l.hasOwnProperty(p))for(c=l[p].slice(0),d=0;d<c.length;d++)u=c[d],u.once===!0&&this.removeListener(o,u.listener),h=u.listener.apply(this,s||[]),h===this._getOnceReturnValue()&&this.removeListener(o,u.listener);return this},e.trigger=n("emitEvent"),e.emit=function(o){let s=Array.prototype.slice.call(arguments,1);return this.emitEvent(o,s)},e.setOnceReturnValue=function(o){return this._onceReturnValue=o,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t}();function XX(){try{return window}catch{return}}const hTe=()=>XX().dev&&typeof XX().dev=="object";function Iat(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:sOe},window.onunhandledrejection=t=>{if(hTe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(lOe(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var fTe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],KN=fTe.join(","),mTe=typeof Element>"u",Dy=mTe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,YN=!mTe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},ZN=function t(e,i){var n;i===void 0&&(i=!0);var r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),a=r===""||r==="true",o=a||i&&e&&t(e.parentNode);return o},bat=function(e){var i,n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return n===""||n==="true"},gTe=function(e,i,n){if(ZN(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(KN));return i&&Dy.call(e,KN)&&r.unshift(e),r=r.filter(n),r},vTe=function t(e,i,n){for(var r=[],a=Array.from(e);a.length;){var o=a.shift();if(!ZN(o,!1))if(o.tagName==="SLOT"){var s=o.assignedElements(),l=s.length?s:o.children,c=t(l,!0,n);n.flatten?r.push.apply(r,c):r.push({scopeParent:o,candidates:c})}else{var u=Dy.call(o,KN);u&&n.filter(o)&&(i||!e.includes(o))&&r.push(o);var d=o.shadowRoot||typeof n.getShadowRoot=="function"&&n.getShadowRoot(o),p=!ZN(d,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(o));if(d&&p){var h=t(d===!0?o.children:d.children,!0,n);n.flatten?r.push.apply(r,h):r.push({scopeParent:o,candidates:h})}else a.unshift.apply(a,o.children)}}return r},yTe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},rv=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||bat(e))&&!yTe(e)?0:e.tabIndex},wat=function(e,i){var n=rv(e);return n<0&&i&&!yTe(e)?0:n},Sat=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},ITe=function(e){return e.tagName==="INPUT"},Tat=function(e){return ITe(e)&&e.type==="hidden"},Uat=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return i},Dat=function(e,i){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===i)return e[n]},Pat=function(e){if(!e.name)return!0;var i=e.form||YN(e),n=function(s){return i.querySelectorAll('input[type="radio"][name="'+s+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=n(window.CSS.escape(e.name));else try{r=n(e.name)}catch(o){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",o.message),!1}var a=Dat(r,e.form);return!a||a===e},Cat=function(e){return ITe(e)&&e.type==="radio"},Eat=function(e){return Cat(e)&&!Pat(e)},Mat=function(e){var i,n=e&&YN(e),r=(i=n)===null||i===void 0?void 0:i.host,a=!1;if(n&&n!==e){var o,s,l;for(a=!!((o=r)!==null&&o!==void 0&&(s=o.ownerDocument)!==null&&s!==void 0&&s.contains(r)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!a&&r;){var c,u,d;n=YN(r),r=(c=n)===null||c===void 0?void 0:c.host,a=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return a},JX=function(e){var i=e.getBoundingClientRect(),n=i.width,r=i.height;return n===0&&r===0},Rat=function(e,i){var n=i.displayCheck,r=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var a=Dy.call(e,"details>summary:first-of-type"),o=a?e.parentElement:e;if(Dy.call(o,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof r=="function"){for(var s=e;e;){var l=e.parentElement,c=YN(e);if(l&&!l.shadowRoot&&r(l)===!0)return JX(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=s}if(Mat(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return JX(e);return!1},Nat=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var n=0;n<i.children.length;n++){var r=i.children.item(n);if(r.tagName==="LEGEND")return Dy.call(i,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}i=i.parentElement}return!1},XN=function(e,i){return!(i.disabled||ZN(i)||Tat(i)||Rat(i,e)||Uat(i)||Nat(i))},oV=function(e,i){return!(Eat(i)||rv(i)<0||!XN(e,i))},Aat=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},_at=function t(e){var i=[],n=[];return e.forEach(function(r,a){var o=!!r.scopeParent,s=o?r.scopeParent:r,l=wat(s,o),c=o?t(r.candidates):s;l===0?o?i.push.apply(i,c):i.push(s):n.push({documentOrder:a,tabIndex:l,item:r,isScope:o,content:c})}),n.sort(Sat).reduce(function(r,a){return a.isScope?r.push.apply(r,a.content):r.push(a.content),r},[]).concat(i)},kat=function(e,i){i=i||{};var n;return i.getShadowRoot?n=vTe([e],i.includeContainer,{filter:oV.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:Aat}):n=gTe(e,i.includeContainer,oV.bind(null,i)),_at(n)},Oat=function(e,i){i=i||{};var n;return i.getShadowRoot?n=vTe([e],i.includeContainer,{filter:XN.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):n=gTe(e,i.includeContainer,XN.bind(null,i)),n},QI=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Dy.call(e,KN)===!1?!1:oV(i,e)},xat=fTe.concat("iframe").join(","),kF=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return Dy.call(e,xat)===!1?!1:XN(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function QX(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function eJ(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?QX(Object(i),!0).forEach(function(n){Lat(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):QX(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function Lat(t,e,i){return e=$at(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function Fat(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function $at(t){var e=Fat(t,"string");return typeof e=="symbol"?e:String(e)}var tJ={activateTrap:function(e,i){if(e.length>0){var n=e[e.length-1];n!==i&&n.pause()}var r=e.indexOf(i);r===-1||e.splice(r,1),e.push(i)},deactivateTrap:function(e,i){var n=e.indexOf(i);n!==-1&&e.splice(n,1),e.length>0&&e[e.length-1].unpause()}},Bat=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},Vat=function(e){return(e==null?void 0:e.key)==="Escape"||(e==null?void 0:e.key)==="Esc"||(e==null?void 0:e.keyCode)===27},OT=function(e){return(e==null?void 0:e.key)==="Tab"||(e==null?void 0:e.keyCode)===9},jat=function(e){return OT(e)&&!e.shiftKey},Gat=function(e){return OT(e)&&e.shiftKey},iJ=function(e){return setTimeout(e,0)},nJ=function(e,i){var n=-1;return e.every(function(r,a){return i(r)?(n=a,!1):!0}),n},GS=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,n):e},N1=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},Hat=[],zat=function(e,i){var n=(i==null?void 0:i.document)||document,r=(i==null?void 0:i.trapStack)||Hat,a=eJ({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:jat,isKeyBackward:Gat},i),o={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},s,l=function(M,N,R){return M&&M[N]!==void 0?M[N]:a[R||N]},c=function(M,N){var R=typeof(N==null?void 0:N.composedPath)=="function"?N.composedPath():void 0;return o.containerGroups.findIndex(function(A){var _=A.container,O=A.tabbableNodes;return _.contains(M)||(R==null?void 0:R.includes(_))||O.find(function(x){return x===M})})},u=function(M){var N=a[M];if(typeof N=="function"){for(var R=arguments.length,A=new Array(R>1?R-1:0),_=1;_<R;_++)A[_-1]=arguments[_];N=N.apply(void 0,A)}if(N===!0&&(N=void 0),!N){if(N===void 0||N===!1)return N;throw new Error("`".concat(M,"` was specified but was not a node, or did not return a node"))}var O=N;if(typeof N=="string"&&(O=n.querySelector(N),!O))throw new Error("`".concat(M,"` as selector refers to no known node"));return O},d=function(){var M=u("initialFocus");if(M===!1)return!1;if(M===void 0||!kF(M,a.tabbableOptions))if(c(n.activeElement)>=0)M=n.activeElement;else{var N=o.tabbableGroups[0],R=N&&N.firstTabbableNode;M=R||u("fallbackFocus")}if(!M)throw new Error("Your focus-trap needs to have at least one focusable element");return M},p=function(){if(o.containerGroups=o.containers.map(function(M){var N=kat(M,a.tabbableOptions),R=Oat(M,a.tabbableOptions),A=N.length>0?N[0]:void 0,_=N.length>0?N[N.length-1]:void 0,O=R.find(function($){return QI($)}),x=R.slice().reverse().find(function($){return QI($)}),F=!!N.find(function($){return rv($)>0});return{container:M,tabbableNodes:N,focusableNodes:R,posTabIndexesFound:F,firstTabbableNode:A,lastTabbableNode:_,firstDomTabbableNode:O,lastDomTabbableNode:x,nextTabbableNode:function(V){var G=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,j=N.indexOf(V);return j<0?G?R.slice(R.indexOf(V)+1).find(function(z){return QI(z)}):R.slice(0,R.indexOf(V)).reverse().find(function(z){return QI(z)}):N[j+(G?1:-1)]}}}),o.tabbableGroups=o.containerGroups.filter(function(M){return M.tabbableNodes.length>0}),o.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(o.containerGroups.find(function(M){return M.posTabIndexesFound})&&o.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},h=function P(M){var N=M.activeElement;if(N)return N.shadowRoot&&N.shadowRoot.activeElement!==null?P(N.shadowRoot):N},f=function P(M){if(M!==!1&&M!==h(document)){if(!M||!M.focus){P(d());return}M.focus({preventScroll:!!a.preventScroll}),o.mostRecentlyFocusedNode=M,Bat(M)&&M.select()}},m=function(M){var N=u("setReturnFocus",M);return N||(N===!1?!1:M)},g=function(M){var N=M.target,R=M.event,A=M.isBackward,_=A===void 0?!1:A;N=N||N1(R),p();var O=null;if(o.tabbableGroups.length>0){var x=c(N,R),F=x>=0?o.containerGroups[x]:void 0;if(x<0)_?O=o.tabbableGroups[o.tabbableGroups.length-1].lastTabbableNode:O=o.tabbableGroups[0].firstTabbableNode;else if(_){var $=nJ(o.tabbableGroups,function(K){var q=K.firstTabbableNode;return N===q});if($<0&&(F.container===N||kF(N,a.tabbableOptions)&&!QI(N,a.tabbableOptions)&&!F.nextTabbableNode(N,!1))&&($=x),$>=0){var V=$===0?o.tabbableGroups.length-1:$-1,G=o.tabbableGroups[V];O=rv(N)>=0?G.lastTabbableNode:G.lastDomTabbableNode}else OT(R)||(O=F.nextTabbableNode(N,!1))}else{var j=nJ(o.tabbableGroups,function(K){var q=K.lastTabbableNode;return N===q});if(j<0&&(F.container===N||kF(N,a.tabbableOptions)&&!QI(N,a.tabbableOptions)&&!F.nextTabbableNode(N))&&(j=x),j>=0){var z=j===o.tabbableGroups.length-1?0:j+1,H=o.tabbableGroups[z];O=rv(N)>=0?H.firstTabbableNode:H.firstDomTabbableNode}else OT(R)||(O=F.nextTabbableNode(N))}}else O=u("fallbackFocus");return O},v=function(M){var N=N1(M);if(!(c(N,M)>=0)){if(GS(a.clickOutsideDeactivates,M)){s.deactivate({returnFocus:a.returnFocusOnDeactivate});return}GS(a.allowOutsideClick,M)||M.preventDefault()}},y=function(M){var N=N1(M),R=c(N,M)>=0;if(R||N instanceof Document)R&&(o.mostRecentlyFocusedNode=N);else{M.stopImmediatePropagation();var A,_=!0;if(o.mostRecentlyFocusedNode)if(rv(o.mostRecentlyFocusedNode)>0){var O=c(o.mostRecentlyFocusedNode),x=o.containerGroups[O].tabbableNodes;if(x.length>0){var F=x.findIndex(function($){return $===o.mostRecentlyFocusedNode});F>=0&&(a.isKeyForward(o.recentNavEvent)?F+1<x.length&&(A=x[F+1],_=!1):F-1>=0&&(A=x[F-1],_=!1))}}else o.containerGroups.some(function($){return $.tabbableNodes.some(function(V){return rv(V)>0})})||(_=!1);else _=!1;_&&(A=g({target:o.mostRecentlyFocusedNode,isBackward:a.isKeyBackward(o.recentNavEvent)})),f(A||o.mostRecentlyFocusedNode||d())}o.recentNavEvent=void 0},I=function(M){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;o.recentNavEvent=M;var R=g({event:M,isBackward:N});R&&(OT(M)&&M.preventDefault(),f(R))},b=function(M){if(Vat(M)&&GS(a.escapeDeactivates,M)!==!1){M.preventDefault(),s.deactivate();return}(a.isKeyForward(M)||a.isKeyBackward(M))&&I(M,a.isKeyBackward(M))},D=function(M){var N=N1(M);c(N,M)>=0||GS(a.clickOutsideDeactivates,M)||GS(a.allowOutsideClick,M)||(M.preventDefault(),M.stopImmediatePropagation())},w=function(){if(o.active)return tJ.activateTrap(r,s),o.delayInitialFocusTimer=a.delayInitialFocus?iJ(function(){f(d())}):f(d()),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",v,{capture:!0,passive:!1}),n.addEventListener("touchstart",v,{capture:!0,passive:!1}),n.addEventListener("click",D,{capture:!0,passive:!1}),n.addEventListener("keydown",b,{capture:!0,passive:!1}),s},S=function(){if(o.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",v,!0),n.removeEventListener("touchstart",v,!0),n.removeEventListener("click",D,!0),n.removeEventListener("keydown",b,!0),s},U=function(M){var N=M.some(function(R){var A=Array.from(R.removedNodes);return A.some(function(_){return _===o.mostRecentlyFocusedNode})});N&&f(d())},C=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(U):void 0,E=function(){C&&(C.disconnect(),o.active&&!o.paused&&o.containers.map(function(M){C.observe(M,{subtree:!0,childList:!0})}))};return s={get active(){return o.active},get paused(){return o.paused},activate:function(M){if(o.active)return this;var N=l(M,"onActivate"),R=l(M,"onPostActivate"),A=l(M,"checkCanFocusTrap");A||p(),o.active=!0,o.paused=!1,o.nodeFocusedBeforeActivation=n.activeElement,N==null||N();var _=function(){A&&p(),w(),E(),R==null||R()};return A?(A(o.containers.concat()).then(_,_),this):(_(),this)},deactivate:function(M){if(!o.active)return this;var N=eJ({onDeactivate:a.onDeactivate,onPostDeactivate:a.onPostDeactivate,checkCanReturnFocus:a.checkCanReturnFocus},M);clearTimeout(o.delayInitialFocusTimer),o.delayInitialFocusTimer=void 0,S(),o.active=!1,o.paused=!1,E(),tJ.deactivateTrap(r,s);var R=l(N,"onDeactivate"),A=l(N,"onPostDeactivate"),_=l(N,"checkCanReturnFocus"),O=l(N,"returnFocus","returnFocusOnDeactivate");R==null||R();var x=function(){iJ(function(){O&&f(m(o.nodeFocusedBeforeActivation)),A==null||A()})};return O&&_?(_(m(o.nodeFocusedBeforeActivation)).then(x,x),this):(x(),this)},pause:function(M){if(o.paused||!o.active)return this;var N=l(M,"onPause"),R=l(M,"onPostPause");return o.paused=!0,N==null||N(),S(),E(),R==null||R(),this},unpause:function(M){if(!o.paused||!o.active)return this;var N=l(M,"onUnpause"),R=l(M,"onPostUnpause");return o.paused=!1,N==null||N(),p(),w(),E(),R==null||R(),this},updateContainerElements:function(M){var N=[].concat(M).filter(Boolean);return o.containers=N.map(function(R){return typeof R=="string"?n.querySelector(R):R}),o.active&&p(),E(),this}},s.updateContainerElements(e),s};const Wat=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,n,r;const a=jle;let o;const s=b=>r=b,l=()=>{pt(r)&&r()&&(r=void 0);const b=document.getElementById(a);b.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){n?(b.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",pt(n==null?void 0:n.callback)&&n.callback()):(b.classList.remove(t.activeClass),i=!1),n=!1,o==null||o.deactivate()},t.speedClose)},c=b=>{const D=document.getElementById(a);D.classList.contains(t.leftAlignment)||D.classList.add(t.leftAlignment),m(D,!1,b)},u=b=>{const D=document.getElementById(a);D.classList.remove(t.leftAlignment),m(D,!1,b)},d=b=>{const w=document.getElementById(a).querySelector(".drawer__title");w&&(w.innerHTML=b)},p=b=>{const w=document.getElementById(a).querySelector(".drawer__footer");w&&(lo(w),pt(b)?e.footer=b(w,l):w.innerHTML=b||"")},h=b=>{const w=document.getElementById(a).querySelector(".drawer__content");w&&(lo(w),pt(b)?e.content=b(w,l):w.innerHTML=b)},f=b=>{const w=document.getElementById(a).querySelector(".drawer__wrapper");w.style.width=b},m=(b,D,w)=>{i=!0,b.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",D&&(o=zat(b),o.activate()),pt(w)&&w(),setTimeout(function(){b.classList.add(t.visibleClass)},t.speedOpen)},g=({title:b,content:D,side:w,width:S,footer:U,callback:C,onClose:E}={})=>{if(D&&h(D),E&&s(E),b&&d(b),S&&f(S),p(U),i)n={callback:C};else if(w){if(w===vt)return u(C);if(w===Et)return c(C)}else{const P=document.getElementById(a);m(P,U,C)}},v=function(b,D){let w=D.parentNode;for(;w;){if(w===b)return!0;w=w.parentNode}return!1},y=function(b){const D=b.target,w=document.querySelector(".drawer__wrapper");(!v(w,D)||D.classList.contains("drawer__close"))&&l()},I=b=>{(b.key==="Escape"||b.keyCode===27)&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",I,!1),{settings:t,open:g,close:l,setTitle:d,setContent:h,setFooter:p,attributes:e}};function qat({data:t}={}){const e=t==null?void 0:t.inviteKey;let i;ir({title:"New User",content:a=>i=Wr(a,[{iconLeft:"fa-regular fa-user",placeholder:"First name",autocomplete:"firstName",label:"First Name",field:"firstName"},{iconLeft:"fa-solid fa-house",placeholder:"Last name",autocomplete:"lastName",label:"Last Name",field:"lastName"},{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Register",intent:"is-primary",onClick:()=>{const a=i.lastName.value,o=i.firstName.value,s=i.password.value,l=i.email.value,c=()=>{ai({message:"Success",intent:"is-success "}),z6()},u=d=>{var p;return(d==null?void 0:d.status)===200&&((p=d==null?void 0:d.data)==null?void 0:p.success)&&c()};Wtt(a,o,e,l,s).then(u,d=>console.log({err:d}))},close:!0}]})}function Kat(){const{tournamentRecord:t}=$e.getTournament();t&&(Ye.ee.emit(Lwe,t.tournamentId),$e.reset())}function rJ(){mx(),aat(),vOe(),Kat(),xwe()}function Dr(){}const Yat=t=>t;function Zat(t,e){for(const i in e)t[i]=e[i];return t}function bTe(t){return t()}function aJ(){return Object.create(null)}function rl(t){t.forEach(bTe)}function Ni(t){return typeof t=="function"}function Ss(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Xat(t){return Object.keys(t).length===0}function X6(t,...e){if(t==null){for(const n of e)n(void 0);return Dr}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function JN(t){let e;return X6(t,i=>e=i)(),e}function Ve(t,e,i){t.$$.on_destroy.push(X6(e,i))}function Jat(t,e,i,n){if(t){const r=wTe(t,e,i,n);return t[0](r)}}function wTe(t,e,i,n){return t[1]&&n?Zat(i.ctx.slice(),t[1](n(e))):i.ctx}function Qat(t,e,i,n){if(t[2]&&n){const r=t[2](n(i));if(e.dirty===void 0)return r;if(typeof r=="object"){const a=[],o=Math.max(e.dirty.length,r.length);for(let s=0;s<o;s+=1)a[s]=e.dirty[s]|r[s];return a}return e.dirty|r}return e.dirty}function eot(t,e,i,n,r,a){if(r){const o=wTe(e,i,n,a);t.p(o,r)}}function tot(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let n=0;n<i;n++)e[n]=-1;return e}return-1}function Hn(t,e,i){return t.set(i),e}function Py(t){return t&&Ni(t.destroy)?t.destroy:Dr}const iot=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Zn(t,e){t.appendChild(e)}function Dn(t,e,i){t.insertBefore(e,i||null)}function Sn(t){t.parentNode&&t.parentNode.removeChild(t)}function MI(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function In(t){return document.createElement(t)}function SE(t){return document.createTextNode(t)}function Rs(){return SE(" ")}function ch(){return SE("")}function un(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function QN(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function Qe(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function not(t){return Array.from(t.childNodes)}function STe(t,e){e=""+e,t.data!==e&&(t.data=e)}function oJ(t,e,i,n){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,n?"important":"")}function Ww(t,e){return new t(e)}let uD;function xT(t){uD=t}function gS(){if(!uD)throw new Error("Function called outside component initialization");return uD}function rot(t){gS().$$.before_update.push(t)}function aot(t){gS().$$.on_mount.push(t)}function TTe(t){gS().$$.after_update.push(t)}function oot(t,e){return gS().$$.context.set(t,e),e}function Jl(t){return gS().$$.context.get(t)}function Ax(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(n=>n.call(this,e))}const db=[],Lp=[];let Mb=[];const sJ=[],UTe=Promise.resolve();let sV=!1;function DTe(){sV||(sV=!0,UTe.then(PTe))}function J6(){return DTe(),UTe}function lV(t){Mb.push(t)}const OF=new Set;let eb=0;function PTe(){if(eb!==0)return;const t=uD;do{try{for(;eb<db.length;){const e=db[eb];eb++,xT(e),sot(e.$$)}}catch(e){throw db.length=0,eb=0,e}for(xT(null),db.length=0,eb=0;Lp.length;)Lp.pop()();for(let e=0;e<Mb.length;e+=1){const i=Mb[e];OF.has(i)||(OF.add(i),i())}Mb.length=0}while(db.length);for(;sJ.length;)sJ.pop()();sV=!1,OF.clear(),xT(t)}function sot(t){if(t.fragment!==null){t.update(),rl(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(lV)}}function lot(t){const e=[],i=[];Mb.forEach(n=>t.indexOf(n)===-1?e.push(n):i.push(n)),i.forEach(n=>n()),Mb=e}const kM=new Set;let pv;function Ls(){pv={r:0,c:[],p:pv}}function Fs(){pv.r||rl(pv.c),pv=pv.p}function Bt(t,e){t&&t.i&&(kM.delete(t),t.i(e))}function Si(t,e,i,n){if(t&&t.o){if(kM.has(t))return;kM.add(t),pv.c.push(()=>{kM.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}else n&&n()}function Co(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function CTe(t,e){Si(t,1,1,()=>{e.delete(t.key)})}function ETe(t,e,i,n,r,a,o,s,l,c,u,d){let p=t.length,h=a.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],v=new Map,y=new Map,I=[];for(f=h;f--;){const S=d(r,a,f),U=i(S);let C=o.get(U);C?n&&I.push(()=>C.p(S,e)):(C=c(U,S),C.c()),v.set(U,g[f]=C),U in m&&y.set(U,Math.abs(f-m[U]))}const b=new Set,D=new Set;function w(S){Bt(S,1),S.m(s,u),o.set(S.key,S),u=S.first,h--}for(;p&&h;){const S=g[h-1],U=t[p-1],C=S.key,E=U.key;S===U?(u=S.first,p--,h--):v.has(E)?!o.has(C)||b.has(C)?w(S):D.has(E)?p--:y.get(C)>y.get(E)?(D.add(C),w(S)):(b.add(E),p--):(l(U,o),p--)}for(;p--;){const S=t[p];v.has(S.key)||l(S,o)}for(;h;)w(g[h-1]);return rl(I),g}function Ma(t){t&&t.c()}function ma(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),lV(()=>{const a=t.$$.on_mount.map(bTe).filter(Ni);t.$$.on_destroy?t.$$.on_destroy.push(...a):rl(a),t.$$.on_mount=[]}),r.forEach(lV)}function ea(t,e){const i=t.$$;i.fragment!==null&&(lot(i.after_update),rl(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function cot(t,e){t.$$.dirty[0]===-1&&(db.push(t),DTe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function al(t,e,i,n,r,a,o=null,s=[-1]){const l=uD;xT(t);const c=t.$$={fragment:null,ctx:[],props:a,update:Dr,not_equal:r,bound:aJ(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:aJ(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};o&&o(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...h)=>{const f=h.length?h[0]:p;return c.ctx&&r(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),u&&cot(t,d)),p}):[],c.update(),u=!0,rl(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const d=not(e.target);c.fragment&&c.fragment.l(d),d.forEach(Sn)}else c.fragment&&c.fragment.c();e.intro&&Bt(t.$$.fragment),ma(t,e.target,e.anchor),PTe()}xT(l)}class ol{constructor(){Qx(this,"$$");Qx(this,"$$set")}$destroy(){ea(this,1),this.$destroy=Dr}$on(e,i){if(!Ni(i))return Dr;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const r=n.indexOf(i);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!Xat(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const tb=[];function MTe(t,e){return{subscribe:Oa(t,e).subscribe}}function Oa(t,e=Dr){let i;const n=new Set;function r(s){if(Ss(t,s)&&(t=s,i)){const l=!tb.length;for(const c of n)c[1](),tb.push(c,t);if(l){for(let c=0;c<tb.length;c+=2)tb[c][0](tb[c+1]);tb.length=0}}}function a(s){r(s(t))}function o(s,l=Dr){const c=[s,l];return n.add(c),n.size===1&&(i=e(r,a)||Dr),s(t),()=>{n.delete(c),n.size===0&&i&&(i(),i=null)}}return{set:r,update:a,subscribe:o}}function kd(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const a=e.length<2;return MTe(i,(o,s)=>{let l=!1;const c=[];let u=0,d=Dr;const p=()=>{if(u)return;d();const f=e(n?c[0]:c,o,s);a?o(f):d=Ni(f)?f:Dr},h=r.map((f,m)=>X6(f,g=>{c[m]=g,u&=~(1<<m),l&&p()},()=>{u|=1<<m}));return l=!0,p(),function(){rl(h),d(),l=!1}})}function eA(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function vS(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n!=null&&n.domNodes?t.replaceChildren(...n.domNodes):n!=null&&n.html&&(t.innerHTML=n.html)}};return i.update(e),i}function uot(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const dot=86400;function Cy(t=void 0){return t!==void 0?t instanceof Date?cJ(t):fot(t):cJ(new Date)}function av(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function pr(t){return new Date(t.getTime())}function Wu(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)qw(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function RTe(t,e,i=1){return Wu(t,e,-i)}function ag(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function qw(t,e=1){return ag(t,-e)}function Cm(t){return t.setUTCHours(0,0,0,0),t}function Il(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function nu(t,e=19){return t.toISOString().substring(0,e)}function ip(t,...e){return e.every(i=>t.getTime()===i.getTime())}function pot(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function NTe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function lJ(t){return typeof t=="string"&&t.length<=10}function hot(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function cJ(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function fot(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function Q6(t,e,i){i.update(n=>n.set(e,t))}function uJ(t){rl(t),t.clear()}function ATe(t,e,i){e??(e=t),i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}function RI(...t){return Object.assign(...t)}function bm(t){return Object.keys(t)}function mot(t){return Math.floor(t)}function aT(...t){return Math.min(...t)}function vb(...t){return Math.max(...t)}function got(){return Symbol("ec")}function _Te(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let a of n)r.setAttribute(...a);return r}function vot(t){return t.scrollHeight>t.clientHeight}function Em(t){return t.getBoundingClientRect()}function dD(t,e){for(;e--;)t=t.parentElement;return t}function A1(t){return Em(t).height}let e7=got();function yot(t,e){t[e7]=e}function Iot(t){return!!(t!=null&&t[e7])}function OM(t){return t[e7]}function LT(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if(Iot(n))return n;if(n.shadowRoot){let r=LT(t,e,n.shadowRoot);if(r)return r}}return null}function bot(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function cc(t){return t=RI({},t),t.currentStart=Il(t.currentStart),t.currentEnd=Il(t.currentEnd),t.activeStart=Il(t.activeStart),t.activeEnd=Il(t.activeEnd),t}function cV(t){return t.startsWith("list")}let wot=1;function tA(t){return t.map(e=>({id:"id"in e?String(e.id):`{generated-${wot++}}`,resourceIds:Array.isArray(e.resourceIds)?e.resourceIds.map(String):"resourceId"in e?[String(e.resourceId)]:[],allDay:e.allDay??(lJ(e.start)&&lJ(e.end)),start:Cy(e.start),end:Cy(e.end),title:e.title||"",titleHTML:e.titleHTML||"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display||"auto",extendedProps:e.extendedProps||{},backgroundColor:e.backgroundColor||e.color,textColor:e.textColor}))}function Sot(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function uV(t,e,i){return{start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t}}function Tot(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function Uot(t,e,i,n,r,a){let o=r.formatRange(t.start,e&&t.event.display!=="pointer"?hot(pr(t.start),t.end):t.start),s;if(i)s=Ni(i)?i({event:ju(t.event),timeText:o,view:cc(a)}):i;else{let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[dJ(o,t,n)];break;default:l=[...t.event.allDay?[]:[dJ(o,t,n)],_Te("h4",n.eventTitle,t.event.title)]}s={domNodes:l}}return[o,s]}function dJ(t,e,i){return _Te("time",i.eventTime,t,[["datetime",nu(e.start)]])}function Dot(t,e,i){return t?(Ni(t)&&(t=t({event:ju(e),view:cc(i)})),Array.isArray(t)?t:[t]):[]}function ju(t){return kTe(t,Il)}function pJ(t){return kTe(t,pr)}function kTe(t,e){return t=RI({},t),t.start=e(t.start),t.end=e(t.end),t}function hJ(t,e){let i={};if(t.length){Tot(t);let n;for(let r of t){let a=[],o=Cm(pr(r.start));for(;r.end>o;){if(!e.includes(o.getUTCDay())&&(a.push(pr(o)),a.length>1)){let s=o.getTime();i[s]?i[s].chunks.push(r):i[s]={sorted:!1,chunks:[r]}}ag(o)}a.length?(r.date=a[0],r.days=a.length,r.dates=a,r.start<a[0]&&(r.start=a[0]),Cm(pr(r.end))>a[a.length-1]&&(r.end=a[a.length-1])):(r.date=Cm(pr(r.start)),r.days=1,r.dates=[r.date]),n&&ip(n.date,r.date)&&(r.prev=n),n=r}}return i}function Pot(t,e,i){var a,o;t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if((a=e[r])!=null&&a.sorted||(o=e[r])!=null&&o.chunks.every(s=>"top"in s)){e[r].sorted||(e[r].chunks.sort((s,l)=>s.top-l.top),e[r].sorted=!0);for(let s of e[r].chunks)if(t.top<s.bottom&&t.bottom>s.top){let l=s.bottom-t.top+1;n+=l,t.top+=l,t.bottom+=l}}return n}function OTe(t,e){var i;t.length=e.length;for(let n of t)(i=n==null?void 0:n.reposition)==null||i.call(n)}function fJ(t,e,i,n,r){return(t.start<i&&t.end>e||!r&&ip(t.start,t.end,e))&&(n===void 0||t.resourceIds.includes(n.id))}function Kw(t){return Cot(t)||Eot(t)||Mot(t)}function t7(t){return t==="background"}function Cot(t){return t==="preview"}function Eot(t){return t==="ghost"}function Mot(t){return t==="pointer"}function Rot(t){return Not(t,"month")}function Not(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function Aot(t){return e=>({...e,view:t})}function FT(t,e){return kd([t,e],([i,n])=>{let r=Ni(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:a=>r.format(Il(a))}})}function mJ(t,e){return kd([t,e],([i,n])=>{let r;if(Ni(n))r=n;else{let a=new Intl.DateTimeFormat(i,n);r=(o,s)=>{if(o<=s)return a.formatRange(o,s);{let l=a.formatRangeToParts(s,o),c="",u=["startRange","endRange"],d=[!1,!1];for(let p of l){let h=u.indexOf(p.source);h>=0?d[h]||(c+=_ot(u[1-h],l),d[h]=!0):c+=p.value}return c}}}return{formatRange:(a,o)=>r(Il(a),Il(o))}})}function _ot(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}function kot(t){var i;let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"long"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},view:void 0,viewDidMount:void 0,views:{}};for(let n of t)(i=n.createOptions)==null||i.call(n,e);return e}function Oot(t){var i;let e={date:n=>Cm(Cy(n)),duration:av,events:tA,eventSources:Sot,hiddenDays:n=>[...new Set(n)],highlightedDates:n=>n.map(Cy),scrollTime:av,slotDuration:av,slotMaxTime:av,slotMinTime:av};for(let n of t)(i=n.createParsers)==null||i.call(n,e);return e}function xot(t,e){let i=[];for(let n of bm(t))t[n]!==e[n]&&i.push([n,t[n]]);return RI(e,t),i}function Lot(t){return kd(t.view,e=>e==null?void 0:e.startsWith("dayGrid"))}function Fot(t){return kd([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,n,r])=>{let a=pr(e.start),o=pr(e.end);if(r)NTe(a,i),pot(o,i);else if(n.days||n.seconds>dot){Wu(qw(o),n);let s=qw(pr(o));s<a&&(a=s)}return{start:a,end:o}})}function $ot(t){return kd([t.date,t.duration,t.firstDay,t._dayGrid],([e,i,n,r])=>{let a=pr(e),o;return r?a.setUTCDate(1):i.inWeeks&&NTe(a,n),o=Wu(pr(a),i),{start:a,end:o}})}function Bot(t){return kd([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=Cm(pr(e.start)),a=Cm(pr(e.end));for(;r<a;)i.includes(r.getUTCDay())||n.push(pr(r)),ag(r);return!n.length&&i.length&&i.length<7&&(t.date.update(o=>{for(;i.includes(o.getUTCDay());)ag(o);return o}),n=JN(t._viewDates)),n})}function Vot(t){return kd([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,qw(pr(i.end))))}function jot(t){return kd([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>bot(...e))}function Got(t){let e=Oa([]),i,n=0,r={};return kd([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(a,o)=>Q6(()=>{let[s,l,c,u,d,p]=a;if(!l.length){o(s);return}if(!u.start||u.start>c.start||u.end<c.end||!d){i&&i.abort(),i=new AbortController,Ni(p)&&!n&&p(!0);let h=()=>{--n===0&&Ni(p)&&p(!1)},f=[],m=I=>h(),g=I=>{f=f.concat(tA(I)),o(f),h()},v=nu(c.start),y=nu(c.end);for(let I of l){if(Ni(I.events)){let b=I.events({start:Il(c.start),end:Il(c.end),startStr:v,endStr:y},g,m);b!==void 0&&Promise.resolve(b).then(g,m)}else{let b=Ni(I.extraParams)?I.extraParams():RI({},I.extraParams);b.start=v,b.end=y,b=new URLSearchParams(b);let D=I.url,w={},S;["GET","HEAD"].includes(I.method)?D+=(D.includes("?")?"&":"?")+b:(w["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",S=String(b)),fetch(D,{method:I.method,headers:w,body:S,signal:i.signal,credentials:"same-origin"}).then(U=>U.json()).then(g).catch(m)}++n}u.start=c.start,u.end=c.end}},r,t._queue),[]).subscribe(e.set),e}function Hot(){return MTe(Cy(),t=>{let e=setInterval(()=>{t(Cy())},1e3);return()=>clearInterval(e)})}function zot(t){return kd(t._now,e=>Cm(pr(e)))}class Wot{constructor(e,i){var o,s;e=e||[];let n=kot(e),r=Oot(e);n=dV(n,r),i=dV(i,r);for(let[l,c]of Object.entries(n))this[l]=Oa(c);this._queue=Oa(new Map),this._queue2=Oa(new Map),this._tasks=new Map,this._auxiliary=Oa([]),this._dayGrid=Lot(this),this._currentRange=$ot(this),this._activeRange=Fot(this),this._fetchedRange=Oa({start:void 0,end:void 0}),this._events=Got(this),this._now=Hot(),this._today=zot(this),this._intlEventTime=mJ(this.locale,this.eventTimeFormat),this._intlSlotLabel=FT(this.locale,this.slotLabelFormat),this._intlDayHeader=FT(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=FT(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=mJ(this.locale,this.titleFormat),this._bodyEl=Oa(void 0),this._scrollable=Oa(!1),this._viewTitle=Vot(this),this._viewDates=Bot(this),this._view=jot(this),this._viewComponent=Oa(void 0),this._resBgColor=Oa(Dr),this._resTxtColor=Oa(Dr),this._interaction=Oa({}),this._iEvents=Oa([null,null]),this._iClasses=Oa(Yat),this._iClass=Oa(void 0),this._set=(l,c)=>{pV(l,this)&&(r[l]&&(c=r[l](c)),this[l].set(c))},this._get=l=>pV(l,this)?JN(this[l]):void 0;for(let l of e)(o=l.createStores)==null||o.call(l,this);i.view&&this.view.set(i.view);let a=new Set([...bm(n.views),...bm(i.views??{})]);for(let l of a){let c=gJ(n,n.views[l]??{}),u=gJ(c,i,((s=i.views)==null?void 0:s[l])??{}),d=u.component;qot(u,this);for(let p of bm(u)){let{set:h,_set:f=h,...m}=this[p];this[p]={set:["buttonText","theme"].includes(p)?g=>{if(Ni(g)){let v=g(c[p]);u[p]=v,h(h===f?v:g)}else u[p]=g,h(g)}:g=>{u[p]=g,h(g)},_set:f,...m}}this.view.subscribe(p=>{if(p===l){this._viewComponent.set(d),Ni(u.viewDidMount)&&J6().then(()=>u.viewDidMount(JN(this._view)));for(let h of bm(u))this[h]._set(u[h])}})}}}function dV(t,e){let i={...t};for(let n of bm(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of bm(t.views))i.views[n]=dV(t.views[n],e)}return i}function gJ(...t){let e={};for(let i of t){let n={};for(let r of["buttonText","theme"])Ni(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function qot(t,e){bm(t).filter(i=>!pV(i,e)||i=="view").forEach(i=>delete t[i])}function pV(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function vJ(t,e,i){const n=t.slice();return n[23]=e[i],n}function Kot(t){let e,i=t[5][t[23]]+"",n,r,a,o;function s(){return t[20](t[23])}return{c(){e=In("button"),n=SE(i),Qe(e,"class",r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])},m(l,c){Dn(l,e,c),Zn(e,n),a||(o=un(e,"click",s),a=!0)},p(l,c){t=l,c&33&&i!==(i=t[5][t[23]]+"")&&STe(n,i),c&73&&r!==(r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])&&Qe(e,"class",r)},d(l){l&&Sn(e),a=!1,o()}}}function Yot(t){let e,i=t[5][t[23]]+"",n,r,a,o;return{c(){e=In("button"),n=SE(i),Qe(e,"class",r=t[3].button+" ec-"+t[23]),e.disabled=t[1]},m(s,l){Dn(s,e,l),Zn(e,n),a||(o=un(e,"click",t[19]),a=!0)},p(s,l){l&33&&i!==(i=s[5][s[23]]+"")&&STe(n,i),l&9&&r!==(r=s[3].button+" ec-"+s[23])&&Qe(e,"class",r),l&2&&(e.disabled=s[1])},d(s){s&&Sn(e),a=!1,o()}}}function Zot(t){let e,i,n,r,a,o,s,l;return{c(){e=In("button"),i=In("i"),Qe(i,"class",n=t[3].icon+" ec-"+t[23]),Qe(e,"class",r=t[3].button+" ec-"+t[23]),Qe(e,"aria-label",a=t[5].next),Qe(e,"title",o=t[5].next)},m(c,u){Dn(c,e,u),Zn(e,i),s||(l=un(e,"click",t[17]),s=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[23])&&Qe(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[23])&&Qe(e,"class",r),u&32&&a!==(a=c[5].next)&&Qe(e,"aria-label",a),u&32&&o!==(o=c[5].next)&&Qe(e,"title",o)},d(c){c&&Sn(e),s=!1,l()}}}function Xot(t){let e,i,n,r,a,o,s,l;return{c(){e=In("button"),i=In("i"),Qe(i,"class",n=t[3].icon+" ec-"+t[23]),Qe(e,"class",r=t[3].button+" ec-"+t[23]),Qe(e,"aria-label",a=t[5].prev),Qe(e,"title",o=t[5].prev)},m(c,u){Dn(c,e,u),Zn(e,i),s||(l=un(e,"click",t[16]),s=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[23])&&Qe(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[23])&&Qe(e,"class",r),u&32&&a!==(a=c[5].prev)&&Qe(e,"aria-label",a),u&32&&o!==(o=c[5].prev)&&Qe(e,"title",o)},d(c){c&&Sn(e),s=!1,l()}}}function Jot(t){let e,i,n,r,a;return{c(){e=In("h2"),Qe(e,"class",i=t[3].title)},m(o,s){Dn(o,e,s),r||(a=Py(n=vS.call(null,e,t[4])),r=!0)},p(o,s){s&8&&i!==(i=o[3].title)&&Qe(e,"class",i),n&&Ni(n.update)&&s&16&&n.update.call(null,o[4])},d(o){o&&Sn(e),r=!1,a()}}}function yJ(t){let e;function i(a,o){if(a[23]=="title")return Jot;if(a[23]=="prev")return Xot;if(a[23]=="next")return Zot;if(a[23]=="today")return Yot;if(a[23]!="")return Kot}let n=i(t),r=n&&n(t);return{c(){r&&r.c(),e=ch()},m(a,o){r&&r.m(a,o),Dn(a,e,o)},p(a,o){n===(n=i(a))&&r?r.p(a,o):(r&&r.d(1),r=n&&n(a),r&&(r.c(),r.m(e.parentNode,e)))},d(a){a&&Sn(e),r&&r.d(a)}}}function Qot(t){let e,i=Co(t[0]),n=[];for(let r=0;r<i.length;r+=1)n[r]=yJ(vJ(t,i,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=ch()},m(r,a){for(let o=0;o<n.length;o+=1)n[o]&&n[o].m(r,a);Dn(r,e,a)},p(r,[a]){if(a&229503){i=Co(r[0]);let o;for(o=0;o<i.length;o+=1){const s=vJ(r,i,o);n[o]?n[o].p(s,a):(n[o]=yJ(s),n[o].c(),n[o].m(e.parentNode,e))}for(;o<n.length;o+=1)n[o].d(1);n.length=i.length}},i:Dr,o:Dr,d(r){r&&Sn(e),MI(n,r)}}}function est(t,e,i){let n,r,a,o,s,l,c,u,{buttons:d}=e,{_currentRange:p,_viewTitle:h,buttonText:f,date:m,duration:g,hiddenDays:v,theme:y,view:I}=Jl("state");Ve(t,p,E=>i(18,o=E)),Ve(t,h,E=>i(4,l=E)),Ve(t,f,E=>i(5,c=E)),Ve(t,m,E=>i(2,r=E)),Ve(t,g,E=>i(21,n=E)),Ve(t,v,E=>i(22,a=E)),Ve(t,y,E=>i(3,s=E)),Ve(t,I,E=>i(6,u=E));let b=Cm(Cy()),D;function w(){let E=RTe(r,n);if(a.length&&a.length<7)for(;a.includes(E.getUTCDay());)qw(E);Hn(m,r=E,r)}function S(){Hn(m,r=Wu(r,n),r)}const U=()=>Hn(m,r=pr(b),r),C=E=>Hn(I,u=E,u);return t.$$set=E=>{"buttons"in E&&i(0,d=E.buttons)},t.$$.update=()=>{t.$$.dirty&262144&&i(1,D=b>=o.start&&b<o.end||null)},[d,D,r,s,l,c,u,p,h,f,m,g,v,y,I,b,w,S,o,U,C]}class xTe extends ol{constructor(e){super(),al(this,e,est,Qot,Ss,{buttons:0})}}function IJ(t,e,i){const n=t.slice();return n[5]=e[i],n}function bJ(t,e,i){const n=t.slice();return n[8]=e[i],n}function tst(t){let e,i;return e=new xTe({props:{buttons:t[8]}}),{c(){Ma(e.$$.fragment)},m(n,r){ma(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.buttons=n[8]),e.$set(a)},i(n){i||(Bt(e.$$.fragment,n),i=!0)},o(n){Si(e.$$.fragment,n),i=!1},d(n){ea(e,n)}}}function ist(t){let e,i,n,r;return i=new xTe({props:{buttons:t[8]}}),{c(){e=In("div"),Ma(i.$$.fragment),Qe(e,"class",n=t[1].buttonGroup)},m(a,o){Dn(a,e,o),ma(i,e,null),r=!0},p(a,o){const s={};o&1&&(s.buttons=a[8]),i.$set(s),(!r||o&2&&n!==(n=a[1].buttonGroup))&&Qe(e,"class",n)},i(a){r||(Bt(i.$$.fragment,a),r=!0)},o(a){Si(i.$$.fragment,a),r=!1},d(a){a&&Sn(e),ea(i)}}}function wJ(t){let e,i,n,r;const a=[ist,tst],o=[];function s(l,c){return l[8].length>1?0:1}return e=s(t),i=o[e]=a[e](t),{c(){i.c(),n=ch()},m(l,c){o[e].m(l,c),Dn(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?o[e].p(l,c):(Ls(),Si(o[u],1,1,()=>{o[u]=null}),Fs(),i=o[e],i?i.p(l,c):(i=o[e]=a[e](l),i.c()),Bt(i,1),i.m(n.parentNode,n))},i(l){r||(Bt(i),r=!0)},o(l){Si(i),r=!1},d(l){l&&Sn(n),o[e].d(l)}}}function SJ(t){let e,i,n,r=Co(t[0][t[5]]),a=[];for(let s=0;s<r.length;s+=1)a[s]=wJ(bJ(t,r,s));const o=s=>Si(a[s],1,1,()=>{a[s]=null});return{c(){e=In("div");for(let s=0;s<a.length;s+=1)a[s].c();i=Rs()},m(s,l){Dn(s,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);Zn(e,i),n=!0},p(s,l){if(l&3){r=Co(s[0][s[5]]);let c;for(c=0;c<r.length;c+=1){const u=bJ(s,r,c);a[c]?(a[c].p(u,l),Bt(a[c],1)):(a[c]=wJ(u),a[c].c(),Bt(a[c],1),a[c].m(e,i))}for(Ls(),c=r.length;c<a.length;c+=1)o(c);Fs()}},i(s){if(!n){for(let l=0;l<r.length;l+=1)Bt(a[l]);n=!0}},o(s){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Si(a[l]);n=!1},d(s){s&&Sn(e),MI(a,s)}}}function nst(t){let e,i,n,r=Co(Object.keys(t[0])),a=[];for(let s=0;s<r.length;s+=1)a[s]=SJ(IJ(t,r,s));const o=s=>Si(a[s],1,1,()=>{a[s]=null});return{c(){e=In("nav");for(let s=0;s<a.length;s+=1)a[s].c();Qe(e,"class",i=t[1].toolbar)},m(s,l){Dn(s,e,l);for(let c=0;c<a.length;c+=1)a[c]&&a[c].m(e,null);n=!0},p(s,[l]){if(l&3){r=Co(Object.keys(s[0]));let c;for(c=0;c<r.length;c+=1){const u=IJ(s,r,c);a[c]?(a[c].p(u,l),Bt(a[c],1)):(a[c]=SJ(u),a[c].c(),Bt(a[c],1),a[c].m(e,null))}for(Ls(),c=r.length;c<a.length;c+=1)o(c);Fs()}(!n||l&2&&i!==(i=s[1].toolbar))&&Qe(e,"class",i)},i(s){if(!n){for(let l=0;l<r.length;l+=1)Bt(a[l]);n=!0}},o(s){a=a.filter(Boolean);for(let l=0;l<a.length;l+=1)Si(a[l]);n=!1},d(s){s&&Sn(e),MI(a,s)}}}function rst(t,e,i){let n,r,{headerToolbar:a,theme:o}=Jl("state");Ve(t,a,l=>i(4,n=l)),Ve(t,o,l=>i(1,r=l));let s={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of Object.keys(s))i(0,s[l]=n[l].split(" ").map(c=>c.split(",")),s)},[s,r,a,o,n]}class ast extends ol{constructor(e){super(),al(this,e,rst,nst,Ss,{})}}function TJ(t,e,i){const n=t.slice();return n[11]=e[i],n}function UJ(t){let e,i,n;var r=t[11];function a(o,s){return{}}return r&&(e=Ww(r,a())),{c(){e&&Ma(e.$$.fragment),i=ch()},m(o,s){e&&ma(e,o,s),Dn(o,i,s),n=!0},p(o,s){if(s&1&&r!==(r=o[11])){if(e){Ls();const l=e;Si(l.$$.fragment,1,0,()=>{ea(l,1)}),Fs()}r?(e=Ww(r,a()),Ma(e.$$.fragment),Bt(e.$$.fragment,1),ma(e,i.parentNode,i)):e=null}},i(o){n||(e&&Bt(e.$$.fragment,o),n=!0)},o(o){e&&Si(e.$$.fragment,o),n=!1},d(o){o&&Sn(i),e&&ea(e,o)}}}function ost(t){let e,i,n=Co(t[0]),r=[];for(let o=0;o<n.length;o+=1)r[o]=UJ(TJ(t,n,o));const a=o=>Si(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=ch()},m(o,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,s);Dn(o,e,s),i=!0},p(o,[s]){if(s&1){n=Co(o[0]);let l;for(l=0;l<n.length;l+=1){const c=TJ(o,n,l);r[l]?(r[l].p(c,s),Bt(r[l],1)):(r[l]=UJ(c),r[l].c(),Bt(r[l],1),r[l].m(e.parentNode,e))}for(Ls(),l=n.length;l<r.length;l+=1)a(l);Fs()}},i(o){if(!i){for(let s=0;s<n.length;s+=1)Bt(r[s]);i=!0}},o(o){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Si(r[s]);i=!1},d(o){o&&Sn(e),MI(r,o)}}}function sst(t,e,i){let n,r,a,o,{datesSet:s,_auxiliary:l,_activeRange:c,_queue:u,_view:d}=Jl("state");Ve(t,s,f=>i(7,r=f)),Ve(t,l,f=>i(0,o=f)),Ve(t,c,f=>i(5,a=f)),Ve(t,d,f=>i(6,n=f));let p={};function h(f){Ni(r)&&Q6(()=>r({start:Il(f.start),end:Il(f.end),startStr:nu(f.start),endStr:nu(f.end),view:cc(n)}),p,u)}return t.$$.update=()=>{t.$$.dirty&32&&h(a)},[o,s,l,c,d,a]}let lst=class extends ol{constructor(e){super(),al(this,e,sst,ost,Ss,{})}};function cst(t){let e,i,n,r,a,o,s,l,c,u,d;i=new ast({});var p=t[5];function h(f,m){return{}}return p&&(r=Ww(p,h())),l=new lst({}),{c(){e=In("div"),Ma(i.$$.fragment),n=Rs(),r&&Ma(r.$$.fragment),s=Rs(),Ma(l.$$.fragment),Qe(e,"class",a=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),Qe(e,"role",o=cV(t[4])?"list":"table"),oJ(e,"height",t[3])},m(f,m){Dn(f,e,m),ma(i,e,null),Zn(e,n),r&&ma(r,e,null),Dn(f,s,m),ma(l,f,m),c=!0,u||(d=un(window,"resize",t[17]),u=!0)},p(f,m){if(m[0]&32&&p!==(p=f[5])){if(r){Ls();const g=r;Si(g.$$.fragment,1,0,()=>{ea(g,1)}),Fs()}p?(r=Ww(p,h()),Ma(r.$$.fragment),Bt(r.$$.fragment,1),ma(r,e,null)):r=null}(!c||m[0]&7&&a!==(a=f[1].calendar+" "+f[1].view+(f[0]?" "+f[1].withScroll:"")+(f[2]?" "+f[1][f[2]]:"")))&&Qe(e,"class",a),(!c||m[0]&16&&o!==(o=cV(f[4])?"list":"table"))&&Qe(e,"role",o),m[0]&8&&oJ(e,"height",f[3])},i(f){c||(Bt(i.$$.fragment,f),r&&Bt(r.$$.fragment,f),Bt(l.$$.fragment,f),c=!0)},o(f){Si(i.$$.fragment,f),r&&Si(r.$$.fragment,f),Si(l.$$.fragment,f),c=!1},d(f){f&&(Sn(e),Sn(s)),ea(i),r&&ea(r),ea(l,f),u=!1,d()}}}function ust(t,e,i){let n,r,a,o,s,l,c,u,d,p,h,{plugins:f=[]}=e,{options:m={}}=e,g=gS(),v=new Wot(f,m);oot("state",v);let{_viewComponent:y,_bodyEl:I,_interaction:b,_iClass:D,_events:w,_queue:S,_queue2:U,_tasks:C,_scrollable:E,height:P,theme:M,view:N}=v;Ve(t,y,Y=>i(5,h=Y)),Ve(t,I,Y=>i(32,n=Y)),Ve(t,b,Y=>i(35,s=Y)),Ve(t,D,Y=>i(2,u=Y)),Ve(t,w,Y=>i(36,l=Y)),Ve(t,S,Y=>i(34,o=Y)),Ve(t,U,Y=>i(33,a=Y)),Ve(t,E,Y=>i(0,r=Y)),Ve(t,P,Y=>i(3,d=Y)),Ve(t,M,Y=>i(1,c=Y)),Ve(t,N,Y=>i(4,p=Y));let R={...m};function A(Y,Z){return v._set(Y,Z),this}function _(Y){let Z=v._get(Y);return Z instanceof Date?Il(Z):Z}function O(){return v._fetchedRange.set({start:void 0,end:void 0}),this}function x(){return l.map(ju)}function F(Y){for(let Z of l)if(Z.id==Y)return ju(Z);return null}function $(Y){return l.push(tA([Y])[0]),w.set(l),this}function V(Y){for(let Z of l)if(Z.id==Y.id){RI(Z,tA([Y])[0]),w.set(l);break}return this}function G(Y){let Z=l.findIndex(Q=>Q.id==Y);return Z>=0&&(l.splice(Z,1),w.set(l)),this}function j(){return cc(JN(v._view))}function z(){return s.action&&s.action.unselect(),this}function H(Y,Z){let Q=LT(Y,Z);return Q?OM(Q)(Z):null}function K(){ea(g,!0)}rot(()=>{uJ(o)}),TTe(()=>{uJ(a),ATe(q,null,C)});function q(){n&&Hn(E,r=vot(n),r)}return t.$$set=Y=>{"plugins"in Y&&i(18,f=Y.plugins),"options"in Y&&i(19,m=Y.options)},t.$$.update=()=>{if(t.$$.dirty[0]&524288)for(let[Y,Z]of xot(m,R))A(Y,Z)},[r,c,u,d,p,h,y,I,b,D,w,S,U,E,P,M,N,q,f,m,A,_,O,x,F,$,V,G,j,z,H,K]}class dst extends ol{constructor(e){super(),al(this,e,ust,cst,Ss,{plugins:18,options:19,setOption:20,getOption:21,refetchEvents:22,getEvents:23,getEventById:24,addEvent:25,updateEvent:26,removeEventById:27,getView:28,unselect:29,dateFromPoint:30,destroy:31},null,[-1,-1])}get setOption(){return this.$$.ctx[20]}get getOption(){return this.$$.ctx[21]}get refetchEvents(){return this.$$.ctx[22]}get getEvents(){return this.$$.ctx[23]}get getEventById(){return this.$$.ctx[24]}get addEvent(){return this.$$.ctx[25]}get updateEvent(){return this.$$.ctx[26]}get removeEventById(){return this.$$.ctx[27]}get getView(){return this.$$.ctx[28]}get unselect(){return this.$$.ctx[29]}get dateFromPoint(){return this.$$.ctx[30]}get destroy(){return this.$$.ctx[31]}}let xF=!1;function pst(t){xF||(xF=!0,window.requestAnimationFrame(()=>{t(),xF=!1}))}function DJ(t,e,i){return vb(e,aT(i,t))}const{window:tm}=iot;function hst(t){let e,i;return{c:Dr,m(n,r){e||(i=[un(tm,"pointermove",t[31]),un(tm,"pointerup",t[32]),un(tm,"pointercancel",t[32]),un(tm,"scroll",t[0]),un(tm,"selectstart",xM(t[33])),un(tm,"contextmenu",function(){Ni(xM(t[41]))&&xM(t[41]).apply(this,arguments)}),un(tm,"touchstart",t[34]),un(tm,"touchmove",t[40],{passive:!1})],e=!0)},p(n,r){t=n},i:Dr,o:Dr,d(n){e=!1,rl(i)}}}const PJ=1,CJ=2,EJ=3,LF=4,_1=5;function MJ(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function xM(t){return e=>{t()&&e.preventDefault()}}function fst(t,e,i){let n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,I,b,D,w,S,U,C,E,P,M,N,R,A,{_iEvents:_,_iClass:O,_events:x,_view:F,_dayGrid:$,_draggable:V,dateClick:G,dragScroll:j,datesAboveResources:z,eventDragMinDistance:H,eventDragStart:K,eventDragStop:q,eventDrop:Y,eventLongPressDelay:Z,eventResizeStart:Q,eventResizeStop:ie,eventResize:ue,longPressDelay:J,selectable:te,select:se,selectBackgroundColor:ee,selectLongPressDelay:ce,selectMinDistance:fe,slotDuration:ge,slotHeight:he,unselect:Se,unselectAuto:Ce,unselectCancel:Fe,view:Je}=Jl("state");Ve(t,_,We=>i(69,o=We)),Ve(t,O,We=>i(72,c=We)),Ve(t,x,We=>i(68,a=We)),Ve(t,F,We=>i(66,n=We)),Ve(t,$,We=>i(71,l=We)),Ve(t,V,We=>i(94,A=We)),Ve(t,G,We=>i(73,u=We)),Ve(t,j,We=>i(82,I=We)),Ve(t,z,We=>i(90,P=We)),Ve(t,H,We=>i(85,w=We)),Ve(t,K,We=>i(83,b=We)),Ve(t,q,We=>i(76,h=We)),Ve(t,Y,We=>i(74,d=We)),Ve(t,Z,We=>i(88,C=We)),Ve(t,Q,We=>i(84,D=We)),Ve(t,ie,We=>i(77,f=We)),Ve(t,ue,We=>i(75,p=We)),Ve(t,J,We=>i(87,U=We)),Ve(t,te,We=>i(93,R=We)),Ve(t,se,We=>i(78,m=We)),Ve(t,ee,We=>i(70,s=We)),Ve(t,ce,We=>i(89,E=We)),Ve(t,fe,We=>i(86,S=We)),Ve(t,ge,We=>i(91,M=We)),Ve(t,he,We=>i(81,y=We)),Ve(t,Se,We=>i(67,r=We)),Ve(t,Ce,We=>i(80,v=We)),Ve(t,Fe,We=>i(79,g=We)),Ve(t,Je,We=>i(92,N=We));let xe,st,we,Oe,ye,Be,Ee,qe,Ge,me,Me,De,Ae,ze,de,pe,ke,Ue,Te,rt,je,Le,It,zt,Jt;function Yr(We,Xt,Yn,Da){xe||(xe=MJ(Xt)?Yn?CJ:A(We)?PJ:_1:_1,tc()&&(we=We,yr(Xt),Da&&(ye=Da),Te=Yn?Ue?"resizingX":"resizingY":"dragging",Yn&&(rt=pr(we.start),Ue?(rt.setUTCHours(we.end.getUTCHours(),we.end.getUTCMinutes(),we.end.getUTCSeconds(),0),rt<we.start&&ag(rt)):Wu(rt,M)),Kn(Xt)))}function Eo(We){xe||(xe=MJ(We)?R&&!cV(N)?EJ:LF:_1,tc()&&(yr(We),Te="selecting",je=Ue?av({day:1}):M,we={allDay:Ue,start:ye,end:Wu(pr(ye),je),resourceIds:Ee?[Ee.id]:[]},Kn(We)))}function Qt(){xe||(xe=_1)}function yr(We){window.getSelection().removeAllRanges(),Ge=Me=We.clientX,me=De=We.clientY;let Xt=LT(Me,De);({allDay:Ue,date:ye,resource:Ee}=OM(Xt)(De)),Ae=dD(Xt,Ee?4:3),de=dD(Xt,Ee&&(uh()||P)?2:1),vo(),We.pointerType!=="mouse"&&i(1,zt=setTimeout(()=>{xe&&(st=!0,Kn(We))},(ec()?E:C)??U))}function Kn(We){if(st||We&&We.pointerType==="mouse"&&Vg()>=(ec()?S:w)){st=!0,to(We),Hn(O,c=Te,c),o[0]||(ec()?Aa():Od(We,Ru()?D:b));let Xt=Qo();if(Xt){let Yn;({allDay:Yn,date:Be,resource:qe}=OM(Xt)(De)),Yn===Ue&&(ke=av((Be-ye)/1e3),Hn(_,o[0].end=Wu(pr(we.end),ke),o),Ru()?o[0].end<rt&&Hn(_,o[0].end=rt,o):ec()?o[0].end<we.end?(Hn(_,o[0].start=RTe(o[0].end,je),o),Hn(_,o[0].end=we.end,o)):Hn(_,o[0].start=we.start,o):(Hn(_,o[0].start=Wu(pr(we.start),ke),o),Ee&&(Hn(_,o[0].resourceIds=we.resourceIds.filter(Da=>Da!==Ee.id),o),o[0].resourceIds.push(qe.id))))}}if(I){let Xt=y*2;pst(()=>{Ae&&(De<Xt&&window.scrollBy(0,vb(-10,(De-Xt)/3)),De<ze.top+Xt&&(Ae.scrollTop+=vb(-10,(De-ze.top-Xt)/3)),De>window.innerHeight-Xt&&window.scrollBy(0,aT(10,(De-window.innerHeight+Xt)/3)),De>ze.bottom-Xt&&(Ae.scrollTop+=aT(10,(De-ze.bottom+Xt)/3)))})}}function yt(){tc()&&(vo(),Kn())}function cr(We){tc()&&We.isPrimary&&(Me=We.clientX,De=We.clientY,Kn(We))}function Jo(We){if(Le&&v&&!(g&&We.target.closest(g))&&to(We),xe&&We.isPrimary){if(st)if(ec()){if(Le=!0,Ni(m)){let{start:Xt,end:Yn}=ju(o[0]);m({start:Xt,end:Yn,startStr:nu(o[0].start),endStr:nu(o[0].end),allDay:Ue,jsEvent:We,view:cc(n),resource:Ee})}}else{we.display=Oe;let Xt=Ru()?f:h;Ni(Xt)&&Xt({event:ju(we),jsEvent:We,view:cc(n)});let Yn=pJ(we);if(Ql(we,o[0]),es(),Xt=Ru()?p:d,Ni(Xt)){let Da=we,ic;Ru()?ic={endDelta:ke}:ic={delta:ke,oldResource:Ee!==qe?Ee:void 0,newResource:Ee!==qe?qe:void 0},Xt(RI(ic,{event:ju(we),oldEvent:ju(Yn),jsEvent:We,view:cc(n),revert(){Ql(Da,Yn)}}))}}else if((Nu()||ec())&&Ni(u)&&!It){Me=We.clientX,De=We.clientY;let Xt=LT(Me,De);if(Xt){let{allDay:Yn,date:Da,resource:ic}=OM(Xt)(De);u({allDay:Yn,date:Il(Da),dateStr:nu(Da),dayEl:Xt,jsEvent:We,view:cc(n),resource:ic})}}st=!1,xe=Ge=me=Me=De=we=Oe=ye=Be=Ee=qe=ke=Ue=Hn(O,c=rt=je=void 0,c),Ae=de=ze=pe=void 0,zt&&(clearTimeout(zt),i(1,zt=void 0))}It=!1}function Qo(){return LT(DJ(Me,Jt[0],Jt[1]),DJ(De,Jt[2],Jt[3]))}function vo(){ze=Em(Ae),pe=Em(de),Jt=[vb(0,pe.left+(l?0:8)),aT(document.documentElement.clientWidth,pe.right)-2,vb(0,ze.top),aT(document.documentElement.clientHeight,ze.bottom)-2]}function Od(We,Xt){Ni(Xt)&&Xt({event:ju(we),jsEvent:We,view:cc(n)}),Oe=we.display,we.display="preview",Hn(_,o[0]=pJ(we),o),we.display="ghost",x.set(a)}function Aa(){Hn(_,o[0]={id:"{select}",allDay:we.allDay,start:we.start,title:"",display:"preview",extendedProps:{},backgroundColor:s,resourceIds:we.resourceIds},o)}function es(){Hn(_,o[0]=null,o)}function Ql(We,Xt){We.start=Xt.start,We.end=Xt.end,We.resourceIds=Xt.resourceIds,x.set(a)}function Vg(){return Math.sqrt(Math.pow(Me-Ge,2)+Math.pow(De-me,2))}function uh(){return xe===PJ}function Ru(){return xe===CJ}function Nu(){return xe===LF}function ec(){return xe===EJ}function tc(){return xe&&xe<LF}function to(We){Le&&(Le=!1,es(),Ni(r)&&r({jsEvent:We,view:cc(n)}))}function di(){It=!0}F.subscribe(to);function jf(We){if(tc()){let Xt=We.target,Yn=[],Da=()=>rl(Yn);Yn.push(un(Xt,"touchmove",xM(()=>st))),Yn.push(un(Xt,"touchend",Da)),Yn.push(un(Xt,"touchcancel",Da))}}function Gf(We){Ax.call(this,t,We)}return[yt,zt,_,O,x,F,$,V,G,j,z,H,K,q,Y,Z,Q,ie,ue,J,te,se,ee,ce,fe,ge,he,Se,Ce,Fe,Je,cr,Jo,tc,jf,Yr,Eo,Qt,to,di,Gf,()=>zt]}class mst extends ol{constructor(e){super(),al(this,e,fst,hst,Ss,{drag:35,select:36,noAction:37,handleScroll:0,unselect:38,noClick:39},null,[-1,-1,-1,-1])}get drag(){return this.$$.ctx[35]}get select(){return this.$$.ctx[36]}get noAction(){return this.$$.ctx[37]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[38]}get noClick(){return this.$$.ctx[39]}}function gst(t){let e,i;return{c:Dr,m(n,r){e||(i=[un(window,"pointermove",t[5]),un(window,"scroll",t[0])],e=!0)},p:Dr,i:Dr,o:Dr,d(n){e=!1,rl(i)}}}function k1(t){return t.isPrimary&&t.pointerType==="mouse"}function vst(t,e,i){let n,r,a,o,{_iEvents:s,_events:l,_viewDates:c,_slotTimeLimits:u,slotDuration:d,slotHeight:p,hiddenDays:h,_view:f,datesAboveResources:m,theme:g}=Jl("state");Ve(t,s,A=>i(9,n=A)),Ve(t,u,A=>i(18,o=A)),Ve(t,d,A=>i(16,r=A)),Ve(t,p,A=>i(17,a=A));let v,y,I,b,D,w;function S(A,_,O,x){k1(O)&&(y=A,I=_,b=Em(I),v=O.clientY,D=x)}function U(A,_){k1(_)&&(y=A,I=null,v=D=void 0)}function C(A){k1(A)&&R()}function E(){if(y){if(I){let A=v-b.top;w=Wu(Wu(pr(y),o.min),r,mot(A/a))}else w=y;n[1]||N(),Hn(s,n[1].start=w,n),Hn(s,n[1].end=Wu(pr(w),r),n),Hn(s,n[1].resourceIds=D?[D.id]:[],n)}}function P(){I&&(b=Em(I),E())}function M(A){k1(A)&&(v=A.clientY,E())}function N(){Hn(s,n[1]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent"},n)}function R(){y=I=Hn(s,n[1]=null,n)}return t.$$.update=()=>{t.$$.dirty&512&&n[0]&&R()},[P,s,u,d,p,M,S,U,C,n]}class yst extends ol{constructor(e){super(),al(this,e,vst,gst,Ss,{enterTimeGrid:6,enterDayGrid:7,leave:8,handleScroll:0})}get enterTimeGrid(){return this.$$.ctx[6]}get enterDayGrid(){return this.$$.ctx[7]}get leave(){return this.$$.ctx[8]}get handleScroll(){return this.$$.ctx[0]}}function RJ(t){let e,i,n,r;return{c(){e=In("div"),Qe(e,"class",i=t[1].resizer)},m(a,o){Dn(a,e,o),n||(r=un(e,"pointerdown",t[8]),n=!0)},p(a,o){o&2&&i!==(i=a[1].resizer)&&Qe(e,"class",i)},d(a){a&&Sn(e),n=!1,r()}}}function Ist(t){let e,i=t[0]&&RJ(t);return{c(){i&&i.c(),e=ch()},m(n,r){i&&i.m(n,r),Dn(n,e,r)},p(n,[r]){n[0]?i?i.p(n,r):(i=RJ(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:Dr,o:Dr,d(n){n&&Sn(e),i&&i.d(n)}}}function bst(t,e,i){let n,r,a,{event:o}=e,{theme:s,eventDurationEditable:l,editable:c}=Jl("state");Ve(t,s,p=>i(1,a=p)),Ve(t,l,p=>i(7,r=p)),Ve(t,c,p=>i(6,n=p));let u;function d(p){Ax.call(this,t,p)}return t.$$set=p=>{"event"in p&&i(5,o=p.event)},t.$$.update=()=>{t.$$.dirty&224&&i(0,u=!t7(o.display)&&!Kw(o.display)&&((o.durationEditable??r)||(o.editable??n)))},[u,a,s,l,c,o,n,r,d]}class wst extends ol{constructor(e){super(),al(this,e,bst,Ist,Ss,{event:5})}}function NJ(t){let e,i,n={};return e=new yst({props:n}),t[16](e),{c(){Ma(e.$$.fragment)},m(r,a){ma(e,r,a),i=!0},p(r,a){const o={};e.$set(o)},i(r){i||(Bt(e.$$.fragment,r),i=!0)},o(r){Si(e.$$.fragment,r),i=!1},d(r){t[16](null),ea(e,r)}}}function Sst(t){let e,i,n,r,a={};e=new mst({props:a}),t[15](e);let o=t[1]&&NJ(t);return{c(){Ma(e.$$.fragment),i=Rs(),o&&o.c(),n=ch()},m(s,l){ma(e,s,l),Dn(s,i,l),o&&o.m(s,l),Dn(s,n,l),r=!0},p(s,[l]){const c={};e.$set(c),s[1]?o?(o.p(s,l),l&2&&Bt(o,1)):(o=NJ(s),o.c(),Bt(o,1),o.m(n.parentNode,n)):o&&(Ls(),Si(o,1,1,()=>{o=null}),Fs())},i(s){r||(Bt(e.$$.fragment,s),Bt(o),r=!0)},o(s){Si(e.$$.fragment,s),Si(o),r=!1},d(s){s&&(Sn(i),Sn(n)),t[15](null),ea(e,s),o&&o.d(s)}}}function Tst(t,e,i){let n,r,a,o,s,l,c,u,{theme:d,editable:p,eventStartEditable:h,eventDurationEditable:f,pointer:m,_bodyEl:g,_interaction:v,_iClasses:y,_draggable:I}=Jl("state");Ve(t,d,S=>i(11,a=S)),Ve(t,p,S=>i(13,l=S)),Ve(t,h,S=>i(14,c=S)),Ve(t,m,S=>i(1,u=S)),Ve(t,g,S=>i(10,r=S)),Ve(t,v,S=>i(0,n=S)),Ve(t,y,S=>i(17,s=S)),Ve(t,I,S=>i(12,o=S)),Hn(v,n.resizer=wst,n);function b(){var S;for(let U of Object.values(n))(S=U==null?void 0:U.handleScroll)==null||S.call(U)}function D(S){Lp[S?"unshift":"push"](()=>{n.action=S,v.set(n)})}function w(S){Lp[S?"unshift":"push"](()=>{n.pointer=S,v.set(n)})}return t.$$.update=()=>{t.$$.dirty&24576&&Hn(I,o=S=>(S.startEditable??c)||(S.editable??l),o),t.$$.dirty&6144&&Hn(y,s=(S,U)=>{let{display:C}=U;return Kw(C)?[a[C]]:!t7(C)&&o(U)?[a.draggable]:[]},s),t.$$.dirty&1024&&r&&un(r,"scroll",b)},[n,u,d,p,h,m,g,v,y,I,r,a,o,l,c,D,w]}class Ust extends ol{constructor(e){super(),al(this,e,Tst,Sst,Ss,{})}}var Dst={createOptions(t){t.dateClick=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.select=void 0,t.selectBackgroundColor=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=Oa(Dr),t._auxiliary.update(e=>[...e,Ust])}};function Pst(t){return kd([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],a=pr(e),o=7;for(;a.getUTCDay()!==i&&o;)qw(a),--o;for(let s=0;s<7;++s)n.includes(a.getUTCDay())||r.push(pr(a)),ag(a);return r})}function AJ(t,e,i){const n=t.slice();return n[8]=e[i],n}function _J(t){let e,i,n,r,a,o,s,l;return{c(){var c;e=In("div"),i=In("span"),a=Rs(),Qe(i,"aria-label",n=t[2].format(t[8])),Qe(e,"class",o=t[0].day+" "+((c=t[0].weekdays)==null?void 0:c[t[8].getUTCDay()])),Qe(e,"role","columnheader")},m(c,u){Dn(c,e,u),Zn(e,i),Zn(e,a),s||(l=Py(r=vS.call(null,i,t[3].format(t[8]))),s=!0)},p(c,u){var d;t=c,u&6&&n!==(n=t[2].format(t[8]))&&Qe(i,"aria-label",n),r&&Ni(r.update)&&u&10&&r.update.call(null,t[3].format(t[8])),u&3&&o!==(o=t[0].day+" "+((d=t[0].weekdays)==null?void 0:d[t[8].getUTCDay()]))&&Qe(e,"class",o)},d(c){c&&Sn(e),s=!1,l()}}}function Cst(t){let e,i,n,r,a,o,s,l=Co(t[1]),c=[];for(let u=0;u<l.length;u+=1)c[u]=_J(AJ(t,l,u));return{c(){e=In("div"),i=In("div");for(let u=0;u<c.length;u+=1)c[u].c();r=Rs(),a=In("div"),Qe(i,"class",n=t[0].days),Qe(i,"role","row"),Qe(a,"class",o=t[0].hiddenScroll),Qe(e,"class",s=t[0].header)},m(u,d){Dn(u,e,d),Zn(e,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);Zn(e,r),Zn(e,a)},p(u,[d]){if(d&15){l=Co(u[1]);let p;for(p=0;p<l.length;p+=1){const h=AJ(u,l,p);c[p]?c[p].p(h,d):(c[p]=_J(h),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}d&1&&n!==(n=u[0].days)&&Qe(i,"class",n),d&1&&o!==(o=u[0].hiddenScroll)&&Qe(a,"class",o),d&1&&s!==(s=u[0].header)&&Qe(e,"class",s)},i:Dr,o:Dr,d(u){u&&Sn(e),MI(c,u)}}}function Est(t,e,i){let n,r,a,o,{theme:s,_intlDayHeader:l,_intlDayHeaderAL:c,_days:u}=Jl("state");return Ve(t,s,d=>i(0,n=d)),Ve(t,l,d=>i(3,o=d)),Ve(t,c,d=>i(2,a=d)),Ve(t,u,d=>i(1,r=d)),[n,r,a,o,s,l,c,u]}class Mst extends ol{constructor(e){super(),al(this,e,Est,Cst,Ss,{})}}function Rst(t){let e,i,n,r,a;const o=t[7].default,s=Jat(o,t,t[6],null);return{c(){e=In("div"),i=In("div"),s&&s.c(),Qe(i,"class",n=t[0].content),Qe(e,"class",r=t[0].body+(t[1]===!0?" "+t[0].uniform:""))},m(l,c){Dn(l,e,c),Zn(e,i),s&&s.m(i,null),t[8](e),a=!0},p(l,[c]){s&&s.p&&(!a||c&64)&&eot(s,o,l,l[6],a?Qat(o,l[6],c,null):tot(l[6]),null),(!a||c&1&&n!==(n=l[0].content))&&Qe(i,"class",n),(!a||c&3&&r!==(r=l[0].body+(l[1]===!0?" "+l[0].uniform:"")))&&Qe(e,"class",r)},i(l){a||(Bt(s,l),a=!0)},o(l){Si(s,l),a=!1},d(l){l&&Sn(e),s&&s.d(l),t[8](null)}}}function Nst(t,e,i){let n,r,a,{$$slots:o={},$$scope:s}=e,{dayMaxEvents:l,_bodyEl:c,theme:u}=Jl("state");Ve(t,l,p=>i(1,r=p)),Ve(t,c,p=>i(2,a=p)),Ve(t,u,p=>i(0,n=p));function d(p){Lp[p?"unshift":"push"](()=>{a=p,c.set(a)})}return t.$$set=p=>{"$$scope"in p&&i(6,s=p.$$scope)},[n,r,a,l,c,u,s,o,d]}class Ast extends ol{constructor(e){super(),al(this,e,Nst,Rst,Ss,{})}}function _st(t){let e,i,n,r,a,o,s,l,c,u,d;var p=t[8].resizer;function h(f,m){return{props:{event:f[0]}}}return p&&(o=Ww(p,h(t)),o.$on("pointerdown",function(){Ni(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)})),{c(){e=In("article"),i=In("div"),a=Rs(),o&&Ma(o.$$.fragment),Qe(i,"class",n=t[2].eventBody),Qe(e,"class",t[4]),Qe(e,"style",t[5]),Qe(e,"role",s=t[7]?"button":void 0),Qe(e,"tabindex",l=t[7]?0:void 0)},m(f,m){Dn(f,e,m),Zn(e,i),Zn(e,a),o&&ma(o,e,null),t[52](e),c=!0,u||(d=[Py(r=vS.call(null,i,t[6])),un(e,"click",function(){Ni(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),un(e,"keydown",function(){Ni(t[7]&&eA(t[7]))&&(t[7]&&eA(t[7])).apply(this,arguments)}),un(e,"mouseenter",function(){Ni(t[32](t[9],t[1]))&&t[32](t[9],t[1]).apply(this,arguments)}),un(e,"mouseleave",function(){Ni(t[32](t[10],t[1]))&&t[32](t[10],t[1]).apply(this,arguments)}),un(e,"pointerdown",function(){Ni(!Kw(t[1])&&t[33](t[8]))&&(!Kw(t[1])&&t[33](t[8])).apply(this,arguments)})],u=!0)},p(f,m){if(t=f,(!c||m[0]&4&&n!==(n=t[2].eventBody))&&Qe(i,"class",n),r&&Ni(r.update)&&m[0]&64&&r.update.call(null,t[6]),m[0]&256&&p!==(p=t[8].resizer)){if(o){Ls();const g=o;Si(g.$$.fragment,1,0,()=>{ea(g,1)}),Fs()}p?(o=Ww(p,h(t)),o.$on("pointerdown",function(){Ni(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)}),Ma(o.$$.fragment),Bt(o.$$.fragment,1),ma(o,e,null)):o=null}else if(p){const g={};m[0]&1&&(g.event=t[0]),o.$set(g)}(!c||m[0]&16)&&Qe(e,"class",t[4]),(!c||m[0]&32)&&Qe(e,"style",t[5]),(!c||m[0]&128&&s!==(s=t[7]?"button":void 0))&&Qe(e,"role",s),(!c||m[0]&128&&l!==(l=t[7]?0:void 0))&&Qe(e,"tabindex",l)},i(f){c||(o&&Bt(o.$$.fragment,f),c=!0)},o(f){o&&Si(o.$$.fragment,f),c=!1},d(f){f&&Sn(e),o&&ea(o),t[52](null),u=!1,rl(d)}}}function kst(t,e,i){let n,r,a,o,s,l,c,u,d,p,h,f,m,g,v,y,I,b,D,w,S,{chunk:U}=e,{longChunks:C={}}=e,{inPopup:E=!1}=e,{dayMaxEvents:P,displayEventEnd:M,eventAllUpdated:N,eventBackgroundColor:R,eventTextColor:A,eventClick:_,eventColor:O,eventContent:x,eventClassNames:F,eventDidMount:$,eventMouseEnter:V,eventMouseLeave:G,theme:j,_view:z,_intlEventTime:H,_interaction:K,_iClasses:q,_resBgColor:Y,_resTxtColor:Z,_hiddenEvents:Q,_popupDate:ie,_tasks:ue}=Jl("state");Ve(t,P,ye=>i(55,a=ye)),Ve(t,M,ye=>i(44,f=ye)),Ve(t,N,ye=>i(57,c=ye)),Ve(t,R,ye=>i(50,b=ye)),Ve(t,A,ye=>i(47,v=ye)),Ve(t,_,ye=>i(40,n=ye)),Ve(t,O,ye=>i(49,I=ye)),Ve(t,x,ye=>i(43,h=ye)),Ve(t,F,ye=>i(45,m=ye)),Ve(t,$,ye=>i(58,u=ye)),Ve(t,V,ye=>i(9,w=ye)),Ve(t,G,ye=>i(10,S=ye)),Ve(t,j,ye=>i(2,p=ye)),Ve(t,z,ye=>i(41,l=ye)),Ve(t,H,ye=>i(42,d=ye)),Ve(t,K,ye=>i(8,s=ye)),Ve(t,q,ye=>i(46,g=ye)),Ve(t,Y,ye=>i(51,D=ye)),Ve(t,Z,ye=>i(48,y=ye)),Ve(t,Q,ye=>i(54,r=ye)),Ve(t,ie,ye=>i(56,o=ye));let J,te,se,ee,ce,fe,ge=1,he=!1,Se,Ce;aot(()=>{Ni(u)&&u({event:ju(te),timeText:fe,el:J,view:cc(l)})}),TTe(()=>{Ni(c)&&!Kw(Se)&&ATe(()=>c({view:cc(l)}),"eau",ue)});function Fe(ye,Be){return!Kw(Be)&&Ni(ye)?Ee=>ye({event:ju(te),el:J,jsEvent:Ee,view:cc(l)}):void 0}function Je(ye,Be){return ye.action?Ee=>s.action.drag(te,Ee,Be,E?o:void 0):void 0}function xe(){J&&(i(38,ge=Pot(U,C,A1(J))),a===!0?st():i(39,he=!1))}function st(){let ye=dD(J,2),Be=A1(ye)-A1(ye.firstElementChild)-we(ye);i(39,he=U.bottom>Be);let Ee=!1;for(let qe of U.dates){let Ge=r[qe.getTime()];if(Ge){let me=Ge.size;he?Ge.add(U.event):Ge.delete(U.event),me!==Ge.size&&(Ee=!0)}}Ee&&Q.set(r)}function we(ye){let Be=0;for(let Ee=0;Ee<U.days&&(Be=vb(Be,A1(ye.lastElementChild)),ye=ye.nextElementSibling,!!ye);++Ee);return Be}function Oe(ye){Lp[ye?"unshift":"push"](()=>{J=ye,i(3,J)})}return t.$$set=ye=>{"chunk"in ye&&i(34,U=ye.chunk),"longChunks"in ye&&i(35,C=ye.longChunks),"inPopup"in ye&&i(36,E=ye.inPopup)},t.$$.update=()=>{if(t.$$.dirty[1]&8&&i(0,te=U.event),t.$$.dirty[0]&37|t.$$.dirty[1]&2082184){i(1,Se=te.display);let ye=te.backgroundColor||D(te)||b||I,Be=te.textColor||y(te)||v;i(5,ee=`width:calc(${U.days*100}% + ${(U.days-1)*7}px);margin-top:${ge}px;`),ye&&i(5,ee+=`background-color:${ye};`),Be&&i(5,ee+=`color:${Be};`),he&&i(5,ee+="visibility:hidden;"),i(4,se=[p.event,...g([],te),...Dot(m,te,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15368&&i(6,[fe,ce]=Uot(U,f,h,p,d,l),ce),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,Ce=Fe(n,Se))},[te,Se,p,J,se,ee,ce,Ce,s,w,S,P,M,N,R,A,_,O,x,F,$,V,G,j,z,H,K,q,Y,Z,Q,ie,Fe,Je,U,C,E,xe,ge,he,n,l,d,h,f,m,g,v,y,I,b,D,Oe]}let _x=class extends ol{constructor(e){super(),al(this,e,kst,_st,Ss,{chunk:34,longChunks:35,inPopup:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function kJ(t,e,i){const n=t.slice();return n[20]=e[i],n}function OJ(t,e){let i,n,r;return n=new _x({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=ch(),Ma(n.$$.fragment),this.first=i},m(a,o){Dn(a,i,o),ma(n,a,o),r=!0},p(a,o){e=a;const s={};o&1&&(s.chunk=e[20]),n.$set(s)},i(a){r||(Bt(n.$$.fragment,a),r=!0)},o(a){Si(n.$$.fragment,a),r=!1},d(a){a&&Sn(i),ea(n,a)}}}function Ost(t){let e,i,n,r,a,o,s,l,c,u,d,p,h=[],f=new Map,m,g,v,y,I,b=Co(t[0]);const D=w=>w[20].event;for(let w=0;w<b.length;w+=1){let S=kJ(t,b,w),U=D(S);f.set(U,h[w]=OJ(U,S))}return{c(){e=In("div"),i=In("div"),n=In("time"),o=Rs(),s=In("a"),l=SE("×"),d=Rs(),p=In("div");for(let w=0;w<h.length;w+=1)h[w].c();Qe(n,"datetime",r=nu(t[3],10)),Qe(s,"role","button"),Qe(s,"tabindex","0"),Qe(s,"aria-label",c=t[6].close),Qe(i,"class",u=t[4].dayHead),Qe(p,"class",m=t[4].events),Qe(e,"class",g=t[4].popup),Qe(e,"style",t[2])},m(w,S){Dn(w,e,S),Zn(e,i),Zn(i,n),Zn(i,o),Zn(i,s),Zn(s,l),Zn(e,d),Zn(e,p);for(let U=0;U<h.length;U+=1)h[U]&&h[U].m(p,null);t[16](e),v=!0,y||(I=[Py(a=vS.call(null,n,t[5].format(t[3]))),un(s,"click",QN(t[13])),un(s,"keydown",eA(t[13])),Py(uot.call(null,e,"pointerdown")),un(e,"pointerdown",QN(t[15])),un(e,"pointerdownoutside",t[14])],y=!0)},p(w,[S]){(!v||S&8&&r!==(r=nu(w[3],10)))&&Qe(n,"datetime",r),a&&Ni(a.update)&&S&40&&a.update.call(null,w[5].format(w[3])),(!v||S&64&&c!==(c=w[6].close))&&Qe(s,"aria-label",c),(!v||S&16&&u!==(u=w[4].dayHead))&&Qe(i,"class",u),S&1&&(b=Co(w[0]),Ls(),h=ETe(h,S,D,1,w,b,f,p,CTe,OJ,null,kJ),Fs()),(!v||S&16&&m!==(m=w[4].events))&&Qe(p,"class",m),(!v||S&16&&g!==(g=w[4].popup))&&Qe(e,"class",g),(!v||S&4)&&Qe(e,"style",w[2])},i(w){if(!v){for(let S=0;S<b.length;S+=1)Bt(h[S]);v=!0}},o(w){for(let S=0;S<h.length;S+=1)Si(h[S]);v=!1},d(w){w&&Sn(e);for(let S=0;S<h.length;S+=1)h[S].d();t[16](null),y=!1,rl(I)}}}function xst(t,e,i){let n,r,a,o,s,l,{buttonText:c,theme:u,_interaction:d,_intlDayPopover:p,_popupDate:h,_popupChunks:f}=Jl("state");Ve(t,c,S=>i(6,l=S)),Ve(t,u,S=>i(4,o=S)),Ve(t,d,S=>i(17,n=S)),Ve(t,p,S=>i(5,s=S)),Ve(t,h,S=>i(3,r=S)),Ve(t,f,S=>i(0,a=S));let m,g="";function v(){let S=dD(m,1),U=dD(S,3),C=Em(m),E=Em(S),P=Em(U);i(2,g="");let M;if(C.width>=P.width){M=P.left-E.left;let R=E.right-P.right;i(2,g+=`right:${R}px;`)}else M=(E.width-C.width)/2,E.left+M<P.left?M=P.left-E.left:E.left+M+C.width>P.right&&(M=P.right-E.left-C.width);i(2,g+=`left:${M}px;`);let N;if(C.height>=P.height){N=P.top-E.top;let R=E.bottom-P.bottom;i(2,g+=`bottom:${R}px;`)}else N=(E.height-C.height)/2,E.top+N<P.top?N=P.top-E.top:E.top+N+C.height>P.bottom&&(N=P.bottom-E.top-C.height);i(2,g+=`top:${N}px;`)}function y(){m&&(i(2,g=""),J6().then(()=>{a.length?v():I()}))}function I(S){Hn(h,r=null,r)}function b(S){var U;I(),(U=n.action)==null||U.noClick()}function D(S){Ax.call(this,t,S)}function w(S){Lp[S?"unshift":"push"](()=>{m=S,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&a&&y()},[a,m,g,r,o,s,l,c,u,d,p,h,f,I,b,D,w]}class Lst extends ol{constructor(e){super(),al(this,e,xst,Ost,Ss,{})}}function xJ(t,e,i){const n=t.slice();return n[42]=e[i],n[43]=e,n[44]=i,n}function LJ(t){let e,i,n,r;return i=new _x({props:{chunk:t[2][1]}}),{c(){e=In("div"),Ma(i.$$.fragment),Qe(e,"class",n=t[12].events)},m(a,o){Dn(a,e,o),ma(i,e,null),r=!0},p(a,o){const s={};o[0]&4&&(s.chunk=a[2][1]),i.$set(s),(!r||o[0]&4096&&n!==(n=a[12].events))&&Qe(e,"class",n)},i(a){r||(Bt(i.$$.fragment,a),r=!0)},o(a){Si(i.$$.fragment,a),r=!1},d(a){a&&Sn(e),ea(i)}}}function FJ(t){let e,i,n,r;return i=new _x({props:{chunk:t[2][0]}}),{c(){e=In("div"),Ma(i.$$.fragment),Qe(e,"class",n=t[12].events+" "+t[12].preview)},m(a,o){Dn(a,e,o),ma(i,e,null),r=!0},p(a,o){const s={};o[0]&4&&(s.chunk=a[2][0]),i.$set(s),(!r||o[0]&4096&&n!==(n=a[12].events+" "+a[12].preview))&&Qe(e,"class",n)},i(a){r||(Bt(i.$$.fragment,a),r=!0)},o(a){Si(i.$$.fragment,a),r=!1},d(a){a&&Sn(e),ea(i)}}}function $J(t,e){let i,n,r=e[44],a;const o=()=>e[36](n,r),s=()=>e[36](null,r);let l={chunk:e[42],longChunks:e[1]};return n=new _x({props:l}),o(),{key:t,first:null,c(){i=ch(),Ma(n.$$.fragment),this.first=i},m(c,u){Dn(c,i,u),ma(n,c,u),a=!0},p(c,u){e=c,r!==e[44]&&(s(),r=e[44],o());const d={};u[0]&16&&(d.chunk=e[42]),u[0]&2&&(d.longChunks=e[1]),n.$set(d)},i(c){a||(Bt(n.$$.fragment,c),a=!0)},o(c){Si(n.$$.fragment,c),a=!1},d(c){c&&Sn(i),s(),ea(n,c)}}}function BJ(t){let e,i;return e=new Lst({}),{c(){Ma(e.$$.fragment)},m(n,r){ma(e,n,r),i=!0},i(n){i||(Bt(e.$$.fragment,n),i=!0)},o(n){Si(e.$$.fragment,n),i=!1},d(n){ea(e,n)}}}function VJ(t){let e,i,n,r;return{c(){e=In("a"),Qe(e,"role","button"),Qe(e,"tabindex","0"),Qe(e,"aria-haspopup","true")},m(a,o){Dn(a,e,o),n||(r=[un(e,"click",QN(t[26])),un(e,"keydown",eA(t[26])),un(e,"pointerdown",QN(t[35])),Py(i=vS.call(null,e,t[10]))],n=!0)},p(a,o){i&&Ni(i.update)&&o[0]&1024&&i.update.call(null,a[10])},d(a){a&&Sn(e),n=!1,rl(r)}}}function Fst(t){let e,i,n,r,a,o,s=t[2][1]&&ip(t[2][1].date,t[0]),l,c=t[2][0]&&ip(t[2][0].date,t[0]),u,d,p=[],h=new Map,f,m,g,v,y,I,b,D,w,S=s&&LJ(t),U=c&&FJ(t),C=Co(t[4]);const E=N=>N[42].event;for(let N=0;N<C.length;N+=1){let R=xJ(t,C,N),A=E(R);h.set(A,p[N]=$J(A,R))}let P=t[6]&&BJ(),M=t[5].size&&VJ(t);return{c(){var N;e=In("div"),i=In("time"),o=Rs(),S&&S.c(),l=Rs(),U&&U.c(),u=Rs(),d=In("div");for(let R=0;R<p.length;R+=1)p[R].c();m=Rs(),P&&P.c(),g=Rs(),v=In("div"),M&&M.c(),Qe(i,"class",n=t[12].dayHead),Qe(i,"datetime",r=nu(t[0],10)),Qe(d,"class",f=t[12].events),Qe(v,"class",y=t[12].dayFoot),Qe(e,"class",I=t[12].day+" "+((N=t[12].weekdays)==null?void 0:N[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")),Qe(e,"role","cell")},m(N,R){Dn(N,e,R),Zn(e,i),Zn(e,o),S&&S.m(e,null),Zn(e,l),U&&U.m(e,null),Zn(e,u),Zn(e,d);for(let A=0;A<p.length;A+=1)p[A]&&p[A].m(d,null);Zn(e,m),P&&P.m(e,null),Zn(e,g),Zn(e,v),M&&M.m(v,null),t[37](e),b=!0,D||(w=[Py(a=vS.call(null,i,t[14].format(t[0]))),un(e,"pointerenter",function(){Ni(t[25](t[13]))&&t[25](t[13]).apply(this,arguments)}),un(e,"pointerleave",function(){var A,_;Ni((A=t[13].pointer)==null?void 0:A.leave)&&((_=t[13].pointer)==null||_.leave.apply(this,arguments))}),un(e,"pointerdown",function(){var A,_;Ni((A=t[13].action)==null?void 0:A.select)&&((_=t[13].action)==null||_.select.apply(this,arguments))})],D=!0)},p(N,R){var A;t=N,(!b||R[0]&4096&&n!==(n=t[12].dayHead))&&Qe(i,"class",n),(!b||R[0]&1&&r!==(r=nu(t[0],10)))&&Qe(i,"datetime",r),a&&Ni(a.update)&&R[0]&16385&&a.update.call(null,t[14].format(t[0])),R[0]&5&&(s=t[2][1]&&ip(t[2][1].date,t[0])),s?S?(S.p(t,R),R[0]&5&&Bt(S,1)):(S=LJ(t),S.c(),Bt(S,1),S.m(e,l)):S&&(Ls(),Si(S,1,1,()=>{S=null}),Fs()),R[0]&5&&(c=t[2][0]&&ip(t[2][0].date,t[0])),c?U?(U.p(t,R),R[0]&5&&Bt(U,1)):(U=FJ(t),U.c(),Bt(U,1),U.m(e,u)):U&&(Ls(),Si(U,1,1,()=>{U=null}),Fs()),R[0]&2066&&(C=Co(t[4]),Ls(),p=ETe(p,R,E,1,t,C,h,d,CTe,$J,null,xJ),Fs()),(!b||R[0]&4096&&f!==(f=t[12].events))&&Qe(d,"class",f),t[6]?P?R[0]&64&&Bt(P,1):(P=BJ(),P.c(),Bt(P,1),P.m(e,g)):P&&(Ls(),Si(P,1,1,()=>{P=null}),Fs()),t[5].size?M?M.p(t,R):(M=VJ(t),M.c(),M.m(v,null)):M&&(M.d(1),M=null),(!b||R[0]&4096&&y!==(y=t[12].dayFoot))&&Qe(v,"class",y),(!b||R[0]&4993&&I!==(I=t[12].day+" "+((A=t[12].weekdays)==null?void 0:A[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")))&&Qe(e,"class",I)},i(N){if(!b){Bt(S),Bt(U);for(let R=0;R<C.length;R+=1)Bt(p[R]);Bt(P),b=!0}},o(N){Si(S),Si(U);for(let R=0;R<p.length;R+=1)Si(p[R]);Si(P),b=!1},d(N){N&&Sn(e),S&&S.d(),U&&U.d();for(let R=0;R<p.length;R+=1)p[R].d();P&&P.d(),M&&M.d(),t[37](null),D=!1,rl(w)}}}function $st(t,e,i){let n,r,a,o,s,l,c,u,d,p,{date:h}=e,{chunks:f}=e,{longChunks:m}=e,{iChunks:g=[]}=e,{date:v,dayMaxEvents:y,highlightedDates:I,moreLinkContent:b,theme:D,_hiddenEvents:w,_intlDayCell:S,_popupDate:U,_popupChunks:C,_today:E,_interaction:P,_queue:M}=Jl("state");Ve(t,v,Z=>i(33,l=Z)),Ve(t,I,Z=>i(32,s=Z)),Ve(t,b,Z=>i(30,a=Z)),Ve(t,D,Z=>i(12,u=Z)),Ve(t,w,Z=>i(31,o=Z)),Ve(t,S,Z=>i(14,p=Z)),Ve(t,U,Z=>i(29,r=Z)),Ve(t,C,Z=>i(38,n=Z)),Ve(t,E,Z=>i(34,c=Z)),Ve(t,P,Z=>i(13,d=Z));let N,R,A,_,O,x=new Set,F="",$,V=[];function G(Z){return Z.pointer?Q=>Z.pointer.enterDayGrid(h,Q):void 0}function j(){Hn(U,r=h,r)}function z(){var ie;let Z=ag(pr(h)),Q=R.concat(((ie=m[h.getTime()])==null?void 0:ie.chunks)||[]);Hn(C,n=Q.map(ue=>RI({},ue,uV(ue.event,h,Z),{days:1,dates:[h]})).sort((ue,J)=>ue.top-J.top),n)}function H(){OTe(V,R)}function K(Z){Ax.call(this,t,Z)}function q(Z,Q){Lp[Z?"unshift":"push"](()=>{V[Q]=Z,i(11,V)})}function Y(Z){Lp[Z?"unshift":"push"](()=>{N=Z,i(3,N)})}return t.$$set=Z=>{"date"in Z&&i(0,h=Z.date),"chunks"in Z&&i(27,f=Z.chunks),"longChunks"in Z&&i(1,m=Z.longChunks),"iChunks"in Z&&i(2,g=Z.iChunks)},t.$$.update=()=>{if(t.$$.dirty[0]&134217777){i(4,R=[]),x.clear(),i(5,x),i(27,f),i(0,h),i(4,R);for(let Z of f)ip(Z.date,h)&&R.push(Z)}if(t.$$.dirty[0]&33&&Hn(w,o[h.getTime()]=x,o),t.$$.dirty[0]&1|t.$$.dirty[1]&8&&i(7,A=ip(h,c)),t.$$.dirty[0]&1|t.$$.dirty[1]&6&&(i(8,_=h.getUTCMonth()!==l.getUTCMonth()),i(9,O=s.some(Z=>ip(Z,h)))),t.$$.dirty[0]&1073741856|t.$$.dirty[1]&1&&o&&x.size){let Z="+"+x.size+" more";a?i(10,F=Ni(a)?a({num:x.size,text:Z}):a):i(10,F=Z)}t.$$.dirty[0]&536870913&&i(6,$=r&&ip(h,r)),t.$$.dirty[0]&82&&$&&m&&R&&J6().then(z),t.$$.dirty[0]&9&&N&&yot(N,()=>({allDay:!0,date:h,resource:void 0,dayEl:N}))},[h,m,g,N,R,x,$,A,_,O,F,V,u,d,p,v,I,b,D,w,S,U,C,E,P,G,j,f,H,r,a,o,s,l,c,K,q,Y]}class Bst extends ol{constructor(e){super(),al(this,e,$st,Fst,Ss,{date:0,chunks:27,longChunks:1,iChunks:2,reposition:28},null,[-1,-1])}get reposition(){return this.$$.ctx[28]}}function jJ(t,e,i){const n=t.slice();return n[21]=e[i],n[22]=e,n[23]=i,n}function GJ(t){let e,i=t[23],n;const r=()=>t[18](e,i),a=()=>t[18](null,i);let o={date:t[21],chunks:t[1],longChunks:t[2],iChunks:t[3]};return e=new Bst({props:o}),r(),{c(){Ma(e.$$.fragment)},m(s,l){ma(e,s,l),n=!0},p(s,l){i!==s[23]&&(a(),i=s[23],r());const c={};l&1&&(c.date=s[21]),l&2&&(c.chunks=s[1]),l&4&&(c.longChunks=s[2]),l&8&&(c.iChunks=s[3]),e.$set(c)},i(s){n||(Bt(e.$$.fragment,s),n=!0)},o(s){Si(e.$$.fragment,s),n=!1},d(s){a(),ea(e,s)}}}function Vst(t){let e,i,n,r,a,o=Co(t[0]),s=[];for(let c=0;c<o.length;c+=1)s[c]=GJ(jJ(t,o,c));const l=c=>Si(s[c],1,1,()=>{s[c]=null});return{c(){e=In("div");for(let c=0;c<s.length;c+=1)s[c].c();Qe(e,"class",i=t[5].days),Qe(e,"role","row")},m(c,u){Dn(c,e,u);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(e,null);n=!0,r||(a=un(window,"resize",t[11]),r=!0)},p(c,[u]){if(u&31){o=Co(c[0]);let d;for(d=0;d<o.length;d+=1){const p=jJ(c,o,d);s[d]?(s[d].p(p,u),Bt(s[d],1)):(s[d]=GJ(p),s[d].c(),Bt(s[d],1),s[d].m(e,null))}for(Ls(),d=o.length;d<s.length;d+=1)l(d);Fs()}(!n||u&32&&i!==(i=c[5].days))&&Qe(e,"class",i)},i(c){if(!n){for(let u=0;u<o.length;u+=1)Bt(s[u]);n=!0}},o(c){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)Si(s[u]);n=!1},d(c){c&&Sn(e),MI(s,c),r=!1,a()}}}function jst(t,e,i){let n,r,a,o,s,{dates:l}=e,{_events:c,_iEvents:u,_queue2:d,_hiddenEvents:p,hiddenDays:h,theme:f}=Jl("state");Ve(t,c,U=>i(17,o=U)),Ve(t,u,U=>i(16,a=U)),Ve(t,p,U=>i(14,n=U)),Ve(t,h,U=>i(15,r=U)),Ve(t,f,U=>i(5,s=U));let m,g,v=[],y,I,b=[],D={};function w(){Q6(()=>OTe(b,l),D,d)}function S(U,C){Lp[U?"unshift":"push"](()=>{b[C]=U,i(4,b)})}return t.$$set=U=>{"dates"in U&&i(0,l=U.dates)},t.$$.update=()=>{if(t.$$.dirty&1&&(i(12,y=l[0]),i(13,I=ag(pr(l[l.length-1])))),t.$$.dirty&176130){i(1,m=[]);for(let U of o)if(!t7(U.display)&&fJ(U,y,I)){let C=uV(U,y,I);m.push(C)}i(2,g=hJ(m,r)),w()}t.$$.dirty&110592&&i(3,v=a.map(U=>{let C;return U&&fJ(U,y,I)?(C=uV(U,y,I),hJ([C],r)):C=null,C})),t.$$.dirty&16384&&n&&w()},[l,m,g,v,b,s,c,u,p,h,f,w,y,I,n,r,a,o,S]}class Gst extends ol{constructor(e){super(),al(this,e,jst,Vst,Ss,{dates:0})}}function HJ(t,e,i){const n=t.slice();return n[10]=e[i],n}function zJ(t){let e,i;return e=new Gst({props:{dates:t[10]}}),{c(){Ma(e.$$.fragment)},m(n,r){ma(e,n,r),i=!0},p(n,r){const a={};r&1&&(a.dates=n[10]),e.$set(a)},i(n){i||(Bt(e.$$.fragment,n),i=!0)},o(n){Si(e.$$.fragment,n),i=!1},d(n){ea(e,n)}}}function Hst(t){let e,i,n=Co(t[0]),r=[];for(let o=0;o<n.length;o+=1)r[o]=zJ(HJ(t,n,o));const a=o=>Si(r[o],1,1,()=>{r[o]=null});return{c(){for(let o=0;o<r.length;o+=1)r[o].c();e=ch()},m(o,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(o,s);Dn(o,e,s),i=!0},p(o,s){if(s&1){n=Co(o[0]);let l;for(l=0;l<n.length;l+=1){const c=HJ(o,n,l);r[l]?(r[l].p(c,s),Bt(r[l],1)):(r[l]=zJ(c),r[l].c(),Bt(r[l],1),r[l].m(e.parentNode,e))}for(Ls(),l=n.length;l<r.length;l+=1)a(l);Fs()}},i(o){if(!i){for(let s=0;s<n.length;s+=1)Bt(r[s]);i=!0}},o(o){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Si(r[s]);i=!1},d(o){o&&Sn(e),MI(r,o)}}}function zst(t){let e,i,n,r;return e=new Mst({}),n=new Ast({props:{$$slots:{default:[Hst]},$$scope:{ctx:t}}}),{c(){Ma(e.$$.fragment),i=Rs(),Ma(n.$$.fragment)},m(a,o){ma(e,a,o),Dn(a,i,o),ma(n,a,o),r=!0},p(a,[o]){const s={};o&8193&&(s.$$scope={dirty:o,ctx:a}),n.$set(s)},i(a){r||(Bt(e.$$.fragment,a),Bt(n.$$.fragment,a),r=!0)},o(a){Si(e.$$.fragment,a),Si(n.$$.fragment,a),r=!1},d(a){a&&Sn(i),ea(e,a),ea(n,a)}}}function Wst(t,e,i){let n,r,a,o,{_viewDates:s,_hiddenEvents:l,dayMaxEvents:c,hiddenDays:u}=Jl("state");Ve(t,s,h=>i(6,n=h)),Ve(t,l,h=>i(9,a=h)),Ve(t,c,h=>i(7,r=h)),Ve(t,u,h=>i(8,o=h));let d,p;return t.$$.update=()=>{if(t.$$.dirty&481){i(0,d=[]),i(5,p=7-o.length),Hn(l,a={},a);for(let h=0;h<n.length/p;++h){let f=[];for(let m=0;m<p;++m)f.push(n[h*p+m]);d.push(f)}}},[d,s,l,c,u,p,n,r,o]}class qst extends ol{constructor(e){super(),al(this,e,Wst,zst,Ss,{})}}var Kst={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.view="dayGridMonth",t.views.dayGridMonth={buttonText:Rot,component:qst,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:Aot("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=Pst(t),t._intlDayCell=FT(t.locale,t.dayCellFormat),t._intlDayPopover=FT(t.locale,t.dayPopoverFormat),t._hiddenEvents=Oa({}),t._popupDate=Oa(null),t._popupChunks=Oa([])}};let LM;function Yst(){var i;const t=Bc(),e=(i=t==null?void 0:t.provider)==null?void 0:i.organisationId;if(e){const n=r=>{r!=null&&r.calendar?FF(r.calendar):Gs.findAllTournaments().then(FF)};Gs.findProvider(e).then(n)}else Gs.findAllTournaments().then(FF)}function FF(t){const e=document.getElementById(ak);return LM&&lo(e),oat(),LM=new dst({target:e,props:{plugins:[Kst,Dst],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:Xst(t),eventClick:Zst,eventMouseEnter:Jst,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{..._P,calendar:LM}}function Zst({event:t}){if(t.id){LM.destroy();const e=t.id;$e.reset();const i=`/${xa}/${e}`;Ye.router.navigate(i)}}function Xst(t){const e=i=>i==null?void 0:i.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function Jst({event:t,jsEvent:e}){pf(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var Qst=/([:*])(\w+)/g,elt="([^/]+)",tlt=/\*/g,ilt="?(?:.*)",nlt=/\/\?/g,rlt="/?([^/]+|)",alt="(?:/^|^)",olt="";function LTe(t){return t===void 0&&(t="/"),n7()?location.pathname+location.search+location.hash:t}function Zr(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function iA(t){return typeof t=="string"}function slt(t){return typeof t=="function"}function nA(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function llt(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,n,r){return i===null&&(i={}),i[e[r]]=decodeURIComponent(n),i},null)}function rA(t){var e=Zr(t).split(/\?(.*)?$/);return[Zr(e[0]),e.slice(1).join("")]}function i7(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]!==""){var a=decodeURIComponent(r[0]);e[a]?(Array.isArray(e[a])||(e[a]=[e[a]]),e[a].push(decodeURIComponent(r[1]||""))):e[a]=decodeURIComponent(r[1]||"")}}return e}function FTe(t,e){var i=rA(Zr(t.currentLocationPath)),n=i[0],r=i[1],a=r===""?null:i7(r),o=[],s;if(iA(e.path)){if(s=alt+Zr(e.path).replace(Qst,function(d,p,h){return o.push(h),elt}).replace(tlt,ilt).replace(nlt,rlt)+"$",Zr(e.path)===""&&Zr(n)==="")return{url:n,queryString:r,hashString:nA(t.to),route:e,data:null,params:a}}else s=e.path;var l=new RegExp(s,olt),c=n.match(l);if(c){var u=iA(e.path)?llt(c,o):c.groups?c.groups:c.slice(1);return{url:Zr(n.replace(new RegExp("^"+t.instance.root),"")),queryString:r,hashString:nA(t.to),route:e,data:u,params:a}}return!1}function $Te(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function NI(t,e){return typeof t[e]>"u"||t[e]===!0}function clt(t){if(!t)return{};var e=t.split(","),i={},n;return e.forEach(function(r){var a=r.split(":").map(function(o){return o.replace(/(^ +| +$)/g,"")});switch(a[0]){case"historyAPIMethod":i.historyAPIMethod=a[1];break;case"resolveOptionsStrategy":n||(n={}),n.strategy=a[1];break;case"resolveOptionsHash":n||(n={}),n.hash=a[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[a[0]]=a[1]==="true";break}}),n&&(i.resolveOptions=n),i}function n7(){return typeof window<"u"}function ult(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(n){i[n]&&(e[n]||(e[n]=[]),e[n].push(i[n]))})}),e}function np(t,e,i){var n=e||{},r=0;(function a(){if(!t[r]){i&&i(n);return}Array.isArray(t[r])?(t.splice.apply(t,[r,1].concat(t[r][0](n)?t[r][1]:t[r][2])),a()):t[r](n,function(o){typeof o>"u"||o===!0?(r+=1,a()):i&&i(n)})})()}np.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function WJ(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=LTe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function $F(t,e){for(var i=0;i<t.instance.routes.length;i++){var n=t.instance.routes[i],r=FTe(t,n);if(r&&(t.matches||(t.matches=[]),t.matches.push(r),t.resolveOptions.strategy==="ONE")){e();return}}e()}function dlt(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function plt(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var qJ=n7(),hlt=$Te();function flt(t,e){if(NI(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),n=qJ&&t.resolveOptions&&t.resolveOptions.hash===!0;hlt?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",n?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!n){var r=location.hash;location.hash="",location.hash=r}t.instance.__freezeListening=!1},1))):qJ&&(window.location.href=t.to)}e()}function BTe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}np(i.lastResolved().map(function(n){return function(r,a){if(!n.route.hooks||!n.route.hooks.leave){a();return}var o=!1,s=t.instance.matchLocation(n.route.path,t.currentLocationPath,!1);if(n.route.path!=="*")o=!s;else{var l=t.matches?t.matches.find(function(c){return n.route.path===c.route.path}):!1;o=!l}if(NI(t.navigateOptions,"callHooks")&&o){np(n.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return a()}]));return}else a()}}),{},function(){return e()})}function mlt(t,e){t.match.route.hooks&&t.match.route.hooks.before&&NI(t.navigateOptions,"callHooks")?np(t.match.route.hooks.before.map(function(i){return function(r,a){return i(function(o){o===!1?t.instance.__markAsClean(t):a()},t.match)}}).concat([function(){return e()}])):e()}function glt(t,e){NI(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function vlt(t,e){t.match.route.hooks&&t.match.route.hooks.after&&NI(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function ylt(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(n){n.route.hooks&&n.route.hooks.already&&NI(t.navigateOptions,"callHooks")&&n.route.hooks.already.forEach(function(r){return r(t.match)})}),e(!1);return}e()}function Ilt(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var n=rA(t.currentLocationPath),r=n[0],a=n[1],o=nA(t.to);i.path=Zr(r);var s={url:i.path,queryString:a,hashString:o,data:null,route:i,params:a!==""?i7(a):null};t.matches=[s],t.match=s}e()}function blt(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function wlt(t,e){t.instance._setCurrent(null),e()}function VTe(t,e){NI(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var jTe=[ylt,mlt,glt,vlt],KJ=[BTe,Ilt,np.if(function(t){var e=t.notFoundHandled;return e},jTe.concat([VTe]),[blt,wlt])];function hV(){return hV=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},hV.apply(this,arguments)}function YJ(t,e){var i=0;function n(){if(i===t.matches.length){VTe(t,e);return}np(jTe,hV({},t,{match:t.matches[i]}),function(){i+=1,n()})}BTe(t,n)}function BF(t){t.instance.__markAsClean(t)}function fV(){return fV=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},fV.apply(this,arguments)}var ZJ="[data-navigo]";function Slt(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:ZJ},n=this,r="/",a=null,o=[],s=!1,l,c=$Te(),u=n7();t?r=Zr(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d($){return $.indexOf("#")>=0&&(i.hash===!0?$=$.split("#")[1]||"/":$=$.split("#")[0]),$}function p($){return Zr(r+"/"+Zr($))}function h($,V,G,j){return $=iA($)?p($):$,{name:j||Zr(String($)),path:$,handler:V,hooks:ult(G)}}function f($,V,G){var j=this;return typeof $=="object"&&!($ instanceof RegExp)?(Object.keys($).forEach(function(z){if(typeof $[z]=="function")j.on(z,$[z]);else{var H=$[z],K=H.uses,q=H.as,Y=H.hooks;o.push(h(z,K,[l,Y],q))}}),this):(typeof $=="function"&&(G=V,V=$,$=r),o.push(h($,V,[l,G])),this)}function m($,V){if(n.__dirty){n.__waiting.push(function(){return n.resolve($,V)});return}else n.__dirty=!0;$=$?Zr(r)+"/"+Zr($):void 0;var G={instance:n,to:$,currentLocationPath:$,navigateOptions:{},resolveOptions:fV({},i,V)};return np([WJ,$F,np.if(function(j){var z=j.matches;return z&&z.length>0},YJ,KJ)],G,BF),G.matches?G.matches:!1}function g($,V){if(n.__dirty){n.__waiting.push(function(){return n.navigate($,V)});return}else n.__dirty=!0;$=Zr(r)+"/"+Zr($);var G={instance:n,to:$,navigateOptions:V||{},resolveOptions:V&&V.resolveOptions?V.resolveOptions:i,currentLocationPath:d($)};np([dlt,plt,$F,np.if(function(j){var z=j.matches;return z&&z.length>0},YJ,KJ),flt,BF],G,BF)}function v($,V,G){var j=P($,V);return j!==null?(g(j.replace(new RegExp("^/?"+r),""),G),!0):!1}function y($){return this.routes=o=o.filter(function(V){return iA($)?Zr(V.path)!==Zr($):slt($)?$!==V.handler:String(V.path)!==String($)}),this}function I(){c&&(this.__popstateListener=function(){n.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function b(){this.routes=o=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function D($,V){return n._notFoundRoute=h("*",$,[l,V],"__NOT_FOUND__"),this}function w(){if(u)return S().forEach(function($){if($.getAttribute("data-navigo")==="false"||$.getAttribute("target")==="_blank"){$.hasListenerAttached&&$.removeEventListener("click",$.navigoHandler);return}$.hasListenerAttached||($.hasListenerAttached=!0,$.navigoHandler=function(V){if((V.ctrlKey||V.metaKey)&&V.target.tagName.toLowerCase()==="a")return!1;var G=$.getAttribute("href");if(typeof G>"u"||G===null)return!1;if(G.match(/^(http|https)/)&&typeof URL<"u")try{var j=new URL(G);G=j.pathname+j.search}catch{}var z=clt($.getAttribute("data-navigo-options"));s||(V.preventDefault(),V.stopPropagation(),n.navigate(Zr(G),z))},$.addEventListener("click",$.navigoHandler))}),n}function S(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||ZJ)):[]}function U($){return"/"+r+"/"+Zr($)}function C($){return l=$,this}function E(){return a}function P($,V,G){var j=o.find(function(K){return K.name===$}),z=null;if(j){if(z=j.path,V)for(var H in V)z=z.replace(":"+H,V[H]);z=z.match(/^\//)?z:"/"+z}return z&&G&&!G.includeRoot&&(z=z.replace(new RegExp("^/"+r),"")),z}function M($){return $.getAttribute("href")}function N($){var V=rA(Zr($)),G=V[0],j=V[1],z=j===""?null:i7(j),H=nA($),K=h(G,function(){},[l],G);return{url:G,queryString:j,hashString:H,route:K,data:null,params:z}}function R(){return N(Zr(LTe(r)).replace(new RegExp("^"+r),""))}function A($){var V={instance:n,currentLocationPath:$,to:$,navigateOptions:{},resolveOptions:i};return $F(V,function(){}),V.matches?V.matches:!1}function _($,V,G){typeof V<"u"&&(typeof G>"u"||G)&&(V=p(V));var j={instance:n,to:V,currentLocationPath:V};WJ(j,function(){}),typeof $=="string"&&($=typeof G>"u"||G?p($):$);var z=FTe(j,{name:String($),path:$,handler:function(){},hooks:{}});return z||!1}function O($,V,G){return typeof V=="string"&&(V=x(V)),V?(V.hooks[$]||(V.hooks[$]=[]),V.hooks[$].push(G),function(){V.hooks[$]=V.hooks[$].filter(function(j){return j!==G})}):(console.warn("Route doesn't exists: "+V),function(){})}function x($){return typeof $=="string"?o.find(function(V){return V.name===p($)}):o.find(function(V){return V.handler===$})}function F($){$.instance.__dirty=!1,$.instance.__waiting.length>0&&$.instance.__waiting.shift()()}this.root=r,this.routes=o,this.destroyed=s,this.current=a,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=f,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=b,this.notFound=D,this.updatePageLinks=w,this.link=U,this.hooks=C,this.extractGETParameters=function($){return rA(d($))},this.lastResolved=E,this.generate=P,this.getLinkPath=M,this.match=A,this.matchLocation=_,this.getCurrentLocation=R,this.addBeforeHook=O.bind(this,"before"),this.addAfterHook=O.bind(this,"after"),this.addAlreadyHook=O.bind(this,"already"),this.addLeaveHook=O.bind(this,"leave"),this.getRoute=x,this._pathToMatchObject=N,this._clean=Zr,this._checkForAHash=d,this._setCurrent=function($){return a=n.current=$},I.call(this),w.call(this)}function Tlt(){const e=new Slt("/",{hash:!0});Ye.router=e;const i=({selectedTab:n,renderDraw:r,data:a})=>{mx(),sat({config:{selectedTab:n,renderDraw:r,...a}})};return e.on(`/${xa}/:tournamentId`,({data:n})=>{i({data:n})}),e.on(`/${xa}/:tournamentId/${ev}/:eventId`,({data:n})=>{i({selectedTab:Vu,data:n})}),e.on(`/${xa}/:tournamentId/${ev}/:eventId/${zS}/:drawId`,({data:n})=>{i({selectedTab:Vu,renderDraw:!0,data:n})}),e.on(`/${xa}/:tournamentId/${ev}/:eventId/${zS}/:drawId/${G$}/:roundsView`,({data:n})=>{i({selectedTab:Vu,renderDraw:!0,data:n})}),e.on(`/${xa}/:tournamentId/${ev}/:eventId/${zS}/:drawId/${j$}/:structureId`,({data:n})=>{i({selectedTab:Vu,renderDraw:!0,data:n})}),e.on(`/${xa}/:tournamentId/${ev}/:eventId/${zS}/:drawId/${j$}/:structureId/${G$}/:roundsView`,({data:n})=>{i({selectedTab:Vu,renderDraw:!0,data:n})}),e.on(`/${xa}/:tournamentId/${ev}/:eventId/${Gle}/:drawId`,({data:n})=>{i({selectedTab:Vu,data:n})}),e.on(`/${xa}/:tournamentId/${Tp}/:participantView`,({data:n})=>{i({selectedTab:Tp,data:n})}),e.on(`/${xa}/:tournamentId/${iy}/:scheduledDate`,({data:n})=>{i({selectedTab:iy,data:n})}),e.on(`/${xa}/:tournamentId/:selectedTab`,({data:n})=>{i({data:n})}),e.on(`/${Sp}/:uuid`,rJ),e.on(`/${Sp}`,rJ),e.on(`/${Kke}/:inviteKey`,qat),e.on("/calendar",Yst),e.on("/actionKey/:key",({data:n})=>{n.key,e.navigate("/"),AF()}),e.on("/",()=>{AF()}),e.notFound(()=>{e.navigate("/"),AF()}),e.resolve(),{success:!0}}function Ult(t){console.log({msg:t}),Gs.findTournament(t.tournamentId).then(e,i=>console.log({err:i}));function e(i){ON.call("tournamentAuthorization","tap",i),i&&t.tournament&&t.send_auth?ir({title:"Save tournament",content:`
        <div class="content">
          <p>Choose to keep the existing tournament or replace the local copy with the incoming tournament</p>
        </div>
        `,buttons:[{label:"Save Received",onClick:()=>n(t.tournament),close:!0},{label:"Keep Existing",onClick:()=>r(i),close:!0},{label:"Cancel",close:!0}]}):!i&&t.tournament?n(t.tournament):i?r(i):o(),t.referee_key&&Ye.ee.emit("sendKey",t.referee_key),t.tournament_key&&Dlt(t.tournament_key,t.tuid);function n(s){let l=vW({data:s,maxTilde:5});l&&(Ye.ee.emit("updateTournament",l),l.start&&(l.start=new Date(l.start).getTime()),l.end&&(l.end=new Date(l.end).getTime()),NN.addTournament(l).then(()=>r(l),o))}function r(s){t.inDB=!0,t.notice=`${s.name}`;let l=`${Nr.tr(t.title)}: ${t.notice}`,c=nat("tournament")&&{text:Nr.tr("tournaments.edit"),onClick:a};ai({intent:"is-success",message:l,action:c})}function a(){console.log("display tournament")}function o(){t.notice="Not Found in Calendar",cn.messages.push(t)}}}function Dlt(t,e){const i=()=>console.log("added tournament key");NN.findSetting("tournamentKeys").then(n,n);function n(r={key:"tournamentKeys",ring:[]}){var a;r.ring=r.ring.filter(o=>o.key!==t),t&&e&&(r.ring.push({key:t,tuid:e,ouid:(a=cn.org)==null?void 0:a.ouid}),NN.addSetting(r).then(i,i))}}function Plt(){return new Promise((t,e)=>{Nlt();const i=()=>{cn.first_time_user=cn.first_time_user&&Ye.ee.emit("sendKey","players")?!1:cn.first_time_user,t()};Elt().then(i,e)})}const Clt=t=>(...e)=>hTe()?t(...e):t(...e).catch(i=>console.log(i));function Elt(){return new Promise((t,e)=>{new Promise((n,r)=>Clt(Gs.initDB)().then(t,Mlt).then(n,r)).then(t,e)})}function Mlt(){Ye.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function GTe(t){const e=r=>Object.keys(r).map(a=>r[a]).join(""),i=e(t);cn.messages.reduce((r,a)=>e(a)===i?!0:r,!1)||cn.messages.push(t)}function Rlt(t){console.log({tmxMessage:t}),t.authorized&&(t.tuid||t.tournamentId)?Ult(t):(t.notice=t.notice||t.tournament,t.notice&&GTe(t))}function Nlt(){Ye.ee.addListener(TYe,Fwe),Ye.ee.addListener("tmxMessage",Rlt),Ye.ee.addListener("addMessage",GTe)}function VF(){xlt(),Iat(),_lt(),gOe(),vat(),Ye.drawer=Wat(),Plt().then(Alt,t=>console.log({err:t}))}function Alt(){console.log("%c TMX ready","color: lightgreen"),uTe(),document.getElementById(hU).onclick=()=>Ye.router.navigate(`/${Sp}`),Tlt(),Wrt()}function _lt(){Ye.dragMatch=new Image,Ye.dragMatch.src=rTe,Ye.ee=new yat}const klt="ResizeObserver loop limit exceeded",Olt="ResizeObserver loop completed with undelivered notifications.";function xlt(){cn.device=Flt(),cn.version_check=new Date().getTime();const t=$e.version();console.log(`%cversion: ${I6}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),Llt()}function Llt(){window.addEventListener("error",t=>{if([klt,Olt].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function Flt(){let t=$lt();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function $lt(){try{return navigator||window.navigator}catch{return}}if(window.attachEvent)window.attachEvent("onload",VF);else if(window.onload){const t=window.onload,e=i=>{t(i),VF()};window.onload=e}else window.onload=VF;fOe();mOe();
//# sourceMappingURL=index-DQoPwYXV.js.map
