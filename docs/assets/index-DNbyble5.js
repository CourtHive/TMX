var y0e=Object.defineProperty;var b0e=(t,e,i)=>e in t?y0e(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var UO=(t,e,i)=>(b0e(t,typeof e!="symbol"?e+"":e,i),i);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();const Fn=function(){let t={},e={},i="gbr";t.define=({ioc:r,idiom:o})=>{e[r]=o},t.set=r=>{if(!r)return i;if(e[r])return i=r,e[r]},t.options=()=>Object.keys(e),t.current=()=>e[i];function n(r){if(!r)return"";let o=e[i],a=r.split(".");for(;a.length;){let s=a.shift();o=(o==null?void 0:o[s])||""}return o}return t.tr=r=>{if(!r)return"";if(n(r))return n(r);let o=e.default,a=r.split(".");for(;a.length;){let s=a.shift();o=(o==null?void 0:o[s])||""}return o},t.obj=r=>{var o;return r?(o=e==null?void 0:e[i])!=null&&o[r]?e[i][r]:e.default[r]?e.default[r]:{}:""},e.default={open:"Open",zoom:"Zoom",addcourts:"Add Courts",login:"Login",logout:"Logout",passwd:"Password",lang:"Language",menu:"Menu",main:"Main Menu",local:"Local Data",save:"Save",side:"Side",bye:"BYE",select:"Select",selected:"Selectd",group:"GROUP",administrator:"Administrator",revoke:"Revoke",tour:"Tour",noresults:"No Results",delete:"Delete",continue:"Do you wish to continue?",notes:"Notes",social:"Social Media",stats:"Statistics",merge:"Merge",week:"Week",warn:"WARNING",add:"Add",remove:"Remove",ptz:"Penalties",replace:"Replace",dl:"Download",or:"or",arp:"All Ranking Points",rlp:"Points - Ranking Lists",trn:"Tournament",tnz:"Tournaments",enable:"Enable",disable:"Disable",rnd:"Round",dt:"Date",fmt:"Format",cat:"Category",cta:"Cat.",team:"Team",tmz:"Teams",rnk:"Rank",rnkz:"Rankings",rtg:"Rating",rtz:"Ratings",prnk:"Rank",trnk:"Rank",rl:"Rank List",rlo:"Rank Order",alpha:"Alphabetical",opnt:"Opponent",ply:"Player",pyr:"Players",sgi:"Sign-In",sgo:"Sign-Out",scr:"Score",pts:"Points",allmatches:"All Matches",allteams:"All Teams",mts:"Matches",emts:"Matches",ests:"Sets",egms:"Games",epts:"Points",mtc:"Match",drw:"Draw",drz:"Draws",ent:"Event",evt:"Events",sch:"Schedule",rename:"Rename",crt:"Courts",ct:"Court",on:"On",off:"Off",id:"ID",nm:"Name",fnm:"First Name",lnm:"Last Name",nnm:"Nickname",attr:"Attribute",bd:"Birthday",yr:"Year",byr:"Birth Year",tot:"Total",sgl:"Singles",dbl:"Doubles",pyo:"Playoff",adh:"Ad-Hoc",snr:"Senior",unk:"Unknown",dup:"Duplicate",stt:"Status",ord:"Order",clb:"Club",scl:"School",cty:"City",state:"State",cnt:"Country",kwn:"Known",ioc:"IOC",act:"Action",agd:"Assigned",igr:"Ignore",igd:"Ignored",edt:"Edit Player",idp:"Identify Player",dlp:"Delete Player",sbt:"Submit",ccl:"Cancel",clr:"Clear",und:"Undo",apt:"Accept",dss:"Dismiss",frm:"From",to:"To",h2h:"Head-to-Head",reg:"Registered",gdr:"Gender",dtp:"Draw Type",drp:"Draw Position",manual:"Manual Draw",adr:"Automated Draw",mdo:"Draw Order",phn:"Phone",view:"View",email:"Email",asn:"Association",start:"Start",end:"End",dates:"Dates",ref:"Referee",time:"Time",duration:"Duration",qualifier:"Qualifier",qualifiers:"Qualifiers",none:"None",keys:"Keys",pos:"Position",seeding:"Seeding",home:"Home",new:"New",inout:"In/Out",indoors:"Indoors",outdoors:"Outdoors",existing:"Existing",success:"Success",loading:"Loading",set:"Settings",version:"Version",messages:"Messages",support:"Support",datastorage:"Data Storage",releasenotes:"Release Notes",documentation:"Documentation",importexport:"Import / Export",newversion:"New Version Available",latitude:"Latitude",longitude:"Longitude",i18n:{previousMonth:"Previous Month",nextMonth:"Next Month",months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],weekdays:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],weekdaysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},settings:{help:"Help",pagesize:"Page Size",schedule:"Schedule",calendar:"Calendar",search:"Search",documentation:"Documentation Links",hoverhelp:"Hover Hints",diacritics:"Diacritics",lastfirst:"Last name, First name",organization:"Organization",general:"General",categories:"Categories",points:"Points",draws:"Draws",data:"Data",sheetdata:"Sheet Data",publishing:"Publishing",printing:"Printing",savepdfs:"Save PDF",opentabs:"Open in Browser Tabs",compresseddraws:"Compressed Draw Formats",teams:"Teams Displayed",countryflags:"Country Flags Displayed",requireconfirm:"Require Confirmation",publishonscore:"Publish when score entered",publishdrawcreation:"Publish as draw created",matchesbefore:"Matches Before Count",automatedbyes:"Automatic Bye Placement",llallrounds:"LL from All Qualifying Rounds",rrh2hpriority:"RR Head-to-Head priority",qualconsolation:"Qualifying Consolation",consolationalts:"Consolation Alternates",consolationseeds:"Consolation Seeding",gemseeding:"GEM Seeding",adhocelo:"Adhoc ELO Ratings",restrictseedplacement:"Restrict Seed Placement",separate_by_team:"Auto Separate Players by Team",separate_by_ioc:"Auto Separate Players by Country",separate_by_club:"Auto Separate Players by Club",separate_by_school:"Auto Separate Players by School",clear_separation:"Clear Auto Separation",courtdetail:"Court Details",matchtimes:"Match Times",matchdates:"Match Dates",firstday:"Week Starts Monday",time24:"24 Hour Clock",draworderscores:"Scores in Draw Order",schedulecompleted:"Schedule Completed Matches",courtidentifiers:"court identifiers"},round_names:{F:"Final",SF:"Semifinal",QF:"Quarterfinal"},search:{filterplayers:"Filter Players",players:"Search Players",tournaments:"Search Tournaments",clubs:"Search Clubs",approve:"Approve Player",add2team:"Add Team Player",lastfirst:"LAST First",firstlast:"First Last"},formats:{singles:"Singles",doubles:"Doubles",team:"Team"},scoring_format:{set:"Set",sets:"Sets",timedset:"Timed Set",timedsets:"Timed Sets",tiebreak:"Tiebreak",tiebreaks:"Tiebreaks",winby:"Win By",custom:"Custom",bestof:"Best of",tbat:"TB at",finalset:"Final Set",setsto:"Sets to",tbto:"TB to",superto:"To"},scoring:{label:"Scoring",retire:"Retire",default:"Default",walkover:"Walkover",supertiebreak:"Match Tiebreak",normal:"Normal",winloss_abbreviation:"W/L",cancelled:"Cancelled",abandoned:"Abandoned"},draws:{seedlimit:"Seed Limit",blockthreshold:"Block Threshold",generating:"Generating... Please be patient...",generateround:"Generate Round",deleteround:"Delete Round",adhoc:"Adhoc",gemseeding:"GEM Seeding",playerfilter:"Ratings Filter",compass:"Compass",north:"North",south:"South",east:"East",west:"West",northeast:"Northeast",northwest:"Northwest",southeast:"Southeast",southwest:"Southwest",feedin:"Feed-in",staggered:"Staggered",standard:"Standard",elective:"Elective",backdraw:"Backdraw",roundlimit:"Round Limit",structure:"Structure",skiprounds:"Skip Rounds",feedrounds:"Feed Rounds",sequential:"Sequential",brackets:"Brackets",bracketsize:"Bracket Size",roundrobin:"Round Robin",elimination:"Elimination",consolation:"Consolation",qualification:"Qualification",preround:"Pre-Round",incidentals:"Incidentals",remove:"Remove",changestatus:"Change Status",penalty:"Assess penalty",umpire:"Select Referee",matchumpire:"Match Referee",matchtime:"Match Time",starttime:"Start Time",endtime:"Finish Time",resttime:"Rest Time",duration:"Duration",timeheader:"Time Heading",maindraw:"Main Draw",unscheduled:"Unscheduled Matches",scheduled:"Scheduled Matches",completed:"Completed",unpublished:"Unpublished",publisheduptodate:"Up to Date",publishedoutofdate:"Out of Date",published:"Published",publish:"Publish",publishQ:"Publish Draw?",organizers:"Organizers",playerrep:"Representative",playerreps:"Representatives",substitutes:"Substitutes (LL/Alts)",allindraw:"all in draw",lastdirectaccept:"Last Direct Acceptance",clear:"Clear Draw",swap:"Swap Position",alternate:"Alternate",alternatepair:"Alternate Pair",alternateplayer:"Alternate Player",luckyloser:"Lucky Loser",first:"First",last:"Last",seedrange:"Seeds",modifyseeding:"Modify Seeding",playerrange:"All Players",unpublish:"Unpublish Draw",unpublishall:"Unpublish All Events"},print:{publishpdf:"Publish PDF",schedule:"Schedule",draw:"Print",signin:"Sign-In Sheet",ranklist:"Rank List",playerlist:"Player List",matchlist:"Print Match List",matchesbytime:"Matches by Time",pendingmatches:"Pending Matches",matchesbycourt:"Matches by Court",completedmatches:"Completed Matches"},teams:{code:"Code (3 letters)",name:"Name",share:"Share Team",rankings:"Team Rankings",members:"Members",matches:"Matches",winloss:"Won/Lost",newteam:"New Team",createnew:"Create New",submitkey:"Submit Key",nameorkey:"Team Name or Import Key",club:"Club",coaches:"Coaches",school:"School",ioc:"Country",abbreviation:"Abbreviation"},tournament:{organizer_email:"Organizer Email",organizer_phone:"Organizer Phone",judge_email:"Referee Email",judge_phone:"Referee Phone",sponsor:"Sponsor(s)",logo:"Tournament Logo",images:"Tournament Images"},tournaments:{type:"Type",standard:"Standard",dual:"Dual Matches",register:"Register",registration:"Registration Link",team:"Team Tournament",new:"New Tournament",add:"Add Tournament",id:"Tournament ID",loadbyid:"Load by ID",edit:"Edit",copy:"Copy",close:"Close",done:"Finish",import:"Import Record",removeall:"Remove All",addall:"Add All",destroyall:"Destroy All",key:"Authorization",noauth:"Not Authorized",unofficial:"Unofficial",auth:"Authorized",fetch:"Download",fetchtournament:"Download Tournament Record",convert:"Convert to TODS / Save",send:"Upload Tournament Record",export:"Export Tournament Record",renewlist:"Renew List",natlassoc:"National Association",tennisclub:"Tennis Club",received:"Received Tournament Record",existing:"Existing Tournament Record",publishtime:"Publish Time",replacelocal:"Replace Local Copy?",unpublish:"Unpublish Tournament?"},ddlb:{singles:"Singles Tournament Rank:",doubles:"Doubles Tournament Rank:",category:"Tournament Category:",draws:"Select Event:",direction:"Select Draw:"},phrases:{remember_me:"Remember Me",forgot_passwd:"Forgot Password",no_account:"No account? Sign Up",selectlanguage:"Select Language",setupcourts:"Set up your courts",courtsmsg:"Before you can schedule matches we need to know more about your courts. To get started, add some court details.",sortorder:"Sort Order",eventcorrupted:"Event is Corrupted: Development Notified",singlesrankings:"Singles Rankings",doublesrankings:"Doubles Rankings",sectionscroll:"Section Scrolling",dynamicrating:"Dynamic Rating",recalcdynamic:"Re-Calculate Dynamic Rating",comingsoon:"New Feature: Coming Soon!",finalrounds:"Final Rounds",sendplayerdb:"Send Player Database",prerelease:"Pre-release version of TMX",feedback:"Please send all feedback and support requests to",improperauth:"Improper Authorization Credentials",noexportformats:"No Export Formats Enabled",verifyranking:"Please Verify Player Ranking!",nomatches2schedule:"No Matches to Schedule!",addimage:"Enter full website address for an image",addgooglemap:'Enter full URL, not "Link to Share"',retrieveFromServer:"Retrieve from CourtHive Server?",mainmenu:"Main Menu",rankbyrating:"Rank by Rating",dblsrankisrating:"Use Rating as Doubles Ranking?",sheetdataurls:"Enter Google Sheet URLs for Synchronizing Data",playerimport:"Player Import",entersheeturl:"Enter Sheet URL",entergooglemapsurl:"Enter Google Maps link",invalidurl:"Invalid URL(s)",invalidsheeturl:"Invalid Sheet URL",invalidgooglemapsurl:"Invalid Google Maps Link",geolocationdenied:"Geolocation has been denied",unblockgeo:"Unblock in browser settings",usecurrentlocation:"Use your current position?",updatelatlng:"Update Latitude/Longitude?",cleardraw:"Existing Draw will be cleared!",clearselection:"Clear Selection",selectplayer:"Select Player",matches2clear:"Matches to be cleared from the schedule",changeapproved:"Changing Approved will reset the draw and clear the schedule.",qualincomplete:"Qualifying Draw is Incomplete",delegate:"Delegate",delegate2mobile:"Delegate to Mobile",revokedelegation:"Revoke Delegation",delegationrevoked:"Delegation has been revoked",qrcode:"QR Code",scanQRcode:"Scan QR Code with Mobile",ranklists:"Rank Lists for",reset:"Database will be reset",action:"Players requiring some action...",search:"Use the search field above to find players, or click player to edit",assign:"Assign this profile by clicking a player below, or ...",accept:"Accept all players",trnyz:"Loading Tournaments ...",loadplayers:"Load Players",badfile:"File Not Recognized",invalid:"Invalid file type",fileerror:"Error reading file",servererror:"Error Message from Server",notfound:"Not Found",pointcalc:"Point calculation requires tournament category and rank",drawcreated:"Draw Created",drawactive:"Active Draw",notcreated:"Not Created",importdata:"Import Data",exportdata:"Export Data",importtemplate:"Import Template",draganddrop:"Drag and Drop files into this zone",schedulematches:"Schedule Matches",notconfigured:"Not Configured",cannotsignout:"Cannot Sign Out",cannotchangerank:"Cannot Change Rank",cannotchangewinner:"Cannot Change Winner",matchmustbecomplete:"Match Must Be Complete!",approvedplayer:"Player Approved for an Event",locallycreated:"Locally Created Tournament",noremote:"No Remote Registrations to Update",calculateranking:"Calculate Ranking Points",generateranklist:"Generate Rank List",generatekey:"Generate Key",norankingdata:"No Ranking Data",oop_system:"Order of Play",schedulepublished:"Publishing Time:",timestamp:"Date/Time: ",rankedplayers:"Ranked Players",judgesignature:"Signature of Head Umpire:",nopointcalcs:"No Point Calculations for given date",downloadtemplate:"Download Import Template",add2database:"Add Players, Tournaments, Rankings to Database",noconnection:"No Connection",schedulepriority:"Match Scheduling Priority",send:"Send",sendTODS:"Send TODS Tournament Record",export:"Export",pointsvalidfrom:"Points Valid From",linkcopied:"Link Copied to Clipboard",keycopied:"Key Copied to Clipboard",submitkey:"Enter New Key",selectkey:"Select Key",deletereplace:"Delete / Replace",weblink:"Web Link",nomatches:"No Matches",updatedioc:"Update Language File",revokeauth:"Revoke Authorization?",clearalldays:"Clear All Days?",cantdelqual:"Cannot Delete: Qualified Player Active in Main Draw",cantrefresh:"Offline: Cannot Refresh",blocked:"Pop-Up Windows are blocked by your browser",enablepopups:"Please enable Pop-Ups for PDF printing",nopersist:"Data Persistence not guaranteed"},events:{name:"Name",newevent:"New Event",customname:"Custom Name",enableeligibility:"Enable Eligibility Filter",disableeligibility:"Disable Eligibility Filter",teamevent:"Team Event",opponents:"Opponents",matchprofile:"Match Profile",teams:"Teams",draw_type:"Draw Type",draw_size:"Draw Size",created:"Created",category:"Category",rank:"Rank",surface:"Surface",approveteam:"Approve",destroyteam:"Destroy",entered:"Entered",approved:"Approved",eligible:"Eligible",ineligible:"Ineligible",unavailable:"Unavailable",wildcard:"Wildcard",received:"Received Event(s)",toggle:"Toggle Publish State?",modifyranking:"Modify Ranking"},locations:{newlocation:"New Location",abbreviation:"Abbreviation",name:"Name",address:"Address",courts:"Courts",identifiers:"Court IDs"},genders:{male:"Male",male_abbr:"M",female:"Female",female_abbr:"W",mixed:"Mixed"},surfaces:{clay:"Clay",hard:"Hard",grass:"Grass",carpet:"Carpet"},actions:{ok:"OK",actions:"Actions",add_event:"Add Event",save_event:"Save Event",save_team:"Save Team",save_location:"Save Location",done:"Done",cancel:"Cancel",refresh:"Refresh",remakedraw:"Remake Draw",delete_event:"Delete Event",delete_team:"Delete Team",delete_match:"Delete Match",add_player:"Add Player",add_team:"Add Team",create_team:"Create team",generate_team:"Generate Team",publish:"Publish",unpublish:"Unpublish",manage_players:"Manage Players",manage_teams:"Manage Teams",add_location:"Add Location",delete_location:"Delete Location",delete_tournament:"Delete tournament",edit_tournament:"Edit Tournament",copy_tournament:"Copy Tournament",createteambyattr:"Create team",add2localdb:"Add Players to Local Database",signoutunapproved:"Sign Out players not approved for Events"},requests:{syncClubs:"Synchronize Clubs",syncTournaments:"Synchronize Tournaments",syncPlayers:"Synchronize players"},signin:{tournament_date:"Start Date",organization:"Organization",place:"Location",id:"Tournament ID",rank:"Tournament Rank",judge:"Head Umpire",doc_name:"SIGN-IN SHEET",doc_subname:" ",signature:"Signature",registered:"Registered Players",notsignedin:"Not Signed In",signedin:"Signed In",withdrawn:"Withdrawn",medical:"Medical",registration:"Registration",medical_issues:"Medical Expired",create_new_player:"Create New",modifyrankings:"Modify Rankings",acceptrankings:"Accept Rankings",reglink:"Set Link"},schedule:{column:"Column",rows:"Schedule Rows",startrow:"Start Row",alldraws:"All Draws",allevents:"All Events",allrounds:"All Rounds",allcourts:"All Courts",alldual:"All Dual Matches",autoschedule:"Auto Schedule",highlightteam:"Highlight Team",limit:"Limit",clearschedule:"Clear Schedule",clearcompleted:"Clear Completed Matches",orderofplay:"ORDER OF PLAY",matchestime:"Matches => Time",notbefore:"Not Before",nb:"NB",followedby:"Followed By",afterrest:"After Rest",raindelay:"Rain Delay",tba:"TBA",nextavailable:"Next Available",called:"Called",oncourt:"On Court",warmingup:"Warming Up",suspended:"Suspended",abandoned:"Abandoned",clear:"Clear",publish:"Publish Schedule",view:"View Schedule",unpublish:"Unpublish Schedule",timing:"Timing",vs:"vs.",umpirenotes:"Umpire Notes",notice:"Schedule Notice",opponentname:"Opponent Name",scheduled:"Scheduled"},penalties:{fail2signout:"Failed to Sign Out",illegalcoaching:"Illegal Coaching",ballabuse:"Ball Abuse",racquetabuse:"Racquet Abuse",equipmentabuse:"Equipment Abuse",cursing:"Swearing",rudegestures:"Rude Gestures",foullanguage:"Foul Language",timeviolation:"Time Violation",latearrival:"Late Arrival",unsporting:"Unsporting Behavior"},datelocalization:"en-EN"},t}();function vt(t){return typeof t=="function"}function yu(t){return typeof t=="object"&&!Array.isArray(t)}function I0e(t,e=0){let i=e,n,r;const o=()=>{i-=new Date-r,window.clearTimeout(n)},a=()=>i=e,s=()=>{r=new Date,n=window.setTimeout(function(){i=e,t()},i)};return s(),{pause:o,resume:s,reset:a}}var w0e=Object.defineProperty,ii=(t,e)=>{for(var i in e)w0e(t,i,{get:e[i],enumerable:!0})};function Yw(){return"2.0.28"}var HN={};ii(HN,{competitionGovernor:()=>$$,drawsGovernor:()=>$V,entriesGovernor:()=>gG,eventGovernor:()=>bG,generationGovernor:()=>CG,matchUpFormatGovernor:()=>Tp,matchUpGovernor:()=>RG,mocksGovernor:()=>M_,participantGovernor:()=>QG,policyGovernor:()=>FH,publishingGovernor:()=>x_,queryGovernor:()=>BH,reportGovernor:()=>tz,scheduleGovernor:()=>iz,scoreGovernor:()=>mv,tieFormatGovernor:()=>rz,tournamentGovernor:()=>lz,venueGovernor:()=>uz});var $$={};ii($$,{getLinkedTournamentIds:()=>SD,getTournamentIds:()=>ID,linkTournaments:()=>dee,mutate:()=>SJ,query:()=>fee,unlinkTournament:()=>hee,unlinkTournaments:()=>pee});var SJ={};ii(SJ,{linkTournaments:()=>dee,unlinkTournament:()=>hee,unlinkTournaments:()=>pee});var ZS={};ii(ZS,{addNotice:()=>di,callListener:()=>NT,createInstanceState:()=>$Q,cycleMutationStatus:()=>yV,deepCopyEnabled:()=>vV,deleteNotice:()=>wV,deleteNotices:()=>Ty,disableNotifications:()=>jQ,enableNotifications:()=>TE,getDevContext:()=>rl,getMethods:()=>bV,getNotices:()=>IV,getProvider:()=>$F,getTopics:()=>pl,getTournamentId:()=>Uy,getTournamentRecord:()=>SV,getTournamentRecords:()=>If,globalLog:()=>qQ,handleCaughtError:()=>rA,removeTournamentRecord:()=>WQ,setDeepCopy:()=>RT,setDevContext:()=>MT,setGlobalLog:()=>VQ,setGlobalMethods:()=>HQ,setGlobalSubscriptions:()=>mSe,setMethods:()=>GQ,setStateMethods:()=>YQ,setStateProvider:()=>hSe,setSubscriptions:()=>gSe,setTournamentId:()=>AT,setTournamentRecord:()=>zQ,setTournamentRecords:()=>nA,timeKeeper:()=>fSe});function ya(t){return typeof t=="function"}function oa(t){return typeof t=="string"}function ln(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function S0e(t,e){if(!ln(t)||!ln(e))return!1;let i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(let r of i)if(t[r]!==e[r])return!1;return!0}function TJ(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(ln).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}var T0e=t=>e=>Object.keys(t).every(i=>e[i]===t[i]);function MF(t,e){if(t===void 0)return null;if(typeof t!="object"||t===null)return t;let i=Object.keys(t),n=r=>r===void 0?null:r;return Object.assign({},...i.map(r=>Array.isArray(t[r])?{[r]:e?t[r]:t[r].map(o=>MF(o))}:{[r]:e?n(t[r]):MF(t[r])}))}function RF(t){return Array.isArray(t)?t.length+t.map(RF).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>RF(t[e])).reduce((e,i)=>e+i,0):0}function U0e(t){if(t===null||typeof t!="object")return;let e=JSON.stringify(t),i=RF(t),n=e.split("").reduce((r,o)=>r+o.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")}var ae={success:!0},D0e="error",UJ={SUCCESS:ae,ERROR:D0e},NF={message:"Chronological error; time violation.",code:"ANACHRONISM"},DJ={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},AF={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},On={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},Ge={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},lD={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},AI={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},sv={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},lt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},PJ={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},ns={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},Iy={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},V$={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},j$={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},_I={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},CJ={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},EJ={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},P0e={message:"drawPosition not found",code:"ERR_NOT_FOUND_DRAW_POSITION"},H$={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},cD={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},GN={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},Kw={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},Zw={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},G$={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},zN={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},z$={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},uD={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Wc={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},MJ={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},RJ={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},NJ={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},AJ={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},_J={message:"Invalid action",code:"ERR_INVALID_ACTION"},_F={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},kJ={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},xJ={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},OJ={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},W$={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},LJ={message:"Existing round",code:"ERR_EXISTING_ROUND"},C0e={message:"Missing roundNumber",code:"ERR_MISSING_ROUND_NUMBER"},_s={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Nn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},q$={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},vf={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},FJ={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Hh={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Vi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},rs={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},BJ={message:"Event exists",code:"ERR_EXISTING_EVENT"},$J={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},VJ={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},Y$={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},K$={message:"Missing stage",code:"ERR_MISSING_STAGE"},ig={message:"Invalid stage",code:"ERR_INVALID_STAGE"},jJ={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},HJ={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},GJ={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},kF={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},dD={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},IE={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},kI={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Yd={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},Z$={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},X$={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},zJ={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},pD={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},To={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},Xw={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},Ao={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},kd={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Ba={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},Sa={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},J$={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},WN={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},E0e={message:"Missing seeding policy",code:"ERR_MISSING_POLICY_SEEDING"},WJ={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},Q$={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},qJ={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},eV={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},M0e={message:"Policy not attached",code:"ERR_FAILURE_POLICY_NOT_ATTACHED"},lv={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},R0e={message:"Missing scoring policy / matchUpFormats",code:"ERR_MISSING_POLICY_SCORING_MATCHUP_FORMATS"},tV={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},N0e={message:"Invalid setNumber",code:"ERR_INVALID_SET_NUMBER"},qN={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},A0e={message:"Missing setNumber",code:"ERR_MISSING_SET_NUMBER"},_0e={message:"Missing sideNumber",code:"ERR_MISSING_SIDE_NUMBER"},wy={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},gt={message:"Missing value",code:"ERR_MISSING_VALUE"},YJ={message:"Missing date",code:"ERR_MISSING_DATE"},KJ={message:"No valid dates",code:"ERR_NO_VALID_DATES"},gM={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},wE={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},ZJ={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},aa={message:"Invalid Date",code:"ERR_INVALID_DATE"},Dl={message:"Invalid time",code:"ERR_INVALID_TIME"},XJ={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},xF={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},JJ={message:"Invalid score",code:"ERR_INVALID_SCORE"},YN={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},k0e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},iV={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},QJ={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},KN={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},nV={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},Jw={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},bu={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},xl={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},eQ={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},_c={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},tQ={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},Sy={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},hD={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},Rr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},Jn={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},iQ={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},x0e={message:"participant pair exists",code:"ERR_EXISTING_PARTICIPANT_PAIR"},nQ={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},yf={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},rQ={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},oQ={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},aQ={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},Qw={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},ZN={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},rV={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},OF={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},sQ={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},O0e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},L0e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},lQ={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},cQ={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},LF={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},uQ={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},oV={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},dQ={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},aV={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},xI={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},pQ={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},fD={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},hQ={message:"Court exists",code:"ERR_EXISTING_COURT"},fQ={message:"Venue exists",code:"ERR_EXISTING_VENUE"},e0={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},bf={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},mQ={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},sV={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},gQ={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},vQ={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},F0e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},lV={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},yQ={message:"Missing async state provider",code:"ERR_MISSING_ASYNC_STATE_PROVIDER"},cV={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},uV={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},XN={message:"Missing context",code:"ERR_MISSING_CONTEXT"},bQ={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},mD={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},IQ={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},t0={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},wQ={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},JN={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},SQ={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},TQ={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Lp={message:"Invalid object",code:"ERR_INVALID_OBJECT"},SE={message:"Invalid gender",code:"ERR_INVALID_GENDER"},vM={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Pe={message:"Invalid values",code:"ERR_INVALID_VALUES"},UQ={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},dV={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},DQ={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},QN={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},pV={message:"Value unchanged",code:"ABORT_UNCHANGED"},_o={message:"Not found",code:"ERR_NOT_FOUND"},eA={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},PQ={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},hV={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},CQ={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},EQ={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},FF={message:"Existing stage",code:"ERR_EXISTING_STAGE"},fV={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},gD={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},MQ={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},tA={message:"Scores present",code:"ERR_SCORES_PRESENT"},RQ={ANACHRONISM:NF,CANNOT_CHANGE_WINNING_SIDE:nV,CANNOT_MODIFY_TIEFORMAT:iV,CANNOT_MODIFY_PARTICIPANT_TYPE:QJ,CANNOT_REMOVE_MAIN_STRUCTURE:DJ,CANNOT_REMOVE_PARTICIPANTS:KN,COURT_EXISTS:hQ,COURT_NOT_FOUND:fD,DRAW_DEFINITION_NOT_FOUND:ns,DRAW_ID_EXISTS:MJ,DRAW_POSITION_ACTIVE:GN,DRAW_POSITION_ASSIGNED:_I,DRAW_POSITION_NOT_CLEARED:EJ,DRAW_POSITION_NOT_FOUND:P0e,DRAW_SIZE_MISMATCH:z$,DUPLICATE_VALUE:UQ,ENTRY_STATUS_NOT_ALLOWED_FOR_EVENT:cQ,ENTRY_STATUS_NOT_ALLOWED_IN_STAGE:lQ,EVENT_EXISTS:BJ,EVENT_NOT_FOUND:rs,EXISTING_DRAW_DEFINITIONS:PJ,EXISTING_END_TIME:sV,EXISTING_FLIGHT:PQ,EXISTING_MATCHUP_ID:EQ,EXISTING_OUTCOME:CQ,EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT:Qw,EXISTING_PARTICIPANT:ZN,EXISTING_POLICY_TYPE:eV,EXISTING_PROFILE:hV,EXISTING_ROUND:LJ,EXISTING_STAGE:FF,EXISTING_STRUCTURE:fV,INCOMPATIBLE_MATCHUP_STATUS:IE,INCOMPLETE_SOURCE_STRUCTURE:V$,INSUFFICIENT_DRAW_POSITIONS:oV,INVALID_ACTION:_J,INVALID_ASSIGNMENT:_F,INVALID_BOOKINGS:gM,INVALID_CATEGORY:vM,INVALID_COLLECTION_DEFINITION:TQ,INVALID_CONFIGURATION:SQ,INVALID_DATE_AVAILABILITY:wE,INVALID_DATE:aa,INVALID_DRAW_DEFINITION:sv,INVALID_DRAW_POSITION_FOR_SEEDING:j$,INVALID_DRAW_POSITION:Kw,INVALID_DRAW_SIZE:zN,INVALID_END_TIME:mQ,INVALID_ENTRIES:VJ,INVALID_EVENT_TYPE:Hh,INVALID_GAME_SCORES:xF,INVALID_GENDER:SE,INVALID_MATCHUP_FORMAT:Z$,INVALID_MATCHUP_STATUS:kI,INVALID_MATCHUP_STATUS_BYE:GJ,INVALID_MATCHUP:Sa,INVALID_OBJECT:Lp,INVALID_PARTICIPANT_ID:bu,INVALID_PARTICIPANT_IDS:xl,INVALID_PARTICIPANT_ROLE:eQ,INVALID_PARTICIPANT_SEEDING:RJ,INVALID_PARTICIPANT_TYPE:_c,INVALID_PARTICIPANT:Jw,INVALID_POLICY_DEFINITION:qJ,INVALID_RECORDS:AF,INVALID_SCALE_ITEM:mD,INVALID_SEED_NUMBER:xJ,INVALID_SEED_POSITION:OJ,INVALID_SET_NUMBER:N0e,INVALID_SIDE_NUMBER:tV,INVALID_SCORE:JJ,INVALID_STAGE:ig,INVALID_START_TIME:vQ,INVALID_STRUCTURE:Iy,INVALID_STOP_TIME:gQ,INVALID_TIE_FORMAT:Yd,INVALID_TIME:Dl,INVALID_TIME_ITEM:lV,INVALID_TOURNAMENT_DATES:XJ,INVALID_TOURNAMENT_RECORD:lD,INVALID_VALUES:Pe,INVALID_WINNING_SIDE:YN,MATCHUP_NOT_FOUND:Ao,METHOD_NOT_FOUND:gD,MISSING_ASSIGNMENTS:Y$,MISSING_ASYNC_STATE_PROVIDER:yQ,MISSING_AVOIDANCE_POLICY:WJ,MISSING_COLLECTION_DEFINITION:zJ,MISSING_COURT_ID:wy,MISSING_COURTS_INFO:pQ,MISSING_DATE_AVAILABILITY:ZJ,MISSING_DATE:YJ,MISSING_DRAW_DEFINITION:lt,MISSING_DRAW_ID:Wc,MISSING_DRAW_POSITION:Zw,MISSING_DRAW_POSITIONS:cD,MISSING_DRAW_SIZE:uD,MISSING_ENTRIES:$J,MISSING_EVENT:Vi,MISSING_MATCHUP_FORMAT:X$,MISSING_MATCHUP_ID:To,MISSING_MATCHUP_IDS:Xw,MISSING_MATCHUP:Ba,MISSING_MATCHUPS:kd,MISSING_PARTICIPANT_COUNT:rQ,MISSING_PARTICIPANT_ID:Rr,MISSING_PARTICIPANT_IDS:yf,MISSING_PARTICIPANT_ROLE:tQ,MISSING_PARTICIPANT:Sy,MISSING_PARTICIPANTS:hD,MISSING_PENALTY_ID:aV,MISSING_PENALTY_TYPE:dQ,MISSING_PERSON_DETAILS:aQ,MISSING_POLICY_ATTRIBUTES:Q$,MISSING_POLICY_DEFINITION:WN,MISSING_POLICY_TYPE:J$,MISSING_POSITION_ASSIGNMENTS:HJ,MISSING_ROUND_NUMBER:C0e,MISSING_SCHEDULE:bQ,MISSING_SCORING_POLICY:R0e,MISSING_SEED_ASSIGNMENTS:kJ,MISSING_SEEDCOUNT_THRESHOLDS:AJ,MISSING_SEEDING_POLICY:E0e,MISSING_SET_NUMBER:A0e,MISSING_SET_OBJECT:qN,MISSING_SIDE_NUMBER:_0e,MISSING_STAGE:K$,MISSING_STRUCTURE_ID:_s,MISSING_STRUCTURE:vf,MISSING_STRUCTURES:q$,MISSING_TARGET_LINK:W$,MISSING_TIE_FORMAT:pD,MISSING_TIME_ITEM:cV,MISSING_TIME_ITEMS:uV,MISSING_TOURNAMENT_ID:AI,MISSING_TOURNAMENT_RECORD:Ge,MISSING_TOURNAMENT_RECORDS:On,MISSING_VALUE:gt,MISSING_VENUE_ID:bf,MODIFICATIONS_FAILED:IQ,NO_CANDIDATES:JN,NO_DRAW_POSITIONS_AVAILABLE_FOR_QUALIFIERS:uQ,NO_MODIFICATIONS_APPLIED:t0,NO_STAGE_SPACE_AVAILABLE_FOR_ENTRY_STATUS:LF,NO_PARTICIPANT_REMOVED:nQ,NO_VALID_ACTIONS:DQ,NO_VALID_ATTRIBUTES:QN,NO_VALID_DATES:KJ,NOT_FOUND:_o,NOT_IMPLEMENTED:eA,PARTICIPANT_COUNT_EXCEEDS_DRAW_SIZE:rV,PARTICIPANT_ID_EXISTS:iQ,PARTICIPANT_NOT_CHECKED_IN:oQ,PARTICIPANT_NOT_FOUND:Jn,PARTICIPANT_PAIR_EXISTS:x0e,PENALTY_NOT_FOUND:xI,POLICY_NOT_ATTACHED:M0e,POLICY_NOT_FOUND:lv,SCHEDULE_NOT_CLEARED:CJ,SCHEDULED_MATCHUPS:MQ,SCORES_PRESENT:tA,SEEDSCOUNT_GREATER_THAN_DRAW_SIZE:NJ,STAGE_SEQUENCE_LIMIT:jJ,STRUCTURE_NOT_FOUND:Nn,TEAM_NOT_FOUND:dV,UNABLE_TO_ASSIGN_COURT:wQ,UNLINKED_STRUCTURES:FJ,UNRECOGNIZED_DRAW_TYPE:H$,UNRECOGNIZED_MATCHUP_FORMAT:dD,UNRECOGNIZED_MATCHUP_STATUS:kF,VALUE_UNCHANGED:pV,VENUE_EXISTS:fQ},Tn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]},NQ={addNotice:Z0e,callListener:tSe,cycleMutationStatus:K0e,deleteNotice:Q0e,deleteNotices:J0e,disableNotifications:B0e,enableNotifications:$0e,getMethods:iA,getNotices:X0e,getTopics:eSe,getTournamentId:AQ,getTournamentRecord:V0e,getTournamentRecords:j0e,removeTournamentRecord:W0e,setMethods:Y0e,setSubscriptions:q0e,setTournamentId:G0e,setTournamentRecord:H0e,setTournamentRecords:z0e,handleCaughtError:iSe};function B0e(){Tn.disableNotifications=!0}function $0e(){Tn.disableNotifications=!1}function AQ(){return Tn.tournamentId}function V0e(t){return Tn.tournamentRecords[t]}function j0e(){return Tn.tournamentRecords}function H0e(t){let e=t==null?void 0:t.tournamentId;return e?(Tn.tournamentRecords[e]=t,{success:!0}):{error:lD}}function G0e(t){return t?Tn.tournamentRecords[t]?(Tn.tournamentId=t,{success:!0}):{error:Ge}:(Tn.tournamentId=void 0,{success:!0})}function z0e(t){Tn.tournamentRecords=t;let e=Object.keys(t);e.length===1?Tn.tournamentId=e[0]:e.length||(Tn.tournamentId=void 0)}function W0e(t){if(typeof t!="string")return{error:Pe};if(!Tn.tournamentRecords[t])return{error:_o};delete Tn.tournamentRecords[t];let e=Object.keys(Tn.tournamentRecords);return e.length===1?Tn.tournamentId=e[0]:e.length||(Tn.tournamentId=void 0),{success:!0}}function q0e(t){return typeof t.subscriptions!="object"?{error:Pe}:(Object.keys(t.subscriptions).forEach(e=>{Tn.subscriptions[e]=t.subscriptions[e]}),{...ae})}function Y0e(t){return typeof t!="object"?{error:Pe}:(Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(Tn.methods[e]=t[e])}),{...ae})}function K0e(){let t=Tn.modified;return Tn.modified=!1,t}function Z0e({topic:t,payload:e,key:i},n){if(!(typeof t!="string"||typeof e!="object")&&(Tn.disableNotifications||(Tn.modified=!0),!(Tn.disableNotifications||!Tn.subscriptions[t]&&!n)))return i&&(Tn.notices=Tn.notices.filter(r=>!(r.topic===t&&r.key===i))),Tn.notices.push({topic:t,payload:e,key:i}),{...ae}}function iA(){return Tn.methods??{}}function X0e({topic:t}){return Tn.notices.filter(e=>e.topic===t).map(e=>e.payload)}function J0e(){Tn.notices=[]}function Q0e({topic:t,key:e}){Tn.notices=Tn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)}function eSe(){return{topics:Object.keys(Tn.subscriptions)}}function tSe({topic:t,notices:e},i){let n=Tn.subscriptions[t];n&&typeof n=="function"&&n(e);let r=i==null?void 0:i[t];r&&typeof r=="function"&&r(e)}function iSe({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:AQ(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}function wr(t,e){return(t??0)-(e??0)}function Et(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function kc(t){return isNaN(t)?!1:t&&(t&t-1)===0}function i6(t){if(!t.length)return;let e=[...t].sort(wr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function nSe(t){if(!kc(t))return!1;let e=t,i=1;for(;e!==2;)i+=1,e=e/2;return i}function mV(t){return isNaN(t)?0:t%2&&t+1||t}function gV(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function Bn(t){return!isNaN(parseFloat(t))}function _Q(t){let e=Et(t);if(!isNaN(e))return e===0?!1:(e&-e)===1}function i0(t){if(isNaN(t))return!1;for(;!kc(t);)t++;return t}function $s(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function Bt(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function rSe(t=1,e=3,i=!0){let n=0;for(let r=0;r<e;r++)n+=Math.random()*(t/e);return i&&t>1?Math.round(n):n}function oSe(t,e){e||(e=1);let i=1/e;return Math.round(t*i)/i}function kQ(t,e,i,n,r=2){let o=1-Math.random(),a=1-Math.random(),s=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*a);return s=s/10+.5,s>1||s<0?s=kQ(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=oSe(s,n)),parseFloat(s.toFixed(r))}function Zt(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function aSe(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t}function Jo(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function OI(t){return Bt(t)?t:1/0}function os(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function sSe(t){return xQ(os(t))}function xQ(t){return Object.keys(t).reduce((e,i)=>{let n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function lSe(t,e,i){return i.indexOf(t)===e}function OQ(t){return t.filter(lSe)}function Qa(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Ja(t){let e=Math.floor(Math.random()*t.length);return t[e]}function it(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function uu(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function Hn(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n)}function n6(t,e){return!Array.isArray(t)||!Array.isArray(e)?[]:t.filter(i=>!e.includes(i))}function sa(t,e){return!Array.isArray(t)||!Array.isArray(e)?!1:t.some(i=>e.includes(i))}function cSe(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0}function uSe(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]}function Qr(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{let o=Math.floor(r/e);return i[o]=[].concat(i[o]||[],n),i},[]):[]}function LQ(t,[e,...i]){return t.length?[t.slice(0,e),...LQ(t.slice(e),[...i,e])]:[]}function dSe(t){return t.reduce((e,i)=>{let n=e[e.length-1];return(!n||n[n.length-1]!==i-1)&&e.push([]),e[e.length-1].push(i),e},[])}function FQ(t){return Array.isArray(t)?t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0):!1}function BQ(t){return Array.isArray(t)?t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0):!1}function BF(t,e,i){return Array.isArray(t)?t.reduce((n,r,o)=>{let a=i?!!(Math.floor(o/e)%2):!1,s=o%e,l=a?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}function pSe(t,e=1){if(!Array.isArray(t)||!t.every(Bt))return[];let i=Math.min(...t,e),n=Math.max(...t);return it(i,n+1).filter(r=>!t.includes(r))}var qi={timers:{default:{elapsedTime:0}},globalSubscriptions:{},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},globalMethods:[],deepCopy:!0},eo=NQ,r6=["addNotice","callListener","cycleMutationStatus","deleteNotice","deleteNotices","disableNotifications","enableNotifications","getMethods","getNotices","getTopics","getTournamentId","getTournamentRecord","getTournamentRecords","removeTournamentRecord","setSubscriptions","setTournamentId","setTournamentRecord","setTournamentRecords"];function hSe(t){if(typeof t!="object")throw new Error("Global state provider can not be undefined or null");if(Hn(Object.keys(t),r6).length!==r6.length)throw new Error("Global state provider is missing required methods");return eo=t,{success:!0}}function $Q(){if(eo.createInstanceState){try{eo.createInstanceState()}catch(t){return{error:t}}return{success:!0}}else return{error:yQ}}function rl(t){return!t||typeof t!="object"?qi.devContext??!1:typeof qi.devContext!="object"?!1:Object.keys(t).every(e=>{var i;return((i=qi.devContext)==null?void 0:i[e])===t[e]})&&qi.devContext}function fSe(t="reset",e="default"){var n,r;let i=Date.now();if(t==="report"){if(e==="allTimers")return Object.keys(qi.timers).filter(o=>o!=="default"||qi.timers[o].startTime).map(o=>{let a=qi.timers[o],s=a.state==="stopped"?0:(i-((a==null?void 0:a.startTime)??0))/1e3,l=a.elapsedTime+s;return{state:qi.timers[o].state,elapsedTime:l.toFixed(2),timer:o}});{let o=qi.timers[e].state==="stopped"?0:(i-(((n=qi.timers[e])==null?void 0:n.startTime)??0))/1e3,a=qi.timers[e].elapsedTime+o;return{state:qi.timers[e].state,elapsedTime:a.toFixed(2),timer:e}}}if(!qi.timers[e]||t==="reset"){if(e==="allTimers")return qi.timers={default:{elapsedTime:0}},!0;qi.timers[e]={startTime:i,state:"active",elapsedTime:0}}return qi.timers[e].elapsedTime||(qi.timers[e].elapsedTime=0),t==="stop"&&qi.timers[e].state!=="stopped"&&(qi.timers[e].state="stopped")&&(qi.timers[e].elapsedTime+=(i-(((r=qi.timers[e])==null?void 0:r.startTime)??0))/1e3),t==="start"&&(qi.timers[e].startTime=i)&&(qi.timers[e].state="active"),qi.timers[e]}function VQ(t){ya(t)?qi.globalLog=t:delete qi.globalLog}function MT(t){qi.devContext=t}function jQ(){eo.disableNotifications()}function TE(){eo.enableNotifications()}function RT(t,e){typeof t=="boolean"&&(qi.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(qi.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(qi.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(qi.deepCopyAttributes.stringify=e.stringify),e.threshold&&(qi.deepCopyAttributes.threshold=e.threshold))}function vV(){return{enabled:qi.deepCopy,...qi.deepCopyAttributes}}function mSe(t){return t!=null&&t.subscriptions?(Object.keys(t.subscriptions).forEach(e=>{qi.globalSubscriptions[e]=t.subscriptions[e]}),{...ae}):{error:gt,info:"missing subscriptions"}}function gSe(t){return t!=null&&t.subscriptions?eo.setSubscriptions({subscriptions:t.subscriptions}):{error:gt,info:"missing subscriptions"}}function HQ(t){return t?typeof t!="object"?{error:Pe}:(Object.keys(t).forEach(e=>{ya(t[e])&&(qi.globalMethods[e]=t[e])}),{...ae}):{error:gt,info:"missing method declarations"}}function GQ(t){return t?typeof t!="object"?{error:Pe}:eo.setMethods(t):{error:gt,info:"missing method declarations"}}function yV(){return eo.cycleMutationStatus()}function di(t){if(typeof(t==null?void 0:t.topic)!="string")return;let e=qi.globalSubscriptions[t.topic];return eo.addNotice(t,e)}function bV(){return{...qi.globalMethods,...eo.getMethods()}}function IV(t){return eo.getNotices(t)}function wV({key:t,topic:e}){return eo.deleteNotice({key:t,topic:e})}function Ty(){return eo.deleteNotices()}function pl(){return eo.getTopics()}async function NT(t){return eo.callListener(t,qi.globalSubscriptions)}function Uy(){return eo.getTournamentId()}function SV(t){return eo.getTournamentRecord(t)}function If(){return eo.getTournamentRecords()}function zQ(t){return eo.setTournamentRecord(t)}function nA(t){return eo.setTournamentRecords(t)}function AT(t){return eo.setTournamentId(t)}function WQ(t){return eo.removeTournamentRecord(t)}function $F(){return eo}function rA({engineName:t,methodName:e,params:i,err:n}){return(ya(eo.handleCaughtError)&&eo.handleCaughtError||NQ.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function qQ(t,e){if(qi.globalLog)try{qi.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),VQ()}else console.log(e,t)}function YQ(t,e,i,n){if(!ln(t))return{error:Pe};Bn||(i=1);let r=Array.isArray(e)?e:[],o={},a=(s,l=0)=>{Object.keys(s).forEach(c=>{ya(s[c])?o[c]=s[c]:ln(s[c])&&(e===!0||r!=null&&r.includes(c))&&(i===void 0||l<i)&&a(s[c],l+1)})};return a(t),n?HQ(o):GQ(o),{methods:o}}function vSe(t,e,i){return Object.keys(t).filter(n=>!e.includes(t[n])&&(!i||(Array.isArray(t[n])?t[n].length:!0)))}function wt(t,e,i,n){var a;if(typeof t!="object"||t===null)return t;(a=vV())!=null&&a.enabled||(n=!0);let r=["",void 0,null];e&&r.push(!1);let o=vSe(t,r,i);return Object.assign({},...o.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>wt(l))}:{[s]:n?t[s]:wt(t[s])}))}function se({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,wt(t)),e&&!(e!=null&&e.error)&&!(e!=null&&e.success)&&Object.assign(e,{...ae}),e??{success:!0}}var ko="tournamentRecords",TV="policyDefinitions",xd="tournamentRecord",qc="drawDefinition",UV="matchUpFormat",hd="participantId",KQ="scheduleDates",ySe="tournamentId",bSe="scheduleDate",DV="structureId",PV="participant",vD="matchUpIds",ISe="policyType",ZQ="structures",ng="matchUpId",CV="inContext",EV="structure",oA="courtIds",wSe="personId",aA="venueIds",XQ="matchUps",JQ="courtId",QQ="eventId",wf="matchUp",eee="drawId",cv="error",n0="event",yD="param",SSe="uuids",TSe="averageMatchUpMinutes",USe="recoveryMinutes",DSe="periodLength",PSe="number",Gd="object",Xa="array",yc="_validate",tee="_message",fd="_invalid",Sf="_ofType",MV="_anyOf",_T="_oneOf",CSe={[ko]:On,[xd]:Ge,[TV]:WN,[qc]:lt,[hd]:Rr,[UV]:X$,[ySe]:AI,[DV]:_s,[vD]:Xw,[PV]:Sy,[ZQ]:q$,[ng]:To,[EV]:vf,[JQ]:wy,[XQ]:kd,[QQ]:rs,[wf]:Ba,[oA]:gt,[aA]:gt,[eee]:Wc,[n0]:Vi},ESe={[ko]:Gd,[TV]:Gd,[xd]:Gd,[qc]:Gd,[KQ]:Xa,[PV]:Gd,[vD]:Xa,[ZQ]:Xa,[EV]:Gd,[oA]:Xa,[aA]:Xa,[XQ]:Xa,[wf]:Gd,[n0]:Gd,[SSe]:Xa};function Ei(t,e,i){if(!t&&!ln(t))return{error:Pe};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Pe};let{paramError:n,errorParam:r}=NSe(t,e);if(!n)return{valid:!0};let o=(t==null?void 0:t[r])===void 0?CSe[r]||Pe:n[yc]&&n[fd]||Pe,a=r??(n[_T]&&Object.keys(n[_T]).join(", "));return se({info:{param:a,message:n[tee]},result:{error:o},stack:i})}function iee(t,e){let i=Object.keys(t),n=Object.keys(e);return Hn(i,n)}function MSe(t,e){if(!e)return;let i=iee(t,e);return i.length!==1?{error:Pe}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function RSe(t,e){if(!e)return;let i=iee(t,e).filter(n=>t[n]);return i.length<1?{error:Pe}:i.reduce((n,r)=>({...n,[r]:!0}),{})}function NSe(t,e){let i,n;return{paramError:e.find(({_ofType:r,_oneOf:o,_anyOf:a,_validate:s,_info:l,...c})=>{let u=o&&MSe(t,o);if(u!=null&&u.error)return u.error;u&&Object.assign(c,u);let d=a&&RSe(t,a);if(d!=null&&d.error)return d.error;d&&Object.assign(c,d);let p=Object.keys(c).filter(f=>typeof c[f]=="boolean"),h=p.find(f=>{let m=s&&!ya(s),g=t[f]&&!s&&ASe(t,f,r),v=c[f]&&!t[f],y=m||g||v||s&&t[f]&&!_Se(t[f],s);return y&&(i=f,n=l),y});return!p.length||h}),errorParam:i,paramInfo:n}}function ASe(t,e,i){return i=i||ESe[e]||"string",i==="array"?!Array.isArray(t[e]):typeof t[e]!==i}function _Se(t,e){return ya(e)?e(t):!0}var nee="DYNAMIC",Gh="RANKING",fm="RATING",_v="SCALE",rd="SEEDING",r0={RANKING:Gh,RATING:fm,SCALE:_v,SEEDING:rd};function o0(t){var r;let e=Ei(t,[{[PV]:!0}]);if(e.error)return e;let i=(r=t.participant.timeItems)==null?void 0:r.filter(({itemType:o})=>(o==null?void 0:o.startsWith(_v))&&[Gh,fm,rd].includes(o.split(".")[1])),n={ratings:{},rankings:{},seedings:{}};if(i!=null&&i.length){let o=s=>i.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),a=Zt(i.map(({itemType:s})=>s));for(let s of a){let l=o(s);if(l){let[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=c===rd&&"seedings"||c===Gh&&"rankings"||"ratings";n[f][u]||(n[f][u]=[]),n[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...ae,...n}}function kv(t){if(t===null)return{};let{source:e,template:i}=t||{};if(!i)return e;let n={};return r(e,i,n),n;function r(o,a,s){if(!o||!a)return;let l=Object.keys(o),c=Object.keys(a),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(let h of l)if(d.indexOf(h)>=0||p){let f=u[h]||h,m=a[f]||p,g=o[h];if(typeof m=="object"&&typeof g!="function"&&!Array.isArray(m))if(Array.isArray(g)){let v=g.map(y=>{let b={};return r(y,m,b)!==!1?b:void 0}).filter(Boolean);s[h]=v}else g&&(s[h]={},r(g,m,s[h]));else{let v=o[h];if(Array.isArray(m)&&!m.includes(v))return!1;(a[h]||p&&a[h]!==!1)&&(s[h]=v)}}}}var yM=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,ree=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,md=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,cm=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function bM(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=Wt(t.scheduledTime)),!e)return;let i=hn(t.scheduledTime),n=Wt(e);return n&&i&&(n+=`T${i}`),n}function kSe(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function a0(t){let e=typeof t=="string"?t==null?void 0:t.split(" "):[];return t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase())?!1:!!(!t||cm.test(Dy(t,!0,!0)))}function ws(t){return Um(t)||yM.test(t)}function xSe(t){let e=new Date(t),i=e.getSeconds()+60*e.getMinutes()+60*60*e.getHours();return OSe(i,{displaySeconds:!1})}function OSe(t,e){let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),o=i-n*3600-r*60;return(!e||e!=null&&e.displaySeconds?n+":"+r+":"+o:n+":"+r).split(":").map(qs).join(":")}var RV=t=>{let e=kT(t)||Um(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${qs(n)}-${qs(e.getUTCDate())}`};function LSe(t){let e=kT(t)||Um(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())}function Dc(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t=t+"T00:00");let n=new Date(t),r=""+(n.getMonth()+1),o=""+n.getDate(),a=n.getFullYear();return r.length<2&&(r="0"+r),o.length<2&&(o="0"+o),i==="DMY"?[o,r,a].join(e):i==="MDY"?[r,o,a].join(e):i==="YDM"?[a,o,r].join(e):i==="DYM"?[o,a,r].join(e):i==="MYD"?[r,a,o].join(e):[a,r,o].join(e)}function IM(t){let e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-i*60*1e3)}function FSe(t){return IM(t).getTime()}function kT(t){if(typeof t=="boolean")return!1;let e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function LI(t,e){if(!ws(t)||!ws(e))return[];let i=Wt(t)+"T00:00",n=Wt(e)+"T00:00",r=new Date(i),o=new Date(n),a=kT(o)&&kT(r)&&c(r,o),s=[],l=0;if(a){let u=r,d=u.getTime();for(;d<=o.getTime()&&l<300;)l+=1,s.push(new Date(u)),d=u.setDate(u.getDate()+1)}return s.map(u=>Dc(u));function c(u,d){return u<=d}}var BSe=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Um(t){return typeof t!="string"?!1:BSe.test(t)}function NV(t){if(typeof t!="string")return!1;let e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function mi(t){let e=hn(t);if(!e)return 0;let[i,n]=e.split(":").map(r=>parseInt(r));return i*60+n}function $Se(t){let e=Math.floor(t/60),i=t-e*60;return e>23&&(e=e%24),[qs(e),qs(i)].join(":")}function wM(t){return NV(t)?t.split(":").slice(0,2).map(qs).join(":"):void 0}function hn(t){return Um(t)&&t.indexOf("T")>0?wM(t.split("T").reverse()[0]):wM(t)}function Wt(t){return Um(t)||md.test(t)?t.split("T")[0]:void 0}function kS(t,e){let i=new Date(t);return i.setDate(i.getDate()+e),Wt(i.toISOString())}function SM(t){t=typeof t!="string"?"00:00":t;let e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function VSe(t){let e=SM(t);return e.ampm&&e.hours&&(e.ampm.toLowerCase()==="pm"&&parseInt(e.hours)<12&&(e.hours=(e.hours&&parseInt(e.hours)||0)+12),e.ampm.toLowerCase()==="am"&&e.hours==="12"&&(e.hours="00")),`${e.hours||"12"}:${e.minutes||"00"}`.split(":").map(qs).join(":")}function jSe(t){var i;let e=SM(t);if(!(typeof e=="object"&&!Object.keys(e).length))return e.ampm?t:(e.hours>12?(e.hours-=12,e.ampm="PM"):e.hours==="12"?e.ampm="PM":(e.hours==="00"&&(e.hours="12"),e.ampm="AM"),((i=e.hours)==null?void 0:i[0])==="0"&&(e.hours=e.hours.slice(1)),`${e.hours||"12"}:${e.minutes||"00"} ${e.ampm}`)}function Dy(t,e,i){let n=Wt(t),r=hn(t),o=n?r:t;return t?e&&(n&&i&&t||VSe(o))||jSe(o):void 0}function oee(t,e){let i=SM(t),n=SM(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function aee(t,e=7){let i=Wt(t)+"T00:00",n=new Date(i),r=new Date(n.setDate(n.getDate()+e));return Dc(r)}function HSe(t){return aee(t)}function GSe(t,e,i,n=!1){let r=new Date(e,0,1+(t-1)*7),o=n?0:1;return r.setDate(r.getDate()+(o-r.getDay())),Dc(r,i)}function zSe(t,e,i){let n=new Date(t,0);return Dc(new Date(n.setDate(e)),i)}function pr(t,e=void 0){let[i,n]=(t||"00:00").split(":").map(qs),r=IM(e).setHours(i,n,0,0);return IM(r)}function bD(t,e,i=!0){let n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function xa(t,e){let i=hn(t);if(!i)return"00:00";let n=isNaN(e)?0:e;return hn(AV(pr(i),n).toISOString())}function AV(t,e){let i=new Date(t);return new Date(i.getTime()+e*6e4)}function qs(t){return t.toString()[1]?t:"0"+t}function gd(t,e){let i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}var WSe={addDays:aee,addWeek:HSe,addMinutesToTimeString:xa,convertTime:Dy,getIsoDateString:bM,getUTCdateString:RV,DateHHMM:xSe,extractDate:Wt,extractTime:hn,formatDate:Dc,getDateByWeek:GSe,isISODateString:Um,isDate:kT,isTimeString:NV,offsetDate:IM,offsetTime:FSe,sameDay:gd,timeStringMinutes:mi,timeToDate:pr,timeUTC:LSe,validTimeValue:a0,validDateString:yM,timeValidation:cm,dateValidation:md};function dt(t,e,i,n,r=0){if($F().makeDeepCopy)return $F().makeDeepCopy(t,e,i,n);let o=vV(),{stringify:a,toJSON:s,ignore:l,modulate:c}=o||{};if(!(o!=null&&o.enabled)&&!i||typeof t!="object"||ya(t)||t===null||typeof(o==null?void 0:o.threshold)=="number"&&r>=o.threshold)return t;let u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||ya(l)&&!l(h)),p=(h,f)=>{u[h]=ya(f==null?void 0:f.toString)?f.toString():JSON.stringify(f)};for(let h of d){let f=t[h],m=ya(c)?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){let g=_V(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(a)&&a.includes(h)?p(h,f):Array.isArray(s)&&s.includes(h)&&ya(f==null?void 0:f.toJSON)?u[h]=f.toJSON():f===null?u[h]=void 0:kSe(f)?u[h]=new Date(f).toISOString():u[h]=dt(f,e,i,n,r+1)}return u}function _V(t){return t==null?void 0:t.map(e=>{let{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}var VF="voluntaryConsolation",Jd="competitiveBands",kV="roundRobinTally",hp="positionActions",Zr="matchUpActions",UE="rankingPoints",FI="roundNaming",s0="participant",xT="progression",Tf="scheduling",OT="avoidance",qSe="display",vd="scoring",Ml="seeding",BI="feedIn",YSe="audit",TM="draws",rg={POLICY_TYPE_VOLUNTARY_CONSOLATION:VF,POLICY_TYPE_COMPETITIVE_BANDS:Jd,POLICY_TYPE_ROUND_ROBIN_TALLY:kV,POLICY_TYPE_POSITION_ACTIONS:hp,POLICY_TYPE_MATCHUP_ACTIONS:Zr,POLICY_TYPE_RANKING_POINTS:UE,POLICY_TYPE_ROUND_NAMING:FI,POLICY_TYPE_PARTICIPANT:s0,POLICY_TYPE_PROGRESSION:xT,POLICY_TYPE_SCHEDULING:Tf,POLICY_TYPE_AVOIDANCE:OT,POLICY_TYPE_DISPLAY:qSe,POLICY_TYPE_FEED_IN:BI,POLICY_TYPE_SCORING:vd,POLICY_TYPE_SEEDING:Ml,POLICY_TYPE_AUDIT:YSe,POLICY_TYPE_DRAWS:TM};function zh({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:o}){let a=t.find(l=>n&&l.participantId===n||o&&l.person&&l.person.personId===o),s=dt(a,!1,r);if(s){let l=e==null?void 0:e[s0];if(i!=null&&i.withScaleValues){let{ratings:c,rankings:u}=o0({participant:s});s.rankings=u,s.ratings=c}if(l!=null&&l.participant)return kv({template:l.participant,source:s})}return s}var xV="element required",KSe="missing name";function ta(t){if(!t||typeof t!="object")return{error:gt};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Pe};if(!(t!=null&&t.name))return{error:gt,info:KSe};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(let e of Object.keys(t.tournamentRecords)){let i=t.tournamentRecords[e],n=ta({element:i,name:t.name});if(n.error)return se({result:n,stack:"removeExtension"})}return{...ae}}return{error:gt,info:xV}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...ae}):{...ae,info:_o}}function Iu({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;let i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function Ui(t){if(typeof t!="object")return{error:gt};let e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return se({result:{error:Pe},stack:e});if(!Iu({extension:t.extension}))return se({result:{error:Pe,info:"invalid extension"},stack:e});if(!t.element)if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(let n of Object.values(t.tournamentRecords)){let r=Ui({extension:t.extension,element:n});if(r.error)return se({result:r,stack:e})}return{...ae}}else return se({result:{error:gt},stack:e});if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){let n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}let i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...ae}}function OV(t){return!t||typeof t!="object"?{error:gt}:t.tournamentRecord?Ui({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:Ge}}function sA(t){return!t||typeof t!="object"?{error:gt}:t.drawDefinition?Ui({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:ns}}function Uf(t){return!t||typeof t!="object"?{error:gt}:t.event?Ui({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:rs}}function see(t){var n;if(!t||typeof t!="object")return{error:gt};if(!t.participantId)return{error:Rr};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=zh({participantId:t.participantId,tournamentParticipants:e});return i?Ui({creationTime:t.creationTime,extension:t.extension,element:i}):{error:Jn}}function LV(t){return!t||typeof t!="object"?{error:gt}:t.tournamentRecord?ta({element:t.tournamentRecord,name:t.name}):{error:Ge}}function lee(t){return!t||typeof t!="object"?{error:gt}:t.drawDefinition?ta({element:t.drawDefinition,name:t.name}):{error:ns}}function lA(t){return!t||typeof t!="object"?{error:gt}:t!=null&&t.event?ta({element:t.event,name:t.name}):{error:rs}}function cee(t){var n;if(!t||typeof t!="object")return{error:gt};if(!t.participantId)return{error:Rr};let e=((n=t.tournamentRecord)==null?void 0:n.participants)||[],i=zh({participantId:t.participantId,tournamentParticipants:e});return i?ta({element:i,name:t.name}):{error:Jn}}function ID({tournamentRecords:t}){return{tournamentIds:ln(t)?Object.keys(t):[],...ae}}var ZSe="extensionQueries";function Qt({discover:t,element:e,name:i,...n}){var o;if(!e||!i){if(t&&n){let a=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return Array.isArray((u=n[c])==null?void 0:u.extensions)?n[c].extensions.find(d=>(d==null?void 0:d.name)===i):!1}),s=a&&n[a];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));let l=(o=s==null?void 0:s.extensions)==null?void 0:o.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:_o}}return se({result:{error:gt},stack:ZSe})}if(!Array.isArray(e.extensions))return{info:"no extensions"};let r=e.extensions.find(a=>(a==null?void 0:a.name)===i);return{extension:r,info:r?void 0:_o}}var XSe="activeSuspension",LT="appliedPolicies",UM="positionActions",uee="context",cA="delegatedOutcome",Pc="disabled",uA="disableLinks",$I="disableAutoCalc",DM="drawDeletions",JSe="drawProfile",PM="entryProfile",QSe="eventProfile",eTe="eventWithdrawalRequests",tTe="factory",Vl="flightProfile",jF="groupingAttribute",fp="lineUps",xv="linkedTournamentsIds",dA="matchUpHistory",FV="participantRepresentatives",l0="personRequests",iTe="rankingPoints",xu="roundTarget",wD="scheduleLimits",mp="scheduleTiming",Ov="schedulingProfile",nTe="statusDetail",VI="subOrder",Wh="tally",Lv="tieFormatModification",BV={ACTIVE_SUSPENSION:XSe,APPLIED_POLICIES:LT,AUDIT_POSITION_ACTIONS:UM,CONTEXT:uee,DELEGATED_OUTCOME:cA,DISABLED:Pc,DISABLE_LINKS:uA,DISABLE_AUTO_CALC:$I,DRAW_DELETIONS:DM,DRAW_PROFILE:JSe,ENTRY_PROFILE:PM,EVENT_PROFILE:QSe,EVENT_WITHDRAWAL_REQUESTS:eTe,FLIGHT_PROFILE:Vl,GROUPING_ATTRIBUTE:jF,LINEUPS:fp,LINKED_TOURNAMENTS:xv,MATCHUP_HISTORY:dA,PARTICIPANT_REPRESENTATIVES:FV,PERSON_REQUESTS:l0,RANKING_POINTS:iTe,ROUND_TARGET:xu,SCHEDULE_LIMITS:wD,SCHEDULE_TIMING:mp,SCHEDULING_PROFILE:Ov,STATUS_DETAIL:nTe,SUB_ORDER:VI,TALLY:Wh,TIE_FORMAT_MODIFICATIONS:Lv,FACTORY:tTe},o6=[cA,Pc,uA,Vl,fp,dA,FV,l0,xu,wD,mp,Ov,VI,Wh];function dee({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:On};let e=ID({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Ui({tournamentRecords:t,discover:!0,extension:{name:xv,value:{tournamentIds:i}}}):{...ae}}function pee({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:On};let e=ta({name:xv,tournamentRecords:t,discover:!0});return se({result:e,stack:"unlinkTournaments"})}function hee({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Pe};if(!e)return{error:AI};let i=ID({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:AI};let r;return n.every(o=>{var d;let a=t[o],{extension:s}=Qt({element:a,name:xv});if(!s)return!0;let l=((d=s==null?void 0:s.value)==null?void 0:d.tournamentIds)||[];if(!(l!=null&&l.length)||l.length===1&&l.includes(e)||o===e){let p=LV({name:xv,tournamentRecord:a});return p.error&&(r=p.error),p.success}let c=l.filter(p=>p!==e);s.value={tournamentIds:c};let u=OV({tournamentRecord:a,extension:s});return u.error&&(r=u.error),u.success}),r?{error:r}:{...ae}}var fee={};ii(fee,{getLinkedTournamentIds:()=>SD,getTournamentIds:()=>ID});function SD({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:On}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var a;let i=t[e],n=i==null?void 0:i.tournamentId,{extension:r}=Qt({element:i,name:xv}),o=(((a=r==null?void 0:r.value)==null?void 0:a.tournamentIds)||[]).filter(s=>s!==n);return{[e]:o}}))}}var $V={};ii($V,{addAdHocMatchUps:()=>HA,addDrawDefinitionTimeItem:()=>Jj,addFinishingRounds:()=>CD,addGoesTo:()=>Am,addPlayoffStructures:()=>jA,addQualifyingStructure:()=>pie,addVoluntaryConsolationStage:()=>uie,addVoluntaryConsolationStructure:()=>Bj,allPlayoffPositionsFilled:()=>Kj,alternateDrawPositionAssignment:()=>zte,assignDrawPosition:()=>Bie,assignDrawPositionBye:()=>xs,attachConsolationStructures:()=>xie,attachPlayoffStructures:()=>lH,attachQualifyingStructure:()=>Xj,attachStructures:()=>VA,autoSeeding:()=>pEe,automatedPlayoffPositioning:()=>JD,automatedPositioning:()=>XD,checkValidEntries:()=>qA,deleteAdHocMatchUps:()=>Vie,drawMatic:()=>OH,findDrawDefinition:()=>hH,generateAdHocMatchUps:()=>YA,generateAdHocRounds:()=>xH,generateAndPopulatePlayoffStructures:()=>sH,generateDrawDefinition:()=>m_,generateDrawMaticRound:()=>PH,generateDrawStructuresAndLinks:()=>TH,generateDrawTypeAndModifyDrawDefinition:()=>UH,generateQualifyingStructure:()=>eH,generateVoluntaryConsolation:()=>gne,getAssignedParticipantIds:()=>fg,getAvailableMatchUpsCount:()=>GA,getAvailablePlayoffProfiles:()=>eP,getDrawDefinitionTimeItem:()=>Rj,getDrawParticipantRepresentativeIds:()=>dH,getDrawTypeCoercion:()=>cP,getEligibleVoluntaryConsolationParticipants:()=>uH,getMatchUpsMap:()=>Uo,getParticipantIdFinishingPositions:()=>pH,getPositionAssignments:()=>ZT,getPositionsPlayedOff:()=>w0,getSeedingThresholds:()=>Hj,getSeedsCount:()=>uP,getStructureSeedAssignments:()=>ol,getTeamLineUp:()=>Nm,getValidGroupSizes:()=>KD,isAdHoc:()=>ss,isCompletedStructure:()=>Xh,isValidForQualifying:()=>SH,luckyLoserDrawPositionAssignment:()=>Gte,modifyDrawDefinition:()=>Oie,modifyDrawName:()=>cH,modifySeedAssignment:()=>eie,mutate:()=>mee,positionActions:()=>wH,pruneDrawDefinition:()=>Fie,qualifierDrawPositionAssignment:()=>Xte,query:()=>Gie,removeDrawPositionAssignment:()=>qT,removeRoundMatchUps:()=>jie,removeSeededParticipant:()=>die,removeStructure:()=>lie,renameStructures:()=>sie,resetDrawDefinition:()=>Lie,resetVoluntaryConsolationStructure:()=>_ee,setDrawParticipantRepresentativeIds:()=>gee,setPositionAssignments:()=>Kte,setStructureOrder:()=>oie,setSubOrder:()=>Hie,shiftAdHocRounds:()=>Yte,swapAdHocRounds:()=>Zte,swapDrawPositionAssignments:()=>Qte,updateTeamLineUp:()=>Ly,withdrawParticipantAtDrawPosition:()=>Ote});var mee={};ii(mee,{addAdHocMatchUps:()=>HA,addDrawDefinitionTimeItem:()=>Jj,addPlayoffStructures:()=>jA,addQualifyingStructure:()=>pie,addVoluntaryConsolationStage:()=>uie,addVoluntaryConsolationStructure:()=>Bj,alternateDrawPositionAssignment:()=>zte,assignDrawPosition:()=>Bie,assignDrawPositionBye:()=>xs,attachConsolationStructures:()=>xie,attachPlayoffStructures:()=>lH,attachQualifyingStructure:()=>Xj,attachStructures:()=>VA,automatedPlayoffPositioning:()=>JD,automatedPositioning:()=>XD,deleteAdHocMatchUps:()=>Vie,luckyLoserDrawPositionAssignment:()=>Gte,modifyDrawDefinition:()=>Oie,modifyDrawName:()=>cH,modifySeedAssignment:()=>eie,pruneDrawDefinition:()=>Fie,qualifierDrawPositionAssignment:()=>Xte,removeDrawPositionAssignment:()=>qT,removeRoundMatchUps:()=>jie,removeSeededParticipant:()=>die,removeStructure:()=>lie,renameStructures:()=>sie,resetDrawDefinition:()=>Lie,resetVoluntaryConsolationStructure:()=>_ee,setDrawParticipantRepresentativeIds:()=>gee,setPositionAssignments:()=>Kte,setStructureOrder:()=>oie,setSubOrder:()=>Hie,shiftAdHocRounds:()=>Yte,swapAdHocRounds:()=>Zte,swapDrawPositionAssignments:()=>Qte,updateTeamLineUp:()=>Ly,withdrawParticipantAtDrawPosition:()=>Ote});var VV=t=>e=>t[e],jV=(t=[])=>t.map(Br).filter(Boolean),HF=(t=[])=>t.map(ai).filter(Boolean),ai=(t={})=>VV(t)("participantId"),Br=(t={})=>VV(t)("matchUpId"),FT=(t={})=>VV(t)("drawId");function gee({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:ns};if(!Array.isArray(t))return{error:Pe};let i=HF((e==null?void 0:e.entries)||[]);return t.length&&Hn(t,i).length<t.length?{error:Pe}:sA({drawDefinition:e,extension:{name:FV,value:t}})}var Us="ABANDONED",Py="AWAITING_RESULT",Ni="BYE",Fp="CANCELLED",or="COMPLETED",c0="DEAD_RUBBER",Pi="DEFAULTED",Er="DOUBLE_DEFAULT",mr="DOUBLE_WALKOVER",Jl="IN_PROGRESS",wu="INCOMPLETE",HV="NOT_PLAYED",Go="RETIRED",Df="SUSPENDED",Gn="TO_BE_PLAYED",Oi="WALKOVER",vee=[Py,or,Pi,Jl,wu,Go,Df],GV=[Py,or,Pi,mr,Er,Jl,wu,Go,Df,Oi],zV=[Us,Py,Ni,Fp,or,c0,Pi,mr,Er,Jl,wu,HV,Go,Df,Gn,Oi],WV=[Ni,mr,Er,or,Pi,Go,Oi],qV=[Us,Py,Fp,c0,Jl,wu,HV,Df,Gn,void 0],Nr=[Fp,Us,or,c0,Pi,mr,Er,Go,Oi],pA=[Us,or,Pi,mr,Er,Jl,Go,Oi],YV=[Jl,wu,Df,Gn],KV={ABANDONED:Us,AWAITING_RESULT:Py,BYE:Ni,CANCELLED:Fp,COMPLETED:or,DEAD_RUBBER:c0,DEFAULTED:Pi,DOUBLE_WALKOVER:mr,DOUBLE_DEFAULT:Er,IN_PROGRESS:Jl,INCOMPLETE:wu,NOT_PLAYED:HV,RETIRED:Go,SUSPENDED:Df,TO_BE_PLAYED:Gn,WALKOVER:Oi},ut="MAIN",Tt="QUALIFYING",Io="CONSOLATION",Xr="VOLUNTARY_CONSOLATION",$n="PLAY_OFF",ZV=[ut,Tt,Io,$n,Xr],Fv={[Tt]:1,[ut]:2,[$n]:3,[Io]:3,[Xr]:4},yee="finishingPositions",bee="aggregateEventStructures",Iee={[ut]:1,[$n]:2,[Io]:3,[Tt]:4,[Xr]:5},rTe={[$n]:1,[ut]:2,[Io]:3,[Tt]:4,[Xr]:5},hA="CLUSTER",oTe="SEPARATE",Dm="WATERFALL",fA="ITEM",fa="CONTAINER",Rl="DRAW",mA="RANDOM",Nl="TOP_DOWN",Pm="BOTTOM_UP",gp="POSITION",vp="WINNER",yd="LOSER",bd="FIRST_MATCHUP",jl="AD_HOC",aTe="AD_HOC",u0="FEED_IN",jI="COMPASS",HI="OLYMPIC",sTe="SINGLE_ELIMINATION",du="SINGLE_ELIMINATION",TD="DOUBLE_ELIMINATION",GI="FIRST_MATCH_LOSER_CONSOLATION",UD="FIRST_ROUND_LOSER_CONSOLATION",og="LUCKY_DRAW",gA="CURTIS_CONSOLATION",lTe="CURTIS_CONSOLATION",XV="FEED_IN_CHAMPIONSHIP_TO_SF",BT="FEED_IN_CHAMPIONSHIP_TO_SF",JV="FEED_IN_CHAMPIONSHIP_TO_QF",$T="FEED_IN_CHAMPIONSHIP_TO_QF",QV="FEED_IN_CHAMPIONSHIP_TO_R16",VT="FEED_IN_CHAMPIONSHIP_TO_R16",wee="MODIFIED_FEED_IN_CHAMPIONSHIP",jT="MODIFIED_FEED_IN_CHAMPIONSHIP",DD="FEED_IN_CHAMPIONSHIP",Hl="ROUND_ROBIN",Id="ROUND_ROBIN_WITH_PLAYOFF",See="DECIDER",Tee="BACKDRAW",ej={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},tj={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},d0="WIN_RATIO",Cy="ROUND_OUTCOME",Uee=[jI,gA,$T,VT,BT,DD,JV,QV,XV,GI,UD,og,jT,HI,$n,Id],cTe=[jl,jI,gA,TD,$T,VT,BT,DD,u0,GI,UD,og,jT,HI,$n,Hl,Id,du],yr={MAIN:ut,QUALIFYING:Tt,CONSOLATION:Io,ITEM:fA,CONTAINER:fa,FIRST_MATCHUP:bd,WINNER:vp,LOSER:yd,AD_HOC:jl,FEED_IN:u0,FLEX_ROUNDS:aTe,COMPASS:jI,PLAY_OFF:$n,OLYMPIC:HI,KNOCKOUT:sTe,SINGLE_ELIMINATION:du,DOUBLE_ELIMINATION:TD,CURTIS:gA,FICSF:XV,FICQF:JV,FICR16:QV,MFIC:wee,VOLUNTARY_CONSOLATION:Xr,FIRST_MATCH_LOSER_CONSOLATION:GI,FIRST_ROUND_LOSER_CONSOLATION:UD,MODIFIED_FEED_IN_CHAMPIONSHIP:jT,FEED_IN_CHAMPIONSHIP_TO_R16:VT,FEED_IN_CHAMPIONSHIP_TO_QF:$T,FEED_IN_CHAMPIONSHIP_TO_SF:BT,FEED_IN_CHAMPIONSHIP:DD,LUCKY_DRAW:og,ROUND_ROBIN_WITH_PLAYOFF:Id,ROUND_ROBIN:Hl,DECIDER:See,BACKDRAW:Tee,COMPASS_ATTRIBUTES:ej,OLYMPIC_ATTRIBUTES:tj,DRAW:Rl,RANDOM:mA,TOP_DOWN:Nl,BOTTOM_UP:Pm,WATERFALL:Dm,WIN_RATIO:d0,ROUND_OUTCOME:Cy,MULTI_STRUCTURE_DRAWS:Uee,generatedDrawTypes:cTe,stageOrder:Fv,finishOrder:Iee,AGGREGATE_EVENT_STRUCTURES:bee,FINISHING_POSITIONS:yee},uTe=yr;function Ey(t,e,i){var d,p;let n=h=>{var f,m;return(m=(f=Qt({element:h,name:xu}))==null?void 0:f.extension)==null?void 0:m.value},r=i==null?void 0:i.deprioritizeCompleted,o=(i==null?void 0:i.mode)===bee&&rTe,a=(i==null?void 0:i.mode)===yee&&Iee,s=a||o||Fv,l=h=>(h==null?void 0:h.stage)===ut&&(h==null?void 0:h.stageSequence)===1,c=h=>l(h)?-1:s[h==null?void 0:h.stage],u=h=>h==null?void 0:h.matchUps.every(({matchUpStatus:f})=>Nr.includes(f)?1:-1);return r&&u(t)-u(e)||o&&c(t)-c(e)||((t==null?void 0:t.stage)&&s[t.stage]||0)-((e==null?void 0:e.stage)&&s[e.stage]||0)||(n(t)||0)-(n(e)||0)||!a&&!o&&(((d=e==null?void 0:e.positionAssignments)==null?void 0:d.length)??1/0)-(((p=t==null?void 0:t.positionAssignments)==null?void 0:p.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(CM(t)||0)-(CM(e)||0)}function CM(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var r;let n=(((r=i.finishingPositionRange)==null?void 0:r.winner)||[]).reduce((o,a)=>o+a,0);return!e||n<e?n:e},void 0)}function At(t){let e=Ei(t,[{[qc]:!0,[DV]:!0}]);if(e.error)return e;let{drawDefinition:i,structureId:n}=t,{structures:r}=wd({drawDefinition:i}),o=r==null?void 0:r.map(l=>l.structures?[...l.structures].concat(l):l).flat(),a=o==null?void 0:o.find(l=>l.structureId===n);if(!a)return{error:Nn};let s=a.structureType===fA?o==null?void 0:o.find(l=>{var c;return(c=l.structures)==null?void 0:c.some(u=>u.structureId===n)}):void 0;return{structure:a,containingStructure:s}}function wd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:o,stages:a,stage:s}){var f;let l=!e&&lt||!(e!=null&&e.structures)&&q$||void 0;if(l)return{error:l,structures:[],stageStructures:{}};let c=m=>{var v,y;let g=(y=(v=Qt({element:m,name:xu}))==null?void 0:v.extension)==null?void 0:y.value;return!r||r===g},u=((f=e==null?void 0:e.structures)==null?void 0:f.filter(p).filter(h).filter(c).sort((m,g)=>Ey(m,g,o)))??[],d=t?Object.assign({},...ZV.map(m=>{let g=u==null?void 0:u.filter(v=>v.stage===m);return(g==null?void 0:g.length)&&{[m]:g}}).filter(Boolean)):{};return{structures:u,stageStructures:d};function p(m){return!s&&!Array.isArray(a)||s&&m.stage===s||Array.isArray(a)&&a.includes(m.stage)}function h(m){return!n&&!Array.isArray(i)||n&&m.stageSequence===n||Array.isArray(i)&&i.includes(m.stageSequence)}}function Dee({drawDefinition:t}){if(!t)return{error:lt};let e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{let n=i.stage;e[n]||(e[n]=[]);let{positionAssignments:r}=Yi({structure:i}),o=(r==null?void 0:r.map(ai).filter(Boolean))??[];return e[n].push(...o),o}).flat(),stagePositionedParticipantIds:e}}function Yi({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:lt};if({structure:i,error:n}=At({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(o=>Yi({structure:o}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=HJ,{positionAssignments:r,error:n}}function jr({drawDefinition:t,structureId:e,structure:i}){var c;let n=((c=Yi({drawDefinition:t,structureId:e,structure:i}))==null?void 0:c.positionAssignments)||[],r=n==null?void 0:n.filter(u=>u.participantId??u.bye??u.qualifier),o=n&&(n==null?void 0:n.length)===(r==null?void 0:r.length),a=n==null?void 0:n.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),s=n==null?void 0:n.filter(u=>!u.participantId&&u.bye),l=n==null?void 0:n.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:o,positionAssignments:n,unassignedPositions:a,assignedPositions:r,qualifierPositions:l,byePositions:s}}var ij="addDrawDefinition",vA="addMatchUps",qh="addParticipants",nj="addScaleItems",rj="addVenue",zI="audit",oj="deleteParticipants",aj="deleteVenue",sj="deletedDrawIds",lj="deletedMatchUpIds",cj="modifyDrawDefinition",Pee="modifyDrawEntries",Cee="modifyEventEntries",uj="modifyMatchUp",wo="modifyParticipants",dj="modifyPositionAssignments",pj="modifySeedAssignments",Eee="modifyTournamentDetail",ag="modifyVenue",HT="mutations",GF="publishEvent",Mee="publishEventSeeding",Ree="publishOrderOfPlay",hj="unPublishEvent",fj="unPublishEventSeeding",mj="unPublishOrderOfPlay",yA="updateInContextMatchUp",Nee={ADD_DRAW_DEFINITION:ij,ADD_MATCHUPS:vA,ADD_PARTICIPANTS:qh,ADD_SCALE_ITEMS:nj,ADD_VENUE:rj,AUDIT:zI,DELETE_PARTICIPANTS:oj,DELETE_VENUE:aj,DELETED_DRAW_IDS:sj,DELETED_MATCHUP_IDS:lj,MODIFY_DRAW_DEFINITION:cj,MODIFY_DRAW_ENTRIES:Pee,MODIFY_EVENT_ENTRIES:Cee,MODIFY_MATCHUP:uj,MODIFY_PARTICIPANTS:wo,MODIFY_POSITION_ASSIGNMENTS:dj,MODIFY_SEED_ASSIGNMENTS:pj,MODIFY_TOURNAMENT_DETAIL:Eee,MODIFY_VENUE:ag,MUTATIONS:HT,PUBLISH_EVENT_SEEDING:Mee,PUBLISH_EVENT:GF,PUBLISH_ORDER_OF_PLAY:Ree,UNPUBLISH_EVENT_SEEDING:fj,UNPUBLISH_EVENT:hj,UNPUBLISH_ORDER_OF_PLAY:mj,UPDATE_INCONTEXT_MATCHUP:yA};function bA(t,e){var o;if(!t)return{error:lt};let i=Date.now();t.updatedAt&&i===new Date(t.updatedAt).getTime()&&(i+=1);let n=new Date(i).toISOString(),r=e==null?void 0:e.filter(Boolean);return t.updatedAt=n,(o=t.structures)==null||o.filter(Boolean).forEach(a=>{(!(r!=null&&r.length)||r!=null&&r.includes(a.structureId))&&(a.updatedAt=n)}),{...ae}}function Yh({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&bA(t),di({payload:{matchUps:i,tournamentId:e,eventId:n},topic:vA}),{...ae}}function Bp({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&bA(t),di({topic:lj,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(let o of i)wV({key:o});return{...ae}}function yi({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:o}){return o?(t&&cn({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),di({topic:uj,payload:{matchUp:o,tournamentId:e,context:n},key:o.matchUpId}),{...ae}):(console.log(Ba),{error:Ba})}function dTe({tournamentId:t,inContextMatchUp:e}){return e?(di({payload:{inContextMatchUp:e,tournamentId:t},topic:yA,key:e.matchUpId}),{...ae}):{error:Ba}}function PD({tournamentId:t,eventId:e,drawDefinition:i}){return i?(bA(i),di({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:ij,key:i.drawId}),{...ae}):(console.log(lt),{error:lt})}function pTe({tournamentId:t,eventId:e,drawId:i}){return di({payload:{drawId:i,tournamentId:t,eventId:e},topic:sj,key:i}),wV({key:i}),{...ae}}function cn({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(bA(t,i),di({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:cj,key:t.drawId}),{...ae}):{error:lt}}function Aee({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:lt};if(!i)return{error:vf};let r=i.seedAssignments,o=i.structureId,a=t.drawId;return di({payload:{tournamentId:e,eventId:n,drawId:a,structureId:o,seedAssignments:r},topic:pj,key:t.drawId}),cn({structureIds:[o],drawDefinition:t,tournamentId:e,eventId:n}),{...ae}}function Kh({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:lt};if(!i)return{error:vf};let r=Yi({structure:i}),o=i.structureId,a=t.drawId,s=n==null?void 0:n.eventId;return di({topic:dj,payload:{positionAssignments:r,tournamentId:e,structureId:o,eventId:s,drawId:a},key:o}),cn({structureIds:[o],drawDefinition:t,tournamentId:e,eventId:s}),{...ae}}function _ee({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var a,s;if(!e)return{error:lt};let r=(a=e.structures)==null?void 0:a.find(l=>l.stage===Xr);if(!r)return{error:Nn};let o=((s=r.matchUps)==null?void 0:s.map(({matchUpId:l})=>l))||[];return r.positionAssignments=[],r.seedAssignments=[],r.matchUps=[],Bp({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:o,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==Xr)),cn({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[r.structureId]}),{...ae}}function gj({drawPositions:t,structure:e}){var n;if([Tt,ut].includes(e.stage)&&e.stageSequence===1)return;let{positionAssignments:i}=Yi({structure:e});(n=i==null?void 0:i.filter(({drawPosition:r})=>t==null?void 0:t.includes(r)))==null||n.forEach(r=>{Ui({element:r,extension:{name:uA,value:!0}})})}function IA({drawDefinition:t,positionAction:e}){var o;let{extension:i}=Qt({name:UM,element:t}),n=Array.isArray(i==null?void 0:i.value)?(i==null?void 0:i.value)??[]:[];if(!(n!=null&&n.length)){let a=t.structures.find(s=>s.stage===ut);if(a){let s=(o=Yi({structure:a}).positionAssignments)==null?void 0:o.map(({drawPosition:l,participantId:c,bye:u,qualifier:d})=>({drawPosition:l,participantId:c,qualifier:d,bye:u}));n.push({name:"initialMainAssignments",initialAssignments:s})}}let r={name:UM,value:n.concat(e)};Ui({element:t,extension:r})}function p0({tournamentRecord:t,drawDefinition:e,event:i}){var s;let n=((s=(t==null?void 0:t.events)||i&&[i])==null?void 0:s.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],r={},o={},a=n.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(let l of a){let{structures:c,structureId:u}=l??{};c&&u&&(r[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>o[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:r,containerStructures:o}}var uv="SINGLES",kn="SINGLES",Cm="DOUBLES",an="DOUBLES",Su="TEAM",sn="TEAM",kee={SINGLES_MATCHUP:uv,SINGLES:kn,DOUBLES_MATCHUP:Cm,DOUBLES:an,TEAM_MATCHUP:Su,TEAM:sn};function wA(t){var o;let{sides:e,matchUpType:i}=t||{},n=(o=t.potentialParticipants)!=null&&o.length?t.potentialParticipants.flat().map(a=>i===an?(a==null?void 0:a.individualParticipantIds)||[]:a.participantId).flat():[],r=(e||[]).map(a=>{var s;return i===an&&(((s=a==null?void 0:a.participant)==null?void 0:s.individualParticipantIds)||[])||(a==null?void 0:a.participantId)&&[a.participantId]||[]}).flat();return{individualParticipantIds:r.concat(n).flat(),enteredIndividualParticipantIds:r,potentialIndividualParticipantIds:n}}function Ou(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}function SA(t){if(!ln(t))return!1;let{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(o=>Bt(o)||o===void 0||o===null);return n&&r}function hl(t){return Array.isArray(t)?t.every(SA):!1}function la({matchUps:t=[],interpolate:e}){var d;if(!hl(t))return{roundMatchUps:[],error:Pe};let i=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?Et(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(wr).map(p=>{let h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===sn)?h.filter(({matchUpType:g})=>g===sn):h,m=g=>g.sort((v,y)=>wr(v.roundPosition,y.roundPosition));return{[p]:m(f)}}),n=t.reduce((p,h)=>{let f=typeof h.roundNumber=="string"?Et(h.roundNumber):h.roundNumber;return p[f]||(p[f]=wt({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),r=Object.assign({},...i);if(e){let p=Math.max(...Object.keys(r).map(f=>Et(f)).filter(f=>!isNaN(f))),h=(d=r[p])==null?void 0:d.length;if(h>1&&kc(h)){let f=p+1,m=f+h/2;it(f,m).forEach((g,v)=>{r[g]=it(0,h/(2+v*2)).map(()=>({}))})}}let o=0,a=Object.assign({},...Object.keys(r).map(p=>{var g,v,y;let h=(g=r[p])==null?void 0:g.length,f=(y=(v=r[p])==null?void 0:v.filter(b=>{var I;return!Nr.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:y.length,m=h&&h===f;return o=Math.max(o,h),{[p]:{matchUpsCount:h,inactiveCount:f,inactiveRound:m}}})),s=0,l=0,c=Object.keys(r).map(p=>Et(p)).filter(p=>!isNaN(p));c.forEach(p=>{var m,g,v,y,b;let h=r[p].sort((I,T)=>I.roundPosition-T.roundPosition),f=h.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(a[p].roundNumber=p,a[p].roundFactor=a[p].matchUpsCount?o/a[p].matchUpsCount:1,a[p].finishingRound=(m=n[p])==null?void 0:m.finishingRound,a[p].roundName=(g=n[p])==null?void 0:g.roundName,a[p].abbreviatedRoundName=(v=n[p])==null?void 0:v.abbreviatedRoundName,a[p].finishingPositionRange=(b=(y=r[p])==null?void 0:y[0])==null?void 0:b.finishingPositionRange,p===1||!a[p-1]){let I=f.sort(wr),T=Qr(I,2);a[p].drawPositions=I,a[p].pairedDrawPositions=T}else{let I=a[p-1],T=I.drawPositions,S=I.matchUpsCount/a[p].matchUpsCount,w=Qr(T,S),U=h.map(D=>{let{roundPosition:E}=D,C=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return C;let M=(C==null?void 0:C.filter(Boolean))||[];if(!(M!=null&&M.length))return[void 0,void 0];if(p<3&&(M==null?void 0:M.length)===2)return C==null?void 0:C.slice().sort(wr);let N=Hn(T,M).length!==(M==null?void 0:M.length);if(M!=null&&M.length&&N)return(M==null?void 0:M.length)===1?[M[0],void 0]:C==null?void 0:C.slice().sort(wr);let R=(E-1)*2;return w.slice(R,R+2).map(A=>M==null?void 0:M.find(_=>A.includes(_)))});a[p].drawPositions=U==null?void 0:U.flat(),a[p].pairedDrawPositions=U}a[p+1]&&a[p+1].matchUpsCount===a[p].matchUpsCount&&(a[p+1].feedRound=!0,a[p+1].feedRoundIndex=l,a[p].preFeedRound=!0,l+=1),a[p]&&!a[p].feedRound&&(a[p].roundIndex=s,s+=1)});let u=!!Object.values(a).find(({matchUpsCount:p})=>!kc(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:u,maxMatchUpsCount:o,roundMatchUps:r,roundNumbers:c,roundProfile:a,...ae}}function dv({element:t,accessor:e}){if(typeof e!="string")return{values:[]};let i=dt(t),n=e.split("."),r=[],o;s({targetElement:i,attributes:n});let a={value:o};return r.length&&(a.values=r),a;function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(let[p,h]of c.entries())if(l!=null&&l[h]){let f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>s({targetElement:m,attributes:f})):(l=l[h],d({targetElement:l,index:p})):(o||(o=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){let f=u?p.slice(0,u):p;o?r.includes(f)||r.push(f):(o=f,r.push(f))}}}}var xee=t=>e=>{var i;return!t||typeof e!="object"?void 0:Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=dv({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=dv({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&dv({element:e,accessor:t}))==null?void 0:i.value)},as=xee;function CD({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:o,lucky:a,fmlc:s}){var g;if(!hl(o))return[];let{roundProfile:l,roundNumbers:c=[]}=la({interpolate:!0,matchUps:o});n=n??Math.max(...c,0);let u=r?n-r:0,d=u&&((g=l==null?void 0:l[n-u])==null?void 0:g.matchUpsCount),p=l&&Object.values(l).map(as("matchUpsCount")),h=(v,y)=>{let b=Math.min(...v);d&&y&&b===1&&(b=d);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},f=l&&Object.assign({},...c.map(v=>{let y=(n??0)+1-v-u,b=l[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=p==null?void 0:p.slice(v-1).reduce((N,R)=>N+(R||0),0),S=s&&v!==1,w=1+t+(S?i??0:0),U=1,D=it(w,a?w+b*2:T+w+U),E=T+U-b,C=h(D.slice(E)),M=h(D.slice(0,E),!0);return I.finishingPositionRange={loser:C,winner:M},{[v]:I}})),m=rl({finishingRound:!0});return o.filter(Boolean).forEach(v=>{let y=v.roundNumber&&f[v.roundNumber];m&&!y&&console.log({roundFinishingData:f,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),o}function Uo({drawDefinition:t,structure:e}){let i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;let{structureId:o,matchUps:a,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(c=>{let{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[o]||(i[o]={itemStructureIds:[],matchUps:[]}),i[o].itemStructureIds||(i[o].itemStructureIds=[]),i[o].itemStructureIds.push(c.structureId)});else{let c=a;i[o]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function Em({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){t=(e==null?void 0:e.mappedMatchUps)??t;let r=t[i],o=((r==null?void 0:r.itemStructureIds)||[]).map(a=>{let{matchUps:s,structureName:l}=t[a];return n?s.map(c=>Object.assign(dt(c,!0,!0),{containerStructureId:i,structureId:a,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...o)}var ED="SIGN_IN_STATUS",Oee="SIGNED_OUT",GT="SIGNED_IN",el="TEAM",si="INDIVIDUAL",ks="GROUP",jt="PAIR",en="TEAM",mI={TEAM_PARTICIPANT:el,INDIVIDUAL:si,GROUP:ks,TEAM:en,PAIR:jt},Fo={INDIVIDUAL:si,GROUP:ks,PAIR:jt,TEAM:en,SIGN_IN_STATUS:ED,SIGNED_OUT:Oee,SIGNED_IN:GT};function vj({participantsProfile:t,participants:e=[],deepCopy:i}){let n=new Map,r=i!==!1?dt(e,t==null?void 0:t.convertExtensions,!0):e,o=r.filter(l=>l.participantType===en),a=r.filter(l=>l.participantType===ks),s=r.filter(l=>l.participantType===jt);return r.forEach(l=>{if(l.participantType===si){let{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d===c&&!((p=l.teamParticipantIds)!=null&&p.includes(u.participantId))&&(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.pairParticipantIds.includes(u.participantId)&&l.pairParticipantIds.push(u.participantId)})}),a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d===c&&!l.groupParticipantIds.includes(u.participantId)&&(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function yj({drawDefinition:t,attributes:e}){let{extension:i}=Qt({element:t,name:PM}),n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(o=>{n[o]?Object.assign(n[o],r[o]):n[o]=r[o]})}),i={name:PM,value:n},sA({drawDefinition:t,extension:i}),{entryProfile:n}}function MD({drawDefinition:t}){let{extension:e}=Qt({element:t,name:PM});return{entryProfile:(e==null?void 0:e.value)||{}}}var Ol="ALTERNATE",RD="CONFIRMED",Ds="DIRECT_ACCEPTANCE",ND="FEED_IN",AD="JUNIOR_EXEMPT",yp="LUCKY_LOSER",_D="ORGANISER_ACCEPTANCE",kD="QUALIFIER",hTe="REGISTERED",xD="SPECIAL_EXEMPT",Ql="UNGROUPED",sg="UNPAIRED",WI="WILDCARD",bp="WITHDRAWN",DE=[RD,Ds,AD,_D,xD],Lee=[ND,yp,kD],lg=[RD,Ds,ND,AD,_D,xD,WI],ec=[RD,Ds,AD,yp,kD,_D,xD,WI],Fee=[Ol,RD,Ds,ND,AD,yp,_D,kD,hTe,xD,Ql,sg,WI,bp],tc={ALTERNATE:Ol,CONFIRMED:RD,DIRECT_ACCEPTANCE:Ds,DIRECT_ENTRY_STATUSES:lg,DRAW_SPECIFIC_STATUSES:Lee,EQUIVALENT_ACCEPTANCE_STATUSES:DE,FEED_IN:ND,JUNIOR_EXEMPT:AD,LUCKY_LOSER:yp,ORGANISER_ACCEPTANCE:_D,QUALIFIER:kD,SPECIAL_EXEMPT:xD,STRUCTURE_SELECTED_STATUSES:ec,UNGROUPED:Ql,UNPAIRED:sg,VALID_ENTRY_STATUSES:Fee,WILDCARD:WI,WITHDRAWN:bp};function bj({stage:t,drawDefinition:e}){let{entryProfile:i}=MD({drawDefinition:e}),n=Object.keys(i).includes(t);if(!n&&ZV.includes(t)){let r=[{[t]:{drawSize:void 0,alternates:!0}}];return yj({drawDefinition:e,attributes:r}),!0}return n}function fTe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=MD({drawDefinition:e});return((n=i[t])==null?void 0:n.alternates)||0}function mTe({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=MD({drawDefinition:e});return((n=i[t])==null?void 0:n.wildcardsCount)||0}function zF({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function My({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:o,roundTarget:a,stages:s,stage:l}){var u;let c=((u=i.entries)==null?void 0:u.reduce((d,p)=>{var v,y;let h=(y=(v=Qt({name:xu,element:p}))==null?void 0:v.extension)==null?void 0:y.value,f=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),m=!r||p.entryStatus&&r.includes(p.entryStatus),g=p.entryStageSequence??1;return f&&(!n||g===n)&&m&&(!a||!h||a===h)?d.concat(p):d},[]))??[];if(o&&l===$n){let{playoffEntries:d,error:p}=gTe({provisionalPositioning:t,drawDefinition:i,structureId:o});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:c).filter(h=>!e||h.placementGroup===e)}return c}function gTe({provisionalPositioning:t,drawDefinition:e,structureId:i}){let n=[],r=(e.links??[]).find(o=>o.linkType===gp&&o.target.structureId===i);if(r){let{finishingPositions:o,structureId:a}=r.source,{structure:s}=At({drawDefinition:e,structureId:a});(s==null?void 0:s.structureType)===fa&&(s.structures??[]).forEach(l=>{let c=l.positionAssignments??[],{structureId:u}=l,d=u,p=Object.assign({},...c.map(m=>{var y;let{participantId:g}=m,v=(y=Qt({element:m,name:Wh}).extension)==null?void 0:y.value;return v&&g?{[g]:v}:void 0}).filter(Boolean)),h=Object.keys(p).reduce((m,g)=>{let v=p[g],y=v.groupOrder||t&&v.provisionalOrder;return m.includes(y)||m.push(y),m},[]).length===Object.keys(p).length,f=Object.keys(p).filter(m=>{let g=p[m],v=g.groupOrder||t&&g.provisionalOrder;return o==null?void 0:o.includes(v)});(!t||h)&&f.forEach(m=>{let g=p[m],{groupOrder:v,provisionalOrder:y,GEMscore:b}=g,I=v||t&&y,T=[...o??[]].sort(wr).indexOf(I)+1;n.push({entryStage:$n,entryStatus:ND,placementGroup:T,groupingValue:d,participantId:m,GEMscore:b})})})}return{playoffEntries:n}}function vTe({stage:t,drawDefinition:e}){return lg.reduce((i,n)=>(zF({drawDefinition:e,entryStatus:n,stage:t})||0)+i,0)}function ol({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var f;let o,a=[];r||({structure:r,error:o}=At({drawDefinition:i,structureId:n}));let s=Yi({structure:r}).positionAssignments;if(o||!r)return{seedAssignments:[],error:Nn};n||(n=r.structureId);let{stage:l,stageSequence:c}=r,u=l===$n&&i&&My({provisionalPositioning:t,drawDefinition:i,stageSequence:c,structureId:n,stage:l}),d=u?u.filter(m=>m.placementGroup===1).sort((m,g)=>m.GEMscore<g.GEMscore&&1||m.GEMscore>g.GEMscore&&-1||0).map((m,g)=>{let v=g+1;return{participantId:m.participantId,seedValue:v,seedProxy:!0,seedNumber:v}}):[],p=d==null?void 0:d.slice(0,e?d.length:s.length/2);p.length?a=p:r.seedAssignments?a=r.seedAssignments:o=kJ;let h=r.seedLimit??((f=r==null?void 0:r.positionAssignments)==null?void 0:f.length);return{seedAssignments:a,stageSequence:c,seedLimit:h,stage:l,error:o}}var Bee="WALKOVER",a6="RETIRED",Ij="COMPETITIVE",zT="ROUTINE",WT="DECISIVE",PE="winRatio",yTe=(t,e)=>(t||0)+(e||0);function $ee(t,e){let i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Bee||i<=e[WT]&&WT||i<=e[zT]&&zT||Ij}function Vee({score:t}){let e=(t==null?void 0:t.sets)||[],i=e.reduce((r,o)=>(r[0]+=o.side1Score||0,r[1]+=o.side2Score||0,r),[0,0]),n=e.reduce((r,o)=>(r[0]+=o.side1TiebreakScore||0,r[1]+=o.side2TiebreakScore||0,r),[0,0]);return n.reduce(yTe)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function bTe(t){let e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function jee(t){return t.map(bTe).sort().map(e=>parseFloat(e.toFixed(2)))}function Bi({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:o}){if(!Array.isArray(e))return{error:J$};let a={};return i&&s(i),o&&s(o),n&&s(n),r&&s(r),{appliedPolicies:a,...ae};function s(l){var u,d;let c=(d=(u=l==null?void 0:l.extensions)==null?void 0:u.find(p=>p.name===LT))==null?void 0:d.value;if(c)for(let p of Object.keys(c))(t?e.includes(p):!e.length||e.includes(p))&&(a[p]=dt(c[p],!1,!0))}}function $p({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:J$};let{appliedPolicies:o}=Bi({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),a={};for(let s of t){let l=o==null?void 0:o[s];l&&(a[s]=l)}return Object.keys(a).length?{policyDefinitions:a}:{info:lv.message}}function cg({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:Ge};let{appliedPolicies:o}=Bi({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return o!=null&&o[i]?{policy:o[i]}:{info:lv==null?void 0:lv.message}}var ITe={[Jd]:{policyName:"Competitive Bands Default",profileBands:{[WT]:20,[zT]:50}}},wj=ITe;function OD({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Ba};let{score:n,winningSide:r}=i;if(!r)return{error:Pe};let o=!e&&t&&cg({policyType:Jd,tournamentRecord:t}).policy,a=e||(o==null?void 0:o.profileBands)||wj[Jd].profileBands,s=Vee({score:n}),l=jee([s]),c=$ee(l,a),u=Array.isArray(l)?l[0]:l;return{...ae,competitiveness:c,pctSpread:u}}function Hee({matchUp:t}){var a,s,l;if(!t)return{error:Ba};if(t&&!t.sides)return{error:Sa};if(t&&!t.hasContext)return{error:XN};let e=(a=t.sides??[])==null?void 0:a.map(c=>c==null?void 0:c.participantId).filter(Boolean),i=((s=t.sides)==null?void 0:s.filter(c=>{var u;return((u=c.participant)==null?void 0:u.participantType)===si}).map(c=>c.participantId).filter(Boolean))??[],n=(((l=t.sides??[])==null?void 0:l.map(c=>{var u;return(u=c.participant)==null?void 0:u.individualParticipants}).filter(Boolean))??[]).map(c=>(c??[]).map(u=>u==null?void 0:u.participantId).filter(Boolean)),r=[...i,...n.flat()].filter(Boolean)??[],o=Zt(r.concat(e)).filter(Boolean)??[];return{nestedIndividualParticipantIds:n,allRelevantParticipantIds:o,individualParticipantIds:r,sideParticipantIds:e,...ae}}var EM="CHECK_IN",MM="CHECK_OUT",wTe="SCHEDULE",h0="SCHEDULE.ASSIGNMENT.VENUE",Ip="SCHEDULE.ALLOCATION.COURTS",Mm="SCHEDULE.ASSIGNMENT.COURT",Sj="SCHEDULE.COURT.ORDER",f0="SCHEDULE.DATE",STe="COMPLETED.DATE",Gee="SCHEDULE.ASSIGN.OFFICIAL",m0="SCHEDULE.TIME.SCHEDULED",bc="SCHEDULE.TIME.START",op="SCHEDULE.TIME.STOP",od="SCHEDULE.TIME.RESUME",wp="SCHEDULE.TIME.END",Tj="SCHEDULE.TIME.MODIFIERS",zee="TO_BE_ANNOUNCED",Wee="NEXT_AVAILABLE",qee="FOLLOWED_BY",Yee="AFTER_REST",Kee="RAIN_DELAY",TTe="NOT_BEFORE",WF=[zee,Wee,qee,Yee,Kee],UTe="ELIGIBILITY",DTe="REGISTRATION",PTe="SUSPENSION",CTe="MEDICAL",ETe="PENALTY",Zee="SCALE",Xee="RATING",Jee="RANKING",Uj="SEEDING",ug="PUBLISH",ic="PUBLIC",dg="STATUS",MTe="MODIFICATION",RTe="RETRIEVAL",NTe="other",TA={MUTUALLY_EXCLUSIVE_TIME_MODIFIERS:WF,AFTER_REST:Yee,ALLOCATE_COURTS:Ip,ASSIGN_COURT:Mm,ASSIGN_OFFICIAL:Gee,ASSIGN_VENUE:h0,CHECK_IN:EM,CHECK_OUT:MM,COMPLETED_DATE:STe,COURT_ORDER:Sj,ELIGIBILITY:UTe,END_TIME:wp,FOLLOWED_BY:qee,MEDICAL:CTe,MODIFICATION:MTe,NEXT_AVAILABLE:Wee,NOT_BEFORE:TTe,OTHER:NTe,PENALTY:ETe,PUBLIC:ic,PUBLISH:ug,RANKING:Jee,RATING:Xee,RAIN_DELAY:Kee,REGISTRATION:DTe,RESUME_TIME:od,RETRIEVAL:RTe,SCALE:Zee,SCHEDULE:wTe,SCHEDULED_DATE:f0,SCHEDULED_TIME:m0,SEEDING:Uj,START_TIME:bc,STATUS:dg,STOP_TIME:op,SUSPENSION:PTe,TIME_MODIFIERS:Tj,TO_BE_ANNOUNCED:zee};function Ry({matchUp:t}){if(!t)return{error:Ba};if(!t.hasContext)return{error:XN};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:Sa};let{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Hee({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[EM,MM].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),o=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===EM);e==null||e.forEach((s,l)=>{let c=n==null?void 0:n[l],u=(s==null?void 0:s.length)&&s.every(d=>o.includes(d));c&&u&&!o.includes(c)&&o.push(c)}),n==null||n.forEach((s,l)=>{o.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!o.includes(c)&&o.push(c)})});let a=n==null?void 0:n.reduce((s,l)=>o.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:a,checkedInParticipantIds:o,...ae}}var Qee={[kn]:[kn,"S"],[an]:[an,"D"],[sn]:[sn,"T"],S:[kn,"S"],D:[an,"D"],T:[sn,"T"]},jn=t=>e=>{let i=ln(e)&&(e==null?void 0:e.matchUpType)||oa(e)&&e;return i&&Qee[t].includes(i)};function XS(t){var o;let{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=(e==null?void 0:e.map(({matchUpFormatCodes:a})=>a==null?void 0:a.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>((a==null?void 0:a.length)||0)-((s==null?void 0:s.length)||0)))||[],r=n.includes(i)?i:n[0];return(o=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:s})=>(a==null?void 0:a.find(l=>r===l))&&s))==null?void 0:o.averageTimes}function JS(t){var r;let{matchUpRecoveryTimes:e,averageMinutes:i,matchUpFormat:n}=t||{};return(r=e==null?void 0:e.find(({matchUpFormatCodes:o,averageTimes:a,recoveryTimes:s})=>{if(a&&i){let{greaterThan:l=0,lessThan:c=360}=a;if(i>l&&i<c)return!0}return(o==null?void 0:o.find(l=>l===n))&&s}))==null?void 0:r.recoveryTimes}function ete({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,o)=>{var a,s;return(((a=o.categoryNames)==null?void 0:a.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:o})=>!(o!=null&&o.length)&&!(r!=null&&r.length)||(o==null?void 0:o.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function ATe({tournamentScheduling:t,eventScheduling:e,averageMinutes:i,defaultTiming:n,matchUpFormat:r,categoryName:o,categoryType:a,policy:s}){var p;let l=(e==null?void 0:e.matchUpRecoveryTimes)&&JS({...e,averageMinutes:i,matchUpFormat:r}),c=(t==null?void 0:t.matchUpRecoveryTimes)&&JS({...t,averageMinutes:i,matchUpFormat:r}),u=(s==null?void 0:s.matchUpRecoveryTimes)&&JS({...s,averageMinutes:i,matchUpFormat:r}),d=[l,c,u,(p=s==null?void 0:s.defaultTimes)==null?void 0:p.recoveryTimes,n==null?void 0:n.recoveryTimes];return ete({categoryName:o,categoryType:a,timesBlockArray:d})}function _Te({matchUpFormat:t,categoryName:e,categoryType:i,defaultTiming:n,tournamentScheduling:r,eventScheduling:o,policy:a}){var d;let s=(o==null?void 0:o.matchUpAverageTimes)&&XS({...o,matchUpFormat:t}),l=(r==null?void 0:r.matchUpAverageTimes)&&XS({...r,matchUpFormat:t}),c=(a==null?void 0:a.matchUpAverageTimes)&&XS({...a,matchUpFormat:t}),u=[s,l,c,(d=a==null?void 0:a.defaultTimes)==null?void 0:d.averageTimes,n==null?void 0:n.averageTimes];return ete({categoryName:e,categoryType:i,timesBlockArray:u})}function LD({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var s,l,c,u,d,p;e=e??((s=n==null?void 0:n.category)==null?void 0:s.categoryName)??((l=n==null?void 0:n.category)==null?void 0:l.ageCategoryCode),i=i??((c=n==null?void 0:n.category)==null?void 0:c.categoryType)??((u=n==null?void 0:n.category)==null?void 0:u.subType);let{policy:r}=cg({policyType:Tf,tournamentRecord:t,event:n}),o=(d=t?Qt({element:t,name:mp}).extension:void 0)==null?void 0:d.value,a=(p=n&&Qt({name:mp,element:n}).extension)==null?void 0:p.value;return{scheduleTiming:{tournamentScheduling:o,eventScheduling:a,categoryName:e,categoryType:i,policy:r}}}var tte="DOUBLES_SINGLES",ite="SINGLES_DOUBLES",Ll="total",qF="participantConflict",vh="matchUpConflict",nte="ISSUE_IDS",Xf="CONFLICT",Jf="WARNING",YF="ERROR",KF="ISSUE",CE="STATE",rte={SINGLES_DOUBLES:ite,DOUBLES_SINGLES:tte,TOTAL:Ll,CONFLICT_MATCHUP_ORDER:vh,CONFLICT_PARTICIPANTS:qF,SCHEDULE_ISSUE_IDS:nte,SCHEDULE_CONFLICT:Xf,SCHEDULE_WARNING:Jf,SCHEDULE_ERROR:YF,SCHEDULE_ISSUE:KF,SCHEDULE_STATE:CE},Sd="SINGLES",Bv="SINGLES",Gl="DOUBLES",Zh="DOUBLES",Or="TEAM",al="TEAM",kTe="AGE",xTe="RATING",OTe="BOTH",ps={AGE:kTe,BOTH:OTe,DOUBLES:Gl,DOUBLES_EVENT:Zh,RATING:xTe,SINGLES:Sd,SINGLES_EVENT:Bv,TEAM_EVENT:al,TEAM:Or};function FD({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:o,eventType:a,event:s}){if(!i)return{error:Ge};a=a??(s==null?void 0:s.eventType)??Bv;let l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=LD({tournamentRecord:i,categoryName:r,categoryType:o,event:s}),u={...c,matchUpFormat:n,categoryType:o,defaultTiming:l};return UA({eventType:a,timingDetails:u})}function UA({timingDetails:t,eventType:e}){let i=_Te(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),o=ATe({...t,averageMinutes:r}),a=Object.keys((o==null?void 0:o.minutes)||{}),s=(o==null?void 0:o.minutes)&&((a==null?void 0:a.includes(e))&&o.minutes[e]||o.minutes.default),l=jn(Bv)(e)?ite:tte,c=(o==null?void 0:o.minutes)&&((a==null?void 0:a.includes(l))&&o.minutes[l]||s);return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:c}}function v1(t){return t.createdAt?new Date(t.createdAt).getTime():0}function pg({visibilityThreshold:t,timeItems:e,itemType:i}){let n=e.filter(o=>o&&o.itemType===i&&(!t||v1(o)<new Date(t).getTime())).sort((o,a)=>v1(o)-v1(a)).pop(),r=n&&v1(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function ZF({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:m0,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function Rm({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:f0,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function ote({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Ip,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{allocatedCourts:dt(r,!1,!0)}:i}function ate({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Mm,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{courtId:r}:i}function ste({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:h0,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{venueId:r}:i}function Dj({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Tj,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function _g(t){if(ree.test(t)){let e=RV();return new Date(`${e}T${t}`)}else return new Date(t)}function LTe({matchUp:t}){if(!t)return{error:Ba};if(!t.timeItems)return{error:uV};let e=t.timeItems.filter(n=>[bc,op,od,wp].includes(n==null?void 0:n.itemType)).sort((n,r)=>_g(n.itemValue).getTime()-_g(r.itemValue).getTime()),i=e.reduce((n,r)=>{var l,c;let o,a=(l=r==null?void 0:r.itemType)==null?void 0:l.split("."),s=`SCHEDULE.TIME.${((c=r==null?void 0:r.itemType)==null?void 0:c.startsWith("SCHEDULE.TIME"))&&a[2]}`;switch(s){case bc:o=0;break;case wp:if(n.lastValue&&[bc,od].includes(n.lastType)){let u=_g(r.itemValue).getTime()-_g(n.lastValue).getTime();o=n.milliseconds+u}else o=n.milliseconds;break;case op:if([bc,"SCHECULE.TIME.RESUME"].includes(n.lastType)){let u=_g(r.itemValue).getTime()-_g(n.lastValue).getTime();o=n.milliseconds+u}else o=n.milliseconds;break;default:o=n.milliseconds;break}return{milliseconds:o,lastType:s,lastValue:r.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([bc,od].includes(i.lastType)){let n=new Date().getTime()-_g(i.lastValue).getTime();i.milliseconds+=n}return{milliseconds:i.milliseconds,time:FTe(i.milliseconds),relevantTimeItems:e}}function FTe(t){let e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function BTe({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){let{itemValue:r,timeStamp:o}=pg({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Sj,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{courtOrder:r}:i}function $Te({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{startTime:(n=e.reduce((r,o)=>{let a=o.itemType===bc&&o;return a&&(!r||i(a)<i(r))?a:r},void 0))==null?void 0:n.itemValue}}function VTe(t=1){return it(0,t).map(ji)}function ji(){let t=[];for(let o=0;o<256;o++)t[o]=(o<16?"0":"")+o.toString(16);let e=Math.random()*4294967295|0,i=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return t[e&255]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[i&255]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[n&63|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[r&255]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function BD(t){let{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Pe};let r=Ou(t);i.venueId||(i.venueId=ji());let o;for(let a of Object.values(r)){let s=jTe({disableNotice:!0,tournamentRecord:a,context:n,venue:i});if(s!=null&&s.error)return s;o=s.venue}return e||di({topic:rj,payload:{venue:i}}),wt({...ae,venue:o})}function jTe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=ji()),t.venues.reduce((r,o)=>r||o.venueId===n.venueId,void 0)?{error:fQ}:(i&&Ui({element:n,extension:{value:i,name:uee}}),t.venues.push(n),e||di({payload:{venue:n,tournamentId:t.tournamentId},topic:rj}),{...ae,venue:dt(n)})):{error:gt,info:"missing venue"}:{error:Ge}}function Vp({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:Ge};if(!i)return{error:bf};let n=(e.venues??[]).reduce((r,o)=>o.venueId===i?o:r,void 0);if(!n&&t){let r=(SD({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let o of r){let a=t[o],s=Vp({tournamentRecord:a,venueId:i});if(s.success&&s.venue)return BD({tournamentRecord:e,venue:s.venue}),{...ae,venue:n}}}return n?{...ae,venue:n}:{error:e0}}function Pj({convertExtensions:t,...e}){let{tournamentRecords:i,tournamentRecord:n,venueId:r}=e,o=Vp({tournamentRecords:i,tournamentRecord:n,venueId:r});return dt(o,t,!0)}function Ny({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:Ge};if(!i)return{error:wy};let n="findCourt",r,o;if((e.venues??[]).forEach(a=>{(a.courts??[]).forEach(s=>{s.courtId===i&&(r=s,o=a)})}),r)return{...ae,court:r,venue:o};if(t){let a=(SD({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(let s of a){let l=t[s],c=Ny({tournamentRecord:l,courtId:i});if(c.success)return c.venue&&BD({tournamentRecord:e,venue:c.venue}),{...ae,court:r,venue:o}}}return se({result:{error:fD},stack:n})}function lte(t){return dt(Ny(t),!1,!0)}function DA({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:Ge};if(!i)return{error:wy};let n=Ny({tournamentRecord:t,courtId:i});if(n.error)return n;let r=n.court&&(({altitude:o,courtId:a,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:o,courtId:a,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...ae,courtInfo:dt(r,!1,e)}}function qI({tournamentRecord:t,venueId:e}){var a;if(!t)return{error:Ge};if(!e)return{error:bf};let i=Vp({tournamentRecord:t,venueId:e});if(i.error)return i;let n=(((a=i.venue)==null?void 0:a.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(DA({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),r=i.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(i.venue),o=r&&{...r,courtsInfo:n};return{...ae,venueData:dt(o,!1,!0)}}function HTe({matchUp:t}){var n;let e=(t==null?void 0:t.timeItems)||[],i=r=>r.createdAt?new Date(r.createdAt).getTime():0;return{endTime:(n=e.reduce((r,o)=>{let a=o.itemType===wp&&o;return a&&(!r||i(a)>i(r))?a:r},void 0))==null?void 0:n.itemValue}}function Kn({event:t,eventId:e}){var r,o;if(!t)return{error:Vi};let i=(r=Qt({name:Vl,element:t}))==null?void 0:r.extension,n=e?dt(i==null?void 0:i.value,!1,!0):i==null?void 0:i.value;return e&&((o=t.drawDefinitions)==null||o.forEach(a=>{var s;(s=n==null?void 0:n.flights)==null||s.forEach(l=>{l.drawId===a.drawId&&Object.assign(l,{drawDefinition:a})})})),{flightProfile:n}}function Ta(t){let{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",o={},a=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(a).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{o[d.eventId]={tournamentId:u}}),c??[])).flat(),l;if(n){let c,u=s.find(d=>{var h,f,m;let p=((d==null?void 0:d.drawDefinitions)??[]).find(g=>g.drawId===n);if(p)c=p,l=o[d.eventId].tournamentId;else{let g=(m=(f=d&&((h=Kn({event:d}))==null?void 0:h.flightProfile))==null?void 0:f.flights)==null?void 0:m.find(v=>v.drawId===n);if(g)return l=o[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return p});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){let c=s.find(u=>(u==null?void 0:u.eventId)===i);if(c)l=o[c.eventId].tournamentId;else return{event:void 0,drawDefinition:void 0,...se({result:{error:rs},stack:r})};return{event:c,drawDefinition:void 0,tournamentId:l}}return{event:void 0,drawDefinition:void 0,...se({result:{error:ns},context:{drawId:n,eventId:i},stack:r})}}function PA(t){var S,w,U,D,E,C,M,N,R;let e=t.event,i=t.matchUpType,{scheduleVisibilityFilters:n,afterRecoveryTimes:r,tournamentRecord:o,usePublishState:a,scheduleTiming:s,matchUpFormat:l,publishStatus:c,matchUp:u}=t;if(!u)return{error:Ba};if(r&&!u.matchUpType&&!t.matchUpType&&(e||o)&&u.drawId){let A=(S=e==null?void 0:e.drawDefinitions)==null?void 0:S.find(k=>k.drawId===u.drawId);!A&&o&&({drawDefinition:A,event:e}=Ta({tournamentRecord:o,drawId:u.drawId}));let _=u.structureId&&((w=A==null?void 0:A.structures)==null?void 0:w.find(({structureId:k})=>k===u.structureId));i=t.matchUpType||(_==null?void 0:_.matchUpType)||(A==null?void 0:A.matchUpType)||(e==null?void 0:e.eventType)!==Or&&(e==null?void 0:e.eventType)}let{milliseconds:d,time:p}=LTe({matchUp:u}),{startTime:h}=$Te({matchUp:u}),{endTime:f}=HTe({matchUp:u}),m,{visibilityThreshold:g,eventIds:v,drawIds:y}=n??{};if((!v||v.includes(u.eventId))&&(!y||y.includes(u.drawId))){let A={matchUp:u,visibilityThreshold:g},{allocatedCourts:_}=ote(A),{scheduledTime:k}=ZF(A),{scheduledDate:O}=Rm(A),{venueId:F}=ste(A),{courtId:B}=ate(A),{courtOrder:$}=BTe(A),{timeModifiers:V}=Dj(A),H,z,G,W,K,Z=u.matchUpType??i;if(s&&k&&r&&Z){let ne={matchUpFormat:u.matchUpFormat??l,...s};({averageMinutes:z=0,recoveryMinutes:G=0,typeChangeRecoveryMinutes:W=0}=UA({timingDetails:ne,eventType:Z})),(z||G)&&(H=f?xa(hn(f),G):xa(k,z+G)),W&&(K=f?xa(hn(f),W):xa(k,z+W))}!O&&k&&(O=Wt(k));let Y=bM({scheduledDate:O,scheduledTime:k}),X={},Q=((U=o&&F&&qI({tournamentRecord:o,venueId:F}))==null?void 0:U.venueData)||{};F&&(X[F]=Q);let{venueName:te,venueAbbreviation:J,courtsInfo:ie}=Q,oe=(D=B&&(ie==null?void 0:ie.find(ne=>ne.courtId===B)))==null?void 0:D.courtName;for(let ne of _||[]){if(!o)break;ne.venueId&&!X[ne.venueid]&&(X[ne.venueId]=(E=qI({venueId:ne.venueId,tournamentRecord:o}))==null?void 0:E.venueData);let re=X[ne.venueId];ne.venueName=re==null?void 0:re.venueName;let me=(C=re==null?void 0:re.courtsInfo)==null?void 0:C.find(he=>he.courtId===ne.courtId);ne.courtName=me==null?void 0:me.courtName}m=wt({typeChangeTimeAfterRecovery:K,timeAfterRecovery:H,scheduledDate:O,scheduledTime:k,isoDateString:Y,allocatedCourts:_,timeModifiers:V,venueAbbreviation:J,venueName:te,venueId:F,courtOrder:$,courtName:oe,courtId:B,typeChangeRecoveryMinutes:W,recoveryMinutes:G,averageMinutes:z,milliseconds:d,startTime:h,endTime:f,time:p})}else m=wt({milliseconds:d,startTime:h,endTime:f,time:p});let{scheduledDate:b}=Rm({matchUp:u}),{scheduledTime:I}=ZF({matchUp:u});if(a&&((M=c==null?void 0:c.displaySettings)!=null&&M.draws)){let A=c.displaySettings.draws,_=(N=(A==null?void 0:A[u.drawId])??(A==null?void 0:A.default))==null?void 0:N.scheduleDetails;if(_){let k=(R=_.find(O=>{var F;return b&&((F=O.dates)==null?void 0:F.includes(b))})??_.find(O=>{var F;return!((F=O.dates)!=null&&F.length)}))==null?void 0:R.attributes;if(k){let O=Object.assign({},...Object.keys(m).map(F=>({[F]:!0})),k);m=kv({source:m,template:O})}}}let T=u.matchUpStatus&&Nr.includes(u.matchUpStatus)&&(Wt(f)||Wt(b)||Wt(I))||void 0;return{schedule:m,endDate:T}}function Ih(t){if(!t)return;let{tieFormatId:e,tieFormats:i}=t;if(t.tieFormat)return t.tieFormat;if(e&&Array.isArray(i))return i.find(n=>n.tieFormatId===e)}function QS({item:t,drawDefinition:e,structure:i,event:n}){var r,o,a;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(l=>t.tieFormatId===l.tieFormatId))||(n.tieFormat?n.tieFormat:(o=n.tieFormats)==null?void 0:o.find(l=>t.tieFormatId===l.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){let s=(a=e.tieFormats)==null?void 0:a.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function Vo({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:QS({item:i,drawDefinition:t,structure:e,event:n})||QS({item:e,drawDefinition:t,structure:e,event:n})||Ih(t)||Ih(n)}}function GTe({matchUps:t}){let e=t.reduce((i,n)=>!n.collectionPosition||i.includes(n.collectionPosition)?i:i.concat(n.collectionPosition),[]).map(i=>({[i]:t.filter(n=>n.collectionPosition===i)}));return{collectionPositionMatchUps:Object.assign({},...e)}}function cte({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;let i=Qr(t,t.length/e).map(r=>r.reduce((o,a)=>o+a)),n=i.slice().sort(wr);return i.map(r=>n.indexOf(r)+1)}function EE(t){if(!Array.isArray(t))return"";let e=t.filter(Bn);return e.length?Zt([Math.min(...e),Math.max(...e)]).join("-"):""}function zTe({drawDefinition:t,structureId:e,matchUpsMap:i}){if(!t)return{error:lt};if(!e)return{error:_s};let{structure:n}=At({drawDefinition:t,structureId:e});if((n==null?void 0:n.stage)!==Io)return{error:ig,info:"Structure is not CONSOLATION stage"};let{links:r}=t,o=(r==null?void 0:r.filter(d=>d.target.structureId===e))||[],a=(o==null?void 0:o.reduce((d,p)=>{let{structureId:h}=p.source;return d.includes(h)?d:d.concat(h)},[]))||[],s=Object.assign({},...a.map(d=>{let p=Em({structureId:d,matchUpsMap:i}),h=la({matchUps:p}).roundProfile;return{[d]:h}})),l=Em({matchUpsMap:i,structureId:e}),{roundProfile:c}=la({matchUps:l}),u={};return o==null||o.forEach(d=>{var M,N,R;let{structureId:p,roundNumber:h}=d.source,{feedProfile:f,groupedOrder:m,positionInterleave:g,roundNumber:v}=d.target,y=s[p],b=(M=y[1])==null?void 0:M.drawPositions,I=(N=y[h])==null?void 0:N.matchUpsCount;if(!I)return;let T=I?b.length/I:0,S=b.length/T,w=b.slice(),U=cte({roundPositionsCount:S,groupedOrder:m}),D=(U==null?void 0:U.length)||1;if(D<=S){let A=b.length/D,_=Qr(w,A);f===Pm&&_.forEach(k=>k.reverse()),w=(U==null?void 0:U.length)&&(U==null?void 0:U.map(k=>_[k-1]).flat())||w}let E=Qr(w,T);if(g){let A=it(0,g.interleave).map(()=>{}),_=it(0,g.offset).map(()=>{});E=E.map(O=>[O,...A]),E.unshift(_),E=E.flat(1);let k=E.length-g.offset;E=E.slice(0,k)}u[v]||(u[v]={});let C=(R=c==null?void 0:c[v])!=null&&R.feedRound?2:1;E.forEach((A,_)=>{let k=1+_*C;u[v][k]||(u[v][k]=EE(A))})}),{sourceDrawPositionRanges:u}}function jp({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){let o={policies:{}};if(!i)return o;let a=$p({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){let s=(t==null?void 0:t[Jd])??(a==null?void 0:a[Jd])??wj[Jd];o.policies[Jd]=s}return o}function WTe({drawPositions:t,roundProfile:e,roundNumber:i}){var s;let n=[void 0,void 0];if(BQ(t))return{orderedDrawPositions:n,displayOrder:n};let r=e==null?void 0:e[i],o=((s=r==null?void 0:r.pairedDrawPositions)==null?void 0:s.find(l=>sa(l||[],t.filter(Boolean))))??n,a=r==null?void 0:r.feedRound;if(FQ(t)){let l=[...t].sort(wr);return{orderedDrawPositions:l.length===2?l:o,displayOrder:a?l:o}}if(a){let l=[t.find(c=>!isNaN(Et(c))),void 0];return{orderedDrawPositions:l,displayOrder:l}}return{orderedDrawPositions:o,displayOrder:o}}function RM({collectionPosition:t,collectionId:e,lineUp:i}){let n=[],r=[];if(i){let o=s=>s===void 0?-1:s,a=i.map(s=>{let{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>o(s.substitutionOrder)-o(l.substitutionOrder));for(let s of a){let{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function zl({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){let n="getPairedParticipant";if(!t&&!e)return{error:Ge};if(!Array.isArray(i)||i.length>2)return{error:xl};if(!i.length)return se({result:{error:yf},stack:n});t=t??(e==null?void 0:e.participants)??[];let r=t.filter(s=>s.participantType===jt&&Hn(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),o=r[0];if(!o)return se({result:{error:Jn},stack:n});let a=dt(r.slice(1),!1,!0);return{participant:dt(o),duplicatedPairParticipants:a,...ae}}function Nm({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:lt};if(typeof e!="string")return{error:Rr};let{extension:i}=Qt({element:t,name:fp});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function qTe({tournamentParticipants:t,positionAssignments:e,collectionPosition:i,drawPositions:n=[],participantMap:r,drawDefinition:o,collectionId:a,sideLineUps:s,matchUpType:l}){if(!a||!i)return{};let c=({attribute:d,lineUp:p,teamParticipant:h})=>{var g,v,y,b;let{assignedParticipantIds:f,substitutions:m}=RM({collectionPosition:i,collectionId:a,lineUp:p});if(l===an){if((f==null?void 0:f.length)<=2){let I=(v=(g=r==null?void 0:r[f[0]])==null?void 0:g.pairIdMap)==null?void 0:v[f[1]],T=(b=I&&((y=r[I])==null?void 0:y.participant)||zl({participantIds:f,tournamentParticipants:t}).participant)==null?void 0:b.participantId;return{[d]:{participantId:T,teamParticipant:h,substitutions:m}}}else if((f==null?void 0:f.length)>2)return{[d]:{teamParticipant:h,substitutions:m}}}else{let I=f==null?void 0:f[0];return I&&{[d]:{participantId:I,teamParticipant:h,substitutions:m}}}};if(!(n!=null&&n.length)){let d=(s==null?void 0:s.map(p=>{var g;let{teamParticipant:h,sideNumber:f}=p,m=p.lineUp||((g=Nm({participantId:h.teamParticipantId,drawDefinition:o}))==null?void 0:g.lineUp);return c({attribute:f,lineUp:m,teamParticipant:h})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},...d)}}let u=(n==null?void 0:n.map(d=>{var g,v,y;let p=(g=e.find(b=>b.drawPosition===d))==null?void 0:g.participantId,h=s==null?void 0:s.find(b=>(b==null?void 0:b.drawPosition)===d),f=(h==null?void 0:h.teamParticipant)||p&&((v=r==null?void 0:r[p])==null?void 0:v.participant)||(t==null?void 0:t.find(({participantId:b})=>b===p)),m=(h==null?void 0:h.lineUp)||((y=Nm({participantId:p,drawDefinition:o}))==null?void 0:y.lineUp);return c({attribute:d,lineUp:m,teamParticipant:f})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...u)}}function ute({drawDefinition:t}){if(typeof t!="object")return{error:sv};let e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((a,s)=>{let{stage:l}=s;return a[l]?a[l].push(s):a[l]=[s],a},{});for(let a of Object.keys(r)){let s=r[a].find(({stageSequence:c})=>c===1);if(!s)continue;let{structureId:l}=s;o({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:a})}return{exitProfiles:e};function o({exitProfiles:a,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){a[l]||(a[l]=[]),s==="0"&&[Io,$n].includes(d)||a[l].push(s);let p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(let h of p){let f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,o({exitProfile:`${s}-${f}`,structureId:g,exitProfiles:a,targetRound:m,aggregator:u,stage:v})}}}function YTe({drawDefinition:t,roundProfile:e,structureId:i,matchUpsMap:n}){var a;if(!t)return{error:lt};if(!i)return{error:_s};if(!e){let s=Em({matchUpsMap:n,structureId:i});if({roundProfile:e}=la({matchUps:s}),!e)return{error:gt}}let r=(Math.min(...((a=e==null?void 0:e[1])==null?void 0:a.drawPositions)??[])||1)-1,o=Object.keys(e);return{drawPositionsRanges:Object.assign({},...(o||[]).map(s=>{var v,y;let l=(v=e==null?void 0:e[s])==null?void 0:v.matchUpsCount,c=((y=e==null?void 0:e[1])==null?void 0:y.drawPositions)??[],u=Qr(c,c.length/l),d=u.map(EE),p=u.map(b=>b.map(I=>I-r)).map(EE),h=o.map(b=>{var T;if(b>s)return;let I=((T=e==null?void 0:e[b])==null?void 0:T.drawPositions)??[];return Qr(I,I.length/l)}).filter(Boolean),f=it(0,l).map(b=>h.map(I=>I[b]).flat().filter(Boolean).sort(wr)).map(b=>Zt(b)),m=f.map(b=>dSe(b).map(EE).join(", ")),g=Object.assign({},...it(0,l).map(b=>({[b+1]:{firstRoundDrawPositionsRange:d[b],firstRoundOffsetDrawPositionsRange:p[b],possibleDrawPositions:f[b],drawPositionsRange:m[b]}})));return{[s]:g}}))}}function Cj({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var o;if(!i)return!1;n=n??i.matchUps??[],t=t??la({matchUps:n}).roundsNotPowerOf2;let r=!!((o=i.positionAssignments)!=null&&o.find(({drawPosition:a})=>a))||!!(n!=null&&n.find(({drawPositions:a})=>a==null?void 0:a.length));return(!(e!=null&&e.drawType)||e.drawType!==og)&&!(i!=null&&i.structures)&&t&&r}function ss({structure:t}){if(!t)return!1;let e=t.matchUps||t.roundMatchUps&&Object.values(t.roundMatchUps).flat(),i=!!(e!=null&&e.find(r=>r==null?void 0:r.roundPosition)),n=!!(e!=null&&e.find(r=>{var o;return(o=r==null?void 0:r.drawPositions)==null?void 0:o.length}));return!(t!=null&&t.structures)&&(t==null?void 0:t.stage)!==Xr&&(!e.length||!i&&!n)}var Ej={[FI]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[ut]:"",[$n]:"P",[Tt]:"Q",[Io]:"C"}}},KTe=Ej;function ZTe({roundNamingPolicy:t,drawDefinition:e,structure:i,matchUps:n}){var M,N,R;let{roundProfile:r,roundMatchUps:o}=la({matchUps:n}),{structureAbbreviation:a,stage:s}=i,l=ss({structure:i}),c=Cj({structure:i}),u=i.structures,d={},p=Ej[FI],h=i.stage===Tt,f=h?Math.max(...((e==null?void 0:e.structures)??[]).filter(A=>A.stage===Tt).map(({stageSequence:A})=>A??1),0):0,m=(i.stageSequence??1)<f?i.stageSequence??1:"",g=m&&(((M=t==null?void 0:t.affixes)==null?void 0:M.preQualifying)||p.affixes.preQualifying)||"",v=(t==null?void 0:t.roundNamingMap)||p.roundNamingMap||{},y=(t==null?void 0:t.abbreviatedRoundNamingMap)||p.abbreviatedRoundNamingMap||{},b=((N=t==null?void 0:t.affixes)==null?void 0:N.preFeedRound)||p.affixes.preFeedRound,I=((R=t==null?void 0:t.affixes)==null?void 0:R.roundNumber)||p.affixes.roundNumber,T=((t==null?void 0:t.namingConventions)||p.namingConventions).round,S=s&&s!==ut?s[0]:"",w=(t==null?void 0:t.stageConstants)||p.stageConstants,U=s&&(w==null?void 0:w[s])||S,D=`${g}${U}${m}`,E=r?Object.keys(r):[],C=h&&(w!=null&&w[Tt])?`${w==null?void 0:w[Tt]}-`:"";if(u||l||c)Object.assign(d,...E.map(A=>{let _=`${C}${T} ${A}`,k=`${I}${A}`;return{[A]:{roundName:_,abbreviatedRoundName:k}}}));else{let A=h&&((t==null?void 0:t.qualifyingFinishMap)||(p==null?void 0:p.qualifyingFinishMap)||{});Object.assign(d,...E.map(_=>{if(!(r!=null&&r[_]))return;let{matchUpsCount:k,preFeedRound:O}=r[_],F=k*2,B=(A==null?void 0:A[r==null?void 0:r[_].finishingRound])||A&&`${I}${F}`||v[k]||`${I}${F}`,$=O?`-${b}`:"",V=`${B}${$}`,H=[D,a,V].filter(Boolean).join("-"),z=`${y[k]||`${I}${F}`}${$}`,G=[D,a,z].filter(Boolean).join("-");return{[_]:{abbreviatedRoundName:G,roundName:H}}}))}return{roundNamingProfile:d,roundProfile:r,roundMatchUps:o}}function CA(t){var r,o,a;let e=Ei(t,[{[wf]:!0}]);if(e.error)return e;let i=t==null?void 0:t.matchUp,n=i==null?void 0:i.matchUpType;if(!n&&((r=i==null?void 0:i.sides)!=null&&r.length)){let s=(a=(o=i.sides.find(({participant:l})=>l))==null?void 0:o.participant)==null?void 0:a.participantType;n=s===si&&kn||s===jt&&an||s===en&&en||void 0}return{matchUpType:n}}var XTe="normal",s6="timed",JTe="final",Mj="NOAD",ME="SET",QTe={S:XTe,F:JTe};function Pa(t){if(typeof t=="string"){let e=t.startsWith("T")&&s6||t.startsWith(ME)&&ME||"";if(e===s6){let i=pte(t),n={simplified:!0,setFormat:i,bestOf:1};if(i)return n}if(e===ME)return eUe(t)}}function eUe(t){let e=t.split("-"),i=$D(e[0].slice(3)),n=i===1||i%2!==0?i:void 0,r=i!==1&&i%2===0?i:void 0,o=e&&l6(e[1]),a=e&&l6(e[2]),s=o&&o.timed||a&&a.timed,l=n&&n<6||s&&r,c=!e[2]||a,u=o,d=wt({setFormat:o,exactly:r,bestOf:n});if(a&&(d.finalSetFormat=a),l&&u&&c)return d}function l6(t){if((t==null?void 0:t[1])===":"){let e=t.split(":"),i=QTe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){let f=c6(n);return f===!1?!1:typeof f=="object"?{tiebreakSet:f}:void 0}if(n.startsWith("T"))return pte(n);let r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),o=r&&hte(r[2])||!1,a=!(r!=null&&r[2])||o,s=r?$D(r[1]):void 0,l=dte(n),c=l!==!1,u=c&&l||s,d=c6(n.split("/")[1]),p=d!==!1,h={setTo:s};return o&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,s&&a&&p&&c&&h||!1}}}function dte(t,e=!0){let i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?$D(i[1]):i[1])||!1}function c6(t){if(t)if(t.startsWith("TB")){let e=dte(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&hte(i[2]),o=!(i!=null&&i[2])||r,a=$D(n);if(a&&o){let s={tiebreakTo:a};return e&&typeof e=="string"&&!Bt(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}else return!1}else return!1}function pte(t){var s;let e=t.slice(1),i=e.match(/^(\d+)(@?[A-Za-z]*)/),n=$D(i==null?void 0:i[1]);if(!n)return;let r={timed:!0,minutes:n},o=i==null?void 0:i[2],a=[void 0,"P","G"].includes(o);if(o&&!a){let l=(s=e.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:s[3];return l?(r.modifier=l,r):void 0}return o&&(r.based=i[2]),r}function hte(t){return t&&t.indexOf(Mj)>=0}function $D(t){return isNaN(Number(t))?0:Number(t)}function EA(t,e){return!Array.isArray(t)||!oa(e)?!1:Hn(t,Qee[e]).length}function Jg(t){let{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:o,matchUpFormats:a,roundPositions:s,matchUpFormat:l,collectionIds:c,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:h,stageSequences:f,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:b,matchUpTypes:I,structureIds:T,readyToScore:S,courtIds:w,eventIds:U,venueIds:D,drawIds:E,stages:C,filterMatchUpIds:M=!0,filterMatchUpTypes:N=!0}=t,R=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],k=Array.isArray(C)?C.filter(Boolean):[],O=Array.isArray(f)?f.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],B=Array.isArray(h)?h.filter(Boolean):[],$=Array.isArray(d)?d.filter(Boolean):[],V=Array.isArray(s)?s.filter(Boolean):[],H=Array.isArray(p)&&M?p.filter(Boolean):[],z=Array.isArray(I)&&N?I.filter(Boolean):[],G=Array.isArray(w)?w.filter(Boolean):[],W=Array.isArray(D)?D.filter(Boolean):[],K=Array.isArray(a)&&a.filter(Boolean)||typeof l=="string"&&[l]||[],Z=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],Y=Array.isArray(b)?b.filter(Boolean):[],X=Array.isArray(U)?U.filter(Boolean):[],Q=Array.isArray(E)?E.filter(Boolean):[],te=Array.isArray(T)?T.filter(Boolean):[];return e.filter(J=>{var ie;if(S&&!jn(Su)(J)&&!J.readyToScore||J.winningSide&&o&&![1,2].includes(J.winningSide)||u!==void 0&&(u&&!J.tieMatchUps||!u&&J.tieMatchUps)||i!==void 0&&(i&&!J.collectionId||!i&&J.collectionId)||k.length&&!k.includes(J.stage)||O.length&&!O.includes(J.stageSequence)||F.length&&(!J.collectionId||!F.includes(J.collectionId))||B.length&&(!J.roundName||!B.includes(J.roundName))||$.length&&(!J.roundNumber||!$.includes(J.roundNumber))||V.length&&(!J.roundPosition||!V.includes(J.roundPosition))||A.length&&(!J.matchUpStatus||!A.includes(J.matchUpStatus))||_.length&&J.matchUpStatus&&_.includes(J.matchUpStatus)||H.length&&!H.includes(J.matchUpId)||z.length&&(!J.matchUpType||!EA(z,J.matchUpType))||K.length&&(!J.matchUpFormat||!K.includes(J.matchUpFormat)))return!1;if(Z!=null&&Z.length){let{scheduledTime:oe}=ZF({matchUp:J}),{scheduledDate:ne}=Rm({matchUp:J}),re=Wt(oe)||ne;if(!Z.find(me=>gd(me,re)))return!1}if(G.length){let{courtId:oe}=ate({matchUp:J}),{allocatedCourts:ne}=ote({matchUp:J}),re=ne==null?void 0:ne.map(({courtId:me})=>me);if(!G.filter(Boolean).includes(oe)||re!=null&&re.includes(oe))return!1}if(W.length){let{venueId:oe}=ste({matchUp:J});if(!W.filter(Boolean).includes(oe))return!1}if(y){if(Y.length&&!Y.includes(J.tournamentId)||X.length&&!X.includes(J.eventId)||Q.length&&!Q.includes(J.drawId)||te.length&&!te.includes(J.structureId))return!1;if(R.length){let oe=((ie=J.sides)==null?void 0:ie.map(({participantId:ne})=>ne).filter(Boolean))??[];if(!R.some(ne=>oe.includes(ne)))return!1}}return!0})}function tUe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:o,isFeedRound:a,sideNumber:s}){var h,f,m,g;let l=i.find(v=>v.drawPosition&&v.drawPosition===o),c=o&&t,u=s&&e,d=c?(h=c[o])==null?void 0:h.participantId:l==null?void 0:l.participantId,p=l?iUe({displaySideNumber:n,seedAssignments:r,participantId:d,assignment:l,sideNumber:s}):{...u==null?void 0:u[s]};if(a&&(s===1?Object.assign(p,{participantFed:!0}):Object.assign(p,{participantAdvanced:!0})),o&&c){let v=(f=c[o])==null?void 0:f.teamParticipant,y=(m=c[o])==null?void 0:m.participant,b=(g=c[o])==null?void 0:g.substitutions;y&&(p.participant=y),b&&(p.substitutions=b),v&&(p.teamParticipant=v)}return p}function iUe({displaySideNumber:t,seedAssignments:e,participantId:i,assignment:n,sideNumber:r}){let o={drawPosition:n.drawPosition,displaySideNumber:t,sideNumber:r};if(i){let a=nUe({seedAssignments:e,participantId:i});Object.assign(o,a,{participantId:i})}else n.bye&&Object.assign(o,{bye:!0});return n.qualifier&&Object.assign(o,{qualifier:!0}),o}function nUe({seedAssignments:t,participantId:e}){return t==null?void 0:t.find(i=>!i.seedProxy&&i.participantId===e)}var Tu="ANY",nn="MALE",ts="MIXED",Qg="OTHER",Un="FEMALE",Lu={ANY:Tu,MALE:nn,FEMALE:Un,MIXED:ts,OTHER:Qg};function _i({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:a,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:h,contextProfile:f,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:b,structure:I,inContext:T,event:S}){var De,Oe,xe,$e,Ae;let w={},U={};if(n=n??(a==null?void 0:a.participants),!I)return{collectionPositionMatchUps:w,error:vf,roundMatchUps:U,matchUps:[]};let D=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],E=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],C=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],M=!(v!=null&&v.eventId)||!(D!=null&&D.length)&&!((De=c==null?void 0:c.eventIds)!=null&&De.filter(Boolean).length)||(D==null?void 0:D.includes(v.eventId))||((Oe=c==null?void 0:c.eventIds)==null?void 0:Oe.includes(v.eventId)),N=!(E!=null&&E.length)||E.includes(I.structureId),R=!m||!(C!=null&&C.length)||C.includes(m.drawId);if(!M||!N||!R)return{collectionPositionMatchUps:w,roundMatchUps:U,matchUps:[]};f&&!u&&(u=jp({tournamentRecord:a,contextProfile:f,drawDefinition:m}));let{appliedPolicies:A}=Bi({drawDefinition:m}),_={...e,...A,...o},k=(xe=_==null?void 0:_.scoring)==null?void 0:xe.structures,O=I.stage&&(k==null?void 0:k.stage)&&(k==null?void 0:k.stage[I.stage]),F=I.stageSequence&&(O==null?void 0:O.stageSequence)&&O.stageSequence[I.stageSequence],B=(($e=_==null?void 0:_.scoring)==null?void 0:$e.requireAllPositionsAssigned)||(O==null?void 0:O.requireAllPositionsAssigned)||(F==null?void 0:F.requireAllPositionsAssigned);b||(b=Uo({drawDefinition:m,structure:I}));let{positionAssignments:$,allPositionsAssigned:V}=jr({structure:I}),H=!B||V,{seedAssignments:z}=ol({provisionalPositioning:i,drawDefinition:m,structure:I});s=s??z;let{roundOffset:G,structureId:W,structureName:K,stage:Z,stageSequence:Y}=I,{drawId:X,drawName:Q,drawType:te}=m??{};y=y||m&&ute({drawDefinition:m}).exitProfiles;let J=y==null?void 0:y[W],ie=(J==null?void 0:J.length)&&(J[0].split("-").map(ve=>parseInt(ve)).reduce((ve,ke)=>ve+ke)||0),oe=!!I.structures,ne=Em({matchUpsMap:b,structureId:W,inContext:T}),re=_==null?void 0:_[FI],me=ZTe({roundNamingPolicy:re,drawDefinition:m,structure:I,matchUps:ne}),{roundNamingProfile:he,roundProfile:be}=me;if(U=(me==null?void 0:me.roundMatchUps)??[],d&&(ne=Jg({matchUps:ne,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),T){let{sourceDrawPositionRanges:ve}=zTe({drawDefinition:m,matchUpsMap:b,structureId:W}),ke=m?YTe({drawDefinition:m,roundProfile:be,matchUpsMap:b,structureId:W}).drawPositionsRanges:void 0;ne=ne.map(ye=>Se({scheduleVisibilityFilters:t,sourceDrawPositionRanges:ve,drawPositionsRanges:ke,roundNamingProfile:he,initialRoundOfPlay:ie,appliedPolicies:_,usePublishState:l,publishStatus:g,isRoundRobin:oe,roundProfile:be,matchUp:ye,event:S})),(ne==null?void 0:ne.filter(ye=>Array.isArray(ye.tieMatchUps))).forEach(ye=>{let Ie=ye.tieMatchUps;ne=ne.concat(...Ie)}),c&&(ne=Jg({processContext:!0,...c,matchUps:ne}))}else(ne==null?void 0:ne.filter(ve=>Array.isArray(ve.tieMatchUps))).forEach(ve=>{let ke=ve.tieMatchUps;ne=ne.concat(...ke)});return d&&(ne=Jg({matchUps:ne,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(ne=Jg({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:ne})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||T)&&(U=la({matchUps:ne}).roundMatchUps??[]),(Ae=Vo({drawDefinition:m,structure:I,event:S}))!=null&&Ae.tieFormat&&({collectionPositionMatchUps:w}=GTe({matchUps:ne})),{collectionPositionMatchUps:w,roundMatchUps:U,isRoundRobin:oe,roundProfile:be,matchUpsMap:b,matchUps:ne};function Se({scheduleVisibilityFilters:ve,sourceDrawPositionRanges:ke,drawPositionsRanges:ye,initialRoundOfPlay:Ie,additionalContext:Ne,roundNamingProfile:Fe,tieDrawPositions:Le,appliedPolicies:ge,isCollectionBye:Ee,usePublishState:we,publishStatus:fe,matchUpTieId:Te,isRoundRobin:ue,roundProfile:de,sideLineUps:_e,matchUp:Ue,event:Ce}){var Ls,Ze,yt,pi,cr,va,Ur,tn,Xn,Do,Tl,qa,Qi,hi,ur;Ne=Ne??{};let We=(Ls=Vo({drawDefinition:m,structure:I,matchUp:Ue,event:Ce}))==null?void 0:Ls.tieFormat,He=We==null?void 0:We.collectionDefinitions,Be=Ue.collectionId&&(He==null?void 0:He.find(Xt=>Xt.collectionId===Ue.collectionId)),et=Ue.collectionId?Be==null?void 0:Be.matchUpFormat:Ue.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(Ce==null?void 0:Ce.matchUpFormat),ot=Ue.matchUpType||(Be==null?void 0:Be.matchUpType)||(I==null?void 0:I.matchUpType)||(m==null?void 0:m.matchUpType)||!jn(Or)(Ce==null?void 0:Ce.eventType)&&(Ce==null?void 0:Ce.eventType),mt=Ee?Ni:Ue.matchUpStatus,{schedule:Rt,endDate:Ft}=PA({scheduleVisibilityFilters:ve,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:we,scheduleTiming:h,matchUpFormat:et,publishStatus:fe,matchUpType:ot,matchUp:Ue,event:Ce}),Je=Le??Ue.drawPositions??[],{collectionPosition:_t,collectionId:pt,roundPosition:Ke}=Ue,ci=Ue.roundNumber??Ne.roundNumber,ni=pt?qTe({tournamentParticipants:n,positionAssignments:$,collectionPosition:_t,drawDefinition:m,participantMap:p,drawPositions:Je,collectionId:pt,sideLineUps:_e,matchUpType:ot}):void 0,Ht=((Ze=Fe==null?void 0:Fe[ci])==null?void 0:Ze.roundName)||Ne.roundName,Zi=((yt=Fe==null?void 0:Fe[ci])==null?void 0:yt.abbreviatedRoundName)||Ne.abbreviatedRoundName,Xi=(pi=de==null?void 0:de[ci])==null?void 0:pi.feedRound,wi=(cr=de==null?void 0:de[ci])==null?void 0:cr.preFeedRound,Ji=(va=de==null?void 0:de[ci])==null?void 0:va.roundFactor,Yt=ye==null?void 0:ye[ci],_n=Ke?Yt==null?void 0:Yt[Ke]:void 0,Gr=ke==null?void 0:ke[ci],qo=Be!=null&&Be.category?{...(v==null?void 0:v.category)||{},...Be.category}:(v==null?void 0:v.category)??(Ce==null?void 0:Ce.category),Ea=((Ur=Ue.processCodes)==null?void 0:Ur.length)&&Ue.processCodes||((tn=Be==null?void 0:Be.processCodes)==null?void 0:tn.length)&&(Be==null?void 0:Be.processCodes)||((Xn=I==null?void 0:I.processCodes)==null?void 0:Xn.length)&&(I==null?void 0:I.processCodes)||((Do=m==null?void 0:m.processCodes)==null?void 0:Do.length)&&(m==null?void 0:m.processCodes)||((Tl=Ce==null?void 0:Ce.processCodes)==null?void 0:Tl.length)&&(Ce==null?void 0:Ce.processCodes)||(a==null?void 0:a.processCodes),ga=(f==null?void 0:f.withCompetitiveness)&&OD({...u,matchUp:Ue}),Ma=Ue.finishingPositionRange??Ne.finishingPositionRange,er=Xt=>wt(Xt,void 0,!0),Gt={...er(v),...er({matchUpFormat:Ue.matchUpType===Or?void 0:et,tieFormat:Ue.matchUpType!==Or?void 0:We,gender:(Be==null?void 0:Be.gender)??(Ce==null?void 0:Ce.gender),roundOfPlay:Z!==Tt&&Bt(Ie)&&Ie+(ci||0),endDate:Ue.endDate??Ft,discipline:Ce==null?void 0:Ce.discipline,category:qo,finishingPositionRange:Ma,abbreviatedRoundName:Zi,drawPositionsRange:_n,competitiveProfile:ga,structureName:K,stageSequence:Y,drawPositions:Je,matchUpStatus:mt,processCodes:Ea,isRoundRobin:ue,matchUpTieId:Te,preFeedRound:wi,matchUpType:ot,roundFactor:Ji,roundOffset:G,structureId:W,roundNumber:ci,feedRound:Xi,roundName:Ht,drawName:Q,drawType:te,schedule:Rt,drawId:X,stage:Z}),...dt(er(Ue),!0,!0)};if(et&&((qa=Ue.score)!=null&&qa.scoreStringSide1)){let Xt=Pa(et),{bestOf:yn,finalSetFormat:at,setFormat:Mt}=Xt??{};(at!=null&&at.tiebreakSet||Mt!=null&&Mt.tiebreakSet||Mt!=null&&Mt.timed)&&(Gt.score.sets=Gt.score.sets.sort((Kt,Si)=>Kt.setNumber-Si.setNumber).map((Kt,Si)=>(Si+1===yn?(at!=null&&at.tiebreakSet||at!=null&&at.timed)&&(Kt.tiebreakSet=!0):(Mt!=null&&Mt.tiebreakSet||Mt!=null&&Mt.timed)&&(Kt.tiebreakSet=!0),Kt)))}if(Array.isArray(Je)){let{orderedDrawPositions:Xt,displayOrder:yn}=WTe({drawPositions:Je,roundProfile:de,roundNumber:ci}),at=(Qi=de==null?void 0:de[ci])==null?void 0:Qi.feedRound,Mt=yn[0]!==Xt[0],Kt=Xt.concat(void 0,void 0).slice(0,2).map((Si,Pt)=>{var zr;let ri=Pt+1,br=Mt?3-ri:ri,Bo=tUe({...ni,positionAssignments:$,displaySideNumber:br,seedAssignments:s,drawPosition:Si,isFeedRound:at,sideNumber:ri}),Ra=(zr=Ue.sides)==null?void 0:zr.find(Ya=>Ya.sideNumber===ri),_r=Ke?(Ke-1)*2+Pt+1:void 0,Na=_r?Gr==null?void 0:Gr[_r]:void 0;return er({sourceDrawPositionRange:Na,...Ra,...Bo})});Object.assign(Gt,dt({sides:Kt},!0,!0))}if(n&&Gt.sides){let Xt=ge==null?void 0:ge[s0],yn=at=>{var Kt;let Mt=(Kt=p==null?void 0:p[at])==null?void 0:Kt.participant;return Mt&&kv({template:Xt==null?void 0:Xt.participant,source:Mt})};if(Gt.sides.filter(Boolean).forEach(at=>{var Mt,Kt,Si;if(at.participantId){let Pt=dt(yn(at.participantId)||n&&zh({policyDefinitions:ge,participantId:at.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(Pt){if(m!=null&&m.entries){let ri=m.entries.find(br=>br.participantId===at.participantId);ri!=null&&ri.entryStatus&&(Pt.entryStatus=ri.entryStatus),ri!=null&&ri.entryStage&&(Pt.entryStage=ri.entryStage)}Object.assign(at,{participant:Pt})}}if((Kt=(Mt=at==null?void 0:at.participant)==null?void 0:Mt.individualParticipantIds)!=null&&Kt.length&&!((Si=at.participant.individualParticipants)!=null&&Si.length)){let Pt=at.participant.individualParticipantIds.map(ri=>yn(ri)||n&&zh({policyDefinitions:ge,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:ri}));Object.assign(at.participant,{individualParticipants:Pt})}}),!Gt.matchUpType){let{matchUpType:at}=CA({matchUp:Gt});at&&Object.assign(Gt,{matchUpType:at})}if(f!=null&&f.inferGender&&(!Gt.gender||Gt.gender===ts)&&((hi=Gt.sides)==null?void 0:hi.length)===2&&Gt.matchUpType!==Or){let at=Gt.sides.map(Mt=>{var Kt,Si,Pt,ri;if(jn(kn)(Gt.matchUpType))return(Si=(Kt=Mt.participant)==null?void 0:Kt.person)==null?void 0:Si.sex;if(((ri=(Pt=Mt.participant)==null?void 0:Pt.individualParticipants)==null?void 0:ri.length)===2){let br=Zt(Mt.participant.individualParticipants.map(Bo=>{var Ra;return(Ra=Bo.person)==null?void 0:Ra.sex})).filter(Boolean);if(br.length===1)return br[0]}});if(at.filter(Boolean).length===2&&Zt(at).length===1){let Mt=at[0];Gt.inferredGender=Mt}}}if(Gt.tieMatchUps){let Xt=Gt.matchUpStatus===Ni,yn=(ur=Gt.sides)==null?void 0:ur.map(({participant:at,drawPosition:Mt,sideNumber:Kt,lineUp:Si})=>{let Pt=(at==null?void 0:at.participantType)===Or&&at;return{teamParticipant:Pt&&wt({participantRoleResponsibilities:Pt.participantRoleResponsibilities,participantOtherName:Pt.participanOthertName,participantName:Pt.participantName,participantId:Pt.participantId,teamId:Pt.teamId}),drawPosition:Mt,sideNumber:Kt,lineUp:Si}});Gt.tieMatchUps=Gt.tieMatchUps.map(at=>{let Mt=Gt.matchUpId,Kt={finishingPositionRange:Gt.finishingPositionRange,abbreviatedRoundName:Zi,roundNumber:ci,roundName:Ht};return Se({tieDrawPositions:Je,scheduleVisibilityFilters:ve,sourceDrawPositionRanges:ke,sideLineUps:yn,drawPositionsRanges:ye,initialRoundOfPlay:Ie,roundNamingProfile:Fe,additionalContext:Kt,appliedPolicies:ge,isCollectionBye:Xt,usePublishState:we,publishStatus:fe,matchUpTieId:Mt,isRoundRobin:ue,roundProfile:de,matchUp:at,event:Ce})})}let Jc=Gt.sides&&Gt.sides.filter(Xt=>Xt==null?void 0:Xt.participantId).length===2,sc=!Gt.winningSide;if(Object.assign(Gt,{readyToScore:H&&Jc&&sc,hasContext:!0}),Jc){let{allParticipantsCheckedIn:Xt,checkedInParticipantIds:yn}=Ry({matchUp:Gt});Object.assign(Gt,{allParticipantsCheckedIn:Xt,checkedInParticipantIds:yn})}return Array.isArray(f==null?void 0:f.exclude)&&(f==null||f.exclude.forEach(Xt=>delete Gt[Xt])),Gt}}function mm({matchUp:t}){return t?Nr.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide):!1}function MA({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:a,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:b,structure:I,context:T,event:S}){!I&&y&&({structure:I}=At({drawDefinition:m,structureId:y}));let w=_i({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:a,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:I,inContext:b,context:T,event:S}),U=[],D=[],E=[],C=[],M=[];if(w.error)return w;let{matchUps:N}=w,{assignedPositions:R}=jr({structure:I}),A=R==null?void 0:R.filter(k=>k.participantId).map(k=>k.drawPosition),_;return N.filter(k=>{var F;let O=((F=l==null?void 0:l.matchUpTypes)==null?void 0:F.length)===1&&l.matchUpTypes[0]===sn;return!(k.matchUpType!==sn&&O)}).forEach(k=>{var G,W,K,Z;if(k.matchUpStatus===Us){U.push(k);return}k.matchUpType===sn&&(_=!0);let O=k.collectionId,F=O&&((G=k.sides)==null?void 0:G.every(Y=>Y.participantId)),B=!O&&((W=k.drawPositions)==null?void 0:W.filter(Boolean).length)===2,$=!O&&((K=k.drawPositions)==null?void 0:K.every(Y=>A==null?void 0:A.includes(Y))),V=R==null?void 0:R.filter(Y=>Y.bye).map(Y=>Y.drawPosition),H=!O&&((Z=k.drawPositions)==null?void 0:Z.find(Y=>V==null?void 0:V.includes(Y))),z=YV.includes(k.matchUpStatus)&&(F||B&&(!t||$));return H?M.push(k):mm({matchUp:k})?D.push(k):z?E.push(k):C.push(k)}),{includesTeamMatchUps:_,abandonedMatchUps:U,completedMatchUps:D,upcomingMatchUps:E,pendingMatchUps:C,byeMatchUps:M,structure:I}}function rUe({drawDefinition:t,roundNumber:e,structureId:i}){if(!t)return{error:lt};if(!i)return{error:_s};let{links:n}=g0({drawDefinition:t,structureId:i}),r=n.source.reduce((a,s)=>!s.source.roundNumber||s.source.roundNumber===e?a.concat(s):a,[]),o=n.target.reduce((a,s)=>!s.target.roundNumber||s.target.roundNumber===e?a.concat(s):a,[]);return{links:{source:r,target:o}}}function DO({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var o;let r=n.find(a=>{var l,c;let s=!((l=a.source)!=null&&l.finishingPositions)||!t||sa(t,(c=a.source)==null?void 0:c.finishingPositions);return e===a.linkCondition&&s&&a.linkType===i});return[vp,yd].includes(r==null?void 0:r.linkType)&&!((o=r==null?void 0:r.source)!=null&&o.roundNumber)?se({result:{error:Pe},stack:"getTargetLink",context:r}):r}function g0({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var o,a;return((o=r.source)==null?void 0:o.structureId)===e&&(!i||r.source.roundNumber===i)&&(n.source=n.source.concat(r)),((a=r.target)==null?void 0:a.structureId)===e&&(!i||r.target.roundNumber===i)&&(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:_s}:{error:lt}}function oUe({structureMatchUps:t,matchUp:e}){let{roundNumber:i,roundPosition:n}=e,r=t.filter(a=>a.roundNumber===i&&!a.matchUpTieId),o=t.filter(a=>a.roundNumber===i+1&&!a.matchUpTieId);if(o.length){let a;return o.length===r.length?a=o.find(s=>s.roundPosition===n):o.length===r.length/2&&(a=o.find(s=>s.roundPosition===Math.ceil(n/2))),{matchUp:a}}return{message:"no progression found"}}function PO({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var D;if(!r)return{error:W$};let{target:{structureId:o,feedProfile:a,groupedOrder:s,roundNumber:l,positionInterleave:c}}=r,{structure:u}=At({drawDefinition:n,structureId:o}),{positionAssignments:d}=Yi({structure:u}),p=(e==null?void 0:e.filter(E=>E.structureId===(u==null?void 0:u.structureId))).filter(E=>E.roundNumber===l&&!E.matchUpTieId),h=p.length,f=it(1,h+1),m=h/t,g=Math.ceil(m*i),v=1-i%2;if(c!=null&&c.interleave&&m!==.5){let E=c.offset+(i-1)*c.interleave,C=i+E;g=Math.ceil(C/2),v=1-C%2}let y=f,b=f[g-1],I=cte({roundPositionsCount:f.length,groupedOrder:s}),T=(I==null?void 0:I.length)||1;if(T<=f.length){let E=h/T,C=Qr(f,E);a===Pm&&C.forEach(M=>M.reverse()),y=(I==null?void 0:I.length)&&(I==null?void 0:I.map(M=>C[M-1]).flat())||y}a===Nl?b=y[g-1]:a===Pm?((!(I!=null&&I.length)||T>f.length)&&(g=p.length+1-g),b=y[g-1]):a===mA&&rl()&&console.log(eA,{feedProfile:a});let S=b&&p.reduce((E,C)=>C.roundPosition===b?C:E,void 0),w;S!=null&&S.feedRound?(v=0,w=Math.min(...(S.drawPositions||[]).filter(Boolean))):w=((D=S==null?void 0:S.drawPositions)==null?void 0:D.length)===2&&(S==null?void 0:S.drawPositions[v]);let U=d==null?void 0:d.find(({drawPosition:E})=>E===w);if(U){let{extension:E}=Qt({element:U,name:uA});if(E!=null&&E.value)return{disabledDrawPosition:w}}return{matchUp:S,targetDrawPosition:w,matchUpDrawPositionIndex:v}}function ca({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let o=i;t.length&&!o&&(o=t.find(s=>s.matchUpId===r));let{structure:a}=At({structureId:o==null?void 0:o.structureId,drawDefinition:n});return(a==null?void 0:a.finishingPosition)===Cy?aUe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:a,matchUp:o}):sUe({matchUp:o})}function aUe({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:i,structure:n,matchUp:r}){var M,N,R;let{winnerMatchUpId:o,loserMatchUpId:a}=r,{links:s}=rUe({roundNumber:r.roundNumber,structureId:n.structureId,drawDefinition:i}),l=s==null?void 0:s.source,c=DO({source:l,linkType:vp}),u=DO({linkCondition:bd,linkType:yd,source:l}),d=DO({source:l,linkType:yd}),p=u&&d;d||(d=u);let h=(M=c==null?void 0:c.target)==null?void 0:M.feedProfile,f=(N=d==null?void 0:d.target)==null?void 0:N.feedProfile,m=(R=u==null?void 0:u.target)==null?void 0:R.feedProfile,g,v,y,b,I,T,S,w,U,D;if(e&&(o||a)&&(S=o&&h!==Rl&&t.find(({matchUpId:A})=>A===o),b=a&&f!==Rl&&t.find(({matchUpId:A})=>A===a),S||b))return{matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c},targetMatchUps:{loserMatchUp:b,winnerMatchUp:S}};let{roundPosition:E}=r;D=D||t.filter(A=>A.structureId===n.structureId);let C=D.reduce((A,_)=>_.roundNumber===r.roundNumber&&!_.matchUpTieId?A+1:A,0);return d&&!b&&f!==Rl&&({matchUpDrawPositionIndex:T,targetDrawPosition:I,matchUp:b}=PO({targetLink:d,sourceRoundMatchUpCount:C,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),p&&m!==Rl&&({matchUpDrawPositionIndex:y,targetDrawPosition:v,matchUp:g}=PO({targetLink:u,sourceRoundMatchUpCount:C,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),c&&!S&&h!==Rl&&({matchUpDrawPositionIndex:U,targetDrawPosition:w,matchUp:S}=PO({targetLink:c,sourceRoundMatchUpCount:C,inContextDrawMatchUps:t,sourceRoundPosition:E,drawDefinition:i})),S||(D=D||t.filter(A=>A.structureId===n.structureId),{matchUp:S}=oUe({structureMatchUps:D,matchUp:r})),wt({matchUp:r,targetLinks:{loserTargetLink:d,winnerTargetLink:c,byeTargetLink:u},targetMatchUps:{winnerMatchUpDrawPositionIndex:U,loserMatchUpDrawPositionIndex:T,byeMatchUpDrawPositionIndex:y,winnerTargetDrawPosition:w,loserTargetDrawPosition:I,byeTargetDrawPosition:v,winnerMatchUp:S,loserMatchUp:b,byeMatchUp:g},targetMatchUpIds:!!(o||a)})}function sUe({matchUp:t}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:t}}function lUe({drawDefinition:t,inContextDrawMatchUps:e}){let i={};return e.forEach(n=>{var l,c,u,d,p,h;let{matchUpId:r,structureId:o,drawPositions:a=[]}=n,{structure:s}=At({drawDefinition:t,structureId:o});if((s==null?void 0:s.finishingPosition)===d0){let{roundNumber:f}=n,m=f&&Et(f)+1,g=s.matchUps??[],{roundMatchUps:v}=la({matchUps:g});if(m&&(v!=null&&v[m])){let y=[...a].sort(wr).map((b,I)=>{let T=v[m].find(S=>{var w;return(w=S.drawPositions)==null?void 0:w.includes(b)});return{matchUpId:T==null?void 0:T.matchUpId,roundNumber:m,schedule:T==null?void 0:T.schedule,sideNumber:I+1,structureName:s.structureName}});Object.assign(n,{sidesTo:y})}}else{let f=ca({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:r}),{winnerMatchUp:m}=f.targetMatchUps,{loserMatchUp:g}=f.targetMatchUps;!n.winnerMatchUpId&&m&&(n.winnerMatchUpId=m.matchUpId),!n.loserMatchUpId&&g&&(n.loserMatchUpId=g.matchUpId);let v=CO({upcomingMatchUp:m}),y=CO({upcomingMatchUp:g});if(n.matchUpStatus!==Ni&&(g==null?void 0:g.matchUpStatus)===Ni){let{matchUp:I}=fte({matchUp:g,drawDefinition:t,inContextDrawMatchUps:e})||{};y=I&&CO({upcomingMatchUp:I})||y}let b=(l=n.schedule)==null?void 0:l.timeAfterRecovery;if(b&&((c=v==null?void 0:v.schedule)!=null&&c.scheduledTime&&mi(v.schedule.scheduledTime)<mi(b)&&(i[v.matchUpId]=n.matchUpId,v.schedule.scheduleConflict=n.matchUpId),(u=y==null?void 0:y.schedule)!=null&&u.scheduledTime&&mi(y.schedule.scheduledTime)<mi(b)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:v,loserTo:y}),(d=n.drawPositions)==null?void 0:d.filter(Boolean).length){let I=((h=(p=f.targetLinks)==null?void 0:p.loserTargetLink)==null?void 0:h.linkCondition)===bd,T=cUe(n);if(T.length){let S=HF(m==null?void 0:m.sides),w=HF(g==null?void 0:g.sides),U=T.find(({participantId:E})=>S.includes(E))?[]:T,D=T.find(({participantId:E})=>w.includes(E))?[]:T;g&&I&&D.length<2&&D.push({bye:!0,tbd:!0}),U!=null&&U.length&&m&&(!f.targetMatchUpIds&&m&&(m=e.find(({matchUpId:E})=>E===m.matchUpId)),m.potentialParticipants||(m.potentialParticipants=[]),m.potentialParticipants.push(U)),D!=null&&D.length&&g&&(f.targetMatchUpIds||(m=e.find(({matchUpId:E})=>E===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(D))}}}}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function cUe(t){var e;return((e=t==null?void 0:t.sides)==null?void 0:e.map(({participant:i,participantId:n,qualifier:r})=>i||n&&{participantId:n}||r&&{qualifier:r}).filter(Boolean))||[]}function fte({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){var a;let{matchUpId:n,matchUpStatus:r,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===Gn)return{matchUp:t};if(r===Ni){let s;return t.winnerMatchUpId?s=i.find(({matchUpId:l})=>l===t.winnerMatchUpId):{winnerMatchUp:s}=((a=ca({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n}))==null?void 0:a.targetMatchUps)||{},fte({matchUp:s,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function CO(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:o,structureName:a})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:o,structureName:a}))(t.upcomingMatchUp)}function Tr(t){let e="getAllDrawMatchUps";Object.assign(t,{requireParticipants:!1});let i=v0(t);if(i.error)return se({result:i,stack:e});let{abandonedMatchUps:n,completedMatchUps:r,upcomingMatchUps:o,pendingMatchUps:a,byeMatchUps:s,matchUpsMap:l}=i;return{matchUps:(n??[]).concat(...r??[],...o??[],...a??[],...s??[]),matchUpsMap:l}}function v0(t){if(!(t!=null&&t.drawDefinition))return{error:lt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:o,requireParticipants:a,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:S}=t,w=[],U=[],D=[],E=[],C=[];v&&!i&&(i=jp({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:S}));let M;!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(I||s!=null&&s.withGroupings)&&(e!=null&&e.length)&&({participantsWithGroupings:e,groupInfo:M}=vj({participants:e,participantsProfile:s})));let{structures:N}=wd({drawDefinition:y});if(!N)return{error:Nn};n||(n=Uo({drawDefinition:y}));let R=y&&ute({drawDefinition:y}).exitProfiles;N.forEach(k=>{let{byeMatchUps:O=[],pendingMatchUps:F=[],upcomingMatchUps:B=[],completedMatchUps:$=[],abandonedMatchUps:V=[]}=MA({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,tournamentAppliedPolicies:o,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:a,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:R,matchUpsMap:n,structure:k,context:T,event:S});w=w.concat(...V),U=U.concat(...$),D=D.concat(...B),E=E.concat(...F),C=C.concat(...O)});let A=k=>(!h&&!b&&!p||(h&&(k=Jg({matchUps:k,...h})),p&&(k=Jg({matchUps:k,...p,processContext:!0}))),k),_={abandonedMatchUps:A(w),completedMatchUps:A(U),upcomingMatchUps:A(D),pendingMatchUps:A(E),byeMatchUps:A(C),matchUpsMap:n,...ae,groupInfo:M};if(b){let k=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:F,upcoming:B,pending:$,bye:V}=k,H=[].concat(...O&&w||[],...F&&U||[],...B&&D||[],...$&&E||[],...V&&C||[]);lUe({inContextDrawMatchUps:H,drawDefinition:y})}return _}function Am({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var r;if(!e)return{error:lt};let n={loserMatchUpIds:{},winnerMatchUpIds:{}};if(t||({matchUps:t,matchUpsMap:i}=Tr({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(o=>o.finishingPositionRange))&&((r=e==null?void 0:e.structures)==null?void 0:r.length)===1&&!(e!=null&&e.structures[0].structures)){let o=(i==null?void 0:i.drawMatchUps)??[];CD({matchUps:o})}return(t??[]).filter(({collectionId:o})=>!o).forEach(o=>{let{matchUpId:a,structureId:s}=o,l=ca({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=Em({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(h&&(d&&(n.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(o,{winnerMatchUpId:d})),p&&(n.loserMatchUpIds[h.matchUpId]=p,o.loserMatchUpId=p,h.loserMatchUpId=p,o.finishingPositionRange))){let f=u.finishingPositionRange&&[...o.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];o.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:n}}function mte(t){return t&&typeof String.fromCodePoint<"u"?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}function uUe(t){let e=Object.assign({},..._h.filter(i=>i.ioc).map(i=>({[i.ioc]:i.iso})));return mte(e[t])}var _h=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function gte({participant:t,withISO2:e,withIOC:i}){let{person:n,individualParticipants:r}=t,o=[n,r==null?void 0:r.map(({person:s})=>s)].flat().filter(Boolean);function a(s){let{nationalityCode:l}=s||{};if(l){let c=_h.find(({iso:u})=>u===l);i&&(c!=null&&c.ioc)&&!s.iocNationalityCode&&(s.iocNationalityCode=c.ioc),e&&(c!=null&&c.iso2)&&!s.iso2NationalityCode&&(s.iso2NationalityCode=c.iso2),c!=null&&c.label&&!s.countryName&&(s.countryName=c.label)}}o.forEach(a)}function dUe({participantMap:t,template:e}){var n;let i=Object.values(t);for(let r of i){let o=r.participant;if((n=o.individualParticipantIds)!=null&&n.length){o.individualParticipants=[];for(let a of o.individualParticipantIds){let s=t[a].participant;o.individualParticipants.push(e?kv({template:e,source:s}):s)}}}}function hg(t){var r;let{tournamentRecord:e,participantId:i}=t,n=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};for(let o of Object.values(n)){let a=(r=o.participants)==null?void 0:r.find(s=>s.participantId===i);if(a)return{participant:a,tournamentId:o.tournamentId}}return{error:Jn}}function Fu({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:n}){if(!n)return{error:gt,info:xV};if(e&&!Array.isArray(e))return{error:Pe,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:uV};let r=n.timeItems.filter(a=>(a==null?void 0:a.itemType)===i).filter(a=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=a==null?void 0:a.itemSubTypes)==null?void 0:l.includes(s)})).sort((a,s)=>{let l=new Date(a.createdAt||void 0).getTime(),c=new Date(s.createdAt||void 0).getTime();return l-c}),o=r.pop();if(o){let a={timeItem:o,...ae};return t&&Object.assign(a,{previousItems:r}),a}else return{info:_o}}function Rj({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Wc};if(!e.timeItems)return{info:_o};let{timeItem:r,previousItems:o,info:a}=Fu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:o}||{info:a}}function VD({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Vi};if(!n.timeItems)return{info:_o};let{timeItem:r,previousItems:o,info:a}=Fu({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:o}||{info:a}}function jD({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Ge};if(!e.timeItems)return{info:_o};let{timeItem:r,previousItems:o,info:a}=Fu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:o}||{info:a}}function Nj({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:Ge};if(!i)return{error:Rr};let o=hg({tournamentRecord:e,participantId:i});if(o.error)return o;let{participant:a}=o;if(!(a!=null&&a.timeItems))return{info:_o};let{timeItem:s,previousItems:l,info:c}=Fu({element:o.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:c}}var pUe={[ks]:"groupParticipantIds",[jt]:"pairParticipantIds",[en]:"teamParticipantIds"},hUe={[ks]:"groups",[en]:"teams"};function vte({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:o,withISO2:a,withIOC:s}){let l={};for(let c of i.participants??[]){let u=c==null?void 0:c.participantId;u&&gUe({participantMap:l,participantId:u})}for(let c of i.participants??[]){let u=dt(c,e,o),{participantId:d,individualParticipantIds:p,participantType:h}=u;if(Object.assign(l[d].participant,u),p&&mUe({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:h,participantId:d}),n&&(l[d].participant.signedIn=fUe(u)),r){let{ratings:f,rankings:m,seedings:g}=o0({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=f}(s||a)&&gte({participant:l[d].participant,withISO2:a,withIOC:s})}if(t){let c=ln(t)?t:void 0;dUe({participantMap:l,template:c})}return{participantMap:l}}function fUe(t){let{timeItem:e}=Fu({itemType:ED,element:t});return(e==null?void 0:e.itemValue)===GT}function mUe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(let o of t){let a=i[o].participant;if(a[pUe[n]].push(r),[en,ks].includes(n)){let{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e,p=hUe[n];a[p].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(n===jt){let s=t.find(l=>l!==o);i[o].pairIdMap[r]=s,i[o].pairIdMap[s]=r}}}function gUe({participantMap:t,participantId:e}){if(t[e])return;let i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[kn]:{...i},[an]:{...i},[en]:{...i},...i}}}function Ay({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var s;if(e)return{participantMap:(s=vte({...t,...n,tournamentRecord:i}))==null?void 0:s.participantMap};let o=dt(i.participants,!1,!0)||[];(t!=null&&t.withIOC||t!=null&&t.withISO2)&&o.forEach(l=>gte({participant:l,...t}));let a;if((r||t!=null&&t.withGroupings)&&(o!=null&&o.length)&&({participantsWithGroupings:o,groupInfo:a}=vj({participantsProfile:t,deepCopy:!1,participants:o})),(t==null?void 0:t.withScaleValues)&&(o==null?void 0:o.length))for(let l of o){let{ratings:c,rankings:u}=o0({participant:l});l.rankings=u,l.ratings=c}return{participants:o,groupInfo:a}}function Hp(t){let{participants:e=[],contextContent:i,participantMap:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:o,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:h,nextMatchUps:f,inContext:m,context:g,event:v}=t;if(!v)return{error:Vi};let{eventId:y,eventName:b,endDate:I,eventType:T,category:S,gender:w,matchUpFormat:U}=v??{},D={...g,...wt({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:U,eventName:b,eventType:T,category:S,eventId:y,gender:w})};I&&(D.endDate=I),p&&!i&&(i=jp({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v}));let E;if(!(e!=null&&e.length)&&!n&&u){let N=Ay({participantsProfile:a,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:m});n=N.participantMap,e=N.participants??[],E=N.groupInfo}let C=v.drawDefinitions??[],M=LD({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:C.flatMap(N=>{let{matchUps:R}=Tr({tournamentParticipants:e,tournamentAppliedPolicies:o,scheduleVisibilityFilters:r,context:D,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:N,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:M,nextMatchUps:f,inContext:m,event:v});return R??[]}),groupInfo:E}}function to(t){let e=Ei(t,[{tournamentRecord:!0}]);if(e.error)return e;if(!(t!=null&&t.tournamentRecord))return{error:Ge};let{participantMap:i,participants:n}=t,{scheduleVisibilityFilters:r,participantsProfile:o,afterRecoveryTimes:a,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,inContext:u=!0,contextProfile:d,matchUpFilters:p,contextFilters:h,nextMatchUps:f,context:m}=t,g=t.tournamentId??c.tournamentId,v=(c==null?void 0:c.events)??[];n||({participants:n,participantMap:i}=Ay({participantsProfile:o,useParticipantMap:s,policyDefinitions:l,tournamentRecord:c,contextProfile:d,inContext:u}));let{appliedPolicies:y}=Bi({tournamentRecord:c}),b={...m,tournamentId:g,indoorOutDoor:c.indoorOutdoor,surfaceCategory:c.surfaceCategory,endDate:c.endDate},I=jp({policyDefinitions:l,tournamentRecord:c,contextProfile:d});return{matchUps:v.flatMap(T=>{var S;return b.eventDrawsCount=((S=T.drawDefinitions)==null?void 0:S.length)??0,Hp({context:b,scheduleVisibilityFilters:r,tournamentAppliedPolicies:y,participantsProfile:o,afterRecoveryTimes:a,policyDefinitions:l,tournamentRecord:c,contextContent:I,contextFilters:h,contextProfile:d,matchUpFilters:p,participantMap:i,nextMatchUps:f,participants:n,inContext:u,event:T}).matchUps??[]}).concat(...c.matchUps??[])}}function xc({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l}){return typeof n!="object"||!Object.keys(n).length?{error:On}:{matchUps:Object.keys(n).map(c=>{let u=n[c];return to({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:u,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function _y(t,e){return vUe(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function vUe(t,e){return(Fv[t==null?void 0:t.stage]||0)-(Fv[e==null?void 0:e.stage]||0)}function Ia(t){let{participants:e,participantMap:i,contextContent:n}=t,{scheduleVisibilityFilters:r,tournamentAppliedPolicies:o,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,matchUpFilters:d,contextFilters:p,contextProfile:h,drawDefinition:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,endDate:T,eventType:S,category:w,gender:U,matchUpFormat:D}=y??{},E={...v,surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),matchUpFormat:D,eventType:S,eventName:I,category:w,eventId:b,endDate:T,gender:U},C;return!(e!=null&&e.length)&&!i&&u&&({participants:e=[],participantMap:i,groupInfo:C}=Ay({participantsProfile:a,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:h,inContext:g})),h&&!n&&(n=jp({policyDefinitions:l,tournamentRecord:u,contextProfile:h,drawDefinition:f,event:y})),{...Tr({context:E,tournamentAppliedPolicies:o,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:f,contextContent:n,contextFilters:p,contextProfile:h,matchUpFilters:d,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:C}}function nc(t){var y;let e=Ou(t),i=t.matchUps??[],n=t.drawIds??[],{includeParticipantDependencies:r,tournamentRecord:o,drawDefinition:a}=t;if(!Array.isArray(i))return{error:kd};if(!Array.isArray(n))return{error:Wc};let s=(y=t.matchUpIds)!=null&&y.length?t.matchUpIds:i.map(b=>b.matchUpId);if(!Array.isArray(s))return{error:Xw};let l={},c={},u={},d={};o&&!Object.keys(e).length&&(e={[o.tournamentId]:o});let p=Object.values(e),h=p.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(S=>S.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===gp),f=i;if(h.length){f=xc({nextMatchUps:!0,tournamentRecords:e}).matchUps;let b=h.reduce((I,T)=>{var U,D;let S=(U=T.source)==null?void 0:U.structureId,w=(D=T.target)==null?void 0:D.structureId;return S&&w&&(u[w]=S),S&&!I.includes(S)&&I.push(S),I},[]);for(let I of b)l[I]=[];for(let I of f??[]){let T=I.containerStructureId||I.structureId;b.includes(T)&&l[T].push(I.matchUpId)}}let m=b=>{c[b]||(c[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},d[b]=[])},g=(b,I)=>{c[b].matchUpIds.forEach(T=>{c[I].matchUpIds.push(T)}),c[I].matchUpIds.push(b),c[b].dependentMatchUpIds.push(I),r&&c[b].participantIds.forEach(T=>c[I].participantIds.push(T))},v=b=>{let I=Object.keys(l).length;for(let T of b||[]){let{matchUpId:S,winnerMatchUpId:w,loserMatchUpId:U}=T;if(!s.length||s.includes(S)){if(m(S),r){let{individualParticipantIds:C}=wA(T);c[S].participantIds=C}w&&(m(w),g(S,w),d[w].push(S)),U&&(m(U),g(S,U),d[U].push(S)),c[S].sources.push(d[S]);let D=d[S].map(C=>c[C].sources[0]).flat(),E=d[S].map(C=>c[C].sources[1]).flat();if(c[S].sources.push(D,E),I){let C=T.containerStructureId||T.structureId,M=u[C];if(l[M])for(let N of l[M])m(N),g(N,S),d[N].push(S)}}}};if(a)Am({drawDefinition:a}),f!=null&&f.length||(f=Ia({drawDefinition:a}).matchUps),v(f);else{if(f!=null&&f.length||(f=xc({nextMatchUps:!0,tournamentRecords:e}).matchUps),!n.length){let b=p!=null&&p.length?p.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:S})=>S))).flat(1/0):[];b&&(n=b)}for(let b of n){let I=f==null?void 0:f.filter(T=>T.drawId===b).sort(_y);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){let T=I==null?void 0:I.find(({tournamentId:w})=>w),{drawDefinition:S}=Ta({tournamentRecord:e[T==null?void 0:T.tournamentId],drawId:b});S&&Am({drawDefinition:S})}v(I)}}return{positionDependencies:l,matchUpDependencies:c,sourceMatchUpIds:d,matchUps:f,...ae}}function io(t){var d,p;let e=t==null?void 0:t.matchUp,i=(t==null?void 0:t.score)||(e==null?void 0:e.score),n=(d=i==null?void 0:i.sets)==null?void 0:d[0],{side1Score:r,side2Score:o,side1TiebreakScore:a,side2TiebreakScore:s,side1PointScore:l,side2PointScore:c}=n||{},u=r||o||a||s||l||c;return!!(((p=i==null?void 0:i.sets)==null?void 0:p.length)>1||u)}function HD({matchUpStatus:t}){return WV.includes(t)}function yUe({matchUpStatus:t}){return pA.includes(t)}function XF({matchUpStatus:t}){return qV.includes(t)}function Aj({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var s;let o=n==null?void 0:n.find(({participantId:l})=>l),a=(s=i==null?void 0:i.filter(Aj))==null?void 0:s.length;return io({score:r})||a||e&&o||t&&yUe({matchUpStatus:t})&&![Pi,Oi,Jl].includes(t)}function GD(t){var w;let{drawDefinition:e,findContainer:i,structureId:n,event:r}=t,o=t.structure,a={isCollectionMatchUp:!1},{containedStructures:s}=p0({drawDefinition:e}),l=n?s[n]||[]:[];if(!o){let U=At({drawDefinition:e,structureId:n});if(U.error)return U;o=i?U.containingStructure??U.structure:U.structure}if(ss({structure:o}))return{structure:o,isAdHoc:!0,error:Kw};let{matchUps:c}=Tr({inContext:!0,matchUpFilters:a,drawDefinition:e,event:r}),u=c==null?void 0:c.filter(U=>U.structureId===n||l.includes(U.structureId)),{matchUpDependencies:d}=nc({drawIds:[e.drawId],matchUps:c,drawDefinition:e}),p=[],h=[],f={},m=[];for(let U of c??[]){if(U.structureId===n||l.includes(U.structureId)){h.push(...U.drawPositions??[]);let D=U.roundNumber;for(let E of(U.drawPositions??[]).filter(Boolean))(!f[E]||D&&f[E]>D)&&(f[E]=D)}Aj(U)&&(m.push(U),p.push(U.matchUpId,...((w=d==null?void 0:d[U==null?void 0:U.matchUpId])==null?void 0:w.matchUpIds)||[]))}let g=Zt(h.filter(Boolean)).sort(wr),v=Zt(p),y=Zt(u==null?void 0:u.map(({matchUpId:U,drawPositions:D})=>v.includes(U)?D:[]).flat().filter(Boolean)).sort(wr),{positionAssignments:b}=Yi({drawDefinition:e,structure:o}),I=b==null?void 0:b.filter(U=>U.bye).map(U=>U.drawPosition),T=b==null?void 0:b.filter(U=>U.qualifier).map(U=>U.drawPosition),S=(g==null?void 0:g.filter(U=>!y.includes(U)))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:T,inactiveDrawPositions:S,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:o}}function $v({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(wr)[0]}}var ph={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},NM=[];function tl(t,e){typeof t=="string"&&(t={method:t}),(e||rl())&&NM.push(t)}function bUe(t){let e=NM.slice();return t&&(NM.length=0),e}function IUe(t){let e=bUe(t).map(i=>{let{color:n,keyColors:r,method:o,newline:a}=i,s=Object.keys(ph).includes(n)?ph[n]:ph.cyan,l=Object.keys(i).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{let d=r&&Object.keys(r).includes(u)&&ph[r[u]]?ph[r[u]]:ph.brightwhite;return`${ph.white}${u}: ${d}${i[u]}`}).join(", "),c=(o==null?void 0:o.length)<15?"		":"	";return[a?`
`:"",s,o,c,ph.white,l,ph.reset,`
`].join("")});e!=null&&e.length&&console.log(...e)}function wUe(){NM.length=0}function xs({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:o,structureId:a,structure:s,event:l}){var U,D,E;if(!n)return{error:lt};if(s||({structure:s}=At({drawDefinition:n,structureId:a})),!s)return{error:Nn};a||({structureId:a}=s);let c="assignDrawPositionBye";tl({method:c,color:"cyan",drawPosition:r}),o||(o=Uo({drawDefinition:n}));let{positionAssignments:u}=Yi({structure:s}),{activeDrawPositions:d}=GD({drawDefinition:n,structureId:a});if((U=u==null?void 0:u.find(C=>C.drawPosition===r))!=null&&U.bye)return{...ae};if(d!=null&&d.includes(r))return{error:GN};let p=u==null?void 0:u.find(C=>C.drawPosition===r);if(!p)return{error:Kw};let{filled:h,containsBye:f,assignedParticipantId:m}=SUe(p);if(f)return{...ae};if(h&&!f)return se({result:{error:_I},stack:c});let g=Tr({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[],v={isCollectionMatchUp:!1},{matchUps:y}=_i({provisionalPositioning:t,drawDefinition:n,matchUpFilters:v,matchUpsMap:o,structure:s});if(u==null||u.forEach(C=>{C.drawPosition===r&&(C.bye=!0)}),s.structureType===fa)return TUe({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:y}),Kh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),u6({assignedParticipantId:m,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:a,stack:c});let{roundProfile:b,roundMatchUps:I}=la({matchUps:y}),T=(D=b&&Object.keys(b).map(C=>parseInt(C)).reverse())==null?void 0:D.find(C=>{var M;return(M=b==null?void 0:b[C].drawPositions)==null?void 0:M.includes(r)}),S=T?I==null?void 0:I[T].find(({drawPositions:C})=>C==null?void 0:C.includes(r)):void 0;S&&yte({tournamentRecord:i,drawDefinition:n,matchUp:S,event:l});let w=(E=S==null?void 0:S.drawPositions)==null?void 0:E.find(C=>C!==r);if(S&&w){let C=_j({sourceDrawPositions:S.drawPositions,matchUpId:S.matchUpId,inContextDrawMatchUps:g,drawPositionToAdvance:w,tournamentRecord:i,drawDefinition:n,matchUpsMap:o});if(C.error)return C}return Kh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),u6({assignedParticipantId:m,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:a,stack:c})}function u6({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:n,structureId:r,stack:o}){return e&&IA({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:n,structureId:r,name:o}}),se({result:{...ae},stack:o})}function SUe(t){let e=t.bye,i=t.qualifier,n=t.participantId;return{containsBye:e,containsQualifier:i,assignedParticipantId:n,filled:e||i||n}}function yte({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:Ni,score:void 0,winningSide:void 0}),yi({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function TUe({tournamentRecord:t,drawDefinition:e,drawPosition:i,matchUps:n,event:r}){n.forEach(o=>{var a;(a=o.drawPositions)!=null&&a.includes(i)&&yte({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,matchUp:o})})}function _j({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:o,matchUpId:a,event:s}){var b,I;tl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});let l=o.drawMatchUps.find(T=>T.matchUpId===a),c=(b=e.find(T=>T.matchUpId===a))==null?void 0:b.structureId,{structure:u}=At({drawDefinition:r,structureId:c}),{positionAssignments:d}=Yi({structure:u}),p=d==null?void 0:d.filter(T=>T.bye).map(T=>T.drawPosition),h=(I=l==null?void 0:l.drawPositions)==null?void 0:I.find(T=>T!==t),f=h&&(p==null?void 0:p.includes(h)),{targetLinks:{loserTargetLink:m},targetMatchUps:{loserMatchUp:g,winnerMatchUp:v,loserTargetDrawPosition:y}}=ca({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:a});if(v&&v.structureId===(u==null?void 0:u.structureId)&&UUe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:v,matchUpsMap:o,event:s}),g&&f&&g.structureId!==(u==null?void 0:u.structureId)){let{roundNumber:T}=g;if(T===1){let S=xs({structureId:m.target.structureId,drawPosition:y,tournamentRecord:n,drawDefinition:r,event:s});if(S.error)return S}else bte({loserTargetDrawPosition:y,tournamentRecord:n,loserTargetLink:m,drawDefinition:r,loserMatchUp:g,matchUpsMap:o,event:s})}return{...ae}}function UUe({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:o,matchUpsMap:a,event:s}){var R,A,_,k,O,F;let l="advanceWinner",c=a.drawMatchUps.find(B=>B.matchUpId===o.matchUpId),u=(R=e.find(B=>B.matchUpId===o.matchUpId))==null?void 0:R.structureId,{structure:d}=At({drawDefinition:r,structureId:u}),{positionAssignments:p}=Yi({structure:d}),h=(A=p==null?void 0:p.find(({drawPosition:B})=>B===t))==null?void 0:A.bye,f=(_=c.drawPositions)==null?void 0:_.filter(Boolean),m=p==null?void 0:p.filter(B=>f==null?void 0:f.includes(B.drawPosition)),g=p==null?void 0:p.find(({drawPosition:B})=>B===t),v=i==null?void 0:i.find(B=>B!==t),y=(k=v&&(m==null?void 0:m.find(({drawPosition:B})=>B===v)))==null?void 0:k.bye,b=h&&y;if(b&&console.log({isByeAdvancedBye:b}),(f==null?void 0:f.length)>1&&h&&!y)return se({result:{error:_I},stack:l});let I=f==null?void 0:f.find(B=>B!==t),T=b,S=[...(c.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),w=S.map(B=>!B&&!T||B===t?(T=!0,t):B).sort(wr);if(!T)return console.log("@@@@@@@",{advancingAssignmentIsBye:g,drawPositionToAdvance:t,existingAssignments:m}),se({result:{error:_I},stack:l});let U=(O=p==null?void 0:p.find(({drawPosition:B})=>B===I))==null?void 0:O.bye,D=(F=p==null?void 0:p.find(({drawPosition:B})=>B===t))==null?void 0:F.bye;Object.assign(c,{matchUpStatus:D||U?Ni:Gn,score:void 0,winningSide:void 0,drawPositions:w});let E=c.drawPositions.find(B=>!S.includes(B));tl({method:l,color:"brightyellow",changedDrawPosition:E,pairedDrawPositionIsBye:U,drawPositionIsBye:D}),yi({tournamentId:n==null?void 0:n.tournamentId,matchUp:c,eventId:s==null?void 0:s.eventId,context:l,drawDefinition:r});let{targetLinks:{loserTargetLink:C},targetMatchUps:{loserMatchUp:M,loserTargetDrawPosition:N}}=ca({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:r});if(U||D){let B=U?t:I;if(B)_j({drawPositionToAdvance:B,matchUpId:o.matchUpId,inContextDrawMatchUps:e,tournamentRecord:n,drawDefinition:r,matchUpsMap:a});else if(D&&C&&M)if(M.feedRound)bte({loserTargetDrawPosition:N,tournamentRecord:n,loserTargetLink:C,drawDefinition:r,loserMatchUp:M,matchUpsMap:a});else{let $=1-o.roundPosition%2,V=M.drawPositions[$],H=xs({structureId:C.target.structureId,drawPosition:V,tournamentRecord:n,drawDefinition:r,event:s});if(H.error)return H}}}function bte({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:o,event:a}){let{roundNumber:s}=r;tl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});let l=((o==null?void 0:o.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=$v({drawPosition:t,matchUps:l});if(c===s){let u=xs({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:a});if(u.error)return u}}function Ite({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:o}){let{matchUps:a}=_i({drawDefinition:i,matchUpsMap:n,structure:r,event:o});a.forEach(s=>{let l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Ni:Gn}),yi({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:o==null?void 0:o.eventId,drawDefinition:i,matchUp:s}))})}function zD(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t,{tournamentRecord:r,drawDefinition:o,structureId:a,matchUpsMap:s,event:l}=t,{structure:c}=At({drawDefinition:o,structureId:a}),u=(jr({drawDefinition:o,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:Zw};i||(i=u==null?void 0:u.participantId);let{activeDrawPositions:d}=GD({drawDefinition:o,structureId:a});return d.includes(n)?{error:GN}:(e||({matchUps:e}=Tr({inContext:!0,drawDefinition:o,matchUpsMap:s})),JF({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,structureId:a,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(Kh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:o,structure:c,event:l}),{...ae,participantId:i}):{error:EJ})}function JF({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:o,event:a}){var v,y;let{structure:s}=At({drawDefinition:i,structureId:o});if(!s)return{error:Nn};let l=jr({drawDefinition:i,structure:s}).positionAssignments||[],c=l.some(b=>{if(b.drawPosition===n)return delete b.participantId,delete b.qualifier,delete b.bye,!0});if(s.structureType===fa)return Ite({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:s}),{drawPositionCleared:c,...ae};let u={isCollectionMatchUp:!1},{matchUps:d}=_i({drawDefinition:i,matchUpFilters:u,matchUpsMap:r,structure:s,event:a}),{roundProfile:p,roundMatchUps:h}=la({matchUps:d}),f=(v=p&&Object.keys(p))==null?void 0:v.map(b=>Et(b)),m=n,g=(y=f==null?void 0:f.map(b=>{var M,N,R,A;let I=(N=(M=p==null?void 0:p[b])==null?void 0:M.pairedDrawPositions)==null?void 0:N.find(_=>_.includes(m)),T=I==null?void 0:I.find(_=>_!==m),S=l.find(_=>_.drawPosition===T),w=p==null?void 0:p[b+1],U=S==null?void 0:S.bye,D=(R=w==null?void 0:w.pairedDrawPositions)==null?void 0:R.find(_=>_.includes(T)),E=U&&D&&w&&((A=w.drawPositions)==null?void 0:A.includes(T)),C=I&&{pairedDrawPositionByeAdvancedPair:!E&&D,pairedDrawPosition:T,targetDrawPosition:m,relevantPair:I,roundNumber:b};return E&&(m=T),C}).filter(b=>b==null?void 0:b.targetDrawPosition))==null?void 0:y.reduce((b,I)=>{let{roundNumber:T,relevantPair:S,targetDrawPosition:w,pairedDrawPosition:U,pairedDrawPositionByeAdvancedPair:D}=I,E={roundNumber:T,targetDrawPosition:w,relevantPair:S},C=D&&{roundNumber:T+1,targetDrawPosition:U,relevantPair:D,subsequentRoundRemoval:!0},M=[E,C].filter(Boolean);return b.concat(...M)},[]);return g==null||g.forEach(({roundNumber:b,targetDrawPosition:I,relevantPair:T})=>{let S=h==null?void 0:h[b].find(w=>{var U;return sa((U=w.drawPositions)==null?void 0:U.filter(Boolean),T.filter(Boolean))});S&&(DUe({inContextDrawMatchUps:t,targetDrawPosition:I,tournamentRecord:e,drawDefinition:i,structureId:o,roundNumber:b,matchUpsMap:r}),wte({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:S,drawPosition:n,matchUpsMap:r,structure:s,event:a}))}),{tasks:g,drawPositionCleared:c,positionAssignments:l}}function DUe({inContextDrawMatchUps:t,targetDrawPosition:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,roundNumber:o,structureId:a}){let{structure:s}=At({drawDefinition:n,structureId:a});if(!s)return{error:Nn};if(s.structureType===fa)return;r=r||Uo({drawDefinition:n});let l=((r==null?void 0:r.mappedMatchUps)||{})[a].matchUps,{initialRoundNumber:c}=$v({drawPosition:e,matchUps:l}),u=l==null?void 0:l.filter(p=>{var h;return p.roundNumber>=o&&p.roundNumber!==c&&((h=p.drawPositions)==null?void 0:h.includes(e))}),d=Yi({drawDefinition:n,structureId:a}).positionAssignments??[];return u==null||u.forEach(p=>wte({drawPosition:e,targetMatchUp:p,inContextDrawMatchUps:t,positionAssignments:d,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,structure:s})),{...ae}}function wte({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:o,matchUpsMap:a,structure:s,event:l}){var w,U,D,E,C,M;let c="removeDrawPosition",u=(w=r.drawPositions)==null?void 0:w.slice(),d=r.matchUpStatus,p=r.winningSide;a=a??Uo({drawDefinition:n});let h=a.mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:f}=$v({drawPosition:o,matchUps:h});if(r.roundNumber&&f&&r.roundNumber>f){let N=(r.drawPositions??[]).map(R=>R===o?void 0:R);r.drawPositions=N}if(r.matchUpType===sn){let N=(((U=t==null?void 0:t.find(R=>R.matchUpId===r.matchUpId))==null?void 0:U.sides)??[]).reduce((R,A,_)=>A.drawPosition===o?_:R,void 0);N!==void 0&&((E=(D=r.sides)==null?void 0:D[N])!=null&&E.lineUp)&&((C=r.sides)==null||delete C[N].lineUp,yi({tournamentId:i==null?void 0:i.tournamentId,context:`${c}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}let m=ca({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:g},targetMatchUps:{loserMatchUp:v,winnerMatchUp:y,loserMatchUpDrawPositionIndex:b}}=m,I=e.filter(({drawPosition:N})=>{var R;return(R=r.drawPositions)==null?void 0:R.includes(N)}).filter(N=>N.bye).length,T=I&&Ni||r.matchUpStatus&&[Pi,Oi].includes(r.matchUpStatus)&&r.matcHUpStatus||((M=r.drawPositions)==null?void 0:M.length)===2&&Gn||void 0;r.matchUpStatus=T,r.matchUpStatus&&[Oi,Pi].includes(r.matchUpStatus)&&(r.winningSide=void 0);let S=u==null?void 0:u.find(N=>{var R;return!((R=r.drawPositions)!=null&&R.includes(N))});if(u!=null&&u.includes(o)&&d===r.matchUpStatus&&p===r.winningSide||(S&&tl({method:c,color:"brightyellow",removedDrawPosition:S}),yi({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${c}-${o}`,drawDefinition:n})),v&&v.structureId!==m.matchUp.structureId&&!I){let{drawPositions:N,roundNumber:R}=v;if(R===1){let A=N[b];JF({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:a})}else{let A=Math.min(...N.filter(Boolean)),_=PUe({loserMatchUpDrawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:v,matchUpsMap:a,event:l});if(_.error)return se({result:_,stack:c});let k=((a==null?void 0:a.mappedMatchUps)||{})[v.structureId].matchUps,{initialRoundNumber:O}=$v({drawPosition:A,matchUps:k});O===1&&(tl({method:c,color:"brightyellow",loserMatchUpDrawPosition:A}),JF({structureId:v.structureId,drawPosition:A,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:a}))}}return y&&y.structureId!==m.matchUp.structureId&&g.target.feedProfile,{...ae}}function PUe({loserMatchUpDrawPosition:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:o,event:a}){var c;let{structure:s}=At({structureId:r.structureId,drawDefinition:n}),{positionAssignments:l}=Yi({structure:s});if((c=l==null?void 0:l.find(u=>u.drawPosition===t))!=null&&c.bye){let u=zD({drawPosition:t,structureId:r.structureId,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,matchUpsMap:o,event:a});if(u.error)return u}return{...ae}}function fg({drawDefinition:t,stages:e}){if(!t)return{error:lt};let i=((t==null?void 0:t.structures)??[]).filter(r=>!(e!=null&&e.length)||r.stage&&e.includes(r.stage)),n=Zt(i.map(r=>{let{positionAssignments:o}=Yi({structure:r});return o?o.map(ai):[]}).flat().filter(Boolean));return{...ae,assignedParticipantIds:n}}function Cc(t){let e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{let{entryStage:o,entryStatus:a}=r,s=`_${o||ut}${a||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,o)=>i(r.entryPosition)-i(o.entryPosition)).map((r,o)=>{let a=o+1;return{...r,entryPosition:a}})).flat()}function em(t){return[sg,Ql].includes(t)}function AM({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:o,entryStage:a,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var D,E,C,M,N,R,A,_,k,O,F,B;if(!r||!Array.isArray(r))return{error:bu,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Vi};if(o&&!Fee.includes(o))return{error:OF};if(a&&!ZV.includes(a))return{error:ig};let p="modifyEntriesStatus",h=[];if(!o&&!s)return se({result:{error:gt},info:"Missing entryStatus",stack:p});if(s&&!Iu({extension:s,requiredAttributes:["name"]}))return se({result:{error:Pe},info:"Invalid extension",context:{extension:s},stack:p});let f=[];(D=d==null?void 0:d.drawDefinitions)==null||D.forEach($=>{let V=fg({stages:u&&[u],drawDefinition:$}).assignedParticipantIds??[];f.push(...V)});let m=(i==null?void 0:i.participants)??[];if(!r.every($=>{var H;let V=(H=zh({tournamentParticipants:m,participantId:$}))==null?void 0:H.participantType;return!(V&&[jt,el].includes(V)&&em(o))&&!(o&&(d!=null&&d.eventType)&&V===si&&[Gl,al].includes(d.eventType)&&[Ol,...DE].includes(o))}))return{error:OF};let g=d&&Kn({event:d}).flightProfile,v=(E=g==null?void 0:g.flights)==null?void 0:E.find($=>$.drawId===c),y=$=>{let V=($||[]).filter(z=>!u||!z.entryStage||u===z.entryStage).filter(({participantId:z})=>r.includes(z)),H=z=>o&&f.includes(z.participantId)&&!(DE.includes(z.entryStatus)&&DE.includes(o));return V.every(z=>H(z)&&!e?!1:(o&&(z.entryStatus=o,delete z.entryPosition),a&&(z.entryStage=a,delete z.entryPosition),s&&(s.value?Ui({element:z,extension:s}):ta({element:z,name:s.name})),!0))?{...ae}:{error:Qw}},b=({flight:$,drawDefinition:V})=>{d&&(d.entries=Cc({entries:d.entries??[]})),$&&($.drawEntries=Cc({entries:$.drawEntries})),V&&(V.entries=Cc({entries:V.entries}))},I=$=>{let{flight:V,drawDefinition:H}=$,z="updateDrawEntries";if(V){let G=y(V.drawEntries);if(G.error)return se({result:G,stack:z})}if(H){let G=y(H.entries);if(G.error)return se({result:G,stack:z});h.includes(H.drawId)||h.push(H.drawId)}return{...ae}},T=((C=d==null?void 0:d.entries)==null?void 0:C.find(({entryPosition:$})=>$))??(((M=v==null?void 0:v.drawEntries)==null?void 0:M.find(({entryPosition:$})=>$))||((N=n==null?void 0:n.entries)==null?void 0:N.find(({entryPosition:$})=>$)));if(t&&!T&&b({flight:v,drawDefinition:n}),v||n){let $=I({flight:v,drawDefinition:n});if($.error)return se({result:$,stack:p})}let S=((R=d==null?void 0:d.drawDefinitions)==null?void 0:R.map(({drawId:$})=>$))??[],w=((A=g==null?void 0:g.flights)==null?void 0:A.filter($=>!S.includes($.drawId)))||[];for(let $ of w){let V=$&&I({flight:$});if(V!=null&&V.error)return se({result:V,stack:p})}let U=((_=g==null?void 0:g.flights)==null?void 0:_.length)===1&&(((k=d==null?void 0:d.drawDefinitions)==null?void 0:k.length)??0)<=((O=g==null?void 0:g.flights)==null?void 0:O.length);if(!v&&!n&&o&&Lee.includes(o))return{error:cQ};if(!v&&!n||o===bp||l&&U){let $=y(d==null?void 0:d.entries);if($!=null&&$.error)return se({result:$,stack:p});let V;if(o===bp&&((F=g==null?void 0:g.flights)==null||F.every(H=>{let z=y(H.drawEntries);return z.error?(V=z.error,!1):(H.drawEntries=H.drawEntries.filter(({participantId:G})=>!r.includes(G)),!0)}),(B=d==null?void 0:d.drawDefinitions)==null||B.every(H=>{var G;let z=y(H.entries);return z.error?(V=z.error,!1):(H.entries=(G=H.entries)==null?void 0:G.filter(({participantId:W})=>!r.includes(W)),!0)})),V)return se({result:{error:V},stack:p})}t&&b({flight:v,drawDefinition:n});for(let $ of(d==null?void 0:d.drawDefinitions)??[])h.length&&!h.includes($.drawId)||cn({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...ae}}function Ste(t){let{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:o,matchUpType:a,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===Ni||e[i].scheduleItems.push({...u,scheduledDate:Wt(u==null?void 0:u.scheduledDate),scheduledTime:hn(u==null?void 0:u.scheduledTime),checkScoreHasValue:io({score:p}),matchUpStatus:n,roundPosition:r,structureId:o,matchUpType:a,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function ad({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n,r;if(!i)return{error:Sy};if(!ln(e))return{error:Pe};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){let{accessor:o,scaleType:a,eventType:s,scaleName:l}=e,c=[_v,a,s,l].join("."),u=i.timeItems.filter(d=>(d==null?void 0:d.itemType)===c).filter(d=>!t||(d==null?void 0:d.itemDate)).sort((d,p)=>(d.createdAt?new Date(d.createdAt).getTime():0)-(p.createdAt?new Date(p.createdAt).getTime():0)).pop();if(u){let[d,p,h,f]=((n=u.itemType)==null?void 0:n.split("."))??[];if(d!==_v)return{error:mD};let m=((r=o&&dv({element:u.itemValue,accessor:o}))==null?void 0:r.value)||u.itemValue,g={eventType:h,scaleDate:u.itemDate,scaleValue:m,scaleName:f,scaleType:p};return{...ae,scaleItem:g}}}return{...ae,scaleItem:void 0}}function CUe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var u,d,p;let o={},a=h=>[_v,rd,r.eventType,h].join("."),s=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===rd).map(({itemType:h,itemValue:f})=>({[h]:f}))),l=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(a),c=Hn(Object.keys(s),l);if((!e||!Object.keys(s).length&&!((u=t==null?void 0:t.drawIds)!=null&&u.length)||c.length)&&c.length){if(t!=null&&t.stageSeedingScaleNames){let h=Object.keys(t.stageSeedingScaleNames).map(m=>{let g=a(t.stageSeedingScaleNames[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);o.seedAssignments=f}else if(c){let h=c.map(f=>s[f]);o.seedValue=h.pop()}}else if(!e&&typeof i=="object"){let h=Object.keys(i).map(m=>{let g=a(i[m]),v=s[g];return[m,v]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);o.seedAssignments=f}else{let{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean),g;for(let v of m){let y={eventType:r.eventType,scaleType:rd,scaleName:v},b=ad({scaleAttributes:y,participant:n});if(b.scaleItem){g=b.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((p=(d=t==null?void 0:t.published)==null?void 0:d.drawIds)!=null&&p.length))){let v=g.scaleValue;o.seedValue=v}}return o}function EUe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:o,ranking:a,entry:s}){let{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},..._V(d??[])):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:a,eventId:o});i.events[o]=wt(h,!1,!1,!0),n&&(e&&(i.events[o].seedAssignments=e),r&&(i.events[o].seedValue=r))}function RA(t,e){return(t||"").localeCompare(e||"")}function MUe({tournamentRecord:t,status:e=ic}){var n,r,o;let i=`${ug}.${dg}`;return(o=(r=(n=jD({tournamentRecord:t,itemType:i}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:o[e]}function RUe(t){let{tournamentId:e}=t??{};return!!e}function fl({event:t,status:e=ic}){var n,r,o;let i=`${ug}.${dg}`;return(o=(r=(n=VD({itemType:i,event:t}))==null?void 0:n.timeItem)==null?void 0:r.itemValue)==null?void 0:o[e]}function kj({drawDetails:t,drawId:e}){var i,n;return(n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail)==null?void 0:n.published}function ky(t){var p,h,f,m,g,v,y;let{tournamentRecord:e,drawDefinition:i,eventIds:n,eventId:r,drawIds:o,drawId:a,event:s}=t??{};if(e&&!RUe(e))return{error:Pe};if(r&&!s)return{error:rs};if(Array.isArray(n)&&(n!=null&&n.length)){let b={};for(let I of n){if(!oa(I))return{error:Pe};let T=(p=Ta({tournamentRecord:e,eventId:I}))==null?void 0:p.event;if(!T)return{error:rs};let S=EO({event:T});b[I]=S}return{...ae,publishState:b}}if(s){let b=EO({event:s}),I={};if(a)return i?{publishState:{status:{published:!!((h=b.status.publishedDrawIds)!=null&&h.includes(a)),drawDetail:(f=b.status.drawDetails)==null?void 0:f[a]},...ae}}:{error:ns};if(Array.isArray(o)&&(o!=null&&o.length)){let T=((m=s.drawDefinitions)==null?void 0:m.map(FT))??[];for(let S of o){if(!oa(S))return{error:Pe};if(!T.includes(S))return{error:ns};I[S]={status:{published:!!b.status.publishedDrawIds.includes(S),drawDetail:(g=b.status.drawDetails)==null?void 0:g[S]}}}}else I=b;return{...ae,publishState:I}}let l=[],c=!1,u={},d=MUe({tournamentRecord:e});u.tournament=d??{};for(let b of(e==null?void 0:e.events)??[]){let I=EO({event:b});u[b.eventId]=I,I.status.published&&(l.push(b.eventId),c=!0);for(let{drawId:T}of b.drawDefinitions??[]){let S=(y=(v=I.status)==null?void 0:v.publishedDrawIds)==null?void 0:y.includes(T);S&&(u[T]={status:{published:S}})}}return e&&(u.tournament.status={published:c,publishedEventIds:l}),{...ae,publishState:u}}function EO({event:t}){var o;let e=fl({event:t});if(!e)return{status:{published:!1}};let i={published:void 0,seedingScaleNames:[],drawIds:[]};e.seeding&&Object.assign(i,e.seeding);let n=e.drawDetails??{};for(let a of((o=t.drawDefinitions)==null?void 0:o.map(FT))||[])n[a]||(n[a]={publishingDetail:{published:!1}});let r=n&&Object.keys(n).length&&Object.keys(n).filter(a=>kj({drawDetails:n,drawId:a}))||e.drawIds;return{status:{published:r&&r.length>0,publishedDrawIds:r,publishedSeeding:i,drawDetails:n}}}function NUe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:o,stageSequence:a,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){let p=e[o],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:a,winCount:0,structureId:l,drawId:u});let f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===Oi&&(f.walkoverWinCount+=1),r===Pi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=s),i===1&&(f.participantWon=n))}function d6(t){var A,_,k,O,F,B,$,V,H,z;let{withScheduleItems:e,scheduleAnalysis:i,withTeamMatchUps:n,participantMap:r,withOpponents:o,withMatchUps:a,withEvents:s,withDraws:l,finishingPositionRange:c,finishingRound:u,matchUpStatus:d,stageSequence:p,roundNumber:h,structureId:f,score:m,stage:g,withRankingProfile:v,tieWinningSide:y,roundPosition:b,matchUpTieId:I,matchUpSides:T,collectionId:S,matchUpType:w,winningSide:U,matchUpId:D,schedule:E,eventId:C,drawId:M,sides:N}=t,R=o&&(N==null?void 0:N.length)===2&&Object.assign({},...N.map(({sideNumber:G},W)=>{let K=N[1-W].participantId;return G&&{[G]:K}}).filter(Boolean));for(let G of N){let{participantId:W,sideNumber:K,bye:Z}=G;if(Z)continue;let Y=U===K,X=J=>{var re,me;let ie=(re=r[J])==null?void 0:re.participant,oe=ie==null?void 0:ie.participantType,ne=[{participantId:J,participantType:oe}];if(oe!==el)for(let he of(ie==null?void 0:ie.individualParticipantIds)||[]){let be=(me=r[he])==null?void 0:me.participant;ne.push({participantType:be==null?void 0:be.participantType,participantId:he})}return ne},Q=(J,ie)=>{if(a){if(r[J].matchUps[D]={participantWon:Y,matchUpType:w,structureId:f,sideNumber:K,matchUpId:D,eventId:C,drawId:M,stage:g},o){let oe=X(ie);r[J].matchUps[D].opponentParticipantInfo=oe}S&&(r[J].matchUps[D].collectionId=S)}o&&ie&&(r[J].opponents[ie]={participantId:ie,matchUpId:D,eventId:C,drawId:M}),v&&NUe({finishingPositionRange:c,participantMap:r,participantWon:Y,finishingRound:u,matchUpStatus:d,participantId:J,stageSequence:p,roundNumber:h,structureId:f,matchUpId:D,drawId:M,stage:g}),(i||e)&&Ste({participantMap:r,participantId:J,matchUpStatus:d,roundPosition:b,matchUpType:w,roundNumber:h,structureId:f,matchUpId:D,schedule:E,drawId:M,score:m})},te=({participant:J,partnerParticipantId:ie})=>{var ne,re,me;let oe=(he,be)=>{he&&(he.partnerParticipantIds||(he.partnerParticipantIds=[]),he.partnerParticipantIds.includes(be)||he.partnerParticipantIds.push(be))};l&&oe((ne=J==null?void 0:J.draws)==null?void 0:ne[M],ie),s&&oe((re=J==null?void 0:J.events)==null?void 0:re[C],ie),a&&oe((me=J==null?void 0:J.matchUps)==null?void 0:me[D],ie)};if(W&&r[W]){let J=R==null?void 0:R[K];Q(W,J);let ie=((A=r[W])==null?void 0:A.participant.participantType)===jt,oe=((_=r[W])==null?void 0:_.participant.individualParticipantIds)||[];if(I){if(n){let ne=re=>r[re].matchUps[I]={participantWon:y===K,matchUpId:I,matchUpType:sn,sideNumber:K};ne(W),oe.forEach(ne)}if(l&&!r[W].draws[M]){let ne=(O=(k=T.find(he=>he.sideNumber===K))==null?void 0:k.participant)==null?void 0:O.participantId,re=($=(B=(F=r[ne])==null?void 0:F.draws)==null?void 0:B[M])==null?void 0:$.entryStatus,me=he=>r[he].draws[M]={entryStatus:re,eventId:C,drawId:M};me(W),oe.forEach(me)}}if(ie&&(oe.forEach(ne=>r[ne]&&Q(ne,J)),oe.forEach((ne,re)=>{let me=oe[1-re],he=r[ne];he&&te({participant:he,partnerParticipantId:me})}),s&&T)){let ne=(H=(V=T.find(re=>re.sideNumber===K))==null?void 0:V.participant)==null?void 0:H.participantId;if(ne){let re=(z=r[ne])==null?void 0:z.events[C];re?(r[W].events[C]={...re},oe.forEach(me=>r[me].events[C]={...re})):console.log("Missing teamEntry",{eventId:C,teamParticipantId:ne})}}if(U){let ne=re=>{Y?(r[re].counters[w].wins+=1,r[re].counters.wins+=1,d===Oi&&(r[re].counters[w].walkoverWins+=1,r[re].counters.walkoverWins+=1),d===Pi&&(r[re].counters[w].defaultWins+=1,r[re].counters.defaultWins+=1)):(r[re].counters[w].losses+=1,r[re].counters.losses+=1,d===Oi&&(r[re].counters[w].walkovers+=1,r[re].counters.walkovers+=1),d===Pi&&(r[re].counters[w].defaults+=1,r[re].counters.defaults+=1))};ne(W),oe.forEach(ne)}}}}function AUe(t){var N,R,A,_,k,O,F;let{participantFilters:e,convertExtensions:i,policyDefinitions:n,tournamentRecord:r,usePublishState:o,contextProfile:a,participantMap:s,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:h,withOpponents:f,withMatchUps:m,withSeeding:g,withEvents:v,withDraws:y}=t,b=e==null?void 0:e.participantIds,I=B=>{var V,H;let $=[B];return(H=(V=s[B])==null?void 0:V.participant.individualParticipantIds)==null||H.forEach(z=>$.push(z)),$.some(z=>!(b!=null&&b.length)||b.includes(z))?$:[]},T={withMatchUps:m||c,withEvents:v||c,withDraws:y||c,withPotentialMatchUps:l,withRankingProfile:c,withScheduleItems:u,scheduleAnalysis:d,withTeamMatchUps:p,withStatistics:h,participantMap:s,withOpponents:f,withSeeding:g},S=[],w={},U=[],D={},E={},C={},M=({eventType:B,scaleNames:$,participantId:V})=>{var H,z,G,W;return(W=(G=(z=(H=s[V].participant)==null?void 0:H.rankings)==null?void 0:z[B])==null?void 0:G.find(K=>$.includes(K.scaleName)))==null?void 0:W.scaleValue};for(let B of(r==null?void 0:r.events)||[]){if(e!=null&&e.eventIds&&!e.eventIds.includes(B.eventId))continue;let{drawDefinitions:$=[],extensions:V=[],eventType:H,eventName:z,category:G,entries:W,eventId:K,gender:Z}=B,{flightProfile:Y}=Kn({event:B}),X=(Y==null?void 0:Y.flights)??[],Q=ky({event:B}).publishState;Q&&(D[K]=Q);let te=(N=Q==null?void 0:Q.status)==null?void 0:N.publishedSeeding;if(v||g||c){let ie=i?Object.assign({},..._V(V??[])):{};E[K]={...ie,eventName:z,eventType:H,category:G,eventId:K,gender:Z};let oe=[G==null?void 0:G.categoryName,G==null?void 0:G.ageCategoryCode].filter(Boolean);for(let ne of W){let{participantId:re}=ne;if(!re||!s[re])continue;let me=M({eventType:H,scaleNames:oe,participantId:re}),he,be;if(g){let De=s[re].participant;({seedAssignments:he,seedValue:be}=CUe({publishedSeeding:te,usePublishState:o,withSeeding:g,participant:De,event:B}))}let Se=De=>{var xe,$e;if(($e=(xe=s[De])==null?void 0:xe.events)!=null&&$e[K])return;let Oe=s[De];EUe({convertExtensions:i,seedAssignments:he,participant:Oe,withSeeding:g,seedValue:be,eventId:K,ranking:me,entry:ne})};Se(re),(s[re].participant.individualParticipantIds||[]).forEach(Se)}}let J=(R=D==null?void 0:D[K])==null?void 0:R.publishedSeeding;if(y||c||g){let ie=ne=>ne?Object.assign({},...ne.map(({participantId:re,seedValue:me,seedNumber:he})=>({[re]:{seedValue:me,seedNumber:he}}))):void 0,oe=Zt([...$.map(FT),...X.map(FT)]);for(let ne of oe){let re=$.find(ue=>ue.drawId===ne),me=X==null?void 0:X.find(ue=>ue.drawId===ne),he=(re==null?void 0:re.entries)||(me==null?void 0:me.drawEntries),{structures:be=[],drawOrder:Se,drawName:De,drawType:Oe}=re??{},xe=me==null?void 0:me.flightNumber,$e=[G==null?void 0:G.categoryName,G==null?void 0:G.ageCategoryCode].filter(Boolean),Ae=((re==null?void 0:re.structures)||[]).sort((ue,de)=>Ey(ue,de)).map(({structureId:ue,structures:de})=>[ue,...(de||[]).map(({structureId:_e})=>_e)]).flat(1/0),ve,ke,ye,Ie,Ne=0,Fe=be.filter(({stage:ue,stageSequence:de})=>ue===ut&&de===1||ue===Tt).flatMap(ue=>{let{seedAssignments:de,stageSequence:_e,stage:Ue}=ue,{positionAssignments:Ce}=Yi({structure:ue});return Ue===ut?(Ne=(Ce==null?void 0:Ce.length)??0,ye=Ce,Ie=de):_e===1&&(ve=Ce,ke=de),Ce}).map(({participantId:ue})=>ue).filter(Boolean),Le=ie(Ie),ge=ie(ke),Ee=re?he.filter(({participantId:ue})=>Fe.includes(ue)):he,we=!o||(J==null?void 0:J.published)&&(((A=J==null?void 0:J.drawIds)==null?void 0:A.length)===0||((_=J==null?void 0:J.drawIds)==null?void 0:_.includes(ne)));for(let ue of Ee){let{entryStatus:de,entryStage:_e,entryPosition:Ue,participantId:Ce}=ue,We=M({participantId:Ce,scaleNames:$e,eventType:H}),He=Be=>{var pt,Ke,ci,ni,Ht;if((pt=s[Be].draws)!=null&&pt[ne])return;let et=g&&we,ot=et?{}:void 0,mt=et?((Ke=Le==null?void 0:Le[Ce])==null?void 0:Ke.seedValue)||((ci=Le==null?void 0:Le[Ce])==null?void 0:ci.seedNumber):void 0,Rt=mt?Le==null?void 0:Le[Ce]:void 0,Ft=et?((ni=ge==null?void 0:ge[Ce])==null?void 0:ni.seedValue)||((Ht=ge==null?void 0:ge[Ce])==null?void 0:Ht.seedNumber):void 0,Je=Ft?ge==null?void 0:ge[Ce]:void 0;ot&&mt&&(ot[ut]=Rt),ot&&Ft&&(ot[Tt]=Je);let _t=mt||Ft;_t&&(s[Be].participant.seedings[H]||(s[Be].participant.seedings[H]=[]),Rt&&s[Be].participant.seedings[H].push({...Rt,scaleName:ne}),Je&&s[Be].participant.seedings[H].push({...Je,scaleName:ne}),ot&&(s[Be].events[K].seedAssignments||(s[Be].events[K].seedAssignments={}),Object.keys(ot).forEach(Zi=>s[Be].events[K].seedAssignments[Zi]=ot[Zi]))),(y||c)&&(s[Be].draws[ne]=wt({seedAssignments:ot,entryPosition:Ue,entryStatus:de,entryStage:_e,seedValue:_t,eventId:K,ranking:We,drawId:ne},!1,!1,!0))};[Ql,sg].includes(de)||(He(Ce),(k=s[Ce].participant.individualParticipantIds||[])==null||k.forEach(He))}let fe=((re==null?void 0:re.structures)??[]).reduce((ue,de)=>(ue.includes(de.stage)||ue.push(de.stage),ue),[]),Te=((re==null?void 0:re.links)??[]).length;C[ne]={qualifyingPositionAssignments:ve,qualifyingSeedAssignments:ke,mainPositionAssignments:ye,qualifyingSeedingMap:ge,mainSeedAssignments:Ie,orderedStructureIds:Ae,mainSeedingMap:Le,flightNumber:xe,linksCount:Te,drawOrder:Se,drawName:De,drawType:Oe,drawSize:Ne,drawId:ne,stages:fe}}}if(c||d||p||h||f||m||y){let ie=!!d||l,oe=((O=Hp({afterRecoveryTimes:!!d,policyDefinitions:n,tournamentRecord:r,inContext:!0,contextProfile:a,participantMap:s,nextMatchUps:ie,event:B}))==null?void 0:O.matchUps)??[];for(let ne of oe){let{finishingPositionRange:re,potentialParticipants:me,tieMatchUps:he=[],sides:be=[],winningSide:Se,matchUpType:De,matchUpId:Oe,eventId:xe,drawId:$e,collectionId:Ae,stageSequence:ve,finishingRound:ke,matchUpStatus:ye,roundPosition:Ie,roundNumber:Ne,structureId:Fe,schedule:Le,score:ge,stage:Ee}=ne;w[Oe]=ne;let we={finishingPositionRange:re,finishingRound:ke,stageSequence:ve,roundPosition:Ie,collectionId:Ae,roundNumber:Ne,structureId:Fe,schedule:Le,eventId:xe,drawId:$e,score:ge,stage:Ee};d6({...we,...T,matchUpStatus:ye,winningSide:Se,matchUpType:De,matchUpId:Oe,sides:be});for(let fe of he){let{winningSide:Te,sides:ue=[],matchUpId:de,matchUpStatus:_e,matchUpType:Ue}=fe;d6({...we,...T,winningSide:Te,tieWinningSide:Se,matchUpTieId:Oe,matchUpId:de,sides:ue,matchUpSides:be,matchUpStatus:_e,matchUpType:Ue})}Array.isArray(me)&&(ie||d||u)&&((F=me.flat().map(ai).filter(Boolean))==null||F.forEach(fe=>{var Te;(Te=I(fe))==null||Te.forEach(ue=>{s[ue]&&(s[ue].potentialMatchUps[Oe]=wt({tournamentId:r==null?void 0:r.tournamentId,matchUpId:Oe,eventId:xe,drawId:$e}))}),(d||u)&&Ste({potential:!0,participantMap:s,participantId:fe,matchUpStatus:ye,roundPosition:Ie,structureId:Fe,matchUpType:De,roundNumber:Ne,matchUpId:Oe,schedule:Le,drawId:$e,score:ge})}))}U.push(...oe)}}if(h||c||d){let B=Object.values(s);for(let $ of B){let{wins:V,losses:H,[kn]:{wins:z,losses:G},[an]:{wins:W,losses:K}}=$.counters,Z=(Y,X,Q)=>{let te=X+Q,J=X,ie=te&&J/te;$.statistics[Y]={denominator:te,numerator:J,statValue:ie,statCode:Y}};if(h&&(Z(PE,V,H),Z(`${PE}.${kn}`,z,G),Z(`${PE}.${an}`,W,K)),c){let Y=(X=[])=>Math.abs(X[0]-X[1]);for(let X of Object.keys($.draws)){let{orderedStructureIds:Q=[],flightNumber:te}=C[X]||{};if($.structureParticipation&&Q.length){let J,ie=0,oe=Q.map(ne=>{let re=$.structureParticipation[ne];if(!re)return;J||(J=re==null?void 0:re.finishingPositionRange),Y(J)>Y(re==null?void 0:re.finishingPositionRange)&&(J=re==null?void 0:re.finishingPositionRange);let me=re.stage!==Tt;return me&&(ie+=1),wt({...re,participationOrder:me?ie:void 0,flightNumber:te})}).filter(Boolean);$.draws[X]&&($.draws[X].finishingPositionRange=J,$.draws[X].structureParticipation=oe)}}}if(d){let Y=ln(d)?d.scheduledMinutesDifference:0,X=$.scheduleItems||[],Q=$.potentialMatchUps||{},te=X.reduce((ie,oe)=>{let{scheduledDate:ne,scheduledTime:re}=oe;return ie[ne]||(ie[ne]=[]),re&&ie[ne].push(oe),ie},{});Object.values(te).forEach(ie=>ie.sort(oee));for(let ie of X){let{typeChangeTimeAfterRecovery:oe,timeAfterRecovery:ne,scheduledDate:re,scheduledTime:me}=ie,he=te[re],be=mi(me);for(let Se of he){if(Se.matchUpId===ie.matchUpId||[Oi,Pi].includes(Se.matchUpStatus)&&!Se.checkScoreHasValue)continue;let De=ie.matchUpType!==Se.matchUpType&&oe||ne,Oe=ie.drawId===Se.drawId,xe=Q[ie.matchUpId]&&Q[Se.matchUpId],$e=mi(Se.scheduledTime),Ae=Math.abs($e-be),ve=$e>=be;if((Y&&!isNaN(Y)?Ae<=Y:ve&&mi(Se.scheduledTime)<mi(De))&&!(xe&&Oe)&&ve){let ke=[ie.matchUpId,Se.matchUpId].sort(RA).join("|");$.scheduleConflicts[ke]={priorScheduledMatchUpId:ie.matchUpId,matchUpIdWithConflict:Se.matchUpId}}}}let J=$.participant.participantId;Object.keys($.scheduleConflicts).length&&S.push(J),s[J].scheduleConflicts=$.scheduleConflicts}}}return{participantIdsWithConflicts:S,eventsPublishStatuses:D,derivedEventInfo:E,derivedDrawInfo:C,mappedMatchUps:w,participantMap:s,matchUps:U}}function WD({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var I;if(!Object.keys(t).length)return i;let{accessorValues:n,drawEntryStatuses:r,positionedParticipants:o,eventEntryStatuses:a,participantRoles:s,participantRoleResponsibilities:l,participantTypes:c,participantIds:u,signInStatus:d,enableOrFiltering:p,eventIds:h,genders:f}=t,m=Wu(h)&&((I=e==null?void 0:e.events)==null?void 0:I.filter(T=>h==null?void 0:h.includes(T.eventId)))||(e==null?void 0:e.events)||[],g=r&&_Ue({drawEntryStatuses:r,tournamentEvents:m}),v=a&&kUe({eventEntryStatuses:a,tournamentEvents:m}),y=o!==void 0&&[!0,!1].includes(o)&&m.reduce((T,S)=>T.concat(...(S.drawDefinitions||[]).map(w=>Dee({drawDefinition:w}).allPositionedParticipantIds).filter(Boolean)),[]),b=T=>n==null?void 0:n.reduce((S,w)=>{let{accessor:U,value:D}=w,{values:E}=dv({element:T,accessor:U});return S&&(E==null?void 0:E.includes(D))},!0);if(i=i==null?void 0:i.filter(T=>{var N,R;let S=(R=(N=Fu({element:T,itemType:ED}))==null?void 0:N.timeItem)==null?void 0:R.itemValue,{participantRoleResponsibilities:w,participantType:U,participantRole:D,participantId:E,person:C}=T,M=Array.isArray(f)&&(f==null?void 0:f.length)&&(C==null?void 0:C.sex)&&f.includes(C.sex);return p?f&&M||o&&y.includes(E)||o===!1&&!y.includes(E)||(g==null?void 0:g.includes(E))||(v==null?void 0:v.includes(E))||(u==null?void 0:u.includes(E))||d&&S===d||c&&U&&Wu(c)&&c.includes(U)||s&&D&&Wu(s)&&s.includes(D)||l&&Wu(w)&&Wu(l)&&l.find(A=>w==null?void 0:w.includes(A))||(n==null?void 0:n.length)&&Wu(n)&&b(T):(!f||M)&&(o===void 0||o&&y.includes(E)||o===!1&&!y.includes(E))&&(!g||g.includes(E))&&(!v||v.includes(E))&&(!u||u.includes(E))&&(!d||S===d)&&(!c||U&&Wu(c)&&c.includes(U))&&(!s||D&&Wu(s)&&s.includes(D))&&(!l||Wu(w)&&Wu(l)&&l.find(A=>w==null?void 0:w.includes(A)))&&(!(n!=null&&n.length)||Wu(n)&&b(T))}),m.length&&h){let T=m.filter(S=>h.includes(S.eventId)).map(S=>{let w=(S.entries||[]).map(D=>D.participantId);if(jn(Sd)(S.eventType))return w;let U=((e==null?void 0:e.participants)??[]).filter(D=>w.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return w.concat(...U)}).flat(1);i=i==null?void 0:i.filter(S=>T.includes(S.participantId))}return i}function Wu(t){return t&&Array.isArray(t)&&t.length}function _Ue({drawEntryStatuses:t,tournamentEvents:e}){let i=({entryStatus:n})=>Array.isArray(t)?t.includes(n):!0;return Zt(e.reduce((n,r)=>{var l,c;let{flightProfile:o}=Kn({event:r}),a=((l=o==null?void 0:o.flights)==null?void 0:l.map(({drawEntries:u})=>Array.isArray(u)?u.filter(i).map(ai):[]).flat())||[],s=((c=r.drawDefinitions)==null?void 0:c.map(({entries:u})=>u?u.filter(i).map(ai):[]))||[];return n.concat(...a,...s)},[]))}function kUe({eventEntryStatuses:t,tournamentEvents:e}){return Zt(e.reduce((i,n)=>{let r=(n.entries||[]).filter(({entryStatus:o})=>Array.isArray(t)?t.includes(o):!0).map(ai);return i.concat(...r)},[]))}function zn(t){var H;let{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:o,policyDefinitions:a,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,contextProfile:f,withStatistics:m,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:b,withEvents:I,withDraws:T,withISO2:S,withIOC:w}=t;if(!l)return{error:Ge};(v||r)&&nc({tournamentRecord:l});let{participantMap:U}=vte({convertExtensions:o,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:y,withISO2:S,withIOC:w}),D=AUe({withMatchUps:v??r,withEvents:I??r,withDraws:T??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:o,withScheduleItems:s,policyDefinitions:a,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:m,participantMap:U,withOpponents:g,contextProfile:f,withSeeding:b}),{participantIdsWithConflicts:E,eventsPublishStatuses:C,derivedEventInfo:M,derivedDrawInfo:N,mappedMatchUps:R}=D,A=D.matchUps;U=D.participantMap;let _=c??n,k=({potentialMatchUps:z,scheduleConflicts:G,scheduleItems:W,participant:K,statistics:Z,opponents:Y,matchUps:X,events:Q,draws:te})=>{let J=Object.values(te),ie=Object.values(Y);return g&&(J==null||J.forEach(oe=>{oe.opponents=ie.filter(ne=>ne.drawId===oe.drawId)})),wt({...K,scheduleConflicts:c?Object.values(G):void 0,draws:T||r?J:void 0,events:I||r?Object.values(Q):void 0,matchUps:v||r?Object.values(X):void 0,opponents:g?ie:void 0,potentialMatchUps:_?Object.values(z):void 0,statistics:m?Object.values(Z):void 0,scheduleItems:s?W:void 0},!1,!1,!0)},O=new Map;for(let z of Object.keys(U))O.set(z,k(U[z]));let F=[...O.values()],B=(H=a==null?void 0:a[s0])==null?void 0:H.participant,$=WD({participants:F,participantFilters:i,tournamentRecord:l});if(e){let z=ln(e)?e:void 0;for(let G of $)for(let W of G.individualParticipantIds??[]){G.individualParticipants||(G.individualParticipants=[]);let K=O.get(W);G.individualParticipants.push(z?kv({template:z,source:K}):K)}}let V=B?$.map(z=>kv({source:z,template:B})):$;return{participantIdsWithConflicts:E,eventsPublishStatuses:C,derivedEventInfo:M,derivedDrawInfo:N,mappedMatchUps:R,participantMap:U,participants:V,...ae,matchUps:A}}function pv({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var o;if(!e)return{error:lt};let r=(o=e.entries)==null?void 0:o.find(a=>a.participantId===t&&(!i||i===a.entryStatus)&&(!n||n===a.entryStage));return t&&r}function y0(t){var h,f,m,g,v,y,b,I,T;let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,structureId:r,stage:o}=t;if(!i)return{error:lt};let{entryProfile:a}=MD({drawDefinition:i}),s=o&&n&&((m=(f=(h=a==null?void 0:a[o])==null?void 0:h.stageSequence)==null?void 0:f[n])==null?void 0:m.qualifiersCount)||o&&((g=a==null?void 0:a[o])==null?void 0:g.qualifiersCount)||0,l={};if(!r)return{qualifiersCount:s,roundQualifiersCounts:l};let{structure:c}=At({drawDefinition:i,structureId:r}),u=(v=i.links)==null?void 0:v.filter(S=>{var w;return((w=S==null?void 0:S.target)==null?void 0:w.structureId)===(c==null?void 0:c.structureId)}),d=0;if(u!=null&&u.length)for(let S of u){let w=(y=At({structureId:S.source.structureId,drawDefinition:i}))==null?void 0:y.structure;if((w==null?void 0:w.stage)===Tt){let U=S.source.roundNumber,D=S.target.roundNumber,E=0;if(w.structureType===fa){let C=((b=w.structures)==null?void 0:b.length)??0,M=((I=S.source.finishingPositions)==null?void 0:I.length)??0;E=C*M}else E=((T=_i({matchUpFilters:{roundNumbers:[U]},structure:w,afterRecoveryTimes:!1,provisionalPositioning:e,inContext:!1}).matchUps)==null?void 0:T.length)||0;l[D]||(l[D]=0),l[D]+=E,d+=E}}let p=Object.keys(l);if(p.length<=1){let S=p[0]||1;l[S]=Math.max(l[S]||0,s)}return d=Math.max(d,s),{qualifiersCount:d,roundQualifiersCounts:l}}function _M({stage:t,drawDefinition:e}){var n;let{entryProfile:i}=MD({drawDefinition:e});return((n=i==null?void 0:i[t])==null?void 0:n.drawSize)||0}function xUe(t){let{provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r}=t,o=_M({stage:r,drawDefinition:i}),{qualifiersCount:a}=y0({provisionalPositioning:e,drawDefinition:i,stageSequence:n,stage:r});return o&&o-a}function Tte({stage:t,drawDefinition:e}){return!!(t===Xr||bj({stage:t,drawDefinition:e})&&_M({stage:t,drawDefinition:e}))}function Ute({entryStatus:t=Ds,drawDefinition:e,stageSequence:i,stage:n}){if(t===Ol)return fTe({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...ae}:{error:lQ};let r=xUe({drawDefinition:e,stageSequence:i,stage:n}),o=mTe({drawDefinition:e,stage:n}),a=zF({entryStatus:WI,drawDefinition:e,stage:n}),s=zF({entryStatus:Ds,drawDefinition:e,stage:n}),l=a+s,c=l>=r,u=r-l;return n!==Xr&&c?{error:LF}:t===WI?a<o?{...ae}:{error:LF}:{positionsAvailable:u,...ae}}function Dte(t){let{entryStatus:e=Ds,entryStageSequence:i,entryStage:n=ut,ignoreStageSpace:r,drawDefinition:o,entryPosition:a,participant:s,roundTarget:l,extensions:c,extension:u,drawType:d}=t,p="addDrawEntry";if(!o)return{error:lt};if(!n)return{error:K$};if(d!==jl&&!Tte({stage:n,drawDefinition:o}))return se({result:{error:ig},stack:p});let h=Ute({stageSequence:i,stage:n,drawDefinition:o,entryStatus:e});if(!r&&!h.success&&(!d||d!==jl))return{error:h.error};if(u&&!Iu({extension:u}))return se({result:{error:Pe},info:"Invalid extension",context:{extension:u},stack:p});let f=t.participantId||(s==null?void 0:s.participantId);if(!f)return se({result:{error:Rr},stack:p});let m=e===yp&&pv({participantId:f,drawDefinition:o,entryStatus:e}),g=n===Xr&&pv({participantId:f,drawDefinition:o,entryStage:n}),v=e!==yp&&n!==Xr&&pv({drawDefinition:o,participantId:f});if(v||m||g)return se({context:{invalidEntry:v,invalidLuckyLoser:m,invalidVoluntaryConsolation:g},result:{error:ZN},stack:p});let y=wt({entryStageSequence:i,participantId:f,entryPosition:a,entryStatus:e,entryStage:n,extensions:c});return u&&Ui({element:y,extension:u}),l&&Ui({extension:{name:"roundEntry",value:l},element:y}),o.entries||(o.entries=[]),o.entries.push(y),cn({drawDefinition:o}),{...ae}}function OUe(t){let e="addDrawEntries",{entryStatus:i=Ds,stage:n=ut,autoEntryPositions:r=!0,ignoreStageSpace:o,drawDefinition:a,participantIds:s,stageSequence:l,roundTarget:c,extension:u}=t;if(!n)return{error:K$};if(!a)return{error:lt};if(!Array.isArray(s))return{error:xl};if(!Tte({stage:n,drawDefinition:a}))return{error:ig};if(u&&!Iu({extension:u}))return se({result:{error:Pe},info:"Invalid extension",context:{extension:u},stack:e});let d=Ute({drawDefinition:a,stageSequence:l,entryStatus:i,stage:n});if(!o&&!d.success)return{error:d.error};let p=d.positionsAvailable??0;if(!o&&n!==Xr&&p<s.length)return{error:rV};let h=s.reduce((f,m)=>{let g=i===yp&&pv({participantId:m,drawDefinition:a,entryStatus:i}),v=n===Xr&&pv({entryStage:n,drawDefinition:a,participantId:m});return i!==yp&&n!==Xr&&pv({drawDefinition:a,participantId:m})||g||v?f.concat(m):f},[]);return s.filter(f=>f&&!h.includes(f)).forEach(f=>{let m={entryStageSequence:l,entryStage:n,participantId:f,entryStatus:i};u&&Ui({element:m,extension:u}),c&&Ui({extension:{name:xu,value:c},element:m}),a.entries||(a.entries=[]),a.entries.push(m)}),r&&(a.entries=Cc({entries:a.entries})),cn({drawDefinition:a}),h!=null&&h.length?{info:"some participantIds could not be added",participantIdsNotAdded:h,...ae}:{...ae}}function xj({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:o,roundTarget:a,entryStage:s,extension:l,drawId:c,event:u}){if(!(r!=null&&r.length))return{error:yf};if(!u)return{error:rs};if(!c)return{error:Wc};let d=(u.entries||[]).map(ai);if(r.filter(f=>!d.includes(f)).length)return{error:$J};if(n){let f=OUe({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:o,roundTarget:a,extension:l});if(f.error)return f}let{flightProfile:p}=Kn({event:u}),h=p==null?void 0:p.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(r.forEach(f=>{let m=o===yp&&MO({participantId:f,entryStatus:o,flight:h}),g=s===Xr&&MO({participantId:f,entryStage:s,flight:h});!(o!==yp&&s!==Xr&&MO({flight:h,participantId:f}))&&!m&&!g&&h.drawEntries.push({participantId:f,entryStatus:o,entryStage:s})}),t&&(h.drawEntries=Cc({entries:h.drawEntries}))),{...ae}}function MO({participantId:t,entryStatus:e,entryStage:i,flight:n}){var o;let r=(o=n.drawEntries)==null?void 0:o.find(a=>a.participantId===t&&(!e||e===a.entryStatus)&&(!i||i===a.entryStage));return t&&r}function qD({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var d,p,h,f;let o="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Vi};if(!Array.isArray(e)||e.some(m=>!oa(m)))return se({result:{error:bu},stack:o});let a=(r.drawDefinitions??[]).flatMap(m=>fg({drawDefinition:m}).assignedParticipantIds??[]),s=((i==null?void 0:i.length)&&((d=r.entries)==null?void 0:d.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(ai).filter(m=>!a.includes(m)),l=(n&&((p=r.entries)==null?void 0:p.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(ai).filter(m=>!a.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||s.includes(m))&&(!n||l.includes(m))):s.length&&l.length?e=Hn(s,l):s.length?e=s:l.length&&(e=l),(e==null?void 0:e.length)&&a.some(m=>e.includes(m)))return se({result:{error:Qw},stack:o});if(!(e!=null&&e.length))return{...ae,participantIdsRemoved:[]};let c=[];r.entries=(r.entries??[]).filter(m=>{let g=!e.includes(m==null?void 0:m.participantId);return g||c.push(m.participantId),g}),t&&(r.entries=Cc({entries:r.entries}));let{flightProfile:u}=Kn({event:r});return(h=u==null?void 0:u.flights)==null||h.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(f=r.drawDefinitions)==null||f.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...ae,participantIdsRemoved:c}}var Pte={[Zr]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}},b0=Pte;function sd(t){var N,R;let{entryStatus:e=Ds,autoEntryPositions:i=!0,enforceGender:n=!0,participantIds:r=[],entryStageSequence:o,policyDefinitions:a,entryStage:s=ut,tournamentRecord:l,ignoreStageSpace:c,drawDefinition:u,roundTarget:d,extensions:p,extension:h,drawId:f,event:m}=t,g="addEventEntries";if(!m)return{error:Vi};if(!(r!=null&&r.length))return se({result:{error:yf},stack:g});if(!(m!=null&&m.eventId))return{error:rs};let v=Bi({tournamentRecord:l,event:m}).appliedPolicies??{},y=(a==null?void 0:a[Zr])??(v==null?void 0:v[Zr])??b0[Zr],b=(n??((N=y==null?void 0:y.participants)==null?void 0:N.enforceGender))!==!1,I=[],T=[];if(p&&(!Array.isArray(p)||!p.every(A=>Iu({extension:A})))||h&&!Iu({extension:h}))return se({context:wt({extension:h,extensions:p}),result:{error:Pe},info:"Invalid extension(s)",stack:g});let S=!!l,w=[],U,D=((R=l==null?void 0:l.participants)==null?void 0:R.filter(A=>{var O,F,B;if(!r.includes(A.participantId))return!1;let _=jn(kn)(m.eventType)&&A.participantType===si&&!em(e),k=m.eventType===an&&A.participantType===jt;return _&&(!m.gender||!b||[ts,Tu].includes(m.gender)||m.gender===((O=A.person)==null?void 0:O.sex))||k&&!em(e)||m.eventType===an&&A.participantType===si&&em(e)?!0:_&&m.gender&&b&&![ts,Tu].includes(m.gender)&&m.gender!==((F=A.person)==null?void 0:F.sex)?(w.push({participantId:A.participantId,sex:(B=A.person)==null?void 0:B.sex}),!1):m.eventType===en&&(A.participantType===en||em(e)&&A.participantType===si)}).map(A=>A.participantId))??[],E=r.filter(A=>!S||D.includes(A));m.entries||(m.entries=[]);let C=m.entries.map(A=>{var _;return A.participantId||((_=A.participant)==null?void 0:_.participantId)});if(E.forEach(A=>{var _;if(!C.includes(A)){let k=wt({participantId:A,entryStatus:e,entryStage:s,extensions:p});h&&Ui({element:k,extension:h}),d&&Ui({extension:{name:xu,value:d},element:k}),o&&(k.entryStageSequence=o),I.push(k.participantId),(_=m.entries)==null||_.push(k)}}),f&&!em(s)){let A=xj({participantIds:E,autoEntryPositions:i,entryStageSequence:o,ignoreStageSpace:c,drawDefinition:u,entryStatus:e,roundTarget:d,entryStage:s,extension:h,drawId:f,event:m});A.error&&(U=A.error)}if(m.eventType&&[Zh,al].includes(m.eventType)){let A=(m.entries||[]).map(F=>F.participantId),_=(m.entries||[]).filter(F=>em(F.entryStatus)).map(F=>F.participantId),k=((l==null?void 0:l.participants)??[]).filter(F=>A.includes(F.participantId)&&F.participantType&&[jt,en].includes(F.participantType)).map(F=>F.individualParticipantIds).flat(1/0),O=_.filter(F=>k.includes(F));O.length&&(T.push(...O),qD({participantIds:O,autoEntryPositions:!1,event:m}))}if(E.length!==r.length)return se({context:{mismatchedGender:w,gender:m.gender},result:{error:xl},stack:g});i&&(m.entries=Cc({entries:m.entries||[]}));let M=I.length-T.length;return se({result:{...ae,addedEntriesCount:M},stack:g,info:U})}var Cte="ADMINISTRATION",LUe="CAPTAIN",FUe="COACH",Mo="COMPETITOR",Ete="MEDIA",Mte="MEDICAL",Oj="OFFICIAL",Rte="OTHER",Nte="SECURITY",Pf={ADMINISTRATION:Cte,CAPTAIN:LUe,COACH:FUe,COMPETITOR:Mo,MEDIA:Ete,MEDICAL:Mte,OFFICIAL:Oj,OTHER:Rte,SECURITY:Nte};function Lj({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){let o="removeIndividualParticipantIds";if(!n)return se({result:{error:Ge},stack:o});if(!i||!e)return se({result:{error:gt},stack:o});let a=(n.participants??[]).find(u=>u.participantId===i);if(!a)return se({result:{error:Jn},stack:o});if(![en,ks].includes(a.participantType))return se({result:{participantType:a.participantType,error:_c},stack:o});let s=Ate({individualParticipantIds:e,groupingParticipant:a,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=s;if(c)return se({result:s,stack:o});if(t)for(let u of n.events??[]){let d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){let p=l==null?void 0:l.filter(h=>!d.includes(h));sd({participantIds:p,entryStatus:Ql,tournamentRecord:n,event:u})}}return l&&di({topic:wo,payload:{tournamentId:n.tournamentId,participants:[a]}}),{...ae,...s}}function Ate({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:o}){var p,h;let a=[];if(!e)return{removed:a};let s=[],l=[];o||({participants:o,mappedMatchUps:r}=zn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));let c=(h=(p=o==null?void 0:o.find(({participantId:f})=>f===e.participantId))==null?void 0:p.events)==null?void 0:h.map(({eventId:f})=>f),u=(e.individualParticipantIds??[]).filter(f=>{var y;let m=t==null?void 0:t.includes(f),g=m&&((y=o==null?void 0:o.find(b=>b.participantId===f))==null?void 0:y.matchUps.filter(({eventId:b})=>c.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||io({score:I}))),v=m&&!(g!=null&&g.length);if(m&&!v&&l.push(f),v){a.push(f);for(let b of i.events??[])for(let I of b.drawDefinitions??[]){let{extension:T}=Qt({element:I,name:fp}),S=T==null?void 0:T.value[e.participantId];T&&S&&(T.value[e.participantId]=S.filter(U=>U.participantId!==f),Ui({element:I,extension:T}),PD({drawDefinition:I}));let w=Ia({drawDefinition:I,inContext:!1}).matchUps??[];for(let U of w){let D=U.sides??[];for(let E of D){let C=E.lineUp??[];C.find(M=>M.participantId===f)&&(E.lineUp=C.filter(M=>M.participantId!==f),yi({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:U}))}}}}else s.push(f);return!v});e.individualParticipantIds=u;let d={groupingParticipantId:e.participantId,cannotRemove:l,notRemoved:s,removed:a};return l.length&&!n&&{...d,cannotRemove:l,error:KN}||d}function NA({participantRole:t=Mo,individualParticipantIds:e=[],groupingTypes:i=[el,ks],tournamentRecord:n}){if(!n)return{error:Ge};let r=n.participants??[],{participants:o,mappedMatchUps:a}=zn({withMatchUps:!0,tournamentRecord:n,withEvents:!0}),s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{let{removed:c}=Ate({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:a,participants:o});c&&s++}),s?ae:{error:nQ}}function xy(t){var h,f,m;if(!(t!=null&&t.tournamentRecord))return{error:Ge};if(!((h=t==null?void 0:t.participantIds)!=null&&h.length))return{error:yf};let{addIndividualParticipantsToEvents:e,tournamentRecord:i,participantIds:n}=t,r=((f=i.participants)==null?void 0:f.length)||0;if(!r)return{...ae};let o=(m=i.events||[])==null?void 0:m.filter(({eventType:g})=>g===Or).map(g=>{var v;return(v=g==null?void 0:g.drawDefinitions)==null?void 0:v.map(({drawId:y})=>y)}).flat(1/0),a=zn({participantFilters:{participantIds:n},tournamentRecord:i,withDraws:!0}).participants??[],s=()=>{let g=(to({matchUpFilters:{drawIds:o,matchUpTypes:[an]},tournamentRecord:i}).matchUps??[]).map(({sides:v})=>v==null?void 0:v.map(({participantId:y})=>y)).flat().filter(Boolean);return Hn(g,n)},l=(o==null?void 0:o.length)&&s(),c=a.filter(g=>{var v;return(v=g.draws)==null?void 0:v.filter(y=>(!(o!=null&&o.length)||!(o!=null&&o.includes(y.drawId)))&&y.positionAssignments).length});if(l!=null&&l.length||c.length)return{error:Qw};let u={},d={};for(let g of i.events||[]){let v=qD({participantIds:n,event:g});if(v.error)return v;u[g.eventId]=v.participantIdsRemoved}i.participants=i.participants.filter(g=>{let v=n.includes(g.participantId)||g.participantType===jt&&g.individualParticipantIds.some(y=>n.includes(y));if(!v&&g.participantType===Or&&g.individualParticipantIds.some(y=>n.includes(y))&&(g.individualParticipantIds=g.individualParticipantIds.filter(y=>!n.includes(y))),v&&e&&[jt,en].includes(g.participantType))for(let y of g.individualParticipantIds||[])n.includes(y)||(d[g.participantId]||(d[g.participantId]=[]),d[g.participantId].push(y));return!v});let p=r-i.participants.length;if(NA({individualParticipantIds:n,tournamentRecord:i}),e)for(let g of i.events||[]){let v=u[g.eventId].map(y=>d[y]||[]).flat();sd({participantIds:v,entryStatus:Ql,tournamentRecord:i,event:g})}return p&&di({payload:{participantIds:n,tournamentId:i.tournamentId},topic:oj}),p?{...ae,participantsRemovedCount:p}:{error:KN}}function _te({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:o}){var l;let a=r.entries??[];if(n){let{flightProfile:c}=Kn({event:r}),u=(l=c==null?void 0:c.flights)==null?void 0:l.find(d=>d.drawId===n);u?a=u.drawEntries:e.entries&&(a=e==null?void 0:e.entries)}let s=a.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!o||!c.entryStage||c.entryStage===o)&&(!t||c.entryStatus&&ec.includes(c.entryStatus)));return{entries:a,stageEntries:s}}function kte({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:o,event:a}){var v;let s="destroyGroupEntry";if(!e)return{error:Ge};if(!n)return se({result:{error:Rr},stack:s});if(!a)return{error:Vi};if(!a.eventType||![Zh,al].includes(a.eventType))return se({result:{error:Hh},stack:s});let l=e.participants??[],c=l.find(y=>y.participantId===n);if(!c)return se({result:{error:Jn},stack:s});if(!c.participantType||![jt,el].includes(c.participantType)||c.participantType===el&&a.eventType!==al||c.participantType===jt&&a.eventType!==Zh)return{error:_c};let u=(a.entries??[]).find(y=>y.participantId===n);if(!u)return{error:sQ};let{stageEntries:d}=_te({selected:!1,drawDefinition:i,drawId:r,event:a,stage:o}),p=d.map(ai),h=l.filter(({participantId:y})=>p.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),f=(v=c.individualParticipantIds)==null?void 0:v.filter(y=>uu(y,h).length===1),m=qD({participantIds:[n],event:a});if(m.error||f!=null&&f.length&&(m=sd({participantIds:f,entryStatus:Ql,entryStage:u.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:a}),m.error))return m;let g;return t&&xy({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...ae,participantRemoved:g}}function Fj({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:o}){return kte({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:o})}function xte(t){if(!t.tournamentRecord)return{error:Ge};let{participantIds:e,...i}=t,n=0,r=[];for(let o of e){let a=kte({participantId:o,...i});a.success&&(n+=1),a.error&&r.push(a.error)}return n?{destroyedCount:n,...ae}:{error:r}}function qT(t){let{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:o,matchUpsMap:a,drawId:s}=t,l="removeDrawPositionAssignment",c=zD(t);if(c.error)return se({result:c,stack:l});let{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t;if([Ol,bp].includes(o)&&u){let{tournamentRecord:m}=t,{participant:g}=hg({tournamentRecord:m,participantId:u}),{participantType:v,individualParticipantIds:y}=g??{};if(r&&v===jt){let b=Fj({tournamentRecord:m,drawDefinition:n,participantId:u,event:p});if(b.error)return se({result:b,stack:l});y&&AM({participantIds:y,tournamentRecord:m,drawDefinition:n,entryStatus:o,drawId:s,event:p})}else AM({participantIds:[u],tournamentRecord:m,drawDefinition:n,entryStatus:o,drawId:s,event:p})}if(i){let m=xs({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:a,event:p});if(m.error)return se({result:m,stack:l})}let{structure:f}=At({drawDefinition:n,structureId:h});return gj({structure:f,drawPositions:[d]}),IA({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:o,structureId:h}}),c}function Ote(t){return Object.assign(t,{entryStatus:bp}),qT(t)}function QF(t){return oa(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function vo(t){return oa(t)?QF(t.replace(/_/g," ")):""}var kh=({finishingPosition:t=Cy,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:o,seedingProfile:a,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{let y={structureId:p??ji(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:c};o&&(y.structureOrder=o),l&&(y.structureType=l),a&&(typeof a=="string"?y.seedingProfile=a:typeof a=="object"&&typeof a.positioning=="string"&&(y.seedingProfile=a.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);let b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=Zt(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y},Ys=kh;function Bj({structureName:t=vo(Xr),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:lt};let o=Ys({stage:Xr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(o),cn({drawDefinition:i,structureIds:[o.structureId]}),{...ae}}function $j({drawPositions:t}){if(!(t!=null&&t.length))return{error:cD};let e=r=>t.filter(o=>o!==r).map(o=>[r,o]),i=[].concat(...(t??[]).map(e)),n=Zt(i.map(AA)).map(r=>r.split("|").map(o=>+o));return{groupMatchUps:i,uniqueMatchUpGroupings:n}}function AA(t=[]){return!Array.isArray(t)||!t.length?"":[...t].sort(wr).join("|")}function Lte({groupSize:t,drawPositionOffset:e}){if(!t)return[];let i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]),o=n.slice(0,n.length/2),a=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{o.forEach((g,v)=>{r[p].push([o[v],a[v]])});let h=o.shift(),f=o.pop(),m=a.shift();o=[h,m,...o].filter(Boolean),a=[...a,f].filter(Boolean)});let s=o.shift(),l=o.pop(),c=a.shift();o=[s,c,...o].filter(Boolean),a=[...a,l].filter(Boolean);let u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>{let h=p.map(f=>f+e);return AA(h)}))}function BUe({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:gt}}var $Ue={getRoundRobinGroupMatchUps:$j,determineRoundNumber:BUe,drawPositionsHash:AA,groupRounds:Lte};function YD(t){var w;let{groupNameBase:e="Group",playoffAttributes:i,stageSequence:n=1,structureOptions:r,appliedPolicies:o,seedingProfile:a,stage:s=ut,matchUpType:l,roundTarget:c,structureId:u,groupNames:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g=t.structureName??((w=i==null?void 0:i["0"])==null?void 0:w.name)??vo(ut),{groupCount:v,groupSize:y}=VUe({structureOptions:r,appliedPolicies:o,drawSize:p}),b=d0,I,T=it(1,v+1).map(U=>{let D=jUe({groupSize:y,structureOrder:U,matchUpType:l,drawSize:p,idPrefix:h,isMock:f});I=Array.isArray(D)?Math.max(...D.map(({roundNumber:C})=>C??0)):0;let E=(d==null?void 0:d[U-1])??`${e} ${U}`;return kh({structureId:m==null?void 0:m.pop(),structureType:fA,finishingPosition:b,structureOrder:U,structureName:E,matchUps:D})}),S=kh({structureId:u??(m==null?void 0:m.pop()),structureType:fa,finishingPosition:b,seedingProfile:a,structureName:g,stageSequence:n,structures:T,stage:s});return c&&Ui({extension:{name:xu,value:c},element:S}),{structures:[S],maxRoundNumber:I,groupCount:v,links:[],groupSize:y,...ae}}function VUe({appliedPolicies:t,structureOptions:e,drawSize:i}){let n=e==null?void 0:e.groupSize,r=(e==null?void 0:e.groupSizeLimit)||8,{validGroupSizes:o}=KD({groupSizeLimit:r,drawSize:i}),a=o&&Math.max(...o);n&&(o!=null&&o.includes(n))||(n&&n>4||!(o!=null&&o.includes(4))?n=a:n=4);let s=Math.ceil(i/n);return{groupSize:n,groupCount:s}}function KD({drawSize:t,groupSizeLimit:e=10}){let i=it(3,e+1).filter(n=>{let r=Math.ceil(t/n),o=r*n-t,a=Math.ceil(t/r),s=Math.ceil(o/r);return(!o||o<n)&&a===n&&a>=3&&s<2});return{...ae,validGroupSizes:i}}function jUe({structureOrder:t,matchUpType:e,groupSize:i,drawSize:n,idPrefix:r,isMock:o,uuids:a}){let s=(t-1)*i,l=it(1+s,i+1+s),c=$j({drawPositions:l}).uniqueMatchUpGroupings??[],u=Lte({groupSize:i,drawPositionOffset:s});return c.map(p).sort((h,f)=>(h.roundNumber??1/0)-(f.roundNumber??1/0));function d(h){return u.reduce((f,m,g)=>m.includes(h)?g+1:f,void 0)}function p(h){let f=AA(h),m=d(f),g=[1,n],v=HUe({structureOrder:t,drawPositions:h,roundNumber:m,idPrefix:r,uuids:a}),y={matchUpStatus:m?Gn:Ni,matchUpType:e,finishingPositionRange:{winner:g,loser:g},drawPositions:h,roundNumber:m,matchUpId:v};return o&&(y.isMock=!0),y}}function HUe({structureOrder:t,drawPositions:e,roundNumber:i,idPrefix:n,uuids:r}){return n?`${n}-${t}-${i}-DP-${e.join("-")}`:(r==null?void 0:r.pop())||ji()}function Vj(t){let{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!Bt(i))return{seedBlocks:void 0,...se({result:{error:Pe},context:{participantsCount:i},stack:"getSeedBlocks"})};let r=i0(i);if(e){let h=Math.min(e,r),f=[],m=1;for(it(0,h).forEach(()=>{f.push([m]),m++});m<r;){let g=it(m,m+h);m+=h,f.push(g)}return{...ae,seedBlocks:f}}let o=it(1,r+1),a=[],s=r/2;for(;s>1;){let h=Qr(o,s),f=h.length;h.forEach((m,g)=>{let v,y=g<f/2,b=g%2===0,I=m[0],T=m[m.length-1];n&&f>4?f===8?v=y?T:I:v=b?I:T:v=y?I:T,sa(m,a)||a.push(v)}),s=s/2}let l=o.filter(h=>!a.includes(h));for(;l.length;)l.length%2===0?a.push(l.pop()):a.push(l.shift());let c=it(0,20).map(h=>Math.pow(2,h));c.unshift(1);let u=c.indexOf(r),d=0,p=[];return it(0,u).forEach(h=>{p.push(a.slice(d,d+c[h])),d+=c[h]}),{...ae,seedBlocks:p}}function jj({roundRobinGroupsCount:t,drawSize:e}){let i="getSeedGroups";if(!Bt(e))return{seedGroups:void 0,...se({result:{error:Pe},context:{drawSize:e},stack:i})};if(t){if(!Bt(t))return{seedGroups:void 0,...se({context:{roundRobinGroupsCount:t},result:{error:Pe},stack:i})};let n=1,r=Math.floor(e/t);return{seedGroups:it(0,r).map(()=>{let o=it(n,n+t);return n+=t,o})}}else{let{seedBlocks:n}=Vj({participantsCount:e,roundRobinGroupsCount:t}),r=0;return{seedGroups:(n||[]).map(o=>(o||[]).map(()=>(r+=1,r)))}}}function Hj({roundRobinGroupsCount:t,participantsCount:e}){var r;if(t){let{validGroupSizes:o}=KD({drawSize:e});if(!((r=o==null?void 0:o.map(a=>Math.ceil(e/a)))!=null&&r.includes(t)))return se({context:{roundRobinGroupsCount:t},result:{error:Pe}})}let{seedGroups:i}=jj({drawSize:e,roundRobinGroupsCount:t}),n=(i==null?void 0:i.map(o=>Math.min(...o)))||[];return{...ae,seedingThresholds:n}}function YI(t){if(!t)return 1/0;if(Bt(t))return Et(t);let e=t.split("-")[0];return Bt(e)?Et(e):1/0}function GUe({size:t}){let e=[t],i=t;for(;i/2===Math.floor(i/2);)i=i/2,e.push(i);return e.includes(1)||e.push(1),e.sort(wr),e.reverse(),e}function zUe({blockPattern:t,index:e}){let i=0;for(let n of t){if(i===e)return n;let r=0;for(;r<n.length;){if(i===e)return n;i+=1,r++}}}function WUe({positioning:t,size:e}){let i=GUe({size:e}),n=[],r=[],o=p=>p[0],a=p=>p[p.length-1],s=(p,h)=>(t&&[hA,Dm].includes(t)&&h%2?a(p):o(p))||o(p),l=(p,h)=>{if(p.every(f=>!r.includes(f))){let f=s(p,h);return r.push(f),f}},c=p=>{let h=p.filter(f=>!r.includes(f));if(h.length)return r.push(...h),h},u=(p,h)=>{let f=s(p,h);if(!r.includes(f))return r.push(f),f},d=it(1,e+1);for(let p of i)if(p===1){let h=Qr(d,2),f=h.map(l).filter(Boolean);f.length&&n.push(f);let m=h.flatMap(c).filter(Boolean);m.length&&n.push(m)}else{let h=Qr(d,p).map(u).filter(Boolean);h.length&&n.push(h)}return{divisions:i,divisionGroupings:n}}function Oy({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:o,structure:a}){var _;let s=[];if(!a)return{error:vf};let{matchUps:l,roundMatchUps:c}=_i({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:a}),{seedAssignments:u}=ol({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:a}),{positionAssignments:d}=jr({structure:a}),p=d==null?void 0:d.length,h=(u==null?void 0:u.length)??0,f=[],m=Object.keys(c).map(k=>parseInt(k)).sort((k,O)=>k-O).map(k=>{let O=c[k].map(B=>B.drawPositions).flat(1/0).filter(Boolean),F=O.filter(B=>!f.includes(B));return f=f.concat(...O),F}).filter(k=>k.length).reverse(),g=m.pop()??[],v=g&&Math.min(...g)-1||0;n=n??((_=i==null?void 0:i.seeding)==null?void 0:_.seedingProfile);let y=(g==null?void 0:g.length)||0,b=m.filter(k=>k.filter(O=>O<=h).length),{stage:I,structureType:T,roundLimit:S}=a,w=T===fa,U=!w&&(m==null?void 0:m.length),D=!w&&I===Tt&&S,E=b.flat(1/0),C=U?E==null?void 0:E.length:0,M=o?p:h,N=Cj({drawDefinition:r,structure:a,matchUps:l}),R=N?0:!U&&M||M&&E.length<M&&M-E.length||0;if(D){let k=a!=null&&a.matchUps?a.matchUps.filter(({roundNumber:F})=>F===a.roundLimit).length:0,O=g.length/k;if(!U){let F=ZD(n),B=Qr(g,O),$=1,V=it(0,B[0].length).map(()=>{let H=it($,$+B.length);return $+=B.length,H});({validSeedBlocks:s}=Fte({drawPositionBlocks:B,nonRandom:n==null?void 0:n.nonRandom,positioning:F,seedGroups:V}))}}else w?{validSeedBlocks:s}=qUe({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:a}):U?s=b.map(k=>({seedNumbers:k,drawPositions:k})):N&&Qr(g,2).map((k,O)=>({drawPositions:[k[0]],seedNumbers:[O+1]})).forEach(k=>s.push(k));if(!w&&!N&&!D){let{blocks:k}=YUe({drawPositionOffset:v,seedNumberOffset:C,seedCountGoal:R,seedingProfile:n,baseDrawSize:y});k.forEach(O=>s.push(O))}let A=s.flatMap(k=>k.drawPositions).reduce((k,O)=>(g==null?void 0:g.includes(O))&&k,!0);return!N&&!U&&!w&&!A?{error:OJ,validSeedBlocks:[],isContainer:w,isFeedIn:U}:{isLuckyStructure:N,validSeedBlocks:s,isContainer:w,isFeedIn:U}}function qUe({seedingProfile:t,structure:e,nonRandom:i}){var u;let n=e.structures||[],r=n.length,o=(u=Yi({structure:e}))==null?void 0:u.positionAssignments,a=ZD(t),s=(o==null?void 0:o.length)??0,{seedGroups:l}=jj({roundRobinGroupsCount:r,drawSize:s}),c=n.map(d=>{var p;return(p=Yi({structure:d}).positionAssignments)==null?void 0:p.map(h=>h.drawPosition)});return Fte({drawPositionBlocks:c,positioning:a,seedGroups:l,nonRandom:i})}function Fte({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){let r=[],{divisionGroupings:o}=WUe({size:i.length,positioning:e}),a=[];return i.forEach((s,l)=>{let c=zUe({blockPattern:o,index:l});s.forEach((u,d)=>{let p=l%2?t.length-d-1:d,h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Dm?h=n?h:Jo(h):l%2&&h.reverse();let f=h.find(m=>!a.includes(m));f&&(a.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function YUe(t){let{drawPositionOffset:e=0,roundRobinGroupsCount:i,seedNumberOffset:n=0,seedingProfile:r,seedCountGoal:o,baseDrawSize:a}=t,s=1,l=[],{seedBlocks:c}=Vj({cluster:ZD(r)===hA,participantsCount:a,roundRobinGroupsCount:i});s=0;for(let d of c){if(s+1>o)break;let p=d.map(f=>f+e),h=u(s+1,d.length).map(f=>+f+n);s+=d.length,l.push({drawPositions:p,seedNumbers:h})}return{blocks:l};function u(d,p){return Array.from(new Array(p),(h,f)=>f+d)}}function kM({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:o}){var l,c,u,d,p,h;let{structure:a}=At({drawDefinition:e,structureId:r});t||(t=Bi({drawDefinition:e}).appliedPolicies);let s=i==null?void 0:i.validSeedBlocks;return!s&&a&&(s=(l=Oy({appliedPolicies:t,drawDefinition:e,structure:a}))==null?void 0:l.validSeedBlocks),(u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.ignore?!0:(p=(d=t==null?void 0:t.seeding)==null?void 0:d.validSeedPositions)!=null&&p.strict?(((h=s.find(f=>f.seedNumbers.includes(o)))==null?void 0:h.drawPositions)||[]).includes(n):[].concat(...s.map(f=>f.drawPositions)).includes(n)}function Bte(t){var M,N,R;let{provisionalPositioning:e,drawDefinition:i,seedingProfile:n,seedBlockInfo:r,structureId:o,randomize:a}=t,{structure:s}=At({drawDefinition:i,structureId:o}),{seedAssignments:l}=ol({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,drawDefinition:i,structure:s}),{positionAssignments:c}=jr({structure:s}),u=(M=c==null?void 0:c.filter(A=>A.participantId??A.bye??A.qualifier))==null?void 0:M.map(A=>A.drawPosition).filter(Boolean),{appliedPolicies:d}=Bi({drawDefinition:i}),p=((r==null?void 0:r.validSeedBlocks)||s&&((N=Oy({returnAllProxies:t.returnAllProxies,provisionalPositioning:e,appliedPolicies:d,drawDefinition:i,seedingProfile:n,structure:s}))==null?void 0:N.validSeedBlocks)||[]).filter(A=>A.drawPositions.filter(_=>!(u!=null&&u.includes(_))).length)[0],h=l==null?void 0:l.map(A=>A.participantId).filter(Boolean),f=c==null?void 0:c.map(A=>A.participantId).filter(Boolean),m=h==null?void 0:h.filter(A=>f==null?void 0:f.includes(A)),g=h==null?void 0:h.filter(A=>!(f!=null&&f.includes(A))),v=l==null?void 0:l.filter(A=>g==null?void 0:g.includes(A.participantId)),y=l==null?void 0:l.filter(A=>!A.participantId),b=(v!=null&&v.length&&v.length>0?v.length:(y==null?void 0:y.length)??0)&&(p==null?void 0:p.drawPositions.filter(A=>!(u!=null&&u.includes(A))))||[],I=a?Jo(b):b,T=[],S=I.map(()=>{var _;let A=(_=C(v,T))==null?void 0:_.participantId;return A&&T.push(A),A}).filter(Boolean),w=l==null?void 0:l.filter(A=>m==null?void 0:m.includes(A.participantId)).map(A=>A.seedNumber),U=((p==null?void 0:p.seedNumbers)||[]).filter(A=>!(w!=null&&w.includes(A))),D=l==null?void 0:l.filter(A=>U.includes(A.seedNumber)).map(A=>A.participantId),E=(R=d==null?void 0:d.seeding)==null?void 0:R.duplicateSeedNumbers;return{nextSeedBlock:p,unplacedSeedParticipantIds:E===void 0||E?S:D,unplacedSeedNumbers:U,unfilledPositions:I,unplacedSeedAssignments:v};function C(A,_){let k=A.filter(B=>!_.includes(B.participantId)),O=Math.min(...k.map(B=>YI(B.seedValue))),F=k.filter(B=>YI(B.seedValue)===O);return Jo(F).pop()}}function ZD(t){if(typeof t=="string")return t;if(typeof t=="object")return t.positioning}function I0({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:o,structureId:a,seedNumber:s,seedValue:l,eventId:c,event:u}){var T,S,w;let d="assignSeed",{structure:p}=At({drawDefinition:i,structureId:a}),{positionAssignments:h}=jr({structure:p}),f=ol({provisionalPositioning:t,drawDefinition:i,structure:p}).seedAssignments,m=f.map(U=>U.seedNumber),g=pv({drawDefinition:i,participantId:r});if(r&&!g)return se({result:{error:bu},context:{participantId:r},stack:d});let v=u?(S=(T=Kn({event:u}).flightProfile)==null?void 0:T.flights)==null?void 0:S.length:0,y=v&&v>1,b=(w=h==null?void 0:h.find(U=>U.participantId===r))==null?void 0:w.drawPosition;if(b&&!kM({drawPosition:b,drawDefinition:i,seedBlockInfo:o,structureId:a,seedNumber:s}))return se({result:{error:j$},context:{assignedDrawPosition:b},info:"invalid seed position",stack:d});m.includes(s)||f.push({seedNumber:s,seedValue:l});let I;return f.forEach(U=>{U.participantId===r&&U.seedNumber!==s&&(U.participantId=void 0),U.seedNumber===s&&(U.participantId=r,!(n!=null&&n.groupSeedingThreshold)&&!y&&(U.seedValue=l??s),I=!0)}),I?(Aee({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:p,eventId:c}),{...ae}):se({result:{error:xJ},stack:d})}function Gj({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:o,event:a}){var p,h,f,m;let s=(h=(p=t==null?void 0:t.sides)==null?void 0:p[e])==null?void 0:h.sideNumber,l=s&&((f=o.sides)==null?void 0:f.find(g=>g.sideNumber===s)),{extension:c}=Qt({element:r,name:fp}),u=(c==null?void 0:c.value)||{},d=dt(u[i],!1,!0);if(l)(m=o==null?void 0:o.sides)==null||m.forEach(g=>{g.sideNumber===s&&(g.lineUp=d)});else{o.sides=[1,2].map(v=>{var y;return{...((y=o.sides)==null?void 0:y.find(b=>b.sideNumber===v))??{},sideNumber:v}});let g=o.sides.find(v=>v.sideNumber===s);g&&(g.lineUp=d)}yi({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o})}function $te(t){let{sourceMatchUp:e}=t,{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:o}=t,a=i.roundNumber>1&&i.roundNumber-1,s=Em({structureId:n.structureId,matchUpsMap:r});!e&&o&&(e=s.find(({drawPositions:f,roundNumber:m})=>m===a&&(f==null?void 0:f.includes(o))));let l=e==null?void 0:e.roundPosition,c=l%2?1:-1,u=l+c,d=a&&s.find(({roundNumber:f,roundPosition:m})=>f===a&&m===u),p=d==null?void 0:d.matchUpStatus,h=[mr,Er].includes(p);return{pairedPreviousMatchUp:d,pairedPreviousMatchUpIsDoubleExit:h}}function KUe({drawPosition:t,drawPositions:e}){let i=!1,n=!!(e!=null&&e.includes(t));return{updatedDrawPositions:n?e||[]:[...e,void 0,void 0].slice(0,2).map(r=>!r&&!n?(n=!0,i=!0,t):r).sort(wr).filter(Boolean),positionAdded:i,positionAssigned:n}}function Vte({structureId:t,matchUpsMap:e,matchUp:i}){let n=i==null?void 0:i.roundPosition,r=n%2?1:-1,o=n+r;return{pairedPreviousMatchUp:Em({matchUpsMap:e,structureId:t}).find(({roundNumber:a,roundPosition:s})=>a===(i==null?void 0:i.roundNumber)&&s===o)}}function jte({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){let o=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:a}=Vte({structureId:o==null?void 0:o.structureId,matchUp:o,matchUpsMap:n});if(o&&a){let s=a==null?void 0:a.matchUpId,l=t.find(u=>u.matchUpId===s),c=(o==null?void 0:o.structureId)===(l==null?void 0:l.structureId)?(o==null?void 0:o.roundPosition)<(l==null?void 0:l.roundPosition)&&1||2:o.structureId===(l==null?void 0:l.structureId)&&2||1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{let d=oa(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function RE({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){let n=t.filter(({winnerMatchUpId:r,loserMatchUpId:o})=>o===i||r===i).sort((r,o)=>r.roundPosition-o.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,o,a)=>{var s;return(s=o.drawPositions)!=null&&s.includes(e)?a+1:r},void 0)}function KI({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:o,drawPosition:a,matchUpsMap:s,matchUpId:l,event:c}){var M,N,R,A;let u="assignMatchUpDrawPosition";s||(s=Uo({drawDefinition:r})),t||(t=Tr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);let d=t.find(_=>_.matchUpId===l),p=d==null?void 0:d.structureId,h=(M=r==null?void 0:r.structures)==null?void 0:M.find(_=>_.structureId===p);if(!h)return{error:Nn};let f=(N=s==null?void 0:s.drawMatchUps)==null?void 0:N.find(_=>_.matchUpId===l),m=(f==null?void 0:f.drawPositions)??[],{positionAdded:g,positionAssigned:v,updatedDrawPositions:y}=KUe({drawPosition:a,drawPositions:m}),{positionAssignments:b}=Yi({drawDefinition:r,structure:h}),I=(R=b==null?void 0:b.filter(_=>y.includes(_.drawPosition)))==null?void 0:R.find(({bye:_})=>_),T=(f==null?void 0:f.matchUpStatus)&&[Oi,Pi].includes(f.matchUpStatus)&&y.filter(Boolean).length<2;if(o=I&&Ni||o||T&&f.matchUpStatus||(f==null?void 0:f.matchUpStatus)&&[mr,Er].includes(f.matchUpStatus)&&f.matchUpStatus||Gn,f&&g){t=Tr({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];let _=T&&RE({inContextDrawMatchUps:t,drawPosition:a,matchUpId:l})||void 0;f!=null&&f.matchUpStatusCodes&&jte({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:f}),Object.assign(f,{drawPositions:y,winningSide:_,matchUpStatus:o}),yi({tournamentId:i==null?void 0:i.tournamentId,eventId:d==null?void 0:d.eventId,context:u,drawDefinition:r,matchUp:f})}let S=ca({inContextDrawMatchUps:t,inContextMatchUp:d,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:w,loserMatchUp:U,loserTargetDrawPosition:D},targetLinks:{loserTargetLink:E}}=S,C=Em({structureId:h.structureId,matchUpsMap:s});if(v&&I){if(w)if([Ni,mr,Er].includes(o)){let _=KI({matchUpId:w.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(_.error)return _}else{let{structureId:_}=w;_!==h.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(w&&d&&!d.feedRound){let{pairedPreviousMatchUpIsDoubleExit:_}=$te({targetMatchUp:f,drawPosition:a,matchUpsMap:s,structure:h});if(_){let k=KI({matchUpId:w.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(k.error)return k}}if((f==null?void 0:f.matchUpType)===sn){let _=t==null?void 0:t.find(({matchUpId:F})=>F===f.matchUpId),k=((_==null?void 0:_.sides)??[]).reduce((F,B,$)=>B.drawPosition===a?$:F,void 0),O=(A=b==null?void 0:b.find(F=>F.drawPosition===a))==null?void 0:A.participantId;O&&k!==void 0&&Gj({inContextTargetMatchUp:_,drawPositionSideIndex:k,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:f})}if((E==null?void 0:E.linkCondition)===bd&&y.filter(Boolean).length===2&&!I&&C.filter(({drawPositions:_,roundNumber:k})=>k===1&&sa(_,y)).every(({matchUpStatus:_})=>[or,Go].includes(_))&&U){let{structureId:_}=U,k=xs({drawPosition:D,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:c});if(k.error)return k}return v?{...ae}:se({result:{error:_I},context:{drawPosition:a},stack:u})}function Hte({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var u,d,p,h;let o=((p=(d=(u=p0({drawDefinition:e}))==null?void 0:u.containedStructures)==null?void 0:d[r.structureId])==null?void 0:p.map(({structureId:f})=>f))||[];o.push(r==null?void 0:r.structureId);let a=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],s=(t==null?void 0:t.filter(f=>o.includes(f.structureId)&&Hn(f.drawPositions??[],a).length))??[],l=s.map(({matchUpId:f})=>f),c=((h=n==null?void 0:n.drawMatchUps)==null?void 0:h.filter(f=>l.includes(f.matchUpId)))??[];return{drawPositions:a,matchUps:c,targetMatchUps:s}}function zj({lineUp:t}){if(!Array.isArray(t))return;let e={};return Zt(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{let[n,r]=i.split("|"),o=parseInt(r),{assignedParticipantIds:a}=RM({collectionPosition:o,collectionId:n,lineUp:t});a.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:o})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function Td(t){return`${t} must be an array`}function _A({lineUp:t,tieFormat:e}){let i=[];if(!Array.isArray(t))return i.push(Td("lineUp")),{valid:!1,errors:i,error:Pe};let n=t.every(o=>{if(typeof o!="object")return i.push("lineUp entries must be objects"),!1;let{participantId:a,collectionAssignments:s}=o;return a?typeof a!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;let{collectionPosition:c}=l;return typeof c!="number"?(i.push("collectionPosition must be a number"),!1):!0}):(i.push(Td("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=Zt(t.map(ai)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Pe:void 0}}function Ly({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:lt};if(typeof e!="string")return{error:Rr};let r=_A({lineUp:n,tieFormat:i});if(!r.valid)return r;let{extension:o}=Qt({element:t,name:fp}),a=(o==null?void 0:o.value)||{};return a[e]=zj({lineUp:n}),Ui({element:t,extension:{name:fp,value:a}}),PD({drawDefinition:t}),{...ae}}function Wj({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:o,structure:a,event:s}){if(!n)return{error:lt};let{drawPositions:l,matchUps:c,targetMatchUps:u}=Hte({inContextDrawMatchUps:t,matchUpsMap:r,assignments:o,structure:a});for(let d of u)d.matchUpType===Su&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&(l!=null&&l.includes(p.drawPosition))){let m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){let g=d.tieFormat,v=p.participantId;g&&v&&Ly({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}yi({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...ae}}function Uu({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:o,seedingProfile:a,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var U,D,E;let h="assignDrawPosition";if(!s&&!i)return se({result:{error:Rr},stack:h});u=u??Uo({drawDefinition:o}),e||({matchUps:e}=Tr({inContext:!0,drawDefinition:o,matchUpsMap:u}));let f=At({drawDefinition:o,structureId:d});if(f.error)return se({result:f,stack:h});let{structure:m}=f;if(!m)return{error:Nn};if(ss({structure:m}))return se({result:{error:Sa},stack:h});let{seedAssignments:g}=ol({provisionalPositioning:t,drawDefinition:o,structure:m}),v=(U=g==null?void 0:g.find(C=>C.participantId===s))==null?void 0:U.seedNumber,{appliedPolicies:y}=Bi({tournamentRecord:r,drawDefinition:o,structure:m,event:p});if(v&&!kM({seedNumber:v,appliedPolicies:y,drawDefinition:o,seedBlockInfo:l,drawPosition:c,structureId:d}))return se({result:{error:j$},context:{drawPosition:c},stack:h});let b=jr({structure:m}).positionAssignments||[],I=b==null?void 0:b.find(C=>C.drawPosition===c);if(!I)return se({result:{error:Kw},context:{drawPosition:c},stack:h});if(b!=null&&b.map(ai).includes(s))return se({result:{error:Qw},context:{drawPosition:c},stack:h});let{containsParticipant:T,containsBye:S}=w(I);if(S){let C=zD({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(C.error)return se({result:C,stack:h})}if(T&&I.participantId!==s){let{activeDrawPositions:C}=GD({drawDefinition:o,structureId:d});if(C.includes(c))return se({result:{error:GN},stack:h});Wj({assignments:[I],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,matchUpsMap:u,structure:m})}if(I.participantId=s,i&&(I.qualifier=!0),((m==null?void 0:m.stageSequence)||0)>1||m.stage&&[Io,$n].includes(m.stage)){let C=m.stage===Tt?Tt:ut,M=(((E=(D=o.structures)==null?void 0:D.find(N=>(N==null?void 0:N.stage)===C&&(N==null?void 0:N.stageSequence)===1))==null?void 0:E.seedAssignments)??[]).find(N=>N.participantId===s);if(M!=null&&M.participantId){let{participantId:N,seedNumber:R,seedValue:A}=M;I0({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:o,seedingProfile:a,participantId:N,seedNumber:R,seedValue:A,structureId:d,event:p})}}if(m.structureType!==fa)ZUe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:o,drawPosition:c,matchUpsMap:u,structure:m,event:p});else{Ite({positionAssignments:b,tournamentRecord:r,drawDefinition:o,matchUpsMap:u,structure:m});let{drawPositions:C,matchUps:M,targetMatchUps:N}=Hte({assignments:[I],inContextDrawMatchUps:e,drawDefinition:o,matchUpsMap:u,structure:m});if(C&&(M==null?void 0:M.length)===1&&M[0].matchUpType===sn){let R=((N==null?void 0:N[0].sides)??[]).reduce((A,_,k)=>C!=null&&C.includes(_.drawPosition)?k:A,void 0);Gj({inContextTargetMatchUp:N[0],teamParticipantId:s,matchUp:M[0],drawPositionSideIndex:R,tournamentRecord:r,drawDefinition:o})}}return Kh({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:o,structure:m,event:p}),{positionAssignments:b,...ae};function w(C){let M=C.bye,N=C.qualifier,R=C.participantId;return{containsBye:M,containsQualifier:N,containsParticipant:R,filled:M||N||R}}}function ZUe({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:o,matchUpsMap:a,structure:s,event:l}){let c={isCollectionMatchUp:!1},{matchUps:u}=_i({provisionalPositioning:t,matchUpFilters:c,drawDefinition:r,matchUpsMap:a,structure:s,event:l}),{roundMatchUps:d}=la({matchUps:u}),{initialRoundNumber:p}=$v({drawPosition:o,matchUps:u}),h=p&&(d==null?void 0:d[p].find(f=>{var m;return(m=f.drawPositions)==null?void 0:m.includes(o)}));if(h){let f=KI({matchUpId:h.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:i,tournamentRecord:n,drawDefinition:r,drawPosition:o,matchUpsMap:a});if(f.error)return se({stack:"assignDrawPositionToMatchUps",context:{drawPosition:o},result:f})}return{...ae}}function qj(t){let{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:o,participantId:a,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!o)return{error:lt};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=Uo({drawDefinition:o}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=Tr({inContext:!0,drawDefinition:o,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));let{positionAssignments:h}=Yi({drawDefinition:o,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){let b=f.participantId,I=Uu({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:o,participantId:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return I.success?y({removedParticipantId:b}):se({result:I,stack:u})}let m=zD({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(m.error)return se({result:m,stack:u});let g=m.participantId,v=Uu({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:r,drawDefinition:o,participantId:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(!v.success)return se({result:v,stack:u});return y({removedParticipantId:g});function y({removedParticipantId:b}){let{structure:I}=At({drawDefinition:o,structureId:l});gj({drawPositions:[s],structure:I});let T={[e]:a,name:n,drawPosition:s,structureId:l};return IA({drawDefinition:o,positionAction:T}),se({context:{removedParticipantId:b},result:{...ae},stack:u})}}function XUe({luckyLoserParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return qj({positionActionName:"luckyLoserDrawPositionAssignment",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Gte(t){return XUe(t)}function JUe({alternateParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return qj({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function zte(t){return JUe(t)}function Wte({params:t,modMap:e,structure:i}){let{tournamentRecord:n,drawDefinition:r,event:o}=t;for(let a of i.matchUps)e[a.matchUpId]&&(a.roundNumber=e[a.matchUpId],yi({tournamentId:n==null?void 0:n.tournamentId,eventId:o==null?void 0:o.eventId,drawDefinition:r,matchUp:a}))}function qte(t,e){let i=[{drawDefinition:!0,structureId:!0}];Array.isArray(e)&&i.push(...e);let n=Ei(t,i);if(n.error)return n;let r=At(t);if(r.error)return r;let o=r.structure;if(!ss({structure:o}))return se({result:{error:Iy,message:"structure must be adHoc"}});let{roundMatchUps:a=[],roundNumbers:s}=la({matchUps:o==null?void 0:o.matchUps});return s!=null&&s.length?{valid:!0,structure:o,roundMatchUps:a,roundNumbers:s}:{error:kd}}function Yte(t){var u;let e=qte(t,[{targetRoundNumber:!0,roundNumber:!0,[Sf]:PSe}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e,{targetRoundNumber:o,roundNumber:a}=t;if(!(r!=null&&r.includes(a))||!(r!=null&&r.includes(o)))return se({result:{error:Pe},info:"roundNumbers must be valid rounds"});let s=o>a,l=s?it(a+1,o+1):it(o,a),c={};return l.forEach(d=>((n==null?void 0:n[d])??[]).forEach(({matchUpId:p})=>{c[p]=d-(s?1:-1)})),(u=n==null?void 0:n[a])==null||u.forEach(({matchUpId:d})=>c[d]=o),Wte({params:t,modMap:c,structure:i}),{...ae}}function Kte({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var s;if(!n)return{error:lt};if(!Array.isArray(t))return{error:Pe};let o="setPositionAssignments";for(let l of t){let{structureId:c,positionAssignments:u}=l;if(!u)continue;let d=At({drawDefinition:n,structureId:c});if(d.error)return d;let p=d.structure;if(!p)return{error:Nn};let h=(s=Yi({structure:p}).positionAssignments)==null?void 0:s.map(({drawPosition:v})=>v),f=u==null?void 0:u.map(({drawPosition:v})=>v);if(Hn(h,f).length!==(h==null?void 0:h.length))return se({result:{error:Pe},info:"drawPositions do not match",stack:o});let m=Uo({drawDefinition:n}),{matchUps:g}=Tr({inContext:!0,drawDefinition:n,matchUpsMap:m});for(let v of u||[]){let{drawPosition:y,participantId:b,bye:I,qualifier:T}=v;if(I){let S=xs({tournamentRecord:i,drawDefinition:n,drawPosition:y,matchUpsMap:m,structureId:c,structure:p,event:r});if(S!=null&&S.error)return S}else if(T)u.forEach(S=>{S.drawPosition===y&&(S.qualifier=!0,delete S.participantId,delete S.bye)});else if(b){let S=Uu({provisionalPositioning:e,inContextDrawMatchUps:g,tournamentRecord:i,drawDefinition:n,participantId:b,drawPosition:y,matchUpsMap:m,structureId:c,event:r});if(S!=null&&S.error)return S}}Kh({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:p,event:r})}let a=t.map(({structureId:l})=>l);return cn({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:a}),{...ae}}function Zte(t){let e=qte(t,[{roundNumbers:!0,[Sf]:Xa,[yc]:a=>a.length===2&&a.every(Bn)}]);if(e.error)return e;let{structure:i,roundMatchUps:n,roundNumbers:r}=e;if(!t.roundNumbers.every(a=>r==null?void 0:r.includes(a)))return se({result:{error:Pe,message:"roundNumbers must be valid rounds"}});let o={};return t.roundNumbers.forEach((a,s)=>((n==null?void 0:n[a])??[]).forEach(({matchUpId:l})=>{o[l]=t.roundNumbers[1-s]})),Wte({params:t,modMap:o,structure:i}),{...ae}}function QUe({qualifyingParticipantId:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r}){return qj({positionActionName:"qualifierDrawPositionAssignment",participantId:t,isQualifierPosition:!0,tournamentRecord:e,drawDefinition:i,drawPosition:n,structureId:r})}function Xte(t){return QUe(t)}function eDe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:lt};if(!n)return{error:_s};if((i==null?void 0:i.length)!==2)return{error:Pe,drawPositions:i};let o=Uo({drawDefinition:e}),{matchUps:a}=Tr({inContext:!0,drawDefinition:e,matchUpsMap:o}),{structure:s}=At({drawDefinition:e,structureId:n});if(!s)return{error:Nn};let l;if(s.structureType===fa?l=nDe({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:o,structure:s,event:r}):l=tDe({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:o,structure:s,event:r}),l.error)return l;if(gj({structure:s,drawPositions:i}),IA({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),Kh({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===al){let c=_i({matchUpFilters:{matchUpTypes:[Su]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(h=>i.includes(h))}),u=_i({matchUpFilters:{matchUpTypes:[Su]},structure:s}).matchUps;c.forEach(d=>{(d.sides||[]).forEach(p=>{var f;let h=p==null?void 0:p.drawPosition;if(i.includes(h)){let m=p.participantId,g=u.find(({matchUpId:y})=>y===d.matchUpId),v=(f=d==null?void 0:d.sides)==null?void 0:f.reduce((y,b,I)=>b.drawPosition===h?I:y,void 0);Gj({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return cn({drawDefinition:e,structureIds:[n]}),{...ae}}function tDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:o,event:a}){let s=o==null?void 0:o.positionAssignments.filter(c=>n==null?void 0:n.includes(c.drawPosition));if(!s)return{error:Pe,structure:o,info:"Missing positionAssignments"};if(s.filter(({bye:c})=>c).length===2)return{...ae};if(s.filter(({qualifier:c})=>c).length===2)return{...ae};let l=s.some(({qualifier:c})=>c);return s.some(({bye:c})=>c)&&!l?Jte({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:o,event:a}):iDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:o,event:a})}function Jte({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:o,event:a}){let s=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=o,h=qT({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error||(h=qT({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error)||(xs({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:a}),h=Uu({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:a}),h.error)?h:{...ae}}function iDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:o,event:a}){let s=Object.assign({},...n.map((l,c)=>{let{drawPosition:u}=l,d={...n[1-c],drawPosition:u};return{[u]:d}}));return o.positionAssignments=o.positionAssignments.map(l=>s[l.drawPosition]||l),Wj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:n,structure:o,event:a}),{...ae}}function nDe({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPositions:n,matchUpsMap:r,structure:o,event:a}){var c;let s=(c=o.structures)==null?void 0:c.reduce((u,d)=>{let p=d==null?void 0:d.positionAssignments.filter(h=>n==null?void 0:n.includes(h.drawPosition));return p&&u.push(...p),u},[]);if(s.filter(({bye:u})=>u).length===2)return{...ae};if(s.filter(({qualifier:u})=>u).length===2)return{...ae};Wj({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,assignments:s,structure:o,event:a});let l=s.some(({qualifier:u})=>u);if(s.some(({bye:u})=>u)&&!l)Jte({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:s,matchUpsMap:r,structure:o,event:a});else{let u=dt(s,!1,!0);s.forEach((d,p)=>{let h=u[1-p].participantId;d.qualifier=u[1-p].qualifier,d.participantId=h})}return{...ae}}function Qte(t){return eDe(t)}function eie({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:o,event:a}){if(!i)return{error:lt};if(!r)return{error:_s};let s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:bu};let{structure:l}=At({drawDefinition:i,structureId:r});if(!l)return{error:Nn};if(!(!t||Bn(o)||o===void 0||o===""||typeof o=="string"&&o.split("-").every(p=>Bn(p)&&Et(p)>0)))return{error:Pe};let{seedAssignments:c}=ol({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){let p=typeof o=="string"?o.includes("-")&&o.split("-").map(h=>parseInt(h)).join("-")||parseInt(o)>0&&parseInt(o)||"":o&&o>0&&o||"";d.seedValue=p}else{let p={seedNumber:Math.max(0,...u||[])+1,participantId:n};o&&(p.seedValue=o),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return Aee({tournamentId:e==null?void 0:e.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,structure:l}),{...ae}}function tie({drawDefinition:t,structureId:e}){if(!t)return{error:lt};let{structure:i}=At({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var o;return((o=r.source)==null?void 0:o.structureId)===e}).map(r=>{var o;return(o=r.target)==null?void 0:o.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function kA({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:o,stage:a}){if(!o)return{error:Vi};let s={},l=[];for(let c of o.drawDefinitions||[]){let{structures:u,stageStructures:d}=wd({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:a});if(l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Yj({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:o,stage:a}){if(!e)return{error:Ge};let s={},l=[];for(let c of e.events||[]){let{structures:u,stageStructures:d}=kA({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:o,event:c,stage:a});if(u&&l.push(...u),d)for(let p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Xh(t){if(!(t!=null&&t.drawDefinition))return!1;let e=MA(t),i=e==null?void 0:e.includesTeamMatchUps,{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:o}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:a})=>a===sn),r=r==null?void 0:r.filter(({matchUpType:a})=>a===sn),o=o==null?void 0:o.filter(({matchUpType:a})=>a===sn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(o!=null&&o.length))}function Kj(t){var a,s;let{drawDefinition:e,structureId:i}=t;if(!e)return{error:lt};let{playoffStructures:n}=tie({drawDefinition:e,structureId:i});if(!(n!=null&&n.length))return!1;let r=((s=(a=e==null?void 0:e.entries)==null?void 0:a.filter(l=>(l==null?void 0:l.entryStatus)&&ec.includes(l.entryStatus)))==null?void 0:s.length)??0,o=0;return(n||[]).reduce((l,c)=>{var u;return!!((u=Yi({structure:c}).positionAssignments??[])!=null&&u.filter(d=>(d.participantId&&o++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length&&l)},!!n.length)||o===r}function e2({significantCharacters:t,accessors:e=[],value:i}){let n=[],r=e[0];if(i!=null&&i[r]){let a=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(s=>{let l=e2({accessors:a,significantCharacters:t,value:s});n.push(...l)});else if(i=i[r],a.length){let s=e2({accessors:a,significantCharacters:t,value:i});n.push(...s)}else o({value:i})}function o({value:a}){if(a&&["string","number"].includes(typeof a)){let s=t?a.slice(0,t):a;n.push(s)}}return n}function rDe({targetParticipantIds:t,policyAttributes:e,idCollections:i,participants:n}){if(!Array.isArray(e))return{error:Q$};if(!Array.isArray(n))return{error:hD};let r={};return t.forEach(o=>{let a=n.find(l=>l.participantId===o),{values:s}=iie({policyAttributes:e,idCollections:i,participants:n,participant:a});s&&s.forEach(l=>{r[l]||(r[l]=[]),r[l].includes(o)||r[l].push(o)})}),r}function iie({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:Q$};if(!n)return{error:Sy};let r=[];return t.forEach(o=>{let{directive:a,groupings:s,key:l,significantCharacters:c}=o||{};if(l){let u=l.split(".");r.push(...e2({significantCharacters:c,value:n,accessors:u}))}else if(a){let u=o==null?void 0:o.includeIds,d=((e==null?void 0:e[a])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&(i!=null&&i.length)&&d.forEach(p=>{var f;let h=i.find(m=>m.participantId===p);if((f=h==null?void 0:h.individualParticipantIds)!=null&&f.includes(n.participantId)){let m=h==null?void 0:h.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(n.participantId)&&r.push(u)})}),{values:Zt(r)}}function p6({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){let r=Object.assign({},...e.map(o=>({[o.participantId]:o})));return t.map(o=>{let a=r[o.participantId],{values:s}=iie({participants:e,policyAttributes:i,idCollections:n,participant:a});return{...o,values:s}})}function nie({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{let{drawPosition:r,participantId:o}=n,a=t?t[o]||[]:[],s=!!i.some(l=>a.includes(l));return{[r]:{participantGroups:a,includesGroupsToAvoid:s}}}))}function oDe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=nie(t);return i.map(o=>{let a=e.filter(c=>o.includes(c)),s=r(a),l=a.filter(c=>!s.includes(c)).filter(c=>{var d;let u=h6(c);return!((d=n[u])!=null&&d.includesGroupsToAvoid)});return{unassigned:a,unpaired:s,pairedNoConflict:l}});function r(o){return o.filter(s=>!a(s));function a(s){let l=h6(s);return!o.includes(l)}}}function aDe(t){let{unfilledPositions:e,chunkedDrawPositions:i}=t,n=nie(t);return i.map(r=>{let o=e.filter(l=>r.includes(l)),a=o.length===r.length?o:[],s=r.filter(l=>{var c;return(c=n[l])==null?void 0:c.includesGroupsToAvoid}).length;return{unassigned:o,unpaired:a,pairedNoConflict:s?[]:o,conflictsCount:s}})}function h6(t){return Number(t%2?t+1:t-1)}function sDe({allGroups:t,participantId:e}){return Object.keys(t).filter(i=>t[i].includes(e))}function lDe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:o}){let a=n.map(s=>o?aDe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):oDe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));if(o){let s=a.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0)),l=a.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=a.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length).sort((u,d)=>(d.length||0)-(u.length||0));return{unassigned:s,unpaired:l,pairedNoConflict:c}}else{let s=a.map(u=>u.map(d=>d.unassigned).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),l=a.map(u=>u.map(d=>d.unpaired).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length),c=a.map(u=>u.map(d=>d.pairedNoConflict).filter(d=>d==null?void 0:d.length)).filter(u=>u==null?void 0:u.length);return{unassigned:s,unpaired:l,pairedNoConflict:c}}}function rie({positionAssignments:t,participantIds:e}){let i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function cDe({useSpecifiedGroupKey:t=!1,targetParticipantIds:e,largestFirst:i=!0,allGroups:n,groupKey:r}){var c;let o=Object.assign({},...Object.keys(n).map(u=>[u,n[u].filter(d=>e.includes(d))]).filter(u=>u[1].length).map(([u,d])=>({[u]:d}))),a=Object.keys(o).reduce((u,d)=>o[d].length>u?o[d].length:u,0),s=Object.keys(o).filter(u=>o[u].length===a),l=Ja(i?s:Object.keys(o));return r=t&&((c=o[r])!=null&&c.length)?r:l,{participantId:r&&o[r]?Ja(o[r]):Ja(e),groupKey:r}}function uDe({drawPositionGroups:t,positionAssignments:e}){let i=Object.assign({},...e.map(n=>({[n.drawPosition]:n})));return t.map(n=>n.filter(Boolean).map(r=>i[r]).filter(Boolean).filter(r=>!r.participantId&&!r.bye).map(r=>r.drawPosition)).flat().filter(Boolean)}function dDe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:o,allGroups:a,groupKey:s}){let l=r.reduce((U,D)=>D.length>U?D.length:U,0)<=2,c=rie({positionAssignments:t,participantIds:e}),u=uDe({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=cDe({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:a,groupKey:s}),h=sDe({participantId:d,allGroups:a}),f=lDe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=o&&y?y:b,T=o?b:y,S=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T,w;if(S!=null&&S.length){let U=Qa(S);w=Qa(U)}else{let U=Qa(m[0]);w=Qa(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:w}}function xM({isRoundRobin:t,groupedParticipants:e}){let i=[];return t?e.forEach(n=>{let r=n.map(s=>s.drawPosition),o=$j({drawPositions:r}).uniqueMatchUpGroupings??[],a=Object.assign({},...n.map(s=>({[s.drawPosition]:s})));o.forEach(s=>{sa(a[s[0]].values||[],a[s[1]].values||[])&&(i.push(s),n.conflict=!0)})}):e.forEach(n=>{var r,o;sa(((r=n[0])==null?void 0:r.values)||[],((o=n[1])==null?void 0:o.values)||[])&&(i.push(n),n.conflict=!0)}),i}function pDe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(o=>{let a=o.map(s=>s.drawPosition);return o.filter(s=>e.includes(s.drawPosition)).map(s=>{let l=e.filter(c=>!(a!=null&&a.includes(c))).filter(c=>{let u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=xM({isRoundRobin:r,groupedParticipants:[[s,d]]}),h=[t.find(m=>m.drawPosition===c),d],f=xM({isRoundRobin:r,groupedParticipants:[h]});return!p.length&&!f.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function f6(t){let{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:o,policyAttributes:a,idCollections:s,allGroups:l}=t,c=[],u,d=Math.min(...(o||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,h=dt(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);it(0,n).forEach(()=>{let{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=dDe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(S=>{S.drawPosition===T&&(S.participantId=I)})});let m=p6({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:a,idCollections:s}),g=Qr(m,d),v=xM({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){let b=pDe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:o,isRoundRobin:p});if(b.length){let I=hDe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=p6({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:a,idCollections:s}),g=Qr(m,d),v=xM({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){let I=_F;c.push(I)}if(b.qualifier&&b.participantId){let I=_F;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function hDe({candidatePositionAssignments:t,swapOptions:e}){let i=Qa(e);if(!i)return{error:{message:"No swap options"}};let n=i.drawPosition,r=Qa(i.possibleDrawPositions),o=t.find(c=>c.drawPosition===n),a=t.find(c=>c.drawPosition===r)??{},s={participantId:a==null?void 0:a.participantId,qualifier:a==null?void 0:a.qualifier,bye:a==null?void 0:a.bye},l={participantId:o.participantId,qualifier:o.qualifier,bye:o.bye};return Object.assign(o,s),Object.assign(a,l),{...ae}}function fDe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var $;if(!u)return{error:WJ};let{candidatesCount:h=1,policyAttributes:f,targetDivisions:m}=u,{roundsToSeparate:g}=u,v="randomUnseededSeparation",{structure:y}=At({drawDefinition:o,structureId:c}),{matchUps:b}=_i({provisionalPositioning:t,matchUpsMap:l,structure:y,event:p});if(m&&kc(m)&&!g){let V=nSe(m)||0,H=b.reduce((z,G)=>G.roundNumber>z?G.roundNumber:z,0);g=H<V?1:H-V+1}let{positionAssignments:I}=jr({structure:y}),T=vj({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,S=I==null?void 0:I.filter(V=>!V.participantId),w=I==null?void 0:I.map(V=>V.drawPosition),U=(y==null?void 0:y.structureType)===fa,D=U?{structure:y,matchUps:b,allDrawPositions:w,roundsToSeparate:g}:{matchUps:b,allDrawPositions:w,roundsToSeparate:g},{drawPositionGroups:E,drawPositionChunks:C}=U?mDe(D):gDe(D),M={groupParticipants:s.filter(V=>V.participantType===ks).map(V=>V.participantId),teamParticipants:s.filter(V=>V.participantType===en).map(V=>V.participantId),pairParticipants:s.filter(V=>V.participantType===jt).map(V=>V.participantId)},N=rDe({targetParticipantIds:e,policyAttributes:f,idCollections:M,participants:s});if(N.error)return se({result:N,stack:v});let R=Object.assign({},...e.map(V=>{let H=Object.keys(N).filter(z=>(N[z]??[]).includes(V));return{[V]:H}})),A=rie({participantIds:e,positionAssignments:I});if(A.length>((S==null?void 0:S.length)||0))return{error:oV};let _,k=A.length,O=it(0,h).map(()=>f6({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!1,unseededByePositions:n,participantIdGroups:R,drawPositionChunks:C,drawPositionGroups:E,policyAttributes:f,idCollections:M,allGroups:N,drawSize:d}));if(_=O.reduce((V,H)=>!V||(H.conflicts||0)<(V.conflicts||0)?H:V,void 0),!_||_.conflicts){let V=it(0,h).map(()=>f6({initialPositionAssignments:I,participantsWithGroupings:T,unseededParticipantIds:e,opponentsToPlaceCount:k,pairedPriority:!0,unseededByePositions:n,participantIdGroups:R,drawPositionChunks:C,drawPositionGroups:E,policyAttributes:f,idCollections:M,allGroups:N,drawSize:d}));_=O.concat(...V).filter(H=>{var z;return!((z=H.errors)!=null&&z.length)}).reduce((H,z)=>!H||(z.conflicts||0)<(H.conflicts||0)?z:H,void 0)}if(!_)return{error:JN};let F=((($=Yi({structure:y}))==null?void 0:$.positionAssignments)??[]).filter(V=>V.participantId).map(V=>V.participantId),B=_.positionAssignments.filter(V=>!F.includes(V.participantId));for(let V of B)if(V.bye){let H=xs({tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,structureId:c,matchUpsMap:l,event:p,...V});if(H.error)return se({result:H,stack:v})}else if(V.participantId){let H=Uu({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,structureId:c,matchUpsMap:l,event:p,...V});if(H.error)return se({result:H,stack:v,context:{assignment:V}})}return{...ae}}function mDe(t){let{structure:{structures:e}}=t,i=e.map(n=>n.positionAssignments.map(r=>r.drawPosition));return{drawPositionGroups:i,drawPositionChunks:[i]}}function gDe({allDrawPositions:t,roundsToSeparate:e,matchUps:i}){let n=i.filter(u=>u.roundNumber===1).map(u=>u.drawPositions),r=n.flat().sort(wr),o=Math.max(...r),a=t.filter(u=>u>o),s=r.length,l=it(s===2?1:2,s).filter(u=>u===gV(u)),c=l.slice(0,e||l.length).reverse().map(u=>Qr(r,u));return a.length&&console.log({fedDrawPositions:a}),{drawPositionGroups:n,drawPositionChunks:c}}function vDe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var D,E;let h="positionUnseededParticipants";u||({structure:u}=At({drawDefinition:o,structureId:c})),c||({structureId:c}=u);let{positionAssignments:f}=jr({structure:u}),{seedAssignments:m}=ol({provisionalPositioning:t,drawDefinition:o,structure:u}),g=m==null?void 0:m.map(C=>C.participantId).filter(Boolean),{stage:v,stageSequence:y}=u,b=v===Tt?(E=(D=Qt({element:u,name:xu}))==null?void 0:D.extension)==null?void 0:E.value:void 0,I=My({provisionalPositioning:t,drawDefinition:o,stageSequence:y,entryStatuses:lg,structureId:c,roundTarget:b,stage:v}),T=I.filter(C=>!(g!=null&&g.includes(C.participantId))).map(C=>C.participantId),S=f==null?void 0:f.filter(C=>!C.participantId&&!C.bye&&!C.qualifier).map(C=>C.drawPosition);if(!n&&T.length>((S==null?void 0:S.length)||0))return se({result:{error:oV},context:{unseededParticipantsCount:T.length,unfilledDrawPositionsCount:S==null?void 0:S.length},stack:h});let{appliedPolicies:w}=Bi({tournamentRecord:r,drawDefinition:o,event:p}),U=w==null?void 0:w[OT];if(u.stage===$n){let C=I.reduce((M,N)=>(M[N.groupingValue]||(M[N.groupingValue]=[]),M[N.groupingValue].push(N.participantId),M),{});Object.keys(C).length&&(U||(U={policyName:"Playoff Avoidance"}),U.policyAttributes||(U.policyAttributes=[]),U.policyAttributes.push({groupings:C}))}return U&&s?fDe({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,participants:s,matchUpsMap:l,structureId:c,avoidance:U,drawSize:d,entries:I}):yDe({provisionalPositioning:t,unseededParticipantIds:T,inContextDrawMatchUps:e,unfilledDrawPositions:S,multipleStructures:n,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function yDe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unfilledDrawPositions:n,multipleStructures:r,tournamentRecord:o,drawDefinition:a,seedBlockInfo:s,matchUpsMap:l,structureId:c,drawSize:u,event:d}){let p=u>2?Jo(n):n.reverse();for(let h of e){let f=p.pop();if(!r||f){let m=Uu({provisionalPositioning:t,inContextDrawMatchUps:i,tournamentRecord:o,drawDefinition:a,seedBlockInfo:s,participantId:h,drawPosition:f,matchUpsMap:l,structureId:c,event:d});if(m!=null&&m.error&&console.log("!!!!!",{result:m}),m==null?void 0:m.error)return se({result:m,stack:"randomUnseededDistribution"})}}return{...ae}}function bDe(t){let e=t.structure??At(t).structure,i="positionQualifiers",n=[];if(e.stage===Io)return se({result:{error:ig},stack:i});let{unplacedRoundQualifierCounts:r,positionAssignments:o,roundDrawPositions:a}=IDe(t);for(let s of Object.keys(r)){let l=o==null?void 0:o.filter(c=>a[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[s]>(l||0))return se({result:{error:uQ},context:{unfilledDrawPositions:l},stack:i});it(0,r[s]).forEach(()=>{let c=Qa(l);n.push(c),o==null||o.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...ae,qualifierDrawPositions:n}}function IDe({drawDefinition:t,structure:e,structureId:i}){e||({structure:e}=At({drawDefinition:t,structureId:i})),i||({structureId:i}=e);let{positionAssignments:n}=jr({structure:e}),{stage:r,stageSequence:o}=e,{qualifiersCount:a,roundQualifiersCounts:s}=y0({drawDefinition:t,stageSequence:o,structureId:i,stage:r}),l=(s?Object.keys(s):[]).map(m=>Et(m)),{matchUps:c}=_i({structure:e}),{roundProfile:u}=la({matchUps:c}),d=Object.assign({},...l.filter(m=>u==null?void 0:u[m]).map(m=>{var g,v;return{[m]:((v=(g=u==null?void 0:u[m])==null?void 0:g.drawPositions)==null?void 0:v.filter(Boolean))??[]}})),p=n==null?void 0:n.filter(m=>m.qualifier).map(m=>m.drawPosition),h=a-((p==null?void 0:p.length)??0),f=p==null?void 0:p.length;return{unplacedRoundQualifierCounts:Object.assign({},...l.map(m=>{let g=n==null?void 0:n.filter(v=>{var y,b;return v.qualifier&&((b=(y=d[m])==null?void 0:y.drawPositions)==null?void 0:b.includes(v.drawPosition))}).map(v=>v.drawPosition);return{[m]:((s==null?void 0:s[m])??0)-((g==null?void 0:g.length)??0)}})),unplacedQualifiersCount:h,placedQualifiersCount:f,roundQualifiersCounts:s,positionAssignments:n,roundDrawPositions:d,qualifiersCount:a}}function m6({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:o,seedingProfile:a,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){let f=[],m=[],g=0;if(p||({structure:p}=At({drawDefinition:o,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=Bi({drawDefinition:o}).appliedPolicies),!r){let v=p&&Oy({provisionalPositioning:t,appliedPolicies:n,drawDefinition:o,seedingProfile:a,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return c=c??(r==null?void 0:r.length)??0,it(0,c).forEach(()=>{if(g<(c||0)){let v=wDe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:o,seedingProfile:a,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...ae,seedPositions:f}}function wDe({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:o,participants:a,structureId:s,matchUpsMap:l,event:c}){let{unplacedSeedParticipantIds:u,unfilledPositions:d}=Bte({provisionalPositioning:t,randomize:!0,drawDefinition:n,seedingProfile:r,seedBlockInfo:o,structureId:s,event:c}),{appliedPolicies:p}=Bi({drawDefinition:n}),{avoidance:h}=p??{};h&&a&&(u==null?void 0:u.length)>2;let f=[];for(let m of u){let g=d.pop();if(!g)return{error:Zw};f.push(g);let v=Uu({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,seedingProfile:r,participantId:m,seedBlockInfo:o,drawPosition:g,matchUpsMap:l,structureId:s,event:c});if(!v.success)return v}return{...ae,seedPositions:f}}function SDe({provisionalPositioning:t,drawDefinition:e,structure:i}){let{positionAssignments:n}=jr({structure:i}),{seedAssignments:r}=ol({provisionalPositioning:t,drawDefinition:e,structure:i}),o=Object.assign({},...(r||[]).filter(a=>a.participantId).map(a=>({[a.participantId]:a})));return n==null?void 0:n.map(a=>o[a.participantId]?{...a,seedNumber:o[a.participantId].seedNumber,seedValue:o[a.participantId].seedValue}:"").filter(Boolean)}function TDe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){let n=[];e.forEach(o=>{if(i-n.length>o.drawPositions.length)n.push(...o.drawPositions);else{let a=t2(Qr(o.drawPositions,2)),s,l=t[n.length];for(;s=NE(a,l);)n.push(s),l=t[n.length]}});let r=n.map(o=>Array.isArray(o)?Jo(o):o).flat(1/0);return _Q(i)&&e.map(o=>o.seedNumbers[0]).includes(i)?t:r}function NE(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();let i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){let r=t[0].flat(1/0).includes(e)?t[0]:t[1];return NE(e?r:t[Math.round(Math.random())],e)}return i<n?NE(t[1],e):NE(t[0],e)}function t2(t){let e=Math.floor(t.length/2);return t.length>2?[t2(t.slice(0,e)),t2(t.slice(e))]:t}function UDe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:o,byesToPlace:a,structure:s}){var I;o||(o=Oy({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));let{isFeedIn:l,isLuckyStructure:c,isContainer:u}=o,{validSeedBlocks:d}=o;(I=i==null?void 0:i.seeding)!=null&&I.containerByesIgnoreSeeding&&(d=[]);let p=SDe({provisionalPositioning:t,drawDefinition:n,structure:s})??[],h=Zt([].concat(...e.map(T=>T.drawPositions))),f=p.filter(T=>h.includes(T.drawPosition)),m=(T,S)=>YI(T.seedValue)-YI(S.seedValue),g=d.reduce((T,S)=>{let w=f.filter(U=>{var D;return(D=S.drawPositions)==null?void 0:D.includes(U.drawPosition)}).sort(m);return T.concat(...w)},[]).map(T=>T.drawPosition),v=TDe({orderedSortedFirstRoundSeededDrawPositions:g,validSeedBlocks:d,byesToPlace:a}),y=g6({orderedSeedDrawPositions:g,relevantMatchUps:e}).slice(0,a),b=g6({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,a);return{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:c,positionedSeeds:p,isContainer:u,isFeedIn:l}}function g6({orderedSeedDrawPositions:t,relevantMatchUps:e}){let i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,o)=>r-o)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,o)=>t.includes(o)?r:o,void 0)).filter(Boolean)}function DDe({provisionalPositioning:t,seedOrderByePositions:e,isLuckyStructure:i,appliedPolicies:n,drawDefinition:r,seedLimit:o,structure:a,isFeedIn:s}){var A,_;let l=(A=n==null?void 0:n.seeding)==null?void 0:A.seedingProfile,c=a.stage===Tt,{positionAssignments:u}=jr({structure:a}),d=u==null?void 0:u.filter(k=>k.participantId).map(k=>k.drawPosition),p={isCollectionMatchUp:!1},{matchUps:h,roundMatchUps:f}=_i({provisionalPositioning:t,matchUpFilters:p,structure:a}),m=(f==null?void 0:f[1])||[],g=a.structureType===fa?h:m,v=Zt([].concat(...g.map(k=>k.drawPositions))),y=Math.min(...v)-1,b=d==null?void 0:d.filter(k=>v.includes(k)),I=k=>{let O=Math.ceil(k.length/2),F=[k.slice(0,O),k.slice(O)],B=F.map(Z=>[].concat(...Z.flat(1/0)).length),$=Math.min(...B.flat(1/0)),V=Math.max(...B.flat(1/0)),H=B.indexOf(V),z=$!==V,G=Jo(F),[W,K]=!$||z?[F[H],F[1-H]]:[G[0],G[1]];return{greaterHalf:W,lesserHalf:K}},T=k=>{let{greaterHalf:O,lesserHalf:F}=I(k),{greaterHalf:B,lesserHalf:$}=I(O),V=Jo(B.flat(1/0)).pop(),H=B.flat().filter(z=>z!==V);return{newlyFilteredChunks:[...F,...$,H],drawPosition:V}},S=k=>!e.includes(k),w=k=>!(b!=null&&b.includes(k)),U=k=>{let O=Qr(k.sort(wr),Math.ceil(k.length/4)).map($=>$.filter(w)),F=[].concat(...O.flat(1/0)).length,B=[];for(let $=0;$<F;$++){let{newlyFilteredChunks:V,drawPosition:H}=T(O);B.push(H),O=V}return B},{validSeedBlocks:D}=Oy({provisionalPositioning:t,allPositions:!0,appliedPolicies:n,drawDefinition:r,structure:a}),E=D==null?void 0:D.map(k=>{var O;return(O=k.drawPositions)==null?void 0:O.map(F=>F+y)}),C;if(s){let k=v.length,{seedBlocks:O}=Vj({cluster:ZD(l)===hA,participantsCount:k});C=O.map(F=>F.map(B=>B+y)).map(U).filter(F=>F.length)}else c?C=E==null?void 0:E.map(k=>k.filter(w)):C=E==null?void 0:E.map(U).filter(k=>k.length);let M=g.map(k=>k.drawPositions).map(k=>k==null?void 0:k.sort((O,F)=>O-F)).filter(k=>(k==null?void 0:k[0])+1===(k==null?void 0:k[1])),N=k=>M.reduce((O,F)=>F.includes(k)?F.reduce((B,$)=>$!==k?$:B,void 0):O,void 0),R=C.map(k=>k.map(N)).flat(1/0).filter(w).filter(S).filter(Boolean);if(c&&!a.structures){let k=o%4,O=R.slice(0,k),F=(_=f[a.roundLimit])==null?void 0:_.length,B=Qr(R.slice(k),F).map(Jo).flat();R=O.concat(B)}return{unseededByePositions:R}}function PDe({provisionalPositioning:t,drawDefinition:e,matchUpsMap:i,structure:n,event:r}){var E;let o={isCollectionMatchUp:!1},{matchUps:a,roundMatchUps:s}=_i({afterRecoveryTimes:!1,provisionalPositioning:t,drawDefinition:e,matchUpFilters:o,matchUpsMap:i,structure:n,event:r}),l=(s==null?void 0:s[1])||[],c=(n==null?void 0:n.structureType)===fa,u=c?a:l,d=c?((E=n==null?void 0:n.structures)==null?void 0:E.length)||0:a.length,{structureId:p,stage:h,stageSequence:f}=n,m=My({entryStatuses:ec,provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),{qualifiersCount:g}=y0({provisionalPositioning:t,drawDefinition:e,stageSequence:f,structureId:p,stage:h}),v=m.length+g,{positionAssignments:y,unassignedPositions:b}=jr({structure:n}),I=b==null?void 0:b.map(C=>C.drawPosition),T=y==null?void 0:y.filter(C=>C.bye).length,S=y==null?void 0:y.filter(C=>C.bye).map(C=>C.drawPosition),w=u.map(C=>C.drawPositions).filter(C=>C==null?void 0:C.reduce((M,N)=>!(S!=null&&S.includes(N))&&M,!0)).flat(1/0).filter(C=>I==null?void 0:I.includes(C)),U=y==null?void 0:y.length,D=U?U-v:0;return D>d&&n.stageSequence===1&&n.stage!==Io&&(D=d),{placedByes:T,byesCount:D,relevantMatchUps:u,placedByePositions:S,roundMatchUps:s,positionsToAvoidDoubleBye:w}}function v6({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:o,matchUpsMap:a,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var M;l||({structure:l}=At({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);let p=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===Tt),{byesCount:h,placedByes:f,relevantMatchUps:m}=PDe({provisionalPositioning:t,drawDefinition:n,matchUpsMap:a,structure:l,event:d}),g=h-(f||0);if(g<=0)return{...ae};let{strictSeedOrderByePositions:v,blockSeedOrderByePositions:y,isLuckyStructure:b,isFeedIn:I}=UDe({provisionalPositioning:t,relevantMatchUps:m,appliedPolicies:i,drawDefinition:n,seedingProfile:o,seedBlockInfo:r,byesToPlace:g,structure:l}),T=(l==null?void 0:l.structureType)&&[fa,fA].includes(l.structureType)&&((M=i==null?void 0:i.seeding)==null?void 0:M.containerByesIgnoreSeeding),S=p&&(y!=null&&y.length)?y:v,{unseededByePositions:w}=DDe({provisionalPositioning:t,seedOrderByePositions:S,isLuckyStructure:b,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:I}),U=N=>N%2,D=(N,R)=>(N||[]).every(A=>U(A)?R!==A+1:R!==A-1),E=[].concat(...S);if(!u)for(;w.length;){let N=w.find(R=>D(E,R));N?(E.push(N),w=w.filter(R=>R!==N)):(E.push(...w),w=[])}T&&(E=Jo(E),rl({ignoreSeededByes:T})&&console.log({byePositions:E}));let C=E.slice(0,g);for(let N of C){let R=xs({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:N,matchUpsMap:a,structureId:s,structure:l,event:d});if(R!=null&&R.error)return R}return{...ae,unseededByePositions:w,byeDrawPositions:C}}function XD(t){var A,_,k,O;let{drawDefinition:e}=t,{applyPositioning:i=!0,provisionalPositioning:n,multipleStructures:r,placeByes:o=!0,tournamentRecord:a,placementGroup:s,seedingProfile:l,structureId:c,seedLimit:u,seedsOnly:d,drawType:p,drawSize:h,event:f}=t,m=[];i||(jQ(),e=dt(e,!1,!0));let g=F=>(i||TE(),se({result:F,stack:"automatedPositioning"})),v=F=>(i||TE(),F),y=At({drawDefinition:e,structureId:c});if(y.error)return g(y);let b=y.structure;if(!b)return{error:Nn};let I=t.appliedPolicies||((A=Bi({drawDefinition:e,structure:b,event:f}))==null?void 0:A.appliedPolicies),{qualifiersCount:T}=y0({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,drawDefinition:e,structureId:c}),S=lg;if(!((_=My({stageSequence:b.stageSequence,provisionalPositioning:n,stage:b.stage,placementGroup:s,drawDefinition:e,entryStatuses:S,structureId:c}))!=null&&_.length)&&!T)return v({...ae});let w=t.matchUpsMap??Uo({drawDefinition:e}),U=t.inContextDrawMatchUps??((k=Tr({inContext:!0,drawDefinition:e,matchUpsMap:w}))==null?void 0:k.matchUps),D=[],E=Oy({provisionalPositioning:n,appliedPolicies:I,drawDefinition:e,seedingProfile:l,structure:b});if(E.error)return E;let{validSeedBlocks:C}=E;m.push({validSeedBlocks:C});let M=t.participants||(a?(O=zn({withIndividualParticipants:!0,convertExtensions:!0,tournamentRecord:a}))==null?void 0:O.participants:[]);if(ZD(b.seedingProfile||l)===Dm){let F=o?v6({provisionalPositioning:n,tournamentRecord:a,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:w,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(F!=null&&F.error)return g(F);D=F.unseededByePositions,m.push({action:"positionByes",unseededByePositions:D});let B=b.seedingProfile?{positioning:b.seedingProfile}:l;if(F=m6({seedingProfile:B,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:a,appliedPolicies:I,validSeedBlocks:C,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:w,structure:b,event:f}),F.error)return g(F);m.push({seedPositions:F.seedPositions,action:"positionSeedBlocks"})}else{if(p!==og){let B=b.seedingProfile?{positioning:b.seedingProfile}:l,$=m6({seedingProfile:B,provisionalPositioning:n,inContextDrawMatchUps:U,tournamentRecord:a,appliedPolicies:I,validSeedBlocks:C,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:w,structure:b,event:f});if($.error)return g($);m.push({action:"positionSeedBlocks",seedPositions:$.seedPositions})}let F=o?v6({provisionalPositioning:n,tournamentRecord:a,appliedPolicies:I,drawDefinition:e,seedBlockInfo:E,matchUpsMap:w,structure:b,seedLimit:u,seedsOnly:d,event:f}):void 0;if(F!=null&&F.error)return g(F);D=F==null?void 0:F.unseededByePositions,m.push({action:"positionByes",byeDrawPositions:F==null?void 0:F.byeDrawPositions,unseededByePositions:D})}let N={};if(!d){let F=bDe({inContextDrawMatchUps:U,tournamentRecord:a,appliedPolicies:I,validSeedBlocks:C,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:w,structure:b});if(F.error||(F.conflicts&&(N.qualifierConflicts=F.conflicts),m.push({action:"positionQualifiers",qualifierDrawPositions:F.qualifierDrawPositions}),F=vDe({provisionalPositioning:n,inContextDrawMatchUps:U,unseededByePositions:D,multipleStructures:r,tournamentRecord:a,drawDefinition:e,seedBlockInfo:E,participants:M,matchUpsMap:w,structureId:c,structure:b,drawSize:h,event:f}),F.error))return g(F);F.conflicts&&(N.unseededConflicts=F.conflicts),m.push({action:"positionUnseededParticipants"})}let{positionAssignments:R}=Yi({drawDefinition:e,structure:b});return cn({drawDefinition:e,structureIds:[c]}),i||TE(),{positionAssignments:R,conflicts:N,...ae,positioningReport:m}}function JD(t){var h;let{applyPositioning:e=!0,provisionalPositioning:i,tournamentRecord:n,drawDefinition:r,seedingProfile:o,structureId:a,placeByes:s,seedsOnly:l,event:c}=t;if(!c)return{error:rs};if(!r)return{error:ns};if(!Xh({drawDefinition:r,structureId:a})&&!i)return{error:V$};let u=(h=tie({drawDefinition:r,structureId:a}).playoffStructures)==null?void 0:h.sort((f,m)=>CM(f)-CM(m)),d=[],p=[];if(u)for(let f of u){let{structureId:m}=f,g=XD({structureId:m,provisionalPositioning:i,applyPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:o,placeByes:s,seedsOnly:l});if(g.error)return g;g.positionAssignments&&d.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&p.push(g.positioningReport)}return{...ae,structurePositionAssignments:d,positioningReports:p}}function oie({drawDefinition:t,orderMap:e}){return t?((typeof e!="object"||!Object.values(e).every(i=>Bt(i)))&&se({result:{error:Pe},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{let n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>OI(i.structureOrder)-OI(n.structureOrder)),{...ae}):{error:lt}}function xA({drawDefinition:t}){var g,v,y,b,I,T,S;let e=t.structures??[],i=t.links??[],n=new Map,r=w=>{let U=n.get(w)||n.set(w,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&n.get(w);if(U&&!(U!=null&&U.stage)){let D=e.find(E=>E.structureId===w);U.stage=D==null?void 0:D.stage}return U},o={},a={},s=i.map(w=>{let U=w.source.structureId,D=w.target.structureId,E=r(U),C=r(D);return[Pm,Nl,mA,Dm].includes(w.target.feedProfile)?(E==null||E.targets.push(D),C==null||C.sources.push(U)):w.target.feedProfile===Rl&&(C==null||C.drawSources.push(U),E==null||E.drawTargets.push(D)),a[D]=a[D]||w.target.feedProfile===Rl,o[D]=Zt([...o[D]||[],U]).filter(Boolean),[w.source.structureId,w.target.structureId]});for(let w of n.keys()){let U=n.get(w);if(U){let D=U.targets??[];for(;D.length;){let E=D.pop(),C=E&&n[E];(g=C==null?void 0:C.targets)!=null&&g.length?D.push(...C.targets):C&&(U.rootStage=C.stage)}if(U.rootStage||(U.rootStage=U.stage),!((v=U.targets)!=null&&v.length)){let E=U.sources??[];for(;E.length;){let C=E.pop(),M=C&&n[C];if((y=M==null?void 0:M.sources)!=null&&y.length){for(let N of M.sources)(b=U.progeny)!=null&&b.includes(N)||((I=U.progeny)==null||I.push(N));E.push(...M.sources)}}}}}let l=0;for(let w of n.keys()){let U=n.get(w);if(U&&U.rootStage===Tt){let D=[(T=U.drawTargets)==null?void 0:T[0]],E=0;for(;D.length;){E+=1;let C=D.pop(),M=C?n.get(C):void 0;(S=M==null?void 0:M.drawTargets)!=null&&S.length&&D.push(M.drawTargets[0])}U.distanceFromMain=E,E>l&&(l=E)}}let c=s.length;it(0,Math.ceil(c/2)).forEach(()=>{s=it(0,c).map(w=>{let U=s[w],D=s.reduce((E,C)=>sa(U,C)?E.concat(...C):E,[])||[];return Zt(U.concat(...D))})});let u=s[0],d=(w,U)=>Hn(w,U).length===w.length,p=s.slice(1).reduce((w,U)=>w&&d(U,u),!0),h=[u].filter(Boolean),f=[u].filter(Boolean);e.forEach(w=>{let{structureId:U,stage:D}=w;h.find(E=>E.includes(U))||(h.push([U]),D!==Xr&&f.push([U]))});let m=p&&f.length===1;return!(i!=null&&i.length)&&e.length===1&&r(e[0].structureId),{structureProfiles:Object.fromEntries(n),allStructuresLinked:m,maxQualifyingDepth:l,sourceStructureIds:o,hasDrawFeedProfile:a,structureGroups:h}}function aie({drawDefinition:t}){let{maxQualifyingDepth:e,structureProfiles:i}=xA({drawDefinition:t});for(let n of t.structures){let r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...ae}}function Cf(t){var l;let{duplicateValues:e=!0,creationTime:i=!0,removePriorValues:n,timeItem:r,element:o}=t;if(!r)return{error:cV};if(!o)return{error:gt,info:xV};let a=r&&Object.keys(r),s=["itemType","itemValue"];if(s.filter(c=>a.includes(c)).length!==s.length)return{error:lV};if(!o.timeItems)o.timeItems=[];else{let{itemType:c,itemSubTypes:u,itemValue:d}=r,p=c&&((l=Fu({itemSubTypes:u,itemType:c,element:o}))==null?void 0:l.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!e)return{...ae}}if(r.itemSubTypes&&!r.itemSubTypes.length&&delete r.itemSubTypes,i){let c=new Date().toISOString();Object.assign(r,{createdAt:c})}return n&&(o.timeItems=o.timeItems.filter(({itemType:c})=>r.itemType!==c)),n&&!r.itemValue||o.timeItems.push(r),{...ae}}function Zj({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:o}){if(!i)return{error:Ge};if(!r)return{error:Rr};let a=hg({tournamentRecord:i,participantId:r});return a.error?a:Cf({element:a.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:o})}function Fy(t){let{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:o}=t;return i?Cf({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:o}):{error:Ge}}function By(t){let{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:o}=t;return o?Cf({removePriorValues:e,duplicateValues:i,element:o,creationTime:n,timeItem:r}):{error:rs}}function Xj({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:Ge};if(!e)return{error:lt};let r=CDe({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});if(r.error)return r;let o={itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}};return Fy({tournamentRecord:t,timeItem:o}),r}function CDe({drawDefinition:t,tournamentId:e,structure:i,eventId:n,link:r}){var l;if(!t)return{error:lt};if(!i)return{error:vf};if(!r)return{error:W$};let o=r.target.structureId,a=At({drawDefinition:t,structureId:o});if(a.error)return se({stack:"attachQualifyingStructure",context:{targetStructureId:o},result:a});t.structures||(t.structures=[]),t.links||(t.links=[]),t.structures.push(i),t.links.push(r),aie({drawDefinition:t});let s=((l=_i({structure:i}))==null?void 0:l.matchUps)||[];return Yh({drawDefinition:t,tournamentId:e,matchUps:s,eventId:n}),cn({drawDefinition:t,structureIds:[i.structureId]}),{...ae}}function sie({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Pe};if(!t)return{error:lt};let i=Object.assign({},...e.map(n=>{if(!ln(n))return;let{structureId:r,structureName:o}=n||{};if(!(!r||!o))return{[r]:o}}).filter(Boolean));if(!Object.values(i).length)return{error:gt};for(let n of t.structures||[]){let r=i[n.structureId];r&&(n.structureName=r)}return{...ae}}function Jj({drawDefinition:t,timeItem:e}){if(!t)return{error:ns};if(!e)return{error:cV};let i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(o=>i.includes(o)).length!==n.length)return{error:lV};t.timeItems||(t.timeItems=[]);let r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),PD({drawDefinition:t}),{...ae}}function lie(t){var v;let{tournamentRecord:e,drawDefinition:i,structureId:n,event:r}=t,o=Ei(t,[{drawDefinition:!0,structureId:!0}]);if(o.error)return o;let a=i.structures??[],s=a.find(y=>y.structureId===n);if(!s)return{error:Nn};let l=a.find(({stage:y,stageSequence:b})=>y===ut&&b===1),c=n===(l==null?void 0:l.structureId),u=a.filter(({stage:y})=>y===Tt).map(as("structureId"));if(c&&!u.length)return{error:DJ};let d=u.includes(n),p=EDe({isQualifyingStructure:d,structure:s,...t});if(p!=null&&p.error)return p;let{structureIdsToRemove:h,relatedStructureIdsMap:f}=RDe({qualifyingStructureIds:u,isQualifyingStructure:d,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureId:n}),{removedMatchUpIds:m,removedStructureIds:g}=NDe({relatedStructureIdsMap:f,qualifyingStructureIds:u,isMainStageSequence1:c,mainStageSequence1:l,drawDefinition:i,structureIdsToRemove:h,structureId:n});if(MDe({removedMatchUpIds:m,drawDefinition:i}),c){let y=(v=l.matchUps??[])==null?void 0:v.map(as("matchUpId"));m.push(...y),l.positionAssignments=[],l.seedAssignments=[],l.matchUps=[],l.extensions&&(l.extensions=[])}return d&&aie({drawDefinition:i}),Bp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:m,action:"removeStructure",eventId:r==null?void 0:r.eventId,drawDefinition:i}),cn({drawDefinition:i,eventId:r==null?void 0:r.eventId}),{...ae,removedMatchUpIds:m,removedStructureIds:g}}function EDe({isQualifyingStructure:t,tournamentRecord:e,drawDefinition:i,structureId:n,structure:r,event:o,force:a}){var l,c,u,d,p,h;let s=[n];if(t){let f=g=>{var v;return(v=i.links)==null?void 0:v.find(y=>y.target.structureId===g)},m=(l=f(n))==null?void 0:l.source.structureId;for(;m;)s.push(m),m=(c=f(m))==null?void 0:c.source.structureId}if((u=Tr({matchUpFilters:{structureIds:s},drawDefinition:i}).matchUps)!=null&&u.some(({score:f})=>io({score:f}))){let f=(d=Bi({tournamentRecord:e,drawDefinition:i,structure:r,event:o}))==null?void 0:d.appliedPolicies;if(!(a??((h=(p=f==null?void 0:f[vd])==null?void 0:p.allowDeletionWithScoresPresent)==null?void 0:h.structures)))return{error:tA}}return{...ae}}function MDe({removedMatchUpIds:t,drawDefinition:e}){let{matchUps:i}=Tr({drawDefinition:e});i==null||i.forEach(n=>{n.winnerMatchUpId&&t.includes(n.winnerMatchUpId)&&delete n.winnerMatchUpId,n.loserMatchUpId&&t.includes(n.loserMatchUpId)&&delete n.loserMatchUpId})}function RDe({qualifyingStructureIds:t,isQualifyingStructure:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureId:o}){let a=(r.structures??[]).map(as("structureId")),s=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>p.source.structureId===u&&p.target.structureId!==(n==null?void 0:n.structureId)&&p.target.structureId).filter(Boolean))??[]},l=u=>{var d;return((d=r.links)==null?void 0:d.map(p=>t.includes(p.source.structureId)&&p.target.structureId===u&&p.source.structureId).filter(Boolean))??[]},c=new Map;return a.forEach(u=>c.set(u,e?l(u):s(u))),{structureIdsToRemove:i?c.get(o):[o],relatedStructureIdsMap:c}}function NDe({relatedStructureIdsMap:t,qualifyingStructureIds:e,isMainStageSequence1:i,mainStageSequence1:n,drawDefinition:r,structureIdsToRemove:o,structureId:a}){let s=[],l=[];for(;o!=null&&o.length;){let c=o.pop();l.push(...kDe({idBeingRemoved:c,drawDefinition:r}));let u=_De({qualifyingStructureIds:e,isMainStageSequence1:i,idBeingRemoved:c,drawDefinition:r,structureId:a});s.push(...u.removedStructureIds);let d=ADe({relatedStructureIdsMap:t,mainStageSequence1:n,idBeingRemoved:c,structureId:a});d!=null&&d.length&&o.push(...d)}return{removedMatchUpIds:l,removedStructureIds:s}}function ADe({idBeingRemoved:t,relatedStructureIdsMap:e,mainStageSequence1:i,structureId:n}){var r;return t&&((r=e.get(t))==null?void 0:r.filter(o=>o!==(i==null?void 0:i.structureId)||n===i.structureId))}function _De({qualifyingStructureIds:t,isMainStageSequence1:e,idBeingRemoved:i,drawDefinition:n,structureId:r}){var a;let o=[];return n.links=((a=n.links)==null?void 0:a.filter(s=>s.source.structureId!==i&&s.target.structureId!==i))??[],(!e||e&&t.length||i!==r)&&(n.structures=(n.structures??[]).filter(s=>(i&&i===s.structureId&&o.push(i),s.structureId!==i))),{removedStructureIds:o}}function kDe({idBeingRemoved:t,drawDefinition:e}){let{structure:i}=At({structureId:t,drawDefinition:e}),n=_i({structure:i}).matchUps;return jV(n)}function OM({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:lt};if(!bj({drawDefinition:e,stage:n}))return{error:ig};let r=vTe({drawDefinition:e,stage:n}),{qualifiersCount:o}=y0({drawDefinition:e,stageSequence:t,stage:n}),a=r+o;if(i<a)return{error:z$};let{entryProfile:s}=yj({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return cn({drawDefinition:e}),{...ae,entryProfile:s}}function cie({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?bj({drawDefinition:e,stage:i})?i!==ut?{error:z$,info:"qualifiersCount can only be set for main stage"}:(yj({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),cn({drawDefinition:e}),{...ae}):{error:ig}:{error:lt}}function xDe({drawDefinition:t,drawSize:e}){if(!t)return{error:lt};let i=OM({stage:Xr,stageSequence:1,drawDefinition:t,drawSize:e});return i.error?i:(cn({drawDefinition:t}),{...ae})}function uie(t){return xDe(t)}function die({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var a;let r="removeSeededParticipant";if(!t)return{error:Ge};if(!e)return{error:lt};let o=(e.structures??[]).find(s=>s.structureId===n);return o?!o.stage||![ut,Tt].includes(o.stage)||o.stage===ut&&o.stageSequence!==1?se({result:{error:Iy},stack:r}):(a=o.seedAssignments)!=null&&a.find(s=>s.participantId===i)?{...ae}:se({info:"participant not seeded",result:{error:_o},context:{participantId:i}}):se({result:{error:Nn},stack:r})}function QD({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:o=vp}){return!n||!r?{error:_s}:{link:wt({linkType:o,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Rl,roundNumber:t,structureId:r}})}}function Qj({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||ji()}function LM({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:o,uuids:a,nodes:s}){let l=0,c=[],u=1,d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){let h=s==null?void 0:s[l],f=s==null?void 0:s[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);let m=Qj({roundPosition:u,roundNumber:i,idPrefix:r,uuids:a}),g={roundPosition:u,children:[h,f],matchUpId:m};c.push(g);let v={drawPositions:g.children.map(y=>y==null?void 0:y.drawPosition).filter(Boolean),matchUpStatus:Gn,matchUpId:g.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(v.matchUpType=e),o&&(v.isMock=!0),n.push(v),u++,l+=2}return{roundNodes:c,matchUps:n}}function Du({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:o,idPrefix:a,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!kc(s)||s%n)){let g=n;for(;g<s;)g=2*g;s=g}let u=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!kc(s)&&!u)return{matchUps:[],roundsCount:0};let d=it(1,s+1).map(g=>({drawPosition:g})),p,h=[],f=1;for({roundNodes:p,matchUps:h}=LM({matchUpType:r,roundNumber:f,idPrefix:a,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,o=o??i;p.length>1;)n&&p.length===n&&(o=f-1),{roundNodes:p,matchUps:h}=LM({nodes:p,matchUpType:r,roundNumber:f,idPrefix:a,matchUps:h,isMock:l,uuids:c}),f++;let m=f-1;return h=CD({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:o,matchUps:h}),o?h=h.filter(g=>o&&(g.roundNumber??0)<=o):o=f-1,{drawSize:s,matchUps:h,roundsCount:m,roundLimit:o}}function eH(t){var O,F,B,$,V,H;let e="generateQualifyingStructure";if(!t.drawDefinition)return se({result:{error:lt},stack:e});if(t.drawSize&&!Bt(t.drawSize)||t.participantsCount&&!Bt(t.participantsCount)||t.qualifyingPositions&&!Bt(t.qualifyingPositions))return se({result:{error:Pe},stack:e});let i=t.drawSize??mV(t.participantsCount),{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:o,structureOptions:a,appliedPolicies:s,drawDefinition:l,matchUpFormat:c,structureName:u,structureId:d,roundTarget:p,drawType:h,idPrefix:f,isMock:m,uuids:g}=t;if(!t.drawSize)return se({result:{error:uD},context:{drawSize:i},stack:e});if(r&&r>=t.drawSize)return se({result:{error:Pe},context:{drawSize:i,qualifyingPositions:r},stack:e});let v,y,b,I,T=0,S,w=1,{structureProfiles:U}=xA({drawDefinition:l}),D=U[o];if(!D)return se({result:{error:Nn},context:{targetStructureId:o},stack:e});let E=l.matchUpType,C=p?`${p}-`:"",M=D.stage===Tt,N=((F=(O=s==null?void 0:s[FI])==null?void 0:O.namingConventions)==null?void 0:F.pre)??(($=(B=KTe[FI])==null?void 0:B.namingConventions)==null?void 0:$.pre),R=M&&N?`${N}-`:"",A=u??(C?`${R}${vo(Tt)} ${C}`:`${R}${vo(Tt)}`);if(h===Hl){let{maxRoundNumber:z,structures:G,groupCount:W}=YD({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),stage:Tt,structureOptions:a,appliedPolicies:s,stageSequence:w,matchUpType:E,roundTarget:p,idPrefix:f,drawSize:i,isMock:m,uuids:g});T=W,v=z,b=G[0],S=[1]}else({drawSize:i,matchUps:I,roundLimit:v,roundsCount:y}=Du({qualifyingRoundNumber:n,qualifyingPositions:r,matchUpType:E,idPrefix:f,drawSize:i,isMock:m,uuids:g})),v||(v=y),b=Ys({structureName:u??A,structureId:d??(g==null?void 0:g.pop()),qualifyingRoundNumber:v,stage:Tt,matchUpFormat:c,stageSequence:w,matchUpType:E,roundLimit:v,matchUps:I}),p&&Ui({extension:{name:xu,value:p},element:b}),T=(V=I==null?void 0:I.filter(z=>z.roundNumber===v))==null?void 0:V.length;let _=h===Hl?gp:vp,k=b&&v&&((H=QD({sourceStructureId:b.structureId,sourceRoundNumber:v,targetStructureId:o,finishingPositions:S,linkType:_}))==null?void 0:H.link);return{qualifyingDrawPositionsCount:i,qualifiersCount:T,...ae,structure:b,link:k}}function pie(t){let e=t.tournamentRecord;if(!e)return{error:Ge};let i=ODe(t);if(i.error)return i;let{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:o,drawDefinition:a,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t,d={itemType:"addQualifyingStructures",itemValue:wt({drawId:a.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:o,structureName:s,matchUpType:l,drawSize:c,drawType:u})};return Fy({tournamentRecord:e,timeItem:d}),i}function ODe(t){if(!t.drawDefinition)return{error:lt};if(!t.targetStructureId)return{error:_s};let e=eH(t);if(e.error)return e;let{structure:i,link:n}=e;return!i||!n?{error:Pe}:Xj({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,structure:i,link:n})}function LDe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:o,isMock:a,uuids:s,nodes:l,fed:c}){let u=l.length,d=e?e-u:void 0,p=it(0,u).map(m=>d?d+m:void 0),h=[];for(let m=0;m<u;m++){let g=p.shift(),v={drawPosition:g,fed:c+1,feed:!0},y=l[m];y.roundNumber=i-1;let b=Qj({roundPosition:y.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),I={roundPosition:y.roundPosition,drawPositions:[g],matchUpStatus:Gn,roundNumber:i,matchUpId:b};t&&(I.matchUpType=n),a&&(I.isMock=!0),o.push(I);let T={children:[y,v]};h.push(T)}let f=e?e-u:void 0;return{roundNodes:h,matchUps:o,drawPosition:f}}function Jh(t){let e=t.drawSize,{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:o}=t,{linkFedFinishingRoundNumbers:a,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;o=o??R(e);let g=FDe({drawSize:o}),v=g.length,y=0;if(i!=null&&i.length)y=i.reduce((A,_)=>A+_,0);else if(e){let A=e-o;i=g.filter(_=>_<=A?(A-=_,!0):!1),y=i.reduce((_,k)=>_+k,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((A,_)=>c&&!n||n&&_>=r+n||_<r?0:A),y=i.reduce((A,_)=>A+_,0),n=i.length;let b=[...g,...i].sort((A,_)=>_-A),I=b.length,T=[...(l??[]).map(A=>A-1),...(a??[]).map(A=>I-A)].map(A=>b[A]).reduce((A,_)=>A+_,0);y=y-T;let S=0,w=[],U,D=1,E=it(0,o).map((A,_)=>({drawPosition:_+1+y})),C=y+1;for(let A of g){if({roundNodes:U,matchUps:w}=LM({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:w,isMock:h,nodes:E,uuids:f}),D++,i.includes(A)){let _=os(i)[A],k=it(0,_),O=I+1-D,F=(a==null?void 0:a.includes(O))??(l==null?void 0:l.includes(D));k.forEach(()=>{({roundNodes:U,matchUps:w,drawPosition:C}=LDe({drawPosition:!F&&C||void 0,nodes:U,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:w,isMock:h,uuids:f,fed:S})),D++,S+=1})}E=U}I!==D-1&&console.log("ERROR");let M=o-y;w=CD({finishingPositionOffset:u?M:s,positionsFed:y,roundsCount:I,matchUps:w,fmlc:m});let N=U!=null&&U.length?U[0]:U;return N&&(N.roundNumber=D-1,N.matchUps=w),{draw:N,matchUps:w,roundsCount:I};function R(A){let _=gV(A);return _>A?_/2:_}}function FDe({drawSize:t}){let e=Math.ceil(Math.log(t)/Math.log(2));return it(0,e).reverse().map(i=>Math.pow(2,i))}function gI(t){let{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:o,playoffAttributes:a,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=ut,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!a||!c||a!=null&&a[l])||g<2||f&&s>f)return{};let I=[],T=[],S=[],w=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,D=e+g,E=`${U}-${D}`,C=a==null?void 0:a[l],M=n&&`${n} `||"",N=(a==null?void 0:a[E])??(r==null?void 0:r[E]),R=t.structureName||(N==null?void 0:N.name)||(C==null?void 0:C.name)&&(i?`${M}${C==null?void 0:C.name}`:C.name)||`${M}${E}`,A=(N==null?void 0:N.abbreviation)??(C==null?void 0:C.abbreviation),_=t.structureId??(C==null?void 0:C.structureId)??(b==null?void 0:b.pop()),k={idPrefix:v&&`${v}-${R}-RP`,finishingPositionOffset:e,matchUpType:w,drawSize:g,isMock:y,uuids:b},{matchUps:O}=h?Jh(k):Du(k),F=Ys({structureAbbreviation:A,stageSequence:s,structureName:R,matchUpType:w,roundOffset:d,structureId:_,matchUps:O,stage:m});I.push(...O),T.push(F);let B=Math.ceil(Math.log(g)/Math.log(2)),$=u?Math.min(u-d,B):!o||U<o?B:0;return g>2&&it(1,$+1).forEach(H=>V(H)),{structureId:F.structureId,matchUps:I,structureName:R,structures:T,links:S,...ae};function V(H){let z=g/Math.pow(2,H);if(z<2)return;let G=g/Math.pow(2,H)+e;if(o&&G+1>o)return;let{structures:W,structureId:K,matchUps:Z,links:Y}=gI({finishingPositionOffset:G,exitProfile:`${l}-${H}`,roundOffset:d+H,stageSequence:s+1,drawSize:z,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:o,playoffAttributes:a,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:w,idPrefix:v,uuids:b,stage:m});if(F.structureId&&K){let X={linkType:yd,source:{roundNumber:H,structureId:F.structureId},target:{roundNumber:1,feedProfile:Nl,structureId:K}};Y&&F&&Y.push(X),Y!=null&&Y.length&&S.push(...Y)}return W!=null&&W.length&&T.push(...W),Z!=null&&Z.length&&I.push(...Z),{structureId:K,childLinks:Y,structures:T}}}function tH({drawDefinition:t,matchUpsMap:e,structureId:i}){let n=At({drawDefinition:t,structureId:i});if(n.error)return se({result:n});let{matchUps:r}=_i({structure:n.structure,matchUpsMap:e});return{...la({matchUps:r}),matchUps:r,matchUpsMap:e}}function y6({finishingPositions:t,drawDefinition:e,structureId:i}){var r;let{roundProfile:n}=tH({drawDefinition:e,structureId:i});return(r=n&&Object.keys(n))==null?void 0:r.reduce((o,a)=>(hie(n==null?void 0:n[a]).forEach(s=>{t.forEach(l=>{BDe({position:l,rangeDefinition:s})&&(o[l]={roundNumber:a})})}),o),{})}function BDe({position:t,rangeDefinition:e}){if(!Array.isArray(e)||e.reduce((r,o)=>r||isNaN(o),!1))return!1;let[i,n]=e;return it(i,(n||i)+1).includes(t)}function hie(t){var e,i;return[Zt(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),Zt(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function $De(t){return hie(t).map(e=>it(e[0],e[1]&&e[1]+1||e[0]+1))}function w0({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Pe,context:{structureIds:e}};if(!t)return{error:lt};e=e??(t.structures??[]).filter(o=>o.stage!==Tt).map(({structureId:o})=>o);let n=e.map(o=>{var s;let{roundProfile:a}=tH({drawDefinition:t,matchUpsMap:i,structureId:o});return(s=a&&Object.values(a))==null?void 0:s.map($De).flat()}).flat(),r=n.filter(o=>(o==null?void 0:o.length)===1).sort(wr).flat();return{positionsNotPlayedOff:Zt(n.flat()).filter(o=>!r.includes(o)),positionsPlayedOff:r}}function fie({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:lt};if(!n)return{error:_s};if(!e)return{error:gt,info:"missing playoffPositions"};let r=w0({drawDefinition:i});if(r.error)return r;let o=r.positionsPlayedOff,a=e.filter(v=>!o.includes(v)),s=y6({finishingPositions:a,drawDefinition:i,structureId:n}),l=Object.values(s).reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Et(v)).filter(v=>!t.includes(v)),c=y6({finishingPositions:o,drawDefinition:i,structureId:n}),u=c?Object.values(c):[],d=c?u.reduce((v,y)=>v.includes(y.roundNumber)?v:v.concat(y.roundNumber),[]).map(v=>Et(v)):[],p=l.filter(v=>!d.includes(v)).sort(wr),{roundProfile:h}=tH({drawDefinition:i,structureId:n}),f=p.map(v=>{let y=h==null?void 0:h[v].finishingPositionRange.loser,[b,I]=y??[0,0];return it(b,(I||b)+1)}).flat().sort(wr),{playoffRoundsRanges:m}=VDe({playoffSourceRounds:p,roundProfile:h}),g=[...p,...d];return{playoffPositionsReturned:f,playedOffSourceRounds:d,playoffRoundsRanges:m,playoffSourceRounds:p,sourceRounds:g,roundProfile:h}}function VDe({playoffSourceRounds:t,roundProfile:e}){return{playoffRoundsRanges:t.map(i=>{let n=e[i].finishingPositionRange.loser,[r,o]=n,a=it(r,(o||r)+1);return{finishingPositionRange:n.join("-"),finishingPositions:a,roundNumber:i}})}}function eP({drawDefinition:t,structureId:e}){if(!t)return{error:lt};let{matchUps:i,matchUpsMap:n}=Ia({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:o}=w0({drawDefinition:t,matchUpsMap:n}),{structures:a}=wd({drawDefinition:t}),s=a.filter(c=>!e&&c.stage!==Xr||c.structureId===e),l={};for(let c of s){let u=c==null?void 0:c.structureId,d=jDe({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:o,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:o}}function jDe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var h,f,m,g,v,y,b,I,T;let r=i==null?void 0:i.structureId,{links:o}=g0({drawDefinition:e,structureId:r});if(i.structureType===fa||i.structures){let S=(f=(h=Yi({structure:i}))==null?void 0:h.positionAssignments)==null?void 0:f.length,w=i.structures.length,U=(S??0)/w,D=((m=o.source)==null?void 0:m.flatMap(({source:F})=>(F==null?void 0:F.finishingPositions)||[]))||[],E=it(1,U+1).filter(F=>!D.includes(F)),C=((v=(g=n.find(F=>F.containerStructureId===r&&F.finishingPositionRange))==null?void 0:g.finishingPositionRange)==null?void 0:v.winner)||[0,1],M=o==null?void 0:o.source.map(({target:F})=>F.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:R=[]}=w0({structureIds:M,drawDefinition:e}),A=[...N,...R],_=it(C[0],C[1]+1).filter(F=>!A.includes(F)),k=Qr(_,_.length/E.length),O=E.map((F,B)=>{let $=k[B],V=[Math.min(...$||[]),Math.max(...$||[])].join("-");return{finishingPosition:F,finishingPositions:$,finishingPositionRange:V}});return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:O,finishingPositionsAvailable:E,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:w,groupSize:U}}let a=((y=o==null?void 0:o.source)==null?void 0:y.filter(S=>S.linkCondition!==bd).map(S=>{var w;return(w=S.source)==null?void 0:w.roundNumber}))||[],s=((b=o==null?void 0:o.source)==null?void 0:b.filter(S=>S.linkCondition===bd).map(S=>{var w;return(w=S.source)==null?void 0:w.roundNumber}))||[],l=fie({excludeRoundNumbers:a,playoffPositions:t,drawDefinition:e,structureId:r}),c=l!=null&&l.playoffSourceRounds?[...(l==null?void 0:l.playoffSourceRounds)||[]]:void 0,u=[...(l==null?void 0:l.playoffRoundsRanges)||[]],{roundProfile:d,error:p}=l;for(let S of s){let w=o==null?void 0:o.source.find(M=>M.source.roundNumber===S),U=w==null?void 0:w.target.roundNumber,D=w==null?void 0:w.target.structureId,E=n.filter(({roundNumber:M,structureId:N})=>N===D&&M===U),C=E.filter(({sides:M})=>M.find(N=>N.participantFed&&!N.participantId)).length;if(c&&C===E.length){c.push(S);let M=(T=(I=d==null?void 0:d[S])==null?void 0:I.finishingPositionRange)==null?void 0:T.loser;if(M){let N=Math.min(...M),R=N+C,A=it(N,R),_={finishingPositionRange:[N,R-1].join("-"),finishingPositions:A,roundNumber:S};u.push(_)}}}return c&&c.sort(wr),u.sort((S,w)=>S.roundNumber-w.roundNumber),{playoffRounds:c,playoffRoundsRanges:u,error:p}}function HDe({playoffGroups:t,drawDefinition:e,structureId:i}){var r,o;if(!e)return{error:lt};if(typeof i!="string"||!Array.isArray(t))return{error:Pe};let n=t.map(({finishingPositions:a})=>a).flat();return{positionRangeMap:(o=(r=eP({drawDefinition:e,structureId:i}).playoffFinishingPositionRanges)==null?void 0:r.filter(a=>n.includes(a.finishingPosition)))==null?void 0:o.reduce((a,s)=>(a[s.finishingPosition]=s,a),{})}}function mie(t){var y,b;let{finishingPositionOffset:e=0,playoffAttributes:i,stageSequence:n=1,staggeredEntry:r,structureName:o,stage:a=ut,matchUpType:s,structureId:l,idPrefix:c,drawSize:u,isMock:d,uuids:p}=t,h={finishingPositionOffset:e,matchUpType:s,drawSize:u,idPrefix:c,isMock:d,uuids:p},{matchUps:f}=r?Jh(h):Du(h),m=Ys({structureName:o||((y=i==null?void 0:i["0"])==null?void 0:y.name)||vo(ut),structureId:l||(p==null?void 0:p.pop()),stageSequence:n,matchUpType:s,matchUps:f,stage:a}),g=[m],v=[];if(u>2){let I=u/2,{matchUps:T}=Du({finishingPositionOffset:e+I,idPrefix:c&&`${c}-c`,drawSize:I,matchUpType:s,isMock:d}),S=vo(Io),w=((b=i==null?void 0:i["0-1"])==null?void 0:b.name)??t.consolationStructureName??(o?`${o} ${S}`:S),U=Ys({structureName:w,matchUps:T,structureId:p==null?void 0:p.pop(),stage:Io,stageSequence:1,matchUpType:s});g.push(U);let D={linkType:yd,source:{roundNumber:1,structureId:m.structureId},target:{roundNumber:1,feedProfile:Nl,structureId:U.structureId}};v.push(D)}return{...ae,structures:g,links:v}}function gie({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:o}){let a=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return it(1+e,n+1+e).map(c=>{let u=l&&l[c-1]?l[c-1]:c%2?Nl:Pm,d=c-e<=2?c-e:(c-e-2)*2+2,p={linkType:yd,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=s[c-1];return h&&(p.target.groupedOrder=h),rl()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&o&&(p.linkCondition=bd,p.target.feedProfile=Nl),a.includes(d)?p:void 0}).filter(Boolean)}function vie(t){var T,S;let{playoffStructureNameBase:e,finishingPositionOffset:i,stageSequence:n=1,playoffAttributes:r,structureNameMap:o,staggeredEntry:a,stage:s=ut,matchUpType:l,structureId:c,drawSize:u,idPrefix:d,isMock:p,uuids:h}=t,f={finishingPositionOffset:i,matchUpType:l,drawSize:u,idPrefix:d,isMock:p,uuids:h},{matchUps:m,roundsCount:g}=a?Jh(f):Du(f),v=t.structureName??((T=r==null?void 0:r["0"])==null?void 0:T.name)??vo(ut),y=kh({structureId:c||(h==null?void 0:h.pop()),structureName:v,stageSequence:n,matchUpType:l,matchUps:m,stage:s}),b=[y],I=[];if(u>2){let w=[0,2].slice(0,u/16).map((U,D)=>{let E=D+1,{consolationStructure:C}=GDe({idPrefix:d&&`${d}-c${D}`,structureId:h==null?void 0:h.pop(),playoffStructureNameBase:e,playoffAttributes:r,structureNameMap:o,stageSequence:E,roundOffset:U,matchUpType:l,drawSize:u,isMock:p,index:D,uuids:h});b.push(C);let M=gie({consolationStructure:C,roundsCount:2,mainStructure:y,roundOffset:U});return{consolationStructure:C,links:M}}).map(U=>U.links).flat();if(I.push(...w),u>=4&&u<=16||u>32){let{matchUps:U}=Du({idPrefix:d&&`${d}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:l,isMock:p}),D=((S=r==null?void 0:r["3-4"])==null?void 0:S.name)??vo($n),E=(o==null?void 0:o[D])||D,C=e?`${e} ${E}`:E,M=kh({structureId:h==null?void 0:h.pop(),matchUps:U,stageSequence:2,stage:$n,structureName:C,matchUpType:l}),N={linkType:yd,source:{roundNumber:g-1,structureId:y.structureId},target:{structureId:M.structureId,feedProfile:Nl,roundNumber:1}};b.push(M),I.push(N)}}return{structures:b,links:I,...ae}}function GDe({playoffStructureNameBase:t,stageSequence:e=1,playoffAttributes:i,structureNameMap:n,roundOffset:r=0,matchUpType:o,structureId:a,idPrefix:s,drawSize:l,isMock:c,index:u,uuids:d}){var y,b;let p=l/(2*Math.pow(2,r)),{matchUps:h,roundsCount:f}=Jh({finishingPositionOffset:p,baseDrawSize:p,isConsolation:!0,feedRounds:1,matchUpType:o,idPrefix:s,isMock:c,uuids:d}),m=u===0&&((y=i==null?void 0:i["0-1"])==null?void 0:y.name)||u===1&&((b=i==null?void 0:i["0-3"])==null?void 0:b.name)||`${vo(Io)} ${u+1}`,g=(n==null?void 0:n[m])||m,v=t?`${t} ${g}`:g;return{consolationStructure:kh({matchUps:h,stage:Io,structureName:v,stageSequence:e,matchUpType:o,structureId:a}),consolationRoundsCount:f}}function Hg(t){var E,C,M,N;let{finishingPositionOffset:e,stageSequence:i=1,playoffAttributes:n,feedsFromFinal:r,staggeredEntry:o,structureName:a,stage:s=ut,structureId:l,matchUpType:c,skipRounds:u,feedRounds:d,idPrefix:p,drawSize:h,isMock:f,uuids:m,fmlc:g}=t,v=t.feedPolicy||((E=t.policyDefinitions)==null?void 0:E[BI])||((C=t.appliedPolicies)==null?void 0:C[BI]),y={finishingPositionOffset:e,matchUpType:c,skipRounds:u,drawSize:h,idPrefix:p,isMock:f,uuids:m},{matchUps:b}=o?Jh(y):Du(y),I=Ys({structureName:a||((M=n==null?void 0:n["0"])==null?void 0:M.name)||vo(ut),structureId:l||(m==null?void 0:m.pop()),stageSequence:i,matchUpType:c,matchUps:b,stage:s}),T=[I],S=[],w=h/2,{matchUps:U,roundsCount:D}=Jh({finishingPositionOffset:w,idPrefix:p&&`${p}-c`,isConsolation:!0,feedsFromFinal:r,baseDrawSize:w,matchUpType:c,feedRounds:d,skipRounds:u,isMock:f,uuids:m,fmlc:g});if(h>2){let R=((N=n==null?void 0:n["0-1"])==null?void 0:N.name)??vo(Io),A=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${R}`:R,_=Ys({matchUps:U,structureId:m==null?void 0:m.pop(),stage:Io,stageSequence:1,structureName:A,matchUpType:c});T.push(_);let k=gie({consolationStructure:_,mainStructure:I,roundsCount:D,feedPolicy:v,fmlc:g});S.push(...k)}return{...ae,structures:T,links:S}}function yie({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:o,drawDefinition:a,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var T,S,w,U,D,E;c=c||(r==null?void 0:r[BI]);let f="processPlayoffGroups",m=0,g=[],v=[],y=[],{error:b,positionRangeMap:I}=HDe({structureId:n,drawDefinition:a,playoffGroups:s});if(b)return se({result:{error:b},stack:f});if(!(!I||s!=null&&s.every(C=>{let{finishingPositions:M=[]}=C;if(!M.length)return!1;let N=[...M].sort(wr).map((R,A)=>(M[A+1]||R)-R).every(R=>R<2);return(!t||N)&&M.every(R=>I[R])})))return se({context:{validFinishingPositions:Object.values(I)},result:{error:Pe},stack:f});for(let C of s){let M=C.finishingPositions,N=I&&M.map($=>{var V;return(V=I[$])==null?void 0:V.finishingPositions}).flat(),R=u*M.length,A=i0(R),_=A===2&&du||C.drawType||du;N&&(m=Math.min(...N)-1);let k=N&&`${Math.min(...N)}-${Math.max(...N)}`,O=C.structureName||k&&((S=(T=C.playoffAttributes)==null?void 0:T[k])==null?void 0:S.name)||((U=(w=C.playoffAttributes)==null?void 0:w["0"])==null?void 0:U.name),F={addNameBaseToAttributeName:C.addNameBaseToAttributeName,playoffStructureNameBase:C.playoffStructureNameBase,finishingPositionNaming:C.finishingPositionNaming,finishingPositionLimit:C.finishingPositionLimit,structureId:C.structureId??(h==null?void 0:h.pop()),playoffAttributes:C.playoffAttributes,structureNameMap:C.structureNameMap,sequenceLimit:C.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:m,stage:$n,stageSequence:o,matchUpType:l,drawSize:A,isMock:p,uuids:h},B=({playoffStructures:$,playoffLinks:V})=>{let[H]=$,z=y1({playoffStructureId:H.structureId,finishingPositions:M,sourceStructureId:n});y.push(z),y.push(...V),v.push(...$),g.push({structureId:H.structureId,finishingPositions:M}),m+=R};if(_===du){let{matchUps:$}=Du({finishingPositionLimit:m+R,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,matchUpType:l,drawSize:A,isMock:p,uuids:h}),V=Ys({structureId:C.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:$n,structureName:O,stageSequence:o,matchUps:$});v.push(V);let H=y1({playoffStructureId:V.structureId,finishingPositions:M,sourceStructureId:n});y.push(H),m+=R,g.push({structureId:V.structureId,finishingPositions:M})}else if([jI,HI,$n].includes(_)){let $={playoffAttributes:C.playoffAttributes??i,playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(h==null?void 0:h.pop()),structureName:C.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:m,stage:$n,roundOffset:0,stageSequence:o,drawSize:A,isMock:p,uuids:h};_===jI?Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??ej,roundOffsetLimit:3}):_===HI&&Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??tj,roundOffsetLimit:2});let V=gI($);if(V.error)return V;if((D=V.links)!=null&&D.length&&y.push(...V.links),(E=V.structures)!=null&&E.length&&v.push(...V.structures),v.sort(Ey),V.structureId){let H=y1({playoffStructureId:V.structureId,finishingPositions:M,sourceStructureId:n});y.push(H),g.push({structureId:V.structureId,finishingPositions:M})}m+=R}else if([GI,DD,VT,$T,BT,jT].includes(_)){let $=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],V={playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(h==null?void 0:h.pop()),playoffAttributes:C.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:m,uuids:$,stage:$n,structureName:O,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},H={[GI]:{fmlc:!0,feedRounds:1},[jT]:{feedRounds:1},[VT]:{feedsFromFinal:3},[$T]:{feedsFromFinal:2},[BT]:{feedsFromFinal:1}};Object.assign(V,H[_]||{});let{structures:z,links:G}=Hg(V),[W]=z,K=y1({playoffStructureId:W.structureId,finishingPositions:M,sourceStructureId:n});y.push(K),y.push(...G),v.push(...z),g.push({structureId:W.structureId,finishingPositions:M}),m+=R}else if([Hl].includes(_)){let{structures:$,links:V}=YD({...F,structureOptions:C.structureOptions||{groupSize:4}});B({playoffStructures:$,playoffLinks:V})}else if([UD].includes(_)){let{structures:$,links:V}=mie(F);B({playoffStructures:$,playoffLinks:V})}else if([lTe].includes(_)){let{structures:$,links:V}=vie(F);B({playoffStructures:$,playoffLinks:V})}else if([jl].includes(_)){let $=Ys({structureId:C.structureId??(h==null?void 0:h.pop()),structureName:C.structureName,finishingPosition:PE,stage:$n,stageSequence:o,matchUps:[]});B({playoffStructures:[$],playoffLinks:[]})}}return{finishingPositionTargets:g,positionRangeMap:I,structures:v,links:y}}function y1({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:gp,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Rl,roundNumber:1}}}function tP({matchUp:t,tieFormat:e,isMock:i,uuids:n}){let{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(o=>iP({matchUp:t,collectionDefinition:o,uuids:n,isMock:i})).filter(Boolean).flat()}}function iP({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:o}){let{matchUpCount:a,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=i??a??0,d=p=>{if(!r&&!(n!=null&&n.isMock))return(o==null?void 0:o.pop())??ji();let h=e==null?void 0:e.collectionId;return(o==null?void 0:o.pop())??`${n==null?void 0:n.matchUpId}-${h}-TMU-${p+1}`};return it(0,u).map(p=>{let h=t+p+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:d(p),matchUpStatus:Gn,collectionPosition:h,collectionId:l,processCodes:c,matchUpType:s,isMock:r}})}function zDe(t){var U,D,E;let e="generateAndPopulateRRplayoffStructures";if(!t.playoffGroups)return se({result:{error:gt},info:"playoffGroups required",stack:e});let{sourceStructureId:i,requireSequential:n,tournamentRecord:r,drawDefinition:o,playoffGroups:a,groupCount:s,groupSize:l,event:c}=t,{structures:u=[],links:d=[],finishingPositionTargets:p,positionRangeMap:h,error:f}=yie({requireSequential:n,sourceStructureId:i,playoffGroups:a,groupCount:s,groupSize:l,...t});if(f)return{error:f};let m=p==null?void 0:p.map(({finishingPositions:C})=>C).flat().map(C=>h[C].finishingPositions).flat();o.structures.push(...u),o.links.push(...d);let{matchUps:g,matchUpsMap:v}=Tr({inContext:!0,drawDefinition:o}),y=u.map(({structureId:C})=>C),b=g==null?void 0:g.filter(({structureId:C})=>y.includes(C)).map(Br),I=(U=v==null?void 0:v.drawMatchUps)==null?void 0:U.filter(({matchUpId:C})=>b==null?void 0:b.includes(C));if(I!=null&&I.length){let C=(D=Vo({drawDefinition:o,event:c}))==null?void 0:D.tieFormat;C&&I.forEach(M=>{let{tieMatchUps:N}=tP({isMock:t.isMock,tieFormat:C,matchUp:M});Object.assign(M,{tieMatchUps:N,matchUpType:Su})})}let{positionAssignments:T}=Yi({structureId:i,drawDefinition:o}),S={};T==null||T.forEach(C=>{var N,R,A;let M=(A=(R=(N=Qt({element:C,name:Wh}))==null?void 0:N.extension)==null?void 0:R.value)==null?void 0:A.groupOrder;M&&(S[M]||(S[M]=[]),S[M].push(C.participantId))});let w=JD({provisionalPositioning:t.provisionalPositioning,structureId:i,applyPositioning:!0,event:t.event,tournamentRecord:r,drawDefinition:o});return w.error&&((E=w.error)==null?void 0:E.code)!==V$.code?se({result:w,stack:e}):{structures:u,links:d,positionsPlayedOff:m,drawDefinition:o,...ae}}var Ks="SET3-S:6/TB7",WDe="SET3-S:6NOAD",bie="SET3-S:6/TB7-F:TB10",qDe="SET3-S:4/TB7",YDe="SET3-S:4/TB5@3",KDe="SET1-S:T20",ZDe="SET1-S:8/TB7",XDe="SET1-S:8/TB7@7",JDe={FORMAT_STANDARD:Ks,FORMAT_STANDARD_NOAD:WDe,FORMAT_ATP_DOUBLES:bie,FORMAT_SHORT_SETS:qDe,FORMAT_FAST4:YDe,FORMAT_PRO_SET:ZDe,FORMAT_COLLEGE_PRO_SET:XDe,TIMED20:KDe};function iH({winningSide:t,matchUpFormat:e=Ks,matchUpStatus:i,tallyPolicy:n,score:r}){let o=[0,0],a=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=Pa(e),c=nH((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Pi&&(n!=null&&n.setsCreditForDefaults)||i===Oi&&(n!=null&&n.setsCreditForWalkovers)))o[s]=c;else for(let u of a||[]){let{winningSide:d}=u;d&&(o[d-1]+=1)}return typeof s=="number"&&i===Go&&(+o[1-s]===c&&(o[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(o[s]=c)),o}function Iie({matchUpFormat:t=Ks,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var p,h;let{sets:o}=r||{};if(!o)return[0,0];let a=typeof e=="number"&&e-1,s=Pa(t),l=(s==null?void 0:s.bestOf)??1,c=nH(l),u=((p=s==null?void 0:s.setFormat)==null?void 0:p.tiebreakAt)||0,d=[[],[]];if(typeof a=="number"&&(i===Pi&&(n!=null&&n.gamesCreditForDefaults)||i===Oi&&(n!=null&&n.gamesCreditForWalkovers))){let f=((h=s==null?void 0:s.setFormat)==null?void 0:h.setTo)||0,m=c*f;d[a].push(m)}else o.forEach((f,m)=>{var T;let g=(f.setNumber||m+1)>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",v=(T=s==null?void 0:s[g])==null?void 0:T.based,y=s==null?void 0:s[g].tiebreakSet,{side1Score:b,side2Score:I}=f;b6(v)&&(d[0].push(Et(b||0)),d[1].push(Et(I||0))),y&&f.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&d[f.winningSide-1].push(1)});if(i===Go&&typeof a=="number"){let f=o.length>c&&(s!=null&&s.finalSetFormat)?"finalSetFormat":"setFormat",m=s==null?void 0:s[f];if(b6(m.based)){let g=(m==null?void 0:m.setTo)||0,v=b=>{if(!(!s||b===""))return+b===u-1||+b===u?Et(u||0)+1:+b<u?g:u},y=iH({winningSide:e,score:{sets:o},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(d.map(b=>b[a]<=b[1-a]).reduce((b,I)=>b+(I?1:0),0)>y[1-a]){let b=d[a].length,I=v(d[1-a][b-1]);I&&(d[a][b-1]=I)}c>d[a].length&&(n!=null&&n.gamesCreditForRetirements)&&d[a].push(g)}}return[d[0].reduce((f,m)=>f+m,0),d[1].reduce((f,m)=>f+m,0)]}function wie({matchUpFormat:t,score:e}){var s;let i=t?Pa(t):void 0,n=(i==null?void 0:i.bestOf)??1,r=nH(n),o=[0,0],a=[0,0];return(s=e==null?void 0:e.sets)==null||s.forEach((l,c)=>{var p;let u=(l.setNumber||c+1)>r&&(i!=null&&i.finalSetFormat)?"finalSetFormat":"setFormat",d=(p=i==null?void 0:i[u])==null?void 0:p.based;if(Sie(d)){let{side1Score:h,side2Score:f}=l;h&&(a[0]+=Et(h||0)),f&&(a[1]+=Et(f||0))}else l.side1TiebreakScore&&(a[0]+=Et(l.side1TiebreakScore||0)),l.side2TiebreakScore&&(a[1]+=Et(l.side2TiebreakScore||0)),(l.side1TiebreakScore||l.side2TiebreakScore)&&l.winningSide&&(o[l.winningSide-1]+=1)}),{pointsTally:a,tiebreaksTally:o}}function nH(t){return t&&Math.ceil(t/2)||1}function Sie(t){return t==="P"}function b6(t){return!Sie(t)}function QDe({participantResults:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:r}){var c;let o=e&&Pa(e)||{},a=o.bestOf,s=a&&Math.ceil(a/2)||1,l=(c=o.setFormat)==null?void 0:c.setTo;Object.keys(t).forEach(u=>{let d=t[u].setsWon,p=t[u].setsLost,h=i!=null&&i.groupTotalSetsPlayed?r:n*(s||0)||d+p,f=Math.round(d/h*1e3)/1e3;(f===1/0||isNaN(f))&&(f=h);let m=t[u].tieMatchUpsWon,g=t[u].tieMatchUpsLost,v=m+g,y=Math.round(m/v*1e3)/1e3;(y===1/0||isNaN(y))&&(y=m);let b=t[u].matchUpsWon,I=t[u].matchUpsLost,T=b+I,S=Math.round(b/T*1e3)/1e3;(S===1/0||isNaN(S))&&(S=b);let w=t[u].gamesWon||0,U=t[u].gamesLost||0,D=(n||0)*(s||0)*(l||0),E=Math.max(D,w+U),C=Math.round(w/E*1e3)/1e3;(C===1/0||isNaN(C))&&(C=0);let M=Math.round(t[u].pointsWon/t[u].pointsLost*1e3)/1e3;(M===1/0||isNaN(M))&&(M=0),t[u].setsWon=d,t[u].setsLost=p,t[u].setsPct=f,t[u].tieMatchUpsWon=m,t[u].tieMatchUpsPct=y,t[u].matchUpsPct=S,t[u].gamesWon=w,t[u].gamesLost=U,t[u].gamesPct=C,t[u].pointsPct=M,t[u].result=`${t[u].matchUpsWon}/${t[u].matchUpsLost}`})}function nP({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){var c,u,d,p,h,f,m;let o={},a=(i==null?void 0:i.excludeMatchUpStatuses)||[],s=r==null?void 0:r.filter(g=>(g.tieMatchUps||!a.includes(g.matchUpStatus))&&(!(t!=null&&t.length)||Hn(t,[lI(g,0),lI(g,1)]).length===2)),l=(c=s==null?void 0:s.flatMap(({score:g,tieMatchUps:v})=>{var y;return v?v.filter(({matchUpStatus:b})=>!a.includes(b)).flatMap(({score:b})=>{var I;return((I=b==null?void 0:b.sets)==null?void 0:I.length)??0}):((y=g==null?void 0:g.sets)==null?void 0:y.length)??0}))==null?void 0:c.reduce((g,v)=>g+v,0);for(let g of s??[]){let{matchUpStatus:v,tieMatchUps:y,tieFormat:b,score:I,winningSide:T,sides:S}=g,w=b&&g._disableAutoCalc&&b.collectionDefinitions.every(({scoreValue:E})=>E),U=T&&ePe(g),D=T&&tPe(g);if(!U&&!D)if(v&&Nr.includes(v)){let E=lI(g,0),C=lI(g,1);E&&(yh(o,E),o[E].matchUpsCancelled+=1),C&&(yh(o,C),o[C].matchUpsCancelled+=1)}else if(y!=null&&y.length){n=0;for(let E of y){if(E.winningSide){let C=(u=S==null?void 0:S.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:u.participantId,M=(d=S==null?void 0:S.find(({sideNumber:N})=>N===E.winningSide))==null?void 0:d.participantId;C&&M&&(yh(o,C),yh(o,M),o[C].tieMatchUpsWon+=1,o[M].tieMatchUpsLost+=1,jn(kn)(E.matchUpType)?(o[C].tieSinglesWon+=1,o[M].tieSinglesLost+=1):jn(an)(E.matchUpType)&&(o[C].tieDoublesWon+=1,o[M].tieDoublesLost+=1))}I6({score:E.score,manualGamesOverride:w,participantResults:o,sides:S})}}else I6({manualGamesOverride:w,participantResults:o,score:I,sides:S});else if(yh(o,U),yh(o,D),y==null?void 0:y.length){n=0;for(let E of y){let{matchUpType:C}=E,M=jn(an)(C),N=jn(kn)(C);E.winningSide&&(E.winningSide===T?(U&&(o[U].tieMatchUpsWon+=1,N&&(o[U].tieSinglesWon+=1),M&&(o[U].tieDoublesWon+=1)),D&&(o[D].tieMatchUpsLost+=1,N&&(o[D].tieSinglesLost+=1),M&&(o[D].tieDoublesLost+=1))):E.winningSide!==T&&(D&&(o[D].tieMatchUpsWon+=1,N&&(o[D].tieSinglesWon+=1),M&&(o[D].tieDoublesWon+=1)),U&&(o[U].tieMatchUpsLost+=1,N&&(o[U].tieSinglesLost+=1),M&&(o[U].tieDoublesLost+=1)))),w6({matchUpFormat:E.matchUpFormat,matchUpStatus:E.matchUpStatus,score:E.score,winningParticipantId:U,losingParticipantId:D,participantResults:o,isTieMatchUp:!0,manualGamesOverride:w,tallyPolicy:i,winningSide:T})}Tie({winningParticipantId:U,losingParticipantId:D,participantResults:o,matchUpStatus:v})}else w6({matchUpFormat:g.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:U,manualGamesOverride:w,losingParticipantId:D,participantResults:o,matchUpStatus:v,tallyPolicy:i,winningSide:T,score:I});if(w){let E=(p=S==null?void 0:S.find(({sideNumber:R})=>R===1))==null?void 0:p.participantId,C=(h=S==null?void 0:S.find(({sideNumber:R})=>R===2))==null?void 0:h.participantId;yh(o,E),yh(o,C);let M=(f=I==null?void 0:I.sets)==null?void 0:f.reduce((R,A)=>R+((A==null?void 0:A.side1Score)??0),0),N=(m=I==null?void 0:I.sets)==null?void 0:m.reduce((R,A)=>R+(A.side2Score??0),0);E&&(o[E].gamesWon+=M,o[E].gamesLost+=N),C&&(o[C].gamesWon+=N,o[C].gamesLost+=M)}}return QDe({participantResults:o,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:l}),{participantResults:o}}function ePe(t){let e=t.winningSide-1;return lI(t,e)}function tPe(t){let e=1-(t.winningSide-1);return lI(t,e)}function lI(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";let i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function yh(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function I6({manualGamesOverride:t,participantResults:e,score:i,sides:n}){let{sets:r}=i||{},o=[[],[]],a=[0,0];for(let l of r||[]){let{winningSide:c,side1Score:u,side2Score:d}=l;c&&(a[c-1]+=1),o[0].push(Et(u||0)),o[1].push(Et(d||0))}let s=[o[0].reduce((l,c)=>l+c,0),o[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{let{participantId:u}=l;u&&(yh(e,u),e[u].setsWon+=a[c],e[u].setsLost+=a[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function w6({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:o,isTieMatchUp:a,tallyPolicy:s,winningSide:l,score:c}){let u=l&&l-1,d=1-u;a||Tie({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:o});let p=iH({matchUpStatus:o,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),h=Iie({matchUpStatus:o,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),{pointsTally:f}=wie({score:c,matchUpFormat:r});t&&(i[t].setsWon+=p[u],i[t].setsLost+=p[d],n||(i[t].gamesWon+=h[u],i[t].gamesLost+=h[d]),i[t].pointsWon+=f[u],i[t].pointsLost+=f[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[u],n||(i[e].gamesWon+=h[d],i[e].gamesLost+=h[u]),i[e].pointsWon+=f[d],i[e].pointsLost+=f[u])}function Tie({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===Oi&&(i[e].walkovers+=1),n===Pi&&(i[e].defaults+=1),n===Go&&(i[e].retirements+=1),[Pi,Go,Oi].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function iPe({matchUps:t,order:e,report:i}){let n={};t.forEach(({sides:o})=>{o.forEach(a=>{a.participantId&&a.participant&&(n[a.participantId]=a.participant.participantName)})});let r=[];return Array.isArray(i)&&i.forEach((o,a)=>{var s,l;if((s=o.excludedDirectives)!=null&&s.length){let c=o.excludedDirectives.map(({attribute:p})=>p).join(", "),u=`${c.length} directives were excluded due to participants limit}`;r.push(u);let d=`Excluded: ${c}`;r.push(d)}else{let c=(m,g)=>parseFloat(o.reversed?m:g)-parseFloat(o.reversed?g:m),u=o.groups?Object.values(o.groups).flat(1/0).length:((l=o.participantIds)==null?void 0:l.length)??0,d=m=>{m.groups&&Object.keys(m.groups).sort(c).forEach(g=>{let v=m.groups[g].map(b=>n[b]).join(", "),y=`${g} ${m.attribute}: ${v}`;r.push(y)})},p=o.reversed?" in reverse order":"",h=o.groups?"grouped":"separated",f=`Step ${a+1}: ${u} particiants were ${h}${p} by ${o.attribute}`;if(r.push(f),o.idsFilter){let m=`${o.attribute} was calculated considering ONLY TIED PARTICIPANTS`;r.push(m)}d(o)}r.push("----------------------")}),r.push("Final Order:"),e.forEach(o=>{let{participantId:a,resolved:s}=o,l=o.groupOrder||o.provisionalOrder;r.push(`${l}: ${n[a]} => resolved: ${!!s}`)}),r.join(`\r
`)}function Uie({participantResults:t,participantIds:e,attribute:i}){return Die({participantResults:t,participantIds:e}).reduce((n,r)=>{let{participantId:o,results:a}=r,s=a==null?void 0:a[i];return!isNaN(s)&&o&&(n[s]?n[s].push(o):n[s]=[o]),n},{})}function Die(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}var nPe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],RO={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function S6(t){let{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,o=[];if(e&&!rPe(t))return{};let a=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=Uie({participantResults:i,attribute:a});o.push({attribute:a,groups:s});let l=Object.keys(s).map(f=>parseFloat(f)).sort((f,m)=>m-f).map(f=>s[f]).map(f=>{let m=Pie({participantIds:f,...t});return o.push(...m.report??[]),m.order}).flat(1/0),c=1,u;l.forEach((f,m)=>{m&&(f.resolved||u&&!f.resolved)&&(c+=1),u=f.resolved,f.resolved?(f.position=m+1,c=f.position):f.position=c});let d=l.map(({position:f})=>f),p=os(d);return l.forEach(f=>{let{participantId:m,position:g}=f||{},v=i[m];f.GEMscore=h(v);let y=p[g];(f==null?void 0:f.position)!==void 0&&(y>1&&(f.ties=y,n&&(f.subOrder=n[m])),f.rankOrder=g,f.groupOrder=g+(f.subOrder||1)-1)}),{groupOrder:l,report:o.flat(1/0).filter(Boolean)};function h(f){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(RO).filter(m=>r.GEMscore.includes(m)):Object.keys(RO)).map(m=>(f[m]||0)*Math.pow(10,RO[m].toFixed(3))).reduce((m,g)=>m+g,0)}}function rPe({participantResults:t,participantsCount:e}){let i=Die({participantResults:t}).filter(n=>e-1===n.results.matchUpsWon+n.results.matchUpsLost+n.results.matchUpsCancelled);return e===i.length}function oPe({disableHeadToHead:t,participantIds:e,matchUpFormat:i,tallyPolicy:n,attribute:r,idsFilter:o,matchUps:a,reversed:s}){let{participantResults:l}=nP({participantIds:o&&e,matchUpFormat:i,tallyPolicy:n,matchUps:a}),c=Uie({participantResults:l,participantIds:e,attribute:r}),u=[{attribute:r,reversed:s,groups:c,idsFilter:o}],d;return Object.keys(c).length>1&&e.length&&(d=Object.keys(c).map(p=>parseFloat(p)).sort((p,h)=>s?p-h:h-p).map(p=>c[p]).map(p=>{let h=Pie({participantResults:l,disableHeadToHead:t,participantIds:p,matchUpFormat:i,tallyPolicy:n,matchUps:a});return u.push(...h.report??[]),h.order}).flat(1/0)),{order:d,report:u}}function Pie({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:o}){let a=[],s=[],l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){let u=aPe({participantIds:i,participantResults:t});if(u){let d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[u],headToHeadWinner:d,report:s}}}let c=((r==null?void 0:r.tallyDirectives)||nPe).filter(u=>{let d=!(Bn(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||a.push(u),d});return a.length&&s.push({excludedDirectives:a,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=oPe({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:o,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function aPe({participantIds:t,participantResults:e}){if(t){if(e[t[0]].victories.includes(t[1]))return t.map(i=>({resolved:!0,participantId:i}));if(e[t[1]].victories.includes(t[0]))return t.reverse().map(i=>({resolved:!0,participantId:i}))}}function S0({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:o}){if(!(n!=null&&n.length)||!hl(n))return{error:kd};let a=Zt(n.map(({structureId:b})=>b));if(a.length!==1)return se({result:{error:Pe,info:"Maximum one structureId"},stack:"tallyParticipantResults",context:{structureIds:a}});let s=n.filter(b=>b&&b.matchUpStatus!==Ni),l=s.length&&Zt(s.map(({drawPositions:b})=>b).flat()).length,c=s.filter(b=>mm({matchUp:b})).length===s.length;c||(o=0);let u=n.every(({matchUpType:b,tieMatchUps:I})=>b===sn&&(I==null?void 0:I.every(T=>mm({matchUp:T})))),d=t==null?void 0:t[kV],p=n.filter(b=>mm({matchUp:b})||b.matchUpType===sn),{participantResults:h}=nP({matchUps:p,matchUpFormat:i,tallyPolicy:d,perPlayer:o}),f,m,{groupOrder:g,report:v}=S6({matchUps:p,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r});if(c&&g)f=v,m=g,g.forEach(b=>{let{participantId:I,groupOrder:T,rankOrder:S,subOrder:w,ties:U,GEMscore:D}=b,E=h[I];Object.assign(E,{groupOrder:T,rankOrder:S,GEMscore:D,subOrder:w,ties:U})});else{let{groupOrder:b,report:I}=S6({requireCompletion:!1,participantResults:h,participantsCount:l,matchUpFormat:i,tallyPolicy:d,subOrderMap:r,matchUps:n});f=I,m=b,b&&b.forEach(T=>{let{participantId:S,groupOrder:w,GEMscore:U}=T,D=h[S];Object.assign(D,{provisionalOrder:w,GEMscore:U})})}let y={completedTieMatchUps:u,readableReport:"",participantResults:h,bracketComplete:c,order:[],report:f};if((c||u)&&(y.order=m),e||rl({tally:!0})){let b=iPe({matchUps:n,report:f,order:m});rl({tally:!0})&&console.log(b),y.readableReport=b}return y}function Cie({positionAssignments:t}){let e=(t||[]).filter(as(hd)).map(r=>{let{extension:o}=Qt({element:r,name:VI}),a=Et(o==null?void 0:o.value),s=!isNaN(a)&&a;return s&&{participantId:r.participantId,subOrder:s}}).filter(Boolean),i=e.map(({subOrder:r})=>r),n=os(i);return{subOrderMap:Object.assign({},...e.filter(({subOrder:r})=>n[r]===1).map(({participantId:r,subOrder:o})=>({[r]:o})))}}function rH({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:o}){if(!hl(r))return{error:Pe};if(!t)return{error:Pe};let{policyDefinitions:a}=$p({policyTypes:[kV],tournamentRecord:e,drawDefinition:i,event:o}),{subOrderMap:s}=Cie({positionAssignments:t}),l=r.length?S0({policyDefinitions:a,matchUpFormat:n,subOrderMap:s,matchUps:r}):void 0;if(l!=null&&l.error)return l;let{participantResults:c={},bracketComplete:u,report:d}=l??{},p=Object.keys(c);return t.forEach(h=>{let{participantId:f}=h;if(p.includes(f)){let m={value:c[f],name:Wh};Ui({element:h,extension:m}),c[f].ties||ta({element:h,name:VI})}else ta({element:h,name:Wh}),ta({element:h,name:VI})}),cn({drawDefinition:i}),{...ae,participantResults:c,bracketComplete:u,report:d}}function Eie({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function fn({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:o,matchUpId:a,inContext:s,context:l,event:c}){if(!r)return{error:lt};if(!a)return{error:To};if(typeof a!="string")return{error:Pe};let{structures:u=[]}=wd({drawDefinition:r});n&&!i&&(i=jp({contextProfile:n,drawDefinition:r}));for(let d of u){let{matchUps:p}=_i({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:o,inContext:s,structure:d,context:l,event:c}),{matchUp:h}=Eie({matchUps:p,matchUpId:a});if(h)return{matchUp:h,structure:d}}return{error:Ao}}function OA(t){var e;return typeof t!="object"?{error:gt}:typeof t.element!="object"?{error:Pe}:t.notes?typeof t.notes!="string"&&!((e=t.notes)!=null&&e.testing)?{error:Pe}:(Object.assign(t.element,{notes:t.notes}),{...ae}):{error:gt}}function Mie(t){return typeof t!="object"?{error:gt}:typeof t.element!="object"?{error:Pe}:(t.element.notes&&delete t.element.notes,{...ae})}var LA={matchUpStatus:Gn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function pu(t){var U,D,E,C,M,N,R,A;let e="modifyMatchUpScore",i=t.matchUpFormat,n=t.matchUp,r,{matchUpStatusCodes:o,removeWinningSide:a,tournamentRecord:s,drawDefinition:l,matchUpStatus:c,removeScore:u,winningSide:d,matchUpId:p,event:h,notes:f,score:m}=t,g=t.appliedPolicies&&Object.keys(t.appliedPolicies).length?t.appliedPolicies:(U=Bi({policyTypes:[vd],tournamentRecord:s,drawDefinition:l,structure:r,event:h}))==null?void 0:U.appliedPolicies,v=n.matchUpType===sn;if(v&&l){if(p&&n.matchUpId!==p){let _=fn({drawDefinition:l,matchUpId:p,event:h});if(!_.matchUp)return{error:Ao};({matchUp:n,structure:r}=_)}}else n.matchUpId!==p&&console.log("!!!!!");c&&[Oi,mr].includes(c)||u?Object.assign(n,{...LA}):m&&(n.score=m);let y=c&&(n==null?void 0:n.matchUpStatus)===Pi&&c!==Pi;c&&(n.matchUpStatus=c),i&&(n.matchUpFormat=i),o&&(n.matchUpStatusCodes=o),d&&(n.winningSide=d),a&&(n.winningSide=void 0),!r&&l&&({structure:r}=fn({drawDefinition:l,matchUpId:p,event:h})),c&&!n.winningSide&&io(n)&&!Nr.includes(c)&&![Py,Df].includes(c)&&(n.matchUpStatus=Jl);let b;if((y&&((D=n==null?void 0:n.processCodes)!=null&&D.length)||c===Pi)&&(b=(C=(E=g==null?void 0:g[vd])==null?void 0:E.processCodes)==null?void 0:C.incompleteAssignmentsOnDefault),!n.collectionId){let _=(r==null?void 0:r.structureType)===fa,k=ss({structure:r});if(Cj({drawDefinition:l,structure:r})||k||_){let O=$=>{i=v?"SET1-S:T100":i??n.matchUpFormat??($==null?void 0:$.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(h==null?void 0:h.matchUpFormat);let V=v?{matchUpTypes:[sn]}:void 0,{matchUps:H}=_i({afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,matchUpFilters:V,drawDefinition:l,structure:$,event:h});return k&&($.positionAssignments=Zt(H.flatMap(z=>(z.sides??[]).map(G=>G.participantId)).filter(Boolean)).map(z=>({participantId:z}))),rH({positionAssignments:$.positionAssignments,tournamentRecord:s,drawDefinition:l,matchUpFormat:i,matchUps:H,event:h})},F=_&&r.structures.find($=>$==null?void 0:$.matchUps.find(V=>V.matchUpId===p)),B=O(F||r);if(B.error)return se({result:B,stack:e})}}if(f){let _=OA({element:n,notes:f});if(_.error)return se({result:_,stack:e})}let I=s==null?void 0:s.tournamentId,T=pl().topics.includes(yA),S=(T||b)&&Uo({drawDefinition:l}),w=S&&((M=Tr({matchUpFilters:{matchUpIds:[p]},nextMatchUps:!0,tournamentRecord:s,inContext:!0,drawDefinition:l,matchUpsMap:S}).matchUps)==null?void 0:M[0]);if(T&&w&&dTe({tournamentId:I,inContextMatchUp:w}),Array.isArray(b)&&w&&!((N=w.sides)!=null&&N.every(({participantId:_})=>_)))if(c===Pi)n.processCodes=Zt([...n.processCodes??[],...b]);else for(let _ of b||[]){let k=_&&((R=n==null?void 0:n.processCodes)==null?void 0:R.lastIndexOf(_));(A=n==null?void 0:n.processCodes)==null||A.splice(k,1)}return yi({eventId:h==null?void 0:h.eventId,context:e,drawDefinition:l,tournamentId:I,matchUp:n}),{...ae}}function oH(t){let{dualWinningSideChange:e,matchUpStatusCodes:i,matchUpStatus:n,structure:r,matchUp:o}=t,a=HD({matchUpStatus:n})||[Fp,Us].includes(n)&&e,s="attemptToModifyScore",l=!!o.collectionId,c=ss({structure:r});if(!(l||c||sPe({structure:r,matchUp:o})))return{error:Y$};let u=[Oi].includes(n),d=pu({...t,matchUpStatusCodes:a&&i||[],matchUpStatus:a&&n||or,context:s,removeScore:u});return se({result:d,stack:s})}function sPe({structure:t,matchUp:e}){var r;let{drawPositions:i}=e,{positionAssignments:n}=jr({structure:t});return((r=n==null?void 0:n.filter(o=>(i==null?void 0:i.includes(o.drawPosition))&&o.participantId))==null?void 0:r.length)===2}function Rie({collectionGroups:t=[]}){let e=Object.assign({},...t.filter(n=>Bt(n==null?void 0:n.groupValue)&&(n==null?void 0:n.groupNumber)).map(n=>({[n.groupNumber]:{...n,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}}))),i=Object.keys(e).map(n=>Et(n));return{groupValueGroups:e,groupValueNumbers:i}}function lPe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){let o=r.filter(y=>y.collectionId===t.collectionId),a=[0,0],s=[0,0],l=o.every(y=>Nr.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(o.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),Bt(p)?o.forEach(y=>{y.winningSide&&(a[y.winningSide-1]+=p)}):Bt(m)?o.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(a[T.winningSide-1]+=m)})}):Bt(f)?o.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{let{side1TiebreakScore:S=0,side2TiebreakScore:w=0,side1Score:U=0,side2Score:D=0}=T;(y.matchUpStatus===or||y.winningSide||T.winningSide)&&(U||D?(a[0]+=U,a[1]+=D):(S||w)&&T.winningSide&&(a[T.winningSide-1]+=1))})}):Array.isArray(c)&&o.forEach(y=>{if(y.winningSide){let b=y.collectionPosition,I=cPe({collectionDefinition:t,collectionPosition:b});Bt(I)&&(a[y.winningSide-1]+=I)}}),Bt(d)){let y;if(h!=null&&h.aggregateValue)l&&(Bt(p||m||f)&&a[0]!==a[1]?y=a[0]>a[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=a.reduce((b,I,T)=>I>=h.valueGoal?T+1:b,0);else{let b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,S)=>T>=b?S+1:I,0)}y&&(g?i[u].values[y-1]+=d:s[y-1]+=d)}else g?(i[u].values[0]+=a[0]||0,i[u].values[1]+=a[1]||0):s=a;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=o.length):s.forEach((y,b)=>n[b]+=y||0)}function cPe({collectionDefinition:t,collectionPosition:e}){var i,n;return(n=(i=t.collectionValueProfiles||[])==null?void 0:i.find(r=>r.collectionPosition===e))==null?void 0:n.matchUpValue}function Nie({collectionValueProfiles:t,matchUpCount:e}){let i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(let r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};let{matchUpValue:o,collectionPosition:a}=r;if(typeof o!="number"||typeof a!="number"||a>e||a<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}let n=t.map(r=>r.collectionPosition);return n.length!==Zt(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...ae}}var uPe="MIXED events can not contain mixed singles or { gender: ANY } collections",dPe="events with { gender: ANY } can not contain MIXED singles collections";function FA(t){let e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[nn,Un].includes(i)&&i!==r?se({result:{valid:!1,error:SE},context:{gender:r},stack:e}):i===ts&&(r===Tu||r===ts&&n!==an)?se({result:{error:SE,valid:!1},info:uPe,stack:e}):i===Tu&&r===ts&&n!==an?se({result:{error:SE,valid:!1},info:dPe,stack:e}):{valid:!0}}function BA(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&(t!=null&&t.setFormat))return pPe(t,e)}function YT(t){return!isNaN(Number(t))&&Number(t)}function Aie(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function pPe(t,e){var u;let i=YT(t.bestOf)||void 0,n=YT(t.exactly)||void 0,r=i||n;if((u=t.setFormat)!=null&&u.timed&&t.simplified&&r===1)return Aie(t.setFormat);let o=r&&`${ME}${r}`||"",a=T6(t.setFormat,e),s=a&&`S:${a}`||"",l=T6(t.finalSetFormat,e),c=r&&r>1&&l&&a!==l&&`F:${l}`||"";if(o&&a)return[o,s,c].filter(d=>d).join("-")}function T6(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Aie(t);if(t.tiebreakSet)return U6(t.tiebreakSet);let i=YT(t.setTo);if(i){let n=t.NoAD&&Mj||"",r=U6(t.tiebreakFormat),o=r&&`/${r}`||"",a=YT(t.tiebreakAt),s=a&&(a!==i||e)&&`@${a}`||"";if(r!==!1)return`${i}${n}${o}${s}`}}}function U6(t){if(t){if(typeof t=="object"&&!t.tiebreakTo)return"";if(typeof t=="object"&&YT(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?Mj:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}else return!1}}function ls({matchUpFormat:t}){if(typeof t!="string")return!1;let e=Pa(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],o=i==null?void 0:i[3],a=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=a==null?void 0:a[1],l=a==null?void 0:a[2],c=a==null?void 0:a[3];return BA(e,!!(i&&r&&n===o||a&&l&&s===c))===t}var hPe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),fPe=t=>t.filter(Boolean).every(Bn);function rP(t){let e=t.category;if(typeof e!="object")return{error:vM};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:o,ageMin:a}=e,s=e.categoryName,l;if(!hPe([i,n,r,s],"string")||!fPe([o,a]))return{error:vM};let c=t.consideredDate??Wt(new Date().toLocaleDateString("sv"));if(!ws(c))return{error:aa};let[u]=c.split("-").slice(0,3).map(F=>parseInt(F)),d=kS(c,-1),[p,h]=d.split("-").slice(1,3).map(F=>parseInt(F)),f=`${qs(p)}-${qs(h)}`,m=kS(c,1),[g,v]=m.split("-").slice(1,3).map(F=>parseInt(F)),y=`${qs(g)}-${qs(v)}`,b=a&&kS(c,-1*365*a),I=o&&kS(c,-1*365*o),T=[],S=F=>!T.includes(F)&&T.push(F);i=i??s;let w=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),E=D&&(i==null?void 0:i.match(U)),C=i==null?void 0:i.match(w),M=(F,B)=>`${F}-${B}`,N=F=>{let B=u-F,$=M(B,y);e.ageMinDate&&e.ageMinDate!==$&&S(`Invalid submitted ageMinDate: ${r}`),r=$,i&&(e.ageMax&&e.ageMax!==F-1&&(S(`Invalid submitted ageMax: ${o}`),I=void 0),o=F-1)},R=F=>{let B=u-F-1,$=M(B,y);e.ageMin&&e.ageMin>F&&S(`Invalid submitted ageMin: ${a}`),e.ageMax&&e.ageMax>F&&S(`Invalid submitted ageMax: ${o}`),e.ageMinDate&&e.ageMinDate!==$&&S(`Invalid submitted ageMinDate: ${r}`),r=$,i&&(e.ageMax&&e.ageMax!==F&&(S(`Invalid submitted ageMax: ${o}`),b=void 0),o=F)},A=F=>{let B=u-F,$=M(B,f);e.ageMaxDate&&e.ageMaxDate!==$&&S(`Invalid submitted ageMaxDate: ${n}`),n=$,i&&(e.ageMin&&e.ageMin!==F+1&&(S(`Invalid submitted ageMin: ${a}`),b=void 0),a=F+1)},_=F=>{let B=u-F-1,$=M(B,f);e.ageMaxDate&&e.ageMaxDate!==$&&S(`Invalid submitted ageMaxDate: ${n}`),n=$,i&&(e.ageMin&&e.ageMin!==F&&(S(`Invalid submitted ageMin: ${a}`),b=void 0),a=F)},k=F=>{let[B,$,V]=(F.match(w)||[]).slice(1),H=parseInt($);B==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N(H)):B==="O"&&A(H),V==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),R(H)):V==="O"&&_(H),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,o=void 0,a=void 0,e.ageMin){let $=u-e.ageMin;n=M($,f)}if(e.ageMax){let $=u-e.ageMax-1;r=M($,y)}let[F,B]=((i==null?void 0:i.match(U))??[]).slice(1).map($=>parseInt($));F<=B?(a=F,o=B,l=!0):S(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(k):C?k(i):(a&&A(a),o&&R(o));o&&e.ageMin&&e.ageMin>o&&(S(`Invalid submitted ageMin: ${e.ageMin}`),a=void 0);let O=wt({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:o,ageMin:a});return T.length&&(O.errors=T),O}function FM({category:t}){if(!ln(t))return{error:Pe};let e=rP({category:t});if(e.error)return{error:e};let{ratingMax:i,ratingMin:n}=t;return i&&!Bn(i)?se({result:{error:Pe},context:{ratingMax:i}}):n&&!Bn(n)?se({result:{error:Pe},context:{ratingMin:n}}):{...e}}function $A({childCategory:t,withDetails:e,category:i}){let n=FM({category:i}),r=FM({category:t}),o=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),a=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=wt({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:a,invalidAgeMin:o,valid:!c&&!s&&!l&&!u&&!a&&!o},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function oP({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:o,event:a}){o=o??(a==null?void 0:a.gender);let s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),se({result:{errors:l,error:Lp},stack:s});let{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&!EA([kn,an],g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map(Bt)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){let T=Nie({collectionValueProfiles:c,matchUpCount:h});T.errors&&l.push(...T.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!ls({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){let T=FA({referenceGender:o,matchUpType:g,gender:I});if(T.error)return se({context:{referenceGender:o,gender:I},result:T,stack:s})}if(t&&r&&b){let T=$A({category:r,childCategory:b});if(!T.valid)return se({result:{error:vM},context:T,stack:s})}return l.length?se({result:{errors:l,error:TQ},stack:s}):{valid:!0}}function $a(t){var m,g,v,y;let e=!!((t==null?void 0:t.enforceCategory)!==!1&&(t!=null&&t.category)),i=!!((t==null?void 0:t.enforceGender)!==!1&&(t!=null&&t.gender)),n=t==null?void 0:t.checkCollectionIds,r=t==null?void 0:t.tieFormat,o=t==null?void 0:t.event,a="validateTieFormat",s=[];if(!t||!r||typeof r!="object")return s.push("tieFormat must be an object"),se({result:{error:Yd},context:{tieFormat:r,errors:s},stack:a});if(typeof r.winCriteria!="object")return s.push("tieFormat.winCriteria must be an object"),se({result:{error:Yd},context:{tieFormat:r,errors:s},stack:a});if(!Array.isArray(r.collectionDefinitions))return s.push(Td("tieFormat.collectionDefinitions")),se({result:{error:Yd},context:{tieFormat:r,errors:s},stack:a});let l,c=r.collectionDefinitions.every(b=>{let{setValue:I,scoreValue:T,collectionValue:S}=b;(I||T)&&!S&&(l=!0);let{valid:w,errors:U}=oP({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:b,checkCollectionIds:n,checkCategory:e,checkGender:i,event:o});return w?!0:(Array.isArray(U)&&s.push(...U),!1)}),u=typeof((m=r.winCriteria)==null?void 0:m.valueGoal)=="number"&&((g=r.winCriteria)==null?void 0:g.valueGoal)>0&&!l||((v=r.winCriteria)==null?void 0:v.aggregateValue);if(!(u||(y=r.winCriteria)!=null&&y.aggregateValue))return l?s.push("aggregateValue is required"):s.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),se({context:{tieFormat:r,errors:s,aggregateValueImperative:l},result:{error:Yd},stack:a});let d=r.collectionDefinitions.map(({collectionId:b})=>b),p=!n||d.length===Zt(d).length,h=c&&u&&p;return h?{valid:h,errors:s}:se({result:{error:Yd},context:{tieFormat:r,errors:s},stack:a})}function aP(t){var I,T,S,w,U;let{sideAdjustments:e=[0,0],separator:i="-",drawDefinition:n,matchUpsMap:r,structure:o,matchUp:a,event:s}=t;if(!Array.isArray(e)||e.length!==2||isNaN(e.reduce((D,E)=>D+E)))return{error:Pe};if(!a)return{error:Ba};let l=((I=Vo({matchUp:a,drawDefinition:n,structure:o,event:s}))==null?void 0:I.tieFormat)||(t==null?void 0:t.tieFormat);if(!l)return{error:pD};let c=$a({tieFormat:l});if(c.error)return c;let u=(l==null?void 0:l.collectionDefinitions)||[],d=(a==null?void 0:a.tieMatchUps)??[],p=[0,0],{groupValueGroups:h,groupValueNumbers:f}=Rie(l);for(let D of u)lPe({collectionDefinition:D,groupValueNumbers:f,groupValueGroups:h,sideTieValues:p,tieMatchUps:d});for(let D of f){let E=h[D],{allGroupMatchUpsCompleted:C,matchUpCount:M,winCriteria:N,groupValue:R,sideWins:A,values:_}=E,k;if(N!=null&&N.aggregateValue)C&&_[0]!==_[1]&&(k=_[0]>_[1]?1:2);else if(N!=null&&N.valueGoal)k=_.reduce((O,F,B)=>F>=N.valueGoal?B+1:O,void 0);else{let O=Math.floor(M/2)+1;k=A.reduce((F,B,$)=>B>=O?$+1:F,void 0)}k&&(p[k-1]+=R||0)}let m=p.map((D,E)=>(D||0)+e[E]),g={side1Score:m[0],side2Score:m[1],winningSide:void 0},v=m.join(i),y=m.slice().reverse().join(i),b;if(l!=null&&l.winCriteria){let{valueGoal:D,aggregateValue:E,tallyDirectives:C}=l.winCriteria;if(D?b=(T=m.map((M,N)=>({sideNumber:N+1,points:M})).find(({points:M})=>M>=D))==null?void 0:T.sideNumber:E&&d.every(M=>M.matchUpStatus&&Nr.includes(M.matchUpStatus)||M.winningSide)&&m[0]!==m[1]&&(b=m[0]>m[1]?1:2),!b&&C){let M=a.matchUpId,N=a.hasContext?a:((S=r==null?void 0:r.drawMatchUps)==null?void 0:S[M])||n&&((w=fn({inContext:!0,drawDefinition:n,matchUpId:M}))==null?void 0:w.matchUp);if(N){let{completedTieMatchUps:R,order:A}=S0({matchUps:[N]});if(R&&(A!=null&&A.length)){let _=A[0].participantId;b=(U=N.sides.find(({participantId:k})=>k===_))==null?void 0:U.sideNumber}}}}return b&&(g.winningSide=b),{scoreStringSide1:v,scoreStringSide2:y,winningSide:b,set:g}}function sP({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var o,a;if(n){t||(t=(o=fn({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:o.matchUp);let{extension:s}=Qt({element:e,name:fp}),l=dt((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(a=t==null?void 0:t.sides)==null?void 0:a.map(u=>{var g;let d=u.participantId,p=d&&l[d]||void 0,{lineUp:h,...f}=((g=n.sides)==null?void 0:g.find(({sideNumber:v})=>v===u.sideNumber))??{},m=h!=null&&h.length?h:p;return{...c(u),...f,lineUp:m}}),yi({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function ho(t){if(t)return dt(t,!1,!0)}function aH(t){let e=Ei(t,[{[ko]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];let r=t.tournamentRecords[n].events??[],o=r.map(({eventId:s})=>s),a=r.map(s=>(s.drawDefinitions??[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...o,...a),i.eventIds.push(...o),i.drawIds.push(...a),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function _ie({tournamentRecords:t,eventId:e,drawId:i}){let{tournamentIdMap:n}=aH({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function Gp(t){var M,N,R,A;let{exitWhenNoValues:e,drawDefinition:i,matchUpStatus:n,removeScore:r,matchUpsMap:o,matchUpId:a,event:s}=t,l=t.tournamentRecords||t.tournamentRecord&&{[(M=t.tournamentRecord)==null?void 0:M.tournamentId]:t.tournamentRecord}||{},c=t.tournamentId||((N=t.tournamentRecord)==null?void 0:N.tournamentId);l&&_ie({tournamentRecords:l,...t});let u=c&&l[c];if(!u)return{error:Ge};let d=fn({drawDefinition:i,event:s,matchUpId:a});if(d.error)return d;if(!d.matchUp)return{error:Ao};let{matchUp:p,structure:h}=d;if(!p.tieMatchUps)return{error:Sa};sP({tournamentId:u==null?void 0:u.tournamentId,eventId:s==null?void 0:s.eventId,dualMatchUp:p,drawDefinition:i});let{extension:f}=Qt({name:$I,element:p});if(f!=null&&f.value)if(r)ta({element:p,name:$I});else return{...ae,score:p.score};let m=(R=Vo({drawDefinition:i,structure:h,matchUp:p,event:s}))==null?void 0:R.tieFormat;p.tieFormat=ho(m);let g=aP({drawDefinition:i,matchUpsMap:o,structure:h,matchUp:p,event:s}),{winningSide:v,set:y,scoreStringSide1:b,scoreStringSide2:I}=g,T=(y==null?void 0:y.side1Score)||(y==null?void 0:y.side2Score);if(e&&!p.score&&!T)return{...ae};let S={scoreStringSide1:b,scoreStringSide2:I,sets:y?[y]:[]},w=v&&[1,2].includes(v),U=w&&or||Aj({matchUpStatus:n??p.matchUpStatus,tieMatchUps:p.tieMatchUps,winningSide:p.winningSide,score:S})&&Jl||Gn,D=!!(p.winningSide&&!w),E=p.tieMatchUps.find(({score:_,winningSide:k,matchUpStatus:O})=>{var F;return((F=_==null?void 0:_.sets)==null?void 0:F.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||O&&Nr.includes(O)||k}),C;if(p.tieFormat&&!w&&!E){let _=(A=Vo({drawDefinition:i,structure:h,event:s}))==null?void 0:A.tieFormat;_&&JSON.stringify(m)===JSON.stringify(_)&&(p.tieFormatId=void 0,p.tieFormat=void 0,C=!0)}return pu({appliedPolicies:t.appliedPolicies,matchUpStatus:U,score:S,removeWinningSide:D,tournamentRecord:u,drawDefinition:i,removeScore:r,winningSide:v,matchUpId:a,matchUp:p,event:s}),{...ae,score:S,removeWinningSide:D,tieFormatRemoved:C,winningSide:v}}function mPe({winnerMatchUpDrawPositionIndex:t,inContextDrawMatchUps:e,projectedWinningSide:i,sourceMatchUpStatus:n,winningDrawPosition:r,tournamentRecord:o,winnerTargetLink:a,sourceMatchUpId:s,drawDefinition:l,winnerMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}){var f,m,g,v,y;let h="directWinner";if(a){let b=c.drawPositions||[],I=b[t],T=a.source.structureId,S=At({structureId:T,drawDefinition:l});if(S.error)return S;let{structure:w}=S,{positionAssignments:U}=jr({structureId:T,drawDefinition:l}),D=(f=U==null?void 0:U.find(A=>A.drawPosition===r))==null?void 0:f.participantId,E=a.target.structureId,{positionAssignments:C}=jr({structureId:E,drawDefinition:l}),M=(m=C==null?void 0:C.find(A=>A.participantId===D))==null?void 0:m.drawPosition,N=C==null?void 0:C.filter(A=>{let _=b.includes(A.drawPosition),k=!A.participantId&&!A.bye&&!A.qualifier;return _&&k}).map(A=>A.drawPosition),R=N==null?void 0:N.includes(I);if(D&&a.target.roundNumber===1&&R)Uu({drawPosition:I,participantId:D,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,matchUpsMap:d,event:p});else if(D&&(N!=null&&N.length)){let A=N.pop();A&&Uu({participantId:D,structureId:E,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:o,drawDefinition:l,drawPosition:A,matchUpsMap:d,event:p})}else if(M){let A=KI({drawPosition:M,matchUpId:c.matchUpId,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:o,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(A.error)return se({result:A,stack:h})}else if((w==null?void 0:w.stage)!==Tt){let A="winner target position unavaiallble";return console.log(A),{error:A}}if(w!=null&&w.seedAssignments&&w.structureId!==E){let A=w.seedAssignments.find(({participantId:k})=>k===D),_=A==null?void 0:A.participantId;A&&_&&I0({eventId:c==null?void 0:c.eventId,structureId:E,...A,tournamentRecord:o,drawDefinition:l,participantId:_})}}else{let b=KI({matchUpId:c.matchUpId,drawPosition:r,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:o,sourceMatchUpId:s,drawDefinition:l,matchUpsMap:d});if(b.error)return b}if(u&&i){let b=(g=u.sides)==null?void 0:g.find(I=>I.sideNumber===i);if(b!=null&&b.lineUp){let I=u.roundPosition,T=c.roundPosition,S=I===T&&I!==1||Math.floor(I/2)===T?2:1,w=(v=d==null?void 0:d.drawMatchUps)==null?void 0:v.find(({matchUpId:E})=>E===c.matchUpId),U=[1,2].map(E=>{var C;return{...((C=w.sides)==null?void 0:C.find(M=>M.sideNumber===E))||{},sideNumber:E}});w.sides=U;let D=w.sides.find(E=>E.sideNumber===S);if(D){let E=(y=b.lineUp)==null?void 0:y.filter(C=>C==null?void 0:C.participantId);D.lineUp=zj({lineUp:E}),yi({tournamentId:o==null?void 0:o.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:w,context:h,drawDefinition:l})}}}return{...ae}}function gPe(t){var B,$,V;let{loserMatchUpDrawPositionIndex:e,inContextDrawMatchUps:i,projectedWinningSide:n,sourceMatchUpStatus:r,loserDrawPosition:o,tournamentRecord:a,loserTargetLink:s,drawDefinition:l,loserMatchUp:c,dualMatchUp:u,matchUpsMap:d,event:p}=t,h="directLoser",f=s.linkCondition,m=c.drawPositions||[],g=f===bd&&c.roundNumber===2&&Math.min(...m.filter(Boolean)),v=g||m[e],y=g||m[1-e],b=s.source.structureId,{structure:I}=At({structureId:b,drawDefinition:l}),{matchUps:T}=_i({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:I,event:p}),S=T.filter(H=>{var z;return(z=H.drawPositions)==null?void 0:z.includes(o)}).filter(H=>{let z=H.sides.find(W=>W.drawPosition===o),G=H.matchUpStatus===Oi||H.matchUpStatus===Pi&&!io(H);return(z==null?void 0:z.sideNumber)===H.winningSide&&!G}),w=f===bd&&S.length===0,{positionAssignments:U}=jr({structureId:b,drawDefinition:l}),D=(B=U==null?void 0:U.find(H=>H.drawPosition===o))==null?void 0:B.participantId,E=s.target.structureId,{positionAssignments:C}=jr({structureId:E,drawDefinition:l}),M=C==null?void 0:C.filter(({drawPosition:H})=>m.includes(H));if(M!=null&&M.some(H=>H.participantId===D))return{...ae};let N=M==null?void 0:M.filter(H=>{let z=m.includes(H.drawPosition),G=!H.participantId&&!H.bye&&!H.qualifier;return z&&G}).map(H=>H.drawPosition),R=N==null?void 0:N.includes(v),A=s.target.roundNumber>1&&(N==null?void 0:N.length),_=s.target.roundNumber===1&&R;if(g){let H=k();if(H.error)return se({result:H,stack:h})}else if(_){let H=F();if(H.error)return se({result:H,stack:h})}else if(D&&A){N.sort(wr);let H=N[0],z=Uu({participantId:D,structureId:E,drawPosition:H,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p});if(z.error)return se({result:z,stack:h})}else return se({result:{error:Kw},context:{loserDrawPosition:o,loserTargetLink:s},stack:h});if(I!=null&&I.seedAssignments&&I.structureId!==E){let H=I.seedAssignments.find(({participantId:G})=>G===D),z=H==null?void 0:H.participantId;H&&z&&I0({eventId:c==null?void 0:c.eventId,structureId:E,...H,tournamentRecord:a,drawDefinition:l,participantId:z})}if(u&&n){let H=($=u.sides)==null?void 0:$.find(z=>z.sideNumber===3-n);if(H!=null&&H.lineUp){let{roundNumber:z,eventId:G}=c,{roundPosition:W}=u,K=z===1?2-W%2:1,Z=(V=d==null?void 0:d.drawMatchUps)==null?void 0:V.find(({matchUpId:Q})=>Q===c.matchUpId),Y=[1,2].map(Q=>{var te;return{...((te=Z.sides)==null?void 0:te.find(J=>J.sideNumber===Q))||{},sideNumber:Q}});Z.sides=Y;let X=Z.sides.find(Q=>Q.sideNumber===K);X&&(X.lineUp=zj({lineUp:H.lineUp}),yi({tournamentId:a==null?void 0:a.tournamentId,matchUp:Z,context:h,drawDefinition:l,eventId:G}))}}return{...ae};function k(){let H="loserLinkFedFMLC";return se(w?{result:F(),stack:H}:{result:O(),stack:H})}function O(){let H=xs({drawPosition:y,structureId:E,tournamentRecord:a,drawDefinition:l,event:p});return se({result:H,stack:"assignLoserPositionBye"})}function F(){let H=D?Uu({drawPosition:v,participantId:D,structureId:E,inContextDrawMatchUps:i,sourceMatchUpStatus:r,tournamentRecord:a,drawDefinition:l,matchUpsMap:d,event:p}):{error:Rr};return se({result:H,stack:"assignLoserDrawPosition"})}}function kie(t){var S;let e=oH(t);if(e.error)return e;let i=HD({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:r,inContextDrawMatchUps:o,tournamentRecord:a,drawDefinition:s,matchUpStatus:l,dualMatchUp:c,matchUpsMap:u,winningSide:d,targetData:p,matchUpId:h,structure:f,matchUp:m,event:g}=t,v="directParticipants",y=!!m.collectionId,b=ss({structure:f}),I=m.drawPositions,T;if(y){let{matchUpTieId:w,matchUpsMap:U}=t,D=Gp({appliedPolicies:t.appliedPolicies,matchUpId:w,tournamentRecord:a,drawDefinition:s,matchUpsMap:U,event:g});if(T=D&&{tieMatchUpResult:D},I=(S=o.find(({matchUpId:E})=>E===w))==null?void 0:S.drawPositions,!n)return se({result:{...ae,...T},stack:v})}if(b)return se({result:{...ae,...T},stack:v});if(I){let w=r?r-1:d-1,U=1-w,D=I[w],E=I[U],{targetLinks:{loserTargetLink:C,winnerTargetLink:M,byeTargetLink:N},targetMatchUps:{winnerMatchUpDrawPositionIndex:R,loserMatchUpDrawPositionIndex:A,winnerMatchUp:_,loserMatchUp:k,byeMatchUp:O}}=p;if(_){let F=mPe({sourceMatchUpStatus:i&&l||or,winnerMatchUpDrawPositionIndex:R,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:r,winningDrawPosition:D,tournamentRecord:a,winnerTargetLink:M,drawDefinition:s,winnerMatchUp:_,dualMatchUp:c,matchUpsMap:u,event:g});if(F.error)return se({result:F,stack:v})}if(k){let F=gPe({sourceMatchUpStatus:i&&l||or,loserMatchUpDrawPositionIndex:A,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:r,loserDrawPosition:E,tournamentRecord:a,loserTargetLink:C,drawDefinition:s,loserMatchUp:k,winningSide:d,matchUpsMap:u,dualMatchUp:c,event:g});if(F.error)return se({result:F,stack:v})}if(O){let F=O.drawPositions||[],B=Math.min(...F.filter(Boolean)),$=N.target.structureId,V=xs({drawPosition:B,structureId:$,tournamentRecord:a,drawDefinition:s,event:g});if(V.error)return se({result:V,stack:v})}}else return se({result:{error:cD},stack:v});return se({result:{...ae,...T},stack:v})}function sH(t){var K,Z,Y,X;let e="genPlayoffStructure";if(!t.drawDefinition)return se({result:{error:lt},stack:e});let i=eP(t);if(i.error)return se({result:i,stack:e});let{structureId:n,addNameBaseToAttributeName:r,playoffStructureNameBase:o,finishingPositionNaming:a,finishingPositionLimit:s,playoffAttributes:l,playoffPositions:c,roundOffsetLimit:u,tournamentRecord:d,exitProfileLimit:p,roundProfiles:h,roundNumbers:f,idPrefix:m,isMock:g,event:v,uuids:y}=t,b=dt(t.drawDefinition,!1,!0),{structure:I}=At({structureId:n,drawDefinition:b});if(!I)return se({result:{error:Nn},stack:e});if(I.structureType===fa||I.structures)return zDe({sourceStructureId:I.structureId,...t,...i,drawDefinition:b});let{playoffRoundsRanges:T,playoffRounds:S}=i,{playoffPositionsReturned:w,error:U,playoffSourceRounds:D,playoffRoundsRanges:E}=fie(t);if(U)return se({result:{error:U},stack:e});let C=(h==null?void 0:h.length)&&Object.assign({},...h),M=f||typeof h=="object"&&h.map(Q=>Object.keys(Q)).flat(),N=Array.isArray(M)&&M.map(Q=>!isNaN(Q)&&Et(Q)).filter(Boolean);if(N){if(!Array.isArray(N))return se({result:{error:Pe},context:{validRoundNumbers:N},stack:e});N.forEach(Q=>{if(!(S!=null&&S.includes(Q)))return se({result:{error:Pe},context:{roundNumber:Q},stack:e})})}c&&c.forEach(Q=>{if(!(w!=null&&w.includes(Q)))return se({result:{error:Pe},context:{playoffPosition:Q},stack:e})});let R=N||D,A=N?T:E,_=[],k=[];for(let Q of R??[]){let te=A==null?void 0:A.find(be=>be.roundNumber===Q);if(!te)return se({result:{error:Pe},context:{roundNumber:Q},stack:e});let J=te.finishingPositions.length,ie=Math.min(...te.finishingPositions)-1,oe=2,ne=Q&&(C==null?void 0:C[Q])&&oe+C[Q]-1,re=gI({exitProfile:`0-${Q}`,addNameBaseToAttributeName:r,playoffStructureNameBase:o,finishingPositionOffset:ie,playoffAttributes:l,exitProfileLimit:p,stage:$n,roundOffset:0,drawDefinition:b,sequenceLimit:ne,stageSequence:oe,drawSize:J,idPrefix:m,isMock:g,uuids:y,finishingPositionNaming:a,finishingPositionLimit:s,roundOffsetLimit:u});if(re.error)return se({result:re,stack:e});let{structures:me,links:he}=re;if(me!=null&&me.length&&_.push(...me),he!=null&&he.length&&k.push(...he),re.structureId&&Q){let be={linkType:yd,source:{structureId:n,roundNumber:Q},target:{structureId:re.structureId,feedProfile:Nl,roundNumber:1}};k.push(be)}}if(!_.length)return se({result:{error:Pe},info:"No structures generated",stack:e});b.structures.push(..._),b.links.push(...k);let{matchUps:O,matchUpsMap:F}=Tr({inContext:!0,drawDefinition:b}),B=_.map(({structureId:Q})=>Q),$=O==null?void 0:O.filter(({structureId:Q})=>B.includes(Q)).map(Br),V=(K=F==null?void 0:F.drawMatchUps)==null?void 0:K.filter(({matchUpId:Q})=>$==null?void 0:$.includes(Q));if(V!=null&&V.length){let Q=(Z=Vo({drawDefinition:b,event:v}))==null?void 0:Z.tieFormat;Q&&V.forEach(te=>{let{tieMatchUps:J}=tP({matchUp:te,tieFormat:Q,isMock:g});Object.assign(te,{tieMatchUps:J,matchUpType:sn})})}(Y=O==null?void 0:O.filter(Q=>mm({matchUp:Q})&&Q.structureId===n))==null||Y.forEach(Q=>{let{matchUpId:te,score:J,winningSide:ie}=Q,oe=ca({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:te}),ne=kie({inContextDrawMatchUps:O,tournamentRecord:d,drawDefinition:b,matchUpsMap:F,winningSide:ie,targetData:oe,matchUpId:te,structure:I,matchUp:Q,score:J,event:v});ne.error&&console.log(ne.error)}),(X=O==null?void 0:O.filter(Q=>Q.matchUpStatus===Ni&&Q.structureId===n))==null||X.forEach(Q=>{let{matchUpId:te}=Q,J=ca({inContextDrawMatchUps:O,drawDefinition:b,matchUpId:te}),{targetLinks:{loserTargetLink:ie},targetMatchUps:{loserMatchUpDrawPositionIndex:oe,loserMatchUp:ne}}=J;if(ie&&ne){let re=ie.target.structureId,me=ne.drawPositions[oe],he=xs({drawPosition:me,structureId:re,tournamentRecord:d,drawDefinition:b,event:v});he.error&&console.log(he.error)}});let H=[],z=Am({inContextDrawMatchUps:O,drawDefinition:b,matchUpsMap:F}).goesToMap,{structure:G}=At({drawDefinition:t.drawDefinition,structureId:n}),{matchUps:W}=_i({structure:G});return W.forEach(Q=>{var ie,oe;let te=z==null?void 0:z.loserMatchUpIds[Q.matchUpId];if(te&&Q.loserMatchUpId!==te){Q.loserMatchUpId=te;let ne={tournamentId:d==null?void 0:d.tournamentId,eventId:(ie=t.event)==null?void 0:ie.eventId,context:e,matchUp:Q};H.push(ne)}let J=z==null?void 0:z.winnerMatchUpIds[Q.matchUpId];if(J&&Q.winnerMatchUpId!==J){Q.winnerMatchUpId=J;let ne={tournamentId:d==null?void 0:d.tournamentId,eventId:(oe=t.event)==null?void 0:oe.eventId,context:e,matchUp:Q};H.push(ne)}}),{structures:_,matchUpModifications:H,links:k,drawDefinition:b,...ae}}function xie(t){return VA({...t,itemType:"attachConsolationStructures"})}function lH(t){return VA({...t,itemType:"attachPlayoffStructures"})}function VA({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:o=[],event:a}){var g,v,y;let s="attachStructures";if(!n)return{error:lt};if(!Array.isArray(r)||!Array.isArray(o))return se({result:{error:Pe},stack:s});let l=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},c=(g=n.links)==null?void 0:g.map(l);if(o.some(b=>{let I=l(b);return c==null?void 0:c.includes(I)}))return se({result:{error:fV},info:"playoff structure exists",stack:s});o.length&&((v=n.links)==null||v.push(...o));let u=r.map(({structureId:b})=>b),d=(y=n.structures)==null?void 0:y.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>u.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);let p=r==null?void 0:r.filter(({structureId:b})=>!(d!=null&&d.includes(b)));p.length&&n.structures.push(...p),Am({drawDefinition:n});let h=r.map(b=>{var I;return((I=_i({structure:b}))==null?void 0:I.matchUps)||[]}).flat();Yh({tournamentId:i==null?void 0:i.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUps:h});let f=r.map(({structureId:b})=>b);if(cn({drawDefinition:n,structureIds:f}),e==null?void 0:e.length){let b={};e.forEach(T=>{var w;let S=(w=T.matchUp)==null?void 0:w.matchUpId;S&&(b[S]=T)});let I=T=>{T.matchUps.forEach(S=>{if(b[S.matchUpId]){let{tieMatchUps:w,...U}=b[S.matchUpId].matchUp;if(Object.assign(S,U),w==null?void 0:w.length){let D={};w.forEach(E=>b[E.matchUpId]=E),S.tieMatchUps.forEach(E=>Object.assign(E,D[E.matchUpId]))}b[S.matchUpId].matchUp=S,yi(b[S.matchUpId])}})};n.structures.forEach(T=>{if(d!=null&&d.includes(T.structureId))if(T.structures)for(let S of T.structures)I(S);else I(T)})}let m=p.map(as("structureId"));if(i){let b={itemValue:{structureIds:f,drawId:n.drawId},itemType:t};Cf({element:i,timeItem:b})}return{...ae,addedStructureIds:m}}function jA(t){var a,s;let{structures:e,links:i,matchUpModifications:n,error:r}=sH(t);if(r)return{error:r};let o=t.drawDefinition;return lH({tournamentId:(a=t.tournamentRecord)==null?void 0:a.tournamentId,eventId:((s=t.event)==null?void 0:s.eventId)||t.eventId,matchUpModifications:n,drawDefinition:o,structures:e,links:i})}function _m(t){let e=Ei(t,[{_anyOf:{[ko]:!1,[xd]:!1,[qc]:!1,[n0]:!1},[TV]:!0}]);if(e.error)return e;let i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){let r=D6(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&cn({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Ge};for(let o of r){let a=t.tournamentRecords[o],s=D6(t,a);if(s.error)return s;i.push(...(s==null?void 0:s.applied)??[])}}else return{error:Ge};return i.length?{...ae,applied:i}:{error:eV}}function D6(t,e){let i=Bi(t).appliedPolicies??{};e.extensions||(e.extensions=[]);let n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:WN};for(let o of r)if(!i[o]||t.allowReplacement){let a=t.policyDefinitions[o];if(!a)continue;if(!ln(a))return{error:Pe};let{policyName:s,...l}=a;if(!l||!Object.keys(l).length||s&&!oa(s))return{error:Pe};i[o]=t.policyDefinitions[o],n.push(o)}return n!=null&&n.length?{...Ui({element:e,extension:{name:LT,value:i}}),applied:n}:{applied:n,error:eV}}function cH({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:o}){var s;if(!n||typeof n!="string")return se({result:{error:Pe},context:{drawName:n}});i||(i=Kn({event:o}).flightProfile);let a=(s=i==null?void 0:i.flights)==null?void 0:s.find(l=>l.drawId===r);if(a){a.drawName=n;let l={name:Vl,value:{...i,flights:i.flights}};Uf({event:o,extension:l})}return e&&(e.drawName=n,cn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),!a&&!e?{error:lt}:{...ae,flight:a}}function Oie({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var l;if(!ln(i))return{error:Pe};let o=Kn({event:r}).flightProfile,a=i.drawName&&cH({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:o,drawId:n,event:r});if(a!=null&&a.error)return a==null?void 0:a.error;let s=(a==null?void 0:a.flight)||((l=o==null?void 0:o.flights)==null?void 0:l.find(c=>c.drawId===n));if(!s&&!e)return{error:lt};if(s){let c={name:Vl,value:{...o,flights:o.flights}};Uf({event:r,extension:c})}return e&&(i.policyDefinitions&&_m({policyDefinitions:i.policyDefinitions,drawDefinition:e}),cn({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...ae}}function Lie({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var a,s;if(!i)return{error:lt};let n=Uo({drawDefinition:i}),r=l=>{var c;return(c=n==null?void 0:n.drawMatchUps)==null?void 0:c.find(u=>u.matchUpId===l)};for(let l of i.structures||[]){let{positionAssignments:c,stage:u,stageSequence:d}=l;c&&(d!==1||![Tt,ut].includes(u))&&(l.positionAssignments=c.map(f=>(delete f.participantId,f)),l.seedAssignments=[]);let{matchUps:p,isRoundRobin:h}=_i({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:n,structure:l});for(let f of p){let{matchUpId:m,roundNumber:g}=f,v=f.sides||[],y=r(m);if(y){if(delete y.extensions,delete y.notes,y.matchUpStatus!==Ni&&Object.assign(y,LA),g&&g>1&&((a=y.drawPositions)==null?void 0:a.length)&&!h){let b=v==null?void 0:v.map(({drawPosition:T,participantFed:S})=>!S&&T).filter(Boolean),I=y.drawPositions.map(T=>b.includes(T)?void 0:T);y.drawPositions=I}e?delete y.timeItems:(s=y.timeItems)!=null&&s.length&&(y.timeItems=y.timeItems.filter(b=>b.itemType&&![Ip,Mm,h0,Gee,f0,m0].includes(b.itemType))),yi({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:y})}}}let o=(i.structures||[]).map(({structureId:l})=>l);return cn({drawDefinition:i,structureIds:o}),{...ae}}function lP({tournamentRecord:t}){var n;if(!t)return{error:Ge};let e={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},i={};return((n=t.events)==null?void 0:n.map(r=>{let o=r.eventId;return i[o]=r,((r==null?void 0:r.drawDefinitions)||[]).map(a=>({drawDefinition:a,eventId:o}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:o})=>{let a=0,s=0,l=0,{allStructuresLinked:c}=xA({drawDefinition:r}),u=i[o],d=((r==null?void 0:r.structures)||[]).map(I=>{let{stage:T,stageSequence:S,structureId:w}=I,U=Fv[T],{inContextStructureMatchUps:D}=GD({drawDefinition:r,structure:I,event:u}),E=D==null?void 0:D.filter(({winningSide:H})=>H),C=E.filter(Boolean).length||0;s+=C,l+=D.length-s;let M=Math.max(E.filter(({roundNumber:H})=>H===1).map(({roundPosition:H})=>H)),{positionAssignments:N}=Yi({structure:I}),R=N==null?void 0:N.filter(({participantId:H})=>H);a+=(R==null?void 0:R.length)??0;let A=((N==null?void 0:N.length)??0)-((R==null?void 0:R.length)??0),{roundMatchUps:_,roundProfile:k,roundNumbers:O,maxMatchUpsCount:F}=la({matchUps:D}),B=k&&Object.keys(k).filter(H=>!k[H].inactiveRound).map(H=>parseInt(H)),$=k&&Object.keys(k).filter(H=>k[H].inactiveRound).map(H=>parseInt(H)),V=k&&Object.values(k).every(H=>H.inactiveRound);return{positionsAssignedCount:(R==null?void 0:R.length)??0,maxWinningSideFirstRoundPosition:M,unassignedPositionsCount:A,inactiveStructure:V,maxMatchUpsCount:F,inactiveRounds:$,roundMatchUps:_,activeRounds:B,roundNumbers:O,roundProfile:k,structureId:w,stageSequence:S,orderNumber:U,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=g0({structureId:p.structureId,drawDefinition:r}),m=Et(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;a&&!s&&e.positionsNoOutcomes.push(y),g&&e.inactive.push(y),m&&e.matchPlay.push(y),v&&e.canBePruned.push(y);let b={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:a,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};e.drawAnalysis[y]=b}),{...ae,drawsAnalysis:e}}function Fie({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var a;if(!e)return{error:Ge};if(!i)return{error:lt};let r=[],{drawsAnalysis:o}=lP({tournamentRecord:e});if(o.canBePruned.includes(n)){let s=o.matchPlay.includes(n),l=o.drawAnalysis[n],{structures:[c]}=wd({stageSequence:1,drawDefinition:i,stage:ut}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);r=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));let p=r.map(Br),h=d.map(Br).filter(f=>!p.includes(f));if(s){let f=r.filter(({roundNumber:b})=>!u.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map(Br),g=p.filter(b=>!m.includes(b));h.push(...g);let v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){let b=(a=c==null?void 0:c.positionAssignments)==null?void 0:a.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));c.positionAssignments=b}else c.positionAssignments=[];c.matchUps=f,r=f}Bp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),cn({drawDefinition:i})}return{...ae,matchUps:r}}function Bie({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:o,event:a,bye:s}){if(!e)return{error:lt};if(!n)return{error:Zw};if(!r)return{error:_s};if(s){let l=xs({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:a});if(l.error)return l}else{if(o)return{error:eA};{let l=Uu({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:a});if(l.error)return l}}return{...ae}}function $ie(t){var l,c,u,d,p;let e=t.matchUpIds??[],{drawDefinition:i}=t,n=t.structureId??((c=(l=i==null?void 0:i.structures)==null?void 0:l.find(h=>{var f;return(f=h.matchUps)==null?void 0:f.some(({matchUpId:m})=>e.includes(m))}))==null?void 0:c.structureId)??((d=(u=i==null?void 0:i.structures)==null?void 0:u[0])==null?void 0:d.structureId);if(!n)return{error:Nn};let r=(p=i.structures)==null?void 0:p.find(h=>h.structureId===n);if(!r)return{error:Nn};let o=r==null?void 0:r.matchUps,a=o==null?void 0:o.find(h=>!!h.roundPosition);if(r.structures||a||r.finishingPosition===Cy)return{error:Iy};let s=o.filter(({roundNumber:h})=>{var f;return(f=t.roundNumbers)==null?void 0:f.includes(h)}).map(Br);return e=e.filter(h=>!s.includes(h)),t.roundNumbers&&!e.length&&(e=s),{existingMatchUps:o,matchUpIds:e,structureId:n,structure:r}}function Vie(t){let e=Ei(t,[{[qc]:!0},{[_T]:{[vD]:!1,roundNumbers:!1},[fd]:Pe,[Sf]:Xa}]);if(e.error)return e;let{removeIncomplete:i=!1,removeUnAssigned:n=!0,removeCompleted:r=!1,tournamentRecord:o,drawDefinition:a,event:s}=t,l=$ie(t);if(l.error)return l;let{structure:c,structureId:u,existingMatchUps:d,matchUpIds:p}=l,h=[],f=(d==null?void 0:d.filter(({matchUpId:v,score:y,winningSide:b})=>{if(b&&!r)return!1;if(io({score:y})){if(!b&&!i)return!1;h.push(v)}else if(!n)return!1;return p==null?void 0:p.includes(v)}))??[],m=f.map(Br),g=f.map(({tieMatchUps:v})=>v==null?void 0:v.map(Br)).filter(Boolean).flat();if(m.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:b})=>!m.includes(b)),Bp({tournamentId:o==null?void 0:o.tournamentId,matchUpIds:[...g,...m],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:a});let v=Zt(c.matchUps.map(as("roundNumber"))),y=pSe(v);if(y.length){y.reverse();for(let b of y)c.matchUps.forEach(I=>{I.roundNumber&&I.roundNumber>b&&(I.roundNumber-=1,yi({tournamentId:o==null?void 0:o.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:a,matchUp:I}))})}if(h.length){c.positionAssignments=Zt(c.matchUps.flatMap(S=>(S.sides??[]).map(w=>w.participantId)).filter(Boolean)).map(S=>({participantId:S}));let b=(c==null?void 0:c.matchUpFormat)??(a==null?void 0:a.matchUpFormat)??(s==null?void 0:s.matchUpFormat),{matchUps:I}=_i({afterRecoveryTimes:!1,inContext:!0,structure:c,event:s}),T=rH({positionAssignments:c.positionAssignments,tournamentRecord:o,drawDefinition:a,matchUpFormat:b,matchUps:I,event:s});T.error&&console.log(T)}cn({structureIds:[u],eventId:s==null?void 0:s.eventId,drawDefinition:a})}return!m.length&&p.length?{error:tA}:{...ae,deletedMatchUpsCount:[...m,...g].length}}function jie({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:o}){if(!e)return{error:Ge};if(!i)return{error:lt};if(!r)return se({result:{error:gt},info:"roundNumber required"});let a=At({drawDefinition:i,structureId:n});if(a.error)return a;let s=a.structure;return s!=null&&s.structures?{error:Iy}:ss({structure:s})?vPe({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:o.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...ae})}function vPe({removeCompletedMatchUps:t,drawDefinition:e,tournamentId:i,roundNumber:n,structure:r,eventId:o}){let a=(r==null?void 0:r.matchUps)??[],s=[],l=[],c=!1;if(a.reduce((u,d)=>{let p=d==null?void 0:d.roundNumber;return p?u.includes(p)?u:u.concat(p):u},[]).sort(wr).includes(n)){let u=a.filter(d=>{let p=d.roundNumber===n&&(!Nr.includes(d.matchUpStatus)||t);return p&&(l.push(d.matchUpId),d.tieMatchUps&&s.push(...d.tieMatchUps.map(Br))),!p});l.length&&(Bp({matchUpIds:[...s,...l],drawDefinition:e,tournamentId:i,eventId:o}),u.some(d=>d.roundNumber===n)||(u.forEach(d=>{d.roundNumber>n&&(d.roundNumber-=1,yi({drawDefinition:e,tournamentId:i,eventId:o,matchUp:d}))}),c=!0),r.matchUps=u)}return{deletedMatchUpsCount:l.length,roundRemoved:c,...ae}}function HA(t){var p,h,f,m,g,v;let{suppressNotifications:e,tournamentRecord:i,drawDefinition:n,matchUps:r,event:o}=t;if(typeof n!="object")return{error:lt};let a=t==null?void 0:t.structureId;if(!a&&((p=n.structures)==null?void 0:p.length)===1&&(a=(f=(h=n.structures)==null?void 0:h[0])==null?void 0:f.structureId),typeof a!="string")return{error:_s};if(!hl(r))return{error:Pe,info:Td("matchUps")};let s=(m=n.structures)==null?void 0:m.find(y=>y.structureId===a);if(!s)return{error:Nn};let l=(s==null?void 0:s.matchUps).find(y=>!!y.roundPosition);if(s.structures||l||s.finishingPosition===Cy)return{error:Iy};let c=((v=(g=to({tournamentRecord:i,inContext:!1}))==null?void 0:g.matchUps)==null?void 0:v.map(Br))??[],u=r.map(Br);if(sa(c,u))return{error:EQ,info:"One or more matchUpIds already present in tournamentRecord"};s.matchUps.push(...r);let d=r.map(({tieMatchUps:y})=>y).filter(Boolean).flat();return e||(Yh({tournamentId:i==null?void 0:i.tournamentId,matchUps:[...d,...r],eventId:o==null?void 0:o.eventId,drawDefinition:n}),cn({drawDefinition:n,structureIds:[a]})),{...ae}}function Hie({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:o}){var h;if(!e)return{error:lt};if(!n)return{error:_s};if(!i)return{error:Zw};let{structure:a}=At({drawDefinition:e,structureId:n});if(!a)return{error:Nn};let s=a;a.structures&&a.structureType===fa&&(s=(h=a.structures)==null?void 0:h.find(f=>{var m;return(m=f.positionAssignments)==null?void 0:m.find(g=>g.drawPosition===i)}));let l=s==null?void 0:s.positionAssignments,c=l==null?void 0:l.find(f=>f.drawPosition===i);c&&Ui({element:c,extension:{name:VI,value:r}});let u=((o==null?void 0:o.eventType)===sn||e.matchUpType===sn||((o==null?void 0:o.tieFormat)??(e==null?void 0:e.tieFormat)??(a==null?void 0:a.tieFormat)))&&{matchUpTypes:[sn]},{matchUps:d}=_i({structure:s,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:u,event:o}),p=(a==null?void 0:a.matchUpFormat)??e.matchUpFormat;return rH({positionAssignments:l,tournamentRecord:t,drawDefinition:e,matchUpFormat:p,matchUps:d,event:o}),cn({drawDefinition:e,structureIds:[n]}),{...ae}}var Gie={};ii(Gie,{addGoesTo:()=>Am,allPlayoffPositionsFilled:()=>Kj,checkValidEntries:()=>qA,findDrawDefinition:()=>hH,getAssignedParticipantIds:()=>fg,getAvailableMatchUpsCount:()=>GA,getAvailablePlayoffProfiles:()=>eP,getDrawDefinitionTimeItem:()=>Rj,getDrawParticipantRepresentativeIds:()=>dH,getDrawTypeCoercion:()=>cP,getEligibleVoluntaryConsolationParticipants:()=>uH,getMatchUpsMap:()=>Uo,getParticipantIdFinishingPositions:()=>pH,getPositionAssignments:()=>ZT,getPositionsPlayedOff:()=>w0,getSeedingThresholds:()=>Hj,getSeedsCount:()=>uP,getStructureSeedAssignments:()=>ol,getTeamLineUp:()=>Nm,getValidGroupSizes:()=>KD,isAdHoc:()=>ss,isCompletedStructure:()=>Xh,isValidForQualifying:()=>SH,positionActions:()=>wH});function uH({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:o,tournamentRecord:a,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var k,O,F,B,$;if(!s)return{error:lt};let f=[ut,$n];i&&f.push(Tt);let m=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,g=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,v=e&&h?((k=Hp({contextFilters:{stages:f},matchUpFilters:m,tournamentRecord:a,inContext:!0,event:h}))==null?void 0:k.matchUps)??[]:((O=Ia({contextFilters:{stages:f},matchUpFilters:g,tournamentRecord:a,inContext:!0,drawDefinition:s}))==null?void 0:O.matchUps)??[],y=My({stage:Xr,drawDefinition:s}).map(({participantId:V})=>V),b={},I={},T={},S={};r||(r=$p({policyTypes:[VF],tournamentRecord:a,drawDefinition:s,event:h}).policyDefinitions);let w=r==null?void 0:r[VF];t=t.length&&t||(w==null?void 0:w.excludedMatchUpStatuses)||[],e=e??(w==null?void 0:w.includeEventParticipants),d=d??(w==null?void 0:w.allEntries),n=n??(w==null?void 0:w.finishingRoundLimit),o=o??(w==null?void 0:w.roundNumberLimit),l=l??(w==null?void 0:w.matchUpsLimit),c===void 0&&(c=(w==null?void 0:w.requirePlay)!==void 0?w.requirePlay:!0),u===void 0&&(u=(w==null?void 0:w.requireLoss)!==void 0?w.requireLoss:!0),p=p??(w==null?void 0:w.winsLimit);for(let V of v){if(c&&V.winningSide&&![1,2].includes(V.winningSide)&&V.matchUpStatus!==mr||V.finishingRound&&n&&V.finishingRound>=n||V.finishingRound&&o&&V.finishingRound<=o)continue;let H=(F=V.sides)==null?void 0:F.find(({sideNumber:G})=>V.winningSide&&G===3-V.winningSide),z=(B=V.sides)==null?void 0:B.find(({sideNumber:G})=>V.winningSide&&G===V.winningSide);if(($=V.sides)==null||$.forEach(G=>{var K;let W=(K=G==null?void 0:G.participant)==null?void 0:K.participantId;W&&(T[W]=G.participant,V.matchUpStatus===mr&&!c&&(I[W]=G.participant,b[W]||(b[W]=0),(!V.matchUpStatus||!t.includes(V.matchUpStatus))&&(b[W]+=1)))}),H==null?void 0:H.participant){let G=H.participant.participantId;I[G]=H.participant,b[G]||(b[G]=0),V.matchUpStatus&&!t.includes(V.matchUpStatus)&&(b[G]+=1)}if(z!=null&&z.participant){let G=z.participant.participantId;S[G]||(S[G]=0),S[G]+=1,b[G]||(b[G]=0),V.matchUpStatus&&!t.includes(V.matchUpStatus)&&(b[G]+=1)}}let U=(a==null?void 0:a.participants)&&!c&&!u&&d,D=U?((e&&h?h.entries:s.entries)??[]).filter(V=>![bp,Ql].includes(V.entryStatus)).map(({participantId:V})=>V):[],E=Object.keys(I),C=U?((a==null?void 0:a.participants)??[]).filter(({participantId:V})=>D.includes(V)):u&&Object.values(I)||Object.values(T),M=V=>!u||E.includes(V),N=V=>!c||(b[V]||0)>=0,R=V=>!p||(S[V]||0)<=p,A=V=>!l||b[V]<=l,_=V=>!y.includes(V);return{eligibleParticipants:C.filter(V=>M(V.participantId)&&N(V.participantId)&&R(V.participantId)&&A(V.participantId)&&_(V.participantId)).map(V=>{var H;return{...V,individualParticipants:(H=V.individualParticipantIds)==null?void 0:H.map(z=>{var G;return(G=a==null?void 0:a.participants)==null?void 0:G.find(W=>W.participantId===z)})}}),losingParticipantIds:E,...ae}}function GA(t){var f,m,g,v,y,b,I,T;let e=Ei(t,[{drawDefinition:!0}]);if(e.error)return e;let{drawDefinition:i,roundNumber:n}=t,r=t.structureId??(((f=i.structures)==null?void 0:f.length)===1&&((g=(m=i.structures)==null?void 0:m[0])==null?void 0:g.structureId));if(typeof r!="string")return{error:_s};let o=(v=i.structures)==null?void 0:v.find(S=>S.structureId===r);if(!o)return{error:Nn};let a,s=(y=o.matchUps??[])==null?void 0:y.reduce((S,w)=>(w.roundPosition&&(a=!0),((w==null?void 0:w.roundNumber)||0)>S?w.roundNumber:S),0);if(o.structures||a||o.finishingPosition===Cy)return{error:Iy};let l=((b=i==null?void 0:i.entries)==null?void 0:b.filter(S=>{let w=S.entryStatus;return ec.includes(w)}))??[],c=Math.floor((l==null?void 0:l.length)/2)||1,u=n??s??1,d=((T=(I=o.matchUps)==null?void 0:I.filter(S=>S.roundNumber===u))==null?void 0:T.length)??0,p=c-d,h=p>0?p:0;return{...ae,availableMatchUpsCount:h,lastRoundNumber:s,roundMatchUpsCount:c}}function dH({drawDefinition:t}){var i;let e=Qt({name:"participantRepresentatives",element:t});return e.error?e:{representativeParticipantIds:((i=e.extension)==null?void 0:i.value)||[]}}function yPe({tournamentParticipants:t,drawDefinition:e,event:i}){if(!e)return{error:lt};let n=Tr({tournamentParticipants:t,inContext:!0,drawDefinition:e,event:i}),r=dt(n.matchUps,!1,!0),o=Zt(r.reduce((s,l)=>s.concat(...l.sides.map(c=>c.participantId).filter(Boolean)),[])),a=Object.assign({},...o.map(s=>{let l=r.filter(c=>c.sides.map(u=>u.participantId).filter(Boolean).includes(s));return{[s]:l}}));return{participantIds:o,participantIdMatchUps:a}}function pH({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:lt};let{participantIds:n,participantIdMatchUps:r}=yPe({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),o=(n==null?void 0:n.map(a=>{let s=r[a].filter(d=>[or,Ni].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{let p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===a).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[a]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...o)}function Ef({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:Ge};if(!n)return{error:Wc};if(!e&&t){if(typeof i!="string"&&(i=_ie({tournamentRecords:t,drawId:n}),!i))return{error:AI};if(e=t[i],!e)return{error:Ge}}let r=e&&Ta({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...ae}:se({result:{error:ns},stack:"findDrawDefinition"})}function hH(t){let{drawDefinition:e,error:i}=Ef(t);return i?{error:i}:{drawDefinition:dt(e)}}function i2({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){let{links:o}=g0({drawDefinition:i,structureId:n})||{},a=((o==null?void 0:o.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{let l=s.source.structureId,{structure:c}=At({structureId:l,drawDefinition:i});if(!(e&&(c==null?void 0:c.finishingPosition)!==e))return s}).filter(Boolean);return{sourceStructureIds:a.map(({source:s})=>s.structureId),relevantLinks:a}}var bPe="qualifierDrawPositionAssignment",IPe="withdrawParticipantAtDrawPosition",wPe="alternateDrawPositionAssignment",SPe="luckyLoserDrawPositionAssignment",P6="removeDrawPositionAssignment",TPe="swapDrawPositionAssignments",UPe="modifyPairAssignment",DPe="modifyParticipantOtherName",C6="assignDrawPosition",PPe="removeSeededParticipant",CPe="assignDrawPositionBye",EPe="modifySeedAssignment",zie="addPenalty",fH="MODIFY_PAIR",zA="QUALIFIER",mH="ALTERNATE",gH="WITHDRAW",Vv="ASSIGN",n2="REMOVE",vH="LUCKY",eT="REMOVE_SEED",yH="SWAP",KT="NICKNAME",hv="SEED_VALUE",jv="PENALTY",BM="BYE",$y={MODIFY_PAIR_ASSIGNMENT:fH,QUALIFYING_PARTICIPANT:zA,ALTERNATE_PARTICIPANT:mH,WITHDRAW_PARTICIPANT:gH,ASSIGN_PARTICIPANT:Vv,LUCKY_PARTICIPANT:vH,REMOVE_ASSIGNMENT:n2,SWAP_PARTICIPANTS:yH,ADD_NICKNAME:KT,REMOVE_SEED:eT,ADD_PENALTY:jv,ASSIGN_BYE:BM,SEED_VALUE:hv};function MPe({tournamentParticipants:t,returnParticipants:e,drawPosition:i,participant:n,drawId:r,event:o}){var s;let a=((s=o==null?void 0:o.entries)==null?void 0:s.filter(({entryStatus:l})=>[Ql,sg].includes(l)).map(({participantId:l})=>l))||[];if(a.length){let l=n.individualParticipantIds,c=e?t.filter(({participantId:d})=>a.includes(d)):void 0,u=e?t.filter(({participantId:d})=>l.includes(d)):void 0;return{validModifyAssignedPairAction:wt({payload:{participantId:n.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:i,drawId:r},method:UPe,availableIndividualParticipantIds:a,availableIndividualParticipants:c,existingIndividualParticipantIds:l,existingIndividualParticipants:u,type:fH},!1,!1,!0)}}return{}}function km(t){var h,f;let{inContextDrawMatchUps:e,targetData:i,drawDefinition:n,relevantLink:r}=t;if((r==null?void 0:r.linkCondition)===bd&&((h=i==null?void 0:i.matchUp)==null?void 0:h.matchUpStatus)===Ni)return!1;let{targetMatchUps:{loserMatchUp:o,winnerMatchUp:a},targetLinks:s}=i,l=[Pi,Oi].includes(o==null?void 0:o.matchUpStatus),c=((f=a==null?void 0:a.drawPositions)==null?void 0:f.filter(Boolean).length)||0;if(o!=null&&o.winningSide&&!l||a!=null&&a.winningSide&&c===2&&(!a.feedRound||![Oi,Pi].includes(a==null?void 0:a.matchUpStatus)))return!0;let u=o&&ca({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),d=a&&ca({matchUpId:a.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),p=u&&km({relevantLink:s==null?void 0:s.loserTargetLink,targetData:u,inContextDrawMatchUps:e,drawDefinition:n});return!!(d&&km({targetData:d,inContextDrawMatchUps:e,drawDefinition:n})||p)}var Wie={[hp]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[Tt,ut],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[KT,jv,zA,hv],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},AE="positionAction",r2="matchUpAction";function qie({actionType:t=AE,appliedPolicies:e,drawDefinition:i,structure:n}){var d,p;let r=t===AE&&hp||t===r2&&Zr,o=t===AE&&Wie||t===r2&&Pte,a=r&&((e==null?void 0:e[r])||(o==null?void 0:o[r])),s=((p=(d=i.links)==null?void 0:d.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}))==null?void 0:p.map(({target:h})=>h.feedProfile))??[],{enabledStructures:l,disabledStructures:c}=a||{},u=c==null?void 0:c.find(h=>{let{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>s.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:l,actionsDisabled:u,actionsPolicy:a}}function E6({activePositionOverrides:t,activeDrawPositions:e,action:i}){return i&&t.includes(i)?!0:!e.length}function Yie({enabledStructures:t,drawDefinition:e,structure:i}){var s,l;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};let{stage:n,stageSequence:r,structureType:o}=i||{},a=((l=(s=e.links)==null?void 0:s.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}))==null?void 0:l.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{let{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(n),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(r),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(o),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>a.includes(y));return m&&g&&v&&c&&f})}}function _a({action:t,policyActions:e}){var n;let i=!(e!=null&&e.enabledActions)||((n=e==null?void 0:e.disabledActions)==null?void 0:n.length)&&e.disabledActions.includes(t);return i?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!i}var Kie="replaceTieMatchUpParticipantId",Zie="assignTieMatchUpParticipantId",o2="removeTieMatchUpParticipantId",M6="assignMatchUpSideParticipant",RPe="removeMatchUpSideParticipant",Xie="substituteParticipant",a2="REMOVE_SUBSTITUTION",Jie="REPLACE_PARTICIPANT",bH="REMOVE_PARTICIPANT",s2="setMatchUpStatus",l2="SUBSTITUTION",Qie="SCHEDULE",NPe="PENALTY",c2="REFEREE",ene="STATUS",u2="START",tne="SCORE",d2="END",IH={REPLACE_TEAM_POSITION_METHOD:Kie,ASSIGN_TEAM_POSITION_METHOD:Zie,REMOVE_TEAM_POSITION_METHOD:o2,REPLACE_PARTICIPANT:Jie,SUBSTITUTION_METHOD:Xie,REMOVE_SUBSTITUTION:a2,REMOVE_PARTICIPANT:bH,SCHEDULE_METHOD:s2,SUBSTITUTION:l2,SCHEDULE:Qie,PENALTY:NPe,REFEREE:c2,STATUS:ene,SCORE:tne,START:u2,END:d2};function APe({specifiedPolicyDefinitions:t,inContextDrawMatchUps:e,matchUpParticipantIds:i,matchUpActionsPolicy:n,inContextMatchUp:r,policyActions:o,enforceGender:a,participantId:s,sideNumber:l,matchUpId:c,matchUp:u,drawId:d,side:p}){var R,A,_,k,O,F,B,$,V,H,z,G,W,K,Z;let h=[],f=(R=r.sides)==null?void 0:R.find(Y=>Y.participant),m=r.gender===ts&&r.sideNumber&&((A=r.sides)==null?void 0:A.filter(Y=>Y.particiapntId).length)===1&&((k=(_=f==null?void 0:f.participant)==null?void 0:_.person)==null?void 0:k.sex),g=r.matchUpType,v=(a??((O=n==null?void 0:n.participants)==null?void 0:O.enforceGender))!==!1?r.gender:void 0,y=(B=(F=r.sides)==null?void 0:F.flatMap(Y=>{var X;return((X=Y.participant)==null?void 0:X.individualParticipants)||Y.participant}).filter(Boolean))==null?void 0:B.map(ai),b=($=r.sides)==null?void 0:$.filter(Y=>!l||Y.sideNumber===l).flatMap(Y=>{var X;return((X=Y.participant)==null?void 0:X.individualParticipants)||Y.participant}).filter(Boolean),I=b==null?void 0:b.map(ai),T=(H=(V=e==null?void 0:e.find(Y=>Y.matchUpId===r.matchUpTieId))==null?void 0:V.sides)==null?void 0:H.map(Y=>{var X;return(X=Y.participant)==null?void 0:X.individualParticipants.filter(({participantId:Q,person:te})=>!(I!=null&&I.includes(Q))&&(!v||v===Tu||te.sex===v||v===ts&&!m||m&&te.sex!==m))}),S=l?T==null?void 0:T[l-1]:T==null?void 0:T.map((Y,X)=>({participants:Y,sideNumber:X+1})),w=l?(z=T==null?void 0:T[l-1])==null?void 0:z.map(ai):T==null?void 0:T.map((Y,X)=>({participants:Y==null?void 0:Y.map(ai),sideNumber:X+1})),U=l&&(jn(uv)(g)&&!(I!=null&&I.length)||jn(Cm)(g)&&((I==null?void 0:I.length)??0)<2)||!l&&(jn(uv)(g)&&((I==null?void 0:I.length)??0)<2||jn(Cm)(g)&&((I==null?void 0:I.length)??0)<4),D=w==null?void 0:w.filter(Y=>!(y!=null&&y.includes(Y))),E=S==null?void 0:S.filter(({participantId:Y})=>D.includes(Y));if(U&&(D!=null&&D.length)&&h.push({availableParticipantIds:D,method:Zie,availableParticipants:E,type:Vv,payload:{participantId:void 0,tieMatchUpId:c,sideNumber:l,drawId:d}}),I!=null&&I.length&&(!io(u)||(G=p==null?void 0:p.substitutions)!=null&&G.length)&&h.push({method:o2,type:bH,existingParticipantIds:I,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}}),E!=null&&E.length&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&h.push({availableParticipantIds:D,method:Kie,availableParticipants:E,type:Jie,existingParticipantIds:I,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:c,drawId:d}}),_a({policyActions:o,action:a2})&&((W=p==null?void 0:p.substitutions)==null?void 0:W.length)){let Y=((K=p.participant)==null?void 0:K.participantType)===si&&[p.participantId]||((Z=p.participant)==null?void 0:Z.participantType)===jt&&p.participant.individualParticipantIds||[],X=p.substitutions.map(Q=>Q.participantId).filter(Q=>Y.includes(Q));(!s||X.includes(s))&&h.push({method:o2,type:a2,substitutedParticipantIds:X,payload:{participantId:void 0,tieMatchUpId:c,drawId:d}})}let C=t==null?void 0:t[Zr],M=C==null?void 0:C.substituteWithoutScore,N=C==null?void 0:C.substituteAfterCompleted;if(_a({policyActions:o,action:l2})&&i.length===2&&(!l&&(I!=null&&I.length)||l&&(p!=null&&p.participant))&&(M||io(u))&&(N||u.matchUpStatus&&!Nr.includes(u.matchUpStatus))&&(b!=null&&b.length)&&S.length){let Y=b.map(ai);h.push({info:"list of team players available for substitution",method:Xie,availableParticipantIds:w,existingParticipantIds:Y,availableParticipants:S,existingParticipants:b,type:l2,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:l,matchUpId:c,drawId:d}})}return h}function _Pe({tournamentParticipants:t=[],possiblyDisablingAction:e,activeDrawPositions:i,positionAssignments:n,returnParticipants:r,appliedPolicies:o,drawDefinition:a,drawPosition:s,validActions:l,structureId:c,structure:u,drawId:d,event:p}){var w,U,D,E,C;if(i.includes(s))return{};let h=(w=l.find(M=>M.type===Vv))==null?void 0:w.availableParticipantIds,f=(U=o==null?void 0:o[hp])==null?void 0:U.otherFlightEntries,m=(D=o==null?void 0:o[hp])==null?void 0:D.restrictQualifyingAlternates,g=(a.entries??[]).filter(({entryStage:M})=>!m||(u.stage===Tt?M===Tt:M!==Tt)).sort((M,N)=>(M.entryPosition??1/0)-(N.entryPosition??1/0)).map(({participantId:M})=>M).filter(Boolean),{allPositionedParticipantIds:v}=Dee({drawDefinition:a}),y=n.map(M=>M.participantId).filter(Boolean),b=g.filter(M=>u.stage&&[Tt,ut,$n].includes(u.stage)?!(v!=null&&v.includes(M)):!y.includes(M)),I=((p==null?void 0:p.entries)??[]).filter(M=>M.entryStatus===Ol&&ine({restrictQualifyingAlternates:m,structure:u,entry:M})&&(u.stage&&[Tt,ut,$n].includes(u.stage)?!(v!=null&&v.includes(M.participantId)):!y.includes(M.participantId))).sort((M,N)=>(M.entryPosition??1/0)-(N.entryPosition??1/0)).map(M=>M.participantId),T=Zt(b.concat(I));if(f){let M=(C=(E=p?Kn({event:p}).flightProfile:void 0)==null?void 0:E.flights)==null?void 0:C.filter(N=>N.drawId!==d).map(N=>N.drawEntries.filter(R=>R.participantId&&![bp,Ql,sg].includes(R.entryStatus)&&!g.includes(R.participantId)).map(({participantId:R})=>R)).flat().filter(Boolean);M!=null&&M.length&&T.push(...M)}h!=null&&h.length&&(T=T.filter(M=>!h.includes(M)));let S=r?t==null?void 0:t.filter(M=>T.includes(M.participantId)):void 0;return S==null||S.forEach(M=>{let N=(a.entries??[]).find(R=>R.participantId===M.participantId);M.entryPosition=N==null?void 0:N.entryPosition}),S==null||S.sort((M,N)=>(M.entryPosition||1/0)-(N.entryPosition||1/0)),T.length?{validAlternatesAction:wt({payload:{drawId:d,structureId:c,drawPosition:s},willDisableLinks:e,method:wPe,availableAlternatesParticipantIds:T,type:mH,availableAlternates:S})}:{}}function ine({restrictQualifyingAlternates:t,structure:e,entry:i}){let{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===Tt&&!t||i.entryStage===ut&&n===Io)return!0}function kPe({eventEntries:t,structure:e}){let i=r=>r.entryStatus===Ol&&ine({structure:e,entry:r}),n=(r,o)=>(r.entryPosition||1/0)-(o.entryPosition||1/0);return t.filter(i).sort(n).map(ai)}function xPe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:o,sideNumber:a,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var S,w,U,D,E;let p=[],h=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:C})=>C===c.roundNumber),f=((S=r==null?void 0:r.entries)==null?void 0:S.filter(({entryStatus:C})=>C&&lg.includes(C)).map(ai))??[],m=h.map(C=>(C.sides??[]).flatMap(ai)).flat().filter(Boolean),g=f.filter(C=>!i.includes(C)&&(!t||!m.includes(C))),v=e==null?void 0:e.filter(C=>g==null?void 0:g.includes(C.participantId)).map(C=>dt(C,void 0,!0));v==null||v.forEach(C=>{let M=(r.entries??[]).find(N=>N.participantId===C.participantId);C.entryPosition=M==null?void 0:M.entryPosition}),g.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:o,sideNumber:a},method:M6,type:Vv,availableParticipantIds:g,participantsAvailable:v});let y=(d==null?void 0:d.entries)??[],b=kPe({eventEntries:y,structure:l}),I=Zt(f.concat(b));if(n){let C=(U=(w=d?Kn({event:d}):void 0)==null?void 0:w.flights)==null?void 0:U.filter(M=>M.drawId!==u).flatMap(M=>M.drawEntries.filter(N=>N.participantId&&![bp,Ql,sg].includes(N.entryStatus)).map(({participantId:N})=>N)).filter(Boolean);C!=null&&C.length&&I.push(...C)}I=I.filter(C=>!i.includes(C)&&!g.includes(C)&&(!t||!m.includes(C)));let T=e==null?void 0:e.filter(C=>I.includes(C.participantId)).map(C=>dt(C,void 0,!0));return T==null||T.forEach(C=>{let M=(r.entries??[]).find(N=>N.participantId===C.participantId);C.entryPosition=M==null?void 0:M.entryPosition}),T==null||T.sort((C,M)=>(C.entryPosition||1/0)-(M.entryPosition||1/0)),I.length&&p.push({payload:{drawId:u,matchUpId:s,structureId:o,sideNumber:a},availableParticipantIds:I,participantsAvailable:T,method:M6,type:Ol}),!io(c)&&a&&((E=(D=c.sides)==null?void 0:D.find(C=>C.sideNumber===a))!=null&&E.participantId)&&p.push({payload:{drawId:u,matchUpId:s,structureId:o,sideNumber:a},method:RPe,type:bH}),p}function WA(t){var Y,X,Q,te,J,ie,oe,ne,re;if(!t)return{error:Pe};let{drawDefinition:e,event:i}=t,{restrictAdHocRoundParticipants:n=!0,policyDefinitions:r,enforceGender:o,participantId:a,sideNumber:s,matchUpId:l}=t,c=t.tournamentRecord??(t.tournamentId&&oa(t.tournamentId)&&((Y=t.tournamentRecords)==null?void 0:Y[t.tournamentId]));if(!c)return{error:Ge};if(!l||!oa(l))return{error:To};if(s&&![1,2].includes(s))return se({result:{error:Pe},context:{sideNumber:s}});if(!e){let me=(to({tournamentRecord:c}).matchUps??[]).find(be=>be.matchUpId===l);i=((c==null?void 0:c.events)??[]).find(be=>be.eventId===(me==null?void 0:me.eventId));let he=((i==null?void 0:i.drawDefinitions)??[]).find(be=>be.drawId===(me==null?void 0:me.drawId));he&&(e=he)}if(!e)return{error:lt};let u=zn({withIndividualParticipants:!0,tournamentRecord:c}).participants,{drawId:d}=e,{matchUp:p,structure:h}=fn({drawDefinition:e,matchUpId:l,event:i});if(!p)return{error:Ao};let f=Bi({tournamentRecord:c,drawDefinition:e,structure:h,event:i}).appliedPolicies??{};Object.assign(f,r??{});let m=(X=f==null?void 0:f[hp])==null?void 0:X.otherFlightEntries,g=(f==null?void 0:f[Zr])??b0[Zr],{enabledStructures:v}=qie({actionType:r2,appliedPolicies:f,drawDefinition:e,structure:h}),{policyActions:y}=Yie({enabledStructures:v,drawDefinition:e,structure:h}),b=t.matchUpsMap??Uo({drawDefinition:e}),I=t.inContextDrawMatchUps??Tr({tournamentParticipants:u,inContext:!0,drawDefinition:e,matchUpsMap:b,event:i}).matchUps,T=I==null?void 0:I.find(me=>me.matchUpId===l),S=s&&((Q=T==null?void 0:T.sides)==null?void 0:Q.find(me=>me.sideNumber===s)),w=((te=T==null?void 0:T.sides)==null?void 0:te.map(me=>{var he;return me.participantId||((he=me.participant)==null?void 0:he.participantid)}).filter(Boolean))??[],{assignedPositions:U,allPositionsAssigned:D}=jr({structure:h}),{structureId:E}=h??{},C=[];if(!E)return{validActions:C};let M=ss({structure:h}),N=p.collectionId;if(M&&!N){let me=xPe({restrictAdHocRoundParticipants:n,tournamentParticipants:u,matchUpParticipantIds:w,otherFlightEntries:m,drawDefinition:e,structureId:E,sideNumber:s,matchUpId:l,structure:h,matchUp:p,drawId:d,event:i});C.push(...me)}let R=Xh({drawDefinition:e,structure:h}),A=U==null?void 0:U.filter(me=>me.participantId).map(me=>me.drawPosition),_=U==null?void 0:U.filter(me=>me.bye).map(me=>me.drawPosition),k=p.matchUpStatus===Ni||!N&&((J=p.drawPositions)==null?void 0:J.reduce((me,he)=>(_==null?void 0:_.includes(he))||me,!1));if(k)return{validActions:C,isByeMatchUp:k};_a({policyActions:y,action:c2})&&C.push({type:c2,payload:{matchUpId:l}});let O=!HD({matchUpStatus:p.matchUpStatus}),F=(ie=f==null?void 0:f.scoring)==null?void 0:ie.structures,B=(h==null?void 0:h.stage)&&(F==null?void 0:F.stage)&&(F==null?void 0:F.stage[h.stage]),$=(h==null?void 0:h.stageSequence)&&(B==null?void 0:B.stageSequence)&&B.stageSequence[h.stageSequence],V=!((oe=f==null?void 0:f.scoring)!=null&&oe.requireAllPositionsAssigned||B!=null&&B.requireAllPositionsAssigned||$!=null&&$.requireAllPositionsAssigned)||D,H=p.sides&&p.sides.filter(me=>me==null?void 0:me.participantId).length===2,z=p.matchUpStatus&&[mr,Er].includes(p.matchUpStatus),G=ca({inContextDrawMatchUps:I,drawDefinition:e,matchUpId:l}),W=km({inContextDrawMatchUps:I,drawDefinition:e,targetData:G}),K=(((ne=T==null?void 0:T.drawPositions)==null?void 0:ne.length)===2&&T.drawPositions.every(me=>A==null?void 0:A.includes(me))&&((re=T==null?void 0:T.sides)==null?void 0:re.length)===2&&T.sides.every(({participantId:me})=>me)||H)&&!(z&&W),Z={method:zie,type:jv,payload:{drawId:d,matchUpId:l,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(O&&C.push({payload:{drawId:d,matchUpId:l,schedule:{}},method:s2,type:Qie}),_a({policyActions:y,action:jv})&&(S!=null&&S.participant||!s&&(w!=null&&w.length))&&C.push(Z),O&&K&&C.push({type:ene}),V&&K){let{matchUpId:me,matchUpFormat:he}=p,be={drawId:d,matchUpId:me,matchUpFormat:he,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};C.push({info:"set outcome and winningSide",method:s2,type:tne,payload:be}),_a({policyActions:y,action:u2})&&C.push({type:u2}),_a({policyActions:y,action:d2})&&C.push({type:d2})}if(N&&T){let me=APe({specifiedPolicyDefinitions:r,inContextDrawMatchUps:I,matchUpParticipantIds:w,matchUpActionsPolicy:g,inContextMatchUp:T,policyActions:y,enforceGender:o,participantId:a,sideNumber:s,matchUpId:l,matchUp:p,drawId:d,side:S});C.push(...me)}return{structureIsComplete:R,validActions:C,isDoubleExit:z,...ae}}function OPe({tournamentParticipants:t=[],sourceStructuresComplete:e,possiblyDisablingAction:i,isWinRatioFedStructure:n,activeDrawPositions:r,positionAssignments:o,drawDefinition:a,drawPosition:s,structureId:l,structure:c,drawId:u,event:d}){var v,y,b,I,T,S,w;if(r.includes(s)||n&&!e)return{};let{sourceStructureIds:p,targetStructureIds:h}=((v=a.links)==null?void 0:v.reduce((U,D)=>{var M,N;let E=(M=D.source)==null?void 0:M.structureId,C=(N=D.target)==null?void 0:N.structureId;return U.sourceStructureIds.includes(E)||U.sourceStructureIds.push(E),U.targetStructureIds.includes(C)||U.targetStructureIds.push(C),U},{sourceStructureIds:[],targetStructureIds:[]}))||{},f=[],m=((y=a.links)==null?void 0:y.filter(U=>{var D;return((D=U.target)==null?void 0:D.structureId)===c.structureId}))??[];for(let U of m){let D=(b=U==null?void 0:U.source)==null?void 0:b.structureId,{structure:E}=At({structureId:D,drawDefinition:a}),C=(E==null?void 0:E.finishingPosition)===Cy&&((p==null?void 0:p.length)!==1||(h==null?void 0:h.length)!==1),M={};if(C){let{matchUps:A}=_i({drawDefinition:a,structure:c,event:d}),{initialRoundNumber:_}=$v({drawPosition:s,matchUps:A}),k=(S=(T=(I=a.links)==null?void 0:I.find(O=>{var F;return((F=O.target)==null?void 0:F.structureId)===(c==null?void 0:c.structureId)&&O.target.roundNumber===_}))==null?void 0:T.source)==null?void 0:S.roundNumber;M.roundNumbers=[k]}let{completedMatchUps:N}=MA({structureId:D,inContext:!0,matchUpFilters:M,drawDefinition:a}),R=o.map(A=>A.participantId).filter(Boolean);(w=N==null?void 0:N.filter(({matchUpType:A,winningSide:_})=>_&&((d==null?void 0:d.eventType)!==Or||A===Or)).map(({winningSide:A,sides:_})=>A&&(_==null?void 0:_[1-(A-1)])).map(ai).filter(A=>A&&!R.includes(A)))==null||w.forEach(A=>{f.includes(A)||f.push(A)})}let g=t==null?void 0:t.filter(U=>f==null?void 0:f.includes(U.participantId));return g==null||g.forEach(U=>{let D=(a.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=D==null?void 0:D.entryPosition}),f!=null&&f.length?{validLuckyLosersAction:{type:vH,method:SPe,availableLuckyLosers:g,availableLuckyLoserParticipantIds:f,willDisableLinks:i,payload:{drawId:u,structureId:l,drawPosition:s}}}:{}}function LPe({positionSourceStructureIds:t,unassignedParticipantIds:e,possiblyDisablingAction:i,provisionalPositioning:n,tournamentParticipants:r,isWinRatioFedStructure:o,positionAssignments:a,returnParticipants:s,appliedPolicies:l,drawDefinition:c,seedingProfile:u,isByePosition:d,drawPosition:p,structureId:h,event:f}){var T,S,w;let{drawId:m}=c,g=[],v,y,b=[],I=(S=(T=l==null?void 0:l[Ml])==null?void 0:T.validSeedPositions)==null?void 0:S.ignore;if(I||({unplacedSeedParticipantIds:v,unplacedSeedAssignments:y,unfilledPositions:b}=Bte({provisionalPositioning:n,returnAllProxies:!0,randomize:!0,drawDefinition:c,seedingProfile:u,structureId:h,event:f})),b!=null&&b.length||(b=a.filter(U=>!U.participantId&&!U.bye&&!U.qualifier).map(U=>U.drawPosition)),d||g.push({payload:{drawId:m,structureId:h,drawPosition:p,isPositionAction:!0},willDisableLinks:i,method:CPe,type:BM}),o&&I){let U=a.map(N=>N.participantId).filter(Boolean),D={structureIds:t},{completedMatchUps:E}=v0({inContext:!0,matchUpFilters:D,drawDefinition:c}),C=Zt((w=(E??[]).filter(({matchUpType:N})=>(f==null?void 0:f.eventType)!==Or||N===Or))==null?void 0:w.map(({sides:N})=>N==null?void 0:N.map(ai)).flat().filter(N=>N&&!U.includes(N))),M=s?r==null?void 0:r.filter(N=>C==null?void 0:C.includes(N.participantId)).map(N=>dt(N,void 0,!0)):void 0;return M==null||M.forEach(N=>{let R=(c.entries??[]).find(A=>A.participantId===N.participantId);N.entryPosition=R==null?void 0:R.entryPosition}),M!=null&&M.length&&g.push(wt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:C6,type:Vv,availableParticipantIds:C,participantsAvailable:M})),{validAssignmentActions:g}}if(b.includes(p)||d){let U;if(y!=null&&y.length){let E=y.filter(C=>v==null?void 0:v.includes(C.participantId));E.sort(FPe),U=E.map(C=>C.participantId)}else U=e;let D=s?r==null?void 0:r.filter(E=>U.includes(E.participantId)).map(E=>dt(E,void 0,!0)):void 0;D!=null&&D.length&&g.push(wt({payload:{drawId:m,structureId:h,drawPosition:p},willDisableLinks:i,method:C6,type:Vv,availableParticipantIds:U,participantsAvailable:D}))}return{validAssignmentActions:g}}function FPe(t,e){return t.bye||YI(t.seedValue)<YI(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function BPe({drawPositionInitialRounds:t,tournamentParticipants:e,positionAssignments:i,returnParticipants:n,appliedPolicies:r,drawDefinition:o,drawPosition:a,structureId:s,drawId:l}){var T,S,w;let c=[],u=[],d=[],p=[],h=i.map(U=>U.participantId).filter(Boolean),f=r==null?void 0:r[hp],m=!(f!=null&&f.disableRoundRestrictions)&&t[a],g=f==null?void 0:f.requireCompletedStructures,{sourceStructureIds:v,relevantLinks:y}=i2({targetRoundNumber:m,linkType:vp,drawDefinition:o,structureId:s})||{};v!=null&&v.length&&p.push(...v);let{sourceStructureIds:b,relevantLinks:I}=i2({targetRoundNumber:m,linkType:gp,drawDefinition:o,structureId:s})||{};b!=null&&b.length&&p.push(...b);for(let U of y){let D=(T=o.structures)==null?void 0:T.find(C=>C.structureId===U.source.structureId);if((D==null?void 0:D.stage)!==Tt)continue;let E=Xh({structureId:U.source.structureId,drawDefinition:o});if(!g||E){let C=D.qualifyingRoundNumber,{matchUps:M}=_i({matchUpFilters:{roundNumbers:[C],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:e,inContext:!0,structure:D});for(let N of M){let R=N.sides.find(_=>(_==null?void 0:_.sideNumber)===N.winningSide),A=N.matchUpStatus===Ni&&((S=N.sides)==null?void 0:S.find(({participantId:_})=>_));if(R||A){let{participantId:_,participant:k}=R||A||{};_&&!h.includes(_)&&(k&&n&&c.push(k),u.push(_))}}}}for(let U of I){let D=(w=o.structures)==null?void 0:w.find(C=>C.structureId===U.source.structureId);if((D==null?void 0:D.stage)!==Tt)continue;let E=Xh({structureId:U.source.structureId,drawDefinition:o});if(!g||E){let{positionAssignments:C}=Yi({structure:D}),M=(C==null?void 0:C.map(N=>{var _;let R=N.participantId,A=(_=Qt({element:N,name:Wh}).extension)==null?void 0:_.value;return A?{participantId:R,groupOrder:A==null?void 0:A.groupOrder}:{}}).filter(({groupOrder:N,participantId:R})=>N===1&&!h.includes(R)).map(({participantId:N})=>N))??[];if(M&&u.push(...M),n){let N=e.filter(({participantId:R})=>M.includes(R));c.push(...N)}}}return u.length&&d.push(wt({payload:{qualifyingParticipantId:void 0,drawPosition:a,structureId:s,drawId:l},method:bPe,type:zA,qualifyingParticipantIds:u,qualifyingParticipants:n?c:void 0})),{validAssignmentActions:d,sourceStructureIds:p}}function $Pe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:o,returnParticipants:a,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};let m=E=>!t||E.participantId||E.qualifier||E.bye,g=n==null?void 0:n.filter(E=>E!==u&&!(c&&s.includes(E))),v=(o==null?void 0:o.filter(E=>m(E)&&(g==null?void 0:g.includes(E.drawPosition))))??[],y=v.map(({drawPosition:E})=>E),{matchUps:b}=_i({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),I=b.filter(({drawPositions:E})=>sa(E,y)),T=Object.assign({},...I.map(E=>{var C;return(C=E.sides)==null?void 0:C.filter(({sourceDrawPositionRange:M})=>M).map(({drawPosition:M,sourceDrawPositionRange:N})=>({[M]:N}))}).flat()),S=v.map(E=>E.participantId).filter(Boolean),w=(i??[]).filter(E=>S.includes(E.participantId)),U=Object.assign({},...w.map(E=>({[E.participantId]:E}))),D=v.map(E=>{let C=U==null?void 0:U[E.participantId],M=T[E.drawPosition];return wt({...E,participant:a?dt(C,!1,!0):void 0,sourceDrawPositionRange:M})});return D.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:TPe,type:yH,availableAssignments:D}}:{}}function wH(t){var K;let e=Ei(t,[{event:!0,drawDefinition:!0,structureId:!0}]);if(e.error)return e;let{policyDefinitions:i,returnParticipants:n=!0,provisionalPositioning:r,tournamentRecord:o,drawDefinition:a,drawPosition:s,event:l}=t,c=t.tournamentParticipants??(o&&zn({withIndividualParticipants:!0,tournamentRecord:o}).participants)??[],u=At({structureId:t.structureId,drawDefinition:a});if(u.error)return u;let d=u.containingStructure||u.structure;if(!d)return{error:Nn};let p=d.structureId;if(u=GD({drawDefinition:a,structureId:p}),s===void 0&&!u.isAdHoc)return{error:Zw};if(u.isAdHoc)return WA(t);if(u.error)return u;let{drawPositionInitialRounds:h,inactiveDrawPositions:f,activeDrawPositions:m,byeDrawPositions:g}=u,v=Bi({tournamentRecord:o,drawDefinition:a,structure:d,event:l}).appliedPolicies??{};Object.assign(v,i??{});let{actionsPolicy:y,enabledStructures:b,actionsDisabled:I}=qie({actionType:AE,appliedPolicies:v,drawDefinition:a,structure:d}),T=(y==null?void 0:y.activePositionOverrides)||[],{sourceStructureIds:S}=i2({finishingPosition:d0,targetRoundNumber:1,linkType:gp,drawDefinition:a,structureId:p})||{},w;S!=null&&S.length&&(w=S.reduce((Z,Y)=>Xh({structureId:Y,drawDefinition:a})&&Z,!0));let U=S.length,D=S.length&&!w,{policyActions:E}=Yie({enabledStructures:b,drawDefinition:a,structure:d}),C=![Tt,ut].includes(d.stage)||d.stageSequence!==1,{drawId:M}=a,N=[],{assignedPositions:R,positionAssignments:A}=jr({structure:d}),_=R==null?void 0:R.find(Z=>Z.drawPosition===s);if(!((K=A==null?void 0:A.map(Z=>Z.drawPosition))!=null&&K.includes(s)))return{error:Kw};let{stage:k,stageSequence:O}=d,F=[k];k===Io&&F.push(ut),k===ut&&F.push(Io);let B=My({entryStatuses:lg,provisionalPositioning:r,drawDefinition:a,stageSequence:O,structureId:p,stages:F}),$=fg({drawDefinition:a,stages:F}).assignedParticipantIds??[],V=B.filter(Z=>!$.includes(Z.participantId)).map(Z=>Z.participantId),H=g.includes(s),z=m.includes(s);if(I)return{hasPositionAssigned:!!_,info:"Actions Disabled for structure",isActiveDrawPosition:z,isDrawPosition:!0,validActions:[],isByePosition:H};if(_a({policyActions:E,action:Vv})&&!z&&A&&!D&&(!_||H)){let{validAssignmentActions:Z}=LPe({positionSourceStructureIds:S,unassignedParticipantIds:V,possiblyDisablingAction:C,isWinRatioFedStructure:U,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:a,isByePosition:H,drawPosition:s,structureId:p,event:l});Z==null||Z.forEach(Y=>N.push(Y))}if(_a({policyActions:E,action:zA})){let{validAssignmentActions:Z}=BPe({drawPositionInitialRounds:h,tournamentParticipants:c,positionAssignments:A,returnParticipants:n,appliedPolicies:v,drawDefinition:a,drawPosition:s,structureId:p,drawId:M});Z==null||Z.forEach(Y=>N.push(Y))}let{participantId:G}=_||{},W=G&&c.find(Z=>Z.participantId===G);if(_){_a({policyActions:E,action:n2})&&!z&&(N.push({type:n2,method:P6,payload:{drawId:M,structureId:p,drawPosition:s},willDisableLinks:C}),H||N.push({type:gH,method:IPe,payload:{drawId:M,structureId:p,drawPosition:s},willDisableLinks:C}),_a({policyActions:E,action:BM})&&!H&&N.push({type:BM,method:P6,payload:{drawId:M,structureId:p,drawPosition:s,replaceWithBye:!0},willDisableLinks:C}));let Z=d.stage===Tt||d.stage===ut&&d.stageSequence===1;if(!H&&E6({activePositionOverrides:T,activeDrawPositions:m,action:hv})&&_a({policyActions:E,action:hv})&&kM({drawDefinition:a,structureId:p,drawPosition:s})&&Z){let{seedAssignments:Y}=ol({returnAllProxies:!0,drawDefinition:a,structure:d}),{seedNumber:X,seedValue:Q}=(Y==null?void 0:Y.find(te=>te.participantId===G))??{};N.push({type:hv,method:EPe,participant:W,seedNumber:X,payload:{drawId:M,structureId:p,participantId:G,seedValue:Q}})}if(!H&&E6({activePositionOverrides:T,activeDrawPositions:m,action:eT})&&_a({policyActions:E,action:eT})&&kM({drawDefinition:a,structureId:p,drawPosition:s})&&Z){let{seedAssignments:Y}=ol({returnAllProxies:!0,drawDefinition:a,structure:d}),{seedNumber:X}=(Y==null?void 0:Y.find(Q=>Q.participantId===G))??{};N.push({method:PPe,type:eT,participant:W,seedNumber:X,payload:{participantId:G,structureId:p,drawId:M}})}if(!H&&G){if(_a({policyActions:E,action:jv})){let Y={type:jv,method:zie,participant:W,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:M}};N.push(Y)}if(_a({policyActions:E,action:KT})){let Y={type:KT,method:DPe,participant:W,payload:{participantId:G,otherName:void 0}};N.push(Y)}}if(_a({policyActions:E,action:yH})){let{validSwapAction:Y}=$Pe({possiblyDisablingAction:C,tournamentParticipants:c,inactiveDrawPositions:f,activeDrawPositions:m,positionAssignments:A,returnParticipants:n,byeDrawPositions:g,drawDefinition:a,isByePosition:H,drawPosition:s,structureId:p,structure:d,drawId:M});Y&&N.push(Y)}}if(_a({policyActions:E,action:mH})&&!D){let{validAlternatesAction:Z}=_Pe({possiblyDisablingAction:C,tournamentParticipants:c,positionAssignments:A,activeDrawPositions:m,returnParticipants:n,appliedPolicies:v,drawDefinition:a,drawPosition:s,validActions:N,structureId:p,structure:d,drawId:M,event:l});Z&&N.push(Z)}if(_a({policyActions:E,action:vH})&&!D&&A){let{validLuckyLosersAction:Z}=OPe({sourceStructuresComplete:w,possiblyDisablingAction:C,isWinRatioFedStructure:U,tournamentParticipants:c,activeDrawPositions:m,positionAssignments:A,drawDefinition:a,drawPosition:s,structureId:p,structure:d,drawId:M});Z&&N.push(Z)}if((W==null?void 0:W.participantType)===jt&&_a({policyActions:E,action:fH})){let{validModifyAssignedPairAction:Z}=MPe({tournamentParticipants:c,returnParticipants:n,drawPosition:s,participant:W,drawId:M,event:l});Z&&N.push(Z)}return{hasPositionAssigned:!!_,isActiveDrawPosition:z,isDrawPosition:!0,isByePosition:H,validActions:N,...ae}}function cP({policyDefinitions:t,appliedPolicies:e,drawType:i}){var o,a;let n=(o=t==null?void 0:t[TM])==null?void 0:o.drawTypeCoercion,r=(a=e==null?void 0:e[TM])==null?void 0:a.drawTypeCoercion;return(typeof n=="boolean"?n:void 0)??(i&&(n==null?void 0:n[i]))??(typeof r=="boolean"?r:void 0)??(i&&(r==null?void 0:r[i]))??!0}function ZT({tournamentRecord:t,drawDefinition:e,stage:i=ut,structureId:n,structure:r}){var s;if(!t)return{error:Ge};if(!r&&!e)return{error:lt};if(!r&&!n&&((s=e==null?void 0:e.structures)==null?void 0:s.filter(l=>l.stage===i).length)===1&&(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:_s};let{error:o,positionAssignments:a}=Yi({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:a??[],structureId:r==null?void 0:r.structureId,error:o}}function SH({structureId:t,drawDefinition:e}){if(!e)return{error:lt};if(!oa(t))return{error:Pe};let i=g0({drawDefinition:e,structureId:t});if(i.error)return i;let n=i.links.target.flatMap(o=>o.target.feedProfile).filter(Boolean),r=!Hn([Pm,Nl,mA,Dm],n).length;return{...ae,valid:r}}function nne({participantsCount:t,participantCount:e}){if(t=t??e,!t)return{error:Pe};let i=i0(t);return i?{drawSize:i}:se({result:{error:Pe},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function uP(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{},{requireParticipantCount:r=!0,tournamentRecord:o,drawDefinition:a,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){let f=$p({tournamentRecord:o,drawDefinition:a,event:s});if(f.error)return se({result:f,stack:l});i=f.policyDefinitions}let u=Bt(c);if(c&&!u)return se({result:{error:Pe},context:{participantsCount:c},stack:l});if(r&&!u)return se({result:{error:rQ},stack:l});if(isNaN(n))if(c)({drawSize:n}=nne({participantsCount:c}));else return se({result:{error:uD},stack:l});let d=r&&c||n;if(d&&d>n)return{error:rV};let p=i==null?void 0:i[Ml];if(!p)return{error:qJ};let h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:AJ}}function qA({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:o,participants:a,event:s}){var v;if((!a||!r)&&i&&({participants:a,participantMap:r}=zn({tournamentRecord:i})),!a)return{error:hD};if(!Array.isArray(a))return{error:Pe};if(!s)return{error:Vi};let l=(e==null?void 0:e[Zr])??(n==null?void 0:n[Zr])??b0[Zr],c=(o??((v=l==null?void 0:l.participants)==null?void 0:v.enforceGender))!==!1,{eventType:u,gender:d}=s,p=u===Zh,h=u===al&&en||p&&jt||si,f=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),m=Object.keys(f),g=a.filter(y=>m.includes(y.participantId)).filter(y=>{let b=VPe({participant:y,participantType:h,eventType:u,entryStatusMap:f}),I=jPe({genderEnforced:c,participantMap:r,eventGender:d,participant:y,isDoubles:p,mismatch:b});return b||!I});if(g.length){let y=g.map(b=>b.participantId);return{error:VJ,invalidParticipantIds:y}}return{...ae,valid:!0}}function VPe({participant:t,participantType:e,eventType:i,entryStatusMap:n}){let r=n[t.participantId],o=i&&[Zh,al].includes(i)&&t.participantType===si&&(em(r)||r===bp);return t.participantType!==e&&!o}function jPe(t){var d,p,h;let{participant:e,participantMap:i,eventGender:n,mismatch:r,isDoubles:o,genderEnforced:a}=t,s=!r&&o&&Zt(((d=e==null?void 0:e.individualParticipantIds)==null?void 0:d.map(f=>{var m,g,v;return(v=(g=(m=i==null?void 0:i[f])==null?void 0:m.participant)==null?void 0:g.person)==null?void 0:v.sex}).filter(Boolean))??[])||[],l=!n||!(s!=null&&s.length)||Tu===n||[nn,Un].includes(n)&&s[0]===n||ts===n&&(s.length==1&&((p=e.individualParticipantIds)==null?void 0:p.length)===1||s.length===2),c=(h=e==null?void 0:e.person)==null?void 0:h.sex,u=!(e!=null&&e.person)||!n||[Tu,ts].includes(n)||[nn,Un].includes(n)&&c===n;return!a||l&&u}function rne({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var m;let o="generateQualifyingSTructures",a=[],s=[],l=[],c=(g,v)=>g.stageSequence-v.stageSequence,u=(g,v)=>g.roundTarget-v.roundTarget,d=0,p=0,h,f=1;for(let g of t.sort(u)){let v=g.structureProfiles||[];f=g.roundTarget||f;let y=1,b=0,I,T,S;for(let w of(v||[]).sort(c)){let U=mV(w.drawSize||w.participantsCount),{qualifyingRoundNumber:D,structureOptions:E,matchUpFormat:C,structureName:M,structureId:N,drawType:R}=w,A=w.matchUpType,_=w.qualifyingPositions||HPe({drawSize:U,qualifyingRoundNumber:D}),k,O,F;if(!Bt(U))return se({result:{error:uD},stack:o});let B=t.length>1?`${f}-`:"",$=v.length>1||B?y:"",V=M||(B||$?`${vo(Tt)} ${B}${$}`:vo(Tt));if(R===Hl){let{structures:H,groupCount:z,maxRoundNumber:G}=YD({structureName:w.structureName||V,structureId:N||(r==null?void 0:r.pop()),stage:Tt,structureOptions:E,appliedPolicies:e,stageSequence:y,matchUpType:A,roundTarget:f,drawSize:U,idPrefix:i,isMock:n,uuids:r});b=z,k=G,O=H[0],h=[1]}else({drawSize:U,matchUps:F,roundLimit:k}=Du({qualifyingRoundNumber:D,qualifyingPositions:_,matchUpType:A,drawSize:U,idPrefix:i,isMock:n,uuids:r})),O=Ys({structureName:w.structureName||V,structureId:N||(r==null?void 0:r.pop()),qualifyingRoundNumber:k,stage:Tt,matchUpFormat:C,stageSequence:y,matchUpType:A,roundLimit:k,matchUps:F}),f&&Ui({extension:{name:xu,value:f},element:O}),b=((m=F==null?void 0:F.filter(H=>H.roundNumber===k))==null?void 0:m.length)||0;if(y>1){let{link:H}=QD({sourceStructureId:T,sourceRoundNumber:I,targetStructureId:O.structureId,finishingPositions:S===gp?[1]:void 0,linkType:S});l.push(H),d+=(U||0)-b}else d+=U||0;S=R===Hl?gp:vp,T=O.structureId,I=k,s.push(O),y+=1}p+=b,a.push({qualifiersCount:b,finalQualifyingRoundNumber:I,finalQualifyingStructureId:T,finishingPositions:h,roundTarget:f,linkType:S}),f+=1}return{qualifiersCount:p,qualifyingDrawPositionsCount:d,qualifyingDetails:a,structures:s,...ae,links:l}}function HPe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function one(t){let{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=Et(t.drawSize),r=e&&(typeof e=="boolean"||e<=2)&&n===2&&du||t.drawType||du,o=Uee.includes(r);if(n&&o){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=du;else if(n<4&&i)return{...se({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:zN},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function GPe(t){let{drawDefinition:e,structureOptions:i,requireSequential:n}=t,r={structureName:vo(ut),...t,stage:ut},{structures:o,groupCount:a,groupSize:s}=YD(r);if(a<1)return{error:SQ};let l=(i==null?void 0:i.playoffGroups)||[{finishingPositions:[1],structureName:vo($n)}],[c]=o,{structures:u,links:d}=yie({sourceStructureId:c.structureId,requireSequential:n,drawDefinition:e,playoffGroups:l,groupCount:a,groupSize:s,...t});return u&&o.push(...u),{...ae,structures:o,links:d}}function zPe({mainStructure:t,consolationStructure:e,deciderStructure:i}){let n=e.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),r=t.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),o=e.matchUps.reduce((c,u)=>!c||u.roundNumber>c?u.roundNumber:c,void 0),a=n.map((c,u)=>{let d=n.indexOf(c)%2?Nl:Pm,p=1+u;return{linkType:yd,source:{roundNumber:p,structureId:t.structureId},target:{feedProfile:d,roundNumber:c,structureId:e.structureId}}}),s={linkType:vp,source:{roundNumber:o,structureId:e.structureId},target:{feedProfile:Nl,roundNumber:r,structureId:t.structureId}},l=[{linkType:vp,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Nl,roundNumber:1,structureId:i.structureId}},{linkType:yd,source:{roundNumber:r,structureId:t.structureId},target:{feedProfile:Nl,roundNumber:1,structureId:i.structureId}}];return[...a,s,...l]}function WPe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:o}){let a=[],{matchUps:s}=Jh({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=kh({structureName:t||vo(ut),structureId:o==null?void 0:o.pop(),stageSequence:1,stage:ut,matchUpType:e,matchUps:s});a.push(l);let c=n/2,{matchUps:u}=Jh({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:o}),d=kh({structureName:vo(Tee),matchUps:u,structureId:o==null?void 0:o.pop(),stage:Io,stageSequence:2,matchUpType:e});a.push(d);let{matchUps:p}=Du({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=kh({structureName:vo(See),matchUps:p,structureId:o==null?void 0:o.pop(),stageSequence:3,stage:$n,matchUpType:e});a.push(h);let f=zPe({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:a,links:f,...ae}}function qPe(t){let{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:o,drawSize:a,isMock:s,uuids:l}=t;if(!Bt(a)||a<2)return{matchUps:[],roundsCount:0};if(kc(a))return Du(t);let c=YPe(a),u=c.shift(),d=it(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g})),p=[],h=1;({matchUps:p}=LM({roundNumber:h,matchUpType:r,idPrefix:o,matchUps:p,isMock:s,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(let g of c){let v=g.participantsCount/2,y=it(1,v+1);n&&v===n&&(f=h-1);let b=y.map(I=>{let T=Qj({roundPosition:I,roundNumber:h,idPrefix:o,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:T}});p.push(...b),h++}let m=h-1;return p=CD({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function YPe(t){let e=Et(t),i=e%2?e+1:e,n=!!(Math.ceil(i/2)%2),r=[{participantsCount:i,preFeedRound:n}];for(;i>2;){let o=Math.ceil(i/2),a=o===1,s=!!(!a&&o%2);i=!a&&s?o+1:o;let l=!!(i!==2&&Math.ceil(i/2)%2);r.push({participantsCount:i,preFeedRound:l,feedRound:s})}return r}function ane(t){var h,f;let{playoffAttributes:e,stageSequence:i=1,stage:n=ut,matchUpType:r,drawSize:o,uuids:a}=t,s=()=>!t.isMock&&!t.idPrefix?void 0:`${t.drawDefinition.drawId}-s-0`,l=t.structureId||s()||(a==null?void 0:a.pop()),c=t.appliedPolicies??Bi(t),u=((h=t.policyDefinitions)==null?void 0:h[BI])||(c==null?void 0:c[BI]);t.skipRounds=t.skipRounds||o<=4&&(u!=null&&u.feedFromMainFinal?0:1)||0;let d=t.structureName??((f=e==null?void 0:e["0"])==null?void 0:f.name)??vo(ut),p=()=>{let{matchUps:m}=Du(t);return{structures:[Ys({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...ae}};return{generators:{[jl]:()=>({structures:[Ys({finishingPosition:d0,stageSequence:i,structureName:d,matchUps:[],matchUpType:r,structureId:l,stage:n})],links:[],...ae}),[og]:()=>{let{matchUps:m}=qPe(t);return{structures:[Ys({stageSequence:i,structureName:d,matchUpType:r,structureId:l,matchUps:m,stage:n})],links:[],...ae}},[du]:()=>p(),[TD]:()=>WPe(t),[jI]:()=>gI({...t,roundOffsetLimit:3,playoffAttributes:e??ej}),[HI]:()=>gI({...t,roundOffsetLimit:2,playoffAttributes:e??tj}),[$n]:()=>gI(t),[u0]:()=>{let{matchUps:m}=Jh({drawSize:o,uuids:a,matchUpType:r});return{structures:[Ys({stageSequence:i,structureName:d,matchUpType:r,structureId:l,stage:ut,matchUps:m})],links:[],...ae}},[UD]:()=>mie(t),[GI]:()=>Hg({...t,feedRounds:1,fmlc:!0}),[wee]:()=>Hg({...t,feedRounds:1}),[XV]:()=>Hg({...t,feedsFromFinal:1}),[JV]:()=>Hg({...t,feedsFromFinal:2}),[QV]:()=>Hg({...t,feedsFromFinal:3}),[DD]:()=>Hg(t),[gA]:()=>vie(t),[Hl]:()=>YD(t),[Id]:()=>GPe(t)}}}function TH(t){var V,H,z,G,W;let{enforceMinimumDrawSize:e=!0,overwriteExisting:i,appliedPolicies:n,staggeredEntry:r,drawDefinition:o,tieFormat:a,isMock:s,uuids:l}=t||{},c=Et(t.drawSize),u=t.drawTypeCoercion??cP({appliedPolicies:n,drawType:t.drawType}),d="generateDrawStructuresAndLinks",p=one({drawType:t.drawType,enforceMinimumDrawSize:e,drawTypeCoercion:u,drawSize:c});if(p.error)return p;let h=p.drawType,f=[],m=[],g=(t==null?void 0:t.matchUpType)??kn,v=(V=o==null?void 0:o.structures)==null?void 0:V.filter(({stage:K})=>K===Tt);v&&f.push(...v);let y=v==null?void 0:v.map(({structureId:K})=>K),b=(H=o==null?void 0:o.structures)==null?void 0:H.find(({stage:K,stageSequence:Z})=>K===ut&&Z===1),I=(z=o==null?void 0:o.links)==null?void 0:z.filter(K=>K.target.structureId===(b==null?void 0:b.structureId)&&(y==null?void 0:y.includes(K.source.structureId))),T=(K,Z)=>{var Y;if(K.linkType===gp&&(Z!=null&&Z.structures)){let X=K.source.finishingPositions||[];return Z.structures.length*X.length}else if(K.linkType===vp&&((Y=Z==null?void 0:Z.matchUps)!=null&&Y.length)){let X=K.source.roundNumber;return Z.matchUps.filter(({roundNumber:Q})=>Q===X).length}},S=v==null?void 0:v.map(K=>{var J,ie,oe;let Z=I==null?void 0:I.find(ne=>ne.target.structureId===K.structureId),Y=((ie=(J=Yi({structure:K}))==null?void 0:J.positionAssignments)==null?void 0:ie.length)??0;if(!Z)return Y;let X=Z==null?void 0:Z.source.structureId,Q=(oe=o.structures)==null?void 0:oe.find(ne=>ne.structureId===X),te=T(Z,Q)||0;return Y-te}).filter(Boolean).reduce((K,Z)=>K+Z,0),w=I==null?void 0:I.map(K=>{let Z=K.source.structureId,Y=v==null?void 0:v.find(X=>X.structureId===Z);return T(K,Y)}).filter(Boolean).reduce((K,Z)=>K+Z,0),U=!!(b&&!((G=b==null?void 0:b.matchUps)!=null&&G.length));if(v!=null&&v.length&&!U)return{error:FF};let D=!(v!=null&&v.length)&&t.qualifyingProfiles,E=(D==null?void 0:D.length)&&rne({idPrefix:t.idPrefix,qualifyingProfiles:D,appliedPolicies:n,isMock:s,uuids:l});if(E!=null&&E.error)return E;let{qualifyingDrawPositionsCount:C,qualifyingDetails:M,qualifiersCount:N}=E||{qualifyingDrawPositionsCount:S,qualifiersCount:w};C&&(E!=null&&E.structures&&f.push(...E.structures),E!=null&&E.links&&m.push(...E.links)),Object.assign(t,wt({drawSize:c,matchUpType:g,tieFormat:a}));let R=h!==jl&&(!c||c<2||!r&&![u0,og].includes(h)&&([Id,Hl].includes(h)&&c<3||![Hl,Id].includes(h)&&!kc(c)));if(R&&!C)return se({context:{drawSize:c,invalidDrawSize:R},result:{error:zN},stack:d});let{generators:A,error:_}=ane(t);if(_)return{error:_};let k=A[h];if(!k)return{error:H$};let O=k==null?void 0:k();if(O.error)return O;let{structures:F,links:B}=O;if(F!=null&&F.length){let K=F.find(({stage:Z,stageSequence:Y})=>Z===ut&&Y===1);if(b&&K){if(U){let Z=K.structureId;if(K.structureId=b.structureId,B==null?void 0:B.length)for(let Y of B)Y.source.structureId===Z&&(Y.source.structureId=b.structureId),Y.target.structureId===Z&&(Y.target.structureId=b.structureId)}else if(!i)return{error:FF}}f.push(...F)}f.sort(Ey),B!=null&&B.length&&m.push(...B);let $=O.structures.find(({stage:K,stageSequence:Z})=>K===ut&&Z===1);for(let K of M||[]){let{finalQualifyingRoundNumber:Z,finalQualifyingStructureId:Y,roundTarget:X,finishingPositions:Q,linkType:te}=K,J=$&&((W=QD({targetStructureId:$.structureId,sourceStructureId:Y,sourceRoundNumber:Z,finishingPositions:Q,targetEntryRound:X,linkType:te}))==null?void 0:W.link);if(J!=null&&J.error)return J;J&&m.push(J)}return I&&m.push(...I),{...ae,qualifyingResult:{qualifyingDrawPositionsCount:C,qualifiersCount:N},structures:f,links:m}}function UH(t){var b,I;let{modifyOriginal:e=!0,stageSequence:i=1,isMock:n}=t||{},r="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return se({result:{error:lt},stack:r});let o=e?t.drawDefinition:dt(t.drawDefinition,!1,!0),{tieFormat:a,matchUpType:s}=t;if(a){let T=$a({tieFormat:a});if(T.error)return T}a=ho(a??((b=Vo({drawDefinition:o}))==null?void 0:b.tieFormat)),s=s??(o.matchUpType||kn),t.tieFormat=a,t.matchUpType=s;let l=_M({drawDefinition:o,stage:ut});t.drawSize=t.drawSize??l,!l&&t.drawSize&&OM({drawSize:t.drawSize,drawDefinition:o,stageSequence:i,stage:ut});let c=Uo({drawDefinition:o}).drawMatchUps.map(Br),u=TH(t);if(u.error)return se({result:u,stack:r});let{structures:d,links:p,qualifyingResult:h}=u;o.structures=d,o.links=p;let f=Math.max(t.qualifiersCount??0,(h==null?void 0:h.qualifiersCount)||0);if(h!=null&&h.qualifyingDrawPositionsCount&&!_M({stage:Tt,drawDefinition:o})){let T=OM({drawSize:h.qualifyingDrawPositionsCount,stage:Tt,drawDefinition:o});if(T.error)return T}if(f){let T=cie({qualifiersCount:f,drawDefinition:o,stage:ut});if(T.error)return T}let m=t.drawSize??l;Object.assign(t,wt({drawSize:m,matchUpType:s,tieFormat:a}));let{matchUps:g,matchUpsMap:v}=Tr({drawDefinition:o});a&&(g==null||g.forEach(T=>{if(!c.includes(T.matchUpId)){let{tieMatchUps:S}=tP({tieFormat:a,matchUp:T,isMock:n});Object.assign(T,{tieMatchUps:S,matchUpType:s})}}));let{inContextDrawMatchUps:y}=Am({drawDefinition:o,matchUpsMap:v});return cn({tournamentId:(I=t.tournamentRecord)==null?void 0:I.tournamentId,drawDefinition:o}),{inContextDrawMatchUps:y,drawDefinition:o,matchUpsMap:v,...ae,structures:d,matchUps:g,links:p}}function ZI(t){let{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:Rr};let{participant:o,tournamentId:a}=hg({tournamentRecords:r,tournamentRecord:e,participantId:n});return o?{...ad({participant:o,scaleAttributes:i}),tournamentId:a}:{error:Jn}}function XI(t){let{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t,o,a;if(!lne({scaleItem:r}))return{error:mD};if(n&&Array.isArray(i.participants)&&(a=i.participants.find(s=>s.participantId===n),a)){let s=cne({removePriorValues:e,participant:a,scaleItem:r});if(s.error)return s;o=!s.valueChanged;let{topics:l}=pl();l.includes(wo)&&di({topic:wo,payload:{tournamentId:i.tournamentId,participants:[a]}})}return o&&{...ae,info:pV,existingValue:r==null?void 0:r.scaleValue}||a&&{...ae,newValue:r==null?void 0:r.scaleValue}||{error:Jn}}function sne(t){var d;let{scaleItemsWithParticipantIds:e=[],removePriorValues:i,tournamentRecord:n,auditData:r,context:o}=t;if(!n)return{error:Ge};if(!n.participants)return{error:hD};let a=0,s={},l=[];for(let p of e){let h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(let f of p.scaleItems)if(lne({scaleItem:f}))Array.isArray(s[h])||(s[h]=[]),s[h].push(f);else return{error:mD}}n.participants.forEach(p=>{let{participantId:h}=p||{};Array.isArray(s[h])&&s[h].forEach(f=>{cne({participant:p,scaleItem:f,removePriorValues:i}),l.push(p),a++})});let c=a?void 0:t0,{topics:u}=pl();if(u.includes(wo)&&a&&di({topic:wo,payload:{tournamentId:n.tournamentId,participants:l}}),o){let{eventId:p,drawId:h,...f}=o,m=((d=f.scaleAttributes)==null?void 0:d.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){let g={itemType:nj,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){let{drawDefinition:v,event:y}=Ta({tournamentRecord:n,eventId:p,drawId:h});h&&Jj({drawDefinition:v,timeItem:g}),p&&By({event:y,timeItem:g})}else Fy({tournamentRecord:n,timeItem:g})}}return r&&u.includes(zI)&&di({topic:zI,payload:r}),wt({...ae,modificationsApplied:a,info:c})}function lne({scaleItem:t}){let e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function cne({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:Sy};let n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:mD};let o=new Date().toISOString();e.timeItems||(e.timeItems=[]);let{scaleItem:a}=ad({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(a==null?void 0:a.scaleValue)&&s(i.scaleValue))&&JSON.stringify(a==null?void 0:a.scaleValue)!==JSON.stringify(i.scaleValue);if(l){let{scaleType:c,eventType:u,scaleName:d}=i,p=[_v,c,u,d].join("."),h=wt({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:o,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...ae,valueChanged:l,newValue:i.scaleValue}}var sm="ELO",une="NTRP",KPe="TRN",dne="UTR",DH="WTN",pne={ELO:sm,NTRP:une,TRN:KPe,UTR:dne,WTN:DH},ZPe={[sm]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[une]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},[dne]:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[DH]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},vs=ZPe,XPe=t=>250/Math.pow(t+5,.4),JPe=()=>1;function QPe(t=3,e=2){let i=t/e;return isNaN(i)?Jb.kDefault():i}var Jb={nSpread:400,diffThreshold:.125,kCalc:XPe,kMultiplier:QPe,kDefault:JPe};function hne(t){let{winnerRating:e,loserRating:i,ratingRange:n}=t,{ratings:r=vs,winnerCountables:o=1,loserCountables:a=0,ratingType:s=sm,maxCountables:l,countables:c}=t||{},u=r==null?void 0:r[s];if(!u)return{error:gt};n=u.range||n,e=e||u.defaultInitialization,i=i||u.defaultInitialization;let d=n[0]>n[1],p=u.decimalsCount||0,h=d?n.slice().reverse():n,f=(k,O)=>parseFloat(O)>=Math.min(...k)&&parseFloat(O)<=Math.max(...k);(!f(n,e)||!f(n,i))&&(f(n,e)||(e=u.defaultInitialization),f(n,i)||(i=u.defaultInitialization));let m=({value:k,sourceRange:O,targetRange:F})=>(k-O[0])*(F[1]-F[0])/(O[1]-O[0])+F[0],g=m({targetRange:vs[sm].range,sourceRange:h,value:d?n[0]-e:e}),v=m({targetRange:vs[sm].range,sourceRange:h,value:d?n[0]-i:i}),y=(k,O)=>1/(1+Math.pow(10,(O-k)/Jb.nSpread)),b=y(g,v),I=y(v,g),T=Jb.kCalc(o),S=Jb.kCalc(a),w=Jb.kMultiplier(l,c),U=g+w*T*(1-b),D=v+w*S*(0-I),E=m({sourceRange:vs[sm].range,value:U,targetRange:h}),C=m({sourceRange:vs[sm].range,value:D,targetRange:h}),M=d?n[0]-E:E,N=parseFloat(parseFloat(M).toFixed(p)),R=d?n[0]-C:C,A=parseFloat(parseFloat(R).toFixed(p)),_=Math.max(...n)?Math.abs(e-i)/Math.max(...n):0;return(E>C&&_>Jb.diffThreshold||N<0||A<0)&&(N=e,A=i),{newWinnerRating:N,newLoserRating:A}}var eCe=t=>(t==null?void 0:t.reduce((e,i)=>(i.winningSide&&(e[i.winningSide-1]+=1),e),[0,0]))||[0,0];function fne(t){var p,h;let{removePriorValues:e=!0,tournamentRecord:i,ratingType:n=sm,considerGames:r,matchUpIds:o,asDynamic:a}=t;if(!i)return{error:Ge};if(!Array.isArray(o))return{error:kd};if(typeof n!="string")return{error:Pe,ratingType:n};if(!vs[n])return{error:Pe};let s=vs[n],{accessor:l}=s,c={},u=t.matchUps??to({matchUpFilters:{matchUpIds:o,matchUpStatuses:Nr},tournamentRecord:i,inContext:!0}).matchUps??[];u.sort(_y);for(let f of u){let{endDate:m,matchUpFormat:g,score:v,sides:y,winningSide:b}=f,I=f.matchUpType,T={eventType:I,scaleName:n,scaleType:fm},S=`${n}.${nee}`,w={scaleName:S,eventType:I,scaleType:fm},U=Object.assign({},...(y??[]).map(O=>{let{sideNumber:F,participant:B}=O;return F&&{[F]:[B==null?void 0:B.participantId,...(B==null?void 0:B.individualParticipantIds)??[]].filter(Boolean).flat()}})),D=a?S:n,E=Object.assign({},...Object.values(U).flat().map(O=>{let{scaleItem:F}=ZI({scaleAttributes:w,tournamentRecord:i,participantId:O}),{scaleItem:B}=ZI({tournamentRecord:i,scaleAttributes:T,participantId:O}),$=l?{[l]:void 0}:void 0;return O&&{[O]:F??B??{scaleName:D,eventType:I,scaleDate:m,scaleType:fm,scaleValue:$}}})),C=g?Pa(g):{},M=(C==null?void 0:C.bestOf)||1,N=(C==null?void 0:C.setsTo)||1,R=r?M&N:M,A=(v==null?void 0:v.sets)&&eCe(v.sets)||b===1&&[1,0]||[0,1],_=b?U[b]:[],k=b?U[3-b]:[];for(let O of _){let F=(p=E[O])==null?void 0:p.scaleValue,B=typeof F=="object"?F[l]:F;for(let $ of k){let V=(h=E[$])==null?void 0:h.scaleValue,H=typeof V=="object"?V[l]:V,z=b?A[b]:[0,0],G=b?A[3-b]:[0,0],{newWinnerRating:W,newLoserRating:K}=hne({winnerCountables:z,loserCountables:G,maxCountables:R,winnerRating:B,loserRating:H,ratingType:n}),Z=l?{...F,[l]:W}:W,Y=l?{...V,[l]:K}:K;E[O].scaleValue=Z,E[$].scaleValue=Y;let X=XI({participantId:O,removePriorValues:e,tournamentRecord:i,scaleItem:{...E[O],scaleName:D}});if(X.error||(X=XI({participantId:$,removePriorValues:e,tournamentRecord:i,scaleItem:{...E[$],scaleName:D}}),X.error))return X}}Object.assign(c,E)}let d=u.map(({matchUpId:f})=>f);return{...ae,modifiedScaleValues:c,processedMatchUpIds:d}}function YA(t){var g;let{matchUpIds:e=[],drawDefinition:i,roundNumber:n,newRound:r,isMock:o,event:a}=t;if(typeof i!="object")return{error:lt};let{participantIdPairings:s,matchUpsCount:l}=t,c=GA(t);if(c.error)return se({result:c});let{lastRoundNumber:u,availableMatchUpsCount:d=0,roundMatchUpsCount:p=0}=c;if(!l)r?l=p:d>0&&(l=d);else if(l>p&&t.restrictMatchUpsCount!==!1)return se({result:{error:Pe,info:"matchUpsCount error",context:{roundMatchUpsCount:p}}});if(s&&!Array.isArray(s)||l&&!Bt(l)||e&&!Array.isArray(e)||!s&&!l)return{error:Pe,info:"matchUpsCount or pairings error"};if(l&&t.restrictMatchUpsCount!==!1&&l>32)return{error:Pe,info:"matchUpsCount must be less than 33"};if(n&&!t.ignoreLastRoundNumber&&n-1>(u||0))return{error:Pe,info:"roundNumber error"};let h=n??(r&&(u??0)+1||u||1);s=s??it(0,l).map(()=>({participantIds:[void 0,void 0]}));let f=v=>{if(!t.idPrefix)return;let y=i.drawId,b=t.idPrefix??"ah";return`${y}-${b}-${h}-${v}`},m=s==null?void 0:s.map((v,y)=>{let b=(v==null?void 0:v.participantIds)??[void 0,void 0];b.push(void 0,void 0);let I=b.slice(0,2).map((S,w)=>wt({sideNumber:w+1,participantId:S})),T=e[y]??f(y)??ji();return{roundNumber:h,matchUpStatus:Gn,matchUpId:T,sides:I}});if(m!=null&&m.length){let v=(g=Vo({drawDefinition:i,event:a}))==null?void 0:g.tieFormat;v&&m.forEach(y=>{let{tieMatchUps:b}=tP({tieFormat:v,matchUp:y,isMock:o});Object.assign(y,{tieMatchUps:b,matchUpType:sn})})}return{roundNumber:h,matchUpsCount:(m==null?void 0:m.length)??0,matchUps:m,...ae}}function tCe({maxIterations:t=4e3,valueSortedPairings:e,pairingValues:i,valueObjects:n,deltaObjects:r}){let o=Object.assign({},...e.map(y=>({[y.pairing]:y.value}))),a=Object.keys(i),s=[],l=R6({actorsCount:a.length,valueSortedPairings:e,pairingValueMap:o,deltaObjects:r,valueObjects:n}),c=[NO(l)];s.push(l);let u=l.value,d=l,p=0,h=0,f=a.length,m;do f-=1,m=a.length*i[a[0]].length;while(m>t&&f>5);let g=[];a.forEach(y=>{i[y].slice(0,f).forEach(b=>{h+=1;let I=fv(y,b.opponent);if(!g.includes(I)){let T=R6({stipulated:[[y,b.opponent]],actorsCount:a.length,valueSortedPairings:e,pairingValueMap:o,deltaObjects:r,valueObjects:n});if(!c.includes(NO(T))){c.push(NO(T)),s.push(T);let{maxDelta:S,value:w}=T;S<d.maxDelta&&(d=T),(w<u||w===u&&Math.round(Math.random()))&&(u=w),g.push(I),p+=1}}}),s=s.filter(b=>Math.abs(b.value-u)<5)}),s.sort((y,b)=>y.maxDiff-b.maxDiff);let v=Qa(s);return{candidatesCount:p,deltaCandidate:d,maxIterations:t,iterations:h,candidate:v}}function NO(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function R6({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:o}){let a=[].concat(...e),s=[],l=0;e.filter(Boolean).forEach(d=>{let[p,h]=d,f=fv(p,h),m=i[f];s.push({participantIds:d,value:m}),l+=i[f]}),Qr(t,o).map(d=>Jo(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{let p=d.pairing.split("|");if(!p.reduce((h,f)=>a.includes(f)||h,!1)){a.push(...p);let h=d.value;l+=h,s.push({participantIds:p,value:h})}}),s.sort((d,p)=>d.value-p.value);let c=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=fv(h,f),g=n[m];return g>d?g:d},0),u=s.reduce((d,p)=>{let[h,f]=p.participantIds,m=fv(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function fv(t,e){return[t,e].sort(RA).join("|")}function mne({participantIds:t}){let e={},i=[];t.forEach(r=>{e[r]=t.filter(o=>o!==r),e[r].forEach(o=>{let a=fv(o,r);i.includes(a)||i.push(a)})});let n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}function iCe({matchUps:t}){let e=[];for(let i of t){let n=i.sides.map(ai);if(n.length===2){let[r,o]=n,a=fv(r,o);e.includes(a)||e.push(a)}}return{encounters:e}}function nCe({possiblePairings:t,valueObjects:e}){let i={};for(let r of Object.keys(t)){let o=t[r].map(a=>n(r,a));i[r]=o.sort((a,s)=>a.value-s.value)}function n(r,o){let a=fv(r,o);return{opponent:o,value:e[a]}}return{pairingValues:i}}var rCe=0;function oCe({tournamentParticipants:t,adHocRatings:e,eventType:i,scaleName:n,pairing:r}){var a;let o=((a=vs[n])==null?void 0:a.defaultInitialization)??rCe;return r.split("|").map(s=>{var l;if(i===Gl){let c=(l=t==null?void 0:t.find(u=>u.participantId===s))==null?void 0:l.individualParticipantIds;return c?c==null?void 0:c.map(u=>e[u]||o):o*2}else return e[s]||o})}function aCe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:o,valueObjects:a,eventType:s,scaleName:l,salted:c}){n.forEach(v=>{let y=oCe({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),b=typeof c=="number"&&c||.5,I=c&&(Math.round(Math.random())?b:b*-1)||0,T=Math.abs(y[0]-y[1])+I,S=Math.abs(y[0]-y[1]);o[v]=S,a[v]||(a[v]=0),a[v]+=T?Math.pow(T,2):0});let u=n.map(v=>({pairing:v,value:a[v]})).sort((v,y)=>v.value-y.value),{pairingValues:d}=nCe({possiblePairings:i,valueObjects:a}),{candidate:p,candidatesCount:h,deltaCandidate:f,iterations:m}=tCe({valueSortedPairings:u,maxIterations:r,pairingValues:d,deltaObjects:o,valueObjects:a}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:h,deltaCandidate:f,iterations:m,candidate:p}}var sCe=100,lCe=100,cCe=4e3;function PH({encounterValue:t=sCe,sameTeamValue:e=lCe,maxIterations:i=cCe,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:o,tournamentRecord:a,dynamicRatings:s,participantIds:l,drawDefinition:c,adHocRatings:u,salted:d=.5,roundNumber:p,structureId:h,matchUpIds:f,eventType:m,structure:g,scaleName:v,idPrefix:y,isMock:b,event:I}){var $,V;if(!c)return{error:lt};if(!g&&!h)return{error:Nn};if(g||(g=At({drawDefinition:c,structureId:h}).structure),!ln(g))return{error:vf};if(!(l!=null&&l.length))return{error:yf};let T=[...o??[],...(g==null?void 0:g.matchUps)??[]],{encounters:S}=iCe({matchUps:T}),w=(a==null?void 0:a.participants)??[];if(s){let H=Zt(g!=null&&g.matchUps?g.matchUps.map(({roundNumber:G})=>G):[]),z=Math.max(...H,0);if(z){let G=($=g==null?void 0:g.matchUps)==null?void 0:$.filter(({roundNumber:W})=>W===z).map(({matchUpId:W})=>W);fne({ratingType:v||((V=I==null?void 0:I.category)==null?void 0:V.ratingType),tournamentRecord:a,asDynamic:!0,matchUpIds:G})}}let{valueObjects:U}=uCe({tournamentParticipants:w,encounterValue:t,sameTeamValue:e,encounters:S}),{uniquePairings:D,possiblePairings:E,deltaObjects:C}=mne({participantIds:l}),M={tournamentParticipants:w,possiblePairings:E,drawDefinition:c,participantIds:l,uniquePairings:D,maxIterations:i,adHocRatings:u,deltaObjects:C,valueObjects:U,eventType:m,scaleName:v,structure:g,salted:d},{candidatesCount:N,participantIdPairings:R,iterations:A,candidate:_}=aCe(M);if(!N)return{error:JN};let k,O;if(n){let H=YA({structureId:g==null?void 0:g.structureId,ignoreLastRoundNumber:r,participantIdPairings:R,newRound:!0,drawDefinition:c,roundNumber:p,matchUpIds:f,idPrefix:y,isMock:b,event:I});if(H.error)return H;k=H.roundNumber,O=H.matchUps}let{maxDelta:F,maxDiff:B}=_;return{roundNumber:k,participantIdPairings:R,candidatesCount:N,...ae,iterations:A,matchUps:O,maxDelta:F,maxDiff:B}}function uCe({encounters:t,tournamentParticipants:e,encounterValue:i,sameTeamValue:n}){let r={};for(let a of t)r[a]||(r[a]=0),r[a]+=i;let o=e==null?void 0:e.filter(({participantType:a})=>a===en);if(o)for(let a of o){let s=a.individualParticipantIds??[],{uniquePairings:l}=mne({participantIds:s});for(let c of l)r[c]||(r[c]=0),r[c]+=n}return{valueObjects:r}}function gne(t){var C,M,N,R;let{drawType:e=du,attachConsolation:i=!0,applyPositioning:n=!0,tournamentRecord:r,staggeredEntry:o,automated:a,placeByes:s,isMock:l,event:c}=t,u=t==null?void 0:t.drawDefinition;if(!u)return{error:lt};let d=Xr,p=My({stageSequence:1,drawDefinition:u,stage:d}),h=[Hl,TD,Id].includes(e)?p.length:i0(p.length);if(!o&&e===u0&&p.length<2||e===Hl&&p.length<3)return{error:zN};let{tieFormat:f,matchUpType:m}=t;if(f){let A=$a({tieFormat:f});if(A.error)return A}f=ho(f??((C=Vo({drawDefinition:u}))==null?void 0:C.tieFormat)),m=m??u.matchUpType??kn;let{structures:g}=wd({stageSequence:1,drawDefinition:u,stage:d});if(g.length>1)return{error:jJ};if((N=(M=g==null?void 0:g[0])==null?void 0:M.matchUps)!=null&&N.length)return{error:fV};let v=(R=g==null?void 0:g[0])==null?void 0:R.structureId;Object.assign(t,wt({structureName:t.structureName??vo(Xr),structureId:v,matchUpType:m,tieFormat:f,drawSize:h,stage:d}));let y=ane(t);if(y.error)return y;let b=y.generators[e];if(!b)return{error:H$};let I=b==null?void 0:b();if(I.error)return I;let{structures:T,links:S}=I,w=T.map(A=>_i({structure:A}).matchUps).flat();f&&w.forEach(A=>{let{tieMatchUps:_}=tP({matchUp:A,tieFormat:f,isMock:l});Object.assign(A,{tieMatchUps:_,matchUpType:m})}),(!n||!i)&&(u=dt(u,!1,!0)),u.links||(u.links=[]),S.length&&u.links.push(...S);let U=T.map(({structureId:A})=>A);u.structures||(u.structures=[]);let D=u.structures.map(({structureId:A})=>A);u.structures=u.structures.map(A=>U.includes(A.structureId)?T.find(({structureId:_})=>_===A.structureId):A);let E=T.filter(({structureId:A})=>!D.includes(A));return E.length&&u.structures.push(...E),a&&XD({seedingProfile:t.seedingProfile,applyPositioning:n,tournamentRecord:r,drawDefinition:u,structureId:v,placeByes:s,drawSize:h,event:c}),i&&cn({drawDefinition:u}),{links:S,structures:T,...ae}}var mv={};ii(mv,{addGame:()=>Une,addPoint:()=>Tne,addSet:()=>Pne,addShot:()=>Dne,analyzeSet:()=>JT,calculateHistoryScore:()=>Ine,checkScoreHasValue:()=>io,checkSetIsComplete:()=>XA,clearHistory:()=>Sne,generate:()=>vne,generateScoreString:()=>ld,generateTieMatchUpScore:()=>aP,getSetComplement:()=>kH,getTiebreakComplement:()=>t_,helpers:()=>Rne,isValidMatchUpFormat:()=>ls,keyValueScore:()=>tre,mutate:()=>bne,parseMatchUpFormat:()=>Pa,parseScoreString:()=>HM,query:()=>are,redo:()=>Cne,reverseScore:()=>yne,setServingSide:()=>wne,stringifyMatchUpFormat:()=>BA,tidyScore:()=>ore,umo:()=>Mne,undo:()=>Ene,validateScore:()=>_H,validateTieFormat:()=>$a});var vne={};ii(vne,{generateScoreString:()=>ld,generateTieMatchUpScore:()=>aP,reverseScore:()=>yne});function ld(t){let{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:o,autoComplete:a,winningSide:s,sets:l}=t;if(!l)return{error:gt,info:"missing sets"};let c=o&&Pa(o),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},h=n||!(!e||!s||s===1),f=i?dCe({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(pCe).map(g).filter(Boolean).join(" "))||"";if(!f)return m;if(s===2)return`${f} ${m}`;return`${m} ${f}`;function g(v){let y=u&&v.setNumber===u&&d?d:p,b=k=>Bn(k==null?void 0:k.side1Score)||Bn(k==null?void 0:k.side2Score),I=k=>Bn(k==null?void 0:k.side1TiebreakScore)||Bn(k==null?void 0:k.side2TiebreakScore),T=(y==null?void 0:y.tiebreakSet)||!b(v)&&I(v),{side1Score:S,side2Score:w,side1TiebreakScore:U,side2TiebreakScore:D}=v,E=U||(Bn(U)||a?0:""),C=D||(Bn(D)||a?0:"");if(T)return`[${(h?[C,E]:[E,C]).join("-")}]`;let M=Math.min(E,C),N=M?`(${M})`:"",R=S||(Bn(S)||a?0:""),A=w||(Bn(w)||a?0:""),_=h?`${[A,R].join("-")}${N}`:`${[R,A].join("-")}${N}`;return["-"," "].includes(_)&&(_=""),_}}function dCe({matchUpStatus:t}){let e={[Go]:"RET",[Oi]:"WO",[Er]:"DF/DF",[mr]:"WO/WO",[Df]:"SUS",[Us]:"ABN",[Pi]:"DEF",[c0]:"DR"};return t&&e[t]||""}function pCe(t,e){return t.setNumber-e.setNumber}function yne(t){if(!(t!=null&&t.score))return{error:gt};let{sets:e}=t.score,i=e.map(o=>{let{side1TiebreakScore:a,side2TiebreakScore:s,winningSide:l,side1Score:c,side2Score:u,setNumber:d}=o;return wt({winningSide:l?3-l:void 0,side1TiebreakScore:s,side2TiebreakScore:a,side1Score:u,side2Score:c,setNumber:d})}),n=ld({sets:i}),r=ld({sets:i,reversed:!0});return{reversedScore:{sets:i,scoreStringSide1:n,scoreStringSide2:r},...ae}}var bne={};ii(bne,{addGame:()=>Une,addPoint:()=>Tne,addSet:()=>Pne,addShot:()=>Dne,calculateHistoryScore:()=>Ine,clearHistory:()=>Sne,redo:()=>Cne,setServingSide:()=>wne,umo:()=>Mne,undo:()=>Ene});function mg({matchUp:t}){let{extension:e}=Qt({name:dA,element:t});if(!e)return{error:_o};let{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...ae}}function Ine(t){var E,C;if(!t)return{error:gt};let{matchUp:e,updateScore:i}=t;if(!e)return{error:Ba};let n=((E=mg({matchUp:e}))==null?void 0:E.history)||[];if(!Array.isArray(n))return{error:Pe,info:"history is not an array"};let{matchUpFormat:r}=e;if(!r)return{error:X$};if(!ls({matchUpFormat:r}))return{error:Z$};let o=Pa(r),{bestOf:a,finalSetFormat:s,setFormat:l}=o,c=["0","15","30","40","A","G"],u={sets:[]},d=[],p,h=[0,0],f=1,m=0,g,v=0,y=M=>[1,2].includes(M),b=()=>(m+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:m,games:[]}),I=()=>({winningSide:void 0,points:[]}),T=()=>({winningSide:void 0,side1Score:"",side2Score:"",shots:[]}),S=T(),w=I(),U=b(),D=0;for(let M of n){D+=1,g=u.sets.length+1===a;let N=g&&s?s:l,{tiebreakAt:R,setTo:A,NoAD:_,tiebbreakFormat:k}=N,O=U.side1Score===R&&U.side1Score===U.side2Score,F=!!N.tiebreakSet,B=F?N.tiebreakSet:k,{tiebreakTo:$,NoAD:V}=B||{},H=()=>{p=void 0,h=[0,0],f=3-f,U.side1TiebreakScore=0,U.side2TiebreakScore=0,U.side1PointScore="",U.side2PointScore="",v=0},z=K=>{U.winningSide=K;let{s:Z,...Y}=U;u.sets.push(Y),S=T(),w=I(),U=b(),H()},G=K=>{w.winningSide=K;let{g:Z,...Y}=w;U.games.push(Y),S=T(),w=I(),H();let X=`side${K}Score`;U[X]+=1},W=K=>{S.winningSide=K;let{p:Z,...Y}=S;w.points.push(Y),S=T(),v=0;let X=()=>h.reduce((te,J)=>te+J)%4/4>.5?f:3-f,Q=K-1;if(O||F){h[Q]+=1,p=X(),U[`side${K}TiebreakScore`]=h[Q],U[`side${3-K}TiebreakScore`]=h[1-Q];let te=V?1:2;if(h[Q]>=$&&h[Q]>=h[1-Q]+te)return G(K),{gameCompleted:!0}}else if(h[1-Q]===4&&h[Q]===3?h[1-Q]-=1:h[Q]+=1,U.side1PointScore=c[h[0]],U.side2PointScore=c[h[1]],h[Q]===5||h[Q]===4&&h[1-Q]<3||_&&h[Q]===4)return G(K),{gameCompleted:!0}};if(y(M.srv)&&(f=M.srv),["p","s","g","o"].includes(M.u)&&d.push(M.u),M.shotOutcome&&(S.shots.push(M),M.shotType==="SERVE"&&["OUT","NET"].includes(M.shotOutcome)&&(v+=1),v===2)){let K=3-f;W(K)}if(y(M.p)||Bt(M.pointNumber)){let K=M.winningSide||M.p;if((C=W(K))!=null&&C.gameCompleted)continue}if(y(M.g)||Bt(M.gameNumber)){let K=M.winningSide||M.g;w.winningSide=K;let Z=`side${K}Score`,Y=`side${3-K}Score`;if(d.length&&(d.includes("p"),d=[]),G(K),U[Z]===A&&U[Z]-U[Y]>=(_?1:2)&&(z(K),g))break}if(y(M.s)||Bt(M.setNumber)){let K=M.winningSide||M.s;if(z(K),d.length&&(d.includes("p"),d.includes("g"),d=[]),g)break}}return D!==n.length&&console.log({error:"Match completed with excess history"}),(U.side1Score||U.side2Score||U.games.length||U.side1TiebreakScore||U.side2TiebreakScore)&&u.sets.push(U),u.scoreStringSide1=ld({...u,matchUpFormat:r}),u.scoreStringSide2=ld({...u,matchUpFormat:r,reversed:!0}),f=p||f,i&&(e.score=u),{...ae,servingSide:f,score:u}}function gg({undoHistory:t,history:e,matchUp:i}){return Ui({element:i,extension:{value:{history:e,undoHistory:t},name:dA}})}function wne({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:tV};let{history:i=[]}=mg({matchUp:t});return i.push({srv:e}),gg({matchUp:t,history:i})}function Sne({matchUp:t}){return gg({matchUp:t})}function Tne({matchUp:t,point:e}){if(!e||!t)return{error:gt};if(typeof e!="object")return{error:Pe,context:{point:e}};let{history:i=[]}=mg({matchUp:t});return i.push(e),gg({matchUp:t,history:i})}function Une({matchUp:t,game:e}){if(typeof e!="object")return{error:Pe,context:{game:e}};let{history:i=[]}=mg({matchUp:t});return i.push(e),gg({matchUp:t,history:i})}function Dne({matchUp:t,shot:e}){if(typeof e!="object")return{error:gt};let{history:i=[]}=mg({matchUp:t});return i.push(e),gg({matchUp:t,history:i})}function Pne({matchUp:t,set:e}){if(typeof e!="object")return{error:gt};let{history:i=[]}=mg({matchUp:t});return i.push(e),gg({matchUp:t,history:i})}function Cne({matchUp:t}){let{history:e=[],undoHistory:i=[]}=mg({matchUp:t});return i.length&&e.push(i.pop()),gg({matchUp:t,history:e,undoHistory:i})}function Ene({matchUp:t}){let{history:e=[],undoHistory:i=[]}=mg({matchUp:t});return i.push(e.pop()),gg({matchUp:t,history:e,undoHistory:i})}var Mne={},Rne={};ii(Rne,{keyValueScore:()=>tre,parseMatchUpFormat:()=>Pa,stringifyMatchUpFormat:()=>BA,tidyScore:()=>ore});var gv=" ",p2="DEF",hCe="COMPLETED",Nne="WO",fCe="WO/WO",Ane="ABN",_ne="SUS",kne="RET",xne="INT",One=[kne,p2,Nne,fCe,Ane,_ne,xne],h2="DEFAULTED",Lne="WALKOVER",Fne="ABANDONED",Bne="SUSPENDED",$ne="RETIRED",Vne="INTERRUPTED",mCe=[$ne,h2,Lne],gCe="Enter Score",Hv="()",xm="[]",CH=["up","left","shift+tab"],EH=["enter","down","tab","right"],$M="backspace",jne="r",Hne="s",Gne="a",zne="d",Wne="w",qne="i",KA=[jne,zne,Wne,Gne,Hne,qne],ZA="space",AO=["[","("],VM=[...CH,...EH,ZA,"]"],Yne="-",vCe="/",vv=Yne,cd=Yne,Kne=[vCe],yCe=0,bCe=["=","+","num_1","num_2","shift+=","shift+-"],Yu=["0","1","2","3","4","5","6","7","8","9"].concat(KA),Zne=Yu.map(t=>`shift+${t}`),MH=[vv,$M].concat(VM,Kne),Xne=[Yu,Zne,MH].join(","),ICe=[Xne,CH,EH,bCe].join(",");[].concat(...Yu,...Yu,...MH,...Yu,...Yu,...Yu,...Yu,...Yu,...Yu);var RH={OUTCOMEKEYS:KA,SIDE1KEYS:Yu,SIDE2KEYS:Zne,MODIFIERS:MH,PROMPT:gCe,MOVEUP:CH,MOVEDOWN:EH,HOTKEYS:ICe};function Ab({scoreString:t,lowSide:e,outcome:i}){if({scoreString:t}=Jne({scoreString:t}),e===2){let n=(t&&t[t.length-1])!==gv?gv:"";return t+n+i}else return i+gv+t}function Jne({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(let i of One){let n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+gv:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function f2({analysis:t,scoreString:e,sets:i,lowSide:n}){var m,g,v;let r,o;if(!e)return{scoreString:e,sets:i};let{scoreString:a,removed:s}=Jne({scoreString:e});if(e=a,s)return{scoreString:e,sets:i,outcomeRemoved:!0};let l=i[i.length-1]||{},c=Object.values(l).filter(y=>y!==void 0).length;l.setNumber&&c===1&&(i=i.slice(0,i.length-1),l=i[i.length-1]||{});let{tiebreakSet:u}=t.setFormat,{tiebreakTo:d,NoAD:p}=u||{},{isTiebreakEntry:h}=vI({brackets:xm,scoreString:e}),f=SCe(e);if(f>=0){r=e.slice(0,f);let{isTiebreakEntry:y}=vI({brackets:Hv,scoreString:r}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=vI({brackets:xm,scoreString:r}),T=r&&r[r.length-1].trim(),S=r&&!isNaN(T),w=t.isIncompleteSetScore;if(h&&I){let U=r.slice(b+1).split(cd),D=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,C=[D,E];if(E){let M=n===1?1:0;C[M]=((C==null?void 0:C[1-M])||0)+(p?1:2),(C[M]||0)<d&&(C[M]=d),r=e.slice(0,b+1),r+=C.join(cd)}else D!==void 0?(r=e.slice(0,b+1),r+=D):(r=e.slice(0,b),w=!0);l.side1TiebreakScore=C[0]||0,l.side2TiebreakScore=C[1]||0}if(r.length||(r=void 0),w){let U=(m=l.side1Score)==null?void 0:m.toString();if(U){let D=U==null?void 0:U.slice(0,U.length-1);l.side1Score=!isNaN(D)&&parseInt(D)||void 0,l.side1Score===void 0&&(l.side2Score=void 0)}t.isTimedSet?(o=l.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],o[i.length-1]=l):o=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(S){let U=(g=l.side2Score)==null?void 0:g.toString(),D=(v=l.side1Score)==null?void 0:v.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(l.side2Score){let E=U==null?void 0:U.slice(0,U.length-1);l.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{let E=D==null?void 0:D.slice(0,D.length-1);l.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?l.side1Score?(o=i||[],o[i.length-1]=l):o=(i==null?void 0:i.slice(0,i.length-1))||[]:(o=i||[],o[i.length-1]=l),o[o.length-1]&&Object.assign(o[o.length-1],{winningSide:void 0})}else y?(o=i||[],Object.assign(o[o.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(h&&!I?o=(i==null?void 0:i.slice(0,i.length-1))||[]:(o=i,o[i.length-1]=l),h||(o[o.length-1].side2Score=0,o[o.length-1].winningSide=void 0));return{scoreString:r,sets:o}}return{scoreString:e,sets:i}}function vI({brackets:t=Hv,scoreString:e}){if(!e)return{};let[i,n]=t.split(""),r=e.split(""),o=Math.max(...uu(i,r)),a=Math.max(...uu(n,r));return{isTiebreakEntry:o>a,lastOpenBracketIndex:o}}function wCe({scoreString:t}){if(!t)return!1;let e=t&&t[t.length-1].trim(),i=t&&!isNaN(e),[n,r]=xm.split(""),o=t.split(""),a=Math.max(...uu(n,o)),s=Math.max(...uu(r,o)),l=Math.max(...uu(cd,o));return i&&a>s&&l>a}function SCe(t){return t.split("").reduce((e,i,n)=>(i.match(/\d+/g)&&e.push(n),e),[]).pop()}function Qne(t){let{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{},r=i?1:2;return e+1>=n?e+r:parseInt(n)}function N6({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){var l;let r=Pa(t),{bestOf:o}=r,a=Math.ceil(o/2),s=((l=n==null?void 0:n.reduce((c,u)=>{let{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]))==null?void 0:l.indexOf(a))+1||void 0;return mCe.includes(e)&&i&&(s=i),{matchUpWinningSide:s}}function XA({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:o}){var y;if(!o)return{error:gt,info:"missing set"};e=e||i&&Pa(i);let a=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:s,side2Score:l}=o,{setTo:c,tiebreakAt:u}=a,d=JA({set:o}),p=Math.abs(s-l),h=s>=c||l>=c,f=n||s>=c&&l>=c||u&&u<c&&(s===u||l===u),m=t||f&&(d===1&&o.side1TiebreakScore>o.side2TiebreakScore||d===2&&o.side2TiebreakScore>o.side1TiebreakScore),g=!f&&a.NoAD||f||n&&((y=a.tiebreakFormat)!=null&&y.NoAD)?1:2,v=p>=g;return!!((h&&(v||f)||n)&&(!f||m))}function JA({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function NH({analysis:t,set:e}){let i=JA({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:o}=t;return XA({matchUpScoringFormat:o,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function TCe({analysis:t,scoreString:e,sets:i,value:n}){let r;if(!(i!=null&&i.length))return{sets:[]};let o=i[i.length-1];n=Et(n);let{validSide2Score:a,requiresTiebreak:s}=UCe({analysis:t,set:o,value:n});if(a){r=!0,e=(e||"")+n,o.side2Score=n;let l=NH({analysis:t,set:i[i.length-1]});if(o.winningSide=l||void 0,s){let c=Hv.split("")[0];e+=c}else t.isDecidingSet||(e+=gv)}return{sets:i,scoreString:e,updated:r}}function UCe({analysis:t,set:e={},value:i}){let n=t.isDecidingSet&&t.matchUpScoringFormat.finalSetFormat||t.matchUpScoringFormat.setFormat,{tiebreakAt:r,setTo:o,NoAD:a}=n,{side1Score:s}=e,l,c;return r&&r<o?s===r?l=i<=o:l=i<=r:s===o?a?l=i<o:l=i<=o+1:s===o-1?a?l=i<=o:l=i<=o+1:s===o+1?l=i===o||i===o-1:l=i<=o,l&&(r&&r<o?c=s===o&&i===r||s===r&&i===o:c=s>=o&&i>=o&&s!==i),{validSide2Score:l,requiresTiebreak:c}}function ere({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:o}){let a;return e===jne?n?(a=!0,n=Ab({scoreString:n,lowSide:t,outcome:kne}),r=t===2?1:2,o=$ne):(a=!0,n=Ab({scoreString:n,lowSide:t,outcome:p2}),r=t===2?1:2,o=h2):e===zne?(a=!0,n=Ab({scoreString:n,lowSide:t,outcome:p2}),r=t===2?1:2,o=h2):e===Wne?(a=!0,i=[],n=Nne,r=t===2?1:2,o=Lne):e===Hne&&n?(a=!0,n=Ab({scoreString:n,lowSide:t,outcome:_ne}),o=Bne,r=void 0):e===Gne?(a=!0,n=Ab({scoreString:n,lowSide:t,outcome:Ane}),o=Fne,r=void 0):e===qne&&n&&(a=!0,n=Ab({scoreString:n,lowSide:t,outcome:xne}),o=Vne,r=void 0),{updated:a,sets:i,scoreString:n,matchUpStatus:o,winningSide:r}}function DCe(t){let{sets:e,info:i,scoreString:n,winningSide:r,matchUpStatus:o}=t,{analysis:a,lowSide:s,value:l}=t,c,u;!(e!=null&&e.length)&&l!==$M&&(e=[{setNumber:1}]);let d=e.length-1;if(KA.includes(l)){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;h&&!f?i="missing side2Score":a.finalSetIsComplete||r?i="final set is already complete":a.isIncompleteSetScore?i="incomplete set scoreString":a.isIncompleteSetScore||({sets:e,scoreString:n,winningSide:r,matchUpStatus:o,updated:c}=ere({lowSide:s,value:l,sets:e,scoreString:n,matchUpStatus:o,winningSide:r}))}else if(l===$M){if({scoreString:n,sets:e,outcomeRemoved:u}=f2({analysis:a,scoreString:n,sets:e}),(n==null?void 0:n.trim())===""&&(n=n.trim()),n||(e=[]),u){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p;if(h&&f){let m=h>f&&1||f>h&&2||void 0;m&&(p.winningSide=m,e.push({setNumber:e.length+1}))}}o=void 0,r=void 0,c=!0}else if(a.hasOutcome)i="has outcome";else{if(r)return{sets:e,scoreString:n,winningSide:r,matchUpStatus:o,updated:!1,info:"matchUp is complete"};if(l===ZA){let p=e[e.length-1]||{},{side1Score:h,side2Score:f}=p,m=h>f&&1||f>h&&2||void 0;m&&!r&&!a.isIncompleteSetScore&&(e[e.length-1].winningSide=m,e.push({setNumber:e.length+1}),n+=" ",c=!0)}else if(l===vv&&e[d].side1Score!==void 0&&e[d].side2Score===void 0&&n&&a.isNumericEnding)n+="-",e[d].side2Score=0,o=void 0,r=void 0,c=!0;else if(!isNaN(l)){let p;if(e[d].side2Score===void 0){let h=Et((e[d].side1Score||0).toString()+l).toString().slice(0,2);e[d].side1Score=Et(h),p=e[d].side1Score.toString(),c=!0}else{let h=Et((e[d].side2Score||0).toString()+l).toString().slice(0,2);e[d].side2Score=Et(h),p=[e[d].side1Score,e[d].side2Score].join("-"),c=!0}if(c){let h=(e.slice(0,d)||[]).filter(f=>f).map(f=>{let{side1Score:m,side2Score:g}=f;return[m,g].join("-")}).join(" ");h?n=h+" "+p:n=p}}}return{sets:e,scoreString:n,winningSide:r,matchUpStatus:o,info:i,updated:c}}function PCe({analysis:t,auto:e,lowSide:i,scoreString:n="",sets:r,value:o}){var d;let a,s,{tiebreakSet:{tiebreakTo:l,NoAD:c}}=t.setFormat,[u]=xm.split("");if(t.isMatchTiebreakEntry||(n+=u),r[t.setNumber-1]){let{lastOpenBracketIndex:p}=vI({brackets:xm,scoreString:n}),h=(n.slice((p??0)+1)+(e?"":o)).split(cd);if((((d=h[i-1])==null?void 0:d.length)||0)>=2)s="tiebreak digit limit";else if(e){i===1&&(h[0]=(h[0]||"")+o),i===2&&(h[1]=(h[1]||"")+o);let f=[h[0]||0,h[1]||0].map(v=>Et(v)),m=i===1?1:0;f[m]=f[1-m]+(c?1:2),f[m]<l&&(f[m]=l);let g=r[r.length-1];g.side1TiebreakScore=f[0],g.side2TiebreakScore=f[1],n=n.slice(0,(p??0)+1),n+=f.join(cd),a=!0}else{let f=[h[0]||0,h[1]||0].map(g=>Et(g)),m=r[r.length-1];m.side1TiebreakScore=f[0],m.side2TiebreakScore=f[1],n+=o,a=!0}}else{let p=Qne({lowValue:Et(o||0),tiebreakTo:l,NoAD:c}),h=[Et(o),p];i===2&&h.reverse();let f={side1TiebreakScore:h[0],side2TiebreakScore:h[1],setNumber:(r==null?void 0:r.length)+1||1};r.push(f),n+=h.join(cd),a=!0}return{info:s,scoreString:n,sets:r,updated:a}}function CCe({analysis:t,lowSide:e,scoreString:i,value:n}){let{setTo:r,tiebreakAt:o,NoAD:a}=(t==null?void 0:t.setFormat)||{},s=n===parseInt(o||r);if(o&&o<r&&n>o)return{scoreString:i};if(a&&n===r||n>r)return{scoreString:i};let l=f(),c=[n,l];e===2&&c.reverse();let u=Hv.split("")[0],d=c.join(vv)+(s?u:gv);i=(i||"")+d;let p={side1Score:c[0],side2Score:c[1]},h=NH({analysis:t,set:p});return p.winningSide=h||void 0,{scoreString:i,set:p};function f(){return s?n+1:n+1===r?n+(a?1:2):r}}function ECe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var F,B,$;let o=(((F=r==null?void 0:r.filter(V=>V==null?void 0:V.winningSide))==null?void 0:F.length)||0)+(i?0:1),a=Pa(t),s=o===(a==null?void 0:a.bestOf),l=s&&(a==null?void 0:a.finalSetFormat)||(a==null?void 0:a.setFormat)||{},c=l==null?void 0:l.timed,u=s&&r[(a==null?void 0:a.bestOf)-1],d=u==null?void 0:u.winningSide,{isTiebreakEntry:p}=vI({brackets:Hv,scoreString:e}),{isTiebreakEntry:h}=vI({brackets:xm,scoreString:e}),f=p||h,m=!!l.tiebreakSet,g=(B=e==null?void 0:e[e.length-1])==null?void 0:B.trim(),v=e&&!isNaN(g),y=!f&&g===vv,b=p&&AO.includes(g),I=h&&AO.includes(g),T=h&&g===cd,S=e==null?void 0:e.split(""),[w]=xm.split(""),U=S&&Math.max(...uu(w,S)),D=S&&Math.max(...uu(cd,S)),E=S&&D>U,C=($=r[r.length-1])==null?void 0:$.winningSide,M=(r==null?void 0:r.length)&&!C,N=One.find(V=>(e==null?void 0:e.indexOf(V))>=0),R=!isNaN(n),A=n===ZA,_=VM.includes(n),k=e==null?void 0:e.split("").find(V=>AO.includes(V)),O=_&&h&&!I&&(T||!wCe({scoreString:e}));return{isTiebreakSetValue:m&&R,matchUpScoringFormat:a,setNumber:o,setFormat:l,matchTiebreakHasJoiner:E,isGameScoreEntry:M,isSpace:A,isCloser:_,isTiebreakCloser:_&&k&&f&&v,isDecidingSet:s,isTiebreakSet:m,isTimedSet:c,isNumericEnding:v,isNumericValue:R,hasOpener:k,hasOutcome:N,finalSet:u,finalSetIsComplete:d,lastSetIsComplete:C,isInvalidSetTiebreakValue:A&&f&&b,isInvalidMatchTiebreakValue:O,isTiebreakEntry:f,isSetTiebreakEntry:p,isMatchTiebreakEntry:h,isIncompleteSetScore:y,isIncompleteSetTiebreak:b,isIncompleteMatchTiebreak:I,isPartialMatchTiebreakValue:T}}function tre(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:o,matchUpStatus:a}=t,{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t,u,d,p=l&&e===2||!l&&e===1;if(!Xne.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);let{matchUpWinningSide:h}=N6({sets:r,winningSide:o,matchUpStatus:a,matchUpFormat:s});o=h;let f=ECe({value:i,winningSide:o,scoreString:n,sets:r,matchUpFormat:s});if(Kne.includes(i)&&(i=vv),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&Et(i)===0&&(f.isTiebreakCloser=!0),VM.includes(i)&&f.hasOpener&&(i=""),VM.includes(i)&&(i=ZA),f.lastSetIsComplete){let m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:a,winningSide:o}=DCe({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:a,winningSide:o,value:i}));else if(KA.includes(i))f.finalSetIsComplete||o?d="final set is already complete":!f.isTiebreakEntry&&!f.isIncompleteSetScore?{sets:r,scoreString:n,matchUpStatus:a,winningSide:o,updated:u}=ere({lowSide:e,sets:r,scoreString:n,matchUpStatus:a,winningSide:o,value:i}):f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i});else if(i===$M)u=!0,{scoreString:n,sets:r}=f2({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),a=void 0,o=void 0;else if(f.hasOutcome)d="has outcome";else if(i===vv&&!f.isMatchTiebreakEntry)(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=f2({analysis:f,scoreString:n,sets:r,lowSide:e}),a=void 0);else if(i===cd&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=cd);else if([vv,cd].includes(i))d="invalid location for joiner";else{if(o)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=TCe({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){let m=f.isSetTiebreakEntry?Hv:xm,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:T}=b||{},S=JA({set:y});if(!f.isTiebreakSet){let U=parseInt(n.split(v).reverse()[0]),D=Qne({lowValue:U,tiebreakTo:I,NoAD:T});S===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=D)}n=(n||"")+g,f.isDecidingSet||(n+=gv);let w=NH({analysis:f,set:y});y.winningSide=w||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=PCe({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){let[m]=Hv.split(""),g=Math.max(...uu(m,n.split(""))),v=n.slice(g+1),y=v&&Et(v)===yCe,b=Et(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:T,NoAD:S}=I||{};!y&&v.length<2?S&&b>T-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;let{scoreString:m,set:g}=CCe({analysis:f,lowSide:e,scoreString:n,value:Et(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}if(u){r=r==null?void 0:r.filter(Boolean);let{matchUpWinningSide:m}=N6({sets:r,winningSide:o,matchUpStatus:a,matchUpFormat:s});return o=m,m&&(!a||[Gn,wu].includes(a))?(a=hCe,r=r.filter(g=>{let{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})):n&&!o&&![Bne,Fne,Vne].includes(a)&&(a=void 0),{updated:u,scoreString:n,sets:r,winningSide:o,matchUpStatus:a,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:o,matchUpStatus:a,info:d}}var QA="\\d+-\\d+",XT="\\d+-\\d+\\(\\d+\\)",AH="\\[\\d+-\\d+\\]",MCe="\\d+-\\d+\\(\\d+-\\d+\\)",RCe=new RegExp(`(${QA}),`,"g"),NCe=new RegExp(`(${XT}),`,"g"),ACe=[QA,XT,AH,MCe],_Ce=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"],kCe=_Ce.map(t=>{let e=t.split("").map(i=>ACe[i]).join(" ");return new RegExp(`^${e}$`)});function A6(t){return!t||kCe.some(e=>e.test(t))}function xCe(t){let e="[];",i="()",n=e+i,r=[e[0],i[0]],o=Object.assign({},...n.split("").map(l=>({[l]:0}))),a="",s=t.split("").map(l=>{let c=n.includes(l)&&l,u=r.includes(c);if(u&&c)return o[c]+=1,a=c,l;if(!u&&c&&a&&c!==a){o[a]-=1;let d=e.includes(a)&&e||i.includes(a)&&i||"",p=d.split("").find(h=>h!==a);if(d.includes(c))o[a]||(a="");else return o[c]||(a=""),p}return l}).join("");return t!==s?s:t}function _E(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function OCe(t){return/^\(\d+-\d+\)$/.test(t)||/^\[\d+-\d+\]$/.test(t)}function JI(t){let e=(i=>i==null?void 0:i.split("-").join("").split("/").join(""))(t);if(/^\d+$/.test(e)&&e.length===2){let i=e.split("");return Math.abs(i.reduce((n,r)=>+n-+r))===1}return!1}function jM(t,e){let i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();let n=i;if(Math.abs(n.reduce((r,o)=>+r-+o))>=2)return n.join("-")}function _6(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"),t)}function LCe(t){return t.startsWith("(")&&t.endsWith(")")}function FCe({score:t,applied:e}){t=xCe(t);let i=/\)(\d+)/g;if(i.test(t))for(let S of t.match(i)){let w=S.replace(")",") ");t=t.replace(S,w)}t=t.replace(/\)\//g,") / "),t=t.replace(/\/\)/g,")");let n=/\(([\d- ]+)\)/g,r=/\(([\d- ]+)\)/,o=t.match(n);for(let S of o||[]){let[w]=S.match(r).slice(1),U=w.replace(/ /g,"");t=t.replace(S,`(${U})`)}let a=/\(\(\d-\d\)\)/g;if(a.test(t)){let S=t.match(a);S.length&&S.forEach(w=>{let U=w.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(w,U)})}if(a=/\(\((\d)\)\)/g,a.test(t)){let S=t.match(a);S.length&&S.forEach(w=>{let U=w.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(w,U)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));let s=new RegExp(/[-,]{2,}/g);t=t.replace(s,"-"),["- "," -"].forEach(S=>{let w=new RegExp(`(\\d+)${S}(\\d+)`,"g"),U=t.match(w);U&&U.forEach(D=>t=t.replace(D,D.split(S).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));let l=/\(\d+, \)/g;l.test(t)&&t.match(l).forEach(S=>{let[w]=S.match(/\((\d+), \)/).slice(1);w.length===2?t=t.replace(S,`(${w})`):w.length===1&&w==="6"&&(t=t.replace(S,"(6-0)"))});let c=/\((\d+)\/\)/g;c.test(t)&&t.match(c).forEach(S=>{let[w]=S.match(/\((\d+)\/\)/).slice(1);w.length===2?t=t.replace(S,`(${w})`):w.length===1&&w==="6"?t=t.replace(S,"(6-0)"):t=t.replace(S,`(${w})`)});let u=/\d\/\d\/,/g;u.test(t)&&t.match(u).forEach(S=>{let[w]=S.match(/(\d\/\d)\/,/).slice(1);t=t.replace(S,`${w},`),e.push("slashComma")});let d=/\(\/(\d+)\)/g;d.test(t)&&t.match(d).forEach(S=>{let[w]=S.match(/\(\/(\d+)\)/).slice(1);w.length===2?t=t.replace(S,`(${w})`):w.length===1&&parseInt(w)<6?t=t.replace(S,`(6-${w})`):t=t.replace(S,`(${w})`)});let p,h,f,m,g,v=()=>{g=os(t.split("")),h=g["("]===(g[")"]||0)+1,p=(g["("]||0)+1===g[")"],f=g["["]===g["]"]+1,m=h&&!f};v();let y=/(\d+-\d+\(\d+)0,/;if(y.test(t)){let[S]=t.match(y).slice(1);t=t.replace(y,S+")")}if(g["("]===g[")"]&&g["("]>1){let S=t.split(")(").join(") (").split(" ");S.every(LCe)?t=S.map(w=>{let U=w.slice(1,w.length-1);return U.length>2?U:w}).join(" "):t=S.join(" ")}v();let b=/[A-Za-z]+/.test(t),I=/\d+/.test(t);if(!b&&!I)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(S=>g[S])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&g["("]===1&&g[")"]===1&&"[]/,".split("").some(S=>g[S]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),g["("]>(g[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",v()),g["("]===1&&!g[")"]&&t[0]==="("&&(t=t+")",v()),g["("]>(g[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),p){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{let S=[],w=0;for(let U of t.split("").reverse())U===")"&&(w?S.push("("):w+=1),U==="("&&(w-=1),S.push(U);S.reverse(),t=S.join("")}v()}if(g[")"]>(g["("]||0)&&t[0]===")"&&(t="("+t.slice(1),v()),m&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",v()),m&&(!t.endsWith(")")||t.startsWith("(("))&&(t=t+")",v()),m){let S="",w=0;for(let U of t.split(""))U==="("&&(w?S+=")":w+=1),U===")"&&(w-=1),S+=U;t=S}v(),f&&!h&&(t=t+"]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),v()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),v(),g[")"]===1&&!g["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&g["("]===1&&g[")"]===1&&(t=t.slice(1,t.length-1),v());let T=S=>{let w=S.indexOf("("),U=S.indexOf(")");return w>=0&&U>=0&&w<U};if(/^\([\d ]+.*[\d ]+\)$/.test(t)&&g["("]===g[")"]){let S=t.slice(1,t.length-1);T(S)&&(t=S,v())}return{score:t,applied:e}}function e_(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;let e=uu("-",t.split(""));if(!e.length)return t;let i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((o,a)=>a%2).forEach(o=>{t=t.substring(0,o)+" "+t.substring(o+1)}),t}function BCe({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[RCe,NCe].forEach(i=>{let n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),t=t.split(" ").filter(Boolean).map(e_).join(" "),{score:t,applied:e}}function $Ce({score:t}){if(typeof t!="string")return{score:t};let e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");t=t.split(", ").join(" ");let n=t.split(" ");t=n.map(p=>{let h=/^-(\d+)$/;if(h.test(p)){let[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");let r=n.filter(_E),o=0,a="";for(let p of r){let h=uu(p,n).filter(v=>!o||v>o)[0],f=n.slice(o,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){let v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1){let b=[f.join(" "),[m,p].join("")].join(" ");a+=b,o=h+1}else if(y===0){let b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){let I=[6,4].includes(b)?b+1:b-1,T=[b,I].sort().reverse().join("-"),S=[f.join(" "),[T,p].join("")].join(" ");a+=S,o=h+1}}}}if(r.length&&a.length){let p=n.slice(o).join(" ");return a=[a,p].join(" "),{score:a.trim()}}if(n.length===2&&["(","["].some(p=>n[1].includes(p))){let p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}let s=n.map(p=>OCe(p)&&"bracket"||JI(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,h="";return n.forEach((f,m)=>{s[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=s[m]}),{score:h.trim()}}n=t.split(" ");let l,c=n.map(p=>{let h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){let[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}}),u=uu("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}let d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){let[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!JI(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{let h=/^\((.*)\)$/,f=h.test(p),m=new RegExp(AH).test(p)&&"super"||new RegExp(XT).test(p)&&"tiebreak"||new RegExp(QA).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}}function VCe({score:t,applied:e}){for(let U of[".",","," ","/"]){let D=new RegExp(`^(\\d+)\\${U}(\\d+)$`);if(D.test(t)){let E=t.match(D).slice(1).map(M=>parseInt(M)),C=Math.abs(E[0]-E[1]);C<=10&&C>=2&&(t=t.split(U).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));let i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){let[U,D,E,C,M,N]=t.match(i).slice(1);t=t.replace(i,`${U}${D}-${E} ${C}-${M}${N}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));let n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));let r=/^\d{3,}\(/,o=/\(\d+\)\d+/;[r,o].forEach(()=>{t=t.split(" ").map(U=>(r.test(U)&&(U=U.replace("("," (")),o.test(U)&&(U=U.replace(")",") ")),U)).join(" "),e.push("spaceConsiderationPatterns")});let a=e_(t);a!==t&&(t=a,e.push("deDashMash"));let s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){let[U,D,E]=t.match(s).slice(1),[C,M]=D.split("");t=`${U}-${C} ${M}-${E}`,e.push("smashSetPattern")}let l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){let[U,D]=t.match(c).slice(1),E=U.trim(),C=D.trim();if(l.test(E)&&l.test(C)){let M=E.match(l).slice(1,3).join("-"),N=C.match(l).slice(1,3).join("-");t=`${M} ${N}`,e.push("slashSeparationPattern")}}let u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){let[U,D]=t.match(u).slice(1),E=U.trim(),C=D.trim();if(l.test(E)&&l.test(C)){let M=E.match(l).slice(1,3).join("-"),N=C.match(l).slice(1,3).join("-");t=`${M} ${N}`,e.push("commaSeparationPattern")}}let d=/^\d \d,/;if(d.test(t)){let U=t.match(d)[0],D=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,D),e.push("singleSetCommaSeparationPattern")}let p=0,h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){let[U,D,E]=t.match(h).slice(1),C=D.split(""),M=`${U}-${C[0]} ${C[1]}-${E}`;t=t.replace(h,M),e.push("noSetSeparationPattern"),p+=1}let f=/(^|\s)7-6\s(\d+)\s/g,m=t.match(f);if(m!=null&&m.length){let U=/(^|\s)7-6\s(\d+)\s/;m.forEach(D=>{let E=D.match(U).slice(2)[0];t=t.replace(D,`7-6(${E}) `),e.push("floatingTiebreakPattern1")})}let g=t.match(/\d \d /);g==null||g.forEach(U=>{let D=U.slice(0,U.length-1).split(" ").join("-");t=t.replace(U,D),e.push("spaceSeparatedSetPattern1")}),g=t.match(/ \d \d$/),g==null||g.forEach(U=>{let D=" "+U.slice(1).split(" ").join("-");t=t.replace(U,D),e.push("spaceSeparatedSetPattern2")});let v=/^\d, *\d\/\d, *\d/;if(v.test(t)){let U=t.match(v)[0],D=U.split("/").map(E=>`(${E})`).join(" ")+" ";t=t.replace(U,D),e.push("slashCommaSetPattern")}let y=/\(6-\)/g;y.test(t)&&(t=t.replace(y,"(6-0)"),e.push("missingZeroPattern2"));let b=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(b.test(t)){let U=t.match(b),D=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)"),E=t;U.forEach(C=>{let[M,N]=C.match(D).slice(1),R=`${M}-${N}`;E=E.replace(C,R)}),t=E,e.push("slashSetPattern")}let I=/(.*)\s(1\d)\s(\d+)$/;if(I.test(t)){let[U,D,E]=t.match(I).slice(1);U.replace(/\D/g,"").length>=4&&(t=U+` ${D}${E}`,e.push("spaceSeparatedSuperPattern"))}let T=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(let U of t.match(T)||[]){let[D,E,C,M]=U.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[N,R]=E.split("-").map(A=>parseInt(A));Math.abs(N-R)===1&&(t=t.replace(U,`${D}${E}(${C})${M}`),e.push("spaceSeparatedSetPattern"))}let S=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(let U of t.match(S)||[]){let D=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[E,C,M]=U.match(D).slice(1),[N,R]=E.split("-").map(A=>parseInt(A));Math.abs(N-R)===1&&(t=t.replace(U,`${E}(${C})${M}`),e.push("floatingTiebreakPattern2"))}let w=/(^|\s)(\d \d)\(/g;for(let U of t.match(w)||[]){let D=/(^|\s)(\d \d)\(/,[E,C]=U.match(D).slice(1);t=t.replace(U,`${E}${C.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}}function jCe({score:t,matchUpStatus:e}){var s;let i=t==null?void 0:t.split(" ");t=i.map(l=>{if(l.endsWith("]")){let c=l.split("[");if(JI(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");let n=new RegExp(/(\([\d ]+\))/g);if(n.test(t))for(let l of t.match(n)){let c=(s=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:s[1];if(Bn(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){let u=c.indexOf("1");c=jM(c.split(""),u)}}t=t.replace(l,`(${c})`)}i=t==null?void 0:t.split(" ");let r=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/),o=i.length-1;t=i.map((l,c)=>{let u=[void 0,"","COMPLETED"].includes(e)||c!==o;if(r.test(l)&&u){let[d,p,h]=Array.from(l.match(r)).slice(1),f=Math.min(p,h);return`${d}(${f})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^(\d{2})\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=i.map(l=>{if(r.test(l)){let[c,u]=Array.from(l.match(r)).slice(1);return JI(c)?`${c}(${u})`:c}return l}).join(" "),i=t==null?void 0:t.split(" "),r=new RegExp(/^1-0\((\d+)\)$/),t=i.map(l=>{if(r.test(l)){let[c]=l.match(r).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");let a=/\((\d)+0 /;if(a.test(t)){let l=t.match(a)[1];t=t.replace(a,`(${l}) `)}return{score:t}}function HCe({score:t,attributes:e,identifier:i}){var u,d,p;if(typeof t!="string")return{score:t,identifier:i};let n=new RegExp(/\([\d,/ ]+\)/g),r=t.match(n);for(let h of r||[]){let f=(d=(u=h.match(/^\((.*)\)$/))==null?void 0:u.slice(1))==null?void 0:d[0],m=t.split(h)[0].split(")").reverse()[0].replace(/\D/g,"");if((f==null?void 0:f.length)===2&&(m==null?void 0:m.length)>=2){let y=m.slice(m.length-2).split("").map(b=>parseInt(b));if(Math.abs(y[0]-y[1])===1)continue}let g=_6(f),v=e_(g);t=t.replace(h,`(${v})`).trim()}let o=new RegExp(/\[[\d,/ ]+\]/g);(p=t.match(o))==null||p.forEach(h=>{let f=_6(h.match(/^\[(.*)\]$/)[1]);t=t.replace(h,`(${f}) `).trim()});let a=[")","]"],s=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&a.some(h=>t.endsWith(h))&&s.some(h=>t.includes(h))){let h="",f=t.split(/[)\]]/).filter(Boolean).map(b=>(b.startsWith(",")&&(b=b.slice(1)),b.trim())),m=f.every(b=>b.includes(",")||_E(b)),g=f.every(b=>b.includes("/")||_E(b)),v=f.every(b=>b.includes("-")||_E(b)),y=m&&","||v&&"-"||g&&"/";if(y){let b;f.forEach(I=>{if(I.startsWith("("))if(b==="set"&&(h+=" "),I.includes(y))h+=I.slice(1).split(y).map(T=>T.trim()).join("-"),b="set";else{let T=I.slice(1);h+=`(${T}) `,b="tiebreak"}else if(I.startsWith("[")){let T=I.slice(1).split(y).map(w=>parseInt(w.trim())),S=Math.min(...T);b==="set"?h+=`(${S}) `:h+=`[${T.join("-")}] `,b="tiebreak"}}),t=h.trim()}}let l=os(t.split(""));l["("]===1&&l[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),l["-"]===1&&JI(t)&&Bn(e==null?void 0:e.removed)&&(t=t+`(${e.removed})`,e.removed=void 0));let c=/\(\)/g;return c.test(t)&&(t=t.replace(c,"").trim()),{score:t}}function ire({score:t}){let e=t.split(""),i=[],n,r=()=>n=[void 0,void 0,void 0],o=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();let a=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){let s=e.shift(),l=Bn(s)&&parseInt(s),c=n[0]!==void 0&&n[1]!==void 0;if(Bn(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,a())){i.push(o()),n=[void 0,void 0];continue}if(c&&e.length===1&&Bn(e[0])){let u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(o()),n=[void 0,void 0]}c&&a()}}return{sets:i}}function m2(t){let e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){let r=jM(i,e);if(r)return r}if(n&&t.length===7&&e>3){let r=i.slice(4),o=jM(r,e-4);if(o)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${o}`}}function nre(t){let{score:e}=t,{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),o=r==null?void 0:r.every(s=>Bn(s)),a=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||o){e=e.toString().toLowerCase(),o&&(e=r.join(""));let s=o?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(ire({score:e}),s.length,e.length===3&&a(s.slice(0,2))===1){let[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){let[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&a(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){let[l,c,u,d]=s,p=Math.min(u,d);e=`${l}-${c}(${p})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){let[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){let[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&a(s.slice(0,2))===1){let[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&a(s.slice(3))===1){let[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(a(s.slice(0,2))>1&&a(s.slice(2,4))>1&&s[4]===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(a(s.slice(0,2))===1&&a(s.slice(3,5))>1&&a(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(a(s.slice(0,2))>1&&a(s.slice(2,4))===1&&a(s.slice(5,7))>1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(a(s.slice(0,2))>1&&a(s.slice(2,4))>1&&a(s.slice(4,6))===1){let[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){let l=m2(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{let l=Qr(e.split(""),2).map(g=>g.join("")),c=l.map(g=>{let[v,y]=g.split("").map(T=>parseInt(T)),b=Math.abs(v-y),I=v>y?1:2;return b>1&&I||I*-1}),u=c.reduce((g,v)=>g>0&&v>0,1),d=os(c),p=c.map(g=>Math.abs(g)),h=os(p),f=c[0]<0,m=!f&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(!Object.values(h).includes(3))e=l.join(" "),i.push("chunkSplit");else{let[g,v,y,b,I,T]=s,S=c.reduce((w,U,D)=>U<0?D:w,void 0);if(S===0){let w=Math.min(y,b);e=`${g}-${v}(${w}) ${I}-${T}`,i.push("chunkSplitTiebreak1")}else if(S===1){let w=Math.min(I,T);e=`${g}-${v} ${y}-${b}(${w})`,i.push("chunkSplitTiebreak2")}else e=`${g}-${v} ${y}-${b}`,i.push("chunkSplitTrimExtraneous")}}else if(s.length===8){let[g,v,y,b,I,T,S,w]=s;f||m?s[5]===1&&(f?e=`${g}-${v}(${y}) ${b}-${I} [${T}${S}-${w}]`:e=`${g}-${v} ${y}-${b}(${I}) [${T}${S}-${w}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function rre(t){let e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){let c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]&&1||c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});let o=e[0]>e[1]&&1||e[1]>e[0]&&2,a=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:a,setWinners:i,totalSets:s,winningSide:o}}function GCe({score:t,matchUpStatus:e,attributes:i}){let n=[],r,o=t.split(" "),a=o.length;t=o.map((u,d)=>{if(new RegExp(XT).test(u)){let h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!JI(f)&&!e){let g=Math.max(...m),v=f.indexOf(g),y=[g,g-1];return v&&y.reverse(),y.join("-")+h}}else if(u.length===2&&Bn(u))return u.split("").join("-");u=e_(u);let p=new RegExp(`^${AH}$`).test(u)&&"super"||new RegExp(`^${XT}$`).test(u)&&"tiebreak"||new RegExp(`^${QA}$`).test(u)&&"standard"||"unknown";if(n.push(p),a>1&&p==="standard"&&d<2){let[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){let b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){let[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");let{setsWon:s,setWinners:l,totalSets:c}=rre(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){let u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}}function zCe({score:t}){let{setsTied:e,winningSide:i}=rre(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){let s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}let r=t.split(" "),o=r[r.length-1];if(!o.includes("-")||o.indexOf("(")>0)return{score:t};let a=o.split("(").join("").split(")").join("").split("-");if(!a.every(s=>Bn(s)))return{score:t};if(a[0]==="76"){let s=a[1].length===2?Math.min(...a[1].split("").map(l=>parseInt(l))):a[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{a=a.map(c=>parseInt(c));let s=Math.max(...a),l=Math.abs(a[0]-a[1]);if(s>=10){if(l>2&&a.every(c=>+c>=10)){let c=a.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(a=c)}t=[...r.slice(0,r.length-1),`[${a.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${a.join("-")}]`].join(" "))}return{score:t}}function WCe({score:t}){return t=(t==null?void 0:t.toString().toLowerCase())||"",{score:t}}function qCe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}function YCe({score:t,applied:e}){return typeof t!="string"?{score:t}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){let n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){let r=jM(i.split(""),n);return e.push("getSuper"),r}}else{let{score:r,applied:o}=nre({score:i,applied:[]});r!==i&&(i=r,e.push(...o))}}return i}).join(" "),{score:t,applied:e})}function KCe({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&m2(t)?{score:m2(t)}:(t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length===1){e.push("removeErroneous1");return}return i}).filter(Boolean).join(" "),{score:t,applied:e})}function ZCe({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}}function XCe({score:t,profile:e,applied:i}){var a;t=t==null?void 0:t.toString().toLowerCase();let n=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(n.test(t)){let[s]=t.match(n).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}let r=(a=e==null?void 0:e.matchUpStatuses)==null?void 0:a.retired,o=["rtd",...Array.isArray(r)?r:[r].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return o?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(o,"").trim(),applied:i}):{score:t}}function JCe({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));let i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));let n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}}function QCe({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}}function e1e({score:t}){let e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));let n=/^(\d+), *(\d+)$/;if(n.test(t)){let[r,o]=t.match(n).slice(1);t=[r,o].join("-")}return{score:t}}function t1e({score:t}){let e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(let n of i||[]){let r=n.replace("/","-");t=t.replace(n,r)}return{score:t}}function i1e({score:t}){if(t.includes(",")){let e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{let r=/\d+ \d+/g;for(let o of n.match(r)){let[a,s]=o.match(/(\d+) (\d+)/).slice(1);n=n.replace(o,`${a}-${s}`)}return n}).join(" "))}if(t.includes(" ")){let e=t.replace(/[ ,]/g,"");e.split("").every(i=>Bn(i))&&e.length===4&&(t=e)}return{score:t}}function n1e({score:t}){let e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());let i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}}var r1e={handleTiebreakSlashSeparation:t1e,handleSetSlashSeparation:QCe,punctuationAdjustments:FCe,handleGameSeparation:e1e,joinFloatingTiebreak:$Ce,handleBracketSpacing:BCe,handleSpaceSeparator:i1e,separateScoreBlocks:YCe,matchKnownPatterns:VCe,removeDanglingBits:JCe,removeErroneous:KCe,handleWalkover:ZCe,properTiebreak:jCe,handleNumeric:nre,handleRetired:XCe,containedSets:HCe,sensibleSets:GCe,stringScore:WCe,superSquare:zCe,setBuilder:ire,excisions:n1e,replaceOh:qCe},_O={},o1e=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],a1e=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function ore(t){if(!t.score)return{error:Pe};let{score:e,sheetName:i,identifier:n,fileName:r,stepLog:o,fullLog:a,profile:s}=t,l=[],c,u=[],d,p,h=e,f=g=>{g.forEach(v=>{p=r1e[v]({profile:s,identifier:n,matchUpStatus:c,attributes:d,applied:u,score:h});let y=p.score!==h;y&&l.push({method:v,score:p.score}),o&&(a||y||p.matchUpStatus!==c)&&console.log(c?{score:p.score,matchUpStatus:c}:{score:p.score},v),p.matchUpStatus&&(c=p.matchUpStatus),p.attributes&&(d=p.attributes),p.applied&&(u=p.applied),h=p.score})};f(o1e);let m=A6(h);return m||(h=e.toString().replace(/\D/g,""),d!=null&&d.removed&&(d.removed=void 0),f(a1e),m=A6(h),m||(h="")),u.forEach(g=>{_O[g]||(_O[g]=0),_O[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:d,isValid:m,score:h}}var are={};ii(are,{analyzeSet:()=>JT,checkScoreHasValue:()=>io,checkSetIsComplete:()=>XA,getSetComplement:()=>kH,getTiebreakComplement:()=>t_,isValidMatchUpFormat:()=>ls,parseScoreString:()=>HM,validateScore:()=>_H,validateTieFormat:()=>$a});function s1e({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){let o=(r==null?void 0:r.sets)??[],a=((o==null?void 0:o.filter(I=>I==null?void 0:I.winningSide))||[]).reduce((I,T)=>{let{winningSide:S}=T;if(!S)return I;let w=S-1;return I[w]++,I},[0,0]),s=n?n-1:void 0,l=s!==void 0?1-s:void 0,c=s!==void 0&&a[s],u=l!==void 0&&a[l],d=e?Pa(e):void 0,p=Math.max(...a),h=os(a)[p],f=d==null?void 0:d.bestOf,m=f&&Math.ceil(f/2)||1,g=i??t,v=g&&[Pi,Go,Oi].includes(g),y=!d||!o.length||o.every((I,T)=>{let S=T+1,w=S===f,U=S===o.length,{side1Score:D,side2Score:E,side1TiebreakScore:C,side2TiebreakScore:M,winningSide:N}=I,R=Math.max(D??0,E??0),A=C??M,{finalSetFormat:_,setFormat:k}=d,O=w&&_||k;if(A){let{tiebreakTo:F,NoAD:B}=(O==null?void 0:O.tiebreakFormat)||{},$=Math.max(C??0,M??0);if(B&&$>F||$<F&&N&&(U&&!v||!U))return!1}return O.setTo?!(!O.noTiebreak&&R>O.setTo+1):!0}),b=(!e||p===m)&&h===1&&a.indexOf(p)+1||void 0;return{valid:y&&(n&&c>u&&n===b||!n&&!b||v)}}function _H({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Pe};let{sets:o,scoreStringSide1:a,scoreStringSide2:s}=r,l="scoreString must be a string!";if(a!==void 0&&typeof a!="string")return{error:Pe,info:l};if(s!==void 0&&typeof s!="string")return{error:Pe,info:l};if(o!==void 0&&!Array.isArray(o))return{error:Pe,info:Td("sets")};if(o!=null&&o.length){let c=o.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==Zt(c).length)return{error:Pe,info:"setNumbers not unique"};for(let d of o){let{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(T=>T!==void 0)).every(I=>I.every(T=>Bt(T))))return{error:Pe,info:"non-numeric values"};if(![b,y].filter(I=>I!==void 0).every(I=>Bt(I)))return{error:Pe,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Pe,info:"winningSide must be 1 or 2"}}let{valid:u}=s1e({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:JJ,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}var kH=t=>{let{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:o}=t;if(i===void 0)return!1;let a=Et(i);(a==null?void 0:a.toString().length)>2&&(a=parseInt(a.toString().slice(0,2))),r&&r<n&&a>r&&(a=r);let s;return o&&!r?(a>n&&(s=n),s=a<n?n:n-1):s=a+1<n&&n||r&&r<n&&a===r&&n||!r&&a+2||n+1,[e?a:s,e?s:a]},t_=t=>{let{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let o=typeof i=="string"?parseInt(i):i;(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&o>n-1&&(o=n-1);let a=l1e({lowValue:o,NoAD:r,tiebreakTo:n});return[e?o:a,e?a:o]};function l1e(t){let{lowValue:e,NoAD:i,tiebreakTo:n}=t,r=i?1:2;return e+1>=n?e+r:n}function HM({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((n,r)=>i({set:n,setNumber:r+1}));function i({set:n,setNumber:r}){let o=(n==null?void 0:n.startsWith("["))&&n.split("[")[1].split("]")[0].split("-").map(m=>parseInt(m)),a=n.includes("(")&&n.split("(")[0]||n.includes("[")&&n.split("[")[0]||n,s=!o&&a.split("-").map(m=>parseInt(m)),l=o?o[0]>o[1]&&1||o[0]<o[1]&&2||void 0:s[0]>s[1]&&1||s[0]<s[1]&&2||void 0,c=n.includes("(")?n.split("(")[1].split(")")[0]:void 0,u=(c&&t_({lowValue:c,isSide1:l===2,tiebreakTo:t}))??[],[d,p]=s||[],[h,f]=o||u||[];return{side1Score:d,side2Score:p,side1TiebreakScore:h,side2TiebreakScore:f,winningSide:l,setNumber:r}}}function c1e({matchUpScoringFormat:t,isDecidingSet:e,isTiebreakSet:i,setObject:n}){if(!n)return;let r=JA({set:n});return XA({matchUpScoringFormat:t,set:n,isDecidingSet:e,isTiebreakSet:i})&&r||void 0}function JT(t){let{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:qN};let{setNumber:n}=e||{},{bestOf:r}=i||{},o=!!(n&&r&&n===r),a=o&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(a!=null&&a.tiebreakSet),l=!!(a!=null&&a.timed),c=!s&&!l,u=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],h=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=h.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=h==null?void 0:h.filter(_=>!isNaN(_)).length,{tiebreakAt:b}=a||{},I=b&&d.filter(_=>_>=b).length===2,T=I&&(d[0]>d[1]&&1||d[1]>d[0]&&2||void 0),S=!!(y&&!v),w=!!(e!=null&&e.winningSide),{error:U,result:D}=u1e({setObject:e,setFormat:a,sideGameScores:d,sideTiebreakScores:h}),{error:E,result:C}=d1e({setObject:e,setFormat:a,sideTiebreakScores:h}),M=c&&!S&&D||s&&S&&C,N=u&&!(s&&!S)&&!(c&&S)&&(!w||M),R=c1e({isDecidingSet:o,isTiebreakSet:S,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:I,isCompletedSet:w,isDecidingSet:o,isTiebreakSet:S,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:M,leadingSide:T,setFormat:a,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:R};return(e==null?void 0:e.winningSide)!==void 0&&(S?(A.isValidTiebreakSetOutcome=C,C||(A.tiebreakSetError=E)):(A.isValidStandardSetOutcome=D,D||(A.standardSetError=U))),A}function u1e({setObject:t,setFormat:e,sideGameScores:i,sideTiebreakScores:n}){if(!t)return{result:!1,error:qN};let r=!!(e!=null&&e.tiebreakSet),o=!!(e!=null&&e.timed);if(!e||r||o)return{result:!1,error:Pe};if((i==null?void 0:i.filter(w=>!isNaN(w)).length)!==2)return{result:!1,error:xF};let{setTo:a,tiebreakAt:s,tiebreakFormat:l,NoAD:c}=e||{};if(!(a&&(i!=null&&i.find(w=>w>=a))))return{result:!1,error:xF};let u=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!u)return{result:!1,error:YN};let d=(t==null?void 0:t.winningSide)-1,p=1-d,h=i[d],f=i[p],m=h-f;if(!(h>f))return{result:!1,error:{message:"winningSide game scoreString is not high"}};let g=s&&l,v=(n==null?void 0:n.filter(w=>!isNaN(w)).length)===2,y=n==null?void 0:n[d],b=n==null?void 0:n[p],I=s&&i.filter(w=>w>=s).length===2;if(g){let{NoAD:w,tiebreakTo:U}=l;if(I){if(m>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!v)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(U))return{result:!1,error:{message:"tiebreakTo error"}};if(!(U&&(n!=null&&n.find(N=>N>=U))))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let D=s<a?a:a+1;if(h>D)return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!y||!b||y<b)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let E=w?1:2,C=y-b,M=b>=U-1;if(C&&M&&C<E)return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(h>a&&!I)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}let T=c?1:2,S=f>=a-1;return m&&S&&!I&&m<T?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:m>T&&h>a?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}function d1e({setObject:t,setFormat:e,sideTiebreakScores:i}){if(!t)return{result:!1,error:qN};let n=!!(e!=null&&e.tiebreakSet),r=!!(e!=null&&e.timed);if(!e||!n||r)return{result:!1,error:{message:"not tiebreak set"}};let o=[1,2].includes(t==null?void 0:t.winningSide);if(!t||!o)return{result:!1,error:YN};let{tiebreakSet:a}=e||{},{NoAD:s,tiebreakTo:l}=a||{};if((i==null?void 0:i.filter(g=>!isNaN(g)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(l))return{result:!1,error:{message:"tiebreakTo error"}};if(!(i!=null&&i.find(g=>g>=l)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};let c=(t==null?void 0:t.winningSide)-1,u=1-c,d=i[c],p=i[u];if(!d||!p||d<p)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};let h=s?1:2,f=d-p,m=p>=l-1;return f&&m&&f<h?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}var sre={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},lre={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},cre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},ure={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},dre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},pre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},hre={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},fre={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},mre={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},gre={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},vre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},yre={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},bre={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},Ire={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},wre={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},Sre={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},Tre={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}},g2="COLLEGE_DEFAULT",v2="COLLEGE_JUCO",y2="COLLEGE_D3",Ure="DOMINANT_DUO",Dre="DOMINANT_DUO_MIXED",Pre="LAVER_CUP",Cre="TEAM_DOUBLES_3_AGGREGATION",Ere="TIME_TENNIS_DUAL",Mre="TIME_TENNIS_PRO_CIRCUIT",Rre="USTA_BREWER_CUP",Nre="USTA_OZAKI_CUP",Are="USTA_COLLEGE",_re="USTA_GOLD_TEAM_CHALLENGE",kre="USTA_LEVEL_1",xre="USTA_INTERSECTIONAL",Ore="USTA_SECTION_BATTLE",Lre="USTA_SOUTHERN_LEVEL_5",Fre="USTA_TOC",Bre="USTA_WTT_ITT",$re="USTA_ZONAL",Vre={COLLEGE_D3:y2,COLLEGE_DEFAULT:g2,COLLEGE_JUCO:v2,DOMINANT_DUO:Ure,DOMINANT_DUO_MIXED:Dre,LAVER_CUP:Pre,TEAM_DOUBLES_3_AGGREGATION:Cre,TIME_TENNIS_DUAL:Ere,TIME_TENNIS_PRO_CIRCUIT:Mre,USTA_BREWER_CUP:Rre,USTA_OZAKI_CUP:Nre,USTA_COLLEGE:Are,USTA_GOLD_TEAM_CHALLENGE:_re,USTA_INTERSECTIONAL:xre,USTA_LEVEL_1:kre,USTA_SECTION_BATTLE:Ore,USTA_SOUTHERN_LEVEL_5:Lre,USTA_TOC:Fre,USTA_WTT_ITT:Bre,USTA_ZONAL:$re},jre="STANDARD",k6={[jre]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[y2]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Ks,matchUpCount:6,matchUpValue:1},tieFormatName:y2,valueGoal:5},[g2]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Ks},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Ks},tieFormatName:g2,valueGoal:4},[v2]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Ks},tieFormatName:v2,valueGoal:5},[Pre]:Sre,[Ure]:vre,[Dre]:hre,[Cre]:lre,[Ere]:fre,[Mre]:pre,[Rre]:mre,[Nre]:gre,[Are]:yre,[_re]:sre,[xre]:dre,[kre]:bre,[Ore]:ure,[Lre]:cre,[Bre]:Ire,[Fre]:Tre,[$re]:wre},p1e=t=>{let e=t!=null&&t.namedFormat&&Object.keys(k6).includes(t.namedFormat)?t.namedFormat:jre,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[],n,{category:r,gender:o}=(t==null?void 0:t.event)??{},a=dt(k6[e],!1,!0),s=l=>{var u,d;if(!(t!=null&&t.isMock)&&!((u=t==null?void 0:t.event)!=null&&u.isMock)||!t.event)return(i==null?void 0:i.pop())??ji();let c=(d=t==null?void 0:t.event)==null?void 0:d.eventId;return i.pop()??`${c}-COL-${l+1}`};return a.hydrate?(n={winCriteria:{valueGoal:a.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:bie,collectionName:"Doubles",matchUpType:an,...a.doubles},{collectionId:s(1),matchUpFormat:Ks,collectionName:"Singles",matchUpType:kn,...a.singles}]},a.tieFormatName&&(n.tieFormatName=a.tieFormatName)):(a.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),n=a),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),o&&!l.gender&&(l.gender=o)}),n},Gv=p1e;function h1e(t){var d,p,h;let{existingDrawDefinition:e,hydrateCollections:i,enforceGender:n,tieFormatName:r,matchUpType:o,eventType:a,isMock:s,event:l}=t,{tieFormat:c,matchUpFormat:u}=t;if(o===Or&&a===Or){let f=(p=(d=e==null?void 0:e.structures)==null?void 0:d.find(({stage:m})=>m===ut))==null?void 0:p.tieFormat;c=c||f||r&&((h=l==null?void 0:l.tieFormat)==null?void 0:h.tieFormatName)===r&&l.tieFormat||r&&Gv({namedFormat:r,hydrateCollections:i,isMock:s,event:l})||(l==null?void 0:l.tieFormat)||Gv({event:l,isMock:s,hydrateCollections:i}),u=void 0}else u||(c=void 0,l!=null&&l.matchUpFormat||(u=Ks));if(c){let f=$a({gender:l==null?void 0:l.gender,enforceGender:n,tieFormat:c});if(f.error)return f}return{tieFormat:c,matchUpFormat:u}}function f1e(t){var y,b,I,T,S;let e=t.drawDefinition,{existingQualifyingPlaceholderStructureId:i,drawEntries:n,appliedPolicies:r,structureId:o,idPrefix:a,isMock:s}=t,l=t.qualifyingProfiles,c=l!=null&&l.length?rne({uuids:t.uuids,qualifyingProfiles:l,appliedPolicies:r,idPrefix:a,isMock:s}):void 0;if(c!=null&&c.error)return c;e.structures=(y=e.structures)==null?void 0:y.filter(({structureId:w})=>w!==i),e.links=(b=e.links)==null?void 0:b.filter(({source:w})=>w.structureId!==i);let{qualifiersCount:u,qualifyingDrawPositionsCount:d,qualifyingDetails:p}=c??{};d&&(c!=null&&c.structures&&((I=e.structures)==null||I.push(...c.structures)),c!=null&&c.links&&((T=e.links)==null||T.push(...c.links)));let h=(S=e.structures)==null?void 0:S.find(({stage:w,stageSequence:U})=>w===ut&&U===1),{qualifiersCount:f}=y0({stageSequence:1,drawDefinition:e,structureId:o,stage:ut}),m=Math.max(u??0,f??0),g=cie({qualifiersCount:m,drawDefinition:e,stage:ut});if(g.error||(g=OM({drawSize:d,stage:Tt,drawDefinition:e}),g.error))return g;m1e({drawDefinition:e,drawEntries:n});let v=g1e({mainStructure:h,qualifyingDetails:p,drawDefinition:e});return v.error?v:{drawDefinition:e,structureId:o}}function m1e({drawDefinition:t,drawEntries:e}){for(let i of(e??[]).filter(({entryStage:n})=>n===Tt)){let n={...i,entryStage:i.entryStage??ut,drawDefinition:t};Dte(n)}}function g1e({mainStructure:t,qualifyingDetails:e,drawDefinition:i}){var n;for(let r of e||[]){let{finalQualifyingRoundNumber:o,finalQualifyingStructureId:a,roundTarget:s,finishingPositions:l,linkType:c}=r,u=t&&((n=QD({targetStructureId:t.structureId,sourceStructureId:a,sourceRoundNumber:o,finishingPositions:l,targetEntryRound:s,linkType:c}))==null?void 0:n.link);if(u!=null&&u.error)return u;u&&(i.links||(i.links=[]),i.links.push(u))}return{error:void 0}}function Hre(t){var n,r;let{participantIds:e}=t,i=((r=(n=t.drawDefinition)==null?void 0:n.entries)==null?void 0:r.filter(o=>{let a=o.entryStatus;return!t.restrictEntryStatus||ec.includes(a)}).map(ai))??[];if(e){let o=e.filter(a=>!(i!=null&&i.includes(a)));if(o!=null&&o.length)return se({result:{error:bu},info:{invalidParticipantIds:o}})}else e=i;return t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>e.length-1&&(!t.enableDoubleRobin||t.roundsCount>(e.length-1)*2)?{error:Pe,info:"Not enough participants for roundsCount"}:t.roundsCount&&t.restrictRoundsCount!==!1&&t.roundsCount>31?{error:Pe,info:"roundsCount must be less than 32"}:{participantIds:e}}function xH(t){var d;let e=[],{roundsCount:i=1,drawDefinition:n,matchUpsCount:r,structureId:o,idPrefix:a,isMock:s,event:l}=t,c,u=Hre(t);if(u.error)return u;for(let p of it(1,i+1)){let h=YA({restrictMatchUpsCount:t.restrictMatchUpsCount,ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:n,matchUpsCount:r,structureId:o,roundNumber:c,idPrefix:a,isMock:s,event:l});if(h.error)return se({result:h,info:{iteration:p}});(d=h.matchUps)!=null&&d.length&&e.push(...h.matchUps),c=((h==null?void 0:h.roundNumber)??1)+1}return{matchUps:e}}function v1e(t){var l;let{tournamentRecord:e,participantIds:i,scaleName:n,eventType:r,adHocRatings:o={}}=t,a=t.scaleAccessor??((l=vs[n])==null?void 0:l.accessor),s=e.participants??[];for(let c of i??[]){let u=s==null?void 0:s.find(p=>p.participantId===c),d=x6({scaleName:`${n}.${nee}`,participant:u,eventType:r});!d&&n&&(d=x6({scaleAccessor:a,participant:u,scaleName:n,eventType:r})),d&&!o[c]&&(o[c]=d)}return o}function x6({scaleType:t=fm,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var a,s;let o=(s=(a=i&&ad({scaleAttributes:{eventType:r??Bv,scaleType:t,scaleName:n},participant:i}))==null?void 0:a.scaleItem)==null?void 0:s.scaleValue;return e&&ln(o)?o[e]:o}function OH(t){var u,d;let e=b1e(t);if(e!=null&&e.error)return e;let i=Hre(t);if(i.error)return i;let n=y1e(t);if(n.error)return n;let r=v1e(t),o=((u=t.tournamentRecord)==null?void 0:u.isMock)??t.isMock,a=t.eventType??((d=t.event)==null?void 0:d.eventType),s=[],l=[],c;for(let p of it(1,(t.roundsCount??1)+1)){let h=PH({...t,participantIds:i.participantIds,structure:n.structure,ignoreLastRoundNumber:!0,iterationMatchUps:s,adHocRatings:r,roundNumber:c,eventType:a,isMock:o});if(h.error)return h;let{matchUps:f,...m}=h;l.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),c=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&s.push(...f)}return{...ae,matchUps:s,roundResults:l}}function y1e(t){var r,o,a;if(t.structureId)return t.structureId;let e=t.drawDefinition,i=(o=(r=e==null?void 0:e.structures)==null?void 0:r.filter(s=>s.stageSequence===1))==null?void 0:o.reduce((s,l)=>{let c=l.stage&&Fv[l.stage];return ss({structure:l})&&c>(Fv[s==null?void 0:s.stage]||1)?l:s},void 0),n=(a=e==null?void 0:e.structures)==null?void 0:a.find(s=>s.structureId===(i==null?void 0:i.structureId));return n?ss({structure:n})?{structure:n}:{error:sv}:{error:Nn}}function b1e(t){var e;return t.roundsCount&&typeof t.roundsCount!="number"?{error:Pe,info:"roundsCount must be a number"}:typeof t.drawDefinition!="object"||t.drawDefinition.drawType&&t.drawDefinition.drawType!==jl?{error:sv}:!Array.isArray((e=t.drawDefinition)==null?void 0:e.entries)&&t.participantIds&&!Array.isArray(t.participantIds)?{error:Pe,info:"Missing Entries"}:{error:void 0}}function I1e(t){var u,d;let{tournamentRecord:e,drawDefinition:i,structureId:n,idPrefix:r,isMock:o,event:a}=t,s=(u=a==null?void 0:a.entries)==null?void 0:u.filter(({entryStage:p,entryStatus:h})=>(!p||p===ut)&&h&&ec.includes(h)),l=s==null?void 0:s.map(ai),c=s?Math.floor(s.length/2):0;if(t.automated)return w1e({...t,participantIds:l});{let p=xH({roundsCount:t.roundsCount,drawDefinition:i,matchUpsCount:c,idPrefix:r,isMock:o,event:a});if(p.error)return p;(d=p.matchUps)!=null&&d.length&&HA({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:e,drawDefinition:i,structureId:n,event:a})}return{...ae}}function w1e(t){var l,c;let{restrictEntryStatus:e,generateMatchUps:i,structureId:n,matchUpIds:r,scaleName:o,scaleAccessor:a}=t.drawMatic??{},s=OH({...t,eventType:((l=t.drawMatic)==null?void 0:l.eventType)??t.matchUpType,generateMatchUps:i??!0,scaleAccessor:a??t.scaleAccessor,scaleName:o??t.scaleName,participantIds:t.participantIds,roundsCount:t.roundsCount,restrictEntryStatus:e,structureId:n,matchUpIds:r});return s.error?s:((c=s==null?void 0:s.matchUps)!=null&&c.length&&HA({tournamentRecord:t.tournamentRecord,drawDefinition:t.drawDefinition,suppressNotifications:!0,matchUps:s.matchUps,event:t.event,structureId:n}),{...ae})}function S1e({requireParticipantCount:t=!0,enforcePolicyLimits:e=!0,drawSizeProgression:i,participantsCount:n,participantCount:r,appliedPolicies:o,drawDefinition:a,seedingProfile:s,structureId:l,seedsCount:c}){var y,b;n=n??r;let u=At({drawDefinition:a,structureId:l});if(u.error)return u;let d=u.structure;if(!d)return{error:Nn};let{positionAssignments:p}=jr({structure:d}),h=(p==null?void 0:p.length)||0;if(c>h)return{error:NJ};let f=(y=d.structures)==null?void 0:y.length,m=Bt(s==null?void 0:s.groupSeedingThreshold)&&(s==null?void 0:s.groupSeedingThreshold),g=(b=jj({roundRobinGroupsCount:f,drawSize:h}))==null?void 0:b.seedGroups,{seedsCount:v}=uP({policyDefinitions:o,requireParticipantCount:t,drawSizeProgression:i,participantsCount:n,drawSize:h});return v&&(o!=null&&o[Ml])&&c>v&&e&&(c=v),d.seedLimit=c,d.seedAssignments=it(1,c+1).map(I=>{let T=g==null?void 0:g.find(U=>U.includes(I)),S=T&&Math.min(...T),w=m&&I>=m?S:I;return{participantId:void 0,seedNumber:I,seedValue:w}}),cn({drawDefinition:a,structureIds:[l]}),{...ae,seedLimit:c}}function Vy({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:o,event:a,stage:s}){if(!e)return{error:Ge};return o=o??(a==null?void 0:a.entries)??[],{scaledEntries:o.filter(u=>(!s||!u.entryStage||u.entryStage===s)&&(!r||!u.entryStageSequence||u.entryStageSequence===r)&&ec.includes(u.entryStatus)).map(u=>{let{participantId:d}=u,{scaleItem:p}=ZI({tournamentRecord:e,scaleAttributes:i,participantId:d});return{...u,...p}}).filter(u=>{let d=u.scaleValue;return!n&&(isNaN(d)||!parseFloat(d))?!1:d}).sort(n||l)};function l(u,d){return t?c(d)-c(u):c(u)-c(d)}function c(u){return parseFloat(u.scaleValue||(t?-1:1e5))}}function Gre(t){let e="prepareStage",{drawDefinition:i}=t,{structures:n}=wd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],o=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!o)return se({result:{error:Nn},stack:e});let a=o==null?void 0:o.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=R1e({...t,structureId:a});(t.seededParticipants||t.event||t.seedingScaleName)&&D1e({...t,seedsCount:s,structure:o,structureId:a});let u=t.automated!==!1&&t.drawType!==jl&&!(t.qualifyingOnly&&t.stage!==Tt),d=((n==null?void 0:n.length)||0)>1,p=u?U1e({...t,multipleStructures:d,seedLimit:c,structureId:a}):{};return p!=null&&p.error?se({result:p,stack:e}):{...p,stageEntries:l,structureId:a,seedsCount:s}}function T1e({entries:t,stage:e,stageSequence:i,roundTarget:n}){return t.filter(r=>{var a,s;let o=(s=(a=Qt({name:xu,element:r}))==null?void 0:a.extension)==null?void 0:s.value;return(!r.entryStage||r.entryStage===e)&&(!i||!r.entryStageSequence||r.entryStageSequence===i)&&(!n||!o||o===n)&&lg.includes(r.entryStatus)})}function U1e(t){let e=typeof t.automated=="object"&&t.automated.seedsOnly,i=XD({...t,seedsOnly:e});if(i.error)return i;let n=i==null?void 0:i.positionAssignments,r=i==null?void 0:i.positioningReport;return{conflicts:i.conflicts,positionAssignments:n,positioningReport:r}}function D1e(t){let{seededParticipants:e,seedingScaleName:i,entries:n,event:r}=t,o=n.map(ai);e?P1e({...t,enteredParticipantIds:o}):(r||i)&&C1e({...t,enteredParticipantIds:o})}function P1e(t){let{provisionalPositioning:e,enteredParticipantIds:i,seededParticipants:n,tournamentRecord:r,appliedPolicies:o,drawDefinition:a,seedingProfile:s,structureId:l,structure:c,event:u}=t,d=c?Oy({provisionalPositioning:e,appliedPolicies:o,drawDefinition:a,seedingProfile:s,structure:c}):void 0;n.filter(({participantId:p})=>i.includes(p)).filter(p=>!p.seedNumber||p.seedNumber<=n.length).sort((p,h)=>p.seedNumber<h.seedNumber?-1:p.seedNumber<h.seedNumber?1:0).forEach(p=>{let{participantId:h,seedNumber:f,seedValue:m}=p;I0({provisionalPositioning:e,tournamentRecord:r,drawDefinition:a,seedingProfile:s,participantId:h,seedBlockInfo:d,structureId:l,seedNumber:f,seedValue:m,event:u})})}function C1e(t){let e=t.seedsCount,{provisionalPositioning:i,enteredParticipantIds:n,seedAssignmentProfile:r,assignSeedsCount:o,tournamentRecord:a,drawDefinition:s,seedByRanking:l,seedingProfile:c,structureId:u,event:d}=t,{categoryName:p,ageCategoryCode:h}=(d==null?void 0:d.category)||{},f=d==null?void 0:d.eventType,m=E1e({...t,ageCategoryCode:h,categoryName:p,eventType:f})||l&&M1e({...t,ageCategoryCode:h,categoryName:p,eventType:f}),g=(m==null?void 0:m.length)??0;g<e&&(e=g),m==null||m.filter(({participantId:v})=>n.includes(v)).slice(0,o||e).forEach((v,y)=>{let b=y+1,{participantId:I,scaleValue:T}=v,S=(r==null?void 0:r[b])||T||b;I0({provisionalPositioning:i,tournamentRecord:a,drawDefinition:s,seedingProfile:c,participantId:I,structureId:u,seedNumber:b,seedValue:S,event:d})})}function E1e(t){let{tournamentRecord:e,seedingScaleName:i,stageSequence:n,entries:r,stage:o,event:a}=t,{categoryName:s,ageCategoryCode:l}=(a==null?void 0:a.category)||{},c=a==null?void 0:a.eventType,u={scaleName:i||s||l||a.eventId,scaleType:rd,eventType:c};return Vy({scaleAttributes:u,tournamentRecord:e,stageSequence:n,entries:r,stage:o}).scaledEntries}function M1e(t){let{tournamentRecord:e,stageSequence:i,event:n,entries:r,stage:o}=t,{categoryName:a,ageCategoryCode:s}=(n==null?void 0:n.category)||{},l=n==null?void 0:n.eventType;return Vy({scaleAttributes:{scaleName:a||s,scaleType:Gh,eventType:l},tournamentRecord:e,stageSequence:i,entries:r,stage:o}).scaledEntries}function R1e(t){let{seedsCount:e}=t;t.seededParticipants&&(e=t.seededParticipants.length),e>t.drawSize&&(e=t.drawSize);let i=T1e(t);e>i.length&&(e=i.length);let{seedLimit:n}=S1e({enforcePolicyLimits:t.enforcePolicyLimits??!0,appliedPolicies:t.appliedPolicies,participantsCount:i.length,seedingProfile:t.seedingProfile,drawDefinition:t.drawDefinition,structureId:t.structureId,seedsCount:e});return n&&n<e&&(e=n),{seedsCount:e,stageEntries:i,seedLimit:n}}function N1e(t){var b;let e=UH({...t,modifyOriginal:!1});if(e.error)return e;let i=e.drawDefinition,{ignoreStageSpace:n,appliedPolicies:r,qualifyingOnly:o,seedingProfile:a,participants:s,drawEntries:l,placeByes:c,drawSize:u,drawType:d,entries:p}=t,h=[],f=[],m=A1e({ignoreStageSpace:n,drawDefinition:i,drawEntries:l,drawType:d,entries:p});if(m.error)return m;let g=d===og?0:Et(t.seedsCount??0),v=Gre({...t,qualifyingOnly:!u||o,appliedPolicies:r,drawDefinition:i,seedingProfile:a,participants:s,stage:ut,seedsCount:g,placeByes:c,drawSize:u,entries:p});if(v.error&&!v.conflicts)return v;(b=v.positioningReport)!=null&&b.length&&h.push({[ut]:v.positioningReport});let y=v.structureId;return v.conflicts&&(f=v.conflicts),d===jl&&t.roundsCount&&I1e({...t,drawDefinition:i,structureId:y}),{drawDefinition:i,positioningReports:h,conflicts:f,structureId:y}}function A1e(t){let{ignoreStageSpace:e,drawDefinition:i,drawEntries:n,drawType:r,entries:o}=t;for(let a of o){if(n&&a.entryStage&&a.entryStage!==ut)continue;let s={...a,ignoreStageSpace:e??r===jl,entryStage:a.entryStage??ut,drawDefinition:i,drawType:r},l=Dte(s);if(n&&l.error)return l}return{error:void 0}}var _1e=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]}),k1e=_1e;function x1e(t){let{drawId:e=ji(),processCodes:i,matchUpType:n,drawType:r}=t??{},o=k1e();return Object.assign(o,{processCodes:i,matchUpType:n,drawType:r,drawId:e})}function LH(t){let e=t.structureIds,{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:o,matchUpId:a,event:s}=t,l=Ei(t,[{[qc]:!0,[UV]:!0}]);if(l.error)return l;if(!ls({matchUpFormat:r}))return{error:dD};let c="setMatchUpFormat";if(a){let u=fn({drawDefinition:n,matchUpId:a,event:s});if(u.error)return u;let d=u.matchUp;if((d==null?void 0:d.matchUpType)===Or)return{info:"Cannot set matchUpFormat when { matchUpType: TEAM }",error:Sa};d&&(d.matchUpFormat=r,yi({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:c,drawDefinition:n,matchUp:d}))}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===Or)return{error:Hh};for(let u of e){let d=At({drawDefinition:n,structureId:u});if(d.error)return d;d.structure&&(d.structure.matchUpFormat=r)}}else if(o){if((s==null?void 0:s.eventType)===Or)return{error:Hh};let u=At({drawDefinition:n,structureId:o});if(u.error)return u;u.structure&&(u.structure.matchUpFormat=r)}else n&&(n.matchUpFormat=r);return e=e??(o?[o]:void 0),cn({drawDefinition:n,structureIds:e}),{...ae}}function O1e({tieFormat:t}){let e=$a({checkCollectionIds:!1,tieFormat:t});if(e.error)return e;for(let i of t.collectionDefinitions)i.collectionId||(i.collectionId=ji());return{tieFormat:t}}function L1e({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:o}){if((i||r)&&!(i&&(o==null?void 0:o.matchUpFormat)===i||o!=null&&o.tieFormat&&r&&JSON.stringify(o.tieFormat)===JSON.stringify(r))){if(r){let a=O1e({tieFormat:r});if(a.error)return a;e.tieFormat=a.tieFormat??r}else if(i){let a=LH({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:o});if(a.error)return{info:"matchUpFormat or tieFormat error",error:a.error}}n&&(e.matchUpType=n)}return{error:void 0}}var FH={};ii(FH,{attachPolicies:()=>_m,findPolicy:()=>cg,getAppliedPolicies:()=>Bi,getPolicyDefinitions:()=>$p,mutate:()=>zre,query:()=>qre,removePolicy:()=>Wre});var zre={};ii(zre,{attachPolicies:()=>_m,removePolicy:()=>Wre});function Wre(t){let e=Ei(t,[{[ISe]:!0,_anyOf:{[ko]:!1,[xd]:!1,[qc]:!1,[n0]:!1}}]);if(e.error)return e;let i,n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return O6(t,n);if(t.tournamentRecords){let r=Object.keys(t.tournamentRecords);if(!r.length)return{error:Ge};for(let o of r){let a=t.tournamentRecords[o],s=O6(t,a);if(s.error)return s;i=!0}}else return{error:Ge};return i?{...ae}:{error:lv}}function O6(t,e){let i=Bi(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Ui({element:e,extension:{name:LT,value:i}}):ta({element:e,name:LT}),{...ae}):{error:lv}}var qre={};ii(qre,{findPolicy:()=>cg,getAppliedPolicies:()=>Bi,getPolicyDefinitions:()=>$p});var Yre={[Ml]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Id]:{positioning:Dm},[Hl]:{positioning:Dm}},positioning:oTe},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},b2=Yre;function F1e({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return se({info:"policyDefinitions must be an object",result:{error:Pe},stack:n});let r={[OT]:t==null?void 0:t[OT]};return e?B1e({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&_m({drawDefinition:i,policyDefinitions:r}),!(t!=null&&t[Ml])&&!(e!=null&&e[Ml])&&(_m({policyDefinitions:b2,drawDefinition:i}),t&&Object.assign(t,b2)),{error:void 0}}function B1e({policyDefinitions:t,appliedPolicies:e,policiesToAttach:i,drawDefinition:n}){for(let r of Object.keys(t))JSON.stringify(e==null?void 0:e[r])!==JSON.stringify(t[r])&&(i[r]=t[r]);Object.keys(i).length&&(_m({policyDefinitions:i,drawDefinition:n}),e&&Object.assign(e,i))}function $1e(t){var v,y,b,I,T;let{tournamentRecord:e,matchUpFormat:i,appliedPolicies:n,policyDefinitions:r,matchUpType:o,tieFormat:a,drawType:s,stack:l,event:c}=t,u=t.drawId?(v=c==null?void 0:c.drawDefinitions)==null?void 0:v.find(S=>S.drawId===t.drawId):void 0;u&&s!==u.drawType&&(u.drawType=s);let d=u??x1e({processCodes:t.processCodes,drawId:t.drawId,drawType:s}),p=L1e({tournamentRecord:e,drawDefinition:d,matchUpFormat:i,matchUpType:o,tieFormat:a,event:c});if(p.error)return se({result:p,stack:l});let h=F1e({appliedPolicies:n,policyDefinitions:r,drawDefinition:d,stack:l});if(h.error)return h;let f=(b=(y=u==null?void 0:u.structures)==null?void 0:y.find(S=>S.stage===ut&&S.stageSequence===1))==null?void 0:b.structureId,m=u?(I=u.structures)==null?void 0:I.filter(S=>S.stage===Tt):[],g=(m==null?void 0:m.length)===1&&!((T=m[0].matchUps)!=null&&T.length)&&m[0].structureId;return{drawDefinition:d,structureId:f,existingDrawDefinition:u,existingQualifyingPlaceholderStructureId:g}}function V1e(t){var u,d;let e="generateOrGetExisting",i=[],n=[],r=$1e(t);if(r.error)return se({result:r,stack:e});let o=r.existingDrawDefinition,a=r.drawDefinition??{},s=r.structureId,l=t.drawEntries??t.eventEntries??[],c=r.existingQualifyingPlaceholderStructureId&&f1e({...t,...r})||N1e({...t,...r,entries:l});return c.error?se({result:c,stack:e}):((u=c.positioningReports)!=null&&u.length&&i.push(...c.positioningReports??[]),(d=c.conflicts)!=null&&d.length&&n.push(...c.conflicts??[]),a=c.drawDefinition,s=c.structureId,{existingDrawDefinition:o,positioningReports:i,drawDefinition:a,structureId:s,conflicts:n,entries:l})}function j1e(t){var m,g,v;let{qualifyingPlaceholder:e,qualifyingProfiles:i,existingDrawDefinition:n,positioningReports:r,appliedPolicies:o,qualifyingOnly:a,drawDefinition:s,seedingProfile:l,participants:c,structureId:u,entries:d,stack:p}=t,h=e&&!(i!=null&&i.length)&&!n,f=[];if(i){let y=(S,w)=>S.stageSequence-w.stageSequence,b=(S,w)=>S.roundTarget-w.roundTarget,I=[],T=1;i.sort(b);for(let S of i){if(!Array.isArray(S.structureProfiles))return se({info:Td("structureProfiles"),result:{error:gt},stack:p});T=S.roundTarget||T;let w=((m=S.structureProfiles)==null?void 0:m.sort(y))||[],U=1;for(let D of w){let{qualifyingRoundNumber:E,qualifyingPositions:C,seededParticipants:M,seedingScaleName:N,seedsCount:R=0,seedByRanking:A,placeByes:_,drawSize:k}=D,O=Gre({...t,seedingProfile:D.seedingProfile??l,stageSequence:U,qualifyingRoundNumber:E,preparedStructureIds:I,qualifyingPositions:C,seededParticipants:M,stage:Tt,seedingScaleName:N,appliedPolicies:o,drawDefinition:s,qualifyingOnly:a,seedByRanking:A,participants:c,roundTarget:T,seedsCount:R,placeByes:_,drawSize:k,entries:d});if(O.error)return O;O.structureId&&I.push(O.structureId),U+=1,(g=O.conflicts)!=null&&g.length&&f.push(...O.conflicts),(v=O.positioningReport)!=null&&v.length&&r.push({[Tt]:O.positioningReport})}T+=1}}else if(u&&h){let y=Ys({structureName:vo(Tt),stage:Tt}),{link:b}=QD({sourceStructureId:y.structureId,targetStructureId:u,sourceRoundNumber:0,linkType:gp});s.structures||(s.structures=[]),s.structures.push(y),s.links||(s.links=[]),s.links.push(b)}return{qualifyingConflicts:f,error:void 0}}var BH={};ii(BH,{addGoesTo:()=>Am,allCompetitionMatchUps:()=>xc,allDrawMatchUps:()=>Ia,allEventMatchUps:()=>Hp,allPlayoffPositionsFilled:()=>Kj,allTournamentMatchUps:()=>to,analyzeDraws:()=>lP,analyzeMatchUp:()=>eU,analyzeTournament:()=>YH,bulkUpdatePublishedEventIds:()=>XH,calculateWinCriteria:()=>Hy,categoryCanContain:()=>$A,checkMatchUpIsComplete:()=>mm,checkValidEntries:()=>qA,compareTieFormats:()=>Sp,competitionScheduleMatchUps:()=>mP,credits:()=>H1e,drawMatchUps:()=>dG,eventMatchUps:()=>p_,filterParticipants:()=>WD,findDrawDefinition:()=>hH,findExtension:()=>Qt,getAllDrawMatchUps:()=>Tr,getAllEventData:()=>JH,getAllStructureMatchUps:()=>_i,getAllowedDrawTypes:()=>i_,getAllowedMatchUpFormats:()=>zH,getAppliedPolicies:()=>Bi,getAssignedParticipantIds:()=>fg,getAvailableMatchUpsCount:()=>GA,getAvailablePlayoffProfiles:()=>eP,getCategoryAgeDetails:()=>rP,getCheckedInParticipantIds:()=>Ry,getCompetitionDateRange:()=>r_,getCompetitionMatchUps:()=>QT,getCompetitionParticipants:()=>$H,getCompetitionPenalties:()=>WH,getCompetitionVenues:()=>dP,getCourtInfo:()=>DA,getCourts:()=>pG,getDrawData:()=>o_,getDrawDefinitionTimeItem:()=>Rj,getDrawParticipantRepresentativeIds:()=>dH,getDrawTypeCoercion:()=>cP,getEligibleVoluntaryConsolationParticipants:()=>uH,getEntriesAndSeedsCount:()=>u_,getEvent:()=>mG,getEventData:()=>a_,getEventMatchUpFormatTiming:()=>iG,getEventProperties:()=>hG,getEventPublishStatus:()=>fl,getEventStructures:()=>kA,getEventTimeItem:()=>VD,getEvents:()=>fG,getFlightProfile:()=>Kn,getLinkedTournamentIds:()=>SD,getMatchUpCompetitiveProfile:()=>OD,getMatchUpContextIds:()=>sG,getMatchUpDailyLimits:()=>f_,getMatchUpDailyLimitsUpdate:()=>nG,getMatchUpDependencies:()=>nc,getMatchUpFormat:()=>lG,getMatchUpFormatTiming:()=>FD,getMatchUpFormatTimingUpdate:()=>tG,getMatchUpScheduleDetails:()=>PA,getMatchUpType:()=>CA,getMatchUpsMap:()=>Uo,getMatchUpsStats:()=>cG,getMaxEntryPosition:()=>eG,getModifiedMatchUpFormatTiming:()=>d_,getPairedParticipant:()=>zl,getParticipantEventDetails:()=>VH,getParticipantIdFinishingPositions:()=>pH,getParticipantMembership:()=>jH,getParticipantResults:()=>nP,getParticipantScaleItem:()=>ZI,getParticipantSchedules:()=>HH,getParticipantSignInStatus:()=>GH,getParticipantTimeItem:()=>Nj,getParticipants:()=>zn,getPersonRequests:()=>vg,getPolicyDefinitions:()=>$p,getPositionAssignments:()=>ZT,getPositionsPlayedOff:()=>w0,getPredictiveAccuracy:()=>aG,getProfileRounds:()=>c_,getPublishState:()=>ky,getRoundMatchUps:()=>la,getRounds:()=>uG,getScaleValues:()=>o0,getScaledEntries:()=>Vy,getScheduledRoundsDetails:()=>pP,getSchedulingProfile:()=>Wp,getSchedulingProfileIssues:()=>QH,getSeedingThresholds:()=>Hj,getSeedsCount:()=>uP,getStructureSeedAssignments:()=>ol,getTeamLineUp:()=>Nm,getTieFormat:()=>ZH,getTimeItem:()=>Fu,getTournamentIds:()=>ID,getTournamentInfo:()=>jy,getTournamentPenalties:()=>n_,getTournamentPersons:()=>qH,getTournamentStructures:()=>Yj,getTournamentTimeItem:()=>jD,getValidGroupSizes:()=>KD,getVenueData:()=>qI,getVenuesAndCourts:()=>zp,isAdHoc:()=>ss,isCompletedStructure:()=>Xh,isValidForQualifying:()=>SH,isValidMatchUpFormat:()=>ls,matchUpActions:()=>WA,participantScaleItem:()=>ad,participantScheduledMatchUps:()=>rG,positionActions:()=>wH,publicFindVenue:()=>Pj,tallyParticipantResults:()=>S0,tieFormatGenderValidityCheck:()=>FA,tournamentMatchUps:()=>h_,validMatchUp:()=>SA,validMatchUps:()=>hl,validateCollectionDefinition:()=>oP,validateLineUp:()=>_A});function H1e(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `}var Kre={};ii(Kre,{filterParticipants:()=>WD,getCompetitionParticipants:()=>$H,getPairedParticipant:()=>zl,getParticipantEventDetails:()=>VH,getParticipantMembership:()=>jH,getParticipantScaleItem:()=>ZI,getParticipantSchedules:()=>HH,getParticipantSignInStatus:()=>GH,getParticipantTimeItem:()=>Nj,getParticipants:()=>zn,getScaleValues:()=>o0,participantScaleItem:()=>ad,validateLineUp:()=>_A});function $H(t){let{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:On};let i=[],n={},r={},o={},a=[],s={},l=[];for(let c of Object.values(e)){let{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=zn({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(o,g),i.push(...h??[]),a.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:o,participantMap:n,mappedMatchUps:s,participants:i,...ae,matchUps:a}}function VH({tournamentRecord:t,participantId:e}){if(!t)return{error:Ge};if(!e)return{error:Rr};let i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[en,jt].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>{let r=((n==null?void 0:n.entries)??[]).map(o=>o.participantId);return sa(r,i)}).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function jH({tournamentRecord:t,participantId:e}){if(!t)return{error:Ge};if(!e)return{error:Rr};let{participants:i}=zn({participantFilters:{participantTypes:[en,jt,ks]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{let o=r.participantType;return o&&(n[o]||(n[o]=[]),n[o].push(r)),n},{})}function HH({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:Ge};if(typeof t!="object")return{error:Lp,context:{participantFilters:t}};let i={eventIds:t.eventIds},n=to({tournamentRecord:e,contextFilters:i}).matchUps??[],r=Object.assign({},...n.map(l=>({[l.matchUpId]:l}))),o=n.filter(({schedule:l})=>l&&Object.keys(l).length),a=nc({tournamentRecord:e,matchUps:n}).sourceMatchUpIds??[],s={};for(let l of o){let{sides:c}=l,u,d=(c==null?void 0:c.map(h=>{if(h.participant)return[h.participant].concat(...h.participant.individualParticipants||[]);a[l.matchUpId]&&!u&&(u=(a[l.matchUpId]||[]).map(f=>r[f]).filter(({winningSide:f,bye:m})=>!f&&!m))}).filter(Boolean).flat())??[];for(let h of d){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].matchUps.push(l)}let p=(u==null?void 0:u.map(({sides:h})=>h).flat().map(({participant:h})=>h&&[h].concat(...h.individualParticipants||[])).filter(Boolean).flat())||[];for(let h of p){let{participantId:f}=h;s[f]||(s[f]={potentialMatchUps:[],participant:h,matchUps:[]}),s[f].potentialMatchUps.push(l)}}return{participantSchedules:Object.values(s).filter(({participant:l})=>!(t.participantIds&&!t.participantIds.includes(l.participantId)||t.participantTypes&&!t.participantTypes.includes(l.participantType))),...ae}}function GH({tournamentRecord:t,participantId:e}){if(!t)return{error:Ge};if(!e)return{error:Rr};let{participant:i}=hg({tournamentRecord:t,participantId:e});if(!i)return{error:Jn};let{timeItem:n}=Fu({itemType:ED,element:i});return n&&n.itemValue===GT&&GT}var Zre={};ii(Zre,{analyzeDraws:()=>lP,analyzeTournament:()=>YH,getAllowedDrawTypes:()=>i_,getAllowedMatchUpFormats:()=>zH,getAppliedPolicies:()=>Bi,getCompetitionDateRange:()=>r_,getCompetitionPenalties:()=>WH,getPolicyDefinitions:()=>$p,getTournamentInfo:()=>jy,getTournamentPenalties:()=>n_,getTournamentPersons:()=>qH,getTournamentStructures:()=>Yj,getTournamentTimeItem:()=>jD});function zH({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:Ge};let{appliedPolicies:n}=Bi({tournamentRecord:t});return(((r=n==null?void 0:n[vd])==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:o,categoryTypes:a})=>!e&&!a||e&&(o==null?void 0:o.includes(e))||i&&(a==null?void 0:a.includes(i)))}function i_({tournamentRecord:t,categoryName:e,categoryType:i}){var r;if(!t)return{error:Ge};let{appliedPolicies:n}=Bi({tournamentRecord:t});return(((r=n==null?void 0:n[TM])==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:o,categoryTypes:a})=>!e&&!a||e&&(o==null?void 0:o.includes(e))||i&&(a==null?void 0:a.includes(i)))}function n_({tournamentRecord:t}){if(!t)return{error:Ge};let e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{let{participantId:r}=n;return(n.penalties??[]).forEach(o=>{let{penaltyId:a}=o||{};i[a]?i[a].participants.push(r):i[a]={...o,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function WH({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:On};let e=[];for(let i of Object.values(t)){let{penalties:n}=n_({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function Xre({event:t}){return{eventInfo:(({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:o,matchUpFormat:a,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f})=>({eventId:e,eventName:i,eventType:n,eventLevel:r,surfaceCategory:o,matchUpFormat:a,category:s,gender:l,startDate:c,endDate:u,ballType:d,discipline:p,onlineResources:h,notes:f}))(t)}}var G1e={[s0]:{policyName:"Staff Privacy Policy",participant:{contacts:!1,individualParticipants:!1,individualParticipantIds:!1,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantRoleResponsibilities:!0,participantStatus:!0,penalties:!1,representing:!0,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},z1e=G1e;function jy(t){var a,s,l,c;let{tournamentRecord:e}=t??{};if(!e)return{error:Ge};let i=(({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:S,updatedAt:w})=>({tournamentId:u,tournamentRank:d,tournamentStatus:p,formalName:h,tournamentName:f,promotionalName:m,onlineResources:g,localTimeZone:v,startDate:y,endDate:b,hostCountryCode:I,venues:T,notes:S,updatedAt:w}))(e),n=zn({participantFilters:{participantRoles:[Cte,Oj,Ete,Mte,Nte]},policyDefinitions:z1e,tournamentRecord:e}).participants;n&&(i.tournamentContacts=n);let r=((c=(l=(s=(a=ky({tournamentRecord:e}))==null?void 0:a.publishState)==null?void 0:s.tournament)==null?void 0:l.status)==null?void 0:c.publishedEventIds)||[],o=[];for(let u of e.events??[])if(!(t!=null&&t.usePublishState)||r.includes(u.eventId)){let d=Xre({event:u}).eventInfo;d&&o.push(d)}return i.eventInfo=o,{tournamentInfo:dt(i,!1,!0),...ae}}function r_({tournamentRecords:t}){if(!ln(t))return{error:On};let e=Object.keys(t??{}).reduce((r,o)=>{let a=t[o],{tournamentInfo:{startDate:s,endDate:l}}=jy({tournamentRecord:a}),c=s&&new Date(Wt(s));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);let u=l&&new Date(Wt(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&Wt(e.startDate.toISOString()),n=e.endDate&&Wt(e.endDate.toISOString());return!i||!n?{error:YJ}:{startDate:i,endDate:n}}function qH({tournamentRecord:t,participantFilters:e}){if(!t)return{error:Ge};let i=t.participants||[];e&&(i=WD({participants:i,participantFilters:e,tournamentRecord:t}));let n={},r=o=>{if(o.person){let{personId:a}=o.person;n[a]?n[a].participantIds.push(o.participantId):n[a]={...o.person,participantIds:[o.participantId]}}};return i.forEach(o=>{o.person&&r(o)}),{tournamentPersons:Object.values(n)}}function W1e(t){var o,a,s,l,c,u,d;let e=((a=(o=t.participants)==null?void 0:o.filter(({participantType:p})=>p===en))==null?void 0:a.length)===2,i=((s=t.events)==null?void 0:s.length)===1&&t.events[0],n=((l=i==null?void 0:i.drawDefinitions)==null?void 0:l.length)===1&&i.drawDefinitions[0],r=((d=(u=((c=n==null?void 0:n.structures)==null?void 0:c.length)===1&&n.structures[0])==null?void 0:u.positionAssignments)==null?void 0:d.length)===2;return!!(i.tieFormat&&e&&r)}function YH({tournamentRecord:t}){if(!t)return{error:Ge};let{drawsAnalysis:e}=lP({tournamentRecord:t}),i={isDual:W1e(t),drawsAnalysis:e};return{...ae,analysis:i}}var Jre={};ii(Jre,{compareTieFormats:()=>Sp,getTieFormat:()=>ZH,tieFormatGenderValidityCheck:()=>FA,validateCollectionDefinition:()=>oP});function GM(t){var r;if(!t)return{};let e=[],i=t.tieFormatName,n=(r=t.collectionDefinitions)==null?void 0:r.map(o=>{let{matchUpType:a,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=o;e.includes(s)||e.push(s);let d=c==null?void 0:c.ageCategoryCode;return[l,a===Cm?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&i||"UNNAMED",matchUpFormats:e,tieFormatDesc:n}}function Sp({considerations:t={},descendant:e,ancestor:i}){var T,S;let n={},r={},{matchUpFormats:o,tieFormatDesc:a}=GM(e),{matchUpFormats:s,tieFormatDesc:l}=GM(i),c=Zt((o??[]).filter(w=>!(s??[]).includes(w)).concat((s??[]).filter(w=>!(o??[]).includes(w)))),u=!!(t!=null&&t.collectionName&&e.collectionDefinitions.map(({collectionName:w})=>w).join("|")!==i.collectionDefinitions.map(({collectionName:w})=>w).join("|")),d=!!(t!=null&&t.collectionOrder&&e.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")!==i.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")),p=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(w=>({[w.collectionId]:w}))),h=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(w=>({[w.collectionId]:w})));n.collectionIds=n6(Object.keys(p),Object.keys(h)),r.collectionIds=n6(Object.keys(h),Object.keys(p)),n.collectionsValue=L6(p),r.collectionsValue=L6(h),n.groupsCount=((T=i==null?void 0:i.collectionGroups)==null?void 0:T.length)??(0-(((S=e==null?void 0:e.collectionGroups)==null?void 0:S.length)??0)||0),r.groupsCount=n.groupsCount?-1*n.groupsCount:0;let f=n.collectionsValue.totalValue-r.collectionsValue.totalValue,m=n.collectionsValue.totalMatchUps-r.collectionsValue.totalMatchUps,g=r.collectionsValue.assignmentValues.length!==n.collectionsValue.assignmentValues.length,v=r.collectionsValue.assignmentValues.some((w,U)=>{let D=n.collectionsValue.assignmentValues[U];return!D||w.valueKey!==D.valueKey||w.value!==D.value?!0:Array.isArray(w.value)?w.value.every((E,C)=>D.value[C]===E):!1}),y=u||d||l!==a||g||v||f!==0,b=[...r.collectionsValue.invalidValues,...n.collectionsValue.invalidValues],I=b.length&&b;return{matchUpFormatDifferences:c,matchUpCountDifference:m,descendantDifferences:n,ancestorDifferences:r,orderDifference:d,valueDifference:f,nameDifference:u,descendantDesc:a,ancestorDesc:l,...ae,different:y,invalid:I}}function L6(t){let e=[],i=[],n=0;return{totalValue:Object.keys(t).sort(RA).reduce((r,o)=>{let a=t[o],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g]));f.length!==1&&e.push({collectionId:o});let m=f[0];if(m){let g=m==="collectionValueProfiles"?Object.values(s):h[m];i.push({valueKey:m,value:g})}return n+=c,s?r+s.reduce((g,v)=>g+v.value,0):c?Bt(u)?r+u*c:Bt(d)?r+d*c:Bt(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function KH(t){Object.assign(t,{inContext:!0});let{matchUp:e,error:i}=Qre(t);return{matchUp:dt(e,!0,!0),error:i}}function Qre({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:o,nextMatchUps:a,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var f;if(!i)return{error:Ge};if(typeof s!="string")return{error:To};if(!o||!d){let m=(to({tournamentRecord:i,nextMatchUps:a}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:Ao};({eventId:c,drawId:u}=m),{event:d,drawDefinition:o}=Ta({tournamentRecord:i,eventId:c,drawId:u})}if(!o)return{error:ns};r&&!n&&(n=jp({tournamentRecord:i,contextProfile:r}));let p={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:h=[]}=Ay({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(a){let m=(Ia({context:l?p:void 0,participants:h,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:o,nextMatchUps:a,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:Ao};let g=(f=o==null?void 0:o.structures)==null?void 0:f.find(v=>v.structureId===m.structureId);return{drawDefinition:o,structure:g,matchUp:m}}else{let{matchUp:m,structure:g}=fn({context:l?p:void 0,tournamentParticipants:h,afterRecoveryTimes:e,contextContent:n,drawDefinition:o,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:o}}}function ZH({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:o,drawId:a,event:s}){var h,f,m,g,v;if(!t)return{error:Ge};if(!a&&!s&&!i&&!n)return se({result:{error:gt},stack:"getTieFormat"});o&&!s&&(s=(h=t.events)==null?void 0:h.find(y=>y.eventId===o));let l=KH({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:a,event:s});if(n&&(l!=null&&l.error))return l;if(!e&&(l!=null&&l.drawDefinition)&&(e=l==null?void 0:l.drawDefinition),r=r??(l==null?void 0:l.structure),!r&&i&&!n){if(!e)return{error:Wc};let y=At({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}let c=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((f=Vo({structure:r,drawDefinition:e,event:s}))==null?void 0:f.tieFormat),u=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((m=Vo({drawDefinition:e,event:s}))==null?void 0:m.tieFormat),d=(g=Vo({event:s}))==null?void 0:g.tieFormat,p=(v=Vo({matchUp:l==null?void 0:l.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:v.tieFormat;return{...ae,matchUp:l==null?void 0:l.matchUp,structureDefaultTieFormat:ho(c),eventDefaultTieFormat:ho(d),drawDefaultTieFormat:ho(u),tieFormat:ho(p),structure:r}}var eoe={};ii(eoe,{bulkUpdatePublishedEventIds:()=>XH,getAllEventData:()=>JH,getCourtInfo:()=>DA,getDrawData:()=>o_,getEventData:()=>a_,getEventPublishStatus:()=>fl,getPublishState:()=>ky,getVenueData:()=>qI});function XH({tournamentRecord:t,outcomes:e}){var r;if(!t)return{error:Ge};if(!(e!=null&&e.length))return{error:gt,info:"Missing outcomes"};let i=e.reduce((o,a)=>{let{drawId:s,eventId:l}=a;return l&&s&&(o[l]?o[l].includes(s)||o[l].push(s):o[l]=[s]),o},{}),n=Object.keys(i);return{publishedEventIds:((r=t.events)==null?void 0:r.filter(o=>n.includes(o.eventId))).filter(o=>{let a=fl({event:o}),{drawDetails:s,drawIds:l}=a??{},{eventId:c}=o;return i[c].filter(u=>{let d=s?Object.keys(a.drawDetails).filter(p=>kj({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(o=>o.eventId),eventIdPublishedDrawIdsMap:i}}function toe({dates:t=[],extension:e}){var n;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;let i=ln(e.value)?(n=e.value)==null?void 0:n.dates:void 0;if(Array.isArray(i))return i!=null&&i.length?!!i.filter(r=>!t.length||t.includes(r)).length:!1}function ioe({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var a;let r={...dt(n,t,!0),venueId:i.venueId},{extension:o}=Qt({name:Pc,element:n});if(e&&o){let s=ln(o.value)?(a=o.value)==null?void 0:a.dates:void 0,l=(o==null?void 0:o.value)===!0?[]:r.dateAvailability.map(c=>{let u=c.date;if(!(!u||s.includes(u)))return c}).filter(Boolean);r.dateAvailability=l}return{inContextCourt:r}}function zp(t){let{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,o=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},a=[],s=[],l=[],c=[];return Object.keys(o).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{let d=o[u];for(let p of d.venues??[])if(!(n.length&&!n.includes(p.venueId))){if(i){let{extension:h}=Qt({name:Pc,element:p});if(h!=null&&h.value)continue}a.includes(p.venueId)||(c.push(dt(p,e,!0)),a.push(p.venueId));for(let h of p.courts??[])if(!s.includes(h.courtId)){if(i){let{extension:m}=Qt({name:Pc,element:h});if(toe({extension:m,dates:r}))continue}let{inContextCourt:f}=ioe({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),s.push(h.courtId)}}}),{courts:l,venues:c,...ae}}function q1e({convertExtensions:t,tournamentRecord:e,ignoreDisabled:i,dates:n}){if(!e)return{error:On};let r=dt(e.venues??[],t).filter(a=>{if(!i)return a;let{extension:s}=Qt({name:Pc,element:a});return!(s!=null&&s.value)&&a}).filter(Boolean),o=r.reduce((a,s)=>{let l=((s==null?void 0:s.courts)||[]).filter(c=>{if(!i&&!(n!=null&&n.length))return c;let{extension:u}=Qt({name:Pc,element:c});return toe({extension:u,dates:n})}).filter(Boolean).map(c=>{let{inContextCourt:u}=ioe({convertExtensions:t,ignoreDisabled:i,venue:s,court:c});return u});return l.length?a.concat(l):a},[]);return{venues:r,courts:o}}function dP({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:On}:Object.keys(t).reduce((n,r)=>{let o=t[r],{venues:a}=q1e({tournamentRecord:o,dates:i});return a==null||a.forEach(s=>{let{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function JH({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:Ge};let i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=jy({tournamentRecord:t}),{venues:o}=zp({tournamentRecord:t}),a=i.map(s=>{let{eventId:l}=s,c=Xre({event:s}).eventInfo,u=LD({tournamentRecord:t,event:s}).scheduleTiming,d=(s.drawDefinitions||[]).map(h=>{let f=(({drawId:b,drawName:I,matchUpFormat:T,updatedAt:S})=>({matchUpFormat:T,updatedAt:S,drawName:I,drawId:b}))(h),{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}=v0({requireParticipants:!0,tournamentParticipants:n,context:{eventId:l},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:u,drawDefinition:h,event:s});return{drawInfo:f,matchUps:{abandonedMatchUps:m,completedMatchUps:g,upcomingMatchUps:v,pendingMatchUps:y}}}),p=fl({event:s});return Object.assign(c,{drawsData:d,publish:p}),c});return{allEventData:{tournamentInfo:r,venuesData:o,eventsData:a}}}function noe({publishStatus:t,drawId:e}){var i,n,r;return t!=null&&t.drawDetails?(r=(n=(i=t.drawDetails)==null?void 0:i[e])==null?void 0:n.publishingDetail)==null?void 0:r.published:t!=null&&t.drawIds?t.drawIds.includes(e):!0}function o_(t){var D,E;let{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:o=!0,usePublishState:a,status:s=ic,drawDefinition:l,noDeepCopy:c,sortConfig:u,context:d,event:p}=t;if(!l)return{error:lt};let h=(({matchUpFormat:C,updatedAt:M,drawType:N,drawName:R,drawId:A})=>({matchUpFormat:C,updatedAt:M,drawName:R,drawType:N,drawId:A}))(l),f,m,{allStructuresLinked:g,sourceStructureIds:v,hasDrawFeedProfile:y,structureGroups:b}=xA({drawDefinition:l});if(!g)return{error:FJ};let I=(t==null?void 0:t.publishStatus)??fl({event:p,status:s}),T=t.eventPublished??!!((E=(D=ky({event:p}).publishState)==null?void 0:D.status)!=null&&E.published),S=!1,w=!1,U=b.map(C=>{let M={},N=C.map(R=>{let{structure:A}=At({drawDefinition:l,structureId:R}),{seedAssignments:_}=ol({drawDefinition:l,structure:A});return(A==null?void 0:A.stage)===ut&&A.stageSequence===1&&(f=_),(A==null?void 0:A.stage)===Tt&&A.stageSequence===1&&(m=_),A}).sort((R,A)=>Ey(R,A,u)).map(R=>{var z;if(!R)return;let A=R==null?void 0:R.structureId,_=[];R.stage&&[ut,Io,$n].includes(R.stage)&&(_=f),(R==null?void 0:R.stage)===Tt&&(_=m);let{matchUps:k,roundMatchUps:O,roundProfile:F}=_i({seedAssignments:(z=R==null?void 0:R.seedAssignments)!=null&&z.length?void 0:_,context:{drawId:h.drawId,...d},tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:a,publishStatus:I,drawDefinition:l,inContext:o,structure:R,event:p}),{positionAssignments:B}=Yi({structure:R}),$=B==null?void 0:B.filter(as(hd)).map(G=>{let{drawPosition:W,participantId:K}=G,{extension:Z}=Qt({element:G,name:Wh});return w=!0,{participantResult:Z==null?void 0:Z.value,participantId:K,drawPosition:W}});if(!($!=null&&$.length)&&k.length&&t.allParticipantResults){let{subOrderMap:G}=Cie({positionAssignments:B}),W=S0({matchUpFormat:R.matchUpFormat,policyDefinitions:n,subOrderMap:G,matchUps:k});$=B==null?void 0:B.filter(as(hd)).map(K=>{let{drawPosition:Z,participantId:Y}=K;return w=!0,{participantResult:Y&&W.participantResults[Y],participantId:Y,drawPosition:Z}})}let V=R?(({stageSequence:G,structureName:W,structureType:K,matchUpFormat:Z,stage:Y})=>({stageSequence:G,structureName:W,structureType:K,matchUpFormat:Z,stage:Y}))(R):{};V.sourceStructureIds=v[A],V.hasDrawFeedProfile=y[A],V.positionAssignments=B,V.structureActive=k.reduce((G,W)=>{var Z;let K=[or,Fp,Pi,Go,Oi,Jl,Er,mr].includes(W.matchUpStatus);return G||K||!!W.winningSide||!!((Z=W.score)!=null&&Z.scoreStringSide1)},!1);let H=k.reduce((G,W)=>G&&[Ni,or,Go,Oi,Pi,Us].includes(W.matchUpStatus),!!k.length);return V.structureCompleted=H,M[A]=H,V.structureActive&&(S=!0),{...V,participantResults:$,seedAssignments:_,roundMatchUps:O,roundProfile:F,structureId:A}});return N.forEach(R=>{var A;i||delete R.positionAssignments,R.sourceStructuresComplete=(A=R.sourceStructureIds)==null?void 0:A.every(_=>M[_])}),N}).flat();return h.drawActive=S,h.participantPlacements=w,h.drawGenerated=U==null?void 0:U.reduce((C,M)=>C||!!(M!=null&&M.roundMatchUps),!1),h.drawCompleted=U==null?void 0:U.reduce((C,M)=>C&&M.structureCompleted,!0),h.drawPublished=a?T&&noe({publishStatus:I,drawId:h.drawId}):void 0,{structures:!a||h.drawPublished?c?U:dt(U,!1,!0):void 0,drawInfo:c?h:dt(h,!1,!0),...ae}}function a_(t){var M,N;let{includePositionAssignments:e,participantsProfile:i,policyDefinitions:n,usePublishState:r,status:o=ic,sortConfig:a}=t,s=Ei(t,[{tournamentRecord:!0},{[MV]:{event:!1,eventId:!1}}]);if(s.error)return s;let l=dt(t.tournamentRecord,!1,!0),c=t.event?void 0:Ta({tournamentRecord:l,eventId:t.eventId}).event,u=t.event?dt(t.event,!1,!0):c&&dt(c,!1,!0)||void 0;if(!u)return{error:rs};let{eventId:d}=u,{tournamentId:p,endDate:h}=l,f=fl({event:u,status:o}),m=ky({event:u}).publishState??{},g=!!((M=m==null?void 0:m.status)!=null&&M.published),{participants:v}=zn({withGroupings:!0,withEvents:!1,withDraws:!1,policyDefinitions:n,...i,tournamentRecord:l}),y=({stage:R,drawId:A})=>{var k,O,F;if(!r)return!0;let _=(O=(k=f==null?void 0:f.drawDetails)==null?void 0:k[A])==null?void 0:O.stageDetails;return!_||!Object.keys(_).length?!0:(F=_[R])==null?void 0:F.published},b=({structureId:R,drawId:A})=>{var k,O,F;if(!r)return!0;let _=(O=(k=f==null?void 0:f.drawDetails)==null?void 0:k[A])==null?void 0:O.structureDetails;return!_||!Object.keys(_).length?!0:(F=_[R])==null?void 0:F.published},I=({drawId:R})=>r?noe({publishStatus:f,drawId:R}):!0,T=({drawId:R,structure:A})=>{var k,O,F,B;if(!r)return A;let _=(B=(F=(O=(k=f==null?void 0:f.drawDetails)==null?void 0:k[R])==null?void 0:O.structureDetails)==null?void 0:F[A.structureId])==null?void 0:B.roundLimit;if(Bt(_)){let $=it(1,_+1),V={},H={};for(let z of $)A.roundMatchUps[z]&&(V[z]=A.roundMatchUps[z],H[z]=A.roundProfile[z]);A.roundMatchUps=V,A.roundProfile=H}return A},S=u.drawDefinitions||[],w=!r||g?S.filter(I).map(R=>(({drawInfo:A,structures:_})=>({...A,structures:_}))(o_({allParticipantResults:t.allParticipantResults,context:{eventId:d,tournamentId:p,endDate:h},includePositionAssignments:e,tournamentParticipants:v,noDeepCopy:!0,policyDefinitions:n,tournamentRecord:l,usePublishState:r,drawDefinition:R,publishStatus:f,sortConfig:a,event:u}))).map(({structures:R,...A})=>{let _=R==null?void 0:R.filter(({stage:k,structureId:O})=>b({structureId:O,drawId:A.drawId})&&y({stage:k,drawId:A.drawId})).map(k=>T({drawId:A.drawId,structure:k}));return{...A,structures:_}}).filter(R=>{var A;return(A=R.structures)==null?void 0:A.length}):void 0,{tournamentInfo:U}=jy({tournamentRecord:l}),D=(l.venues||[]).map(R=>(({venueData:A})=>({...A}))(qI({tournamentRecord:l,venueId:R.venueId}))),E=(({eventId:R,eventName:A,eventType:_,eventLevel:k,surfaceCategory:O,matchUpFormat:F,category:B,gender:$,startDate:V,endDate:H,ballType:z,discipline:G})=>({eventId:R,eventName:A,eventType:_,eventLevel:k,surfaceCategory:O,matchUpFormat:F,category:B,gender:$,startDate:V,endDate:H,ballType:z,discipline:G}))(u),C={tournamentInfo:U,venuesData:D,eventInfo:E,drawsData:w};return C.eventInfo.publishState=m,C.eventInfo.published=(N=m==null?void 0:m.status)==null?void 0:N.published,{...ae,eventData:C,participants:v}}var roe={};ii(roe,{getPersonRequests:()=>vg,getProfileRounds:()=>c_,getScheduledRoundsDetails:()=>pP,getSchedulingProfile:()=>Wp,getSchedulingProfileIssues:()=>QH});function s_({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:o,tournamentId:a,eventType:s,eventId:l}){if(!ls({matchUpFormat:n}))return{error:dD};let c=Object.keys(i).filter(d=>!a||d===a),u;return c.forEach(d=>{var f;if(u)return;let p=i[d],h=l?(f=Ta({tournamentRecord:p,eventId:l}))==null?void 0:f.event:void 0;return u=FD({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:o,eventType:s,event:h}),(u==null?void 0:u.averageMinutes)||(u==null?void 0:u.recoveryMinutes)}),{recoveryMinutes:(u==null?void 0:u.recoveryMinutes)||t,averageMinutes:(u==null?void 0:u.averageMinutes)||e,typeChangeRecoveryMinutes:(u==null?void 0:u.typeChangeRecoveryMinutes)||(u==null?void 0:u.recoveryMinutes)||t}}function pP({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:o}){if(typeof i!="object")return{error:On};if(!Array.isArray(o))return{error:gt,info:Td("rounds")};let a={},s=[];o.sort((p,h)=>(p.sortOrder??0)-(h.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>p0({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=xc({nextMatchUps:!0,tournamentRecords:i}));let l=0,c={},u={},d={};return{scheduledRoundsDetails:o.flatMap(p=>{var T;let h=p.periodLength||n,f=[];e!=null&&e[p.structureId]?f.push(...e[p.structureId]):f.push(p.structureId);let m=r?Jg({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:f,matchUps:r}).sort(_y):[],{segmentNumber:g,segmentsCount:v}=p.roundSegment||{};if(Bt(g)&&kc(m==null?void 0:m.length)&&kc(v)&&g>0&&g<=v&&v<(m==null?void 0:m.length)&&!((T=p.matchUpIds)!=null&&T.length)){let S=m.length/v,w=S*(g-1);m=m.slice(w,w+S)}let y=i[p.tournamentId],b=Ta({drawId:p.drawId,tournamentRecord:y}).event,I=[];for(let S of m){let w=S.matchUpFormat;w&&(a[w]||(a[w]=[],a[w].push(S)),I.push(w))}for(let S of I){let{eventType:w,category:U}=b??{},{categoryName:D,ageCategoryCode:E}=U??{},{typeChangeRecoveryMinutes:C,recoveryMinutes:M,averageMinutes:N,error:R}=s_({categoryName:D??E,categoryType:U==null?void 0:U.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:S,eventType:w});if(R)return{error:R,round:p};let A=m.filter(k=>(t||!Nr.includes(k.matchUpStatus))&&k.matchUpStatus!==Ni).map(Br);A.forEach(k=>{d[k]={typeChangeRecoveryMinutes:C,recoveryMinutes:M,averageMinutes:N},c[k]=M,u[k]=N}),s.push(...A),l=Math.max(N||0,l);let _=`${N}|${h}`;return{roundPeriodLength:h,recoveryMinutes:M,averageMinutes:N,matchUpIds:A,hash:_}}}),greatestAverageMinutes:l,matchUpFormatCohorts:a,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...ae}}function ooe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){let r=[],o=t==null?void 0:t.map(s=>{let l=Wt(s==null?void 0:s.scheduleDate);if(!l){r.push(`Invalid date: ${s==null?void 0:s.scheduledDate}`);return}let c=((s==null?void 0:s.venues)||[]).map(u=>{let{rounds:d,venueId:p}=u;if(!(e!=null&&e.includes(p))){r.push(`Missing venueId: ${p}`);return}let h=d.filter(f=>{let m=i.includes(f.eventId)&&n.includes(f.drawId);return m||r.push(`Invalid eventId: ${f.eventId} or drawId: ${f.drawId}`),m});if(h.length)return{venueId:p,rounds:h}}).filter(Boolean);return c.length&&l&&{...s,venues:c}}).filter(Boolean),a=r.length;return{updatedSchedulingProfile:o,modifications:a,issues:r}}function l_({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Pe};let{venueIds:i,tournamentsMap:n}=K1e({tournamentRecords:t}),r,o,a=e.every(s=>{let{scheduleDate:l,venues:c}=s;return ws(l)?c.every(u=>{let{venueId:d,rounds:p}=u;return typeof d!="string"?(o="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var U,D,E,C;if(!h)return o="empty round",!1;let{roundSegment:f,tournamentId:m,structureId:g,roundNumber:v,eventId:y,drawId:b}=h,I=(C=(E=(D=(U=n==null?void 0:n[m])==null?void 0:U[y])==null?void 0:D[b])==null?void 0:E[g])==null?void 0:C.includes(v);I||(o="Invalid rounds");let{segmentNumber:T,segmentsCount:S}=f||{},w=!f||Bt(T)&&kc(S)&&T<=S;return w||(o="Invalid segment"),I&&w}):(r=e0,!1):(o="rounds should be an array",!1)}):!1});return!a&&!r&&(r=Pe),{valid:!!a,error:r,info:o}}function Y1e(t){let{tournamentRecord:e={},tournamentMap:i={},requireCourts:n}=t,r=[],o=[],a=[],s=[],l=((e==null?void 0:e.venues)||[]).map(({venueId:u,courts:d})=>(!n||(d==null?void 0:d.length))&&u),c=e==null?void 0:e.tournamentId;return c&&(r.push(c),i[c]={},((e==null?void 0:e.events)||[]).forEach(u=>{let d=u.eventId;a.push(d),i[c][d]={},(u.drawDefinitions||[]).forEach(p=>{let h=p.drawId;s.push(h),i[c][d][h]={};let{structures:f}=wd({drawDefinition:p});(f||[]).forEach(m=>{var I;let g=m.structureId,{matchUps:v}=_i({structure:m}),{roundMatchUps:y}=la({matchUps:v}),b=y&&Object.keys(y).map(T=>parseInt(T));i[c][d][h][g]=b,o.push(g),(I=m.structures)!=null&&I.length&&m.structures.forEach(T=>{o.push(T.structureId),i[c][d][h][T.structureId]=b})})})})),{tournamentMap:i,tournamentIds:r,structureIds:o,venueIds:l,eventIds:a,drawIds:s}}function K1e(t){let e=(t==null?void 0:t.tournamentRecords)&&Object.values(t==null?void 0:t.tournamentRecords)||[],i={},{venueIds:n,eventIds:r,drawIds:o,structureIds:a,tournamentIds:s}=e.reduce((l,c)=>{let{tournamentIds:u,tournamentMap:d,structureIds:p,venueIds:h,eventIds:f,drawIds:m}=Y1e({tournamentRecord:c});return h.forEach(g=>{l.venueIds.includes(g)||l.venueIds.push(g)}),l.tournamentIds.push(...u),l.structureIds.push(...p),l.eventIds.push(...f),l.drawIds.push(...m),Object.assign(i,d),l},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:i,tournamentIds:s,structureIds:a,venueIds:n,eventIds:r,drawIds:o}}function Wp({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:On};let{extension:i}=Qt({element:e,name:Ov,tournamentRecords:t,discover:!0}),n=(i==null?void 0:i.value)||[];if(n.length){let{venueIds:r}=dP({requireCourts:!0,tournamentRecords:t}),{eventIds:o,drawIds:a}=aH({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=ooe({schedulingProfile:n,venueIds:r,eventIds:o,drawIds:a});if(l){n=s;let u=T0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function T0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){let n=l_({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?Ui({tournamentRecords:t,discover:!0,extension:{name:Ov,value:i}}):ta({element:e,name:Ov,tournamentRecords:t,discover:!0})}function hP(t){let{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){let{modifications:c,issues:u}=Wp({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}let{venueIds:n}=dP({tournamentRecords:i}),{eventIds:r,drawIds:o}=aH({tournamentRecords:i}),{updatedSchedulingProfile:a,modifications:s,issues:l}=ooe({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:o});return s?{...T0({schedulingProfile:a,tournamentRecords:i}),modifications:s,issues:l}:{...ae,modifications:s,issues:l}}function QH(t){let{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:lD};if(!Array.isArray(e))return{error:Pe};if(!e.every(ws))return{error:aa};let r=[],o=0,a={},{schedulingProfile:s}=Wp({tournamentRecords:i});if(!s)return{issues:r,...ae};let{matchUps:l}=xc({nextMatchUps:!0,tournamentRecords:i});for(let u of s){let{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(let h of p||[])if(h){let{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=pP({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=nc({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((S,w)=>{let U=S.matchUpIds.includes(I);return U&&(T=w),U}),T};if(g==null||g.forEach((I,T)=>{var U;let S=g.slice(T+1),w=Hn(S,((U=y==null?void 0:y[I])==null?void 0:U.matchUpIds)||[]);w.length&&m.push({matchUpId:I,shouldBeAfter:w})}),m.length){o+=m.length;let I=m.map(({matchUpId:T,shouldBeAfter:S})=>{let w=b(T),U=Zt(S.map(b));return a[d]||(a[d]={}),a[d][w]||(a[d][w]=[]),U.forEach(D=>{a[d][w].includes(D)||a[d][w].push(D)}),{matchUpId:T,matchUpRoundIndex:w,earlierRoundIndices:U,shouldBeAfter:S}});r.push(...I)}}}}let c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{let{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:o,profileIssues:c,roundIndexShouldBeAfter:a,...ae}}function vg(t){let{tournamentRecords:e,requestType:i}=t,n=Ei(t,[{[ko]:!0}]);if(n.error)return n;let r={};for(let o of Object.values(e)){let{extension:a}=Qt({element:o,name:l0}),s=(a==null?void 0:a.value)||[];for(let l of s){let{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(let d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...ae}}function I2(t){let{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:o,structureId:a,eventId:s,drawId:l}=t,c=n?e:a,u=[r,s,l,c,o].join("|");return wt({structureId:c,roundSegment:i,tournamentId:r,roundNumber:o,eventId:s,drawId:l,id:u})}function F6({round:t,matchUps:e,events:i,tournamentRecords:n}){let r=i.find(p=>p.eventId===t.eventId),{eventType:o,category:a,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:c}=a||{},u=os(e.map(({matchUpFormat:p})=>p)),d=0;return Object.keys(u).forEach(p=>{let h=u[p],f=s_({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:o});if(f.error)return f;let m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function Z1e(t){return(t||[]).reduce((e,i)=>{var o,a;let n=(((o=i.finishingPositionRange)==null?void 0:o.winner)||[]).reduce((s,l)=>s+l,0),r=(((a=i.finishingPositionRange)==null?void 0:a.winner)||[]).join("-")||"";return!e.minFinishingSum||n<e.minFinishingSum?{minFinishingSum:n,winnerFinishingPositionRange:r}:e},{minFinishingSum:0,winnerFinishingPositionRange:""})}function B6(t){let e=t.length,i=t.filter(({sides:c})=>c==null?void 0:c.some(({bye:u})=>u)).length||0,n=t.filter(({winningSide:c,matchUpStatus:u})=>c||Nr.includes(u)).length||0,r=t.filter(({schedule:c,matchUpStatus:u})=>(c==null?void 0:c.scheduledDate)&&(c==null?void 0:c.scheduledTime)&&u!==Ni).length||0,o=e-i,a=o===n,s=o-r,l=o-r;return{unscheduledCount:s,incompleteCount:l,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:o===r,isComplete:a,byeCount:i}}function c_({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:lD};t={[i.tournamentId]:i}}if(e){let o=l_({tournamentRecords:t,schedulingProfile:e});if(o.error)return o}if(!e&&t){let o=Wp({tournamentRecords:t});if(o.error)return o;e=o.schedulingProfile}if(!e)return{error:_o};let r={};return{profileRounds:e.map(({venues:o,scheduleDate:a})=>o.map(({rounds:s})=>s.map(l=>{var u;let c=I2(l);return(u=c.roundSegment)!=null&&u.segmentsCount&&(r[c.id]=c.roundSegment.segmentsCount),wt({id:n?c.id:void 0,scheduleDate:a,...c})}))).flat(1/0),segmentedRounds:r}}var aoe={};ii(aoe,{getEntriesAndSeedsCount:()=>u_,getMaxEntryPosition:()=>eG});function u_({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:o}){if(!r)return{error:Vi};let{entries:a,stageEntries:s}=_te({drawDefinition:e,drawId:n,stage:o,event:r}),l=s.length,{drawSize:c}=nne({participantsCount:l}),u=uP({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return se({result:u,stack:"getEntriesAndSeedsCount"});let{seedsCount:d}=u;return{entries:a,seedsCount:d,stageEntries:s}}function eG(t){let{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>(!n||n===r.entryStage)&&(!i||r.entryStatus===i)&&!isNaN(r.entryPosition)).map(({entryPosition:r})=>Et(r||0)),0)}var soe={};ii(soe,{allCompetitionMatchUps:()=>xc,allDrawMatchUps:()=>Ia,allEventMatchUps:()=>Hp,allTournamentMatchUps:()=>to,analyzeMatchUp:()=>eU,calculateWinCriteria:()=>Hy,checkMatchUpIsComplete:()=>mm,competitionScheduleMatchUps:()=>mP,drawMatchUps:()=>dG,eventMatchUps:()=>p_,getAllDrawMatchUps:()=>Tr,getAllStructureMatchUps:()=>_i,getCheckedInParticipantIds:()=>Ry,getCompetitionMatchUps:()=>QT,getEventMatchUpFormatTiming:()=>iG,getMatchUpCompetitiveProfile:()=>OD,getMatchUpContextIds:()=>sG,getMatchUpDailyLimits:()=>f_,getMatchUpDailyLimitsUpdate:()=>nG,getMatchUpDependencies:()=>nc,getMatchUpFormat:()=>lG,getMatchUpFormatTiming:()=>FD,getMatchUpFormatTimingUpdate:()=>tG,getMatchUpScheduleDetails:()=>PA,getMatchUpType:()=>CA,getMatchUpsStats:()=>cG,getModifiedMatchUpFormatTiming:()=>d_,getParticipantResults:()=>nP,getPredictiveAccuracy:()=>aG,getRoundMatchUps:()=>la,getRounds:()=>uG,isValidMatchUpFormat:()=>ls,matchUpActions:()=>WA,participantScheduledMatchUps:()=>rG,tallyParticipantResults:()=>S0,tournamentMatchUps:()=>h_,validMatchUp:()=>SA,validMatchUps:()=>hl});function loe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:On};let i=[],n;for(let r of Object.values(t)){let{extension:o}=Qt({element:r,name:e});o&&!n&&(i.push({params:{extension:o,discover:!0},method:"addExtension"}),n=!0);let a=r.events??[];for(let s of a){let{eventId:l}=s,{extension:c}=Qt({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function tG({tournamentRecords:t}){return loe({extensionName:mp,tournamentRecords:t})}var kO="ADULT",xO="JUNIOR",b1="WHEELCHAIR",coe={[Tf]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[an]:30,default:60}}]},defaultDailyLimits:{[kn]:2,[an]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Ks],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[b1],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[kO,b1],minutes:{default:60,[an]:30}},{categoryTypes:[xO],minutes:{default:60,[an]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[kO,b1],minutes:{default:30}},{categoryTypes:[xO],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[kO,xO],minutes:{default:30}},{categoryTypes:[b1],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}},X1e=coe;function iG({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Vi};let r=[],o;if(e!=null&&e.length){let d=[];r=e.map(p=>{let h=typeof p=="string"?{matchUpFormat:p}:p;if(!d.includes(h==null?void 0:h.matchUpFormat)&&ls({matchUpFormat:h==null?void 0:h.matchUpFormat}))return d.push(h.matchUpFormat),h}).filter(Boolean)}else{let{policy:d}=cg({policyType:vd,tournamentRecord:t,event:n});if(d!=null&&d.matchUpFormats)r=d==null?void 0:d.matchUpFormats;else{let{extension:p}=Qt({name:mp,element:n}),h,f;p!=null&&p.value?{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=p.value:{matchUpAverageTimes:h,matchUpRecoveryTimes:f}=X1e[Tf],r=Zt([...(h||[]).map(m=>m.matchUpFormatCodes),...(f||[]).map(m=>m.matchUpFormatCodes)].flat()).map(m=>({matchUpFormat:m})),o="default scheduling policy in use"}}let{eventType:a,eventId:s,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;if(!s)return{error:Vi};let u=r.map(({matchUpFormat:d,description:p})=>{let h=FD({tournamentRecord:t,matchUpFormat:d,categoryName:c,categoryType:i,eventType:a,event:n});return{matchUpFormat:d,description:p,...h}});return wt({eventMatchUpFormatTiming:u,info:o})}function d_(t){let e=Ei(t,[{[xd]:!0},{[yc]:m=>ls({matchUpFormat:m}),[fd]:dD,[UV]:!0}]);if(e.error)return e;let{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:o}=Qt({name:mp,element:r}),a=o==null?void 0:o.value,{extension:s}=Qt({element:i,name:mp}),l=s==null?void 0:s.value,c=(a==null?void 0:a.matchUpAverageTimes)&&XS({...a,matchUpFormat:n}),u=(l==null?void 0:l.matchUpAverageTimes)&&XS({...l,matchUpFormat:n}),d=[c,u].find(m=>m),p=(a==null?void 0:a.matchUpRecoveryTimes)&&JS({...a,matchUpFormat:n}),h=(l==null?void 0:l.matchUpRecoveryTimes)&&JS({...l,matchUpFormat:n}),f=[p,h].find(m=>m);return{matchUpFormat:n,recoveryTimes:f,averageTimes:d}}function nG({tournamentRecords:t}){return loe({extensionName:wD,tournamentRecords:t})}var fP=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function rG({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!hl(e))return{error:kd};if(!Array.isArray(t))return{error:Pe};let i=e.filter(Boolean).filter(({schedule:n})=>fP({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{let{schedule:o}=r,a=Wt(o==null?void 0:o.scheduledDate),s=hn(o==null?void 0:o.scheduledTime);return a&&s&&(n[a]?n[a].push(r):n[a]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,o)=>{var a,s;return oee(hn((a=r.schedule)==null?void 0:a.scheduledTime),hn((s=o.schedule)==null?void 0:s.scheduledTime))})}),{...ae,scheduledMatchUps:i}}function J1e({tournamentRecords:t}){var n;let e=[],i={};for(let r of Object.values(t))for(let o of r.events??[]){let a=fl({event:o}),s=a==null?void 0:a.drawDetails;ln(s)?(Object.assign(i,s),e.push(...Object.keys(s).filter(l=>kj({drawId:l,drawDetails:s})))):(n=a==null?void 0:a.drawIds)!=null&&n.length&&e.push(...a.drawIds)}return{drawIds:e,detailsMap:i}}function zM({schedulingProfile:t,matchUps:e=[]}){let i={},n=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{let h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});let r=[],o={noScheduledDate:[]};for(let s of e){let l=s.schedule||{},c=l.scheduledDate&&Wt(l.scheduledDate)||l.scheduledTime&&Wt(l.scheduledTime)||"noScheduledDate";o[c]||(o[c]=[]),o[c].push(s)}let a=Object.keys(o).sort();for(let s of a){let l=o[s],c={noScheduledTime:[]};for(let d of l){let p=d.schedule||{},h=p.scheduledTime&&hn(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}let u=Object.keys(c).sort();for(let d of u){let p=c[d];p.sort((h,f)=>{let m=i[n(h)]||0,g=i[n(f)]||0;return m-g}),r.push(...p)}}return r}function oG({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Pe};let n=i==null?void 0:i.reduce((a,s)=>{let l=s.matchUps||[],c=Math.max(0,...l.map(u=>u.schedule.courtOrder||0));return c>a?c:a},1),r=e?Math.max(e,n):n,o=it(0,r).map(a=>({matchUps:it(0,i.length).map(s=>{let l=i[s],{courtId:c,venueId:u}=l;return{schedule:{courtOrder:a+1,venueId:u,courtId:c}}})}));return i.forEach((a,s)=>{var l;for(let c of a.matchUps){let u=(l=c.schedule)==null?void 0:l.courtOrder;u&&(o[u-1].matchUps[s]=c)}}),{courtPrefix:t,rows:o.map((a,s)=>Object.assign({rowId:`rowId-${s+1}`},...a.matchUps.map((l,c)=>({[`${t}${c}`]:l}))))}}function p_(t){let{participants:e,contextContent:i,participantMap:n}=t,{tournamentAppliedPolicies:r,scheduleVisibilityFilters:o,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Vi};let{eventId:I,eventName:T,endDate:S,eventType:w,category:U,gender:D}=b??{},E={...y,...wt({surfaceCategory:b.surfaceCategory??(u==null?void 0:u.surfaceCategory),indoorOutDoor:b.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),tournamentId:g??(u==null?void 0:u.tournamentId),endDate:S??(u==null?void 0:u.endDate),eventName:T,eventType:w,category:U,eventId:I,gender:D})},C;!e&&u&&({participants:e,participantMap:n,groupInfo:C}=Ay({participantsProfile:a,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=jp({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));let M=fl({event:b});return{...(b.drawDefinitions??[]).reduce((N,R)=>{var _;let A=v0({context:E,tournamentAppliedPolicies:r,scheduleVisibilityFilters:o,tournamentParticipants:e,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:M,contextProfile:f,drawDefinition:R,nextMatchUps:m,inContext:v,event:b});return(_=Object.keys(A))==null||_.forEach(k=>{Array.isArray(A[k])&&(N[k]||(N[k]=[]),N[k]=N[k].concat(A[k]))}),N},{}),...ae,groupInfo:C}}function h_(t){if(!(t!=null&&t.tournamentRecord))return{error:Ge};let e=t.contextContent,{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:b}=Ay({participantsProfile:n,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=jp({policyDefinitions:o,tournamentRecord:s,contextProfile:p}));let{appliedPolicies:I}=Bi({tournamentRecord:s}),T=(u==null?void 0:u.eventIds)??[];return{...g.filter(S=>!T.includes(S.eventId)).map(S=>{var U,D,E;let w={eventDrawsCount:((D=(U=Kn({event:S}).flightProfile)==null?void 0:U.flights)==null?void 0:D.length)||((E=S.drawDefinitions)==null?void 0:E.length)||0,...f};return p_({context:w,tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:h,inContext:l,event:S})}).reduce((S,w)=>{var U;return(U=w&&Object.keys(w).filter(D=>!["success","matchUpsMap"].includes(D)))==null||U.forEach(D=>{Array.isArray(w[D])&&(S[D]||(S[D]=[]),S[D]=S[D].concat(w[D]),S.matchUpsCount+=w[D].length)}),S},{matchUpsCount:0}),groupInfo:b}}function QT({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:On};let c=Object.keys(i).map(d=>{let p=i[d];return h_({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(h=>{Array.isArray(p[h])&&(d[h]||(d[h]=[]),d[h]=d[h].concat(p[h])),h==="groupInfo"&&Object.assign(u,p[h])}),d),{}),groupInfo:u}}function mP(t){var C,M,N,R,A,_,k,O;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:On};let{courts:e,venues:i}=zp(t),n=Wp(t).schedulingProfile,{sortDateMatchUps:r=!0,courtCompletedMatchUps:o,alwaysReturnCompleted:a,activeTournamentId:s,tournamentRecords:l,withCourtGridRows:c,minCourtGridRows:u,usePublishState:d,status:p=ic,sortCourtsData:h}=t,f=d?(M=(C=jD({tournamentRecord:l[s??Uy()],itemType:`${ug}.${dg}`}).timeItem)==null?void 0:C.itemValue)==null?void 0:M[p]:void 0,m=a?QT({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[or]},contextFilters:t.contextFilters}).completedMatchUps:[];if(d&&(!f||!Object.keys(f).length))return{completedMatchUps:m,dateMatchUps:[],courtsData:[],venues:i};let g,v;d&&({drawIds:g,detailsMap:v}=J1e({tournamentRecords:l})),g!=null&&g.length&&(t.contextFilters||(t.contextFilters={}),(N=t.contextFilters)!=null&&N.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(F=>g.includes(F)):t.contextFilters.drawIds=g),(R=f==null?void 0:f.eventIds)!=null&&R.length&&(t.matchUpFilters||(t.matchUpFilters={}),(A=t.matchUpFilters)!=null&&A.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(F=>f.eventIds.includes(F)):t.matchUpFilters.eventIds=f.eventIds),(_=f==null?void 0:f.scheduledDates)!=null&&_.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(F=>f.scheduledDates.includes(F)):t.matchUpFilters.scheduledDates=f.scheduledDates),a&&(t.matchUpFilters||(t.matchUpFilters={}),(O=(k=t.matchUpFilters)==null?void 0:k.excludeMatchUpStatuses)!=null&&O.length?t.matchUpFilters.excludeMatchUpStatuses.includes(or)||t.matchUpFilters.excludeMatchUpStatuses.push(or):t.matchUpFilters.excludeMatchUpStatuses=[or]);let{completedMatchUps:y,upcomingMatchUps:b,pendingMatchUps:I,groupInfo:T}=QT({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters}),S=[...b??[],...I??[]];v&&Object.keys(v).length&&(S=S.filter(F=>{let{drawId:B,structureId:$,stage:V}=F;if(!v[B])return!1;if(v[B].stageDetails){let H=Object.keys(v[B].stageDetails),z=H.filter(W=>!v[B].stageDetails[W].published),G=H.filter(W=>v[B].stageDetails[W].published);return z.length&&z.includes(V)?!1:G.length&&G.includes(V)?!0:z.length&&!z.includes(V)&&!G.length}if(v[B].structureDetails){let H=Object.keys(v[B].structureDetails),z=H.filter(W=>!v[B].structureDetails[W].published),G=H.filter(W=>v[B].structureDetails[W].published);return z.length&&z.includes($)?!1:G.length&&G.includes($)?!0:z.length&&!z.includes($)&&!G.length}return!0}));let w=r?zM({matchUps:S,schedulingProfile:n}):S,U=e==null?void 0:e.map(F=>{let B=E(F);return{surfaceCategory:(F==null?void 0:F.surfaceCategory)??"",matchUps:B,...F}}),D={completedMatchUps:a?m:y,dateMatchUps:w,courtsData:U,groupInfo:T,venues:i};if(c){let{rows:F,courtPrefix:B}=oG({minRowsCount:u,courtsData:U});D.courtPrefix=B,D.rows=F}return{...D,...ae};function E({courtId:F}){let B=(o?w.concat(y??[]):w).filter($=>{var V,H,z;return((V=$.schedule)==null?void 0:V.courtId)===F||((z=(H=$.schedule)==null?void 0:H.allocatedCourts)==null?void 0:z.map(({courtId:G})=>G).includes(F))});return h?zM({matchUps:B,schedulingProfile:n}):B}}function f_({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:On};let i=Object.keys(t).filter(r=>!e||r===e),n;return i.forEach(r=>{let o=t[r],{matchUpDailyLimits:a}=Q1e({tournamentRecord:o});n=a}),{matchUpDailyLimits:n}}function Q1e(t){var s;let e=Ei(t,[{[xd]:!0}]);if(e.error)return e;let{tournamentRecord:i}=t,{policy:n}=cg({policyType:Tf,tournamentRecord:i}),{extension:r}=Qt({element:i,name:wD}),o=(s=r==null?void 0:r.value)==null?void 0:s.dailyLimits,a=n==null?void 0:n.defaultDailyLimits;return{matchUpDailyLimits:o||a}}function aG(t){var R,A,_,k;let{matchUps:e}=t,{singlesForDoubles:i,tournamentRecord:n,drawDefinition:r,excludeMargin:o,exclusionRule:a,zoneDoubling:s,matchUpType:l,scaleName:c,eventId:u,zonePct:d,drawId:p,event:h}=t;if(!n&&!e)return{error:Ge};if(l&&![kn,an].includes(l))return{error:Pe,info:{matchUpType:l}};if(e&&!hl(e))return{error:Pe,context:{matchUps:e}};let f=vs[c],m=(f==null?void 0:f.ascending)??t.ascending??!1,g=(f==null?void 0:f.accessor)??t.valueAccessor,v=Array.isArray(f==null?void 0:f.range)?Math.abs(f.range[0]-f.range[1]):0,y=Bt(d)&&v?(d??0/100)*v:t.zoneMargin??v,b={withScaleValues:!0,withCompetitiveness:!0},I={matchUpTypes:l?[l]:[kn,an]},T=n==null?void 0:n.participants;(R=e==null?void 0:e[0])!=null&&R.hasContext?p?e=e.filter(O=>O.drawId===p):u&&(e=e.filter(O=>O.eventId===u)):e===void 0&&(e=p&&!r&&[]||!p&&u&&!h&&[]||p&&((A=Ia({inContext:!0,drawDefinition:r,contextFilters:I,contextProfile:b,participants:T}))==null?void 0:A.matchUps)||!p&&u&&((_=Hp({inContext:!0,contextFilters:I,contextProfile:b,participants:T,event:h}))==null?void 0:_.matchUps)||((k=to({tournamentRecord:n,contextFilters:I,contextProfile:b}))==null?void 0:k.matchUps)||[]),l&&(e=e.filter(O=>O.matchUpType===l));let S=e.filter(({winningSide:O,score:F,sides:B,matchUpStatus:$})=>![Go,Pi,Oi,c0,Us].includes($??"")&&io({score:F})&&(B==null?void 0:B.length)===2&&O),w=tEe({matchUps:S,excludeMargin:o,exclusionRule:a,valueAccessor:g,ascending:m,scaleName:c}),U=!s||jn(kn)(l)?y:(y||0)*2,D=y?S.map(({competitiveProfile:O,matchUpType:F,score:B,sides:$})=>{let V=uoe({singlesForDoubles:i,valueAccessor:g,matchUpType:F,scaleName:c,sides:$}),H=Math.abs(V[0].value-V[1].value);return{competitiveness:O==null?void 0:O.competitiveness,valuesGap:H,score:B}}).filter(({valuesGap:O})=>O<=U):[],E=eEe({zoneData:D}),C=E&&[].concat(Object.values(E)).flat().length,M=C&&Object.assign({},...Object.keys(E).map(O=>({[O]:Math.round(1e4*E[O].length/C)/100}))),N=S.length-((D==null?void 0:D.length)||0);return{...ae,relevantMatchUps:S,zoneDistribution:M,zoneData:D,accuracy:w,nonZone:N}}function eEe({zoneData:t}){let e={[Ij]:[],[zT]:[],[WT]:[]};for(let i of t){let{competitiveness:n,score:r,valuesGap:o}=i;e[n]&&e[n].push({score:r,valuesGap:o})}return e}function uoe({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:o}){let a=e==null?void 0:e.range.sort(),s=l=>{let c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=a[0]&&c<=a[1],exclusionValue:c}};return o.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{let c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){let d=[],p=0;for(let h of u){let{scaleValue:f,value:m}=$6({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}else if(l){let{scaleValue:d,value:p}=$6({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=s(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}else return{}})}function $6({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var c,u,d,p,h;let o=t?kn:i,a=(u=(c=n==null?void 0:n.rankings)==null?void 0:c[o])==null?void 0:u.find(f=>f.scaleName===r),s=(h=((p=(d=n==null?void 0:n.ratings)==null?void 0:d[o])==null?void 0:p.find(f=>f.scaleName===r))||a)==null?void 0:h.scaleValue,l=e?s==null?void 0:s[e]:s;return{scaleValue:s,value:l}}function tEe({excludeMargin:t,exclusionRule:e,valueAccessor:i,ascending:n,scaleName:r,matchUps:o}){let a={affirmative:[],negative:[],excluded:[]};for(let c of o){let{matchUpType:u,sides:d,score:p,winningSide:h}=c;if(!h)continue;if(e&&(!e.valueAccessor||!e.range))return{info:"exclusionRule requires valueAccessor and range",error:gt};let f=h-1,m=uoe({exclusionRule:e,valueAccessor:i,matchUpType:u,scaleName:r,sides:d});if(e){let T=m.map(({exclusionValues:S})=>S).flat();if(T.length){a.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,exclusionValues:T,winningSide:h,sideValues:m});continue}}if(m.filter(T=>![void 0,"",null].includes(T.value)).length<2){a.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,missingValues:!0,winningSide:h,sideValues:m});continue}let g=m[f].value-m[1-f].value,v=parseFloat(t||0),y=v&&Math.abs(g)<v;if(y){a.excluded.push({scoreString:p==null?void 0:p.scoreStringSide1,excludeMargin:t,winningSide:h,excludeGap:y,sideValues:m,valuesGap:g});continue}let b=n?g:g*-1,I=h===1?p==null?void 0:p.scoreStringSide1:p==null?void 0:p.scoreStringSide2;b>0?a.affirmative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p}):a.negative.push({winningScoreString:I,winningSide:h,sideValues:m,valuesGap:g,score:p})}let s=a.affirmative.length+a.negative.length,l=s&&a.affirmative.length/s*100;return a.percent=l?Math.round(100*l)/100:0,a}function Hy({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0,{groupValueNumbers:n}=Rie({collectionGroups:e}),r;for(let o of t||[]){let{collectionValueProfiles:a,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,h=s&&n.includes(s);if(Bt(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&Bt(l))i+=l;else if(a!=null&&a.length)for(let f of a)i+=f.matchUpValue;else typeof u=="number"&&Bt(u)&&(i+=(c??0)*u)}}for(let o of e)i+=o.groupValue??0;return r||!i?{aggregateValue:!0,...ae}:{valueGoal:Math.floor(i/2)+1,...ae}}function sG({matchUps:t,matchUpId:e}){if(!hl(t))return{error:Pe};let i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:o,tournamentId:a}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:o,tournamentId:a}}function gP(t,e){if(!ln(t))return{error:Pe};if(!Array.isArray(e))return{error:Pe};let i={};for(let{param:n,error:r,attr:o}of e){let a=iEe({params:t,param:n,attr:o,error:r});if(a!=null&&a.error)return a;i[n]=a}return i}function iEe({params:t,param:e,attr:i,error:n}){if(e===EV&&ln(t.drawDefinition)&&oa(t.structureId)){let r=(t.drawDefinition.structures??[]).find(({structureId:o})=>o===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===wf){let r=Qre({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:_o,info:{param:e}}}function lG(t){var p,h;let{structureId:e,matchUpId:i,event:n}=t,r=t.drawDefinition,o=Ei(t,[{[xd]:!0},{[MV]:{[DV]:!1,[ng]:!1,[eee]:!1,[n0]:!1}}]);if(o[cv])return o;let a=(p=gP(t,[{[yD]:wf,[cv]:gt}]))==null?void 0:p.matchUp;if(i&&(a!=null&&a.error))return a;!r&&(a!=null&&a.drawDefinition)&&(r=a==null?void 0:a.drawDefinition);let s=a==null?void 0:a.structure;if(!s&&e&&!i){if(!r)return{error:Wc};let f=At({drawDefinition:r,structureId:e});if(f.error)return f;s=f.structure}let l=s==null?void 0:s.matchUpFormat,c=r==null?void 0:r.matchUpFormat,u=n==null?void 0:n.matchUpFormat,d=((h=a==null?void 0:a.matchUp)==null?void 0:h.matchUpFormat)||l||c||u;return{structureDefaultMatchUpFormat:l,eventDefaultMatchUpFormat:u,drawDefaultMatchUpFormat:c,matchUpFormat:d}}function cG({profileBands:t,tournamentRecord:e,matchUps:i}){if(!hl(i))return{error:kd};let n=!t&&cg({policyType:Jd,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||wj[Jd].profileBands,o=i.filter(({winningSide:p})=>p),a=o.map(Vee),s=(p,h)=>{let f=$ee(h,r);return p[f]+=1,p},l=jee(a).reduce((p,h)=>s(p,h),{[Ij]:0,[zT]:0,[WT]:0,[Bee]:0}),c=Object.keys(l).reduce((p,h)=>(l[h]||0)+p,0),u=Object.keys(l).map(p=>{let h=parseFloat((l[p]/c).toFixed(4));return{[p]:h*100}}),d=o.filter(({matchUpStatus:p})=>p===a6).length;return u.push({[a6]:parseFloat((d/c).toFixed(4))*100}),{competitiveBands:Object.assign({},...u),...ae}}var{stageOrder:V6}=uTe;function nEe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(V6[t==null?void 0:t.stage]||0)-(V6[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function uG({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:o,tournamentRecord:a,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var S;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Pe,inContextMatchUps:n};if(a&&!r){if(typeof a!="object")return{error:lD};r={[a.tournamentId]:a}}let h=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!o&&(t||i||o||s))&&h)return{error:On};let f=Object.assign({},...Object.values(r??{}).map(({venues:w=[],tournamentId:U})=>({[U]:w==null?void 0:w.map(({venueId:D})=>D)}))),m=Object.values(r??{}).map(({events:w=[],tournamentId:U,startDate:D,endDate:E})=>w.map(C=>({...C,validVenueIds:f[U],startDate:C.startDate??D,endDate:C.endDate??E}))).flat(),{segmentedRounds:g,profileRounds:v}=r&&(t||i||o||s)&&c_({tournamentRecords:r,schedulingProfile:o})||{},y=t&&Object.assign({},...v.map(w=>({[w.id]:w}))),b=n||r&&((S=xc({tournamentRecords:r,matchUpFilters:l}))==null?void 0:S.matchUps)||[],I=[],T=b&&Object.values(b.reduce((w,U)=>{var K;let D=I2(U).id,E=g==null?void 0:g[D],C=[...((K=w[D])==null?void 0:K.matchUps)??[],U],{containerStructureId:M,stageSequence:N,structureName:R,tournamentId:A,isRoundRobin:_,matchUpType:k,roundNumber:O,roundOffset:F,structureId:B,eventName:$,roundName:V,drawName:H,eventId:z,drawId:G}=U,W=_?M:B;return{...w,[D]:{id:u?D:void 0,structureId:W,stageSequence:N,segmentsCount:E,structureName:R,tournamentId:A,matchUpType:k,roundNumber:O,roundOffset:F,eventName:$,roundName:V,drawName:H,matchUps:C,eventId:z,drawId:G}}},{})).map(w=>{let{minFinishingSum:U,winnerFinishingPositionRange:D}=Z1e(w.matchUps),E=w.segmentsCount;if(E){let O=w.matchUps.length/E;return Qr(w.matchUps.sort((F,B)=>F.roundPosition-B.roundPosition),O).map((F,B)=>{let{unscheduledCount:$,incompleteCount:V,matchUpsCount:H,isScheduled:z,isComplete:G,byeCount:W}=B6(F),K=F6({matchUps:w.matchUps,tournamentRecords:r,events:m,round:w});return wt({...w,...p,roundSegment:{segmentsCount:E,segmentNumber:B+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:V,minFinishingSum:U,matchUpsCount:H,isScheduled:z,roundTiming:K,isComplete:G,byeCount:W,matchUps:F})})}let{unscheduledCount:C,incompleteCount:M,matchUpsCount:N,isScheduled:R,isComplete:A,byeCount:_}=B6(w.matchUps),k=F6({matchUps:w.matchUps,tournamentRecords:r,events:m,round:w});return wt({...w,...p,winnerFinishingPositionRange:D,unscheduledCount:C,incompleteCount:M,minFinishingSum:U,matchUpsCount:N,isScheduled:R,roundTiming:k,isComplete:A,byeCount:_})}).flat().filter(w=>{if(t){let B=Wt(t),$=u?w.id:I2(w).id;if(B&&y[$]&&Wt(y[$].scheduleDate)===B)return!1}let{isComplete:U,isScheduled:D}=w,E=!i||!U,C=!e||!D,M=d||c?m==null?void 0:m.find(({eventId:B})=>B===w.eventId):void 0,N=(M==null?void 0:M.startDate)??(a==null?void 0:a.startDate),R=(M==null?void 0:M.endDate)??(a==null?void 0:a.endDate),A=!c||!N||new Date(c)>=new Date(N),_=!c||!R||new Date(c)<=new Date(R),k=A&&_,O=!d||(M==null?void 0:M.validVenueIds.includes(d)),F=E&&C&&O&&k;return F||I.push(w),F}).sort(nEe)||[];return{...ae,rounds:T,excludedRounds:I}}function eU(t){var z;let{matchUp:e,sideNumber:i,setNumber:n,isTiebreakValue:r,isPointValue:o}=t||{},{matchUpFormat:a}=t||{};if(!e)return{error:Ba};a=a||(e==null?void 0:e.matchUpFormat);let s=Pa(a),l=!!(e!=null&&e.winningSide),c=(z=e.score)==null?void 0:z.sets,u=c==null?void 0:c.length,d=n&&n-1,p=!!(c!=null&&c.find((G,W)=>G.setNumber===n&&W===d)),h=(c==null?void 0:c.filter(G=>G==null?void 0:G.winningSide))||[],f=(h==null?void 0:h.length)||0,m=n&&(c==null?void 0:c.slice(n))||[],g=!!(u&&n&&(m!=null&&m.reduce((G,W)=>(!W||!W.side1Score&&!W.side2Score&&!W.side1TiebreakScore&&!W.side2TiebreakScore&&!W.side1PointScore&&!W.side2PointScore)&&G,!0))),v=n<=u&&c.find(G=>G.setNumber===n),y=v&&JT({setObject:v,matchUpScoringFormat:s}),{isCompletedSet:b,sideGameScores:I,sideTiebreakScores:T}=y||{},S=!!(v&&!b&&g||n&&n===u+1&&!l),w=[1,2].includes(i),U=w?i-1:0,D=v&&w&&(!r&&!o&&I[U]!==void 0&&I[U]||r&&T[U]!==void 0&&T[U]),E=!!D,C=h==null?void 0:h.map(G=>JT({setObject:G,matchUpScoringFormat:s}).isValidSetOutcome).reduce((G,W)=>G&&W,!0),M=h.reduce((G,W)=>{let{winningSide:K}=W,Z=K-1;return G[Z]++,G},[0,0]),N=e==null?void 0:e.winningSide,R=N&&N-1,A=1-R,_=M[R],k=M[A],O=Math.max(...M),F=os(M)[O],{bestOf:B}=s??{},$=B&&Math.ceil(B/2)||1,V=O===$&&F===1&&M.indexOf(O)+1||void 0,H=_>k&&N===V;return{completedSetsHaveValidOutcomes:C,validMatchUpWinningSide:H,calculatedWinningSide:V,matchUpScoringFormat:s,validMatchUpOutcome:V&&C&&H,isLastSetWithValues:g,completedSetsCount:f,isCompletedMatchUp:l,isValidSideNumber:w,hasExistingValue:E,existingValue:D,isExistingSet:p,isActiveSet:S,...y}}function dG({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){let{eventId:T,eventName:S,endDate:w,eventType:U,category:D,gender:E}=I??{},C={...b,...wt({surfaceCategory:(I==null?void 0:I.surfaceCategory)??(s==null?void 0:s.surfaceCategory),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),endDate:w??(I==null?void 0:I.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),eventName:S,eventType:U,category:D,eventId:T,gender:E})},M;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:M}=Ay({participantsProfile:n,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,contextProfile:f,inContext:y})),I&&f&&!u&&(u=jp({policyDefinitions:o,tournamentRecord:s,contextProfile:f,drawDefinition:m,event:I})),{...v0({context:C,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:M}}var doe={};ii(doe,{getCompetitionVenues:()=>dP,getCourts:()=>pG,getVenuesAndCourts:()=>zp,publicFindVenue:()=>Pj});function pG({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:i?i.includes(n.venueId):!0).map(n=>{let{venueId:r}=n,o=dt(n.courts||[]);return o.forEach(a=>Object.assign(a,{venueId:r})),o}).flat()}:{error:Ge}}var poe={};ii(poe,{categoryCanContain:()=>$A,getCategoryAgeDetails:()=>rP,getEvent:()=>mG,getEventProperties:()=>hG,getEventStructures:()=>kA,getEventTimeItem:()=>VD,getEvents:()=>fG,getFlightProfile:()=>Kn,getScaledEntries:()=>Vy});function hG({tournamentRecord:t,event:e}){var d,p;if(!t)return{error:Ge};if(!e)return{error:Vi};let i=e.entries||[],n=t.participants||[],r=((d=e.category)==null?void 0:d.categoryName)||((p=e.category)==null?void 0:p.ageCategoryCode),{eventType:o}=e,a=i.map(h=>h.participantId),s=n.filter(h=>a.includes(h.participantId)),l,c,u;return{entryScaleAttributes:s.map(h=>{var T,S,w,U,D,E;let{participantId:f,participantName:m,name:g}=h,v={scaleType:Uj,eventType:o,scaleName:r},y=(S=(T=ad({participant:h,scaleAttributes:v}))==null?void 0:T.scaleItem)==null?void 0:S.scaleValue;v={scaleType:Jee,eventType:o,scaleName:r};let b=(U=(w=ad({participant:h,scaleAttributes:v}))==null?void 0:w.scaleItem)==null?void 0:U.scaleValue;v={scaleType:Xee,eventType:o,scaleName:r};let I=(E=(D=ad({participant:h,scaleAttributes:v}))==null?void 0:D.scaleItem)==null?void 0:E.scaleValue;return l=!!(l||y),c=!!(c||b),u=!!(u||I),{participantId:f,participantName:m||g,seed:y,ranking:b,rating:I}}),hasSeededParticipants:l,hasRankedParticipants:c,hasRatedParticipants:u}}function fG({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:o,context:a}){var u,d,p,h;if(!t)return{error:Ge};let{tournamentId:s}=t,l=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var v;let m=(v=f.drawDefinitions)==null?void 0:v.map(FT);if(o!=null&&o.length&&!Hn(o,m).length)return;let g=dt(f);return n&&Object.assign(g,{tournamentId:s}),a&&Object.assign(g,a),g}).filter(Boolean),c={};if(e){let f=zn({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(let g of l){let v=i??g.eventType,y=g.eventId;c[y]||(c[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});let b=(g.entries??[]).filter(({entryStatus:E})=>ec.includes(E)).map(ai),I=E=>{var C,M,N,R,A,_;if((C=E==null?void 0:E.ratings)!=null&&C[v])for(let k of((M=E==null?void 0:E.ratings)==null?void 0:M[v])??[]){let O=k.scaleName;c[y].ratings[O]||(c[y].ratings[O]=[]);let F=(N=vs[O])==null?void 0:N.accessor;if(F){let B=parseFloat((R=k.scaleValue)==null?void 0:R[F]);B&&c[y].ratings[O].push(B)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(let k of((_=E==null?void 0:E.rankings)==null?void 0:_[v])??[]){let O=k.scaleName;c[y].ranking[O]||(c[y].ranking[O]=[]),k.scaleValue&&c[y].ranking[O].push(k.scaleValue)}};for(let E of b){let C=(u=f==null?void 0:f[E])==null?void 0:u.participant;if((C==null?void 0:C.participantType)!==si)for(let M of(C==null?void 0:C.individualParticipantIds)??[]){let N=(d=f==null?void 0:f[M])==null?void 0:d.participant;I(N)}else I(C)}let T=c[y].ratings;for(let E of Object.keys(T)){let C=T[E];if(!C.length)continue;let M=(p=i6(C))==null?void 0:p.toFixed(2);c[y].ratingsStats[E]={avg:parseFloat((m(C)/C.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...C),min:Math.min(...C)}}let S=(E,C)=>{var N,R;let M=A=>{var _,k,O,F,B,$,V,H,z,G;if((_=c[y].draws)!=null&&_[E]&&((k=A==null?void 0:A.ratings)!=null&&k[v]))for(let W of((O=A==null?void 0:A.ratings)==null?void 0:O[v])??[]){let K=W.scaleName;(F=c[y].draws[E])!=null&&F.ratings[K]||(c[y].draws[E].ratings[K]=[]);let Z=(B=vs[K])==null?void 0:B.accessor;if(Z){let Y=parseFloat(($=W.scaleValue)==null?void 0:$[Z]);Y&&c[y].draws[E].ratings[K].push(Y)}}if((V=c[y].draws)!=null&&V[E]&&((H=A==null?void 0:A.rankings)!=null&&H[v]))for(let W of((z=A==null?void 0:A.rankings)==null?void 0:z[v])??[]){let K=W.scaleName;(G=c[y].draws[E])!=null&&G.ranking[K]||(c[y].draws[E].ranking[K]=[]);let Z=W.scaleValue;Z&&c[y].draws[E].ranking[K].push(Z)}};for(let A of C.filter(Boolean)){let _=(N=f==null?void 0:f[A])==null?void 0:N.participant;if((_==null?void 0:_.participantType)!==si)for(let k of(_==null?void 0:_.individualParticipantIds)??[]){let O=(R=f==null?void 0:f[k])==null?void 0:R.participant;M(O)}else M(_)}},w=[],U=E=>(o==null?void 0:o.length)&&o.includes(E)||w.includes(E);for(let E of g.drawDefinitions??[]){let C=E.drawId;if(U(C))continue;let M=fg({drawDefinition:E}).assignedParticipantIds??[];c[y].draws[C]||(c[y].draws[C]={ratingsStats:{},ratings:{},ranking:{}}),w.push(C),S(C,M)}let D=Kn({event:g}).flightProfile;for(let E of(D==null?void 0:D.flights)??[]){let C=E.drawId;if(U(C))continue;let M=E.drawEntries.map(ai);S(C,M)}for(let E of w){let C=c[y].draws[E].ratings;for(let M of Object.keys(C)){let N=C[M];if(!N.length)continue;let R=(h=i6(N))==null?void 0:h.toFixed(2);c[y].draws[E].ratingsStats[M]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return wt({eventScaleValues:c,events:l,...ae})}function mG({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var a;if(!t)return{error:Ge};if(!n)return{error:Vi};let r=dt(n);i&&Object.assign(r,i);let o=e&&((a=r.drawDefinitions)==null?void 0:a.find(({drawId:s})=>e.drawId===s));return wt({drawDefinition:o,event:r})}function rEe(t){var h,f;let e="validateAndDeriveDrawValues",{appliedPolicies:i,policyDefinitions:n}=sEe(t),r=lEe({...t,policyDefinitions:n,appliedPolicies:i}),o=aEe(t),a=cEe({...t,consideredEntries:o,appliedPolicies:i});if(a!=null&&a.error)return se({result:a,stack:e});let s=uEe({...t,consideredEntries:o}),l=oEe({...t,appliedPolicies:i,policyDefinitions:n,drawSize:s});if(l.error)return se({result:l,stack:e});let c=l.drawType;if(isNaN(s)&&c!==jl)return se({result:{error:uD},stack:e});let u=(n==null?void 0:n[Ml])??(i==null?void 0:i[Ml]),d=t.seedingProfile??((f=(h=u==null?void 0:u.seedingProfile)==null?void 0:h.drawTypes)==null?void 0:f[c??""])??(u==null?void 0:u.seedingProfile);t.seedingProfile&&(n[Ml]||(n[Ml]={...b2[Ml]}),n[Ml].seedingProfile=d);let p=dEe({...t,drawType:c});return p!=null&&p.error?se({result:p,stack:e}):{drawSize:s,drawType:c,enforceGender:r,seedingProfile:d,appliedPolicies:i,policyDefinitions:n}}function oEe(t){let{policyDefinitions:e,appliedPolicies:i,enforceMinimumDrawSize:n=!0,drawSize:r}=t,o=t.drawTypeCoercion??cP({drawType:t.drawType,policyDefinitions:e,appliedPolicies:i}),a=one({drawType:t.drawType,enforceMinimumDrawSize:n,drawTypeCoercion:o,drawSize:r});return a.error?a:{drawType:a.drawType}}function hoe(t){return t==null?void 0:t.filter(e=>e.entryStatus&&[...ec,kD].includes(e.entryStatus))}function aEe({considerEventEntries:t=!0,drawEntries:e,eventEntries:i,qualifyingOnly:n}){return(n&&[]||hoe(e)||(t?i:[])).filter(({entryStage:r})=>!r||r===ut)}function sEe(t){let{tournamentRecord:e,event:i}=t,n=Bi({tournamentRecord:e,event:i}).appliedPolicies??{},r=dt(t.policyDefinitions??{},!1,!0);return{appliedPolicies:n,policyDefinitions:r}}function lEe({enforceGender:t,policyDefinitions:e,appliedPolicies:i}){var n,r,o,a;return t??((r=(n=e==null?void 0:e[Zr])==null?void 0:n.participants)==null?void 0:r.enforceGender)??((a=(o=i==null?void 0:i[Zr])==null?void 0:o.participants)==null?void 0:a.enforceGender)}function cEe(t){let{consideredEntries:e,appliedPolicies:i,policyDefinitions:n,enforceGender:r,participantMap:o,participants:a,event:s}=t;return s&&a&&qA({consideredEntries:e,policyDefinitions:n,appliedPolicies:i,participantMap:o,enforceGender:r,participants:a,event:s})}function uEe(t){return!t.drawSize&&t.consideredEntries.length&&![jl,TD,u0,Hl,Id].includes(t.drawType??"")&&i0(t.consideredEntries.length)||t.drawSize&&Et(t.drawSize)||!1}function dEe(t){var a,s;let{tournamentRecord:e,event:i,ignoreAllowedDrawTypes:n,drawType:r}=t,o=!n&&e&&i_({tournamentRecord:e,categoryType:(a=i==null?void 0:i.category)==null?void 0:a.categoryType,categoryName:(s=i==null?void 0:i.category)==null?void 0:s.categoryName});return o!=null&&o.length&&!o.includes(r)?{error:G$}:{...ae}}function m_(t){let{voluntaryConsolation:e,tournamentRecord:i,event:n}=t,r="generateDrawDefinition",{participants:o,participantMap:a}=zn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:i}),s=hoe(n==null?void 0:n.entries)??[],l=rEe({...t,participantMap:a,participants:o,eventEntries:s});if(l.error)return se({result:l,stack:r});let{appliedPolicies:c,policyDefinitions:u,drawSize:d,drawType:p,enforceGender:h,seedingProfile:f}=l,m=n==null?void 0:n.eventType,g=t.matchUpType??m,v=h1e({...t,enforceGender:h,eventType:m,matchUpType:g});if(v.error)return se({result:v,stack:r});let{matchUpFormat:y,tieFormat:b}=v;if(t.drawId&&typeof t.drawId!="string")return se({result:{error:Pe},stack:r});let I=V1e({...t,isMock:t.isMock??!0,policyDefinitions:u,tournamentRecord:i,appliedPolicies:c,matchUpFormat:y,seedingProfile:f,participants:o,eventEntries:s,matchUpType:g,tieFormat:b,drawSize:d,drawType:p,event:n});if(I.error)return se({result:I,stack:r});let{existingDrawDefinition:T,positioningReports:S,drawDefinition:w,structureId:U,conflicts:D,entries:E}=I;if(!w)return se({result:{error:Pe},stack:r});let C=j1e({...t,existingDrawDefinition:T,positioningReports:S,appliedPolicies:c,drawDefinition:w,seedingProfile:f,participants:o,structureId:U,entries:E,params:t,stack:r});if(C.error)return C;let{qualifyingConflicts:M}=C;return w.drawName=t.drawName??(p&&vo(p)),d&&typeof e=="object"&&d>=4&&Bj({...e,drawDefinition:w,matchUpType:g}),{existingDrawDefinition:!!T,qualifyingConflicts:M,positioningReports:S,drawDefinition:w,structureId:U,...ae,conflicts:D}}function foe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:gt,info:"missing scaleAttributes"};let o=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;let a=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:o[s],eventType:t.eventType,scaleType:rd,scaleName:r,scaleDate:a}],participantId:s}))}}function pEe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:o,drawId:a,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){let d=u_({policyDefinitions:i,drawDefinition:e,drawSize:o,drawId:a,event:s,stage:l});if(d.error)return d;let{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Pe};let m=Vy({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=foe({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var gG={};ii(gG,{addDrawEntries:()=>xj,addEventEntries:()=>sd,addEventEntryPairs:()=>boe,destroyPairEntries:()=>xte,destroyPairEntry:()=>Fj,getEntriesAndSeedsCount:()=>u_,getMaxEntryPosition:()=>eG,modifyEntriesStatus:()=>AM,modifyEventEntries:()=>Ioe,mutate:()=>moe,promoteAlternate:()=>voe,promoteAlternates:()=>yG,query:()=>aoe,removeDrawEntries:()=>yoe,removeEventEntries:()=>qD,setEntryPosition:()=>vG,setEntryPositions:()=>goe});var moe={};ii(moe,{addDrawEntries:()=>xj,addEventEntries:()=>sd,addEventEntryPairs:()=>boe,destroyPairEntries:()=>xte,destroyPairEntry:()=>Fj,modifyEntriesStatus:()=>AM,modifyEventEntries:()=>Ioe,promoteAlternate:()=>voe,promoteAlternates:()=>yG,removeDrawEntries:()=>yoe,removeEventEntries:()=>qD,setEntryPosition:()=>vG,setEntryPositions:()=>goe});function vG({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:o}){let a="setEntryPositions";if(!t)return{error:Ge};if(!i)return se({result:{error:Rr},stack:a});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Pe,entryPosition:n};((o==null?void 0:o.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(l=>{l.participantId===i&&(l.entryPosition=n)});let s=l=>{l.entries.forEach(c=>{c.entryPosition===n&&c.participantId!==i&&(c.entryPosition+=.1)})};return r||(o!=null&&o.entries&&(s(o),o.entries=Cc({entries:o.entries})),e!=null&&e.entries&&(s(e),e.entries=Cc({entries:e.entries}))),{...ae}}function goe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:Ge};if(!Array.isArray(e))return{error:Pe};for(let r of e){let{participantId:o,entryPosition:a}=r,s=vG({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:o,entryPosition:a,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=Cc({entries:n.entries})),i!=null&&i.entries&&(i.entries=Cc({entries:i.entries})),{...ae}}function voe(t){let{participantId:e}=t;return e&&typeof e!="string"?{error:Pe,participantId:e}:yG({...t,participantIds:[e].filter(Boolean)})}function yG({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=ut,eventId:o,event:a}){if(!t)return{error:Ge};if(!Array.isArray(i))return{error:Pe,participantIds:i};if(!a)return{error:Vi};let s="promoteAlternates";if(a){let l=j6({element:a,participantIds:i,stageSequence:n,stage:r});if(l.error)return l}if(e){let l=j6({element:e,participantIds:i,stageSequence:n,stage:r});if(l.error)return o?se({context:{drawPromotionError:l.error,drawId:e.drawId},result:{...ae},stack:s}):l}return{...ae}}function j6({participantIds:t,stageSequence:e,element:i,stage:n}){let r=(i.entries||[]).filter(d=>d.entryStatus===Ol),o=(i.entries||[]).filter(d=>t.includes(d.participantId)),a=r.reduce((d,p)=>{let{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),s=o.length?o:[a].filter(Boolean);if(!(s!=null&&s.length))return{error:sQ};let l=s.filter(({entryStatus:d})=>d!==Ol);if(l.length)return{error:OF,invalidEntryStatus:l};let c=s.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:O0e,invalidStage:c};let u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:L0e,invalidStageSequence:u};for(let d of s){d.entryStatus=Ds;let p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Ol&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});let h=Math.max(...i.entries.filter(f=>f.entryStatus===Ds&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>Et(f||0)),0);d.entryPosition=h||0}return{...ae}}function yoe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:o}){var u;if(!o)return{error:Vi};if(!n)return{error:Wc};if(!(e!=null&&e.length))return{error:yf};let a=fg({drawDefinition:i,stages:r}).assignedParticipantIds??[];if(sa(a,e))return{error:Qw};let s=d=>{let p=d.participantId;return!e.includes(p)},{flightProfile:l}=Kn({event:o}),c=(u=l==null?void 0:l.flights)==null?void 0:u.find(d=>d.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(s),t&&(c.drawEntries=Cc({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=Cc({entries:i.entries}))),{...ae}}function Pu(t){var m,g,v,y,b;let e="addParticipant",{allowDuplicateParticipantIdPairs:i,returnParticipant:n,disableNotice:r,pairOverride:o,participant:a}=t,s=t.tournamentId?(m=t.tournamentRecords)==null?void 0:m[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((g=t.tournamentRecords)==null?void 0:g[t.activeTournamentId]));if(!s)return{error:Ge};if(!a)return se({result:{error:Sy},stack:e});a.participantId||(a.participantId=ji()),s.participants||(s.participants=[]);let{participantId:l,individualParticipantIds:c}=a;if(s.participants.reduce((I,T)=>T.participantId===l||I,!1))return{error:iQ};let{participantType:u,participantRole:d}=a;if(!u||!Object.keys(mI).includes(u))return{error:_c,participantType:u};if(!d)return{error:tQ};let p=s.participants||[],h=p.filter(I=>I.participantType===si).map(I=>I.participantId);if(u!==si&&a.person)return{error:Pe,person:a.person};if(c&&!Array.isArray(c))return{error:Pe,individualParticipantIds:c};if(u===jt){if(a.person)return{error:Pe,person:a.person};if(a.individualParticipantIds){if(a.individualParticipantIds.length!==2&&!o)return se({info:"PAIR must be 2 individualParticipantIds",result:{error:xl},stack:e});{let S=p.filter(w=>w.participantType===si).map(w=>w.participantId);if(!Array.isArray(a.individualParticipantIds))return se({result:{error:xl},stack:e});if(!a.individualParticipantIds.reduce((w,U)=>S.includes(U)&&w,!0))return se({result:{error:xl},stack:e})}}else return se({result:{error:yf},stack:e});let I=p.filter(S=>S.participantType===jt).map(S=>({individualParticipantIds:S.individualParticipantIds,participant:S})),T=a.participantType===jt&&I.find(S=>Hn(S.individualParticipantIds,a.individualParticipantIds).length===2);if(T&&!i)return{...ae,existingParticipant:!0,participant:n&&dt(T.participant)};if(!a.participantName){let S=p.filter(U=>{var D;return(D=a.individualParticipantIds)==null?void 0:D.includes(U.participantId)}),w=S.map(U=>{var D;return(D=U.person)==null?void 0:D.standardFamilyName}).filter(Boolean).join("/");S.length===1&&(w+="/Unknown"),a.participantName=w}}else if(u===si){if(!((v=a.person)!=null&&v.standardFamilyName)||!((y=a.person)!=null&&y.standardGivenName))return{error:aQ};if(!a.participantName){let I=`${a.person.standardFamilyName.toUpperCase()}, ${a.person.standardGivenName}`;a.participantName=I}}else if(u&&[en,ks].includes(u)){if(c||(a.individualParticipantIds=[]),(b=a.individualParticipantIds)==null?void 0:b.length)for(let I of a.individualParticipantIds){if(typeof I!="string")return se({result:{participantId:I,error:Pe},stack:e});if(!h.includes(I))return se({result:{participantId:I,error:Jn},stack:e})}}else return{error:_c};s.participants.push(a),r||di({payload:{tournamentId:s.tournamentId,participants:[a]},topic:qh});let f={participant:n&&dt(a),...ae};return wt(f)}function Oc({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:Ge};i.participants||(i.participants=[]);let r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=ji())});let o=n.filter(d=>!r.includes(d.participantId)),a=n.filter(d=>r.includes(d.participantId)),s=o.filter(d=>d.participantType===si),l=o.filter(d=>d.participantType!==si),c=s.concat(...l),u=[];if(c.length){for(let p of c){let h=Pu({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&di({topic:qh,payload:{tournamentId:i.tournamentId,participants:u}});let d={participants:e&&dt(u),addedCount:u.length,...ae};return a.length&&Object.assign(d,{notAdded:a,info:ZN}),wt(d)}else return{info:"No new participants to add",addedCount:0,...ae}}function boe({allowDuplicateParticipantIdPairs:t,entryStage:e=ut,entryStatus:i=Ol,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:o,event:a,uuids:s}){if(!r)return{error:Ge};if(!a)return{error:Vi};if(a.eventType!==an)return{error:Hh};let l=[],c=new Map;for(let y of r.participants??[]){let{participantType:b,participantId:I,person:T,individualParticipantIds:S}=y;b===si&&(T!=null&&T.sex)?c.set(I,T.sex):b===jt&&S&&l.push(S)}let u=n.filter(y=>{if(y.length!==2||!c.has(y[0])||!c.has(y[1]))return!0;if(!a.gender||a.gender===Tu)return!1;let b=y.map(T=>c.get(T)),I=a.gender===nn&&(b[0]!==nn||b[1]!==nn)||a.gender===Un&&(b[0]!==Un||b[1]!==Un);return a.gender===ts&&(b.sort(RA),(b[0]!==Un||b[1]!==nn)&&(I=!0)),I});if(u.length)return{error:xl,invalidParticipantIdPairs:u};let d=n.map(y=>({participantId:(s==null?void 0:s.pop())??ji(),participantRole:Mo,individualParticipantIds:y,participantType:jt})),p=t?d:d.filter(y=>!l.find(b=>Hn(b,y.individualParticipantIds).length===2)),h,f=[];if(p){let y=Oc({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(y.error)return y;f=y.participants||[],h=y.info}let m=n.map(y=>{let b=f.find(T=>Hn(T.individualParticipantIds,y).length===2);if(b)return b;let{participant:I}=zl({tournamentRecord:r,participantIds:y});return I}).map(y=>y.participantId),g=sd({participantIds:m,tournamentRecord:r,drawDefinition:o,entryStatus:i,entryStage:e,event:a});p.length&&di({payload:{participants:p},topic:qh});let v=p.map(ai);return{...g,info:h,newParticipantIds:v}}function Ioe({entryStatus:t=Ds,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=ut,tournamentRecord:r,event:o}){if(!r)return{error:Ge};if(!o)return{error:Vi};let a=r.participants??[],s=a.filter(m=>m.participantType===si).map(m=>m.participantId),l=e.concat(...i).flat(1/0).filter(m=>!s.includes(m));if(l.length)return{error:xl,invalidParticipantIds:l};let c=i.filter(m=>m.length!==2);if(c.length)return{error:xl,invalidParticipantIdPairs:c};let u=a.filter(m=>m.participantType===jt).map(m=>m.individualParticipantIds),d=i.filter(m=>!u.find(g=>Hn(g,m).length===2)).map(m=>({participantType:jt,participantRole:Mo,individualParticipantIds:m})),p=Oc({participants:d,tournamentRecord:r});if(p.error)return p;let h=i.map(m=>{let{participant:g}=zl({tournamentRecord:r,participantIds:m});return g}).map(m=>({participantId:m,entryStatus:t,entryStage:n})),f=e.map(m=>({entryStatus:Ql,participantId:m,entryStage:n}));return o.entries=(o.entries??[]).filter(m=>m.entryStage===n),o.entries=o.entries.concat(...h,...f),{...ae}}var bG={};ii(bG,{addDrawDefinition:()=>y_,addEvent:()=>vP,addFlight:()=>I_,assignSeedPositions:()=>Noe,attachFlightProfile:()=>DG,categoryCanContain:()=>$A,deleteDrawDefinitions:()=>g_,deleteEvents:()=>_oe,deleteFlightAndFlightDraw:()=>Moe,deleteFlightProfileAndFlightDraws:()=>Doe,getCategoryAgeDetails:()=>rP,getEvent:()=>mG,getEventProperties:()=>hG,getEventStructures:()=>kA,getEventTimeItem:()=>VD,getEvents:()=>fG,getFlightProfile:()=>Kn,getScaledEntries:()=>Vy,modifyEvent:()=>koe,modifyEventMatchUpFormatTiming:()=>Poe,modifyPairAssignment:()=>Roe,mutate:()=>woe,query:()=>poe,refreshEventDrawOrder:()=>UG,removeEventMatchUpFormatTiming:()=>v_,removeScaleValues:()=>PG,removeSeeding:()=>Aoe,setEventDates:()=>Coe,setEventDisplay:()=>b_,setEventEndDate:()=>SG,setEventStartDate:()=>wG,updateDrawIdsOrder:()=>TG,validateCategory:()=>FM});var woe={};ii(woe,{addDrawDefinition:()=>y_,addEvent:()=>vP,addFlight:()=>I_,assignSeedPositions:()=>Noe,attachFlightProfile:()=>DG,deleteDrawDefinitions:()=>g_,deleteEvents:()=>_oe,deleteFlightAndFlightDraw:()=>Moe,deleteFlightProfileAndFlightDraws:()=>Doe,modifyEvent:()=>koe,modifyEventMatchUpFormatTiming:()=>Poe,modifyPairAssignment:()=>Roe,refreshEventDrawOrder:()=>UG,removeEventMatchUpFormatTiming:()=>v_,removeScaleValues:()=>PG,removeSeeding:()=>Aoe,setEventDates:()=>Coe,setEventDisplay:()=>b_,setEventEndDate:()=>SG,setEventStartDate:()=>wG,updateDrawIdsOrder:()=>TG,validateCategory:()=>FM});function U0({removePriorValues:t=!0,status:e=ic,statusObject:i,event:n}){if(!ln(i))return{error:Pe};let r=fl({event:n,status:e}),o=`${ug}.${dg}`,a={itemValue:{[e]:{...r,...i}},itemType:o};return By({timeItem:a,removePriorValues:t,event:n})}function D0(t){var I,T,S,w,U,D,E;let{includePositionAssignments:e,removePriorValues:i,tournamentRecord:n,status:r=ic,event:o,drawIdsToRemove:a,drawIdsToAdd:s}=t;if(!n)return{error:Ge};if(!o)return{error:Vi};let{appliedPolicies:l}=Bi({tournamentRecord:n,event:o}),c={...l,...t.policyDefinitions},u=((I=o.drawDefinitions)==null?void 0:I.map(({drawId:C})=>C))??[],d=t.drawDetails?Object.keys(t.drawDetails):[],p=d.length?[]:t.drawIds,h=(s??[]).concat(...a??[],...p??[],...d),f=h.filter(C=>!u.includes(C));if(f.length)return se({result:{error:ns},context:{invalidDrawIds:f}});let m=fl({event:o,status:r}),g=Object.keys((m==null?void 0:m.drawDetails)||{}).filter(C=>u.includes(C)).reduce((C,M)=>(C[M]=m.drawDetails[M],C),{});for(let C of u)if((!h.length||h.includes(C))&&(a!=null&&a.includes(C)||p!=null&&p.length&&!p.includes(C)?g[C]={...g[C],publishingDetail:{published:!1}}:(s!=null&&s.includes(C)||p!=null&&p.includes(C)||!(p!=null&&p.length))&&(g[C]={...g[C],publishingDetail:{published:!0}})),(T=t.drawDetails)==null?void 0:T[C]){let M=t.drawDetails[C],N=M.structureDetails??g[C].structureDetails,R=M.stageDetails??g[C].stageDetails??{},{structureIdsToRemove:A=[],structureIdsToAdd:_=[],publishingDetail:k={},stagesToRemove:O=[],stagesToAdd:F=[]}=M;if((_||F)&&(k.published=!0),g[C]={publishingDetail:k,structureDetails:N,stageDetails:R},_.length||A.length){let $=(((w=(S=o.drawDefinitions)==null?void 0:S.find(H=>H.drawId===C))==null?void 0:w.structures)??[]).map(({structureId:H})=>H),V=(_??[]).concat(A??[]).filter(H=>!$.includes(H));if(V.length)return se({result:{error:Nn},context:{invalidStructureIds:V}});N=N??{};for(let H of $)A.includes(H)?N[H]={published:!1}:N[H]={published:!0};g[C].structureDetails=N}let B=(((D=(U=o.drawDefinitions)==null?void 0:U.find($=>$.drawId===C))==null?void 0:D.structures)??[]).map(({stage:$})=>$);if(F.length){for(let $ of F)R[$]={published:!0};for(let $ of B)R[$]||(R[$]={published:!1})}if(F.length||O.length){for(let $ of O)R[$]={published:!1};for(let $ of B)R[$]||(R[$]={published:!0})}(F.length||O.length)&&(g[C].stageDetails=R)}U0({statusObject:{drawDetails:g},removePriorValues:i,status:r,event:o});let{topics:v}=pl(),y=v.includes(GF),b=y||t.returnEventData?(E=a_({includePositionAssignments:e,usePublishState:!0,tournamentRecord:n,policyDefinitions:c,event:o}))==null?void 0:E.eventData:void 0;return y&&di({payload:{eventData:b,tournamentId:n.tournamentId},topic:GF}),{...ae,eventData:b}}var Soe="deleteDrawDefinitions",Toe="autoSchedulingAudit",w2="deleteEvents",Uoe={AUTO_SCHEDULING_AUDIT:Toe,DELETE_EVENTS:w2,DELETE_DRAW_DEFINITIONS:Soe};function g_(t){var U,D,E;if(!t.tournamentRecord)return{error:Ge};let e="deleteDrawDefinitions",i=t.drawIds??[],n=t.event,{autoPublish:r=!0,tournamentRecord:o,auditData:a,eventId:s,force:l}=t,{appliedPolicies:c}=Bi({tournamentRecord:o,event:n}),u={...c,...t.policyDefinitions},d=Array.isArray(i)?i[0]:void 0;if(!n){let C=Ta({tournamentRecord:o,eventId:s,drawId:d});if(C.error)return C;n=C.event}let p=[],h=[],f=[];if(!(n!=null&&n.drawDefinitions))return se({info:"event has no drawDefinition",result:{...ae},stack:e});let m=n.drawDefinitions.map(({drawId:C})=>C);if(i.length||(i=m),i=i.filter(C=>m.includes(C)),!i.length)return se({info:"nothing to do; no matching drawIds in event.",result:{...ae},stack:e});let g=dt(Kn({event:n}).flightProfile,!1,!0),v=({participantId:C,drawPosition:M,qualifier:N,bye:R})=>({bye:R,qualifier:N,drawPosition:M,participantId:C}),y=l??((D=(U=c==null?void 0:c[vd])==null?void 0:U.allowDeletionWithScoresPresent)==null?void 0:D.drawDefinitions),b=fl({event:n})??{},I=b.drawIds??(b.drawDetails&&Object.keys(b.drawDetails))??[],T,S=[],w=n.drawDefinitions.filter(C=>{var M,N,R,A,_,k,O,F;if(i.includes(C.drawId)){let B=((M=Ia({event:n,drawDefinition:C}))==null?void 0:M.matchUps)??[];if(B.some(({score:X})=>io({score:X}))&&!y)return S.push(C.drawId),!0;let{drawId:$,drawType:V,drawName:H}=C,z=(N=g==null?void 0:g.flights)==null?void 0:N.find(X=>X.drawId===C.drawId);z&&(z.drawEntries=(R=z.drawEntries)==null?void 0:R.filter(X=>ec.includes(X.entryStatus))),I.includes($)&&(I=I.filter(X=>X!==$),T=!0);let G=(_=(A=wd({stageSequence:1,drawDefinition:C,stage:ut}))==null?void 0:A.structures)==null?void 0:_[0],W=(O=(k=G?ZT({structureId:G.structureId,tournamentRecord:o,drawDefinition:C}):void 0)==null?void 0:k.positionAssignments)==null?void 0:O.map(v),K=(F=wd({stage:Tt,drawDefinition:C}))==null?void 0:F.structures,Z=K!=null&&K.length?K.map(X=>{var te;let Q=X.stageSequence;return{positionAssignments:(te=ZT({structureId:X.structureId,tournamentRecord:o,drawDefinition:C}))==null?void 0:te.positionAssignments.map(v),stageSequence:Q}}):void 0,Y={action:Soe,payload:{drawDefinitions:[C],eventId:s??(n==null?void 0:n.eventId),auditData:a}};f.push(Y),p.push(wt({tournamentId:o.tournamentId,eventId:s??(n==null?void 0:n.eventId),qualifyingPositionAssignments:Z,positionAssignments:W,auditData:a,drawType:V,drawName:H,drawId:$})),B==null||B.forEach(({matchUpId:X})=>h.push(X))}return!i.includes(C.drawId)});if(S.length&&!l)return se({context:{drawIdsWithScoresPresent:S},result:{error:tA},stack:e});if(n.drawDefinitions=w,g&&Uf({event:n,extension:{name:Vl,value:g}}),hP({tournamentRecord:o}),T){let C={};for(let N of I)C[N]=((E=b.drawDetails)==null?void 0:E[N])??{published:!0};let M=U0({statusObject:{drawDetails:C},event:n});if(M.error)return{error:M.error}}if(f.length&&di({topic:zI,payload:f}),h.length&&Bp({tournamentId:o==null?void 0:o.tournamentId,matchUpIds:h}),i.forEach(C=>{pTe({drawId:C})}),hEe({event:n,deletedDrawsDetail:p,auditData:a}),r&&T){let C=D0({drawIdsToRemove:i,policyDefinitions:u,tournamentRecord:o,event:n});if(C.error)return{...ae,info:C.error}}return{...ae}}function hEe({event:t,deletedDrawsDetail:e,auditData:i}){let{extension:n}=Qt({name:DM,element:t}),r={...i,deletedDrawsDetail:e},o={name:DM,value:Array.isArray(n==null?void 0:n.value)?n==null?void 0:n.value.concat(r):[r]};Ui({element:t,extension:o})}function Doe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var a;if(!e)return{error:Ge};if(!n)return{error:Vi};let{flightProfile:o}=Kn({event:n});if(o){let s=(a=o.flights)==null?void 0:a.map(({drawId:c})=>c).filter(Boolean),l=g_({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:lA({event:n,name:Vl})}return{...ae}}function IG(t){let{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:o}=t,a=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(a).length)return{error:On};let s=Object.keys(a).filter(c=>!r||r===c);if(r&&!s.includes(r))return{error:Pe};let l;for(let c of s){let u=a[c],{event:d}=Ta({tournamentRecord:u,eventId:o});o&&d&&(l=!0);let p=fEe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!o||l?{...ae}:{error:rs}}function fEe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:Ge};if(n&&!Array.isArray(n))return{error:Pe};if(e&&!Array.isArray(e))return{error:Pe};let o=mp;if(r){let{extension:a}=Qt({element:r,name:o}),s=(a==null?void 0:a.value)||{},l=H6({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});Ui({element:r,extension:{name:o,value:l}})}else{let{extension:a}=Qt({element:t,name:o}),s=(a==null?void 0:a.value)||{},l=H6({...s,matchUpFormat:i,averageTimes:n,recoveryTimes:e});Ui({extension:{name:o,value:l},element:t})}return{...ae}}function H6(t){let{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t,{averageTimes:r,recoveryTimes:o}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let a=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});o=(o||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});let s=(o==null?void 0:o.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:o});return{matchUpAverageTimes:(a==null?void 0:a.length)&&a||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function Poe(t){let{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:o,eventId:a,event:s}=t;if(!e)return{error:Ge};if(!ls({matchUpFormat:r}))return{error:Pe};if(!s)return{error:Vi};let{averageTimes:l=[],recoveryTimes:c=[]}=d_({tournamentRecord:e,matchUpFormat:r,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId),p={categoryNames:[d],minutes:{}},h={categoryNames:[d],minutes:{}},f=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(o)&&console.log("encountered:",{categoryType:o}),!((T=b.categoryNames)!=null&&T.includes(d)&&(b.categoryNames=b.categoryNames.filter(S=>S!==d),p={minutes:b.minutes,categoryNames:[d]},!b.categoryNames.length)))return b},m=n&&!isNaN(Et(n)),g=i&&!isNaN(Et(i)),v=l.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=c.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||kn]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(s==null?void 0:s.eventType)||kn]:i}),y.push(h)),!m&&!g?{error:Pe}:IG({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:a,event:s})}function v_(t){if(t.event)return G6({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});let e=Ei(t,[{[ko]:!0,[QQ]:!0}]);if(e.error)return e;let{tournamentRecords:i,eventId:n}=t;for(let r of Object.values(i??{})){let{event:o}=Ta({tournamentRecord:r,eventId:n});if(o)return G6({event:o})}}return{error:rs}}function G6({event:t}){return lA({event:t,name:mp})}function wG({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:Ge};if(!e)return{error:Vi};if(!md.test(i))return{error:aa};let n=Eoe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:o}=n,a=new Date(Wt(i)).getTime();if(!r||!o||a<r||a>o)return{error:aa};let s=e.endDate&&new Date(Wt(e.endDate)).getTime();return s&&a>s&&(e.endDate=i),e.startDate=i,{...ae}}function SG({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:Ge};if(!e)return{error:Vi};if(!md.test(i))return{error:aa};let n=Eoe(t);if(n.error)return n;let{tournamentStartDate:r,tournamentEndDate:o}=n,a=new Date(Wt(i)).getTime();if(!r||!o||a<r||a>o)return{error:aa};let s=e.startDate&&new Date(Wt(e.startDate)).getTime();return s&&a<s&&(e.startDate=i),e.endDate=i,{...ae}}function Coe({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:Ge};if(!e)return{error:Vi};if(!i&&!n)return{error:gt,info:"missing date"};if(i&&!md.test(i))return{error:aa};if(n&&!md.test(n))return{error:aa};if(i&&n){let r=new Date(Wt(i)).getTime(),o=new Date(Wt(n)).getTime();if(r>o)return{error:Pe}}if(i){let r=wG({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){let r=SG({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...ae}}function Eoe(t){let{startDate:e,endDate:i}=t;return!md.test(e)||!md.test(i)?se({result:{error:XJ},context:{startDate:e,endDate:i}}):{tournamentStartDate:new Date(Wt(e)).getTime(),tournamentEndDate:new Date(Wt(i)).getTime()}}function TG({event:t,orderedDrawIdsMap:e}){var r,o;if(typeof t!="object")return{error:Vi};if(!e)return{error:gt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Pe,info:"orderedDrawIdsMap must be an object"};let i=Object.values(e);if(!i.every(a=>!isNaN(a)))return{error:Pe,info:"drawOrder must be numeric"};if(Zt(i).length!==i.length)return{error:Pe,info:"drawOrder values must be unique"};if((r=t.drawDefinitions)!=null&&r.length){let a=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&Hn(a,s).length!==a.length)return{error:Pe,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}let{flightProfile:n}=Kn({event:t});return(o=n==null?void 0:n.flights)==null||o.forEach(a=>{a.flightNumber=e[a.drawId]}),{...ae}}function UG({tournamentRecord:t,event:e}){var r;if(!t)return{error:Ge};if(!e)return{error:Vi};let{flightProfile:i}=Kn({event:e}),n=(i==null?void 0:i.flights)&&Object.assign({},...i.flights.sort((o,a)=>o.flightNumber-a.flightNumber).map((o,a)=>({[o.drawId]:a+1})))||((r=e.drawDefinitions)==null?void 0:r.length)&&Object.assign({},...e.drawDefinitions.sort((o,a)=>o.drawOrder-a.drawOrder).map((o,a)=>({[o.drawId]:a+1})))||void 0;return n?TG({event:e,orderedDrawIdsMap:n}):{...ae}}function Moe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:o}){var s,l;if(!e)return{error:Ge};if(!n)return{error:Wc};if(!r)return{error:Vi};let{flightProfile:a}=Kn({event:r});if(a&&((s=a.flights)!=null&&s.find(c=>c.drawId===n))){let c=a.flights.filter(d=>d.drawId!==n),u={name:Vl,value:{...a,flights:c}};Uf({event:r,extension:u})}if((l=r.drawDefinitions)!=null&&l.find(c=>c.drawId===n)){let c=g_({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:o});if(c.error)return c}return UG({tournamentRecord:e,event:r})}function Roe({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:o,uuids:a}){var f,m;if(!o)return{error:Vi};if((o==null?void 0:o.eventType)!==Gl)return{error:Hh};if(a&&!Array.isArray(a))return{error:Pe};if(!i)return{error:Ge};if(![t,e,r].every(g=>typeof g=="string"))return{error:Rr};if(!(((f=o==null?void 0:o.entries)==null?void 0:f.filter(({entryStatus:g})=>[Ql,sg].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:bu};let s=(i.participants||[]).find(g=>g.participantId===r);if((s==null?void 0:s.participantType)!==jt)return{error:Jw,participant:s};let l=s.individualParticipantIds,c=[t,...l.filter(g=>g!==e)],{participant:u}=zl({participantIds:c,tournamentRecord:i}),d;if(u)d=u.participantId;else{let g={participantId:a==null?void 0:a.pop(),participantRole:Mo,individualParticipantIds:c,participantType:jt},v=Pu({participant:g,returnParticipant:!0,tournamentRecord:i});if(v.error)return v;d=v.participant.participantId}let{flightProfile:p}=Kn({event:o});if(n){let g=(m=p==null?void 0:p.flights)==null?void 0:m.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:d}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:d}:v);for(let v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:d}:y);else if(v.structures)for(let y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===r?{...b,participantId:d}:b)}o.entries=o.entries.map(g=>g.participantId===r&&{...g,participantId:d}||g.participantId===t&&{...g,participantId:e}||g);let h=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>o.eventId===v?y.some(({drawId:b,entries:I})=>b===(n==null?void 0:n.drawId)?!1:I==null?void 0:I.find(T=>T.participantId===r)):g==null?void 0:g.find(b=>b.participantId===r));if(!h){let g=xy({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...ae,participantOtherEntries:h,newPairParticipantId:d}}function y_(t){var M,N,R,A,_,k,O,F,B,$,V,H;let{flight:e,suppressNotifications:i,modifyEventEntries:n,existingDrawCount:r,allowReplacement:o,checkEntryStatus:a,tournamentRecord:s,drawDefinition:l,event:c}=t;if(!l)return{error:lt};if(!c)return{error:Vi};c.drawDefinitions||(c.drawDefinitions=[]);let{drawId:u,drawName:d,entries:p}=l,{entries:h}=c,f=0;if(r!==void 0&&r!==c.drawDefinitions.length)return{error:Pe,info:"drawDefintions count mismatch"};let{flightProfile:m}=Kn({event:c}),g=e&&((M=m==null?void 0:m.flights)==null?void 0:M.find(z=>z.flightNumber===e.flightNumber)),v=(A=(R=(N=m==null?void 0:m.links)==null?void 0:N.find(z=>{var G;return((G=z==null?void 0:z.target)==null?void 0:G.drawId)===u}))==null?void 0:R.source)==null?void 0:A.drawId;if(v&&!c.drawDefinitions.find(z=>z.drawId===v))return se({result:{error:lt},info:{sourceDrawId:v}});if(g&&g.drawId!==l.drawId)return se({result:{error:sv},info:{relevantFlight:g}});let y=p==null?void 0:p.every(({participantId:z,entryStatus:G})=>{let W=g==null?void 0:g.drawEntries.find(K=>K.participantId===z);return!G||(W==null?void 0:W.entryStatus)===G}),b=!a||h&&(p==null?void 0:p.every(({participantId:z,entryStatus:G,entryStage:W})=>{var K;return((K=h.find(Z=>Z.participantId===z&&(!Z.entryStage||Z.entryStage===W)))==null?void 0:K.entryStatus)===G}));if(g&&!y)return se({result:{error:sv},context:{drawEntriesPresentInFlight:y,matchingEventEntries:b,relevantFlight:g},info:"Draw entries are not present in flight or do not match entryStatuses"});if(n&&(p==null||p.filter(Boolean).forEach(z=>{if(z!=null&&z.entryStatus&&ec.includes(z==null?void 0:z.entryStatus)){let G=h==null?void 0:h.filter(Boolean).find(W=>W.participantId===z.participantId);G&&z.entryStatus&&(G==null?void 0:G.entryStatus)!==z.entryStatus&&(G.entryStatus=z.entryStatus,f+=1)}})),h&&!b)return se({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:b,eventEntries:h},error:sv}});let I=((k=(_=m==null?void 0:m.flights)==null?void 0:_.map(({flightNumber:z})=>!isNaN(z)&&Et(z)))==null?void 0:k.filter(Boolean))||[],T=((O=c.drawDefinitions.map(({drawOrder:z})=>z&&Et(z)))==null?void 0:O.filter(Boolean))||[],S=Math.max(0,...T,...I)+1,w=(F=m==null?void 0:m.flights)==null?void 0:F.find(z=>z.drawId===u),U;if(w){w.drawName=l.drawName,U={name:Vl,value:{...m,flights:m.flights}};let z=w.flightNumber;z&&!T.includes(z)?S=z:w.flightNumber=S}else{let z=(m==null?void 0:m.flights)||[];z.push({manuallyAdded:!0,flightNumber:S,drawEntries:p,drawName:d,drawId:u}),U={name:Vl,value:{...m||{},flights:z}}}Uf({event:c,extension:U}),Object.assign(l,{drawOrder:S});let D=c.drawDefinitions.find(z=>z.drawId===u),E=s==null?void 0:s.tournamentId,C=c.eventId;if(D){if(!o)return{error:MJ};let z=(($=(B=Ia({drawDefinition:D}))==null?void 0:B.matchUps)==null?void 0:$.map(Br))??[],G=(V=Ia({drawDefinition:l}))==null?void 0:V.matchUps;if(!i){z!=null&&z.length&&Bp({matchUpIds:z,action:"modifyDrawDefinition",tournamentId:E,eventId:C}),G!=null&&G.length&&Yh({matchUps:G,tournamentId:E,eventId:C}),c.drawDefinitions=c.drawDefinitions.map(K=>K.drawId===u?l:K);let W=(H=l.structures)==null?void 0:H.map(({structureId:K})=>K);cn({drawDefinition:l,tournamentId:E,structureIds:W,eventId:C})}}else if(c.drawDefinitions.push(l),!i){let{matchUps:z}=Ia({drawDefinition:l,event:c});z&&Yh({tournamentId:s==null?void 0:s.tournamentId,matchUps:z}),PD({drawDefinition:l,tournamentId:E,eventId:C})}return{...ae,modifiedEventEntryStatusCount:f}}function Noe(t){let{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:o,structureId:a,assignments:s,drawId:l,event:c}=t,u=0;if(!(s!=null&&s.length))return{error:Y$};if(!n)return{error:Ge};if(!l)return{error:Wc};let d=ol({provisionalPositioning:e,drawDefinition:r,structureId:a});if(d.error)return d;let{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{let{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});let m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==OQ(g).length)return{error:RJ};for(let v of m){let y=I0({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:o,structureId:a,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...ae,modifications:u}:{error:t0}}function DG({deleteExisting:t,event:e,flightProfile:i}){var o;let n="attachFlightProfile";if(!i)return se({result:{error:gt},stack:n});if(!e)return se({result:{error:Vi},stack:n});let{flightProfile:r}=Kn({event:e});return r&&!t?se({result:{error:hV},stack:n}):(o=e.drawDefinitions)!=null&&o.length?se({result:{error:PJ},stack:n}):(Uf({event:e,extension:{name:Vl,value:i}}),{flightProfile:dt(i,!1,!0),...ae})}function mEe({tournamentRecord:t,scaleAttributes:e,participantIds:i}){var s;if(!t)return{error:Ge};if(!i)return{error:yf};if(!e)return{error:gt,info:"scaleAttributes required"};let{scaleType:n,eventType:r,scaleName:o}=e,a=[Zee,n,r,o].join(".");return(s=t.participants)==null||s.forEach(l=>{i.includes(l.participantId)&&l.timeItems&&(l.timeItems=l.timeItems.filter(c=>c&&(c==null?void 0:c.itemType)!==a))}),{...ae}}function PG({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:o,stage:a}){var c;if(!o)return{error:Vi};if(n&&!Array.isArray(n))return se({result:{error:Pe},info:Td("entryStatus"),stack:"removeScaleValues"});let s=o.entries;if(r){let{flightProfile:u}=Kn({event:o}),d=(c=u==null?void 0:u.flights)==null?void 0:c.find(p=>p.drawId===r);d?s=d.drawEntries:s=i==null?void 0:i.entries}let l=(s||[]).filter(u=>(!a||!u.entryStage||u.entryStage===a)&&(!n||n.includes(u.entryStatus))).map(ai);return mEe({tournamentRecord:t,scaleAttributes:e,participantIds:l})}function b_({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=ic,event:r}){if(!e)return se({result:{error:Ge}});if(!r)return se({result:{error:Vi}});if(!ln(i))return se({result:{error:gt}});if(ln(i.draws))for(let a of Object.keys(i.draws)){let s=i.draws[a].scheduleDetails??[];if(s.length){let l=[];for(let c of s){let u=l.find(d=>S0e(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[a].scheduleDetails=l}}let o=U0({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return o.error?o:{...ae}}function Aoe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:o,stage:a}){var l,c;if(!t)return{error:Ge};if(!o)return{error:Vi};n=n||((l=o.category)==null?void 0:l.categoryName)||((c=o.category)==null?void 0:c.ageCategoryCode);let s={eventType:o.eventType,scaleType:rd,scaleName:n};return PG({tournamentRecord:t,scaleAttributes:s,drawDefinition:e,entryStatuses:i,drawId:r,event:o,stage:a})}function _oe({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:Ge};if(!e.events)return{error:rs};if(!Array.isArray(i))return{error:gt,info:Td("drawIds")};let n=[],r=[],o=[],a=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){let u={action:w2,payload:{events:[s]}};n.push(u),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}let l=s.eventType===Gl?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Ql&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?a.push(...l):o.push(...l),!c}),t){let s=a.filter(l=>!o.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return hP({tournamentRecord:e}),n.length&&(di({topic:zI,payload:n}),Fy({tournamentRecord:e,timeItem:{itemType:w2,itemValue:r}})),{...ae}}function koe({tournamentRecord:t,eventUpdates:e,eventId:i,event:n}){var p;let r="modifyEvent";if(!t)return se({result:{error:Ge},stack:r});if(!oa(i))return se({result:{error:Vi},context:{eventId:i},stack:r});if(!ln(e))return se({result:{error:Pe},context:{eventUpdates:e},stack:r});let o=((p=n==null?void 0:n.entries)==null?void 0:p.filter(({entryStatus:h})=>{let f=h;return[...ec,Ol].includes(f)}).map(({participantId:h})=>h))??[],a=o?zn({participantFilters:{participantIds:o},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],s=[],l=a.reduce((h,f)=>{var g,v;let m=(g=f.person)!=null&&g.sex?[f.person.sex]:((v=f.individualParticpants)==null?void 0:v.map(y=>{var b;return(b=y.person)==null?void 0:b.sex}))||[];return s.push(...m),h.includes(f.participantType)?h:h.concat(f.participantType)},[]),c=Zt(s),u=!c.length||[ts,Tu].includes(e.gender??"")||c.length===1&&c[0]===e.gender;if(e.gender&&!u)return se({context:{gender:e.gender,validGender:u},result:{error:Pe},stack:r});let d=(l.includes(Or)&&[Or]||l.includes(si)&&[Sd]||l.includes(jt)&&[Gl]||[Gl,Sd,Or]).includes(e.eventType??"");return e.eventType&&!d?se({context:{participantType:e.eventType,validEventType:d},result:{error:Pe},stack:r}):(e.eventType&&(n.eventType=e.eventType),e.eventName&&(n.eventName=e.eventName),e.gender&&(n.gender=e.gender),{...ae})}function I_({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:o}){var h,f,m;let a="addFlight";if(!r)return se({result:{error:Vi},stack:a});if(!i)return se({result:{error:gt},stack:a});if(e!=null&&e.length){let g=(r.entries??[]).map(ai),v=e.map(ai);if(Hn(v,g).length!==v.length)return se({result:{error:Pe},stack:a})}let s=(h=Kn({event:r}))==null?void 0:h.flightProfile,l=((m=(f=s==null?void 0:s.flights)==null?void 0:f.map(({flightNumber:g})=>!isNaN(g)&&Et(g)))==null?void 0:m.filter(Boolean))||[],c=Math.max(0,...l)+1,u={drawId:n||ji(),flightNumber:c,drawEntries:e,drawName:i};if(o&&(u.stage=o),t&&(u.qualifyingPositions=t),((s==null?void 0:s.flights)||[]).find(({drawId:g})=>g===u.drawId))return se({result:{error:PQ},stack:a});let d=((s==null?void 0:s.flights)||[]).concat(u),p={name:Vl,value:{...s||{},flights:d}};return Uf({event:r,extension:p})}var gEe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},vEe={collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},yEe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},xoe={COLLEGE_D3:gEe,COLLEGE_DEFAULT:vEe,COLLEGE_JUCO:yEe,DOMINANT_DUO:vre,DOMINANT_DUO_MIXED:hre,LAVER_CUP:Sre,TEAM_DOUBLES_3_AGGREGATION:lre,TIME_TENNIS_DUAL:fre,TIME_TENNIS_PRO_CIRCUIT:pre,USTA_BREWER_CUP:mre,USTA_OZAKI_CUP:gre,USTA_COLLEGE:yre,USTA_GOLD_TEAM_CHALLENGE:sre,USTA_INTERSECTIONAL:dre,USTA_LEVEL_1:bre,USTA_SECTION_BATTLE:ure,USTA_SOUTHERN_LEVEL_5:cre,USTA_TOC:Tre,USTA_WTT_ITT:Ire,USTA_ZONAL:wre};function vP({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var s,l,c,u;if(!e)return{error:Ge};if(e.events||(e.events=[]),!n)return{error:Vi};let{startDate:r,endDate:o}=e;if(!i&&((s=n.entries)!=null&&s.length||(l=n.drawDefinitions)!=null&&l.length)){let d=wt({drawDefinitions:!!((c=n.drawDefinitions)!=null&&c.length),entries:!!((u=n.entries)!=null&&u.length)});return{info:"entries/drawDefinitions cannot exist",error:Pe,context:d}}let a={eventType:Bv,drawDefinitions:[],entries:[],startDate:r,endDate:o,...n};if(n.eventType===al){if(n.tieFormat){let d=$a({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!xoe[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Pe};let d=Gv({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});a.tieFormat=d}}if(a.eventId||(a.eventId=ji()),e.events.reduce((d,p)=>d||p.eventId===a.eventId,void 0))return{error:BJ};{let d=a;if(e.events.push(d),!t){let{topics:p}=pl();if(p.includes(vA)){let h=Hp({event:n}).matchUps??[];Yh({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:h})}for(let h of n.drawDefinitions||[])PD({drawDefinition:h})}return{...ae,event:a}}}var CG={};ii(CG,{drawMatic:()=>OH,garman:()=>joe,generateAdHocMatchUps:()=>YA,generateAdHocRounds:()=>xH,generateAndPopulatePlayoffStructures:()=>sH,generateCourts:()=>EG,generateDrawDefinition:()=>m_,generateDrawMaticRound:()=>PH,generateDrawStructuresAndLinks:()=>TH,generateDrawTypeAndModifyDrawDefinition:()=>UH,generateFlightProfile:()=>IEe,generateLineUps:()=>Voe,generateQualifyingStructure:()=>eH,generateSeedingScaleItems:()=>foe,generateVoluntaryConsolation:()=>gne,roundRobinGroups:()=>$Ue});var bEe="splitLevelBased",Ooe="splitWaterfall",Loe="splitShuttle",Foe={SPLIT_LEVEL_BASED:bEe,SPLIT_WATERFALL:Ooe,SPLIT_SHUTTLE:Loe};function IEe(t){let{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:o,deleteExisting:a,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Vi};let f=p.entries??[],{flightProfile:m}=Kn({event:p});if(m&&i&&!a)return{error:hV};let g=t.scaledEntries??Vy({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:o,sortDescending:s,event:p,stage:h}).scaledEntries,v=g.map(ai),y=Jo(f.filter(({participantId:E})=>!v.includes(E)).filter(E=>(!h||!E.entryStage||E.entryStage===h)&&(!E.entryStatus||lg.includes(E.entryStatus)))),b=g.concat(...y),I=b.length,T=Math.ceil(I/c),S=Qr(b,T);u===Ooe?S=BF(b,c):u===Loe&&(S=BF(b,c,!0));function w(E){return(E||[]).map(({participantId:C,scaleValue:M})=>{let N=f.find(R=>R.participantId===C);return N!=null&&N.scaleValue&&M&&(N.scaleValue=M),N}).sort((C,M)=>C.scaleValue-M.scaleValue).map((C,M)=>(C.scaleValue&&(C.seedNumber=M+1),C))}let U=it(0,c).map(E=>{let C=E+1;return{flightNumber:C,drawId:(d==null?void 0:d.pop())??ji(),drawEntries:w(S[E]),drawName:(l==null?void 0:l.length)&&l[E]||`${e} ${C}`}}),D={scaleAttributes:r,splitMethod:u,flights:U};if(i){let E=DG({flightProfile:D,deleteExisting:a,event:p});return{splitEntries:rl()&&S||void 0,...E}}else return{flightProfile:D,...ae}}var wEe="ASC",Boe="ASC",SEe="DESC",S2="DESC",$oe={ASC:wEe,ASCENDING:Boe,DESC:SEe,DESCENDING:S2};function Voe(t){var C,M,N,R,A;let{tieFormat:e}=t,{useDefaultEventRanking:i,tournamentRecord:n,drawDefinition:r,scaleAccessor:o,singlesOnly:a,attach:s,event:l}=t;if((l==null?void 0:l.eventType)!==al)return{error:Hh};if(!n)return{error:Ge};if(!e&&!r)return{error:ns};if(e=e??((C=Vo({drawDefinition:r,event:l}))==null?void 0:C.tieFormat),$a({tieFormat:e}).error)return{error:Yd};if(typeof o!="object"&&!i)return{error:Pe,context:{scaleAccessor:o}};let c={},u=((r==null?void 0:r.entries)??(l==null?void 0:l.entries)??[]).filter(_=>(_==null?void 0:_.entryStatus)===Ds).map(ai),{participants:d=[]}=zn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:n}),p=d.filter(({participantId:_})=>u.includes(_)),h=_=>_===Gh?"rankings":"ratings",f=((M=l==null?void 0:l.category)==null?void 0:M.categoryName)??((N=l==null?void 0:l.category)==null?void 0:N.ageCategoryCode),{scaleName:m=f,scaleType:g=Gh,sortOrder:v,accessor:y}=o||{},b=h(g),I=(_,k)=>{var F,B,$;let O=(F=_[b])==null?void 0:F[k];if(!O&&i&&(O=(B=_[b])==null?void 0:B[uv]),Array.isArray(O)){let V=($=O.find(H=>H.scaleName===m))==null?void 0:$.scaleValue;if(Bn(V))return V;if(y&&typeof V=="object")return V[y]}return 0},T=(_,k,O)=>{let F=v===S2?k:_,B=v===S2?_:k;return I(F,O)-I(B,O)},S=(_,k)=>T(_,k,uv),w=(_,k)=>T(_,k,Cm),U=[],D=(e==null?void 0:e.collectionDefinitions)??[];for(let _ of p){let k=((R=_.individualParticipants)==null?void 0:R.sort(S))??[],O=a?k:((A=_.individualParticipants)==null?void 0:A.sort(w))??[],F={};for(let $ of D){let V=[],{collectionId:H,matchUpCount:z,matchUpType:G,gender:W}=$,K=jn(uv)(G);it(0,z).forEach(Z=>{let Y=K?k:O??[],X=Z+1,Q=[];it(0,K?1:2).forEach(te=>{var ie;let J=(ie=Y==null?void 0:Y.find(oe=>{var re;let ne=W&&([nn,Un].includes(W)&&W||W===ts&&[nn,Un][te]);return(!ne||ne===((re=oe.person)==null?void 0:re.sex))&&!V.includes(oe.participantId)}))==null?void 0:ie.participantId;J&&(Q.push(J),V.push(J),F[J]||(F[J]=[]),F[J].push({collectionPosition:X,collectionId:H}))}),K||U.push(Q)})}let B=Object.keys(F).map($=>({collectionAssignments:F[$],participantId:$}));c[_.participantId]=B}let E=[];for(let _ of U){let{participant:k}=zl({tournamentParticipants:d,participantIds:_});if(!k){let O={individualParticipantIds:_,participantRole:Mo,participantType:jt};E.push(O)}}if(s){for(;E.length;)Pu({participant:E.pop(),tournamentRecord:n});Ui({element:r,extension:{name:fp,value:c}})}return{...ae,lineUps:c,participantsToAdd:E}}function EG(t){if(!t)return{error:gt};let e=Ei(t,[{dates:!1,[yc]:a=>Array.isArray(a)&&a.every(ws)},{uuids:!1,[yc]:a=>Array.isArray(a)&&a.every(oa)},{startTime:!1,endTime:!1,[yc]:NV},{idPrefix:!1,namePrefix:!1,[yc]:oa},{count:!0,[yc]:Bn}]);if(e.error)return e;let{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&LI(i,n)||[],o=it(1,t.count+1).map(a=>{var s,l;return wt({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${a}`)??ji(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${a}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...ae,courts:o}}var joe={};ii(joe,{default:()=>DEe,garman:()=>zoe});function yP({court:t,date:e}){let i=e&&t.dateAvailability.find(r=>gd(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function P0(t){let e=Ei(t,[{courtDate:!0,_ofType:Gd}]);if(e.error)return e;let{includeBookingTypes:i=[],courtDate:n}=t,r=[],o=pr(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>wM(s.startTime).localeCompare(wM(l.startTime))).forEach(s=>{let l={startTime:hn(o.toISOString()),endTime:s.startTime};pr(s.startTime)>o&&r.push(l),pr(s.endTime)>o&&(o=pr(s.endTime))});let a={startTime:hn(o.toISOString()),endTime:n.endTime};return pr(n.endTime)>o&&r.push(a),{timeSlots:r}}function TEe({averageMatchUpMinutes:t,includeBookingTypes:e,periodStartTime:i,periodEndTime:n}){let r=a=>{var l;let{timeSlots:s}=P0({includeBookingTypes:e,courtDate:a});return!!((l=s==null?void 0:s.filter(o))!=null&&l.length)};function o(a){let s=pr(a.startTime),l=pr(a.endTime);return s>i||l<n?!1:bD(i,l)>=t}return{enoughTime:r}}function Hoe(t){let e=Ei(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:Xa}]);if(e.error)return e;let{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:o}=t,a=t.courts,s=pr(r),l=AV(s,i),{enoughTime:c}=TEe({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((a==null?void 0:a.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;let d=yP({date:o,court:u});return!!(d&&c(d))}))||[]).length,...ae}}function w_(t){var p;let{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:o=[]}=t,{bookings:a=[]}=t;if(!Array.isArray(o)||!o.length)return{error:Pe,courts:o};if(!Array.isArray(a))return{error:gM};if(!ws(r))return{error:aa};i&&(Array.isArray(i)?i.includes(r)&&(a=[]):a=[]);let{courtBookings:s,unassignedBookings:l}=a.reduce((h,f)=>{let{courtId:m}=f;return m?h.courtBookings[m]?h.courtBookings[m].push(f):h.courtBookings[m]=[f]:h.unassignedBookings.push(f),h},{courtBookings:{},unassignedBookings:[]}),c=o.map((h,f)=>{let{courtId:m,courtName:g}=h,v=s[m]||[],y=yP({date:r,court:h})||{},{bookings:b=[],startTime:I,endTime:T,date:S}=y,w=[e[f]&&{startTime:I,endTime:e[f]},...dt(b,!1,!0),...v].filter(Boolean);return{courtId:m,courtName:g,dateAvailability:{bookings:w,startTime:I,endTime:T,date:S}}});l.sort((h,f)=>mi(h.startTime)-mi(f.startTime));let u=()=>c.map(h=>{let f=h.dateAvailability,{timeSlots:m=[]}=P0({courtDate:f});return{courtName:h.courtName,courtId:h.courtId,timeSlots:m}}).flat(),d=[];for(let h of l){let{startTime:f,endTime:m,averageMinutes:g,recoveryMinutes:v,matchUpId:y}=h,b=mi(f),I=mi(m),T=u().reduce((S,{courtId:w,courtName:U,timeSlots:D})=>{let E;return D.find(({startTime:C,endTime:M})=>{E=mi(C)-b;let N=b>=mi(C);return I<=mi(M)&&S.startDifference!==0&&((E===0||E+n>=0)&&(S.startDifference===void 0||E<S.startDifference)||N)})?{courtName:U,courtId:w,startDifference:E}:S},{});if(T.courtId){let S={averageMinutes:g,recoveryMinutes:v,matchUpId:y,startTime:f,endTime:m};d.push(S),(p=c.find(({courtId:w})=>w===T.courtId))==null||p.dateAvailability.bookings.push(S)}else console.log({unassignedBooking:h})}return{virtualCourts:c.map(({courtId:h,courtName:f,dateAvailability:m})=>({dateAvailability:[m],courtName:f,courtId:h})),assignedBookings:d}}function S_({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){let n=(t||90)+(i||0);return e>n?n:e||30}function Goe(t){let{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return it(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function QI({scheduleDate:t,startTime:e,endTime:i,courts:n}){let r=e&&"startTime"||i&&"endTime"||void 0;return n.reduce((o,a)=>{let s=yP({date:t,court:a}),l=r&&((s==null?void 0:s[r])||a[r]);return l&&(!o||e&&mi(l)<mi(o)||i&&mi(l)>mi(o))?l:o},void 0)}function UEe({averageMinutes:t,startTime:e,endTime:i,courts:n,date:r}){e=e||QI({courts:n,scheduleDate:r,startTime:!0}),i=i||QI({courts:n,scheduleDate:r,endTime:!0});let o;if(e&&i){let a=pr(e),s=pr(i);for(let l of n||[]){if(!Array.isArray(l.dateAvailability))continue;let c=yP({court:l,date:r}),{timeSlots:u}=P0({courtDate:c});u==null||u.forEach(d=>{let p=pr(d.startTime),h=pr(d.endTime);if(p>s||p<a||h<a)return!1;if(bD(p,h)>=t){let f=hn(p.toISOString());(!o||f<o)&&(o=f)}})}}return{firstTimeSlotStartTime:o}}function MG(t){let e=Ei(t,[{courts:!0,_ofType:Xa}]);if(e.error)return e;let{date:i=RV(),startTime:n="08:00",endTime:r="19:00",periodLength:o,courts:a}=t,{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;o=o||S_({averageMatchUpMinutes:c}),i=Wt(i),n=hn(n),r=hn(r);let h=0,f=0,m=0,g=0,v=0;!a&&d&&(a=Goe({startTime:n,endTime:r,count:d,date:i}));let{virtualCourts:y}=w_({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:o,bookings:p,courts:a}),{firstTimeSlotStartTime:b}=UEe({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});s&&b&&(n=b||n);let I=mi(n),T=mi(r)-I,S=Math.floor(T/o),w=it(0,S+1).map(U=>{let D=I+U*o,E=$Se(D),C=Hoe({courts:y??[],averageMatchUpMinutes:c,periodStart:E,date:i});if(C.error)return{error:C.error};let{availableToScheduleCount:M=0}=C,N=M>f?M-f:0;v+=U?M:0;let R=U?v/U:M,A=o*R/c,_=U?A*(U-1)+R:R,k=M?f&&_-h||N:0;h=_,f=M,m+=k;let O=Et(m)-g;return g+=O,{periodStart:E,add:O,availableToScheduleCount:M,newCourts:N,totalMatchUps:g}});return{scheduleTimes:w.reduce((U,D)=>{let E=it(0,D.add).map(()=>({scheduleTime:D.periodStart}));return U.concat(...E)},[]).flat(),timingProfile:w,totalMatchUps:g}}var zoe={getCourtsAvailableAtPeriodStart:Hoe,generateTimeSlots:P0,getScheduleTimes:MG,courtGenerator:Goe},DEe=zoe,Tp={};ii(Tp,{isValid:()=>ls,isValidMatchUpFormat:()=>ls,parse:()=>Pa,stringify:()=>BA});var RG={};ii(RG,{allCompetitionMatchUps:()=>xc,allDrawMatchUps:()=>Ia,allEventMatchUps:()=>Hp,allTournamentMatchUps:()=>to,analyzeMatchUp:()=>eU,applyLineUps:()=>hae,assignMatchUpSideParticipant:()=>qoe,assignTieMatchUpParticipantId:()=>WM,bulkMatchUpStatusUpdate:()=>cae,calculateWinCriteria:()=>Hy,checkInParticipant:()=>AG,checkMatchUpIsComplete:()=>mm,checkOutParticipant:()=>NG,competitionScheduleMatchUps:()=>mP,disableTieAutoCalc:()=>aae,drawMatchUps:()=>dG,enableTieAutoCalc:()=>nae,eventMatchUps:()=>p_,findMatchUp:()=>KH,getAllDrawMatchUps:()=>Tr,getAllStructureMatchUps:()=>_i,getCheckedInParticipantIds:()=>Ry,getCompetitionMatchUps:()=>QT,getEventMatchUpFormatTiming:()=>iG,getMatchUpCompetitiveProfile:()=>OD,getMatchUpContextIds:()=>sG,getMatchUpDailyLimits:()=>f_,getMatchUpDailyLimitsUpdate:()=>nG,getMatchUpDependencies:()=>nc,getMatchUpFormat:()=>lG,getMatchUpFormatTiming:()=>FD,getMatchUpFormatTimingUpdate:()=>tG,getMatchUpScheduleDetails:()=>PA,getMatchUpType:()=>CA,getMatchUpsStats:()=>cG,getModifiedMatchUpFormatTiming:()=>d_,getParticipantResults:()=>nP,getPredictiveAccuracy:()=>aG,getRoundMatchUps:()=>la,getRounds:()=>uG,isValidMatchUpFormat:()=>ls,matchUpActions:()=>WA,mutate:()=>Woe,participantScheduledMatchUps:()=>rG,query:()=>soe,removeDelegatedOutcome:()=>rae,removeMatchUpSideParticipant:()=>xG,removeTieMatchUpParticipantId:()=>Koe,replaceTieMatchUpParticipantId:()=>kG,resetAdHocMatchUps:()=>dae,resetMatchUpLineUps:()=>VG,resetScorecard:()=>HG,resetTieFormat:()=>jG,setDelegatedOutcome:()=>uae,setMatchUpFormat:()=>sae,setMatchUpStatus:()=>IP,setOrderOfFinish:()=>pae,substituteParticipant:()=>oae,tallyParticipantResults:()=>S0,toggleParticipantCheckInState:()=>T_,tournamentMatchUps:()=>h_,updateTieMatchUpScore:()=>Gp,validMatchUp:()=>SA,validMatchUps:()=>hl});var Woe={};ii(Woe,{applyLineUps:()=>hae,assignMatchUpSideParticipant:()=>qoe,assignTieMatchUpParticipantId:()=>WM,bulkMatchUpStatusUpdate:()=>cae,checkInParticipant:()=>AG,checkOutParticipant:()=>NG,disableTieAutoCalc:()=>aae,enableTieAutoCalc:()=>nae,findMatchUp:()=>KH,removeDelegatedOutcome:()=>rae,removeMatchUpSideParticipant:()=>xG,removeTieMatchUpParticipantId:()=>Koe,replaceTieMatchUpParticipantId:()=>kG,resetAdHocMatchUps:()=>dae,resetMatchUpLineUps:()=>VG,resetScorecard:()=>HG,resetTieFormat:()=>jG,setDelegatedOutcome:()=>uae,setMatchUpFormat:()=>sae,setMatchUpStatus:()=>IP,setOrderOfFinish:()=>pae,substituteParticipant:()=>oae,toggleParticipantCheckInState:()=>T_,updateTieMatchUpScore:()=>Gp});function qoe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:o}){var c,u;if(i&&typeof i!="string")return{error:bu};if(!e)return{error:lt};if(!r)return{error:To};let a=n===void 0;if(a&&(n=1),![1,2].includes(n))return se({result:{error:Pe,context:{sideNumber:n}}});let{matchUp:s,structure:l}=fn({drawDefinition:e,matchUpId:r,event:o});if(!s)return{error:Ao};if(!(!(l!=null&&l.structures)&&!(e.drawType&&e.drawType!==jl)&&!((c=l==null?void 0:l.matchUps)!=null&&c.find(({roundPosition:d})=>!!d))))return{error:G$};if(!i&&((u=s==null?void 0:s.score)!=null&&u.scoreStringSide1||Nr.includes(s==null?void 0:s.matchUpstatus)||s!=null&&s.matchUpStatus&&[mr,Er].includes(s.matchUpStatus)))return{error:KN,info:"matchUp has completed status or score"};if(s){if(s.sides=[1,2].map(d=>{var h;let p=((h=s.sides)==null?void 0:h.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...p,participantId:i}:p}),a)for(let d of s.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);yi({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s})}return{...ae,sidesSwapped:a}}function Ps({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:a,event:s}){let{matchUp:l}=fn({drawDefinition:n,event:s,matchUpId:o});if(!l)return{error:Ao};let c=Cf({removePriorValues:t,element:l,duplicateValues:i,timeItem:a});return r||yi({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function NG(t){var y;let e=[{[xd]:!0},{[qc]:!0},{[hd]:!0},{[ng]:!0}],i=Ei(t,e);if(i.error)return i;let n=gP(t,[{[yD]:wf,attr:{[CV]:!0}}]);if(n.error)return n;let{tournamentRecord:r,drawDefinition:o,participantId:a,matchUpId:s}=t,l=(y=n==null?void 0:n.matchUp)==null?void 0:y.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&pA.includes(c)||c&&Nr.includes(c)||io({score:u}))return{error:_J};let d=Ry({matchUp:l});if(d!=null&&d.error)return d;let{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!(h!=null&&h.includes(a)))return{error:bu};if(!(p!=null&&p.includes(a)))return{error:oQ};let f=Hee({matchUp:l});if(f!=null&&f.error)return f;let{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m==null?void 0:m.indexOf(a);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(b=>{Ps({drawDefinition:o,matchUpId:s,timeItem:{itemType:MM,itemValue:b}})}),Ps({tournamentRecord:r,drawDefinition:o,matchUpId:s,timeItem:{itemValue:a,itemType:MM}}),{...ae,checkedOut:!0}}function AG(t){var p;let e=[{[xd]:!0},{[qc]:!0},{[hd]:!0},{[ng]:!0}],i=Ei(t,e);if(i[cv])return i;let n=gP(t,[{[yD]:wf,attr:{[CV]:!0}}]);if(n[cv])return n;let{tournamentRecord:r,drawDefinition:o,participantId:a,matchUpId:s}=t,l=Ry({matchUp:(p=n==null?void 0:n.matchUp)==null?void 0:p.matchUp});if(l!=null&&l.error)return l;let{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};if(!(u!=null&&u.includes(a)))return{[cv]:bu};let d={...ae,checkedIn:!0};return c!=null&&c.includes(a)||Ps({tournamentRecord:r,drawDefinition:o,matchUpId:s,timeItem:{itemValue:a,itemType:EM}}),d}function T_(t){var c,u;let e=Ei(t,[{[hd]:!0,[qc]:!0,[ng]:!0}]);if(e.error)return e;let i=t.tournamentId??t.activeTournamentId,n=t.tournamentRecord??(i&&((c=t.tournamentRecords)==null?void 0:c[i]));if(!n)return{error:Ge};let r=(u=gP(t,[{[yD]:wf,attr:{[CV]:!0},[cv]:Ao}]).matchUp)==null?void 0:u.matchUp;if(!r)return{error:Ao};let{checkedInParticipantIds:o=[]}=Ry({matchUp:r}),{participantId:a,matchUpId:s,drawDefinition:l}=t;return a&&o.includes(a)?NG({tournamentRecord:n,drawDefinition:l,participantId:a,matchUpId:s,matchUp:r}):AG({tournamentRecord:n,drawDefinition:l,participantId:a,matchUpId:s,matchUp:r})}function _G({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var S,w;if(!t)return{error:Ge};if(!e)return{error:Wc};if(!n)return{error:rs};let r=Uo({drawDefinition:e}),{matchUp:o}=fn({matchUpId:i,drawDefinition:e,matchUpsMap:r});if(!o)return{error:Ao};let{matchUp:a,structure:s}=fn({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:r,event:n});if(!a)return{error:Ao};let{collectionPosition:l,drawPositions:c,collectionId:u,matchUpTieId:d,matchUpType:p}=a;if(p&&!EA([kn,an],p))return{error:Sa};let{positionAssignments:h}=Yi({structure:s}),f=h==null?void 0:h.filter(U=>c==null?void 0:c.includes(U.drawPosition)),{matchUp:m}=fn({matchUpId:d,drawDefinition:e,matchUpsMap:r}),g=((S=m==null?void 0:m.sides)==null?void 0:S.map(ai))??[],v=(f==null?void 0:f.map(ai))??[],y=[...g,...v],{participants:b}=zn({tournamentRecord:t,participantFilters:{participantTypes:[en],participantIds:y}}),{matchUp:I}=fn({matchUpId:d,inContext:!0,drawDefinition:e,matchUpsMap:r}),T=(w=Vo({matchUp:m,drawDefinition:e,structure:s,event:n}))==null?void 0:w.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:a,relevantAssignments:f,collectionPosition:l,teamParticipants:b,collectionId:u,matchUpType:p,dualMatchUp:m,tieMatchUp:o,tieFormat:T,structure:s,...ae}}function kG(t){var O,F,B,$,V,H,z,G,W,K,Z,Y,X,Q,te,J;let e=_G(t);if(e.error)return e;let i="replaceTieMatchUpParticipantid",{existingParticipantId:n,tournamentRecord:r,newParticipantId:o,drawDefinition:a,substitution:s,event:l}=t;if(!n||!o)return se({result:{error:Rr},stack:i});if(n===o)return{...ae};let{inContextDualMatchUp:c,inContextTieMatchUp:u,collectionPosition:d,collectionId:p,dualMatchUp:h,tieMatchUp:f,tieFormat:m}=e,g=u==null?void 0:u.matchUpType,v=(O=u==null?void 0:u.sides)==null?void 0:O.find(ie=>{var oe,ne,re;return((oe=ie.participant)==null?void 0:oe.participantId)===n||((re=(ne=ie.participant)==null?void 0:ne.individualParticipantIds)==null?void 0:re.includes(n))});if(!v)return{error:Jn};let y=((F=zn({tournamentRecord:r,participantFilters:{participantIds:[n,o]}}))==null?void 0:F.participants)??[];if(y.length!==2)return se({result:{error:Rr},stack:i});if(y[0].participantType!==y[1].participantType)return se({result:{error:_c},stack:i});let{appliedPolicies:b}=Bi({tournamentRecord:r,drawDefinition:a,event:l}),I=((B=t.policyDefinitions)==null?void 0:B[Zr])??(b==null?void 0:b[Zr])??b0[Zr],T=y.find(({participantId:ie})=>ie===o);if((t.enforceGender??(($=I==null?void 0:I.participants)==null?void 0:$.enforceGender))!==!1&&[nn,Un].includes(u==null?void 0:u.gender)&&(u==null?void 0:u.gender)!==((V=T==null?void 0:T.person)==null?void 0:V.sex))return{error:Jw,info:"Gender mismatch"};let S=(H=I==null?void 0:I.processCodes)==null?void 0:H.substitution;sP({tournamentId:r.tournamentId,eventId:l.eventId,inContextDualMatchUp:c,drawDefinition:a,dualMatchUp:h});let w=(z=h==null?void 0:h.sides)==null?void 0:z.find(({sideNumber:ie})=>ie===v.sideNumber);if(!w)return se({result:{sideNumber:v.sideNumber,existingParticipantId:n,error:_o},stack:i});if((W=(G=u==null?void 0:u.sides)==null?void 0:G.flatMap(ie=>{var oe,ne;return((oe=ie.participant)==null?void 0:oe.individualParticipantIds)||((ne=ie.participant)==null?void 0:ne.participantId)||[]}))!=null&&W.includes(o))return se({result:{error:ZN},stack:i});let U=(Z=(K=c==null?void 0:c.sides)==null?void 0:K.find(({sideNumber:ie})=>ie===v.sideNumber))==null?void 0:Z.participantId,D=w.lineUp,E=D==null?void 0:D.find(({participantId:ie})=>o===ie),C=D==null?void 0:D.reduce((ie,oe)=>oe.substitutionOrder>ie?oe.substitutionOrder:ie,0),M=(D==null?void 0:D.map(ie=>{var ne;let oe=dt(ie,!1,!0);if(![n,o].includes(oe.participantId))return oe;if(!s&&[n,o].includes(oe.participantId)&&(oe.collectionAssignments=(ne=oe.collectionAssignments)==null?void 0:ne.filter(re=>!(re.collectionPosition===d&&re.collectionId===p))),s&&n===oe.participantId&&(oe.collectionAssignments=oe.collectionAssignments.map(re=>re.collectionPosition===d&&re.collectionId===p&&re.substitutionOrder===void 0?{...re,substitutionOrder:C}:re)),oe.participantId===o){oe.collectionAssignments||(oe.collectionAssignments=[]);let re={collectionId:p,collectionPosition:d};s&&(re.previousParticipantId=n,re.substitutionOrder=(C??0)+1),oe.collectionAssignments.push(re)}return oe}))??[];if(!E){let ie={collectionId:p,collectionPosition:d};s&&(ie.substitutionOrder=(C??0)+1,ie.previousParticipantId=n);let oe={collectionAssignments:[ie],participantId:o};M.push(oe)}let N=g===an,{assignedParticipantIds:R}=RM({lineUp:D,collectionPosition:d,collectionId:p}),{assignedParticipantIds:A}=RM({lineUp:M,collectionPosition:d,collectionId:p});if(w.lineUp=M,U&&m){let ie=Ly({participantId:U,lineUp:M,drawDefinition:a,tieFormat:m});if(ie.error)return se({result:ie,stack:i})}else console.log("team participantId not found");let _,k;if(N){let{tournamentRecord:ie}=t,oe=zl({participantIds:A,tournamentRecord:ie});if(!oe.participant){let re=Pu({returnParticipant:!0,pairOverride:!0,tournamentRecord:ie,participant:{participantRole:Mo,individualParticipantIds:A,participantType:jt}});if(re.error)return se({result:re,stack:i});_=(Y=re.participant)==null?void 0:Y.participantId}oe=zl({participantIds:R,tournamentRecord:ie});let ne=(X=oe.participant)==null?void 0:X.participantId;ne&&xy({participantIds:[ne],tournamentRecord:ie}).success&&(k=ne)}if(s||((Q=v.substitutions)==null?void 0:Q.length)===1){if(s)S&&f&&(f.processCodes=Zt([...(f==null?void 0:f.processCodes)??[],...S]));else for(let ie of S||[]){let oe=(te=f==null?void 0:f.processCodes)==null?void 0:te.lastIndexOf(ie);oe!==void 0&&((J=f==null?void 0:f.processCodes)==null||J.splice(oe,1))}f&&yi({tournamentId:r==null?void 0:r.tournamentId,matchUp:f,context:i,drawDefinition:a})}return h&&yi({tournamentId:r==null?void 0:r.tournamentId,matchUp:h,context:i,drawDefinition:a}),{...ae,modifiedLineUp:M,participantRemoved:k,participantAdded:_}}function Yoe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:o}){var c;if(!o||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Pe};let a=(i==null?void 0:i.lineUp)||((c=Nm({participantId:e,drawDefinition:n}))==null?void 0:c.lineUp),s=[],l=[];return{modifiedLineUp:(a==null?void 0:a.map(u=>{var p;if(!r.includes(u.participantId))return u;let d=(p=u.collectionAssignments)==null?void 0:p.filter(h=>{let f=h.collectionId===o&&h.collectionPosition===t;return f&&(h.previousParticipantId&&s.push(h.previousParticipantId),l.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:d}}).filter(Boolean))||[],assignmentsRemoved:l,previousParticipantIds:s}}function PEe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){var o,a;let n=(i.events||[]).filter(s=>{var l;return(s==null?void 0:s.eventType)===Or&&((l=s==null?void 0:s.entries)==null?void 0:l.some(c=>c.participantId===e))}),r=s=>!t.includes(s.participantId);for(let s of n){s.entries=(s.entries||[]).filter(r);let{flightProfile:l}=Kn({event:s});(o=l==null?void 0:l.flights)==null||o.forEach(c=>{c.drawEntries=(c.drawEntries||[]).filter(r)}),(a=s==null?void 0:s.drawDefinitions)==null||a.forEach(c=>{c.entries=(c.entries||[]).filter(r)})}return{...ae}}function U_({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){let r="addIndividualParticipantIds";if(!n)return se({result:{error:Ge},stack:r});if(!e||!t)return se({result:{error:gt},stack:r});let o=n.participants??[],a=o.find(d=>d.participantId===e);if(!a)return se({result:{error:Jn},stack:r});if(a!=null&&a.participantType&&![en,ks].includes(a.participantType))return se({context:{participantType:a.participantType},result:{error:_c},stack:r});let s=t.filter(d=>{var p;return((p=o.find(h=>h.participantId===d))==null?void 0:p.participantType)!==si});if(s.length)return se({result:{error:xl,invalidParticipantIds:s},stack:r});a.individualParticipantIds||(a.individualParticipantIds=[]);let l=a.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&NA({individualParticipantIds:c,tournamentRecord:n}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));let{topics:u}=pl();if(u.includes(wo)){let d=o.find(({participantId:p})=>p===e);di({topic:wo,payload:{participants:[d]}})}return PEe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:dt(a,!1,!0),added:c.length,...ae}}function D_(t){let{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:o,participant:a}=t;if(!r)return{error:Ge};if(!a)return{error:Sy};if(!a.participantId)return Pu({tournamentRecord:r,participant:a});let{participant:s}=hg({participantId:a.participantId,tournamentRecord:r});if(!s)return Pu({tournamentRecord:r,participant:a});let{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=a;if(h&&s.participantType!==h)return{error:QJ};let v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),d&&typeof d=="string"&&(v.participantName=d),u&&typeof u=="string"&&(v.participantOtherName=u),Array.isArray(c)){let{participants:y}=zn({participantFilters:{participantTypes:[si]},tournamentRecord:r}),b=y==null?void 0:y.map(ai);if(b){let I=c.filter(T=>typeof T=="string"&&b.includes(T));([ks,sn].includes(h||s.participantType)||h===jt&&(I.length===2||o))&&(v.individualParticipantIds=I),s.participantType===mI.PAIR&&e&&(v.participantName=CEe({individualParticipants:y,newValues:v}))}}return Object.keys(Pf).includes(p)&&(v.participantRole=p),Object.keys(mI).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===mI.INDIVIDUAL&&g&&EEe({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,wt(v)),i&&U_({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),di({topic:wo,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:dt(s),...ae}}function CEe({individualParticipants:t,newValues:e}){let i=e.individualParticipantIds,n=t.filter(({participantId:r})=>i.includes(r)).map(({person:r})=>r==null?void 0:r.standardFamilyName).filter(Boolean).sort().join("/");return i.length===1&&(n+="/Unknown"),n}function EEe({updateParticipantName:t,existingParticipant:e,newValues:i,person:n}){let r={},{standardFamilyName:o,standardGivenName:a,nationalityCode:s,personId:l,sex:c}=n;c&&Object.keys(Lu).includes(c)&&(r.sex=c);let u;if(l&&typeof l=="string"&&(r.personId=l),s&&typeof s=="string"&&(MEe(s)||s==="")&&(r.nationalityCode=s),o&&typeof o=="string"&&o.length>1&&(r.standardFamilyName=o,u=!0),a&&typeof a=="string"&&a.length>1&&(r.standardGivenName=a,u=!0),u&&t){let d=`${r.standardGivenName} ${r.standardFamilyName}`;i.participantName=d}Object.assign(e.person,r)}function MEe(t){return _h.flatMap(({iso:e,ioc:i})=>[e,i]).filter(Boolean).includes(t)}function WM(t){var B,$,V,H,z,G,W,K,Z,Y,X,Q,te,J,ie,oe,ne,re,me,he;let e=_G(t);if(e.error)return e;let i="assignTieMatchUpParticipantId",n=t.teamParticipantId,{tournamentRecord:r,drawDefinition:o,participantId:a,event:s}=t;if(!a)return se({result:{error:Rr},stack:i});if(t.sideNumber&&![1,2].includes(t.sideNumber))return se({result:{error:tV},stack:i});let{inContextDualMatchUp:l,inContextTieMatchUp:c,relevantAssignments:u,collectionPosition:d,teamParticipants:p,collectionId:h,matchUpType:f,dualMatchUp:m,tieFormat:g}=e;if(($=(B=c==null?void 0:c.sides)==null?void 0:B.flatMap(be=>{var Se,De;return((Se=be.participant)==null?void 0:Se.individualParticipantIds)||((De=be.participant)==null?void 0:De.participantId)||[]}))!=null&&$.includes(a))return se({result:{...ae},stack:i});n=n??(t.sideNumber?(H=(V=l==null?void 0:l.sides)==null?void 0:V.find(be=>be.sideNumber===t.sideNumber))==null?void 0:H.participantId:void 0);let v=(G=(z=zn({participantFilters:{participantIds:[a]},tournamentRecord:r}))==null?void 0:z.participants)==null?void 0:G[0];if(!v)return se({result:{error:Jn},stack:i});let{appliedPolicies:y}=Bi({tournamentRecord:r,drawDefinition:o,event:s}),b=((W=t.policyDefinitions)==null?void 0:W[Zr])??(y==null?void 0:y[Zr])??b0[Zr];if((t.enforceGender??((K=b==null?void 0:b.participants)==null?void 0:K.enforceGender))!==!1&&[nn,Un].includes(c==null?void 0:c.gender)&&(c==null?void 0:c.gender)!==((Z=v.person)==null?void 0:Z.sex))return{error:Jw,info:"Gender mismatch"};let{individualParticipantIds:I,participantType:T}=v;if(jn(kn)(f)&&T!==si)return{error:_c};let S=T===si?[a]:I,w=n&&(p==null?void 0:p.find(({participantId:be})=>be===n))||(p==null?void 0:p.find(({individualParticipantIds:be})=>sa(S,be)));if(!w)return{error:dV};if(n||(n=w.participantId),!n)return{error:Jn};let U=(Y=u==null?void 0:u.find(be=>be.participantId===(w==null?void 0:w.participantId)))==null?void 0:Y.drawPosition,D=(Q=(X=m==null?void 0:m.sides)==null?void 0:X.find(be=>be.participantId===n))==null?void 0:Q.sideNumber,E=(J=(te=c==null?void 0:c.sides)==null?void 0:te.find(be=>U&&be.drawPosition===U))==null?void 0:J.sideNumber,C=D??E??t.sideNumber;if(!g)return{error:pD};if(!((ie=g.collectionDefinitions)!=null&&ie.find(be=>be.collectionId===h)))return{error:zJ};sP({tournamentId:r.tournamentId,eventId:s.eventId,inContextDualMatchUp:l,drawDefinition:o,dualMatchUp:m});let M=(oe=m==null?void 0:m.sides)==null?void 0:oe.find(be=>be.sideNumber===C),N=(ne=c==null?void 0:c.sides)==null?void 0:ne.find(be=>be.sideNumber===C),R=(he=(me=(M==null?void 0:M.lineUp)??((re=Nm({participantId:n,drawDefinition:o}))==null?void 0:re.lineUp))==null?void 0:me.filter(be=>{var Se;return(Se=be.collectionAssignments)==null?void 0:Se.find(De=>De.collectionPosition===d&&De.collectionId===h&&!De.previousParticipantId)}))==null?void 0:he.map(be=>be==null?void 0:be.participantId),A=(R==null?void 0:R.length)>1&&R||(T===jt?v.individualParticipantIds:[a]),_=Yoe({collectionPosition:d,teamParticipantId:n,dualMatchUpSide:M,drawDefinition:o,participantIds:A,collectionId:h});if(_.error)return se({result:_,stack:i});let{modifiedLineUp:k}=_,O;if(f===an){if(T!==jt){let be=OO({collectionPosition:d,teamParticipantId:n,drawDefinition:o,modifiedLineUp:k,participantId:a,collectionId:h,tieFormat:g});if(be!=null&&be.error)return se({result:be,stack:i});if(be=F({side:N}),be.error)return be;O=be.deletedParticipantId,M&&(M.lineUp=k),m&&yi({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:o})}else if(T===jt)for(let be of A)OO({collectionPosition:d,teamParticipantId:n,drawDefinition:o,modifiedLineUp:k,participantId:be,collectionId:h,tieFormat:g})}else{let be=OO({collectionPosition:d,teamParticipantId:n,drawDefinition:o,modifiedLineUp:k,participantId:a,collectionId:h,tieFormat:g});if(be!=null&&be.error)return be}if(M&&(M.lineUp=k),m&&yi({tournamentId:r==null?void 0:r.tournamentId,matchUp:m,context:i,drawDefinition:o}),O){let{error:be}=xy({participantIds:[O],tournamentRecord:r});be&&console.log("cleanup")}return{...ae,modifiedLineUp:k};function F({side:be}){let Se;if(be.participant){let De=be.participant.individualParticipantIds||[];if(De.filter(Boolean).length===1){let{participant:Oe}=zl({participantIds:De,tournamentRecord:r});De.push(a);let{participant:xe}=zl({participantIds:De,tournamentRecord:r});if(!xe&&Oe){Oe.individualParticipantIds=De;let $e=D_({pairOverride:!0,tournamentRecord:r,participant:Oe});if($e.error)return $e}else Se=Oe==null?void 0:Oe.participantId}}else{let De=Pu({participant:{individualParticipantIds:[a],participantRole:Mo,participantType:jt},pairOverride:!0,tournamentRecord:r});if(De.error)return De}return{...ae,deletedParticipantId:Se}}}function OO({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:o,tieFormat:a}){var u,d;let s=(u=Nm({participantId:e,drawDefinition:i}))==null?void 0:u.lineUp,l=(d=n||s)==null?void 0:d.find(p=>(p==null?void 0:p.participantId)===r),c={collectionId:o,collectionPosition:t};if(l)l.collectionAssignments.push(c);else{let p={collectionAssignments:[c],participantId:r};n.push(p)}return Ly({participantId:e,lineUp:n,drawDefinition:i,tieFormat:a})}function Koe(t){var E,C,M,N,R,A,_,k,O,F,B,$,V,H,z,G,W,K,Z,Y,X,Q;let{tournamentRecord:e,drawDefinition:i,participantId:n,event:r}=t,o="removeTieMatchUpParticiapantId";if(!n)return se({result:{error:Rr},stack:o});let a=_G(t);if(a.error)return a;let{appliedPolicies:s}=Bi({tournamentRecord:e,drawDefinition:i,event:r}),l=(M=(C=((E=t.policyDefinitions)==null?void 0:E[Zr])??(s==null?void 0:s[Zr])??b0[Zr])==null?void 0:C.processCodes)==null?void 0:M.substitution,{inContextDualMatchUp:c,inContextTieMatchUp:u,relevantAssignments:d,collectionPosition:p,teamParticipants:h,collectionId:f,matchUpType:m,dualMatchUp:g,tieMatchUp:v,tieFormat:y}=a;if(!g)return se({result:{error:Ba},stack:o});let b=(N=u==null?void 0:u.sides)==null?void 0:N.find(te=>{var J,ie,oe;return((J=te.participant)==null?void 0:J.participantId)===n||((oe=(ie=te.participant)==null?void 0:ie.individualParticipantIds)==null?void 0:oe.includes(n))});if(!b)return se({result:{error:Jn},stack:o});if(!((R=b.substitutions)!=null&&R.length)&&(io({score:u==null?void 0:u.score})||u!=null&&u.winningSide))return se({result:{error:CQ},stack:o});let I=(_=(A=c==null?void 0:c.sides)==null?void 0:A.find(({sideNumber:te})=>te===b.sideNumber))==null?void 0:_.participantId;if(!I)return se({result:{error:Jn},stack:o});let T=(O=(k=zn({participantFilters:{participantIds:[n]},tournamentRecord:e}))==null?void 0:k.participants)==null?void 0:O[0];if(!T)return se({result:{error:Jn},stack:o});if(m===kn&&T.participantType===jt)return se({result:{error:Jw},stack:o});let S=T.participantType===si?[n]:T.individualParticipantIds;sP({tournamentId:e.tournamentId,eventId:r.eventId,inContextDualMatchUp:c,drawDefinition:i,dualMatchUp:g});let w=(F=g.sides)==null?void 0:F.find(({sideNumber:te})=>te===b.sideNumber);if(!w&&(((B=g.sides)==null?void 0:B.filter(({lineUp:te})=>!te).length)||0)<2){let te=h==null?void 0:h.map(({participantId:J})=>{var ie;return{drawPosition:(ie=d==null?void 0:d.find(oe=>oe.participantId===J))==null?void 0:ie.drawPosition,teamParticipantId:J}});w=($=g.sides)==null?void 0:$.find(J=>{var ie;return((ie=te==null?void 0:te.find(({drawPosition:oe})=>oe===J.drawPosition))==null?void 0:ie.teamParticipantId)===I})}if(!w)return se({result:{error:Jn,context:{participantId:n}}});let{modifiedLineUp:U,previousParticipantIds:D}=Yoe({collectionPosition:p,teamParticipantId:I,dualMatchUpSide:w,participantIds:S,drawDefinition:i,collectionId:f});if(w.lineUp=U,I&&y&&Ly({participantId:I,lineUp:U,drawDefinition:i,tieFormat:y}),m===an&&T.participantType===si){let te=(V=u==null?void 0:u.sides)==null?void 0:V.find(oe=>oe.sideNumber===(w==null?void 0:w.sideNumber)),{participantId:J}=te??{},ie=J&&((z=(H=zn({participantFilters:{participantIds:[J]},tournamentRecord:e,withDraws:!0}))==null?void 0:H.participants)==null?void 0:z[0]);if(ie){let oe=((G=ie==null?void 0:ie.individualParticipantIds)==null?void 0:G.filter(ne=>ne!==n))??[];if(D&&oe.push(...D),oe.length>2)return se({result:{error:xl},stack:o});if((W=ie.draws)!=null&&W.length){if(oe.length===1){let{participant:ne}=zl({participantIds:oe,tournamentRecord:e});if(!ne){let re=Pu({participant:{participantRole:Mo,individualParticipantIds:oe,participantType:jt},pairOverride:!0,tournamentRecord:e});if(re.error)return se({result:re,stack:o})}}}else if(oe.length){ie.individualParticipantIds=oe;let ne=D_({participant:ie,pairOverride:!0,tournamentRecord:e});if(ne.error)return se({result:ne,stack:o})}else{let ne=xy({participantIds:[J],tournamentRecord:e});ne.error&&console.log("cleanup",{result:ne})}}else return se({result:{error:Jn},stack:o})}if(((K=b.substitutions)==null?void 0:K.length)===1&&!((X=(Y=(Z=u==null?void 0:u.sides)==null?void 0:Z.find(te=>te.sideNumber!==b.sideNumber))==null?void 0:Y.substitutions)!=null&&X.length)&&((Q=v==null?void 0:v.processCodes)!=null&&Q.length)){for(let te of l||[]){let J=v.processCodes.lastIndexOf(te);v.processCodes.splice(J,1)}yi({tournamentId:e==null?void 0:e.tournamentId,matchUp:v,context:o,drawDefinition:i})}return yi({tournamentId:e==null?void 0:e.tournamentId,matchUp:g,context:o,drawDefinition:i}),{...ae,modifiedLineUp:U}}function xG(t){var l,c;let e=Ei(t,[{[xd]:!0,[qc]:!0,[ng]:!0}]);if(e.error)return e;let{drawDefinition:i,sideNumber:n,matchUpId:r,event:o}=t;if(n&&![1,2].includes(n))return{error:Pe,sideNumber:n};let{matchUp:a,structure:s}=fn({drawDefinition:i,matchUpId:r,event:o});return a?ss({structure:s})?((l=a.sides)==null||l.forEach(u=>{(!n||u.sideNumber===n)&&delete u.participantId}),yi({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,context:"assignSideParticipant",drawDefinition:i,matchUp:a}),{...ae}):{error:G$}:{error:Ao}}function REe({drawDefinition:t,matchUpStatus:e,matchUpsMap:i,winningSide:n,dualMatchUp:r,tieFormat:o,structure:a,matchUp:s,event:l,score:c}){var p;let u=dt(r,void 0,!0);for(let h of(u==null?void 0:u.tieMatchUps)||[])h.matchUpId===s.matchUpId&&(h.winningSide=n,h.score=c,!io({score:c})&&!e?Object.assign(h,{...LA}):e&&(h.matchUpStatus=e));o=o??((p=Vo({matchUp:s,structure:a,drawDefinition:t,event:l}))==null?void 0:p.tieFormat);let{winningSide:d}=aP({matchUp:u,drawDefinition:t,matchUpsMap:i,structure:a,tieFormat:o,event:l});return{projectedWinningSide:d}}function NEe({matchUpStatuses:t=[Ni,Oi,Pi],drawPositionMatchUps:e,loserDrawPosition:i,sourceMatchUps:n}){var u;let r=e==null?void 0:e.reduce((d,p)=>!d||p.roundNumber>d.roundNumber?p:d,void 0),o=(u=r==null?void 0:r.drawPositions)==null?void 0:u.find(d=>d!==i),a=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(o)}).map(d=>d.matchUpStatus),s=n.filter(d=>{var p;return(p=d==null?void 0:d.drawPositions)==null?void 0:p.includes(i)}).map(d=>d.matchUpStatus),l=sa(a||[],t),c=sa(s||[],t);return{sourceMatchUp:r,winnerHadMatchUpStatus:l,winnerMatchUpStatuses:a,loserHadMatchUpStatus:c,loserMatchUpStatuses:s}}function AEe({inContextDrawMatchUps:t,sourceMatchUpStatus:e,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:o,structureId:a,dualMatchUp:s,roundNumber:l,matchUpsMap:c,event:u}){let{structure:d}=At({drawDefinition:o,structureId:a});if((d==null?void 0:d.structureType)===fa)return{...ae};c=c??Uo({drawDefinition:o});let p=((c==null?void 0:c.mappedMatchUps)||{})[a].matchUps,{initialRoundNumber:h}=$v({drawPosition:i,matchUps:p}),f=p==null?void 0:p.filter(g=>{var v;return g.roundNumber>=l&&g.roundNumber!==h&&((v=g.drawPositions)==null?void 0:v.includes(i))}),{positionAssignments:m}=Yi({drawDefinition:o,structureId:a});for(let g of f??[])_Ee({inContextDrawMatchUps:t,sourceMatchUpStatus:e,positionAssignments:m,targetDrawPosition:i,tournamentRecord:n,sourceMatchUpId:r,drawDefinition:o,dualMatchUp:s,matchUpsMap:c,matchUp:g,event:u});return{...ae}}function _Ee({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:a,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var h,f,m;let d="removeSubsequentDrawPosition";if(s){let g=(f=(h=t.find(({matchUpId:y})=>c.matchUpId===y).sides)==null?void 0:h.find(y=>y.drawPosition===n))==null?void 0:f.sideNumber,v=(m=c.sides)==null?void 0:m.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(g=>g===n?void 0:g).filter(Boolean);let p=e.filter(({drawPosition:g})=>{var v;return(v=c.drawPositions)==null?void 0:v.includes(g)}).filter(g=>g.bye).length;return c.matchUpStatus=p&&Ni||[Pi,Oi].includes(c.matchUpStatus)&&c.matchUpStatus||Gn,[Oi,Pi].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&jte({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:o,matchUpsMap:l,matchUp:c}),yi({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`${d}-${n}`,drawDefinition:a,matchUp:c}),{...ae}}function C0(t){let{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:o,matchUpsMap:a,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=ss({structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:cD};let{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,S=pu({...t,matchUpStatus:o||Gn,removeWinningSide:!0});if(S.error)return S;let w;if(p){let{matchUpTieId:k,matchUpsMap:O}=t;if(w=Gp({appliedPolicies:t.appliedPolicies,matchUpId:k,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!w.removeWinningSide)return{...ae}}if(h)return{...ae};let{matchUps:U}=_i({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:a,structure:u}),{positionAssignments:D}=jr({structure:u}),E=m-1,C=1-E,M=f[E],N=f[C],{winnerParticipantId:R,loserParticipantId:A}=(D==null?void 0:D.reduce((k,O)=>(O.drawPosition===N&&(k.loserParticipantId=O.participantId),O.drawPosition===M&&(k.winnerParticipantId=O.participantId),k),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=U.filter(k=>{var O;return(O=k.drawPositions)==null?void 0:O.includes(N)});if(I&&Zoe({sourceMatchUpStatus:o,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:M,winnerParticipantId:R,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:s,matchUpsMap:a}),b){let{winnerHadMatchUpStatus:k}=NEe({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:U}),O=g.linkCondition===bd;if(k&&O){let B=Math.min(...b.drawPositions);T2({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:B,matchUpsMap:a,event:d})}let F=kEe({sourceMatchUpStatus:o,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:s,matchUpsMap:a,event:d});if(F.error)return F}if(T){let k=Math.min(...T.drawPositions);T2({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:k,matchUpsMap:a,event:d})}return{...ae,...w&&{tieMatchUpResult:w}}}function Zoe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:o,sourceMatchUpId:a,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var m,g;let{structureId:p,roundNumber:h}=l,f="removeDirectedWinner";if(o){let v=o.target.structureId,{structure:y}=At({drawDefinition:s,structureId:v});if(!y)return{error:Nn};let{positionAssignments:b}=jr({structure:y});y.seedAssignments=(y.seedAssignments??[]).filter(D=>D.participantId!==n);let I=(m=b==null?void 0:b.find(D=>D.participantId===n))==null?void 0:m.drawPosition,{matchUps:T}=_i({drawDefinition:s,structure:y,event:d}),S=T.map(D=>D.drawPositions).flat(1/0).filter(Boolean),w=os(S);if((I?w[I]:void 0)===1)b==null||b.forEach(D=>{D.participantId===n&&delete D.participantId});else{let D=T.filter(({drawPositions:E})=>E.includes(I));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:D,winnerTargetLink:o})}let U=(g=c==null?void 0:c.drawMatchUps)==null?void 0:g.find(({matchUpId:D})=>D===l.matchUpId);U&&yi({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:U,context:f,drawDefinition:s})}return h&&AEe({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:h,structureId:p}),{...ae}}function kEe({sourceMatchUpStatus:t,loserParticipantId:e,tournamentRecord:i,loserTargetLink:n,sourceMatchUpId:r,drawDefinition:o,loserMatchUp:a,matchUpsMap:s,dualMatchUp:l,event:c}){var m,g,v;let u="removeDirectedLoser",d=n.target.structureId,{structure:p}=At({drawDefinition:o,structureId:d});if(!p)return{error:Nn};let{positionAssignments:h}=jr({structure:p}),f=(m=h==null?void 0:h.find(y=>y.participantId===e))==null?void 0:m.drawPosition;if(h==null||h.forEach(y=>{y.participantId===e&&delete y.participantId}),p.seedAssignments=(p.seedAssignments??[]).filter(y=>y.participantId!==e),l){let y=a==null?void 0:a.sides.reduce((T,S,w)=>S.drawPosition===f?w:T,void 0),b=(g=s==null?void 0:s.drawMatchUps)==null?void 0:g.find(({matchUpId:T})=>T===a.matchUpId),I=(v=b==null?void 0:b.sides)==null?void 0:v[y];I&&(delete I.lineUp,yi({tournamentId:i==null?void 0:i.tournamentId,eventId:c==null?void 0:c.eventId,matchUp:b,context:u,drawDefinition:o}))}return{...ae}}function T2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:o,event:a}){let s=o.target.structureId;return zD({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:s,event:a}),{...ae}}function xEe(t){var l,c;let{matchUpFormat:e,score:i}=t,n=(l=i==null?void 0:i.sets)==null?void 0:l.length,r=e&&Pa(e),{setFormat:o,finalSetFormat:a,bestOf:s}=r??{};return((c=s&&n===s&&a||o)==null?void 0:c.timed)||!1}function OEe({tournamentRecord:t,drawDefinition:e,structure:i,matchUp:n}){var s;let r="attemptToSetMatchUpStatusBYE";if(n!=null&&n.winningSide)return se({result:{error:kI},context:{matchUpStatus:Ni},stack:r});let{positionAssignments:o}=jr({structure:i}),a=o==null?void 0:o.filter(l=>l.bye).map(l=>l.drawPosition);return(s=n.drawPositions)!=null&&s.some(l=>a==null?void 0:a.includes(l))?(n.matchUpStatus=Ni,n.matchUpStatusCodes=[],yi({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:n}),{...ae}):se({result:{error:GJ},info:"matchUp does not include BYE",stack:r})}function tT(t){var m;let{tournamentRecord:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:o,structure:a,event:s}=t,l="doubleExitAdvancement";if(a.structureType===fa)return se({result:{...ae},stack:l});let{matchUp:c,targetMatchUps:u,targetLinks:d}=o,{loserMatchUp:p,winnerMatchUp:h,loserTargetDrawPosition:f}=u;if(p&&p.matchUpStatus!==Ni){let{loserTargetLink:g}=d;if((m=i==null?void 0:i.progression)!=null&&m.doubleExitPropagateBye){let v=Xoe({loserTargetDrawPosition:f,tournamentRecord:e,loserTargetLink:g,drawDefinition:n,loserMatchUp:p,matchUpsMap:r,event:s});if(v.error)return se({result:v,stack:l})}else{let{feedRound:v,drawPositions:y,matchUpId:b}=p,I=v?2:2-y.indexOf(f),T=z6({...t,targetMatchUp:p,walkoverWinningSide:I,tournamentRecord:e,sourceMatchUp:c,matchUpId:b});if(T.error)return se({result:T,stack:l})}}if(h){let g=z6({...t,matchUpId:h.matchUpId,targetMatchUp:h,tournamentRecord:e,sourceMatchUp:c});if(g.error)return se({result:g,stack:l})}return se({result:{...ae},stack:l})}function z6(t){var G,W,K;let{inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:o,matchUpsMap:a}=t,s=n.structures.find(({structureId:Z})=>Z===o.structureId),l=t.matchUpStatus===Er?Er:mr,c=t.matchUpStatus===Er?Pi:Oi,u="conditionallyAdvanceDrawPosition",d=a.drawMatchUps.find(Z=>Z.matchUpId===o.matchUpId);if(!d)return{error:Ba};let p=(r==null?void 0:r.drawPositions)||[],h=(G=d.drawPositions)==null?void 0:G.filter(Boolean),f=(r==null?void 0:r.structureId)===o.structureId;if(f&&sa(p,h)&&(h=h.filter(Z=>!p.includes(Z))),f&&h.length>1)return se({result:{error:_I},stack:u});let{pairedPreviousMatchUpIsDoubleExit:m,pairedPreviousMatchUp:g}=$te(t),v=ca({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:y,targetLinks:b}=v,{loserTargetDrawPosition:I,winnerMatchUp:T,loserMatchUp:S}=y;if(S){let{loserTargetLink:Z}=b,Y=Xoe({loserTargetDrawPosition:I,loserMatchUp:S,tournamentRecord:i,loserTargetLink:Z,drawDefinition:n,matchUpsMap:a});if(Y.error)return se({result:Y,stack:u})}let w=((W=d.drawPositions)==null?void 0:W.filter(Boolean))||[],U=w.length===1,D=t.walkoverWinningSide||U&&RE({drawPosition:w[0],matchUpId:o.matchUpId,inContextDrawMatchUps:e})||void 0,E=[Oi,Pi].includes(d.matchUpStatus)&&!w.length,C=d.finishingRound===1,M=E&&!C?l:c,N=e.find(Z=>Z.matchUpId===g.matchUpId),R=[],A;r&&((r==null?void 0:r.structureId)===(N==null?void 0:N.structureId)?r.roundPosition<(g==null?void 0:g.roundPosition)?A=1:A=2:o.feedRound?r.structureId===o.structureId?A=2:A=1:D&&(A=3-D));let _=t.matchUpStatus,k=g==null?void 0:g.matchUpStatus;A===1?R=[{matchUpStatus:I1(_),previousMatchUpStatus:_,sideNumber:1},{matchUpStatus:I1(k),previousMatchUpStatus:k,sideNumber:2}]:A===2&&(R=[{matchUpStatus:I1(k),previousMatchUpStatus:k,sideNumber:1},{matchUpStatus:I1(_),previousMatchUpStatus:_,sideNumber:2}]),R.length&&(R=R.map(Z=>wt(Z)));let O=pu({...t,winningSide:D,matchUp:d,matchUpStatusCodes:R,context:u,matchUpStatus:M});if(O.error)return se({result:O,stack:u});if(E)return tT({...t,matchUpStatus:M,targetData:v});if(!T)return se({result:{...ae},stack:u});let F=h.length===2?h[D-1]:h[0],{positionAssignments:B}=Yi({structure:s}),$=B==null?void 0:B.find(Z=>Z.drawPosition===F),V=a.drawMatchUps.find(Z=>Z.matchUpId===T.matchUpId),H=(K=V==null?void 0:V.drawPositions)==null?void 0:K.filter(Boolean),z=H.length===1;if(F){if($!=null&&$.bye){let Z=ca({matchUpId:V.matchUpId,inContextDrawMatchUps:e,drawDefinition:n});if(z){let Y=H.filter(Boolean)[0],X=RE({drawPosition:Y,matchUpId:V.matchUpId,inContextDrawMatchUps:e}),Q=pu({appliedPolicies:t.appliedPolicies,matchUpId:V.matchUpId,matchUp:V,matchUpStatus:c,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,winningSide:X});return Q.error?se({result:Q,stack:u}):_j({drawPositionToAdvance:Y,matchUpId:V.matchUpId,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:a})}else if([Oi,Pi].includes(T.matchUpStatus)){let Y=tT({...t,matchUpId:V.matchUpId,matchUpStatus:M,targetData:Z});if(Y.error)return se({result:Y,stack:u})}return se({result:{...ae},stack:u})}return KI({matchUpId:T.matchUpId,drawPosition:F,inContextDrawMatchUps:e,drawDefinition:n})}else if(m){if(!V)return{error:Ba};if(z){let X=H[0],Q=RE({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawPosition:X});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Q})}let Z=[Oi,Pi].includes(V.matchUpStatus)?c:l,Y=pu({matchUpId:V.matchUpId,appliedPolicies:t.appliedPolicies,matchUp:V,matchUpStatusCodes:[],removeScore:!0,context:u,drawDefinition:n,matchUpStatus:Z});if(Y.error)return se({result:Y,stack:u});if(Z===l){let X=tT({...t,matchUpId:o.matchUpId,matchUpStatus:Z,targetData:v});if(X.error)return X}}return se({result:{...ae},stack:u})}function Xoe(t){var c;let{loserTargetDrawPosition:e,tournamentRecord:i,loserTargetLink:n,drawDefinition:r,matchUpsMap:o,event:a}=t,s=(c=n==null?void 0:n.target)==null?void 0:c.structureId,{structure:l}=At({drawDefinition:r,structureId:s});return l?xs({drawPosition:e,tournamentRecord:i,drawDefinition:r,structureId:s,matchUpsMap:o,event:a}):{error:vf}}function I1(t){return t===mr?Oi:t===Er?Pi:t}function LEe(t){let{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:o}=t,a=!!(o.tieMatchUps&&!o.rondPosition&&t.inContextDrawMatchUps.find(v=>v.matchUpId===o.matchUpId).containerStructureId),s="attemptToSetMatchUpStatus",l=n===Ni,c=o.winningSide,u=[mr,Er].includes(n),d=HD({matchUpStatus:n}),p=XF({matchUpStatus:n}),h=!d&&!p,f=t.matchUpTieId||c&&d&&!u,m=c&&u,g=()=>pu({...t,removeScore:[Fp,Oi].includes(n),matchUpStatus:n||Gn});return h&&{error:kF}||f&&U2(t)||m&&FEe(t)||c&&C0(t)||p&&g()||l&&OEe({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:o})||!d&&{error:kF}||u&&BEe(t)||a&&U2(t)||se({result:{error:kI},stack:s})}function FEe(t){let e=C0(t);return e.error?e:tT(t)}function BEe(t){let e=U2({...t,removeScore:!0});return e.error?e:tT(t)}function U2(t){var r;let e="scoreModification";if(t.isCollectionMatchUp&&((r=t.dualMatchUp)!=null&&r.winningSide)&&!t.projectedWinningSide){let o=C0(t);if(o.error)return se({result:o,stack:e})}let i=!!t.matchUp.collectionId,n=pu({...t,context:e});if(i){let{matchUpTieId:o,drawDefinition:a,matchUpsMap:s}=t,l=Gp({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:o,event:t.event,drawDefinition:a,matchUpsMap:s});if(l.error)return se({result:l,stack:e});Object.assign(n,{tieMatchUpResult:l})}return se({result:n,stack:e})}function $Ee({drawDefinition:t,structure:e,matchUp:i}){var l,c,u,d;let{drawPositions:n}=i,{positionAssignments:r}=Yi({drawDefinition:t,structure:e}),o=(l=r==null?void 0:r.filter(({drawPosition:p})=>n==null?void 0:n.includes(p)))==null?void 0:l.map(p=>{var f;let{extension:h}=Qt({element:p,name:Wh});return(f=h==null?void 0:h.value)==null?void 0:f.groupOrder}),{containerStructures:a}=p0({drawDefinition:t}),s=a[e.structureId];return{structureIds:(d=(u=(c=g0({drawDefinition:t,structureId:s}))==null?void 0:c.links)==null?void 0:u.source)==null?void 0:d.filter(p=>{var h;return sa(o,((h=p.source)==null?void 0:h.finishingPositions)||[])}).map(p=>p.source.structureId)}}function Joe({drawDefinition:t,structure:e,matchUp:i}){let n=[];if(e.finishingPosition===d0&&Xh({drawDefinition:t,structure:e})){let{structureIds:r}=$Ee({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function VEe(t){var s,l,c;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:o}=t,a=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(a.target.feedProfile===Rl){let u=n.sides.find(({sideNumber:p})=>p!==o).participantId,d=i.find(p=>p.structureId===a.target.structureId&&p.roundNumber===a.target.roundNumber&&p.sides.some(({participantId:h})=>h===u));if((d==null?void 0:d.matchUpStatus)===Gn){let p=ca({matchUpId:d.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!km({inContextDrawMatchUps:i,drawDefinition:r,targetData:p})){let{structure:h}=At({structureId:d.structureId,drawDefinition:r}),f=Yi({structure:h}).positionAssignments;for(let m of f||[])if(m.participantId===u){let g=n.sides.find(({sideNumber:v})=>v===o).participantId;if(m.participantId=g,h==null?void 0:h.positionAssignments)h.positionAssignments=f;else if(h!=null&&h.structures){let v=Object.assign({},...(f||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of h.structures)(l=y.positionAssignments)==null||l.forEach(b=>b.participantId=v[b.drawPosition])}Kh({tournamentId:(c=t.tournamentRecord)==null?void 0:c.tournamentId,event:t.event,drawDefinition:r,structure:h}),e=!0}}}}return{...ae,qualifierReplaced:e}}function jEe(t){var s,l,c,u,d;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r,winningSide:o}=t,a=(s=t.targetData.targetLinks)==null?void 0:s.winnerTargetLink;if(a.target.feedProfile===Rl){let p=(l=n.sides.find(({sideNumber:m})=>m===o))==null?void 0:l.participantId,h=i.filter(m=>m.structureId===a.target.structureId&&m.roundNumber===a.target.roundNumber&&m.sides.some(({participantId:g,qualifier:v})=>v&&!g)),f=Ja(h);if((f==null?void 0:f.matchUpStatus)===Gn){let m=ca({matchUpId:f.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!km({inContextDrawMatchUps:i,drawDefinition:r,targetData:m})){let g=(c=f.sides.find(b=>b.qualifier&&!b.participantId))==null?void 0:c.drawPosition,{structure:v}=At({structureId:f.structureId,drawDefinition:r});if(!v)return{error:Nn};let y=Yi({structure:v}).positionAssignments;for(let b of y||[])if(b.drawPosition===g&&!b.participantId){if(b.participantId=p,v.positionAssignments)v.positionAssignments=y;else if(v.structures){let I=Object.assign({},...(y||[]).map(T=>({[T.drawPosition]:T.participantId})));for(let T of v.structures)(u=T.positionAssignments)==null||u.forEach(S=>S.participantId=I[S.drawPosition])}Kh({tournamentId:(d=t.tournamentRecord)==null?void 0:d.tournamentId,event:t.event,drawDefinition:r,structure:v}),e=!0}}}}return{...ae,qualifierPlaced:e}}function HEe(t){var h,f;let e="attemptToSetWinningSide",i,{appliedPolicies:n,disableAutoCalc:r,drawDefinition:o,dualMatchUp:a,winningSide:s,structure:l,matchUp:c}=t;if(a!=null&&a._disableAutoCalc&&r!==!1)return oH(t);if(c.winningSide&&c.winningSide!==s){let{connectedStructureIds:m}=Joe({drawDefinition:o,structure:l,matchUp:c});m.length&&(console.log({connectedStructureIds:m}),i=!0);let g=C0(t);if(g.error)return g}let u=kie(t);if(u.error)return se({result:u,stack:e});let d,p;return t.qualifierChanging&&((h=n==null?void 0:n[xT])!=null&&h.autoReplaceQualifiers)&&(d=VEe(t).qualifierReplaced),t.qualifierAdvancing&&((f=n==null?void 0:n[xT])!=null&&f.autoPlaceQualifiers)&&(p=jEe(t).qualifierPlaced),se({result:wt({...ae,...u,connectedStructures:i,qualifierReplaced:d,qualifierPlaced:p}),stack:e})}var kE={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function Qoe(t){var h;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:r,targetData:o,matchUp:a}=t,{iteration:s=0}=t;s+=1;let l="removeDoubleExit";tl({method:l,color:"brightyellow",iteration:s,keyColors:kE});let{targetLinks:{loserTargetLink:c},targetMatchUps:{loserMatchUp:u,winnerMatchUp:d,loserTargetDrawPosition:p}}=o;if(d&&d.matchUpStatus!==Ni){let{stage:f,roundNumber:m,roundPosition:g}=d;tl({winner:"winner",stage:f,roundNumber:m,roundPosition:g,keyColors:kE}),W6({...t,targetMatchUp:d,sourceMatchUp:a,iteration:s})}if(u&&u.matchUpStatus!==Ni){let f=e.find(({matchUpId:I})=>I===u.matchUpId),{structure:m}=At({drawDefinition:n,structureId:f.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:b}=u;if(tl({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:kE,feedRound:b}),(h=i==null?void 0:i.progression)==null?void 0:h.doubleExitPropagateBye)T2({drawPosition:p,targetLink:c,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:r});else{let I=W6({...t,structure:m,targetMatchUp:u,iteration:s});if(I.error)return se({result:I,stack:l})}}return se({result:{...ae},stack:l})}function W6(t){var I,T,S,w,U,D;let{inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,sourceMatchUp:r,targetMatchUp:o,matchUpsMap:a,structure:s,iteration:l}=t,c="conditionallyRemoveDrawPosition";tl({method:c});let u=ca({matchUpId:o.matchUpId,inContextDrawMatchUps:e,drawDefinition:n}),{targetMatchUps:{winnerMatchUp:d}}=u,p=a==null?void 0:a.drawMatchUps.find(E=>E.matchUpId===o.matchUpId),h=[],f,m,g;if(o.feedRound)g=(T=(I=d==null?void 0:d.drawPositions)==null?void 0:I.filter(Boolean))==null?void 0:T.find(E=>o.drawPositions.includes(E));else if(!r)g=(S=Hn((o==null?void 0:o.drawPositions)||[],(d==null?void 0:d.drawPositions)||[]))==null?void 0:S[0];else if(m=(w=Vte({structureId:s.structureId,matchUp:r,matchUpsMap:a}))==null?void 0:w.pairedPreviousMatchUp,f=[mr,Er].includes(m==null?void 0:m.matchUpStatus),h=((U=m==null?void 0:m.drawPositions)==null?void 0:U.filter(Boolean))||[],[...Nr,Ni].includes(m==null?void 0:m.matchUpStatus)||(m==null?void 0:m.winningSide)){let E=r.drawPositions||[],C=(D=o.drawPositions)==null?void 0:D.filter(Boolean);sa(E,C)&&(C=C==null?void 0:C.filter(M=>!E.includes(M))),g=E.concat(h).find(M=>C==null?void 0:C.includes(M))}if(d&&g){let{stage:E,roundNumber:C,roundPosition:M}=d;tl({method:"removeDirectedWinner",drawPositionToRemove:g,keyColors:kE,color:"brightgreen",stage:E,roundNumber:C,roundPosition:M}),Zoe({winningDrawPosition:g,winnerMatchUp:d,inContextDrawMatchUps:e,drawDefinition:n,matchUpsMap:a})}let v=Qoe({targetData:u,matchUp:o,inContextDrawMatchUps:e,appliedPolicies:i,drawDefinition:n,matchUpsMap:a,structure:s,iteration:l});if(v.error)return se({result:v,stack:c});let y=GEe({pairedPreviousDoubleExit:f,noContextTargetMatchUp:p}),b=!f;return v=pu({...t,matchUpId:o.matchUpId,matchUp:p,removeWinningSide:!0,matchUpStatusCodes:[],context:c,matchUpStatus:y,removeScore:b,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0}}),v.error?se({result:v,stack:c}):{...ae}}function GEe({pairedPreviousDoubleExit:t,noContextTargetMatchUp:e}){return e.matchUpStatus===Ni?Ni:t?[Er,Pi].includes(e==null?void 0:e.matchUpStatus)?Pi:Oi:Gn}function zEe(t){var a,s,l,c,u;let e,{inContextDrawMatchUps:i,inContextMatchUp:n,drawDefinition:r}=t,o=(a=t.targetData.targetLinks)==null?void 0:a.winnerTargetLink;if(o.target.feedProfile===Rl){let d=(l=(s=n.sides)==null?void 0:s.find(({sideNumber:h})=>h===n.winningSide))==null?void 0:l.participantId,p=i.find(h=>{var f;return h.structureId===o.target.structureId&&h.roundNumber===o.target.roundNumber&&((f=h.sides)==null?void 0:f.some(({participantId:m})=>m===d))});if(p&&p.matchUpStatus===Gn){let h=ca({matchUpId:p.matchUpId,inContextDrawMatchUps:i,drawDefinition:r});if(!km({inContextDrawMatchUps:i,drawDefinition:r,targetData:h})){let{structure:f}=At({structureId:p.structureId,drawDefinition:r}),m=Yi({structure:f}).positionAssignments;for(let g of m||[])if(g.participantId===d){if(g.participantId=void 0,f==null?void 0:f.positionAssignments)f.positionAssignments=m;else if(f!=null&&f.structures){let v=Object.assign({},...(m||[]).map(y=>({[y.drawPosition]:y.participantId})));for(let y of(f==null?void 0:f.structures)||[])(c=y.positionAssignments)==null||c.forEach(b=>b.participantId=v[b.drawPosition])}Kh({tournamentId:(u=t.tournamentRecord)==null?void 0:u.tournamentId,event:t.event,drawDefinition:r,structure:f}),e=!0}}}}return{qualifierRemoved:e}}function WEe(t){var m;let{matchUp:e,matchUpStatus:i,score:n,winningSide:r}=t,o="noDownStreamDependencies";if([mr,Er].includes(e==null?void 0:e.matchUpStatus)&&![mr,Er].includes(i)){let g=Qoe(t);if(g.error)return se({result:g,stack:o})}let a=i===mr,s=io({score:n})&&!a&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!r),l=((m=t==null?void 0:t.inContextMatchUp)==null?void 0:m.collectionId)&&xEe(t.inContextMatchUp),c=t.removeScore||!l&&![wu,Us].includes(i||wu),u=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||e.winningSide&&!r&&!io({score:n}),d=i&&i!==Gn,p=g=>{var U,D;let v,{structure:y,drawDefinition:b,dualMatchUp:I,disableAutoCalc:T}=t;if(I!=null&&I._disableAutoCalc&&T!==!1)return oH(t);let{connectedStructureIds:S}=Joe({drawDefinition:b,structure:y,matchUp:e});S.length&&(console.log({connectedStructureIds:S}),v=!0),Object.assign(t,{removeScore:g});let w=C0(t);if(w.error)return w;if(t.removingQualifier&&((D=(U=t.appliedPolicies)==null?void 0:U[xT])!=null&&D.autoRemoveQualifiers)){let E=zEe(t);return{...ae,connectedStructures:v,...E}}return{...ae,connectedStructures:v}};if(u&&r&&t.isCollectionMatchUp)return q6(t);let h=[Fp,Us].includes(i)&&t.dualWinningSideChange,f=(r||h)&&HEe(t)||s&&p(c)||d&&LEe(t)||u&&p(c)||e&&q6({...t,removeScore:!0})||{...ae};return se({result:f,stack:o})}function q6(t){var n;let e="scoreModification";if(t.isCollectionMatchUp&&((n=t.dualMatchUp)!=null&&n.winningSide)&&!t.projectedWinningSide){let r=C0(t);if(r.error)return r}let i=pu({...t,context:e});if(t.isCollectionMatchUp){let{matchUpTieId:r,drawDefinition:o,event:a,matchUpsMap:s}=t,{removeWinningSide:l}=Gp({tournamentRecord:t.tournamentRecord,appliedPolicies:t.appliedPolicies,matchUpId:r,drawDefinition:o,matchUpsMap:s,event:a});l&&console.log("REMOVE WINNING SIDE")}return se({result:i,stack:e})}function Mf(t){var h;let e="addMatchUpScheduledTime",i=t.matchUp,{removePriorValues:n,tournamentRecord:r,drawDefinition:o,disableNotice:a,scheduledTime:s,matchUpId:l}=t;if(!l)return se({result:{error:To},stack:e});if(!a0(s))return se({result:{error:Dl},stack:e});if(!i){let f=fn({drawDefinition:o,matchUpId:l});if(f.error)return se({result:f,stack:e});i=f.matchUp}let c=Wt(s),u=Rm({matchUp:i}).scheduledDate,d=c&&!u;if((h=Dj({matchUp:i}).timeModifiers||[])!=null&&h.length){let f=eae({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:o,matchUpId:l,matchUp:i});if(f!=null&&f.error)return se({result:f,stack:e})}let p=Dy(s,!0,d);return Ps({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:o,disableNotice:a,matchUpId:l,timeItem:{itemType:m0,itemValue:p}})}function eae({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:o,matchUp:a}){let s="addMatchUpTimeModifiers";if(!o)return se({result:{error:To},stack:s});if(r!==void 0&&!Array.isArray(r))return se({info:Td("timeModifiers"),result:{error:Pe},stack:s});if(!a){let d=fn({drawDefinition:i,matchUpId:o});if(d.error)return se({result:d,stack:s});a=d.matchUp}let l=Dj({matchUp:a}).timeModifiers||[],c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...ae};if(c.some(d=>WF.includes(d))){l=l.filter(p=>!WF.includes(p));let d=Mf({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:o});if(d.error)return se({result:d,stack:s})}let u=r!=null&&r.length?[...c,...l]:void 0;return Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:Tj,itemValue:u}})}function P_({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:o,matchUpId:a,courtIds:s}){var u,d;if(!i&&!e)return{error:Ge};if(!a)return{error:To};let l=fn({drawDefinition:n,matchUpId:a});if(l.error)return l;if(((u=l==null?void 0:l.matchUp)==null?void 0:u.matchUpType)!==Su)return{error:Sa};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:Pe,context:{courtIds:s}};let c;if(s){let p=e||i&&{[i.tournamentId]:i},h=zp({tournamentRecords:p});if(h.error)return h;let f=(d=h.courts)==null?void 0:d.filter(m=>s.includes(m.courtId));if((f==null?void 0:f.length)!==s.length)return{error:Pe,context:{courtIds:s}};c=f==null?void 0:f.map(m=>({venueId:m.venueId,courtId:m.courtId}))}return Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Ip,itemDate:o,itemValue:c}})}function E0({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:a}){if(!i)return{error:Ge};if(!o)return{error:To};if(a){let s=Vp({tournamentRecords:e,tournamentRecord:i,venueId:a});if(s.error)return s}return Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:h0,itemValue:a}})}function Gy({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:o,matchUpId:a,courtId:s}){var l;if(!i&&!e)return{error:Ge};if(!a)return{error:To};if(s){let c=Ny({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;let u=(l=c.venue)==null?void 0:l.venueId;E0({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:u})}return Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:Mm,itemDate:o,itemValue:s}})}function su(t,e){let i=ree.test(t)?t:hn(t),n=Wt(t)||Wt(e)||Dc(new Date);return new Date(`${n}T${i}`).getTime()}function C_({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:o,tournamentRecord:a,drawDefinition:s,disableNotice:l,drawMatchUps:c,matchUpId:u,schedule:d,event:p}){var M;if(!d)return{error:gt,info:"Missing schedule"};if(!s)return{error:lt};if(!u)return{error:To};let h="addMatchUpScheduleItems",f,m;if(c)f=c.find(N=>N.matchUpId===u);else{let N=fn({drawDefinition:s,event:p,matchUpId:u});if(N.error)return N;f=N.matchUp}let{endTime:g,courtId:v,courtIds:y,courtOrder:b,resumeTime:I,scheduledDate:T,scheduledTime:S,startTime:w,stopTime:U,timeModifiers:D,venueId:E}=d;e&&(!i||!n)&&({matchUpDependencies:i,matchUps:n}=nc({drawDefinition:s}));let C=(M=i==null?void 0:i[u])==null?void 0:M.matchUpIds;if(d.scheduledDate&&e&&C){let N=n==null?void 0:n.filter(R=>{var A,_;return(((A=R.schedule)==null?void 0:A.scheduledDate)||Wt((_=R.schedule)==null?void 0:_.scheduledTime))&&C.includes(R.matchUpId)}).map(({schedule:R})=>{let A=bM(R);return new Date(A).getTime()});if(N!=null&&N.length){let R=bM(d),A=new Date(R).getTime();if(Math.max(...N)>=A){if(t)return se({result:{error:NF},stack:h});m=NF}}}if(T!==void 0){let N=E_({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,scheduledDate:T,matchUpId:u});if(N!=null&&N.error)return se({result:N,stack:h,context:{scheduledDate:T}})}if(S!==void 0){let N=Mf({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,scheduledTime:S,matchUpId:u,matchUp:f});if(N!=null&&N.error)return se({result:N,stack:h,context:{scheduledTime:S}})}if(w!==void 0){let N=LG({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,startTime:w,event:p});if(N!=null&&N.error)return se({result:N,stack:h,context:{startTime:w}})}if(U!==void 0){let N=BG({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,stopTime:U,event:p});if(N!=null&&N.error)return se({result:N,stack:h,context:{stopTime:U}})}if(I!==void 0){let N=$G({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,resumeTime:I,matchUpId:u,event:p});if(N!=null&&N.error)return se({result:N,stack:h,context:{resumeTime:I}})}if(g!==void 0){let N=FG({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,endTime:g,event:p});if(N!=null&&N.error)return se({result:N,stack:h,context:{endTime:g}})}if(y!==void 0){let N=P_({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,courtIds:y});if(N!=null&&N.error)return se({result:N,stack:h,context:{courtIds:y}})}if(v!==void 0&&T!==void 0){let N=Gy({courtDayDate:T,disableNotice:!0,removePriorValues:r,tournamentRecords:o,tournamentRecord:a,drawDefinition:s,matchUpId:u,courtId:v});if(N!=null&&N.error)return se({result:N,stack:h,context:{courtId:v}})}if(E!==void 0){let N=E0({disableNotice:!0,removePriorValues:r,tournamentRecords:o,tournamentRecord:a,drawDefinition:s,matchUpId:u,venueId:E});if(N!=null&&N.error)return se({result:N,stack:h,context:{venueId:E}})}if(b!==void 0&&Bt(b)){let N=OG({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,courtOrder:b,matchUpId:u});if(N!=null&&N.error)return se({result:N,stack:h,context:{courtOrder:b}})}if(D!==void 0){let N=eae({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,timeModifiers:D,matchUpId:u,matchUp:f});if(N!=null&&N.error)return se({result:N,stack:h,context:{timeModifiers:D}})}return l||yi({tournamentId:a==null?void 0:a.tournamentId,eventId:p==null?void 0:p.eventId,context:h,drawDefinition:s,matchUp:f}),m?{...ae,warnings:[m]}:{...ae}}function E_({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o}){if(!o)return{error:To};let a=t&&md.test(t);if(t&&!a)return{error:aa};let s={itemValue:Wt(t),itemType:f0};return Ps({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:s})}function OG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:o}){if(!o)return{error:To};if(r&&!Bt(r))return{error:Pe,info:"courtOrder must be numeric"};let a=r&&Et(r);return Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:Sj,itemValue:a}})}function tae({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:o,matchUpId:a}){if(!a)return{error:To};if(!r)return{error:Rr};if(e){let l=zn({tournamentRecord:e,participantFilters:{participantTypes:[si],participantRoles:[Oj]}}).participants??[];if(!zh({tournamentParticipants:l,participantId:r}))return{error:Jn}}let s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return o&&(s.itemSubTypes=[o]),Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:s})}function LG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:o,event:a}){if(!r)return{error:To};if(!a0(o))return{error:Dl};let{matchUp:s}=fn({drawDefinition:i,event:a,matchUpId:r}),{scheduledDate:l}=Rm({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[op,od,wp].includes(u==null?void 0:u.itemType)).map(u=>su(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||su(o,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==bc));let u=Dy(o,!0,!0);return Ps({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:bc,itemValue:u}})}else return{error:vQ}}function FG({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,endTime:a,event:s}){if(!o)return{error:To};if(!a0(a))return{error:Dl};let{matchUp:l}=fn({drawDefinition:n,event:s,matchUpId:o}),{scheduledDate:c}=Rm({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[bc,od,op].includes(d==null?void 0:d.itemType)).map(d=>su(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||su(a,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==wp));let d=Dy(a,!0,!0);return Ps({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:wp,itemValue:d}})}else return{error:mQ}}function BG({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:o,event:a}){if(!r)return{error:To};if(!a0(o))return{error:Dl};let{matchUp:s}=fn({drawDefinition:i,event:a,matchUpId:r}),{scheduledDate:l}=Rm({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===wp||f,void 0))return{error:sV};let u=c.filter(f=>[bc,od,op].includes(f==null?void 0:f.itemType)).sort((f,m)=>su(f.itemValue,l)-su(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===op,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>su(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(su(o,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:Dy(o,!0,!0),itemType:op};return Ps({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:f})}else return{error:gQ}}function $G({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:o,event:a}){if(!o)return{error:To};if(!a0(r))return{error:Dl};let{matchUp:s}=fn({drawDefinition:i,event:a,matchUpId:o}),{scheduledDate:l}=Rm({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===wp||f,void 0))return{error:sV};let u=c.filter(f=>[bc,od,op].includes(f==null?void 0:f.itemType)).sort((f,m)=>su(f.itemValue,l)-su(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===od,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>su(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(su(r,l)>h){if(s!=null&&s.timeItems&&p){let m=d.createdAt;s.timeItems=s.timeItems.filter(g=>g.createdAt!==m)}let f={itemValue:Dy(r,!0,!0),itemType:od};return Ps({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:f})}else return{error:F0e}}function qEe(t){var T;let{tournamentRecord:e,inContextMatchUp:i,structure:n,drawDefinition:r}=t,o=i.roundNumber,a=i.sides.find(S=>S.sideNumber===i.winningSide),s=i.sides.find(S=>S.sideNumber!==i.winningSide),{drawPosition:l,participantId:c}=a,{drawPosition:u,participantId:d}=s,p="swapWinnerLoser",{matchUps:h}=_i(t),f=h.filter(({drawPositions:S,roundNumber:w})=>(S==null?void 0:S.includes(l))&&w>o);rl({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:f}),f.forEach(S=>{var w,U;S.drawPositions=((w=S.drawPositions)==null?void 0:w.map(D=>D===l?u:D))||[],yi({tournamentId:e==null?void 0:e.tournamentId,eventId:(U=t.event)==null?void 0:U.eventId,context:p,drawDefinition:r,matchUp:S})});let{stage:m,stageSequence:g}=n,v=r.structures.filter(({stage:S,stageSequence:w})=>S===m&&w>g).map(({structureId:S})=>S),{targetLinks:{loserTargetLink:y,winnerTargetLink:b}}=t.targetData,I=[y==null?void 0:y.target.structureId,(T=b==null?void 0:b.target)==null?void 0:T.structureId].filter(Boolean);return r.structures.filter(({stage:S,structureId:w})=>S!==m&&I.includes(w)).forEach(({stage:S,stageSequence:w,structureId:U})=>{v.includes(U)||v.push(U),r.structures.filter(({stage:D,stageSequence:E})=>D===S&&E>w).forEach(({structureId:D})=>{v.includes(D)||v.push(D)})}),r.structures.filter(({structureId:S})=>v.includes(S)).forEach(S=>{let{positionAssignments:w}=Yi({structure:S}),U=w==null?void 0:w.find(({participantId:E})=>E===c),D=w==null?void 0:w.find(({participantId:E})=>E===d);U&&(U.participantId=d),D&&(D.participantId=c)}),pu({...t,context:p})}function bP(t){var H,z,G,W;let e="setMatchUpStatus";t.matchUpStatus&&[Oi,mr].includes(t.matchUpStatus)&&(t.score=void 0);let{allowChangePropagation:i,disableScoreValidation:n,tournamentRecords:r,tournamentRecord:o,disableAutoCalc:a,enableAutoCalc:s,drawDefinition:l,matchUpStatus:c,winningSide:u,matchUpId:d,event:p,score:h}=t;if(!l)return{error:lt};if(c&&[Fp,wu,Us,Gn].includes(c)&&u)return{error:Pe,winningSide:u,matchUpStatus:c};if(![void 0,...zV].includes(c))return se({result:{error:kI},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});let f=Uo({drawDefinition:l}),{matchUps:m}=Tr({nextMatchUps:!0,tournamentRecord:o,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p}),g=f.drawMatchUps.find(K=>K.matchUpId===d),v=m==null?void 0:m.find(K=>K.matchUpId===d);if(!g||!m)return{error:Ao};if((g.winningSide||u)&&c===Ni)return{context:"Cannot have Bye with winningSide",error:IE,matchUpStatus:c};let y=v==null?void 0:v.structureId,{structure:b}=At({drawDefinition:l,structureId:y}),I=jn(sn)(g.matchUpType),T=(H=v==null?void 0:v.drawPositions)==null?void 0:H.filter(Boolean),S;if(I){if(a)Ui({extension:{name:$I,value:!0},element:g});else if(s){let K=g.winningSide;ta({name:$I,element:g});let{winningSide:Z,scoreStringSide1:Y,scoreStringSide2:X,set:Q}=aP({drawDefinition:l,matchUpsMap:f,structure:b,matchUp:g,event:p}),te={scoreStringSide1:Y,scoreStringSide2:X,sets:Q?[Q]:[]};S=Z!==K,Object.assign(t,{winningSide:Z,dualWinningSideChange:S,projectedWinningSide:Z,score:te})}sP({tournamentId:o==null?void 0:o.tournamentId,inContextDualMatchUp:v,eventId:p==null?void 0:p.eventId,dualMatchUp:g,drawDefinition:l})}if(I&&c&&[Py].includes(c))return{error:Pe,info:"Not supported for matchUpType: TEAM"};let w=v==null?void 0:v.matchUpTieId,U=ca({matchUpId:w||d,inContextDrawMatchUps:m,drawDefinition:l});if(h&&!I&&!n){let K=g.matchUpFormat??(b==null?void 0:b.matchUpFormat)??(l==null?void 0:l.matchUpFormat)??(p==null?void 0:p.matchUpFormat),Z=_H({existingMatchUpStatus:g.matchUpStatus,matchUpFormat:K,matchUpStatus:c,winningSide:u,score:h});if(Z.error)return Z}let D=g!=null&&g.sides?[]:Yi({drawDefinition:l,structureId:y}).positionAssignments,E=(z=v==null?void 0:v.sides)==null?void 0:z.map(K=>K.participantId).filter(Boolean).length,C=E&&E===2||g.collectionId&&ss({structure:b})&&E&&E>=1||(T==null?void 0:T.length)===2&&(D==null?void 0:D.filter(K=>T.includes(K.drawPosition)).every(K=>K.participantId));if(c&&GV.includes(c)&&!C)return se({info:"present in participantsRequiredMatchUpStatuses",context:{matchUpStatus:c,requiredParticipants:C},result:{error:kI}});let M=((G=Bi({policyTypes:[xT,vd],tournamentRecord:o,drawDefinition:l,event:p}))==null?void 0:G.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(M,t.policyDefinitions);let N=(v==null?void 0:v.stage)===Tt&&v.finishingRound===1,R=N&&u,A=N&&g.winningSide&&!u&&(!t.matchUpStatus||t.matchUpStatus&&XF({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!io({outcome:t.outcome})),_=R&&u!==g.winningSide&&g.winningSide;if(Object.assign(t,{inContextDrawMatchUps:m,qualifierAdvancing:R,qualifierChanging:_,removingQualifier:A,inContextMatchUp:v,appliedPolicies:M,matchUpTieId:w,matchUpsMap:f,targetData:U,structure:b,matchUp:g}),w){let{matchUp:K}=fn({matchUpId:w,inContext:!0,drawDefinition:l,matchUpsMap:f,event:p});if(K){let Z=(W=Vo({matchUp:K,drawDefinition:l,structure:b,event:p}))==null?void 0:W.tieFormat,{projectedWinningSide:Y}=REe({drawDefinition:l,matchUpStatus:c,dualMatchUp:K,matchUpsMap:f,winningSide:u,tieFormat:Z,structure:b,matchUp:g,event:p,score:h}),X=K.winningSide;S=Y!==X,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:S,projectedWinningSide:Y,matchUpTieId:w,dualMatchUp:K,tieFormat:Z})}}let k=km(t),O=HD({matchUpStatus:c});if(!w){if(k&&!u&&(c&&XF({matchUpStatus:c})||c&&[mr,Er].includes(c)))return{error:IE,activeDownstream:k,winningSide:u};if(u&&u===g.winningSide&&c&&!O)return{context:"winningSide must include directing matchUpStatus",error:IE,directingMatchUpStatus:O,matchUpStatus:c}}let{schedule:F}=t;if(F){let K=C_({disableNotice:!0,tournamentRecords:r,tournamentRecord:o,drawDefinition:l,matchUpId:d,schedule:F});if(K.error)return K}let B=!I&&!S&&u&&g.winningSide&&g.winningSide!==u;if(i&&B&&g.roundPosition)return qEe(t);let $=u&&!w||t.projectedWinningSide;tl({activeDownstream:k,matchUpWinner:$,method:e,winningSide:u});let V=!k&&WEe(t)||$&&YEe(t)||O&&iae(t)||{error:DQ};return se({result:V,stack:e})}function YEe(t){let{matchUp:e,winningSide:i,matchUpTieId:n,dualWinningSideChange:r}=t;return i===e.winningSide||n&&!r?iae(t):se({stack:"winningSideWithDownstreamDependencies",result:{error:nV},context:{winningSide:i,matchUp:e}})}function iae(t){let{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!io({score:t.score}),o=t.isCollectionMatchUp?t.matchUpStatus||r&&Gn||or:t.matchUpStatus||or,a=t.removeScore||[Fp,Oi].includes(o)&&![wu,Us].includes(o),s=pu({...t,matchUpStatus:o,removeWinningSide:r,context:"sms",removeScore:a});if(s.error)return s;if(t.isCollectionMatchUp){let{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=Gp({appliedPolicies:t.appliedPolicies,matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function nae({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:lt};let{matchUp:r}=fn({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==Su?{error:Sa}:bP({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function rae({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:lt};if(!i)return{error:To};let{matchUp:n}=fn({drawDefinition:t,event:e,matchUpId:i});return n?ta({name:cA,element:n}):{error:Ao}}function KEe({substituteParticipantId:t,existingParticipantId:e,tournamentRecord:i,drawDefinition:n,sideNumber:r,matchUpId:o,event:a}){var h,f,m,g,v;let s="substituteParticipant";if(!n)return{error:lt};if(!o)return{error:To};if(!e||!t)return se({result:{error:Rr},stack:s});let{matchUp:l}=fn({drawDefinition:n,matchUpId:o,event:a});if(!l)return{error:Ao};if(!l.collectionId)return se({result:{error:Sa},stack:s});let c=Uo({drawDefinition:n}),{matchUps:u}=Tr({tournamentParticipants:i==null?void 0:i.participants,inContext:!0,drawDefinition:n,matchUpsMap:c}),d=u==null?void 0:u.find(y=>y.matchUpId===o),p=(f=(h=u==null?void 0:u.find(y=>y.matchUpId===(d==null?void 0:d.matchUpTieId)))==null?void 0:h.sides)==null?void 0:f.find(y=>y.participant.individualParticipants.some(({participantId:b})=>b===e));return!p||r&&p.sideNumber!==r?{error:bu}:(v=(g=(m=p.participant)==null?void 0:m.individualParticipants)==null?void 0:g.map(ai).filter(y=>y!==e))!=null&&v.includes(t)?kG({newParticipantId:t,tieMatchUpId:o,existingParticipantId:e,substitution:!0,tournamentRecord:i,drawDefinition:n,event:a}):se({result:{error:bu},stack:s})}function oae(t){return KEe(t)}function aae({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:lt};let{matchUp:n}=fn({drawDefinition:t,matchUpId:e,event:i});return Ui({extension:{name:$I,value:!0},element:n})}function sae(t){let e="setMatchUpFormat",i=Ei(t,[{tournamentRecord:!0},{[yc]:T=>ls({matchUpFormat:T}),[fd]:dD,matchUpFormat:!0}]);if(i.error)return se({result:i,stack:e});let{tournamentRecord:n,drawDefinition:r,scheduledDates:o,stageSequences:a,matchUpFormat:s,structureId:l,eventType:c,matchUpId:u,eventId:d,stages:p,drawId:h,event:f,force:m}=t;if(o&&!Array.isArray(o))return se({result:{error:Pe,scheduledDates:o},stack:e});if(c&&!EA([Sd,Gl],c))return se({result:{error:Hh},stack:e});let g=0,v=t.structureIds||l&&[l].filter(Boolean)||[],y=t.eventIds||d&&[d].filter(Boolean)||[],b=t.drawIds||h&&[h].filter(Boolean)||[];if((l||v!=null&&v.length)&&!r)return se({result:{error:lt},stack:e});if(h&&u&&r){let T=LH({tournamentRecord:n,drawDefinition:r,matchUpFormat:s,structureIds:v,structureId:l,matchUpId:u});if(T.error)return T;g+=1}let I=T=>{let S=[];for(let w of T.structures||[]){if(Array.isArray(p)&&!p.includes(w.stage)||Array.isArray(a)&&!a.includes(w.stageSequence)||v!=null&&v.length&&!v.includes(w.structureId))continue;v!=null&&v.length&&w.matchUpFormat!==s&&(w.matchUpFormat=s,S.push(w.structureId),g+=1);let U=((m||o)&&_i({matchUpFilters:{matchUpStatuses:[Gn]},structure:w}).matchUps)??[],D=(o&&_i({matchUpFilters:{matchUpStatuses:[Gn]},contextFilters:{scheduledDates:o},afterRecoveryTimes:!1,inContext:!0,structure:w}).matchUps)??[];if(U!=null&&U.length){let E=D?D.map(Br):U.map(Br);for(let C of U)E.includes(C.matchUpId)&&(C.matchUpFormat=o!=null&&o.length?s:void 0,yi({tournamentId:n==null?void 0:n.tournamentId,eventId:f==null?void 0:f.eventId,context:e,drawDefinition:T,matchUp:C}))}}return!S.length&&T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1),S};for(let T of(n==null?void 0:n.events)||[])if(!(y!=null&&y.length&&!y.includes(T.eventId)||c&&c!==T.eventType||c===Or))if(Array.isArray(a)||Array.isArray(p)||v!=null&&v.length||b!=null&&b.length)for(let S of T.drawDefinitions||[]){if(Array.isArray(b)&&!b.includes(S.drawId))continue;let w=I(S);cn({structureIds:w,drawDefinition:S})}else T.matchUpFormat!==s&&(T.matchUpFormat=s,g+=1);return g?{...ae,modificationsCount:g}:{...ae,info:t0}}function VG({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var l,c;if(!i)return{error:lt};let o=(l=fn({drawDefinition:i,matchUpId:n}))==null?void 0:l.matchUp;if(!(o!=null&&o.tieMatchUps))return{error:Sa};let a=(c=fn({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:c.matchUp,s=0;return((o==null?void 0:o.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((a==null?void 0:a.sides)||[]).forEach(u=>{if(s+=1,t===!1){let d=a==null?void 0:a.tieFormat,p=u.participantId;d&&p&&Ly({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}yi({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:o})}),{...ae,modificationsCount:s}}function lae(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};let o=r.sets||[],a=ld({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:o}),s=ld({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:o}),l=ld({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:o}),c=a===l?s:a;return n&&(a=n===1?l:c,s=n===2?l:c),{score:{sets:o,scoreStringSide1:a,scoreStringSide2:s}}}function IP(t){var v;let e=Ei(t,[{[ng]:!0,[qc]:!0}]);if(e.error)return e;let i=Ou(t);if(!t.drawDefinition){let y=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=y);let b=Ta({eventId:t.eventId,drawId:t.drawId,tournamentRecord:y});if(b.error)return b;b.drawDefinition&&(t.drawDefinition=b.drawDefinition),t.event=b.event}let{disableScoreValidation:n,policyDefinitions:r,tournamentRecord:o,disableAutoCalc:a,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:u,schedule:d,event:p,notes:h}=t,{policy:f}=cg({policyType:vd,tournamentRecord:o,event:p}),m=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(f==null?void 0:f.allowChangePropagation)!==void 0&&f.allowChangePropagation||void 0,{outcome:g}=t;if(g!=null&&g.winningSide&&![1,2].includes(g.winningSide))return{error:YN};if(c){let y=LH({tournamentRecord:o,drawDefinition:l,matchUpFormat:c,matchUpId:u,event:p});if(y.error)return y}if((v=g==null?void 0:g.score)!=null&&v.sets&&!g.score.scoreStringSide1){let{score:y}=lae(g);g.score=y,g.score.sets=g.score.sets.filter(b=>b.side1Score||b.side2Score||b.side1TiebreakScore||b.side2TiebreakScore)}return bP({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:m,disableScoreValidation:n,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:r,tournamentRecord:o,disableAutoCalc:a,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:u,schedule:d,event:p,notes:h})}function cae(t){if(!(t!=null&&t.outcomes))return{error:gt};if(!Array.isArray(t.outcomes))return{error:gt,info:{outcomes:t.outcomes}};let e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,o)=>r.includes(o.tournamentId)?r:r.concat(o.tournamentId),[]);for(let r of n){let o=e[r];if(!o)return{error:Ge};let a=i.filter(s=>s.tournamentId===r);if(a.length){let s=ZEe({outcomes:a,tournamentRecord:o});if(s.error)return s}}return{...ae}}function ZEe(t){var a;let{tournamentRecords:e,tournamentRecord:i,outcomes:n,policyDefinitions:r}=t,o={};n.forEach(s=>{let{eventId:l}=s;o[l]||(o[l]=[]),o[l].push(s)});for(let s of Object.keys(o)){let{event:l}=Ta({tournamentRecord:i,eventId:s});for(let c of o[s]){let{drawId:u}=c,d=(a=l==null?void 0:l.drawDefinitions)==null?void 0:a.find(p=>p.drawId===u);if(d&&u){let{matchUpFormat:p,matchUpId:h}=c,f=IP({schedule:c==null?void 0:c.schedule,tournamentRecords:e,policyDefinitions:r,tournamentRecord:i,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...ae}}function XEe({drawDefinition:t,matchUpId:e,outcome:i,matchUp:n}){var r,o;if(!n&&!t)return{error:lt};if(!i)return{error:gt,info:"missing outcome"};if(!n&&!e)return{error:Ba};if(!n){let a=fn({drawDefinition:t,matchUpId:e});if(a.error)return a;n=a.matchUp}return typeof i!="object"||!((r=i.score)!=null&&r.scoreStringSide1)||!((o=i.score)!=null&&o.scoreStringSide2)?{error:Pe}:Ui({element:n,extension:{name:cA,value:i}})}function uae(t){return XEe(t)}function jG(t){var m,g;let e="resetTieFormat",{drawDefinition:i,event:n,uuids:r}=t,o=Ei(t,[{[xd]:!0,[ng]:!0}],e);if(o.error)return o;let a=gP(t,[{[yD]:wf}]);if(a[cv])return a;let s=(m=t.tournamentRecord)==null?void 0:m.tournamentId,{matchUp:l,structure:c}=(a==null?void 0:a.matchUp)??{};if(!(l!=null&&l.tieMatchUps))return se({result:{error:Sa},info:"Must be a TEAM matchUp",stack:e});if(!l.tieFormat)return{...ae};let u=(g=Vo({structure:c,drawDefinition:i,event:n}))==null?void 0:g.tieFormat;if(!u)return se({result:{error:_o},info:"No inherited tieFormat",stack:e});let d=[],p=[],h=[],f=[];for(let v of u.collectionDefinitions){let{matchUpCount:y,collectionId:b}=v;p.push(b);let I=(l.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,S)=>(T.matchUpStatus===Gn?1:0)-(S.matchUpStatus===Gn?1:0)),h.push(...I.slice(0,y)),d.push(...I.slice(3).map(Br));else if(h.push(...I),I.length<y){let T=y-I.length,S=iP({collectionDefinition:v,matchUpsLimit:T,matchUp:l,uuids:r});f.push(...S)}}for(let v of(l==null?void 0:l.tieMatchUps)||[])v.collectionId&&!p.includes(v.collectionId)&&d.push(v.matchUpId);return f.length&&(h.push(...f),Yh({eventId:n==null?void 0:n.eventId,matchUps:f,drawDefinition:i,tournamentId:s})),d.length&&Bp({matchUpIds:d,eventId:n==null?void 0:n.eventId,drawDefinition:i,tournamentId:s}),l&&(l.tieMatchUps=h,l.tieFormatId=void 0,l.tieFormat=void 0,yi({structureId:c==null?void 0:c.structureId,eventId:n==null?void 0:n.eventId,context:e,drawDefinition:i,tournamentId:s,matchUp:l})),{...ae,newMatchUps:f,deletedMatchUpIds:d}}function HG(t){var m,g,v;let{tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}=t,o="resetScorecard";if(!i)return se({result:{error:lt},stack:o});if(!n)return se({result:{error:To},stack:o});if(!oa(n))return se({result:{error:Pe,matchUpId:n},stack:o});let a=Uo({drawDefinition:i}),{matchUps:s}=Tr({nextMatchUps:!0,inContext:!0,drawDefinition:i,matchUpsMap:a}),l=a.drawMatchUps.find(y=>y.matchUpId===n),c=s==null?void 0:s.find(y=>y.matchUpId===n);if(!l||!s)return{error:Ao};if(l.matchUpType!==al)return{error:Sa};let u=ca({inContextDrawMatchUps:s,drawDefinition:i,matchUpId:n}),d=c==null?void 0:c.structureId,{structure:p}=At({drawDefinition:i,structureId:d});if(Object.assign(t,{inContextDrawMatchUps:s,inContextMatchUp:c,matchUpsMap:a,targetData:u,structure:p,matchUp:l}),km(t))return{error:nV};if((m=l.tieMatchUps)!=null&&m.length)for(let y of l.tieMatchUps){let b=bP({matchUpId:y.matchUpId,matchUpTieId:n,winningSide:void 0,removeScore:!0,tournamentRecord:e,drawDefinition:i,event:r});if(b.error)return se({result:b,stack:o})}let h=(g=Bi({tournamentRecord:e,drawDefinition:i,event:r}))==null?void 0:g.appliedPolicies,f=Gp({event:t.event,removeScore:!0,tournamentRecord:e,appliedPolicies:h,drawDefinition:i,matchUpsMap:a,matchUpId:n});if(f.error)return se({result:f,stack:o});if(t.tiebreakReset&&!f.tieFormatRemoved){let y=(v=Vo({drawDefinition:i,structure:p,event:r}))==null?void 0:v.tieFormat;if(l.tieFormat&&y){let{matchUpCountDifference:b,descendantDifferences:I,ancestorDifferences:T,valueDifference:S}=Sp({descendant:l.tieFormat,ancestor:y});if(I.collectionIds.length===1&&!T.collectionIds.length&&!T.groupsCount&&b===1&&S===1){let w=jG({tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r});if(w.error)return w}}}return{...ae}}function dae(t){let e=Ei(t,[{[qc]:!0,[n0]:!0},{[_T]:{[vD]:!1,roundNumbers:!1},[tee]:"At least one must be provided",[Sf]:Xa}]);if(e.error)return e;let i=$ie(t);if(i.error)return i;let{matchUpIds:n}=i,r=jn(al)(t.event.eventType),{tournamentRecord:o,drawDefinition:a,event:s}=t;for(let l of n){if(r){let u=HG({tiebreakReset:!0,tournamentRecord:o,drawDefinition:a,matchUpId:l,event:s});if(u.error||t.removeAssignments&&VG({inheritance:!1,drawDefinition:a,matchUpId:l}).error)return u}let c=bP({winningSide:void 0,removeScore:!0,tournamentRecord:o,drawDefinition:a,matchUpId:l,event:s});if(c.error)return c;if(t.removeAssignments){let u=xG({...t,matchUpId:l});if(u.error)return u}}return{...ae}}function JEe({drawDefinition:t,finishingOrder:e}){var v;if(!t)return{error:lt};let i="setOrderOfFinish";if(!Array.isArray(e))return se({info:Td("finishingOrder"),result:{error:Pe},stack:i});let{completedMatchUps:n,matchUpsMap:r}=v0({inContext:!0,drawDefinition:t}),o=(n==null?void 0:n.map(Br))??[],a=e.map(Br),{matchUpTypes:s,roundNumbers:l,structureIds:c,matchUpTieIds:u}=(n??[]).filter(({matchUpId:y})=>a.includes(y)).reduce((y,b)=>{let{matchUpTieId:I,matchUpType:T,roundNumber:S,structureId:w}=b;return y.matchUpTypes.includes(T)||y.matchUpTypes.push(T),y.roundNumbers.includes(S)||y.roundNumbers.push(S),y.structureIds.includes(w)||y.structureIds.push(w),y.matchUpTieIds.includes(I)||y.matchUpTieIds.push(I),y},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(s.length>1||u.length>1||l.length>1||c.length>1)return se({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Pe},stack:i});let d,p,h={},f=[],m=[];if(!e.every(({orderOfFinish:y,matchUpId:b})=>(f.push(b),y&&m.push(y),h[b]=y,d=o.includes(b),p=y===void 0||Bt(y)&&Math.floor(y)>0,d&&p)))return se({result:{error:d?Pe:kI},info:!d&&"matchUps must be completed"||!p&&"orderOfFinish must be integer > 0 or undefined"||void 0,stack:i});let g=n==null?void 0:n.filter(y=>y.structureId===c[0]&&y.roundNumber===l[0]&&y.matchUpType===s[0]&&y.matchUpTieId===u[0]&&!f.includes(y.matchUpId));for(let y of g??[]){let{orderOfFinish:b}=y||{};if(b){if(!Bt(b))return se({context:{orderOfFinish:b,matchUp:y},result:{error:Pe},stack:i});m.push(b)}}if(OQ(m).length!==m.length||Math.max(...m)>m.length)return se({info:"Values not unique or greater than expected number of values",result:{error:Pe},stack:i});if(c.length){let y=MA({matchUpFilters:{matchUpIds:a},structureId:c[0],drawDefinition:t,matchUpsMap:r});if(y.error)return se({result:y,stack:i});(v=y.completedMatchUps)==null||v.forEach(b=>b.orderOfFinish=h[b.matchUpId])}return{...ae}}function pae(t){return JEe(t)}function hae({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:n,event:r}){var m,g,v,y;if(!t)return{error:Ge};if(!e)return{error:ns};if(typeof i!="string")return{error:Sa};if(!Array.isArray(n))return{error:Pe,lineUps:n};let o="applyLineUps",a=t.participants||[],s=fn({tournamentParticipants:a,inContext:!0,drawDefinition:e,matchUpId:i});if(s.error)return s;if(!s.matchUp)return{error:Ao};let{matchUp:l,structure:c}=s,{drawPositions:u,matchUpType:d}=l;if(d!==sn)return{error:Sa};if(!(u!=null&&u.length))return{error:cD};let p=(m=Vo({matchUp:l,drawDefinition:e,structure:c,event:r}))==null?void 0:m.tieFormat,h={};for(let b of n){if(!Array.isArray(b))return{error:Pe,lineUp:b};let I={},T=[];for(let E of b){if(typeof E!="object")return{error:Pe,lineUpAssignment:E};let{participantId:C,collectionAssignments:M=[]}=E;if(!Array.isArray(M))return{error:Pe,collectionAssignments:M};let N=a.find(A=>A.participantId===C);if(!N)return{error:Jn};if(N.participantType!==si)return{error:_c};let R=(v=(g=l.sides)==null?void 0:g.find(A=>{var _,k;return(k=(_=A.participant)==null?void 0:_.individualParticipantIds)==null?void 0:k.includes(C)}))==null?void 0:v.sideNumber;R&&T.push(R);for(let A of M){if(typeof A!="object")return{error:Pe,collectionAssignment:A};let{collectionId:_,collectionPosition:k}=A,O=(y=p==null?void 0:p.collectionDefinitions)==null?void 0:y.find($=>$.collectionId===_);if(!O)return{error:Pe,collectionId:_};let F=`${_}-${k}`;I[F]||(I[F]=[]);let B=I[F].length;if(jn(kn)(O.matchUpType)&&B||O.matchUpType===an&&B>1)return{info:"Excessive collectionPosition assignments",error:Pe};I[F].push(C)}}let S=Object.values(I);for(let E of S)if(E.length===2){let{participant:C}=zl({tournamentParticipants:a,participantIds:E});if(!C){let M=Pu({participant:{participantType:jt,participantRole:Mo,individualParticipantIds:E},pairOverride:!0,tournamentRecord:t});if(M.error)return M}}let w=os(T),U=(w[1]||0)>(w[2]||0)&&1||(w[2]||0)>(w[1]||0)&&2||void 0,D=Object.keys(h).map(E=>parseInt(E));U&&!D.includes(U)&&(h[U]=b)}if(!Object.keys(h).length)return{error:pV};if(s=fn({drawDefinition:e,matchUpId:i}),s.error)return s;if(!s.matchUp)return{error:Ao};let{matchUp:f}=s;f.sides||(f.sides=[]);for(let b of[1,2]){let I=f.sides.find(S=>S.sideNumber===b),T=h[b];if(T)I?I.lineUp=T:f.sides.push({lineUp:T,sideNumber:b});else continue}return yi({tournamentId:t==null?void 0:t.tournamentId,context:o,drawDefinition:e,matchUp:f}),{...ae}}var M_={};ii(M_,{anonymizeTournamentRecord:()=>Bae,generate:()=>fae,generateEventWithDraw:()=>__,generateOutcome:()=>ZG,generateOutcomeFromScoreString:()=>GG,generateParticipants:()=>UP,generateTournamentRecord:()=>Lae,modifyTournamentRecord:()=>$ae,mutate:()=>Fae});var fae={};ii(fae,{generateEventWithDraw:()=>__,generateOutcome:()=>ZG,generateOutcomeFromScoreString:()=>GG,generateParticipants:()=>UP,generateTournamentRecord:()=>Lae});function GG(t){let{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...LA,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Pe,winningSide:n};let o=r&&HM({scoreString:r}),a={},s=ld({sets:o,matchUpFormat:e}),l=ld({sets:o,reversed:!0,matchUpFormat:e});return n===2?(a.scoreStringSide1=l,a.scoreStringSide2=s):(a.scoreStringSide1=s,a.scoreStringSide2=l),a.sets=HM({scoreString:a.scoreStringSide1}),wt({outcome:{matchUpStatus:i,winningSide:n,score:a}})}function zG({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var o;let r=(((o=e==null?void 0:e[n.matchUpId])==null?void 0:o.matchUpIds)||[]).filter(a=>i.includes(a)).filter(a=>!t[a]);return{dependenciesScheduled:!(r!=null&&r.length),remainingDependencies:r}}function ew({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var c,u,d,p;let{individualParticipantIds:r}=wA(n);i=i??((c=n.schedule)==null?void 0:c.timeAfterRecovery);let o=h=>{t[h]||(t[h]=[]),t[h]=Zt(t[h].concat(...r))},a=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},s=((u=n.winnerTo)==null?void 0:u.matchUpId)||n.winnerMatchUpId;s&&(i&&a(s),o(s));let l=((d=n.loserTo)==null?void 0:d.matchUpId)||n.loserMatchUpId;l&&(i&&a(l),o(l)),(p=n.sidesTo)!=null&&p.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&a(h),o(h))})}function wP({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function QEe({individualParticipantProfiles:t,recoveryValue:e,participantId:i,scheduleTime:n,drawId:r}){t[i].potentialRecovery[r]||(t[i].potentialRecovery[r]=[]),t[i].potentialRecovery[r].push(e),t[i].potentialBookings[r]||(t[i].potentialBookings[r]=[]),t[i].potentialBookings[r].push({timeAfterRecovery:e,scheduleTime:n})}function tU({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:o,recoveryMinutes:a=0,scheduleTime:s,matchUp:l}){var f,m;let c=hn((f=l==null?void 0:l.schedule)==null?void 0:f.endTime),u=c?xa(c,Et(a)):xa(s,Et(n)+Et(a)),d=i&&(c?xa(hn(c),i):xa(s,Et(n)+Et(i))),p=((m=o==null?void 0:o[l.matchUpId])==null?void 0:m.participantIds)||[],h=(l.roundPosition&&t[l.matchUpId]||[]).flat();p.forEach(g=>{wP({individualParticipantProfiles:e,participantId:g});let v=e[g].priorMatchUpType!==l.matchUpType&&d||u;h.includes(g)?QEe({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),ew({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:u,matchUp:l})}function mae({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var u,d,p,h,f;let o,a=(d=(u=r.minutesMap)==null?void 0:u[n])==null?void 0:d.recoveryMinutes,s=(((h=(p=r.minutesMap)==null?void 0:p[n])==null?void 0:h.averageMinutes)||0)+(a||0),l=xa(i,s),c=((f=e==null?void 0:e[n])==null?void 0:f.dependentMatchUpIds)||[];if(c.length){let m=c.reduce((g,v)=>{let y=t[v];if(!y)return g;let b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||mi(y)<mi(g.scheduleTime)?b:g},{});m.scheduleTime&&mi(l)>mi(m.scheduleTime)&&(o=m)}return{scheduledDependent:o}}function eMe(t){let{sides:e,matchUpType:i}=t||{};return(e||[]).map(n=>{var r;return i===an&&(((r=n==null?void 0:n.participant)==null?void 0:r.individualParticipants)||[])||(n==null?void 0:n.participant)&&[n.participant]||[]}).flat()}var SP="DO_NOT_SCHEDULE",gae={DO_NOT_SCHEDULE:SP};function WG({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:o,matchUp:a}){let s=eMe(a).map(({person:h})=>h==null?void 0:h.personId);if(i){let h=((a==null?void 0:a.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);s.push(...h)}let l=s.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===SP&&gd(o,h.date)),c=[],u=a==null?void 0:a.matchUpId,d=pr(hn(r),Wt(o)),p=hn(AV(d,t).toISOString());for(let h of l){let{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function D2({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){let{matchUpType:r}=i,{individualParticipantIds:o}=wA(i),a=(t[i.matchUpId]||[]).filter(s=>!sa(s,o)).flat();[...o,...a].forEach(s=>{if(wP({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){let l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[Ll]?l[Ll]+=n:n>0&&(l[Ll]=n),a.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function tMe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:o,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var m,g;let p=[];i||(r=d==null?void 0:d.filter(v=>{let y=v.schedule||{},b=v.matchUpStatus===Ni;return b&&p.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&fP({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map(Br));let h=Array.isArray(l)?l.includes(c):l,f=h?[]:d.filter(({matchUpId:v})=>i.includes(v));for(let v of f){D2({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});let y=(m=v.schedule)==null?void 0:m.scheduledTime;if(y){a[v.matchUpId]=y;let b=(g=u==null?void 0:u[v.matchUpId])==null?void 0:g.recoveryMinutes;tU({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:o,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:p,dateScheduledMatchUps:r,clearDate:h}}function iMe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:o,clearDate:a,matchUps:s}){let l=Object.keys(r),c=o.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{let p=!a&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),h=[Ni,Pi,or,Us,Go,Oi,mr,Er].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!h}),{matchUpMap:u}=c.reduce((d,p)=>{let{drawId:h,tournamentId:f}=p;return d.matchUpMap[f]||(d.matchUpMap[f]={}),d.matchUpMap[f][h]?d.matchUpMap[f][h].push(p):d.matchUpMap[f][h]=[p],ew({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function R_({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:o,scheduleDate:a,matchUps:s}){if(typeof n!="object")return{error:On};if(!hl(s)&&!Array.isArray(i))return{error:kd};o=o??S_({recoveryMinutes:t,averageMatchUpMinutes:e});let l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{let{scheduleTiming:h}=LD({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{let p=d.schedule;return fP({schedule:p})&&(!a||d.schedule.scheduledDate===a)}));let u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==Ni);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{let{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=UA({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,S=hn(p.scheduledTime),w=xa(S,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:o,startTime:S,courtId:I,endTime:w,venueId:T}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function nMe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:o,tournamentRecord:a,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(a&&!o&&(o={[a.tournamentId]:a}),typeof o!="object"||!Object.keys(o).length)return{error:On};s=s??S_({recoveryMinutes:i,averageMatchUpMinutes:n});let{courts:h,venues:f}=zp({dates:[l],ignoreDisabled:!0,tournamentRecords:o}),m=(h==null?void 0:h.filter(T=>!u||u.includes(T.venueId)))??[];c=c??QI({courts:m,scheduleDate:l,startTime:!0}),p=p??QI({courts:m,scheduleDate:l,endTime:!0});let{bookings:g,dateScheduledMatchUps:v}=R_({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:o,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=MG(y),I=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(as("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function rMe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){let n=[],r=[],o,a,s,l;for(let c of t.filter(Boolean))l||(l=c.hash),(c.hash===l||i)&&(r=r.concat(c.matchUpIds)),c.hash!==l&&!i&&(l=c.hash,n.push({averageMinutes:s,recoveryMinutes:a,roundPeriodLength:o,matchUpIds:r}),r=c.matchUpIds),s=i?e:c.averageMinutes,a=c.recoveryMinutes,o=c.roundPeriodLength;return r.length&&n.push({matchUpIds:r,roundPeriodLength:o,recoveryMinutes:a,averageMinutes:s}),{groupedRounds:n}}function vae({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:o,matchUpDependencies:a,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var b;let m={},g=[],v=[],y=[];for(let I of f){let{rounds:T=[],venueId:S}=I,{scheduledRoundsDetails:w,greatestAverageMinutes:U,orderedMatchUpIds:D,minutesMap:E}=pP({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:T});y.push(...D??[]);let{groupedRounds:C}=rMe({scheduledRoundsDetails:w,greatestAverageMinutes:U,garmanSinglePass:!0}),M,N,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=nMe({averageMatchUpMinutes:(b=C[0])==null?void 0:b.averageMinutes,scheduleDate:Wt(u),venueIds:[I.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));let A=tMe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:M,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:o,matchUpDependencies:a,clearScheduleDates:s,scheduleDate:u,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=A);let{byeScheduledMatchUpDetails:_,clearDate:k}=A;_!=null&&_.length&&v.push(..._);let{matchUpsToSchedule:O,matchUpMap:F}=iMe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:M,matchUpNotBeforeTimes:r,matchUpScheduleTimes:o,orderedMatchUpIds:D,clearDate:k,matchUps:p}),B=h.filter($=>$.venueId===S);m[S]={previousRemainingScheduleTimes:[],courtsCount:B.length,greatestAverageMinutes:U,scheduledRoundsDetails:w,dateScheduledMatchUps:N,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:C,venueCourts:B,minutesMap:E,matchUpMap:F},s||g.push(...M)}return{allDateScheduledByeMatchUpDetails:v,allDateScheduledMatchUpIds:g,venueScheduledRoundDetails:m,allDateMatchUpIds:y}}function oMe(t,e){let i=mi(t.scheduleTime),n=mi(t.timeAfterRecovery),r=mi(e.scheduleTime),o=mi(e.timeAfterRecovery),a=i===r||n===o,s=i>r&&i<o,l=r>i&&r<n,c=n>r&&n<o,u=o>i&&o<n;return wt({hasOverlap:a||s||c||l||u,startAisContained:s,endAisContained:c,startBisContained:l,endBisContained:u},!0)}function qG({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:o}){var p,h,f,m,g;let a=(((p=i==null?void 0:i[r.matchUpId])==null?void 0:p.participantIds)||[]).flat(),s=((f=(h=o==null?void 0:o.minutesMap)==null?void 0:h[r.matchUpId])==null?void 0:f.averageMinutes)||0,l=((g=(m=o==null?void 0:o.minutesMap)==null?void 0:m[r.matchUpId])==null?void 0:g.recoveryMinutes)||0,c=a.every(v=>{var T;wP({individualParticipantProfiles:t,participantId:v});let y=t[v];if(!y.timeAfterRecovery)return!0;let b=hn((T=r==null?void 0:r.schedule)==null?void 0:T.endTime),I=b?xa(b,Et(l)):xa(n,Et(s)+Et(l));return![...Object.keys(y.potentialBookings).filter(S=>S!==r.drawId).map(S=>y.potentialBookings[S]).flat(),...y.bookings].find(S=>oMe({scheduleTime:n,timeAfterRecovery:I},S).hasOverlap)}),u=e[r.matchUpId],d=(u?bD(pr(u),pr(n),!1):0)>=0;return{enoughTime:c&&d}}function YG({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){let{enteredIndividualParticipantIds:r}=wA(n),{matchUpId:o,matchUpType:a}=n,s=(n.roundPosition&&e[o]||[]).flat(),l=Zt(r.concat(...s));return l.forEach(c=>{wP({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{let u=t[c];if(u)return[a,Ll].find(d=>{var f;let p=((f=u.counters)==null?void 0:f[d])||0,h=i[d]||0;return p&&h&&p>=h})}),relevantParticipantIds:l}}function iU({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:o,tournamentRecords:a,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var g,v,y;if(!s)return{error:Ge};if(!l&&(!c||!Array.isArray(c)))return{error:Xw};if(!l&&(!u||typeof u!="object"))return{error:bQ};let d,p=[],h=0;if(n&&!r){let b=nc({tournamentRecords:a,tournamentRecord:s});r=b.matchUpDependencies,d=b.matchUps}d||(d=((g=to({tournamentRecord:s}))==null?void 0:g.matchUps)??[]);let f=d.reduce((b,I)=>{let{matchUpId:T,drawId:S,matchUpStatus:w}=I;return(e||w!==Ni)&&(t||!Nr.includes(w))&&(b[S]?b[S].push(T):b[S]=[T]),b},{}),m=l==null?void 0:l.map(b=>b.matchUpId);for(let b of Object.keys(f)){let{drawDefinition:I}=Ef({tournamentRecord:s,drawId:b});if(!I)continue;let T=f[b].filter(w=>(c==null?void 0:c.includes(w))??(m==null?void 0:m.includes(w))),S=Ia({inContext:!1,drawDefinition:I}).matchUps;for(let w of T){let U=((v=l==null?void 0:l.find(E=>E.matchUpId===w))==null?void 0:v.schedule)||u,D=C_({schedule:U,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:o,inContextMatchUps:d,tournamentRecords:a,tournamentRecord:s,checkChronology:n,drawDefinition:I,drawMatchUps:S,matchUpId:w});if((y=D==null?void 0:D.warnings)!=null&&y.length&&p.push(...D.warnings),D!=null&&D.success&&(h+=1),D.error)return D}}return p.length?{...ae,scheduled:h,warnings:p}:{...ae,scheduled:h}}function TP(t){var f;let{scheduleCompletedMatchUps:e=!1,scheduleByeMatchUps:i=!1,errorOnAnachronism:n,matchUpContextIds:r,removePriorValues:o,tournamentRecords:a,checkChronology:s,matchUpDetails:l,schedule:c}=t;if(t.matchUpIds&&!r)return iU(t);let u=Ei(t,[{[ko]:!0},{[_T]:{matchUpContextIds:!1,matchUpDetails:!1},[fd]:Pe,[Sf]:Xa}]);if(u.error)return u;if((!l||r)&&!c)return{error:gt,info:"schedule is required"};let d=[],p=0,{matchUpDependencies:h}=nc({tournamentRecords:a});for(let m of Object.values(a)){let{tournamentId:g}=m,v=r==null?void 0:r.filter(b=>b.tournamentId===g).map(Br),y=l==null?void 0:l.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){let b=iU({matchUpDetails:y,scheduleCompletedMatchUps:e,scheduleByeMatchUps:i,matchUpDependencies:h,errorOnAnachronism:n,removePriorValues:o,tournamentRecords:a,tournamentRecord:m,checkChronology:s,matchUpIds:v,schedule:c});if((f=b.warnings)!=null&&f.length&&d.push(...b.warnings),b.scheduled&&(p+=b.scheduled),b.error)return b}}return d.length?{...ae,scheduled:p,warnings:d}:{...ae,scheduled:p}}function yae({autoSchedulingAudit:t,tournamentRecords:e}){var a;di({topic:zI,payload:t});let i=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,n=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),r={scheduledDatesCount:(a=t.scheduledDates)==null?void 0:a.length,noTimeMatchUpIdsCount:i(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:i(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:i(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:i(t==null?void 0:t.requestConflicts),profileRoundsCount:n},o={itemType:Toe,itemValue:r};for(let s of Object.values(e))Fy({tournamentRecord:s,timeItem:o})}function aMe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:o,matchUpDependencies:a,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,schedulingProfile:u,personRequests:d,periodLength:p,matchUps:h,courts:f,dryRun:m}){var M,N,R,A,_,k,O;let g={},v={},y={},b={},I={},T={},S={},w={},U={},D={};for(let F of r){let B=Wt(F==null?void 0:F.scheduleDate),$=(F==null?void 0:F.venues)||[],V={},H={},z=(J,ie)=>{J.forEach(oe=>{let ne=H[oe].counters;ne[ie]?ne[ie]+=1:ne[ie]=1,ne[Ll]?ne[Ll]+=1:ne[Ll]=1})};y[B]={},b[B]={},g[B]={},v[B]={},S[B]=[],w[B]=[],U[B]=[],D[B]=[];let G={};h.forEach(J=>{var ie;(ie=J.schedule)!=null&&ie.scheduledDate&&gd(B,Wt(J.schedule.scheduledDate))&&ew({matchUpPotentialParticipantIds:V,matchUpNotBeforeTimes:G,matchUp:J})});let{allDateScheduledByeMatchUpDetails:W,venueScheduledRoundDetails:K,allDateMatchUpIds:Z}=vae({matchUpPotentialParticipantIds:V,individualParticipantProfiles:H,scheduleCompletedMatchUps:i,containedStructureIds:o,matchUpNotBeforeTimes:G,matchUpScheduleTimes:T,matchUpDependencies:a,clearScheduleDates:l,tournamentRecords:c,useGarman:!0,periodLength:p,scheduleDate:B,matchUps:h,courts:f,venues:$}),Y=10,X=0,Q,te=10;for(;!Q;){for(let{venueId:J}of $){let ie=0,oe=K[J];for(;oe.courtsCount&&((M=oe.scheduleTimes)!=null&&M.length)&&((N=oe.matchUpsToSchedule)!=null&&N.length)&&ie<=oe.courtsCount;){let{scheduleTime:ne,attempts:re=0}=oe.scheduleTimes.shift(),me=oe.matchUpsToSchedule.find(he=>{var Ne,Fe;let{matchUpId:be,matchUpType:Se}=he,{participantIdsAtLimit:De,relevantParticipantIds:Oe}=YG({matchUpPotentialParticipantIds:V,individualParticipantProfiles:H,matchUpDailyLimits:s,matchUp:he});if(De.length)return w[B].includes(be)||w[B].push(be),!1;let{scheduledDependent:xe}=mae({matchUpScheduleTimes:T,matchUpDependencies:a,scheduleTime:ne,matchUpId:be,details:oe});if(xe)return!1;let{dependenciesScheduled:$e,remainingDependencies:Ae}=zG({matchUpScheduleTimes:T,matchUpDependencies:a,allDateMatchUpIds:Z,matchUp:he});if(!$e)return b[B][be]||(b[B][be]=[]),b[B][be].push({scheduleTime:ne,remainingDependencies:Ae}),!1;let{enoughTime:ve}=qG({individualParticipantProfiles:H,matchUpNotBeforeTimes:G,matchUpDependencies:a,scheduleTime:ne,details:oe,matchUp:he});if(!ve)return y[B][be]||(y[B][be]=[]),y[B][be].push({scheduleTime:ne}),!1;let ke=oe.greatestAverageMinutes,{conflicts:ye}=WG({potentials:e,averageMatchUpMinutes:ke,requestConflicts:D,personRequests:d,scheduleTime:ne,scheduleDate:B,matchUp:he});if(ye!=null&&ye.length)return I[B]||(I[B]=[]),I[B].push(...ye),!1;z(Oe,Se);let Ie=(Fe=(Ne=oe.minutesMap)==null?void 0:Ne[be])==null?void 0:Fe.recoveryMinutes;return tU({matchUpPotentialParticipantIds:V,individualParticipantProfiles:H,matchUpNotBeforeTimes:G,averageMatchUpMinutes:ke,matchUpDependencies:a,recoveryMinutes:Ie,scheduleTime:ne,matchUp:he}),T[be]=ne,!0});oe.matchUpsToSchedule=oe.matchUpsToSchedule.filter(({matchUpId:he})=>he!==(me==null?void 0:me.matchUpId)),me?ie+=1:(v[B][J]||(v[B][J]=[]),v[B][J].push({scheduleTime:ne,attempts:re+1}))}(R=oe.matchUpsToSchedule)!=null&&R.length&&(v[B][J]=(A=v[B][J])==null?void 0:A.filter(ne=>{let re=ne.attempts<Y;return re&&oe.scheduleTimes.push(ne),!re})),(!((_=oe.scheduleTimes)!=null&&_.length)||!((k=oe.matchUpsToSchedule)!=null&&k.length))&&(oe.complete=!0)}X+=1,Q=$.every(({venueId:J})=>K[J].complete)||X===te}for(let{venueId:J}of $){let ie=K[J].matchUpMap;Object.keys(ie).forEach(oe=>{let ne=c[oe];ne&&Object.keys(ie[oe]).forEach(re=>{let{drawDefinition:me}=Ef({tournamentRecord:ne,drawId:re});me&&ie[oe][re].forEach(({matchUpId:he})=>{let be=T[he];if(be){let Se=be.split(":").map(qs).join(":"),De=`${Wt(B)}T${Se}`;m?S[B].push(he):(Mf({drawDefinition:me,scheduledTime:De,matchUpId:he}).success&&S[B].push(he),J&&E0({tournamentRecord:ne,drawDefinition:me,matchUpId:he,venueId:J}))}})})}),U[B]=K[J].matchUpsToSchedule.map(Br),g[B][J]=K[J].scheduleTimes.sort((oe,ne)=>mi(oe.scheduleTime)-mi(ne.scheduleTime))}!m&&(W!=null&&W.length)&&TP({matchUpDetails:W,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of F.venues)for(let ie of J.rounds){let oe=(((O=ie.matchUps)==null?void 0:O.map(({matchUpId:re})=>re))||[]).filter(re=>S[B].includes(re));ie.canScheduledMatchUpIds=oe;let ne=Math.round(oe.length/ie.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=0),ie.possibleToSchedulePct=ne,ie.matchUpsCount===oe.length&&(ie.possibleToSchedule=!0)}}let E=r.map(({scheduleDate:F})=>F),C={timeStamp:Date.now(),overLimitMatchUpIds:w,scheduledMatchUpIds:S,schedulingProfile:u,noTimeMatchUpIds:U,requestConflicts:D,scheduledDates:E};return yae({tournamentRecords:c,autoSchedulingAudit:C}),{...ae,schedulingProfileModifications:t,schedulingProfileIssues:n,scheduleTimesRemaining:g,dateSchedulingProfiles:r,skippedScheduleTimes:v,recoveryTimeDeferredMatchUpIds:y,dependencyDeferredMatchUpIds:b,matchUpScheduleTimes:T,overLimitMatchUpIds:w,scheduledMatchUpIds:S,noTimeMatchUpIds:U,requestConflicts:D,scheduledDates:E}}function Y6({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:gt,stack:"getEarliestCourtTime"};let o=QI({scheduleDate:r,courts:[n],startTime:!0}),a=QI({scheduleDate:r,courts:[n],endTime:!0});e=e||o,i=i||a;let s=yP({court:n,date:r}),{timeSlots:l}=P0({courtDate:s}),c=pr(e),u=pr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{let h=pr(p.startTime),f=pr(p.endTime);if(h>u||f<c)return d;let m=c>h?c:h;if(bD(m,f)>=t){let g=hn(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:o,courtEndTime:a}}function sMe({schedulingProfileModifications:t,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:n,dateSchedulingProfiles:r,containedStructureIds:o,matchUpDependencies:a,matchUpDailyLimits:s,clearScheduleDates:l,tournamentRecords:c,periodLength:u=30,schedulingProfile:d,personRequests:p,matchUps:h=[],courts:f,dryRun:m}){var C,M;let g={},v={},y={},b={},I={},T={},S={},w={},U={};for(let N of r??[]){let R=Wt(N==null?void 0:N.scheduleDate),A=(N==null?void 0:N.venues)||[],_={},k={},O=(J,ie)=>{J.forEach(oe=>{let ne=k[oe].counters;ne[ie]?ne[ie]+=1:ne[ie]=1,ne[Ll]?ne[Ll]+=1:ne[Ll]=1})};g[R]={},v[R]={},T[R]=[],S[R]=[],w[R]=[],U[R]=[];let F={};h==null||h.forEach(J=>{var ie;(ie=J.schedule)!=null&&ie.scheduledDate&&gd(R,Wt(J.schedule.scheduledDate))&&ew({matchUpPotentialParticipantIds:_,matchUpNotBeforeTimes:F,matchUp:J})});let{allDateScheduledByeMatchUpDetails:B,allDateScheduledMatchUpIds:$,venueScheduledRoundDetails:V,allDateMatchUpIds:H}=vae({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,scheduleCompletedMatchUps:i,containedStructureIds:o,matchUpNotBeforeTimes:F,matchUpScheduleTimes:I,matchUpDependencies:a,clearScheduleDates:l,tournamentRecords:c,periodLength:u,scheduleDate:R,matchUps:h,courts:f,venues:A}),z=h==null?void 0:h.filter(({matchUpId:J})=>$.includes(J)),{bookings:G}=R_({dateScheduledMatchUps:z,tournamentRecords:c,scheduleDate:R,periodLength:u}),{virtualCourts:W}=w_({scheduleDate:R,periodLength:u,bookings:G,courts:f}),K=W==null?void 0:W.reduce((J,ie)=>{let{earliestCourtTime:oe,courtEndTime:ne}=Y6({date:R,averageMinutes:0,court:ie});return(!J.startTime||pr(oe)<pr(J.startTime))&&(J.startTime=oe),(!J.endTime||pr(ne)>pr(J.endTime))&&(J.endTime=ne),J},{}),Z=K.startTime,Y=({courtId:J,booking:ie})=>{var oe;return(oe=W==null?void 0:W.find(ne=>ne.courtId===J))==null?void 0:oe.dateAvailability[0].bookings.push(ie)},X=10,Q=0,te;for(;!te;){for(let{venueId:J}of A){let ie=V[J],oe=ie.matchUpsToSchedule.length,ne=[],re=[],me,he=0;for(;!me;){for(let be of ie.matchUpsToSchedule){if(re.length===ie.courtsCount||ne.length===ie.courtsCount){me=!0;break}let{matchUpId:Se,matchUpType:De}=be,{participantIdsAtLimit:Oe,relevantParticipantIds:xe}=YG({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,matchUpDailyLimits:s,matchUp:be});if(Oe.length){S[R].includes(Se)||S[R].push(Se);continue}let{dependenciesScheduled:$e,remainingDependencies:Ae}=zG({matchUpScheduleTimes:I,matchUpDependencies:a,allDateMatchUpIds:H,matchUp:be});if(!$e){v[R][Se]||(v[R][Se]=[]),v[R][Se].push({remainingDependencies:Ae});continue}let ve=[],ke=W==null?void 0:W.reduce((ye,Ie)=>{var fe,Te,ue,de;if(re.includes(Ie.courtId))return ye;let{earliestCourtTime:Ne}=Y6({averageMinutes:ie.greatestAverageMinutes,startTime:Z,date:R,court:Ie});if(ye.scheduleTime&&mi(Ne)>=mi(ye.scheduleTime))return ye;let{scheduledDependent:Fe}=mae({matchUpScheduleTimes:I,matchUpDependencies:a,scheduleTime:Ne,matchUpId:Se,details:ie});if(Fe)return ye;let{enoughTime:Le}=qG({individualParticipantProfiles:k,matchUpNotBeforeTimes:F,matchUpDependencies:a,scheduleTime:Ne,details:ie,matchUp:be});if(!Le)return g[R][Se]||(g[R][Se]=[]),g[R][Se].includes(Ne)||g[R][Se].push(Ne),ye;let ge=((Te=(fe=ie.minutesMap)==null?void 0:fe[Se])==null?void 0:Te.averageMinutes)||ie.greatestAverageMinutes,{conflicts:Ee}=WG({potentials:e,averageMatchUpMinutes:ge,requestConflicts:U,personRequests:p,scheduleTime:Ne,scheduleDate:R,matchUp:be});if(Ee!=null&&Ee.length)return ve.push(...Ee),!1;O(xe,De);let we=(de=(ue=ie.minutesMap)==null?void 0:ue[Se])==null?void 0:de.recoveryMinutes;return tU({matchUpPotentialParticipantIds:_,individualParticipantProfiles:k,matchUpNotBeforeTimes:F,averageMatchUpMinutes:ge,matchUpDependencies:a,recoveryMinutes:we,scheduleTime:Ne,matchUp:be}),(!ye.scheduleTime||mi(Ne)<mi(ye.scheduleTime))&&(ye.averageMatchUpMinutes=ge,ye.recoveryMinutes=we,ye.scheduleTime=Ne,ye.courtName=Ie.courtName,ye.courtId=Ie.courtId),ye},{});if(ke.scheduleTime){let{averageMatchUpMinutes:ye,recoveryMinutes:Ie,scheduleTime:Ne,courtId:Fe}=ke;I[Se]=Ne,b[Se]=Fe,ne.push(Se),re.push(Fe);let Le=Ne,ge=xa(Le,ye);Y({courtId:Fe,booking:{averageMatchUpMinutes:ye,recoveryMinutes:Ie,periodLength:u,matchUpId:Se,startTime:Le,courtId:Fe,endTime:ge,venueId:J}}),ie.matchUpsToSchedule=ie.matchUpsToSchedule.filter(Ee=>Ee.matchUpId!==Se)}else ve!=null&&ve.length&&(y[R]||(y[R]=[]),y[R].push(...ve))}(re.length===ie.courtsCount||ne.length===ie.courtsCount||!ie.matchUpsToSchedule.length)&&(me=!0),ie.matchUpsToSchedule.length&&ne<ie.courtsCount&&(pr(Z)<pr(K.endTime)?Z=xa(Z,u):(me=!0,ie.complete=!0)),he+=1,!me&&he>=oe&&(me=!0)}(C=ie.matchUpsToSchedule)!=null&&C.length||(ie.complete=!0)}Q+=1,te=A.every(({venueId:J})=>V[J].complete)||Q===X}for(let{venueId:J}of A){let ie=V[J].matchUpMap;Object.keys(ie).forEach(oe=>{let ne=c[oe];ne&&Object.keys(ie[oe]).forEach(re=>{let{drawDefinition:me}=Ef({tournamentRecord:ne,drawId:re});me&&ie[oe][re].forEach(({matchUpId:he})=>{let be=I[he],Se=b[he];if(be){let De=be.split(":").map(qs).join(":"),Oe=`${Wt(R)}T${De}`;m||(Mf({drawDefinition:me,scheduledTime:Oe,matchUpId:he}),Gy({courtDayDate:R,tournamentRecords:c,tournamentRecord:ne,drawDefinition:me,matchUpId:he,courtId:Se})),T[R].push(he)}})})}),w[R]=V[J].matchUpsToSchedule.map(Br)}!m&&(B!=null&&B.length)&&TP({matchUpDetails:B,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:c,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(let J of N.venues)for(let ie of J.rounds){let oe=(M=(ie.matchUps??[]).map(({matchUpId:re})=>re))==null?void 0:M.filter(re=>T[R].includes(re));ie.canScheduledMatchUpIds=oe;let ne=Math.round(((oe==null?void 0:oe.length)||0)/ie.matchUpsCount*1e4)/100;(ne===1/0||isNaN(ne))&&(ne=void 0),ie.possibleToSchedulePct=ne,ie.matchUpsCount===(oe==null?void 0:oe.length)&&(ie.possibleToSchedule=!0)}}let D=(r??[]).map(({scheduleDate:N})=>N),E={timeStamp:Date.now(),overLimitMatchUpIds:S,scheduledMatchUpIds:T,schedulingProfile:d,noTimeMatchUpIds:w,requestConflicts:U,scheduledDates:D};return yae({tournamentRecords:c,autoSchedulingAudit:E}),{...ae,schedulingProfileModifications:t,schedulingProfileIssues:n,dateSchedulingProfiles:r,recoveryTimeDeferredMatchUpIds:g,dependencyDeferredMatchUpIds:v,matchUpScheduleTimes:I,overLimitMatchUpIds:S,scheduledMatchUpIds:T,noTimeMatchUpIds:w,requestConflicts:U,scheduledDates:D}}function N_(t){let{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=Nr,scheduledDates:n,venueIds:r}=t,o=Ou(t),a=ln(o)?Object.values(o).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(a!=null&&a.length))return{error:On};let s=0;for(let l of a){let c=o[l],u=lMe({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:c,scheduledDates:n,venueIds:r});if(u.error)return u;s+=u.clearedScheduleCount??0}return{...ae,clearedScheduleCount:s}}function lMe({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=Nr,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:Ge};if(!Array.isArray(e)||!Array.isArray(r))return{error:Pe};r.length&&t.push("venueId");let o=to({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[],a={};o.forEach(({matchUpStatus:c,schedule:u,drawId:d,matchUpId:p})=>{(!c||!e.includes(c))&&fP({schedule:u,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(u.venueId))&&(a[d]||(a[d]=[]),a[d].push(p))});let s=i.tournamentId,l=0;for(let c in a){let{event:u,drawDefinition:d}=Ta({tournamentRecord:i,drawId:c}),p=Ia({drawDefinition:d,matchUpFilters:{matchUpIds:a[c]}}).matchUps??[];for(let h of p){let f=!1;h.timeItems=(h.timeItems??[]).filter(m=>{let g=(m==null?void 0:m.itemType)&&![Ip,Mm,h0,f0,m0].includes(m==null?void 0:m.itemType);return g||(f=!0),g}),f&&(yi({context:"clear schedules",eventId:u==null?void 0:u.eventId,drawDefinition:d,tournamentId:s,matchUp:h}),l+=1)}}return{...ae,clearedScheduleCount:l}}function A_(t){let{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:o,periodLength:a,useGarman:s,dryRun:l,pro:c}=t,u=Ei(t,[{[ko]:!0},{[yc]:D=>!D||Array.isArray(D)&&D.every(ws),[KQ]:!1,[Sf]:Xa}]);if(u.error)return u;let d=Wp({tournamentRecords:o});if(d.error)return d;if(!d.schedulingProfile.length)return{...ae};let{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(o).map(D=>p0({tournamentRecord:D}).containedStructures)),g=r.map(D=>{if(ws(D))return Wt(D)}).filter(Boolean),v=f.map(D=>D.scheduleDate).map(D=>ws(D)&&Wt(D)).filter(D=>D&&(!r.length||g.includes(D)));if(!v.length)return{error:KJ};if(n&&!l){let D=Array.isArray(n)?n:[];N_({tournamentRecords:o,scheduledDates:D})}let y=zp({ignoreDisabled:!1,tournamentRecords:o}).courts,{matchUps:b}=xc({matchUpFilters:{matchUpTypes:[kn,an]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:o}),{matchUpDependencies:I}=nc({includeParticipantDependencies:!0,tournamentRecords:o,matchUps:b}),{matchUpDailyLimits:T}=f_({tournamentRecords:o}),{personRequests:S}=vg({requestType:SP,tournamentRecords:o}),w=f.filter(D=>{let E=Wt(D==null?void 0:D.scheduleDate);return v.includes(E)}).sort((D,E)=>new Date(D.scheduleDate).getTime()-new Date(E.scheduleDate).getTime()),U={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:w,containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:o,schedulingProfile:f,personRequests:S,periodLength:a,useGarman:s,matchUps:b,dryRun:l,courts:y};return c?sMe(U):aMe(U)}function bae(t){let e=t||{};return e.tournamentId||(e.tournamentId=ji()),e.startDate&&!Um(e.startDate)&&!yM.test(e.startDate)?{error:aa}:e.endDate&&!Um(e.endDate)&&!yM.test(e.endDate)?{error:aa}:(e.extensions&&(e.extensions=e.extensions.filter(Iu)),{...e})}function KG({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:o,uuids:a}){var f,m;if(!i)return{error:Ge};let s={},l=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===si&&v===Mo),c=0;for(let g of l){let v=o&&((f=dv({element:g,accessor:o}))==null?void 0:f.value)||n&&((m=g.person)==null?void 0:m[n])||e&&g[e];if(v){if(!Object.keys(s).includes(v)){s[v]={participantName:(r==null?void 0:r[c])??v,participantId:(a==null?void 0:a.pop())??ji(),individualParticipantIds:[],participantRole:Mo,participantType:en};let y={value:n??e,name:jF};Ui({element:s[v],extension:y}),c+=1}s[v].individualParticipantIds.push(g.participantId)}}let u=Object.keys(s),d=(i.participants??[]).map(g=>{if(g.participantType!==en||g.participantRole!==Mo)return;let{extension:v}=Qt({name:jF,element:g}),y=v==null?void 0:v.value;if(u.includes(y))return g.participantId}).filter(Boolean),p=0,h=[];return Object.keys(s).forEach(g=>{let v=s[g],{participantId:y}=v;d.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),h.push(v),p++)}),t&&p?(di({payload:{tournamentId:i.tournamentId,participants:h},topic:qh}),{...ae,participantsAdded:p}):h.length?{...ae,newParticipants:h}:{error:k0e}}var cMe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],uMe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function Iae({count:t=1,participantsCount:e=32}={}){let i=Jo(uMe),n=i.slice(0,t);return{cities:it(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Ja(n))}}function wae({count:t=1,participantsCount:e=32}={}){let i=Jo(cMe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:it(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Ja(n))}}function Sae({count:t=1,participantsCount:e=32}={}){let i=it(0,t).map(()=>it(0,5).map(()=>$s(0,9)).join(""));return{postalCodes:it(0,e).map(n=>n<t?i[n]:Ja(i))}}function Tae(t){let{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:o}=t;return{postalCode:n==null?void 0:n[o],state:i==null?void 0:i[o],city:e==null?void 0:e[o],countryCode:r}}var dMe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function LO(t){let{count:e=100,sex:i}=t||{};if(!e||i&&![nn,Un].includes(i))return{personData:[],error:Pe};let n=Math.ceil(e*1.3),{lastNames:r,firstFemale:o,firstMale:a}=dMe,s=_h.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/o.length),u=Math.ceil(n/a.length),d=it(0,l).flatMap(()=>{let m=dt(r,!1,!0);return it(0,r.length).map(()=>Qa(m))}),p=it(0,c).flatMap(()=>{let m=dt(o,!1,!0);return it(0,o.length).map(()=>Qa(m))}),h=it(0,u).flatMap(()=>{let m=dt(a,!1,!0);return it(0,a.length).map(()=>Qa(m))}),f={};for(let m=0;m<n;m++){let g=d.pop(),v=i||Ja([nn,Un]),y=v===nn?h.pop():p.pop(),b=Ja(s);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function Uae(t){let e=(t==null?void 0:t.count)||1,{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:o,personData:a,category:s,sex:l}=t||{};if(isNaN(e))return{error:Pe};let c=(o==null?void 0:o[nn])||l===nn&&e||0,u=(o==null?void 0:o[Un])||l===Un&&e||0;e=Math.max(e,c+u);let d=e-(c+u),p=c&&LO({count:c,sex:nn}).personData||[],h=u&&LO({count:u,sex:Un}).personData||[],f=[...p,...h,...d&&LO({count:d}).personData||[]],m=f.filter(U=>!l||c&&u||U.sex===l),g=[];if(Array.isArray(a)){let U=a.filter(D=>typeof D.firstName!="string"||typeof D.lastName!="string"||D.sex&&![nn,Un].includes(D.sex)||D.nationalityCode&&(typeof D.nationalityCode!="string"||D.nationalityCode.length>3||!_h.find(({iso:E,ioc:C})=>[E,C].includes(D.nationalityCode)))?!1:(D.nationalityCode&&g.push(D.nationalityCode),!0));if(U.length)m=U;else return{error:Pe}}let v=a?m:Jo(m);if(v.length<e){let{maleFirstNames:U,maleLastNames:D,femaleFirstNames:E,femaleLastNames:C,nationalityCodes:M}=f.reduce((N,R)=>{let{firstName:A,lastName:_,nationalityCode:k}=R;return R.sex===nn?(N.maleFirstNames.includes(A)||N.maleFirstNames.push(A),N.maleLastNames.includes(_)||N.maleLastNames.push(_)):(N.femaleFirstNames.includes(A)||N.femaleFirstNames.push(A),N.femaleLastNames.includes(_)||N.femaleLastNames.push(_)),N.nationalityCodes.includes(k)||N.nationalityCodes.push(k),N},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});it(0,e-v.length).forEach(()=>{let N=l||Ja([nn,Un]),R=Ja(M),A=Ja(N===nn?U:E),_=Ja(N===nn?D:C),k={firstName:A,lastName:_,sex:N,nationalityCode:R};v.push(k)})}let{ageMinDate:y,ageMaxDate:b}=rP({consideredDate:n,category:s}),I=Et((y==null?void 0:y.slice(0,4))||0)||Et((b==null?void 0:b.slice(0,4))||0)-3,T=Et((b==null?void 0:b.slice(0,4))||0)||Et((y==null?void 0:y.slice(0,4))||0)+3,S=(y||b)&&[I,T],w=v.slice(0,e).map((U,D)=>{let[E,C]=S||[],M=S&&Qa(it(E,C)),N=Qa(it(0,365)),R=M&&zSe(M,N);return Object.assign(wt({extensions:i||[{name:"regionCode",value:D+1}],birthDate:R,isMock:r}),U)});return{persons:w.length&&w||v[0],nationalityCodes:g}}var pMe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function P2({nameRoot:t="TEAM",count:e=1}={}){let i=Jo(pMe).slice(0,e);return i.length<e&&it(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function C2({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===si?"I":"P"}-${i}`:(n==null?void 0:n.pop())||ji()}function UP(t){let{rankingRange:e,scaledParticipantsCount:i}=t,{ratingsParameters:n=vs,valuesInstanceLimit:r,consideredDate:o,category:a,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:c,participantsCount:u=32,participantType:d,personIds:p,idPrefix:h,uuids:f,personExtensions:m,addressProps:g,gendersCount:v,matchUpType:y,personData:b,sex:I,inContext:T,withISO2:S,withIOC:w,scaleAllParticipants:U}=t,D=d===jt||y===Cm,E=d===en||y===en;e&&(!Array.isArray(e)||!e.every(he=>Bn(he))||e.length!==2)&&(e=void 0),i=U?u:i;let C=1e3,M=i&&i>C?i:C;e=e||[1,M],e[1]+=1;let N=u*(D?2:E?8:1),R=Uae({count:N,personExtensions:m,consideredDate:o,gendersCount:v,personData:b,category:a,sex:I});if(R.error)return R;let{nationalityCodes:A,persons:_}=R,k=[],O=[],F=[],B=[];if(typeof a=="object"){let{categoryName:he,ageCategoryCode:be,ratingType:Se}=a;if((he||be)&&!Se){let[De,Oe]=e||[];if(O=Jo(it(De,Oe)).slice(0,i||$s(20,30)),[jt,en].includes(d)){let[xe,$e]=e||[];k=Jo(it(xe,$e)).slice(0,i||$s(20,30))}}if(Se&&n[Se]){let{ratingMax:De,ratingMin:Oe,ratingAttributes:xe}=a,$e={...n[Se],...xe||{}},{attributes:Ae={},decimalsCount:ve,accessors:ke,range:ye,step:Ie}=$e,Ne=we=>{let fe={},Te=Object.keys(we||{});for(let ue of Te){let de=we[ue];if(typeof de=="object"&&de.generator){let{range:_e}=de,[Ue,Ce]=_e.slice().sort();fe[ue]=$s(Ue,Ce)}else fe[ue]=de}return fe},Fe=ye[0]>ye[1]?2:.5,[Le,ge]=ye.slice().sort(),Ee=()=>it(0,2e3).map(()=>kQ(Le,ge,Fe,Ie,ve)).filter(we=>(!De||we<=De)&&(!Oe||we>=Oe)).slice(0,i||$s(20,30)).map(we=>ke?Object.assign({},...ke.map(fe=>({[fe]:we})),Ne(Ae)):we);F=Ee(),[jt,en].includes(d)&&(B=Ee())}}let $=_h.filter(he=>l==="IOC"&&he.ioc||he.iso);function V(he){let be=Math.ceil(N/he);return r&&be>r?Math.ceil(N/r):he}let{postalCodesProfile:H,postalCodesCount:z,statesProfile:G,citiesProfile:W,citiesCount:K,statesCount:Z}=g||{},Y=he=>Object.keys(he).map(be=>it(0,G[be]).map(()=>be)).flat(),X=W&&Y(W)||(g==null?void 0:g.cities)||Iae({count:K||N,participantsCount:N}).cities,Q=G&&Y(G)||(g==null?void 0:g.states)||wae({count:Z||N,participantsCount:N}).states,te=H&&Y(H)||(g==null?void 0:g.postalCodes)||Sae({count:z||N,participantsCount:N}).postalCodes,J={cities:X,states:Q,postalCodes:te},ie=V(s),oe=ie?Jo($).slice(0,s):c?$.filter(he=>c.includes(he.iso)):$,ne=Jo(it(0,Math.ceil(N/(ie||1))).map(()=>oe).flat(1/0)),re=P2({count:u}).names;return{participants:it(0,u).map(he=>{let be=D?2:E?8:1,Se=it(0,be).map(Ae=>{let ve=he*be+Ae;return me(ve)}),De=Se.map(Ae=>Ae.participantId),Oe=Se.map(Ae=>Ae.person.standardFamilyName).join("/"),xe=D?jt:en,$e={participantId:C2({participantType:xe,idPrefix:h,index:he,uuids:f}),participantRole:Mo,participantName:D?Oe:re[he],individualParticipantIds:De,participantType:xe};return T&&($e.individualParticipants=Se),D||E?[$e,...Se]:Se}).flat(),...ae};function me(he){let be=_[he],{nationalityCode:Se,participantExtensions:De,participantTimeItems:Oe,extensions:xe,firstName:$e,birthDate:Ae,lastName:ve,personId:ke,sex:ye}=be||{},Ie=$e||"GivenName",Ne=ve||"FamilyName",Fe=`${Ie} ${Ne}`,Le=ne[he],ge=(A==null?void 0:A.length)&&Se||Le&&(l==="IOC"?Le.ioc||Le.iso:Le.iso||Le.ioc)||Se;ne!=null&&ne.length&&!ge&&!Se&&console.log("%c Invalid Nationality Code",{participantIndex:he,country:Le});let Ee=Tae({...J,participantIndex:he,nationalityCode:ge}),we=wt({participantId:C2({participantType:si,index:he,idPrefix:h,uuids:f}),extensions:De,timeItems:Oe,participantRole:Mo,participantType:si,participantName:Fe,person:{addresses:[Ee],personId:ke||(p==null?void 0:p.length)&&p[he]||ji(),standardFamilyName:Ne,standardGivenName:Ie,nationalityCode:ge,extensions:xe,birthDate:ws(Ae)?Ae:void 0,sex:ye}});if(w&&ge){let fe=_h.find(({iso:Te})=>Te===ge);fe!=null&&fe.ioc&&(we.person.iocNationalityCode=fe.ioc),fe!=null&&fe.label&&(we.person.countryName=fe.label)}if(S&&ge){let fe=_h.find(({iso:Te})=>Te===ge);fe!=null&&fe.iso2&&(we.person.iso2NationalityCode=fe.iso2),fe!=null&&fe.label&&(we.person.countryName=fe.label)}if(a){let fe=O[he],Te=k[he];w1({scaleValue:fe,eventType:Bv,scaleType:Gh,participant:we,category:a}),w1({scaleValue:Te,eventType:Zh,scaleType:Gh,participant:we,category:a});let ue=F[he],de=B[he];w1({scaleValue:ue,eventType:Bv,scaleType:fm,participant:we,category:a}),w1({scaleValue:de,eventType:Zh,scaleType:fm,participant:we,category:a})}return we}}function w1({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){let o=r.categoryName||r.ratingType||r.ageCategoryCode,a=[_v,n,i,o].join("."),s={itemValue:t,itemType:a};o&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(s))}function Dae({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:n}){var h;let r=0,o=0,a=0,s=0,l={},c={[nn]:0,[Un]:0,[ts]:0,[Qg]:0,[Tu]:0};i=typeof i=="object"?i:Gv({namedFormat:e}),(h=i==null?void 0:i.collectionDefinitions)==null||h.filter(Boolean).forEach(f=>{let{category:m,collectionId:g,matchUpType:v,matchUpCount:y,gender:b}=f;if([nn,Un].includes(b)){let I=y*(v===an?2:1);c[b]<I&&(c[b]=I)}else b===ts&&(c[nn]<y&&(c[nn]=y),c[Un]<y&&(c[Un]=y));if(m){let I=JSON.stringify(m);l[I]=m}if(g||(f.collectionId=ji()),jn(an)(v)){let I=y;s+=y,r=Math.max(r,I)}if(jn(kn)(v)){let I=y;a+=y,o=Math.max(o,I)}});let u=Object.keys(l).length?Math.max(a,s*2):Math.max(o,r*2),d=r*(n+t),p=o*(n+t);return{maxDoublesDraw:d,maxSinglesDraw:p,teamSize:u,genders:c}}function hMe({participantsProfile:t,eventProfiles:e,drawProfiles:i}){let{participantsCount:n,participantType:r=si}=t||{},o=n||0,a={[Un]:0,[ts]:0,[Qg]:0,[nn]:0,[Tu]:0},s=0,l=0,c=0,u=0,d=0,p=({alternatesCount:f=0,uniqueParticipants:m,tieFormatName:g,drawSize:v=0,eventType:y,tieFormat:b,category:I,gender:T,stage:S})=>{let w=y===Gl,U=y===Or,D=!!(m||S===Tt||I||T);if(U){u=Math.max(u,v+f),b=typeof b=="object"?b:Gv({namedFormat:g});let{teamSize:E,maxDoublesDraw:C,maxSinglesDraw:M,genders:N}=Dae({alternatesCount:f,tieFormatName:g,tieFormat:b,drawSize:v});c=Math.max(c,E),l=Math.max(l,M),D||(s=Math.max(s,C)),Object.keys(N).forEach(R=>a[R]+=N[R])}else if(w)if(D){let E=(v+f)*2;d+=E,T&&(a[T]+=E)}else v+f&&v+f>s&&(s=v+f);else if(D){let E=v+f;T&&(a[T]+=E),d+=E}else v&&v>l&&(l=v+f)};if(e==null||e.forEach(f=>{let{tieFormatName:m,tieFormat:g,drawProfiles:v,eventType:y,category:b,gender:I}=f;if(v)for(let T of v){let{tieFormatName:S,tieFormat:w}=T;p({...T,tieFormatName:S||m,tieFormat:w||g,eventType:y,category:b,gender:I})}}),Array.isArray(i))for(let f of i)p(f);let h=Math.max(u*c,s*2,l);return s&&(r=jt),(n||o)<h&&(n=h),n&&s&&[jt,Or].includes(r)&&(l&&Math.floor(l/2)>s?n=Math.floor(l/2):(!l||s*2>=l)&&(n=Math.ceil(n/2))),n===void 0&&(n=!(e!=null&&e.length)&&!(i!=null&&i.length)?32:0),n<o&&(n=o),{uniqueParticipantsCount:d,participantsCount:n,largestTeamDraw:u,largestTeamSize:c,participantType:r,gendersCount:a}}function Pae({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:o}){let{participantsCount:a,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=hMe({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=UP({uuids:o,...t,consideredDate:r,participantsCount:a,participantType:s,gendersCount:u}).participants,h=0,f=Oc({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){let y=KG({tournamentRecord:e,...d});if(y.error)return y}let m=p.filter(({participantType:y})=>y===si).map(ai),g=t!=null&&t.idPrefix?`${en}-${t.idPrefix}`:void 0,v=it(0,l).map(y=>{let b=m.slice(y*c,(y+1)*c),I=C2({index:y,participantType:s,idPrefix:g,uuids:o});return{participantName:`Team ${y+1}`,participantRole:Mo,individualParticipantIds:b,participantType:en,participantId:I}});return f=Oc({participants:v,tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...ae})}function Cae({drawProfiles:t,category:e,gender:i}){let n={},r=t==null?void 0:t.reduce((a,s)=>{let{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=ut,drawSize:p=0}=s||{};Object.keys(a).includes(d)||(a[d]=0);let h=(c||p)-l;return u||i||e||d===Tt?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):a[d]=Math.max(a[d],h),a},{}),o=Object.keys(n);return o.forEach(a=>r[a]+=n[a]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:o}}function Eae({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){let r=e[ut]||0,o=e[Tt]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:a})=>a===i).filter(({participantId:a})=>!t.includes(a)).slice(0,o),MAIN:n.filter(({participantType:a})=>a===i).filter(({participantId:a})=>!t.includes(a)).slice(o,o+r)}}}var fMe={[Oi]:2,[mr]:1,[Er]:1,[Go]:1,[Pi]:4};function ZG(t){let{defaultWithScorePercent:e=2,winningSide:i}=t,{matchUpStatusProfile:n=fMe,matchUpFormat:r=Ks,pointsPerMinute:o=1,sideWeight:a=4}=t;if(!ls({matchUpFormat:r}))return{error:Z$};if(typeof n!="object")return{error:Pe};if(e>100&&(e=100),isNaN(e)||isNaN(o)||isNaN(a))return{error:Pe};let s=Object.keys(n).filter(U=>Object.keys(KV).includes(U)&&U!==or);if(Object.keys(s).reduce((U,D)=>U+n[D],0)>100)return{error:Pe,matchUpStatusProfile:n};let l=s.reduce((U,D)=>(U.pointer=U.pointer+n[D],U.valueMap.push([U.pointer,D]),U),{pointer:0,valueMap:[]}),c=$s(1,100),u=(l.valueMap.find(U=>c<=U[0])??[100,or])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Oi,Pi].includes(u)){i=i||$s(1,2);let U={score:d,winningSide:i,matchUpStatus:u};if(!(u===Pi&&$s(1,100)>100-e))return{outcome:U}}else if([mr,Er].includes(u))return{outcome:{score:d,matchUpStatus:u}};let p=Pa(r),{bestOf:h,setFormat:f,finalSetFormat:m}=p??{},g=[],v=$s(0,1),y=i?[i-1]:[...it(0,a).map(()=>v),1-v],b=[Go,Pi,wu,Df].includes(u)&&(Qa(it(1,h))||1),I;for(let U of it(1,(h??0)+1)){let D=U===h,{set:E,incomplete:C,winningSideNumber:M}=mMe({incomplete:b===U,matchUpStatus:u,pointsPerMinute:o,setFormat:D&&m||f,setNumber:U,weightedRange:y});if(g.push(E),C){I=M;break}if(eU({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}let T=eU({matchUp:{score:{sets:g},matchUpFormat:r}}),S=I?i||I:T.calculatedWinningSide,{score:w}=lae({score:{sets:g},winningSide:S,matchUpStatus:u});return{outcome:{score:w,winningSide:S,matchUpStatus:u}}}function mMe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:o}){let a={setNumber:o},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=$s(0,t.length-1),f=t[h],m;if(d){let g=p*e,v=Math.round(g*.2),y=g+Qa([1,-1])*v,b=rSe(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let T=I[0]>I[1]&&1||I[1]>I[0]&&2||0;if(n){let[U,D]=I;return Object.assign(a,{side1Score:U,side2Score:D}),Nr.includes(i)?{set:a,incomplete:n,winningSideNumber:m}:{set:a,incomplete:n}}T||(I[$s(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();let[S,w]=I;return Object.assign(a,{side1Score:S,side2Score:w,winningSide:m}),{set:a}}else{if(n)return a.side1Score=$s(0,c),a.side2Score=$s(0,c),Nr.includes(i)&&(m=t[h]+1),{set:a,incomplete:n,winningSideNumber:m};{let g=it(1,s+1).map(w=>it(0,s+2-w).map(()=>w)).flat(),v=g[$s(0,g.length-1)],y=s&&kH({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();let[w,U]=y;Object.assign(a,{side1Score:w,side2Score:U})}let T=JT({matchUpScoringFormat:{setFormat:r},setObject:a}),S;if(T.hasTiebreakCondition||b){let{NoAD:w,tiebreakTo:U}=l||u||{},D=it(1,U+1).map(M=>it(0,U+2-M).map(()=>M)).flat(),E=D[$s(0,D.length-1)],C=t_({isSide1:!0,tiebreakNoAd:w,tiebreakTo:U,lowValue:E});if(C)if(b){let M=C[0]>C[1]?1:2;I?M!==I&&C.reverse():f&&C.reverse(),[a.side1TiebreakScore,a.side2TiebreakScore]=C,S=C[0]>C[1]&&1||C[1]>C[0]&&2||void 0}else T.leadingSide===2?[a.side1TiebreakScore,a.side2TiebreakScore]=C:[a.side2TiebreakScore,a.side1TiebreakScore]=C}a.winningSide=T.winningSide||T.leadingSide||I||S}}return{set:a}}function qM(t){var m,g,v;let{matchUpStatusProfile:e,completeAllMatchUps:i,randomWinningSide:n,tournamentRecord:r,completionGoal:o,drawDefinition:a,event:s}=t;if(!a)return{error:lt};let l=t.matchUpFormat||a.matchUpFormat||(s==null?void 0:s.matchUpFormat),c=a.structures.slice().sort(Ey),u=0,{matchUps:d,matchUpsMap:p}=Tr({contextFilters:{stages:[ut,Tt]},matchUpFilters:{matchUpTypes:[sn],roundNumbers:[1]},inContext:!0,drawDefinition:a});if(d!=null&&d.length){let y=((m=s==null?void 0:s.category)==null?void 0:m.ageCategoryCode)||((g=s==null?void 0:s.category)==null?void 0:g.categoryName);if(y){let b=Voe({singlesOnly:!0,tournamentRecord:r,drawDefinition:a,scaleAccessor:{scaleName:y,sortOrder:Boe,scaleType:Gh},event:s});if(b.error)return b;let{lineUps:I,participantsToAdd:T}=b;Oc({tournamentRecord:r,participants:T}),Ui({element:a,extension:{name:fp,value:I}})}else{let b=(v=d[0])==null?void 0:v.structureId,{positionAssignments:I}=Yi({drawDefinition:a,structureId:b});if(I!=null&&I.length){let{participants:T}=zn({participantFilters:{participantTypes:[sn]},tournamentRecord:r}),S=w=>{let U=w.tieMatchUps.filter(jn(kn)),D=w.tieMatchUps.filter(jn(an));U.forEach((E,C)=>{let M=E.matchUpId;E.sides.forEach(N=>{var _;let{drawPosition:R}=N,A=T==null?void 0:T.find(k=>{var F;let{participantId:O}=k;return((F=I.find(B=>B.participantId===O))==null?void 0:F.drawPosition)===R});if(A){let k=(_=A.individualParticipantIds)==null?void 0:_[C];k&&WM({teamParticipantId:A.participantId,participantId:k,tournamentRecord:r,drawDefinition:a,tieMatchUpId:M,event:s})}})}),D.forEach((E,C)=>{let M=E.matchUpId;E.sides.forEach(N=>{var _,k;let{drawPosition:R}=N,A=T==null?void 0:T.find(O=>{var B;let{participantId:F}=O;return((B=I.find($=>$.participantId===F))==null?void 0:B.drawPosition)===R});A&&((k=(_=A.individualParticipantIds)==null?void 0:_.slice(C*2,C*2+2))==null||k.forEach(O=>{WM({teamParticipantId:A.participantId,participantId:O,tournamentRecord:r,drawDefinition:a,tieMatchUpId:M,event:s})}))})})};d.forEach(S)}}}let h=typeof i=="string"&&i,f=h&&or;for(let y of c){if(u>=o)break;let{matchUps:b}=_i({matchUpFilters:{matchUpTypes:[an,kn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:a,matchUpsMap:p,structure:y,event:s}),I=b.filter(({winningSide:T})=>!T).sort(_y).map(Br);for(let T of I){if(!isNaN(o)&&u>=o)break;let{matchUps:S}=_i({matchUpFilters:{matchUpTypes:[an,kn]},afterRecoveryTimes:!1,tournamentRecord:r,inContext:!0,drawDefinition:a,matchUpsMap:p,structure:y,event:s}),w=S.find(D=>D.matchUpId===T),U=[mr,Er].includes(w.matchUpStatus);if(w!=null&&w.readyToScore&&!U){let D=gMe({winningSide:!n&&1,matchUpStatusProfile:e,tournamentRecord:r,drawDefinition:a,targetMatchUp:w,matchUpFormat:l,matchUpStatus:f,scoreString:h,event:s});if(D!=null&&D.error)return D;u+=1}}}return{...ae,completedCount:u}}function Mae(t){let{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:o,matchUpStatus:a,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!o||o.matchUpStatus===Ni)return;let{matchUpId:d}=o||{},{outcome:p}=GG({matchUpFormat:s,matchUpStatus:a,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),IP({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function gMe(t){let{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:o,matchUpFormat:a,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||o)return Mae(t);let{matchUpId:d}=s||{},{outcome:p}=ZG({matchUpStatusProfile:e,matchUpFormat:a,winningSide:c});return IP({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:a,matchUpId:d,outcome:p,event:u})}function Rae({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:o}){var f,m,g,v;let a=Kn({event:o}).flightProfile,{eventName:s,eventType:l,category:c}=o,{startDate:u}=n,d=[],p=(c==null?void 0:c.categoryName)||(c==null?void 0:c.ageCategoryCode)||(c==null?void 0:c.ratingType),h=(f=o.drawDefinitions)==null?void 0:f.map(({drawId:y})=>y);if(Array.isArray(a==null?void 0:a.flights))for(let[y,b]of a.flights.entries()){let{drawId:I,stage:T,drawName:S,drawEntries:w}=b;d.push(b.drawId);let U=r[y],{seedsCount:D,generate:E=!0}=U||{};if(E){let C=w.filter(as(hd)).map(as(hd)),M=p||s;if(n&&D&&D<=C.length&&it(1,D+1).forEach((k,O)=>{let F={scaleValue:k,scaleName:M,scaleType:rd,eventType:l,scaleDate:u},B=C[O];XI({tournamentRecord:n,participantId:B,scaleItem:F})}),h==null?void 0:h.includes(I))break;let N=m_({...U,matchUpType:l,seedingScaleName:M,tournamentRecord:n,isMock:!0,drawEntries:w,drawName:S,drawId:I,event:o,stage:T});if(N.error)return{error:N.error,drawIds:[]};let{drawDefinition:R}=N;if(!R)return{error:ns};let A=(m=r[y])==null?void 0:m.drawExtensions;if(Array.isArray(A)&&A.filter(Iu).forEach(k=>Ui({element:R,extension:k})),N=y_({suppressNotifications:!0,tournamentRecord:n,drawDefinition:R,event:o}),N.error)return{error:N.error,drawIds:[]};if(U!=null&&U.withPlayoffs){let k=(g=R.structures)==null?void 0:g[0].structureId,O=jA({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:n,drawDefinition:R,isMock:!0,structureId:k,event:o});if(O!=null&&O.error)return O}let _=U==null?void 0:U.completionGoal;if((U==null?void 0:U.automated)!==!1&&(e||_)){let k=U==null?void 0:U.matchUpFormat,O=qM({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:R,matchUpFormat:k,event:o});if(O.error)return{error:O.error,drawIds:[]};let F=O.completedCount;if((U==null?void 0:U.drawType)===Id){let B=(v=R.structures)==null?void 0:v.find(H=>H.stage===ut);if(!B)return{error:Nn};let $=JD({structureId:B.structureId,tournamentRecord:n,drawDefinition:R,event:o});if($.error)return{error:$.error,drawIds:[]};let V=_?_-(F??0):void 0;if($=qM({completeAllMatchUps:!_&&e,completionGoal:_?V:void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:R,matchUpFormat:k,event:o}),$.error)return{error:$.error,drawIds:[]}}}}}return{...ae,drawIds:d}}function Nae(t){var S,w;let{participantsProfile:e={},uniqueParticipantsCount:i,ratingsParameters:n,tournamentRecord:r,eventProfile:o,eventIndex:a,event:s,uuids:l}=t,{category:c,gender:u,eventType:d}=s,p=jn(Sd)(d)&&si||jn(Gl)(d)&&jt||d,h=i[ut]||0,f=i[Tt]||0,m=(S=o.drawProfiles)!=null&&S.length?h+f:((w=o.participantsProfile)==null?void 0:w.participantsCount)??0,g=[nn,Un].includes(u)?u:void 0,v=e!=null&&e.idPrefix?`E-${a}-${e==null?void 0:e.idPrefix}`:void 0,{participants:y}=UP({uuids:o.uuids||l,...e,scaledParticipantsCount:o.scaledParticipantsCount,consideredDate:r==null?void 0:r.startDate,rankingRange:o.rankingRange,participantType:p,participantsCount:m,ratingsParameters:n,category:c,idPrefix:v,sex:g}),b=Oc({tournamentRecord:r,participants:y});if(b.error)return b;let I=y==null?void 0:y.filter(({participantType:U})=>U===p),T=y==null?void 0:y.map(ai);return{uniqueDrawParticipants:I,uniqueParticipantIds:T}}function vMe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){let{drawType:o=du,qualifyingPositions:a=0,stage:s=ut,drawSize:l=0,drawName:c,drawId:u}=n,d=l-a,p=i.slice(0,d).map(ai);if(p.length){let m=sd({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(m.error)return m}let h=p.map(m=>({entryStatus:Ds,entryStage:s,participantId:m})),f=I_({drawName:c||o,qualifyingPositions:a,drawEntries:h,drawId:u,event:r,stage:s});return f.error?f:{...ae}}function Aae({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:o,gender:a,event:s}){let l=0;for(let c of r){let{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=ut,drawSize:h=0}=c,f=h-u,m=d||a||o||p===Tt,g=m?t.slice(l,l+f):i[p||ut]||[];m&&(l+=f);let v=vMe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:s});if(v.error)return v}return{...ae}}function _ae(t){var Y;let{allUniqueParticipantIds:e,matchUpStatusProfile:i,participantsProfile:n,completeAllMatchUps:r,autoEntryPositions:o,hydrateCollections:a,randomWinningSide:s,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,publish:p,isMock:h,uuids:f}=t,m=u.gender,g=u.eventName,{eventType:v=Sd,policyDefinitions:y,drawProfiles:b=[],eventExtensions:I,surfaceCategory:T,tieFormatName:S,processCodes:w,discipline:U,eventLevel:D,timeItems:E,ballType:C,category:M}=u,N=u.eventId||ji(),R=u.tieFormat||(v===Or?Gv({namedFormat:S,event:{eventId:N,category:M,gender:m},hydrateCollections:a,isMock:h}):void 0),A=c.participants;for(let X of b)!m&&X.gender&&(m=X==null?void 0:X.gender);let{stageParticipantsCount:_,uniqueParticipantsCount:k,uniqueParticipantStages:O}=Cae({drawProfiles:b,category:M,gender:m}),F=jn(Sd)(v)&&si||jn(Gl)(v)&&jt||v,{uniqueDrawParticipants:B=[],uniqueParticipantIds:$=[]}=O?Nae({event:{eventType:v,category:M,gender:m},uniqueParticipantsCount:k,participantsProfile:n,ratingsParameters:l,tournamentRecord:c,eventProfile:u,eventIndex:d,uuids:f}):{},{eventAttributes:V}=u;typeof V!="object"&&(V={});let H=(M==null?void 0:M.categoryName)||(M==null?void 0:M.ageCategoryCode)||(M==null?void 0:M.ratingType);g=g||H||"Generated Event";let z={...V,surfaceCategory:T,processCodes:w,discipline:U,eventLevel:D,eventName:g,eventType:v,tieFormat:R,ballType:C,category:M,eventId:N,gender:m};if(I!=null&&I.length&&Array.isArray(I)){let X=I.filter(Iu);X!=null&&X.length&&Object.assign(z,{extensions:X})}if(Array.isArray(E)&&E.forEach(X=>By({event:K,timeItem:X})),typeof y=="object")for(let X of Object.keys(y))_m({policyDefinitions:{[X]:y[X]},event:z});z.category&&(z.category.categoryName=H);let G,W=vP({suppressNotifications:!1,internalUse:!0,tournamentRecord:c,event:z});if(W.error)return W;let K=W==null?void 0:W.event,{stageParticipants:Z}=Eae({allUniqueParticipantIds:e,stageParticipantsCount:_,eventParticipantType:F,targetParticipants:A});if(b!=null&&b.length){let X=Aae({uniqueDrawParticipants:B,autoEntryPositions:o,stageParticipants:Z,tournamentRecord:c,drawProfiles:b,category:M,gender:m,event:K});if(X.error)return X;let Q=Rae({matchUpStatusProfile:i,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:c,drawProfiles:b,event:K});if(Q.error)return Q;G=Q.drawIds}else if((Y=u==null?void 0:u.participantsProfile)!=null&&Y.participantsCount){let X=B.map(ai);if(X.length){let Q=sd({participantIds:X,autoEntryPositions:o,tournamentRecord:c,entryStage:ut,event:K});if(Q.error)return Q}}return p&&D0({tournamentRecord:c,event:K}),{drawIds:G,eventId:N,uniqueParticipantIds:$}}function XG({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!ws(e))return{error:aa};let r="addSchedulingProfileRound",{extension:o}=Qt({name:Ov,tournamentRecords:t,discover:!0}),a=(o==null?void 0:o.value)||[],s=a.find(p=>gd(e,p.scheduleDate));if(!s){let{startDate:p,endDate:h}=r_({tournamentRecords:t}),f=new Date(e);if(p&&f<new Date(p)||h&&f>new Date(h))return{error:aa};s={scheduleDate:e,venues:[]},a.push(s)}let l=s.venues.find(p=>p.venueId===i);l||(l={venueId:i,rounds:[]},s.venues.push(l));let c=["notBeforeTime"],u=p=>Object.keys(p).filter(h=>!c.includes(h)).sort().map(h=>ln(p[h])?u(p[h]):p[h]).flat().join("|");if(l.rounds.find(p=>u(p)===u(n)))return se({result:{error:LJ},stack:r});l.rounds.push(n);let d=T0({tournamentRecords:t,schedulingProfile:a});return d.error?d:{...ae}}function yMe({schedulingProfile:t,tournamentRecord:e}){if(typeof t!="object")return{error:Pe};let i=p0({tournamentRecord:e}).containedStructures,n=to({tournamentRecord:e}).matchUps??[],{tournamentId:r}=e,o=[];for(let a of t){let{scheduleDate:s,venues:l=[]}=a;for(let c of l){let{rounds:u,venueId:d}=c;for(let p of u){let{drawId:h,winnerFinishingPositionRange:f,roundSegment:m}=p,g=n.filter(v=>{var I;let y=(f==null?void 0:f.indexOf("-"))>0&&f.split("-").map(T=>+T),b=(I=v.finishingPositionRange)==null?void 0:I.winner;return v.drawId===h&&(!p.roundNumber||v.roundNumber===p.roundNumber)&&(!b||!y||Hn(b,y).length===2||Zt(b).length===Zt(y).length&&Hn(b,y).length===Zt(b).length)})[0];if(g){let{eventId:v,roundNumber:y,drawName:b,structureName:I,roundName:T}=g,S=g.structureId;y&&!f&&(S=Object.keys(i).find(D=>i[D].includes(S))??S);let w={tournamentId:r,structureId:S,roundNumber:y,roundSegment:m,eventId:v,drawId:h},U=XG({tournamentRecords:{[r]:e},round:w,scheduleDate:s,venueId:d});if(U.error)return U;o.push({structureName:I,roundName:T,drawName:b,...w})}}}}return{scheduledRounds:o}}function __(t){var xe,$e,Ae;let e=Ei(t,[{drawProfile:!0,_ofType:Gd}]);if(e.error)return e;let{allUniqueParticipantIds:i=[],participantsProfile:n={},matchUpStatusProfile:r,completeAllMatchUps:o,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,isMock:d=!0,drawProfile:p,startDate:h,drawIndex:f,uuids:m}=t,g=dt(p,!1,!0),{excessParticipantAlternates:v=!0,matchUpFormat:y=Ks,drawType:b=du,tournamentAlternates:I=0,alternatesCount:T=0,qualifyingPositions:S,qualifyingProfiles:w,generate:U=!0,eventExtensions:D,drawExtensions:E,completionGoal:C,tieFormatName:M,seedsCount:N,timeItems:R,drawName:A,category:_,idPrefix:k,publish:O,gender:F,stage:B}=g,$=g.drawSize||(g.ignoreDefaults?void 0:32),V=g.eventId||ji(),H=p.eventType||p.matchUpType||Sd,z=H===Gl?jt:si,G=typeof p.tieFormat=="object"&&p.tieFormat||H===en&&Gv({event:{eventId:V,category:_,gender:F},namedFormat:M,hydrateCollections:s,isMock:d})||void 0,W=(_==null?void 0:_.categoryName)||(_==null?void 0:_.ageCategoryCode)||(_==null?void 0:_.ratingType),K=p.eventName||W||`Generated ${H}`,Z=(u==null?void 0:u.participants)||[],Y=((w==null?void 0:w.map(ve=>ve.structureProfiles||[]).flat().reduce((ve,ke)=>{let ye=!ke.participantsCount||ke.participantsCount>ke.drawSize?ke.drawSize:ke.participantsCount||0;return ve+ye},0))||0)*(z===jt?2:1),X=(!p.participantsCount||p.participantsCount>$?$:p.participantsCount)||0,Q={eventName:K,eventType:H,tieFormat:G,category:_,eventId:V,gender:F};Array.isArray(R)&&R.forEach(ve=>By({event:Q,timeItem:ve}));let{eventAttributes:te}=p;if(typeof te!="object"&&(te={}),Object.assign(Q,te),(D==null?void 0:D.length)&&Array.isArray(D)){let ve=D.filter(Iu);ve!=null&&ve.length&&Object.assign(Q,{extensions:ve})}let J=[];if(Y||p.uniqueParticipants||!u||F||_){let ve=(X||0)+T+Y,ke=ve,ye={[nn]:0,[Un]:0},Ie,Ne;H===en&&({teamSize:Ie,genders:Ne}=Dae({alternatesCount:T,tieFormatName:M,tieFormat:G,drawSize:$}),Object.keys(Ne).forEach(ge=>{[nn,Un].includes(ge)&&Ne[ge]&&(ye[ge]=$*Ne[ge])}),ke=Ie*(($||0)+Y));let Fe=n!=null&&n.idPrefix?`D-${f}-${n==null?void 0:n.idPrefix}`:void 0,Le=UP({...n,scaledParticipantsCount:p.scaledParticipantsCount||n.scaledParticipantsCount,participantsCount:ke,consideredDate:u==null?void 0:u.startDate,sex:F||(n==null?void 0:n.sex),rankingRange:p.rankingRange,uuids:p.uuids||m,ratingsParameters:c,participantType:z,gendersCount:ye,idPrefix:Fe,category:_}).participants;if(Q.category&&(Q.category.categoryName=W),u){let ge=Oc({participants:Le,tournamentRecord:u});if(ge.error)return ge}if(Le.forEach(({participantId:ge})=>J.push(ge)),Z=Le,H===en){let ge=Ne[nn]?Le.filter(({participantType:Ce,person:We})=>Ce===si&&(We==null?void 0:We.sex)===nn).map(ai):[],Ee=Ne[Un]?Le.filter(({participantType:Ce,person:We})=>Ce===si&&(We==null?void 0:We.sex)===Un).map(ai):[],we=Le.filter(({participantType:Ce})=>Ce===si).map(ai).filter(Ce=>!ge.includes(Ce)&&!Ee.includes(Ce)),fe=Ie-(Ne[nn]+Ne[Un]),Te=0,ue=0,de=0,_e=it(0,ve).map(Ce=>{let We=Ee.slice(Te,Te+Ne[Un]),He=ge.slice(ue,ue+Ne[nn]),Be=we.slice(de,de+fe);return Te+=Ne[Un],ue+=Ne[nn],de+=fe,{individualParticipantIds:[...We,...He,...Be],participantOtherName:`TM${Ce+1}`,participantName:`Team ${Ce+1}`,participantRole:Mo,participantType:en,participantId:ji()}}),Ue=Oc({participants:_e,tournamentRecord:u});if(!Ue.success)return Ue;Z=_e}}let ie=ve=>{let{participantType:ke}=ve;return jn(Sd)(H)&&ke===si||jn(Gl)(H)&&ke===jt?!0:H===en&&ke===en},oe=ve=>{var ke,ye;return!p.gender||((ke=ve.person)==null?void 0:ke.sex)===p.gender?!0:(ye=ve.individualParticipantIds)==null?void 0:ye.some(Ie=>{let Ne=Z.find(Fe=>Fe.participantId===Ie);return Ne&&oe(Ne)})},ne=Z.filter(ie).filter(oe).filter(({participantId:ve})=>!i.includes(ve)),re=ne.slice(0,X).map(ve=>ve.participantId);if(d&&(re!=null&&re.length)){let ve=sd({autoEntryPositions:a,entryStage:B,tournamentRecord:u,participantIds:re,event:Q});if(ve.error)return ve}let me=Y?ne.slice(X,X+Y).map(ve=>ve.participantId):0;if(d&&(me!=null&&me.length)){let ve=0,ke=1,ye=(Ne,Fe)=>Ne.stageSequence-Fe.stageSequence,Ie=(Ne,Fe)=>Ne.roundTarget-Fe.roundTarget;for(let Ne of w.sort(Ie)){ke=Ne.roundTarget||ke;let Fe=1,Le;for(let ge of Ne.structureProfiles.sort(ye)){let Ee=(ge.drawSize||mV(ge.participantsCount))-(Le||0),we=me.slice(ve,ve+Ee),fe=sd({entryStage:Tt,entryStageSequence:Fe,autoEntryPositions:a,tournamentRecord:u,participantIds:we,roundTarget:ke,event:Q});if(fe.error)return fe;Le=ge.qualifyingPositions,ve+=Ee,Fe+=1}ke+=1}}let he=v&&((xe=u==null?void 0:u.participants)==null?void 0:xe.filter(({participantId:ve})=>!re.includes(ve)).filter(ie).filter(oe).slice(0,T||$-X||I).map(ve=>ve.participantId));if(d&&(he!=null&&he.length)){let ve=sd({participantIds:he,autoEntryPositions:!1,entryStatus:Ol,tournamentRecord:u,event:Q});if(ve.error)return ve.error}let be=W||K;u&&N&&N<=re.length&&it(1,N+1).forEach((ve,ke)=>{let ye={scaleName:be,scaleDate:h,scaleType:Uj,scaleValue:ve,eventType:H},Ie=re[ke];XI({tournamentRecord:u,participantId:Ie,scaleItem:ye})});let Se=m_({...dt(p,!1,!0),tournamentRecord:u,seedingScaleName:be,matchUpFormat:y,eventId:V,isMock:d,event:Q});if(Se.error)return Se;if(!Se.drawDefinition)return{error:ns};let{drawDefinition:De}=Se,Oe=De.drawId;if(Array.isArray(E)&&E.filter(Iu).forEach(ve=>Ui({element:De,extension:ve})),U){if(y_({drawDefinition:De,event:Q,suppressNotifications:!0}),p.withPlayoffs){let ke=($e=De.structures)==null?void 0:$e[0].structureId,ye=jA({...p.withPlayoffs,tournamentRecord:u,drawDefinition:De,structureId:ke,idPrefix:k,isMock:d,event:Q});if(ye!=null&&ye.error)return ye}let ve=p.automated===!1;if(d&&!ve){let ke=ye=>{var Fe;let Ie=qM({completeAllMatchUps:ye.completeAllMatchUps,completionGoal:ye.completionGoal,matchUpStatusProfile:r,randomWinningSide:l,tournamentRecord:u,drawDefinition:De,matchUpFormat:y,event:Q});if(Ie.error)return Ie;let Ne=Ie.completedCount;if(b===Id){let Le=(Fe=De.structures)==null?void 0:Fe.find(we=>we.stage===ut);if(!Le)return{error:Nn};JD({structureId:Le.structureId,tournamentRecord:u,drawDefinition:De,event:Q});let ge=C?C-(Ne??0):void 0,Ee=qM({completionGoal:C?ge:void 0,matchUpStatusProfile:r,completeAllMatchUps:o,randomWinningSide:l,tournamentRecord:u,drawDefinition:De,matchUpFormat:y,event:Q});if(Ee.error)return Ee}};if(C&&ke({completionGoal:C}),p.outcomes){let{matchUps:ye}=Ia({inContext:!0,drawDefinition:De,event:Q});for(let Ie of p.outcomes){let{matchUpStatus:Ne=or,matchUpStatusCodes:Fe,stageSequence:Le=1,matchUpIndex:ge=0,structureOrder:Ee,matchUpFormat:we,drawPositions:fe,roundPosition:Te,stage:ue=ut,roundNumber:de,winningSide:_e,scoreString:Ue}=Ie,Ce=(ye==null?void 0:ye.reduce((et,ot)=>{let{structureId:mt,matchUpId:Rt}=ot;return et[mt]?et[mt].push(Rt):et[mt]=[Rt],et},{}))??[],We=Object.assign({},...Object.keys(Ce).map((et,ot)=>({[et]:ot+1}))),He=(Ae=ye==null?void 0:ye.filter(et=>(!ue||et.stage===ue)&&(!Le||et.stageSequence===Le)&&(!de||et.roundNumber===de)&&(!Te||et.roundPosition===Te)&&(!Ee||We[et.structureId]===Ee)&&(!fe||Hn(fe,et.drawPositions).length===2)))==null?void 0:Ae[ge],Be=Mae({matchUpStatusCodes:Fe,tournamentRecord:u,drawDefinition:De,targetMatchUp:He,matchUpFormat:we,matchUpStatus:Ne,scoreString:Ue,winningSide:_e});if(Be!=null&&Be.error)return Be}}o&&ke({completeAllMatchUps:o})}O&&D0({tournamentRecord:u,event:Q})}else{let ve=I_({drawEntries:De.entries,drawName:A||b,qualifyingPositions:S,drawId:Oe,event:Q,stage:B});if(ve.error)return ve}return{...ae,event:wt(Q),uniqueParticipantIds:J,targetParticipants:Z,drawDefinition:De,eventId:V,drawId:Oe}}var kae=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0}),bMe=kae;function YM(t){return parseInt(t)}function K6({startTime:t="",endTime:e=""}={}){if(!t||!e||!cm.test(t)||!cm.test(e))return!1;let[i,n]=t.split(":").map(YM),[r,o]=e.split(":").map(YM);return r<i?!1:!(i===r&&o<n)}function IMe(t,e){let[i,n]=t.startTime.split(":").map(YM),[r,o]=e.startTime.split(":").map(YM);return i<r?-1:i>r?1:n<o?-1:n>o?1:0}function xae({dateAvailability:t}){if(!t)return{error:ZJ};if(!Array.isArray(t))return{error:wE};let e="Dates must be formated => YYYY-MM-DD",i="Times must be 24 hour => 00:00";for(let n of t){if(typeof n!="object")return{error:wE};let{date:r,startTime:o,endTime:a,bookings:s=[]}=n;if(!o||!a)return{error:wE};if(r&&!md.test(r))return{error:aa,dateAvailability:{date:r},info:e};if(!cm.test(o))return{error:Dl,dateAvailability:{startTime:o},info:i};if(!cm.test(a))return{error:Dl,dateAvailability:{endTime:a},info:i};if(o===a)return{error:Dl,dateAvailability:{startTime:o,endTime:a},info:"startTime and endTime are equivalent"};if(!K6({startTime:o,endTime:a}))return{error:Dl,dateAvailability:{startTime:o,endTime:a},info:"endTime must be after startTime"};if(s){if(!Array.isArray(s))return{error:gM};for(let l of s){if(typeof l!="object")return{error:gM};let{startTime:c,endTime:u}=l;if(!cm.test(c))return{error:Dl,booking:{startTime:c},info:i};if(!cm.test(u))return{error:Dl,booking:{endTime:u},info:i};if(c===u)return{error:Dl,dateAvailability:{startTime:c,endTime:u},info:"startTime and endTime are equivalent"};if(!K6({startTime:c,endTime:u}))return{error:Dl,dateAvailability:{startTime:c,endTime:u},info:"endTime must be after startTime"}}}}return{valid:!0}}function k_({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){let{venue:o}=Vp({tournamentRecord:t,venueId:i});if(!o)return{error:e0};o.courts||(o.courts=[]);let a={...kae(),venueId:i,courtId:n};if(a.courtId||(a.courtId=ji()),o.courts.some(s=>s.courtId===a.courtId))return{error:hQ};{let s=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:Wt(u.date),startTime:hn(u.startTime),endTime:hn(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:hn(p),endTime:hn(h),bookingType:f}))}}),l=Object.keys(a);for(let u of l)if(r!=null&&r[u])if(u==="dateAvailability"){let d=xae({dateAvailability:s});if(!d.valid&&d.error)return d;a.dateAvailability=s}else a[u]=r[u];let c=a;return o.courts.push(c),e||di({payload:{venue:o,tournamentId:t.tournamentId},topic:ag,key:o.venueId}),{...ae,court:dt(a),venueId:i}}}function JG(t){let{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:bf};let n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[],o;for(let a of Object.values(n)){let{venue:s}=Vp({tournamentRecord:a,venueId:i});if(s){let l=wMe({...t,tournamentRecord:a});for(let c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;o=!0}}return o?{...ae,courtIds:r}:{error:e0}}function wMe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:o,courtsCount:a,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:bf};let h=Vp({tournamentRecord:n,venueId:d});if(h.error)return h;let{venue:f}=h;if(!Bn(a)||!r)return{error:pQ};a=a??r.length;let m=it(0,a).map(g=>{let v=o==null?void 0:o[g],y=v?p.map(b=>({date:Dc(b),startTime:s,endTime:c,...v})):e;return v&&s&&c&&y.push({startTime:s,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{let y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return k_({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==a?se({info:"not all courts could be generated",result:{error:Pe}}):(f&&di({payload:{venue:f,tournamentId:n.tournamentId},topic:ag,key:f.venueId}),{...ae,courts:dt(m)})}function Oae({tournamentRecord:t,venueProfiles:e,uuids:i}){let{startDate:n,endDate:r}=t,o=[];for(let[a,s]of e.entries()){let{venueAbbreviation:l,venueId:c=(i==null?void 0:i.pop())??ji(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:h,courtsCount:f,courtNames:m,venueName:g,idPrefix:v,courtIds:y}=s,b={venueName:g||`Venue ${a+1}`,venueAbbreviation:l,venueId:c},I=BD({tournamentRecord:t,venue:b});if(I.error)return I;o.push(c);let T=LI(n,r),S=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(T.map(U=>({date:Dc(U),startTime:d,endTime:p}))),w=JG({dateAvailability:u||S,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:m,startTime:d,idPrefix:v,courtIds:y,endTime:p,venueId:c,dates:T});if(w.error)return w}return o}var SMe=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function Lae(t){let{tournamentAttributes:e,startDate:i,endDate:n}=t??{},{tournamentName:r=Qa(SMe),ratingsParameters:o=vs,scheduleCompletedMatchUps:a,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:c,participantsProfile:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,policyDefinitions:f,schedulingProfile:m,periodLength:g,autoSchedule:v,eventProfiles:y,venueProfiles:b,drawProfiles:I,uuids:T}=t??{};if(i&&!ws(i)||n&&!ws(n))return{error:aa};if(y&&!Array.isArray(y))return{error:Pe};if(!i){let R=new Date;i=Dc(n??R),n=Dc(R.setDate(R.getDate()+7))}if(!n){let R=new Date(i);n=Dc(R.setDate(R.getDate()+7))}typeof e!="object"&&(e={});let S=bae({...e,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(s!=null&&s.length&&Array.isArray(s)){let R=s.filter(A=>Iu({extension:A}));R!=null&&R.length&&Object.assign(S,{extensions:R,isMock:!0})}if(typeof f=="object")for(let R of Object.keys(f))_m({policyDefinitions:{[R]:f[R]},tournamentRecord:S});let w=Pae({participantsProfile:u,tournamentRecord:S,eventProfiles:y,drawProfiles:I,startDate:i,uuids:T});if(!w.success)return w;let U=[],D=[],E=[];if(Array.isArray(I)){let R=0;for(let A of I){let _=__({allUniqueParticipantIds:U,matchUpStatusProfile:l,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,participantsProfile:u,randomWinningSide:h,ratingsParameters:o,tournamentRecord:S,isMock:!0,drawProfile:A,startDate:i,drawIndex:R,uuids:T});if(_.error)return _;let{drawId:k,eventId:O,event:F,uniqueParticipantIds:B}=_;if(_=vP({suppressNotifications:!1,internalUse:!0,tournamentRecord:S,event:F}),_.error)return _;k&&E.push(k),D.push(O),B!=null&&B.length&&U.push(...B),R+=1}}if(y){let R=0;for(let A of y){let _=_ae({allUniqueParticipantIds:U,matchUpStatusProfile:l,participantsProfile:u,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,ratingsParameters:o,tournamentRecord:S,eventProfile:A,eventIndex:R,startDate:i,uuids:T});if(_.error)return _;let{eventId:k,drawIds:O,uniqueParticipantIds:F}=_;O&&E.push(...O),D.push(k),F!=null&&F.length&&U.push(...F),R+=1}}let C=b!=null&&b.length?Oae({tournamentRecord:S,venueProfiles:b,uuids:T}):[],M,N={};if(m){let R=yMe({schedulingProfile:m,tournamentRecord:S});if(R.error)return R;if(M=R.scheduledRounds,v){let{tournamentId:A}=S,_={[A]:S};N=A_({scheduleCompletedMatchUps:a,tournamentRecords:_,periodLength:g})}}return yV(),wt({...ae,tournamentRecord:S,scheduledRounds:M,schedulerResult:N,eventIds:D,venueIds:C,drawIds:E})}var Fae={};ii(Fae,{anonymizeTournamentRecord:()=>Bae,modifyTournamentRecord:()=>$ae});function Bae({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:o}){var O,F,B,$,V;if(!i)return{error:Ge};let a=Array.isArray(t)?o6.concat(...t):o6,s=H=>{var z;return Array.isArray(t)?(z=H==null?void 0:H.extensions)==null?void 0:z.filter(G=>a.includes(G.name)):H==null?void 0:H.extensions},l={};i.extensions=s(i);let c=o||ji();l[i.tournamentId]=c,i.tournamentId=c,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Dc(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(let H of i.participants||[]){let z=ji();l[H.participantId]=z,H.participantId=z}for(let H of i.participants||[])Array.isArray(H.individualParticipantIds)&&(H.individualParticipantIds=H.individualParticipantIds.map(z=>l[z]));let u=0;for(let H of i.venues||[]){H.extensions=s(H),H.venueName=`Venue #${u}`,H.venueAbbreviation=`V${u}`;let z=ji();l[H.venueId]=z,H.isMock=!0,u+=1}let d=1;for(let H of i.events||[]){H.extensions=s(H),H.isMock=!0;let z=ji();l[H.eventId]=z,H.eventId=z;let G=((O=H.category)==null?void 0:O.categoryName)||((F=H.category)==null?void 0:F.ageCategoryCode)||((B=H.category)==null?void 0:B.ratingType)||H.gender;if(H.eventName=`Event ${d} ${G}`,Array.isArray(H.entries))for(let K of H.entries)K.participantId=l[K.participantId];for(let K of H.drawDefinitions||[]){K.extensions=s(K);let Z=ji();if(l[K.drawId]=Z,K.drawId=Z,K.isMock=!0,Array.isArray(K.entries))for(let X of K.entries)X.participantId=l[X.participantId];let Y=X=>{X.extensions=s(X);let Q=ji();l[X.structureId]=Q,X.structureId=Q;for(let te of X.positionAssignments||[])te.participantId&&(te.participantId=l[te.participantId]);for(let te of X.seedAssignments||[])te.participantId&&(te.participantId=l[te.participantId]);for(let te of X.matchUps||[]){te.isMock=!0;for(let J of te.sides||[])J.lineUp&&(J.lineUp=J.lineUp.map(({participantId:ie,collectionAssignments:oe})=>({participantId:l[ie],collectionAssignments:oe})))}};for(let X of K.structures||[])if(Y(X),Array.isArray(X.structures))for(let Q of X.structures)Y(Q);for(let X of K.links||[])X.source.structureId=l[X.source.structureId],X.target.structureId=l[X.target.structureId]}let{extension:W}=Qt({name:Vl,element:H});Array.isArray(($=W==null?void 0:W.value)==null?void 0:$.flights)&&((V=W==null?void 0:W.value.flights)==null||V.forEach(K=>{if(K.drawId=l[K.drawId],Array.isArray(K.drawEntries))for(let Z of K.drawEntries)Z.participantId=l[Z.participantId]})),d+=1}let p=i.startDate||Dc(new Date),h=(i.participants||[]).filter(({participantType:H})=>H===si),f=h.reduce((H,z)=>{var W;let G=(W=z.person)==null?void 0:W.sex;return[nn,Un].includes(G)?H[G]+=1:H[Qg]+=1,H},{[nn]:0,[Un]:0,[Qg]:0}),m=Object.assign({},...Object.keys(f).map(H=>{var z;return{[H]:((z=Uae({category:{ageCategoryCode:"O18"},count:f[H],addressProps:{citiesCount:10},personExtensions:[],consideredDate:p,sex:H}))==null?void 0:z.persons)||[]}})),g={[nn]:0,[Un]:0,[Qg]:0},v=h.length,y=h.reduce((H,z)=>{var Y,X;let G=((X=(Y=z.person)==null?void 0:Y.addresses)==null?void 0:X[0])||{},{city:W,state:K,postalCode:Z}=G;return H.cities.includes(W)||H.cities.push(W),H.states.includes(K)||H.states.push(K),H.postalCodes.includes(Z)||H.postalCodes.push(Z),H},{cities:[],postalCodes:[],states:[]}),b=y.postalCodes.length,I=y.cities.length,T=y.states.length,{cities:S}=Iae({count:I||v,participantsCount:v}),{states:w}=wae({count:T||v,participantsCount:v}),{postalCodes:U}=Sae({count:b||v,participantsCount:v}),D={cities:S,states:w,postalCodes:U};h.forEach((H,z)=>{var X,Q;let G=H==null?void 0:H.person,W=(G==null?void 0:G.sex)||Qg,K=(X=Wt(G==null?void 0:G.birthDate))==null?void 0:X.split("-")[0],Z=g[W],Y=m[W][Z];if(g[W]+=1,K){let[,te,J]=((Q=Y==null?void 0:Y.birthDate)==null?void 0:Q.split("-"))||[],ie=[K,te,J].join("-");Y.birthDate=ie}if(G!=null&&G.addresses){let te=Tae({...D,participantIndex:z,nationalityCode:Y.nationalityCode});Y.addresses=[te]}Y.personId=(r==null?void 0:r[z])||ji(),e?(Y.standardFamilyName=Y.lastName,Y.standardGivenName=Y.firstName,H.participantName=`${Y.standardGivenName} ${Y.standardFamilyName}`):(Y.standardFamilyName=G==null?void 0:G.standardFamilyName,Y.standardGivenName=G==null?void 0:G.standardGivenName),delete Y.firstName,delete Y.lastName,Y.extensions=s(G),H.person=Y,l[G==null?void 0:G.personId]=Y.personId}),(i.participants||[]).filter(({participantType:H})=>H===jt).forEach(H=>{let{individualParticipantIds:z}=H;H.participantName=TMe({individualParticipantIds:z,individualParticipants:h})});let E=(i.participants||[]).filter(({participantType:H})=>H===en),C=E.length,M=P2({count:C}).names;E.forEach((H,z)=>{H.participantName=M[z]});let N=(i.participants||[]).filter(({participantType:H})=>H===ks),R=N.length,A=P2({count:R,nameRoot:"Group"}).names;N.forEach((H,z)=>{H.participantName=A[z]});let{extension:_}=Qt({element:i,name:Ov});Array.isArray(_==null?void 0:_.value)&&(_==null||_.value.forEach(H=>{H.tournamentId=l[H.tournamentId],H.structureId=l[H.structureId],H.eventId=l[H.eventId],H.drawId=l[H.drawId]}));let{extension:k}=Qt({element:i,name:l0});return Array.isArray(k==null?void 0:k.value)&&(k==null||k.value.forEach(H=>{H.personId=l[H.personId]})),{...ae}}function TMe({individualParticipantIds:t,individualParticipants:e}){let i=e.filter(({participantId:n})=>t.includes(n)).map(({person:n})=>n==null?void 0:n.standardFamilyName).filter(Boolean).sort().join("/");return t.length===1&&(i+="/Unknown"),i}function $ae(t){var U,D,E;let{ratingsParameters:e=vs,participantsProfile:i={},matchUpStatusProfile:n,completeAllMatchUps:r,autoEntryPositions:o,hydrateCollections:a,randomWinningSide:s,schedulingProfile:l,tournamentRecord:c,eventProfiles:u,periodLength:d,venueProfiles:p,autoSchedule:h,drawProfiles:f,uuids:m}=t;if(!c)return{error:Ge};let g=[],v=[],y=[];u==null||u.forEach(C=>{var N;let M=(N=c.events)==null?void 0:N.find((R,A)=>C.eventIndex!==void 0&&A===C.eventIndex||C.eventName&&R.eventName===C.eventName||C.eventId&&R.eventId===C.eventId);M!=null&&M.gender&&(C.gender=M.gender)});let b=((U=c.participants)==null?void 0:U.length)||void 0;b&&(i!=null&&i.idPrefix)&&(i.idPrefix=`${i.idPrefix}-${b}`);let I=Pae({startDate:c.startDate,participantsProfile:i,tournamentRecord:c,eventProfiles:u,drawProfiles:f,uuids:m});if(!I.success)return I;if(u){let C=((D=c.events)==null?void 0:D.length)||0;for(let M of u){let{ratingsParameters:N}=M,R=(E=c.events)==null?void 0:E.find((A,_)=>M.eventIndex!==void 0&&_===M.eventIndex||M.eventName&&A.eventName===M.eventName||M.eventId&&A.eventId===M.eventId);if(R){let{gender:A,category:_,eventType:k}=R,{drawProfiles:O,publish:F}=M,B=jn(Sd)(k)&&si||jn(Gl)(k)&&jt||k;if(O){let{stageParticipantsCount:$,uniqueParticipantsCount:V,uniqueParticipantStages:H}=Cae({drawProfiles:O,category:_,gender:A}),{uniqueDrawParticipants:z=[],uniqueParticipantIds:G=[]}=H?Nae({event:{eventType:k,category:_,gender:A},uniqueParticipantsCount:V,participantsProfile:i,ratingsParameters:N,tournamentRecord:c,eventProfile:M,uuids:m}):{};g.push(...G);let{stageParticipants:W}=Eae({targetParticipants:c.participants||[],allUniqueParticipantIds:g,stageParticipantsCount:$,eventParticipantType:B}),K=Aae({uniqueDrawParticipants:z,autoEntryPositions:o,stageParticipants:W,tournamentRecord:c,drawProfiles:O,category:_,gender:A,event:R});if(K.error||(K=Rae({matchUpStatusProfile:n,completeAllMatchUps:r,randomWinningSide:s,tournamentRecord:c,drawProfiles:O,event:R}),K.error))return K;y.push(...K.drawIds)}F&&D0({tournamentRecord:c,event:R})}else{let A=_ae({startDate:c.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:o,randomWinningSide:s,ratingsParameters:N,tournamentRecord:c,eventProfile:M,eventIndex:C,uuids:m});if(A.error)return A;let{eventId:_,drawIds:k,uniqueParticipantIds:O}=A;k&&y.push(...k),v.push(_),O!=null&&O.length&&g.push(...O),C+=1}}}if(f){let C=(c.events||[]).map(M=>{var N;return((N=M.drawDefinitions)==null?void 0:N.map(()=>1))||[]}).flat().reduce((M,N)=>M+N,0);for(let M of f){let N=__({startDate:c.startDate,allUniqueParticipantIds:g,matchUpStatusProfile:n,participantsProfile:i,completeAllMatchUps:r,autoEntryPositions:o,hydrateCollections:a,randomWinningSide:s,ratingsParameters:e,tournamentRecord:c,drawProfile:M,drawIndex:C,uuids:m});if(N.error)return N;let{drawId:R,eventId:A,event:_,uniqueParticipantIds:k}=N;if(N=vP({tournamentRecord:c,event:_,internalUse:!0}),N.error)return N;R&&y.push(R),v.push(A),k!=null&&k.length&&g.push(...k),C+=1}}let T=p!=null&&p.length?Oae({tournamentRecord:c,venueProfiles:p}):[],S,w={};if(l!=null&&l.length){let C={[c.tournamentId]:c},M=T0({tournamentRecords:C,schedulingProfile:l});if(M.error)return M;if(h){let{tournamentId:N}=c,R={[N]:c};w=A_({tournamentRecords:R,periodLength:d})}}return{totalParticipantsCount:c.participants.length,scheduledRounds:S,schedulerResult:w,...ae,eventIds:v,venueIds:T,drawIds:y}}var QG={};ii(QG,{addIndividualParticipantIds:()=>U_,addParticipant:()=>Pu,addParticipants:()=>Oc,addPenalty:()=>ase,addPersonRequests:()=>Wae,addPersons:()=>sse,createGroupParticipant:()=>Jae,createTeamsFromParticipantAttributes:()=>KG,deleteParticipants:()=>xy,filterParticipants:()=>WD,findParticipant:()=>Xae,getCompetitionParticipants:()=>$H,getPairedParticipant:()=>zl,getParticipantEventDetails:()=>VH,getParticipantMembership:()=>jH,getParticipantScaleItem:()=>ZI,getParticipantSchedules:()=>HH,getParticipantSignInStatus:()=>GH,getParticipantTimeItem:()=>Nj,getParticipants:()=>zn,getScaleValues:()=>o0,mergeParticipants:()=>ose,modifyIndividualParticipantIds:()=>qae,modifyParticipant:()=>D_,modifyParticipantName:()=>Qae,modifyParticipantOtherName:()=>Kae,modifyParticipantsSignInStatus:()=>Yae,modifyPenalty:()=>nse,modifyPersonRequests:()=>Gae,mutate:()=>Vae,participantScaleItem:()=>ad,query:()=>Kre,regenerateParticipantNames:()=>Zae,removeIndividualParticipantIds:()=>Lj,removeParticipantIdsFromAllTeams:()=>NA,removePenalty:()=>tse,removePersonRequests:()=>zae,scaledTeamAssignment:()=>ese,setParticipantScaleItem:()=>XI,setParticipantScaleItems:()=>sne,validateLineUp:()=>_A});var Vae={};ii(Vae,{addIndividualParticipantIds:()=>U_,addParticipant:()=>Pu,addParticipants:()=>Oc,addPenalty:()=>ase,addPersonRequests:()=>Wae,addPersons:()=>sse,createGroupParticipant:()=>Jae,createTeamsFromParticipantAttributes:()=>KG,deleteParticipants:()=>xy,findParticipant:()=>Xae,mergeParticipants:()=>ose,modifyIndividualParticipantIds:()=>qae,modifyParticipant:()=>D_,modifyParticipantName:()=>Qae,modifyParticipantOtherName:()=>Kae,modifyParticipantsSignInStatus:()=>Yae,modifyPenalty:()=>nse,modifyPersonRequests:()=>Gae,regenerateParticipantNames:()=>Zae,removeIndividualParticipantIds:()=>Lj,removeParticipantIdsFromAllTeams:()=>NA,removePenalty:()=>tse,removePersonRequests:()=>zae,scaledTeamAssignment:()=>ese,setParticipantScaleItem:()=>XI,setParticipantScaleItems:()=>sne});function jae(t=0){(typeof t!="number"||isNaN(t))&&(t=0);let e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}function Hae({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);let n=i.filter(({requestType:r})=>r).map(r=>{let{date:o,startTime:a,endTime:s}=r;return r.requestType===SP&&(o=Wt(o),a=hn(a),s=hn(s),o&&a&&s)?{date:o,startTime:a,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(let r of n)r.requestId=jae(),t[e].push(r);return{mergeCount:n.length}}function ez(t){let{tournamentRecords:e,personRequests:i}=t,n=Ei(t,[{[ko]:!0}]);if(n.error)return n;if(!i)return{...ae};let r=Object.values(e);for(let o of r){let a=o.participants??[],s=[];for(let l of Object.keys(i))if(zh({tournamentParticipants:a,personId:l})){let c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&Ui({element:o,extension:{value:s,name:l0}})}return{...ae}}function Gae(t){let{tournamentRecords:e,requests:i,personId:n}=t,r=Ei(t,[{[ko]:!0},{requests:!0,[Sf]:Xa,[fd]:Pe}]);if(r.error)return r;let o=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:a}=vg({tournamentRecords:e}),s=c=>{a&&(a[c]=a[c].map(u=>{if(!o.includes(u.requestId))return u;let d=i.find(p=>p.requestId===u.requestId);if(d.requestType)return Object.assign(u,d)}).filter(Boolean))};if(n&&(a!=null&&a[n]))s(n);else if(a)for(let c of Object.keys(a))s(c);let l=i.filter(c=>!c.requestId);return l.length&&Hae({personRequests:a,personId:n,requests:l}),ez({tournamentRecords:e,personRequests:a})}function zae(t){let{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:o}=t,a=Ei(t,[{[ko]:!0}]);if(a.error)return a;let{personRequests:s}=vg({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>(!i||p.requestType!==i)&&(!n||p.requestId!==n)&&(!o||p.date!==o)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!i&&!n&&!r&&!o;if(!c){if(r&&(s!=null&&s[r]))l(r);else if(s)for(let u of Object.keys(s))l(u)}return c||!s||!Object.keys(s).length?ta({name:l0,tournamentRecords:e,discover:!0}):ez({tournamentRecords:e,personRequests:s})}function Wae(t){let{tournamentRecords:e,personId:i,requests:n}=t,r=Ei(t,[{[ko]:!0,[wSe]:!0},{requests:!0,[Sf]:Xa,[fd]:Pe}]);if(r.error)return r;let{personRequests:o}=vg({tournamentRecords:e}),{mergeCount:a}=Hae({personRequests:o,personId:i,requests:n});return a&&o?ez({tournamentRecords:e,personRequests:o}):{error:Pe}}function qae({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){let n="modifyIndividualParticipantIds";if(!i)return se({result:{error:Ge},stack:n});if(!e||!t)return se({result:{error:gt},stack:n});let r=i.participants||[],o=r.find(h=>h.participantId===e);if(!o)return se({result:{error:Jn},stack:n});if(![en,ks].includes(o.participantType))return se({result:{error:_c},context:{participantType:o.participantType},stack:n});let a=t.filter(h=>{var f;return((f=r.find(m=>m.participantId===h))==null?void 0:f.participantType)!==si});if(a.length)return se({result:{error:xl,invalidParticipantIds:a},stack:n});let s=o.individualParticipantIds||[],l=t.filter(h=>!s.includes(h)),c=s.filter(h=>!t.includes(h)),u=U_({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return se({result:u,stack:n});let d=Lj({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return se({result:d,stack:n});let{topics:p}=pl();if(p.includes(wo)){let h=r.find(({participantId:f})=>f===e);di({topic:wo,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function Yae({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:Ge};if(!Array.isArray(e))return{error:gt};if(![GT,Oee].includes(i))return{error:Pe,signInState:i};let n=t.participants||[];if(!n.length)return{error:hD};let r=n.map(ai),o=e.filter(c=>!r.includes(c));if(o.length)return{error:Pe,context:{invalidParticipantIds:o}};let a=[],s=new Date().toISOString();for(let c of n){let{participantId:u}=c;if(e.includes(u)){let d=Zj({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:ED,itemValue:i,createdAt:s}});if(d.error)return d;a.push(c)}}let{topics:l}=pl();return a.length&&l.includes(wo)&&di({topic:wo,payload:{tournamentId:t.tournamentId,participants:a}}),{...ae}}function Kae({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:Ge};if(!e)return{error:Rr};let{participant:n}=hg({tournamentRecord:t,participantId:e});if(!n)return{error:Jn};n.participantOtherName=i;let{topics:r}=pl();return r.includes(wo)&&di({topic:wo,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ae}}function Z6({personFormat:t,person:e}){let i=m=>m.replace(/\W/g,""),n=m=>/^[a-z]*$/.test(i(m)),r=m=>/^[A-Z]*$/.test(i(m)),o=m=>/^[LAST]{4}/.test(i(m)),a=m=>m.toLowerCase().indexOf("l")<m.toLowerCase().indexOf("f"),s=m=>m.indexOf(",")>=0,l=m=>m.toLowerCase().indexOf("f.")>=0,c=m=>m.toLowerCase().indexOf("f")<0,u=m=>m.indexOf(" ")>0;if(!e)return;let d=u(t)?" ":"",p=QF((e==null?void 0:e.standardGivenName)??""),h=QF((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${p}${d}${h}`;l(t)&&!s(t)&&!a(t)&&(p=`${p[0]}.`),n(t)?(p=p.toLowerCase(),h=h.toLowerCase()):r(t)?(p=p.toUpperCase(),h=h.toUpperCase()):o(t)&&(h=h.toUpperCase());let f=`${p}${d}${h}`;return c(t)?f=h:a(t)&&(s(t)?f=`${h},${d}${p}`:f=`${h}${d}${p}`),f}function UMe({participantMap:t,participant:e,formats:i}){let{participantType:n,individualParticipantIds:r,person:o}=e,a=n&&i[n];if(n!==el&&a){let{personFormat:s,doublesJoiner:l}=a;n===si&&(e.participantName=Z6({person:o,personFormat:s})),n===jt&&(e.participantName=r==null?void 0:r.map(c=>{var d;let u=(d=t[c])==null?void 0:d.person;return Z6({person:u,personFormat:s})}).filter(Boolean).join(l??"/"))}}function Zae({tournamentRecord:t,formats:e}){if(!t)return{error:Ge};if(!ln(e))return{error:gt};let i=t.participants??[],n=TJ(i,"participantId");for(let r of i)UMe({participant:r,participantMap:n,formats:e});return{...ae}}function Xae(t){let{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:o}=t,a=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof o!="string")return{error:gt,stack:"publicFindParticipant"};let s,l;for(let c of Object.values(a)){l=c.tournamentId;let u=c.participants||[];if(s=zh({tournamentParticipants:u,internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:o}),s)break}return{participant:s,tournamentId:l,...ae}}function Jae({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Rte,tournamentRecord:n,participantId:r,groupName:o}){if(!n)return{error:Ge};if(!o)return{error:gt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Pe};let a=(zn({participantFilters:{participantTypes:[si]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(let u of t)if(!a.includes(u))return{error:_c,participantId:u};let s=wt({participantId:r||ji(),participantRoleResponsibilities:e,participantName:o,individualParticipantIds:t,participantType:ks,participantRole:i}),l=Pu({participant:s,tournamentRecord:n});if(l.error)return l;let{topics:c}=pl();return c.includes(qh)&&di({topic:qh,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...ae,participant:dt(s)}}function Qae({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:Ge};if(!i)return{error:Rr};if(!e)return{error:gt,info:"Missing participantName"};let{participant:n}=hg({tournamentRecord:t,participantId:i});if(!n)return{error:Jn};n.participantName=e;let{topics:r}=pl();return r.includes(wo)&&di({topic:wo,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...ae}}function ese({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:o,tournamentRecord:a,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var v,y,b,I,T;if(!a)return{error:Ge};if(!Array.isArray(o)&&!Bt(c)&&!u||!Bt(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:Pe};if(!s&&!r.length||!r&&!(e&&s))return{error:gt,info:"Missing scaling details"};if(u&&!o){if((d==null?void 0:d.eventType)!==al)return{error:Hh};o=(v=d==null?void 0:d.entries)==null?void 0:v.filter(({entryStatus:S})=>S===Ds).map(ai)}if(!(o!=null&&o.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:gt};let p=e??r.map(({participantId:S})=>S);i&&(o==null||o.reverse(),n+=1),n>((o==null?void 0:o.length)||0)-1&&(n=0);let h=(o==null?void 0:o.slice(n).concat(...o.slice(0,n)))??[],f=[];for(let S of a.participants??[]){let{participantId:w,participantType:U}=S;if(h.includes(w)){if(U!==el)return{error:_c,participant:S};f.push(S)}}if(c&&f.length<c){let S=c-((f==null?void 0:f.length)||0),w=l??"Team",U=it(0,S).map(M=>({participantName:`${w} ${M+1}`,participantType:el,participantRole:Mo})),{participants:D=[]}=Oc({participants:U,returnParticipants:!0,tournamentRecord:a}),E=D.map(ai),C=((y=a.participants)==null?void 0:y.filter(({participantId:M})=>E.includes(M)))??[];f.push(...C)}if(!f.length)return{error:dV};if(t)for(let S of f)S.individualParticipantIds=[];else{let S=f.map(w=>w).flat();e!=null&&e.length?p=p.filter(w=>!S.includes(w)):r=r==null?void 0:r.filter(({participantId:w})=>!S.includes(w))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:JN,info:"Nothing to be done"};if(!r.length){for(let S of a.participants??[]){let{participantId:w,participantType:U}=S;if(!p.includes(w))continue;if(U!==si)return{error:_c,participant:S};let D=(b=ad({scaleAttributes:s,participant:S}))==null?void 0:b.scaleItem,E=s!=null&&s.accessor?(I=D==null?void 0:D.scaleValue)==null?void 0:I[s==null?void 0:s.accessor]:D==null?void 0:D.scaleValue,C={participantId:w,scaleValue:E};r.push(C)}if(!r.length)return{error:Jn}}r.sort((S,w)=>s!=null&&s.sortOrder?((w==null?void 0:w.scaleValue)||0)-((S==null?void 0:S.scaleValue)||0):((S==null?void 0:S.scaleValue)||1/0)-((w==null?void 0:w.scaleValue)||1/0));for(let S of r)if(!S.participantId)return{error:Pe,scaledParticipant:S};let m=0;for(;m<r.length;){for(let S of f){if(m+1>r.length)break;let w=r[m];S.individualParticipantIds.push(w.participantId),m++}f.reverse()}let g=f.map(ai);for(let S of a.events??[]){if(S.eventType!==al)continue;let w=(S.entries??[]).filter(U=>g.includes(U.participantId));for(let U of w){let D=U.participantId,E=(T=f.find(M=>M.participantId===D))==null?void 0:T.individualParticipantIds;S.entries=(S.entries??[]).filter(M=>!E.includes(M.participantId)),(S.drawDefinitions??[]).forEach(M=>{M.entries=(M.entries??[]).filter(N=>!E.includes(N.participantId))});let{flightProfile:C}=Kn({event:S});((C==null?void 0:C.flights)||[]).forEach(M=>{M.drawEntries=(M.drawEntries||[]).filter(N=>!E.includes(N.participantId))})}}return{...ae,scaledParticipants:r}}function tse(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:On};for(let i of Object.values(e)){let n=DMe({...t,tournamentRecord:i});if(n.error&&n.error!==xI)return n}return{...ae}}function DMe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:Ge};if(!e)return{error:aV};let i=(t==null?void 0:t.participants)??[],n=[],r=!1,o;return i.forEach(a=>{let s=!1;a.penalties=(a.penalties??[]).filter(l=>(l.penaltyId===e&&(s=!0,r||(o=l,r=!0)),s&&n.push(a),l.penaltyId!==e))}),o&&di({topic:wo,payload:{tournamentId:t.tournamentId,participants:n}}),o?{...ae,penalty:o}:{error:xI}}var PMe=({penaltyId:t=ji()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t}),ise=PMe;function nse(t){let{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:On};for(let i of Object.values(e)){let n=CMe({...t,tournamentRecord:i});if(n.error&&n.error!==xI||n.success)return n}return{error:xI}}function CMe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:Ge};if(!e)return{error:Pe,modifications:e};if(!i)return{error:aV};let n=(t==null?void 0:t.participants)??[],r=Object.keys(ise()).filter(l=>l!=="penaltyId"),o=Object.keys(e).filter(l=>r.includes(l));if(!o.length)return{error:QN};let a,s=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,o.forEach(d=>Object.assign(u,{[d]:e[d]})),a||(a=u)),u)),c&&s.push(l)}),a&&di({topic:wo,payload:{tournamentId:t.tournamentId,participants:s}}),a?{...ae,penalty:a}:{error:xI}}function rse(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:Zt(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(!e[r])n[r]=t[r];else if(!t[r])n[r]=e[r];else if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){let o=Zt(t[r].map(a=>JSON.stringify(a)).concat(e[r].map(a=>JSON.stringify(a)))).map(a=>JSON.parse(a));n[r]=o}else n[r]=e[r];else typeof t[r]=="object"?n[r]=rse(t[r],e[r],i):n[r]=e[r];return n},{})}function ose({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:Ge};e.participants||(e.participants=[]);let n=t.filter(as(hd)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),o=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){let u=rse(c,r[c.participantId],i);return o.push(u),u}return c});let a=e.participants.map(as(hd))||[],s=t.filter(({participantId:c})=>!a.includes(c)),{topics:l}=pl();return s.length&&(e.participants=e.participants.concat(...s),l.includes(qh)&&di({topic:qh,payload:{participants:s}})),o.length&&l.includes(wo)&&di({topic:wo,payload:{tournamentId:e.tournamentId,participants:o}}),{modifiedParticipantsCount:o.length,newParticipantsCount:s.length,...ae}}function ase(t){var o;let{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r;for(let a of Object.values(n)){let s=(o=zn({tournamentRecord:a}).participants??[])==null?void 0:o.map(ai).filter(l=>i.includes(l));s.length&&(r=EMe({...t,penaltyId:t.penaltyId??r,tournamentRecord:a,participantIds:s}).penaltyId)}return r?{...ae,penaltyId:r}:{error:Jn}}function EMe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:o,penaltyId:a,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:Ge};if(!i)return{error:Rr};if(!r)return{error:dQ};let u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:Jn};let d=new Date().toISOString(),p=Object.assign(ise({penaltyId:a}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,createdAt:d,issuedAt:l,notes:c});return Array.isArray(o)&&o.forEach(h=>Ui({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),di({topic:wo,payload:{tournamentId:e.tournamentId,participants:u}}),{...ae,penaltyId:p.penaltyId}}function sse({participantRole:t=Mo,tournamentRecord:e,persons:i}){var f;if(!e)return{error:Ge};if(!Array.isArray(i))return{error:Pe};if(!Object.keys(Pf).includes(t))return{error:eQ};let n=(e.participants||[]).map(({person:m})=>m==null?void 0:m.personId).filter(Boolean),r=[],o=i.filter(m=>m&&(!m.personId||!n.includes(m.personId))).map(m=>(m.personId||(m.personId=ji()),r.push(m.personId),m)),a=(m,g)=>Object.assign({},...Object.keys(m).filter(v=>!g.includes(v)).map(v=>({[v]:m[v]}))),s=o.map(m=>wt({extensions:m.participantExtensions,timeItems:m.participantTimeItems,participantType:si,participantRole:t,person:a(m,["participantExtensions","participantTimeItems","pairedPersons"])})),l=0,c=0,u=Oc({participants:s,tournamentRecord:e});if(u.error)return u;c=u.addedCount||0;let d=[],p=((f=zn({participantFilters:{participantTypes:[si]},tournamentRecord:e}))==null?void 0:f.participants)??[];if(t===Mo&&i.filter(({pairedPersons:m})=>m).forEach(({personId:m,pairedPersons:g})=>{Array.isArray(g)&&g.forEach(v=>{let y=[m,v.personId].map(b=>zh({tournamentParticipants:p,personId:b})).filter(Boolean);if(y.length===2){let b=y.map(ai);d.push(wt({extensions:v.participantExtensions,timeItems:v.timeItems,participantRole:Mo,individualParticipantIds:b,participantType:jt}))}})}),d.length){if(u=Oc({participants:d,tournamentRecord:e}),u.error)return u;l=u.addedCount||0}let h=c+l;return{...ae,addedCount:h,newPersonIds:r}}var x_={};ii(x_,{bulkUpdatePublishedEventIds:()=>XH,getAllEventData:()=>JH,getCourtInfo:()=>DA,getDrawData:()=>o_,getEventData:()=>a_,getEventPublishStatus:()=>fl,getPublishState:()=>ky,getVenueData:()=>qI,mutate:()=>lse,publishEvent:()=>D0,publishEventSeeding:()=>cse,publishOrderOfPlay:()=>pse,query:()=>eoe,setEventDisplay:()=>b_,unPublishEvent:()=>hse,unPublishEventSeeding:()=>use,unPublishOrderOfPlay:()=>dse});var lse={};ii(lse,{publishEvent:()=>D0,publishEventSeeding:()=>cse,publishOrderOfPlay:()=>pse,setEventDisplay:()=>b_,unPublishEvent:()=>hse,unPublishEventSeeding:()=>use,unPublishOrderOfPlay:()=>dse});function cse({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=ic,drawIds:o=[],event:a}){var d,p,h,f;if(!n)return{error:Ge};if(!a)return{error:Vi};let s=fl({event:a,status:r}),l=(((d=s==null?void 0:s.seeding)==null?void 0:d.seedingScaleNames)||i)&&{...(p=s==null?void 0:s.seeding)==null?void 0:p.seedingScaleNames,...i},c=(((h=s==null?void 0:s.seeding)==null?void 0:h.stageSeedingScaleNames)||e)&&{...(f=s==null?void 0:s.seeding)==null?void 0:f.stageSeedingScaleNames,...e},u=wt({stageSeedingScaleNames:c,seedingScaleNames:l,published:!0,drawIds:o});return U0({statusObject:{seeding:u},removePriorValues:t,status:r,event:a}),di({topic:Mee,payload:{tournamentId:n.tournamentId,eventId:a.eventId,drawIds:o}}),{...ae}}function use({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=ic,drawIds:r,stages:o,event:a}){var l,c;if(!i)return{error:Ge};if(!a)return{error:Vi};let s=fl({event:a});if(s){let u=s.seeding;if(Array.isArray(o)&&u.stageSeedingScaleNames)for(let d of o)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&(u!=null&&u.seedingScaleNames)&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&(u!=null&&u.drawIds)&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(!Object.values(u.stageSeedingScaleNames??{}).length&&!((l=u.seedingScaleNames)!=null&&l.length)&&!((c=u.drawIds)!=null&&c.length)||!o&&!e&&!(r!=null&&r.length))&&(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),U0({statusObject:{seeding:u},removePriorValues:t,status:n,event:a})}return di({topic:fj,payload:{tournamentId:i.tournamentId,eventId:a.eventId}}),{...ae}}function dse(t){let e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:On};for(let i of Object.values(e)){let n=MMe({tournamentRecord:i,...t});if(n.error)return n}return{...ae}}function MMe({removePriorValues:t=!0,tournamentRecord:e,status:i=ic}){if(!e)return{error:Ge};let n=`${ug}.${dg}`,{timeItem:r}=Fu({element:e,itemType:n}),o=(r==null?void 0:r.itemValue)||{[i]:{}};return o[i]&&delete o[i].orderOfPlay,Cf({timeItem:{itemValue:o,itemType:n},element:e,removePriorValues:t}),di({topic:mj,payload:{tournamentId:e.tournamentId}}),{...ae}}function pse(t){let e=Ou(t);if(!Object.keys(e).length)return{error:On};for(let i of Object.values(e)){let n=RMe({tournamentRecord:i,...t});if(n.error)return n}return{...ae}}function RMe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=ic,eventIds:r=[]}){if(!i)return{error:Ge};let o=`${ug}.${dg}`,{timeItem:a}=Fu({element:i,itemType:o}),s=(a==null?void 0:a.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},Cf({timeItem:{itemValue:s,itemType:o},element:i,removePriorValues:e}),di({topic:Ree,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...ae}}function hse({removePriorValues:t=!0,tournamentRecord:e,status:i=ic,event:n}){if(!e)return{error:Ge};if(!n)return{error:Vi};let r=`${ug}.${dg}`,{timeItem:o}=VD({itemType:r,event:n}),a=(o==null?void 0:o.itemValue)||{[i]:{}};return delete a[i].structureIds,delete a[i].drawDetails,delete a[i].drawIds,By({event:n,timeItem:{itemValue:a,itemType:r},removePriorValues:t}),U0({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),di({topic:hj,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...ae}}var tz={};ii(tz,{getEntryStatusReports:()=>AMe,getParticipantStats:()=>NMe,getStructureReports:()=>kMe,getVenuesReport:()=>OMe});function NMe({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:o,tallyPolicy:a,matchUps:s}){var w,U,D,E,C;if(!r)return{error:Ge};if(s&&!Array.isArray(s))return{error:Sa};if(s=s??to({tournamentRecord:r,participantsProfile:o?{withScaleValues:o}:void 0}).matchUps,!(s!=null&&s.length))return{error:kd};let l=[];e&&l.push(e),n&&l.push(n);let c=l.length?{participantIds:l}:{participantTypes:[el]},u=zn({participantFilters:c,tournamentRecord:r}).participants??[];if(!u.every(({participantType:M})=>M===el))return{error:xl};l.length||l.push(...u.map(ai));let d=new Map,p=new Map,h=new Map,f=new Map,m=(M,N="")=>p.get(M)||p.set(M,{participantName:N,participantId:M,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&p.get(M);for(let M of u){let{participantId:N,individualParticipantIds:R}=M;f.set(N,R??[]),m(N,M.participantName)}if(n&&!f.get(n))return se({result:{error:Jn},context:{teamParticipantId:n}});if(e&&!f.get(e))return se({result:{error:Jn},context:{opponentParticipantId:e}});let g=[],v=M=>{let N=[[],[]];for(let A of M){let _=A.participant;if(_!=null&&_.participantName){d.set(_.participantId,{participantName:_.participantName,ratings:_.ratings});let k=p.get(_.participantId);k&&(k.participantName=_.participantName)}}let R=({side:A,individualParticipantIds:_})=>{var k,O,F,B,$;return A.participantId&&(!(_!=null&&_.length)||_.includes(A.participantId))&&[A.participantId]||((O=(k=A.participant)==null?void 0:k.individualParticipantIds)==null?void 0:O.length)&&(!(_!=null&&_.length)||Hn(_,(F=A.participant)==null?void 0:F.individualParticipantIds).length===(($=(B=A.participant)==null?void 0:B.individualParticipantIds)==null?void 0:$.length))&&A.participant.individualParticipantIds};if(f.size){let A=(_,k)=>{for(let O of M){if(!O.participant)continue;let F=R({individualParticipantIds:k,side:O});if(F!=null&&F.length){let B=O.sideNumber;if(!B)continue;let $=[_];i&&$.push(...F),N[B-1]=$;let V=p.get(_);for(let H of F.filter(Boolean))V&&!V.competitorIds.includes(H)&&V.competitorIds.push(H)}}};if(n)(!e||M.every(_=>_.participant&&(R({individualParticipantIds:f.get(n),side:_})||R({individualParticipantIds:f.get(e),side:_}))))&&A(n,f.get(n));else for(let[_,k]of f)A(_,k)}else if(i)for(let A of M){if(!A.participant)continue;let _=R({individualParticipantIds:[],side:A}),k=A.sideNumber;k&&(N[k-1]=_)}return N};for(let M of s){if(!ln(M))return{error:Sa};let{matchUpStatus:N,matchUpFormat:R,matchUpType:A,winningSide:_,score:k,sides:O}=M;if(!O||!k||A===Su||N===Ni)continue;let F=v(O);if(!F.filter(Boolean).length)continue;let B=t&&_&&((w=OD({matchUp:M}))==null?void 0:w.competitiveness);g.push(M);let $=iH({matchUpStatus:N,matchUpFormat:R,tallyPolicy:a,winningSide:_,score:k}),V=Iie({matchUpStatus:N,matchUpFormat:R,tallyPolicy:a,winningSide:_,score:k}),{pointsTally:H,tiebreaksTally:z}=wie({matchUpFormat:R,score:k});F.forEach((G,W)=>{var K;for(let Z of G){let Y=(K=d.get(Z))==null?void 0:K.participantName,X=m(Z,Y);if(X){let Q=(ne,re)=>re.forEach((me,he)=>X[ne][he]+=me),te=W?[...z].reverse():z,J=W?[...H].reverse():H,ie=W?[...V].reverse():V,oe=W?[...$].reverse():$;if(Q("tiebreaks",te),Q("points",J),Q("games",ie),Q("sets",oe),_){let ne=_-1===W?0:1;X.matchUps[ne]+=1}if(B){let ne=B.toLowerCase();X.competitiveness[ne]||(X.competitiveness[ne]=[0,0]),X.competitiveness[ne][W]+=1}if(N){let ne=N.toLowerCase();X.matchUpStatuses[ne]||(X.matchUpStatuses[ne]=0),X.matchUpStatuses[ne]+=1}}}})}let y=["tiebreaks","matchUps","points","games","sets"],b=["competitive","routine","decisive"],I=new Map,T=(M,N)=>(M??0)+(N??0);for(let[M,N]of p.entries()){for(let R of y){let A=N[R].reduce(T);if(A){let _=N[R][0]/A,k=`${R}Ratio`,O=parseFloat(_.toFixed(2));N[k]=O,h.set(M,!0),I.has(k)||I.set(k,[]),(U=I.get(k))==null||U.push(O)}}for(let R of b){let A=(E=(D=N.competitiveness)==null?void 0:D[R])==null?void 0:E.reduce(T);if(A){let _=N.competitiveness[R][0]/A,k=`${R}Ratio`,O=parseFloat(_.toFixed(2));N[k]=O}}}if(!n){let M=(N,R)=>R-N;for(let N of p.values())for(let R of y){let A=`${R}Ratio`;if(typeof N[A]=="number"){let _=(C=I.get(A))==null?void 0:C.sort(M).indexOf(N[A]);if(typeof _=="number"&&_>=0){let k=`${R}Rank`;N[k]=_+1}}}}let S={relevantMatchUps:g,...ae};return n?(S.teamStats=p.get(n),e&&(S.opponentStats=p.get(e))):S.participatingTeamsCount=h.size,S.allParticipantStats=[...p.values()],S}function KM({participant:t,eventType:e}){var c,u,d,p,h,f;let i=(c=t==null?void 0:t.person)==null?void 0:c.personId,n=(d=(u=t==null?void 0:t.person)==null?void 0:u.personOtherIds)==null?void 0:d[0],r=(p=t==null?void 0:t.person)==null?void 0:p.tennisId,o=(f=(h=t==null?void 0:t.ratings)==null?void 0:h[e])==null?void 0:f.find(({scaleName:m})=>m===DH),a=o==null?void 0:o.scaleValue,{wtnRating:s,confidence:l}=a||{};return{timeStamp:o==null?void 0:o.scaleDate,personOtherId:n,confidence:l,wtnRating:s,personId:i,tennisId:r}}function AMe({tournamentRecord:t}){if(!t)return{error:Ge};let e=t.tournamentId,{participantMap:i}=zn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(to({matchUpFilters:{matchUpTypes:[uv,Cm]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===Cm?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],o={},a={},s={},l=0,c=({id:h,entry:f,eventId:m,eventType:g})=>{var E;let{qualifyingSeeding:v,mainSeeding:y,entryStatus:b,entryStage:I,drawId:T}=f;o[h]||(o[h]=[]);let{participant:S,events:w}=(i==null?void 0:i[h])??{},U=KM({participant:S,eventType:g}),D=(E=w==null?void 0:w[m])==null?void 0:E.ranking;b===gH&&r.push(h),o[h].push({participantType:S==null?void 0:S.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:T,entryStatus:b,entryStage:I,...U,ranking:D,mainSeeding:y,qualifyingSeeding:v})};for(let h of t.events??[]){let f={},m=w=>{f[w]||(f[w]={count:0}),f[w].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(w=>{let{drawId:U,entries:D}=w;l+=1;let E=({stage:R,stageSequence:A})=>R===ut&&A===1||R===Tt,C=(w.structures??[]).filter(E).flatMap(({positionAssignments:R})=>R).filter(Boolean).map(({participantId:R})=>R),M=({participantId:R})=>C.includes(R),N=R=>{var F,B,$,V,H,z,G,W;let{participantId:A,entryStatus:_,entryStage:k}=R;m(_);let O=(V=($=(B=(F=i==null?void 0:i[A])==null?void 0:F.draws)==null?void 0:B[U])==null?void 0:$.seedAssignments)==null?void 0:V[ut];return{qualifyingSeeding:(W=(G=(z=(H=i==null?void 0:i[A])==null?void 0:H.draws)==null?void 0:z[U])==null?void 0:G.seedAssignments)==null?void 0:W[Tt],participantId:A,mainSeeding:O,entryStatus:_,entryStage:k,drawId:U}};return D==null?void 0:D.filter(M).map(N)}),I=w=>{var E;let U=w.participantId,D=(E=i==null?void 0:i[U].participant.individualParticipantIds)==null?void 0:E.filter(C=>n.includes(C));return U&&{[U]:{individualParticipantIds:D}}};v===Zh?(()=>{let w=Object.assign({},...b.map(I).filter(Boolean)),U=D=>{w[D.participantId].individualParticipantIds.forEach(E=>{c({id:E,eventType:v,eventId:y,entry:D})})};b.forEach(U)})():b.forEach(w=>{c({id:w==null?void 0:w.participantId,eventType:v,eventId:y,entry:w})});let T=Object.values(f).reduce((w,U)=>w+U.count,0);Object.keys(f).forEach(w=>{f[w].pct=f[w].count/T*100}),s[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};let S=Object.assign({},...ec.flatMap(w=>{var U,D;return[{[w+"_count"]:(U=f[w])==null?void 0:U.count},{[w+"_pct"]:(D=f[w])==null?void 0:D.pct}]}));a[y]={tournamentId:e,eventId:y,...S}}let u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===si&&f===Mo),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(a).flat(),participantEntryReports:Object.values(o).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}}function _Me({eventType:t,matchUps:e,eventId:i,drawId:n}){let r={},o=f=>{let m=f==null?void 0:f.matchUpFormat;m&&(r[m]||(r[m]=0),r[m]+=1)},a=e.filter(f=>i?f.eventId===i:f.drawId===n).reduce((f,m)=>(o(m),(m.sides??[]).flatMap(g=>{var v;return(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[g==null?void 0:g.participant]).filter(Boolean)}).forEach(g=>f[g.participantId]=g),f),{}),s=Object.values(a),l=s.map(f=>KM({participant:f,eventType:t})).filter(({wtnRating:f})=>f),c=(s.length-l.length)/s.length*100,u=l.reduce((f,m)=>{let{wtnRating:g,confidence:v}=m;return f.totalWTN+=g,f.totalConfidence+=v,f},{totalWTN:0,totalConfidence:0}),d=l!=null&&l.length?u.totalWTN/l.length:0,p=l!=null&&l.length?u.totalConfidence/l.length:0,h=Object.values(r).reduce((f,m)=>f+(m||0),0);return{matchUpFormatCounts:r,matchUpsCount:h,avgConfidence:p,pctNoRating:c,avgWTN:d}}function kMe({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var c;if(!i)return{error:AI};let n={},r=Object.assign({},...(e??[]).map(({name:u,label:d,accessor:p})=>{var m,g,v;let h=(g=(m=Qt({element:i,name:u}))==null?void 0:m.extension)==null?void 0:g.value,f=p?(v=dv({element:h,accessor:p}))==null?void 0:v.value:h;return{[d||u]:f}})),o=i==null?void 0:i.tournamentId,a=to({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],s=u=>{var d,p,h;return(h=(p=(d=Fu({itemType:nj,itemSubTypes:[rd],element:{timeItems:u}}))==null?void 0:d.timeItem)==null?void 0:p.itemValue)==null?void 0:h.scaleBasis},l=(c=i==null?void 0:i.events)==null?void 0:c.flatMap(({timeItems:u,drawDefinitions:d=[],extensions:p,eventType:h,eventId:f,category:m})=>{var S,w,U,D,E;let g=(U=(w=(S=p==null?void 0:p.find(C=>C.name===Vl))==null?void 0:S.value)==null?void 0:w.flights)==null?void 0:U.map(C=>({[C.drawId]:C.flightNumber})),v=g&&Object.assign({},...g),y=((E=(D=p==null?void 0:p.find(C=>C.name===DM))==null?void 0:D.value)==null?void 0:E.length)||0,b=Object.values(v),I=v&&Math.min(...b),T=s(u);return n[f]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:y,seedingBasis:T?JSON.stringify(T):void 0,tournamentId:o,eventId:f},d.filter(C=>!t||!g||v[C.drawId]===I).flatMap(C=>{let{matchUpFormat:M,tieFormat:N,timeItems:R,extensions:A,structures:_,drawType:k,drawId:O}=C,{matchUpFormatCounts:F,matchUpsCount:B,avgConfidence:$,pctNoRating:V,avgWTN:H}=_Me({eventType:h,matchUps:a,drawId:O}),z=s(R)||T,G=xMe({extensions:A}),W=(G==null?void 0:G.length)||0;return n[f].totalPositionManipulations+=W,n[f].generatedDrawsCount+=1,W>n[f].maxPositionManipulations&&(n[f].maxPositionManipulations=W),_==null?void 0:_.filter(K=>K.stageSequence===1&&[Tt,ut,Io,$n].includes(K.stage)).map(K=>{var fe,Te,ue;let Z=[ut,$n].includes(K.stage)?a.find(de=>de.structureId===K.structureId&&de.finishingRound===1&&de.winningSide):void 0,Y=(Te=(fe=Z==null?void 0:Z.sides)==null?void 0:fe.find(de=>de.sideNumber===Z.winningSide))==null?void 0:Te.participant,X=(Y==null?void 0:Y.participantType)===el&&Y.participantId,Q=(Y==null?void 0:Y.participantType)===jt?Y.individualParticipants:[],te=KM({participant:(Q==null?void 0:Q[0])||Y,eventType:h}),{personId:J,personOtherId:ie,tennisId:oe,confidence:ne,wtnRating:re}=te||{},me=KM({participant:Q==null?void 0:Q[1],eventType:h}),{personId:he,personOtherId:be,tennisId:Se,confidence:De,wtnRating:Oe}=me||{},{ageCategoryCode:xe,categoryName:$e,subType:Ae}=m??{},ve=K.matchUpFormat||M,ke=(F[ve]||0)/B*100,{tieFormatName:ye,tieFormatDesc:Ie}=GM(N),{tieFormatName:Ne,tieFormatDesc:Fe}=GM(K.tieFormat),Le=Ie===Fe,ge=!Le&&Ne,Ee=K.tieFormat&&!Le&&Fe,we=((ue=G==null?void 0:G.filter(de=>de.structureId===K.structureId))==null?void 0:ue.length)||0;return{...r,tournamentId:o,eventId:f,structureId:K.structureId,drawId:O,eventType:h,category:Ae,categoryName:$e,ageCategoryCode:xe,flightNumber:v[O],drawType:k,stage:K.stage,seedingBasis:z?JSON.stringify(z):void 0,winningPersonId:J,winningPersonOtherId:ie,winningPersonTennisId:oe,winningPersonWTNrating:re,winningPersonWTNconfidence:ne,winningPerson2Id:he,winningPerson2OtherId:be,winningPerson2TennisId:Se,winningPerson2WTNrating:Oe,winningPerson2WTNconfidence:De,winningTeamId:X,positionManipulations:we,pctNoRating:V,matchUpFormat:ve,pctInitialMatchUpFormat:ke,matchUpsCount:B,drawTieFormatName:ye,drawTieFormatDesc:Ie,tieFormatName:ge,tieFormatDesc:Ee,avgConfidence:$,avgWTN:H}})})});return{eventStructureReports:Object.values(n),structureReports:l}}function xMe({extensions:t}){var e,i;return(i=(e=t==null?void 0:t.find(({name:n})=>n===UM))==null?void 0:e.value)==null?void 0:i.slice(1)}function OMe({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var u,d;if(!Array.isArray(r))return{error:Pe,dates:r};if(!Array.isArray(n))return{error:Pe,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:On};if(!r.every(ws))return{error:aa};let o=zp({tournamentRecords:e,ignoreDisabled:t,dates:r});if(o.error)return o;let a=(u=o==null?void 0:o.venues)==null?void 0:u.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),s=(d=o.courts)==null?void 0:d.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{let g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),l={venueIds:a==null?void 0:a.map(({venueId:p})=>p)},{matchUps:c}=xc({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:l});return{venuesReport:a==null?void 0:a.map(p=>LMe(s,p,c))}}function LMe(t,e,i){let{venueId:n,courts:r,venueName:o}=e,a={};return t.forEach(s=>{var h;let l=0,c=0,u=0;for(let f of r){let m=f.dateAvailability.find(v=>v.date===s),g=(h=m&&P0({courtDate:m}).timeSlots)==null?void 0:h.reduce((v,y)=>{let{startTime:b,endTime:I}=y,T=mi(I)-mi(b);return v+T},0);g&&(u+=1),l+=g}let d=i.filter(({schedule:f})=>f.venueId===n&&gd(s,f.scheduledDate));d.forEach(({schedule:f})=>{let m=hn(f.scheduledTime),g=xa(m,f.averageMinutes),v=mi(g)-mi(m);c+=v});let p=l?(c/l*100).toFixed(2):"100";a[s]={scheduledMatchUpsCount:d.length,availableCourts:u,availableMinutes:l,scheduledMinutes:c,percentUtilization:p}}),{venueId:n,venueName:o,venueReport:a}}var iz={};ii(iz,{addMatchUpCourtOrder:()=>OG,addMatchUpEndTime:()=>FG,addMatchUpOfficial:()=>tae,addMatchUpResumeTime:()=>$G,addMatchUpScheduleItems:()=>C_,addMatchUpScheduledDate:()=>E_,addMatchUpScheduledTime:()=>Mf,addMatchUpStartTime:()=>LG,addMatchUpStopTime:()=>BG,addSchedulingProfileRound:()=>XG,allocateTeamMatchUpCourts:()=>P_,assignMatchUpCourt:()=>Gy,assignMatchUpVenue:()=>E0,bulkRescheduleMatchUps:()=>wse,bulkScheduleMatchUps:()=>TP,bulkScheduleTournamentMatchUps:()=>iU,bulkUpdateCourtAssignments:()=>vse,calculateScheduleTimes:()=>nz,clearMatchUpSchedule:()=>Tse,clearScheduledMatchUps:()=>N_,courtGridRows:()=>oG,findMatchUpFormatTiming:()=>s_,findVenue:()=>Vp,generateBookings:()=>R_,generateVirtualCourts:()=>w_,getPersonRequests:()=>vg,getProfileRounds:()=>c_,getScheduledRoundsDetails:()=>pP,getSchedulingProfile:()=>Wp,getSchedulingProfileIssues:()=>QH,matchUpScheduleChange:()=>Sse,modifyMatchUpFormatTiming:()=>IG,mutate:()=>fse,proAutoSchedule:()=>gse,proConflicts:()=>bse,publicFindCourt:()=>lte,query:()=>roe,removeEventMatchUpFormatTiming:()=>v_,removeMatchUpCourtAssignment:()=>mse,reorderUpcomingMatchUps:()=>Ise,scheduleMatchUps:()=>yse,scheduleProfileRounds:()=>A_,setMatchUpDailyLimits:()=>Use,setSchedulingProfile:()=>T0,toggleParticipantCheckInState:()=>T_,validateSchedulingProfile:()=>l_});var fse={};ii(fse,{addMatchUpCourtOrder:()=>OG,addMatchUpEndTime:()=>FG,addMatchUpOfficial:()=>tae,addMatchUpResumeTime:()=>$G,addMatchUpScheduleItems:()=>C_,addMatchUpScheduledDate:()=>E_,addMatchUpScheduledTime:()=>Mf,addMatchUpStartTime:()=>LG,addMatchUpStopTime:()=>BG,addSchedulingProfileRound:()=>XG,allocateTeamMatchUpCourts:()=>P_,assignMatchUpCourt:()=>Gy,assignMatchUpVenue:()=>E0,bulkRescheduleMatchUps:()=>wse,bulkScheduleMatchUps:()=>TP,bulkScheduleTournamentMatchUps:()=>iU,bulkUpdateCourtAssignments:()=>vse,calculateScheduleTimes:()=>nz,clearMatchUpSchedule:()=>Tse,clearScheduledMatchUps:()=>N_,courtGridRows:()=>oG,findMatchUpFormatTiming:()=>s_,findVenue:()=>Vp,generateBookings:()=>R_,generateVirtualCourts:()=>w_,matchUpScheduleChange:()=>Sse,modifyMatchUpFormatTiming:()=>IG,proAutoSchedule:()=>gse,proConflicts:()=>bse,publicFindCourt:()=>lte,removeEventMatchUpFormatTiming:()=>v_,removeMatchUpCourtAssignment:()=>mse,reorderUpcomingMatchUps:()=>Ise,scheduleMatchUps:()=>yse,scheduleProfileRounds:()=>A_,setMatchUpDailyLimits:()=>Use,setSchedulingProfile:()=>T0,toggleParticipantCheckInState:()=>T_,validateSchedulingProfile:()=>l_});function nz({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:o,periodLength:a,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof o!="object"||!Object.keys(o).length)return{error:On};a=a??S_({recoveryMinutes:e,averageMatchUpMinutes:i});let{courts:d,venues:p}=zp({dates:[s],ignoreDisabled:!0,tournamentRecords:o}),h=d==null?void 0:d.filter(E=>!c||c.includes(E.venueId));l||(l=h==null?void 0:h.reduce((E,C)=>{var N,R;let M=((R=(N=C.dateAvailability)==null?void 0:N.find(A=>!A.date||gd(s,A.date)))==null?void 0:R.startTime)??C.startTime;return M&&(!E||mi(M)<mi(E))?M:E},void 0)),u||(u=h==null?void 0:h.reduce((E,C)=>{var N,R;let M=((R=(N=C.dateAvailability)==null?void 0:N.find(A=>!A.date||gd(s,A.date)))==null?void 0:R.endTime)??C.endTime;return M&&(!E||mi(M)>mi(E))?M:E},void 0));let f=Object.values(o),m=Object.assign({},...f.map(E=>(E.events??[]).map(C=>{let{scheduleTiming:M}=LD({tournamentRecord:E,event:C});return{[C.eventId]:{event:C,scheduleTiming:M}}})).flat()),g=mP({sortDateMatchUps:!1,tournamentRecords:o,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);let I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:E,schedule:C,matchUpFormat:M})=>{let{event:N,scheduleTiming:R}=m[E],A=N==null?void 0:N.eventType,_={...R,defaultTiming:I,matchUpFormat:M},{averageMinutes:k,recoveryMinutes:O}=UA({eventType:A,timingDetails:_}),{courtId:F,venueId:B}=C,$=hn(C.scheduledTime),V=xa($,k);return{recoveryMinutes:O,averageMinutes:k,periodLength:a,startTime:$,endTime:V,courtId:F,venueId:B}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:a,startTime:l,endTime:u,bookings:T,courts:h},{scheduleTimes:w}=MG(S),U=(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,D=b.map(Br);return{venueId:U,scheduleTimes:w,dateScheduledMatchUpIds:D}}function mse(t){var h;let e=Ei(t,[{[ko]:!0}]);if(e.error)return e;let{removePriorValues:i,tournamentRecords:n,tournamentId:r,courtDayDate:o,matchUpId:a,courtId:s,drawId:l}=t,c=n[r];if(!c)return{error:Ge};let{drawDefinition:u,event:d}=Ef({tournamentRecord:c,drawId:l});if(!u)return{error:lt};let p=fn({drawDefinition:u,event:d,matchUpId:a});if(p.error)return p;if(((h=p==null?void 0:p.matchUp)==null?void 0:h.matchUpType)===Su){let{itemValue:f}=pg({timeItems:p.matchUp.timeItems??[],itemType:Ip}),m=s&&f.filter(g=>g.courtId!==s);return Ps({duplicateValues:!1,removePriorValues:i,tournamentRecord:c,drawDefinition:u,matchUpId:a,timeItem:{itemType:Ip,itemValue:m}})}else return Gy({tournamentRecord:c,drawDefinition:u,courtDayDate:o,courtId:"",matchUpId:a})}function gse({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!hl(n))return{error:Pe};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:XN};let r=mP({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;let{rows:o}=r,a=[],s=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=o==null?void 0:o.reduce((h,f)=>{let m=[],g=[];Object.values(f).forEach(y=>{if(ln(y)&&(y.matchUpId&&(m.push(y.matchUpId),a.push(y)),y.sides)){let b=s(y);g.push(...b)}});let v=Object.values(f).filter(y=>ln(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==Ni&&(t||!Nr.includes(h))).sort(_y);let c=nc({matchUps:n.concat(a),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){let h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){let m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(U=>c[v].matchUpIds.includes(U)),I=v&&d.some(U=>c[v].dependentMatchUpIds.includes(U)),T=h.matchUpIds.some(U=>y.includes(U)),S=s(g),w=h.participantIds.some(U=>S.includes(U));if(g&&!T&&!b&&!w&&!I){let U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),u.push(g),h.participantIds.push(...S),h.matchUpIds.push(v)}else g&&f.push(g)}n.push(...f),d.push(...h.matchUpIds)}let p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=TP({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function vse(t){let{courtDayDate:e}=t,i=Ei(t,[{courtAssignments:!0,[Sf]:Xa,[fd]:gt},{[ko]:!0}]);if(i.error)return i;let n=t.courtAssignments.reduce((o,a)=>{let{tournamentId:s}=a;return o[s]||(o[s]=[]),o[s].push(a),o},{}),r;return Object.keys(n).every(o=>{let a=t[ko][o];if(!a)return r={error:Ge},!1;let s=n[o].reduce((l,c)=>{let{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{let{drawDefinition:c}=Ta({tournamentRecord:a,drawId:l});return c?(s[l].every(u=>{let{matchUpId:d,courtId:p}=u,h=Gy({tournamentRecord:a,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:wQ}}),!0):(r={error:lt},!1)})}),r||ae}function yse(t){let{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:a={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=Ei(t,[{[ko]:!0,[vD]:!0},{[yc]:ws,[fd]:aa,[bSe]:!0},{[yc]:G=>!G||!isNaN(G),[TSe]:!1,[fd]:Pe,[USe]:!1,[DSe]:!1}]);if(I.error)return I;let T=t.competitionMatchUps??xc({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??nc({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(G=>{var W;(W=G.schedule)!=null&&W.scheduledDate&&gd(f,Wt(G.schedule.scheduledDate))&&ew({matchUpPotentialParticipantIds:a,matchUpNotBeforeTimes:l,matchUp:G})});let w=m.map(G=>T.find(W=>W.matchUpId===G)).filter(Boolean),{venueId:U,scheduleTimes:D,dateScheduledMatchUpIds:E}=nz({tournamentRecords:e,remainingScheduleTimes:d,startTime:hn(v),endTime:hn(y),scheduleDate:Wt(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),C={},M=[],N={},R={},A={};T.filter(({matchUpId:G})=>E==null?void 0:E.includes(G)).forEach(G=>{var K;D2({matchUpPotentialParticipantIds:a,individualParticipantProfiles:s,matchUp:G,value:1});let W=(K=G.schedule)==null?void 0:K.scheduledTime;if(W){N[G.matchUpId]=W;let Z=o==null?void 0:o[G.matchUpId];tU({recoveryMinutes:Z||r,matchUpPotentialParticipantIds:a,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:S,scheduleTime:W,matchUp:G})}});let _=w.filter(G=>{let W=E==null?void 0:E.includes(G.matchUpId),K=[Ni,Pi,or,Us,Go,Oi].includes(G==null?void 0:G.matchUpStatus);return!W&&!G.winningSide&&!K}),{matchUpMap:k,overLimitMatchUpIds:O,participantIdsAtLimit:F}=_.reduce((G,W)=>{let{drawId:K,tournamentId:Z,matchUpType:Y}=W,{participantIdsAtLimit:X,relevantParticipantIds:Q}=YG({individualParticipantProfiles:s,matchUpPotentialParticipantIds:a,matchUpDailyLimits:c,matchUp:W});return X!=null&&X.length?(G.overLimitMatchUpIds.push(W.matchUpId),G.participantIdsAtLimit.push(...X),G):(Q.forEach(te=>{wP({individualParticipantProfiles:s,participantId:te});let J=s[te].counters;J[Y]?J[Y]+=1:J[Y]=1,J[Ll]?J[Ll]+=1:J[Ll]=1}),G.matchUpMap[Z]||(G.matchUpMap[Z]={}),G.matchUpMap[Z][K]?G.matchUpMap[Z][K].push(W):G.matchUpMap[Z][K]=[W],ew({matchUpPotentialParticipantIds:a,matchUpNotBeforeTimes:l,matchUp:W}),G)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:G})=>!O.includes(G));let B=0,$=(D==null?void 0:D.length)??0,{personRequests:V}=vg({tournamentRecords:e,requestType:SP});for(;D!=null&&D.length&&_.length&&B<=$;){B++;let{scheduleTime:G}=D.shift(),W=_.find(K=>{let{matchUpId:Z}=K,{dependenciesScheduled:Y,remainingDependencies:X}=zG({matchUpScheduleTimes:N,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:K});if(!Y)return A[Z]||(A[Z]=[]),A[Z].push({scheduleTime:G,remainingDependencies:X}),!1;let{enoughTime:Q}=qG({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:G,matchUp:K});if(!Q)return R[Z]||(R[Z]=[]),R[Z].push({scheduleTime:G}),!1;let{conflicts:te}=WG({potentials:u,averageMatchUpMinutes:n,requestConflicts:C,personRequests:V,scheduleTime:G,scheduleDate:f,matchUp:K});if(te!=null&&te.length)return!1;let J=o==null?void 0:o[K.matchUpId];return tU({recoveryMinutes:J||r,matchUpPotentialParticipantIds:a,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:S,scheduleTime:G,matchUp:K}),N[K.matchUpId]=G,!0});_=_.filter(({matchUpId:K})=>K!==(W==null?void 0:W.matchUpId)),W||M.push(G)}_.forEach(G=>{D2({individualParticipantProfiles:s,matchUpPotentialParticipantIds:a,value:-1,matchUp:G})});let H=[];Object.keys(k).forEach(G=>{let W=e[G];W&&Object.keys(k[G]).forEach(K=>{let{drawDefinition:Z}=Ef({tournamentRecord:W,drawId:K});Z&&k[G][K].forEach(({matchUpId:Y})=>{let X=N[Y];if(X){let Q=X.split(":").map(qs).join(":"),te=`${Wt(f)}T${Q}`;b?H.push(Y):(Mf({drawDefinition:Z,matchUpId:Y,scheduledTime:te}).success&&H.push(Y),U&&E0({tournamentRecords:e,tournamentRecord:W,drawDefinition:Z,matchUpId:Y,venueId:U}))}})})});let z=jV(_);return{...ae,requestConflicts:Object.values(C),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:G})=>G),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:M,overLimitMatchUpIds:O,scheduledMatchUpIds:H,noTimeMatchUpIds:z,recoveryTimeDeferred:R,dependencyDeferred:A}}function bse({tournamentRecords:t,matchUps:e}){if(!hl(e))return{error:kd};if(e.some(({matchUpId:h,hasContext:f})=>h&&!f))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:XN};let i=Math.max(...e.map(({schedule:h})=>(h==null?void 0:h.courtOrder)||1).map(h=>Et(h))),n=it(1,i+1).map(h=>e.filter(f=>{var m;return Et((m=f.schedule)==null?void 0:m.courtOrder)===h})),r={},o={},a={};n.flat().filter(Boolean).sort(_y).forEach(({schedule:h})=>delete h[CE]);let s=Zt(e.map(({drawId:h})=>h)),l=nc({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:s}).matchUpDependencies,c=n.map((h,f)=>h.reduce((m,g)=>{if(!g.matchUpId)return m;let{matchUpId:v,winnerMatchUpId:y,loserMatchUpId:b,schedule:I,sides:T,potentialParticipants:S}=g,w=I==null?void 0:I.courtId;r[v]=f,o[w]=[],m.matchUpIds.push(v),a[v]=g;let U=l[v].matchUpIds;U.length&&m.sourceMatchUpIds.push(...U);let D=(T==null?void 0:T.map(C=>{var M;return[(M=C.participant)==null?void 0:M.individualParticipantIds,C.participantId]}).flat().filter(Boolean))??[],E=(S==null?void 0:S.flat().map(({individualParticipantIds:C,participantId:M})=>[C,M]).flat().filter(Boolean))||[];return m.participantIds.push(...E,...D),y&&m.targetMatchUpIds.push(y),b&&m.targetMatchUpIds.push(b),m},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),u=(h,f)=>l[h].sources.reduce((m,g,v)=>g.includes(f)&&v+1||m,0),d=c.map(()=>[]),p=(h,f,m,g)=>{if(!a[h].schedule[CE]){a[h].schedule[CE]=f,a[h].schedule[nte]=g,d[r[h]].push({matchUpId:h,issueType:m,issueIds:g,issue:f});let v=a[h].schedule.courtId;o[v]||(o[v]=[]),o[v].push({matchUpId:h,issue:f,issueType:m,issueIds:g})}};return c.forEach((h,f)=>{let m=f?c[f-1]:void 0,g=c.slice(f+1),v={},y=os(h.participantIds),b=Object.keys(y).filter(S=>y[S]>1),I=h.matchUpIds.filter(S=>l[S].participantIds.some(w=>b.includes(w)));I.forEach(S=>{v[S]||(v[S]={}),v[S][Xf]||(v[S][Xf]=I.filter(w=>w!==S))});let T=m&&h.participantIds.filter(S=>m.participantIds.includes(S));T&&T.forEach(S=>{let w=h.matchUpIds.concat(m.matchUpIds).filter(U=>l[U].participantIds.includes(S));w.forEach(U=>{v[U]||(v[U]={}),v[U][Jf]||(v[U][Jf]=w.filter(D=>D!==U))})}),h.matchUpIds.forEach(S=>{var D,E,C,M;let w=l[S].matchUpIds;for(let N of g){let R=N.matchUpIds.filter(A=>w.includes(A));R!=null&&R.length&&(R.forEach(A=>p(A,YF,vh,[S])),p(S,YF,vh,R))}if((D=v[S])!=null&&D[Xf]&&p(S,Xf,qF,v[S][Xf]),h.sourceMatchUpIds.includes(S)){let N=h.matchUpIds.filter(R=>l[R].matchUpIds.includes(S));p(S,Xf,vh,N),h.matchUpIds.filter(R=>l[R].matchUpIds.includes(S)).forEach(R=>p(R,Xf,vh,[S]))}let U=(E=m==null?void 0:m.matchUpIds)==null?void 0:E.filter(N=>u(S,N)>1);if(U!=null&&U.length&&(p(S,KF,vh,U),U.forEach(N=>p(N,KF,vh,[S]))),(C=v[S])!=null&&C[Jf]&&p(S,Jf,qF,v[S][Jf]),(M=m==null?void 0:m.targetMatchUpIds)==null?void 0:M.includes(S)){let N=a[S].schedule.courtId,R=w.filter(A=>m.matchUpIds.includes(A));R.some(A=>a[A].schedule.courtId===N)||(R.forEach(A=>p(A,Jf,vh,[S])),p(S,Jf,vh,R))}})}),{courtIssues:o,rowIssues:d}}function Ise(t){let e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return se({result:{error:On},stack:e});let{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return se({result:{error:gt},stack:e});let o=n==null?void 0:n.length;if(!o)return{...ae};let a=0;return n.forEach((l,c)=>{let{tournamentId:u,drawId:d,matchUpId:p}=l,h=c+(r?-1:1);h<0&&(h=o-1),h===o&&(h=0);let f=n[h].schedule.scheduledTime,m=s({tournamentId:u,scheduledTime:f,matchUpId:p,drawId:d});if(m.success)a++;else return m}),a===o?ae:se({result:{error:IQ},stack:e});function s({tournamentId:l,scheduledTime:c,matchUpId:u,drawId:d}){let p=i[l],{drawDefinition:h}=Ef({tournamentRecord:p,drawId:d});return h?Mf({drawDefinition:h,scheduledTime:c,matchUpId:u}):{error:ns}}}function wse(t){var l,c;let{scheduleChange:e,matchUpIds:i,dryRun:n}=t;if(!i||!Array.isArray(i))return{error:Xw};if(typeof e!="object")return{error:Pe};let r=Ou(t),o=[],a=[];for(let u of Object.values(r)){let d=FMe({tournamentRecord:u,scheduleChange:e,matchUpIds:i,dryRun:n});if(d.error)return d;Array.isArray(d.notRescheduled)&&a.push(...d.notRescheduled);let p=jV(d.notRescheduled),h=[];(l=d.rescheduled)==null||l.forEach(f=>{let{matchUpId:m}=f;p.includes(m)&&h.push(m),o.push(f)}),h.length&&(a=((c=d==null?void 0:d.notRescheduled)==null?void 0:c.filter(({matchUpId:f})=>!h.includes(f)))||[])}let s=!!(o.length&&!a.length);return{...ae,rescheduled:o,notRescheduled:a,allRescheduled:s}}function FMe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){var I;if(!t)return{error:Ge};if(!i||!Array.isArray(i))return{error:Xw};if(typeof e!="object")return{error:Pe};let r=[],o=[],{minutesChange:a,daysChange:s}=e;if(!a&&!s)return{...ae};if(a&&isNaN(a))return{error:Pe};if(s&&isNaN(s))return{error:Pe};let{matchUps:l}=to({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=({matchUpStatus:T})=>!Nr.includes(T),u=l==null?void 0:l.filter(T=>fP({schedule:T.schedule})).filter(T=>c({matchUpStatus:T.matchUpStatus}));if(!(u!=null&&u.length))return{...ae};let{tournamentInfo:d}=jy({tournamentRecord:t}),{startDate:p,endDate:h}=d,f=u==null?void 0:u.reduce((T,S)=>{let{matchUpId:w,drawId:U}=S;return T[U]?T[U].push(w):T[U]=[w],T},{}),m=1440;for(let T of Object.keys(f)){let S=Ef({tournamentRecord:t,drawId:T});if(S.error)return S;let w=S.drawDefinition,U=f[T].filter(D=>i.includes(D));for(let D of U)if(D&&w){let E=(I=u.find(_=>_.matchUpId===D))==null?void 0:I.schedule,{scheduledTime:C,scheduledDate:M}=E,N,R,A;if(!N&&s&&M){let _=Wt(M);A=kS(_,s),N=new Date(A)<new Date(p)||new Date(A)>new Date(h)}if(a&&C){let _=Wt(C),k=mi(hn(C))+a;if(N=k<0||k>m,!N){let O=xa(C,a),F=_&&A||M===_&&_;R=F?`${F}T${O}`:O}}if(N)o.push(D);else{if(!n){if(R){let _=Mf({scheduledTime:R,drawDefinition:w,matchUpId:D});if(_.error)return _}if(A){let _=E_({scheduledDate:A,drawDefinition:w,matchUpId:D});if(_.error)return _}}(R||A)&&r.push(D)}}}let g=to({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],v=g.filter(({matchUpId:T})=>r.includes(T)),y=g.filter(({matchUpId:T})=>o.includes(T)),b=v.length&&!y.length;return{...ae,rescheduled:v,notRescheduled:y,allRescheduled:b}}function Sse(t){let e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:On};let{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:o,targetCourtId:a,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return se({result:{error:gt},stack:e});let{matchUps:f}=xc({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:I})=>I===c),g=f==null?void 0:f.find(({matchUpId:I})=>I===p),v=0;if(a&&c&&!p){let I=y({tournamentId:u,matchUpId:c,courtId:a,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:o,courtDayDate:s});if(I!=null&&I.success&&v++,I.error)return se({result:I,stack:e})}else if(o&&a&&c&&p){let I=y({tournamentId:u,matchUpId:c,courtId:a,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:o,courtDayDate:s});if(I.success&&v++,I.error)return se({result:I,stack:e,info:"source"});let T=y({tournamentId:h,sourceCourtId:a,matchUpId:p,matchUp:g,courtId:o,drawId:d,tournamentRecords:i,courtDayDate:s});if(T.success&&v++,T.error)return se({result:T,stack:e,info:"target"})}else return{error:gt};return v?ae:se({result:{error:t0},stack:e});function y(I){let{tournamentRecords:T,tournamentId:S,matchUp:w,drawId:U}=I,D=T[S],{drawDefinition:E}=Ef({tournamentRecord:D,drawId:U});return w.matchUpType===sn?b({...I,tournamentRecord:D,drawDefinition:E}):Gy({...I,tournamentRecord:D,drawDefinition:E})}function b({removePriorValues:I,tournamentRecords:T,tournamentRecord:S,drawDefinition:w,sourceCourtId:U,courtDayDate:D,matchUpId:E,matchUp:C,courtId:M}){let N=[M].concat(C.schedule.allocatedCourts.map(({courtId:R})=>R).filter(R=>R!==U));return P_({removePriorValues:I,tournamentRecords:T,tournamentRecord:S,drawDefinition:w,courtDayDate:D,matchUpId:E,courtIds:N})}}function Tse({scheduleAttributes:t=[Ip,Mm,h0,f0,m0,bc,wp,od,op],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var s,l;let r="clearMatchUpSchedule",o=i?(s=Ia({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:s[0]:(l=to({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:l[0];if(!o)return{error:Ao};let a=(o.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&!t.includes(c==null?void 0:c.itemType));return o.timeItems=a,yi({tournamentId:e.tournamentId,context:r,drawDefinition:i,matchUp:o}),{...ae}}function Use(t){let{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:On};if(typeof n!="object")return{error:Lp};let o=Object.keys(r).filter(a=>!i||i===a);if(i&&!o.includes(i))return{error:Pe};for(let a of o){let s=r[a],l=Ui({element:s,extension:{name:wD,value:{dailyLimits:n}}});if(l.error)return l}return{...ae}}var rz={};ii(rz,{addCollectionDefinition:()=>sz,addCollectionGroup:()=>Rse,aggregateTieFormats:()=>Ase,compareTieFormats:()=>Sp,getTieFormat:()=>ZH,modifyCollectionDefinition:()=>oz,modifyTieFormat:()=>Nse,mutate:()=>Dse,orderCollectionDefinitions:()=>Ese,query:()=>Jre,removeCollectionDefinition:()=>az,removeCollectionGroup:()=>Cse,tieFormatGenderValidityCheck:()=>FA,validateCollectionDefinition:()=>oP});var Dse={};ii(Dse,{addCollectionDefinition:()=>sz,addCollectionGroup:()=>Rse,aggregateTieFormats:()=>Ase,modifyCollectionDefinition:()=>oz,modifyTieFormat:()=>Nse,orderCollectionDefinitions:()=>Ese,removeCollectionDefinition:()=>az,removeCollectionGroup:()=>Cse});function Om({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:o,event:a}){var c;let s="getTieFormat",l;if(e=(n==null?void 0:n.structureId)??e,i=(r==null?void 0:r.matchUpId)??i,(i||e)&&!t)return{error:lt};if(o&&a)l=Ih(a);else if(i){if(t&&(!r||!n)){let u=fn({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((c=u.matchUp)==null?void 0:c.matchUpType)!==Su)return se({result:{error:Sa},stack:s});n||(n=u.structure),r||(r=u.matchUp)}l=QS({item:r,drawDefinition:t,structure:n,event:a})||QS({item:n,drawDefinition:t,structure:n,event:a})||Ih(t)||Ih(a)}else if(t&&e){if(!n){let u=At({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}l=QS({item:n,drawDefinition:t,structure:n,event:a})||Ih(t)||Ih(a)}else l=Ih(t)||Ih(a);return l?{...ae,structure:n,tieFormat:l,matchUp:r}:se({result:{error:pD},stack:s})}function ZM({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![Nr].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Jl&&!io(t))}function FO({from:t,to:e}){let i=Object.keys(t),n=Hn(i,Object.keys(e)).length===i.length,r=i.filter(a=>t[a]!==e[a]).map(a=>({countChange:e[a]-t[a],collectionId:a})),o=i.every(a=>t[a]===e[a]);return{equivalent:n&&o,matchUpsCountChanges:r}}function BMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,structure:n,tieFormat:r,eventId:o,matchUp:a,event:s,uuids:l}){var S,w,U,D;let c="updateTieFormat",u=e==null?void 0:e.tournamentId,d=0,p=0,h=0,f=0,m=r==null?void 0:r.collectionDefinitions.reduce((E,C)=>(E[C.collectionId]=(E[C.collectionId]||0)+C.matchUpCount,E),{}),g=({tieFormat:E})=>{let C=E==null?void 0:E.collectionDefinitions.reduce((M,N)=>(M[N.collectionId]=(M[N.collectionId]||0)+N.matchUpCount,M),{});return FO({from:C,to:m}).equivalent},v=(S=Om({drawDefinition:i}))==null?void 0:S.tieFormat,y=(w=Om({event:s}))==null?void 0:w.tieFormat;if(s&&o){for(let E of s.drawDefinitions??[])b({drawDefinition:E});s.tieFormat=ho(r),f+=1}else if(a){if(!a.tieMatchUps)return se({result:{error:Sa},stack:c});let E=os((U=a.tieMatchUps)==null?void 0:U.map(({collectionId:A})=>A)),C=FO({to:m,from:E}),{changes:M,changesArePossible:N,cannotChangeReaon:R}=X6({matchUp:a,check:C});if(C.equivalent)if(ZM({matchUp:a,updateInProgressMatchUps:t}))a.tieFormat=ho(r),f+=1;else return se({result:{error:iV},info:"matchUp is IN_PROGRESS or COMPLETE",stack:c});else if(N)T({tieFormat:r,matchUp:a,changes:M,uuids:l});else return se({context:{collectionMap:m,matchUpMap:E},result:{error:Yd},info:R||"specified changes not possible",stack:c});p+=1,yi({eventId:s==null?void 0:s.eventId,context:c,drawDefinition:i,tournamentId:u,matchUp:a})}else if(n){let E=(D=I({inheritedTieFormat:v??y,structure:n}))==null?void 0:D.modifiedMatchUpsCount;E&&(p+=E,d+=1,f+=1);let C=!n.tieFormat||Sp({ancestor:n.tieFormat,descendant:r}).different;C&&(n.tieFormat=ho(r),d+=1,f+=1),(E||C)&&i&&cn({structureIds:[n.structureId],eventId:s==null?void 0:s.eventId,drawDefinition:i})}else if(i)b({drawDefinition:i}),i.tieFormat=ho(r),f+=1;else return{error:lt};return{modifiedStructuresCount:d,modifiedMatchUpsCount:p,addedMatchUpsCount:h,modifiedCount:f,...ae,tieFormat:r};function b({drawDefinition:E}){var N;let C=E.structures||[],M=[];for(let R of C){if(R.tieFormat)continue;let A=(N=I({inheritedTieFormat:y,structure:R}))==null?void 0:N.modifiedMatchUpsCount;if(A){d+=1,p+=A;let _=R.structureId;M.push(_)}}return cn({structureIds:M,eventId:s==null?void 0:s.eventId,drawDefinition:E}),M.length}function I({inheritedTieFormat:E,structure:C}){var R,A;let M=0,N=((R=_i({matchUpFilters:{matchUpTypes:[sn]},structure:C}))==null?void 0:R.matchUps)||[];for(let _ of N){let k=ZM({matchUp:_,updateInProgressMatchUps:t}),O=!1,F=os((A=_.tieMatchUps)==null?void 0:A.map(({collectionId:$})=>$)),B=FO({from:F,to:m});if(B.equivalent)_.tieFormat&&g(_)&&k&&(_.tieFormat=ho(r),O=!0);else{let{changes:$,changesArePossible:V}=X6({matchUp:_,check:B});if(V&&!_.tieFormat)T({changes:$,matchUp:_,tieFormat:r,uuids:l});else if(E)(!_.tieFormat||Sp({ancestor:E,descendant:_.tieFormat}).different)&&(_.tieFormat=E,O=!0);else return se({result:{error:pD},stack:c})}O&&(M+=1,yi({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,context:c,eventId:o,matchUp:_}))}return{modifiedMatchUpsCount:M}}function T({uuids:E,matchUp:C,tieFormat:M,changes:N}){C.tieFormat=ho(M);let R=[],A=[];return N.forEach(_=>{if(_.countChange>0){let k=Math.max(0,...C.tieMatchUps.filter(B=>B.collectionId===_.collectionId).map(as("collectionPosition"))),O=M.collectionDefinitions.find(B=>B.collectionId===_.collectionId),F=iP({matchUpsLimit:_.countChange,collectionPositionOffset:k,collectionDefinition:O,matchUp:C,uuids:E});A.push(...dt(F,!1,!0)),h+=A.length,C.tieMatchUps.push(...F)}else{let k=_.toBePlayedTieMatchUpIds.slice(0,Math.abs(_.countChange));console.log("remove",k.length),R.push(...k),C.tieMatchUps=C.tieMatchUps.filter(({matchUpId:O})=>!k.includes(O))}}),A.length&&Yh({matchUps:A,drawDefinition:i,tournamentId:u,eventId:o}),R.length&&Bp({matchUpIds:R,action:"updateTieFormat",drawDefinition:i,tournamentId:u,eventId:o}),{matchUpIdsRemoved:R,matchUpsAdded:A}}}function X6({check:t,matchUp:e}){let i="",n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:o})=>{let a=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===Gn).map(as("matchUpId")),s=a.length+o>=0||o>0;return!s&&o<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:a,collectionId:r,countChange:o}),s}),changes:n,cannotChangeReaon:i}}function O_({drawDefinition:t,auditData:e}){let{extension:i}=Qt({name:Lv,element:t}),n={name:Lv,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]};Ui({element:t,extension:n})}function oz({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:o,matchUpFormat:a,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){var H;let T="modifyCollectionDefinition";if(a&&!ls({matchUpFormat:a}))return se({result:{error:Pe},context:{matchUpFormat:a},stack:T});if(n&&typeof n!="string")return se({result:{error:Pe},context:{collectionName:n},stack:T});if(f&&!Object.values(Lu).includes(f))return se({result:{error:Pe},context:{gender:f},stack:T});if(p&&typeof p!="object")return se({result:{error:Pe},context:{category:p},stack:T});let S={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!Object.values(S).filter(Boolean).length&&!i&&!n&&!a&&!s&&!c)return se({result:{error:gt},stack:T});if(Object.values(S).filter(Boolean).length>1)return se({info:"Only one value assignment allowed per collectionDefinition",result:{error:Pe},stack:T});let w=Om({drawDefinition:o,structureId:u,matchUpId:d,eventId:h,event:m});if(w.error)return se({result:w,stack:T});let{matchUp:U,structure:D,tieFormat:E}=w,C=ho(E),M=E==null?void 0:E.collectionDefinitions.find(z=>z.collectionId===l),N=C==null?void 0:C.collectionDefinitions.find(z=>z.collectionId===l);if(!M)return se({info:"source collectionDefinition",result:{error:_o},context:{collectionId:l},stack:T});let R=v??y??b??I;if(g){let z=Nie({matchUpCount:s??(M==null?void 0:M.matchUpCount)??0,collectionValueProfiles:g});if(z.errors)return se({result:{error:Pe},info:z.errors,stack:T})}else if(R&&!Bt(R))return se({result:{error:Pe},info:"value is not an integer",context:{value:R},stack:T});let A=(z,G)=>Hn(Object.keys(z),Object.keys(G)).length===Object.keys(z).length&&Hn(Object.values(z),Object.values(G)).length===Object.values(z).length,_=g&&(!M.collectionValueProfiles||!A(M.collectionValueProfiles,g)),k=Bt(v)&&M.collectionValue!==v||Bt(y)&&M.matchUpValue!==y||Bt(b)&&M.scoreValue!==b||Bt(I)&&M.setValue!==I||_,O=[];if(k&&(N.collectionValueProfiles=void 0,N.collectionValue=void 0,N.matchUpValue=void 0,N.scoreValue=void 0,N.setValue=void 0,Object.assign(N,S),O.push({collectionId:l,...wt(S)})),(Bt(b)||Bt(I))&&N.collectionGroupNumber){let z=N.collectionGroupNumber;C.collectionDefinitions=C.collectionDefinitions.map(G=>{let{collectionGroupNumber:W,...K}=G;return W===z?K:G}),C.collectionGroups=C.collectionGroups.filter(({groupNumber:G})=>G!==z),O.push({collectionId:l,change:"collectionGroupNumber removed"})}let{aggregateValue:F,valueGoal:B}=Hy(C),$=wt({aggregateValue:F,valueGoal:B});if(($.aggregateValue!==(E==null?void 0:E.winCriteria.aggregateValue)||$.valueGoal!==(E==null?void 0:E.winCriteria.valueGoal))&&(C.winCriteria=$,O.push({collectionId:l,winCriteria:$})),Bt(i)&&M.collectionOrder!==i&&(N.collectionOrder=i,O.push({collectionId:l,collectionOrder:i})),n&&M.collectionName!==n&&(N.collectionName=n,O.push({collectionId:l,collectionName:n})),a&&M.matchUpFormat!==a&&(N.matchUpFormat=a,O.push({collectionId:l,matchUpFormat:a})),Bt(s)&&M.matchUpCount!==s&&(N.matchUpCount=s,O.push({collectionId:l,matchUpCount:s})),c&&M.matchUpType!==c)return se({result:{error:eA},context:{matchUpType:c},stack:T});p&&M.category!==p&&(N.category=p,O.push({collectionId:l,category:p})),f&&M.gender!==f&&(N.gender=f,O.push({collectionId:l,gender:f}));let V=wt(C);if(w=$a({tieFormat:V}),w.error)return se({result:w,stack:T});if(!O.length)return se({result:{...ae,modifications:O}});if((E==null?void 0:E.tieFormatName)!==r?(V.tieFormatName=r,O.push({tieFormatName:r})):O.length&&(delete V.tieFormatName,O.push("tieFormatName removed: modifications without new tieFormatName")),w=BMe({tieFormat:V,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:o,structure:D,eventId:h,matchUp:U,event:m}),!w.error){let{appliedPolicies:z}=Bi({tournamentRecord:e});if((H=z==null?void 0:z.audit)!=null&&H[Lv]){let G=wt({collectionDefinition:N,drawId:o==null?void 0:o.drawId,action:T,structureId:u,matchUpId:d,eventId:h});O_({drawDefinition:o,auditData:G})}}return se({result:{...w,modifications:O},stack:T})}function $Me({updateInProgressMatchUps:t,drawDefinition:e,structureId:i,structure:n,matchUpId:r,matchUp:o}){var s,l;let a=[];return r&&o?a=[o]:i&&n?a=((s=_i({matchUpFilters:{matchUpTypes:[sn]},structure:n}))==null?void 0:s.matchUps)??[]:e&&(a=((l=Ia({matchUpFilters:{matchUpTypes:[sn]},drawDefinition:e}))==null?void 0:l.matchUps)??[]),{targetMatchUps:a.filter(c=>!c.winningSide&&c.matchUpStatus!==or&&(t||c.matchUpStatus!==Jl&&!io(c)))}}function VMe({updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:i,targetMatchUps:n,tieFormat:r,event:o}){for(let a of n){let s=!!a.tieFormat;s&&(a.tieFormat=ho(r));let l;if(t){let c=Bi({tournamentRecord:e,drawDefinition:i,event:o}).appliedPolicies,u=Gp({matchUpId:a.matchUpId,exitWhenNoValues:!0,tournamentRecord:e,appliedPolicies:c,drawDefinition:i,event:o});if(u.error)return u;l=u.score}s&&!l&&yi({tournamentId:e==null?void 0:e.tournamentId,context:"updateTargetTeamMatchUps",eventId:o==null?void 0:o.eventId,matchUp:a,drawDefinition:i})}return{...ae}}function Pse({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:o,structureId:a,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){let{aggregateValue:h,valueGoal:f}=Hy(l);l.winCriteria=wt({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);let{targetMatchUps:m}=$Me({updateInProgressMatchUps:t,drawDefinition:o,structureId:a,structure:s,matchUpId:c,matchUp:u});VMe({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:o,tieFormat:l,event:p});let g=wt(l),v=$a({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(o)o.tieFormat=g;else if(!u||!o)return{error:lt};return cn({drawDefinition:o,eventId:p==null?void 0:p.eventId}),{...ae}}function Cse({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:o,matchUpId:a,matchUp:s,eventId:l,event:c}){var y;if(!e)return{error:gt};if(isNaN(e))return{error:Pe};let u="removeCollectionGroup",d=s?void 0:Om({drawDefinition:n,structureId:o,matchUpId:a,eventId:l,event:c});if(d!=null&&d.error)return se({result:d,stack:u});let p=d==null?void 0:d.structure;s=s??(d==null?void 0:d.matchUp);let h=d==null?void 0:d.tieFormat,f=h==null?void 0:h.winCriteria.valueGoal,m=h==null?void 0:h.winCriteria.aggregateValue,g=ho(h);if(d=$a({tieFormat:g}),d.error)return se({result:d,stack:u});let v=[];if(g.collectionDefinitions=g.collectionDefinitions.map(b=>{let{collectionGroupNumber:I,...T}=b;return I!==e?b:(v.push(b.collectionId),T)}),g.collectionGroups=g.collectionGroups.filter(({groupNumber:b})=>b!==e),d=Pse({updateInProgressMatchUps:t,originalValueGoal:f,wasAggregateValue:m,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:o,structure:p,tieFormat:g,matchUpId:a,matchUp:s,eventId:l,event:c}),!d.error){let{appliedPolicies:b}=Bi({tournamentRecord:i});if((y=b==null?void 0:b.audit)!=null&&y[Lv]){let I=wt({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:u,structureId:o,matchUpId:a,eventId:l});O_({drawDefinition:n,auditData:I})}}return se({result:{...d,modifiedCollectionIds:v},stack:u})}function tw({tieFormat:t,orderMap:e}){let i=ho(t);return i.collectionDefinitions.forEach(n=>{let r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions.sort((n,r)=>OI(n.collectionOrder)-OI(r.collectionOrder)),i}function Ese({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:o,matchUp:a,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>Bt(l)))return se({result:{error:Pe},context:{orderMap:r}});if(o&&(s!=null&&s.tieFormat))J6({tournamentRecord:t,event:s,orderMap:r});else if(n){let l=e&&fn({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(a=l.matchUp,!a)return{error:Ba};a!=null&&a.tieFormat&&(a.tieFormat=tw({tieFormat:a.tieFormat,orderMap:r}),yi({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:a}))}else if(i){let l=At({drawDefinition:e,structureId:i});if(l.error)return l;let c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=tw({tieFormat:c.tieFormat,orderMap:r}),Mse({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),cn({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)E2({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else if(s!=null&&s.tieFormat)J6({structureIds:[i],tournamentRecord:t,orderMap:r,event:s});else return{error:_o}}else if(e!=null&&e.tieFormat)E2({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else return{error:_o};return{...ae}}function J6({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){let r=tw({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(let o of n.drawDefinitions??[])E2({tournamentRecord:t,drawDefinition:o,structureIds:e,orderMap:i,event:n})}function E2({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){let o=e.tieFormat??(r==null?void 0:r.tieFormat),a=tw({tieFormat:o,orderMap:n});i!=null&&i.length||(e.tieFormat=a);let s=[];for(let l of e.structures??[])i!=null&&i.length&&!i.includes(l.structureId)||((l.tieFormat||i!=null&&i.includes(l.structureId))&&(l.tieFormat=tw({tieFormat:l.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),Mse({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:l,orderMap:n}),s.push(l.structureId));cn({drawDefinition:e,structureIds:s})}function Mse({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var a;let o=(a=_i({matchUpFilters:{matchUpTypes:[sn]},structure:i}))==null?void 0:a.matchUps;for(let s of o)s.tieFormat&&(s.tieFormat=tw({tieFormat:s.tieFormat,orderMap:n}),yi({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function az({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:o,structureId:a,matchUpId:s,eventId:l,matchUp:c,event:u}){var E,C,M,N,R,A;let d="removeCollectionDefinition",p=c?void 0:Om({drawDefinition:n,structureId:a,matchUpId:s,eventId:l,event:u});if(p!=null&&p.error)return se({result:p,stack:d});let h=p==null?void 0:p.structure;c=c??(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=ho(f);if(p=$a({tieFormat:m}),p.error)return se({result:p,stack:d});let g=(E=m==null?void 0:m.collectionDefinitions)==null?void 0:E.find(_=>_.collectionId===o);if(!g)return se({result:{error:_o,collectionId:o}});m.collectionDefinitions=m.collectionDefinitions.filter(_=>_.collectionId!==o),g.collectionGroupNumber&&(m.collectionDefinitions=m.collectionDefinitions.map(_=>{let{collectionGroupNumber:k,...O}=_;return O}),m.collectionGroups=m.collectionGroups.filter(({groupNumber:_})=>_!==g.collectionGroupNumber));let{aggregateValue:v,valueGoal:y}=Hy(m);m.winCriteria=wt({aggregateValue:v,valueGoal:y});let b=f==null?void 0:f.winCriteria.valueGoal,I=f==null?void 0:f.winCriteria.aggregateValue;(b&&b!==y||v&&!I)&&(r?m.tieFormatName=r:delete m.tieFormatName);let T=[];s&&c?T=[c]:a&&h?T=((C=_i({matchUpFilters:{matchUpTypes:[sn]},structure:h}))==null?void 0:C.matchUps)??[]:n?T=((M=Ia({matchUpFilters:{matchUpTypes:[sn]},drawDefinition:n}))==null?void 0:M.matchUps)??[]:u&&(T=((N=Hp({matchUpFilters:{matchUpTypes:[sn]},drawDefinition:n}))==null?void 0:N.matchUps)??[]);let S=(T||[]).filter(_=>{var F,B,$;let k=(B=(F=_.tieMatchUps)==null?void 0:F.filter(V=>V.collectionId===o))==null?void 0:B.some(io),O=e&&_.tieFormat?($=Sp({descendant:_.tieFormat,ancestor:m}))==null?void 0:$.different:!1;return t&&!k||!_.winningSide&&_.matchUpStatus!==or&&(t||_.matchUpStatus!==Jl&&!io(_)&&!O)});if(!S.length)return{error:t0};let{appliedPolicies:w}=Bi({tournamentRecord:i});if(s&&c&&t){let _=(R=c.tieMatchUps)==null?void 0:R.filter(k=>k.collectionId===o);for(let k of _??[]){let O=bP({matchUpId:k.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,appliedPolicies:w,drawDefinition:n,event:u});if(O.error||(O=fn({drawDefinition:n,matchUpId:s}),O.error))return O;c=O==null?void 0:O.matchUp}}let U=[];for(let _ of S){for(let k of(_==null?void 0:_.sides)??[])k.lineUp=(k.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:((O==null?void 0:O.collectionAssignments)??[]).filter(F=>F.collectionId!==o)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(k=>{let O=k.collectionId===o;return O&&U.push(k.matchUpId),!O}),_.tieFormat&&(_.tieFormat=ho(m)),t){let k=Gp({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,appliedPolicies:w,drawDefinition:n,event:u});if(k.error)return k}yi({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:d,matchUp:_})}U.length&&Bp({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:U,eventId:u==null?void 0:u.eventId,drawDefinition:n});let D=wt(m);if(p=$a({tieFormat:D}),p.error)return se({result:p,stack:d});if(l&&u)u.tieFormat=D;else if(s&&c)c.tieFormat=D;else if(h)h.tieFormat=D;else if(n)n.tieFormat=D;else if(!c||!n)return{error:lt};if(cn({drawDefinition:n,eventId:u==null?void 0:u.eventId}),(A=w==null?void 0:w.audit)==null?void 0:A[Lv]){let _=wt({drawId:n==null?void 0:n.drawId,action:d,collectionId:o,structureId:a,matchUpId:s,eventId:l});O_({drawDefinition:n,auditData:_})}return{tieFormat:D,deletedMatchUpIds:U,targetMatchUps:S,...ae}}function Rse({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:o,structureId:a,matchUpId:s,matchUp:l,eventId:c,event:u}){let d="addCollectionGroup";if(!Array.isArray(r))return se({result:{error:gt},stack:d});let p=l?void 0:Om({drawDefinition:n,structureId:a,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return se({result:p,stack:d});let h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);let f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=ho(f);if(p=$a({tieFormat:g}),p.error)return se({result:p,stack:d});for(let y of g.collectionDefinitions){let{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return se({info:"collectionIds cannot be part of other collectionGroups",result:{error:Pe},stack:d})}let v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],Pse({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:o,structureId:a,structure:h,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function sz({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:o,referenceGender:a,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var F,B,$;let g="addCollectionDefinition",v=Bi({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},y=(r==null?void 0:r[Zr])??(v==null?void 0:v[Zr]);o=o??((F=y==null?void 0:y.participants)==null?void 0:F.enforceCategory);let b=(c??((B=y==null?void 0:y.participants)==null?void 0:B.enforceGender))!==!1,I=!!((i??(m==null?void 0:m.category))&&o!==!1),T=!!((a??(m==null?void 0:m.gender))&&b),S=oP({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:a,checkCategory:I,checkGender:T,event:m});if(S.error)return se({result:S,stack:g});let w=p!=null&&p.tieFormat?void 0:Om({drawDefinition:s,structureId:u,matchUpId:d,eventId:h,event:m});if(w!=null&&w.error)return se({result:{error:w.error},stack:g});let U=w==null?void 0:w.structure;p=p??(w==null?void 0:w.matchUp);let D=(p==null?void 0:p.tieFormat)??(w==null?void 0:w.tieFormat),E=ho(D);if(w=$a({tieFormat:E}),w==null?void 0:w.error)return se({result:{error:w.error},stack:g});if(!e.collectionId)e.collectionId=ji();else if(E.collectionDefinitions.map(({collectionId:V})=>V).includes(e.collectionId))return se({context:{collectionId:e.collectionId},result:{error:UQ}});E.collectionDefinitions.push(e),E.collectionDefinitions.sort((V,H)=>(V.collectionOrder||0)-(H.collectionOrder||0)).forEach((V,H)=>V.collectionOrder=H+1);let{aggregateValue:C,valueGoal:M}=Hy(E);E.winCriteria=wt({aggregateValue:C,valueGoal:M});let N=D==null?void 0:D.winCriteria.valueGoal,R=D==null?void 0:D.winCriteria.aggregateValue;(N&&N!==M||C&&!R)&&(l?E.tieFormatName=l:delete E.tieFormatName);let A=[],_=[],k=[],O=wt(E);if(w=$a({tieFormat:O}),w==null?void 0:w.error)return se({result:{error:w.error},stack:g});if(h&&m){m.tieFormat=O;for(let V of m.drawDefinitions??[])if(!V.tieFormat)for(let H of V.structures??[]){if(H.tieFormat)continue;let z=BO({updateInProgressMatchUps:t,collectionDefinition:e,structure:H,uuids:f});_.push(...z.newMatchUps),k.push(...z.targetMatchUps),A.push(H.structureId)}S1({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(u&&U){U.tieFormat=O;let V=BO({updateInProgressMatchUps:t,collectionDefinition:e,structure:U,uuids:f});_.push(...V.newMatchUps),k=V.targetMatchUps,S1({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(d&&p){if(!ZM({matchUp:p,updateInProgressMatchUps:t}))return se({result:{error:iV},stack:g});p.tieFormat=O;let V=iP({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...V),_.push(...V),S1({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:A,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else if(s){s.tieFormat=O;for(let V of s.structures??[]){let H=BO({updateInProgressMatchUps:t,collectionDefinition:e,structure:V,uuids:f});A.push(V.structureId),_.push(...H.newMatchUps),k.push(...H.targetMatchUps)}S1({modifiedMatchUps:k,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:_,stack:g})}else return{error:lt};if(($=v==null?void 0:v.audit)!=null&&$[Lv]){let V=wt({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:g,structureId:u,matchUpId:d,eventId:h});O_({drawDefinition:s,auditData:V})}return{tieFormat:O,targetMatchUps:k,addedMatchUps:_,...ae}}function BO({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var a;let r=[],o=((a=_i({matchUpFilters:{matchUpTypes:[sn]},structure:i}))==null?void 0:a.matchUps).filter(s=>ZM({matchUp:s,updateInProgressMatchUps:t})&&!s.tieFormat);for(let s of o){let l=iP({collectionDefinition:e,matchUp:s,uuids:n});Array.isArray(s.tieMatchUps)||(s.tieMatchUps=[]),s.tieMatchUps.push(...l),r.push(...l)}return{newMatchUps:r,targetMatchUps:o}}function S1({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:o,stack:a}){Yh({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:o}),i==null||i.forEach(s=>{yi({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:a,matchUp:s,eventId:o})}),cn({structureIds:t,drawDefinition:n,eventId:o})}function Nse({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:o,matchUpId:a,eventId:s,uuids:l,event:c}){let u="modifyTieFormat";if(!$a({tieFormat:i}).valid)return se({result:{error:Yd},info:"falied validation",stack:u});let d=Om({drawDefinition:r,structureId:o,matchUpId:a,eventId:s,event:c});if(d.error)return se({result:d,stack:u});let{matchUp:p,tieFormat:h}=d,f=ho(h),m=Sp({descendant:i,ancestor:f});if(m.invalid)return se({context:{invalid:m.invalid},result:{error:Yd},stack:u});if(!(m!=null&&m.different))return se({result:{...ae},info:"Nothing to do",stack:u});let g=f.collectionDefinitions.map(({collectionId:U})=>U),v=i.collectionDefinitions.map(({collectionId:U})=>U),y=g.filter(U=>!v.includes(U)),b=i.collectionDefinitions.filter(({collectionId:U})=>!g.includes(U)),I=b.map(as("collectionId")),T=[],S,w=i.tieFormatName;for(let U of i.collectionDefinitions){if(I.includes(U.collectionId))continue;let D=oz({updateInProgressMatchUps:t,...U,tournamentRecord:n,tieFormatName:w,drawDefinition:r,structureId:o,matchUpId:a,eventId:s,event:c});if(D.modifications&&T.push(...D.modifications),D.error)return se({result:D,stack:u});D.tieFormat&&(S=D.tieFormat)}for(let U of b){let D=sz({updateInProgressMatchUps:t,collectionDefinition:U,tournamentRecord:n,drawDefinition:r,tieFormatName:w,structureId:o,matchUpId:a,matchUp:p,eventId:s,uuids:l,event:c});if(D.error)return se({result:D,stack:u});D.tieFormat&&(S=D.tieFormat)}for(let U of y){let D=az({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:r,tieFormatName:w,collectionId:U,structureId:o,matchUpId:a,eventId:s,matchUp:p,event:c});if(D.error)return se({result:D,stack:u});D.tieFormat&&(S=D.tieFormat)}return(h==null?void 0:h.tieFormatName)!==w?(S.tieFormatName=w,T.push({tieFormatName:w})):(T.length||I.length||y.length)&&(delete S.tieFormatName,T.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((U,D)=>OI(U.collectionOrder)-OI(D.collectionOrder)).map((U,D)=>({...U,collectionOrder:D+1})),{processedTieFormat:ho(S),modifications:T,...ae}}function Ase({tournamentRecord:t}){if(!t)return{error:Ge};let e=0;for(let i of t.events??[]){let n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(let p of n)Sp({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{let p=dt(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=ji()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},o=i.eventType;r({tieFormat:i.tieFormat,eventType:o});for(let u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:o});for(let d of u.structures??[])r({tieFormat:d.tieFormat,eventType:o})}let a=(u,d)=>{var h;let p=(h=l.matchUps)==null?void 0:h.find(f=>f.matchUpId===u);p&&(p.tieFormatId=d,delete p.tieFormat,yi({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:p}))},s=u=>{let d=dt(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=ji()),n.push(d),e+=1,a(u.matchUpId,d.tieFormatId)},l=Hp({matchUpFilters:{matchUpTypes:[Su]},event:i}),c=l.matchUps??[];for(let u of c){let d;for(let p of n)u.tieFormat&&Sp({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?a(u.matchUpId,d):s(u)}n.length&&(i.tieFormats=n)}return{...ae,addedCount:e}}var lz={};ii(lz,{addDrawDefinitionExtension:()=>sA,addEventExtension:()=>Uf,addEventTimeItem:()=>By,addExtension:()=>Ui,addNotes:()=>OA,addOnlineResource:()=>xse,addParticipantExtension:()=>see,addParticipantTimeItem:()=>Zj,addTimeItem:()=>Cf,addTournamentExtension:()=>OV,addTournamentTimeItem:()=>Fy,analyzeDraws:()=>lP,analyzeTournament:()=>YH,getAllowedDrawTypes:()=>i_,getAllowedMatchUpFormats:()=>zH,getAppliedPolicies:()=>Bi,getCompetitionDateRange:()=>r_,getCompetitionPenalties:()=>WH,getPolicyDefinitions:()=>$p,getTournamentInfo:()=>jy,getTournamentPenalties:()=>n_,getTournamentPersons:()=>qH,getTournamentStructures:()=>Yj,getTournamentTimeItem:()=>jD,mutate:()=>_se,query:()=>Zre,removeDrawDefinitionExtension:()=>lee,removeEventExtension:()=>lA,removeExtension:()=>ta,removeNotes:()=>Mie,removeParticipantExtension:()=>cee,removeTournamentExtension:()=>LV,setTournamentCategories:()=>Fse,setTournamentDates:()=>L_,setTournamentEndDate:()=>$se,setTournamentName:()=>Ose,setTournamentNotes:()=>Lse,setTournamentStartDate:()=>Bse,setTournamentStatus:()=>kse});var _se={};ii(_se,{addDrawDefinitionExtension:()=>sA,addEventExtension:()=>Uf,addEventTimeItem:()=>By,addExtension:()=>Ui,addNotes:()=>OA,addOnlineResource:()=>xse,addParticipantExtension:()=>see,addParticipantTimeItem:()=>Zj,addTimeItem:()=>Cf,addTournamentExtension:()=>OV,addTournamentTimeItem:()=>Fy,removeDrawDefinitionExtension:()=>lee,removeEventExtension:()=>lA,removeExtension:()=>ta,removeNotes:()=>Mie,removeParticipantExtension:()=>cee,removeTournamentExtension:()=>LV,setTournamentCategories:()=>Fse,setTournamentDates:()=>L_,setTournamentEndDate:()=>$se,setTournamentName:()=>Ose,setTournamentNotes:()=>Lse,setTournamentStartDate:()=>Bse,setTournamentStatus:()=>kse});var jMe="ABANDONED",HMe="ACTIVE",GMe="CANCELLED",zMe="COMPLETED",WMe="IN_PROGRESS",cz={ABANDONED:jMe,ACTIVE:HMe,CANCELLED:GMe,COMPLETED:zMe,IN_PROGRESS:WMe};function kse({tournamentRecord:t,status:e}){return t?e&&!Object.keys(cz).includes(e)?{error:Pe,info:"Unknown status"}:(t.tournamentStatus=e,{...ae}):{error:Ge}}function xse({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:n,personId:r,courtId:o,venueId:a}){var s,l,c;if(!t)return{error:Ge};if(!ln(e))return{error:gt};if(Hn(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return se({result:{error:Lp},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return se({result:{error:_o}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(n||r){let u=(t.participants??[]).find(d=>{var p;return r&&((p=d.person)==null?void 0:p.personId)===r||d.participantId===n});if(!u)return se(r?{result:{error:_o}}:{result:{error:Jn}});if(r){if(((l=u.person)==null?void 0:l.personId)!==r)return se({result:{error:Jw}});u.person.onlineResources||(u.person.onlineResources=[]),u.person.onlineResources.push(e)}else u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(o){let u=(c=(t.venues??[]).filter(d=>!a||d.venueId===a).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===o)))==null?void 0:c[0];if(!u)return se({result:{error:fD}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(a){let u=(t.venues??[]).find(d=>d.venueId===a);if(!u)return se({result:{error:e0}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...ae}}function Ose({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...ae}):{error:Ge}}function Lse({tournamentRecord:t,notes:e}){return t?OA({element:t,notes:e}):{error:Ge}}function Fse({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...ae}):{error:Ge}}function qMe({tournamentRecord:t}){var o,a;if(!t)return{error:Ge};let{startDate:e,endDate:i}=t,n=LI(e,i),r=[];for(let s of t.venues||[])(o=s==null?void 0:s.courts)!=null&&o.length&&r.push(...s.courts);for(let s of r){let{startTime:l,endTime:c}=(s.dateAvailability??[]).reduce((p,h)=>{let f=mi(p.startTime),m=mi(p.endTime);return h.startTime&&mi(h.startTime)<f&&(p.startTime=h.startTime),h.endTime&&mi(h.endTime)>m&&(p.endTime=h.endTime),p},{startTime:"08:00",endTime:"18:00"}),u=n.map(p=>{var h;return((h=s.dateAvailability)==null?void 0:h.find(f=>f.date===p))??{date:p,startTime:l,endTime:c}}),d=(a=s.dateAvailability)==null?void 0:a.find(p=>!p.date);d&&u.unshift(d),s.dateAvailability=u}return{...ae}}function L_(t){var d;let{tournamentRecord:e,startDate:i,endDate:n}=t,r=Ei(t,[{tournamentRecord:!0},{[MV]:{startDate:!1,endDate:!1},[fd]:aa,[yc]:p=>md.test(p)}]);if(r.error)return r;if(n&&i&&new Date(n)<new Date(i))return{error:Pe};let o;(i&&e.startDate&&new Date(i)>new Date(e.startDate)||n&&e.endDate&&new Date(n)<new Date(e.endDate))&&(o=!0);let a=LI(e.startDate,e.endDate);i&&(e.startDate=i),n&&(e.endDate=n);let s=LI(e.startDate,e.endDate),l=a.filter(p=>!s.includes(p)),c=s.filter(p=>!a.includes(p));for(let p of e.events??[])i&&p.startDate&&new Date(i)>new Date(p.startDate)&&(p.startDate=i),n&&p.endDate&&new Date(n)<new Date(p.endDate)&&(p.endDate=n);i&&e.endDate&&new Date(i)>new Date(e.endDate)&&(e.endDate=i),n&&e.startDate&&new Date(n)<new Date(e.startDate)&&(e.startDate=n);let u=o&&((d=YMe({tournamentRecord:e}))==null?void 0:d.unscheduledMatchUpIds);return qMe({tournamentRecord:e}),di({topic:Eee,payload:{startDate:i,endDate:n}}),{...ae,unscheduledMatchUpIds:u,datesAdded:c,datesRemoved:l}}function Bse({tournamentRecord:t,startDate:e}){return L_({tournamentRecord:t,startDate:e})}function $se({tournamentRecord:t,endDate:e}){return L_({tournamentRecord:t,endDate:e})}function YMe({tournamentRecord:t}){let e=to({tournamentRecord:t}).matchUps??[],i=t.startDate&&new Date(t.startDate),n=t.endDate&&new Date(t.endDate),r=[],o=[];for(let a of e){let{schedule:s,matchUpId:l}=a;if(s&&s.scheduledDate){let c=new Date(s.scheduledDate);(i&&c<i||n&&c>n)&&(o.push(l),r.includes(s.scheduledDate)||r.push(s.scheduledDate))}}return r.length&&!N_({scheduledDates:r,tournamentRecord:t}).clearedScheduleCount?{error:CJ}:{unscheduledMatchUpIds:o}}var uz={};ii(uz,{addCourt:()=>k_,addCourts:()=>JG,addVenue:()=>BD,deleteCourt:()=>Kse,deleteVenue:()=>fz,deleteVenues:()=>Gse,disableCourts:()=>zse,disableVenues:()=>Wse,enableCourts:()=>qse,enableVenues:()=>Yse,generate:()=>Vse,generateCourts:()=>EG,getCompetitionVenues:()=>dP,getCourts:()=>pG,getVenuesAndCourts:()=>zp,modifyCourt:()=>mz,modifyCourtAvailability:()=>pz,modifyVenue:()=>Zse,mutate:()=>jse,publicFindVenue:()=>Pj,query:()=>doe});var Vse={};ii(Vse,{generateCourts:()=>EG});var jse={};ii(jse,{addCourt:()=>k_,addCourts:()=>JG,addVenue:()=>BD,deleteCourt:()=>Kse,deleteVenue:()=>fz,deleteVenues:()=>Gse,disableCourts:()=>zse,disableVenues:()=>Wse,enableCourts:()=>qse,enableVenues:()=>Yse,modifyCourt:()=>mz,modifyCourtAvailability:()=>pz,modifyVenue:()=>Zse});function dz(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:Ge};if(!(t!=null&&t.courtId))return{error:wy};let{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:o}=t,{schedulingProfile:a}=Wp({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:o})};let{matchUps:s}=to({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:o})};function l({matchUps:c,courtId:u}){let d=c.filter(p=>{var f,m,g;let h=(m=(f=p.schedule)==null?void 0:f.allocatedCourts)==null?void 0:m.map(({courtId:v})=>v);return((g=p.schedule)==null?void 0:g.courtId)===u||(h==null?void 0:h.includes(u))});return zM({matchUps:d,schedulingProfile:a})}}function KMe({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i,venueId:n}){if(!e)return{error:Ge};if(!n)return{error:bf};let{schedulingProfile:r}=Wp({tournamentRecord:e}),{matchUps:o}=to({scheduleVisibilityFilters:t,tournamentRecord:e,matchUpFilters:i});return{matchUps:a({matchUps:o,venueId:n})};function a({matchUps:s,venueId:l}){let c=s.filter(u=>{var p,h,f;let d=(h=(p=u.schedule)==null?void 0:p.allocatedCourts)==null?void 0:h.map(({venueId:m})=>m);return((f=u.schedule)==null?void 0:f.venueId)===l||(d==null?void 0:d.includes(l))});return zM({matchUps:c,schedulingProfile:r})}}function pz({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:o}){var h,f,m;if(!t)return{error:Ge};if(!r)return{error:wy};let a=xae({dateAvailability:e});if(a.error)return a;let{updatedDateAvailability:s,totalMergeCount:l}=ZMe(e);e=s;let c=Ny({tournamentRecord:t,courtId:r});if(c.error)return c;let{court:u,venue:d}=c,{matchUps:p}=dz({tournamentRecord:t,venueMatchUps:n,courtId:r});if(p!=null&&p.length){let g=(h=Bi({tournamentRecord:t}))==null?void 0:h.appliedPolicies,v=o??((m=(f=g==null?void 0:g[Tf])==null?void 0:f.allowDeletionWithScoresPresent)==null?void 0:m.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return u&&(u.dateAvailability=e,!i&&d&&di({payload:{venue:d,tournamentId:t.tournamentId},topic:ag,key:d.venueId})),{...ae,totalMergeCount:l}}function ZMe(t){let e=0,i=t.reduce((r,o)=>{let{date:a,startTime:s,endTime:l,bookings:c}=o;return r[a]||(r[a]=[]),r[a].push({startTime:s,endTime:l,bookings:c}),r},{}),n=[];return Object.keys(i).forEach(r=>{i[r].sort(IMe);let{mergedAvailability:o,mergeCount:a}=XMe(i[r]);n.push(...o.map(s=>({date:r,...s}))),e+=a}),{updatedDateAvailability:n,totalMergeCount:e}}function XMe(t){let e,i,n,r=t.length,o=0,a=[];for(;t.length&&r;){let l=t.shift(),{startTime:c,endTime:u,bookings:d}=l;if(r-=1,!e)e=c,n=d,i=u;else if(bD(pr(i),pr(c),!1)>0){let p={startTime:e,endTime:i};n!=null&&n.length&&(p.bookings=n),a.push(p),e=c,n=d,i=u}else d&&(n?n.push(d):n=d),i=u,o+=1}let s={startTime:e,endTime:i};return n!=null&&n.length&&(s.bookings=n),a.push(s),{mergedAvailability:a,mergeCount:o}}function hz({matchUpsCount:t=0}){let e=`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`;return{error:MQ,info:e}}function Hse({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){let r="removeCourtAssignment";if(!i)return{error:To};if(!e&&!n)return{error:Wc};let o;if(!e){if(!t)return{error:Ge};({drawDefinition:e}=Ta({tournamentRecord:t,drawId:n}))}if(e)({matchUp:o}=fn({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:Ge};let a=to({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:o}=Eie({matchUps:a,matchUpId:i}))}return o?(o.timeItems&&o.timeItems.find(a=>[Mm,Ip].includes(a.itemType))&&(o.timeItems=o.timeItems.filter(({itemType:a})=>![Mm,Ip].includes(a)),yi({tournamentId:t==null?void 0:t.tournamentId,context:r,drawDefinition:e,matchUp:o})),{...ae}):{error:Ao}}function fz(t){var l,c,u;if(typeof(t==null?void 0:t.venueId)!="string")return{error:bf};let{tournamentRecord:e,venueId:i,force:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!Object.keys(r).length)return{error:Ge};let o=xc({tournamentRecords:r,contextFilters:{venueIds:[i]}}).matchUps??[],a=(l=Bi({tournamentRecord:e}))==null?void 0:l.appliedPolicies,s=n??((u=(c=a==null?void 0:a[Tf])==null?void 0:c.allowDeletionWithScoresPresent)==null?void 0:u.venues);if(!o.length||s)for(let d of Object.values(r)){for(let h of o){let f=Hse({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==i?!0:(p=!0,!1)),p&&di({payload:{venueId:i,tournamentId:d.tournamentId},topic:aj,key:i})}else return hz({matchUpsCount:o.length});return hP({tournamentRecords:r}),{...ae}}function Gse({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:Ge};if(!Array.isArray(e))return{error:Pe};for(let n of t.venues||[]){let{venueId:r}=n;if(e.includes(r)){let{venueId:o}=n,a=fz({tournamentRecord:t,venueId:o,force:i});if(a.error)return a}}return{...ae}}function zse(t){let{courtIds:e,dates:i}=t,n=Ou(t),r=[{[ko]:!0,[oA]:!0}],o=Ei(t,r);if(o.error)return o;for(let a of Object.values(n))JMe({tournamentRecord:a,courtIds:e,dates:i});return{...ae}}function JMe({tournamentRecord:t,courtIds:e,dates:i}){let n=Array.isArray(i)&&i.length?{dates:i}:!0,r=o=>Ui({extension:{value:n,name:Pc},creationTime:!1,element:o});for(let o of t.venues||[])for(let a of o.courts||[])if(e!=null&&e.includes(a.courtId)){let s=r(a);if(s.error)return s}return{...ae}}function Wse(t){let{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=[{[ko]:!0,[aA]:!0}],o=Ei(t,r);if(o.error)return o;let a=Object.keys(e).filter(s=>!i||s===i);for(let s of a){let l=e[s];QMe({tournamentRecord:l,venueIds:n})}return{...ae}}function QMe({tournamentRecord:t,venueIds:e}){for(let i of t.venues||[])if(e!=null&&e.includes(i.venueId)){let n=Ui({creationTime:!1,element:i,extension:{name:Pc,value:!0}});if(n.error)return n}return{...ae}}function qse(t){let e=Ou(t),i=[{[ko]:!0}];!t.enableAll&&i.push({[oA]:!0});let n=Ei(t,i);if(n.error)return n;let{enableAll:r,courtIds:o,dates:a}=t;for(let s of Object.values(e))eRe({tournamentRecord:s,courtIds:o,enableAll:r,dates:a});return{...ae}}function eRe({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(let r of t.venues||[])for(let o of r.courts||[])if(i||e!=null&&e.includes(o.courtId))if(Array.isArray(n)){let{extension:a}=Qt({element:o,name:Pc});if(a){let s=a.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),Ui({extension:{name:Pc,value:s},creationTime:!1,element:o})}}else ta({element:o,name:Pc});return{...ae}}function Yse(t){let e=Ou(t),i=[{[ko]:!0}];!t.enableAll&&i.push({[aA]:!0});let n=Ei(t,i);if(n.error)return n;let{venueIds:r,enableAll:o}=t;for(let a of Object.values(e))for(let s of a.venues||[])(o||r!=null&&r.includes(s.venueId))&&ta({element:s,name:Pc});return{...ae}}function Kse(t){let{courtId:e,disableNotice:i,force:n}=t,r=Ou(t),o=Ei(t,[{[ko]:!0,[JQ]:!0}]);if(o.error)return o;let a,s;for(let l of Object.values(r)){if(s=tRe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==fD)return s;s.success&&(a=!0)}return a?{...ae}:s}function tRe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var c,u,d;let r=Ny({tournamentRecord:t,courtId:i});if(r.error)return r;let o=r.venue,{matchUps:a}=dz({tournamentRecord:t,courtId:i}),s=(c=Bi({tournamentRecord:t}))==null?void 0:c.appliedPolicies,l=n??((d=(u=s==null?void 0:s[Tf])==null?void 0:u.allowDeletionWithScoresPresent)==null?void 0:d.courts);if(!(a!=null&&a.length)||l){for(let p of a??[]){let h=Hse({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}o&&(o.courts=(o.courts??[]).filter(p=>p.courtId!==i),e||di({payload:{venue:o,tournamentId:t.tournamentId},topic:ag,key:o.venueId}))}else return hz({matchUpsCount:a.length});return{...ae}}function mz(t){let{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:o}=t,a=Ou(t);if(!Object.keys(a).length)return{error:On};let s,l;for(let c of Object.values(a)){let u=iRe({tournamentRecord:c,disableNotice:e,venueMatchUps:o,modifications:i,courtId:n,force:r});if(u!=null&&u.error)return u;s=!0}return s?{...ae}:l}function iRe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:o}){if(!t)return{error:Ge};if(!r)return{error:wy};if(!n||typeof n!="object")return{error:Lp};let a=Ny({tournamentRecord:t,courtId:r});if(a.error)return a;let{venue:s,court:l}=a,c=Object.keys(bMe()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:QN};let u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){let p=pz({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:o});if(p.error)return p}return e||di({payload:{venue:s,tournamentId:t.tournamentId},topic:ag,key:s==null?void 0:s.venueId}),{...ae,court:dt(l)}}var nRe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]}),rRe=nRe;function Zse(t){let{modifications:e,venueId:i,force:n}=t,r=Ou(t);if(!Object.keys(r).length)return{error:On};if(typeof i!="string")return{error:bf};let o,a;for(let s of Object.values(r)){let l=oRe({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(a=!0),l.error&&(o=l.error),l.error&&l.error!==e0)return l}return hP({tournamentRecords:r}),a?{...ae}:{error:o}}function oRe({tournamentRecord:t,modifications:e,venueId:i,force:n}){var g,v,y,b,I,T,S,w;if(!t)return{error:Ge};if(!e||typeof e!="object")return{error:Lp};if(!i)return{error:bf};let r=(g=Bi({tournamentRecord:t}))==null?void 0:g.appliedPolicies,o=n??((y=(v=r==null?void 0:r[Tf])==null?void 0:v.allowDeletionWithScoresPresent)==null?void 0:y.venues),{matchUps:a}=KMe({tournamentRecord:t,venueId:i}),s=Vp({tournamentRecord:t,venueId:i});if(s.error)return s;let l=s.venue,c=Object.keys(rRe()).filter(U=>U!=="venueId");if(!Object.keys(e).filter(U=>c.includes(U)).length)return{error:QN};let u=c.filter(U=>!["courts","onlineResources"].includes(U)),d=Object.keys(e).filter(U=>u.includes(U));l&&d.forEach(U=>Object.assign(l,{[U]:e[U]}));let p=((b=l==null?void 0:l.courts)==null?void 0:b.map(U=>U.courtId))??[],h=((I=e.courts)==null?void 0:I.map(U=>U.courtId))||[],f=h.length?p.filter(U=>!h.includes(U)):(e==null?void 0:e.courts)&&p,m=[];if(f!=null&&f.length){let U=(S=(T=l==null?void 0:l.courts)==null?void 0:T.filter(D=>f.includes(D.courtId)))==null?void 0:S.map(D=>{var C;let E=dz({courtId:D.courtId,tournamentRecord:t,venueMatchUps:a});for(let M of E.matchUps??[])m.push({matchUpId:M.matchUpId,drawId:M.drawId});return((C=E.matchUps)==null?void 0:C.length)??0}).reduce((D,E)=>D+E);if(l&&(!U||o))l.courts=(w=l.courts)==null?void 0:w.filter(D=>h.includes(D.courtId)),iU({schedule:{courtId:"",scheduledDate:""},matchUpDetails:m,removePriorValues:!0,tournamentRecord:t});else return hz({matchUpsCount:U})}if(e.courts)for(let U of e.courts){let{courtId:D}=U||{},E=mz({modifications:U,disableNotice:!0,tournamentRecord:t,venueMatchUps:a,courtId:D,force:n});if(E.error===fD&&(E=k_({disableNotice:!0,tournamentRecord:t,venueId:i,court:U})),E.error)return E}return hP({tournamentRecord:t}),l&&di({payload:{venue:l,tournamentId:t.tournamentId},topic:ag,key:l==null?void 0:l.venueId}),{...ae,venue:dt(l)}}var Di={};ii(Di,{JSON2CSV:()=>dRe,UUID:()=>ji,UUIDS:()=>VTe,allNumeric:()=>FQ,attributeFilter:()=>kv,chunkArray:()=>Qr,chunkByNth:()=>BF,chunkSizeProfile:()=>LQ,constantToString:()=>vo,countValues:()=>sSe,createMap:()=>TJ,dateTime:()=>WSe,definedAttributes:()=>wt,dehydrateMatchUps:()=>sRe,extractAttributes:()=>xee,flattenJSON:()=>gz,generateDateRange:()=>LI,generateHashCode:()=>U0e,generateRange:()=>it,generateTimeCode:()=>jae,groupValues:()=>xQ,hasAttributeValues:()=>T0e,instanceCount:()=>os,intersection:()=>Hn,isConvertableInteger:()=>Bt,isNumeric:()=>Bn,isOdd:()=>_Q,isPowerOf2:()=>kc,makeDeepCopy:()=>dt,matchUpSort:()=>_y,nearestPowerOf2:()=>gV,nextPowerOf2:()=>i0,noNulls:()=>aSe,noNumeric:()=>BQ,numericSort:()=>wr,occurrences:()=>cSe,overlap:()=>sa,randomMember:()=>Ja,randomPop:()=>Qa,shuffleArray:()=>Jo,structureSort:()=>Ey,subSort:()=>uSe,undefinedToNull:()=>MF,unique:()=>Zt,visualizeScheduledMatchUps:()=>aRe});function aRe({scheduledMatchUps:t,showGlobalLog:e}){wUe();let i=t==null?void 0:t.reduce((r,{structureId:o})=>r.includes(o)?r:r.concat(o),[]),n=Array.isArray(i)&&{...i.map(r=>{let{structureName:o,matchUpType:a}=t.find(s=>s.structureId===r);return{[r]:`${o} ${a}`}})};i==null||i.forEach(r=>{var s;tl({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);let o=t.filter(l=>l.structureId===r),a=((s=la({matchUps:o}))==null?void 0:s.roundMatchUps)||[];Object.keys(a).forEach(l=>{tl({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),a[l].forEach(({matchUpId:c,schedule:u})=>{let d=hn(u.scheduledTime);tl({matchUpId:c,time:d,date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&IUe()}function sRe({tournamentRecord:t}){if(!t)return{error:Ge};if(typeof t!="object"||!t.tournamentId)return{error:Pe};let{matchUps:e}=to({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){let i=lRe({tournamentRecord:t});uRe(e,i)}return{...ae}}function lRe({tournamentRecord:t}){let e={};for(let i of t.events||[]){i.matchUpFormat&&(e[i.eventId]=i.matchUpFormat);for(let n of i.drawDefinitions||[]){n.matchUpFormat&&(e[n.drawId]=n.matchUpFormat);for(let r of n.structures||[]){r.matchUpFormat&&(e[r.structureId]=r.matchUpFormat);for(let o of r.structures||[])o.matchUpFormat&&(e[o.structureId]=o.matchUpFormat)}}}return e}var cRe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function uRe(t,e={}){for(let i of t){let{structureId:n,drawId:r,eventId:o}=i,a=e[n]||e[r]||e[o],s=i.matchUpFormat===a?void 0:i.matchUpFormat;for(let l of Object.keys(i))cRe.includes(l)||delete i[l];i.sides&&i.drawPositions&&!i.tieMatchUps&&delete i.sides,s&&(i.matchUpFormat=s)}}function dRe(t,e){if(e&&typeof e!="object")return{error:Pe};let{columnTransform:i={}}=e||{},{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:o,removeEmptyColumns:a,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Pe};i=Object.assign({},...Object.keys(i).reverse().map(R=>({[R]:Array.isArray(i[R])?i[R]:[typeof i[R]=="string"&&i[R]].filter(Boolean)})));let v=t.filter(Boolean).map(R=>gz(R,g)),y=Object.values(i).flat();n&&l.push(...y);let b=v.reduce((R,A)=>Object.keys(A).every(_=>!R.includes(_)&&R.push(_)||!0)&&R,[]).filter(R=>!(l!=null&&l.length)||l.includes(R)),I=Object.assign({},...Object.keys(i).reverse().map(R=>i[R].map(A=>({[A]:R})).flat()).flat()),T=(R,A)=>e!=null&&e.sortOrder?e.sortOrder.includes(R)&&e.sortOrder.includes(A)&&e.sortOrder.indexOf(R)-e.sortOrder.indexOf(A)||!e.sortOrder.includes(A)&&-1:0,S=b.reduce((R,A)=>{let _=I[A];return _?R.includes(_)||R.push(_):R.push(A),R},[]).sort(T);Object.keys(u).forEach(R=>!S.includes(R)&&S.unshift(R)),Object.keys(i).forEach(R=>!S.includes(R)&&S.unshift(R)),typeof p=="object"&&Object.keys(p).forEach(R=>!S.includes(R)&&S.unshift(R));let w=S.map(R=>u[R]||R);if(s)return[w];let U=R=>`${h}${R}${h}`,D=[],E=R=>Object.values(S.reduce((A,_,k)=>{var V;let O=i[_],F=(O!=null&&O.length?R[O.find(H=>R[H])]:R[_])||(p==null?void 0:p[_])||"",B=((V=d[_])==null?void 0:V[F])||F,$=ya(c[_])?c[_](B):B;return A[_]=U($),$&&(D[k]=(D[k]||0)+1),A},{})),C=v.map(E),M=a&&[...D].map((R,A)=>!R&&A).filter(Bn).reverse();if(M){let R=A=>A.filter((_,k)=>!M.includes(k));C=C.map(R),w=R(w)}let N=C.map(R=>R.join(f));return o?N.map(R=>{let A=R.split(f);return Object.assign({},...A.map((_,k)=>({[w[k]]:_})))}):r?[w.map(U).join(f),...N].join(m):N.join(m)}function gz(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,gz(t[r],e,i.concat(r))),{})}var pRe={},{FACTORY:Q6}=BV;function hRe({tournamentRecord:t,value:e}){let{extension:i}=Qt({element:t,name:Q6}),n={name:Q6,value:{...i==null?void 0:i.value,...e}};Ui({element:t,extension:n})}function F_({timeStamp:t}){let e=If(),i=yV();return i&&Object.values(e).forEach(n=>{hRe({tournamentRecord:n,value:{version:Yw(),timeStamp:t}})}),i}function Xse({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var d,p;let o=rl();if(typeof o!="object")return;let a={method:e},s=(r==null?void 0:r.error)&&(o.errors===!0||Array.isArray(o.errors)&&o.errors.includes(e)),l=Array.isArray(o.params)&&((d=o.params)==null?void 0:d.includes(e)),c=o.params&&!Array.isArray(o.params)||l,u=Array.isArray(o.exclude)&&o.exclude.includes(e);!u&&![void 0,!1].includes(o.perf)&&!isNaN(o.perf)&&i>=o.perf&&(a.elapsed=i),!u&&(s||c)&&(a.params=n),!u&&(s||o.result&&!Array.isArray(o.result)&&(!Array.isArray(o.params)||l)||Array.isArray(o.result)&&((p=o.result)!=null&&p.includes(e)))&&(a.result=r),Object.keys(a).length>1&&qQ(a,t)}function DP({methodName:t,params:e,start:i}){let n={error:gD,methodName:t},r=i?Date.now()-i:0;return Xse({result:n,methodName:t,elapsed:r,params:e,engineType:"sync"}),n}function fRe(t,e){var o;if(e._middleware===!1)return e;if(e.tournamentId&&!t[e.tournamentId])return{error:Ge};let i=e.drawId||((o=e.matchUp)==null?void 0:o.drawId);if(i){let{event:a,drawDefinition:s,tournamentId:l}=Ta({tournamentRecords:t,drawId:i});s&&(e.drawDefinition=s),l&&(e.tournamentId=l),a&&(e.event=a)}if(e.eventId&&!e.event){let{event:a,tournamentId:s}=Ta({eventId:e.eventId,tournamentRecords:t});if(!a)return{error:rs};e.tournamentId=s,e.event=a}let n=e.tournamentId??Uy();if(!n&&e)return e;let r=t[n];return n&&!r?{error:Ge}:(r&&(e.tournamentRecord=r),e)}function PP(t,e,i,n,r){delete t.success,delete t.error;let o=Date.now(),a=Uy();i&&(i.activeTournamentId=a);let s=(i==null?void 0:i.tournamentRecord)||SV(a),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||If(),c=i?dt(i,void 0,!0):void 0,u=i?fRe(l,i):void 0;if(u!=null&&u.error)return u;let d=mRe({params:u,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e}),p=Date.now()-o;return Xse({result:d,methodName:n,elapsed:p,params:c,engineType:r}),d}function mRe({tournamentRecords:t,tournamentRecord:e,params:i,methodName:n,method:r}){if(rl())return r({tournamentRecords:t,tournamentRecord:e,...i});try{return r({tournamentRecords:t,tournamentRecord:e,...i})}catch(o){return rA({engineName:"engine",methodName:n,params:i,err:o})}}function B_(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:o}=pl();for(let a of[...o].sort(Qse)){let s=IV({topic:a});s!=null&&s.length&&NT({topic:a,notices:s})}e&&r&&o.includes(HT)&&NT({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:HT})}async function Jse(t){let{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:o}=pl();for(let a of[...o].sort(Qse)){let s=IV({topic:a});s&&await NT({topic:a,notices:s})}e&&r&&o.includes(HT)&&NT({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:HT})}var e7={[fj]:5,[hj]:5,[mj]:5,[pj]:5,[dj]:5,[cj]:5,[Pee]:5,[Cee]:5,[uj]:1,[yA]:1,[wo]:5,[ag]:5,[lj]:4,[oj]:4,[aj]:4,[sj]:4,[vA]:3,[ij]:2};function Qse(t,e){return(e7[e]||0)-(e7[t]||0)}function gRe({convertExtensions:t,removeExtensions:e}){let i=If();return{tournamentId:Uy(),tournamentRecords:dt(i,t,!1,e)}}function vRe(t){let{convertExtensions:e=!1,removeExtensions:i=!1}=t??{},n=(t==null?void 0:t.tournamentId)??Uy();if(typeof n!="string")return{};let r=SV(n);return{tournamentRecord:dt(r,e,!1,i)}}function yRe(){var n;let t=If(),{extension:e}=Qt({name:xv,tournamentRecords:t,discover:!0}),i=((n=e==null?void 0:e.value)==null?void 0:n.tournamentIds)||[];return Object.keys(t).forEach(r=>{i.includes(r)||delete t[r]}),nA(t)}function t7(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Lp}:t!=null&&t.tournamentId?zQ(e?dt(t):t):{error:Pe}}function M0(t,e=!0){if(typeof t!="object")return{error:Lp};if(AT(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:AF};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)t={[t.tournamentId]:t},AT(t.tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:AF};return nA(e?dt(t):t)}async function bRe(t,e,i){if(!Array.isArray(e))return{error:Pe,message:"directives must be an array"};let n=bV(),r=Date.now(),o=i&&dt(If(),!1,!0),a=[];for(let c of e){if(typeof c!="object")return{error:Pe,message:"directive must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return DP({methodName:u,start:r,params:p});if(d){let f=a[a.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=PP(t,n[u],p,u,"async");if(h!=null&&h.error)return o&&M0(o),{...h,rolledBack:!!o};a.push({...h,methodName:u})}let s=Date.now(),l=F_({timeStamp:s});return Jse({directives:e,mutationStatus:l,timeStamp:s}),Ty(),{success:a.every(c=>c.success),results:a}}async function i7(t,e){if(!ln(e))return{error:Pe,message:"args must be an object"};let i=Object.values(e).filter(ya).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Pe};let n=i?Object.keys(e).find(h=>ya(e[h])):oa(e.method)&&e.method;if(!n)return{error:gD};let{[n]:r,...o}=e,a=e!=null&&e.params?{...e.params}:{...o},s=a.rollbackOnError&&dt(If(),!1,!0),l=r||t[n]||iA()[n];if(!l)return DP({methodName:n,params:a});let c=await PP(t,l,a,n,"async")??{};c!=null&&c.error&&s&&M0(s);let u=Date.now(),d=F_({timeStamp:u}),p=(c==null?void 0:c.success)&&(a==null?void 0:a.delayNotify)!==!0&&(a==null?void 0:a.doNotNotify)!==!0;return p&&await Jse({directives:[{method:l,params:a}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||a!=null&&a.doNotNotify)&&Ty(),c}function IRe(t,e,i,n,r,o){let a=YQ(i,n,r,o);if(a.error)return a;let s=a.methods??[];return Object.keys(s).filter(l=>ya(s[l])).forEach(l=>{t[l]=c=>{let u=()=>e(t,{[l]:s[l],...c});if(rl())return u();try{return u()}catch(d){rA({engineName:"engine",methodName:l,params:c,err:d})}}}),{...ae,...t}}function _b(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function vz(t,e){t.importMethods=(i,n,r,o)=>IRe(t,e,i,n,r,o),t.getTournament=i=>vRe(i),t.getState=i=>gRe({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>Yw(),t.reset=()=>(nA({}),_b(t)),t.devContext=i=>(MT(i),_b(t)),t.getDevContext=i=>rl(i),t.newTournamentRecord=(i={})=>{let n=bae(i),r=n.tournamentId;return n.error?n:(t7(n),AT(r),{...ae,tournamentId:r})},t.setState=(i,n,r)=>{RT(n,r);let o=M0(i,n);return _b(t,o)},t.setTournamentId=i=>AT(i),t.getTournamentId=()=>Uy(),t.setTournamentRecord=(i,n,r)=>{RT(n,r);let o=t7(i,n);return _b(t,o)},t.removeTournamentRecord=i=>{let n=WQ(i);return _b(t,n)},t.removeUnlinkedTournamentRecords=()=>{let i=yRe();return _b(t,i)}}function wRe(t){let e=$Q();if(e.error&&!t)return e;let i={executionQueue:(n,r)=>bRe(i,n,r),execute:n=>i7(i,n)};return vz(i,i7),i}function SRe(t,e,i){if(!Array.isArray(e))return{error:Pe,message:"directives must be an array"};let n=bV(),r=Date.now(),o=i&&dt(If(),!1,!0),a=[];for(let c of e){if(typeof c!="object")return{error:Pe,message:"directive must be an object"};if(c.params&&typeof c.params!="object")return{error:Pe,message:"params must be an object"};let{method:u,pipe:d}=c,p=c.params?{...c.params}:{};if(!n[u])return DP({methodName:u,start:r,params:p});if(d){let f=a[a.length-1],m=Object.keys(d);for(let g of m)f[g]&&(p[g]=f[g])}let h=PP(t,n[u],p,u,"sync");if(h!=null&&h.error)return o&&M0(o),{...h,rolledBack:!!o};a.push({...h,methodName:u})}let s=Date.now(),l=F_({timeStamp:s});return B_({directives:e,mutationStatus:l,timeStamp:s}),Ty(),{success:a.every(c=>c.success),results:a}}function n7(t,e){if(!ln(e))return{error:Pe,message:"args must be an object"};let i=Object.values(e).filter(ya).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Pe};let n=i?Object.keys(e).find(h=>ya(e[h])):oa(e.method)&&e.method;if(!n)return{error:gD};let{[n]:r,...o}=e,a=e!=null&&e.params?{...e.params}:{...o},s=a.rollbackOnError&&dt(If(),!1,!0),l=r||t[n]||iA()[n];if(!l)return DP({methodName:n,params:a});let c=PP(t,l,a,n,"sync")??{};c!=null&&c.error&&s&&M0(s);let u=Date.now(),d=F_({timeStamp:u}),p=(c==null?void 0:c.success)&&(a==null?void 0:a.delayNotify)!==!0&&(a==null?void 0:a.doNotNotify)!==!0;return p&&B_({directives:[{method:l,params:a}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||a!=null&&a.doNotNotify)&&Ty(),c}var ele=(()=>{let t={executionQueue:(e,i)=>SRe(t,e,i),execute:e=>n7(t,e)};return vz(t,n7),t})(),CP=ele;function r7(t,e){if(!ln(e))return{error:Pe,message:"args must be an object"};let i=Object.values(e).filter(ya).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Pe};let n=i?Object.keys(e).find(l=>ya(e[l])):oa(e.method)&&e.method;if(!n)return{error:gD};let{[n]:r,...o}=e,a=e!=null&&e.params?{...e.params}:{...o},s=r||t[n]||iA()[n];return s?PP(t,s,a,n,"ask"):DP({methodName:n,params:a})}var TRe=(()=>{let t={execute:e=>r7(t,e)};return vz(t,r7),t})(),yv={},Th;function o7(t,e=!0){if(!t)return{error:gt};if(typeof t!="object")return{error:Lp};if(t.matchUpId)Th=t.matchUpId,yv[Th]=e?dt(t):t;else if(Array.isArray(t))for(let i of t.reverse())i.matchUpId&&(yv[i.matchUpId]=e?dt(i):i,Th||(Th=i.matchUpId));else for(let i of Object.values(t))i.matchUpId&&(yv[i.matchUpId]=e?dt(i):i,Th||(Th=i.matchUpId));return e?dt(t):t}function URe(){return yv[Th]}function DRe(){return Object.values(yv)}function PRe(){Th=void 0,yv={}}function CRe(t){return dt(yv[Th],t==null?void 0:t.convertExtensions,!1,t==null?void 0:t.removeExtensions)}var ERe=(()=>{let t={getState:r=>CRe(r),version:()=>Yw(),reset:()=>(PRe(),{...ae}),drawId:void 0,error:void 0,success:!1,devContext:r=>(MT(r),t),setState:(r,o,a)=>{RT(o,a);let s=o7(r);return e(s)}};function e(r){return r!=null&&r.error?(t.error=r.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=r.drawId),t}return i([mv]),t;function i(r){r.forEach(o=>{Object.keys(o).forEach(a=>{t[a]=s=>{if(rl())return n({params:s,governor:o,methodName:a});try{return n({params:s,governor:o,methodName:a})}catch(l){rA({engineName:"matchUpEngine",methodName:a,params:s,err:l})}}})})}function n({params:r,governor:o,methodName:a}){t.error=void 0,t.success=!1;let s=(r==null?void 0:r.matchUp)||URe(),l=(r==null?void 0:r.matchUps)||DRe(),c=(r==null?void 0:r.rollbackOnError)&&dt(s,!1,!0);r={...r,matchUpId:s==null?void 0:s.matchUpId,matchUps:l,matchUp:s};let u=o[a](r);if(u!=null&&u.error)return c&&o7(c),{...u,rolledBack:!!c};let d=(u==null?void 0:u.success)&&(r==null?void 0:r.delayNotify)!==!0&&(r==null?void 0:r.doNotNotify)!==!0;return d&&B_(),(d||!(u!=null&&u.success)||r!=null&&r.doNotNotify)&&Ty(),u}})(),$O=!1,$_=(()=>{let t={version:()=>Yw(),setDeepCopy:(n,r)=>(RT(n,r),t),devContext:n=>(MT(n),$O=!0,t)};return i([M_]),t;function e(n,r){let o=n({...r});return o!=null&&o.error||B_(),Ty(),$O&&(MT(!1),$O=!1),o}function i(n){n.forEach(r=>{Object.keys(r).forEach(o=>{t[o]=a=>{try{let s=e(r[o],a);return!(s!=null&&s.error)&&(a!=null&&a.setState)&&(s!=null&&s.tournamentRecord)&&M0(s.tournamentRecord),s}catch(s){let l;typeof s=="string"?l=s.toUpperCase():s instanceof Error&&(l=s.message),console.log("ERROR",{params:JSON.stringify(a),method:o,error:l})}}})})}})();CP.importMethods(HN,!0,1);var yg=CP,Ye=CP;function tle(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function MRe(t){let{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:o,drawType:a,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e,h=f=>!n&&!l||!f.dateRanges?!0:f.dateRanges.some(m=>{let g=!n||!m.startDate||new Date(n)>new Date(m.startDate),v=!l||!m.endDate||new Date(l)<=new Date(m.endDate);return g&&v});return{awardProfile:i.find(f=>{var m,g,v,y,b,I,T,S,w,U;return h(f)&&(!f.maxFlightNumber||d<=f.maxFlightNumber)&&(!((m=f.drawTypes)!=null&&m.length)||((g=f.drawTypes)==null?void 0:g.includes(a)))&&(!((v=f.drawSizes)!=null&&v.length)||f.drawSizes.includes(o))&&(!((y=f.stages)!=null&&y.length)||f.stages.includes(p))&&(!((b=f.levels)!=null&&b.length)||f.levels.includes(c))&&(!f.maxDrawSize||o<=f.maxDrawSize)&&(!f.drawSize||f.drawSize===o)&&(!f.maxLevel||c<=f.maxLevel)&&(!d||!((T=(I=f.flights)==null?void 0:I.flightNumbers)!=null&&T.length)||f.flights.flightNumbers.includes(d))&&(!f.participationOrder||f.participationOrder===u)&&(!((S=f.category)!=null&&S.ageCategoryCodes)||f.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((w=f.eventTypes)!=null&&w.length)||((U=f.eventTypes)==null?void 0:U.includes(r)))})}}function a7({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:o}){var f,m;let a=(g,v)=>{if(g){if(Array.isArray(v)){let y=v.find(b=>b.flight===g||b.f===g);return y.value||y.v}if(typeof v=="object"){let y=v.flights||v.f;if(Array.isArray(y))return y[g-1]}}},s=(g,v)=>{let y=(g==null?void 0:g.value)||(g==null?void 0:g.v)||(Bt(g)?g:0),b=tle(o,g==null?void 0:g.level);return{value:a(v,b)||Bt(b)&&b||y}},l=0,c,u,d,p,h=t&&"won"||t===!1&&"lost"||void 0;if(Array.isArray(i)){let g=i.find(b=>{var I;return b.drawSize===n||((I=b.drawSizes)==null?void 0:I.includes(n))}),v=i.find(b=>b.drawSize&&b.threshold&&n>b.drawSize),y=i.find(b=>{var I;return!b.drawSize&&!((I=b.drawSizes)!=null&&I.length)});h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h],y=y==null?void 0:y[h]),u=s(g,e).value,d=s(v,e).value,p=s(y,e).value,l=u||d||p,c=u&&g.requireWin||d&&v.requireWin||(y==null?void 0:y.requireWin)}else if(typeof i=="object"){let g=(f=i==null?void 0:i.drawSizes)==null?void 0:f[n],v=i;h!==void 0&&(g=g==null?void 0:g[h],v=v==null?void 0:v[h]),u=s(g,e).value,p=s(v,e).value,l=u||p,c=u?g.requireWin:v==null?void 0:v.requireWin}else Bt(i)&&h===void 0&&(l=i);return e&&((m=r==null?void 0:r.pct)!=null&&m[e])&&(l=Math.round(l*r.pct[e])),{awardPoints:l,requireWin:c}}function RRe({participantFilters:t,policyDefinitions:e,tournamentRecord:i,level:n}){var v;if(!i)return{error:Ge};let{policyDefinitions:r}=$p({policyTypes:[UE],tournamentRecord:i}),o=(e==null?void 0:e[UE])??(r==null?void 0:r[UE]);if(!o)return{error:WN};let a=o.awardProfiles,s=o.requireWinFirstRound,l=o.requireWinForPoints,{participants:c,derivedEventInfo:u,derivedDrawInfo:d,mappedMatchUps:p}=zn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),h=c==null?void 0:c.filter(y=>{var b;return(b=y.draws)==null?void 0:b.length}),f={},m={},g={};for(let y of h??[]){let{participantType:b,participantId:I,person:T,draws:S}=y;for(let w of S){let{drawId:U,structureParticipation:D,eventId:E}=w,C=u[E],M=d[U],N=M==null?void 0:M.drawType,{category:R,eventType:A}=C||{},_=w.startDate||C.startDate||i.startDate,k=w.endDate||C.endDate||i.endDate;if(A===al&&I!==el)continue;let O;if(a){let F=l,B=0,$=0,V=0,H;for(let z of D){let{finishingPositionRange:G,participationOrder:W,participantWon:K,flightNumber:Z,rankingStage:Y,winCount:X}=z;B+=X||0;let Q=M==null?void 0:M.drawSize,{awardProfile:te}=MRe({awardProfiles:a,participation:z,eventType:A,startDate:_,category:R,drawSize:Q,drawType:N,endDate:k,level:n});if(te){if(!Q)continue;let J=Array.isArray(G)&&Math.max(...G),ie=Zt(G||[]).join("-"),oe=J&&Y!==Tt&&(G==null?void 0:G.includes(Q));te.requireWinForPoints!==void 0&&(F=te.requireWinForPoints),te.requireWinFirstRound!==void 0&&(s=te.requireWinFirstRound);let{finishingPositionPoints:ne={},finishingPositionRanges:re,finishingRound:me,pointsPerWin:he,flights:be}=te,Se=Array.isArray(te.perWinPoints)?(v=te.perWinPoints)==null?void 0:v.find($e=>{var Ae;return(Ae=$e.participationOrders)==null?void 0:Ae.includes(W)}):te.perWinPoints,De=ne.participationOrders,Oe=0,xe;if((!De||De.includes(W))&&re&&J){let $e=re[J];$e&&({awardPoints:Oe,requireWin:xe}=a7({flightNumber:Z,valueObj:$e,drawSize:Q,flights:be,level:n}))}if(!Oe&&me&&W===1&&J){let $e=me[J];$e&&({awardPoints:Oe,requireWin:xe}=a7({participantWon:K,flightNumber:Z,valueObj:$e,drawSize:Q,flights:be,level:n}))}if(oe&&s!==void 0&&(F=s),xe!==void 0&&(F=xe),Oe>$&&(!F||X)&&($=Oe,H=J),!Oe&&he&&X&&(V+=X*he,H=ie),!Oe&&X&&Se){let $e=tle(n,Se==null?void 0:Se.level);$e?V+=X*$e:Se.value&&(V+=X*Se.value)}}if(O=$+V,b===el){let J=(y.matchUps||[]).filter(({structureId:ie})=>ie===z.structureId);for(let{matchUpId:ie}of J){let oe=p[ie],ne=oe.sides.find(re=>re.participantId===I).sideNumber;if(oe.winningSice===ne)for(let re of oe.tieMatchUps)re.winningSide}}}if(V||$){let z={winCount:B,positionPoints:$,rangeAccessor:H,perWinPoints:V,eventType:A,drawId:U,points:O},G=T==null?void 0:T.personId;G?(f[G]||(f[G]=[]),f[G].push(z)):b===jt?(g[I]||(g[I]=[]),g[I].push(z)):b===el&&(m[I]||(m[I]=[]),m[I].push(z))}}}}return{participantsWithOutcomes:h,personPoints:f,pairPoints:g,teamPoints:m,...ae}}var NRe={getTournamentPoints:RRe},ARe=NRe,_Re={calculateNewRatings:hne,generateDynamicRatings:fne},kRe=_Re,xRe={...ARe,...kRe};CP.importMethods(xRe);var ORe=CP,LRe={[OT]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},FRe={[hp]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[hv,eT]}},BRe={[hp]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[hv,KT,jv],disabledActions:[]}]}},$Re={[hp]:{policyName:"positionActionsDisabled",enabledStructures:!1}},VRe={[s0]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},jRe={[vd]:{defaultMatchUpFormat:Ks,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[ut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},HRe={[vd]:{requireAllPositionsAssigned:!1,stage:{[ut]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Ks,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Ks,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},GRe={[Ml]:{seedingProfile:{positioning:hA},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},zRe={POLICY_AVOIDANCE_COUNTRY:LRe,POLICY_POSITION_ACTIONS_DEFAULT:Wie,POLICY_POSITION_ACTIONS_DISABLED:$Re,POLICY_POSITION_ACTIONS_NO_MOVEMENT:BRe,POLICY_POSITION_ACTIONS_UNRESTRICTED:FRe,POLICY_PRIVACY_DEFAULT:VRe,POLICY_ROUND_NAMING_DEFAULT:Ej,POLICY_SCHEDULING_DEFAULT:coe,POLICY_SCORING_DEFAULT:jRe,POLICY_SCORING_USTA:HRe,POLICY_SEEDING_ITF:GRe,POLICY_SEEDING_DEFAULT:Yre},iw={ratingsParameters:vs,matchUpFormats:JDe,countryToFlag:mte,tieFormats:xoe,countries:_h,policies:zRe,flagIOC:uUe},Ca={};ii(Ca,{activeMatchUpStatuses:()=>pA,auditConstants:()=>Uoe,completedMatchUpStatuses:()=>Nr,directingMatchUpStatuses:()=>WV,drawDefinitionConstants:()=>yr,entryStatusConstants:()=>tc,errorConditionConstants:()=>RQ,eventConstants:()=>ps,extensionConstants:()=>BV,flightConstants:()=>Foe,genderConstants:()=>Lu,keyValueConstants:()=>RH,matchUpActionConstants:()=>IH,matchUpStatusConstants:()=>KV,matchUpTypes:()=>kee,nonDirectingMatchUpStatuses:()=>qV,particicipantsRequiredMatchUpStatuses:()=>GV,participantConstants:()=>Fo,participantRoles:()=>Pf,participantTypes:()=>mI,penaltyConstants:()=>ile,policyConstants:()=>rg,positionActionConstants:()=>$y,ratingConstants:()=>pne,recoveryTimeRequiredMatchUpStatuses:()=>vee,requestConstants:()=>gae,resultConstants:()=>UJ,scaleConstants:()=>r0,scheduleConstants:()=>rte,sortingConstants:()=>$oe,surfaceConstants:()=>nle,tieFormatConstants:()=>Vre,timeItemConstants:()=>TA,topicConstants:()=>Nee,tournamentConstants:()=>cz,upcomingMatchUpStatuses:()=>YV,validMatchUpStatuses:()=>zV,venueConstants:()=>rle});var WRe="Coaching",qRe="Ball Abuse",YRe="Racket Abuse",KRe="Verbal Abuse",ZRe="INELIGIBILITY",XRe="Physical Abuse",JRe="Unsportmanlike Conduct",QRe="Dress Code Violation",eNe="Equipment Violation",tNe="Leaving the court",iNe="Failure to complete",nNe="No Show",rNe="Other",oNe="REFUSAL_TO_PLAY",aNe="PROHIBITED_SUBSTANCE",sNe="Puncuality",lNe="Failure to sign in",ile={COACHING:WRe,BALL_ABUSE:qRe,RACKET_ABUSE:YRe,VERBAL_ABUSE:KRe,PHYSICAL_ABUSE:XRe,INELIGIBILITY:ZRe,UNSPORTSMANLIKE_CONDUCT:JRe,PROHIBITED_SUBSTANCE:aNe,DRESS_CODE_VIOLATION:QRe,EQUIMENT_VIOLATION:eNe,LEAVING_THE_COURT:tNe,REFUSAL_TO_PLAY:oNe,FAILURE_TO_COMPLETE:iNe,NO_SHOW:nNe,OTHER:rNe,PUNCTUALITY:sNe,FAILUIRE_TO_SIGN_IN:lNe},cNe="CLAY",uNe="HARD",dNe="GRASS",pNe="CARPET",hNe="ARTIFICIAL",nle={CLAY:cNe,HARD:uNe,GRASS:dNe,CARPET:pNe,ARTIFICIAL:hNe},fNe="INDOOR",mNe="OUTDOOR",rle={INDOOR:fNe,OUTDOOR:mNe};const ole=Object.freeze(Object.defineProperty({__proto__:null,activeMatchUpStatuses:pA,askEngine:TRe,asyncEngine:wRe,auditConstants:Uoe,competitionEngine:yg,competitionGovernor:$$,completedMatchUpStatuses:Nr,directingMatchUpStatuses:WV,drawDefinitionConstants:yr,drawsGovernor:$V,entriesGovernor:gG,entryStatusConstants:tc,errorConditionConstants:RQ,eventConstants:ps,eventGovernor:bG,extensionConstants:BV,factoryConstants:Ca,fixtures:iw,flightConstants:Foe,forge:pRe,genderConstants:Lu,generationGovernor:CG,globalState:ZS,governors:HN,keyValueConstants:RH,matchUpActionConstants:IH,matchUpEngine:ERe,matchUpFormatCode:Tp,matchUpFormatGovernor:Tp,matchUpGovernor:RG,matchUpStatusConstants:KV,matchUpTypes:kee,mocksEngine:$_,mocksGovernor:M_,nonDirectingMatchUpStatuses:qV,particicipantsRequiredMatchUpStatuses:GV,participantConstants:Fo,participantGovernor:QG,participantRoles:Pf,participantTypes:mI,penaltyConstants:ile,policyConstants:rg,policyGovernor:FH,positionActionConstants:$y,publishingGovernor:x_,queryGovernor:BH,ratingConstants:pne,recoveryTimeRequiredMatchUpStatuses:vee,reportGovernor:tz,requestConstants:gae,resultConstants:UJ,scaleConstants:r0,scaleEngine:ORe,scheduleConstants:rte,scheduleGovernor:iz,scoreGovernor:mv,sortingConstants:$oe,surfaceConstants:nle,syncEngine:ele,tieFormatConstants:Vre,tieFormatGovernor:rz,timeItemConstants:TA,tools:Di,topicConstants:Nee,tournamentConstants:cz,tournamentEngine:Ye,tournamentGovernor:lz,upcomingMatchUpStatuses:YV,utilities:Di,validMatchUpStatuses:zV,venueConstants:rle,venueGovernor:uz,version:Yw},Symbol.toStringTag,{value:"Module"})),{AFTER_REST:ale,FOLLOWED_BY:sle,NEXT_AVAILABLE:lle,NOT_BEFORE:cle,TO_BE_ANNOUNCED:ule}=Ca.timeItemConstants,{SCHEDULE_ERROR:gNe,SCHEDULE_CONFLICT:vNe,SCHEDULE_WARNING:yNe}=Ca.scheduleConstants,{ORGANISER_ACCEPTANCE:bNe,DIRECT_ACCEPTANCE:INe,SPECIAL_EXEMPT:wNe,JUNIOR_EXEMPT:SNe,ALTERNATE:TNe,WILDCARD:UNe}=tc,s7="All statuses",DNe="All genders",VO="All flights",zv="All events",l7="All teams",dle="registration",PNe="timepicker",CNe="timevalue",XM="tmxContent",ple="tmxDrawer",V_="navbar",nU="splash",j_="superadmin",JM="competitionEngine",jO="tournamentEngine",Up="tournaments",hle="drawEntries",Xo="tournament",M2="structure",ENe="invite",Gg="event",xS="draw",R2="view",rU="tournamentEvents",EP="overview",Dp="participants",Wv="schedule",yz="matchUps",Xu="events",bz="venues",MNe="unscheduled",MP={success:!0},RNe=10,fle="ISSUE",Vs="Automated",Iz="Manual",mle={[gNe]:"matchup-error",[vNe]:"matchup-conflict",[fle]:"matchup-issue",[yNe]:"matchup-warning"},QM="tournamentParticipants",gle="scheduledDateFilter",bv="unscheduledMatchUps",H_="tournamentsCalendar",eR="tournamentMatchUps",tR="tournamentSchedule",N2="tournamentsTable",iR="tournamentTeams",nR="venuesTable",vle="entriesCount",yle="eventsTable",oU="tmxOverlay",wz="teamStats",Sz="drawControl",NNe="drawFrame",ble="drawRight",Ile="drawLeft",wle="entriesView",Ud="drawsView",RP="QUALIFYING",pc="ACCEPTED",Sle="eventInfo",Tz="acceptedPanel",Uz="alternatesPanel",Dz="qualifyingPanel",Pz="ungroupedPanel",Cz="withdrawaPanel",Tle="unscheduledVisibility",Ule="tournamentsControl",Ez="participantControl",Mz="unscheduledControl",Rz="scheduleControl",Nz="matchUpsControl",Az="venuesControl",_z="eventsControl",NP="eventControl",kz="teamsControl",ANe="controlBar",Dle="buttonBar",qg="tmxPanel",Ple="tmxTable",Cle="tcContainer",Pr="overlay",Vt="center",rR="header",Ut="right",Lt="left",Rf="bottom",c7="top",G_="subTable",nw="",T1="flex",ht="none",Ele="isOpen",xz="Collection value",Oz="Match value",Lz="Score value",Fz="Set value",pS={[ale]:"After rest",[sle]:"Followed by",[ule]:"To be announced",[lle]:"Next available",[cle]:"Not before"},_Ne={[ale]:"After rest",[sle]:"Followed by",[ule]:"TBA",[lle]:"Next available",[cle]:"NB"},Mle={[bNe]:"OA",[INe]:"DA",[wNe]:"SE",[SNe]:"JE",[RP]:"QUAL",[TNe]:"ALT",[UNe]:"WC"},oR="Playoff",tm="drawSize",aR="CUSTOM",Qb="advancePerGroup",sR="qualifiersCount",lR="groupRemaining",Bz="matchUpFormat",aU="structureName",iT="playoffType",Qd="groupSize",Rle="positions",qv="drawName",ed="drawType",nT="top",kNe="winners",A2="roundsColumns",rw="roundsStats",ow="roundsTable",$z="utr",xNe="wtn",rT={},ONe={position:"top-right",clickClose:!0,duration:2e3,offsetBottom:0,offsetRight:0,offsetLeft:0,offsetTop:0,opacity:1},LNe=(t,e,i,n,r)=>{const o=t.split("-"),a=o.includes(Lt)&&`left:${n}`,s=o.includes(Ut)&&`right:${r}`,l=o.includes("top")&&`top:${e}`,c=o.includes("bottom")&&`bottom:${i}`,u="align-items: "+(o.includes("left")&&"flex-start"||o.includes("right")&&"flex-end"||Vt),d="text-align: "+(o.includes("left")&&"left"||o.includes("right")&&"right"||Vt);return[a,s,l,c,u,d].filter(Boolean).join(";")};function FNe(t){if(rT.position)return rT.position;const e=document.createElement("div");return e.style="position: fixed; display: flex; flex-direction: column; width:100%; z-index: 9999; pointer-events: none;padding:15px;"+LNe(t.position,t.offsetTop,t.offsetBottom,t.offsetLeft,t.offsetRight),(t.appendTo||document.body).appendChild(e),rT.position=e,e}function BNe(t){if(!t.message)return{error:"Missing message"};const e={...ONe,...t},i=FNe(e),n=$Ne(e);if(e.onlyOne){let r=i.lastElementChild;for(;r;)i.removeChild(r),r=i.lastElementChild}i.appendChild(n.element)}function $Ne(t){var l,c;const e=document.createElement("div");t.clickClose&&e.addEventListener("click",()=>o(t.onClose));const i=t.duration&&I0e(()=>o(t.onClose),t.duration);i&&t.pauseOnHover&&(e.addEventListener("mouseover",i.pause),e.addEventListener("mouseout",i.resume)),e.style=`display:inline-flex;width:auto;pointer-events:auto;white-space:pre-wrap;opacity:${t.opacity};${t.dismissible?"":"padding: 1.25rem, 1.5rem;"}`;const n=["notification"];if(typeof t.classList=="string"&&n.push(t.classList),t.type&&n.push(t.type),(l=t==null?void 0:t.animate)!=null&&l.in){const u=t.animate.speed?`animate__${t.animate.speed}`:"animate__faster",d=`animate__${t.animate.in}`;n.push(`animate__animated ${d} ${u}`),s(()=>e.classList.remove(d))}if(e.className=n.join(" "),t.dismissible){const u=document.createElement("button");u.className="delete",u.addEventListener("click",()=>o(t.onClose)),e.insertAdjacentElement("afterbegin",u)}const r=document.createElement("div");if(r.style="display: flex; flex-direction: row; align-items: center; justify-content: center;",typeof t.message=="string"?r.insertAdjacentHTML("beforeend",t.message):t.message&&(console.log(" MESSAGE ",t.message,typeof t.messsage),r.appendChild(t.message)),vt((c=t.action)==null?void 0:c.onClick)){const u=document.createElement("button");u.style="margin-left: 1em;",u.className="button",u.innerHTML=t.action.text||"OK",u.addEventListener("click",t.action.onClick),r.appendChild(u)}return e.appendChild(r),{element:e};function o(u){var d;vt(u)&&u(),(d=t==null?void 0:t.animate)!=null&&d.out?(e.classList.add(`animate__${t.animate.out}`),s(()=>{a(e.parentNode),delete rT.position,e.remove()})):(a(e.parentNode),delete rT.position,e.remove())}function a(u){u&&u.children.length<=1&&u.remove()}function s(u=()=>{}){const d={WebkitAnimation:"webkitAnimationEnd",MozAnimation:"mozAnimationEnd",OAnimation:"oAnimationEnd",animation:"animationend"};for(const p in d)if(e.style[p]!==void 0){e.addEventListener(d[p],()=>u());break}}}function vi(t){const{position:e="top-center",intent:i="is-success",pauseOnHover:n=!1,dismissible:r=!0,clickClose:o=!0,duration:a=2500,single:s=!0,onClose:l,offsetBottom:c=0,offsetRight:u=0,offsetLeft:d=0,offsetTop:p=0,opacity:h=1,message:f,action:m}=t??{};BNe({animate:{in:"fadeIn",out:"fadeOut"},pauseOnHover:n,offsetBottom:c,type:i,offsetRight:u,dismissible:r,offsetLeft:d,clickClose:o,offsetTop:p,duration:a,position:e,message:f,onClose:l,opacity:h,action:m,single:s})}function VNe(){vi({intent:"is-success",message:"New Version Cached: Close Tab or Browser and Re-open to Update"})}function jNe(){let t=`${Fn.tr("phrases.blocked")}. ${Fn.tr("phrases.enablepopups")}`;return vi({intent:"is-danger",message:t})}function HNe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="o-tab",t.innerHTML=`
    <div class="tab_section events_tab">
        <div class="section">
            <div id=${EP} class="box tournament-information">
            </div>
        </div>
    </div>
  `,t}function GNe(){const t=document.createElement("nav");return t.className="navbar is-transparent",t.ariaLabel="main navigation",t.style.display=ht,t.style.width="100%",t.role="navigation",t.id=V_,t.innerHTML=`
    <div class="navbar-brand">
      <div class="navbar-item" id="provider">TMX</div>
      <div class="navbar-item" id="pageTitle"></div>
      <a
        data-target="navbar-basic"
        class="navbar-burger"
        aria-expanded="false"
        aria-label="menu"
        role="button"
      >
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
        <span aria-hidden="true"></span>
      </a>
    </div>

    <div id="navbar-menu" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" style="font-size: 2em">
          <i id="config" class="fa-solid fa-sliders"></i>
        </div>
        <div class="navbar-item" style="font-size: 2.5em">
          <i id="login" class="fa-solid fa-circle-user"></i>
        </div>
      </div>
    </div>
  `,t}function zNe(){const t=document.createElement("div");return t.className="is-marginless",t.style.width="inherit",t.id="e-tab",t.innerHTML=`
  <div class="tab_section events_tab">
    <div class="section">
      <div class='tabHeader foreground'></div>
      <div id=${Sle} class="block" style='display: none; width: 100%;'}>
        <div id=${NP} class="controlBar" style='min-height: 3em; border-radius: 6px;'}></div>
      </div>
      <div id=${yle}>
        <div id=${_z} class="controlBar"></div>
        <div id=${rU} class="tableClass flexcol flexcenter">
          {' '}
        </div>
      </div>
      <div id=${wle} style='display: none;'}>
        <div id=${Tz} class='tableClass block ${qg}'>
          {' '}
        </div>
        <div id=${Dz} class='tableClass block ${qg}'>
          {' '}
        </div>
        <div id=${Uz} class='tableClass block ${qg}'>
          {' '}
        </div>
        <div id=${Pz} class='tableClass block ${qg}'>
          {' '}
        </div>
        <div id=${Cz} class='tableClass block ${qg}'>
          {' '}
        </div>
      </div>
      <div style="background-color: white; width: 100%; margin: 0">
        <div id=${Sz}></div>
        <div id=${NNe} class="flexrow flexjustifystart" style="width: 100%">
          <div id=${Ile} ></div>
          <div
            id=${Ud}
            style="overflow-x: scroll; width: 100%; display: none;"
          >
          </div>
          <div id=${ble} ></div>
        </div>
      </div>
    </div>
  </div>
  `,t}const WNe=""+new URL("orgLogo-DsK9KK2k.png",import.meta.url).href;function qNe(){const t=document.createElement("img");return t.style.maxWidth="800px",t.style.width="100%",t.alt="tmxLogo",t.src=WNe,t}function YNe(){const t=document.getElementById("root"),e=document.createElement("div");e.className="flexrow flexcenter",e.id=nU,e.style="margin-top: 2em; padding-top: 5em; display: none;",e.appendChild(qNe()),t.appendChild(e);const i=document.createElement("div");i.style.display=ht,i.id=PNe;const n=document.createElement("input");n.className="timepicker-ui-input",n.id=CNe,n.type="text",i.appendChild(n),t.appendChild(i);const r=document.createElement("section");r.className="drawer drawer--left",r.setAttribute("data-drawer-target",""),r.id=ple,r.innerHTML=`
      <div class="drawer__overlay" data-drawer-close tabIndex="-1"></div>
      <div class="drawer__wrapper">
        <div class="drawer__header">
          <div class="drawer__title"></div>
          <button
            class="drawer__close"
            style='display: none;'}
            data-drawer-close
            aria-label="Close Drawer"
          ></button>
        </div>
        <div class="drawer__content"></div>
        <div class="drawer__footer"></div>
      </div>
  `,t.appendChild(r);const o=document.createElement("div");o.className="main noselect",o.appendChild(GNe());const a=document.createElement("div");a.id=XM,a.className="springboard flexrow flexcenter",a.style.display=ht;const s=document.createElement("div");s.id="sideNav",s.className="sideNav",a.appendChild(s);const l=document.createElement("div");l.id=Cle,l.className="flexcol flexcenter tournament_container",l.appendChild(HNe()),l.appendChild(zNe()),a.appendChild(l),o.appendChild(a);const c=document.createElement("div");c.className="flexcol flexgrow",c.style.paddingTop="3em",c.style.display=ht,c.id=Up;const u=document.createElement("div");u.className="controlBar flexcol flexgrow flexcenter",u.id=Ule,c.appendChild(u);const d=document.createElement("div");d.className="flexcol flexgrow flexcenter box",d.id=N2,c.appendChild(d),o.appendChild(c);const p=document.createElement("div");return p.className="flexcol flexgrow",p.style.paddingTop="3em",p.style.display=ht,p.style.height="90%",p.style.width="100%",p.id=H_,o.appendChild(p),t.appendChild(o),t}window.location.hostname==="localhost"||window.location.hostname==="[::1]"||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/);function KNe(){"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(t=>{t.unregister()})}function Ua(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const xE={[EP]:"o-tab",[Dp]:"p-tab",[Xu]:"e-tab",[yz]:"m-tab",[Wv]:"s-tab",[bz]:"v-tab"};function ZNe(){const t=`
        <div id='individuals' class='tab_section participants_tab'>
          <div class='section'>
            <div class='tabHeader foreground'>Participants</div>
              <div id='${Ez}' class='controlBar'></div>
              <div id='${QM}' class='tableClass flexcol flexcenter'> </div>
          </div>
        </div>
        <div id='participantGroupings' class='tab_section participants_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${kz}' class='controlBar'></div>
              <div id='${iR}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,e=`
        <div class='tab_section sch_tab'>
            <div class='section block'>
              <div id='${Tle}' style='width: 100%; display: none;'>
                  <div id='${Mz}' class='controlBar flexcol flexcenter'></div>
                  <div id='${bv}' class='tableClass flexcol flexcenter'></div>
              </div>
              <div>
                  <div id='${Rz}' class='controlBar flexcol flexcenter'></div>
                  <div id='${tR}' class='tableClass flexcol flexcenter'></div>
              </div>
            </div>
        </div>
        `,i=`
        <div class='tab_section venues_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${Az}' class='controlBar'></div>
              <div id='${nR}' class='tableClass flexcol flexcenter'></div>
            </div>
        </div>
        `,n=`
        <div class='tab_section matchUps_tab'>
            <div class='section'>
              <div class='tabHeader foreground'></div>
              <div id='${Nz}' class='controlBar'></div>
              <div id='${wz}' class='controlBar'></div>
              <div id='${eR}' class='tableClass flexcol flexcenter'> </div>
            </div>
        </div>
        `,r={"p-tab":t,"s-tab":e,"v-tab":i,"m-tab":n},o=document.getElementById(Cle);Object.keys(r).forEach(a=>{const s=document.createElement("div");s.class="is-marginless",s.style="width: inherit",s.id=a,s.innerHTML=r[a],o.appendChild(s)}),Nle(Dp)}function Nle(t){return Object.keys(xE).includes(t)?(Object.keys(xE).forEach(e=>{const i=xE[e],n=document.getElementById(i);n?n.style.display=t===e?"":ht:console.log({key:e,id:i,element:n})}),{...MP}):!1}function XNe(){[Ud,_z,Nz,Ez,Mz,NP,kz,Rz,Az,wz,Tz,Uz,Dz,Pz,Cz,rU,eR,QM,tR,iR,bv,nR].forEach(e=>{const i=xE[e],n=document.getElementById(i);n&&Ua(n)})}function Ale(){const t=!window.location.host.startsWith("localhost");!window.location.host.endsWith("github.io")&&t&&window.dev&&(delete window.dev,console.log("%c dev cancelled","color: cyan"))}function _le(){return"tmxToken"}const Vz=_le();function kle(){localStorage.removeItem(Vz)}function xle(){return localStorage.getItem(Vz)}function JNe(t){localStorage.setItem(Vz,t)}var Ole=function(t){return String.prototype.normalize?t.normalize("NFKD").replace(/[\u0300-\u036F]/g,""):t};function z_({note:t,data:e}){try{return JSON.parse(e)}catch{console.log({message:"falied normal parse",note:t})}}function QNe(t){if(t){if(typeof t=="string")return t;try{return JSON.stringify(t)}catch{return""}}}function Lle(t,e){let i=document.createElement("a");i.style.display="none",i.setAttribute("href",e),i.setAttribute("download",t);let n=document.body.appendChild(i);n.click(),n.remove()}function eAe(t,e){let i="data:text/json;charset=utf-8,"+encodeURIComponent(QNe(e));Lle(t,i)}function tAe(t,e){let i="data:text/plain;charset=utf-8,"+encodeURIComponent(e);Lle(t,i)}function iAe(){const t=s=>s.toString()[1]?s:"0"+s,e=s=>{if(!s)return"";const l=new Date(s);return[t(l.getMonth()+1),t(l.getDate()),l.getFullYear()].join("/")},{tournamentInfo:i}=Ye.getTournamentInfo(),{completedMatchUps:n}=Ye.tournamentMatchUps({context:{tournamentStartDate:e(i.startDate),tournamentEndDate:e(i.endDate),tournamentEventSource:"CourtHive",tournamentEventType:"Tournament",...i,idType:$z}}),r=n.map(s=>{const{winningSide:l,sides:c,score:u}=s,d=c.find(({sideNumber:f})=>f===l),p=c.find(({sideNumber:f})=>f!==l);return{winnerScore:u[`scoreStringSide${l}`],...s,winners:d,losers:p}}),o={columnAccessors:[""],columnTransform:{"Winner 1 Name":["winners.participant.individualParticipants.0.participantName","winners.participant.participantName"],"Winner 1 Third Party ID":["winners.participant.individualParticipants.0.participantId","winners.participant.participantId"],"Winner 1 City":["winners.participant.individualParticipants.0.addresses.0.city","winners.participant.addresses.0.city"],"Winner 1 State":["winners.participant.individualParticipants.0.addresses.0.state","winners.participant.addresses.0.state"],"Winner 1 Country":["winners.participant.individualParticipants.0.addresses.0.nationalityCode","winners.participant.addresses.0nationalityCode"],"Winner 1 Gender":["winners.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Winner 1 DOB":["winners.participant.individualParticipants.0.person.birthDate","winners.participant.person.birthDate"],"Winner 2 Name":["winner.participant.individualParticipants.1.participantName"],"Winner 2 City":["winners.participant.individualParticipants.1.addresses.0.city"],"Winner 2 State":["winners.participant.individualParticipants.1.addresses.0.state"],"Winner 2 Country":["winners.participant.individualParticipants.1.addresses.0.nationalityCode"],"Winner 2 Third Party ID":["winners.participant.individualParticipants.1.participantId"],"Winner 2 Gender":["winners.participant.individualParticipants.1.person.sex"],"Winner 2 DOB":["winners.participant.individualParticipants.1.person.birthDate"],"Loser 1 Name":["losers.participant.individualParticipants.0.participantName","losers.participant.participantName"],"Loser 1 City":["losers.participant.individualParticipants.0.addresses.0.city","losers.participant.addresses.0.city"],"Loser 1 State":["losers.participant.individualParticipants.0.addresses.0.state","losers.participant.addresses.0.state"],"Loser 1 Country":["losers.participant.individualParticipants.0.addresses.0.nationalityCode","losers.participant.addresses.0nationalityCode"],"Loser 1 Third Party ID":["losers.participant.individualParticipants.0.participantId","losers.participant.participantId"],"Loser 1 Gender":["losers.participant.individualParticipants.0.person.sex","winners.participant.person.sex"],"Loser 1 DOB":["losers.participant.individualParticipants.0.person.birthDate","losers.participant.person.birthDate"],"Loser 2 Name":["losers.participant.individualParticipants.1.participantName"],"Loser 2 City":["losers.participant.individualParticipants.1.addresses.0.city"],"Loser 2 State":["losers.participant.individualParticipants.1.addresses.0.state"],"Loser 2 Country":["losers.participant.individualParticipants.1.addresses.0.nationalityCode"],"Loser 2 Third Party ID":["losers.participant.individualParticipants.1.participantId"],"Loser 2 Gender":["losers.participant.individualParticipants.1.person.sex"],"Loser 2 DOB":["losers.participant.individualParticipants.1.person.birthDate"],"Tournament Start Date":["tournamentStartDate"],"Tournament End Date":["tournamentEndDate"],"Tournament Import Source":["tournamentEventSource"],"Tournament Event Type":["tournamentEventType"],"Tournament Name":["tournamentName"],"Draw Name":[qv],"Draw Type":[ed],"Match ID":["matchUpId"],Score:["winnerScore"],"Id Type":["idType"]}};let a=Di.JSON2CSV(r,o);tAe(`UTR-${i.tournamentId}.csv`,a)}var u7,Ir="colors",Bs="sizes",Ot="space",nAe={gap:Ot,gridGap:Ot,columnGap:Ot,gridColumnGap:Ot,rowGap:Ot,gridRowGap:Ot,inset:Ot,insetBlock:Ot,insetBlockEnd:Ot,insetBlockStart:Ot,insetInline:Ot,insetInlineEnd:Ot,insetInlineStart:Ot,margin:Ot,marginTop:Ot,marginRight:Ot,marginBottom:Ot,marginLeft:Ot,marginBlock:Ot,marginBlockEnd:Ot,marginBlockStart:Ot,marginInline:Ot,marginInlineEnd:Ot,marginInlineStart:Ot,padding:Ot,paddingTop:Ot,paddingRight:Ot,paddingBottom:Ot,paddingLeft:Ot,paddingBlock:Ot,paddingBlockEnd:Ot,paddingBlockStart:Ot,paddingInline:Ot,paddingInlineEnd:Ot,paddingInlineStart:Ot,top:Ot,right:Ot,bottom:Ot,left:Ot,scrollMargin:Ot,scrollMarginTop:Ot,scrollMarginRight:Ot,scrollMarginBottom:Ot,scrollMarginLeft:Ot,scrollMarginX:Ot,scrollMarginY:Ot,scrollMarginBlock:Ot,scrollMarginBlockEnd:Ot,scrollMarginBlockStart:Ot,scrollMarginInline:Ot,scrollMarginInlineEnd:Ot,scrollMarginInlineStart:Ot,scrollPadding:Ot,scrollPaddingTop:Ot,scrollPaddingRight:Ot,scrollPaddingBottom:Ot,scrollPaddingLeft:Ot,scrollPaddingX:Ot,scrollPaddingY:Ot,scrollPaddingBlock:Ot,scrollPaddingBlockEnd:Ot,scrollPaddingBlockStart:Ot,scrollPaddingInline:Ot,scrollPaddingInlineEnd:Ot,scrollPaddingInlineStart:Ot,fontSize:"fontSizes",background:Ir,backgroundColor:Ir,backgroundImage:Ir,borderImage:Ir,border:Ir,borderBlock:Ir,borderBlockEnd:Ir,borderBlockStart:Ir,borderBottom:Ir,borderBottomColor:Ir,borderColor:Ir,borderInline:Ir,borderInlineEnd:Ir,borderInlineStart:Ir,borderLeft:Ir,borderLeftColor:Ir,borderRight:Ir,borderRightColor:Ir,borderTop:Ir,borderTopColor:Ir,caretColor:Ir,color:Ir,columnRuleColor:Ir,fill:Ir,outline:Ir,outlineColor:Ir,stroke:Ir,textDecorationColor:Ir,fontFamily:"fonts",fontWeight:"fontWeights",lineHeight:"lineHeights",letterSpacing:"letterSpacings",blockSize:Bs,minBlockSize:Bs,maxBlockSize:Bs,inlineSize:Bs,minInlineSize:Bs,maxInlineSize:Bs,width:Bs,minWidth:Bs,maxWidth:Bs,height:Bs,minHeight:Bs,maxHeight:Bs,flexBasis:Bs,gridTemplateColumns:Bs,gridTemplateRows:Bs,borderWidth:"borderWidths",borderTopWidth:"borderWidths",borderRightWidth:"borderWidths",borderBottomWidth:"borderWidths",borderLeftWidth:"borderWidths",borderStyle:"borderStyles",borderTopStyle:"borderStyles",borderRightStyle:"borderStyles",borderBottomStyle:"borderStyles",borderLeftStyle:"borderStyles",borderRadius:"radii",borderTopLeftRadius:"radii",borderTopRightRadius:"radii",borderBottomRightRadius:"radii",borderBottomLeftRadius:"radii",boxShadow:"shadows",textShadow:"shadows",transition:"transitions",zIndex:"zIndices"},rAe=(t,e)=>typeof e=="function"?{"()":Function.prototype.toString.call(e)}:e,AP=()=>{const t=Object.create(null);return(e,i,...n)=>{const r=(o=>JSON.stringify(o,rAe))(e);return r in t?t[r]:t[r]=i(e,...n)}},OE=Symbol.for("sxs.internal"),jz=(t,e)=>Object.defineProperties(t,Object.getOwnPropertyDescriptors(e)),d7=t=>{for(const e in t)return!0;return!1},{hasOwnProperty:oAe}=Object.prototype,_2=t=>t.includes("-")?t:t.replace(/[A-Z]/g,e=>"-"+e.toLowerCase()),aAe=/\s+(?![^()]*\))/,kb=t=>e=>t(...typeof e=="string"?String(e).split(aAe):[e]),p7={appearance:t=>({WebkitAppearance:t,appearance:t}),backfaceVisibility:t=>({WebkitBackfaceVisibility:t,backfaceVisibility:t}),backdropFilter:t=>({WebkitBackdropFilter:t,backdropFilter:t}),backgroundClip:t=>({WebkitBackgroundClip:t,backgroundClip:t}),boxDecorationBreak:t=>({WebkitBoxDecorationBreak:t,boxDecorationBreak:t}),clipPath:t=>({WebkitClipPath:t,clipPath:t}),content:t=>({content:t.includes('"')||t.includes("'")||/^([A-Za-z]+\([^]*|[^]*-quote|inherit|initial|none|normal|revert|unset)$/.test(t)?t:`"${t}"`}),hyphens:t=>({WebkitHyphens:t,hyphens:t}),maskImage:t=>({WebkitMaskImage:t,maskImage:t}),maskSize:t=>({WebkitMaskSize:t,maskSize:t}),tabSize:t=>({MozTabSize:t,tabSize:t}),textSizeAdjust:t=>({WebkitTextSizeAdjust:t,textSizeAdjust:t}),userSelect:t=>({WebkitUserSelect:t,userSelect:t}),marginBlock:kb((t,e)=>({marginBlockStart:t,marginBlockEnd:e||t})),marginInline:kb((t,e)=>({marginInlineStart:t,marginInlineEnd:e||t})),maxSize:kb((t,e)=>({maxBlockSize:t,maxInlineSize:e||t})),minSize:kb((t,e)=>({minBlockSize:t,minInlineSize:e||t})),paddingBlock:kb((t,e)=>({paddingBlockStart:t,paddingBlockEnd:e||t})),paddingInline:kb((t,e)=>({paddingInlineStart:t,paddingInlineEnd:e||t}))},HO=/([\d.]+)([^]*)/,sAe=(t,e)=>t.length?t.reduce((i,n)=>(i.push(...e.map(r=>r.includes("&")?r.replace(/&/g,/[ +>|~]/.test(n)&&/&.*&/.test(r)?`:is(${n})`:n):n+" "+r)),i),[]):e,lAe=(t,e)=>t in cAe&&typeof e=="string"?e.replace(/^((?:[^]*[^\w-])?)(fit-content|stretch)((?:[^\w-][^]*)?)$/,(i,n,r,o)=>n+(r==="stretch"?`-moz-available${o};${_2(t)}:${n}-webkit-fill-available`:`-moz-fit-content${o};${_2(t)}:${n}fit-content`)+o):String(e),cAe={blockSize:1,height:1,inlineSize:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,width:1},Qh=t=>t?t+"-":"",Fle=(t,e,i)=>t.replace(/([+-])?((?:\d+(?:\.\d*)?|\.\d+)(?:[Ee][+-]?\d+)?)?(\$|--)([$\w-]+)/g,(n,r,o,a,s)=>a=="$"==!!o?n:(r||a=="--"?"calc(":"")+"var(--"+(a==="$"?Qh(e)+(s.includes("$")?"":Qh(i))+s.replace(/\$/g,"-"):s)+")"+(r||a=="--"?"*"+(r||"")+(o||"1")+")":"")),uAe=/\s*,\s*(?![^()]*\))/,dAe=Object.prototype.toString,cI=(t,e,i,n,r)=>{let o,a,s;const l=(c,u,d)=>{let p,h;const f=m=>{for(p in m){const y=p.charCodeAt(0)===64,b=y&&Array.isArray(m[p])?m[p]:[m[p]];for(h of b){const I=/[A-Z]/.test(v=p)?v:v.replace(/-[^]/g,S=>S[1].toUpperCase()),T=typeof h=="object"&&h&&h.toString===dAe&&(!n.utils[I]||!u.length);if(I in n.utils&&!T){const S=n.utils[I];if(S!==a){a=S,f(S(h)),a=null;continue}}else if(I in p7){const S=p7[I];if(S!==s){s=S,f(S(h)),s=null;continue}}if(y&&(g=p.slice(1)in n.media?"@media "+n.media[p.slice(1)]:p,p=g.replace(/\(\s*([\w-]+)\s*(=|<|<=|>|>=)\s*([\w-]+)\s*(?:(<|<=|>|>=)\s*([\w-]+)\s*)?\)/g,(S,w,U,D,E,C)=>{const M=HO.test(w),N=.0625*(M?-1:1),[R,A]=M?[D,w]:[w,D];return"("+(U[0]==="="?"":U[0]===">"===M?"max-":"min-")+R+":"+(U[0]!=="="&&U.length===1?A.replace(HO,(_,k,O)=>Number(k)+N*(U===">"?1:-1)+O):A)+(E?") and ("+(E[0]===">"?"min-":"max-")+R+":"+(E.length===1?C.replace(HO,(_,k,O)=>Number(k)+N*(E===">"?-1:1)+O):C):"")+")"})),T){const S=y?d.concat(p):[...d],w=y?[...u]:sAe(u,p.split(uAe));o!==void 0&&r(h7(...o)),o=void 0,l(h,w,S)}else o===void 0&&(o=[[],u,d]),p=y||p.charCodeAt(0)!==36?p:`--${Qh(n.prefix)}${p.slice(1).replace(/\$/g,"-")}`,h=T?h:typeof h=="number"?h&&I in pAe?String(h)+"px":String(h):Fle(lAe(I,h??""),n.prefix,n.themeMap[I]),o[0].push(`${y?`${p} `:`${_2(p)}:`}${h}`)}}var g,v};f(c),o!==void 0&&r(h7(...o)),o=void 0};l(t,e,i)},h7=(t,e,i)=>`${i.map(n=>`${n}{`).join("")}${e.length?`${e.join(",")}{`:""}${t.join(";")}${e.length?"}":""}${Array(i.length?i.length+1:0).join("}")}`,pAe={animationDelay:1,animationDuration:1,backgroundSize:1,blockSize:1,border:1,borderBlock:1,borderBlockEnd:1,borderBlockEndWidth:1,borderBlockStart:1,borderBlockStartWidth:1,borderBlockWidth:1,borderBottom:1,borderBottomLeftRadius:1,borderBottomRightRadius:1,borderBottomWidth:1,borderEndEndRadius:1,borderEndStartRadius:1,borderInlineEnd:1,borderInlineEndWidth:1,borderInlineStart:1,borderInlineStartWidth:1,borderInlineWidth:1,borderLeft:1,borderLeftWidth:1,borderRadius:1,borderRight:1,borderRightWidth:1,borderSpacing:1,borderStartEndRadius:1,borderStartStartRadius:1,borderTop:1,borderTopLeftRadius:1,borderTopRightRadius:1,borderTopWidth:1,borderWidth:1,bottom:1,columnGap:1,columnRule:1,columnRuleWidth:1,columnWidth:1,containIntrinsicSize:1,flexBasis:1,fontSize:1,gap:1,gridAutoColumns:1,gridAutoRows:1,gridTemplateColumns:1,gridTemplateRows:1,height:1,inlineSize:1,inset:1,insetBlock:1,insetBlockEnd:1,insetBlockStart:1,insetInline:1,insetInlineEnd:1,insetInlineStart:1,left:1,letterSpacing:1,margin:1,marginBlock:1,marginBlockEnd:1,marginBlockStart:1,marginBottom:1,marginInline:1,marginInlineEnd:1,marginInlineStart:1,marginLeft:1,marginRight:1,marginTop:1,maxBlockSize:1,maxHeight:1,maxInlineSize:1,maxWidth:1,minBlockSize:1,minHeight:1,minInlineSize:1,minWidth:1,offsetDistance:1,offsetRotate:1,outline:1,outlineOffset:1,outlineWidth:1,overflowClipMargin:1,padding:1,paddingBlock:1,paddingBlockEnd:1,paddingBlockStart:1,paddingBottom:1,paddingInline:1,paddingInlineEnd:1,paddingInlineStart:1,paddingLeft:1,paddingRight:1,paddingTop:1,perspective:1,right:1,rowGap:1,scrollMargin:1,scrollMarginBlock:1,scrollMarginBlockEnd:1,scrollMarginBlockStart:1,scrollMarginBottom:1,scrollMarginInline:1,scrollMarginInlineEnd:1,scrollMarginInlineStart:1,scrollMarginLeft:1,scrollMarginRight:1,scrollMarginTop:1,scrollPadding:1,scrollPaddingBlock:1,scrollPaddingBlockEnd:1,scrollPaddingBlockStart:1,scrollPaddingBottom:1,scrollPaddingInline:1,scrollPaddingInlineEnd:1,scrollPaddingInlineStart:1,scrollPaddingLeft:1,scrollPaddingRight:1,scrollPaddingTop:1,shapeMargin:1,textDecoration:1,textDecorationThickness:1,textIndent:1,textUnderlineOffset:1,top:1,transitionDelay:1,transitionDuration:1,verticalAlign:1,width:1,wordSpacing:1},f7=t=>String.fromCharCode(t+(t>25?39:97)),Iv=t=>(e=>{let i,n="";for(i=Math.abs(e);i>52;i=i/52|0)n=f7(i%52)+n;return f7(i%52)+n})(((e,i)=>{let n=i.length;for(;n;)e=33*e^i.charCodeAt(--n);return e})(5381,JSON.stringify(t))>>>0),OS=["themed","global","styled","onevar","resonevar","allvar","inline"],hAe=t=>{if(t.href&&!t.href.startsWith(location.origin))return!1;try{return!!t.cssRules}catch{return!1}},fAe=t=>{let e;const i=()=>{const{cssRules:r}=e.sheet;return[].map.call(r,(o,a)=>{const{cssText:s}=o;let l="";if(s.startsWith("--sxs"))return"";if(r[a-1]&&(l=r[a-1].cssText).startsWith("--sxs")){if(!o.cssRules.length)return"";for(const c in e.rules)if(e.rules[c].group===o)return`--sxs{--sxs:${[...e.rules[c].cache].join(" ")}}${s}`;return o.cssRules.length?`${l}${s}`:""}return s}).join("")},n=()=>{if(e){const{rules:s,sheet:l}=e;if(!l.deleteRule){for(;Object(Object(l.cssRules)[0]).type===3;)l.cssRules.splice(0,1);l.cssRules=[]}for(const c in s)delete s[c]}const r=Object(t).styleSheets||[];for(const s of r)if(hAe(s)){for(let l=0,c=s.cssRules;c[l];++l){const u=Object(c[l]);if(u.type!==1)continue;const d=Object(c[l+1]);if(d.type!==4)continue;++l;const{cssText:p}=u;if(!p.startsWith("--sxs"))continue;const h=p.slice(14,-3).trim().split(/\s+/),f=OS[h[0]];f&&(e||(e={sheet:s,reset:n,rules:{},toString:i}),e.rules[f]={group:d,index:l,cache:new Set(h)})}if(e)break}if(!e){const s=(l,c)=>({type:c,cssRules:[],insertRule(u,d){this.cssRules.splice(d,0,s(u,{import:3,undefined:1}[(u.toLowerCase().match(/^@([a-z]+)/)||[])[1]]||4))},get cssText(){return l==="@media{}"?`@media{${[].map.call(this.cssRules,u=>u.cssText).join("")}}`:l}});e={sheet:t?(t.head||t).appendChild(document.createElement("style")).sheet:s("","text/css"),rules:{},reset:n,toString:i}}const{sheet:o,rules:a}=e;for(let s=OS.length-1;s>=0;--s){const l=OS[s];if(!a[l]){const c=OS[s+1],u=a[c]?a[c].index:o.cssRules.length;o.insertRule("@media{}",u),o.insertRule(`--sxs{--sxs:${s}}`,u),a[l]={group:o.cssRules[u+1],index:u,cache:new Set([s])}}mAe(a[l])}};return n(),e},mAe=t=>{const e=t.group;let i=e.cssRules.length;t.apply=n=>{try{e.insertRule(n,i),++i}catch{}}},hS=Symbol(),gAe=AP(),vAe=(t,e)=>gAe(t,()=>(...i)=>{let n={type:null,composers:new Set};for(const r of i)if(r!=null)if(r[OE]){n.type==null&&(n.type=r[OE].type);for(const o of r[OE].composers)n.composers.add(o)}else r.constructor!==Object||r.$$typeof?n.type==null&&(n.type=r):n.composers.add(yAe(r,t));return n.type==null&&(n.type="span"),n.composers.size||n.composers.add(["PJLV",{},[],[],{},[]]),bAe(t,n,e)}),yAe=({variants:t,compoundVariants:e,defaultVariants:i,...n},r)=>{const o=`${Qh(r.prefix)}c-${Iv(n)}`,a=[],s=[],l=Object.create(null),c=[];for(const p in i)l[p]=String(i[p]);if(typeof t=="object"&&t)for(const p in t){u=l,d=p,oAe.call(u,d)||(l[p]="undefined");const h=t[p];for(const f in h){const m={[p]:String(f)};String(f)==="undefined"&&c.push(p);const g=h[f],v=[m,g,!d7(g)];a.push(v)}}var u,d;if(typeof e=="object"&&e)for(const p of e){let{css:h,...f}=p;h=typeof h=="object"&&h||{};for(const g in f)f[g]=String(f[g]);const m=[f,h,!d7(h)];s.push(m)}return[o,n,a,s,l,c]},bAe=(t,e,i)=>{const[n,r,o,a]=IAe(e.composers),s=typeof e.type=="function"||e.type.$$typeof?(d=>{function p(){for(let h=0;h<p[hS].length;h++){const[f,m]=p[hS][h];d.rules[f].apply(m)}return p[hS]=[],null}return p[hS]=[],p.rules={},OS.forEach(h=>p.rules[h]={apply:f=>p[hS].push([h,f])}),p})(i):null,l=(s||i).rules,c=`.${n}${r.length>1?`:where(.${r.slice(1).join(".")})`:""}`,u=d=>{d=typeof d=="object"&&d||wAe;const{css:p,...h}=d,f={};for(const v in o)if(delete h[v],v in d){let y=d[v];typeof y=="object"&&y?f[v]={"@initial":o[v],...y}:(y=String(y),f[v]=y!=="undefined"||a.has(v)?y:o[v])}else f[v]=o[v];const m=new Set([...r]);for(const[v,y,b,I]of e.composers){i.rules.styled.cache.has(v)||(i.rules.styled.cache.add(v),cI(y,[`.${v}`],[],t,w=>{l.styled.apply(w)}));const T=m7(b,f,t.media),S=m7(I,f,t.media,!0);for(const w of T)if(w!==void 0)for(const[U,D,E]of w){const C=`${v}-${Iv(D)}-${U}`;m.add(C);const M=(E?i.rules.resonevar:i.rules.onevar).cache,N=E?l.resonevar:l.onevar;M.has(C)||(M.add(C),cI(D,[`.${C}`],[],t,R=>{N.apply(R)}))}for(const w of S)if(w!==void 0)for(const[U,D]of w){const E=`${v}-${Iv(D)}-${U}`;m.add(E),i.rules.allvar.cache.has(E)||(i.rules.allvar.cache.add(E),cI(D,[`.${E}`],[],t,C=>{l.allvar.apply(C)}))}}if(typeof p=="object"&&p){const v=`${n}-i${Iv(p)}-css`;m.add(v),i.rules.inline.cache.has(v)||(i.rules.inline.cache.add(v),cI(p,[`.${v}`],[],t,y=>{l.inline.apply(y)}))}for(const v of String(d.className||"").trim().split(/\s+/))v&&m.add(v);const g=h.className=[...m].join(" ");return{type:e.type,className:g,selector:c,props:h,toString:()=>g,deferredInjector:s}};return jz(u,{className:n,selector:c,[OE]:e,toString:()=>(i.rules.styled.cache.has(n)||u(),n)})},IAe=t=>{let e="";const i=[],n={},r=[];for(const[o,,,,a,s]of t){e===""&&(e=o),i.push(o),r.push(...s);for(const l in a){const c=a[l];(n[l]===void 0||c!=="undefined"||s.includes(c))&&(n[l]=c)}}return[e,i,n,new Set(r)]},m7=(t,e,i,n)=>{const r=[];e:for(let[o,a,s]of t){if(s)continue;let l,c=0,u=!1;for(l in o){const d=o[l];let p=e[l];if(p!==d){if(typeof p!="object"||!p)continue e;{let h,f,m=0;for(const g in p){if(d===String(p[g])){if(g!=="@initial"){const v=g.slice(1);(f=f||[]).push(v in i?i[v]:g.replace(/^@media ?/,"")),u=!0}c+=m,h=!0}++m}if(f&&f.length&&(a={["@media "+f.join(", ")]:a}),!h)continue e}}}(r[c]=r[c]||[]).push([n?"cv":`${l}-${o[l]}`,a,u])}return r},wAe={},SAe=AP(),TAe=(t,e)=>SAe(t,()=>(...i)=>{const n=()=>{for(let r of i){r=typeof r=="object"&&r||{};let o=Iv(r);if(!e.rules.global.cache.has(o)){if(e.rules.global.cache.add(o),"@import"in r){let a=[].indexOf.call(e.sheet.cssRules,e.rules.themed.group)-1;for(let s of[].concat(r["@import"]))s=s.includes('"')||s.includes("'")?s:`"${s}"`,e.sheet.insertRule(`@import ${s};`,a++);delete r["@import"]}cI(r,[],[],t,a=>{e.rules.global.apply(a)})}}return""};return jz(n,{toString:n})}),UAe=AP(),DAe=(t,e)=>UAe(t,()=>i=>{const n=`${Qh(t.prefix)}k-${Iv(i)}`,r=()=>{if(!e.rules.global.cache.has(n)){e.rules.global.cache.add(n);const o=[];cI(i,[],[],t,s=>o.push(s));const a=`@keyframes ${n}{${o.join("")}}`;e.rules.global.apply(a)}return n};return jz(r,{get name(){return r()},toString:r})}),PAe=class{constructor(t,e,i,n){this.token=t==null?"":String(t),this.value=e==null?"":String(e),this.scale=i==null?"":String(i),this.prefix=n==null?"":String(n)}get computedValue(){return"var("+this.variable+")"}get variable(){return"--"+Qh(this.prefix)+Qh(this.scale)+this.token}toString(){return this.computedValue}},CAe=AP(),EAe=(t,e)=>CAe(t,()=>(i,n)=>{n=typeof i=="object"&&i||Object(n);const r=`.${i=(i=typeof i=="string"?i:"")||`${Qh(t.prefix)}t-${Iv(n)}`}`,o={},a=[];for(const l in n){o[l]={};for(const c in n[l]){const u=`--${Qh(t.prefix)}${l}-${c}`,d=Fle(String(n[l][c]),t.prefix,l);o[l][c]=new PAe(c,d,l,t.prefix),a.push(`${u}:${d}`)}}const s=()=>{if(a.length&&!e.rules.themed.cache.has(i)){e.rules.themed.cache.add(i);const l=`${n===t.theme?":root,":""}.${i}{${a.join(";")}}`;e.rules.themed.apply(l)}return i};return{...o,get className(){return s()},selector:r,toString:s}}),MAe=AP(),Ble=t=>{let e=!1;const i=MAe(t,n=>{e=!0;const r="prefix"in(n=typeof n=="object"&&n||{})?String(n.prefix):"",o=typeof n.media=="object"&&n.media||{},a=typeof n.root=="object"?n.root||null:globalThis.document||null,s=typeof n.theme=="object"&&n.theme||{},l={prefix:r,media:o,theme:s,themeMap:typeof n.themeMap=="object"&&n.themeMap||{...nAe},utils:typeof n.utils=="object"&&n.utils||{}},c=fAe(a),u={css:vAe(l,c),globalCss:TAe(l,c),keyframes:DAe(l,c),createTheme:EAe(l,c),reset(){c.reset(),u.theme.toString()},theme:{},sheet:c,config:l,prefix:r,getCssText:c.toString,toString:c.toString};return String(u.theme=u.createTheme(s)),u});return e||i.reset(),i},RAe=()=>u7||(u7=Ble()),ki=(...t)=>RAe().css(...t);function NAe({variant:t}){return ki({margin:"2.5px 0",variants:{variant:{showAddress:{lineHeight:"2.3em"}}}})({variant:t})}const AAe=ki({justifyContent:"flex-start",alignItems:"center",whiteSpace:"nowrap",fontWeight:500,display:"flex"}),_Ae=ki({textTransform:"$participant$textTransform",fontSize:"0.875rem",fontWeight:500,variants:{variant:{winner:{fontWeight:700,color:"$winnerName"},loser:{fontWeight:500}}}}),kAe=ki({"&::WebkitScrollbar":{display:"none"},justifyContent:"space-between",flexDirection:"column",marginInlineEnd:"0rem",scrollbarWidth:"none",overflowX:"scroll",fontWeight:500,display:"flex",width:"100%",variants:{variant:{doubles:{marginTop:"0.25rem",fontSize:"0.75rem",lineHeight:"1rem"}}}});function xAe({drawPosition:t,sideNumber:e}){return ki({minHeight:"$participant$minHeight",justifyContent:"space-between",paddingInlineStart:"0.75rem",backgroundColor:"$matchUp",paddingInlineEnd:"0rem",boxSizing:"border-box",paddingBottom:".2rem",position:"relative",alignItems:"center",paddingTop:".2rem",minWidth:"15rem",cursor:"pointer",display:"flex",flexGrow:1,"& p":{fontFamily:"Sharp Sans, Arial, sans-serif",color:"$color"},variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}}}})({sideNumber:e,css:t&&{"&:before":{backgroundColor:"$backgroundColor",content:`${t}`,justifyContent:"center",alignContent:"center",insetInlineStart:-10,position:"absolute",color:"#55AFFE",display:"flex",width:20}}})}function OAe({winnerChevron:t,isDoubles:e}){const i=(e?.4:.3)*2;return ki({variants:{variant:{winner:{"&::before":{borderTop:`${i}rem solid transparent`,borderBottom:`${i}rem solid transparent`,borderInlineStart:"8px solid #008f70",position:"absolute",insetInlineStart:0,display:"block",content:""}}}}})({variant:t?"winner":void 0})}const $le=ki({fontSize:"smaller",color:"gray"});var LAe=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Vle(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jle={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function i(){for(var o="",a=0;a<arguments.length;a++){var s=arguments[a];s&&(o=r(o,n(s)))}return o}function n(o){if(typeof o=="string"||typeof o=="number")return o;if(typeof o!="object")return"";if(Array.isArray(o))return i.apply(null,o);if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]"))return o.toString();var a="";for(var s in o)e.call(o,s)&&o[s]&&(a=r(a,s));return a}function r(o,a){return a?o?o+" "+a:o+a:o}t.exports?(i.default=i,t.exports=i):window.classNames=i})()})(jle);var FAe=jle.exports;const zy=Vle(FAe);function BAe({individualParticipant:t,className:e}){var i,n;const{city:r,state:o,countryCode:a}=((n=(i=t==null?void 0:t.person)==null?void 0:i.addresses)==null?void 0:n[0])||{},s=[r,o,a].filter(Boolean).join(", ")||" ",l=document.createElement("div");return l.className=zy($le(),e),l.innerHTML=s,l}function $Ae({individualParticipant:t,className:e}){var i;const n=(i=t==null?void 0:t.teams)==null?void 0:i[0],r=(n==null?void 0:n.participantName)||" ",o=document.createElement("div");return o.className=zy($le(),e),o.classList.add("tmx-tm"),o.setAttribute("id",n==null?void 0:n.participantId),o.innerHTML=r,o}function VAe(t){var e,i,n,r;const o=(i=(e=t==null?void 0:t.composition)==null?void 0:e.configuration)==null?void 0:i.participantDetail;return((r=(n=t==null?void 0:t.composition)==null?void 0:n.configuration)==null?void 0:r.showAddress)??o==="ADDRESS"?BAe(t):o==="TEAM"?$Ae(t):document.createElement("div")}const jAe=ki({color:"$participant$seed",marginInlineStart:".5rem",textTransform:"uppercase",fontSize:"0.75rem",lineHeight:"1rem"});function HAe({className:t,composition:e,side:i}){const n=(i==null?void 0:i.seedValue)||(i==null?void 0:i.seedNumber);if(!n)return"";const r=(e==null?void 0:e.configuration)||{},{bracketedSeeds:o}=r,a=typeof o=="boolean"&&["(",")"]||o==="square"&&["[","]"]||["",""],s=`${a[0]}${n}${a[1]}`,l=r.seedingElement==="sup"?"sup":"span",c=document.createElement(l);return c.className=t,c.innerHTML=s,c}const GAe=ki({WebkitBoxSizing:"border-box",marginInlineEnd:".5em",boxSizing:"border-box",display:"inline-block",position:"relative",fontSize:"smaller",fontWeight:"bold",borderRadius:2,color:"blue",variants:{color:{green:{color:"green"},red:{color:"red"}}}});function zAe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r}){var o,a,s,l,c,u,d;const p=e==null?void 0:e.configuration,h=((o=p==null?void 0:p.scaleAttributes)==null?void 0:o.eventType)||(n==null?void 0:n.matchUpType)||"SINGLES",f=t==null?void 0:t.rankings,m=t==null?void 0:t.ratings,g=p==null?void 0:p.scaleAttributes,v=g==null?void 0:g.scaleType,y=g==null?void 0:g.scaleName,b=g==null?void 0:g.accessor,I=v==="RATING"?m:f,T=(s=(a=I==null?void 0:I.SINGLES)==null?void 0:a.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:s.scaleValue,S=(c=(l=I==null?void 0:I.DOUBLES)==null?void 0:l.find(N=>(N==null?void 0:N.scaleName)===y))==null?void 0:c.scaleValue,w=T&&b?T[b]:T||"",U=S&&b?S[b]:S||"",D=h==="SINGLES"?w:U,E=(u=p==null?void 0:p.scaleAttributes)==null?void 0:u.fallback,C=!r&&(D||E&&(w||U)),M=document.createElement("span");return C&&(M.className=zy(i,GAe({color:(d=p==null?void 0:p.scaleAttributes)==null?void 0:d.scaleColor}))),M.innerHTML=C||"",M}function Sr(t,e){return(t??0)-(e??0)}function Ct(t){return typeof t=="number"?parseInt(t.toString()):typeof t=="string"?parseInt(t):0}function Lc(t){return!isNaN(t)&&t&&(t&t-1)==0}function g7(t){if(!t.length)return;const e=[...t].sort(Sr),i=Math.floor(e.length/2);return e.length%2?e[i]:(e[i-1]+e[i])/2}function Hz(t){return isNaN(t)?0:t%2&&t+1||t}function Gz(t){return Math.pow(2,Math.round(Math.log(t)/Math.log(2)))}function ir(t){return!isNaN(parseFloat(t))}function Hle(t){const e=Ct(t);if(!isNaN(e))return e!==0&&(e&-e)==1}function R0(t){if(isNaN(t))return!1;for(;!Lc(t);)t++;return t}function js(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t+1))+t}function $t(t){return Number.isSafeInteger(typeof t=="string"?+t:t)}function Gle(t,e,i,n,r=2){const o=1-Math.random(),a=1-Math.random();let s=Math.sqrt(-2*Math.log(o))*Math.cos(2*Math.PI*a);return s=s/10+.5,s>1||s<0?s=Gle(t,e,i):(s=Math.pow(s,i),s*=e-t,s+=t),n&&(s=function(l,c){c||(c=1);const u=1/c;return Math.round(l*u)/u}(s,n)),parseFloat(s.toFixed(r))}function ti(t){return Array.isArray(t)?t==null?void 0:t.filter((e,i,n)=>n.lastIndexOf(e)===i):[]}function Qo(t){return Array.isArray(t)?t.map(e=>[Math.random(),e]).sort((e,i)=>e[0]-i[0]).map(e=>e[1]):[]}function aw(t){return $t(t)?t:1/0}function cs(t){return Array.isArray(t)?t.reduce((e,i)=>(e[i]||(e[i]=0),e[i]++,e),{}):{}}function v7(t){return Object.keys(t).reduce((e,i)=>{const n=t[i];return e[n]?e[n].push(i):e[n]=[i],e},{})}function WAe(t,e,i){return i.indexOf(t)===e}function zle(t){return t.filter(WAe)}function es(t){return Array.isArray(t)&&t.length?t.splice(Math.floor(Math.random()*t.length),1)[0]:void 0}function Al(t){return t[Math.floor(Math.random()*t.length)]}function nt(t,e){return Array.from({length:e-t},(i,n)=>n+t)}function au(t,e){return e.reduce((i,n,r)=>(n===t&&i.push(r),i),[])}function sr(t,e){return Array.isArray(t)&&Array.isArray(e)?t.filter(i=>e.indexOf(i)!==-1).filter((i,n,r)=>r.indexOf(i)===n):[]}function y7(t,e){return Array.isArray(t)&&Array.isArray(e)?t.filter(i=>!e.includes(i)):[]}function ua(t,e){return!(!Array.isArray(t)||!Array.isArray(e))&&t.some(i=>e.includes(i))}function Kr(t,e){return Array.isArray(t)?t.reduce((i,n,r)=>{const o=Math.floor(r/e);return i[o]=[].concat(i[o]||[],n),i},[]):[]}function Wle(t){return!!Array.isArray(t)&&t.reduce((e,i)=>!isNaN(parseInt(i))&&e,!0)}function qle(t){return!!Array.isArray(t)&&t.reduce((e,i)=>isNaN(parseInt(i))&&e,!0)}function k2(t,e,i){return Array.isArray(t)?t.reduce((n,r,o)=>{const a=!!i&&!!(Math.floor(o/e)%2),s=o%e,l=a?e-1-s:s;return n[l]||(n[l]=[]),n[l].push(r),n},[]):[]}const le={success:!0},b7={message:"Chronological error; time violation.",code:"ANACHRONISM"},qAe={message:"Cannot remove main structure",code:"ERR_CANNOT_REMOVE_MAIN_STRUCTURE"},I7={message:"records must be an object with tournamentId keys",code:"ERR_INVALID_TOURNAMENTS"},Wn={message:"Missing tournamentRecords",code:"ERR_MISSING_TOURNAMENTS"},je={message:"Missing tournamentRecord",code:"ERR_MISSING_TOURNAMENT"},W_={message:"Invalid tournamentRecord",code:"ERR_INVALID_TOURNAMENT"},sU={message:"Missing tournamentId",code:"ERR_MISSING_TOURNAMENT_ID"},yI={message:"Invalid drawDefinition",code:"ERR_INVALID_DRAWDEF"},rt={message:"Missing drawDefinition",code:"ERR_MISSING_DRAWDEF"},YAe={message:"Existing drawDefinition(s)",code:"ERR_EXISTING_DRAWDEFS"},ml={message:"drawDefinition not found",code:"ERR_NOT_FOUND_DRAWDEF"},_P={message:"Invalid structure",code:"ERR_INVALID_STRUCTURE"},Yle={message:"Incomplete source structure",code:"ERR_INCOMPLETE_STRUCTURE"},Kle={message:"Invalid drawPosition for seedAssignment",code:"ERR_INVALID_SEEDING_POSITION"},lU={message:"drawPosition already assigned",code:"ERR_EXISTING_POSITION_ASSIGNMENT"},KAe={message:"Schedule not cleared",code:"ERR_UNCHANGED_SCHEDULE_NOT_CLEARED"},ZAe={message:"drawPosition not cleared",code:"ERR_FAILURE_POSITION_NOT_CLEARED"},Zle={message:"Unrecognized drawType",code:"ERR_UNRECOGNIZED_DRAW_TYPE"},q_={message:"Missing drawPositions",code:"ERR_MISSING_DRAW_POSITIONS"},zz={message:"drawPosition is active",code:"ERR_ACTIVE_DRAW_POSITION"},kP={message:"Invlid drawPosition",code:"ERR_INVALID_DRAW_POSITION"},xP={message:"Missing drawPosition",code:"ERR_MISSING_DRAW_POSITION"},Wz={message:"Invalid drawType",code:"ERR_INVALID_DRAW_TYPE"},qz={message:"Invalid drawSize",code:"ERR_INVALID_DRAW_SIZE"},Xle={message:"Cannot set drawSize to be less than existing entries",code:"ERR_INVALID_DRAW_SIZE_MISMATCH"},Y_={message:"Missing drawSize",code:"ERR_MISSING_DRAW_SIZE"},Yc={message:"Missing drawId",code:"ERR_MISSING_DRAW_ID"},XAe={message:"drawId exists",code:"ERR_EXISTING_DRAW_ID"},JAe={message:"participantId cannot be assigned to multiple seedNumbers",code:"INVALID_PARTICIPANT_SEEDING"},QAe={message:"seedsCount greater than drawSize",code:"ERR_INVALID_SEED_COUNT"},e_e={message:"Missing seedCountThresholds",code:"ERR_MISSING_SEED_COUNT_THRESHOLD"},t_e={message:"Invalid action",code:"ERR_INVALID_ACTION"},w7={message:"Invalid assignment",code:"ERR_INVALID_ASSIGNMENT"},i_e={message:"Missing seedAssignments",code:"ERR_MISSING_SEED_ASSIGNMENTS"},n_e={message:"Invalid seedNumber",code:"ERR_INVALID_SEED_NUMBER"},r_e={message:"Invalid seedPosition",code:"ERR_INVALID_SEED_POSITION"},Jle={message:"Missing targetLink",code:"ERR_MISSING_LINK_TARGET"},o_e={message:"Existing round",code:"ERR_EXISTING_ROUND"},Va={message:"Missing structureId",code:"ERR_MISSING_STRUCTURE_ID"},Cn={message:"structure not found",code:"ERR_NOT_FOUND_STRUCTURE"},Qle={message:"Missing structures",code:"ERR_MISSING_STRUCTURES"},bg={message:"Missing structure",code:"ERR_MISSING_STRUCTURE"},a_e={message:"drawDefinition contains unlinked structures",code:"ERR_MISSING_STRUCTURE_LINKS"},Lm={message:"Invalid eventType",code:"ERR_INVALID_EVENT_TYPE"},Fi={message:"Missing event / eventId",code:"ERR_MISSING_EVENT_ID"},sl={message:"Event not found",code:"ERR_NOT_FOUND_EVENT"},s_e={message:"Event exists",code:"ERR_EXISTING_EVENT"},l_e={message:"Missing entries",code:"ERR_MISSING_ENTRIES"},c_e={message:"Invalid entries",code:"ERR_INVALID_ENTRIES"},ece={message:"Missing assignments",code:"ERR_MISSING_ASSIGNMENTS"},tce={message:"Missing stage",code:"ERR_MISSING_STAGE"},Wy={message:"Invalid stage",code:"ERR_INVALID_STAGE"},u_e={message:"stageSequence limit",code:"ERR_LIMIT_STAGE_SEQUENCE"},d_e={message:"Missing positionAssignments",code:"ERR_MISSING_POSITION_ASSIGNMENTS"},p_e={message:"Cannot Assign BYE status if no assignment: { bye: true }",code:"ERR_UNCHANGED_CANNOT_ASSIGN_BYE"},S7={message:"Unrecognized matchUpStatus",code:"ERR_UNRECOGNIZED_MATCHUP_STATUS"},K_={message:"Unrecognized matchUpFormat",code:"ERR_UNRECOGNIZED_MATCHUP_FORMAT"},GO={message:"Incompatible matchUpStatus",code:"ERR_INCOMPATIBLE_MATCHUP_STATUS"},cU={message:"Invalid matchUpStatus",code:"ERR_INVALID_MATCHUP_STATUS"},Ph={message:"Invalid tieFormat",code:"ERR_INVALID_TIE_FORMAT"},ice={message:"Invalid matchUpFormat",code:"ERR_INVALID_MATCHUP_FORMAT"},Yz={message:"Missing matchUpFormat",code:"ERR_MISSING_MATCHUP_FORMAT"},h_e={message:"Missing collectionDefinition",code:"ERR_MISSING_COLLECTION_DEFINITION"},Z_={message:"Missing tieFormat",code:"ERR_MISSING_TIE_FORMAT"},co={message:"Missing matchUpId",code:"ERR_MISSING_MATCHUP_ID"},OP={message:"Missing matchUpIds",code:"ERR_MISSING_MATCHUP_IDS"},xo={message:"matchUp not found",code:"ERR_NOT_FOUND_MATCHUP"},Nf={message:"Missing matchUps",code:"ERR_MISSING_MATCHUPS"},Cs={message:"Missing matchUp",code:"ERR_MISSING_MATCHUP"},ja={message:"Invalid matchUp",code:"ERR_INVALID_MATCHUP"},nce={message:"Missing policyType",code:"ERR_MISSING_POLICY_TYPE"},Kz={message:"Missing policyDefinitions",code:"ERR_MISSING_POLICY_DEFINITIONS"},f_e={message:"Missing avoidance policy",code:"ERR_MISSING_POLICY_AVOIDANCE"},rce={message:"Missing policy attributes",code:"ERR_MISSING_POLICY_ATTRIBUTES"},m_e={message:"Invalid policyDefinitions",code:"ERR_INVALID_POLICY_DEFINITIONS"},oce={message:"existing policyType",code:"ERR_EXISTING_POLICY_TYPE"},uU={message:"Policy not found",code:"ERR_NOT_FOUND_POLICY"},ace={message:"Invalid sideNumber",code:"ERR_INVALID_SIDE_NUMBER"},zO={message:"Missing setObject",code:"ERR_MISSING_SET_ATTRIBUTE"},N0={message:"Missing courtId",code:"ERR_MISSING_COURT_ID"},bt={message:"Missing value",code:"ERR_MISSING_VALUE"},sce={message:"Missing date",code:"ERR_MISSING_DATE"},g_e={message:"No valid dates",code:"ERR_NO_VALID_DATES"},x2={message:"Invalid bookings",code:"ERR_INVALID_BOOKINGS"},WO={message:"Invalid dateAvailability",code:"ERR_INVALID_DATE_AVAILABILITY"},v_e={message:"Missing dateAvailability",code:"ERR_MISSING_DATE_AVAILABILITY"},Ha={message:"Invalid Date",code:"ERR_INVALID_DATE"},hc={message:"Invalid time",code:"ERR_INVALID_TIME"},y_e={message:"Invalid tournament dates",code:"ERR_INVALID_DATES_TOURNAMENT"},T7={message:"Invalid game scores",code:"ERR_INVALID_SCORES_GAME"},b_e={message:"Invalid score",code:"ERR_INVALID_SCORE"},U7={message:"Invalid winningSide",code:"ERR_INVALID_WINNING_SIDE"},I_e={message:"No participants generated",code:"ERR_NO_PARTICIPANTS_GENERATED"},lce={message:"Cannot modify tieFormat",code:"ERR_UNCHANGED_CANNOT_MODIFY_TIEFORMAT"},w_e={message:"Cannot modify participantType",code:"ERR_UNCHANGED_CANNOT_MODIFY_PARTICIPANT_TYPE"},Zz={message:"Cannot remove participants",code:"ERR_UNCHANGED_CANNOT_REMOVE_PARTICIPANTS"},cce={message:"Cannot change winningSide",code:"ERR_UNCHANGED_CANNOT_CHANGE_WINNING_SIDE"},LP={message:"Invalid participant",code:"ERR_INVALID_PARTICIPANT"},Dd={message:"Invalid participantId",code:"ERR_INVALID_PARTICIPANT_ID"},Ec={message:"Invalid participantIds",code:"ERR_INVALID_PARTICIPANT_IDS"},S_e={message:"Invalid participantRole",code:"ERR_INVALID_PARTICIPANT_ROLE"},Cu={message:"Invalid participantType",code:"ERR_INVALID_PARTICIPANT_TYPE"},T_e={message:"Missing participantRole",code:"ERR_MISSING_PARTICIPANT_ROLE"},A0={message:"Missing participant",code:"ERR_MISSING_PARTICIPANT"},X_={message:"Missing participants",code:"ERR_MISSING_PARTICIPANTS"},Hr={message:"Missing participantId",code:"ERR_MISSING_PARTICIPANT_ID"},rr={message:"Participant Not Found",code:"ERR_NOT_FOUND_PARTICIPANT"},U_e={message:"participantId exists",code:"ERR_EXISTING_PARTICIPANT_ID"},D_e={message:"No participant removed",code:"ERR_UNCHANGED_NO_PARTICIPANT_REMOVED"},Ig={message:"Missing participantIds",code:"ERR_MISSING_PARTICIPANT_IDS"},P_e={message:"Missing participantsCount",code:"ERR_MISSING_PARTICIPANT_COUNT"},C_e={message:"Participant not checked in",code:"ERR_UNCHANGED_PARTICIPANT_NOT_CHECKED_IN"},E_e={message:"Missing person details",code:"ERR_MISSING_PERSON_DETAILS"},FP={message:"Existing participant drawPosition assignment",code:"ERR_EXISTING_PARTICIPANT_DRAW_POSITION_ASSIGNMENT"},Xz={message:"Existing participant",code:"ERR_EXISTING_PARTICIPANT"},uce={message:"participantsCount exceeds drawSize",code:"ERR_INVALID_PARTICIPANT_COUNT"},O2={message:"Invalid entry status",code:"ERR_INVALID_ENTRY_STATUS"},dce={message:"Participant Entry Not Found",code:"ERR_NOT_FOUND_PARTICIPANT_ENTRY"},M_e={message:"Participant not entered in stage",code:"ERR_UNCHANGED_PARTICIPANT_NOT_ENTERED"},R_e={message:"Participant not found in stageSequence",code:"ERR_NOT_FOUND_PARTICIPANT_IN_STAGE"},N_e={message:"entryStatus not allowed in stage",code:"ERR_INVALID_ENTRY_STATUS_IN_STAGE"},A_e={message:"entryStatus not allowed for event",code:"ERR_INVALID_ENTRY_STATUS_IN_EVENT"},D7={message:"No stage space available for entryStatus",code:"ERR_UNCHANGED_NO_AVAILABLE_STAGE_SPACE"},__e={message:"Insufficient drawPositions to accommodate qualifiers",code:"ERR_UNCHANGED_NO_DRAW_POSITIONS_FOR_QUALIFIERS"},pce={message:"Insufficient drawPositions to accommodate entries",code:"ERR_INSUFFICIENT_DRAW_POSITIONS"},k_e={message:"Missing penaltyType",code:"ERR_MISSING_PENALTY_TYPE"},hce={message:"Missing penaltyId",code:"ERR_MISSING_PENALTY_ID"},dU={message:"Penalty not found",code:"ERR_NOT_FOUND_PENALTY"},x_e={message:"Missing courtsCount/courtNames",code:"ERR_MISSING_COURTS_INFO"},J_={message:"Court not found",code:"ERR_NOT_FOUND_COURT"},O_e={message:"Court exists",code:"ERR_EXISTING_COURT"},L_e={message:"Venue exists",code:"ERR_EXISTING_VENUE"},_0={message:"Venue not found",code:"ERR_NOT_FOUND_VENUE"},Fm={message:"Missing venueId",code:"ERR_MISSING_VENUE_ID"},F_e={message:"Invalid endTime",code:"ERR_INVALID_END_TIME"},fce={message:"Existing endTime",code:"ERR_EXISTING_END_TIME"},B_e={message:"Invalid stopTime",code:"ERR_INVALID_STOP_TIME"},$_e={message:"Invalid startTime",code:"ERR_INVALID_START_TIME"},V_e={message:"Invalid resumeTime",code:"ERR_INVALID_RESUME_TIME"},mce={message:"Invalid timeItem",code:"ERR_INVALID_TIME_ITEMS"},gce={message:"Missing timeItem",code:"ERR_MISSING_TIME_ITEM"},vce={message:"Missing timeItems",code:"ERR_MISSING_TIME_ITEMS"},Q_={message:"Missing context",code:"ERR_MISSING_CONTEXT"},j_e={message:"Missing schedule",code:"ERR_MISSING_SCHEDULE"},ek={message:"Invalid scaleItem",code:"ERR_INVALID_SCALE_ITEM"},H_e={message:"Modifications failed",code:"ERR_FAILURE_MODIFICATIONS"},BP={message:"No modifications applied",code:"ERR_UNCHANGED_NO_MODIFICATIONS_APPLIED"},G_e={message:"Unable to assign court",code:"ERR_UNCHANGED_COURT_NOT_ASSIGNED"},Jz={message:"No Candidates",code:"ERR_UNCHANGED_NO_CANDIDATES"},z_e={message:"Invalid configuration",code:"ERR_INVALID_CONFIG"},W_e={message:"Invalid collectionDefinition",code:"ERR_INVALID_COLLECTION_DEFINITION"},Af={message:"Invalid object",code:"ERR_INVALID_OBJECT"},qO={message:"Invalid gender",code:"ERR_INVALID_GENDER"},L2={message:"Invalid category",code:"ERR_INVALID_CATEGORY"},Re={message:"Invalid values",code:"ERR_INVALID_VALUES"},q_e={message:"Duplicate value",code:"ERR_DUPLICATE_VALUE"},yce={message:"Team not found",code:"ERR_NOT_FOUND_TEAM"},Y_e={message:"No valid actions",code:"ERR_NO_VALID_ACTIONS"},Qz={message:"No valid attributes",code:"ERR_NO_VALID_ATTRIBUTES"},bce={message:"Value unchanged",code:"ABORT_UNCHANGED"},zo={message:"Not found",code:"ERR_NOT_FOUND"},eW={message:"Not implemented",code:"ERR_NOT_IMPLEMENTED"},K_e={message:"Existing flight",code:"ERR_EXISTING_FLIGHT"},Ice={message:"Existing flight profile",code:"ERR_EXISTING_FLIGHT_PROFILE"},Z_e={message:"Existing outcome",code:"ERR_EXISTING_OUTCOME"},X_e={message:"Existing matchUpId",code:"ERR_EXISTING_MATCHUP_ID"},P7={message:"Existing stage",code:"ERR_EXISTING_STAGE"},wce={message:"Existing structure",code:"ERR_EXISTING_STRUCTURE"},tW={message:"Method not found",code:"ERR_NOT_FOUND_METHOD"},J_e={message:"Scheduled matchUps",code:"ERR_SCHEDULED_MATCHUPS"},Sce={message:"Scores present",code:"ERR_SCORES_PRESENT"},wn={disableNotifications:!1,tournamentId:void 0,tournamentRecords:{},subscriptions:{},modified:!1,methods:{},notices:[]};var Tce={addNotice:function({topic:t,payload:e,key:i}){if(!(typeof t!="string"||typeof e!="object")&&(wn.disableNotifications||(wn.modified=!0),!(wn.disableNotifications||!wn.subscriptions[t])))return i&&(wn.notices=wn.notices.filter(n=>!(n.topic===t&&n.key===i))),wn.notices.push({topic:t,payload:e,key:i}),{...le}},callListener:function({topic:t,notices:e}){const i=wn.subscriptions[t];i&&typeof i=="function"&&i(e)},cycleMutationStatus:function(){const t=wn.modified;return wn.modified=!1,t},deleteNotice:function({topic:t,key:e}){wn.notices=wn.notices.filter(i=>(!t||i.topic===t)&&i.key!==e)},deleteNotices:function(){wn.notices=[]},disableNotifications:function(){wn.disableNotifications=!0},enableNotifications:function(){wn.disableNotifications=!1},getMethods:iW,getNotices:function({topic:t}){const e=wn.notices.filter(i=>i.topic===t).map(i=>i.payload);return e.length&&e},getTopics:function(){return{topics:Object.keys(wn.subscriptions)}},getTournamentId:C7,getTournamentRecord:function(t){return wn.tournamentRecords[t]},getTournamentRecords:function(){return wn.tournamentRecords},removeTournamentRecord:function(t){if(typeof t!="string")return{error:Re};if(!wn.tournamentRecords[t])return{error:zo};delete wn.tournamentRecords[t];const e=Object.keys(wn.tournamentRecords);return e.length===1?wn.tournamentId=e[0]:e.length||(wn.tournamentId=void 0),{success:!0}},setMethods:function(t){return Object.keys(t).forEach(e=>{typeof t[e]=="function"&&(wn.methods[e]=t[e])}),{...le}},setSubscriptions:function(t){return typeof t.subscriptions!="object"?{error:Re}:(Object.keys(t.subscriptions).forEach(e=>{wn.subscriptions[e]=t.subscriptions[e]}),{...le})},setTournamentId:function(t){return t?wn.tournamentRecords[t]?(wn.tournamentId=t,{success:!0}):{error:je}:(wn.tournamentId=void 0,{success:!0})},setTournamentRecord:function(t){const e=t==null?void 0:t.tournamentId;return e?(wn.tournamentRecords[e]=t,{success:!0}):{error:W_}},setTournamentRecords:function(t){wn.tournamentRecords=t;const e=Object.keys(t);e.length===1?wn.tournamentId=e[0]:e.length||(wn.tournamentId=void 0)},handleCaughtError:function({engineName:t,methodName:e,params:i,err:n}){let r;return typeof n=="string"?r=n.toUpperCase():n instanceof Error&&(r=n.message),console.log("ERROR",{tournamentId:C7(),params:JSON.stringify(i),engine:t,methodName:e,error:r}),{error:r}}};function C7(){return wn.tournamentId}function iW(){return wn.methods??{}}const ys={tournamentFactoryVersion:"0.0.0",timers:{default:{elapsedTime:0}},deepCopyAttributes:{stringify:[],ignore:[],toJSON:[]},deepCopy:!0};let Wo=Tce;function Wl(t){return t&&typeof t=="object"?typeof ys.devContext=="object"&&Object.keys(t).every(e=>{var i;return((i=ys.devContext)==null?void 0:i[e])===t[e]})&&ys.devContext:ys.devContext??!1}function Q_e(t){typeof t=="function"?ys.globalLog=t:delete ys.globalLog}function cR(t){ys.devContext=t}function eke(){Wo.disableNotifications()}function YO(){Wo.enableNotifications()}function uR(t,e){typeof t=="boolean"&&(ys.deepCopy=t),typeof e=="object"&&(Array.isArray(e.ignore)&&(ys.deepCopyAttributes.ignore=e.ignore),Array.isArray(e.toJSON)&&(ys.deepCopyAttributes.toJSON=e.toJSON),Array.isArray(e.stringify)&&(ys.deepCopyAttributes.stringify=e.stringify),e.threshold&&(ys.deepCopyAttributes.threshold=e.threshold))}function Uce(){return{enabled:ys.deepCopy,...ys.deepCopyAttributes}}function tke(t){return t?typeof t!="object"?{error:Re}:Wo.setMethods(t):{error:bt,info:"missing method declarations"}}function Dce(){return Wo.cycleMutationStatus()}function bi(t){return Wo.addNotice(t)}function ike(){return Wo.getMethods()}function nke(t){return Wo.getNotices(t)}function Pce({key:t,topic:e}){return Wo.deleteNotice({key:t,topic:e})}function tk(){return Wo.deleteNotices()}function Bu(){return Wo.getTopics()}async function E7(t){return Wo.callListener(t)}function bI(){return Wo.getTournamentId()}function Cce(t){return Wo.getTournamentRecord(t)}function sw(){return Wo.getTournamentRecords()}function rke(t){return Wo.setTournamentRecord(t)}function F2(t){return Wo.setTournamentRecords(t)}function dR(t){return Wo.setTournamentId(t)}function oke(t){return Wo.removeTournamentRecord(t)}function M7(){return Wo}function nW({engineName:t,methodName:e,params:i,err:n}){return(typeof Wo.handleCaughtError=="function"&&Wo.handleCaughtError||Tce.handleCaughtError)({engineName:t,methodName:e,params:i,err:n})}function ake(t,e){if(ys.globalLog)try{ys.globalLog({log:t,engine:e})}catch(i){console.log("globalLog error",i),console.log(e,t),Q_e()}else console.log(e,t)}function It(t,e,i,n){if(typeof t!="object"||t===null)return t;const r=Uce();r!=null&&r.enabled||(n=!0);const o=["",void 0,null];e&&o.push(!1);const a=function(s,l,c){return Object.keys(s).filter(u=>!l.includes(s[u])&&(!c||!Array.isArray(s[u])||s[u].length))}(t,o,i);return Object.assign({},...a.map(s=>Array.isArray(t[s])?{[s]:n?t[s]:t[s].map(l=>It(l))}:{[s]:n?t[s]:It(t[s])}))}function ce({context:t,result:e,stack:i,info:n}){return e&&!Array.isArray(e==null?void 0:e.stack)&&(e.stack=[]),e&&Array.isArray(e==null?void 0:e.stack)&&typeof i=="string"&&e.stack.push(i),e&&n&&(e.info=n),e&&typeof t=="object"&&Object.keys(t).length&&Object.assign(e,It(t)),!e||e!=null&&e.error||e!=null&&e.success||Object.assign(e,{...le}),e??{success:!0}}const rW="element required",ske="missing name";function ia(t){if(!t||typeof t!="object")return{error:bt};if(t.element&&typeof(t==null?void 0:t.element)!="object")return{error:Re};if(!(t!=null&&t.name))return{error:bt,info:ske};if(!(t!=null&&t.element)){if(t.discover&&t.tournamentRecords){for(const e of Object.keys(t.tournamentRecords)){const i=ia({element:t.tournamentRecords[e],name:t.name});if(i.error)return ce({result:i,stack:"removeExtension"})}return{...le}}return{error:bt,info:rW}}return t!=null&&t.element.extensions?(t.element.extensions=t.element.extensions.filter(e=>(e==null?void 0:e.name)!==t.name),{...le}):{...le,info:zo}}function Eu({requiredAttributes:t=["name","value"],extension:e}){if(!e||typeof e!="object"||typeof e.name!="string")return!1;const i=Object.keys(e);return t.filter(n=>i.includes(n)).length===t.length}function Ii(t){if(typeof t!="object")return{error:bt};const e="addExtension";if(t!=null&&t.element&&typeof t.element!="object")return ce({result:{error:Re},stack:e});if(!Eu({extension:t.extension}))return ce({result:{error:Re,info:"invalid extension"},stack:e});if(!t.element){if(t.discover&&!t.tournamentId&&t.tournamentRecords){for(const n of Object.values(t.tournamentRecords)){const r=Ii({extension:t.extension,element:n});if(r.error)return ce({result:r,stack:e})}return{...le}}return ce({result:{error:bt},stack:e})}if(t.element.extensions||(t.element.extensions=[]),(t==null?void 0:t.creationTime)??!0){const n=new Date().toISOString();Object.assign(t.extension,{createdAt:n})}const i=t.element.extensions.find(({name:n})=>n===t.extension.name);return i?i.value=t.extension.value:t.extension.value&&t.element.extensions.push(t.extension),{...le}}const lke="extensionQueries";function ei({discover:t,element:e,name:i,...n}){var r;if(!e||!i){if(t&&n){const a=Object.keys(n).filter(c=>typeof t=="boolean"||Array.isArray(t)&&t.includes(c)).find(c=>{var u;return!!Array.isArray((u=n[c])==null?void 0:u.extensions)&&n[c].extensions.find(d=>(d==null?void 0:d.name)===i)});let s=a&&n[a];!s&&n.tournamentRecords&&(s=Object.values(n.tournamentRecords).find(c=>{var u;return(u=c.extensions)==null?void 0:u.length}));const l=(r=s==null?void 0:s.extensions)==null?void 0:r.find(c=>(c==null?void 0:c.name)===i);return{extension:l,info:l?void 0:zo}}return ce({result:{error:bt},stack:lke})}if(!Array.isArray(e.extensions))return{info:"no extensions"};const o=e.extensions.find(a=>(a==null?void 0:a.name)===i);return{extension:o,info:o?void 0:zo}}const pR=/^[\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1])$/,Ece=/^((0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)([.,][0-9]{3})?$/,Mu=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))([ T](0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/,um=/^([\d]{4}-(0[1-9]|1[0-2])-(0[1-9]|[1-2][\d]|3[0-1]))?([ T]?(0[\d]|1[\d]|2[0-3]):[0-5][\d](:[0-5][\d])?)?([.,][\d]{3})?Z?$/;function hR(t){let{scheduledDate:e}=t;if(!e&&t.scheduledTime&&(e=zt(t.scheduledTime)),!e)return;const i=mn(t.scheduledTime);let n=zt(e);return n&&i&&(n+=`T${i}`),n}function cke(t){return typeof t!="object"||Array.isArray(t)?!1:Object.prototype.toString.call(t)==="[object Date]"}function k0(t){const e=typeof t=="string"?t==null?void 0:t.split(" "):[];return!(t&&(e==null?void 0:e.length)>1&&!["AM","PM"].includes(e[1].toUpperCase()))&&!(t&&!um.test(qy(t,!0,!0)))}function Ss(t){return Bm(t)||pR.test(t)}const oW=t=>{const e=pU(t)||Bm(t)?new Date(t):new Date,i=e.getUTCMonth()+1,n=i<10?`0${i}`:`${i}`;return`${e.getUTCFullYear()}-${Zs(n)}-${Zs(e.getUTCDate())}`};function Mc(t,e="-",i="YMD"){if(!t)return"";typeof t=="string"&&t.indexOf("T")<0&&(t+="T00:00");const n=new Date(t);let r=""+(n.getMonth()+1),o=""+n.getDate();const a=n.getFullYear();return r.length<2&&(r="0"+r),o.length<2&&(o="0"+o),i==="DMY"?[o,r,a].join(e):i==="MDY"?[r,o,a].join(e):i==="YDM"?[a,o,r].join(e):i==="DYM"?[o,a,r].join(e):i==="MYD"?[r,a,o].join(e):[a,r,o].join(e)}function fR(t){const e=t?new Date(t):new Date,i=e.getTimezoneOffset();return new Date(e.getTime()-60*i*1e3)}function pU(t){if(typeof t=="boolean")return!1;const e=t instanceof Date&&t||!isNaN(t)&&new Date(t)||!1;return e&&!isNaN(e.valueOf())}function ik(t,e){if(!Ss(t)||!Ss(e))return[];const i=zt(t)+"T00:00",n=zt(e)+"T00:00",r=new Date(i),o=new Date(n),a=[];let s=0;if(pU(o)&&pU(r)&&r<=o){const l=r;let c=l.getTime();for(;c<=o.getTime()&&s<300;)s+=1,a.push(new Date(l)),c=l.setDate(l.getDate()+1)}return a.map(l=>Mc(l))}const uke=/^([+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24:?00)([.,]\d+(?!:))?)?(\17[0-5]\d([.,]\d+)?)?([zZ]|([+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/;function Bm(t){return typeof t=="string"&&uke.test(t)}function aW(t){if(typeof t!="string")return!1;const e=t.split("Z")[0].split(":"),i=e.every(n=>!isNaN(parseInt(n)));return!(e.length<2||!i||parseInt(e[0])>23||parseInt(e[1])>60)}function gi(t){const e=mn(t);if(!e)return 0;const[i,n]=e.split(":").map(r=>parseInt(r));return 60*i+n}function mR(t){return aW(t)?t.split(":").slice(0,2).map(Zs).join(":"):void 0}function mn(t){return Bm(t)&&t.indexOf("T")>0?mR(t.split("T").reverse()[0]):mR(t)}function zt(t){return Bm(t)||Mu.test(t)?t.split("T")[0]:void 0}function LS(t,e){const i=new Date(t);return i.setDate(i.getDate()+e),zt(i.toISOString())}function gR(t){t=typeof t!="string"?"00:00":t;const e={},i={};return{0:e.time,1:e.ampm}=t.split(" ")||[],{0:i.hours,1:i.minutes}=e.time.split(":")||[],i.ampm=e.ampm,isNaN(i.hours)||isNaN(i.minutes)||i.ampm&&!["AM","PM"].includes(i.ampm.toUpperCase())?{}:i}function qy(t,e,i){const n=zt(t),r=mn(t),o=n?r:t;return t?e&&(n&&i&&t||function(a){const s=gR(a);return s.ampm&&s.hours&&(s.ampm.toLowerCase()==="pm"&&parseInt(s.hours)<12&&(s.hours=(s.hours&&parseInt(s.hours)||0)+12),s.ampm.toLowerCase()==="am"&&s.hours==="12"&&(s.hours="00")),`${s.hours||"12"}:${s.minutes||"00"}`.split(":").map(Zs).join(":")}(o))||function(a){var s;const l=gR(a);if(typeof l!="object"||Object.keys(l).length)return l.ampm?a:(l.hours>12?(l.hours-=12,l.ampm="PM"):l.hours==="12"?l.ampm="PM":(l.hours==="00"&&(l.hours="12"),l.ampm="AM"),((s=l.hours)==null?void 0:s[0])==="0"&&(l.hours=l.hours.slice(1)),`${l.hours||"12"}:${l.minutes||"00"} ${l.ampm}`)}(o):void 0}function Mce(t,e){const i=gR(t),n=gR(e);if(parseInt(i.hours)<parseInt(n.hours))return-1;if(parseInt(i.hours)>parseInt(n.hours))return 1;if(i.hours===n.hours){if(parseInt(i.minutes)<parseInt(n.minutes))return-1;if(parseInt(i.minutes)>parseInt(n.minutes))return 1}return 0}function R7(t,e=7){const i=zt(t)+"T00:00",n=new Date(i);return Mc(new Date(n.setDate(n.getDate()+e)))}function hr(t,e=void 0){const[i,n]=(t||"00:00").split(":").map(Zs),r=fR(e).setHours(i,n,0,0);return fR(r)}function $P(t,e,i=!0){const n=new Date(t),r=(new Date(e).getTime()-n.getTime())/1e3/60;return i?Math.abs(Math.round(r)):Math.round(r)}function Oa(t,e){const i=mn(t);if(!i)return"00:00";const n=isNaN(e)?0:e;return mn(sW(hr(i),n).toISOString())}function sW(t,e){const i=new Date(t);return new Date(i.getTime()+6e4*e)}function Zs(t){return t.toString()[1]?t:"0"+t}function Pd(t,e){const i=new Date(t),n=new Date(e);return i.getFullYear()===n.getFullYear()&&i.getMonth()===n.getMonth()&&i.getDate()===n.getDate()}const dke={addDays:R7,addWeek:function(t){return R7(t)},addMinutesToTimeString:Oa,convertTime:qy,getIsoDateString:hR,getUTCdateString:oW,DateHHMM:function(t){const e=new Date(t);return function(i,n){const r=parseInt(i,10),o=Math.floor(r/3600),a=Math.floor((r-3600*o)/60),s=r-3600*o-60*a;return(!n||n!=null&&n.displaySeconds?o+":"+a+":"+s:o+":"+a).split(":").map(Zs).join(":")}(e.getSeconds()+60*e.getMinutes()+3600*e.getHours(),{displaySeconds:!1})},extractDate:zt,extractTime:mn,formatDate:Mc,getDateByWeek:function(t,e,i,n=!1){const r=new Date(e,0,1+7*(t-1)),o=n?0:1;return r.setDate(r.getDate()+(o-r.getDay())),Mc(r,i)},isISODateString:Bm,isDate:pU,isTimeString:aW,offsetDate:fR,offsetTime:function(t){return fR(t).getTime()},sameDay:Pd,timeStringMinutes:gi,timeToDate:hr,timeUTC:function(t){const e=pU(t)||Bm(t)?new Date(t):new Date;return Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())},validTimeValue:k0,validDateString:pR,timeValidation:um,dateValidation:Mu};function ft(t,e,i,n,r=0){if(M7().makeDeepCopy)return M7().makeDeepCopy(t,e,i,n);const o=Uce(),{stringify:a,toJSON:s,ignore:l,modulate:c}=o||{};if(!(o!=null&&o.enabled)&&!i||typeof t!="object"||typeof t=="function"||t===null||typeof(o==null?void 0:o.threshold)=="number"&&r>=o.threshold)return t;const u=Array.isArray(t)?[]:{},d=Object.keys(t).filter(h=>!i||!l||Array.isArray(l)&&!l.includes(h)||typeof l=="function"&&!l(h)),p=(h,f)=>{u[h]=typeof(f==null?void 0:f.toString)=="function"?f.toString():JSON.stringify(f)};for(const h of d){const f=t[h],m=typeof c=="function"?c(f):void 0;if(m!==void 0)u[h]=m;else if(e&&h==="extensions"&&Array.isArray(f)){const g=lW(f);Object.assign(u,...g)}else n&&h==="extensions"?u[h]=[]:Array.isArray(a)&&a.includes(h)?p(h,f):Array.isArray(s)&&s.includes(h)&&typeof(f==null?void 0:f.toJSON)=="function"?u[h]=f.toJSON():f===null?u[h]=void 0:cke(f)?u[h]=new Date(f).toISOString():u[h]=ft(f,e,i,n,r+1)}return u}function lW(t){return t==null?void 0:t.map(e=>{const{name:i,value:n}=e;return i&&n&&{[`_${i}`]:n}}).filter(Boolean)}function wv({element:t,accessor:e}){if(typeof e!="string")return{values:[]};const i=ft(t),n=e.split("."),r=[];let o;(function s({targetElement:l,attributes:c=[],significantCharacters:u}){for(const[p,h]of c.entries())if(l!=null&&l[h]){const f=c.slice(p+1);f.length?Array.isArray(l[h])?l[h].forEach(m=>s({targetElement:m,attributes:f})):d({targetElement:l=l[h],index:p}):(o||(o=l[h]),r.includes(l[h])||r.push(l[h]))}function d({targetElement:p,index:h}){if(p&&h===c.length-1&&["string","number"].includes(typeof p)){const f=u?p.slice(0,u):p;o?r.includes(f)||r.push(f):(o=f,r.push(f))}}})({targetElement:i,attributes:n});const a={value:o};return r.length&&(a.values=r),a}function $m(t){return typeof t=="function"}function La(t){return typeof t=="string"}function bn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}function pke(t,e){if(!bn(t)||!bn(e))return!1;const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length)return!1;for(const r of i)if(t[r]!==e[r])return!1;return!0}function Rce(t,e){return Array.isArray(t)?Object.assign({},...(t??[]).filter(bn).map(i=>i[e]&&{[i[e]]:i}).filter(Boolean)):{}}const Nce=t=>e=>{var i;return t&&typeof e=="object"?Array.isArray(t)&&t.map(n=>{var r;return{[n]:(r=wv({element:e,accessor:n}))==null?void 0:r.value}})||typeof t=="object"&&Object.keys(t).map(n=>{var r;return{[n]:(r=wv({element:e,accessor:n}))==null?void 0:r.value}})||((i=typeof t=="string"&&wv({element:e,accessor:t}))==null?void 0:i.value):void 0},Ts=Nce;function B2(t){return Array.isArray(t)?t.length+t.map(B2).reduce((e,i)=>e+i,0):typeof t=="object"&&t!==null?Object.keys(t).length+Object.keys(t).map(e=>B2(t[e])).reduce((e,i)=>e+i,0):0}const Oo="tournamentRecords",cW="policyDefinitions",qp="tournamentRecord",Yy="drawDefinition",hke="matchUpFormat",Pp="participantId",Ace="scheduleDates",_ce="structureId",uW="participant",dW="matchUpIds",kce="structures",x0="matchUpId",xce="inContext",pW="structure",nk="courtIds",rk="venueIds",Oce="matchUps",Lce="courtId",Fce="eventId",_f="matchUp",Bce="drawId",Sv="error",VP="event",jP="param",zd="object",El="array",Ch="validate",Yv="invalid",HP="_ofType",fke="_oneOf",mke={[Oo]:Wn,[qp]:je,[cW]:Kz,[Yy]:rt,[Pp]:Hr,tournamentId:sU,[_ce]:Va,[dW]:OP,[uW]:A0,[kce]:Qle,[x0]:co,[pW]:bg,[Lce]:N0,[Oce]:Nf,[_f]:Cs,[nk]:bt,[rk]:bt,[Bce]:Yc,[Fce]:Fi,[VP]:sl},gke={[Oo]:zd,[cW]:zd,[qp]:zd,[Yy]:zd,[Ace]:El,[uW]:zd,[dW]:El,[kce]:El,[pW]:zd,[nk]:El,[rk]:El,[Oce]:El,[_f]:zd,[VP]:zd,uuids:El};function Ln(t,e,i){if(!t&&!bn(t))return{error:Re};if(!(e!=null&&e.length)||t!=null&&t._bypassParamCheck)return{valid:!0};if(!Array.isArray(e))return{error:Re};const{paramError:n,errorParam:r}=function(o,a){let s;return{paramError:a.find(({_ofType:l,_oneOf:c,_anyOf:u,validate:d,...p})=>{const h=c&&function(v,y){if(!y)return;const b=N7(v,y);return b.length!==1?{error:Re}:b.reduce((I,T)=>({...I,[T]:!0}),{})}(o,c);if(h!=null&&h.error)return h.error;h&&Object.assign(p,h);const f=u&&function(v,y){if(!y)return;const b=N7(v,y).filter(I=>v[I]);return b.length<1?{error:Re}:b.reduce((I,T)=>({...I,[T]:!0}),{})}(o,u);if(f!=null&&f.error)return f.error;f&&Object.assign(p,f);const m=Object.keys(p).filter(v=>typeof p[v]=="boolean"),g=m.find(v=>{const y=d&&!$m(d),b=o[v]&&!d&&function(S,w,U){return U=U||gke[w]||"string",U==="array"?!Array.isArray(S[w]):typeof S[w]!==U}(o,v,l),I=p[v]&&!o[v],T=y||b||I||d&&o[v]&&!function(S,w){return!$m(w)||w(S)}(o[v],d);return T&&(s=v),T});return!m.length||g}),errorParam:s}}(t,e);return n?ce({info:{param:r},result:{error:t[r]===void 0?mke[r]||Re:n.validate&&n.invalid||Re},stack:i}):{valid:!0}}function N7(t,e){return sr(Object.keys(t),Object.keys(e))}const $ce="DYNAMIC",Vm="RANKING",Tv="RATING",lw="SCALE",ap="SEEDING";function O0(t){var e;const i=Ln(t,[{[uW]:!0}]);if(i.error)return i;const n=(e=t.participant.timeItems)==null?void 0:e.filter(({itemType:o})=>(o==null?void 0:o.startsWith(lw))&&[Vm,Tv,ap].includes(o.split(".")[1])),r={ratings:{},rankings:{},seedings:{}};if(n!=null&&n.length){const o=s=>n.filter(l=>(l==null?void 0:l.itemType)===s).sort((l,c)=>new Date(l.createdAt||void 0).getTime()-new Date(c.createdAt||void 0).getTime()).pop(),a=ti(n.map(({itemType:s})=>s));for(const s of a){const l=o(s);if(l){const[,c,u,d,p]=l.itemType.split("."),h=p?`${d}.${p}`:d,f=(c===ap?"seedings":c===Vm&&"rankings")||"ratings";r[f][u]||(r[f][u]=[]),r[f][u].push({scaleValue:l.itemValue,scaleDate:l.itemDate,scaleName:h})}}}return{...le,...r}}function Kv(t){if(t===null)return{};const{source:e,template:i}=t||{};if(!i)return e;const n={};return function r(o,a,s){if(!o||!a)return;const l=Object.keys(o),c=Object.keys(a),u=Object.assign({},...c.filter(h=>h.indexOf("||")).map(h=>h.split("||").map(f=>({[f]:h}))).flat()),d=c.concat(...Object.keys(u)),p=d.includes("*");for(const h of l)if(d.indexOf(h)>=0||p){const f=a[u[h]||h]||p,m=o[h];if(typeof f!="object"||typeof m=="function"||Array.isArray(f)){const g=o[h];if(Array.isArray(f)&&!f.includes(g))return!1;(a[h]||p&&a[h]!==!1)&&(s[h]=g)}else if(Array.isArray(m)){const g=m.map(v=>{const y={};return r(v,f,y)!==!1?y:void 0}).filter(Boolean);s[h]=g}else m&&(s[h]={},r(m,f,s[h]))}}(e,i,n),n}const A7="voluntaryConsolation",Rh="competitiveBands",Vce="roundRobinTally",xh="positionActions",so="matchUpActions",KO="rankingPoints",hU="roundNaming",ok="participant",vR="progression",wg="scheduling",yR="avoidance",jm="scoring",mc="seeding",bR="feedIn",$2="draws";function ef({tournamentParticipants:t=[],policyDefinitions:e={},contextProfile:i,participantId:n,internalUse:r,personId:o}){const a=ft(t.find(s=>n&&s.participantId===n||o&&s.person&&s.person.personId===o),!1,r);if(a){const s=e==null?void 0:e[ok];if(i!=null&&i.withScaleValues){const{ratings:l,rankings:c}=O0({participant:a});a.rankings=c,a.ratings=l}if(s!=null&&s.participant)return Kv({template:s.participant,source:a})}return a}function hW(t){return t&&typeof t=="object"?t.tournamentRecord?Ii({creationTime:t.creationTime,element:t.tournamentRecord,extension:t.extension}):{error:je}:{error:bt}}function ak(t){return t&&typeof t=="object"?t.drawDefinition?Ii({creationTime:t.creationTime,element:t.drawDefinition,extension:t.extension}):{error:ml}:{error:bt}}function kf(t){return t&&typeof t=="object"?t.event?Ii({creationTime:t.creationTime,extension:t.extension,element:t.event}):{error:sl}:{error:bt}}function jce(t){var e;if(!t||typeof t!="object")return{error:bt};if(!t.participantId)return{error:Hr};const i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ef({participantId:t.participantId,tournamentParticipants:i});return n?Ii({creationTime:t.creationTime,extension:t.extension,element:n}):{error:rr}}function fW(t){return t&&typeof t=="object"?t.tournamentRecord?ia({element:t.tournamentRecord,name:t.name}):{error:je}:{error:bt}}function Hce(t){return t&&typeof t=="object"?t.drawDefinition?ia({element:t.drawDefinition,name:t.name}):{error:ml}:{error:bt}}function sk(t){return t&&typeof t=="object"?t!=null&&t.event?ia({element:t.event,name:t.name}):{error:sl}:{error:bt}}function Gce(t){var e;if(!t||typeof t!="object")return{error:bt};if(!t.participantId)return{error:Hr};const i=((e=t.tournamentRecord)==null?void 0:e.participants)||[],n=ef({participantId:t.participantId,tournamentParticipants:i});return n?ia({element:n,name:t.name}):{error:rr}}const fU="appliedPolicies",IR="positionActions",zce="context",lk="delegatedOutcome",Rc="disabled",ck="disableLinks",cw="disableAutoCalc",wR="drawDeletions",SR="entryProfile",ql="flightProfile",V2="groupingAttribute",Cp="lineUps",Zv="linkedTournamentsIds",uk="matchUpHistory",mW="participantRepresentatives",L0="personRequests",Wce="rankingPoints",$u="roundTarget",GP="scheduleLimits",Ep="scheduleTiming",Xv="schedulingProfile",II="subOrder",tf="tally",Jv="tieFormatModification",vke={ACTIVE_SUSPENSION:"activeSuspension",APPLIED_POLICIES:fU,AUDIT_POSITION_ACTIONS:IR,CONTEXT:zce,DELEGATED_OUTCOME:lk,DISABLED:Rc,DISABLE_LINKS:ck,DISABLE_AUTO_CALC:cw,DRAW_DELETIONS:wR,DRAW_PROFILE:"drawProfile",ENTRY_PROFILE:SR,EVENT_PROFILE:"eventProfile",EVENT_WITHDRAWAL_REQUESTS:"eventWithdrawalRequests",FLIGHT_PROFILE:ql,GROUPING_ATTRIBUTE:V2,LINEUPS:Cp,LINKED_TOURNAMENTS:Zv,MATCHUP_HISTORY:uk,PARTICIPANT_REPRESENTATIVES:mW,PERSON_REQUESTS:L0,RANKING_POINTS:Wce,ROUND_TARGET:$u,SCHEDULE_LIMITS:GP,SCHEDULE_TIMING:Ep,SCHEDULING_PROFILE:Xv,STATUS_DETAIL:"statusDetail",SUB_ORDER:II,TALLY:tf,TIE_FORMAT_MODIFICATIONS:Jv,FACTORY:"factory"},_7=[lk,Rc,ck,ql,Cp,uk,mW,L0,$u,GP,Ep,Xv,II,tf];function zP({tournamentRecords:t}){return{tournamentIds:bn(t)?Object.keys(t):[],...le}}function qce({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Wn};const e=zP({tournamentRecords:t}),{tournamentIds:i}=e;return(i==null?void 0:i.length)>1?Ii({tournamentRecords:t,discover:!0,extension:{name:Zv,value:{tournamentIds:i}}}):{...le}}function Yce({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Wn}:ce({result:ia({name:Zv,tournamentRecords:t,discover:!0}),stack:"unlinkTournaments"})}function Kce({tournamentRecords:t,tournamentId:e}){if(typeof t!="object")return{error:Re};if(!e)return{error:sU};const i=zP({tournamentRecords:t}),{tournamentIds:n}=i;if(!n.includes(e))return{error:sU};let r;return n.every(o=>{var a;const s=t[o],{extension:l}=ei({element:s,name:Zv});if(!l)return!0;const c=((a=l==null?void 0:l.value)==null?void 0:a.tournamentIds)||[];if(!(c!=null&&c.length)||c.length===1&&c.includes(e)||o===e){const p=fW({name:Zv,tournamentRecord:s});return p.error&&(r=p.error),p.success}const u=c.filter(p=>p!==e);l.value={tournamentIds:u};const d=hW({tournamentRecord:s,extension:l});return d.error&&(r=d.error),d.success}),r?{error:r}:{...le}}var yke=Object.freeze({__proto__:null,linkTournaments:qce,unlinkTournament:Kce,unlinkTournaments:Yce});function WP({tournamentRecords:t}){return typeof t!="object"||!Object.keys(t).length?{error:Wn}:{linkedTournamentIds:Object.assign({},...Object.keys(t).map(e=>{var i;const n=t[e],r=n==null?void 0:n.tournamentId,{extension:o}=ei({element:n,name:Zv});return{[e]:(((i=o==null?void 0:o.value)==null?void 0:i.tournamentIds)||[]).filter(a=>a!==r)}}))}}var bke=Object.freeze({__proto__:null,getLinkedTournamentIds:WP,getTournamentIds:zP}),Ike=Object.freeze({__proto__:null,getLinkedTournamentIds:WP,getTournamentIds:zP,linkTournaments:qce,mutate:yke,query:bke,unlinkTournament:Kce,unlinkTournaments:Yce});const gW=t=>e=>t[e],vW=(t=[])=>t.map($r).filter(Boolean),j2=(t=[])=>t.map(li).filter(Boolean),li=(t={})=>gW(t)("participantId"),$r=(t={})=>gW(t)("matchUpId"),TR=(t={})=>gW(t)("drawId");function Zce({representativeParticipantIds:t,drawDefinition:e}){if(!e)return{error:ml};if(!Array.isArray(t))return{error:Re};const i=j2((e==null?void 0:e.entries)||[]);return t.length&&sr(t,i).length<t.length?{error:Re}:ak({drawDefinition:e,extension:{name:mW,value:t}})}const Es="ABANDONED",F0="AWAITING_RESULT",Ri="BYE",Yp="CANCELLED",fr="COMPLETED",B0="DEAD_RUBBER",Mi="DEFAULTED",Mr="DOUBLE_DEFAULT",gr="DOUBLE_WALKOVER",Kc="IN_PROGRESS",Cd="INCOMPLETE",yW="NOT_PLAYED",da="RETIRED",Sg="SUSPENDED",qn="TO_BE_PLAYED",Li="WALKOVER",wke=[F0,fr,Mi,gr,Mr,Kc,Cd,da,Sg,Li],Ske=[Es,F0,Ri,Yp,fr,B0,Mi,gr,Mr,Kc,Cd,yW,da,Sg,qn,Li],Tke=[Ri,gr,Mr,fr,Mi,da,Li],Uke=[Es,F0,Yp,B0,Kc,Cd,yW,Sg,qn,void 0],no=[Yp,Es,fr,B0,Mi,gr,Mr,da,Li],Xce=[Es,fr,Mi,gr,Mr,Kc,da,Li],Dke=[Kc,Cd,Sg,qn],Pke={ABANDONED:Es,AWAITING_RESULT:F0,BYE:Ri,CANCELLED:Yp,COMPLETED:fr,DEAD_RUBBER:B0,DEFAULTED:Mi,DOUBLE_WALKOVER:gr,DOUBLE_DEFAULT:Mr,IN_PROGRESS:Kc,INCOMPLETE:Cd,NOT_PLAYED:yW,RETIRED:da,SUSPENDED:Sg,TO_BE_PLAYED:qn,WALKOVER:Li},ct="MAIN",St="QUALIFYING",So="CONSOLATION",qr="VOLUNTARY_CONSOLATION",Vn="PLAY_OFF",bW=[ct,St,So,Vn,qr],Qv={[St]:1,[ct]:2,[Vn]:3,[So]:3,[qr]:4},Jce="finishingPositions",Qce="aggregateEventStructures",eue={[ct]:1,[Vn]:2,[So]:3,[St]:4,[qr]:5},Cke={[Vn]:1,[ct]:2,[So]:3,[St]:4,[qr]:5},dk="CLUSTER",Hm="WATERFALL",pk="ITEM",na="CONTAINER",Ic="DRAW",hk="RANDOM",_l="TOP_DOWN",nf="BOTTOM_UP",Mp="POSITION",Rp="WINNER",Ed="LOSER",Md="FIRST_MATCHUP",ll="AD_HOC",uw="FEED_IN",dw="COMPASS",pw="OLYMPIC",hu="SINGLE_ELIMINATION",mU="DOUBLE_ELIMINATION",hw="FIRST_MATCH_LOSER_CONSOLATION",gU="FIRST_ROUND_LOSER_CONSOLATION",Gm="LUCKY_DRAW",UR="CURTIS_CONSOLATION",Eke="CURTIS_CONSOLATION",IW="FEED_IN_CHAMPIONSHIP_TO_SF",vU="FEED_IN_CHAMPIONSHIP_TO_SF",wW="FEED_IN_CHAMPIONSHIP_TO_QF",yU="FEED_IN_CHAMPIONSHIP_TO_QF",SW="FEED_IN_CHAMPIONSHIP_TO_R16",bU="FEED_IN_CHAMPIONSHIP_TO_R16",tue="MODIFIED_FEED_IN_CHAMPIONSHIP",IU="MODIFIED_FEED_IN_CHAMPIONSHIP",wU="FEED_IN_CHAMPIONSHIP",Yl="ROUND_ROBIN",Rd="ROUND_ROBIN_WITH_PLAYOFF",iue="DECIDER",nue="BACKDRAW",TW={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-3":{name:"Northeast",abbreviation:"NE"},"0-1-1":{name:"South",abbreviation:"S"},"0-1-2":{name:"Southwest",abbreviation:"SW"},"0-2-1":{name:"Northwest",abbreviation:"NW"},"0-1-1-1":{name:"Southeast",abbreviation:"SE"}},UW={0:{name:"East",abbreviation:"E"},"0-1":{name:"West",abbreviation:"W"},"0-2":{name:"North",abbreviation:"N"},"0-1-1":{name:"South",abbreviation:"S"}},$0="WIN_RATIO",Ky="ROUND_OUTCOME",rue=[dw,UR,yU,bU,vU,wU,wW,SW,IW,hw,gU,Gm,IU,pw,Vn,Rd],Mke={MAIN:ct,QUALIFYING:St,CONSOLATION:So,ITEM:pk,CONTAINER:na,FIRST_MATCHUP:Md,WINNER:Rp,LOSER:Ed,AD_HOC:ll,FEED_IN:uw,FLEX_ROUNDS:"AD_HOC",COMPASS:dw,PLAY_OFF:Vn,OLYMPIC:pw,KNOCKOUT:"SINGLE_ELIMINATION",SINGLE_ELIMINATION:hu,DOUBLE_ELIMINATION:mU,CURTIS:UR,FICSF:IW,FICQF:wW,FICR16:SW,MFIC:tue,VOLUNTARY_CONSOLATION:qr,FIRST_MATCH_LOSER_CONSOLATION:hw,FIRST_ROUND_LOSER_CONSOLATION:gU,MODIFIED_FEED_IN_CHAMPIONSHIP:IU,FEED_IN_CHAMPIONSHIP_TO_R16:bU,FEED_IN_CHAMPIONSHIP_TO_QF:yU,FEED_IN_CHAMPIONSHIP_TO_SF:vU,FEED_IN_CHAMPIONSHIP:wU,LUCKY_DRAW:Gm,ROUND_ROBIN_WITH_PLAYOFF:Rd,ROUND_ROBIN:Yl,DECIDER:iue,BACKDRAW:nue,COMPASS_ATTRIBUTES:TW,OLYMPIC_ATTRIBUTES:UW,DRAW:Ic,RANDOM:hk,TOP_DOWN:_l,BOTTOM_UP:nf,WATERFALL:Hm,WIN_RATIO:$0,ROUND_OUTCOME:Ky,MULTI_STRUCTURE_DRAWS:rue,generatedDrawTypes:[ll,dw,UR,mU,yU,bU,vU,wU,uw,hw,gU,Gm,IU,pw,Vn,Yl,Rd,hu],stageOrder:Qv,finishOrder:eue,AGGREGATE_EVENT_STRUCTURES:Qce,FINISHING_POSITIONS:Jce};function Zy(t,e,i){var n,r;const o=p=>{var h,f;return(f=(h=ei({element:p,name:$u}))==null?void 0:h.extension)==null?void 0:f.value},a=i==null?void 0:i.deprioritizeCompleted,s=(i==null?void 0:i.mode)===Qce&&Cke,l=(i==null?void 0:i.mode)===Jce&&eue,c=l||s||Qv,u=p=>(h=>(h==null?void 0:h.stage)===ct&&(h==null?void 0:h.stageSequence)===1)(p)?-1:c[p==null?void 0:p.stage],d=p=>p==null?void 0:p.matchUps.every(({matchUpStatus:h})=>no.includes(h)?1:-1);return a&&d(t)-d(e)||s&&u(t)-u(e)||((t==null?void 0:t.stage)&&c[t.stage]||0)-((e==null?void 0:e.stage)&&c[e.stage]||0)||(o(t)||0)-(o(e)||0)||!l&&!s&&(((n=e==null?void 0:e.positionAssignments)==null?void 0:n.length)??1/0)-(((r=t==null?void 0:t.positionAssignments)==null?void 0:r.length)??1/0)||((t==null?void 0:t.stageSequence)??0)-((e==null?void 0:e.stageSequence)??0)||(DR(t)||0)-(DR(e)||0)}function DR(t){return((t==null?void 0:t.matchUps)||[]).reduce((e,i)=>{var n;const r=(((n=i.finishingPositionRange)==null?void 0:n.winner)||[]).reduce((o,a)=>o+a,0);return!e||r<e?r:e},void 0)}function kt({drawDefinition:t,structureId:e}){if(!t)return{error:rt};if(!e)return{error:Va};const{structures:i}=Nd({drawDefinition:t}),n=i==null?void 0:i.map(o=>o.structures?[...o.structures].concat(o):o).flat(),r=n==null?void 0:n.find(o=>o.structureId===e);return r?{structure:r,containingStructure:r.structureType===pk?n==null?void 0:n.find(o=>{var a;return(a=o.structures)==null?void 0:a.some(s=>s.structureId===e)}):void 0}:{error:Cn}}function Nd({withStageGrouping:t,drawDefinition:e,stageSequences:i,stageSequence:n,roundTarget:r,sortConfig:o,stages:a,stage:s}){var l;const c=!e&&rt||!(e!=null&&e.structures)&&Qle||void 0;if(c)return{error:c,structures:[],stageStructures:{}};const u=((l=e==null?void 0:e.structures)==null?void 0:l.filter(function(p){return!s&&!Array.isArray(a)||s&&p.stage===s||Array.isArray(a)&&a.includes(p.stage)}).filter(function(p){return!n&&!Array.isArray(i)||n&&p.stageSequence===n||Array.isArray(i)&&i.includes(p.stageSequence)}).filter(p=>{var h,f;const m=(f=(h=ei({element:p,name:$u}))==null?void 0:h.extension)==null?void 0:f.value;return!r||r===m}).sort((p,h)=>Zy(p,h,o)))??[],d=t?Object.assign({},...bW.map(p=>{const h=u==null?void 0:u.filter(f=>f.stage===p);return(h==null?void 0:h.length)&&{[p]:h}}).filter(Boolean)):{};return{structures:u,stageStructures:d}}function oue({drawDefinition:t}){if(!t)return{error:rt};const e={};return{allPositionedParticipantIds:(t.structures||[]).map(i=>{const n=i.stage;e[n]||(e[n]=[]);const{positionAssignments:r}=Ki({structure:i}),o=(r==null?void 0:r.map(li).filter(Boolean))??[];return e[n].push(...o),o}).flat(),stagePositionedParticipantIds:e}}function Ki({drawDefinition:t,structureId:e,structure:i}){let n,r=[];if(!i){if(!t)return{positionAssignments:r,error:rt};if({structure:i,error:n}=kt({drawDefinition:t,structureId:e}),n)return{positionAssignments:r,error:n}}return i.structures?r=[].concat(...i.structures.map(o=>Ki({structure:o}).positionAssignments)):i.positionAssignments?r=i.positionAssignments:n=d_e,{positionAssignments:r,error:n}}function Lr({drawDefinition:t,structureId:e,structure:i}){var n;const r=((n=Ki({drawDefinition:t,structureId:e,structure:i}))==null?void 0:n.positionAssignments)||[],o=r==null?void 0:r.filter(u=>u.participantId??u.bye??u.qualifier),a=r&&(r==null?void 0:r.length)===(o==null?void 0:o.length),s=r==null?void 0:r.filter(u=>!u.participantId&&!u.bye&&!u.qualifier),l=r==null?void 0:r.filter(u=>!u.participantId&&u.bye),c=r==null?void 0:r.filter(u=>!u.participantId&&u.qualifier);return{allPositionsAssigned:a,positionAssignments:r,unassignedPositions:s,assignedPositions:o,qualifierPositions:c,byePositions:l}}const aue="addDrawDefinition",DW="addMatchUps",zm="addParticipants",sue="addScaleItems",lue="addVenue",SU="audit",cue="deleteParticipants",uue="deleteVenue",due="deletedDrawIds",pue="deletedMatchUpIds",hue="modifyDrawDefinition",Rke="modifyDrawEntries",Nke="modifyEventEntries",fue="modifyMatchUp",Lo="modifyParticipants",mue="modifyPositionAssignments",gue="modifySeedAssignments",Ake="modifyTournamentDetail",Xy="modifyVenue",k7="mutations",_ke="publishEvent",kke="publishEventSeeding",xke="publishOrderOfPlay",vue="unPublishEvent",yue="unPublishEventSeeding",bue="unPublishOrderOfPlay",H2="updateInContextMatchUp";function fk(t,e){var i;if(!t)return{error:rt};let n=Date.now();t.updatedAt&&n===new Date(t.updatedAt).getTime()&&(n+=1);const r=new Date(n).toISOString(),o=e==null?void 0:e.filter(Boolean);return t.updatedAt=r,(i=t.structures)==null||i.filter(Boolean).forEach(a=>{o!=null&&o.length&&!(o!=null&&o.includes(a.structureId))||(a.updatedAt=r)}),{...le}}function rf({drawDefinition:t,tournamentId:e,matchUps:i,eventId:n}){return t&&fk(t),bi({payload:{matchUps:i,tournamentId:e,eventId:n},topic:DW}),{...le}}function Kp({drawDefinition:t,tournamentId:e,matchUpIds:i,eventId:n,action:r}){t&&fk(t),bi({topic:pue,payload:{tournamentId:e,matchUpIds:i,eventId:n,action:r}});for(const o of i)Pce({key:o});return{...le}}function Ci({drawDefinition:t,tournamentId:e,structureId:i,context:n,eventId:r,matchUp:o}){return o?(t&&un({drawDefinition:t,structureIds:i?[i]:void 0,tournamentId:e,eventId:r}),bi({topic:fue,payload:{matchUp:o,tournamentId:e,context:n},key:o.matchUpId}),{...le}):(console.log(Cs),{error:Cs})}function qP({tournamentId:t,eventId:e,drawDefinition:i}){return i?(fk(i),bi({payload:{drawDefinition:i,tournamentId:t,eventId:e},topic:aue,key:i.drawId}),{...le}):(console.log(rt),{error:rt})}function un({drawDefinition:t,tournamentId:e,structureIds:i,eventId:n}){return t?(fk(t,i),bi({payload:{tournamentId:e,eventId:n,drawDefinition:t},topic:hue,key:t.drawId}),{...le}):{error:rt}}function Iue({drawDefinition:t,tournamentId:e,structure:i,eventId:n}){if(!t)return{error:rt};if(!i)return{error:bg};const r=i.seedAssignments,o=i.structureId;return bi({payload:{tournamentId:e,eventId:n,drawId:t.drawId,structureId:o,seedAssignments:r},topic:gue,key:t.drawId}),un({structureIds:[o],drawDefinition:t,tournamentId:e,eventId:n}),{...le}}function of({drawDefinition:t,tournamentId:e,structure:i,event:n}){if(!t)return{error:rt};if(!i)return{error:bg};const r=Ki({structure:i}),o=i.structureId,a=t.drawId,s=n==null?void 0:n.eventId;return bi({topic:mue,payload:{positionAssignments:r,tournamentId:e,structureId:o,eventId:s,drawId:a},key:o}),un({structureIds:[o],drawDefinition:t,tournamentId:e,eventId:s}),{...le}}function wue({tournamentRecord:t,drawDefinition:e,resetEntries:i,event:n}){var r,o;if(!e)return{error:rt};const a=(r=e.structures)==null?void 0:r.find(l=>l.stage===qr);if(!a)return{error:Cn};const s=((o=a.matchUps)==null?void 0:o.map(({matchUpId:l})=>l))||[];return a.positionAssignments=[],a.seedAssignments=[],a.matchUps=[],Kp({tournamentId:t==null?void 0:t.tournamentId,action:"resetVoluntaryConsolationStructure",matchUpIds:s,drawDefinition:e}),i&&(e.entries=e.entries.filter(l=>l.entryStage!==qr)),un({tournamentId:t==null?void 0:t.tournamentId,eventId:n==null?void 0:n.eventId,drawDefinition:e,structureIds:[a.structureId]}),{...le}}function PW({drawPositions:t,structure:e}){if([St,ct].includes(e.stage)&&e.stageSequence===1)return;const{positionAssignments:i}=Ki({structure:e}),n=i==null?void 0:i.filter(({drawPosition:r})=>t==null?void 0:t.includes(r));n==null||n.forEach(r=>{Ii({element:r,extension:{name:ck,value:!0}})})}function mk({drawDefinition:t,positionAction:e}){var i;const{extension:n}=ei({name:IR,element:t}),r=Array.isArray(n==null?void 0:n.value)?(n==null?void 0:n.value)??[]:[];if(!(r!=null&&r.length)){const o=t.structures.find(a=>a.stage===ct);if(o){const a=(i=Ki({structure:o}).positionAssignments)==null?void 0:i.map(({drawPosition:s,participantId:l,bye:c,qualifier:u})=>({drawPosition:s,participantId:l,qualifier:u,bye:c}));r.push({name:"initialMainAssignments",initialAssignments:a})}}Ii({element:t,extension:{name:IR,value:r.concat(e)}})}function V0({tournamentRecord:t,drawDefinition:e,event:i}){const n=(t==null?void 0:t.events)||i&&[i],r=(n==null?void 0:n.map(l=>l==null?void 0:l.drawDefinitions).flat().filter(Boolean))||e&&[e]||[],o={},a={},s=r.map(l=>{var c;return(c=l==null?void 0:l.structures)==null?void 0:c.filter(u=>u==null?void 0:u.structures)}).flat().filter(Boolean);for(const l of s){const{structures:c,structureId:u}=l??{};c&&u&&(o[u]=c==null?void 0:c.map(d=>d.structureId))&&c.forEach(d=>a[d.structureId]=l==null?void 0:l.structureId)}return{containedStructures:o,containerStructures:a}}function lo(t){var e,i;const n=t==null?void 0:t.matchUp,r=(t==null?void 0:t.score)||(n==null?void 0:n.score),o=(e=r==null?void 0:r.sets)==null?void 0:e[0],{side1Score:a,side2Score:s,side1TiebreakScore:l,side2TiebreakScore:c,side1PointScore:u,side2PointScore:d}=o||{},p=a||s||l||c||u||d;return!!(((i=r==null?void 0:r.sets)==null?void 0:i.length)>1||p)}function YP({matchUpStatus:t}){return Tke.includes(t)}function G2({matchUpStatus:t}){return Uke.includes(t)}function CW({matchUpStatus:t,winningSide:e,tieMatchUps:i,sides:n,score:r}){var o;const a=n==null?void 0:n.find(({participantId:l})=>l),s=(o=i==null?void 0:i.filter(CW))==null?void 0:o.length;return lo({score:r})||s||e&&a||t&&function({matchUpStatus:l}){return Xce.includes(l)}({matchUpStatus:t})&&![Mi,Li,Kc].includes(t)}const wI="SINGLES",vr="SINGLES",ey="DOUBLES",Pn="DOUBLES",Ad="TEAM",gn="TEAM";function gk(t){var e;const{sides:i,matchUpType:n}=t||{},r=(e=t.potentialParticipants)!=null&&e.length?t.potentialParticipants.flat().map(a=>n===Pn?(a==null?void 0:a.individualParticipantIds)||[]:a.participantId).flat():[],o=(i||[]).map(a=>{var s;return n===Pn&&(((s=a==null?void 0:a.participant)==null?void 0:s.individualParticipantIds)||[])||(a==null?void 0:a.participantId)&&[a.participantId]||[]}).flat();return{individualParticipantIds:o.concat(r).flat(),enteredIndividualParticipantIds:o,potentialIndividualParticipantIds:r}}function Vu(t){return(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{}}const vk="SIGN_IN_STATUS",Oke="SIGNED_OUT",PR="SIGNED_IN",il="TEAM",ui="INDIVIDUAL",gl="GROUP",qt="PAIR",on="TEAM",LE={TEAM_PARTICIPANT:il,INDIVIDUAL:ui,GROUP:gl,TEAM:on,PAIR:qt};function EW({participantsProfile:t,participants:e=[],deepCopy:i}){const n=new Map,r=i!==!1?ft(e,t==null?void 0:t.convertExtensions,!0):e,o=r.filter(l=>l.participantType===on),a=r.filter(l=>l.participantType===gl),s=r.filter(l=>l.participantType===qt);return r.forEach(l=>{if(l.participantType===ui){const{participantId:c}=l;l.groupParticipantIds=[],l.teamParticipantIds=[],l.pairParticipantIds=[],l.groups=[],l.teams=[],o.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{var p;d!==c||(p=l.teamParticipantIds)!=null&&p.includes(u.participantId)||(l.teamParticipantIds.push(u.participantId),n.get(u.participantId)||n.set(u.participantId,{participantName:u.participantName,participantId:u.participantId}),l.teams.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId,teamId:u.teamId}))})}),s.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d!==c||l.pairParticipantIds.includes(u.participantId)||l.pairParticipantIds.push(u.participantId)})}),a.forEach(u=>{((u==null?void 0:u.individualParticipantIds)||[]).forEach(d=>{d!==c||l.groupParticipantIds.includes(u.participantId)||(l.groupParticipantIds.push(u.participantId),l.groups.push({participantRoleResponsibilities:u.participantRoleResponsibilities,participantOtherName:u.participantOtherName,participantName:u.participantName,participantId:u.participantId}))})})}}),{participantsWithGroupings:r,groupInfo:Object.fromEntries(n)}}function Sue({groupedOrder:t,roundPositionsCount:e}){if(!t||(t==null?void 0:t.length)<=e)return t;const i=Kr(t,t.length/e).map(r=>r.reduce((o,a)=>o+a)),n=i.slice().sort(Sr);return i.map(r=>n.indexOf(r)+1)}function ZO({sourceRoundMatchUpCount:t,inContextDrawMatchUps:e,sourceRoundPosition:i,drawDefinition:n,targetLink:r}){var o;if(!r)return{error:Jle};const{target:{structureId:a,feedProfile:s,groupedOrder:l,roundNumber:c,positionInterleave:u}}=r,{structure:d}=kt({drawDefinition:n,structureId:a}),{positionAssignments:p}=Ki({structure:d}),h=e==null?void 0:e.filter(C=>C.structureId===(d==null?void 0:d.structureId)),f=h.filter(C=>C.roundNumber===c&&!C.matchUpTieId),m=f.length,g=nt(1,m+1),v=m/t;let y=Math.ceil(v*i),b=1-i%2;if(u!=null&&u.interleave&&v!==.5){const C=i+(u.offset+(i-1)*u.interleave);y=Math.ceil(C/2),b=1-C%2}let I=g,T=g[y-1];const S=Sue({groupedOrder:l,roundPositionsCount:g.length}),w=(S==null?void 0:S.length)||1;if(w<=g.length){const C=Kr(g,m/w);s===nf&&C.forEach(M=>M.reverse()),I=(S==null?void 0:S.length)&&(S==null?void 0:S.map(M=>C[M-1]).flat())||I}s===_l?T=I[y-1]:s===nf?((!(S!=null&&S.length)||w>g.length)&&(y=f.length+1-y),T=I[y-1]):s===hk&&Wl()&&console.log(eW,{feedProfile:s});const U=T&&f.reduce((C,M)=>M.roundPosition===T?M:C,void 0);let D;U!=null&&U.feedRound?(b=0,D=Math.min(...(U.drawPositions||[]).filter(Boolean))):D=((o=U==null?void 0:U.drawPositions)==null?void 0:o.length)===2&&(U==null?void 0:U.drawPositions[b]);const E=p==null?void 0:p.find(({drawPosition:C})=>C===D);if(E){const{extension:C}=ei({element:E,name:ck});if(C!=null&&C.value)return{disabledDrawPosition:D}}return{matchUp:U,targetDrawPosition:D,matchUpDrawPositionIndex:b}}function XO({finishingPositions:t,linkCondition:e,linkType:i,source:n}){var r;const o=n.find(a=>{var s,l;const c=!((s=a.source)!=null&&s.finishingPositions)||!t||ua(t,(l=a.source)==null?void 0:l.finishingPositions);return e===a.linkCondition&&c&&a.linkType===i});return[Rp,Ed].includes(o==null?void 0:o.linkType)&&!((r=o==null?void 0:o.source)!=null&&r.roundNumber)?ce({result:{error:Re},stack:"getTargetLink",context:o}):o}function j0({drawDefinition:t,structureId:e,roundNumber:i}){return t?e?{links:(t.links||[]).filter(Boolean).reduce((n,r)=>{var o,a;return((o=r.source)==null?void 0:o.structureId)!==e||i&&r.source.roundNumber!==i||(n.source=n.source.concat(r)),((a=r.target)==null?void 0:a.structureId)!==e||i&&r.target.roundNumber!==i||(n.target=n.target.concat(r)),n},{source:[],target:[]})}:{error:Va}:{error:rt}}function pa({inContextDrawMatchUps:t=[],useTargetMatchUpIds:e,inContextMatchUp:i,drawDefinition:n,matchUpId:r}){let o=i;t.length&&!o&&(o=t.find(s=>s.matchUpId===r));const{structure:a}=kt({structureId:o==null?void 0:o.structureId,drawDefinition:n});return(a==null?void 0:a.finishingPosition)===Ky?function({inContextDrawMatchUps:s,useTargetMatchUpIds:l,drawDefinition:c,structure:u,matchUp:d}){var p,h,f;const{winnerMatchUpId:m,loserMatchUpId:g}=d,{links:v}=function({drawDefinition:V,roundNumber:H,structureId:z}){if(!V)return{error:rt};if(!z)return{error:Va};const{links:G}=j0({drawDefinition:V,structureId:z});return{links:{source:G.source.reduce((W,K)=>K.source.roundNumber&&K.source.roundNumber!==H?W:W.concat(K),[]),target:G.target.reduce((W,K)=>K.target.roundNumber&&K.target.roundNumber!==H?W:W.concat(K),[])}}}({roundNumber:d.roundNumber,structureId:u.structureId,drawDefinition:c}),y=v==null?void 0:v.source,b=XO({source:y,linkType:Rp}),I=XO({linkCondition:Md,linkType:Ed,source:y});let T=XO({source:y,linkType:Ed});const S=I&&T;T||(T=I);const w=(p=b==null?void 0:b.target)==null?void 0:p.feedProfile,U=(h=T==null?void 0:T.target)==null?void 0:h.feedProfile,D=(f=I==null?void 0:I.target)==null?void 0:f.feedProfile;let E,C,M,N,R,A,_,k,O,F;if(l&&(m||g)&&(_=m&&w!==Ic&&s.find(({matchUpId:V})=>V===m),N=g&&U!==Ic&&s.find(({matchUpId:V})=>V===g),_||N))return{matchUp:d,targetLinks:{loserTargetLink:T,winnerTargetLink:b},targetMatchUps:{loserMatchUp:N,winnerMatchUp:_}};const{roundPosition:B}=d;F=F||s.filter(V=>V.structureId===u.structureId);const $=F.reduce((V,H)=>H.roundNumber!==d.roundNumber||H.matchUpTieId?V:V+1,0);return T&&!N&&U!==Ic&&({matchUpDrawPositionIndex:A,targetDrawPosition:R,matchUp:N}=ZO({targetLink:T,sourceRoundMatchUpCount:$,inContextDrawMatchUps:s,sourceRoundPosition:B,drawDefinition:c})),S&&D!==Ic&&({matchUpDrawPositionIndex:M,targetDrawPosition:C,matchUp:E}=ZO({targetLink:I,sourceRoundMatchUpCount:$,inContextDrawMatchUps:s,sourceRoundPosition:B,drawDefinition:c})),b&&!_&&w!==Ic&&({matchUpDrawPositionIndex:O,targetDrawPosition:k,matchUp:_}=ZO({targetLink:b,sourceRoundMatchUpCount:$,inContextDrawMatchUps:s,sourceRoundPosition:B,drawDefinition:c})),_||(F=F||s.filter(V=>V.structureId===u.structureId),{matchUp:_}=function({structureMatchUps:V,matchUp:H}){const{roundNumber:z,roundPosition:G}=H,W=V.filter(Z=>Z.roundNumber===z&&!Z.matchUpTieId),K=V.filter(Z=>Z.roundNumber===z+1&&!Z.matchUpTieId);if(K.length){let Z;return K.length===W.length?Z=K.find(Y=>Y.roundPosition===G):K.length===W.length/2&&(Z=K.find(Y=>Y.roundPosition===Math.ceil(G/2))),{matchUp:Z}}return{message:"no progression found"}}({structureMatchUps:F,matchUp:d})),It({matchUp:d,targetLinks:{loserTargetLink:T,winnerTargetLink:b,byeTargetLink:I},targetMatchUps:{winnerMatchUpDrawPositionIndex:O,loserMatchUpDrawPositionIndex:A,byeMatchUpDrawPositionIndex:M,winnerTargetDrawPosition:k,loserTargetDrawPosition:R,byeTargetDrawPosition:C,winnerMatchUp:_,loserMatchUp:N,byeMatchUp:E},targetMatchUpIds:!(!m&&!g)})}({inContextDrawMatchUps:t,useTargetMatchUpIds:e,drawDefinition:n,structure:a,matchUp:o}):function({matchUp:s}){return{targetLinks:{loserTargetLink:void 0,winnerTargetLink:void 0},targetMatchUps:{loserMatchUp:void 0,winnerMatchUp:void 0},matchUp:s}}({matchUp:o})}function yk(t){if(!bn(t))return!1;const{matchUpId:e,drawPositions:i}=t,n=typeof e=="string",r=!i||Array.isArray(i)&&i.length<=2&&i.every(o=>$t(o)||o==null);return n&&r}function vl(t){return!!Array.isArray(t)&&t.every(yk)}function ba({matchUps:t=[],interpolate:e}){var i;if(!vl(t))return{roundMatchUps:[],error:Re};const n=t.reduce((p,h)=>{const f=typeof h.roundNumber=="string"?Ct(h.roundNumber):h.roundNumber;return!h.roundNumber||p.includes(f)?p:p.concat(f)},[]).sort(Sr).map(p=>{const h=t.filter(g=>g.roundNumber===p),f=h.find(({matchUpType:g})=>g===gn)?h.filter(({matchUpType:g})=>g===gn):h;return{[p]:(m=f,m.sort((g,v)=>Sr(g.roundPosition,v.roundPosition)))};var m}),r=t.reduce((p,h)=>{const f=typeof h.roundNumber=="string"?Ct(h.roundNumber):h.roundNumber;return p[f]||(p[f]=It({abbreviatedRoundName:h.abbreviatedRoundName,finishingRound:h.finishingRound,roundName:h.roundName})),p},{}),o=Object.assign({},...n);if(e){const p=Math.max(...Object.keys(o).map(f=>Ct(f)).filter(f=>!isNaN(f))),h=(i=o[p])==null?void 0:i.length;if(h>1&&Lc(h)){const f=p+1;nt(f,f+h/2).forEach((m,g)=>{o[m]=nt(0,h/(2+2*g)).map(()=>({}))})}}let a=0;const s=Object.assign({},...Object.keys(o).map(p=>{var h,f,m;const g=(h=o[p])==null?void 0:h.length,v=(m=(f=o[p])==null?void 0:f.filter(b=>{var I;return!no.includes(b.matchUpStatus)&&!((I=b.score)!=null&&I.scoreStringSide1)}))==null?void 0:m.length,y=g&&g===v;return a=Math.max(a,g),{[p]:{matchUpsCount:g,inactiveCount:v,inactiveRound:y}}}));let l=0,c=0;const u=Object.keys(o).map(p=>Ct(p)).filter(p=>!isNaN(p));u.forEach(p=>{var h,f,m,g,v;const y=o[p].sort((I,T)=>I.roundPosition-T.roundPosition),b=y.map(I=>(I==null?void 0:I.drawPositions)||[]).flat();if(s[p].roundNumber=p,s[p].roundFactor=s[p].matchUpsCount?a/s[p].matchUpsCount:1,s[p].finishingRound=(h=r[p])==null?void 0:h.finishingRound,s[p].roundName=(f=r[p])==null?void 0:f.roundName,s[p].abbreviatedRoundName=(m=r[p])==null?void 0:m.abbreviatedRoundName,s[p].finishingPositionRange=(v=(g=o[p])==null?void 0:g[0])==null?void 0:v.finishingPositionRange,p!==1&&s[p-1]){const I=s[p-1],T=I.drawPositions,S=I.matchUpsCount/s[p].matchUpsCount,w=Kr(T,S),U=y.map(D=>{const{roundPosition:E}=D,C=[...D.drawPositions||[],void 0,void 0].slice(0,2);if(!E)return C;const M=(C==null?void 0:C.filter(Boolean))||[];if(!(M!=null&&M.length))return[void 0,void 0];if(p<3&&(M==null?void 0:M.length)===2)return C==null?void 0:C.slice().sort(Sr);const N=sr(T,M).length!==(M==null?void 0:M.length);if(M!=null&&M.length&&N)return(M==null?void 0:M.length)===1?[M[0],void 0]:C==null?void 0:C.slice().sort(Sr);const R=2*(E-1);return w.slice(R,R+2).map(A=>M==null?void 0:M.find(_=>A.includes(_)))});s[p].drawPositions=U==null?void 0:U.flat(),s[p].pairedDrawPositions=U}else{const I=b.sort(Sr),T=Kr(I,2);s[p].drawPositions=I,s[p].pairedDrawPositions=T}s[p+1]&&s[p+1].matchUpsCount===s[p].matchUpsCount&&(s[p+1].feedRound=!0,s[p+1].feedRoundIndex=c,s[p].preFeedRound=!0,c+=1),s[p]&&!s[p].feedRound&&(s[p].roundIndex=l,l+=1)});const d=!!Object.values(s).find(({matchUpsCount:p})=>!Lc(p));return{hasNoRoundPositions:t.some(p=>!p.roundPosition),roundsNotPowerOf2:d,maxMatchUpsCount:a,roundMatchUps:o,roundNumbers:u,roundProfile:s,...le}}function Lke({drawDefinition:t,inContextDrawMatchUps:e}){const i={};return e.forEach(n=>{var r,o,a,s,l,c;const{matchUpId:u,structureId:d,drawPositions:p=[]}=n,{structure:h}=kt({drawDefinition:t,structureId:d});if((h==null?void 0:h.finishingPosition)===$0){const{roundNumber:m}=n,g=m&&Ct(m)+1,v=h.matchUps??[],{roundMatchUps:y}=ba({matchUps:v});if(g&&y!=null&&y[g]){const b=[...p].sort(Sr).map((I,T)=>{const S=y[g].find(w=>{var U;return(U=w.drawPositions)==null?void 0:U.includes(I)});return{matchUpId:S==null?void 0:S.matchUpId,roundNumber:g,schedule:S==null?void 0:S.schedule,sideNumber:T+1,structureName:h.structureName}});Object.assign(n,{sidesTo:b})}}else{const m=pa({useTargetMatchUpIds:!0,inContextDrawMatchUps:e,inContextMatchUp:n,drawDefinition:t,matchUpId:u});let{winnerMatchUp:g}=m.targetMatchUps;const{loserMatchUp:v}=m.targetMatchUps;!n.winnerMatchUpId&&g&&(n.winnerMatchUpId=g.matchUpId),!n.loserMatchUpId&&v&&(n.loserMatchUpId=v.matchUpId);const y=JO({upcomingMatchUp:g});let b=JO({upcomingMatchUp:v});if(n.matchUpStatus!==Ri&&(v==null?void 0:v.matchUpStatus)===Ri){const{matchUp:T}=Tue({matchUp:v,drawDefinition:t,inContextDrawMatchUps:e})||{};b=T&&JO({upcomingMatchUp:T})||b}const I=(r=n.schedule)==null?void 0:r.timeAfterRecovery;if(I&&((o=y==null?void 0:y.schedule)!=null&&o.scheduledTime&&gi(y.schedule.scheduledTime)<gi(I)&&(i[y.matchUpId]=n.matchUpId,y.schedule.scheduleConflict=n.matchUpId),(a=b==null?void 0:b.schedule)!=null&&a.scheduledTime&&gi(b.schedule.scheduledTime)<gi(I)&&(i[b.matchUpId]=n.matchUpId,b.schedule.scheduleConflict=n.matchUpId)),Object.assign(n,{winnerTo:y,loserTo:b}),(s=n.drawPositions)==null?void 0:s.filter(Boolean).length){const T=(l=m.targetLinks)==null?void 0:l.loserTargetLink,S=(T==null?void 0:T.linkCondition)===Md,w=(f=n,((c=f==null?void 0:f.sides)==null?void 0:c.map(({participant:U,participantId:D,qualifier:E})=>U||D&&{participantId:D}||E&&{qualifier:E}).filter(Boolean))||[]);if(w.length){const U=j2(g==null?void 0:g.sides),D=j2(v==null?void 0:v.sides),E=w.find(({participantId:M})=>U.includes(M))?[]:w,C=w.find(({participantId:M})=>D.includes(M))?[]:w;v&&S&&C.length<2&&C.push({bye:!0,tbd:!0}),E!=null&&E.length&&g&&(!m.targetMatchUpIds&&g&&(g=e.find(({matchUpId:M})=>M===g.matchUpId)),g.potentialParticipants||(g.potentialParticipants=[]),g.potentialParticipants.push(E)),C!=null&&C.length&&v&&(m.targetMatchUpIds||(g=e.find(({matchUpId:M})=>M===v.matchUpId)),v.potentialParticipants||(v.potentialParticipants=[]),v.potentialParticipants.push(C))}}}var f}),Object.keys(i).length&&e.forEach(n=>{Object.keys(i).includes(n.matchUpId)&&(n.schedule.scheduleConflict=i[n.matchUpId])}),{scheduleConflictMatchUpIds:i}}function Tue({matchUp:t,drawDefinition:e,inContextDrawMatchUps:i}){const{matchUpId:n,matchUpStatus:r,structureId:o}=t||{};if(!t||!o||(t==null?void 0:t.matchUpStatus)===qn)return{matchUp:t};if(r===Ri){let a;if(t.winnerMatchUpId)a=i.find(({matchUpId:s})=>s===t.winnerMatchUpId);else{const s=pa({inContextDrawMatchUps:i,drawDefinition:e,matchUpId:n});({winnerMatchUp:a}=(s==null?void 0:s.targetMatchUps)||{})}return Tue({matchUp:a,drawDefinition:e,inContextDrawMatchUps:i})}return{matchUp:void 0}}function JO(t){if(t!=null&&t.upcomingMatchUp)return(({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:o,structureName:a})=>({matchUpId:e,structureId:i,schedule:n,roundNumber:r,roundPosition:o,structureName:a}))(t.upcomingMatchUp)}function Gi({onlySpecifiedPolicyTypes:t=!1,policyTypes:e=[],tournamentRecord:i,drawDefinition:n,structure:r,event:o}){if(!Array.isArray(e))return{error:nce};const a={};return i&&s(i),o&&s(o),n&&s(n),r&&s(r),{appliedPolicies:a,...le};function s(l){var c;const u=l==null?void 0:l.extensions,d=(c=u==null?void 0:u.find(p=>p.name===fU))==null?void 0:c.value;if(d)for(const p of Object.keys(d))(t?e.includes(p):!e.length||e.includes(p))&&(a[p]=ft(d[p],!1,!0))}}function Zp({policyTypes:t=[],tournamentRecord:e,drawDefinition:i,structure:n,event:r}){if(!Array.isArray(t))return{error:nce};const{appliedPolicies:o}=Gi({tournamentRecord:e,drawDefinition:i,structure:n,event:r}),a={};for(const s of t){const l=o==null?void 0:o[s];l&&(a[s]=l)}return Object.keys(a).length?{policyDefinitions:a}:{info:uU.message}}const Uue="WALKOVER",x7="RETIRED",MW="COMPETITIVE",TU="ROUTINE",UU="DECISIVE",FE="winRatio",RW={[Rh]:{policyName:"Competitive Bands Default",profileBands:{[UU]:20,[TU]:50}}};function Xp({policyDefinitions:t,tournamentRecord:e,contextProfile:i,drawDefinition:n,event:r}){const o={policies:{}};if(!i)return o;const a=Zp({tournamentRecord:e,drawDefinition:n,event:r}).policyDefinitions;if(i.withCompetitiveness){const s=(t==null?void 0:t[Rh])??(a==null?void 0:a[Rh])??RW[Rh];o.policies[Rh]=s}return o}function Due({drawDefinition:t}){if(typeof t!="object")return{error:yI};const e={},{structures:i=[],links:n=[]}=t||{},r=i.reduce((a,s)=>{const{stage:l}=s;return a[l]?a[l].push(s):a[l]=[s],a},{});for(const a of Object.keys(r)){const s=r[a].find(({stageSequence:c})=>c===1);if(!s)continue;const{structureId:l}=s;o({aggregator:{},targetRound:0,exitProfiles:e,exitProfile:"0",structureId:l,stage:a})}return{exitProfiles:e};function o({exitProfiles:a,exitProfile:s,structureId:l,targetRound:c,aggregator:u,stage:d}){a[l]||(a[l]=[]),s==="0"&&[So,Vn].includes(d)||a[l].push(s);const p=n.filter(h=>h.source.structureId===l&&h.source.roundNumber>=c);for(const h of p){const f=h.source.roundNumber,m=h.target.roundNumber,g=h.target.structureId,v=i.find(b=>b.structureId===g).stage,y=[v,g,m,f].join("|");if(u[y])return;u[y]=!0,o({exitProfile:`${s}-${f}`,structureId:g,exitProfiles:a,targetRound:m,aggregator:u,stage:v})}}}function ma({drawDefinition:t,structure:e}){const i={},n=[];return((t==null?void 0:t.structures)??[e]).filter(r=>r&&typeof r=="object").forEach(r=>{if(!r)return;const{structureId:o,matchUps:a,structures:s}=r,l=Array.isArray(s);if(l)l&&s.forEach(c=>{const{structureName:u}=c,d=c.matchUps;i[c.structureId]={matchUps:d,itemStructureIds:[],structureName:u},d&&(n.push(...d),d.forEach(p=>{p.tieMatchUps&&n.push(...p.tieMatchUps)})),i[o]||(i[o]={itemStructureIds:[],matchUps:[]}),i[o].itemStructureIds||(i[o].itemStructureIds=[]),i[o].itemStructureIds.push(c.structureId)});else{const c=a;i[o]={matchUps:c,itemStructureIds:[]},c==null||c.forEach(u=>{n.push(u),u.tieMatchUps&&n.push(...u.tieMatchUps)})}}),{mappedMatchUps:i,drawMatchUps:n}}function dm({mappedMatchUps:t,matchUpsMap:e,structureId:i,inContext:n}){const r=(t=(e==null?void 0:e.mappedMatchUps)??t)[i],o=((r==null?void 0:r.itemStructureIds)||[]).map(a=>{const{matchUps:s,structureName:l}=t[a];return n?s.map(c=>Object.assign(ft(c,!0,!0),{containerStructureId:i,structureId:a,structureName:l})):s}).flat();return((r==null?void 0:r.matchUps)||[]).concat(...o)}function NW({drawDefinition:t,attributes:e}){let{extension:i}=ei({element:t,name:SR});const n=(i==null?void 0:i.value)||{};return e.forEach(r=>{Object.keys(r).forEach(o=>{n[o]?Object.assign(n[o],r[o]):n[o]=r[o]})}),i={name:SR,value:n},ak({drawDefinition:t,extension:i}),{entryProfile:n}}function DU({drawDefinition:t}){const{extension:e}=ei({element:t,name:SR});return{entryProfile:(e==null?void 0:e.value)||{}}}const Nc="ALTERNATE",bk="CONFIRMED",cl="DIRECT_ACCEPTANCE",Ik="FEED_IN",wk="JUNIOR_EXEMPT",Nh="LUCKY_LOSER",Sk="ORGANISER_ACCEPTANCE",Tk="QUALIFIER",Uk="SPECIAL_EXEMPT",Fc="UNGROUPED",ty="UNPAIRED",PU="WILDCARD",af="WITHDRAWN",QO=[bk,cl,wk,Sk,Uk],Fke=[Ik,Nh,Tk],Jy=[bk,cl,Ik,wk,Sk,Uk,PU],Zc=[bk,cl,wk,Nh,Tk,Sk,Uk,PU],Bke=[Nc,bk,cl,Ik,wk,Nh,Sk,Tk,"REGISTERED",Uk,Fc,ty,PU,af];function AW({stage:t,drawDefinition:e}){const{entryProfile:i}=DU({drawDefinition:e}),n=Object.keys(i).includes(t);return!n&&bW.includes(t)?(NW({drawDefinition:e,attributes:[{[t]:{drawSize:void 0,alternates:!0}}]}),!0):n}function z2({stage:t,drawDefinition:e,entryStatus:i}){return e.entries.reduce((n,r)=>r.entryStage===t&&r.entryStatus===i?n+1:n,0)}function Qy({provisionalPositioning:t,placementGroup:e,drawDefinition:i,stageSequence:n,entryStatuses:r,structureId:o,roundTarget:a,stages:s,stage:l}){var c;const u=((c=i.entries)==null?void 0:c.reduce((d,p)=>{var h,f;const m=(f=(h=ei({name:$u,element:p}))==null?void 0:h.extension)==null?void 0:f.value,g=l&&p.entryStage===l||(s==null?void 0:s.length)&&p.entryStage&&s.includes(p.entryStage),v=!r||p.entryStatus&&r.includes(p.entryStatus),y=p.entryStageSequence??1;return g&&(!n||y===n)&&v&&(!a||!m||a===m)?d.concat(p):d},[]))??[];if(o&&l===Vn){const{playoffEntries:d,error:p}=function({provisionalPositioning:h,drawDefinition:f,structureId:m}){const g=[],v=(f.links??[]).find(y=>y.linkType===Mp&&y.target.structureId===m);if(v){const{finishingPositions:y,structureId:b}=v.source,{structure:I}=kt({drawDefinition:f,structureId:b});(I==null?void 0:I.structureType)===na&&(I.structures??[]).forEach(T=>{const S=T.positionAssignments??[],{structureId:w}=T,U=w,D=Object.assign({},...S.map(N=>{var R;const{participantId:A}=N,_=(R=ei({element:N,name:tf}).extension)==null?void 0:R.value;return _&&A?{[A]:_}:void 0}).filter(Boolean)),E=Object.keys(D).reduce((N,R)=>{const A=D[R],_=A.groupOrder||h&&A.provisionalOrder;return N.includes(_)||N.push(_),N},[]),C=E.length===Object.keys(D).length,M=Object.keys(D).filter(N=>{const R=D[N],A=R.groupOrder||h&&R.provisionalOrder;return y==null?void 0:y.includes(A)});h&&!C||M.forEach(N=>{const R=D[N],{groupOrder:A,provisionalOrder:_,GEMscore:k}=R,O=A||h&&_,F=[...y??[]].sort(Sr).indexOf(O)+1;g.push({entryStage:Vn,entryStatus:Ik,placementGroup:F,groupingValue:U,participantId:N,GEMscore:k})})})}return{playoffEntries:g}}({provisionalPositioning:t,drawDefinition:i,structureId:o});return p&&console.log("playoff entries error"),(d!=null&&d.length?d:u).filter(h=>!e||h.placementGroup===e)}return u}function ul({provisionalPositioning:t,returnAllProxies:e,drawDefinition:i,structureId:n,structure:r}){var o;let a,s=[];r||({structure:r,error:a}=kt({drawDefinition:i,structureId:n}));const l=Ki({structure:r}).positionAssignments;if(a||!r)return{seedAssignments:[],error:Cn};n||(n=r.structureId);const{stage:c,stageSequence:u}=r,d=c===Vn&&i&&Qy({provisionalPositioning:t,drawDefinition:i,stageSequence:u,structureId:n,stage:c}),p=d?d.filter(f=>f.placementGroup===1).sort((f,m)=>(f.GEMscore<m.GEMscore?1:f.GEMscore>m.GEMscore&&-1)||0).map((f,m)=>{const g=m+1;return{participantId:f.participantId,seedValue:g,seedProxy:!0,seedNumber:g}}):[],h=p==null?void 0:p.slice(0,e?p.length:l.length/2);return h.length?s=h:r.seedAssignments?s=r.seedAssignments:a=i_e,{seedAssignments:s,stageSequence:u,seedLimit:r.seedLimit??((o=r==null?void 0:r.positionAssignments)==null?void 0:o.length),stage:c,error:a}}const $ke=(t,e)=>(t||0)+(e||0);function Pue(t,e){const i=Array.isArray(t)?t[0]:t;return isNaN(i)&&Uue||i<=e[UU]&&UU||i<=e[TU]&&TU||MW}function Cue({score:t}){const e=(t==null?void 0:t.sets)||[],i=e.reduce((r,o)=>(r[0]+=o.side1Score||0,r[1]+=o.side2Score||0,r),[0,0]),n=e.reduce((r,o)=>(r[0]+=o.side1TiebreakScore||0,r[1]+=o.side2TiebreakScore||0,r),[0,0]);return n.reduce($ke)&&(i[n[0]>n[1]?0:1]+=1),{sets:e,games:i,score:t}}function Vke(t){const e=Math.min(...t.games),i=Math.max(...t.games);return Math.round(e/i*100)}function Eue(t){return t.map(Vke).sort().map(e=>parseFloat(e.toFixed(2)))}function Tg({tournamentRecord:t,drawDefinition:e,policyType:i,structure:n,event:r}){if(!t)return{error:je};const{appliedPolicies:o}=Gi({tournamentRecord:t,drawDefinition:e,structure:n,event:r});return o!=null&&o[i]?{policy:o[i]}:{info:uU==null?void 0:uU.message}}function KP({tournamentRecord:t,profileBands:e,matchUp:i}){if(!i)return{error:Cs};const{score:n,winningSide:r}=i;if(!r)return{error:Re};const o=!e&&t&&Tg({policyType:Rh,tournamentRecord:t}).policy,a=e||(o==null?void 0:o.profileBands)||RW[Rh].profileBands,s=Eue([Cue({score:n})]),l=Pue(s,a),c=Array.isArray(s)?s[0]:s;return{...le,competitiveness:l,pctSpread:c}}function Mue({matchUp:t}){var e,i,n;if(!t)return{error:Cs};if(t&&!t.sides)return{error:ja};if(t&&!t.hasContext)return{error:Q_};const r=(e=t.sides??[])==null?void 0:e.map(l=>l==null?void 0:l.participantId).filter(Boolean),o=((i=t.sides)==null?void 0:i.filter(l=>{var c;return((c=l.participant)==null?void 0:c.participantType)===ui}).map(l=>l.participantId).filter(Boolean))??[],a=(((n=t.sides??[])==null?void 0:n.map(l=>{var c;return(c=l.participant)==null?void 0:c.individualParticipants}).filter(Boolean))??[]).map(l=>(l??[]).map(c=>c==null?void 0:c.participantId).filter(Boolean)),s=[...o,...a.flat()].filter(Boolean)??[];return{nestedIndividualParticipantIds:a,allRelevantParticipantIds:ti(s.concat(r)).filter(Boolean)??[],individualParticipantIds:s,sideParticipantIds:r,...le}}const W2="CHECK_IN",q2="CHECK_OUT",ZP="SCHEDULE.ASSIGNMENT.VENUE",sf="SCHEDULE.ALLOCATION.COURTS",iy="SCHEDULE.ASSIGNMENT.COURT",Rue="SCHEDULE.COURT.ORDER",XP="SCHEDULE.DATE",jke="SCHEDULE.ASSIGN.OFFICIAL",JP="SCHEDULE.TIME.SCHEDULED",ru="SCHEDULE.TIME.START",Oh="SCHEDULE.TIME.STOP",sp="SCHEDULE.TIME.RESUME",Lh="SCHEDULE.TIME.END",Nue="SCHEDULE.TIME.MODIFIERS",Hke="TO_BE_ANNOUNCED",Gke="NEXT_AVAILABLE",zke="FOLLOWED_BY",Wke="AFTER_REST",qke="RAIN_DELAY",O7=[Hke,Gke,zke,Wke,qke],Yke="SCALE",Kke="RATING",Zke="RANKING",Aue="SEEDING",eb="PUBLISH",ju="PUBLIC",tb="STATUS";function ib({matchUp:t}){if(!t)return{error:Cs};if(!t.hasContext)return{error:Q_};if(!t.sides||t.sides.filter(Boolean).length!==2)return{error:ja};const{nestedIndividualParticipantIds:e,allRelevantParticipantIds:i,sideParticipantIds:n}=Mue({matchUp:t}),r=(t.timeItems??[]).filter(s=>(s==null?void 0:s.itemType)&&[W2,q2].includes(s.itemType)).sort((s,l)=>(s.createdAt?new Date(s.createdAt).getTime():0)-(l.createdAt?new Date(l.createdAt).getTime():0)),o=r.map(s=>s.itemValue).filter(s=>r.filter(l=>(l==null?void 0:l.itemValue)===s).reverse()[0].itemType===W2);e==null||e.forEach((s,l)=>{const c=n==null?void 0:n[l],u=(s==null?void 0:s.length)&&s.every(d=>o.includes(d));c&&u&&!o.includes(c)&&o.push(c)}),n==null||n.forEach((s,l)=>{o.includes(s)&&((e==null?void 0:e[l])??[]).forEach(c=>{c&&!o.includes(c)&&o.push(c)})});const a=n==null?void 0:n.reduce((s,l)=>o.includes(l)&&s,!0);return{allRelevantParticipantIds:i,allParticipantsCheckedIn:a,checkedInParticipantIds:o,...le}}function oT(t){const{matchUpAverageTimes:e,matchUpFormat:i}=t||{},n=(e==null?void 0:e.map(({matchUpFormatCodes:a})=>a==null?void 0:a.filter(s=>s===i)).flat().filter(Boolean).sort((a,s)=>((a==null?void 0:a.length)||0)-((s==null?void 0:s.length)||0)))||[],r=n.includes(i)?i:n[0],o=e==null?void 0:e.find(({matchUpFormatCodes:a,averageTimes:s})=>(a==null?void 0:a.find(l=>r===l))&&s);return o==null?void 0:o.averageTimes}function aT(t){var e;const{matchUpRecoveryTimes:i,averageMinutes:n,matchUpFormat:r}=t||{};return(e=i==null?void 0:i.find(({matchUpFormatCodes:o,averageTimes:a,recoveryTimes:s})=>{if(a&&n){const{greaterThan:l=0,lessThan:c=360}=a;if(n>l&&n<c)return!0}return(o==null?void 0:o.find(l=>l===r))&&s}))==null?void 0:e.recoveryTimes}function L7({timesBlockArray:t,categoryName:e,categoryType:i}){return t.filter(n=>Array.isArray(n)).map(n=>n.sort((r,o)=>{var a,s;return(((a=o.categoryNames)==null?void 0:a.length)||0)-(((s=r.categoryNames)==null?void 0:s.length)||0)}).find(({categoryTypes:r,categoryNames:o})=>!(o!=null&&o.length)&&!(r!=null&&r.length)||(o==null?void 0:o.includes(e))||(r==null?void 0:r.includes(i)))).find(Boolean)}function QP({tournamentRecord:t,categoryName:e,categoryType:i,event:n}){var r,o,a,s;e=e??((r=n==null?void 0:n.category)==null?void 0:r.categoryName)??((o=n==null?void 0:n.category)==null?void 0:o.ageCategoryCode),i=i??((a=n==null?void 0:n.category)==null?void 0:a.categoryType)??((s=n==null?void 0:n.category)==null?void 0:s.subType);const{policy:l}=Tg({policyType:wg,tournamentRecord:t,event:n}),c=t?ei({element:t,name:Ep}).extension:void 0,u=c==null?void 0:c.value,d=n&&ei({name:Ep,element:n}).extension,p=d==null?void 0:d.value;return{scheduleTiming:{tournamentScheduling:u,eventScheduling:p,categoryName:e,categoryType:i,policy:l}}}const Np="SINGLES",fw="SINGLES",Bc="DOUBLES",Wm="DOUBLES",Yr="TEAM",$c="TEAM",Xke="DOUBLES_SINGLES",Jke="SINGLES_DOUBLES",gc="total",F7="participantConflict",jf="matchUpConflict",Qke="ISSUE_IDS",kg="CONFLICT",xg="WARNING",B7="ERROR",$7="ISSUE",eL="STATE";function eC({defaultAverageMinutes:t=90,defaultRecoveryMinutes:e=0,tournamentRecord:i,matchUpFormat:n,categoryName:r,categoryType:o,eventType:a,event:s}){if(!i)return{error:je};a=a??(s==null?void 0:s.eventType)??fw;const l={averageTimes:[{minutes:{default:t}}],recoveryTimes:[{minutes:{default:e}}]},{scheduleTiming:c}=QP({tournamentRecord:i,categoryName:r,categoryType:o,event:s});return Dk({eventType:a,timingDetails:{...c,matchUpFormat:n,categoryType:o,defaultTiming:l}})}function Dk({timingDetails:t,eventType:e}){const i=function({matchUpFormat:c,categoryName:u,categoryType:d,defaultTiming:p,tournamentScheduling:h,eventScheduling:f,policy:m}){var g;return L7({categoryName:u,categoryType:d,timesBlockArray:[(f==null?void 0:f.matchUpAverageTimes)&&oT({...f,matchUpFormat:c}),(h==null?void 0:h.matchUpAverageTimes)&&oT({...h,matchUpFormat:c}),(m==null?void 0:m.matchUpAverageTimes)&&oT({...m,matchUpFormat:c}),(g=m==null?void 0:m.defaultTimes)==null?void 0:g.averageTimes,p==null?void 0:p.averageTimes]})}(t),n=Object.keys((i==null?void 0:i.minutes)||{}),r=(i==null?void 0:i.minutes)&&((n==null?void 0:n.includes(e))&&i.minutes[e]||i.minutes.default),o=function({tournamentScheduling:c,eventScheduling:u,averageMinutes:d,defaultTiming:p,matchUpFormat:h,categoryName:f,categoryType:m,policy:g}){var v;return L7({categoryName:f,categoryType:m,timesBlockArray:[(u==null?void 0:u.matchUpRecoveryTimes)&&aT({...u,averageMinutes:d,matchUpFormat:h}),(c==null?void 0:c.matchUpRecoveryTimes)&&aT({...c,averageMinutes:d,matchUpFormat:h}),(g==null?void 0:g.matchUpRecoveryTimes)&&aT({...g,averageMinutes:d,matchUpFormat:h}),(v=g==null?void 0:g.defaultTimes)==null?void 0:v.recoveryTimes,p==null?void 0:p.recoveryTimes]})}({...t,averageMinutes:r}),a=Object.keys((o==null?void 0:o.minutes)||{}),s=(o==null?void 0:o.minutes)&&((a==null?void 0:a.includes(e))&&o.minutes[e]||o.minutes.default),l=e===fw?Jke:Xke;return{averageMinutes:r,recoveryMinutes:s,typeChangeRecoveryMinutes:(o==null?void 0:o.minutes)&&((a==null?void 0:a.includes(l))&&o.minutes[l]||s)}}function U1(t){return t.createdAt?new Date(t.createdAt).getTime():0}function Ug({visibilityThreshold:t,timeItems:e,itemType:i}){const n=e.filter(o=>o&&o.itemType===i&&(!t||U1(o)<new Date(t).getTime())).sort((o,a)=>U1(o)-U1(a)).pop(),r=n&&U1(n);return{itemValue:n==null?void 0:n.itemValue,timeStamp:r}}function Y2({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){const{itemValue:r,timeStamp:o}=Ug({timeItems:(n==null?void 0:n.timeItems)||[],itemType:JP,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{scheduledTime:r}:i}function qm({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){const{itemValue:r,timeStamp:o}=Ug({timeItems:(n==null?void 0:n.timeItems)||[],itemType:XP,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{scheduledDate:r}:i}function _ue({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){const{itemValue:r,timeStamp:o}=Ug({timeItems:(n==null?void 0:n.timeItems)||[],itemType:sf,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{allocatedCourts:ft(r,!1,!0)}:i}function kue({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){const{itemValue:r,timeStamp:o}=Ug({timeItems:(n==null?void 0:n.timeItems)||[],itemType:iy,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{courtId:r}:i}function xue({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){const{itemValue:r,timeStamp:o}=Ug({timeItems:(n==null?void 0:n.timeItems)||[],itemType:ZP,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{venueId:r}:i}function Hi(){const t=[];for(let o=0;o<256;o++)t[o]=(o<16?"0":"")+o.toString(16);const e=4294967295*Math.random()|0,i=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return t[255&e]+t[e>>8&255]+t[e>>16&255]+t[e>>24&255]+"-"+t[255&i]+t[i>>8&255]+"-"+t[i>>16&15|64]+t[i>>24&255]+"-"+t[63&n|128]+t[n>>8&255]+"-"+t[n>>16&255]+t[n>>24&255]+t[255&r]+t[r>>8&255]+t[r>>16&255]+t[r>>24&255]}function tC(t){const{disableNotice:e,venue:i,context:n}=t;if(typeof i!="object")return{error:Re};const r=Vu(t);let o;i.venueId||(i.venueId=Hi());for(const a of Object.values(r)){const s=exe({disableNotice:!0,tournamentRecord:a,context:n,venue:i});if(s!=null&&s.error)return s;o=s.venue}return e||bi({topic:lue,payload:{venue:i}}),It({...le,venue:o})}function exe({tournamentRecord:t,disableNotice:e,context:i,venue:n}){return t?n?(t.venues||(t.venues=[]),n.venueId||(n.venueId=Hi()),t.venues.reduce((r,o)=>r||o.venueId===n.venueId,void 0)?{error:L_e}:(i&&Ii({element:n,extension:{value:i,name:zce}}),t.venues.push(n),e||bi({payload:{venue:n,tournamentId:t.tournamentId},topic:lue}),{...le,venue:ft(n)})):{error:bt,info:"missing venue"}:{error:je}}function Jp({tournamentRecords:t,tournamentRecord:e,venueId:i}){if(!e)return{error:je};if(!i)return{error:Fm};const n=(e.venues??[]).reduce((r,o)=>o.venueId===i?o:r,void 0);if(!n&&t){const r=(WP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(const o of r){const a=Jp({tournamentRecord:t[o],venueId:i});if(a.success&&a.venue)return tC({tournamentRecord:e,venue:a.venue}),{...le,venue:n}}}return n?{...le,venue:n}:{error:_0}}function _W({convertExtensions:t,...e}){const{tournamentRecords:i,tournamentRecord:n,venueId:r}=e;return ft(Jp({tournamentRecords:i,tournamentRecord:n,venueId:r}),t,!0)}function nb({tournamentRecords:t,tournamentRecord:e,courtId:i}){if(!e)return{error:je};if(!i)return{error:N0};let n,r;if((e.venues??[]).forEach(o=>{(o.courts??[]).forEach(a=>{a.courtId===i&&(n=a,r=o)})}),n)return{...le,court:n,venue:r};if(t){const o=(WP({tournamentRecords:t}).linkedTournamentIds??[])[e.tournamentId];for(const a of o){const s=nb({tournamentRecord:t[a],courtId:i});if(s.success)return s.venue&&tC({tournamentRecord:e,venue:s.venue}),{...le,court:n,venue:r}}}return ce({result:{error:J_},stack:"findCourt"})}function Oue(t){return ft(nb(t),!1,!0)}function kW({tournamentRecord:t,internalUse:e,courtId:i}){if(!t)return{error:je};if(!i)return{error:N0};const n=nb({tournamentRecord:t,courtId:i});if(n.error)return n;const r=n.court&&(({altitude:o,courtId:a,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m})=>({altitude:o,courtId:a,courtName:s,courtDimensions:l,latitude:c,longitude:u,surfaceCategory:d,surfaceType:p,surfacedDate:h,pace:f,notes:m}))(n.court);return{...le,courtInfo:ft(r,!1,e)}}function CU({tournamentRecord:t,venueId:e}){var i;if(!t)return{error:je};if(!e)return{error:Fm};const n=Jp({tournamentRecord:t,venueId:e});if(n.error)return n;const r=(((i=n.venue)==null?void 0:i.courts)??[]).map(s=>(({courtInfo:l})=>({...l}))(kW({courtId:s.courtId,internalUse:!0,tournamentRecord:t}))),o=n.venue&&(({venueId:s,venueName:l,venueAbbreviation:c})=>({venueAbbreviation:c,venueName:l,venueId:s}))(n.venue),a=o&&{...o,courtsInfo:r};return{...le,venueData:ft(a,!1,!0)}}function xW({visibilityThreshold:t,timeStamp:e,schedule:i,matchUp:n}){const{itemValue:r,timeStamp:o}=Ug({timeItems:(n==null?void 0:n.timeItems)||[],itemType:Nue,visibilityThreshold:t});return!i||o&&e&&new Date(o).getTime()>new Date(e).getTime()?{timeModifiers:r}:i}function Og(t){if(Ece.test(t)){const e=oW();return new Date(`${e}T${t}`)}return new Date(t)}function txe(t){const e=(i,n=2)=>("00"+i).slice(-n);return e(t/36e5|0)+":"+e(t%36e5/6e4|0)+":"+e(t%6e4/1e3|0)}function Zn({event:t,eventId:e}){var i;if(!t)return{error:Fi};const n=ei({name:ql,element:t}),r=n==null?void 0:n.extension,o=e?ft(r==null?void 0:r.value,!1,!0):r==null?void 0:r.value;return e&&((i=t.drawDefinitions)==null||i.forEach(a=>{var s;(s=o==null?void 0:o.flights)==null||s.forEach(l=>{l.drawId===a.drawId&&Object.assign(l,{drawDefinition:a})})})),{flightProfile:o}}function us(t){const{tournamentRecord:e,eventId:i,drawId:n}=t,r="findEvent",o={},a=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},s=Object.values(a).map(({events:c,tournamentId:u})=>(c&&c.forEach(d=>{o[d.eventId]={tournamentId:u}}),c??[])).flat();let l;if(n){let c;const u=s.find(d=>{var p,h;const f=((d==null?void 0:d.drawDefinitions)??[]).find(m=>m.drawId===n);if(f)c=f,l=o[d.eventId].tournamentId;else{const m=d&&((p=Zn({event:d}))==null?void 0:p.flightProfile),g=(h=m==null?void 0:m.flights)==null?void 0:h.find(v=>v.drawId===n);if(g)return l=o[d.eventId].tournamentId,{entries:g.drawEntries,drawName:g.drawName,tournamentId:l,drawId:n}}return f});if(u)return{event:u,drawDefinition:c,tournamentId:l}}if(i){const c=s.find(u=>(u==null?void 0:u.eventId)===i);return c?(l=o[c.eventId].tournamentId,{event:c,drawDefinition:void 0,tournamentId:l}):{event:void 0,drawDefinition:void 0,...ce({result:{error:sl},stack:r})}}return{event:void 0,drawDefinition:void 0,...ce({result:{error:ml},context:{drawId:n,eventId:i},stack:r})}}function Pk(t){var e,i,n,r,o,a,s,l;let c=t.event,u=t.matchUpType;const{scheduleVisibilityFilters:d,afterRecoveryTimes:p,tournamentRecord:h,usePublishState:f,scheduleTiming:m,matchUpFormat:g,publishStatus:v,matchUp:y}=t;if(!y)return{error:Cs};if(p&&!y.matchUpType&&!t.matchUpType&&(c||h)&&y.drawId){let N=(e=c==null?void 0:c.drawDefinitions)==null?void 0:e.find(A=>A.drawId===y.drawId);!N&&h&&({drawDefinition:N,event:c}=us({tournamentRecord:h,drawId:y.drawId}));const R=y.structureId&&((i=N==null?void 0:N.structures)==null?void 0:i.find(({structureId:A})=>A===y.structureId));u=t.matchUpType||(R==null?void 0:R.matchUpType)||(N==null?void 0:N.matchUpType)||(c==null?void 0:c.eventType)!==Yr&&(c==null?void 0:c.eventType)}const{milliseconds:b,time:I}=function({matchUp:N}){if(!N)return{error:Cs};if(!N.timeItems)return{error:vce};const R=N.timeItems.filter(_=>[ru,Oh,sp,Lh].includes(_==null?void 0:_.itemType)).sort((_,k)=>Og(_.itemValue).getTime()-Og(k.itemValue).getTime()),A=R.reduce((_,k)=>{var O,F;let B;const $=(O=k==null?void 0:k.itemType)==null?void 0:O.split("."),V=`SCHEDULE.TIME.${((F=k==null?void 0:k.itemType)==null?void 0:F.startsWith("SCHEDULE.TIME"))&&$[2]}`;switch(V){case ru:B=0;break;case Lh:if(_.lastValue&&[ru,sp].includes(_.lastType)){const H=Og(k.itemValue).getTime()-Og(_.lastValue).getTime();B=_.milliseconds+H}else B=_.milliseconds;break;case Oh:if([ru,"SCHECULE.TIME.RESUME"].includes(_.lastType)){const H=Og(k.itemValue).getTime()-Og(_.lastValue).getTime();B=_.milliseconds+H}else B=_.milliseconds;break;default:B=_.milliseconds}return{milliseconds:B,lastType:V,lastValue:k.itemValue}},{milliseconds:0,lastType:void 0,lastValue:void 0});if([ru,sp].includes(A.lastType)){const _=new Date().getTime()-Og(A.lastValue).getTime();A.milliseconds+=_}return{milliseconds:A.milliseconds,time:txe(A.milliseconds),relevantTimeItems:R}}({matchUp:y}),{startTime:T}=function({matchUp:N}){const R=_=>_.createdAt?new Date(_.createdAt).getTime():0,A=((N==null?void 0:N.timeItems)||[]).reduce((_,k)=>{const O=k.itemType===ru&&k;return O&&(!_||R(O)<R(_))?O:_},void 0);return{startTime:A==null?void 0:A.itemValue}}({matchUp:y}),{endTime:S}=function({matchUp:N}){const R=_=>_.createdAt?new Date(_.createdAt).getTime():0,A=((N==null?void 0:N.timeItems)||[]).reduce((_,k)=>{const O=k.itemType===Lh&&k;return O&&(!_||R(O)>R(_))?O:_},void 0);return{endTime:A==null?void 0:A.itemValue}}({matchUp:y});let w;const{visibilityThreshold:U,eventIds:D,drawIds:E}=d??{};if(D&&!D.includes(y.eventId)||E&&!E.includes(y.drawId))w=It({milliseconds:b,startTime:T,endTime:S,time:I});else{const N={matchUp:y,visibilityThreshold:U},{allocatedCourts:R}=_ue(N),{scheduledTime:A}=Y2(N);let{scheduledDate:_}=qm(N);const{venueId:k}=xue(N),{courtId:O}=kue(N),{courtOrder:F}=function({visibilityThreshold:oe,timeStamp:ne,schedule:re,matchUp:me}){const{itemValue:he,timeStamp:be}=Ug({timeItems:(me==null?void 0:me.timeItems)||[],itemType:Rue,visibilityThreshold:oe});return!re||be&&ne&&new Date(be).getTime()>new Date(ne).getTime()?{courtOrder:he}:re}(N),{timeModifiers:B}=xW(N);let $,V,H,z,G;const W=y.matchUpType??u;if(m&&A&&p&&W){const oe={matchUpFormat:y.matchUpFormat??g,...m};({averageMinutes:V=0,recoveryMinutes:H=0,typeChangeRecoveryMinutes:z=0}=Dk({timingDetails:oe,eventType:W})),(V||H)&&($=S?Oa(mn(S),H):Oa(A,V+H)),z&&(G=S?Oa(mn(S),z):Oa(A,V+z))}!_&&A&&(_=zt(A));const K=hR({scheduledDate:_,scheduledTime:A}),Z={},Y=((n=h&&k&&CU({tournamentRecord:h,venueId:k}))==null?void 0:n.venueData)||{};k&&(Z[k]=Y);const{venueName:X,venueAbbreviation:Q,courtsInfo:te}=Y,J=O&&(te==null?void 0:te.find(oe=>oe.courtId===O)),ie=J==null?void 0:J.courtName;for(const oe of R||[]){if(!h)break;oe.venueId&&!Z[oe.venueid]&&(Z[oe.venueId]=(r=CU({venueId:oe.venueId,tournamentRecord:h}))==null?void 0:r.venueData);const ne=Z[oe.venueId];oe.venueName=ne==null?void 0:ne.venueName;const re=(o=ne==null?void 0:ne.courtsInfo)==null?void 0:o.find(me=>me.courtId===oe.courtId);oe.courtName=re==null?void 0:re.courtName}w=It({typeChangeTimeAfterRecovery:G,timeAfterRecovery:$,scheduledDate:_,scheduledTime:A,isoDateString:K,allocatedCourts:R,timeModifiers:B,venueAbbreviation:Q,venueName:X,venueId:k,courtOrder:F,courtName:ie,courtId:O,typeChangeRecoveryMinutes:z,recoveryMinutes:H,averageMinutes:V,milliseconds:b,startTime:T,endTime:S,time:I})}const{scheduledDate:C}=qm({matchUp:y}),{scheduledTime:M}=Y2({matchUp:y});if(f&&(a=v==null?void 0:v.displaySettings)!=null&&a.draws){const N=v.displaySettings.draws,R=(s=(N==null?void 0:N[y.drawId])??(N==null?void 0:N.default))==null?void 0:s.scheduleDetails;if(R){const A=(l=R.find(_=>{var k;return C&&((k=_.dates)==null?void 0:k.includes(C))})??R.find(_=>{var k;return!((k=_.dates)!=null&&k.length)}))==null?void 0:l.attributes;A&&(w=Kv({source:w,template:Object.assign({},...Object.keys(w).map(_=>({[_]:!0})),A)}))}}return{schedule:w,endDate:y.matchUpStatus&&no.includes(y.matchUpStatus)&&(zt(S)||zt(C)||zt(M))||void 0}}function wh(t){if(!t)return;const{tieFormatId:e,tieFormats:i}=t;return t.tieFormat?t.tieFormat:e&&Array.isArray(i)?i.find(n=>n.tieFormatId===e):void 0}function sT({item:t,drawDefinition:e,structure:i,event:n}){var r,o,a;if(t){if(t.tieFormat)return t.tieFormat;if(t.tieFormatId)return e.tieFormat?e.tieFormat:((r=e.tieFormats)==null?void 0:r.find(s=>t.tieFormatId===s.tieFormatId))||(n.tieFormat?n.tieFormat:(o=n.tieFormats)==null?void 0:o.find(s=>t.tieFormatId===s.tieFormatId));if(i.tieFormat)return i.tieFormat;if(i.tieFormatId){const s=(a=e.tieFormats)==null?void 0:a.find(l=>i.tieFormatId===l.tieFormatId);if(s)return s}}}function jo({drawDefinition:t,structure:e,matchUp:i,event:n}){return{tieFormat:sT({item:i,drawDefinition:t,structure:e,event:n})||sT({item:e,drawDefinition:t,structure:e,event:n})||wh(t)||wh(n)}}function D1(t){if(!Array.isArray(t))return"";const e=t.filter(ir);return e.length?ti([Math.min(...e),Math.max(...e)]).join("-"):""}const V7="timed",OW="NOAD",BE="SET",ixe={S:"normal",F:"final"};function Ga(t){if(typeof t=="string"){const e=t.startsWith("T")&&V7||t.startsWith(BE)&&BE||"";if(e===V7){const i=Fue(t);if(i)return{simplified:!0,setFormat:i,bestOf:1}}if(e===BE)return function(i){const n=i.split("-"),r=iC(n[0].slice(3)),o=r===1||r%2!=0?r:void 0,a=r!==1&&r%2==0?r:void 0,s=n&&j7(n[1]),l=n&&j7(n[2]),c=s&&s.timed||l&&l.timed,u=o&&o<6||c&&a,d=!n[2]||l,p=s,h=It({setFormat:s,exactly:a,bestOf:o});if(l&&(h.finalSetFormat=l),u&&p&&d)return h}(t)}}function j7(t){if((t==null?void 0:t[1])===":"){const e=t.split(":"),i=ixe[e[0]],n=e[1];if(i&&n){if(n.startsWith("TB")){const f=H7(n);return f!==!1&&(typeof f=="object"?{tiebreakSet:f}:void 0)}if(n.startsWith("T"))return Fue(n);const r=t.match(/^[FS]:(\d+)([A-Za-z]*)/),o=r&&Bue(r[2])||!1,a=!(r!=null&&r[2])||o,s=r?iC(r[1]):void 0,l=Lue(n),c=l!==!1,u=c&&l||s,d=H7(n.split("/")[1]),p=d!==!1,h={setTo:s};return o&&(h.NoAD=!0),d?(h.tiebreakFormat=d,h.tiebreakAt=u):h.noTiebreak=!0,s&&a&&p&&c&&h||!1}}}function Lue(t,e=!0){const i=(t==null?void 0:t.indexOf("@"))>0&&t.split("@");if(i)return(e?iC(i[1]):i[1])||!1}function H7(t){if(t){if(t.startsWith("TB")){const e=Lue(t,!1),i=t.match(/^TB(\d+)([A-Za-z]*)/),n=i==null?void 0:i[1],r=i&&Bue(i[2]),o=!(i!=null&&i[2])||r,a=iC(n);if(a&&o){const s={tiebreakTo:a};return e&&typeof e=="string"&&!$t(e)&&(s.modifier=e),r&&(s.NoAD=!0),s}return!1}return!1}}function Fue(t){var e;const i=t.slice(1),n=i.match(/^(\d+)(@?[A-Za-z]*)/),r=iC(n==null?void 0:n[1]);if(!r)return;const o={timed:!0,minutes:r},a=n==null?void 0:n[2],s=[void 0,"P","G"].includes(a);if(a&&!s){const l=(e=i.match(/^(\d+)(@)([A-Za-z]+)$/))==null?void 0:e[3];return l?(o.modifier=l,o):void 0}return a&&(o.based=n[2]),o}function Bue(t){return t&&t.indexOf(OW)>=0}function iC(t){return isNaN(Number(t))?0:Number(t)}function CR({collectionPosition:t,collectionId:e,lineUp:i}){let n=[];const r=[];if(i){const o=s=>s===void 0?-1:s,a=i.map(s=>{const{collectionAssignments:l,participantId:c}=s,u=l==null?void 0:l.find(d=>d.collectionPosition===t&&d.collectionId===e);return u&&{participantId:c,...u}}).filter(Boolean).sort((s,l)=>o(s.substitutionOrder)-o(l.substitutionOrder));for(const s of a){const{participantId:l,previousParticipantId:c,substitutionOrder:u}=s;n.includes(l)||(c&&r.push({previousParticipantId:c,substitutionOrder:u,participantId:l}),n=n.filter(d=>d!==c),n.push(l))}}return{assignedParticipantIds:n,substitutions:r}}function Kl({tournamentParticipants:t,tournamentRecord:e,participantIds:i}){const n="getPairedParticipant";if(!t&&!e)return{error:je};if(!Array.isArray(i)||i.length>2)return{error:Ec};if(!i.length)return ce({result:{error:Ig},stack:n});const r=(t=t??(e==null?void 0:e.participants)??[]).filter(s=>s.participantType===qt&&sr(i,s.individualParticipantIds).length===i.length&&s.individualParticipantIds.length===i.length),o=r[0];if(!o)return ce({result:{error:rr},stack:n});const a=ft(r.slice(1),!1,!0);return{participant:ft(o),duplicatedPairParticipants:a,...le}}function Ym({drawDefinition:t,participantId:e}){if(typeof t!="object")return{error:rt};if(typeof e!="string")return{error:Hr};const{extension:i}=ei({element:t,name:Cp});return{lineUp:((i==null?void 0:i.value)||{})[e]}}function LW({roundsNotPowerOf2:t,drawDefinition:e,structure:i,matchUps:n}){var r;if(!i)return!1;n=n??i.matchUps??[],t=t??ba({matchUps:n}).roundsNotPowerOf2;const o=!!((r=i.positionAssignments)!=null&&r.find(({drawPosition:a})=>a))||!!(n!=null&&n.find(({drawPositions:a})=>a==null?void 0:a.length));return(!(e!=null&&e.drawType)||e.drawType!==Gm)&&!(i!=null&&i.structures)&&t&&o}function Zl({drawDefinition:t,structure:e}){if(!e)return!1;const i=e.matchUps||e.roundMatchUps&&Object.values(e.roundMatchUps).flat(),n=i==null?void 0:i.find(o=>o==null?void 0:o.roundPosition),r=i==null?void 0:i.find(o=>{var a;return(a=o==null?void 0:o.drawPositions)==null?void 0:a.length});return!(e!=null&&e.structures||(e==null?void 0:e.stage)===qr||t!=null&&t.drawType&&t.drawType!==ll||n||r)}const FW={[hU]:{policyName:"Round Naming Default",namingConventions:{round:"Round",pre:"Pre"},qualifyingFinishMap:{1:"Final"},abbreviatedRoundNamingMap:{1:"F",2:"SF",4:"QF"},roundNamingMap:{1:"Final",2:"Semifinal",4:"Quarterfinal"},affixes:{roundNumber:"R",preFeedRound:"Q",preQualifying:"P"},stageConstants:{[ct]:"",[Vn]:"P",[St]:"Q",[So]:"C"}}};function Ck(t){var e;const i=Ln(t,[{[_f]:!0}]);if(i.error)return i;const n=t==null?void 0:t.matchUp;let r=n==null?void 0:n.matchUpType;if(!r&&(e=n==null?void 0:n.sides)!=null&&e.length){const o=n.sides.find(({participant:l})=>l),a=o==null?void 0:o.participant,s=a==null?void 0:a.participantType;r=s===ui&&vr||s===qt&&Pn||s===on&&on||void 0}return{matchUpType:r}}function ev(t){const{matchUps:e,isCollectionMatchUp:i,excludeMatchUpStatuses:n,matchUpStatuses:r,hasWinningSide:o,matchUpFormats:a,roundPositions:s,matchUpFormat:l,collectionIds:c,isMatchUpTie:u,roundNumbers:d,matchUpIds:p,roundNames:h,stageSequences:f,scheduledDates:m,scheduledDate:g,participantIds:v,processContext:y,tournamentIds:b,matchUpTypes:I,structureIds:T,readyToScore:S,courtIds:w,eventIds:U,venueIds:D,drawIds:E,stages:C,filterMatchUpIds:M=!0,filterMatchUpTypes:N=!0}=t,R=Array.isArray(v)?v.filter(Boolean):[],A=Array.isArray(r)?r.filter(Boolean):[],_=Array.isArray(n)?n.filter(Boolean):[],k=Array.isArray(C)?C.filter(Boolean):[],O=Array.isArray(f)?f.filter(Boolean):[],F=Array.isArray(c)?c.filter(Boolean):[],B=Array.isArray(h)?h.filter(Boolean):[],$=Array.isArray(d)?d.filter(Boolean):[],V=Array.isArray(s)?s.filter(Boolean):[],H=Array.isArray(p)&&M?p.filter(Boolean):[],z=Array.isArray(I)&&N?I.filter(Boolean):[],G=Array.isArray(w)?w.filter(Boolean):[],W=Array.isArray(D)?D.filter(Boolean):[],K=Array.isArray(a)&&a.filter(Boolean)||typeof l=="string"&&[l]||[],Z=Array.isArray(m)&&m.filter(Boolean)||typeof g=="string"&&g.length&&[g]||[],Y=Array.isArray(b)?b.filter(Boolean):[],X=Array.isArray(U)?U.filter(Boolean):[],Q=Array.isArray(E)?E.filter(Boolean):[],te=Array.isArray(T)?T.filter(Boolean):[];return e.filter(J=>{var ie;if(S&&J.matchUpType!==Ad&&!J.readyToScore||J.winningSide&&o&&![1,2].includes(J.winningSide)||u!==void 0&&(u&&!J.tieMatchUps||!u&&J.tieMatchUps)||i!==void 0&&(i&&!J.collectionId||!i&&J.collectionId)||k.length&&!k.includes(J.stage)||O.length&&!O.includes(J.stageSequence)||F.length&&(!J.collectionId||!F.includes(J.collectionId))||B.length&&(!J.roundName||!B.includes(J.roundName))||$.length&&(!J.roundNumber||!$.includes(J.roundNumber))||V.length&&(!J.roundPosition||!V.includes(J.roundPosition))||A.length&&(!J.matchUpStatus||!A.includes(J.matchUpStatus))||_.length&&J.matchUpStatus&&_.includes(J.matchUpStatus)||H.length&&!H.includes(J.matchUpId)||z.length&&(!J.matchUpType||!z.includes(J.matchUpType))||K.length&&(!J.matchUpFormat||!K.includes(J.matchUpFormat)))return!1;if(Z!=null&&Z.length){const{scheduledTime:oe}=Y2({matchUp:J}),{scheduledDate:ne}=qm({matchUp:J}),re=zt(oe)||ne;if(!Z.find(me=>Pd(me,re)))return!1}if(G.length){const{courtId:oe}=kue({matchUp:J}),{allocatedCourts:ne}=_ue({matchUp:J}),re=ne==null?void 0:ne.map(({courtId:me})=>me);if(!G.filter(Boolean).includes(oe)||re!=null&&re.includes(oe))return!1}if(W.length){const{venueId:oe}=xue({matchUp:J});if(!W.filter(Boolean).includes(oe))return!1}if(y){if(Y.length&&!Y.includes(J.tournamentId)||X.length&&!X.includes(J.eventId)||Q.length&&!Q.includes(J.drawId)||te.length&&!te.includes(J.structureId))return!1;if(R.length){const oe=((ie=J.sides)==null?void 0:ie.map(({participantId:ne})=>ne).filter(Boolean))??[];if(!R.some(ne=>oe.includes(ne)))return!1}}return!0})}function nxe({drawPositionCollectionAssignment:t,sideNumberCollectionAssignment:e,positionAssignments:i,displaySideNumber:n,seedAssignments:r,drawPosition:o,isFeedRound:a,sideNumber:s}){var l,c,u,d;const p=i.find(v=>v.drawPosition&&v.drawPosition===o),h=o&&t,f=s&&e,m=h?(l=h[o])==null?void 0:l.participantId:p==null?void 0:p.participantId,g=p?function({displaySideNumber:v,seedAssignments:y,participantId:b,assignment:I,sideNumber:T}){const S={drawPosition:I.drawPosition,displaySideNumber:v,sideNumber:T};if(b){const w=function({seedAssignments:U,participantId:D}){return U==null?void 0:U.find(E=>!E.seedProxy&&E.participantId===D)}({seedAssignments:y,participantId:b});Object.assign(S,w,{participantId:b})}else I.bye&&Object.assign(S,{bye:!0});return I.qualifier&&Object.assign(S,{qualifier:!0}),S}({displaySideNumber:n,seedAssignments:r,participantId:m,assignment:p,sideNumber:s}):{...f==null?void 0:f[s]};if(a&&(s===1?Object.assign(g,{participantFed:!0}):Object.assign(g,{participantAdvanced:!0})),o&&h){const v=(c=h[o])==null?void 0:c.teamParticipant,y=(u=h[o])==null?void 0:u.participant,b=(d=h[o])==null?void 0:d.substitutions;y&&(g.participant=y),b&&(g.substitutions=b),v&&(g.teamParticipant=v)}return g}const Ru="ANY",rn="MALE",is="MIXED",tv="OTHER",Dn="FEMALE",$ue={ANY:Ru,MALE:rn,FEMALE:Dn,MIXED:is,OTHER:tv};function zi({scheduleVisibilityFilters:t,tournamentAppliedPolicies:e,provisionalPositioning:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:a,seedAssignments:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,scheduleTiming:h,contextProfile:f,drawDefinition:m,publishStatus:g,context:v={},exitProfiles:y,matchUpsMap:b,structure:I,inContext:T,event:S}){var w,U,D,E,C;let M={},N={};if(n=n??(a==null?void 0:a.participants),!I)return{collectionPositionMatchUps:M,error:bg,roundMatchUps:N,matchUps:[]};const R=Array.isArray(d==null?void 0:d.eventIds)?d==null?void 0:d.eventIds.filter(Boolean):[],A=Array.isArray(d==null?void 0:d.structureIds)?d==null?void 0:d.structureIds.filter(Boolean):[],_=Array.isArray(d==null?void 0:d.drawIds)?d==null?void 0:d.drawIds.filter(Boolean):[],k=!(v!=null&&v.eventId)||!(R!=null&&R.length)&&!((w=c==null?void 0:c.eventIds)!=null&&w.filter(Boolean).length)||(R==null?void 0:R.includes(v.eventId))||((U=c==null?void 0:c.eventIds)==null?void 0:U.includes(v.eventId)),O=!(A!=null&&A.length)||A.includes(I.structureId),F=!m||!(_!=null&&_.length)||_.includes(m.drawId);if(!k||!O||!F)return{collectionPositionMatchUps:M,roundMatchUps:N,matchUps:[]};f&&!u&&(u=Xp({tournamentRecord:a,contextProfile:f,drawDefinition:m}));const{appliedPolicies:B}=Gi({drawDefinition:m}),$={...e,...B,...o},V=(D=$==null?void 0:$.scoring)==null?void 0:D.structures,H=I.stage&&(V==null?void 0:V.stage)&&(V==null?void 0:V.stage[I.stage]),z=I.stageSequence&&(H==null?void 0:H.stageSequence)&&H.stageSequence[I.stageSequence],G=((E=$==null?void 0:$.scoring)==null?void 0:E.requireAllPositionsAssigned)||(H==null?void 0:H.requireAllPositionsAssigned)||(z==null?void 0:z.requireAllPositionsAssigned);b||(b=ma({drawDefinition:m,structure:I}));const{positionAssignments:W,allPositionsAssigned:K}=Lr({structure:I}),Z=!G||K,{seedAssignments:Y}=ul({provisionalPositioning:i,drawDefinition:m,structure:I});s=s??Y;const{roundOffset:X,structureId:Q,structureName:te,stage:J,stageSequence:ie}=I,{drawId:oe,drawName:ne,drawType:re}=m??{};y=y||m&&Due({drawDefinition:m}).exitProfiles;const me=y==null?void 0:y[Q],he=(me==null?void 0:me.length)&&(me[0].split("-").map(ve=>parseInt(ve)).reduce((ve,ke)=>ve+ke)||0),be=!!I.structures;let Se=dm({matchUpsMap:b,structureId:Q,inContext:T});const De=$==null?void 0:$[hU],Oe=function({roundNamingPolicy:ve,drawDefinition:ke,structure:ye,matchUps:Ie}){var Ne,Fe,Le;const{roundProfile:ge,roundMatchUps:Ee}=ba({matchUps:Ie}),{structureAbbreviation:we,stage:fe}=ye,Te=Zl({structure:ye}),ue=LW({structure:ye}),de=ye.structures,_e={},Ue=FW[hU],Ce=ye.stage===St,We=Ce?Math.max(...((ke==null?void 0:ke.structures)??[]).filter(ni=>ni.stage===St).map(({stageSequence:ni})=>ni??1),0):0,He=(ye.stageSequence??1)<We?ye.stageSequence??1:"",Be=He&&(((Ne=ve==null?void 0:ve.affixes)==null?void 0:Ne.preQualifying)||Ue.affixes.preQualifying)||"",et=(ve==null?void 0:ve.roundNamingMap)||Ue.roundNamingMap||{},ot=(ve==null?void 0:ve.abbreviatedRoundNamingMap)||Ue.abbreviatedRoundNamingMap||{},mt=((Fe=ve==null?void 0:ve.affixes)==null?void 0:Fe.preFeedRound)||Ue.affixes.preFeedRound,Rt=((Le=ve==null?void 0:ve.affixes)==null?void 0:Le.roundNumber)||Ue.affixes.roundNumber,Ft=((ve==null?void 0:ve.namingConventions)||Ue.namingConventions).round,Je=fe&&fe!==ct?fe[0]:"",_t=(ve==null?void 0:ve.stageConstants)||Ue.stageConstants,pt=`${Be}${fe&&(_t==null?void 0:_t[fe])||Je}${He}`,Ke=ge?Object.keys(ge):[],ci=Ce&&_t!=null&&_t[St]?`${_t==null?void 0:_t[St]}-`:"";if(de||Te||ue)Object.assign(_e,...Ke.map(ni=>({[ni]:{roundName:`${ci}${Ft} ${ni}`,abbreviatedRoundName:`${Rt}${ni}`}})));else{const ni=Ce&&((ve==null?void 0:ve.qualifyingFinishMap)||(Ue==null?void 0:Ue.qualifyingFinishMap)||{});Object.assign(_e,...Ke.map(Ht=>{if(!(ge!=null&&ge[Ht]))return;const{matchUpsCount:Zi,preFeedRound:Xi}=ge[Ht],wi=2*Zi,Ji=(ni==null?void 0:ni[ge==null?void 0:ge[Ht].finishingRound])||ni&&`${Rt}${wi}`||et[Zi]||`${Rt}${wi}`,Yt=Xi?`-${mt}`:"",_n=[pt,we,`${Ji}${Yt}`].filter(Boolean).join("-"),Gr=ot[Zi]||`${Rt}${wi}`;return{[Ht]:{abbreviatedRoundName:[pt,we,`${Gr}${Yt}`].filter(Boolean).join("-"),roundName:_n}}}))}return{roundNamingProfile:_e,roundProfile:ge,roundMatchUps:Ee}}({roundNamingPolicy:De,drawDefinition:m,structure:I,matchUps:Se}),{roundNamingProfile:xe,roundProfile:$e}=Oe;if(N=(Oe==null?void 0:Oe.roundMatchUps)??[],d&&(Se=ev({matchUps:Se,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),T){const{sourceDrawPositionRanges:ve}=function({drawDefinition:ye,structureId:Ie,matchUpsMap:Ne}){if(!ye)return{error:rt};if(!Ie)return{error:Va};const{structure:Fe}=kt({drawDefinition:ye,structureId:Ie});if((Fe==null?void 0:Fe.stage)!==So)return{error:Wy,info:"Structure is not CONSOLATION stage"};const{links:Le}=ye,ge=(Le==null?void 0:Le.filter(de=>de.target.structureId===Ie))||[],Ee=(ge==null?void 0:ge.reduce((de,_e)=>{const{structureId:Ue}=_e.source;return de.includes(Ue)?de:de.concat(Ue)},[]))||[],we=Object.assign({},...Ee.map(de=>({[de]:ba({matchUps:dm({structureId:de,matchUpsMap:Ne})}).roundProfile}))),fe=dm({matchUpsMap:Ne,structureId:Ie}),{roundProfile:Te}=ba({matchUps:fe}),ue={};return ge==null||ge.forEach(de=>{var _e;const{structureId:Ue,roundNumber:Ce}=de.source,{feedProfile:We,groupedOrder:He,positionInterleave:Be,roundNumber:et}=de.target,ot=we[Ue],mt=(_e=ot[1])==null?void 0:_e.drawPositions,Rt=ot[Ce],Ft=Rt==null?void 0:Rt.matchUpsCount;if(!Ft)return;const Je=Ft?mt.length/Ft:0,_t=mt.length/Je;let pt=mt.slice();const Ke=Sue({roundPositionsCount:pt.length,groupedOrder:He}),ci=(Ke==null?void 0:Ke.length)||1;if(ci<=_t){const Xi=Kr(pt,mt.length/ci);We===nf&&Xi.forEach(wi=>wi.reverse()),pt=(Ke==null?void 0:Ke.length)&&(Ke==null?void 0:Ke.map(wi=>Xi[wi-1]).flat())||pt}let ni=Kr(pt,Je);if(Ke!=null&&Ke.length||We!==nf||ni.reverse(),Be){const Xi=nt(0,Be.interleave).map(()=>{}),wi=nt(0,Be.offset).map(()=>{});ni=ni.map(Yt=>[Yt,...Xi]),ni.unshift(wi),ni=ni.flat(1);const Ji=ni.length-Be.offset;ni=ni.slice(0,Ji)}ue[et]||(ue[et]={});const Ht=Te==null?void 0:Te[et],Zi=Ht!=null&&Ht.feedRound?2:1;ni.forEach((Xi,wi)=>{const Ji=1+wi*Zi;ue[et][Ji]||(ue[et][Ji]=D1(Xi))})}),{sourceDrawPositionRanges:ue}}({drawDefinition:m,matchUpsMap:b,structureId:Q}),ke=m?function({drawDefinition:ye,roundProfile:Ie,structureId:Ne,matchUpsMap:Fe}){var Le;if(!ye)return{error:rt};if(!Ne)return{error:Va};if(!Ie){const we=dm({matchUpsMap:Fe,structureId:Ne});if({roundProfile:Ie}=ba({matchUps:we}),!Ie)return{error:bt}}const ge=(Math.min(...((Le=Ie==null?void 0:Ie[1])==null?void 0:Le.drawPositions)??[])||1)-1,Ee=Object.keys(Ie);return{drawPositionsRanges:Object.assign({},...(Ee||[]).map(we=>{var fe,Te;const ue=(fe=Ie==null?void 0:Ie[we])==null?void 0:fe.matchUpsCount,de=((Te=Ie==null?void 0:Ie[1])==null?void 0:Te.drawPositions)??[],_e=Kr(de,de.length/ue),Ue=_e.map(D1),Ce=_e.map(ot=>ot.map(mt=>mt-ge)).map(D1),We=Ee.map(ot=>{var mt;if(ot>we)return;const Rt=((mt=Ie==null?void 0:Ie[ot])==null?void 0:mt.drawPositions)??[];return Kr(Rt,Rt.length/ue)}).filter(Boolean),He=nt(0,ue).map(ot=>We.map(mt=>mt[ot]).flat().filter(Boolean).sort(Sr)).map(ot=>ti(ot)),Be=He.map(ot=>{return(mt=ot,mt.reduce((Rt,Ft)=>{const Je=Rt[Rt.length-1];return Je&&Je[Je.length-1]===Ft-1||Rt.push([]),Rt[Rt.length-1].push(Ft),Rt},[])).map(D1).join(", ");var mt}),et=Object.assign({},...nt(0,ue).map(ot=>({[ot+1]:{firstRoundDrawPositionsRange:Ue[ot],firstRoundOffsetDrawPositionsRange:Ce[ot],possibleDrawPositions:He[ot],drawPositionsRange:Be[ot]}})));return{[we]:et}}))}}({drawDefinition:m,roundProfile:$e,matchUpsMap:b,structureId:Q}).drawPositionsRanges:void 0;Se=Se.map(ye=>Ae({scheduleVisibilityFilters:t,sourceDrawPositionRanges:ve,drawPositionsRanges:ke,roundNamingProfile:xe,initialRoundOfPlay:he,appliedPolicies:$,usePublishState:l,publishStatus:g,isRoundRobin:be,roundProfile:$e,matchUp:ye,event:S})),(Se==null?void 0:Se.filter(ye=>Array.isArray(ye.tieMatchUps))).forEach(ye=>{const Ie=ye.tieMatchUps;Se=Se.concat(...Ie)}),c&&(Se=ev({processContext:!0,...c,matchUps:Se}))}else(Se==null?void 0:Se.filter(ve=>Array.isArray(ve.tieMatchUps))).forEach(ve=>{const ke=ve.tieMatchUps;Se=Se.concat(...ke)});return d&&(Se=ev({matchUps:Se,...d,filterMatchUpTypes:!1,filterMatchUpIds:!1})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds)&&(Se=ev({matchUpTypes:d.matchUpTypes,matchUpIds:d.matchUpIds,matchUps:Se})),(d!=null&&d.matchUpTypes||d!=null&&d.matchUpIds||T)&&(N=ba({matchUps:Se}).roundMatchUps??[]),(C=jo({drawDefinition:m,structure:I,event:S}))!=null&&C.tieFormat&&({collectionPositionMatchUps:M}=function({matchUps:ve}){const ke=ve.reduce((ye,Ie)=>!Ie.collectionPosition||ye.includes(Ie.collectionPosition)?ye:ye.concat(Ie.collectionPosition),[]).map(ye=>({[ye]:ve.filter(Ie=>Ie.collectionPosition===ye)}));return{collectionPositionMatchUps:Object.assign({},...ke)}}({matchUps:Se})),{collectionPositionMatchUps:M,roundMatchUps:N,roundProfile:$e,matchUpsMap:b,matchUps:Se};function Ae({scheduleVisibilityFilters:ve,sourceDrawPositionRanges:ke,drawPositionsRanges:ye,initialRoundOfPlay:Ie,additionalContext:Ne,roundNamingProfile:Fe,tieDrawPositions:Le,appliedPolicies:ge,isCollectionBye:Ee,usePublishState:we,publishStatus:fe,matchUpTieId:Te,isRoundRobin:ue,roundProfile:de,sideLineUps:_e,matchUp:Ue,event:Ce}){var We,He,Be,et,ot,mt,Rt,Ft,Je,_t,pt,Ke,ci,ni,Ht;Ne=Ne??{};const Zi=(We=jo({drawDefinition:m,structure:I,matchUp:Ue,event:Ce}))==null?void 0:We.tieFormat,Xi=Zi==null?void 0:Zi.collectionDefinitions,wi=Ue.collectionId&&(Xi==null?void 0:Xi.find(Xt=>Xt.collectionId===Ue.collectionId)),Ji=Ue.collectionId?wi==null?void 0:wi.matchUpFormat:Ue.matchUpFormat??(I==null?void 0:I.matchUpFormat)??(m==null?void 0:m.matchUpFormat)??(Ce==null?void 0:Ce.matchUpFormat),Yt=Ue.matchUpType||(wi==null?void 0:wi.matchUpType)||(I==null?void 0:I.matchUpType)||(m==null?void 0:m.matchUpType)||(Ce==null?void 0:Ce.eventType)!==Yr&&(Ce==null?void 0:Ce.eventType),_n=Ee?Ri:Ue.matchUpStatus,{schedule:Gr,endDate:qo}=Pk({scheduleVisibilityFilters:ve,afterRecoveryTimes:r,tournamentRecord:a,usePublishState:we,scheduleTiming:h,matchUpFormat:Ji,publishStatus:fe,matchUpType:Yt,matchUp:Ue,event:Ce}),Ea=Le??Ue.drawPositions??[],{collectionPosition:ga,collectionId:Ma,roundPosition:er}=Ue,Gt=Ue.roundNumber??Ne.roundNumber,Jc=Ma?function({tournamentParticipants:Xt,positionAssignments:yn,collectionPosition:at,drawPositions:Mt=[],participantMap:Kt,drawDefinition:Si,collectionId:Pt,sideLineUps:ri,matchUpType:br}){if(!Pt||!at)return{};const Bo=({attribute:_r,lineUp:Na,teamParticipant:zr})=>{var Ya,lc,cc;const{assignedParticipantIds:hs,substitutions:Bf}=CR({collectionPosition:at,collectionId:Pt,lineUp:Na});if(br!==Pn){const fs=hs==null?void 0:hs[0];return fs&&{[_r]:{participantId:fs,teamParticipant:zr,substitutions:Bf}}}if((hs==null?void 0:hs.length)<=2){const fs=(lc=(Ya=Kt==null?void 0:Kt[hs[0]])==null?void 0:Ya.pairIdMap)==null?void 0:lc[hs[1]],r1=fs&&((cc=Kt[fs])==null?void 0:cc.participant)||Kl({participantIds:hs,tournamentParticipants:Xt}).participant,xi=r1==null?void 0:r1.participantId;return{[_r]:{participantId:xi,teamParticipant:zr,substitutions:Bf}}}if((hs==null?void 0:hs.length)>2)return{[_r]:{teamParticipant:zr,substitutions:Bf}}};if(!(Mt!=null&&Mt.length)){const _r=(ri==null?void 0:ri.map(Na=>{var zr;const{teamParticipant:Ya,sideNumber:lc}=Na,cc=Na.lineUp||((zr=Ym({participantId:Ya.teamParticipantId,drawDefinition:Si}))==null?void 0:zr.lineUp);return Bo({attribute:lc,lineUp:cc,teamParticipant:Ya})}).filter(Boolean))||{};return{sideNumberCollectionAssignment:Object.assign({},..._r)}}const Ra=(Mt==null?void 0:Mt.map(_r=>{var Na,zr,Ya;const lc=(Na=yn.find(fs=>fs.drawPosition===_r))==null?void 0:Na.participantId,cc=ri==null?void 0:ri.find(fs=>(fs==null?void 0:fs.drawPosition)===_r),hs=(cc==null?void 0:cc.teamParticipant)||lc&&((zr=Kt==null?void 0:Kt[lc])==null?void 0:zr.participant)||(Xt==null?void 0:Xt.find(({participantId:fs})=>fs===lc)),Bf=(cc==null?void 0:cc.lineUp)||((Ya=Ym({participantId:lc,drawDefinition:Si}))==null?void 0:Ya.lineUp);return Bo({attribute:_r,lineUp:Bf,teamParticipant:hs})}).filter(Boolean))||{};return{drawPositionCollectionAssignment:Object.assign({},...Ra)}}({tournamentParticipants:n,positionAssignments:W,collectionPosition:ga,drawDefinition:m,participantMap:p,drawPositions:Ea,collectionId:Ma,sideLineUps:_e,matchUpType:Yt}):void 0,sc=((He=Fe==null?void 0:Fe[Gt])==null?void 0:He.roundName)||Ne.roundName,Ls=((Be=Fe==null?void 0:Fe[Gt])==null?void 0:Be.abbreviatedRoundName)||Ne.abbreviatedRoundName,Ze=(et=de==null?void 0:de[Gt])==null?void 0:et.feedRound,yt=(ot=de==null?void 0:de[Gt])==null?void 0:ot.preFeedRound,pi=(mt=de==null?void 0:de[Gt])==null?void 0:mt.roundFactor,cr=ye==null?void 0:ye[Gt],va=er?cr==null?void 0:cr[er]:void 0,Ur=ke==null?void 0:ke[Gt],tn=wi!=null&&wi.category?{...(v==null?void 0:v.category)||{},...wi.category}:(v==null?void 0:v.category)??(Ce==null?void 0:Ce.category),Xn=((Rt=Ue.processCodes)==null?void 0:Rt.length)&&Ue.processCodes||((Ft=wi==null?void 0:wi.processCodes)==null?void 0:Ft.length)&&(wi==null?void 0:wi.processCodes)||((Je=I==null?void 0:I.processCodes)==null?void 0:Je.length)&&(I==null?void 0:I.processCodes)||((_t=m==null?void 0:m.processCodes)==null?void 0:_t.length)&&(m==null?void 0:m.processCodes)||((pt=Ce==null?void 0:Ce.processCodes)==null?void 0:pt.length)&&(Ce==null?void 0:Ce.processCodes)||(a==null?void 0:a.processCodes),Do=(f==null?void 0:f.withCompetitiveness)&&KP({...u,matchUp:Ue}),Tl=Ue.finishingPositionRange??Ne.finishingPositionRange,qa=Xt=>It(Xt,void 0,!0),Qi={...qa(v),...qa({matchUpFormat:Ue.matchUpType===Yr?void 0:Ji,tieFormat:Ue.matchUpType!==Yr?void 0:Zi,gender:(wi==null?void 0:wi.gender)??(Ce==null?void 0:Ce.gender),roundOfPlay:J!==St&&$t(Ie)&&Ie+(Gt||0),endDate:Ue.endDate??qo,discipline:Ce==null?void 0:Ce.discipline,category:tn,finishingPositionRange:Tl,abbreviatedRoundName:Ls,drawPositionsRange:va,competitiveProfile:Do,structureName:te,stageSequence:ie,drawPositions:Ea,matchUpStatus:_n,processCodes:Xn,isRoundRobin:ue,matchUpTieId:Te,preFeedRound:yt,matchUpType:Yt,roundFactor:pi,roundOffset:X,structureId:Q,roundNumber:Gt,feedRound:Ze,roundName:sc,drawName:ne,drawType:re,schedule:Gr,drawId:oe,stage:J}),...ft(qa(Ue),!0,!0)};if(Ji&&(Ke=Ue.score)!=null&&Ke.scoreStringSide1){const Xt=Ga(Ji),{bestOf:yn,finalSetFormat:at,setFormat:Mt}=Xt??{};(at!=null&&at.tiebreakSet||Mt!=null&&Mt.tiebreakSet||Mt!=null&&Mt.timed)&&(Qi.score.sets=Qi.score.sets.sort((Kt,Si)=>Kt.setNumber-Si.setNumber).map((Kt,Si)=>(Si+1===yn?(at!=null&&at.tiebreakSet||at!=null&&at.timed)&&(Kt.tiebreakSet=!0):(Mt!=null&&Mt.tiebreakSet||Mt!=null&&Mt.timed)&&(Kt.tiebreakSet=!0),Kt)))}if(Array.isArray(Ea)){const{orderedDrawPositions:Xt,displayOrder:yn}=function({drawPositions:Si,roundProfile:Pt,roundNumber:ri}){const br=[void 0,void 0];if(qle(Si))return{orderedDrawPositions:br,displayOrder:br};const Bo=Pt==null?void 0:Pt[ri],Ra=Bo==null?void 0:Bo.pairedDrawPositions,_r=(Ra==null?void 0:Ra.find(zr=>ua(zr||[],Si.filter(Boolean))))??br,Na=Bo==null?void 0:Bo.feedRound;if(Wle(Si)){const zr=[...Si].sort(Sr);return{orderedDrawPositions:zr.length===2?zr:_r,displayOrder:Na?zr:_r}}if(Na){const zr=[Si.find(Ya=>!isNaN(Ct(Ya))),void 0];return{orderedDrawPositions:zr,displayOrder:zr}}return{orderedDrawPositions:_r,displayOrder:_r}}({drawPositions:Ea,roundProfile:de,roundNumber:Gt}),at=(ci=de==null?void 0:de[Gt])==null?void 0:ci.feedRound,Mt=yn[0]!==Xt[0],Kt=Xt.concat(void 0,void 0).slice(0,2).map((Si,Pt)=>{var ri;const br=Pt+1,Bo=nxe({...Jc,positionAssignments:W,displaySideNumber:Mt?3-br:br,seedAssignments:s,drawPosition:Si,isFeedRound:at,sideNumber:br}),Ra=(ri=Ue.sides)==null?void 0:ri.find(Na=>Na.sideNumber===br),_r=er?2*(er-1)+Pt+1:void 0;return qa({sourceDrawPositionRange:_r?Ur==null?void 0:Ur[_r]:void 0,...Ra,...Bo})});Object.assign(Qi,ft({sides:Kt},!0,!0))}if(n&&Qi.sides){const Xt=ge==null?void 0:ge[ok],yn=at=>{var Mt;const Kt=(Mt=p==null?void 0:p[at])==null?void 0:Mt.participant;return Kt&&Kv({template:Xt==null?void 0:Xt.participant,source:Kt})};if(Qi.sides.filter(Boolean).forEach(at=>{var Mt,Kt,Si;if(at.participantId){const Pt=ft(yn(at.participantId)||n&&ef({policyDefinitions:ge,participantId:at.participantId,tournamentParticipants:n,internalUse:!0,contextProfile:f}),void 0,!0);if(Pt){if(m!=null&&m.entries){const ri=m.entries.find(br=>br.participantId===at.participantId);ri!=null&&ri.entryStatus&&(Pt.entryStatus=ri.entryStatus),ri!=null&&ri.entryStage&&(Pt.entryStage=ri.entryStage)}Object.assign(at,{participant:Pt})}}if((Kt=(Mt=at==null?void 0:at.participant)==null?void 0:Mt.individualParticipantIds)!=null&&Kt.length&&!((Si=at.participant.individualParticipants)!=null&&Si.length)){const Pt=at.participant.individualParticipantIds.map(ri=>yn(ri)||n&&ef({policyDefinitions:ge,tournamentParticipants:n,internalUse:!0,contextProfile:f,participantId:ri}));Object.assign(at.participant,{individualParticipants:Pt})}}),!Qi.matchUpType){const{matchUpType:at}=Ck({matchUp:Qi});at&&Object.assign(Qi,{matchUpType:at})}if(f!=null&&f.inferGender&&(!Qi.gender||Qi.gender===is)&&((ni=Qi.sides)==null?void 0:ni.length)===2&&Qi.matchUpType!==Yr){const at=Qi.sides.map(Mt=>{var Kt,Si,Pt,ri;if(Qi.matchUpType===vr)return(Si=(Kt=Mt.participant)==null?void 0:Kt.person)==null?void 0:Si.sex;if(((ri=(Pt=Mt.participant)==null?void 0:Pt.individualParticipants)==null?void 0:ri.length)===2){const br=ti(Mt.participant.individualParticipants.map(Bo=>{var Ra;return(Ra=Bo.person)==null?void 0:Ra.sex})).filter(Boolean);if(br.length===1)return br[0]}});if(at.filter(Boolean).length===2&&ti(at).length===1){const Mt=at[0];Qi.inferredGender=Mt}}}if(Qi.tieMatchUps){const Xt=Qi.matchUpStatus===Ri,yn=(Ht=Qi.sides)==null?void 0:Ht.map(({participant:at,drawPosition:Mt,sideNumber:Kt,lineUp:Si})=>{const Pt=(at==null?void 0:at.participantType)===Yr&&at;return{teamParticipant:Pt&&It({participantRoleResponsibilities:Pt.participantRoleResponsibilities,participantOtherName:Pt.participanOthertName,participantName:Pt.participantName,participantId:Pt.participantId,teamId:Pt.teamId}),drawPosition:Mt,sideNumber:Kt,lineUp:Si}});Qi.tieMatchUps=Qi.tieMatchUps.map(at=>{const Mt=Qi.matchUpId,Kt=Qi.finishingPositionRange;return Ae({tieDrawPositions:Ea,scheduleVisibilityFilters:ve,sourceDrawPositionRanges:ke,sideLineUps:yn,drawPositionsRanges:ye,initialRoundOfPlay:Ie,roundNamingProfile:Fe,additionalContext:{finishingPositionRange:Kt,abbreviatedRoundName:Ls,roundNumber:Gt,roundName:sc},appliedPolicies:ge,isCollectionBye:Xt,usePublishState:we,publishStatus:fe,matchUpTieId:Mt,isRoundRobin:ue,roundProfile:de,matchUp:at,event:Ce})})}const hi=Qi.sides&&Qi.sides.filter(Xt=>Xt==null?void 0:Xt.participantId).length===2,ur=!Qi.winningSide;if(Object.assign(Qi,{readyToScore:Z&&hi&&ur,hasContext:!0}),hi){const{allParticipantsCheckedIn:Xt,checkedInParticipantIds:yn}=ib({matchUp:Qi});Object.assign(Qi,{allParticipantsCheckedIn:Xt,checkedInParticipantIds:yn})}return Array.isArray(f==null?void 0:f.exclude)&&(f==null||f.exclude.forEach(Xt=>delete Qi[Xt])),Qi}}function gm({matchUp:t}){return!!t&&(no.includes(t==null?void 0:t.matchUpStatus)||(t==null?void 0:t.winningSide))}function Ek({requireParticipants:t=!0,scheduleVisibilityFilters:e,tournamentAppliedPolicies:i,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:a,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structureId:y,inContext:b,structure:I,context:T,event:S}){!I&&y&&({structure:I}=kt({drawDefinition:m,structureId:y}));const w=zi({tournamentAppliedPolicies:i,scheduleVisibilityFilters:e,tournamentParticipants:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:a,usePublishState:s,matchUpFilters:l,contextFilters:c,contextContent:u,participantMap:d,scheduleTiming:p,publishStatus:h,contextProfile:f,drawDefinition:m,exitProfiles:g,matchUpsMap:v,structure:I,inContext:b,context:T,event:S}),U=[],D=[],E=[],C=[],M=[];if(w.error)return w;const{matchUps:N}=w,{assignedPositions:R}=Lr({structure:I}),A=R==null?void 0:R.filter(k=>k.participantId).map(k=>k.drawPosition);let _;return N.filter(k=>{var O;const F=((O=l==null?void 0:l.matchUpTypes)==null?void 0:O.length)===1&&l.matchUpTypes[0]===gn;return!(k.matchUpType!==gn&&F)}).forEach(k=>{var O,F,B,$;if(k.matchUpStatus===Es)return void U.push(k);k.matchUpType===gn&&(_=!0);const V=k.collectionId,H=V&&((O=k.sides)==null?void 0:O.every(Y=>Y.participantId)),z=!V&&((F=k.drawPositions)==null?void 0:F.filter(Boolean).length)===2,G=!V&&((B=k.drawPositions)==null?void 0:B.every(Y=>A==null?void 0:A.includes(Y))),W=R==null?void 0:R.filter(Y=>Y.bye).map(Y=>Y.drawPosition),K=!V&&(($=k.drawPositions)==null?void 0:$.find(Y=>W==null?void 0:W.includes(Y))),Z=Dke.includes(k.matchUpStatus)&&(H||z&&(!t||G));return K?M.push(k):gm({matchUp:k})?D.push(k):Z?E.push(k):C.push(k)}),{includesTeamMatchUps:_,abandonedMatchUps:U,completedMatchUps:D,upcomingMatchUps:E,pendingMatchUps:C,byeMatchUps:M,structure:I}}function Ar(t){Object.assign(t,{requireParticipants:!1});const e=H0(t);if(e.error)return ce({result:e,stack:"getAllDrawMatchUps"});const{abandonedMatchUps:i,completedMatchUps:n,upcomingMatchUps:r,pendingMatchUps:o,byeMatchUps:a,matchUpsMap:s}=e;return{matchUps:(i??[]).concat(...n??[],...r??[],...o??[],...a??[]),matchUpsMap:s}}function H0(t){if(!(t!=null&&t.drawDefinition))return{error:rt};let{tournamentParticipants:e,contextContent:i,matchUpsMap:n}=t;const{scheduleVisibilityFilters:r,tournamentAppliedPolicies:o,requireParticipants:a,participantsProfile:s,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,scheduleTiming:f,participantMap:m,publishStatus:g,contextProfile:v,drawDefinition:y,nextMatchUps:b,inContext:I,context:T,event:S}=t;let w,U=[],D=[],E=[],C=[],M=[];v&&!i&&(i=Xp({policyDefinitions:c,tournamentRecord:u,contextProfile:v,event:S})),!(e!=null&&e.length)&&u&&(e=u==null?void 0:u.participants,(I||s!=null&&s.withGroupings)&&e!=null&&e.length&&({participantsWithGroupings:e,groupInfo:w}=EW({participants:e,participantsProfile:s})));const{structures:N}=Nd({drawDefinition:y});if(!N)return{error:Cn};n||(n=ma({drawDefinition:y}));const R=y&&Due({drawDefinition:y}).exitProfiles;N.forEach(k=>{const{byeMatchUps:O=[],pendingMatchUps:F=[],upcomingMatchUps:B=[],completedMatchUps:$=[],abandonedMatchUps:V=[]}=Ek({matchUpFilters:b?void 0:h,contextFilters:b?void 0:p,inContext:I||b||p,tournamentAppliedPolicies:o,scheduleVisibilityFilters:r,tournamentParticipants:e,requireParticipants:a,afterRecoveryTimes:l,policyDefinitions:c,tournamentRecord:u,usePublishState:d,contextContent:i,participantMap:m,scheduleTiming:f,publishStatus:g,contextProfile:v,drawDefinition:y,exitProfiles:R,matchUpsMap:n,structure:k,context:T,event:S});U=U.concat(...V),D=D.concat(...$),E=E.concat(...B),C=C.concat(...F),M=M.concat(...O)});const A=k=>((h||b||p)&&(h&&(k=ev({matchUps:k,...h})),p&&(k=ev({matchUps:k,...p,processContext:!0}))),k),_={abandonedMatchUps:A(U),completedMatchUps:A(D),upcomingMatchUps:A(E),pendingMatchUps:A(C),byeMatchUps:A(M),matchUpsMap:n,...le,groupInfo:w};if(b){const k=typeof b=="object"||{abandoned:!0,completed:!0,upcoming:!0,pending:!0,bye:!0},{abandoned:O,completed:F,upcoming:B,pending:$,bye:V}=k;Lke({inContextDrawMatchUps:[].concat(...O&&U||[],...F&&D||[],...B&&E||[],...$&&C||[],...V&&M||[]),drawDefinition:y})}return _}function Mk({finishingPositionOffset:t=0,finishingPositionLimit:e,positionsFed:i,roundsCount:n,roundLimit:r,matchUps:o,lucky:a,fmlc:s}){var l;if(!vl(o))return[];const{roundProfile:c,roundNumbers:u=[]}=ba({interpolate:!0,matchUps:o});n=n??Math.max(...u,0);const d=r?n-r:0,p=d&&((l=c==null?void 0:c[n-d])==null?void 0:l.matchUpsCount),h=c&&Object.values(c).map(Ts("matchUpsCount")),f=(v,y)=>{let b=Math.min(...v);p&&y&&b===1&&(b=p);let I=Math.max(...v);return e&&I>e&&(I=e),[b,I]},m=c&&Object.assign({},...u.map(v=>{const y=(n??0)+1-v-d,b=c[v].matchUpsCount,I={finishingPositionRange:{},finishingRound:y},T=h==null?void 0:h.slice(v-1).reduce((C,M)=>C+(M||0),0),S=1+t+(s&&v!==1?i??0:0),w=nt(S,a?S+2*b:T+S+1),U=T+1-b,D=f(w.slice(U)),E=f(w.slice(0,U),!0);return I.finishingPositionRange={loser:D,winner:E},{[v]:I}})),g=Wl({finishingRound:!0});return o.filter(Boolean).forEach(v=>{const y=v.roundNumber&&m[v.roundNumber];g&&!y&&console.log({roundFinishingData:m,matchUp:v}),v.finishingRound=y==null?void 0:y.finishingRound,v.finishingPositionRange=y==null?void 0:y.finishingPositionRange}),o}function EU({inContextDrawMatchUps:t,drawDefinition:e,matchUpsMap:i}){var n;if(!e)return{error:rt};const r={loserMatchUpIds:{},winnerMatchUpIds:{}};return t||({matchUps:t,matchUpsMap:i}=Ar({inContext:!0,drawDefinition:e,matchUpsMap:i})),!(i!=null&&i.drawMatchUps.some(o=>o.finishingPositionRange))&&((n=e==null?void 0:e.structures)==null?void 0:n.length)===1&&!(e!=null&&e.structures[0].structures)&&Mk({matchUps:(i==null?void 0:i.drawMatchUps)??[]}),(t??[]).filter(({collectionId:o})=>!o).forEach(o=>{const{matchUpId:a,structureId:s}=o,l=pa({inContextDrawMatchUps:t,drawDefinition:e,matchUpId:a}),{winnerMatchUp:c,loserMatchUp:u}=l.targetMatchUps,d=c==null?void 0:c.matchUpId,p=u==null?void 0:u.matchUpId,h=dm({matchUpsMap:i,structureId:s}).find(f=>f.matchUpId===a);if(h&&(d&&(r.winnerMatchUpIds[h.matchUpId]=d,Object.assign(h,{winnerMatchUpId:d}),Object.assign(o,{winnerMatchUpId:d})),p&&(r.loserMatchUpIds[h.matchUpId]=p,o.loserMatchUpId=p,h.loserMatchUpId=p,o.finishingPositionRange))){const f=u.finishingPositionRange&&[...o.finishingPositionRange.loser,...u.finishingPositionRange.loser],m=f&&[Math.min(...f),Math.max(...f)];o.finishingPositionRange.loser=m,h.finishingPositionRange.loser=m}}),{inContextDrawMatchUps:t,goesToMap:r}}function G7(t){return t&&String.fromCodePoint!==void 0?t.toUpperCase().replace(/./g,e=>String.fromCodePoint(e.charCodeAt(0)+127397)):t}const Fh=[{ioc:"",iso2:"",iso:"",label:"NONE",phone:""},{ioc:"AND",iso2:"AD",iso:"AND",label:"Andorra",phone:"376"},{ioc:"UAE",iso2:"AE",iso:"ARE",label:"United Arab Emirates",phone:"971"},{ioc:"AFG",iso2:"AF",iso:"AFG",label:"Afghanistan",phone:"93"},{ioc:"ANT",iso2:"AG",iso:"ATG",label:"Antigua and Barbuda",phone:"1-268"},{ioc:"AIA",iso2:"AI",iso:"AIA",label:"Anguilla",phone:"1-264"},{ioc:"ALB",iso2:"AL",iso:"ALB",label:"Albania",phone:"355"},{ioc:"ARM",iso2:"AM",iso:"ARM",label:"Armenia",phone:"374"},{ioc:"ANG",iso2:"AO",iso:"AGO",label:"Angola",phone:"244"},{ioc:"",iso2:"AQ",iso:"ATA",label:"Antarctica",phone:"672"},{ioc:"ARG",iso2:"AR",iso:"ARG",label:"Argentina",phone:"54"},{ioc:"ASA",iso2:"AS",iso:"ASM",label:"American Samoa",phone:"1-684"},{ioc:"AUT",iso2:"AT",iso:"AUT",label:"Austria",phone:"43"},{ioc:"AUS",iso2:"AU",iso:"AUS",label:"Australia",phone:"61",suggested:!0},{ioc:"ARU",iso2:"AW",iso:"ABW",label:"Aruba",phone:"297"},{ioc:"AZE",iso2:"AZ",iso:"AZE",label:"Azerbaijan",phone:"994"},{ioc:"BIH",iso2:"BA",iso:"BIH",label:"Bosnia and Herzegovina",phone:"387"},{ioc:"BAR",iso2:"BB",iso:"BRB",label:"Barbados",phone:"1-246"},{ioc:"BAN",iso2:"BD",iso:"BGD",label:"Bangladesh",phone:"880"},{ioc:"BEL",iso2:"BE",iso:"BEL",label:"Belgium",phone:"32"},{ioc:"BUR",iso2:"BF",iso:"BFA",label:"Burkina Faso",phone:"226"},{ioc:"BUL",iso2:"BG",iso:"BGR",label:"Bulgaria",phone:"359"},{ioc:"BRN",iso2:"BH",iso:"BHR",label:"Bahrain",phone:"973"},{ioc:"BDI",iso2:"BI",iso:"BDI",label:"Burundi",phone:"257"},{ioc:"BEN",iso2:"BJ",iso:"BEN",label:"Benin",phone:"229"},{ioc:"",iso2:"BL",iso:"BLM",label:"Saint Barthelemy",phone:"590"},{ioc:"BER",iso2:"BM",iso:"BMU",label:"Bermuda",phone:"1-441"},{ioc:"BRU",iso2:"BN",iso:"BRN",label:"Brunei Darussalam",phone:"673"},{ioc:"BOL",iso2:"BO",iso:"BOL",label:"Bolivia",phone:"591"},{ioc:"BRA",iso2:"BR",iso:"BRA",label:"Brazil",phone:"55"},{ioc:"BAH",iso2:"BS",iso:"BHS",label:"Bahamas",phone:"1-242"},{ioc:"BHU",iso2:"BT",iso:"BTN",label:"Bhutan",phone:"975"},{ioc:"",iso2:"BV",iso:"BVT",label:"Bouvet Island",phone:"47"},{ioc:"BOT",iso2:"BW",iso:"BWA",label:"Botswana",phone:"267"},{ioc:"BLR",iso2:"BY",iso:"BLR",label:"Belarus",phone:"375"},{ioc:"BIZ",iso2:"BZ",iso:"BLZ",label:"Belize",phone:"501"},{ioc:"CAN",iso2:"CA",iso:"CAN",label:"Canada",phone:"1",suggested:!0},{ioc:"",iso2:"CC",iso:"CCK",label:"Cocos (Keeling) Islands",phone:"61"},{ioc:"CGO",iso2:"CD",iso:"COG",label:"Congo, Republic of the",phone:"242"},{ioc:"CAF",iso2:"CF",iso:"CAF",label:"Central African Republic",phone:"236"},{ioc:"COD",iso2:"CG",iso:"CGD",label:"Congo, Democratic Republic of the",phone:"243"},{ioc:"SUI",iso2:"CH",iso:"CHE",label:"Switzerland",phone:"41"},{ioc:"CIV",iso2:"CI",iso:"CIV",label:"Cote d'Ivoire",phone:"225"},{ioc:"COK",iso2:"CK",iso:"COK",label:"Cook Islands",phone:"682"},{ioc:"CHI",iso2:"CL",iso:"CHL",label:"Chile",phone:"56"},{ioc:"CMR",iso2:"CM",iso:"CMR",label:"Cameroon",phone:"237"},{ioc:"CHN",iso2:"CN",iso:"CHN",label:"China",phone:"86"},{ioc:"COL",iso2:"CO",iso:"COL",label:"Colombia",phone:"57"},{ioc:"CRC",iso2:"CR",iso:"CRI",label:"Costa Rica",phone:"506"},{ioc:"CUB",iso2:"CU",iso:"CUB",label:"Cuba",phone:"53"},{ioc:"CPV",iso2:"CV",iso:"CPV",label:"Cape Verde",phone:"238"},{ioc:"CUW",iso2:"CW",iso:"CUW",label:"Curacao",phone:"599"},{ioc:"CXR",iso2:"CX",iso:"CXR",label:"Christmas Island",phone:"61"},{ioc:"CYP",iso2:"CY",iso:"CYP",label:"Cyprus",phone:"357"},{ioc:"CZE",iso2:"CZ",iso:"CZE",label:"Czech Republic",phone:"420"},{ioc:"GER",iso2:"DE",iso:"DEU",label:"Germany",phone:"49",suggested:!0},{ioc:"DJI",iso2:"DJ",iso:"DJI",label:"Djibouti",phone:"253"},{ioc:"DEN",iso2:"DK",iso:"DNK",label:"Denmark",phone:"45"},{ioc:"DMA",iso2:"DM",iso:"DMA",label:"Dominica",phone:"1-767"},{ioc:"DOM",iso2:"DO",iso:"DOM",label:"Dominican Republic",phone:"1-809"},{ioc:"ALG",iso2:"DZ",iso:"DZA",label:"Algeria",phone:"213"},{ioc:"ECU",iso2:"EC",iso:"ECU",label:"Ecuador",phone:"593"},{ioc:"EST",iso2:"EE",iso:"ESE",label:"Estonia",phone:"372"},{ioc:"EGY",iso2:"EG",iso:"EGY",label:"Egypt",phone:"20"},{ioc:"",iso2:"EH",iso:"ESH",label:"Western Sahara",phone:"212"},{ioc:"ERI",iso2:"ER",iso:"ERI",label:"Eritrea",phone:"291"},{ioc:"ESP",iso2:"ES",iso:"ESP",label:"Spain",phone:"34"},{ioc:"ETH",iso2:"ET",iso:"ETH",label:"Ethiopia",phone:"251"},{ioc:"FIN",iso2:"FI",iso:"FIN",label:"Finland",phone:"358"},{ioc:"FIJ",iso2:"FJ",iso:"FJI",label:"Fiji",phone:"679"},{ioc:"FLK",iso2:"FK",iso:"FLK",label:"Falkland Islands (Malvinas)",phone:"500"},{ioc:"FSM",iso2:"FM",iso:"FSM",label:"Micronesia, Federated States of",phone:"691"},{ioc:"FAR",iso2:"FO",iso:"FRO",label:"Faroe Islands",phone:"298"},{ioc:"FRA",iso2:"FR",iso:"FRA",label:"France",phone:"33",suggested:!0},{ioc:"GAB",iso2:"GA",iso:"GAB",label:"Gabon",phone:"241"},{ioc:"GBR",iso2:"GB",iso:"GBR",label:"United Kingdom",phone:"44"},{ioc:"GRN",iso2:"GD",iso:"GRD",label:"Grenada",phone:"1-473"},{ioc:"GEO",iso2:"GE",iso:"GEO",label:"Georgia",phone:"995"},{ioc:"FGU",iso2:"GF",iso:"GUF",label:"French Guiana",phone:"594"},{ioc:"",iso2:"GG",iso:"GGY",label:"Guernsey",phone:"44"},{ioc:"",iso2:"GH",iso:"GHA",label:"Ghana",phone:"233"},{ioc:"GIB",iso2:"GI",iso:"GIB",label:"Gibraltar",phone:"350"},{ioc:"GRL",iso2:"GL",iso:"GRL",label:"Greenland",phone:"299"},{ioc:"GAM",iso2:"GM",iso:"GMB",label:"Gambia",phone:"220"},{ioc:"GUI",iso2:"GN",iso:"GIN",label:"Guinea",phone:"224"},{ioc:"GUD",iso2:"GP",iso:"GLP",label:"Guadeloupe",phone:"590"},{ioc:"GEQ",iso2:"GQ",iso:"GNQ",label:"Equatorial Guinea",phone:"240"},{ioc:"GRE",iso2:"GR",iso:"GRC",label:"Greece",phone:"30"},{ioc:"",iso2:"GS",iso:"SGS",label:"South Georgia and the South Sandwich Islands",phone:"500"},{ioc:"GUA",iso2:"GT",iso:"GTM",label:"Guatemala",phone:"502"},{ioc:"GUM",iso2:"GU",iso:"GUM",label:"Guam",phone:"1-671"},{ioc:"GBS",iso2:"GW",iso:"GNB",label:"Guinea-Bissau",phone:"245"},{ioc:"GUY",iso2:"GY",iso:"GUY",label:"Guyana",phone:"592"},{ioc:"HKG",iso2:"HK",iso:"HKG",label:"Hong Kong",phone:"852"},{ioc:"",iso2:"HM",iso:"HMD",label:"Heard Island and McDonald Islands",phone:"672"},{ioc:"HON",iso2:"HN",iso:"HND",label:"Honduras",phone:"504"},{ioc:"CRO",iso2:"HR",iso:"HRV",label:"Croatia",phone:"385"},{ioc:"HAI",iso2:"HT",iso:"HTI",label:"Haiti",phone:"509"},{ioc:"HUN",iso2:"HU",iso:"HUN",label:"Hungary",phone:"36"},{ioc:"INA",iso2:"ID",iso:"IDN",label:"Indonesia",phone:"62"},{ioc:"IRL",iso2:"IE",iso:"IRL",label:"Ireland",phone:"353"},{ioc:"ISR",iso2:"IL",iso:"ISR",label:"Israel",phone:"972"},{ioc:"",iso2:"IM",iso:"IMN",label:"Isle of Man",phone:"44"},{ioc:"IND",iso2:"IN",iso:"IND",label:"India",phone:"91"},{ioc:"",iso2:"IO",iso:"IOT",label:"British Indian Ocean Territory",phone:"246"},{ioc:"IRQ",iso2:"IQ",iso:"IRQ",label:"Iraq",phone:"964"},{ioc:"IRI",iso2:"IR",iso:"IRN",label:"Iran, Islamic Republic of",phone:"98"},{ioc:"ISL",iso2:"IS",iso:"ISL",label:"Iceland",phone:"354"},{ioc:"ITA",iso2:"IT",iso:"ITA",label:"Italy",phone:"39"},{ioc:"",iso2:"JE",iso:"JEY",label:"Jersey",phone:"44"},{ioc:"JAM",iso2:"JM",iso:"JAM",label:"Jamaica",phone:"1-876"},{ioc:"JOR",iso2:"JO",iso:"JOR",label:"Jordan",phone:"962"},{ioc:"JPN",iso2:"JP",iso:"JPN",label:"Japan",phone:"81",suggested:!0},{ioc:"KEN",iso2:"KE",iso:"KEN",label:"Kenya",phone:"254"},{ioc:"KGZ",iso2:"KG",iso:"KGZ",label:"Kyrgyzstan",phone:"996"},{ioc:"CAM",iso2:"KH",iso:"KHM",label:"Cambodia",phone:"855"},{ioc:"KIR",iso2:"KI",iso:"KIR",label:"Kiribati",phone:"686"},{ioc:"COM",iso2:"KM",iso:"COM",label:"Comoros",phone:"269"},{ioc:"SKN",iso2:"KN",iso:"KNA",label:"Saint Kitts and Nevis",phone:"1-869"},{ioc:"KOR",iso2:"KP",iso:"KOR",label:"Korea, Democratic People's Republic of",phone:"850"},{ioc:"PRK",iso2:"KR",iso:"PRK",label:"Korea, Republic of",phone:"82"},{ioc:"KUW",iso2:"KW",iso:"KWT",label:"Kuwait",phone:"965"},{ioc:"CAY",iso2:"KY",iso:"CYM",label:"Cayman Islands",phone:"1-345"},{ioc:"KAZ",iso2:"KZ",iso:"KAZ",label:"Kazakhstan",phone:"7"},{ioc:"LAO",iso2:"LA",iso:"LAO",label:"Lao People's Democratic Republic",phone:"856"},{ioc:"LIB",iso2:"LB",iso:"LBN",label:"Lebanon",phone:"961"},{ioc:"LCA",iso2:"LC",iso:"LCA",label:"Saint Lucia",phone:"1-758"},{ioc:"LIE",iso2:"LI",iso:"LIE",label:"Liechtenstein",phone:"423"},{ioc:"SRI",iso2:"LK",iso:"LKA",label:"Sri Lanka",phone:"94"},{ioc:"LBR",iso2:"LR",iso:"LBR",label:"Liberia",phone:"231"},{ioc:"LES",iso2:"LS",iso:"LSO",label:"Lesotho",phone:"266"},{ioc:"LTU",iso2:"LT",iso:"LTU",label:"Lithuania",phone:"370"},{ioc:"LUX",iso2:"LU",iso:"LUX",label:"Luxembourg",phone:"352"},{ioc:"LAT",iso2:"LV",iso:"LVA",label:"Latvia",phone:"371"},{ioc:"LBA",iso2:"LY",iso:"LBY",label:"Libya",phone:"218"},{ioc:"MAR",iso2:"MA",iso:"MAR",label:"Morocco",phone:"212"},{ioc:"MON",iso2:"MC",iso:"MCO",label:"Monaco",phone:"377"},{ioc:"MDA",iso2:"MD",iso:"MDA",label:"Moldova, Republic of",phone:"373"},{ioc:"MNE",iso2:"ME",iso:"MNE",label:"Montenegro",phone:"382"},{ioc:"",iso2:"MF",iso:"MAF",label:"Saint Martin (French part)",phone:"590"},{ioc:"MAD",iso2:"MG",iso:"MDG",label:"Madagascar",phone:"261"},{ioc:"MSH",iso2:"MH",iso:"MHL",label:"Marshall Islands",phone:"692"},{ioc:"MKD",iso2:"MK",iso:"MKD",label:"Macedonia, the Former Yugoslav Republic of",phone:"389"},{ioc:"MLI",iso2:"ML",iso:"MLI",label:"Mali",phone:"223"},{ioc:"MYA",iso2:"MM",iso:"MMR",label:"Myanmar",phone:"95"},{ioc:"MGL",iso2:"MN",iso:"MNG",label:"Mongolia",phone:"976"},{ioc:"MAC",iso2:"MO",iso:"MAC",label:"Macao",phone:"853"},{ioc:"NMA",iso2:"MP",iso:"NMP",label:"Northern Mariana Islands",phone:"1-670"},{ioc:"MRT",iso2:"MQ",iso:"MTQ",label:"Martinique",phone:"596"},{ioc:"MTN",iso2:"MR",iso:"MRT",label:"Mauritania",phone:"222"},{ioc:"MNT",iso2:"MS",iso:"MSR",label:"Montserrat",phone:"1-664"},{ioc:"MLT",iso2:"MT",iso:"MLT",label:"Malta",phone:"356"},{ioc:"MRI",iso2:"MU",iso:"MUS",label:"Mauritius",phone:"230"},{ioc:"MDV",iso2:"MV",iso:"MDV",label:"Maldives",phone:"960"},{ioc:"MAW",iso2:"MW",iso:"MWI",label:"Malawi",phone:"265"},{ioc:"MEX",iso2:"MX",iso:"MEX",label:"Mexico",phone:"52"},{ioc:"MAS",iso2:"MY",iso:"MYS",label:"Malaysia",phone:"60"},{ioc:"MOZ",iso2:"MZ",iso:"MOZ",label:"Mozambique",phone:"258"},{ioc:"NAM",iso2:"NA",iso:"NAM",label:"Namibia",phone:"264"},{ioc:"NCL",iso2:"NC",iso:"NCL",label:"New Caledonia",phone:"687"},{ioc:"NIG",iso2:"NE",iso:"NER",label:"Niger",phone:"227"},{ioc:"NFI",iso2:"NF",iso:"NFK",label:"Norfolk Island",phone:"672"},{ioc:"NGR",iso2:"NG",iso:"NGA",label:"Nigeria",phone:"234"},{ioc:"NCA",iso2:"NI",iso:"NIC",label:"Nicaragua",phone:"505"},{ioc:"NED",iso2:"NL",iso:"NLD",label:"Netherlands",phone:"31"},{ioc:"NOR",iso2:"NO",iso:"NOR",label:"Norway",phone:"47"},{ioc:"NEP",iso2:"NP",iso:"NPL",label:"Nepal",phone:"977"},{ioc:"NRU",iso2:"NR",iso:"NRU",label:"Nauru",phone:"674"},{ioc:"NIU",iso2:"NU",iso:"NIU",label:"Niue",phone:"683"},{ioc:"NZL",iso2:"NZ",iso:"NZL",label:"New Zealand",phone:"64"},{ioc:"OMA",iso2:"OM",iso:"OMN",label:"Oman",phone:"968"},{ioc:"PAN",iso2:"PA",iso:"PAN",label:"Panama",phone:"507"},{ioc:"PER",iso2:"PE",iso:"PER",label:"Peru",phone:"51"},{ioc:"FPO",iso2:"PF",iso:"PYF",label:"French Polynesia",phone:"689"},{ioc:"PNG",iso2:"PG",iso:"PNG",label:"Papua New Guinea",phone:"675"},{ioc:"PHI",iso2:"PH",iso:"PHL",label:"Philippines",phone:"63"},{ioc:"PAK",iso2:"PK",iso:"PAK",label:"Pakistan",phone:"92"},{ioc:"POL",iso2:"PL",iso:"POL",label:"Poland",phone:"48"},{ioc:"SPM",iso2:"PM",iso:"SPM",label:"Saint Pierre and Miquelon",phone:"508"},{ioc:"",iso2:"PN",iso:"PCN",label:"Pitcairn",phone:"870"},{ioc:"PUR",iso2:"PR",iso:"PRI",label:"Puerto Rico",phone:"1"},{ioc:"PLE",iso2:"PS",iso:"PSE",label:"Palestine, State of",phone:"970"},{ioc:"POR",iso2:"PT",iso:"PRT",label:"Portugal",phone:"351"},{ioc:"PLW",iso2:"PW",iso:"PLW",label:"Palau",phone:"680"},{ioc:"PAR",iso2:"PY",iso:"PRY",label:"Paraguay",phone:"595"},{ioc:"QAT",iso2:"QA",iso:"QAT",label:"Qatar",phone:"974"},{ioc:"REU",iso2:"RE",iso:"REU",label:"Reunion",phone:"262"},{ioc:"ROU",iso2:"RO",iso:"ROU",label:"Romania",phone:"40"},{ioc:"SRB",iso2:"RS",iso:"SRB",label:"Serbia",phone:"381"},{ioc:"RUS",iso2:"RU",iso:"RUS",label:"Russia",phone:"7"},{ioc:"RWA",iso2:"RW",iso:"RWA",label:"Rwanda",phone:"250"},{ioc:"KSA",iso2:"SA",iso:"SAU",label:"Saudi Arabia",phone:"966"},{ioc:"SOL",iso2:"SB",iso:"SLB",label:"Solomon Islands",phone:"677"},{ioc:"SEY",iso2:"SC",iso:"SYC",label:"Seychelles",phone:"248"},{ioc:"SUD",iso2:"SD",iso:"SDN",label:"Sudan",phone:"249"},{ioc:"SWE",iso2:"SE",iso:"SWE",label:"Sweden",phone:"46"},{ioc:"SIN",iso2:"SG",iso:"SGP",label:"Singapore",phone:"65"},{ioc:"HEL",iso2:"SH",iso:"SHN",label:"Saint Helena",phone:"290"},{ioc:"SLO",iso2:"SI",iso:"SVN",label:"Slovenia",phone:"386"},{ioc:"",iso2:"SJ",iso:"SJM",label:"Svalbard and Jan Mayen",phone:"47"},{ioc:"SVK",iso2:"SK",iso:"SVK",label:"Slovakia",phone:"421"},{ioc:"SLE",iso2:"SL",iso:"SLE",label:"Sierra Leone",phone:"232"},{ioc:"SMR",iso2:"SM",iso:"SMR",label:"San Marino",phone:"378"},{ioc:"SEN",iso2:"SN",iso:"SEN",label:"Senegal",phone:"221"},{ioc:"SOM",iso2:"SO",iso:"SOM",label:"Somalia",phone:"252"},{ioc:"SUR",iso2:"SR",iso:"SUR",label:"Suriname",phone:"597"},{ioc:"",iso2:"SS",iso:"SSD",label:"South Sudan",phone:"211"},{ioc:"STP",iso2:"ST",iso:"STP",label:"Sao Tome and Principe",phone:"239"},{ioc:"ESA",iso2:"SV",iso:"SLV",label:"El Salvador",phone:"503"},{ioc:"",iso2:"SX",iso:"SMX",label:"Sint Maarten",phone:"1-721"},{ioc:"SYR",iso2:"SY",iso:"SYR",label:"Syria",phone:"963"},{ioc:"",iso2:"SZ",iso:"SWZ",label:"Swaziland",phone:"268"},{ioc:"TKS",iso2:"TC",iso:"TCA",label:"Turks and Caicos Islands",phone:"1-649"},{ioc:"CHA",iso2:"TD",iso:"TCD",label:"Chad",phone:"235"},{ioc:"",iso2:"TF",iso:"ATF",label:"French Southern Territories",phone:"262"},{ioc:"TOG",iso2:"TG",iso:"TGO",label:"Togo",phone:"228"},{ioc:"THA",iso2:"TH",iso:"THA",label:"Thailand",phone:"66"},{ioc:"TJK",iso2:"TJ",iso:"TJK",label:"Tajikistan",phone:"992"},{ioc:"",iso2:"TK",iso:"TKL",label:"Tokelau",phone:"690"},{ioc:"TLS",iso2:"TL",iso:"TLS",label:"Timor-Leste",phone:"670"},{ioc:"TKM",iso2:"TM",iso:"TKM",label:"Turkmenistan",phone:"993"},{ioc:"TUN",iso2:"TN",iso:"TUN",label:"Tunisia",phone:"216"},{ioc:"TGA",iso2:"TO",iso:"TON",label:"Tonga",phone:"676"},{ioc:"TUR",iso2:"TR",iso:"TUR",label:"Turkey",phone:"90"},{ioc:"TTO",iso2:"TT",iso:"TTO",label:"Trinidad and Tobago",phone:"1-868"},{ioc:"TUV",iso2:"TV",iso:"TUV",label:"Tuvalu",phone:"688"},{ioc:"TPE",iso2:"TW",iso:"TWN",label:"Taiwan",phone:"886"},{ioc:"TAN",iso2:"TZ",iso:"TZA",label:"United Republic of Tanzania",phone:"255"},{ioc:"UKR",iso2:"UA",iso:"UKR",label:"Ukraine",phone:"380"},{ioc:"UGA",iso2:"UG",iso:"UGA",label:"Uganda",phone:"256"},{ioc:"USA",iso2:"US",label:"United States",phone:"1",suggested:!0,iso:"USA"},{ioc:"URU",iso2:"UY",iso:"URY",label:"Uruguay",phone:"598"},{ioc:"UZB",iso2:"UZ",iso:"UZB",label:"Uzbekistan",phone:"998"},{ioc:"",iso2:"VA",iso:"VAT",label:"Holy See (Vatican City State)",phone:"379"},{ioc:"VIN",iso2:"VC",iso:"VCT",label:"Saint Vincent and the Grenadines",phone:"1-784"},{ioc:"VEN",iso2:"VE",iso:"VEN",label:"Venezuela",phone:"58"},{ioc:"IVB",iso2:"VG",iso:"VGB",label:"British Virgin Islands",phone:"1-284"},{ioc:"ISV",iso2:"VI",iso:"VIR",label:"US Virgin Islands",phone:"1-340"},{ioc:"VIE",iso2:"VN",iso:"VNM",label:"Vietnam",phone:"84"},{ioc:"VAN",iso2:"VU",iso:"VUT",label:"Vanuatu",phone:"678"},{ioc:"WAF",iso2:"WF",iso:"WLF",label:"Wallis and Futuna",phone:"681"},{ioc:"SAM",iso2:"WS",iso:"WSM",label:"Samoa",phone:"685"},{ioc:"KOS",iso2:"XK",iso:"KOS",label:"Kosovo",phone:"383"},{ioc:"YEM",iso2:"YE",iso:"YEM",label:"Yemen",phone:"967"},{ioc:"MAY",iso2:"YT",iso:"MYT",label:"Mayotte",phone:"262"},{ioc:"RSA",iso2:"ZA",iso:"ZAF",label:"South Africa",phone:"27"},{ioc:"ZAM",iso2:"ZM",iso:"ZMB",label:"Zambia",phone:"260"},{ioc:"ZIM",iso2:"ZW",iso:"ZWE",label:"Zimbabwe",phone:"263"}];function Vue({participant:t,withISO2:e,withIOC:i}){const{person:n,individualParticipants:r}=t;[n,r==null?void 0:r.map(({person:o})=>o)].flat().filter(Boolean).forEach(function(o){const{nationalityCode:a}=o||{};if(a){const s=Fh.find(({iso:l})=>l===a);i&&s!=null&&s.ioc&&!o.iocNationalityCode&&(o.iocNationalityCode=s.ioc),e&&s!=null&&s.iso2&&!o.iso2NationalityCode&&(o.iso2NationalityCode=s.iso2),s!=null&&s.label&&!o.countryName&&(o.countryName=s.label)}})}function Dg(t){var e;const{tournamentRecord:i,participantId:n}=t,r=t.tournamentRecords||i&&{[i.tournamentId]:i}||{};for(const o of Object.values(r)){const a=(e=o.participants)==null?void 0:e.find(s=>s.participantId===n);if(a)return{participant:a,tournamentId:o.tournamentId}}return{error:rr}}function Hu({returnPreviousValues:t,itemSubTypes:e,itemType:i,element:n}){if(!n)return{error:bt,info:rW};if(e&&!Array.isArray(e))return{error:Re,context:{itemSubTypes:e}};if(!Array.isArray(n.timeItems))return{error:vce};const r=n.timeItems.filter(a=>(a==null?void 0:a.itemType)===i).filter(a=>!(e!=null&&e.length)||e.some(s=>{var l;return(l=a==null?void 0:a.itemSubTypes)==null?void 0:l.includes(s)})).sort((a,s)=>new Date(a.createdAt||void 0).getTime()-new Date(s.createdAt||void 0).getTime()),o=r.pop();if(o){const a={timeItem:o,...le};return t&&Object.assign(a,{previousItems:r}),a}return{info:zo}}function BW({returnPreviousValues:t,drawDefinition:e,itemSubTypes:i,itemType:n}){if(!e)return{error:Yc};if(!e.timeItems)return{info:zo};const{timeItem:r,previousItems:o,info:a}=Hu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:o}||{info:a}}function nC({returnPreviousValues:t,itemSubTypes:e,itemType:i,event:n}){if(!n)return{error:Fi};if(!n.timeItems)return{info:zo};const{timeItem:r,previousItems:o,info:a}=Hu({returnPreviousValues:t,element:n,itemSubTypes:e,itemType:i});return r&&{timeItem:r,previousItems:o}||{info:a}}function rC({returnPreviousValues:t,tournamentRecord:e,itemSubTypes:i,itemType:n}){if(!e)return{error:je};if(!e.timeItems)return{info:zo};const{timeItem:r,previousItems:o,info:a}=Hu({element:e,returnPreviousValues:t,itemSubTypes:i,itemType:n});return r&&{timeItem:r,previousItems:o}||{info:a}}function $W({returnPreviousValues:t,tournamentRecord:e,participantId:i,itemSubTypes:n,itemType:r}){if(!e)return{error:je};if(!i)return{error:Hr};const o=Dg({tournamentRecord:e,participantId:i});if(o.error)return o;const{participant:a}=o;if(!(a!=null&&a.timeItems))return{info:zo};const{timeItem:s,previousItems:l,info:c}=Hu({element:o.participant,returnPreviousValues:t,itemSubTypes:n,itemType:r});return s&&{timeItem:s,previousItems:l}||{info:c}}const rxe={[gl]:"groupParticipantIds",[qt]:"pairParticipantIds",[on]:"teamParticipantIds"},oxe={[gl]:"groups",[on]:"teams"};function jue({withIndividualParticipants:t,convertExtensions:e,tournamentRecord:i,withSignInStatus:n,withScaleValues:r,internalUse:o,withISO2:a,withIOC:s}){const l={};for(const c of i.participants??[]){const u=c==null?void 0:c.participantId;u&&lxe({participantMap:l,participantId:u})}for(const c of i.participants??[]){const u=ft(c,e,o),{participantId:d,individualParticipantIds:p,participantType:h}=u;if(Object.assign(l[d].participant,u),p&&sxe({individualParticipantIds:p,participantCopy:u,participantMap:l,participantType:h,participantId:d}),n&&(l[d].participant.signedIn=axe(u)),r){const{ratings:f,rankings:m,seedings:g}=O0({participant:u});l[d].participant.seedings=g,l[d].participant.rankings=m,l[d].participant.ratings=f}(s||a)&&Vue({participant:l[d].participant,withISO2:a,withIOC:s})}return t&&function({participantMap:c,template:u}){var d;const p=Object.values(c);for(const h of p){const f=h.participant;if((d=f.individualParticipantIds)!=null&&d.length){f.individualParticipants=[];for(const m of f.individualParticipantIds){const g=c[m].participant;f.individualParticipants.push(u?Kv({template:u,source:g}):g)}}}}({participantMap:l,template:bn(t)?t:void 0}),{participantMap:l}}function axe(t){const{timeItem:e}=Hu({itemType:vk,element:t});return(e==null?void 0:e.itemValue)===PR}function sxe({individualParticipantIds:t,participantCopy:e,participantMap:i,participantType:n,participantId:r}){for(const o of t){const a=i[o].participant;if(a[rxe[n]].push(r),[on,gl].includes(n)){const{participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d}=e;a[oxe[n]].push({participantRoleResponsibilities:s,participantOtherName:l,participantName:c,participantId:u,teamId:d})}if(n===qt){const s=t.find(l=>l!==o);i[o].pairIdMap[r]=s,i[o].pairIdMap[s]=r}}}function lxe({participantMap:t,participantId:e}){if(t[e])return;const i={walkoverWins:0,defaultWins:0,walkovers:0,defaults:0,losses:0,wins:0};t[e]={structureParticipation:{},potentialMatchUps:{},scheduleConflicts:{},scheduleItems:[],participant:{groupParticipantIds:[],pairParticipantIds:[],teamParticipantIds:[],seedings:{},rankings:{},ratings:{},groups:[],teams:[]},statistics:{},opponents:{},pairIdMap:{},matchUps:{},events:{},draws:{},counters:{[vr]:{...i},[Pn]:{...i},[on]:{...i},...i}}}function rb({participantsProfile:t,useParticipantMap:e,tournamentRecord:i,contextProfile:n,inContext:r}){var o;if(e)return{participantMap:(o=jue({...t,...n,tournamentRecord:i}))==null?void 0:o.participantMap};let a,s=ft(i.participants,!1,!0)||[];if((t!=null&&t.withIOC||t!=null&&t.withISO2)&&s.forEach(l=>Vue({participant:l,...t})),(r||t!=null&&t.withGroupings)&&s!=null&&s.length&&({participantsWithGroupings:s,groupInfo:a}=EW({participantsProfile:t,deepCopy:!1,participants:s})),(t==null?void 0:t.withScaleValues)&&(s==null?void 0:s.length))for(const l of s){const{ratings:c,rankings:u}=O0({participant:l});l.rankings=u,l.ratings=c}return{participants:s,groupInfo:a}}function Qp(t){let{participants:e=[],contextContent:i,participantMap:n}=t;const{scheduleVisibilityFilters:r,tournamentAppliedPolicies:o,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,matchUpFilters:h,nextMatchUps:f,inContext:m,context:g,event:v}=t;if(!v)return{error:Fi};const{eventId:y,eventName:b,endDate:I,category:T,gender:S,matchUpFormat:w}=v,U={...g,...It({indoorOutDoor:v.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:v.surfaceCategory??(u==null?void 0:u.surfaceCategory),endDate:v.endDate??(u==null?void 0:u.endDate),tournamentId:u==null?void 0:u.tournamentId,matchUpFormat:w,eventName:b,category:T,gender:S,eventId:y})};let D;if(I&&(U.endDate=I),p&&!i&&(i=Xp({policyDefinitions:l,tournamentRecord:u,contextProfile:p,event:v})),!(e!=null&&e.length)&&!n&&u){const M=rb({participantsProfile:a,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:m});n=M.participantMap,e=M.participants??[],D=M.groupInfo}const E=v.drawDefinitions??[],C=QP({tournamentRecord:u,event:v}).scheduleTiming;return{matchUps:E.flatMap(M=>{const{matchUps:N}=Ar({tournamentParticipants:e,tournamentAppliedPolicies:o,scheduleVisibilityFilters:r,context:U,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:M,contextContent:i,matchUpFilters:h,participantMap:n,scheduleTiming:C,nextMatchUps:f,inContext:m,event:v});return N??[]}),groupInfo:D}}function Vr(t){if(!(t!=null&&t.tournamentRecord))return{error:je};let{participantMap:e,participants:i}=t;const{scheduleVisibilityFilters:n,participantsProfile:r,afterRecoveryTimes:o,useParticipantMap:a,policyDefinitions:s,tournamentRecord:l,inContext:c=!0,contextProfile:u,matchUpFilters:d,contextFilters:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??l.tournamentId,g=(l==null?void 0:l.events)??[];i||({participants:i,participantMap:e}=rb({participantsProfile:r,useParticipantMap:a,policyDefinitions:s,tournamentRecord:l,contextProfile:u,inContext:c}));const{appliedPolicies:v}=Gi({tournamentRecord:l}),y={...f,tournamentId:m,indoorOutDoor:l.indoorOutdoor,surfaceCategory:l.surfaceCategory,endDate:l.endDate},b=Xp({policyDefinitions:s,tournamentRecord:l,contextProfile:u});return{matchUps:g.flatMap(I=>{var T;return y.eventDrawsCount=((T=I.drawDefinitions)==null?void 0:T.length)??0,Qp({context:y,scheduleVisibilityFilters:n,tournamentAppliedPolicies:v,participantsProfile:r,afterRecoveryTimes:o,policyDefinitions:s,tournamentRecord:l,contextContent:b,contextFilters:p,contextProfile:u,matchUpFilters:d,participantMap:e,nextMatchUps:h,participants:i,inContext:c,event:I}).matchUps??[]}).concat(...l.matchUps??[])}}function Vc({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,tournamentRecords:n,policyDefinitions:r,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l}){return typeof n!="object"||!Object.keys(n).length?{error:Wn}:{matchUps:Object.keys(n).map(c=>{const u=n[c];return Vr({scheduleVisibilityFilters:t,afterRecoveryTimes:e,participantsProfile:i,policyDefinitions:r,tournamentRecord:u,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l}).matchUps??[]}).flat()}}function ob(t,e){return function(i,n){return(Qv[i==null?void 0:i.stage]||0)-(Qv[n==null?void 0:n.stage]||0)}(t,e)||((t==null?void 0:t.stageSequence)||0)-((e==null?void 0:e.stageSequence)||0)||(t==null?void 0:t.roundNumber)&&e.roundNumber&&(t==null?void 0:t.roundNumber)-(e==null?void 0:e.roundNumber)||((t==null?void 0:t.roundPosition)??0)-((e==null?void 0:e.roundPosition)??0)}function Fa(t){let{participants:e,participantMap:i,contextContent:n}=t;const{scheduleVisibilityFilters:r,tournamentAppliedPolicies:o,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextFilters:d,contextProfile:p,drawDefinition:h,matchUpFilters:f,nextMatchUps:m,inContext:g,context:v,event:y}=t,{eventId:b,eventName:I,eventType:T,category:S,gender:w,matchUpFormat:U}=y??{},D={...v,eventId:b,eventType:T,eventName:I,category:S,gender:w,matchUpFormat:U,indoorOutDoor:(y==null?void 0:y.indoorOutdoor)??(u==null?void 0:u.indoorOutdoor),surfaceCategory:(y==null?void 0:y.surfaceCategory)??(u==null?void 0:u.surfaceCategory),endDate:y==null?void 0:y.endDate};let E;return e!=null&&e.length||i||!u||({participants:e=[],participantMap:i,groupInfo:E}=rb({participantsProfile:a,useParticipantMap:c,policyDefinitions:l,tournamentRecord:u,contextProfile:p,inContext:g})),p&&!n&&(n=Xp({policyDefinitions:l,tournamentRecord:u,contextProfile:p,drawDefinition:h,event:y})),{...Ar({context:D,tournamentAppliedPolicies:o,scheduleVisibilityFilters:r,tournamentParticipants:e,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,drawDefinition:h,contextContent:n,contextFilters:d,contextProfile:p,matchUpFilters:f,participantMap:i,nextMatchUps:m,inContext:g,event:y}),groupInfo:E}}function rc(t){var e;let i=Vu(t);const n=t.matchUps??[];let r=t.drawIds??[];const{includeParticipantDependencies:o,tournamentRecord:a,drawDefinition:s}=t;if(!Array.isArray(n))return{error:Nf};if(!Array.isArray(r))return{error:Yc};const l=(e=t.matchUpIds)!=null&&e.length?t.matchUpIds:n.map(b=>b.matchUpId);if(!Array.isArray(l))return{error:OP};const c={},u={},d={},p={};a&&!Object.keys(i).length&&(i={[a.tournamentId]:a});const h=Object.values(i),f=h.reduce((b,I)=>b.concat(I.events??[]).map(T=>(T.drawDefinitions||[]).map(S=>S.links||[])).flat(1/0),[]).filter(({linkType:b})=>b===Mp);let m=n;if(f.length){m=Vc({nextMatchUps:!0,tournamentRecords:i}).matchUps;const b=f.reduce((I,T)=>{var S,w;const U=(S=T.source)==null?void 0:S.structureId,D=(w=T.target)==null?void 0:w.structureId;return U&&D&&(d[D]=U),U&&!I.includes(U)&&I.push(U),I},[]);for(const I of b)c[I]=[];for(const I of m??[]){const T=I.containerStructureId||I.structureId;b.includes(T)&&c[T].push(I.matchUpId)}}const g=b=>{u[b]||(u[b]={dependentMatchUpIds:[],participantIds:[],matchUpIds:[],sources:[]},p[b]=[])},v=(b,I)=>{u[b].matchUpIds.forEach(T=>{u[I].matchUpIds.push(T)}),u[I].matchUpIds.push(b),u[b].dependentMatchUpIds.push(I),o&&u[b].participantIds.forEach(T=>u[I].participantIds.push(T))},y=b=>{const I=Object.keys(c).length;for(const T of b||[]){const{matchUpId:S,winnerMatchUpId:w,loserMatchUpId:U}=T;if(!l.length||l.includes(S)){if(g(S),o){const{individualParticipantIds:C}=gk(T);u[S].participantIds=C}w&&(g(w),v(S,w),p[w].push(S)),U&&(g(U),v(S,U),p[U].push(S)),u[S].sources.push(p[S]);const D=p[S].map(C=>u[C].sources[0]).flat(),E=p[S].map(C=>u[C].sources[1]).flat();if(u[S].sources.push(D,E),I){const C=T.containerStructureId||T.structureId,M=d[C];if(c[M])for(const N of c[M])g(N),v(N,S),p[N].push(S)}}}};if(s)EU({drawDefinition:s}),m!=null&&m.length||(m=Fa({drawDefinition:s}).matchUps),y(m);else{if(m!=null&&m.length||(m=Vc({nextMatchUps:!0,tournamentRecords:i}).matchUps),!r.length){const b=h!=null&&h.length?h.map(({events:I=[]})=>I.map(({drawDefinitions:T=[]})=>T.map(({drawId:S})=>S))).flat(1/0):[];b&&(r=b)}for(const b of r){const I=m==null?void 0:m.filter(T=>T.drawId===b).sort(ob);if(!(I!=null&&I.find(({roundPosition:T})=>!T))){const T=I==null?void 0:I.find(({tournamentId:w})=>w),{drawDefinition:S}=us({tournamentRecord:i[T==null?void 0:T.tournamentId],drawId:b});S&&EU({drawDefinition:S})}y(I)}}return{positionDependencies:c,matchUpDependencies:u,sourceMatchUpIds:p,matchUps:m,...le}}function oC(t){var e;const{drawDefinition:i,findContainer:n,structureId:r,event:o}=t;let a=t.structure;const{containedStructures:s}=V0({drawDefinition:i}),l=r&&s[r]||[];if(!a){const w=kt({drawDefinition:i,structureId:r});if(w.error)return w;a=n?w.containingStructure??w.structure:w.structure}if(Zl({drawDefinition:i,structure:a}))return{structure:a,isAdHoc:!0,error:kP};const{matchUps:c}=Ar({inContext:!0,matchUpFilters:{isCollectionMatchUp:!1},drawDefinition:i,event:o}),u=c==null?void 0:c.filter(w=>w.structureId===r||l.includes(w.structureId)),{matchUpDependencies:d}=rc({drawIds:[i.drawId],matchUps:c,drawDefinition:i}),p=[],h=[],f={},m=[];for(const w of c??[]){if(w.structureId===r||l.includes(w.structureId)){h.push(...w.drawPositions??[]);const U=w.roundNumber;for(const D of(w.drawPositions??[]).filter(Boolean))(!f[D]||U&&f[D]>U)&&(f[D]=U)}CW(w)&&(m.push(w),p.push(w.matchUpId,...((e=d==null?void 0:d[w==null?void 0:w.matchUpId])==null?void 0:e.matchUpIds)||[]))}const g=ti(h.filter(Boolean)).sort(Sr),v=ti(p),y=ti(u==null?void 0:u.map(({matchUpId:w,drawPositions:U})=>v.includes(w)?U:[]).flat().filter(Boolean)).sort(Sr),{positionAssignments:b}=Ki({drawDefinition:i,structure:a}),I=b==null?void 0:b.filter(w=>w.bye).map(w=>w.drawPosition),T=b==null?void 0:b.filter(w=>w.qualifier).map(w=>w.drawPosition),S=(g==null?void 0:g.filter(w=>!y.includes(w)))||[];return{allDrawPositions:g,inContextStructureMatchUps:u,drawPositionInitialRounds:f,activeDependentMatchUpIds:v,qualifyingDrawPositions:T,inactiveDrawPositions:S,positionAssignments:b,activeDrawPositions:y,byeDrawPositions:I,activeMatchUps:m,structure:a}}function ny({drawPosition:t,matchUps:e=[]}){return{initialRoundNumber:e.filter(({drawPositions:i})=>t&&(i==null?void 0:i.includes(t))).map(({roundNumber:i})=>i).sort(Sr)[0]}}const hh={reset:"\x1B[0m",bright:"\x1B[1m",dim:"\x1B[2m",red:"\x1B[31m",brightred:"\x1B[91m",green:"\x1B[32m",brightgreen:"\x1B[92m",yellow:"\x1B[33m",brightyellow:"\x1B[93m",blue:"\x1B[34m",brightblue:"\x1B[94m",lightblue:"\x1B[105m",magenta:"\x1B[35m",brightmagenta:"\x1B[95m",cyan:"\x1B[36m",brightcyan:"\x1B[96m",white:"\x1B[37m",brightwhite:"\x1B[97m"},ER=[];function nl(t,e){typeof t=="string"&&(t={method:t}),(e||Wl())&&ER.push(t)}function cxe(t){const e=function(n){const r=ER.slice();return n&&(ER.length=0),r}(t),i=e.map(n=>{const{color:r,keyColors:o,method:a,newline:s}=n,l=Object.keys(hh).includes(r)?hh[r]:hh.cyan,c=Object.keys(n).filter(u=>!["color","keyColors","method","newline"].includes(u)).map(u=>{const d=o&&Object.keys(o).includes(u)&&hh[o[u]]?hh[o[u]]:hh.brightwhite;return`${hh.white}${u}: ${d}${n[u]}`}).join(", ");return[s?`
`:"",l,a,(a==null?void 0:a.length)<15?"		":"	",hh.white,c,hh.reset,`
`].join("")});i!=null&&i.length&&console.log(...i)}function Ms({provisionalPositioning:t,isPositionAction:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUpsMap:o,structureId:a,structure:s,event:l}){var c;if(!n)return{error:rt};if(s||({structure:s}=kt({drawDefinition:n,structureId:a})),!s)return{error:Cn};a||({structureId:a}=s);const u="assignDrawPositionBye";nl({method:u,color:"cyan",drawPosition:r}),o||(o=ma({drawDefinition:n}));const{positionAssignments:d}=Ki({structure:s}),{activeDrawPositions:p}=oC({drawDefinition:n,structureId:a}),h=d==null?void 0:d.find(E=>E.drawPosition===r);if(h!=null&&h.bye)return{...le};if(p!=null&&p.includes(r))return{error:zz};const f=d==null?void 0:d.find(E=>E.drawPosition===r);if(!f)return{error:kP};const{filled:m,containsBye:g,assignedParticipantId:v}=function(E){const C=E.bye,M=E.qualifier,N=E.participantId;return{containsBye:C,containsQualifier:M,assignedParticipantId:N,filled:C||M||N}}(f);if(g)return{...le};if(m&&!g)return ce({result:{error:lU},stack:u});const y=Ar({inContext:!0,drawDefinition:n,matchUpsMap:o}).matchUps??[],{matchUps:b}=zi({provisionalPositioning:t,drawDefinition:n,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:o,structure:s});if(d==null||d.forEach(E=>{E.drawPosition===r&&(E.bye=!0)}),s.structureType===na)return function({tournamentRecord:E,drawDefinition:C,drawPosition:M,matchUps:N,event:R}){N.forEach(A=>{var _;(_=A.drawPositions)!=null&&_.includes(M)&&W7({eventId:R==null?void 0:R.eventId,tournamentRecord:E,drawDefinition:C,matchUp:A})})}({tournamentRecord:i,drawDefinition:n,drawPosition:r,matchUps:b}),of({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),z7({assignedParticipantId:v,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:a,stack:u});const{roundProfile:I,roundMatchUps:T}=ba({matchUps:b}),S=I&&Object.keys(I).map(E=>parseInt(E)).reverse(),w=S==null?void 0:S.find(E=>{var C;return(C=I==null?void 0:I[E].drawPositions)==null?void 0:C.includes(r)}),U=w?T==null?void 0:T[w].find(({drawPositions:E})=>E==null?void 0:E.includes(r)):void 0;U&&W7({tournamentRecord:i,drawDefinition:n,matchUp:U,event:l});const D=(c=U==null?void 0:U.drawPositions)==null?void 0:c.find(E=>E!==r);if(U&&D){const E=VW({sourceDrawPositions:U.drawPositions,matchUpId:U.matchUpId,inContextDrawMatchUps:y,drawPositionToAdvance:D,tournamentRecord:i,drawDefinition:n,matchUpsMap:o});if(E.error)return E}return of({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:s,event:l}),z7({assignedParticipantId:v,isPositionAction:e,drawDefinition:n,drawPosition:r,structureId:a,stack:u})}function z7({assignedParticipantId:t,isPositionAction:e,drawDefinition:i,drawPosition:n,structureId:r,stack:o}){return e&&mk({drawDefinition:i,positionAction:{removedParticipantId:t,drawPosition:n,structureId:r,name:o}}),ce({result:{...le},stack:o})}function W7({tournamentRecord:t,drawDefinition:e,eventId:i,matchUp:n,event:r}){Object.assign(n,{matchUpStatus:Ri,score:void 0,winningSide:void 0}),Ci({tournamentId:t==null?void 0:t.tournamentId,eventId:i??(r==null?void 0:r.eventId),context:"setMatchUpStatusBye",drawDefinition:e,matchUp:n})}function VW({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,matchUpsMap:o,matchUpId:a,event:s}){var l;nl({method:"advanceDrawPosition",color:"cyan",drawPositionToAdvance:t});const c=o.drawMatchUps.find(T=>T.matchUpId===a),u=e.find(T=>T.matchUpId===a),d=u==null?void 0:u.structureId,{structure:p}=kt({drawDefinition:r,structureId:d}),{positionAssignments:h}=Ki({structure:p}),f=h==null?void 0:h.filter(T=>T.bye).map(T=>T.drawPosition),m=(l=c==null?void 0:c.drawPositions)==null?void 0:l.find(T=>T!==t),g=m&&(f==null?void 0:f.includes(m)),{targetLinks:{loserTargetLink:v},targetMatchUps:{loserMatchUp:y,winnerMatchUp:b,loserTargetDrawPosition:I}}=pa({inContextDrawMatchUps:e,drawDefinition:r,matchUpId:a});if(b&&b.structureId===(p==null?void 0:p.structureId)&&function({drawPositionToAdvance:T,inContextDrawMatchUps:S,sourceDrawPositions:w,tournamentRecord:U,drawDefinition:D,winnerMatchUp:E,matchUpsMap:C,event:M}){var N,R,A;const _="advanceWinner",k=C.drawMatchUps.find(Se=>Se.matchUpId===E.matchUpId),O=S.find(Se=>Se.matchUpId===E.matchUpId),F=O==null?void 0:O.structureId,{structure:B}=kt({drawDefinition:D,structureId:F}),{positionAssignments:$}=Ki({structure:B}),V=$==null?void 0:$.find(({drawPosition:Se})=>Se===T),H=V==null?void 0:V.bye,z=(N=k.drawPositions)==null?void 0:N.filter(Boolean),G=$==null?void 0:$.filter(Se=>z==null?void 0:z.includes(Se.drawPosition)),W=$==null?void 0:$.find(({drawPosition:Se})=>Se===T),K=w==null?void 0:w.find(Se=>Se!==T),Z=K&&(G==null?void 0:G.find(({drawPosition:Se})=>Se===K)),Y=Z==null?void 0:Z.bye,X=H&&Y;if(X&&console.log({isByeAdvancedBye:X}),(z==null?void 0:z.length)>1&&H&&!Y)return ce({result:{error:lU},stack:_});const Q=z==null?void 0:z.find(Se=>Se!==T);let te=X;const J=[...(k.drawPositions||[]).filter(Boolean),void 0,void 0].slice(0,2),ie=J.map(Se=>!Se&&!te||Se===T?(te=!0,T):Se).sort(Sr);if(!te)return console.log("@@@@@@@",{advancingAssignmentIsBye:W,drawPositionToAdvance:T,existingAssignments:G}),ce({result:{error:lU},stack:_});const oe=(R=$==null?void 0:$.find(({drawPosition:Se})=>Se===Q))==null?void 0:R.bye,ne=(A=$==null?void 0:$.find(({drawPosition:Se})=>Se===T))==null?void 0:A.bye;Object.assign(k,{matchUpStatus:ne||oe?Ri:qn,score:void 0,winningSide:void 0,drawPositions:ie});const re=k.drawPositions.find(Se=>!J.includes(Se));nl({method:_,color:"brightyellow",changedDrawPosition:re,pairedDrawPositionIsBye:oe,drawPositionIsBye:ne}),Ci({tournamentId:U==null?void 0:U.tournamentId,matchUp:k,eventId:M==null?void 0:M.eventId,context:_,drawDefinition:D});const{targetLinks:{loserTargetLink:me},targetMatchUps:{loserMatchUp:he,loserTargetDrawPosition:be}}=pa({matchUpId:E.matchUpId,inContextDrawMatchUps:S,drawDefinition:D});if(oe||ne){const Se=oe?T:Q;if(Se)VW({drawPositionToAdvance:Se,matchUpId:E.matchUpId,inContextDrawMatchUps:S,tournamentRecord:U,drawDefinition:D,matchUpsMap:C});else if(ne&&me&&he)if(he.feedRound)q7({loserTargetDrawPosition:be,tournamentRecord:U,loserTargetLink:me,drawDefinition:D,loserMatchUp:he,matchUpsMap:C});else{const De=1-E.roundPosition%2,Oe=he.drawPositions[De];Ms({structureId:me.target.structureId,drawPosition:Oe,tournamentRecord:U,drawDefinition:D,event:M}).error}}}({drawPositionToAdvance:t,inContextDrawMatchUps:e,sourceDrawPositions:i,tournamentRecord:n,drawDefinition:r,winnerMatchUp:b,matchUpsMap:o,event:s}),y&&g&&y.structureId!==(p==null?void 0:p.structureId)){const{roundNumber:T}=y;if(T===1){const S=Ms({structureId:v.target.structureId,drawPosition:I,tournamentRecord:n,drawDefinition:r,event:s});if(S.error)return S}else q7({loserTargetDrawPosition:I,tournamentRecord:n,loserTargetLink:v,drawDefinition:r,loserMatchUp:y,matchUpsMap:o,event:s})}return{...le}}function q7({loserTargetDrawPosition:t,tournamentRecord:e,loserTargetLink:i,drawDefinition:n,loserMatchUp:r,matchUpsMap:o,event:a}){const{roundNumber:s}=r;nl({method:"assignFedDrawPositionBye",color:"cyan",loserTargetDrawPosition:t});const l=((o==null?void 0:o.mappedMatchUps)||{})[r.structureId].matchUps,{initialRoundNumber:c}=ny({drawPosition:t,matchUps:l});if(c===s){const u=Ms({structureId:i.target.structureId,drawPosition:t,tournamentRecord:e,drawDefinition:n,event:a});if(u.error)return u}}function Hue({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:n,structure:r,event:o}){const{matchUps:a}=zi({drawDefinition:i,matchUpsMap:n,structure:r,event:o});a.forEach(s=>{const l=t.filter(({drawPosition:c})=>{var u;return(u=s.drawPositions)==null?void 0:u.includes(c)}).filter(c=>c.bye).length;s.winningSide||(Object.assign(s,{matchUpStatus:l?Ri:qn}),Ci({tournamentId:e==null?void 0:e.tournamentId,context:"modifyRoundRobinMatchUpsStatus",eventId:o==null?void 0:o.eventId,drawDefinition:i,matchUp:s}))})}function aC(t){let{inContextDrawMatchUps:e,participantId:i,drawPosition:n}=t;const{tournamentRecord:r,drawDefinition:o,structureId:a,matchUpsMap:s,event:l}=t,{structure:c}=kt({drawDefinition:o,structureId:a}),u=(Lr({drawDefinition:o,structure:c}).positionAssignments||[]).find(p=>i&&p.participantId===i||n&&p.drawPosition===n);if(u&&i&&!n&&(n=u==null?void 0:u.drawPosition),!n)return{error:xP};i||(i=u==null?void 0:u.participantId);const{activeDrawPositions:d}=oC({drawDefinition:o,structureId:a});return d.includes(n)?{error:zz}:(e||({matchUps:e}=Ar({inContext:!0,drawDefinition:o,matchUpsMap:s})),K2({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,structureId:a,drawPosition:n,matchUpsMap:s,event:l}).drawPositionCleared?(of({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:o,structure:c,event:l}),{...le,participantId:i}):{error:ZAe})}function K2({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,structureId:o,event:a}){const{structure:s}=kt({drawDefinition:i,structureId:o});if(!s)return{error:Cn};const l=Lr({drawDefinition:i,structure:s}).positionAssignments||[],c=l.some(y=>{if(y.drawPosition===n)return delete y.participantId,delete y.qualifier,delete y.bye,!0});if(s.structureType===na)return Hue({positionAssignments:l,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,structure:s}),{drawPositionCleared:c,...le};const{matchUps:u}=zi({drawDefinition:i,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:r,structure:s,event:a}),{roundProfile:d,roundMatchUps:p}=ba({matchUps:u}),h=d&&Object.keys(d),f=h==null?void 0:h.map(y=>Ct(y));let m=n;const g=f==null?void 0:f.map(y=>{var b,I,T;const S=d==null?void 0:d[y],w=(b=S==null?void 0:S.pairedDrawPositions)==null?void 0:b.find(A=>A.includes(m)),U=w==null?void 0:w.find(A=>A!==m),D=l.find(A=>A.drawPosition===U),E=d==null?void 0:d[y+1],C=D==null?void 0:D.bye,M=(I=E==null?void 0:E.pairedDrawPositions)==null?void 0:I.find(A=>A.includes(U)),N=C&&M&&E&&((T=E.drawPositions)==null?void 0:T.includes(U)),R=w&&{pairedDrawPositionByeAdvancedPair:!N&&M,pairedDrawPosition:U,targetDrawPosition:m,relevantPair:w,roundNumber:y};return N&&(m=U),R}).filter(y=>y==null?void 0:y.targetDrawPosition),v=g==null?void 0:g.reduce((y,b)=>{const{roundNumber:I,relevantPair:T,targetDrawPosition:S,pairedDrawPosition:w,pairedDrawPositionByeAdvancedPair:U}=b,D=[{roundNumber:I,targetDrawPosition:S,relevantPair:T},U&&{roundNumber:I+1,targetDrawPosition:w,relevantPair:U,subsequentRoundRemoval:!0}].filter(Boolean);return y.concat(...D)},[]);return v==null||v.forEach(({roundNumber:y,targetDrawPosition:b,relevantPair:I})=>{const T=p==null?void 0:p[y].find(S=>{var w;return ua((w=S.drawPositions)==null?void 0:w.filter(Boolean),I.filter(Boolean))});T&&(function({inContextDrawMatchUps:S,targetDrawPosition:w,tournamentRecord:U,drawDefinition:D,matchUpsMap:E,roundNumber:C,structureId:M}){const{structure:N}=kt({drawDefinition:D,structureId:M});if(!N)return{error:Cn};if(N.structureType===na)return;E=E||ma({drawDefinition:D});const R=(E==null?void 0:E.mappedMatchUps)||{},A=R[M].matchUps,{initialRoundNumber:_}=ny({drawPosition:w,matchUps:A}),k=A==null?void 0:A.filter(F=>{var B;return F.roundNumber>=C&&F.roundNumber!==_&&((B=F.drawPositions)==null?void 0:B.includes(w))}),O=Ki({drawDefinition:D,structureId:M}).positionAssignments??[];k==null||k.forEach(F=>Y7({drawPosition:w,targetMatchUp:F,inContextDrawMatchUps:S,positionAssignments:O,tournamentRecord:U,drawDefinition:D,matchUpsMap:E,structure:N}))}({inContextDrawMatchUps:t,targetDrawPosition:b,tournamentRecord:e,drawDefinition:i,structureId:o,roundNumber:y,matchUpsMap:r}),Y7({inContextDrawMatchUps:t,positionAssignments:l,tournamentRecord:e,drawDefinition:i,targetMatchUp:T,drawPosition:n,matchUpsMap:r,structure:s,event:a}))}),{tasks:v,drawPositionCleared:c,positionAssignments:l}}function Y7({inContextDrawMatchUps:t,positionAssignments:e,tournamentRecord:i,drawDefinition:n,targetMatchUp:r,drawPosition:o,matchUpsMap:a,structure:s,event:l}){var c,u,d,p,h;const f="removeDrawPosition",m=(c=r.drawPositions)==null?void 0:c.slice(),g=r.matchUpStatus,v=r.winningSide,y=(a=a??ma({drawDefinition:n})).mappedMatchUps[s.structureId].matchUps,{initialRoundNumber:b}=ny({drawPosition:o,matchUps:y});if(r.roundNumber&&b&&r.roundNumber>b){const M=(r.drawPositions??[]).map(N=>N===o?void 0:N);r.drawPositions=M}if(r.matchUpType===gn){const M=t==null?void 0:t.find(R=>R.matchUpId===r.matchUpId),N=((M==null?void 0:M.sides)??[]).reduce((R,A,_)=>A.drawPosition===o?_:R,void 0);N!==void 0&&(d=(u=r.sides)==null?void 0:u[N])!=null&&d.lineUp&&((p=r.sides)==null||delete p[N].lineUp,Ci({tournamentId:i==null?void 0:i.tournamentId,context:`${f}-TEAM`,eventId:l==null?void 0:l.eventId,matchUp:r,drawDefinition:n}))}const I=pa({matchUpId:r.matchUpId,inContextDrawMatchUps:t,drawDefinition:n}),{targetLinks:{winnerTargetLink:T},targetMatchUps:{loserMatchUp:S,winnerMatchUp:w,loserMatchUpDrawPositionIndex:U}}=I,D=e.filter(({drawPosition:M})=>{var N;return(N=r.drawPositions)==null?void 0:N.includes(M)}).filter(M=>M.bye).length,E=D&&Ri||r.matchUpStatus&&[Mi,Li].includes(r.matchUpStatus)&&r.matcHUpStatus||((h=r.drawPositions)==null?void 0:h.length)===2&&qn||void 0;r.matchUpStatus=E,r.matchUpStatus&&[Li,Mi].includes(r.matchUpStatus)&&(r.winningSide=void 0);const C=m==null?void 0:m.find(M=>{var N;return!((N=r.drawPositions)!=null&&N.includes(M))});if(m!=null&&m.includes(o)&&g===r.matchUpStatus&&v===r.winningSide||(C&&nl({method:f,color:"brightyellow",removedDrawPosition:C}),Ci({tournamentId:i==null?void 0:i.tournamentId,eventId:l==null?void 0:l.eventId,matchUp:r,context:`${f}-${o}`,drawDefinition:n})),S&&S.structureId!==I.matchUp.structureId&&!D){const{drawPositions:M,roundNumber:N}=S;if(N===1){const R=M[U];K2({structureId:S.structureId,drawPosition:R,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:a})}else{const R=Math.min(...M.filter(Boolean)),A=function({loserMatchUpDrawPosition:O,inContextDrawMatchUps:F,tournamentRecord:B,drawDefinition:$,loserMatchUp:V,matchUpsMap:H,event:z}){const{structure:G}=kt({structureId:V.structureId,drawDefinition:$}),{positionAssignments:W}=Ki({structure:G}),K=W==null?void 0:W.find(Z=>Z.drawPosition===O);if(K!=null&&K.bye){const Z=aC({drawPosition:O,structureId:V.structureId,inContextDrawMatchUps:F,tournamentRecord:B,drawDefinition:$,matchUpsMap:H,event:z});if(Z.error)return Z}return{...le}}({loserMatchUpDrawPosition:R,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,loserMatchUp:S,matchUpsMap:a,event:l});if(A.error)return ce({result:A,stack:f});const _=((a==null?void 0:a.mappedMatchUps)||{})[S.structureId].matchUps,{initialRoundNumber:k}=ny({drawPosition:R,matchUps:_});k===1&&(nl({method:f,color:"brightyellow",loserMatchUpDrawPosition:R}),K2({structureId:S.structureId,drawPosition:R,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:n,matchUpsMap:a}))}}return w&&w.structureId!==I.matchUp.structureId&&T.target.feedProfile,{...le}}function Pg({drawDefinition:t,stages:e}){if(!t)return{error:rt};const i=ti(((t==null?void 0:t.structures)??[]).filter(n=>!(e!=null&&e.length)||n.stage&&e.includes(n.stage)).map(n=>{const{positionAssignments:r}=Ki({structure:n});return r?r.map(li):[]}).flat().filter(Boolean));return{...le,assignedParticipantIds:i}}function Ac(t){const e=((t==null?void 0:t.entries)??[]).filter(Boolean).reduce((n,r)=>{const{entryStage:o,entryStatus:a}=r,s=`_${o||ct}${a||""}`;return n[s]||(n[s]=[]),n[s].push(r),n},{}),i=n=>isNaN(n)?1/0:n;return Object.keys(e).map(n=>e[n].sort((r,o)=>i(r.entryPosition)-i(o.entryPosition)).map((r,o)=>({...r,entryPosition:o+1}))).flat()}function im(t){return[ty,Fc].includes(t)}function MR({autoEntryPositions:t=!0,ignoreAssignment:e,tournamentRecord:i,drawDefinition:n,participantIds:r,entryStatus:o,entryStage:a,extension:s,eventSync:l,drawId:c,stage:u,event:d}){var p,h,f,m,g,v,y,b,I,T,S,w;if(!r||!Array.isArray(r))return{error:Dd,method:"modifyEntriesStatus",participantIds:r};if(!n&&!d)return{error:Fi};if(o&&!Bke.includes(o))return{error:O2};if(a&&!bW.includes(a))return{error:Wy};const U="modifyEntriesStatus",D=[];if(!o&&!s)return ce({result:{error:bt},info:"Missing entryStatus",stack:U});if(s&&!Eu({extension:s,requiredAttributes:["name"]}))return ce({result:{error:Re},info:"Invalid extension",context:{extension:s},stack:U});const E=[];(p=d==null?void 0:d.drawDefinitions)==null||p.forEach($=>{const V=Pg({stages:u&&[u],drawDefinition:$}).assignedParticipantIds??[];E.push(...V)});const C=(i==null?void 0:i.participants)??[];if(!r.every($=>{var V;const H=(V=ef({tournamentParticipants:C,participantId:$}))==null?void 0:V.participantType;return!(H&&[qt,il].includes(H)&&im(o)||o&&d!=null&&d.eventType&&H===ui&&[Bc,$c].includes(d.eventType)&&[Nc,...QO].includes(o))}))return{error:O2};const M=d&&Zn({event:d}).flightProfile,N=(h=M==null?void 0:M.flights)==null?void 0:h.find($=>$.drawId===c),R=$=>($||[]).filter(V=>!u||!V.entryStage||u===V.entryStage).filter(({participantId:V})=>r.includes(V)).every(V=>!((H=>o&&E.includes(H.participantId)&&!(QO.includes(H.entryStatus)&&QO.includes(o)))(V)&&!e)&&(o&&(V.entryStatus=o,delete V.entryPosition),a&&(V.entryStage=a,delete V.entryPosition),s&&(s.value?Ii({element:V,extension:s}):ia({element:V,name:s.name})),!0))?{...le}:{error:FP},A=({flight:$,drawDefinition:V})=>{d&&(d.entries=Ac({entries:d.entries??[]})),$&&($.drawEntries=Ac({entries:$.drawEntries})),V&&(V.entries=Ac({entries:V.entries}))},_=$=>{const{flight:V,drawDefinition:H}=$,z="updateDrawEntries";if(V){const G=R(V.drawEntries);if(G.error)return ce({result:G,stack:z})}if(H){const G=R(H.entries);if(G.error)return ce({result:G,stack:z});D.includes(H.drawId)||D.push(H.drawId)}return{...le}},k=((f=d==null?void 0:d.entries)==null?void 0:f.find(({entryPosition:$})=>$))??(((m=N==null?void 0:N.drawEntries)==null?void 0:m.find(({entryPosition:$})=>$))||((g=n==null?void 0:n.entries)==null?void 0:g.find(({entryPosition:$})=>$)));if(t&&!k&&A({flight:N,drawDefinition:n}),N||n){const $=_({flight:N,drawDefinition:n});if($.error)return ce({result:$,stack:U})}const O=((v=d==null?void 0:d.drawDefinitions)==null?void 0:v.map(({drawId:$})=>$))??[],F=((y=M==null?void 0:M.flights)==null?void 0:y.filter($=>!O.includes($.drawId)))||[];for(const $ of F){const V=$&&_({flight:$});if(V!=null&&V.error)return ce({result:V,stack:U})}const B=((b=M==null?void 0:M.flights)==null?void 0:b.length)===1&&(((I=d==null?void 0:d.drawDefinitions)==null?void 0:I.length)??0)<=((T=M==null?void 0:M.flights)==null?void 0:T.length);if(!N&&!n&&o&&Fke.includes(o))return{error:A_e};if(!N&&!n||o===af||l&&B){const $=R(d==null?void 0:d.entries);if($!=null&&$.error)return ce({result:$,stack:U});let V;if(o===af&&((S=M==null?void 0:M.flights)==null||S.every(H=>{const z=R(H.drawEntries);return z.error?(V=z.error,!1):(H.drawEntries=H.drawEntries.filter(({participantId:G})=>!r.includes(G)),!0)}),(w=d==null?void 0:d.drawDefinitions)==null||w.every(H=>{var z;const G=R(H.entries);return G.error?(V=G.error,!1):(H.entries=(z=H.entries)==null?void 0:z.filter(({participantId:W})=>!r.includes(W)),!0)})),V)return ce({result:{error:V},stack:U})}t&&A({flight:N,drawDefinition:n});for(const $ of(d==null?void 0:d.drawDefinitions)??[])D.length&&!D.includes($.drawId)||un({tournamentId:i.tournamentId,eventId:d==null?void 0:d.eventId,drawDefinition:$});return{...le}}function Gue(t){const{participantMap:e,participantId:i,matchUpStatus:n,roundPosition:r,structureId:o,matchUpType:a,roundNumber:s,matchUpId:l,potential:c,schedule:u,drawId:d,score:p}=t;!u||!Object.keys(u).length||n===Ri||e[i].scheduleItems.push({...u,scheduledDate:zt(u==null?void 0:u.scheduledDate),scheduledTime:mn(u==null?void 0:u.scheduledTime),checkScoreHasValue:lo({score:p}),matchUpStatus:n,roundPosition:r,structureId:o,matchUpType:a,roundNumber:s,matchUpId:l,potential:c,drawId:d})}function ud({requireTimeStamp:t,scaleAttributes:e,participant:i}){var n;if(!i)return{error:A0};if(!bn(e))return{error:Re};if(i.timeItems||(i.timeItems=[]),Array.isArray(i.timeItems)){const{accessor:r,scaleType:o,eventType:a,scaleName:s}=e,l=[lw,o,a,s].join("."),c=i.timeItems.filter(u=>(u==null?void 0:u.itemType)===l).filter(u=>!t||(u==null?void 0:u.itemDate)).sort((u,d)=>(u.createdAt?new Date(u.createdAt).getTime():0)-(d.createdAt?new Date(d.createdAt).getTime():0)).pop();if(c){const[u,d,p,h]=((n=c.itemType)==null?void 0:n.split("."))??[];if(u!==lw)return{error:ek};const f=r&&wv({element:c.itemValue,accessor:r}),m=(f==null?void 0:f.value)||c.itemValue,g={eventType:p,scaleDate:c.itemDate,scaleValue:m,scaleName:h,scaleType:d};return{...le,scaleItem:g}}}return{...le,scaleItem:void 0}}function uxe({publishedSeeding:t,usePublishState:e,withSeeding:i,participant:n,event:r}){var o,a,s;const l={},c=h=>[lw,ap,r.eventType,h].join("."),u=Object.assign({},...(n.timeItems||[]).filter(({itemType:h})=>h.split(".")[1]===ap).map(({itemType:h,itemValue:f})=>({[h]:f}))),d=((t==null?void 0:t.stageSeedingScaleNames)&&Object.values(t==null?void 0:t.stageSeedingScaleNames)||Array.isArray(t==null?void 0:t.seedingScaleNames)&&t.seedingScaleNames||[]).map(c),p=sr(Object.keys(u),d);if(!(e&&(Object.keys(u).length||(o=t==null?void 0:t.drawIds)!=null&&o.length)&&!p.length)&&p.length){if(t!=null&&t.stageSeedingScaleNames){const h=Object.keys(t.stageSeedingScaleNames).map(m=>{const g=c(t.stageSeedingScaleNames[m]);return[m,u[g]]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}else if(p){const h=p.map(f=>u[f]);l.seedValue=h.pop()}}else if(e||typeof i!="object"){const{categoryName:h,ageCategoryCode:f}=r.category||{},m=[f,r.eventId,h].filter(Boolean);let g;for(const v of m){const y=ud({scaleAttributes:{eventType:r.eventType,scaleType:ap,scaleName:v},participant:n});if(y.scaleItem){g=y.scaleItem;break}}if(g&&(!e||t!=null&&t.published&&!((s=(a=t==null?void 0:t.published)==null?void 0:a.drawIds)!=null&&s.length))){const v=g.scaleValue;l.seedValue=v}}else{const h=Object.keys(i).map(m=>{const g=c(i[m]);return[m,u[g]]}).filter(m=>m[1]).map(m=>({[m[0]]:{seedValue:m[1]}})),f=Object.assign({},...h);l.seedAssignments=f}return l}function dxe({convertExtensions:t,seedAssignments:e,participant:i,withSeeding:n,seedValue:r,eventId:o,ranking:a,entry:s}){const{entryStatus:l,entryStage:c,entryPosition:u,extensions:d}=s,p=d!=null&&d.length&&t?Object.assign({},...lW(d)):{},h=Object.assign(p,{entryPosition:u,entryStatus:l,entryStage:c,ranking:a,eventId:o});i.events[o]=It(h,!1,!1,!0),n&&(e&&(i.events[o].seedAssignments=e),r&&(i.events[o].seedValue=r))}function Rk(t,e){return(t||"").localeCompare(e||"")}function jW({tournamentRecord:t,status:e=ju}){var i,n,r;const o=`${eb}.${tb}`;return(r=(n=(i=rC({tournamentRecord:t,itemType:o}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function Xc({event:t,status:e=ju}){var i,n,r;const o=`${eb}.${tb}`;return(r=(n=(i=nC({itemType:o,event:t}))==null?void 0:i.timeItem)==null?void 0:n.itemValue)==null?void 0:r[e]}function HW({drawDetails:t,drawId:e}){var i;const n=(i=t==null?void 0:t[e])==null?void 0:i.publishingDetail;return n==null?void 0:n.published}function Nk({tournamentRecord:t,drawDefinition:e,eventIds:i,eventId:n,drawIds:r,drawId:o,event:a}){var s,l,c,u,d;if(n&&!a)return{error:sl};if(Array.isArray(i)&&i!=null&&i.length){const p={};for(const h of i){if(!La(h))return{error:Re};const f=us({tournamentRecord:t,eventId:h});if(!f)return{error:sl};const m=tL({event:f});if(m.error)return m;p[h]=m}return{...le,publishState:p}}if(!a){if(t){const p={},h=jW({tournamentRecord:t});p.tournament=h;for(const f of t.events??[]){const m=tL({event:f});if(p[f.eventId]=m,m.error)return m;for(const{drawId:g}of f.drawDefinitions??[]){if(!La(g))return{error:Re};const v=(l=(s=m.publishState)==null?void 0:s.publishedDrawIds)==null?void 0:l.includes(g);v&&(p[g]={status:{published:v}})}}return{...le,publishState:p}}return{error:je}}{const p=tL({event:a});if(p.error)return p;if(o)return e?{publishState:{status:{published:!!((c=p.status.publishedDrawIds)!=null&&c.includes(o)),drawDetail:(u=p.status.drawDetails)==null?void 0:u[o]},...le}}:{error:ml};if(!Array.isArray(r)||!(r!=null&&r.length))return{publishState:p};{const h={};for(const f of r)return La(f)?(h[f]={status:{published:!!p.status.publishedDrawIds.includes(f),drawDetail:(d=p.status.drawDetails)==null?void 0:d[f]}},{...le,publishState:h}):{error:Re}}}return{error:Re}}function tL({event:t}){var e;const i=Xc({event:t});if(!i)return{status:{published:!1}};const n={published:void 0,seedingScaleNames:[],drawIds:[]};i.seeding&&Object.assign(n,i.seeding);const r=i.drawDetails??{};for(const a of((e=t.drawDefinitions)==null?void 0:e.map(TR))||[])r[a]||(r[a]={publishingDetail:{published:!1}});const o=r&&Object.keys(r).filter(a=>HW({drawDetails:r,drawId:a}))||i.drawIds||[];return{status:{published:o.length>0,publishedDrawIds:o,publishedSeeding:n,drawDetails:r}}}function pxe({finishingPositionRange:t={},participantMap:e,finishingRound:i,participantWon:n,matchUpStatus:r,participantId:o,stageSequence:a,roundNumber:s,structureId:l,matchUpId:c,drawId:u,stage:d}){const p=e[o],h=y=>Math.abs(y[0]-y[1]);p.structureParticipation[l]||(p.structureParticipation[l]={rankingStage:d,walkoverWinCount:0,defaultWinCount:0,stageSequence:a,winCount:0,structureId:l,drawId:u});const f=p.structureParticipation[l],{winner:m,loser:g}=t,v=n?m:g;n&&(f.winCount+=1,r===Li&&(f.walkoverWinCount+=1),r===Mi&&(f.defaultWinCount+=1)),v&&(!f.finishingPositionRange||h(v)<h(f.finishingPositionRange))&&(f.finishingPositionRange=v),i&&((!f.finishingRound||i<f.finishingRound)&&(f.finishingMatchUpId=c,f.finishingRound=i,f.roundNumber=s),i===1&&(f.participantWon=n))}function K7(t){var e,i,n,r,o,a,s,l,c,u;const{withScheduleItems:d,scheduleAnalysis:p,withTeamMatchUps:h,participantMap:f,withOpponents:m,withMatchUps:g,withEvents:v,withDraws:y,finishingPositionRange:b,finishingRound:I,matchUpStatus:T,stageSequence:S,roundNumber:w,structureId:U,score:D,stage:E,withRankingProfile:C,tieWinningSide:M,roundPosition:N,matchUpTieId:R,matchUpSides:A,collectionId:_,matchUpType:k,winningSide:O,matchUpId:F,schedule:B,eventId:$,drawId:V,sides:H}=t,z=m&&(H==null?void 0:H.length)===2&&Object.assign({},...H.map(({sideNumber:G},W)=>{const K=H[1-W].participantId;return G&&{[G]:K}}).filter(Boolean));for(const G of H){const{participantId:W,sideNumber:K,bye:Z}=G;if(Z)continue;const Y=O===K,X=J=>{var ie,oe;const ne=(ie=f[J])==null?void 0:ie.participant,re=ne==null?void 0:ne.participantType,me=[{participantId:J,participantType:re}];if(re!==il)for(const he of(ne==null?void 0:ne.individualParticipantIds)||[]){const be=(oe=f[he])==null?void 0:oe.participant;me.push({participantType:be==null?void 0:be.participantType,participantId:he})}return me},Q=(J,ie)=>{if(g){if(f[J].matchUps[F]={participantWon:Y,matchUpType:k,structureId:U,sideNumber:K,matchUpId:F,eventId:$,drawId:V,stage:E},m){const oe=X(ie);f[J].matchUps[F].opponentParticipantInfo=oe}_&&(f[J].matchUps[F].collectionId=_)}m&&ie&&(f[J].opponents[ie]={participantId:ie,matchUpId:F,eventId:$,drawId:V}),C&&pxe({finishingPositionRange:b,participantMap:f,participantWon:Y,finishingRound:I,matchUpStatus:T,participantId:J,stageSequence:S,roundNumber:w,structureId:U,matchUpId:F,drawId:V,stage:E}),(p||d)&&Gue({participantMap:f,participantId:J,matchUpStatus:T,roundPosition:N,matchUpType:k,roundNumber:w,structureId:U,matchUpId:F,schedule:B,drawId:V,score:D})},te=({participant:J,partnerParticipantId:ie})=>{var oe,ne,re;const me=(he,be)=>{he&&(he.partnerParticipantIds||(he.partnerParticipantIds=[]),he.partnerParticipantIds.includes(be)||he.partnerParticipantIds.push(be))};y&&me((oe=J==null?void 0:J.draws)==null?void 0:oe[V],ie),v&&me((ne=J==null?void 0:J.events)==null?void 0:ne[$],ie),g&&me((re=J==null?void 0:J.matchUps)==null?void 0:re[F],ie)};if(W&&f[W]){const J=z==null?void 0:z[K];Q(W,J);const ie=((e=f[W])==null?void 0:e.participant.participantType)===qt,oe=((i=f[W])==null?void 0:i.participant.individualParticipantIds)||[];if(R){if(h){const ne=re=>f[re].matchUps[R]={participantWon:M===K,matchUpId:R,matchUpType:gn,sideNumber:K};ne(W),oe.forEach(ne)}if(y&&!f[W].draws[V]){const ne=(r=(n=A.find(he=>he.sideNumber===K))==null?void 0:n.participant)==null?void 0:r.participantId,re=(s=(a=(o=f[ne])==null?void 0:o.draws)==null?void 0:a[V])==null?void 0:s.entryStatus,me=he=>f[he].draws[V]={entryStatus:re,eventId:$,drawId:V};me(W),oe.forEach(me)}}if(ie&&(oe.forEach(ne=>f[ne]&&Q(ne,J)),oe.forEach((ne,re)=>{const me=oe[1-re],he=f[ne];he&&te({participant:he,partnerParticipantId:me})}),v&&A)){const ne=(c=(l=A.find(re=>re.sideNumber===K))==null?void 0:l.participant)==null?void 0:c.participantId;if(ne){const re=(u=f[ne])==null?void 0:u.events[$];re?(f[W].events[$]={...re},oe.forEach(me=>f[me].events[$]={...re})):console.log("Missing teamEntry",{eventId:$,teamParticipantId:ne})}}if(O){const ne=re=>{Y?(f[re].counters[k].wins+=1,f[re].counters.wins+=1,T===Li&&(f[re].counters[k].walkoverWins+=1,f[re].counters.walkoverWins+=1),T===Mi&&(f[re].counters[k].defaultWins+=1,f[re].counters.defaultWins+=1)):(f[re].counters[k].losses+=1,f[re].counters.losses+=1,T===Li&&(f[re].counters[k].walkovers+=1,f[re].counters.walkovers+=1),T===Mi&&(f[re].counters[k].defaults+=1,f[re].counters.defaults+=1))};ne(W),oe.forEach(ne)}}}}function sC({participantFilters:t={},tournamentRecord:e,participants:i=[]}){var n;if(!Object.keys(t).length)return i;const{accessorValues:r,drawEntryStatuses:o,positionedParticipants:a,eventEntryStatuses:s,participantRoles:l,participantRoleResponsibilities:c,participantTypes:u,participantIds:d,signInStatus:p,enableOrFiltering:h,eventIds:f,genders:m}=t,g=qu(f)&&((n=e==null?void 0:e.events)==null?void 0:n.filter(T=>f==null?void 0:f.includes(T.eventId)))||(e==null?void 0:e.events)||[],v=o&&function({drawEntryStatuses:T,tournamentEvents:S}){const w=({entryStatus:U})=>!Array.isArray(T)||T.includes(U);return ti(S.reduce((U,D)=>{var E,C;const{flightProfile:M}=Zn({event:D}),N=((E=M==null?void 0:M.flights)==null?void 0:E.map(({drawEntries:A})=>Array.isArray(A)?A.filter(w).map(li):[]).flat())||[],R=((C=D.drawDefinitions)==null?void 0:C.map(({entries:A})=>A?A.filter(w).map(li):[]))||[];return U.concat(...N,...R)},[]))}({drawEntryStatuses:o,tournamentEvents:g}),y=s&&function({eventEntryStatuses:T,tournamentEvents:S}){return ti(S.reduce((w,U)=>{const D=(U.entries||[]).filter(({entryStatus:E})=>!Array.isArray(T)||T.includes(E)).map(li);return w.concat(...D)},[]))}({eventEntryStatuses:s,tournamentEvents:g}),b=a!==void 0&&[!0,!1].includes(a)&&g.reduce((T,S)=>T.concat(...(S.drawDefinitions||[]).map(w=>oue({drawDefinition:w}).allPositionedParticipantIds).filter(Boolean)),[]),I=T=>r==null?void 0:r.reduce((S,w)=>{const{accessor:U,value:D}=w,{values:E}=wv({element:T,accessor:U});return S&&(E==null?void 0:E.includes(D))},!0);if(i=i==null?void 0:i.filter(T=>{var S,w;const U=(w=(S=Hu({element:T,itemType:vk}))==null?void 0:S.timeItem)==null?void 0:w.itemValue,{participantRoleResponsibilities:D,participantType:E,participantRole:C,participantId:M,person:N}=T,R=Array.isArray(m)&&(m==null?void 0:m.length)&&(N==null?void 0:N.sex)&&m.includes(N.sex);return h?m&&R||a&&b.includes(M)||a===!1&&!b.includes(M)||(v==null?void 0:v.includes(M))||(y==null?void 0:y.includes(M))||(d==null?void 0:d.includes(M))||p&&U===p||u&&E&&qu(u)&&u.includes(E)||l&&C&&qu(l)&&l.includes(C)||c&&qu(D)&&qu(c)&&c.find(A=>D==null?void 0:D.includes(A))||(r==null?void 0:r.length)&&qu(r)&&I(T):(!m||R)&&(a===void 0||a&&b.includes(M)||a===!1&&!b.includes(M))&&(!v||v.includes(M))&&(!y||y.includes(M))&&(!d||d.includes(M))&&(!p||U===p)&&(!u||E&&qu(u)&&u.includes(E))&&(!l||C&&qu(l)&&l.includes(C))&&(!c||qu(D)&&qu(c)&&c.find(A=>D==null?void 0:D.includes(A)))&&(!(r!=null&&r.length)||qu(r)&&I(T))}),g.length&&f){const T=g.filter(S=>f.includes(S.eventId)).map(S=>{const w=(S.entries||[]).map(D=>D.participantId);if(S.eventType===Np)return w;const U=((e==null?void 0:e.participants)??[]).filter(D=>w.includes(D.participantId)).map(D=>D.individualParticipantIds).flat(1);return w.concat(...U)}).flat(1);i=i==null?void 0:i.filter(S=>T.includes(S.participantId))}return i}function qu(t){return t&&Array.isArray(t)&&t.length}function Qn(t){const{withIndividualParticipants:e,participantFilters:i={},withPotentialMatchUps:n,withRankingProfile:r,convertExtensions:o,policyDefinitions:a,withScheduleItems:s,tournamentRecord:l,scheduleAnalysis:c,withSignInStatus:u,withTeamMatchUps:d,withScaleValues:p,usePublishState:h,contextProfile:f,withStatistics:m,withOpponents:g,withMatchUps:v,internalUse:y,withSeeding:b,withEvents:I,withDraws:T,withISO2:S,withIOC:w}=t;if(!l)return{error:je};(v||r)&&rc({tournamentRecord:l});let{participantMap:U}=jue({convertExtensions:o,tournamentRecord:l,withSignInStatus:u,withScaleValues:p,internalUse:y,withISO2:S,withIOC:w});const D=function(H){var z,G,W,K,Z;const{participantFilters:Y,convertExtensions:X,policyDefinitions:Q,tournamentRecord:te,usePublishState:J,contextProfile:ie,participantMap:oe,withPotentialMatchUps:ne,withRankingProfile:re,withScheduleItems:me,scheduleAnalysis:he,withTeamMatchUps:be,withStatistics:Se,withOpponents:De,withMatchUps:Oe,withSeeding:xe,withEvents:$e,withDraws:Ae}=H,ve=Y==null?void 0:Y.participantIds,ke=fe=>{var Te,ue;const de=[fe];return(ue=(Te=oe[fe])==null?void 0:Te.participant.individualParticipantIds)==null||ue.forEach(_e=>de.push(_e)),de.some(_e=>!(ve!=null&&ve.length)||ve.includes(_e))?de:[]},ye={withMatchUps:Oe||re,withEvents:$e||re,withDraws:Ae||re,withPotentialMatchUps:ne,withRankingProfile:re,withScheduleItems:me,scheduleAnalysis:he,withTeamMatchUps:be,withStatistics:Se,participantMap:oe,withOpponents:De,withSeeding:xe},Ie=[],Ne={},Fe=[],Le={},ge={},Ee={},we=({eventType:fe,scaleNames:Te,participantId:ue})=>{var de,_e,Ue,Ce;return(Ce=(Ue=(_e=(de=oe[ue].participant)==null?void 0:de.rankings)==null?void 0:_e[fe])==null?void 0:Ue.find(We=>Te.includes(We.scaleName)))==null?void 0:Ce.scaleValue};for(const fe of(te==null?void 0:te.events)||[]){if(Y!=null&&Y.eventIds&&!Y.eventIds.includes(fe.eventId))continue;const{drawDefinitions:Te=[],extensions:ue=[],eventType:de,eventName:_e,category:Ue,entries:Ce,eventId:We,gender:He}=fe,{flightProfile:Be}=Zn({event:fe}),et=(Be==null?void 0:Be.flights)??[],ot=Nk({event:fe}).publishState;ot&&(Le[We]=ot);const mt=(z=ot==null?void 0:ot.status)==null?void 0:z.publishedSeeding;if($e||xe||re){const Ft=X?Object.assign({},...lW(ue)):{};ge[We]={...Ft,eventName:_e,eventType:de,category:Ue,eventId:We,gender:He};const Je=[Ue==null?void 0:Ue.categoryName,Ue==null?void 0:Ue.ageCategoryCode].filter(Boolean);for(const _t of Ce){const{participantId:pt}=_t;if(!pt||!oe[pt])continue;const Ke=we({eventType:de,scaleNames:Je,participantId:pt});let ci,ni;if(xe){const Zi=oe[pt].participant;({seedAssignments:ci,seedValue:ni}=uxe({publishedSeeding:mt,usePublishState:J,withSeeding:xe,participant:Zi,event:fe}))}const Ht=Zi=>{var Xi,wi;if((wi=(Xi=oe[Zi])==null?void 0:Xi.events)!=null&&wi[We])return;const Ji=oe[Zi];dxe({convertExtensions:X,seedAssignments:ci,participant:Ji,withSeeding:xe,seedValue:ni,eventId:We,ranking:Ke,entry:_t})};Ht(pt),(oe[pt].participant.individualParticipantIds||[]).forEach(Ht)}}const Rt=(G=Le==null?void 0:Le[We])==null?void 0:G.publishedSeeding;if(Ae||re||xe){const Ft=_t=>_t?Object.assign({},..._t.map(({participantId:pt,seedValue:Ke,seedNumber:ci})=>({[pt]:{seedValue:Ke,seedNumber:ci}}))):void 0,Je=ti([...Te.map(TR),...et.map(TR)]);for(const _t of Je){const pt=Te.find(yt=>yt.drawId===_t),Ke=et==null?void 0:et.find(yt=>yt.drawId===_t),ci=(pt==null?void 0:pt.entries)||(Ke==null?void 0:Ke.drawEntries),{structures:ni=[],drawOrder:Ht,drawName:Zi,drawType:Xi}=pt??{},wi=Ke==null?void 0:Ke.flightNumber,Ji=[Ue==null?void 0:Ue.categoryName,Ue==null?void 0:Ue.ageCategoryCode].filter(Boolean),Yt=((pt==null?void 0:pt.structures)||[]).sort((yt,pi)=>Zy(yt,pi)).map(({structureId:yt,structures:pi})=>[yt,...(pi||[]).map(({structureId:cr})=>cr)]).flat(1/0);let _n,Gr,qo,Ea,ga=0;const Ma=ni.filter(({stage:yt,stageSequence:pi})=>yt===ct&&pi===1||yt===St).flatMap(yt=>{const{seedAssignments:pi,stageSequence:cr,stage:va}=yt,{positionAssignments:Ur}=Ki({structure:yt});return va===ct?(ga=(Ur==null?void 0:Ur.length)??0,qo=Ur,Ea=pi):cr===1&&(_n=Ur,Gr=pi),Ur}).map(({participantId:yt})=>yt).filter(Boolean),er=Ft(Ea),Gt=Ft(Gr),Jc=pt?ci.filter(({participantId:yt})=>Ma.includes(yt)):ci,sc=!J||(Rt==null?void 0:Rt.published)&&(((W=Rt==null?void 0:Rt.drawIds)==null?void 0:W.length)===0||((K=Rt==null?void 0:Rt.drawIds)==null?void 0:K.includes(_t)));for(const yt of Jc){const{entryStatus:pi,entryStage:cr,entryPosition:va,participantId:Ur}=yt,tn=we({participantId:Ur,scaleNames:Ji,eventType:de}),Xn=Do=>{var Tl,qa,Qi,hi,ur;if((Tl=oe[Do].draws)!=null&&Tl[_t])return;const Xt=xe&&sc,yn=Xt?{}:void 0,at=Xt?((qa=er==null?void 0:er[Ur])==null?void 0:qa.seedValue)||((Qi=er==null?void 0:er[Ur])==null?void 0:Qi.seedNumber):void 0,Mt=at?er==null?void 0:er[Ur]:void 0,Kt=Xt?((hi=Gt==null?void 0:Gt[Ur])==null?void 0:hi.seedValue)||((ur=Gt==null?void 0:Gt[Ur])==null?void 0:ur.seedNumber):void 0,Si=Kt?Gt==null?void 0:Gt[Ur]:void 0;yn&&at&&(yn[ct]=Mt),yn&&Kt&&(yn[St]=Si);const Pt=at||Kt;Pt&&(oe[Do].participant.seedings[de]||(oe[Do].participant.seedings[de]=[]),Mt&&oe[Do].participant.seedings[de].push({...Mt,scaleName:_t}),Si&&oe[Do].participant.seedings[de].push({...Si,scaleName:_t}),yn&&(oe[Do].events[We].seedAssignments||(oe[Do].events[We].seedAssignments={}),Object.keys(yn).forEach(ri=>oe[Do].events[We].seedAssignments[ri]=yn[ri]))),(Ae||re)&&(oe[Do].draws[_t]=It({seedAssignments:yn,entryPosition:va,entryStatus:pi,entryStage:cr,seedValue:Pt,eventId:We,ranking:tn,drawId:_t},!1,!1,!0))};if(![Fc,ty].includes(pi)){Xn(Ur);const Do=oe[Ur].participant.individualParticipantIds||[];Do==null||Do.forEach(Xn)}}const Ls=((pt==null?void 0:pt.structures)??[]).reduce((yt,pi)=>(yt.includes(pi.stage)||yt.push(pi.stage),yt),[]),Ze=((pt==null?void 0:pt.links)??[]).length;Ee[_t]={qualifyingPositionAssignments:_n,qualifyingSeedAssignments:Gr,mainPositionAssignments:qo,qualifyingSeedingMap:Gt,mainSeedAssignments:Ea,orderedStructureIds:Yt,mainSeedingMap:er,flightNumber:wi,linksCount:Ze,drawOrder:Ht,drawName:Zi,drawType:Xi,drawSize:ga,drawId:_t,stages:Ls}}}if(re||he||be||Se||De||Oe||Ae){const Ft=!!he||ne,Je=((Z=Qp({afterRecoveryTimes:!!he,policyDefinitions:Q,tournamentRecord:te,inContext:!0,contextProfile:ie,participantMap:oe,nextMatchUps:Ft,event:fe}))==null?void 0:Z.matchUps)??[];for(const _t of Je){const{finishingPositionRange:pt,potentialParticipants:Ke,tieMatchUps:ci=[],sides:ni=[],winningSide:Ht,matchUpType:Zi,matchUpId:Xi,eventId:wi,drawId:Ji,collectionId:Yt,stageSequence:_n,finishingRound:Gr,matchUpStatus:qo,roundPosition:Ea,roundNumber:ga,structureId:Ma,schedule:er,score:Gt,stage:Jc}=_t;Ne[Xi]=_t;const sc={finishingPositionRange:pt,finishingRound:Gr,stageSequence:_n,roundPosition:Ea,collectionId:Yt,roundNumber:ga,structureId:Ma,schedule:er,eventId:wi,drawId:Ji,score:Gt,stage:Jc};K7({...sc,...ye,matchUpStatus:qo,winningSide:Ht,matchUpType:Zi,matchUpId:Xi,sides:ni});for(const Ls of ci){const{winningSide:Ze,sides:yt=[],matchUpId:pi,matchUpStatus:cr,matchUpType:va}=Ls;K7({...sc,...ye,winningSide:Ze,tieWinningSide:Ht,matchUpTieId:Xi,matchUpId:pi,sides:yt,matchUpSides:ni,matchUpStatus:cr,matchUpType:va})}if(Array.isArray(Ke)&&(Ft||he||me)){const Ls=Ke.flat().map(li).filter(Boolean);Ls==null||Ls.forEach(Ze=>{const yt=ke(Ze);yt==null||yt.forEach(pi=>{oe[pi]&&(oe[pi].potentialMatchUps[Xi]=It({tournamentId:te==null?void 0:te.tournamentId,matchUpId:Xi,eventId:wi,drawId:Ji}))}),(he||me)&&Gue({potential:!0,participantMap:oe,participantId:Ze,matchUpStatus:qo,roundPosition:Ea,structureId:Ma,matchUpType:Zi,roundNumber:ga,matchUpId:Xi,schedule:er,drawId:Ji,score:Gt})})}}Fe.push(...Je)}}if(Se||re||he){const fe=Object.values(oe);for(const Te of fe){const{wins:ue,losses:de,[vr]:{wins:_e,losses:Ue},[Pn]:{wins:Ce,losses:We}}=Te.counters,He=(Be,et,ot)=>{const mt=et+ot,Rt=et,Ft=mt&&Rt/mt;Te.statistics[Be]={denominator:mt,numerator:Rt,statValue:Ft,statCode:Be}};if(Se&&(He(FE,ue,de),He(`${FE}.${vr}`,_e,Ue),He(`${FE}.${Pn}`,Ce,We)),re){const Be=(et=[])=>Math.abs(et[0]-et[1]);for(const et of Object.keys(Te.draws)){const{orderedStructureIds:ot=[],flightNumber:mt}=Ee[et]||{};if(Te.structureParticipation&&ot.length){let Rt,Ft=0;const Je=ot.map(_t=>{const pt=Te.structureParticipation[_t];if(!pt)return;Rt||(Rt=pt==null?void 0:pt.finishingPositionRange),Be(Rt)>Be(pt==null?void 0:pt.finishingPositionRange)&&(Rt=pt==null?void 0:pt.finishingPositionRange);const Ke=pt.stage!==St;return Ke&&(Ft+=1),It({...pt,participationOrder:Ke?Ft:void 0,flightNumber:mt})}).filter(Boolean);Te.draws[et]&&(Te.draws[et].finishingPositionRange=Rt,Te.draws[et].structureParticipation=Je)}}}if(he){const Be=bn(he)?he.scheduledMinutesDifference:0,et=Te.scheduleItems||[],ot=Te.potentialMatchUps||{},mt=et.reduce((Ft,Je)=>{const{scheduledDate:_t,scheduledTime:pt}=Je;return Ft[_t]||(Ft[_t]=[]),pt&&Ft[_t].push(Je),Ft},{});Object.values(mt).forEach(Ft=>Ft.sort(Mce));for(const Ft of et){const{typeChangeTimeAfterRecovery:Je,timeAfterRecovery:_t,scheduledDate:pt,scheduledTime:Ke}=Ft,ci=mt[pt],ni=gi(Ke);for(const Ht of ci){if(Ht.matchUpId===Ft.matchUpId||[Li,Mi].includes(Ht.matchUpStatus)&&!Ht.checkScoreHasValue)continue;const Zi=Ft.matchUpType!==Ht.matchUpType&&Je||_t,Xi=Ft.drawId===Ht.drawId,wi=ot[Ft.matchUpId]&&ot[Ht.matchUpId],Ji=gi(Ht.scheduledTime),Yt=Math.abs(Ji-ni),_n=Ji>=ni;if((Be&&!isNaN(Be)?Yt<=Be:_n&&gi(Ht.scheduledTime)<gi(Zi))&&(!wi||!Xi)&&_n){const Gr=[Ft.matchUpId,Ht.matchUpId].sort(Rk).join("|");Te.scheduleConflicts[Gr]={priorScheduledMatchUpId:Ft.matchUpId,matchUpIdWithConflict:Ht.matchUpId}}}}const Rt=Te.participant.participantId;Object.keys(Te.scheduleConflicts).length&&Ie.push(Rt),oe[Rt].scheduleConflicts=Te.scheduleConflicts}}}return{participantIdsWithConflicts:Ie,eventsPublishStatuses:Le,derivedEventInfo:ge,derivedDrawInfo:Ee,mappedMatchUps:Ne,participantMap:oe,matchUps:Fe}}({withMatchUps:v??r,withEvents:I??r,withDraws:T??r,withPotentialMatchUps:n,participantFilters:i,withRankingProfile:r,convertExtensions:o,withScheduleItems:s,policyDefinitions:a,tournamentRecord:l,scheduleAnalysis:c,withTeamMatchUps:d,usePublishState:h,withStatistics:m,participantMap:U,withOpponents:g,contextProfile:f,withSeeding:b}),{participantIdsWithConflicts:E,eventsPublishStatuses:C,derivedEventInfo:M,derivedDrawInfo:N,mappedMatchUps:R}=D,A=D.matchUps;U=D.participantMap;const _=c??n,k=({potentialMatchUps:H,scheduleConflicts:z,scheduleItems:G,participant:W,statistics:K,opponents:Z,matchUps:Y,events:X,draws:Q})=>{const te=Object.values(Q),J=Object.values(Z);return g&&(te==null||te.forEach(ie=>{ie.opponents=J.filter(oe=>oe.drawId===ie.drawId)})),It({...W,scheduleConflicts:c?Object.values(z):void 0,draws:T||r?te:void 0,events:I||r?Object.values(X):void 0,matchUps:v||r?Object.values(Y):void 0,opponents:g?J:void 0,potentialMatchUps:_?Object.values(H):void 0,statistics:m?Object.values(K):void 0,scheduleItems:s?G:void 0},!1,!1,!0)},O=new Map;for(const H of Object.keys(U))O.set(H,k(U[H]));const F=[...O.values()],B=a==null?void 0:a[ok],$=B==null?void 0:B.participant,V=sC({participants:F,participantFilters:i,tournamentRecord:l});if(e){const H=bn(e)?e:void 0;for(const z of V)for(const G of z.individualParticipantIds??[]){z.individualParticipants||(z.individualParticipants=[]);const W=O.get(G);z.individualParticipants.push(H?Kv({template:H,source:W}):W)}}return{participantIdsWithConflicts:E,eventsPublishStatuses:C,derivedEventInfo:M,derivedDrawInfo:N,mappedMatchUps:R,participantMap:U,participants:$?V.map(H=>Kv({source:H,template:$})):V,...le,matchUps:A}}function Uv({participantId:t,drawDefinition:e,entryStatus:i,entryStage:n}){var r;if(!e)return{error:rt};const o=(r=e.entries)==null?void 0:r.find(a=>!(a.participantId!==t||i&&i!==a.entryStatus||n&&n!==a.entryStage));return t&&o}function G0(t){var e,i,n,r,o,a,s,l;const{provisionalPositioning:c,drawDefinition:u,stageSequence:d,structureId:p,stage:h}=t;if(!u)return{error:rt};const{entryProfile:f}=DU({drawDefinition:u}),m=h&&d&&((n=(i=(e=f==null?void 0:f[h])==null?void 0:e.stageSequence)==null?void 0:i[d])==null?void 0:n.qualifiersCount)||h&&((r=f==null?void 0:f[h])==null?void 0:r.qualifiersCount)||0,g={};if(!p)return{qualifiersCount:m,roundQualifiersCounts:g};const{structure:v}=kt({drawDefinition:u,structureId:p}),y=(o=u.links)==null?void 0:o.filter(T=>{var S;return((S=T==null?void 0:T.target)==null?void 0:S.structureId)===(v==null?void 0:v.structureId)});let b=0;if(y!=null&&y.length)for(const T of y){const S=(a=kt({structureId:T.source.structureId,drawDefinition:u}))==null?void 0:a.structure;if((S==null?void 0:S.stage)===St){const w=T.source.roundNumber,U=T.target.roundNumber;let D=0;if(S.structureType===na)D=(((s=S.structures)==null?void 0:s.length)??0)*(((l=T.source.finishingPositions)==null?void 0:l.length)??0);else{const E=zi({matchUpFilters:{roundNumbers:[w]},structure:S,afterRecoveryTimes:!1,provisionalPositioning:c,inContext:!1}).matchUps;D=(E==null?void 0:E.length)||0}g[U]||(g[U]=0),g[U]+=D,b+=D}}const I=Object.keys(g);if(I.length<=1){const T=I[0]||1;g[T]=Math.max(g[T]||0,m)}return b=Math.max(b,m),{qualifiersCount:b,roundQualifiersCounts:g}}function RR({stage:t,drawDefinition:e}){var i;const{entryProfile:n}=DU({drawDefinition:e});return((i=n==null?void 0:n[t])==null?void 0:i.drawSize)||0}function zue({stage:t,drawDefinition:e}){return!!(t===qr||AW({stage:t,drawDefinition:e})&&RR({stage:t,drawDefinition:e}))}function Wue({entryStatus:t=cl,drawDefinition:e,stageSequence:i,stage:n}){if(t===Nc)return function({stage:c,drawDefinition:u}){var d;const{entryProfile:p}=DU({drawDefinition:u});return((d=p[c])==null?void 0:d.alternates)||0}({stage:n,drawDefinition:e})?{positionsAvailable:1/0,...le}:{error:N_e};const r=function(c){const{provisionalPositioning:u,drawDefinition:d,stageSequence:p,stage:h}=c,f=RR({stage:h,drawDefinition:d}),{qualifiersCount:m}=G0({provisionalPositioning:u,drawDefinition:d,stageSequence:p,stage:h});return f&&f-m}({drawDefinition:e,stageSequence:i,stage:n}),o=function({stage:c,drawDefinition:u}){var d;const{entryProfile:p}=DU({drawDefinition:u});return((d=p[c])==null?void 0:d.wildcardsCount)||0}({drawDefinition:e,stage:n}),a=z2({entryStatus:PU,drawDefinition:e,stage:n}),s=a+z2({entryStatus:cl,drawDefinition:e,stage:n}),l=r-s;return n!==qr&&s>=r?{error:D7}:t===PU?a<o?{...le}:{error:D7}:{positionsAvailable:l,...le}}function que(t){const{entryStatus:e=cl,entryStageSequence:i,entryStage:n=ct,ignoreStageSpace:r,drawDefinition:o,entryPosition:a,participant:s,roundTarget:l,extensions:c,extension:u,drawType:d}=t,p="addDrawEntry";if(!o)return{error:rt};if(!n)return{error:tce};if(d!==ll&&!zue({stage:n,drawDefinition:o}))return ce({result:{error:Wy},stack:p});const h=Wue({stageSequence:i,stage:n,drawDefinition:o,entryStatus:e});if(!r&&!h.success)return{error:h.error};if(u&&!Eu({extension:u}))return ce({result:{error:Re},info:"Invalid extension",context:{extension:u},stack:p});const f=t.participantId||(s==null?void 0:s.participantId);if(!f)return ce({result:{error:Hr},stack:p});const m=e===Nh&&Uv({participantId:f,drawDefinition:o,entryStatus:e}),g=n===qr&&Uv({participantId:f,drawDefinition:o,entryStage:n}),v=e!==Nh&&n!==qr&&Uv({drawDefinition:o,participantId:f});if(v||m||g)return ce({context:{invalidEntry:v,invalidLuckyLoser:m,invalidVoluntaryConsolation:g},result:{error:Xz},stack:p});const y=It({entryStageSequence:i,participantId:f,entryPosition:a,entryStatus:e,entryStage:n,extensions:c});return u&&Ii({element:y,extension:u}),l&&Ii({extension:{name:"roundEntry",value:l},element:y}),o.entries||(o.entries=[]),o.entries.push(y),un({drawDefinition:o}),{...le}}function GW({autoEntryPositions:t=!0,entryStageSequence:e,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:o,roundTarget:a,entryStage:s,extension:l,drawId:c,event:u}){if(!(r!=null&&r.length))return{error:Ig};if(!u)return{error:sl};if(!c)return{error:Yc};const d=(u.entries||[]).map(li);if(r.filter(f=>!d.includes(f)).length)return{error:l_e};if(n){const f=function(m){const{entryStatus:g=cl,stage:v=ct,autoEntryPositions:y=!0,ignoreStageSpace:b,drawDefinition:I,participantIds:T,stageSequence:S,roundTarget:w,extension:U}=m;if(!v)return{error:tce};if(!I)return{error:rt};if(!Array.isArray(T))return{error:Ec};if(!zue({stage:v,drawDefinition:I}))return{error:Wy};if(U&&!Eu({extension:U}))return ce({result:{error:Re},info:"Invalid extension",context:{extension:U},stack:"addDrawEntries"});const D=Wue({drawDefinition:I,stageSequence:S,entryStatus:g,stage:v});if(!b&&!D.success)return{error:D.error};const E=D.positionsAvailable??0;if(!b&&v!==qr&&E<T.length)return{error:uce};const C=T.reduce((M,N)=>{const R=g===Nh&&Uv({participantId:N,drawDefinition:I,entryStatus:g}),A=v===qr&&Uv({entryStage:v,drawDefinition:I,participantId:N});return g!==Nh&&v!==qr&&Uv({drawDefinition:I,participantId:N})||R||A?M.concat(N):M},[]);return T.filter(M=>M&&!C.includes(M)).forEach(M=>{const N={entryStageSequence:S,entryStage:v,participantId:M,entryStatus:g};U&&Ii({element:N,extension:U}),w&&Ii({extension:{name:$u,value:w},element:N}),I.entries||(I.entries=[]),I.entries.push(N)}),y&&(I.entries=Ac({entries:I.entries})),un({drawDefinition:I}),C!=null&&C.length?{info:"some participantIds could not be added",participantIdsNotAdded:C,...le}:{...le}}({stageSequence:e,autoEntryPositions:t,stage:s,ignoreStageSpace:i,drawDefinition:n,participantIds:r,entryStatus:o,roundTarget:a,extension:l});if(f.error)return f}const{flightProfile:p}=Zn({event:u}),h=p==null?void 0:p.flights.find(f=>f.drawId===c);return h!=null&&h.drawEntries&&(r.forEach(f=>{const m=o===Nh&&iL({participantId:f,entryStatus:o,flight:h}),g=s===qr&&iL({participantId:f,entryStage:s,flight:h});o!==Nh&&s!==qr&&iL({flight:h,participantId:f})||m||g||h.drawEntries.push({participantId:f,entryStatus:o,entryStage:s})}),t&&(h.drawEntries=Ac({entries:h.drawEntries}))),{...le}}function iL({participantId:t,entryStatus:e,entryStage:i,flight:n}){var r;const o=(r=n.drawEntries)==null?void 0:r.find(a=>!(a.participantId!==t||e&&e!==a.entryStatus||i&&i!==a.entryStage));return t&&o}function lC({autoEntryPositions:t=!0,participantIds:e=[],entryStatuses:i,stage:n,event:r}){var o,a,s,l;const c="removeEventEntries";if(!(r!=null&&r.eventId))return{error:Fi};if(!Array.isArray(e)||e.some(m=>!La(m)))return ce({result:{error:Dd},stack:c});const u=(r.drawDefinitions??[]).flatMap(m=>Pg({drawDefinition:m}).assignedParticipantIds??[]),d=((i==null?void 0:i.length)&&((o=r.entries)==null?void 0:o.filter(m=>m.entryStatus&&i.includes(m.entryStatus)))||[]).map(li).filter(m=>!u.includes(m)),p=(n&&((a=r.entries)==null?void 0:a.filter(m=>m.entryStage&&m.entryStage===n))||[]).map(li).filter(m=>!u.includes(m));if(e.length?e=e.filter(m=>(!(i!=null&&i.length)||d.includes(m))&&(!n||p.includes(m))):d.length&&p.length?e=sr(d,p):d.length?e=d:p.length&&(e=p),(e==null?void 0:e.length)&&u.some(m=>e.includes(m)))return ce({result:{error:FP},stack:c});if(!(e!=null&&e.length))return{...le,participantIdsRemoved:[]};const h=[];r.entries=(r.entries??[]).filter(m=>{const g=!e.includes(m==null?void 0:m.participantId);return g||h.push(m.participantId),g}),t&&(r.entries=Ac({entries:r.entries}));const{flightProfile:f}=Zn({event:r});return(s=f==null?void 0:f.flights)==null||s.forEach(m=>{m.drawEntries=(m.drawEntries||[]).filter(g=>!e.includes(g.participantId))}),(l=r.drawDefinitions)==null||l.forEach(m=>{m.entries=(m.entries??[]).filter(g=>!e.includes(g.participantId))}),{...le,participantIdsRemoved:h}}const ab={[so]:{policyName:"matchUpActionsDefault",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[],disabledActions:[]}],participants:{enforceCategory:!0,enforceGender:!0},processCodes:{substitution:["RANKING.IGNORE","RATING.IGNORE"]},substituteAfterCompleted:!1,substituteWithoutScore:!1}};function dd(t){var e,i;const{entryStatus:n=cl,autoEntryPositions:r=!0,enforceGender:o=!0,participantIds:a=[],entryStageSequence:s,policyDefinitions:l,entryStage:c=ct,tournamentRecord:u,ignoreStageSpace:d,drawDefinition:p,roundTarget:h,extensions:f,extension:m,drawId:g,event:v}=t,y="addEventEntries";if(!v)return{error:Fi};if(!(a!=null&&a.length))return ce({result:{error:Ig},stack:y});if(!(v!=null&&v.eventId))return{error:sl};const b=Gi({tournamentRecord:u,event:v}).appliedPolicies??{},I=(l==null?void 0:l[so])??(b==null?void 0:b[so])??ab[so],T=(o??((e=I==null?void 0:I.participants)==null?void 0:e.enforceGender))!==!1,S=[],w=[];if(f&&(!Array.isArray(f)||!f.every(A=>Eu({extension:A})))||m&&!Eu({extension:m}))return ce({context:It({extension:m,extensions:f}),result:{error:Re},info:"Invalid extension(s)",stack:y});const U=!!u,D=[];let E;const C=((i=u==null?void 0:u.participants)==null?void 0:i.filter(A=>{var _,k,O;if(!a.includes(A.participantId))return!1;const F=v.eventType===vr&&A.participantType===ui&&!im(n),B=v.eventType===Pn&&A.participantType===qt;return!(!F||v.gender&&T&&![is,Ru].includes(v.gender)&&v.gender!==((_=A.person)==null?void 0:_.sex))||!(!B||im(n))||!(v.eventType!==Pn||A.participantType!==ui||!im(n))||(F&&v.gender&&T&&![is,Ru].includes(v.gender)&&v.gender!==((k=A.person)==null?void 0:k.sex)?(D.push({participantId:A.participantId,sex:(O=A.person)==null?void 0:O.sex}),!1):v.eventType===on&&(A.participantType===on||im(n)&&A.participantType===ui))}).map(A=>A.participantId))??[],M=a.filter(A=>!U||C.includes(A));v.entries||(v.entries=[]);const N=v.entries.map(A=>{var _;return A.participantId||((_=A.participant)==null?void 0:_.participantId)});if(M.forEach(A=>{var _;if(!N.includes(A)){const k=It({participantId:A,entryStatus:n,entryStage:c,extensions:f});m&&Ii({element:k,extension:m}),h&&Ii({extension:{name:$u,value:h},element:k}),s&&(k.entryStageSequence=s),S.push(k.participantId),(_=v.entries)==null||_.push(k)}}),g&&!im(c)){const A=GW({participantIds:M,autoEntryPositions:r,entryStageSequence:s,ignoreStageSpace:d,drawDefinition:p,entryStatus:n,roundTarget:h,entryStage:c,extension:m,drawId:g,event:v});A.error&&(E=A.error)}if(v.eventType&&[Wm,$c].includes(v.eventType)){const A=(v.entries||[]).map(F=>F.participantId),_=(v.entries||[]).filter(F=>im(F.entryStatus)).map(F=>F.participantId),k=((u==null?void 0:u.participants)??[]).filter(F=>A.includes(F.participantId)&&F.participantType&&[qt,on].includes(F.participantType)).map(F=>F.individualParticipantIds).flat(1/0),O=_.filter(F=>k.includes(F));O.length&&(w.push(...O),lC({participantIds:O,autoEntryPositions:!1,event:v}))}if(M.length!==a.length)return ce({context:{mismatchedGender:D,gender:v.gender},result:{error:Ec},stack:y});r&&(v.entries=Ac({entries:v.entries||[]}));const R=S.length-w.length;return ce({result:{...le,addedEntriesCount:R},stack:y,info:E})}const Ro="COMPETITOR",Yue="OFFICIAL",Kue="OTHER",Zue={ADMINISTRATION:"ADMINISTRATION",CAPTAIN:"CAPTAIN",COACH:"COACH",COMPETITOR:Ro,MEDIA:"MEDIA",MEDICAL:"MEDICAL",OFFICIAL:Yue,OTHER:Kue,SECURITY:"SECURITY"};function zW({addIndividualParticipantsToEvents:t,individualParticipantIds:e,groupingParticipantId:i,tournamentRecord:n,suppressErrors:r}){const o="removeIndividualParticipantIds";if(!n)return ce({result:{error:je},stack:o});if(!i||!e)return ce({result:{error:bt},stack:o});const a=(n.participants??[]).find(u=>u.participantId===i);if(!a)return ce({result:{error:rr},stack:o});if(![on,gl].includes(a.participantType))return ce({result:{participantType:a.participantType,error:Cu},stack:o});const s=Xue({individualParticipantIds:e,groupingParticipant:a,tournamentRecord:n,suppressErrors:r}),{removed:l,error:c}=s;if(c)return ce({result:s,stack:o});if(t)for(const u of n.events??[]){const d=(u.entries??[]).map(({participantId:p})=>p).filter(Boolean);if(d.includes(i)){const p=l==null?void 0:l.filter(h=>!d.includes(h));dd({participantIds:p,entryStatus:Fc,tournamentRecord:n,event:u})}}return l&&bi({topic:Lo,payload:{tournamentId:n.tournamentId,participants:[a]}}),{...le,...s}}function Xue({individualParticipantIds:t=[],groupingParticipant:e,tournamentRecord:i,suppressErrors:n,mappedMatchUps:r,participants:o}){var a;const s=[];if(!e)return{removed:s};const l=[],c=[];o||({participants:o,mappedMatchUps:r}=Qn({withMatchUps:!0,tournamentRecord:i,withEvents:!0}));const u=o==null?void 0:o.find(({participantId:f})=>f===e.participantId),d=(a=u==null?void 0:u.events)==null?void 0:a.map(({eventId:f})=>f),p=(e.individualParticipantIds??[]).filter(f=>{var m;const g=t==null?void 0:t.includes(f),v=g&&((m=o==null?void 0:o.find(b=>b.participantId===f))==null?void 0:m.matchUps.filter(({eventId:b})=>d.includes(b)).map(({matchUpId:b})=>r==null?void 0:r[b]).filter(({winningSide:b,score:I})=>b||lo({score:I}))),y=g&&!(v!=null&&v.length);if(g&&!y&&c.push(f),y){s.push(f);for(const b of i.events??[])for(const I of b.drawDefinitions??[]){const{extension:T}=ei({element:I,name:Cp}),S=T==null?void 0:T.value[e.participantId];T&&S&&(T.value[e.participantId]=S.filter(U=>U.participantId!==f),Ii({element:I,extension:T}),qP({drawDefinition:I}));const w=Fa({drawDefinition:I,inContext:!1}).matchUps??[];for(const U of w){const D=U.sides??[];for(const E of D){const C=E.lineUp??[];C.find(M=>M.participantId===f)&&(E.lineUp=C.filter(M=>M.participantId!==f),Ci({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:I,matchUp:U}))}}}}else l.push(f);return!y});e.individualParticipantIds=p;const h={groupingParticipantId:e.participantId,cannotRemove:c,notRemoved:l,removed:s};return c.length&&!n&&{...h,cannotRemove:c,error:Zz}||h}function Ak({participantRole:t=Ro,individualParticipantIds:e=[],groupingTypes:i=[il,gl],tournamentRecord:n}){if(!n)return{error:je};const r=n.participants??[],{participants:o,mappedMatchUps:a}=Qn({withMatchUps:!0,tournamentRecord:n,withEvents:!0});let s=0;return r.filter(l=>(l.participantRole===t||!l.participantRole)&&l.participantType&&i.includes(l.participantType)).forEach(l=>{const{removed:c}=Xue({groupingParticipant:l,individualParticipantIds:e,tournamentRecord:n,mappedMatchUps:a,participants:o});c&&s++}),s?le:{error:D_e}}function sb(t){var e,i,n;if(!(t!=null&&t.tournamentRecord))return{error:je};if(!((e=t==null?void 0:t.participantIds)!=null&&e.length))return{error:Ig};const{addIndividualParticipantsToEvents:r,tournamentRecord:o,participantIds:a}=t,s=((i=o.participants)==null?void 0:i.length)||0;if(!s)return{...le};const l=(n=o.events||[])==null?void 0:n.filter(({eventType:m})=>m===Yr).map(m=>{var g;return(g=m==null?void 0:m.drawDefinitions)==null?void 0:g.map(({drawId:v})=>v)}).flat(1/0),c=Qn({participantFilters:{participantIds:a},tournamentRecord:o,withDraws:!0}).participants??[],u=(l==null?void 0:l.length)&&sr((Vr({matchUpFilters:{drawIds:l,matchUpTypes:[Pn]},tournamentRecord:o}).matchUps??[]).map(({sides:m})=>m==null?void 0:m.map(({participantId:g})=>g)).flat().filter(Boolean),a),d=c.filter(m=>{var g;return(g=m.draws)==null?void 0:g.filter(v=>(!(l!=null&&l.length)||!(l!=null&&l.includes(v.drawId)))&&v.positionAssignments).length});if(u!=null&&u.length||d.length)return{error:FP};const p={},h={};for(const m of o.events||[]){const g=lC({participantIds:a,event:m});if(g.error)return g;p[m.eventId]=g.participantIdsRemoved}o.participants=o.participants.filter(m=>{const g=a.includes(m.participantId)||m.participantType===qt&&m.individualParticipantIds.some(v=>a.includes(v));if(!g&&m.participantType===Yr&&m.individualParticipantIds.some(v=>a.includes(v))&&(m.individualParticipantIds=m.individualParticipantIds.filter(v=>!a.includes(v))),g&&r&&[qt,on].includes(m.participantType))for(const v of m.individualParticipantIds||[])a.includes(v)||(h[m.participantId]||(h[m.participantId]=[]),h[m.participantId].push(v));return!g});const f=s-o.participants.length;if(Ak({individualParticipantIds:a,tournamentRecord:o}),r)for(const m of o.events||[])dd({participantIds:p[m.eventId].map(g=>h[g]||[]).flat(),entryStatus:Fc,tournamentRecord:o,event:m});return f&&bi({payload:{participantIds:a,tournamentId:o.tournamentId},topic:cue}),f?{...le,participantsRemovedCount:f}:{error:Zz}}function Jue({selected:t=!0,drawDefinition:e,entryStatuses:i,drawId:n,event:r,stage:o}){var a;let s=r.entries??[];if(n){const{flightProfile:c}=Zn({event:r}),u=(a=c==null?void 0:c.flights)==null?void 0:a.find(d=>d.drawId===n);u?s=u.drawEntries:e.entries&&(s=e==null?void 0:e.entries)}const l=s.filter(c=>(!(i!=null&&i.length)||!c.entryStatus||i.includes(c.entryStatus))&&(!o||!c.entryStage||c.entryStage===o)&&(!t||c.entryStatus&&Zc.includes(c.entryStatus)));return{entries:s,stageEntries:l}}function Que({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,stage:o,event:a}){var s;const l="destroyGroupEntry";if(!e)return{error:je};if(!n)return ce({result:{error:Hr},stack:l});if(!a)return{error:Fi};if(!a.eventType||![Wm,$c].includes(a.eventType))return ce({result:{error:Lm},stack:l});const c=e.participants??[],u=c.find(y=>y.participantId===n);if(!u)return ce({result:{error:rr},stack:l});if(!u.participantType||![qt,il].includes(u.participantType)||u.participantType===il&&a.eventType!==$c||u.participantType===qt&&a.eventType!==Wm)return{error:Cu};const d=(a.entries??[]).find(y=>y.participantId===n);if(!d)return{error:dce};const{stageEntries:p}=Jue({selected:!1,drawDefinition:i,drawId:r,event:a,stage:o}),h=p.map(li),f=c.filter(({participantId:y})=>h.includes(y)).map(({individualParticipantIds:y})=>y).flat().filter(Boolean),m=(s=u.individualParticipantIds)==null?void 0:s.filter(y=>au(y,f).length===1);let g,v=lC({participantIds:[n],event:a});return v.error||m!=null&&m.length&&(v=dd({participantIds:m,entryStatus:Fc,entryStage:d.entryStage,tournamentRecord:e,drawDefinition:i,drawId:r,event:a}),v.error)?v:(t&&sb({participantIds:[n],tournamentRecord:e}).success&&(g=!0),{...le,participantRemoved:g})}function WW({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:o}){return Que({removeGroupParticipant:t,tournamentRecord:e,drawDefinition:i,participantId:n,drawId:r,event:o})}function ede(t){if(!t.tournamentRecord)return{error:je};const{participantIds:e,...i}=t;let n=0;const r=[];for(const o of e){const a=Que({participantId:o,...i});a.success&&(n+=1),a.error&&r.push(a.error)}return n?{destroyedCount:n,...le}:{error:r}}function MU(t){const{tournamentRecord:e,replaceWithBye:i,drawDefinition:n,destroyPair:r,entryStatus:o,matchUpsMap:a,drawId:s}=t,l="removeDrawPositionAssignment",c=aC(t);if(c.error)return ce({result:c,stack:l});const{participantId:u}=c,{drawPosition:d,event:p,structureId:h}=t;if([Nc,af].includes(o)&&u){const{tournamentRecord:m}=t,{participant:g}=Dg({tournamentRecord:m,participantId:u}),{participantType:v,individualParticipantIds:y}=g??{};if(r&&v===qt){const b=WW({tournamentRecord:m,drawDefinition:n,participantId:u,event:p});if(b.error)return ce({result:b,stack:l});y&&MR({participantIds:y,tournamentRecord:m,drawDefinition:n,entryStatus:o,drawId:s,event:p})}else MR({participantIds:[u],tournamentRecord:m,drawDefinition:n,entryStatus:o,drawId:s,event:p})}if(i){const m=Ms({tournamentRecord:e,drawDefinition:n,drawPosition:d,structureId:h,matchUpsMap:a,event:p});if(m.error)return ce({result:m,stack:l})}const{structure:f}=kt({drawDefinition:n,structureId:h});return PW({structure:f,drawPositions:[d]}),mk({drawDefinition:n,positionAction:{name:"removeDrawPositionAssignment",replaceWithBye:i,drawPosition:d,entryStatus:o,structureId:h}}),c}function tde(t){return Object.assign(t,{entryStatus:af}),MU(t)}function Z2(t){return La(t)?t.split(" ").map(e=>e.split("").map((i,n)=>n?i.toLowerCase():i.toUpperCase()).join("")).join(" "):t}function yo(t){return La(t)?Z2(t.replace(/_/g," ")):""}const fo=({finishingPosition:t=Ky,qualifyingRoundNumber:e,structureAbbreviation:i,seedAssignments:n=[],stageSequence:r=1,structureOrder:o,seedingProfile:a,matchUpFormat:s,structureType:l,structureName:c,matchUpType:u,matchUps:d=[],structureId:p,roundOffset:h,roundLimit:f,stageOrder:m,structures:g,stage:v})=>{const y={structureId:p??Hi(),structureAbbreviation:i,finishingPosition:t,seedAssignments:n,matchUpFormat:s,stageSequence:r,structureName:c};o&&(y.structureOrder=o),l&&(y.structureType=l),a&&(typeof a=="string"?y.seedingProfile=a:typeof a=="object"&&typeof a.positioning=="string"&&(y.seedingProfile=a.positioning)),u&&(y.matchUpType=u),h&&(y.roundOffset=h),m&&(y.stageOrder=m),f&&(y.roundLimit=f),v&&(y.stage=v),e&&(y.qualifyingRoundNumber=e);const b=d.flatMap(({drawPositions:I})=>I).filter(Boolean);return g?y.structures=g:(y.matchUps=d,y.positionAssignments=ti(b).sort((I,T)=>I-T).map(I=>({drawPosition:I}))),y};function qW({structureName:t=yo(qr),structureAbbreviation:e,drawDefinition:i,matchUpType:n,structureId:r}){if(!i)return{error:rt};const o=fo({stage:qr,structureAbbreviation:e,structureName:t,matchUps:[],structureId:r,matchUpType:n});return i.structures||(i.structures=[]),i.structures.push(o),un({drawDefinition:i,structureIds:[o.structureId]}),{...le}}function ide(t){let{sourceMatchUp:e}=t;const{targetMatchUp:i,structure:n,matchUpsMap:r,drawPosition:o}=t,a=i.roundNumber>1&&i.roundNumber-1,s=dm({structureId:n.structureId,matchUpsMap:r});!e&&o&&(e=s.find(({drawPositions:p,roundNumber:h})=>h===a&&(p==null?void 0:p.includes(o))));const l=e==null?void 0:e.roundPosition,c=l+(l%2?1:-1),u=a&&s.find(({roundNumber:p,roundPosition:h})=>p===a&&h===c),d=u==null?void 0:u.matchUpStatus;return{pairedPreviousMatchUp:u,pairedPreviousMatchUpIsDoubleExit:[gr,Mr].includes(d)}}function nde({structureId:t,matchUpsMap:e,matchUp:i}){const n=i==null?void 0:i.roundPosition,r=n+(n%2?1:-1);return{pairedPreviousMatchUp:dm({matchUpsMap:e,structureId:t}).find(({roundNumber:o,roundPosition:a})=>o===(i==null?void 0:i.roundNumber)&&a===r)}}function rde({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:i,matchUpsMap:n,matchUp:r}){const o=t.find(s=>s.matchUpId===i),{pairedPreviousMatchUp:a}=nde({structureId:o==null?void 0:o.structureId,matchUp:o,matchUpsMap:n});if(o&&a){const s=a==null?void 0:a.matchUpId,l=t.find(u=>u.matchUpId===s),c=(o==null?void 0:o.structureId)===(l==null?void 0:l.structureId)?(o==null?void 0:o.roundPosition)<(l==null?void 0:l.roundPosition)?1:2:o.structureId===(l==null?void 0:l.structureId)?2:1;r.matchUpStatusCodes=(r.matchUpStatusCodes??[]).map(u=>{const d=La(u)||!isNaN(u)?{code:u}:u;return d.sideNumber===c?{...d,previousMatchUpStatus:e}:d})}}function $E({inContextDrawMatchUps:t,drawPosition:e,matchUpId:i}){const n=t.filter(({winnerMatchUpId:r,loserMatchUpId:o})=>o===i||r===i).sort((r,o)=>r.roundPosition-o.roundPosition);return t.find(r=>r.matchUpId===i).feedRound?1:n.reduce((r,o,a)=>{var s;return(s=o.drawPositions)!=null&&s.includes(e)?a+1:r},void 0)}function YW({inContextTargetMatchUp:t,drawPositionSideIndex:e,teamParticipantId:i,tournamentRecord:n,drawDefinition:r,matchUp:o,event:a}){var s,l,c,u;const d=(l=(s=t==null?void 0:t.sides)==null?void 0:s[e])==null?void 0:l.sideNumber,p=d&&((c=o.sides)==null?void 0:c.find(m=>m.sideNumber===d)),{extension:h}=ei({element:r,name:Cp}),f=ft(((h==null?void 0:h.value)||{})[i],!1,!0);if(p)(u=o==null?void 0:o.sides)==null||u.forEach(m=>{m.sideNumber===d&&(m.lineUp=f)});else{o.sides=[1,2].map(g=>{var v;return{...((v=o.sides)==null?void 0:v.find(y=>y.sideNumber===g))??{},sideNumber:g}});const m=o.sides.find(g=>g.sideNumber===d);m&&(m.lineUp=f)}Ci({tournamentId:n==null?void 0:n.tournamentId,context:"updateSidLineUp",eventId:a==null?void 0:a.eventId,drawDefinition:r,matchUp:o})}function mw({inContextDrawMatchUps:t,sourceMatchUpStatus:e,tournamentRecord:i,sourceMatchUpId:n,drawDefinition:r,matchUpStatus:o,drawPosition:a,matchUpsMap:s,matchUpId:l,event:c}){var u,d,p;const h="assignMatchUpDrawPosition";s||(s=ma({drawDefinition:r})),t||(t=Ar({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[]);const f=t.find(_=>_.matchUpId===l),m=f==null?void 0:f.structureId,g=(u=r==null?void 0:r.structures)==null?void 0:u.find(_=>_.structureId===m);if(!g)return{error:Cn};const v=(d=s==null?void 0:s.drawMatchUps)==null?void 0:d.find(_=>_.matchUpId===l),y=(v==null?void 0:v.drawPositions)??[],{positionAdded:b,positionAssigned:I,updatedDrawPositions:T}=function({drawPosition:_,drawPositions:k}){let O=!1,F=!!(k!=null&&k.includes(_));return{updatedDrawPositions:F?k||[]:[...k,void 0,void 0].slice(0,2).map(B=>B||F?B:(F=!0,O=!0,_)).sort(Sr).filter(Boolean),positionAdded:O,positionAssigned:F}}({drawPosition:a,drawPositions:y}),{positionAssignments:S}=Ki({drawDefinition:r,structure:g}),w=S==null?void 0:S.filter(_=>T.includes(_.drawPosition)),U=w==null?void 0:w.find(({bye:_})=>_),D=(v==null?void 0:v.matchUpStatus)&&[Li,Mi].includes(v.matchUpStatus)&&T.filter(Boolean).length<2;if(o=U&&Ri||o||D&&v.matchUpStatus||(v==null?void 0:v.matchUpStatus)&&[gr,Mr].includes(v.matchUpStatus)&&v.matchUpStatus||qn,v&&b){t=Ar({inContext:!0,drawDefinition:r,matchUpsMap:s}).matchUps??[];const _=D&&$E({inContextDrawMatchUps:t,drawPosition:a,matchUpId:l})||void 0;v!=null&&v.matchUpStatusCodes&&rde({inContextDrawMatchUps:t,sourceMatchUpStatus:e,sourceMatchUpId:n,matchUpsMap:s,matchUp:v}),Object.assign(v,{drawPositions:T,winningSide:_,matchUpStatus:o}),Ci({tournamentId:i==null?void 0:i.tournamentId,eventId:f==null?void 0:f.eventId,context:h,drawDefinition:r,matchUp:v})}const E=pa({inContextDrawMatchUps:t,inContextMatchUp:f,drawDefinition:r,matchUpId:l}),{targetMatchUps:{winnerMatchUp:C,loserMatchUp:M,loserTargetDrawPosition:N},targetLinks:{loserTargetLink:R}}=E,A=dm({structureId:g.structureId,matchUpsMap:s});if(I&&U){if(C)if([Ri,gr,Mr].includes(o)){const _=mw({matchUpId:C.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(_.error)return _}else{const{structureId:_}=C;_!==g.structureId&&console.log("winnerMatchUp in different structure... participant is in different targetDrawPosition")}}else if(C&&f&&!f.feedRound){const{pairedPreviousMatchUpIsDoubleExit:_}=ide({targetMatchUp:v,drawPosition:a,matchUpsMap:s,structure:g});if(_){const k=mw({matchUpId:C.matchUpId,inContextDrawMatchUps:t,tournamentRecord:i,drawDefinition:r,drawPosition:a,matchUpsMap:s});if(k.error)return k}}if((v==null?void 0:v.matchUpType)===gn){const _=t==null?void 0:t.find(({matchUpId:F})=>F===v.matchUpId),k=((_==null?void 0:_.sides)??[]).reduce((F,B,$)=>B.drawPosition===a?$:F,void 0),O=(p=S==null?void 0:S.find(F=>F.drawPosition===a))==null?void 0:p.participantId;O&&k!==void 0&&YW({inContextTargetMatchUp:_,drawPositionSideIndex:k,teamParticipantId:O,tournamentRecord:i,drawDefinition:r,matchUp:v})}if((R==null?void 0:R.linkCondition)===Md&&T.filter(Boolean).length===2&&!U&&A.filter(({drawPositions:_,roundNumber:k})=>k===1&&ua(_,T)).every(({matchUpStatus:_})=>[fr,da].includes(_))&&M){const{structureId:_}=M,k=Ms({drawPosition:N,tournamentRecord:i,drawDefinition:r,structureId:_,matchUpsMap:s,event:c});if(k.error)return k}return I?{...le}:ce({result:{error:lU},context:{drawPosition:a},stack:h})}function KW({drawPositions:t}){if(!(t!=null&&t.length))return{error:q_};const e=[].concat(...(t??[]).map(n=>t.filter(r=>r!==n).map(r=>[n,r]))),i=ti(e.map(_k)).map(n=>n.split("|").map(r=>+r));return{groupMatchUps:e,uniqueMatchUpGroupings:i}}function _k(t=[]){return Array.isArray(t)&&t.length?[...t].sort(Sr).join("|"):""}function ode({groupSize:t,drawPositionOffset:e}){if(!t)return[];const i=d=>[...Array(d)].map((p,h)=>h),n=i(2*Math.round(t/2)+1).slice(1),r=i(n.length-1).map(()=>[]);let o=n.slice(0,n.length/2),a=n.slice(n.length/2);n.slice(1).forEach((d,p)=>{o.forEach((g,v)=>{r[p].push([o[v],a[v]])});const h=o.shift(),f=o.pop(),m=a.shift();o=[h,m,...o].filter(Boolean),a=[...a,f].filter(Boolean)});const s=o.shift(),l=o.pop(),c=a.shift();o=[s,c,...o].filter(Boolean),a=[...a,l].filter(Boolean);const u=d=>d[0].reduce((p,h)=>p+h);return[...r].reverse().sort((d,p)=>u(d)-u(p)).map(d=>d.filter(p=>p.every(h=>h<=t)).map(p=>_k(p.map(h=>h+e))))}const hxe={getRoundRobinGroupMatchUps:KW,determineRoundNumber:function({rounds:t,hash:e}){return t!=null&&t.length?t==null?void 0:t.reduce((i,n,r)=>n.includes(e)?r+1:i,void 0):{error:bt}},drawPositionsHash:_k,groupRounds:ode};function RU(t){var e;const{groupNameBase:i="Group",playoffAttributes:n,stageSequence:r=1,structureOptions:o,appliedPolicies:a,seedingProfile:s,stage:l=ct,matchUpType:c,roundTarget:u,structureId:d,groupNames:p,drawSize:h,idPrefix:f,isMock:m,uuids:g}=t,v=t.structureName??((e=n==null?void 0:n[0])==null?void 0:e.name)??yo(ct),{groupCount:y,groupSize:b}=function({appliedPolicies:U,structureOptions:D,drawSize:E}){let C=D==null?void 0:D.groupSize;const M=(D==null?void 0:D.groupSizeLimit)||8,{validGroupSizes:N}=cC({groupSizeLimit:M,drawSize:E}),R=N&&Math.max(...N);C&&(N!=null&&N.includes(C))||(C=C&&C>4||!(N!=null&&N.includes(4))?R:4);const A=Math.ceil(E/C);return{groupSize:C,groupCount:A}}({structureOptions:o,appliedPolicies:a,drawSize:h}),I=$0;let T;const S=nt(1,y+1).map(U=>{const D=function({structureOrder:C,matchUpType:M,groupSize:N,drawSize:R,idPrefix:A,isMock:_,uuids:k}){const O=(C-1)*N,F=nt(1+O,N+1+O),B=KW({drawPositions:F}).uniqueMatchUpGroupings??[],$=ode({groupSize:N,drawPositionOffset:O});return B.map(H).sort((z,G)=>(z.roundNumber||1/0)-(G.roundNumber||1/0));function V(z){return $.reduce((G,W,K)=>W.includes(z)?K+1:G,void 0)}function H(z){const G=V(_k(z)),W=[1,R],K=function({structureOrder:Y,drawPositions:X,roundNumber:Q,idPrefix:te,uuids:J}){return te?`${te}-${Y}-${Q}-DP-${X.join("-")}`:(J==null?void 0:J.pop())||Hi()}({structureOrder:C,drawPositions:z,roundNumber:G,idPrefix:A,uuids:k}),Z={matchUpStatus:G?qn:Ri,matchUpType:M,finishingPositionRange:{winner:W,loser:W},drawPositions:z,roundNumber:G,matchUpId:K};return _&&(Z.isMock=!0),Z}}({groupSize:b,structureOrder:U,matchUpType:c,drawSize:h,idPrefix:f,isMock:m});T=Array.isArray(D)?Math.max(...D.map(({roundNumber:C})=>C??0)):0;const E=(p==null?void 0:p[U-1])??`${i} ${U}`;return fo({structureId:g==null?void 0:g.pop(),structureType:pk,finishingPosition:I,structureOrder:U,structureName:E,matchUps:D})}),w=fo({structureId:d??(g==null?void 0:g.pop()),structureType:na,finishingPosition:I,seedingProfile:s,structureName:v,stageSequence:r,structures:S,stage:l});return u&&Ii({extension:{name:$u,value:u},element:w}),{structures:[w],maxRoundNumber:T,groupCount:y,links:[],groupSize:b,...le}}function cC({drawSize:t,groupSizeLimit:e=10}){const i=nt(3,e+1).filter(n=>{const r=Math.ceil(t/n),o=r*n-t,a=Math.ceil(t/r),s=Math.ceil(o/r);return(!o||o<n)&&a===n&&a>=3&&s<2});return{...le,validGroupSizes:i}}function ZW(t){const{roundRobinGroupsCount:e,participantsCount:i,cluster:n}=t;if(!$t(i))return{seedBlocks:void 0,...ce({result:{error:Re},context:{participantsCount:i},stack:"getSeedBlocks"})};const r=R0(i);if(e){const h=Math.min(e,r),f=[];let m=1;for(nt(0,h).forEach(()=>{f.push([m]),m++});m<r;){const g=nt(m,m+h);m+=h,f.push(g)}return{...le,seedBlocks:f}}const o=nt(1,r+1),a=[];let s=r/2;for(;s>1;){const h=Kr(o,s),f=h.length;h.forEach((m,g)=>{let v;const y=g<f/2,b=g%2==0,I=m[0],T=m[m.length-1];v=n&&f>4?f===8?y?T:I:b?I:T:y?I:T,ua(m,a)||a.push(v)}),s/=2}const l=o.filter(h=>!a.includes(h));for(;l.length;)l.length%2==0?a.push(l.pop()):a.push(l.shift());const c=nt(0,20).map(h=>Math.pow(2,h));c.unshift(1);const u=c.indexOf(r);let d=0;const p=[];return nt(0,u).forEach(h=>{p.push(a.slice(d,d+c[h])),d+=c[h]}),{...le,seedBlocks:p}}function XW({roundRobinGroupsCount:t,drawSize:e}){const i="getSeedGroups";if(!$t(e))return{seedGroups:void 0,...ce({result:{error:Re},context:{drawSize:e},stack:i})};if(t){if(!$t(t))return{seedGroups:void 0,...ce({context:{roundRobinGroupsCount:t},result:{error:Re},stack:i})};let n=1;return{seedGroups:nt(0,Math.floor(e/t)).map(()=>{const r=nt(n,n+t);return n+=t,r})}}{const{seedBlocks:n}=ZW({participantsCount:e,roundRobinGroupsCount:t});let r=0;return{seedGroups:(n||[]).map(o=>(o||[]).map(()=>(r+=1,r)))}}}function JW({roundRobinGroupsCount:t,participantsCount:e}){if(t){const{validGroupSizes:r}=cC({drawSize:e}),o=r==null?void 0:r.map(a=>Math.ceil(e/a));if(!(o!=null&&o.includes(t)))return ce({context:{roundRobinGroupsCount:t},result:{error:Re}})}const{seedGroups:i}=XW({drawSize:e,roundRobinGroupsCount:t}),n=(i==null?void 0:i.map(r=>Math.min(...r)))||[];return{...le,seedingThresholds:n}}function gw(t){if(!t)return 1/0;if($t(t))return Ct(t);const e=t.split("-")[0];return $t(e)?Ct(e):1/0}function fxe({positioning:t,size:e}){const i=function({size:d}){const p=[d];let h=d;for(;h/2===Math.floor(h/2);)h/=2,p.push(h);return p.includes(1)||p.push(1),p.sort(Sr),p.reverse(),p}({size:e}),n=[],r=[],o=d=>d[0],a=(d,p)=>(t&&[dk,Hm].includes(t)&&p%2?(h=>h[h.length-1])(d):o(d))||o(d),s=(d,p)=>{if(d.every(h=>!r.includes(h))){const h=a(d,p);return r.push(h),h}},l=d=>{const p=d.filter(h=>!r.includes(h));if(p.length)return r.push(...p),p},c=(d,p)=>{const h=a(d,p);if(!r.includes(h))return r.push(h),h},u=nt(1,e+1);for(const d of i)if(d===1){const p=Kr(u,2),h=p.map(s).filter(Boolean);h.length&&n.push(h);const f=p.flatMap(l).filter(Boolean);f.length&&n.push(f)}else{const p=Kr(u,d).map(c).filter(Boolean);p.length&&n.push(p)}return{divisions:i,divisionGroupings:n}}function lb({provisionalPositioning:t,returnAllProxies:e,appliedPolicies:i,seedingProfile:n,drawDefinition:r,allPositions:o,structure:a}){var s;let l=[];if(!a)return{error:bg};const{matchUps:c,roundMatchUps:u}=zi({matchUpFilters:{roundNumbers:[1]},provisionalPositioning:t,structure:a}),{seedAssignments:d}=ul({provisionalPositioning:t,returnAllProxies:e,drawDefinition:r,structure:a}),{positionAssignments:p}=Lr({structure:a}),h=p==null?void 0:p.length,f=(d==null?void 0:d.length)??0;let m=[];const g=Object.keys(u).map(k=>parseInt(k)).sort((k,O)=>k-O).map(k=>{const O=u[k].map(B=>B.drawPositions).flat(1/0).filter(Boolean),F=O.filter(B=>!m.includes(B));return m=m.concat(...O),F}).filter(k=>k.length).reverse(),v=g.pop(),y=v&&Math.min(...v)-1||0;n=n??((s=i==null?void 0:i.seeding)==null?void 0:s.seedingProfile);const b=(v==null?void 0:v.length)||0,I=g.filter(k=>k.filter(O=>O<=f).length),{stage:T,structureType:S,roundLimit:w}=a,U=S===na,D=!U&&(g==null?void 0:g.length),E=!U&&T===St&&w,C=I.flat(1/0),M=D?C==null?void 0:C.length:0,N=o?h:f,R=LW({drawDefinition:r,structure:a,matchUps:c}),A=R?0:!D&&N||N&&C.length<N&&N-C.length||0;if(E){const k=a!=null&&a.matchUps?a.matchUps.filter(({roundNumber:F})=>F===a.roundLimit).length:0,O=v.length/k;if(!D){const F=lT(n),B=Kr(v,O);let $=1;const V=nt(0,B[0].length).map(()=>{const H=nt($,$+B.length);return $+=B.length,H});({validSeedBlocks:l}=Z7({drawPositionBlocks:B,nonRandom:n==null?void 0:n.nonRandom,positioning:F,seedGroups:V}))}}else U?{validSeedBlocks:l}=function({seedingProfile:k,structure:O,nonRandom:F}){var B;const $=O.structures||[],V=$.length,H=(B=Ki({structure:O}))==null?void 0:B.positionAssignments,z=lT(k),G=(H==null?void 0:H.length)??0,{seedGroups:W}=XW({roundRobinGroupsCount:V,drawSize:G});return Z7({drawPositionBlocks:$.map(K=>{var Z;return(Z=Ki({structure:K}).positionAssignments)==null?void 0:Z.map(Y=>Y.drawPosition)}),positioning:z,seedGroups:W,nonRandom:F})}({nonRandom:n==null?void 0:n.nonRandom,seedingProfile:n,structure:a}):D?l=I.map(k=>({seedNumbers:k,drawPositions:k})):R&&Kr(v,2).map((k,O)=>({drawPositions:[k[0]],seedNumbers:[O+1]})).forEach(k=>l.push(k));if(!U&&!R&&!E){const{blocks:k}=function(O){const{drawPositionOffset:F=0,roundRobinGroupsCount:B,seedNumberOffset:$=0,seedingProfile:V,seedCountGoal:H,baseDrawSize:z}=O;let G=1;const W=[],{seedBlocks:K}=ZW({cluster:lT(V)===dk,participantsCount:z,roundRobinGroupsCount:B});G=0;for(const Y of K){if(G+1>H)break;const X=Y.map(te=>te+F),Q=Z(G+1,Y.length).map(te=>+te+$);G+=Y.length,W.push({drawPositions:X,seedNumbers:Q})}return{blocks:W};function Z(Y,X){return Array.from(new Array(X),(Q,te)=>te+Y)}}({drawPositionOffset:y,seedNumberOffset:M,seedCountGoal:A,seedingProfile:n,baseDrawSize:b});k.forEach(O=>l.push(O))}const _=l.flatMap(k=>k.drawPositions).reduce((k,O)=>(v==null?void 0:v.includes(O))&&k,!0);return R||D||U||_?{isLuckyStructure:R,validSeedBlocks:l,isContainer:U,isFeedIn:D}:{error:r_e,validSeedBlocks:[],isContainer:U,isFeedIn:D}}function Z7({drawPositionBlocks:t,positioning:e,seedGroups:i,nonRandom:n}){const r=[],{divisionGroupings:o}=fxe({size:i.length,positioning:e}),a=[];return i.forEach((s,l)=>{const c=function({blockPattern:u,index:d}){let p=0;for(const h of u){if(p===d)return h;let f=0;for(;f<h.length;){if(p===d)return h;p+=1,f++}}}({blockPattern:o,index:l});s.forEach((u,d)=>{const p=l%2?t.length-d-1:d;let h=t[p].slice().filter((m,g)=>c.includes(g+1)&&m);e!==Hm?h=n?h:Qo(h):l%2&&h.reverse();const f=h.find(m=>!a.includes(m));f&&(a.push(f),r.push({drawPositions:[f],seedNumbers:[u]}))})}),{validSeedBlocks:r}}function NR({appliedPolicies:t,drawDefinition:e,seedBlockInfo:i,drawPosition:n,structureId:r,seedNumber:o}){var a,s,l,c,u;const{structure:d}=kt({drawDefinition:e,structureId:r});t||(t=Gi({drawDefinition:e}).appliedPolicies);let p=i==null?void 0:i.validSeedBlocks;if(!p&&d&&(p=(a=lb({appliedPolicies:t,drawDefinition:e,structure:d}))==null?void 0:a.validSeedBlocks),(l=(s=t==null?void 0:t.seeding)==null?void 0:s.validSeedPositions)==null?void 0:l.ignore)return!0;if((u=(c=t==null?void 0:t.seeding)==null?void 0:c.validSeedPositions)!=null&&u.strict){const h=p.find(f=>f.seedNumbers.includes(o));return((h==null?void 0:h.drawPositions)||[]).includes(n)}return[].concat(...p.map(h=>h.drawPositions)).includes(n)}function ade(t){var e,i;const{provisionalPositioning:n,drawDefinition:r,seedingProfile:o,seedBlockInfo:a,structureId:s,randomize:l}=t,{structure:c}=kt({drawDefinition:r,structureId:s}),{seedAssignments:u}=ul({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,drawDefinition:r,structure:c}),{positionAssignments:d}=Lr({structure:c}),p=d==null?void 0:d.filter(R=>R.participantId??R.bye??R.qualifier),h=p==null?void 0:p.map(R=>R.drawPosition).filter(Boolean),{appliedPolicies:f}=Gi({drawDefinition:r}),m=((a==null?void 0:a.validSeedBlocks)||c&&((e=lb({returnAllProxies:t.returnAllProxies,provisionalPositioning:n,appliedPolicies:f,drawDefinition:r,seedingProfile:o,structure:c}))==null?void 0:e.validSeedBlocks)||[]).filter(R=>R.drawPositions.filter(A=>!(h!=null&&h.includes(A))).length)[0],g=u==null?void 0:u.map(R=>R.participantId).filter(Boolean),v=d==null?void 0:d.map(R=>R.participantId).filter(Boolean),y=g==null?void 0:g.filter(R=>v==null?void 0:v.includes(R)),b=g==null?void 0:g.filter(R=>!(v!=null&&v.includes(R))),I=u==null?void 0:u.filter(R=>b==null?void 0:b.includes(R.participantId)),T=u==null?void 0:u.filter(R=>!R.participantId),S=(I!=null&&I.length&&I.length>0?I.length:(T==null?void 0:T.length)??0)&&(m==null?void 0:m.drawPositions.filter(R=>!(h!=null&&h.includes(R))))||[],w=l?Qo(S):S,U=[],D=w.map(()=>{const R=function(_,k){const O=_.filter($=>!k.includes($.participantId)),F=Math.min(...O.map($=>gw($.seedValue))),B=O.filter($=>gw($.seedValue)===F);return Qo(B).pop()}(I,U),A=R==null?void 0:R.participantId;return A&&U.push(A),A}).filter(Boolean),E=u==null?void 0:u.filter(R=>y==null?void 0:y.includes(R.participantId)).map(R=>R.seedNumber),C=((m==null?void 0:m.seedNumbers)||[]).filter(R=>!(E!=null&&E.includes(R))),M=u==null?void 0:u.filter(R=>C.includes(R.seedNumber)).map(R=>R.participantId),N=(i=f==null?void 0:f.seeding)==null?void 0:i.duplicateSeedNumbers;return{nextSeedBlock:m,unplacedSeedParticipantIds:N===void 0||N?D:M,unplacedSeedNumbers:C,unfilledPositions:w,unplacedSeedAssignments:I}}function lT(t){return typeof t=="string"?t:typeof t=="object"?t.positioning:void 0}function vw({provisionalPositioning:t,tournamentRecord:e,drawDefinition:i,seedingProfile:n,participantId:r,seedBlockInfo:o,structureId:a,seedNumber:s,seedValue:l,eventId:c,event:u}){var d,p;const h="assignSeed",{structure:f}=kt({drawDefinition:i,structureId:a}),{positionAssignments:m}=Lr({structure:f}),g=ul({provisionalPositioning:t,drawDefinition:i,structure:f}).seedAssignments,v=g.map(U=>U.seedNumber),y=Uv({drawDefinition:i,participantId:r});if(r&&!y)return ce({result:{error:Dd},context:{participantId:r},stack:h});const b=u?(p=(d=Zn({event:u}).flightProfile)==null?void 0:d.flights)==null?void 0:p.length:0,I=b&&b>1,T=m==null?void 0:m.find(U=>U.participantId===r),S=T==null?void 0:T.drawPosition;if(S&&!NR({drawPosition:S,drawDefinition:i,seedBlockInfo:o,structureId:a,seedNumber:s}))return ce({result:{error:Kle},context:{assignedDrawPosition:S},info:"invalid seed position",stack:h});let w;return v.includes(s)||g.push({seedNumber:s,seedValue:l}),g.forEach(U=>{U.participantId===r&&U.seedNumber!==s&&(U.participantId=void 0),U.seedNumber===s&&(U.participantId=r,n!=null&&n.groupSeedingThreshold||I||(U.seedValue=l??s),w=!0)}),w?(Iue({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:i,structure:f,eventId:c}),{...le}):ce({result:{error:n_e},stack:h})}function sde({inContextDrawMatchUps:t,drawDefinition:e,assignments:i,matchUpsMap:n,structure:r}){var o,a,s;const l=(o=V0({drawDefinition:e}))==null?void 0:o.containedStructures,c=((a=l==null?void 0:l[r.structureId])==null?void 0:a.map(({structureId:f})=>f))||[];c.push(r==null?void 0:r.structureId);const u=(i==null?void 0:i.map(({drawPosition:f})=>f))||[],d=(t==null?void 0:t.filter(f=>c.includes(f.structureId)&&sr(f.drawPositions??[],u).length))??[],p=d.map(({matchUpId:f})=>f),h=((s=n==null?void 0:n.drawMatchUps)==null?void 0:s.filter(f=>p.includes(f.matchUpId)))??[];return{drawPositions:u,matchUps:h,targetMatchUps:d}}function X2({lineUp:t}){if(!Array.isArray(t))return;const e={};return ti(t.flatMap(({collectionAssignments:i})=>i==null?void 0:i.map(({collectionId:n,collectionPosition:r})=>[n,r].join("|"))).filter(Boolean)).forEach(i=>{const[n,r]=i.split("|"),o=parseInt(r),{assignedParticipantIds:a}=CR({collectionPosition:o,collectionId:n,lineUp:t});a.forEach(s=>{e[s]||(e[s]=[]),e[s].push({collectionId:n,collectionPosition:o})})}),Object.keys(e).map(i=>({participantId:i,collectionAssignments:e[i]}))}function _d(t){return`${t} must be an array`}function kk({lineUp:t,tieFormat:e}){const i=[];if(!Array.isArray(t))return i.push(_d("lineUp")),{valid:!1,errors:i,error:Re};const n=t.every(o=>{if(typeof o!="object")return i.push("lineUp entries must be objects"),!1;const{participantId:a,collectionAssignments:s}=o;return a?typeof a!="string"?(i.push("participantIds must be strings"),!1):Array.isArray(s)?s.every(l=>{if(typeof l!="object")return i.push("collectionAssignments must be objects"),!1;const{collectionPosition:c}=l;return typeof c=="number"||(i.push("collectionPosition must be a number"),!1)}):(i.push(_d("collectionAssignments")),!1):(i.push("Missing participantId"),!1)}),r=ti(t.map(li)).length===t.length;return r||i.push("Duplicated participantId(s)"),{valid:n&&r,errors:i,error:i.length?Re:void 0}}function cb({drawDefinition:t,participantId:e,tieFormat:i,lineUp:n}){if(typeof t!="object")return{error:rt};if(typeof e!="string")return{error:Hr};const r=kk({lineUp:n,tieFormat:i});if(!r.valid)return r;const{extension:o}=ei({element:t,name:Cp}),a=(o==null?void 0:o.value)||{};return a[e]=X2({lineUp:n}),Ii({element:t,extension:{name:Cp,value:a}}),qP({drawDefinition:t}),{...le}}function J2({inContextDrawMatchUps:t,inheritance:e=!0,tournamentRecord:i,drawDefinition:n,matchUpsMap:r,assignments:o,structure:a,event:s}){if(!n)return{error:rt};const{drawPositions:l,matchUps:c,targetMatchUps:u}=sde({inContextDrawMatchUps:t,matchUpsMap:r,assignments:o,structure:a});for(const d of u)d.matchUpType===Ad&&(d.sides??[]).forEach((p,h)=>{var f;if(p!=null&&p.drawPosition&&l!=null&&l.includes(p.drawPosition)){const m=c.find(({matchUpId:g})=>g===d.matchUpId);if((f=m==null?void 0:m.sides)!=null&&f[h]){if(delete m.sides[h].lineUp,e===!1){const g=d.tieFormat,v=p.participantId;g&&v&&cb({drawDefinition:n,participantId:v,lineUp:[],tieFormat:g})}Ci({tournamentId:i==null?void 0:i.tournamentId,context:"resetLineUps",eventId:s==null?void 0:s.eventId,drawDefinition:n,matchUp:m})}}});return{...le}}function lu({provisionalPositioning:t,inContextDrawMatchUps:e,isQualifierPosition:i,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:o,seedingProfile:a,participantId:s,seedBlockInfo:l,drawPosition:c,matchUpsMap:u,structureId:d,event:p}){var h;const f="assignDrawPosition";if(!s&&!i)return ce({result:{error:Hr},stack:f});u=u??ma({drawDefinition:o}),e||({matchUps:e}=Ar({inContext:!0,drawDefinition:o,matchUpsMap:u}));const m=kt({drawDefinition:o,structureId:d});if(m.error)return ce({result:m,stack:f});const{structure:g}=m;if(!g)return{error:Cn};if(Zl({drawDefinition:o,structure:g}))return ce({result:{error:ja},stack:f});const{seedAssignments:v}=ul({provisionalPositioning:t,drawDefinition:o,structure:g}),y=v==null?void 0:v.find(D=>D.participantId===s),b=y==null?void 0:y.seedNumber,{appliedPolicies:I}=Gi({tournamentRecord:r,drawDefinition:o,structure:g,event:p});if(b&&!NR({seedNumber:b,appliedPolicies:I,drawDefinition:o,seedBlockInfo:l,drawPosition:c,structureId:d}))return ce({result:{error:Kle},context:{drawPosition:c},stack:f});const T=Lr({structure:g}).positionAssignments||[],S=T==null?void 0:T.find(D=>D.drawPosition===c);if(!S)return ce({result:{error:kP},context:{drawPosition:c},stack:f});if(T!=null&&T.map(li).includes(s))return ce({result:{error:FP},context:{drawPosition:c},stack:f});const{containsParticipant:w,containsBye:U}=function(D){const E=D.bye,C=D.qualifier,M=D.participantId;return{containsBye:E,containsQualifier:C,containsParticipant:M,filled:E||C||M}}(S);if(U){const D=aC({inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,drawPosition:c,structureId:d,matchUpsMap:u,event:p});if(D.error)return ce({result:D,stack:f})}if(w&&S.participantId!==s){const{activeDrawPositions:D}=oC({drawDefinition:o,structureId:d});if(D.includes(c))return ce({result:{error:zz},stack:f});J2({assignments:[S],inContextDrawMatchUps:e,tournamentRecord:r,drawDefinition:o,matchUpsMap:u,structure:g})}if(S.participantId=s,i&&(S.qualifier=!0),((g==null?void 0:g.stageSequence)||0)>1||g.stage&&[So,Vn].includes(g.stage)){const D=g.stage===St?St:ct,E=(h=o.structures)==null?void 0:h.find(M=>(M==null?void 0:M.stage)===D&&(M==null?void 0:M.stageSequence)===1),C=((E==null?void 0:E.seedAssignments)??[]).find(M=>M.participantId===s);if(C!=null&&C.participantId){const{participantId:M,seedNumber:N,seedValue:R}=C;vw({eventId:p==null?void 0:p.eventId,provisionalPositioning:t,tournamentRecord:r,drawDefinition:o,seedingProfile:a,participantId:M,seedNumber:N,seedValue:R,structureId:d,event:p})}}if(g.structureType!==na)(function({provisionalPositioning:D,inContextDrawMatchUps:E,sourceMatchUpStatus:C,tournamentRecord:M,drawDefinition:N,drawPosition:R,matchUpsMap:A,structure:_,event:k}){const O={isCollectionMatchUp:!1},{matchUps:F}=zi({provisionalPositioning:D,matchUpFilters:O,drawDefinition:N,matchUpsMap:A,structure:_,event:k}),{roundMatchUps:B}=ba({matchUps:F}),{initialRoundNumber:$}=ny({drawPosition:R,matchUps:F}),V=$&&(B==null?void 0:B[$].find(H=>{var z;return(z=H.drawPositions)==null?void 0:z.includes(R)}));if(V){const H=mw({matchUpId:V.matchUpId,inContextDrawMatchUps:E,sourceMatchUpStatus:C,tournamentRecord:M,drawDefinition:N,drawPosition:R,matchUpsMap:A});if(H.error)return ce({stack:"assignDrawPositionToMatchUps",context:{drawPosition:R},result:H})}})({provisionalPositioning:t,inContextDrawMatchUps:e,sourceMatchUpStatus:n,tournamentRecord:r,drawDefinition:o,drawPosition:c,matchUpsMap:u,structure:g,event:p});else{Hue({positionAssignments:T,tournamentRecord:r,drawDefinition:o,matchUpsMap:u,structure:g});const{drawPositions:D,matchUps:E,targetMatchUps:C}=sde({assignments:[S],inContextDrawMatchUps:e,drawDefinition:o,matchUpsMap:u,structure:g});if(D&&(E==null?void 0:E.length)===1&&E[0].matchUpType===gn){const M=((C==null?void 0:C[0].sides)??[]).reduce((N,R,A)=>D!=null&&D.includes(R.drawPosition)?A:N,void 0);YW({inContextTargetMatchUp:C[0],teamParticipantId:s,matchUp:E[0],drawPositionSideIndex:M,tournamentRecord:r,drawDefinition:o})}}return of({tournamentId:r==null?void 0:r.tournamentId,drawDefinition:o,structure:g,event:p}),{positionAssignments:T,...le}}function QW(t){const{participantIdAttributeName:e="participantId",isQualifierPosition:i,positionActionName:n,tournamentRecord:r,drawDefinition:o,participantId:a,drawPosition:s,structureId:l,event:c}=t,u="positionParticipantAction";if(!o)return{error:rt};let{inContextDrawMatchUps:d,matchUpsMap:p}=t;p||(p=ma({drawDefinition:o}),Object.assign(t,{matchUpsMap:p})),d||({matchUps:d}=Ar({inContext:!0,drawDefinition:o,matchUpsMap:p}),Object.assign(t,{inContextDrawMatchUps:d}));const{positionAssignments:h}=Ki({drawDefinition:o,structureId:l}),f=h==null?void 0:h.find(b=>b.drawPosition===s);if(f!=null&&f.participantId){const b=f.participantId,I=lu({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:o,participantId:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return I.success?y({removedParticipantId:b}):ce({result:I,stack:u})}const m=aC({inContextDrawMatchUps:d,tournamentRecord:r,drawDefinition:o,drawPosition:s,structureId:l,matchUpsMap:p,event:c});if(m.error)return ce({result:m,stack:u});const g=m.participantId,v=lu({inContextDrawMatchUps:d,isQualifierPosition:i,tournamentRecord:r,drawDefinition:o,participantId:a,drawPosition:s,structureId:l,matchUpsMap:p,event:c});return v.success?y({removedParticipantId:g}):ce({result:v,stack:u});function y({removedParticipantId:b}){const{structure:I}=kt({drawDefinition:o,structureId:l});return PW({drawPositions:[s],structure:I}),mk({drawDefinition:o,positionAction:{[e]:a,name:n,drawPosition:s,structureId:l}}),ce({context:{removedParticipantId:b},result:{...le},stack:u})}}function lde(t){return function({luckyLoserParticipantId:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:o}){return QW({positionActionName:"luckyLoserDrawPositionAssignment",participantId:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:o})}(t)}function cde(t){return function({alternateParticipantId:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:o}){return QW({positionActionName:"alternateDrawPositionAssignment",participantIdAttributeName:"alternateParticipantid",participantId:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:o})}(t)}function ude({structurePositionAssignments:t,provisionalPositioning:e,tournamentRecord:i,drawDefinition:n,event:r}){var o;if(!n)return{error:rt};if(!Array.isArray(t))return{error:Re};for(const s of t){const{structureId:l,positionAssignments:c}=s;if(!c)continue;const u=kt({drawDefinition:n,structureId:l});if(u.error)return u;const d=u.structure;if(!d)return{error:Cn};const p=(o=Ki({structure:d}).positionAssignments)==null?void 0:o.map(({drawPosition:g})=>g),h=c==null?void 0:c.map(({drawPosition:g})=>g);if(sr(p,h).length!==(p==null?void 0:p.length))return ce({result:{error:Re},info:"drawPositions do not match",stack:"setPositionAssignments"});const f=ma({drawDefinition:n}),{matchUps:m}=Ar({inContext:!0,drawDefinition:n,matchUpsMap:f});for(const g of c||[]){const{drawPosition:v,participantId:y,bye:b,qualifier:I}=g;if(b){const T=Ms({tournamentRecord:i,drawDefinition:n,drawPosition:v,matchUpsMap:f,structureId:l,structure:d,event:r});if(T!=null&&T.error)return T}else if(I)c.forEach(T=>{T.drawPosition===v&&(T.qualifier=!0,delete T.participantId,delete T.bye)});else if(y){const T=lu({provisionalPositioning:e,inContextDrawMatchUps:m,tournamentRecord:i,drawDefinition:n,participantId:y,drawPosition:v,matchUpsMap:f,structureId:l,event:r});if(T!=null&&T.error)return T}}of({tournamentId:i==null?void 0:i.tournamentId,drawDefinition:n,structure:d,event:r})}const a=t.map(({structureId:s})=>s);return un({tournamentId:i==null?void 0:i.tournamentId,eventId:r==null?void 0:r.eventId,drawDefinition:n,structureIds:a}),{...le}}function dde(t){return function({qualifyingParticipantId:e,tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:o}){return QW({positionActionName:"qualifierDrawPositionAssignment",participantId:e,isQualifierPosition:!0,tournamentRecord:i,drawDefinition:n,drawPosition:r,structureId:o})}(t)}function mxe({tournamentRecord:t,drawDefinition:e,drawPositions:i,structureId:n,event:r}){if(!e)return{error:rt};if(!n)return{error:Va};if((i==null?void 0:i.length)!==2)return{error:Re,drawPositions:i};const o=ma({drawDefinition:e}),{matchUps:a}=Ar({inContext:!0,drawDefinition:e,matchUpsMap:o}),{structure:s}=kt({drawDefinition:e,structureId:n});if(!s)return{error:Cn};let l;if(l=s.structureType===na?function({inContextDrawMatchUps:c,tournamentRecord:u,drawDefinition:d,drawPositions:p,matchUpsMap:h,structure:f,event:m}){var g;const v=(g=f.structures)==null?void 0:g.reduce((b,I)=>{const T=I==null?void 0:I.positionAssignments.filter(S=>p==null?void 0:p.includes(S.drawPosition));return T&&b.push(...T),b},[]);if(v.filter(({bye:b})=>b).length===2)return{...le};if(v.filter(({qualifier:b})=>b).length===2)return{...le};J2({inContextDrawMatchUps:c,tournamentRecord:u,drawDefinition:d,matchUpsMap:h,assignments:v,structure:f,event:m});const y=v.some(({qualifier:b})=>b);if(v.some(({bye:b})=>b)&&!y)X7({inContextDrawMatchUps:c,tournamentRecord:u,drawDefinition:d,assignments:v,matchUpsMap:h,structure:f,event:m});else{const b=ft(v,!1,!0);v.forEach((I,T)=>{const S=b[1-T].participantId;I.qualifier=b[1-T].qualifier,I.participantId=S})}return{...le}}({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:o,structure:s,event:r}):function({inContextDrawMatchUps:c,tournamentRecord:u,drawDefinition:d,drawPositions:p,matchUpsMap:h,structure:f,event:m}){const g=f==null?void 0:f.positionAssignments.filter(y=>p==null?void 0:p.includes(y.drawPosition));if(!g)return{error:Re,structure:f,info:"Missing positionAssignments"};if(g.filter(({bye:y})=>y).length===2)return{...le};if(g.filter(({qualifier:y})=>y).length===2)return{...le};const v=g.some(({qualifier:y})=>y);return g.some(({bye:y})=>y)&&!v?X7({inContextDrawMatchUps:c,tournamentRecord:u,drawDefinition:d,assignments:g,matchUpsMap:h,structure:f,event:m}):function({inContextDrawMatchUps:y,tournamentRecord:b,drawDefinition:I,assignments:T,matchUpsMap:S,structure:w,event:U}){const D=Object.assign({},...T.map((E,C)=>{const{drawPosition:M}=E;return{[M]:{...T[1-C],drawPosition:M}}}));return w.positionAssignments=w.positionAssignments.map(E=>D[E.drawPosition]||E),J2({inContextDrawMatchUps:y,tournamentRecord:b,drawDefinition:I,matchUpsMap:S,assignments:T,structure:w,event:U}),{...le}}({inContextDrawMatchUps:c,tournamentRecord:u,drawDefinition:d,assignments:g,matchUpsMap:h,structure:f,event:m})}({inContextDrawMatchUps:a,tournamentRecord:t,drawDefinition:e,drawPositions:i,matchUpsMap:o,structure:s,event:r}),l.error)return l;if(PW({structure:s,drawPositions:i}),mk({drawDefinition:e,positionAction:{name:"swapDrawPositionAssignments",drawPositions:i,structureId:n}}),of({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,structure:s,event:r}),r.eventType===$c){const c=zi({matchUpFilters:{matchUpTypes:[Ad]},inContext:!0,structure:s}).matchUps.filter(d=>{var p;return(p=d.drawPositions)==null?void 0:p.some(h=>i.includes(h))}),u=zi({structure:s,matchUpFilters:{matchUpTypes:[Ad]}}).matchUps;c.forEach(d=>{(d.sides||[]).forEach(p=>{var h;const f=p==null?void 0:p.drawPosition;if(i.includes(f)){const m=p.participantId,g=u.find(({matchUpId:y})=>y===d.matchUpId),v=(h=d==null?void 0:d.sides)==null?void 0:h.reduce((y,b,I)=>b.drawPosition===f?I:y,void 0);YW({inContextTargetMatchUp:d,drawPositionSideIndex:v,teamParticipantId:m,tournamentRecord:t,drawDefinition:e,matchUp:g,event:r})}})})}return un({drawDefinition:e,structureIds:[n]}),{...le}}function X7({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,assignments:n,matchUpsMap:r,structure:o,event:a}){const s=n.find(({bye:f})=>f),l=n.find(({participantId:f})=>f),c=s.drawPosition,{participantId:u,drawPosition:d}=l,{structureId:p}=o;let h=MU({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r});return h.error?h:(h=MU({drawPosition:d,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r}),h.error?h:(Ms({drawPosition:d,tournamentRecord:e,drawDefinition:i,structureId:p,matchUpsMap:r,event:a}),h=lu({drawPosition:c,inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:p,participantId:u,matchUpsMap:r,event:a}),h.error?h:{...le}))}function pde(t){return mxe(t)}function hde({validation:t=!0,tournamentRecord:e,drawDefinition:i,participantId:n,structureId:r,seedValue:o,event:a}){if(!i)return{error:rt};if(!r)return{error:Va};const s=((e==null?void 0:e.participants)??[]).find(p=>p.participantId===n);if(e&&!s)return{error:Dd};const{structure:l}=kt({drawDefinition:i,structureId:r});if(!l)return{error:Cn};if(!(!t||ir(o)||o===void 0||o===""||typeof o=="string"&&o.split("-").every(p=>ir(p)&&Ct(p)>0)))return{error:Re};const{seedAssignments:c}=ul({drawDefinition:i,structure:l}),u=c==null?void 0:c.map(p=>p.seedNumber),d=c==null?void 0:c.find(p=>p.participantId===n);if(d){const p=typeof o=="string"?o.includes("-")&&o.split("-").map(h=>parseInt(h)).join("-")||parseInt(o)>0&&parseInt(o)||"":o&&o>0&&o||"";d.seedValue=p}else{const p={seedNumber:Math.max(0,...u||[])+1,participantId:n};o&&(p.seedValue=o),l.seedAssignments||(l.seedAssignments=[]),l.seedAssignments.push(p)}return Iue({tournamentId:e==null?void 0:e.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:i,structure:l}),{...le}}function fde({drawDefinition:t,structureId:e}){if(!t)return{error:rt};const{structure:i}=kt({drawDefinition:t,structureId:e}),n=((t==null?void 0:t.links)||[]).filter(r=>{var o;return((o=r.source)==null?void 0:o.structureId)===e}).map(r=>{var o;return(o=r.target)==null?void 0:o.structureId});return{playoffStructures:((t==null?void 0:t.structures)||[]).filter(r=>n.includes(r.structureId)),structure:i}}function xk({withStageGrouping:t,stageSequences:e,stageSequence:i,roundTarget:n,stages:r,event:o,stage:a}){if(!o)return{error:Fi};const s={},l=[];for(const c of o.drawDefinitions||[]){const{structures:u,stageStructures:d}=Nd({withStageGrouping:t,stageSequences:e,drawDefinition:c,stageSequence:i,roundTarget:n,stages:r,stage:a});if(l.push(...u),d)for(const p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function e3({withStageGrouping:t,tournamentRecord:e,stageSequences:i,stageSequence:n,roundTarget:r,stages:o,stage:a}){if(!e)return{error:je};const s={},l=[];for(const c of e.events||[]){const{structures:u,stageStructures:d}=xk({withStageGrouping:t,stageSequences:i,stageSequence:n,roundTarget:r,stages:o,event:c,stage:a});if(u&&l.push(...u),d)for(const p of Object.keys(d))s[p]||(s[p]=[]),s[p].push(...d[p])}return{structures:l,stageStructures:s}}function Bh(t){if(!(t!=null&&t.drawDefinition))return!1;const e=Ek(t),i=e==null?void 0:e.includesTeamMatchUps;let{completedMatchUps:n,pendingMatchUps:r,upcomingMatchUps:o}=e||{};return i&&(n=n==null?void 0:n.filter(({matchUpType:a})=>a===gn),r=r==null?void 0:r.filter(({matchUpType:a})=>a===gn),o=o==null?void 0:o.filter(({matchUpType:a})=>a===gn)),!!(n!=null&&n.length&&!(r!=null&&r.length)&&!(o!=null&&o.length))}function t3(t){var e,i;const{drawDefinition:n,structureId:r}=t;if(!n)return{error:rt};const{playoffStructures:o}=fde({drawDefinition:n,structureId:r});if(!(o!=null&&o.length))return!1;const a=((i=(e=n==null?void 0:n.entries)==null?void 0:e.filter(l=>(l==null?void 0:l.entryStatus)&&Zc.includes(l.entryStatus)))==null?void 0:i.length)??0;let s=0;return(o||[]).reduce((l,c)=>{const u=Ki({structure:c}).positionAssignments??[];return!(!(u!=null&&u.filter(d=>(d.participantId&&s++,(d==null?void 0:d.bye)??(d==null?void 0:d.participantId))).length)||!l)},!!o.length)||s===a}function Q2({significantCharacters:t,accessors:e=[],value:i}){const n=[],r=e[0];if(i!=null&&i[r]){const o=e.slice(1);if(Array.isArray(i[r]))i[r].forEach(a=>{const s=Q2({accessors:o,significantCharacters:t,value:a});n.push(...s)});else if(i=i[r],o.length){const a=Q2({accessors:o,significantCharacters:t,value:i});n.push(...a)}else(function({value:a}){if(a&&["string","number"].includes(typeof a)){const s=t?a.slice(0,t):a;n.push(s)}})({value:i})}return n}function mde({policyAttributes:t,idCollections:e,participants:i,participant:n}){if(!Array.isArray(t))return{error:rce};if(!n)return{error:A0};const r=[];return t.forEach(o=>{const{directive:a,groupings:s,key:l,significantCharacters:c}=o||{};if(l){const u=l.split(".");r.push(...Q2({significantCharacters:c,value:n,accessors:u}))}else if(a){const u=o==null?void 0:o.includeIds,d=((e==null?void 0:e[a])||[]).filter(p=>!u||u.includes(p));d!=null&&d.length&&i!=null&&i.length&&d.forEach(p=>{var h;const f=i.find(m=>m.participantId===p);if((h=f==null?void 0:f.individualParticipantIds)!=null&&h.includes(n.participantId)){const m=f==null?void 0:f.participantId;r.push(m)}})}else s&&Object.keys(s).forEach(u=>{s[u].includes(n.participantId)&&r.push(u)})}),{values:ti(r)}}function J7({candidatePositionAssignments:t,participantsWithGroupings:e,policyAttributes:i,idCollections:n}){const r=Object.assign({},...e.map(o=>({[o.participantId]:o})));return t.map(o=>{const a=r[o.participantId],{values:s}=mde({participants:e,policyAttributes:i,idCollections:n,participant:a});return{...o,values:s}})}function gde({participantIdGroups:t,positionAssignments:e,groupsToAvoid:i}){return Object.assign({},...e.filter(n=>n==null?void 0:n.participantId).map(n=>{const{drawPosition:r,participantId:o}=n,a=t&&t[o]||[],s=!!i.some(l=>a.includes(l));return{[r]:{participantGroups:a,includesGroupsToAvoid:s}}}))}function gxe(t){const{unfilledPositions:e,chunkedDrawPositions:i}=t,n=gde(t);return i.map(r=>{const o=e.filter(l=>r.includes(l)),a=function(l){return l.filter(u=>!c(u));function c(u){const d=Q7(u);return!l.includes(d)}}(o),s=o.filter(l=>!a.includes(l)).filter(l=>{var c;const u=Q7(l);return!((c=n[u])!=null&&c.includesGroupsToAvoid)});return{unassigned:o,unpaired:a,pairedNoConflict:s}})}function Q7(t){return Number(t%2?t+1:t-1)}function vxe({selectedParticipantGroups:t,participantIdGroups:e,positionAssignments:i,drawPositionChunks:n,unfilledPositions:r,isRoundRobin:o}){const a=n.map(s=>o?function(l){const{unfilledPositions:c,chunkedDrawPositions:u}=l,d=gde(l);return u.map(p=>{const h=c.filter(g=>p.includes(g)),f=h.length===p.length?h:[],m=p.filter(g=>{var v;return(v=d[g])==null?void 0:v.includesGroupsToAvoid}).length;return{unassigned:h,unpaired:f,pairedNoConflict:m?[]:h,conflictsCount:m}})}({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}):gxe({groupsToAvoid:t,chunkedDrawPositions:s,participantIdGroups:e,positionAssignments:i,unfilledPositions:r}));return o?{unassigned:a.map(s=>s.map(l=>l.unassigned).filter(l=>l==null?void 0:l.length)).filter(s=>s==null?void 0:s.length).sort((s,l)=>(l.length||0)-(s.length||0)),unpaired:a.map(s=>s.map(l=>l.unpaired).filter(l=>l==null?void 0:l.length)).filter(s=>s==null?void 0:s.length),pairedNoConflict:a.map(s=>s.map(l=>l.pairedNoConflict).filter(l=>l==null?void 0:l.length)).filter(s=>s==null?void 0:s.length).sort((s,l)=>(l.length||0)-(s.length||0))}:{unassigned:a.map(s=>s.map(l=>l.unassigned).filter(l=>l==null?void 0:l.length)).filter(s=>s==null?void 0:s.length),unpaired:a.map(s=>s.map(l=>l.unpaired).filter(l=>l==null?void 0:l.length)).filter(s=>s==null?void 0:s.length),pairedNoConflict:a.map(s=>s.map(l=>l.pairedNoConflict).filter(l=>l==null?void 0:l.length)).filter(s=>s==null?void 0:s.length)}}function vde({positionAssignments:t,participantIds:e}){const i=t.map(n=>n.participantId);return e.filter(n=>!i.includes(n))}function yxe({candidatePositionAssignments:t,unseededParticipantIds:e,participantIdGroups:i,drawPositionChunks:n,drawPositionGroups:r,pairedPriority:o,allGroups:a,groupKey:s}){const l=r.reduce((U,D)=>D.length>U?D.length:U,0)<=2,c=vde({positionAssignments:t,participantIds:e}),u=function({drawPositionGroups:U,positionAssignments:D}){const E=Object.assign({},...D.map(C=>({[C.drawPosition]:C})));return U.map(C=>C.filter(Boolean).map(M=>E[M]).filter(Boolean).filter(M=>!M.participantId&&!M.bye).map(M=>M.drawPosition)).flat().filter(Boolean)}({positionAssignments:t,drawPositionGroups:r}),{participantId:d,groupKey:p}=function({useSpecifiedGroupKey:U=!1,targetParticipantIds:D,largestFirst:E=!0,allGroups:C,groupKey:M}){var N;const R=Object.assign({},...Object.keys(C).map(O=>[O,C[O].filter(F=>D.includes(F))]).filter(O=>O[1].length).map(([O,F])=>({[O]:F}))),A=Object.keys(R).reduce((O,F)=>R[F].length>O?R[F].length:O,0),_=Object.keys(R).filter(O=>R[O].length===A),k=Al(E?_:Object.keys(R));return{participantId:(M=U&&(N=R[M])!=null&&N.length?M:k)&&R[M]?Al(R[M]):Al(D),groupKey:M}}({targetParticipantIds:c,useSpecifiedGroupKey:l,allGroups:a,groupKey:s}),h=function({allGroups:U,participantId:D}){return Object.keys(U).filter(E=>U[E].includes(D))}({participantId:d,allGroups:a}),f=vxe({positionAssignments:t,isRoundRobin:l,selectedParticipantGroups:h,participantIdGroups:i,drawPositionChunks:n,unfilledPositions:u}),{unassigned:m,unpaired:g,pairedNoConflict:v}=f,y=(v==null?void 0:v.length)&&v[0],b=(g==null?void 0:g.length)&&g[0],I=o&&y?y:b,T=o?b:y,S=(I==null?void 0:I.length)&&I||(T==null?void 0:T.length)&&T;let w;if(S!=null&&S.length){const U=es(S);w=es(U)}else{const U=es(m[0]);w=es(U)}return{newGroupKey:p,selectedParticipantId:d,targetDrawPosition:w}}function AR({isRoundRobin:t,groupedParticipants:e}){const i=[];return t?e.forEach(n=>{const r=KW({drawPositions:n.map(a=>a.drawPosition)}).uniqueMatchUpGroupings??[],o=Object.assign({},...n.map(a=>({[a.drawPosition]:a})));r.forEach(a=>{ua(o[a[0]].values||[],o[a[1]].values||[])&&(i.push(a),n.conflict=!0)})}):e.forEach(n=>{var r,o;ua(((r=n[0])==null?void 0:r.values)||[],((o=n[1])==null?void 0:o.values)||[])&&(i.push(n),n.conflict=!0)}),i}function bxe({positionedParticipants:t,potentialDrawPositions:e,drawPositionGroups:i,avoidanceConflicts:n,isRoundRobin:r}){return n.map(o=>{const a=o.map(s=>s.drawPosition);return o.filter(s=>e.includes(s.drawPosition)).map(s=>{const l=e.filter(c=>!(a!=null&&a.includes(c))).filter(c=>{const u=i.find(m=>m.includes(c)).find(m=>m!==c),d=t.find(m=>m.drawPosition===u),p=AR({isRoundRobin:r,groupedParticipants:[[s,d]]}),h=t.find(m=>m.drawPosition===c),f=AR({isRoundRobin:r,groupedParticipants:[[h,d]]});return!p.length&&!f.length});if(l.length)return{drawPosition:s.drawPosition,possibleDrawPositions:l}}).filter(Boolean)}).flat(1)}function eY(t){const{initialPositionAssignments:e,participantsWithGroupings:i,opponentsToPlaceCount:n,unseededByePositions:r,drawPositionGroups:o,policyAttributes:a,idCollections:s,allGroups:l}=t,c=[];let u;const d=Math.min(...(o||[]).map(b=>b==null?void 0:b.length).filter(Boolean)),p=d>2,h=ft(e,!1,!0).filter(b=>!b.qualifier),f=e.filter(b=>!b.participantId&&(!b.bye||(r==null?void 0:r.includes(b.drawPosition)))).map(b=>b.drawPosition);nt(0,n).forEach(()=>{const{newGroupKey:b,selectedParticipantId:I,targetDrawPosition:T}=yxe({...t,candidatePositionAssignments:h,allGroups:l,groupKey:u});u=b,h.forEach(S=>{S.drawPosition===T&&(S.participantId=I)})});let m=J7({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:a,idCollections:s}),g=Kr(m,d),v=AR({groupedParticipants:g,isRoundRobin:p}),y=0;for(;y<20&&v.length;){const b=bxe({positionedParticipants:m,potentialDrawPositions:f,avoidanceConflicts:v,drawPositionGroups:o,isRoundRobin:p});if(b.length){const I=Ixe({candidatePositionAssignments:h,swapOptions:b});I.error&&console.log({result:I}),m=J7({candidatePositionAssignments:h,participantsWithGroupings:i,policyAttributes:a,idCollections:s}),g=Kr(m,d),v=AR({groupedParticipants:g,isRoundRobin:p}),y++}else y=20}return h.forEach(b=>{if(b.bye&&b.participantId){const I=w7;c.push(I)}if(b.qualifier&&b.participantId){const I=w7;c.push(I)}}),{positionAssignments:h,conflicts:v.length,groupedParticipants:g,errors:c}}function Ixe({candidatePositionAssignments:t,swapOptions:e}){const i=es(e);if(!i)return{error:{message:"No swap options"}};const n=i.drawPosition,r=es(i.possibleDrawPositions),o=t.find(c=>c.drawPosition===n),a=t.find(c=>c.drawPosition===r)??{},s={participantId:a==null?void 0:a.participantId,qualifier:a==null?void 0:a.qualifier,bye:a==null?void 0:a.bye},l={participantId:o.participantId,qualifier:o.qualifier,bye:o.bye};return Object.assign(o,s),Object.assign(a,l),{...le}}function wxe({provisionalPositioning:t,unseededParticipantIds:e,inContextDrawMatchUps:i,unseededByePositions:n,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,participants:s,matchUpsMap:l,structureId:c,avoidance:u,drawSize:d,event:p}){var h;if(!u)return{error:f_e};const{candidatesCount:f=1,policyAttributes:m,targetDivisions:g}=u;let{roundsToSeparate:v}=u;const y="randomUnseededSeparation",{structure:b}=kt({drawDefinition:o,structureId:c}),{matchUps:I}=zi({provisionalPositioning:t,matchUpsMap:l,structure:b,event:p});if(g&&Lc(g)&&!v){const V=function(z){if(!Lc(z))return!1;let G=z,W=1;for(;G!==2;)W+=1,G/=2;return W}(g)||0,H=I.reduce((z,G)=>G.roundNumber>z?G.roundNumber:z,0);v=H<V?1:H-V+1}const{positionAssignments:T}=Lr({structure:b}),S=EW({participantsProfile:{convertExtensions:!0},deepCopy:!1,participants:s}).participantsWithGroupings,w=T==null?void 0:T.filter(V=>!V.participantId),U=T==null?void 0:T.map(V=>V.drawPosition),D=(b==null?void 0:b.structureType)===na,E=D?{structure:b,matchUps:I,allDrawPositions:U,roundsToSeparate:v}:{matchUps:I,allDrawPositions:U,roundsToSeparate:v},{drawPositionGroups:C,drawPositionChunks:M}=D?function(V){const{structure:{structures:H}}=V,z=H.map(G=>G.positionAssignments.map(W=>W.drawPosition));return{drawPositionGroups:z,drawPositionChunks:[z]}}(E):function({allDrawPositions:V,roundsToSeparate:H,matchUps:z}){const G=z.filter(J=>J.roundNumber===1).map(J=>J.drawPositions),W=G.flat().sort(Sr),K=Math.max(...W),Z=V.filter(J=>J>K),Y=W.length,X=nt(Y===2?1:2,Y).filter(J=>J===Gz(J)),Q=X.slice(0,H||X.length).reverse(),te=Q.map(J=>Kr(W,J));return Z.length&&console.log({fedDrawPositions:Z}),{drawPositionGroups:G,drawPositionChunks:te}}(E),N={groupParticipants:s.filter(V=>V.participantType===gl).map(V=>V.participantId),teamParticipants:s.filter(V=>V.participantType===on).map(V=>V.participantId),pairParticipants:s.filter(V=>V.participantType===qt).map(V=>V.participantId)},R=function({targetParticipantIds:V,policyAttributes:H,idCollections:z,participants:G}){if(!Array.isArray(H))return{error:rce};if(!Array.isArray(G))return{error:X_};const W={};return V.forEach(K=>{const Z=G.find(X=>X.participantId===K),{values:Y}=mde({policyAttributes:H,idCollections:z,participants:G,participant:Z});Y&&Y.forEach(X=>{W[X]||(W[X]=[]),W[X].includes(K)||W[X].push(K)})}),W}({targetParticipantIds:e,policyAttributes:m,idCollections:N,participants:s});if(R.error)return ce({result:R,stack:y});const A=Object.assign({},...e.map(V=>{const H=Object.keys(R).filter(z=>(R[z]??[]).includes(V));return{[V]:H}})),_=vde({participantIds:e,positionAssignments:T});if(_.length>((w==null?void 0:w.length)||0))return{error:pce};let k;const O=_.length,F=nt(0,f).map(()=>eY({initialPositionAssignments:T,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!1,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:M,drawPositionGroups:C,policyAttributes:m,idCollections:N,allGroups:R,drawSize:d}));if(k=F.reduce((V,H)=>!V||(H.conflicts||0)<(V.conflicts||0)?H:V,void 0),!k||k.conflicts){const V=nt(0,f).map(()=>eY({initialPositionAssignments:T,participantsWithGroupings:S,unseededParticipantIds:e,opponentsToPlaceCount:O,pairedPriority:!0,unseededByePositions:n,participantIdGroups:A,drawPositionChunks:M,drawPositionGroups:C,policyAttributes:m,idCollections:N,allGroups:R,drawSize:d}));k=F.concat(...V).filter(H=>{var z;return!((z=H.errors)!=null&&z.length)}).reduce((H,z)=>!H||(z.conflicts||0)<(H.conflicts||0)?z:H,void 0)}if(!k)return{error:Jz};const B=(((h=Ki({structure:b}))==null?void 0:h.positionAssignments)??[]).filter(V=>V.participantId).map(V=>V.participantId),$=k.positionAssignments.filter(V=>!B.includes(V.participantId));for(const V of $)if(V.bye){const H=Ms({tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,structureId:c,matchUpsMap:l,event:p,...V});if(H.error)return ce({result:H,stack:y})}else if(V.participantId){const H=lu({automaticPlacement:!0,inContextDrawMatchUps:i,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,structureId:c,matchUpsMap:l,event:p,...V});if(H.error)return ce({result:H,stack:y,context:{assignment:V}})}return{...le}}function Sxe({provisionalPositioning:t,inContextDrawMatchUps:e,unseededByePositions:i,multipleStructures:n,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,participants:s,matchUpsMap:l,structureId:c,structure:u,drawSize:d,event:p}){var h,f;u||({structure:u}=kt({drawDefinition:o,structureId:c})),c||({structureId:c}=u);const{positionAssignments:m}=Lr({structure:u}),{seedAssignments:g}=ul({provisionalPositioning:t,drawDefinition:o,structure:u}),v=g==null?void 0:g.map(E=>E.participantId).filter(Boolean),{stage:y,stageSequence:b}=u,I=y===St?(f=(h=ei({element:u,name:$u}))==null?void 0:h.extension)==null?void 0:f.value:void 0,T=Qy({provisionalPositioning:t,drawDefinition:o,stageSequence:b,entryStatuses:Jy,structureId:c,roundTarget:I,stage:y}),S=T.filter(E=>!(v!=null&&v.includes(E.participantId))).map(E=>E.participantId),w=m==null?void 0:m.filter(E=>!E.participantId&&!E.bye&&!E.qualifier).map(E=>E.drawPosition);if(!n&&S.length>((w==null?void 0:w.length)||0))return ce({result:{error:pce},context:{unseededParticipantsCount:S.length,unfilledDrawPositionsCount:w==null?void 0:w.length},stack:"positionUnseededParticipants"});const{appliedPolicies:U}=Gi({tournamentRecord:r,drawDefinition:o,event:p});let D=U==null?void 0:U[yR];if(u.stage===Vn){const E=T.reduce((C,M)=>(C[M.groupingValue]||(C[M.groupingValue]=[]),C[M.groupingValue].push(M.participantId),C),{});Object.keys(E).length&&(D||(D={policyName:"Playoff Avoidance"}),D.policyAttributes||(D.policyAttributes=[]),D.policyAttributes.push({groupings:E}))}return D&&s?wxe({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unseededByePositions:i,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,participants:s,matchUpsMap:l,structureId:c,avoidance:D,drawSize:d,entries:T}):function({provisionalPositioning:E,unseededParticipantIds:C,inContextDrawMatchUps:M,unfilledDrawPositions:N,multipleStructures:R,tournamentRecord:A,drawDefinition:_,seedBlockInfo:k,matchUpsMap:O,structureId:F,drawSize:B,event:$}){const V=B>2?Qo(N):N.reverse();for(const H of C){const z=V.pop();if(!R||z){const G=lu({provisionalPositioning:E,inContextDrawMatchUps:M,tournamentRecord:A,drawDefinition:_,seedBlockInfo:k,participantId:H,drawPosition:z,matchUpsMap:O,structureId:F,event:$});if(G!=null&&G.error&&console.log("!!!!!",{result:G}),G==null?void 0:G.error)return ce({result:G,stack:"randomUnseededDistribution"})}}return{...le}}({provisionalPositioning:t,unseededParticipantIds:S,inContextDrawMatchUps:e,unfilledDrawPositions:w,multipleStructures:n,tournamentRecord:r,drawDefinition:o,seedBlockInfo:a,structureId:c,matchUpsMap:l,drawSize:d,event:p})}function Txe(t){const e=t.structure??kt(t).structure,i="positionQualifiers",n=[];if(e.stage===So)return ce({result:{error:Wy},stack:i});const{unplacedRoundQualifierCounts:r,positionAssignments:o,roundDrawPositions:a}=function({drawDefinition:s,structure:l,structureId:c}){l||({structure:l}=kt({drawDefinition:s,structureId:c})),c||({structureId:c}=l);const{positionAssignments:u}=Lr({structure:l}),{stage:d,stageSequence:p}=l,{qualifiersCount:h,roundQualifiersCounts:f}=G0({drawDefinition:s,stageSequence:p,structureId:c,stage:d}),m=(f?Object.keys(f):[]).map(S=>Ct(S)),{matchUps:g}=zi({structure:l}),{roundProfile:v}=ba({matchUps:g}),y=Object.assign({},...m.filter(S=>v==null?void 0:v[S]).map(S=>{var w,U;return{[S]:((U=(w=v==null?void 0:v[S])==null?void 0:w.drawPositions)==null?void 0:U.filter(Boolean))??[]}})),b=u==null?void 0:u.filter(S=>S.qualifier).map(S=>S.drawPosition),I=h-((b==null?void 0:b.length)??0),T=b==null?void 0:b.length;return{unplacedRoundQualifierCounts:Object.assign({},...m.map(S=>{const w=u==null?void 0:u.filter(U=>{var D,E;return U.qualifier&&((E=(D=y[S])==null?void 0:D.drawPositions)==null?void 0:E.includes(U.drawPosition))}).map(U=>U.drawPosition);return{[S]:((f==null?void 0:f[S])??0)-((w==null?void 0:w.length)??0)}})),unplacedQualifiersCount:I,placedQualifiersCount:T,roundQualifiersCounts:f,positionAssignments:u,roundDrawPositions:y,qualifiersCount:h}}(t);for(const s of Object.keys(r)){const l=o==null?void 0:o.filter(c=>a[s].includes(c.drawPosition)&&!c.participantId&&!c.qualifier&&!c.bye).map(c=>c.drawPosition);if(r[s]>(l||0))return ce({result:{error:__e},context:{unfilledDrawPositions:l},stack:i});nt(0,r[s]).forEach(()=>{const c=es(l);n.push(c),o==null||o.forEach(u=>{u.drawPosition===c&&(u.qualifier=!0,delete u.participantId,delete u.bye)})})}return{...le,qualifierDrawPositions:n}}function Uxe({orderedSortedFirstRoundSeededDrawPositions:t,validSeedBlocks:e,byesToPlace:i}){const n=[];e.forEach(o=>{if(i-n.length>o.drawPositions.length)n.push(...o.drawPositions);else{const a=tB(Kr(o.drawPositions,2));let s,l=t[n.length];for(;s=eB(a,l);)n.push(s),l=t[n.length]}});const r=n.map(o=>Array.isArray(o)?Qo(o):o).flat(1/0);return Hle(i)&&e.map(o=>o.seedNumbers[0]).includes(i)?t:r}function eB(t,e){if(Array.isArray(t)&&t.length!==2)return t.pop();if(!Array.isArray(t[0]))return t.includes(e)?t.indexOf(e)?t.pop():t.shift():Math.round(Math.random())?t.pop():t.shift();const i=t[0].flat(1/0).length,n=t[1].flat(1/0).length;if(i===n){const r=t[0].flat(1/0).includes(e)?t[0]:t[1];return eB(e?r:t[Math.round(Math.random())],e)}return eB(i<n?t[1]:t[0],e)}function tB(t){const e=Math.floor(t.length/2);return t.length>2?[tB(t.slice(0,e)),tB(t.slice(e))]:t}function Dxe({provisionalPositioning:t,relevantMatchUps:e,appliedPolicies:i,drawDefinition:n,seedingProfile:r,seedBlockInfo:o,byesToPlace:a,structure:s}){var l;o||(o=lb({provisionalPositioning:t,appliedPolicies:i,drawDefinition:n,seedingProfile:r,structure:s}));const{isFeedIn:c,isLuckyStructure:u,isContainer:d}=o;let{validSeedBlocks:p}=o;(l=i==null?void 0:i.seeding)!=null&&l.containerByesIgnoreSeeding&&(p=[]);const h=function({provisionalPositioning:b,drawDefinition:I,structure:T}){const{positionAssignments:S}=Lr({structure:T}),{seedAssignments:w}=ul({provisionalPositioning:b,drawDefinition:I,structure:T}),U=Object.assign({},...(w||[]).filter(D=>D.participantId).map(D=>({[D.participantId]:D})));return S==null?void 0:S.map(D=>U[D.participantId]?{...D,seedNumber:U[D.participantId].seedNumber,seedValue:U[D.participantId].seedValue}:"").filter(Boolean)}({provisionalPositioning:t,drawDefinition:n,structure:s})??[],f=ti([].concat(...e.map(b=>b.drawPositions))),m=h.filter(b=>f.includes(b.drawPosition)),g=(b,I)=>gw(b.seedValue)-gw(I.seedValue),v=p.reduce((b,I)=>{const T=m.filter(S=>{var w;return(w=I.drawPositions)==null?void 0:w.includes(S.drawPosition)}).sort(g);return b.concat(...T)},[]).map(b=>b.drawPosition),y=Uxe({orderedSortedFirstRoundSeededDrawPositions:v,validSeedBlocks:p,byesToPlace:a});return{strictSeedOrderByePositions:tY({orderedSeedDrawPositions:v,relevantMatchUps:e}).slice(0,a),blockSeedOrderByePositions:tY({orderedSeedDrawPositions:y,relevantMatchUps:e}).slice(0,a),isLuckyStructure:u,positionedSeeds:h,isContainer:d,isFeedIn:c}}function tY({orderedSeedDrawPositions:t,relevantMatchUps:e}){const i=e.map(n=>n.drawPositions).map(n=>n==null?void 0:n.sort((r,o)=>r-o)).filter(n=>(n==null?void 0:n[0])+1===(n==null?void 0:n[1]));return t.map(n=>i.find(r=>r==null?void 0:r.includes(n))).filter(Boolean).map(n=>n==null?void 0:n.reduce((r,o)=>t.includes(o)?r:o,void 0)).filter(Boolean)}function iY({provisionalPositioning:t,tournamentRecord:e,appliedPolicies:i,drawDefinition:n,seedBlockInfo:r,seedingProfile:o,matchUpsMap:a,structureId:s,structure:l,seedLimit:c,seedsOnly:u,event:d}){var p;l||({structure:l}=kt({drawDefinition:n,structureId:s})),s||(s=l==null?void 0:l.structureId);const h=!((l==null?void 0:l.structures)??(l==null?void 0:l.stage)===St),{byesCount:f,placedByes:m,relevantMatchUps:g}=function({provisionalPositioning:C,drawDefinition:M,matchUpsMap:N,structure:R,event:A}){var _;const{matchUps:k,roundMatchUps:O}=zi({afterRecoveryTimes:!1,provisionalPositioning:C,drawDefinition:M,matchUpFilters:{isCollectionMatchUp:!1},matchUpsMap:N,structure:R,event:A}),F=(O==null?void 0:O[1])||[],B=(R==null?void 0:R.structureType)===na,$=B?k:F,V=B?((_=R==null?void 0:R.structures)==null?void 0:_.length)||0:k.length,{structureId:H,stage:z,stageSequence:G}=R,W=Qy({entryStatuses:Zc,provisionalPositioning:C,drawDefinition:M,stageSequence:G,structureId:H,stage:z}),{qualifiersCount:K}=G0({provisionalPositioning:C,drawDefinition:M,stageSequence:G,structureId:H,stage:z}),Z=W.length+K,{positionAssignments:Y,unassignedPositions:X}=Lr({structure:R}),Q=X==null?void 0:X.map(re=>re.drawPosition),te=Y==null?void 0:Y.filter(re=>re.bye).length,J=Y==null?void 0:Y.filter(re=>re.bye).map(re=>re.drawPosition),ie=$.map(re=>re.drawPositions).filter(re=>re==null?void 0:re.reduce((me,he)=>!(J!=null&&J.includes(he))&&me,!0)).flat(1/0).filter(re=>Q==null?void 0:Q.includes(re)),oe=Y==null?void 0:Y.length;let ne=oe?oe-Z:0;return ne>V&&R.stageSequence===1&&R.stage!==So&&(ne=V),{placedByes:te,byesCount:ne,relevantMatchUps:$,placedByePositions:J,roundMatchUps:O,positionsToAvoidDoubleBye:ie}}({provisionalPositioning:t,drawDefinition:n,matchUpsMap:a,structure:l,event:d}),v=f-(m||0);if(v<=0)return{...le};const{strictSeedOrderByePositions:y,blockSeedOrderByePositions:b,isLuckyStructure:I,isFeedIn:T}=Dxe({provisionalPositioning:t,relevantMatchUps:g,appliedPolicies:i,drawDefinition:n,seedingProfile:o,seedBlockInfo:r,byesToPlace:v,structure:l}),S=(l==null?void 0:l.structureType)&&[na,pk].includes(l.structureType)&&((p=i==null?void 0:i.seeding)==null?void 0:p.containerByesIgnoreSeeding),w=h&&b!=null&&b.length?b:y;let{unseededByePositions:U}=function({provisionalPositioning:C,seedOrderByePositions:M,isLuckyStructure:N,appliedPolicies:R,drawDefinition:A,seedLimit:_,structure:k,isFeedIn:O}){var F,B;const $=(F=R==null?void 0:R.seeding)==null?void 0:F.seedingProfile,V=k.stage===St,{positionAssignments:H}=Lr({structure:k}),z=H==null?void 0:H.filter(De=>De.participantId).map(De=>De.drawPosition),{matchUps:G,roundMatchUps:W}=zi({provisionalPositioning:C,matchUpFilters:{isCollectionMatchUp:!1},structure:k}),K=(W==null?void 0:W[1])||[],Z=k.structureType===na?G:K,Y=ti([].concat(...Z.map(De=>De.drawPositions))),X=Math.min(...Y)-1,Q=z==null?void 0:z.filter(De=>Y.includes(De)),te=De=>{const Oe=Math.ceil(De.length/2),xe=[De.slice(0,Oe),De.slice(Oe)],$e=xe.map(Le=>[].concat(...Le.flat(1/0)).length),Ae=Math.min(...$e.flat(1/0)),ve=Math.max(...$e.flat(1/0)),ke=$e.indexOf(ve),ye=Ae!==ve,Ie=Qo(xe),[Ne,Fe]=!Ae||ye?[xe[ke],xe[1-ke]]:[Ie[0],Ie[1]];return{greaterHalf:Ne,lesserHalf:Fe}},J=De=>{const{greaterHalf:Oe,lesserHalf:xe}=te(De),{greaterHalf:$e,lesserHalf:Ae}=te(Oe),ve=Qo($e.flat(1/0)).pop();return{newlyFilteredChunks:[...xe,...Ae,$e.flat().filter(ke=>ke!==ve)],drawPosition:ve}},ie=De=>!(Q!=null&&Q.includes(De)),oe=De=>{let Oe=Kr(De.sort(Sr),Math.ceil(De.length/4)).map(Ae=>Ae.filter(ie));const xe=[].concat(...Oe.flat(1/0)).length,$e=[];for(let Ae=0;Ae<xe;Ae++){const{newlyFilteredChunks:ve,drawPosition:ke}=J(Oe);$e.push(ke),Oe=ve}return $e},{validSeedBlocks:ne}=lb({provisionalPositioning:C,allPositions:!0,appliedPolicies:R,drawDefinition:A,structure:k}),re=ne==null?void 0:ne.map(De=>{var Oe;return(Oe=De.drawPositions)==null?void 0:Oe.map(xe=>xe+X)});let me;if(O){const De=Y.length,{seedBlocks:Oe}=ZW({cluster:lT($)===dk,participantsCount:De});me=Oe.map(xe=>xe.map($e=>$e+X)).map(oe).filter(xe=>xe.length)}else me=V?re==null?void 0:re.map(De=>De.filter(ie)):re==null?void 0:re.map(oe).filter(De=>De.length);const he=Z.map(De=>De.drawPositions).map(De=>De==null?void 0:De.sort((Oe,xe)=>Oe-xe)).filter(De=>(De==null?void 0:De[0])+1===(De==null?void 0:De[1])),be=De=>he.reduce((Oe,xe)=>xe.includes(De)?xe.reduce(($e,Ae)=>Ae!==De?Ae:$e,void 0):Oe,void 0);let Se=me.map(De=>De.map(be)).flat(1/0).filter(ie).filter(De=>!M.includes(De)).filter(Boolean);if(V&&!k.structures){const De=_%4,Oe=Se.slice(0,De),xe=(B=W[k.roundLimit])==null?void 0:B.length,$e=Kr(Se.slice(De),xe).map(Qo).flat();Se=Oe.concat($e)}return{unseededByePositions:Se}}({provisionalPositioning:t,seedOrderByePositions:w,isLuckyStructure:I,appliedPolicies:i,drawDefinition:n,seedLimit:c,structure:l,isFeedIn:T}),D=[].concat(...w);if(!u)for(;U.length;){const C=U.find(M=>{return N=M,(D||[]).every(R=>R%2?N!==R+1:N!==R-1);var N});C?(D.push(C),U=U.filter(M=>M!==C)):(D.push(...U),U=[])}S&&(D=Qo(D),Wl({ignoreSeededByes:S})&&console.log({byePositions:D}));const E=D.slice(0,v);for(const C of E){const M=Ms({provisionalPositioning:t,tournamentRecord:e,drawDefinition:n,drawPosition:C,matchUpsMap:a,structureId:s,structure:l,event:d});if(M!=null&&M.error)return M}return{...le,unseededByePositions:U,byeDrawPositions:E}}function nY({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,appliedPolicies:n,validSeedBlocks:r,drawDefinition:o,seedingProfile:a,seedBlockInfo:s,participants:l,groupsCount:c,structureId:u,matchUpsMap:d,structure:p,event:h}){const f=[],m=[];let g=0;if(p||({structure:p}=kt({drawDefinition:o,structureId:u})),u||(u=p==null?void 0:p.structureId),n||(n=Gi({drawDefinition:o}).appliedPolicies),!r){const v=p&&lb({provisionalPositioning:t,appliedPolicies:n,drawDefinition:o,seedingProfile:a,structure:p});v!=null&&v.error&&m.push(v.error),r=v==null?void 0:v.validSeedBlocks}return nt(0,c=c??(r==null?void 0:r.length)??0).forEach(()=>{if(g<(c||0)){const v=function({provisionalPositioning:y,inContextDrawMatchUps:b,tournamentRecord:I,drawDefinition:T,seedingProfile:S,seedBlockInfo:w,participants:U,structureId:D,matchUpsMap:E,event:C}){const{unplacedSeedParticipantIds:M,unfilledPositions:N}=ade({provisionalPositioning:y,randomize:!0,drawDefinition:T,seedingProfile:S,seedBlockInfo:w,structureId:D,event:C});Gi({drawDefinition:T});const R=[];for(const A of M){const _=N.pop();if(!_)return{error:xP};R.push(_);const k=lu({provisionalPositioning:y,inContextDrawMatchUps:b,tournamentRecord:I,drawDefinition:T,seedingProfile:S,participantId:A,seedBlockInfo:w,drawPosition:_,matchUpsMap:E,structureId:D,event:C});if(!k.success)return k}return{...le,seedPositions:R}}({provisionalPositioning:t,inContextDrawMatchUps:e,tournamentRecord:i,drawDefinition:o,seedingProfile:a,seedBlockInfo:s,participants:l,structureId:u,matchUpsMap:d,event:h});v!=null&&v.success&&(g++,f.push(...v.seedPositions??[])),v.error&&m.push({seedPositionError:v.error})}}),m.length?{error:m}:{...le,seedPositions:f}}function uC({applyPositioning:t=!0,provisionalPositioning:e,inContextDrawMatchUps:i,multipleStructures:n,placeByes:r=!0,tournamentRecord:o,appliedPolicies:a,placementGroup:s,drawDefinition:l,seedingProfile:c,structureId:u,matchUpsMap:d,seedLimit:p,seedsOnly:h,drawType:f,drawSize:m,event:g}){var v,y;const b=[];t||(eke(),l=ft(l,!1,!0));const I=k=>(t||YO(),ce({result:k,stack:"automatedPositioning"})),T=kt({drawDefinition:l,structureId:u});if(T.error)return I(T);const S=T.structure;if(!S)return{error:Cn};a||(a=(v=Gi({drawDefinition:l,structure:S,event:g}))==null?void 0:v.appliedPolicies);const{qualifiersCount:w}=G0({stageSequence:S.stageSequence,provisionalPositioning:e,stage:S.stage,drawDefinition:l,structureId:u}),U=Jy,D=Qy({stageSequence:S.stageSequence,provisionalPositioning:e,stage:S.stage,placementGroup:s,drawDefinition:l,entryStatuses:U,structureId:u});if(!(D!=null&&D.length)&&!w)return E={...le},t||YO(),E;var E;d=d??ma({drawDefinition:l}),i||({matchUps:i}=Ar({inContext:!0,drawDefinition:l,matchUpsMap:d}));let C=[];const M=lb({provisionalPositioning:e,appliedPolicies:a,drawDefinition:l,seedingProfile:c,structure:S});if(M.error)return M;const{validSeedBlocks:N}=M;b.push({validSeedBlocks:N});const R=o?(y=Qn({withIndividualParticipants:!0,tournamentRecord:o}))==null?void 0:y.participants:[];if(lT(S.seedingProfile||c)===Hm){let k=r?iY({provisionalPositioning:e,tournamentRecord:o,appliedPolicies:a,drawDefinition:l,seedBlockInfo:M,matchUpsMap:d,structure:S,seedLimit:p,seedsOnly:h,event:g}):void 0;if(k!=null&&k.error||(C=k.unseededByePositions,b.push({action:"positionByes",unseededByePositions:C}),k=nY({seedingProfile:S.seedingProfile?{positioning:S.seedingProfile}:c,provisionalPositioning:e,inContextDrawMatchUps:i,tournamentRecord:o,appliedPolicies:a,validSeedBlocks:N,drawDefinition:l,seedBlockInfo:M,participants:R,matchUpsMap:d,structure:S,event:g}),k.error))return I(k);b.push({seedPositions:k.seedPositions,action:"positionSeedBlocks"})}else{if(f!==Gm){const O=nY({seedingProfile:S.seedingProfile?{positioning:S.seedingProfile}:c,provisionalPositioning:e,inContextDrawMatchUps:i,tournamentRecord:o,appliedPolicies:a,validSeedBlocks:N,drawDefinition:l,seedBlockInfo:M,participants:R,matchUpsMap:d,structure:S,event:g});if(O.error)return I(O);b.push({action:"positionSeedBlocks",seedPositions:O.seedPositions})}const k=r?iY({provisionalPositioning:e,tournamentRecord:o,appliedPolicies:a,drawDefinition:l,seedBlockInfo:M,matchUpsMap:d,structure:S,seedLimit:p,seedsOnly:h,event:g}):void 0;if(k!=null&&k.error)return I(k);C=k==null?void 0:k.unseededByePositions,b.push({action:"positionByes",byeDrawPositions:k==null?void 0:k.byeDrawPositions,unseededByePositions:C})}const A={};if(!h){let k=Txe({inContextDrawMatchUps:i,tournamentRecord:o,appliedPolicies:a,validSeedBlocks:N,drawDefinition:l,seedBlockInfo:M,participants:R,matchUpsMap:d,structure:S});if(k.error||(k.conflicts&&(A.qualifierConflicts=k.conflicts),b.push({action:"positionQualifiers",qualifierDrawPositions:k.qualifierDrawPositions}),k=Sxe({provisionalPositioning:e,inContextDrawMatchUps:i,unseededByePositions:C,multipleStructures:n,tournamentRecord:o,drawDefinition:l,seedBlockInfo:M,participants:R,matchUpsMap:d,structureId:u,structure:S,drawSize:m,event:g}),k.error))return I(k);k.conflicts&&(A.unseededConflicts=k.conflicts),b.push({action:"positionUnseededParticipants"})}const{positionAssignments:_}=Ki({drawDefinition:l,structure:S});return un({drawDefinition:l,structureIds:[u]}),t||YO(),{positionAssignments:_,conflicts:A,...le,positioningReport:b}}function dC(t){var e;const{applyPositioning:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:o,seedingProfile:a,structureId:s,placeByes:l,seedsOnly:c,event:u}=t;if(!u)return{error:sl};if(!o)return{error:ml};if(!Bh({drawDefinition:o,structureId:s})&&!n)return{error:Yle};const d=(e=fde({drawDefinition:o,structureId:s}).playoffStructures)==null?void 0:e.sort((f,m)=>DR(f)-DR(m)),p=[],h=[];if(d)for(const f of d){const{structureId:m}=f,g=uC({structureId:m,provisionalPositioning:n,applyPositioning:i,tournamentRecord:r,drawDefinition:o,seedingProfile:a,placeByes:l,seedsOnly:c});if(g.error)return g;g.positionAssignments&&p.push({positionAssignments:g.positionAssignments,structureId:m}),g.positioningReport&&h.push(g.positioningReport)}return{...le,structurePositionAssignments:p,positioningReports:h}}function yde({drawDefinition:t,orderMap:e}){return t?(typeof e=="object"&&Object.values(e).every(i=>$t(i))||ce({result:{error:Re},context:{orderMap:e}}),t.structures||(t.structures=[]),t.structures.forEach(i=>{const n=e[i.structureId];n&&(i.structureOrder=n)}),t.structures.sort((i,n)=>aw(i.structureOrder)-aw(n.structureOrder)),{...le}):{error:rt}}function Ok({drawDefinition:t}){var e,i,n,r,o,a,s;const l=t.structures??[],c=t.links??[],u=new Map,d=S=>{const w=u.get(S)||u.set(S,{drawSources:[],drawTargets:[],progeny:[],sources:[],targets:[]})&&u.get(S);if(w&&!(w!=null&&w.stage)){const U=l.find(D=>D.structureId===S);w.stage=U==null?void 0:U.stage}return w},p={},h={};let f=c.map(S=>{const w=S.source.structureId,U=S.target.structureId,D=d(w),E=d(U);return[nf,_l,hk,Hm].includes(S.target.feedProfile)?(D==null||D.targets.push(U),E==null||E.sources.push(w)):S.target.feedProfile===Ic&&(E==null||E.drawSources.push(w),D==null||D.drawTargets.push(U)),h[U]=h[U]||S.target.feedProfile===Ic,p[U]=ti([...p[U]||[],w]).filter(Boolean),[S.source.structureId,S.target.structureId]});for(const S of u.keys()){const w=u.get(S);if(w){const U=w.targets??[];for(;U.length;){const D=U.pop(),E=D&&u[D];(e=E==null?void 0:E.targets)!=null&&e.length?U.push(...E.targets):E&&(w.rootStage=E.stage)}if(w.rootStage||(w.rootStage=w.stage),!((i=w.targets)!=null&&i.length)){const D=w.sources??[];for(;D.length;){const E=D.pop(),C=E&&u[E];if((n=C==null?void 0:C.sources)!=null&&n.length){for(const M of C.sources)(r=w.progeny)!=null&&r.includes(M)||(o=w.progeny)==null||o.push(M);D.push(...C.sources)}}}}}let m=0;for(const S of u.keys()){const w=u.get(S);if(w&&w.rootStage===St){const U=[(a=w.drawTargets)==null?void 0:a[0]];let D=0;for(;U.length;){D+=1;const E=U.pop(),C=E?u.get(E):void 0;(s=C==null?void 0:C.drawTargets)!=null&&s.length&&U.push(C.drawTargets[0])}w.distanceFromMain=D,D>m&&(m=D)}}const g=f.length;nt(0,Math.ceil(g/2)).forEach(()=>{f=nt(0,g).map(S=>{const w=f[S],U=f.reduce((D,E)=>ua(w,E)?D.concat(...E):D,[])||[];return ti(w.concat(...U))})});const v=f[0],y=f.slice(1).reduce((S,w)=>{return S&&sr(U=w,v).length===U.length;var U},!0),b=[v].filter(Boolean),I=[v].filter(Boolean);l.forEach(S=>{const{structureId:w,stage:U}=S;b.find(D=>D.includes(w))||(b.push([w]),U!==qr&&I.push([w]))});const T=y&&I.length===1;return c!=null&&c.length||l.length!==1||d(l[0].structureId),{structureProfiles:Object.fromEntries(u),allStructuresLinked:T,maxQualifyingDepth:m,sourceStructureIds:p,hasDrawFeedProfile:h,structureGroups:b}}function bde({drawDefinition:t}){const{maxQualifyingDepth:e,structureProfiles:i}=Ok({drawDefinition:t});for(const n of t.structures){const r=i[n.structureId];r.distanceFromMain&&(n.stageSequence=e+1-r.distanceFromMain)}return{...le}}function xf(t){var e;const{duplicateValues:i=!0,creationTime:n=!0,removePriorValues:r,timeItem:o,element:a}=t;if(!o)return{error:gce};if(!a)return{error:bt,info:rW};const s=o&&Object.keys(o),l=["itemType","itemValue"];if(l.filter(c=>s.includes(c)).length!==l.length)return{error:mce};if(a.timeItems){const{itemType:c,itemSubTypes:u,itemValue:d}=o,p=c&&((e=Hu({itemSubTypes:u,itemType:c,element:a}))==null?void 0:e.timeItem);if(p&&JSON.stringify(p==null?void 0:p.itemValue)===JSON.stringify(d)&&!i)return{...le}}else a.timeItems=[];if(o.itemSubTypes&&!o.itemSubTypes.length&&delete o.itemSubTypes,n){const c=new Date().toISOString();Object.assign(o,{createdAt:c})}return r&&(a.timeItems=a.timeItems.filter(({itemType:c})=>o.itemType!==c)),r&&!o.itemValue||a.timeItems.push(o),{...le}}function i3({creationTime:t=!0,removePriorValues:e,tournamentRecord:i,duplicateValues:n,participantId:r,timeItem:o}){if(!i)return{error:je};if(!r)return{error:Hr};const a=Dg({tournamentRecord:i,participantId:r});return a.error?a:xf({element:a.participant,removePriorValues:e,duplicateValues:n,creationTime:t,timeItem:o})}function ub(t){const{removePriorValues:e,tournamentRecord:i,duplicateValues:n,creationTime:r,timeItem:o}=t;return i?xf({element:i,removePriorValues:e,duplicateValues:n,creationTime:r,timeItem:o}):{error:je}}function db(t){const{removePriorValues:e,duplicateValues:i,creationTime:n,timeItem:r,event:o}=t;return o?xf({removePriorValues:e,duplicateValues:i,element:o,creationTime:n,timeItem:r}):{error:sl}}function n3({tournamentRecord:t,drawDefinition:e,structure:i,link:n}){if(!t)return{error:je};if(!e)return{error:rt};const r=function({drawDefinition:o,tournamentId:a,structure:s,eventId:l,link:c}){var u;if(!o)return{error:rt};if(!s)return{error:bg};if(!c)return{error:Jle};const d=c.target.structureId,p=kt({drawDefinition:o,structureId:d});if(p.error)return ce({stack:"attachQualifyingStructure",context:{targetStructureId:d},result:p});o.structures||(o.structures=[]),o.links||(o.links=[]),o.structures.push(s),o.links.push(c),bde({drawDefinition:o});const h=((u=zi({structure:s}))==null?void 0:u.matchUps)||[];return rf({drawDefinition:o,tournamentId:a,matchUps:h,eventId:l}),un({drawDefinition:o,structureIds:[s.structureId]}),{...le}}({tournamentId:t.tournamentId,drawDefinition:e,structure:i,link:n});return r.error||ub({tournamentRecord:t,timeItem:{itemType:"attachQualifyingStructures",itemValue:{structureId:i.structureId,drawId:e.drawId}}}),r}function Ide({drawDefinition:t,structureDetails:e}){if(!Array.isArray(e))return{error:Re};if(!t)return{error:rt};const i=Object.assign({},...e.map(n=>{if(!bn(n))return;const{structureId:r,structureName:o}=n||{};return r&&o?{[r]:o}:void 0}).filter(Boolean));if(!Object.values(i).length)return{error:bt};for(const n of t.structures||[]){const r=i[n.structureId];r&&(n.structureName=r)}return{...le}}function r3({drawDefinition:t,timeItem:e}){if(!t)return{error:ml};if(!e)return{error:gce};const i=e&&Object.keys(e),n=["itemType","itemValue"];if(n.filter(o=>i.includes(o)).length!==n.length)return{error:mce};t.timeItems||(t.timeItems=[]);const r=new Date().toISOString();return Object.assign(e,{createdAt:r}),t.timeItems.push(e),qP({drawDefinition:t}),{...le}}function wde({tournamentRecord:t,drawDefinition:e,structureId:i,event:n,force:r}){var o,a,s,l,c,u;if(typeof i!="string")return{error:Re};if(!e)return{error:rt};if(!i)return{error:Va};const d=e.structures??[],p=[],h=d.find(w=>w.structureId===i);if(!h)return{error:Cn};if(zi({structure:h}).matchUps.some(({score:w})=>lo({score:w}))){const w=(o=Gi({tournamentRecord:t,drawDefinition:e,structure:h,event:n}))==null?void 0:o.appliedPolicies;if(!(r??((s=(a=w==null?void 0:w[jm])==null?void 0:a.allowDeletionWithScoresPresent)==null?void 0:s.structures)))return{error:Sce}}const f=d.find(({stage:w,stageSequence:U})=>w===ct&&U===1),m=i===(f==null?void 0:f.structureId),g=d.filter(({stage:w})=>w===St).map(Ts("structureId"));if(m&&!g.length)return{error:qAe};const v=d.map(Ts("structureId")),y=[],b=g.includes(i),I=new Map;v.forEach(w=>{var U;return I.set(w,b?(D=w,((U=e.links)==null?void 0:U.map(E=>g.includes(E.source.structureId)&&E.target.structureId===D&&E.source.structureId).filter(Boolean))??[]):(E=>{var C;return((C=e.links)==null?void 0:C.map(M=>M.source.structureId===E&&M.target.structureId!==(f==null?void 0:f.structureId)&&M.target.structureId).filter(Boolean))??[]})(w));var D});const T=m?I.get(i):[i];for(;T!=null&&T.length;){const w=T.pop(),{structure:U}=kt({structureId:w,drawDefinition:e}),{matchUps:D}=zi({structure:U}),E=vW(D);y.push(...E),e.links=((l=e.links)==null?void 0:l.filter(M=>M.source.structureId!==w&&M.target.structureId!==w))??[],(!m||m&&g.length||w!==i)&&(e.structures=(e.structures??[]).filter(M=>(w&&w===M.structureId&&p.push(w),M.structureId!==w)));const C=w&&((c=I.get(w))==null?void 0:c.filter(M=>M!==(f==null?void 0:f.structureId)||i===f.structureId));C!=null&&C.length&&T.push(...C)}const{matchUps:S}=Ar({drawDefinition:e});if(S==null||S.forEach(w=>{w.winnerMatchUpId&&y.includes(w.winnerMatchUpId)&&delete w.winnerMatchUpId,w.loserMatchUpId&&y.includes(w.loserMatchUpId)&&delete w.loserMatchUpId}),m){const w=(u=f.matchUps??[])==null?void 0:u.map(Ts("matchUpId"));y.push(...w),f.positionAssignments=[],f.seedAssignments=[],f.matchUps=[],f.extensions&&(f.extensions=[])}return b&&bde({drawDefinition:e}),Kp({tournamentId:t==null?void 0:t.tournamentId,matchUpIds:y,action:"removeStructure",eventId:n==null?void 0:n.eventId,drawDefinition:e}),un({drawDefinition:e,eventId:n==null?void 0:n.eventId}),{...le,removedMatchUpIds:y,removedStructureIds:p}}function _R({stageSequence:t=1,drawDefinition:e,drawSize:i,stage:n}){if(!e)return{error:rt};if(!AW({drawDefinition:e,stage:n}))return{error:Wy};const r=function({stage:s,drawDefinition:l}){return Jy.reduce((c,u)=>(z2({drawDefinition:l,entryStatus:u,stage:s})||0)+c,0)}({drawDefinition:e,stage:n}),{qualifiersCount:o}=G0({drawDefinition:e,stageSequence:t,stage:n});if(i<r+o)return{error:Xle};const{entryProfile:a}=NW({attributes:[{[n]:{drawSize:i}}],drawDefinition:e});return un({drawDefinition:e}),{...le,entryProfile:a}}function Sde({qualifiersCount:t=0,drawDefinition:e,stage:i}){return e?AW({drawDefinition:e,stage:i})?i!==ct?{error:Xle,info:"qualifiersCount can only be set for main stage"}:(NW({attributes:[{[i]:{qualifiersCount:t}}],drawDefinition:e}),un({drawDefinition:e}),{...le}):{error:Wy}:{error:rt}}function Tde(t){return function({drawDefinition:e,drawSize:i}){if(!e)return{error:rt};const n=_R({stage:qr,stageSequence:1,drawDefinition:e,drawSize:i});return n.error?n:(un({drawDefinition:e}),{...le})}(t)}function Ude({tournamentRecord:t,drawDefinition:e,participantId:i,structureId:n}){var r;const o="removeSeededParticipant";if(!t)return{error:je};if(!e)return{error:rt};const a=(e.structures??[]).find(s=>s.structureId===n);return a?!a.stage||![ct,St].includes(a.stage)||a.stage===ct&&a.stageSequence!==1?ce({result:{error:_P},stack:o}):(r=a.seedAssignments)!=null&&r.find(s=>s.participantId===i)?{...le}:ce({info:"participant not seeded",result:{error:zo},context:{participantId:i}}):ce({result:{error:Cn},stack:o})}function pC({targetEntryRound:t=1,finishingPositions:e,sourceRoundNumber:i,sourceStructureId:n,targetStructureId:r,linkType:o=Rp}){return!n||!r?{error:Va}:{link:It({linkType:o,source:{roundNumber:i,structureId:n,finishingPositions:e},target:{feedProfile:Ic,roundNumber:t,structureId:r}})}}function o3({roundPosition:t,roundNumber:e,idPrefix:i,uuids:n}){return i?`${i}-${e}-${t}`:(n==null?void 0:n.pop())||Hi()}function kR({includeMatchUpType:t,matchUpType:e,roundNumber:i,matchUps:n,idPrefix:r,isMock:o,uuids:a,nodes:s}){let l=0;const c=[];let u=1;const d=i-1,p=s==null?void 0:s.length;for(;l<(p||0);){const h=s==null?void 0:s[l],f=s==null?void 0:s[l+1];d&&(h.roundNumber=d),f&&d&&(f.roundNumber=d);const m={roundPosition:u,children:[h,f],matchUpId:o3({roundPosition:u,roundNumber:i,idPrefix:r,uuids:a})};c.push(m);const g={drawPositions:m.children.map(v=>v==null?void 0:v.drawPosition).filter(Boolean),matchUpStatus:qn,matchUpId:m.matchUpId,roundPosition:u,roundNumber:i};t&&e&&(g.matchUpType=e),o&&(g.isMock=!0),n.push(g),u++,l+=2}return{roundNodes:c,matchUps:n}}function Nu({finishingPositionOffset:t,finishingPositionLimit:e,qualifyingRoundNumber:i,qualifyingPositions:n,matchUpType:r,roundLimit:o,idPrefix:a,drawSize:s,isMock:l,uuids:c}){if(isNaN(s)||s<2||n&&s<=n)return{matchUps:[],roundsCount:0};if(n&&(!Lc(s)||s%n)){let g=n;for(;g<s;)g*=2;s=g}const u=n&&!(s%2)&&(!isNaN(n)||i&&!isNaN(i))&&(s/n===Math.round(s/n)||i&&s/i===Math.round(s/i));if(!Lc(s)&&!u)return{matchUps:[],roundsCount:0};const d=nt(1,s+1).map(g=>({drawPosition:g}));let p,h=[],f=1;for({roundNodes:p,matchUps:h}=kR({matchUpType:r,roundNumber:f,idPrefix:a,matchUps:h,isMock:l,nodes:d,uuids:c}),f++,o=o??i;p.length>1;)n&&p.length===n&&(o=f-1),{roundNodes:p,matchUps:h}=kR({nodes:p,matchUpType:r,roundNumber:f,idPrefix:a,matchUps:h,isMock:l,uuids:c}),f++;const m=f-1;return h=Mk({finishingPositionOffset:t,finishingPositionLimit:e,roundsCount:m,roundLimit:o,matchUps:h}),o?h=h.filter(g=>o&&(g.roundNumber??0)<=o):o=f-1,{drawSize:s,matchUps:h,roundsCount:m,roundLimit:o}}function a3(t){var e,i,n,r,o,a;const s="generateQualifyingStructure";if(!t.drawDefinition)return ce({result:{error:rt},stack:s});if(t.drawSize&&!$t(t.drawSize)||t.participantsCount&&!$t(t.participantsCount)||t.qualifyingPositions&&!$t(t.qualifyingPositions))return ce({result:{error:Re},stack:s});let l=t.drawSize??Hz(t.participantsCount);const{qualifyingRoundNumber:c,qualifyingPositions:u,targetStructureId:d,structureOptions:p,appliedPolicies:h,drawDefinition:f,matchUpFormat:m,structureName:g,structureId:v,roundTarget:y,drawType:b,idPrefix:I,isMock:T,uuids:S}=t;if(!t.drawSize)return ce({result:{error:Y_},context:{drawSize:l},stack:s});if(u&&u>=t.drawSize)return ce({result:{error:Re},context:{drawSize:l,qualifyingPositions:u},stack:s});let w,U,D,E,C,M=0;const{structureProfiles:N}=Ok({drawDefinition:f}),R=N[d];if(!R)return ce({result:{error:Cn},context:{targetStructureId:d},stack:s});const A=f.matchUpType,_=y?`${y}-`:"",k=R.stage===St,O=((i=(e=h==null?void 0:h[hU])==null?void 0:e.namingConventions)==null?void 0:i.pre)??((r=(n=FW[hU])==null?void 0:n.namingConventions)==null?void 0:r.pre),F=k&&O?`${O}-`:"",B=g??(_?`${F}${yo(St)} ${_}`:`${F}${yo(St)}`);if(b===Yl){const{maxRoundNumber:H,structures:z,groupCount:G}=RU({structureName:g??B,structureId:v??(S==null?void 0:S.pop()),stage:St,structureOptions:p,appliedPolicies:h,stageSequence:1,matchUpType:A,roundTarget:y,idPrefix:I,drawSize:l,isMock:T,uuids:S});M=G,w=H,D=z[0],C=[1]}else({drawSize:l,matchUps:E,roundLimit:w,roundsCount:U}=Nu({qualifyingRoundNumber:c,qualifyingPositions:u,matchUpType:A,idPrefix:I,drawSize:l,isMock:T,uuids:S})),w||(w=U),D=fo({structureName:g??B,structureId:v??(S==null?void 0:S.pop()),qualifyingRoundNumber:w,stage:St,matchUpFormat:m,stageSequence:1,matchUpType:A,roundLimit:w,matchUps:E}),y&&Ii({extension:{name:$u,value:y},element:D}),M=(o=E==null?void 0:E.filter(H=>H.roundNumber===w))==null?void 0:o.length;const $=b===Yl?Mp:Rp,V=D&&w&&((a=pC({sourceStructureId:D.structureId,sourceRoundNumber:w,targetStructureId:d,finishingPositions:C,linkType:$}))==null?void 0:a.link);return{qualifyingDrawPositionsCount:l,qualifiersCount:M,...le,structure:D,link:V}}function Dde(t){const e=t.tournamentRecord;if(!e)return{error:je};const i=function(d){if(!d.drawDefinition)return{error:rt};if(!d.targetStructureId)return{error:Va};const p=a3(d);if(p.error)return p;const{structure:h,link:f}=p;return h&&f?n3({tournamentRecord:d.tournamentRecord,drawDefinition:d.drawDefinition,structure:h,link:f}):{error:Re}}(t);if(i.error)return i;const{qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:o,drawDefinition:a,structureName:s,matchUpType:l,drawSize:c,drawType:u}=t;return ub({tournamentRecord:e,timeItem:{itemType:"addQualifyingStructures",itemValue:It({drawId:a.drawId,qualifyingRoundNumber:n,qualifyingPositions:r,targetStructureId:o,structureName:s,matchUpType:l,drawSize:c,drawType:u})}}),i}function s3({drawDefinition:t,matchUpsMap:e,structureId:i}){const n=kt({drawDefinition:t,structureId:i});if(n.error)return ce({result:n});const{matchUps:r}=zi({structure:n.structure,matchUpsMap:e});return{...ba({matchUps:r}),matchUps:r,matchUpsMap:e}}function rY({finishingPositions:t,drawDefinition:e,structureId:i}){const{roundProfile:n}=s3({drawDefinition:e,structureId:i}),r=n&&Object.keys(n);return r==null?void 0:r.reduce((o,a)=>(Pde(n==null?void 0:n[a]).forEach(s=>{t.forEach(l=>{(function({position:c,rangeDefinition:u}){if(!Array.isArray(u)||u.reduce((h,f)=>h||isNaN(f),!1))return!1;const[d,p]=u;return nt(d,(p||d)+1).includes(c)})({position:l,rangeDefinition:s})&&(o[l]={roundNumber:a})})}),o),{})}function Pde(t){var e,i;return[ti(((e=t==null?void 0:t.finishingPositionRange)==null?void 0:e.loser)||[]),ti(((i=t==null?void 0:t.finishingPositionRange)==null?void 0:i.winner)||[])]}function Pxe(t){return Pde(t).map(e=>nt(e[0],e[1]&&e[1]+1||e[0]+1))}function z0({drawDefinition:t,structureIds:e,matchUpsMap:i}){if(e&&!Array.isArray(e))return{error:Re,context:{structureIds:e}};if(!t)return{error:rt};const n=(e=e??(t.structures??[]).filter(o=>o.stage!==St).map(({structureId:o})=>o)).map(o=>{const{roundProfile:a}=s3({drawDefinition:t,matchUpsMap:i,structureId:o}),s=a&&Object.values(a);return s==null?void 0:s.map(Pxe).flat()}).flat(),r=n.filter(o=>(o==null?void 0:o.length)===1).sort(Sr).flat();return{positionsNotPlayedOff:ti(n.flat()).filter(o=>!r.includes(o)),positionsPlayedOff:r}}function Cde({excludeRoundNumbers:t=[],playoffPositions:e=[],drawDefinition:i,structureId:n}){if(!i)return{error:rt};if(!n)return{error:Va};if(!e)return{error:bt,info:"missing playoffPositions"};const r=z0({drawDefinition:i});if(r.error)return r;const o=r.positionsPlayedOff,a=rY({finishingPositions:e.filter(g=>!o.includes(g)),drawDefinition:i,structureId:n}),s=Object.values(a).reduce((g,v)=>g.includes(v.roundNumber)?g:g.concat(v.roundNumber),[]).map(g=>Ct(g)).filter(g=>!t.includes(g)),l=rY({finishingPositions:o,drawDefinition:i,structureId:n}),c=l?Object.values(l):[],u=l?c.reduce((g,v)=>g.includes(v.roundNumber)?g:g.concat(v.roundNumber),[]).map(g=>Ct(g)):[],d=s.filter(g=>!u.includes(g)).sort(Sr),{roundProfile:p}=s3({drawDefinition:i,structureId:n}),h=d.map(g=>{const v=p==null?void 0:p[g].finishingPositionRange.loser,[y,b]=v??[0,0];return nt(y,(b||y)+1)}).flat().sort(Sr),{playoffRoundsRanges:f}=function({playoffSourceRounds:g,roundProfile:v}){return{playoffRoundsRanges:g.map(y=>{const b=v[y].finishingPositionRange.loser,[I,T]=b,S=nt(I,(T||I)+1);return{finishingPositionRange:b.join("-"),finishingPositions:S,roundNumber:y}})}}({playoffSourceRounds:d,roundProfile:p}),m=[...d,...u];return{playoffPositionsReturned:h,playedOffSourceRounds:u,playoffRoundsRanges:f,playoffSourceRounds:d,sourceRounds:m,roundProfile:p}}function hC({drawDefinition:t,structureId:e}){if(!t)return{error:rt};const{matchUps:i,matchUpsMap:n}=Fa({inContext:!0,drawDefinition:t}),{positionsNotPlayedOff:r,positionsPlayedOff:o}=z0({drawDefinition:t,matchUpsMap:n}),{structures:a}=Nd({drawDefinition:t}),s=a.filter(c=>!e&&c.stage!==qr||c.structureId===e),l={};for(const c of s){const u=c==null?void 0:c.structureId,d=Cxe({playoffPositions:r,drawDefinition:t,structure:c,matchUps:i}),{error:p,...h}=d;if(p)return d;l[u]={structureId:u,...h}}return e?{positionsPlayedOff:o,...l[e]}:{availablePlayoffProfiles:Object.values(l),availablePlayoffRounds:Object.values(l),positionsPlayedOff:o}}function Cxe({playoffPositions:t,drawDefinition:e,structure:i,matchUps:n}){var r,o,a,s,l,c,u,d,p;const h=i==null?void 0:i.structureId,{links:f}=j0({drawDefinition:e,structureId:h});if(i.structureType===na||i.structures){const S=(o=(r=Ki({structure:i}))==null?void 0:r.positionAssignments)==null?void 0:o.length,w=i.structures.length,U=(S??0)/w,D=((a=f.source)==null?void 0:a.flatMap(({source:O})=>(O==null?void 0:O.finishingPositions)||[]))||[],E=nt(1,U+1).filter(O=>!D.includes(O)),C=((l=(s=n.find(O=>O.containerStructureId===h&&O.finishingPositionRange))==null?void 0:s.finishingPositionRange)==null?void 0:l.winner)||[0,1],M=f==null?void 0:f.source.map(({target:O})=>O.structureId),{positionsPlayedOff:N=[],positionsNotPlayedOff:R=[]}=z0({structureIds:M,drawDefinition:e}),A=[...N,...R],_=nt(C[0],C[1]+1).filter(O=>!A.includes(O)),k=Kr(_,_.length/E.length);return{positionsNotPlayedOff:_,playoffFinishingPositionRanges:E.map((O,F)=>{const B=k[F];return{finishingPosition:O,finishingPositions:B,finishingPositionRange:[Math.min(...B||[]),Math.max(...B||[])].join("-")}}),finishingPositionsAvailable:E,finishingPositionsPlayedOff:D,positionsPlayedOff:N,groupCount:w,groupSize:U}}const m=((c=f==null?void 0:f.source)==null?void 0:c.filter(S=>S.linkCondition!==Md).map(S=>{var w;return(w=S.source)==null?void 0:w.roundNumber}))||[],g=((u=f==null?void 0:f.source)==null?void 0:u.filter(S=>S.linkCondition===Md).map(S=>{var w;return(w=S.source)==null?void 0:w.roundNumber}))||[],v=Cde({excludeRoundNumbers:m,playoffPositions:t,drawDefinition:e,structureId:h}),y=v!=null&&v.playoffSourceRounds?[...(v==null?void 0:v.playoffSourceRounds)||[]]:void 0,b=[...(v==null?void 0:v.playoffRoundsRanges)||[]],{roundProfile:I,error:T}=v;for(const S of g){const w=f==null?void 0:f.source.find(M=>M.source.roundNumber===S),U=w==null?void 0:w.target.roundNumber,D=w==null?void 0:w.target.structureId,E=n.filter(({roundNumber:M,structureId:N})=>N===D&&M===U),C=E.filter(({sides:M})=>M.find(N=>N.participantFed&&!N.participantId)).length;if(y&&C===E.length){y.push(S);const M=(p=(d=I==null?void 0:I[S])==null?void 0:d.finishingPositionRange)==null?void 0:p.loser;if(M){const N=Math.min(...M),R=N+C,A=nt(N,R),_={finishingPositionRange:[N,R-1].join("-"),finishingPositions:A,roundNumber:S};b.push(_)}}}return y&&y.sort(Sr),b.sort((S,w)=>S.roundNumber-w.roundNumber),{playoffRounds:y,playoffRoundsRanges:b,error:T}}function Exe({includeMatchUpType:t,drawPosition:e,roundNumber:i,matchUpType:n,idPrefix:r,matchUps:o,isMock:a,uuids:s,nodes:l,fed:c}){const u=l.length,d=e?e-u:void 0,p=nt(0,u).map(f=>d?d+f:void 0),h=[];for(let f=0;f<u;f++){const m=p.shift(),g={drawPosition:m,fed:c+1,feed:!0},v=l[f];v.roundNumber=i-1;const y=o3({roundPosition:v.roundPosition,roundNumber:i,idPrefix:r,uuids:s}),b={roundPosition:v.roundPosition,drawPositions:[m],matchUpStatus:qn,roundNumber:i,matchUpId:y};t&&(b.matchUpType=n),a&&(b.isMock=!0),o.push(b);const I={children:[v,g]};h.push(I)}return{roundNodes:h,matchUps:o,drawPosition:e?e-u:void 0}}function lf(t){const e=t.drawSize;let{feedRoundsProfile:i,feedRounds:n=0,skipRounds:r=0,baseDrawSize:o}=t;const{linkFedFinishingRoundNumbers:a,finishingPositionOffset:s,linkFedRoundNumbers:l,feedsFromFinal:c,isConsolation:u,matchUpType:d,idPrefix:p,isMock:h,uuids:f,fmlc:m}=t;o=o??function(N){const R=Gz(N);return R>N?R/2:R}(e);const g=function({drawSize:N}){const R=Math.ceil(Math.log(N)/Math.log(2));return nt(0,R).reverse().map(A=>Math.pow(2,A))}({drawSize:o}),v=g.length;let y=0;if(i!=null&&i.length)y=i.reduce((N,R)=>N+R,0);else if(e){let N=e-o;i=g.filter(R=>R<=N&&(N-=R,!0)),y=i.reduce((R,A)=>R+A,0),n=i.length}else r>=v?n=0:c&&(n=v-c,r=0),i=g.filter((N,R)=>c&&!n||n&&R>=r+n||R<r?0:N),y=i.reduce((N,R)=>N+R,0),n=i.length;const b=[...g,...i].sort((N,R)=>R-N),I=b.length,T=[...(l??[]).map(N=>N-1),...(a??[]).map(N=>I-N)].map(N=>b[N]).reduce((N,R)=>N+R,0);y-=T;let S,w=0,U=[],D=1,E=nt(0,o).map((N,R)=>({drawPosition:R+1+y})),C=y+1;for(const N of g){if({roundNodes:S,matchUps:U}=kR({matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:h,nodes:E,uuids:f}),D++,i.includes(N)){const R=nt(0,cs(i)[N]),A=I+1-D,_=(a==null?void 0:a.includes(A))??(l==null?void 0:l.includes(D));R.forEach(()=>{({roundNodes:S,matchUps:U,drawPosition:C}=Exe({drawPosition:!_&&C||void 0,nodes:S,matchUpType:d,roundNumber:D,idPrefix:p,matchUps:U,isMock:h,uuids:f,fed:w})),D++,w+=1})}E=S}I!==D-1&&console.log("ERROR"),U=Mk({finishingPositionOffset:u?o-y:s,positionsFed:y,roundsCount:I,matchUps:U,fmlc:m});const M=S!=null&&S.length?S[0]:S;return M&&(M.roundNumber=D-1,M.matchUps=U),{draw:M,matchUps:U,roundsCount:I}}function SI(t){const{finishingPositionOffset:e=0,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:o,playoffAttributes:a,stageSequence:s=1,exitProfile:l="0",exitProfileLimit:c,roundOffsetLimit:u,roundOffset:d=0,drawDefinition:p,staggeredEntry:h,sequenceLimit:f,stage:m=ct,drawSize:g,idPrefix:v,isMock:y,uuids:b}=t;if(!(!a||!c||a!=null&&a[l])||g<2||f&&s>f)return{};const I=[],T=[],S=[],w=t.matchUpType??(p==null?void 0:p.matchUpType),U=e+1,D=`${U}-${e+g}`,E=a==null?void 0:a[l],C=n&&`${n} `||"",M=(a==null?void 0:a[D])??(r==null?void 0:r[D]),N=t.structureName||(M==null?void 0:M.name)||(E==null?void 0:E.name)&&(i?`${C}${E==null?void 0:E.name}`:E.name)||`${C}${D}`,R=(M==null?void 0:M.abbreviation)??(E==null?void 0:E.abbreviation),A=t.structureId??(E==null?void 0:E.structureId)??(b==null?void 0:b.pop()),_={idPrefix:v&&`${v}-${N}-RP`,finishingPositionOffset:e,matchUpType:w,drawSize:g,isMock:y,uuids:b},{matchUps:k}=h?lf(_):Nu(_),O=fo({structureAbbreviation:R,stageSequence:s,structureName:N,matchUpType:w,roundOffset:d,structureId:A,matchUps:k,stage:m});I.push(...k),T.push(O);const F=Math.ceil(Math.log(g)/Math.log(2)),B=u?Math.min(u-d,F):!o||U<o?F:0;return g>2&&nt(1,B+1).forEach($=>function(V){const H=g/Math.pow(2,V);if(H<2)return;const z=g/Math.pow(2,V)+e;if(o&&z+1>o)return;const{structures:G,structureId:W,matchUps:K,links:Z}=SI({finishingPositionOffset:z,exitProfile:`${l}-${V}`,roundOffset:d+V,stageSequence:s+1,drawSize:H,addNameBaseToAttributeName:i,playoffStructureNameBase:n,finishingPositionNaming:r,finishingPositionLimit:o,playoffAttributes:a,exitProfileLimit:c,roundOffsetLimit:u,drawDefinition:p,sequenceLimit:f,matchUpType:w,idPrefix:v,uuids:b,stage:m});if(O.structureId&&W){const Y={linkType:Ed,source:{roundNumber:V,structureId:O.structureId},target:{roundNumber:1,feedProfile:_l,structureId:W}};Z&&O&&Z.push(Y),Z!=null&&Z.length&&S.push(...Z)}return G!=null&&G.length&&T.push(...G),K!=null&&K.length&&I.push(...K),{structureId:W,childLinks:Z,structures:T}}($)),{structureId:O.structureId,matchUps:I,structureName:N,structures:T,links:S,...le}}function Ede(t){var e,i;const{finishingPositionOffset:n=0,playoffAttributes:r,stageSequence:o=1,staggeredEntry:a,structureName:s,stage:l=ct,matchUpType:c,structureId:u,idPrefix:d,drawSize:p,isMock:h,uuids:f}=t,m={finishingPositionOffset:n,matchUpType:c,drawSize:p,idPrefix:d,isMock:h,uuids:f},{matchUps:g}=a?lf(m):Nu(m),v=fo({structureName:s||((e=r==null?void 0:r[0])==null?void 0:e.name)||yo(ct),structureId:u||(f==null?void 0:f.pop()),stageSequence:o,matchUpType:c,matchUps:g,stage:l}),y=[v],b=[];if(p>2){const I=p/2,{matchUps:T}=Nu({finishingPositionOffset:n+I,idPrefix:d&&`${d}-c`,drawSize:I,matchUpType:c,isMock:h}),S=yo(So),w=((i=r==null?void 0:r["0-1"])==null?void 0:i.name)??t.consolationStructureName??(s?`${s} ${S}`:S),U=fo({structureName:w,matchUps:T,structureId:f==null?void 0:f.pop(),stage:So,stageSequence:1,matchUpType:c});y.push(U);const D={linkType:Ed,source:{roundNumber:1,structureId:v.structureId},target:{roundNumber:1,feedProfile:_l,structureId:U.structureId}};b.push(D)}return{...le,structures:y,links:b}}function Mde({consolationStructure:t,roundOffset:e=0,mainStructure:i,roundsCount:n,feedPolicy:r,fmlc:o}){const a=t.matchUps.reduce((c,u)=>(u.drawPositions||[]).filter(Boolean).length&&!c.includes(u.roundNumber)?c.concat(u.roundNumber):c,[]),s=(r==null?void 0:r.roundGroupedOrder)||[],l=r==null?void 0:r.roundFeedProfiles;return nt(1+e,n+1+e).map(c=>{const u=l&&l[c-1]?l[c-1]:c%2?_l:nf,d=c-e<=2?c-e:2*(c-e-2)+2,p={linkType:Ed,source:{roundNumber:c,structureId:i.structureId},target:{feedProfile:u,roundNumber:d,structureId:t.structureId}},h=s[c-1];return h&&(p.target.groupedOrder=h),Wl()&&(p.source.structureName=i.structureName,p.target.structureName=t.structureName),c===2&&o&&(p.linkCondition=Md,p.target.feedProfile=_l),a.includes(d)?p:void 0}).filter(Boolean)}function Rde(t){var e,i;const{playoffStructureNameBase:n,finishingPositionOffset:r,stageSequence:o=1,playoffAttributes:a,structureNameMap:s,staggeredEntry:l,stage:c=ct,matchUpType:u,structureId:d,drawSize:p,idPrefix:h,isMock:f,uuids:m}=t,g={finishingPositionOffset:r,matchUpType:u,drawSize:p,idPrefix:h,isMock:f,uuids:m},{matchUps:v,roundsCount:y}=l?lf(g):Nu(g),b=t.structureName??((e=a==null?void 0:a[0])==null?void 0:e.name)??yo(ct),I=fo({structureId:d||(m==null?void 0:m.pop()),structureName:b,stageSequence:o,matchUpType:u,matchUps:v,stage:c}),T=[I],S=[];if(p>2){const w=[0,2].slice(0,p/16).map((D,E)=>{const C=E+1,{consolationStructure:M}=function({playoffStructureNameBase:N,stageSequence:R=1,playoffAttributes:A,structureNameMap:_,roundOffset:k=0,matchUpType:O,structureId:F,idPrefix:B,drawSize:$,isMock:V,index:H,uuids:z}){var G,W;const K=$/(2*Math.pow(2,k)),{matchUps:Z,roundsCount:Y}=lf({finishingPositionOffset:K,baseDrawSize:K,isConsolation:!0,feedRounds:1,matchUpType:O,idPrefix:B,isMock:V,uuids:z}),X=H===0&&((G=A==null?void 0:A["0-1"])==null?void 0:G.name)||H===1&&((W=A==null?void 0:A["0-3"])==null?void 0:W.name),Q=X||`${yo(So)} ${H+1}`,te=(_==null?void 0:_[Q])||Q,J=N?`${N} ${te}`:te;return{consolationStructure:fo({matchUps:Z,stage:So,structureName:J,stageSequence:R,matchUpType:O,structureId:F}),consolationRoundsCount:Y}}({idPrefix:h&&`${h}-c${E}`,structureId:m==null?void 0:m.pop(),playoffStructureNameBase:n,playoffAttributes:a,structureNameMap:s,stageSequence:C,roundOffset:D,matchUpType:u,drawSize:p,isMock:f,index:E,uuids:m});return T.push(M),{consolationStructure:M,links:Mde({consolationStructure:M,roundsCount:2,mainStructure:I,roundOffset:D})}}),U=w.map(D=>D.links).flat();if(S.push(...U),p>=4&&p<=16||p>32){const{matchUps:D}=Nu({idPrefix:h&&`${h}-p3t4`,finishingPositionOffset:2,drawSize:2,matchUpType:u,isMock:f}),E=((i=a==null?void 0:a["3-4"])==null?void 0:i.name)??yo(Vn),C=(s==null?void 0:s[E])||E,M=n?`${n} ${C}`:C,N=fo({structureId:m==null?void 0:m.pop(),matchUps:D,stageSequence:2,stage:Vn,structureName:M,matchUpType:u}),R={linkType:Ed,source:{roundNumber:y-1,structureId:I.structureId},target:{structureId:N.structureId,feedProfile:_l,roundNumber:1}};T.push(N),S.push(R)}}return{structures:T,links:S,...le}}function zg(t){var e,i;const{finishingPositionOffset:n,stageSequence:r=1,playoffAttributes:o,policyDefinitions:a,feedsFromFinal:s,staggeredEntry:l,structureName:c,stage:u=ct,structureId:d,matchUpType:p,skipRounds:h,feedRounds:f,idPrefix:m,drawSize:g,isMock:v,uuids:y,fmlc:b}=t,I=t.feedPolicy||(a==null?void 0:a[bR]),T={finishingPositionOffset:n,matchUpType:p,skipRounds:h,drawSize:g,idPrefix:m,isMock:v,uuids:y},{matchUps:S}=l?lf(T):Nu(T),w=fo({structureName:c||((e=o==null?void 0:o[0])==null?void 0:e.name)||yo(ct),structureId:d||(y==null?void 0:y.pop()),stageSequence:r,matchUpType:p,matchUps:S,stage:u}),U=[w],D=[],E=g/2,{matchUps:C,roundsCount:M}=lf({finishingPositionOffset:E,idPrefix:m&&`${m}-c`,isConsolation:!0,feedsFromFinal:s,baseDrawSize:E,matchUpType:p,feedRounds:f,skipRounds:h,isMock:v,uuids:y,fmlc:b});if(g>2){const N=((i=o==null?void 0:o["0-1"])==null?void 0:i.name)??yo(So),R=t.playoffStructureNameBase?`${t.playoffStructureNameBase} ${N}`:N,A=fo({matchUps:C,structureId:y==null?void 0:y.pop(),stage:So,stageSequence:1,structureName:R,matchUpType:p});U.push(A);const _=Mde({consolationStructure:A,mainStructure:w,roundsCount:M,feedPolicy:I,fmlc:b});D.push(..._)}return{...le,structures:U,links:D}}function Nde({requireSequential:t=!0,playoffMatchUpFormat:e,playoffAttributes:i,sourceStructureId:n,policyDefinitions:r,stageSequence:o,drawDefinition:a,playoffGroups:s,matchUpType:l,feedPolicy:c,groupCount:u,idPrefix:d,isMock:p,uuids:h}){var f,m,g,v,y,b;c=c||(r==null?void 0:r[bR]);const I="processPlayoffGroups";let T=0;const S=[],w=[],U=[],{error:D,positionRangeMap:E}=function({playoffGroups:C,drawDefinition:M,structureId:N}){var R;if(!M)return{error:rt};if(typeof N!="string"||!Array.isArray(C))return{error:Re};const A=C.map(({finishingPositions:O})=>O).flat(),_=hC({drawDefinition:M,structureId:N}),k=(R=_.playoffFinishingPositionRanges)==null?void 0:R.filter(O=>A.includes(O.finishingPosition));return{positionRangeMap:k==null?void 0:k.reduce((O,F)=>(O[F.finishingPosition]=F,O),{})}}({structureId:n,drawDefinition:a,playoffGroups:s});if(D)return ce({result:{error:D},stack:I});if(!(!E||s!=null&&s.every(C=>{const{finishingPositions:M=[]}=C;if(!M.length)return!1;const N=[...M].sort(Sr).map((R,A)=>(M[A+1]||R)-R).every(R=>R<2);return(!t||N)&&M.every(R=>E[R])})))return ce({context:{validFinishingPositions:Object.values(E)},result:{error:Re},stack:I});for(const C of s){const M=C.finishingPositions,N=E&&M.map($=>{var V;return(V=E[$])==null?void 0:V.finishingPositions}).flat(),R=u*M.length,A=R0(R),_=A===2&&hu||C.drawType||hu;N&&(T=Math.min(...N)-1);const k=N&&`${Math.min(...N)}-${Math.max(...N)}`,O=C.structureName||k&&((m=(f=C.playoffAttributes)==null?void 0:f[k])==null?void 0:m.name)||((v=(g=C.playoffAttributes)==null?void 0:g[0])==null?void 0:v.name),F={addNameBaseToAttributeName:C.addNameBaseToAttributeName,playoffStructureNameBase:C.playoffStructureNameBase,finishingPositionNaming:C.finishingPositionNaming,finishingPositionLimit:C.finishingPositionLimit,structureId:C.structureId??(h==null?void 0:h.pop()),playoffAttributes:C.playoffAttributes,structureNameMap:C.structureNameMap,sequenceLimit:C.sequenceLimit,structureName:O,idPrefix:d&&`${d}-po`,appliedPolicies:r,finishingPositionOffset:T,stage:Vn,stageSequence:o,matchUpType:l,drawSize:A,isMock:p,uuids:h},B=({playoffStructures:$,playoffLinks:V})=>{const[H]=$,z=P1({playoffStructureId:H.structureId,finishingPositions:M,sourceStructureId:n});U.push(z),U.push(...V),w.push(...$),S.push({structureId:H.structureId,finishingPositions:M}),T+=R};if(_===hu){const{matchUps:$}=Nu({finishingPositionLimit:T+R,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,matchUpType:l,drawSize:A,isMock:p,uuids:h}),V=fo({structureId:C.structureId??(h==null?void 0:h.pop()),matchUpFormat:e,stage:Vn,structureName:O,stageSequence:o,matchUps:$});w.push(V);const H=P1({playoffStructureId:V.structureId,finishingPositions:M,sourceStructureId:n});U.push(H),T+=R,S.push({structureId:V.structureId,finishingPositions:M})}else if([dw,pw,Vn].includes(_)){const $={playoffAttributes:C.playoffAttributes??i,playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(h==null?void 0:h.pop()),structureName:C.structureName,idPrefix:d&&`${d}-po`,addNameBaseToAttributeName:!0,finishingPositionOffset:T,stage:Vn,roundOffset:0,stageSequence:o,drawSize:A,isMock:p,uuids:h};_===dw?Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??TW,roundOffsetLimit:3}):_===pw&&Object.assign($,{playoffAttributes:(C==null?void 0:C.playoffAttributes)??i??UW,roundOffsetLimit:2});const V=SI($);if(V.error)return V;if((y=V.links)!=null&&y.length&&U.push(...V.links),(b=V.structures)!=null&&b.length&&w.push(...V.structures),w.sort(Zy),V.structureId){const H=P1({playoffStructureId:V.structureId,finishingPositions:M,sourceStructureId:n});U.push(H),S.push({structureId:V.structureId,finishingPositions:M})}T+=R}else if([hw,wU,bU,yU,vU,IU].includes(_)){const $=[h==null?void 0:h.pop(),h==null?void 0:h.pop()],V={playoffStructureNameBase:C.playoffStructureNameBase,structureId:C.structureId??(h==null?void 0:h.pop()),playoffAttributes:C.playoffAttributes,idPrefix:d&&`${d}-po`,finishingPositionOffset:T,uuids:$,stage:Vn,structureName:O,matchUpType:l,feedPolicy:c,drawSize:A,isMock:p},H={[hw]:{fmlc:!0,feedRounds:1},[IU]:{feedRounds:1},[bU]:{feedsFromFinal:3},[yU]:{feedsFromFinal:2},[vU]:{feedsFromFinal:1}};Object.assign(V,H[_]||{});const{structures:z,links:G}=zg(V),[W]=z,K=P1({playoffStructureId:W.structureId,finishingPositions:M,sourceStructureId:n});U.push(K),U.push(...G),w.push(...z),S.push({structureId:W.structureId,finishingPositions:M}),T+=R}else if([Yl].includes(_)){const{structures:$,links:V}=RU({...F,structureOptions:C.structureOptions||{groupSize:4}});B({playoffStructures:$,playoffLinks:V})}else if([gU].includes(_)){const{structures:$,links:V}=Ede(F);B({playoffStructures:$,playoffLinks:V})}else if([Eke].includes(_)){const{structures:$,links:V}=Rde(F);B({playoffStructures:$,playoffLinks:V})}else[ll].includes(_)&&B({playoffStructures:[fo({structureId:C.structureId??(h==null?void 0:h.pop()),structureName:C.structureName,finishingPosition:FE,stage:Vn,stageSequence:o,matchUps:[]})],playoffLinks:[]})}return{finishingPositionTargets:S,positionRangeMap:E,structures:w,links:U}}function P1({playoffStructureId:t,finishingPositions:e,sourceStructureId:i}){return{linkType:Mp,source:{structureId:i,finishingPositions:e},target:{structureId:t,feedProfile:Ic,roundNumber:1}}}function NU({matchUp:t,tieFormat:e,isMock:i,uuids:n}){const{collectionDefinitions:r}=e??{};return{tieMatchUps:(r??[]).map(o=>fC({matchUp:t,collectionDefinition:o,uuids:n,isMock:i})).filter(Boolean).flat()}}function fC({collectionPositionOffset:t=0,collectionDefinition:e,matchUpsLimit:i,matchUp:n,isMock:r,uuids:o}){const{matchUpCount:a,matchUpType:s,collectionId:l,processCodes:c}=e||{},u=d=>{if(!r&&!(n!=null&&n.isMock))return(o==null?void 0:o.pop())??Hi();const p=e==null?void 0:e.collectionId;return(o==null?void 0:o.pop())??`${n==null?void 0:n.matchUpId}-${p}-TMU-${d+1}`};return nt(0,i??a??0).map(d=>{const p=t+d+1;return{sides:[{sideNumber:1},{sideNumber:2}],matchUpId:u(d),matchUpStatus:qn,collectionPosition:p,collectionId:l,processCodes:c,matchUpType:s,isMock:r}})}const Xs="SET3-S:6/TB7",Ade="SET3-S:6/TB7-F:TB10",Mxe={FORMAT_STANDARD:Xs,FORMAT_STANDARD_NOAD:"SET3-S:6NOAD",FORMAT_ATP_DOUBLES:Ade,FORMAT_SHORT_SETS:"SET3-S:4/TB7",FORMAT_FAST4:"SET3-S:4/TB5@3",FORMAT_PRO_SET:"SET1-S:8/TB7",FORMAT_COLLEGE_PRO_SET:"SET1-S:8/TB7@7",TIMED20:"SET1-S:T20"};function l3({winningSide:t,matchUpFormat:e=Xs,matchUpStatus:i,tallyPolicy:n,score:r}){const o=[0,0],a=r==null?void 0:r.sets,s=typeof t=="number"&&t-1,l=Ga(e),c=c3((l==null?void 0:l.bestOf)??1);if(typeof s=="number"&&(i===Mi&&n!=null&&n.setsCreditForDefaults||i===Li&&n!=null&&n.setsCreditForWalkovers))o[s]=c;else for(const u of a||[]){const{winningSide:d}=u;d&&(o[d-1]+=1)}return typeof s=="number"&&i===da&&(+o[1-s]===c&&(o[1-s]-=1),n!=null&&n.setsCreditForRetirements&&(o[s]=c)),o}function _de({matchUpFormat:t=Xs,winningSide:e,matchUpStatus:i,tallyPolicy:n,score:r}){var o,a;const{sets:s}=r||{};if(!s)return[0,0];const l=typeof e=="number"&&e-1,c=Ga(t),u=c3((c==null?void 0:c.bestOf)??1),d=((o=c==null?void 0:c.setFormat)==null?void 0:o.tiebreakAt)||0,p=[[],[]];if(typeof l=="number"&&(i===Mi&&n!=null&&n.gamesCreditForDefaults||i===Li&&n!=null&&n.gamesCreditForWalkovers)){const h=u*(((a=c==null?void 0:c.setFormat)==null?void 0:a.setTo)||0);p[l].push(h)}else s.forEach((h,f)=>{var m;const g=(h.setNumber||f+1)>u&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",v=(m=c==null?void 0:c[g])==null?void 0:m.based,y=c==null?void 0:c[g].tiebreakSet,{side1Score:b,side2Score:I}=h;oY(v)&&(p[0].push(Ct(b||0)),p[1].push(Ct(I||0))),y&&h.winningSide&&(n==null?void 0:n.gamesCreditForTiebreakSets)!==!1&&p[h.winningSide-1].push(1)});if(i===da&&typeof l=="number"){const h=s.length>u&&c!=null&&c.finalSetFormat?"finalSetFormat":"setFormat",f=c==null?void 0:c[h];if(oY(f.based)){const m=(f==null?void 0:f.setTo)||0,g=y=>{if(c&&y!=="")return+y==d-1||+y===d?Ct(d||0)+1:+y<d?m:d},v=l3({winningSide:e,score:{sets:s},matchUpStatus:i,matchUpFormat:t,tallyPolicy:n});if(p.map(y=>y[l]<=y[1-l]).reduce((y,b)=>y+(b?1:0),0)>v[1-l]){const y=p[l].length,b=g(p[1-l][y-1]);b&&(p[l][y-1]=b)}u>p[l].length&&n!=null&&n.gamesCreditForRetirements&&p[l].push(m)}}return[p[0].reduce((h,f)=>h+f,0),p[1].reduce((h,f)=>h+f,0)]}function kde({matchUpFormat:t,score:e}){var i;const n=t?Ga(t):void 0,r=c3((n==null?void 0:n.bestOf)??1),o=[0,0],a=[0,0];return(i=e==null?void 0:e.sets)==null||i.forEach((s,l)=>{var c;const u=(s.setNumber||l+1)>r&&n!=null&&n.finalSetFormat?"finalSetFormat":"setFormat",d=(c=n==null?void 0:n[u])==null?void 0:c.based;if(xde(d)){const{side1Score:p,side2Score:h}=s;p&&(a[0]+=Ct(p||0)),h&&(a[1]+=Ct(h||0))}else s.side1TiebreakScore&&(a[0]+=Ct(s.side1TiebreakScore||0)),s.side2TiebreakScore&&(a[1]+=Ct(s.side2TiebreakScore||0)),(s.side1TiebreakScore||s.side2TiebreakScore)&&s.winningSide&&(o[s.winningSide-1]+=1)}),{pointsTally:a,tiebreaksTally:o}}function c3(t){return t&&Math.ceil(t/2)||1}function xde(t){return t==="P"}function oY(t){return!xde(t)}function Ode({participantIds:t,matchUpFormat:e,tallyPolicy:i,perPlayer:n,matchUps:r}){var o,a,s,l,c,u;const d={},p=(i==null?void 0:i.excludeMatchUpStatuses)||[],h=r.filter(m=>(m.tieMatchUps||!p.includes(m.matchUpStatus))&&(!(t!=null&&t.length)||sr(t,[uI(m,0),uI(m,1)]).length===2)),f=h.flatMap(({score:m,tieMatchUps:g})=>{var v;return g?g.filter(({matchUpStatus:y})=>!p.includes(y)).flatMap(({score:y})=>{var b;return((b=y==null?void 0:y.sets)==null?void 0:b.length)??0}):((v=m==null?void 0:m.sets)==null?void 0:v.length)??0}).reduce((m,g)=>m+g,0);for(const m of h){const{matchUpStatus:g,tieMatchUps:v,tieFormat:y,score:b,winningSide:I,sides:T}=m,S=y&&m._disableAutoCalc&&y.collectionDefinitions.every(({scoreValue:D})=>D),w=I&&Rxe(m),U=I&&Nxe(m);if(w||U)if(bh(d,w),bh(d,U),v==null?void 0:v.length){n=0;for(const D of v){const{matchUpType:E}=D,C=E===Pn,M=E===vr;D.winningSide&&(D.winningSide===I?(w&&(d[w].tieMatchUpsWon+=1,M&&(d[w].tieSinglesWon+=1),C&&(d[w].tieDoublesWon+=1)),U&&(d[U].tieMatchUpsLost+=1,M&&(d[U].tieSinglesLost+=1),C&&(d[U].tieDoublesLost+=1))):D.winningSide!==I&&(U&&(d[U].tieMatchUpsWon+=1,M&&(d[U].tieSinglesWon+=1),C&&(d[U].tieDoublesWon+=1)),w&&(d[w].tieMatchUpsLost+=1,M&&(d[w].tieSinglesLost+=1),C&&(d[w].tieDoublesLost+=1)))),sY({matchUpFormat:D.matchUpFormat,matchUpStatus:D.matchUpStatus,score:D.score,winningParticipantId:w,losingParticipantId:U,participantResults:d,isTieMatchUp:!0,manualGamesOverride:S,tallyPolicy:i,winningSide:I})}Lde({winningParticipantId:w,losingParticipantId:U,participantResults:d,matchUpStatus:g})}else sY({matchUpFormat:m.matchUpFormat??e,isTieMatchUp:void 0,winningParticipantId:w,manualGamesOverride:S,losingParticipantId:U,participantResults:d,matchUpStatus:g,tallyPolicy:i,winningSide:I,score:b});else if(g&&no.includes(g)){const D=uI(m,0),E=uI(m,1);D&&(bh(d,D),d[D].matchUpsCancelled+=1),E&&(bh(d,E),d[E].matchUpsCancelled+=1)}else if(v!=null&&v.length){n=0;for(const D of v){if(D.winningSide){const E=(o=T==null?void 0:T.find(({sideNumber:M})=>M===D.winningSide))==null?void 0:o.participantId,C=(a=T==null?void 0:T.find(({sideNumber:M})=>M===D.winningSide))==null?void 0:a.participantId;E&&C&&(bh(d,E),bh(d,C),d[E].tieMatchUpsWon+=1,d[C].tieMatchUpsLost+=1,D.matchUpType===vr?(d[E].tieSinglesWon+=1,d[C].tieSinglesLost+=1):D.matchUpType===Pn&&(d[E].tieDoublesWon+=1,d[C].tieDoublesLost+=1))}aY({score:D.score,manualGamesOverride:S,participantResults:d,sides:T})}}else aY({manualGamesOverride:S,participantResults:d,score:b,sides:T});if(S){const D=(s=T==null?void 0:T.find(({sideNumber:N})=>N===1))==null?void 0:s.participantId,E=(l=T==null?void 0:T.find(({sideNumber:N})=>N===2))==null?void 0:l.participantId;bh(d,D),bh(d,E);const C=(c=b==null?void 0:b.sets)==null?void 0:c.reduce((N,R)=>N+((R==null?void 0:R.side1Score)??0),0),M=(u=b==null?void 0:b.sets)==null?void 0:u.reduce((N,R)=>N+(R.side2Score??0),0);D&&(d[D].gamesWon+=C,d[D].gamesLost+=M),E&&(d[E].gamesWon+=M,d[E].gamesLost+=C)}}return function({participantResults:m,matchUpFormat:g,tallyPolicy:v,perPlayer:y,totalSets:b}){var I;const T=g&&Ga(g)||{},S=T.bestOf,w=S&&Math.ceil(S/2)||1,U=(I=T.setFormat)==null?void 0:I.setTo;Object.keys(m).forEach(D=>{const E=m[D].setsWon,C=m[D].setsLost,M=v!=null&&v.groupTotalSetsPlayed?b:y*(w||0)||E+C;let N=Math.round(E/M*1e3)/1e3;(N===1/0||isNaN(N))&&(N=M);const R=m[D].tieMatchUpsWon,A=R+m[D].tieMatchUpsLost;let _=Math.round(R/A*1e3)/1e3;(_===1/0||isNaN(_))&&(_=R);const k=m[D].matchUpsWon,O=k+m[D].matchUpsLost;let F=Math.round(k/O*1e3)/1e3;(F===1/0||isNaN(F))&&(F=k);const B=m[D].gamesWon||0,$=m[D].gamesLost||0,V=(y||0)*(w||0)*(U||0),H=Math.max(V,B+$);let z=Math.round(B/H*1e3)/1e3;(z===1/0||isNaN(z))&&(z=0);let G=Math.round(m[D].pointsWon/m[D].pointsLost*1e3)/1e3;(G===1/0||isNaN(G))&&(G=0),m[D].setsWon=E,m[D].setsLost=C,m[D].setsPct=N,m[D].tieMatchUpsWon=R,m[D].tieMatchUpsPct=_,m[D].matchUpsPct=F,m[D].gamesWon=B,m[D].gamesLost=$,m[D].gamesPct=z,m[D].pointsPct=G,m[D].result=`${m[D].matchUpsWon}/${m[D].matchUpsLost}`})}({participantResults:d,matchUpFormat:e,tallyPolicy:i,perPlayer:n,totalSets:f}),{participantResults:d}}function Rxe(t){return uI(t,t.winningSide-1)}function Nxe(t){return uI(t,1-(t.winningSide-1))}function uI(t,e){if(!(t!=null&&t.sides))return console.log("no sides:",{matchUp:t}),"foo";const i=t.sides[e];return i?i.participantId:(console.log("No Side",{matchUp:t,index:e}),"foo")}function bh(t,e){e&&!t[e]&&(t[e]={allDefaults:0,defaults:0,defeats:[],gamesLost:0,gamesWon:0,matchUpsCancelled:0,matchUpsLost:0,matchUpsWon:0,pointsLost:0,pointsWon:0,retirements:0,setsLost:0,setsWon:0,tieSinglesWon:0,tieSinglesLost:0,tieDoublesWon:0,tieDoublesLost:0,tieMatchUpsLost:0,tieMatchUpsWon:0,victories:[],walkovers:0})}function aY({manualGamesOverride:t,participantResults:e,score:i,sides:n}){const{sets:r}=i||{},o=[[],[]],a=[0,0];for(const l of r||[]){const{winningSide:c,side1Score:u,side2Score:d}=l;c&&(a[c-1]+=1),o[0].push(Ct(u||0)),o[1].push(Ct(d||0))}const s=[o[0].reduce((l,c)=>l+c,0),o[1].reduce((l,c)=>l+c,0)];n.forEach((l,c)=>{const{participantId:u}=l;u&&(bh(e,u),e[u].setsWon+=a[c],e[u].setsLost+=a[1-c],t||(e[u].gamesWon+=s[c],e[u].gamesLost+=s[1-c]))})}function sY({winningParticipantId:t,losingParticipantId:e,participantResults:i,manualGamesOverride:n,matchUpFormat:r,matchUpStatus:o,isTieMatchUp:a,tallyPolicy:s,winningSide:l,score:c}){const u=l&&l-1,d=1-u;a||Lde({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:o});const p=l3({matchUpStatus:o,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),h=_de({matchUpStatus:o,matchUpFormat:r,tallyPolicy:s,winningSide:l,score:c}),{pointsTally:f}=kde({score:c,matchUpFormat:r});t&&(i[t].setsWon+=p[u],i[t].setsLost+=p[d],n||(i[t].gamesWon+=h[u],i[t].gamesLost+=h[d]),i[t].pointsWon+=f[u],i[t].pointsLost+=f[d]),e&&(i[e].setsWon+=p[d],i[e].setsLost+=p[u],n||(i[e].gamesWon+=h[d],i[e].gamesLost+=h[u]),i[e].pointsWon+=f[d],i[e].pointsLost+=f[u])}function Lde({winningParticipantId:t,losingParticipantId:e,participantResults:i,matchUpStatus:n}){e&&(n===Li&&(i[e].walkovers+=1),n===Mi&&(i[e].defaults+=1),n===da&&(i[e].retirements+=1),[Mi,da,Li].includes(n)&&(i[e].allDefaults+=1),i[e].matchUpsLost+=1),t&&(i[t].matchUpsWon+=1),e&&t&&(i[e].defeats.push(t),i[t].victories.push(e))}function Fde({participantResults:t,participantIds:e,attribute:i}){return Bde({participantResults:t,participantIds:e}).reduce((n,r)=>{const{participantId:o,results:a}=r,s=a==null?void 0:a[i];return!isNaN(s)&&o&&(n[s]?n[s].push(o):n[s]=[o]),n},{})}function Bde(t){return(t.participantIds||Object.keys(t.participantResults)).reduce((e,i,n)=>(e.push({participantId:i,i:n,results:t.participantResults[i]}),e),[])}const Axe=[{attribute:"matchUpsPct",idsFilter:!1},{attribute:"allDefaults",reversed:!0,idsFilter:!1},{attribute:"defaults",reversed:!0,idsFilter:!1},{attribute:"walkovers",reversed:!0,idsFilter:!1},{attribute:"retirements",reversed:!0,idsFilter:!1},{attribute:"setsPct",idsFilter:!1},{attribute:"gamesPct",idsFilter:!1},{attribute:"pointsPct",idsFilter:!1},{attribute:"matchUpsPct",idsFilter:!0},{attribute:"setsPct",idsFilter:!0},{attribute:"gamesPct",idsFilter:!0},{attribute:"pointsPct",idsFilter:!0}],nL={matchUpsPct:20,tieMatchUpsPct:16,setsPct:12,gamesPct:8,pointsPct:4};function lY(t){const{requireCompletion:e=!0,participantResults:i,subOrderMap:n,tallyPolicy:r}=t,o=[];if(e&&!function({participantResults:p,participantsCount:h}){const f=Bde({participantResults:p}),m=f.filter(g=>h-1===g.results.matchUpsWon+g.results.matchUpsLost+g.results.matchUpsCancelled);return h===m.length}(t))return{};const a=["tieMatchUpsWon","tieSinglesWon","tieDoublesWon","matchUpsWon","pointsWon","gamesWon","setsWon","gamesPct","setsPct","pointsPct","matchUpsPct"].includes(r==null?void 0:r.groupOrderKey)?r.groupOrderKey:"matchUpsWon",s=Fde({participantResults:i,attribute:a});o.push({attribute:a,groups:s});const l=Object.keys(s).map(p=>parseFloat(p)).sort((p,h)=>h-p).map(p=>s[p]).map(p=>{const h=$de({participantIds:p,...t});return o.push(...h.report??[]),h.order}).flat(1/0);let c,u=1;l.forEach((p,h)=>{h&&(p.resolved||c&&!p.resolved)&&(u+=1),c=p.resolved,p.resolved?(p.position=h+1,u=p.position):p.position=u});const d=cs(l.map(({position:p})=>p));return l.forEach(p=>{const{participantId:h,position:f}=p||{},m=i[h];p.GEMscore=function(v){return(Array.isArray(r==null?void 0:r.GEMscore)?Object.keys(nL).filter(y=>r.GEMscore.includes(y)):Object.keys(nL)).map(y=>(v[y]||0)*Math.pow(10,nL[y].toFixed(3))).reduce((y,b)=>y+b,0)}(m);const g=d[f];(p==null?void 0:p.position)!==void 0&&(g>1&&(p.ties=g,n&&(p.subOrder=n[h])),p.rankOrder=f,p.groupOrder=f+(p.subOrder||1)-1)}),{groupOrder:l,report:o.flat(1/0).filter(Boolean)}}function $de({participantResults:t,disableHeadToHead:e,participantIds:i,matchUpFormat:n,tallyPolicy:r,matchUps:o}){const a=[],s=[];let l;if((i==null?void 0:i.length)===1)return{order:[{resolved:!0,participantId:i[0]}]};if((i==null?void 0:i.length)===2&&(!(r!=null&&r.headToHead)||!r.headToHead.disabled&&!e)){const u=function({participantIds:d,participantResults:p}){if(d){if(p[d[0]].victories.includes(d[1]))return d.map(h=>({resolved:!0,participantId:h}));if(p[d[1]].victories.includes(d[0]))return d.reverse().map(h=>({resolved:!0,participantId:h}))}}({participantIds:i,participantResults:t});if(u){const d=u[0].participantId;return s.push({attribute:"head2Head",participantIds:i,headToHeadWinner:d}),{order:[u],headToHeadWinner:d,report:s}}}const c=((r==null?void 0:r.tallyDirectives)||Axe).filter(u=>{const d=!(ir(u.maxParticipants)&&(i==null?void 0:i.length)>u.maxParticipants);return d||a.push(u),d});return a.length&&s.push({excludedDirectives:a,participantIds:i}),c.every(({attribute:u,reversed:d,idsFilter:p,disableHeadToHead:h})=>(l=function({disableHeadToHead:f,participantIds:m,matchUpFormat:g,tallyPolicy:v,attribute:y,idsFilter:b,matchUps:I,reversed:T}){const{participantResults:S}=Ode({participantIds:b&&m,matchUpFormat:g,tallyPolicy:v,matchUps:I}),w=Fde({participantResults:S,participantIds:m,attribute:y}),U=[{attribute:y,reversed:T,groups:w,idsFilter:b}];let D;return Object.keys(w).length>1&&m.length&&(D=Object.keys(w).map(E=>parseFloat(E)).sort((E,C)=>T?E-C:C-E).map(E=>w[E]).map(E=>{const C=$de({participantResults:S,disableHeadToHead:f,participantIds:E,matchUpFormat:g,tallyPolicy:v,matchUps:I});return U.push(...C.report??[]),C.order}).flat(1/0)),{order:D,report:U}}({disableHeadToHead:h,participantIds:i,matchUpFormat:n,tallyPolicy:r,attribute:u,idsFilter:p,matchUps:o,reversed:d}),s.push(l.report),!l.order)),l.order?{order:l.order,report:s}:{order:i==null?void 0:i.map(u=>({participantId:u})),report:s}}function mC({policyDefinitions:t,generateReport:e,matchUpFormat:i,matchUps:n=[],subOrderMap:r,perPlayer:o}){if(!vl(n))return{error:Nf};if(n.reduce((y,{structureId:b})=>y.includes(b)?y:y.concat(b),[]).length!==1)return{error:Re,info:"Maximum one structureId"};const a=n.filter(y=>y&&y.matchUpStatus!==Ri),s=a.length&&ti(a.map(({drawPositions:y})=>y).flat()).length,l=a.filter(y=>gm({matchUp:y})).length===a.length;l||(o=0);const c=n.every(({matchUpType:y,tieMatchUps:b})=>y===gn&&(b==null?void 0:b.every(I=>gm({matchUp:I})))),u=t==null?void 0:t[Vce],d=n.filter(y=>gm({matchUp:y})||y.matchUpType===gn),{participantResults:p}=Ode({matchUps:d,matchUpFormat:i,tallyPolicy:u,perPlayer:o});let h,f;const{groupOrder:m,report:g}=lY({matchUps:d,participantResults:p,participantsCount:s,matchUpFormat:i,tallyPolicy:u,subOrderMap:r});if(l&&m)h=g,f=m,m.forEach(y=>{const{participantId:b,groupOrder:I,rankOrder:T,subOrder:S,ties:w,GEMscore:U}=y,D=p[b];Object.assign(D,{groupOrder:I,rankOrder:T,GEMscore:U,subOrder:S,ties:w})});else{const{groupOrder:y,report:b}=lY({requireCompletion:!1,participantResults:p,participantsCount:s,matchUpFormat:i,tallyPolicy:u,subOrderMap:r,matchUps:n});h=b,f=y,y&&y.forEach(I=>{const{participantId:T,groupOrder:S,GEMscore:w}=I,U=p[T];Object.assign(U,{provisionalOrder:S,GEMscore:w})})}const v={completedTieMatchUps:c,readableReport:"",participantResults:p,bracketComplete:l,order:[],report:h};if((l||c)&&(v.order=f),e||Wl({tally:!0})){const y=function({matchUps:b,order:I,report:T}){const S={};b.forEach(({sides:U})=>{U.forEach(D=>{D.participantId&&D.participant&&(S[D.participantId]=D.participant.participantName)})});const w=[];return Array.isArray(T)&&T.forEach((U,D)=>{var E,C;if((E=U.excludedDirectives)!=null&&E.length){const M=U.excludedDirectives.map(({attribute:A})=>A).join(", "),N=`${M.length} directives were excluded due to participants limit}`;w.push(N);const R=`Excluded: ${M}`;w.push(R)}else{const M=(k,O)=>parseFloat(U.reversed?k:O)-parseFloat(U.reversed?O:k),N=U.groups?Object.values(U.groups).flat(1/0).length:((C=U.participantIds)==null?void 0:C.length)??0,R=k=>{k.groups&&Object.keys(k.groups).sort(M).forEach(O=>{const F=k.groups[O].map($=>S[$]).join(", "),B=`${O} ${k.attribute}: ${F}`;w.push(B)})},A=U.reversed?" in reverse order":"",_=`Step ${D+1}: ${N} particiants were ${U.groups?"grouped":"separated"}${A} by ${U.attribute}`;if(w.push(_),U.idsFilter){const k=`${U.attribute} was calculated considering ONLY TIED PARTICIPANTS`;w.push(k)}R(U)}w.push("----------------------")}),w.push("Final Order:"),I.forEach(U=>{const{participantId:D,resolved:E}=U,C=U.groupOrder||U.provisionalOrder;w.push(`${C}: ${S[D]} => resolved: ${!!E}`)}),w.join(`\r
`)}({matchUps:n,report:h,order:f});Wl({tally:!0})&&console.log(y),v.readableReport=y}return v}function u3({positionAssignments:t,tournamentRecord:e,drawDefinition:i,matchUpFormat:n,matchUps:r,event:o}){if(!vl(r))return{error:Re};if(!t)return{error:Re};const{policyDefinitions:a}=Zp({policyTypes:[Vce],tournamentRecord:e,drawDefinition:i,event:o}),{subOrderMap:s}=function({positionAssignments:h}){const f=(h||[]).filter(Ts(Pp)).map(g=>{const{extension:v}=ei({element:g,name:II}),y=Ct(v==null?void 0:v.value),b=!isNaN(y)&&y;return b&&{participantId:g.participantId,subOrder:b}}).filter(Boolean),m=cs(f.map(({subOrder:g})=>g));return{subOrderMap:Object.assign({},...f.filter(({subOrder:g})=>m[g]===1).map(({participantId:g,subOrder:v})=>({[g]:v})))}}({positionAssignments:t}),l=mC({policyDefinitions:a,matchUpFormat:n,subOrderMap:s,matchUps:r});if(l.error)return l;const{participantResults:c,bracketComplete:u,report:d}=l,p=Object.keys(c);return t.forEach(h=>{const{participantId:f}=h;p.includes(f)?(Ii({element:h,extension:{value:c[f],name:tf}}),c[f].ties||ia({element:h,name:II})):(ia({element:h,name:tf}),ia({element:h,name:II}))}),un({drawDefinition:i}),{...le,participantResults:c,bracketComplete:u,report:d}}const Lk={matchUpStatus:qn,matchUpStatusCodes:[],score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},matchUpFormat:void 0,winningSide:void 0};function Vde({matchUps:t,matchUpId:e}){return{matchUp:(t||[]).find(i=>i.matchUpId===e)}}function vn({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,contextProfile:n,drawDefinition:r,matchUpsMap:o,matchUpId:a,inContext:s,context:l,event:c}){if(!r)return{error:rt};if(!a)return{error:co};if(typeof a!="string")return{error:Re};const{structures:u=[]}=Nd({drawDefinition:r});n&&!i&&(i=Xp({contextProfile:n,drawDefinition:r}));for(const d of u){const{matchUps:p}=zi({tournamentParticipants:t,afterRecoveryTimes:e,contextContent:i,drawDefinition:r,contextProfile:n,matchUpsMap:o,inContext:s,structure:d,context:l,event:c}),{matchUp:h}=Vde({matchUps:p,matchUpId:a});if(h)return{matchUp:h,structure:d}}return{error:xo}}function Fk(t){var e;return typeof t!="object"?{error:bt}:typeof t.element!="object"?{error:Re}:t.notes?typeof t.notes=="string"||(e=t.notes)!=null&&e.testing?(Object.assign(t.element,{notes:t.notes}),{...le}):{error:Re}:{error:bt}}function jde(t){return typeof t!="object"?{error:bt}:typeof t.element!="object"?{error:Re}:(t.element.notes&&delete t.element.notes,{...le})}function fu({matchUpStatusCodes:t,removeWinningSide:e,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUpStatus:o,removeScore:a,winningSide:s,matchUpId:l,matchUp:c,event:u,notes:d,score:p}){var h,f,m,g,v,y,b,I;const T="modifyMatchUpScore";let S;const w=c.matchUpType===gn;if(w&&n){if(l&&c.matchUpId!==l){const R=vn({drawDefinition:n,matchUpId:l,event:u});if(!R.matchUp)return{error:xo};({matchUp:c,structure:S}=R)}}else c.matchUpId!==l&&console.log("!!!!!");o&&[Li,gr].includes(o)||a?Object.assign(c,{...Lk}):p&&(c.score=p);const U=o&&(c==null?void 0:c.matchUpStatus)===Mi&&o!==Mi;let D;if(o&&(c.matchUpStatus=o),r&&(c.matchUpFormat=r),t&&(c.matchUpStatusCodes=t),s&&(c.winningSide=s),e&&(c.winningSide=void 0),!S&&n&&({structure:S}=vn({drawDefinition:n,matchUpId:l,event:u})),!o||c.winningSide||!lo(c)||no.includes(o)||[F0,Sg].includes(o)||(c.matchUpStatus=Kc),U&&((h=c==null?void 0:c.processCodes)==null?void 0:h.length)||o===Mi){const R=(f=Gi({tournamentRecord:i,drawDefinition:n,structure:S,event:u}))==null?void 0:f.appliedPolicies;D=(g=(m=R==null?void 0:R[jm])==null?void 0:m.processCodes)==null?void 0:g.incompleteAssignmentsOnDefault}if(!c.collectionId){const R=(S==null?void 0:S.structureType)===na,A=Zl({drawDefinition:n,structure:S});if(LW({drawDefinition:n,structure:S})||A||R){const _=(k=>{r=w?"SET1-S:T100":r??c.matchUpFormat??(k==null?void 0:k.matchUpFormat)??(n==null?void 0:n.matchUpFormat)??(u==null?void 0:u.matchUpFormat);const O=w?{matchUpTypes:[gn]}:void 0,{matchUps:F}=zi({afterRecoveryTimes:!1,tournamentRecord:i,inContext:!0,matchUpFilters:O,drawDefinition:n,structure:k,event:u});return A&&(k.positionAssignments=ti(F.flatMap(B=>(B.sides??[]).map($=>$.participantId)).filter(Boolean)).map(B=>({participantId:B}))),u3({positionAssignments:k.positionAssignments,tournamentRecord:i,drawDefinition:n,matchUpFormat:r,matchUps:F,event:u})})(R&&S.structures.find(k=>k==null?void 0:k.matchUps.find(O=>O.matchUpId===l))||S);if(_.error)return ce({result:_,stack:T})}}if(d){const R=Fk({element:c,notes:d});if(R.error)return ce({result:R,stack:T})}const E=i==null?void 0:i.tournamentId,C=Bu().topics.includes(H2),M=(C||D)&&ma({drawDefinition:n}),N=M&&((v=Ar({matchUpFilters:{matchUpIds:[l]},nextMatchUps:!0,tournamentRecord:i,inContext:!0,drawDefinition:n,matchUpsMap:M}).matchUps)==null?void 0:v[0]);if(C&&N&&function({tournamentId:R,inContextMatchUp:A}){A&&bi({payload:{inContextMatchUp:A,tournamentId:R},topic:H2,key:A.matchUpId})}({tournamentId:E,inContextMatchUp:N}),Array.isArray(D)&&N&&!((y=N.sides)!=null&&y.every(({participantId:R})=>R)))if(o===Mi)c.processCodes=ti([...c.processCodes??[],...D]);else for(const R of D||[]){const A=R&&((b=c==null?void 0:c.processCodes)==null?void 0:b.lastIndexOf(R));(I=c==null?void 0:c.processCodes)==null||I.splice(A,1)}return Ci({eventId:u==null?void 0:u.eventId,context:T,drawDefinition:n,tournamentId:E,matchUp:c}),{...le}}function d3(t){const{dualWinningSideChange:e,matchUpStatusCodes:i,tournamentRecord:n,drawDefinition:r,matchUpFormat:o,matchUpStatus:a,winningSide:s,matchUpId:l,structure:c,matchUp:u,event:d,score:p}=t,h=YP({matchUpStatus:a})||[Yp,Es].includes(a)&&e,f=!!u.collectionId,m=Zl({drawDefinition:r,structure:c});if(!(f||m||function({structure:v,matchUp:y}){const{drawPositions:b}=y,{positionAssignments:I}=Lr({structure:v}),T=I==null?void 0:I.filter(S=>(b==null?void 0:b.includes(S.drawPosition))&&S.participantId);return(T==null?void 0:T.length)===2}({structure:c,matchUp:u})))return{error:ece};const g=[Li].includes(a);return ce({result:fu({matchUpStatusCodes:h&&i||[],matchUpStatus:h&&a||fr,tournamentRecord:n,drawDefinition:r,matchUpFormat:o,removeScore:g,winningSide:s,matchUpId:l,matchUp:u,event:d,score:p}),stack:"attemptToModifyScore"})}function Hde({collectionValueProfiles:t,matchUpCount:e}){const i=[];if(!Array.isArray(t))return i.push(`collectionValueProfiles is not an array: ${t}`),{errors:i};if(t.length&&t.length!==e)return i.push("collectionValueProfiles do not align with matchUpsCount"),{errors:i};for(const r of t){if(typeof r!="object")return i.push(`valueProfile is not type object: ${r}`),{errors:i};const{matchUpValue:o,collectionPosition:a}=r;if(typeof o!="number"||typeof a!="number"||a>e||a<1)return i.push("Invalid value profile: value and collectionPosition must be numeric. collectionPosition cannot be greater than matchUpCount"),{errors:i}}const n=t.map(r=>r.collectionPosition);return n.length!==ti(n).length?(i.push("collectionPositions are not unique"),{errors:i}):{...le}}const _xe="MIXED events can not contain mixed singles or { gender: ANY } collections",kxe="events with { gender: ANY } can not contain MIXED singles collections";function Bk(t){const e="tieFormatGenderValidityCheck",{referenceGender:i,matchUpType:n,gender:r}=t;return i&&r&&[rn,Dn].includes(i)&&i!==r?ce({result:{valid:!1,error:qO},context:{gender:r},stack:e}):i===is&&(r===Ru||r===is&&n!==Pn)?ce({result:{error:qO,valid:!1},info:_xe,stack:e}):i===Ru&&r===is&&n!==Pn?ce({result:{error:qO,valid:!1},info:kxe,stack:e}):{valid:!0}}const xxe=(t,e)=>t.filter(Boolean).every(i=>typeof i===e),Oxe=t=>t.filter(Boolean).every(ir);function gC(t){const e=t.category;if(typeof e!="object")return{error:L2};let{ageCategoryCode:i,ageMaxDate:n,ageMinDate:r,ageMax:o,ageMin:a}=e;const s=e.categoryName;let l;if(!xxe([i,n,r,s],"string")||!Oxe([o,a]))return{error:L2};const c=t.consideredDate??zt(new Date().toLocaleDateString("sv"));if(!Ss(c))return{error:Ha};const[u]=c.split("-").slice(0,3).map(k=>parseInt(k)),d=LS(c,-1),[p,h]=d.split("-").slice(1,3).map(k=>parseInt(k)),f=`${Zs(p)}-${Zs(h)}`,m=LS(c,1),[g,v]=m.split("-").slice(1,3).map(k=>parseInt(k)),y=`${Zs(g)}-${Zs(v)}`;let b=a&&LS(c,-365*a),I=o&&LS(c,-365*o);const T=[],S=k=>!T.includes(k)&&T.push(k);i=i??s;const w=/^([UO]?)(\d{1,2})([UO]?)$/,U=/^C(\d{1,2})-(\d{1,2})$/,D=i==null?void 0:i.includes("-"),E=D&&(i==null?void 0:i.match(U)),C=i==null?void 0:i.match(w),M=(k,O)=>`${k}-${O}`,N=k=>{const O=M(u-k-1,y);e.ageMin&&e.ageMin>k&&S(`Invalid submitted ageMin: ${a}`),e.ageMax&&e.ageMax>k&&S(`Invalid submitted ageMax: ${o}`),e.ageMinDate&&e.ageMinDate!==O&&S(`Invalid submitted ageMinDate: ${r}`),r=O,i&&(e.ageMax&&e.ageMax!==k&&(S(`Invalid submitted ageMax: ${o}`),b=void 0),o=k)},R=k=>{const O=M(u-k,f);e.ageMaxDate&&e.ageMaxDate!==O&&S(`Invalid submitted ageMaxDate: ${n}`),n=O,i&&(e.ageMin&&e.ageMin!==k+1&&(S(`Invalid submitted ageMin: ${a}`),b=void 0),a=k+1)},A=k=>{const[O,F,B]=(k.match(w)||[]).slice(1),$=parseInt(F);O==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),(V=>{const H=M(u-V,y);e.ageMinDate&&e.ageMinDate!==H&&S(`Invalid submitted ageMinDate: ${r}`),r=H,i&&(e.ageMax&&e.ageMax!==V-1&&(S(`Invalid submitted ageMax: ${o}`),I=void 0),o=V-1)})($)):O==="O"&&R($),B==="U"?(e.ageMaxDate&&e.ageMaxDate!==n&&S(`Invalid submitted ageMaxDate: ${e.ageMaxDate}`),N($)):B==="O"&&(V=>{const H=M(u-V-1,f);e.ageMaxDate&&e.ageMaxDate!==H&&S(`Invalid submitted ageMaxDate: ${n}`),n=H,i&&(e.ageMin&&e.ageMin!==V&&(S(`Invalid submitted ageMin: ${a}`),b=void 0),a=V)})($),n=n??b,r=r??I};if(E){if(n=void 0,r=void 0,o=void 0,a=void 0,e.ageMin){const F=u-e.ageMin;n=M(F,f)}if(e.ageMax){const F=u-e.ageMax-1;r=M(F,y)}const[k,O]=((i==null?void 0:i.match(U))??[]).slice(1).map(F=>parseInt(F));k<=O?(a=k,o=O,l=!0):S(`Invalid combined age range ${i}`)}else D?i==null||i.split("-").forEach(A):C?A(i):(a&&R(a),o&&N(o));o&&e.ageMin&&e.ageMin>o&&(S(`Invalid submitted ageMin: ${e.ageMin}`),a=void 0);const _=It({consideredDate:c,combinedAge:l,ageMaxDate:n,ageMinDate:r,ageMax:o,ageMin:a});return T.length&&(_.errors=T),_}function xR({category:t}){if(!bn(t))return{error:Re};const e=gC({category:t});if(e.error)return{error:e};const{ratingMax:i,ratingMin:n}=t;return i&&!ir(i)?ce({result:{error:Re},context:{ratingMax:i}}):n&&!ir(n)?ce({result:{error:Re},context:{ratingMin:n}}):{...e}}function $k({childCategory:t,withDetails:e,category:i}){const n=xR({category:i}),r=xR({category:t}),o=r.ageMin&&(n.ageMin&&r.ageMin<n.ageMin||n.ageMax&&r.ageMin>n.ageMax),a=r.ageMax&&(n.ageMax&&r.ageMax>n.ageMax||n.ageMin&&r.ageMax<n.ageMin),s=r.ageMinDate&&n.ageMaxDate&&new Date(r.ageMinDate)>new Date(n.ageMaxDate),l=r.ageMaxDate&&n.ageMinDate&&new Date(r.ageMaxDate)<new Date(n.ageMinDate),c=(i==null?void 0:i.ratingType)&&(t==null?void 0:t.ratingType)&&i.ratingType===t.ratingType&&(i.ratingMin&&t.ratingMin&&t.ratingMin<i.ratingMin||i.ratingMax&&t.ratingMax&&t.ratingMax>i.ratingMax||i.ratingMin&&t.ratingMax&&t.ratingMax<i.ratingMin||i.ratingMax&&t.ratingMin&&t.ratingMin>i.ratingMax),u=(i==null?void 0:i.ballType)&&(t==null?void 0:t.ballType)&&i.ballType!==t.ballType,d=It({invalidRatingRange:c,invalidAgeMinDate:s,invalidAgeMaxDate:l,invalidBallType:u,invalidAgeMax:a,invalidAgeMin:o,valid:!(c||s||l||u||a||o)},!0);return e&&Object.assign(d,{categoryDetails:n,childCategoryDetails:r}),d}function p3(t,e){if((t!=null&&t.bestOf||t!=null&&t.exactly)&&t!=null&&t.setFormat)return function(i,n){var r;const o=AU(i.bestOf)||void 0,a=AU(i.exactly)||void 0,s=o||a;if((r=i.setFormat)!=null&&r.timed&&i.simplified&&s===1)return Gde(i.setFormat);const l=s&&`${BE}${s}`||"",c=cY(i.setFormat,n),u=c&&`S:${c}`||"",d=cY(i.finalSetFormat,n),p=s&&s>1&&d&&c!==d&&`F:${d}`||"";if(l&&c)return[l,u,p].filter(h=>h).join("-")}(t,e)}function AU(t){return!isNaN(Number(t))&&Number(t)}function Gde(t){let e=`T${t.minutes}`;return t.based&&(e+=t.based),t.modifier&&(e+=`@${t.modifier}`),e}function cY(t,e){if(typeof t=="object"&&Object.keys(t).length){if(t.timed)return Gde(t);if(t.tiebreakSet)return uY(t.tiebreakSet);const i=AU(t.setTo);if(i){const n=t.NoAD&&OW||"",r=uY(t.tiebreakFormat),o=r&&`/${r}`||"",a=AU(t.tiebreakAt);if(r!==!1)return`${i}${n}${o}${a&&(a!==i||e)&&`@${a}`||""}`}}}function uY(t){if(t){if(typeof t!="object"||t.tiebreakTo){if(typeof t=="object"&&AU(t.tiebreakTo)){let e=`TB${t.tiebreakTo}${t.NoAD?OW:""}`;return t.modifier&&(e+=`@${t.modifier}`),e}return!1}return""}}function Rs({matchUpFormat:t}){if(typeof t!="string")return!1;const e=Ga(t),i=t.match(/-S:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),n=i==null?void 0:i[1],r=i==null?void 0:i[2],o=i==null?void 0:i[3],a=t.match(/-F:([1-9])+\/TB([0-9]{1,2})@?([1-9]?)*/),s=a==null?void 0:a[1],l=a==null?void 0:a[2],c=a==null?void 0:a[3];return p3(e,!!(i&&r&&n===o||a&&l&&s===c))===t}function vC({checkCategory:t=!0,collectionDefinition:e,checkCollectionIds:i,checkGender:n=!0,referenceCategory:r,referenceGender:o,event:a}){o=o??(a==null?void 0:a.gender);const s="validateCollectionDefinition",l=[];if(typeof e!="object")return l.push(`collectionDefinition must be an object: ${e}`),ce({result:{errors:l,error:Af},stack:s});const{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,collectionId:p,matchUpCount:h,matchUpFormat:f,matchUpValue:m,matchUpType:g,scoreValue:v,setValue:y,category:b,gender:I}=e;if(i&&typeof p!="string"&&l.push(`collectionId is not type string: ${p}`),typeof h!="number"&&l.push(`matchUpCount is not type number: ${h}`),g&&![vr,Pn].includes(g)&&l.push(`matchUpType must be SINGLES or DOUBLES: ${g}`),[!!(c!=null&&c.length)].concat([m,d,v,y].map($t)).filter(Boolean).length!==1&&l.push("Missing value definition for matchUps: matchUpValue, collectionValue, or collectionValueProfiles"),m&&typeof m!="number"&&l.push(`matchUpValue is not type number: ${m}`),d&&typeof d!="number"&&l.push(`collectionValue is not type number: ${d}`),c&&h){const T=Hde({collectionValueProfiles:c,matchUpCount:h});T.errors&&l.push(...T.errors)}if(u&&typeof u!="number"&&l.push(`collectionGroupNumber is not type number: ${d}`),f&&!Rs({matchUpFormat:f})&&l.push(`Invalid matchUpFormat: ${f}`),n){const T=Bk({referenceGender:o,matchUpType:g,gender:I});if(T.error)return ce({context:{referenceGender:o,gender:I},result:T,stack:s})}if(t&&r&&b){const T=$k({category:r,childCategory:b});if(!T.valid)return ce({result:{error:L2},context:T,stack:s})}return l.length?ce({result:{errors:l,error:W_e},stack:s}):{valid:!0}}function ds(t){var e,i,n,r;const o=!((t==null?void 0:t.enforceCategory)===!1||!(t!=null&&t.category)),a=!((t==null?void 0:t.enforceGender)===!1||!(t!=null&&t.gender)),s=t==null?void 0:t.checkCollectionIds,l=t==null?void 0:t.tieFormat,c=t==null?void 0:t.event,u="validateTieFormat",d=[];if(!t||!l||typeof l!="object")return d.push("tieFormat must be an object"),ce({result:{error:Ph},context:{tieFormat:l,errors:d},stack:u});if(typeof l.winCriteria!="object")return d.push("tieFormat.winCriteria must be an object"),ce({result:{error:Ph},context:{tieFormat:l,errors:d},stack:u});if(!Array.isArray(l.collectionDefinitions))return d.push(_d("tieFormat.collectionDefinitions")),ce({result:{error:Ph},context:{tieFormat:l,errors:d},stack:u});let p;const h=l.collectionDefinitions.every(y=>{const{setValue:b,scoreValue:I,collectionValue:T}=y;!b&&!I||T||(p=!0);const{valid:S,errors:w}=vC({referenceCategory:t.category,referenceGender:t.gender,collectionDefinition:y,checkCollectionIds:s,checkCategory:o,checkGender:a,event:c});return!!S||(Array.isArray(w)&&d.push(...w),!1)}),f=typeof((e=l.winCriteria)==null?void 0:e.valueGoal)=="number"&&((i=l.winCriteria)==null?void 0:i.valueGoal)>0&&!p||((n=l.winCriteria)==null?void 0:n.aggregateValue);if(!f&&!((r=l.winCriteria)!=null&&r.aggregateValue))return p?d.push("aggregateValue is required"):d.push("Either non-zero valueGoal, or { aggregateValue: true } must be specified in winCriteria"),ce({context:{tieFormat:l,errors:d,aggregateValueImperative:p},result:{error:Ph},stack:u});const m=l.collectionDefinitions.map(({collectionId:y})=>y),g=!s||m.length===ti(m).length,v=h&&f&&g;return v?{valid:v,errors:d}:ce({result:{error:Ph},context:{tieFormat:l,errors:d},stack:u})}function Lxe({collectionDefinition:t,groupValueNumbers:e,groupValueGroups:i,sideTieValues:n,tieMatchUps:r}){const o=r.filter(y=>y.collectionId===t.collectionId),a=[0,0];let s=[0,0];const l=o.every(y=>no.includes(y.matchUpStatus)),{collectionValueProfiles:c,collectionGroupNumber:u,collectionValue:d,matchUpValue:p,winCriteria:h,scoreValue:f,setValue:m}=t,g=u&&e.includes(u),v=[0,0];if(o.forEach(y=>{y.winningSide&&(v[y.winningSide-1]+=1)}),$t(p)?o.forEach(y=>{y.winningSide&&(a[y.winningSide-1]+=p)}):$t(m)?o.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{T.winningSide&&(a[T.winningSide-1]+=m)})}):$t(f)?o.forEach(y=>{var b,I;(I=(b=y.score)==null?void 0:b.sets)==null||I.forEach(T=>{const{side1TiebreakScore:S=0,side2TiebreakScore:w=0,side1Score:U=0,side2Score:D=0}=T;(y.matchUpStatus===fr||y.winningSide||T.winningSide)&&(U||D?(a[0]+=U,a[1]+=D):(S||w)&&T.winningSide&&(a[T.winningSide-1]+=1))})}):Array.isArray(c)&&o.forEach(y=>{if(y.winningSide){const b=y.collectionPosition,I=function({collectionDefinition:T,collectionPosition:S}){const w=T.collectionValueProfiles||[],U=w==null?void 0:w.find(D=>D.collectionPosition===S);return U==null?void 0:U.matchUpValue}({collectionDefinition:t,collectionPosition:b});$t(I)&&(a[y.winningSide-1]+=I)}}),$t(d)){let y;if(h!=null&&h.aggregateValue)l&&($t(p||m||f)&&a[0]!==a[1]?y=a[0]>a[1]?1:2:v[0]!==v[1]&&(y=v[0]>v[1]?1:2));else if(h!=null&&h.valueGoal)y=a.reduce((b,I,T)=>I>=h.valueGoal?T+1:b,0);else{const b=Math.floor(t.matchUpCount/2)+1;y=v.reduce((I,T,S)=>T>=b?S+1:I,0)}y&&(g?i[u].values[y-1]+=d:s[y-1]+=d)}else g?(i[u].values[0]+=a[0]||0,i[u].values[1]+=a[1]||0):s=a;g?(i[u].sideWins[0]+=v[0]||0,i[u].sideWins[1]+=v[1]||0,i[u].allGroupMatchUpsCompleted=i[u].allGroupMatchUpsCompleted&&l,i[u].matchUpsCount+=o.length):s.forEach((y,b)=>n[b]+=y||0)}function zde({collectionGroups:t=[]}){const e=Object.assign({},...t.filter(i=>$t(i==null?void 0:i.groupValue)&&(i==null?void 0:i.groupNumber)).map(i=>({[i.groupNumber]:{...i,allGroupMatchUpsCompleted:!0,matchUpsCount:0,sideWins:[0,0],values:[0,0]}})));return{groupValueGroups:e,groupValueNumbers:Object.keys(e).map(i=>Ct(i))}}function OR(t){var e,i,n,r;const{sideAdjustments:o=[0,0],separator:a="-",drawDefinition:s,matchUpsMap:l,structure:c,matchUp:u,event:d}=t;if(!Array.isArray(o)||o.length!==2||isNaN(o.reduce((U,D)=>U+D)))return{error:Re};if(!u)return{error:Cs};const p=((e=jo({matchUp:u,drawDefinition:s,structure:c,event:d}))==null?void 0:e.tieFormat)||(t==null?void 0:t.tieFormat);if(!p)return{error:Z_};const h=ds({tieFormat:p});if(h.error)return h;const f=(p==null?void 0:p.collectionDefinitions)||[],m=(u==null?void 0:u.tieMatchUps)??[],g=[0,0],{groupValueGroups:v,groupValueNumbers:y}=zde(p);for(const U of f)Lxe({collectionDefinition:U,groupValueNumbers:y,groupValueGroups:v,sideTieValues:g,tieMatchUps:m});for(const U of y){const D=v[U],{allGroupMatchUpsCompleted:E,matchUpCount:C,winCriteria:M,groupValue:N,sideWins:R,values:A}=D;let _;if(M!=null&&M.aggregateValue)E&&A[0]!==A[1]&&(_=A[0]>A[1]?1:2);else if(M!=null&&M.valueGoal)_=A.reduce((k,O,F)=>O>=M.valueGoal?F+1:k,void 0);else{const k=Math.floor(C/2)+1;_=R.reduce((O,F,B)=>F>=k?B+1:O,void 0)}_&&(g[_-1]+=N||0)}const b=g.map((U,D)=>(U||0)+o[D]),I={side1Score:b[0],side2Score:b[1],winningSide:void 0},T=b.join(a),S=b.slice().reverse().join(a);let w;if(p!=null&&p.winCriteria){const{valueGoal:U,aggregateValue:D,tallyDirectives:E}=p.winCriteria;if(U){const C=b.map((M,N)=>({sideNumber:N+1,points:M})).find(({points:M})=>M>=U);w=C==null?void 0:C.sideNumber}else D&&m.every(C=>C.matchUpStatus&&no.includes(C.matchUpStatus)||C.winningSide)&&b[0]!==b[1]&&(w=b[0]>b[1]?1:2);if(!w&&E){const C=u.matchUpId,M=u.hasContext?u:((i=l==null?void 0:l.drawMatchUps)==null?void 0:i[C])||s&&((n=vn({inContext:!0,drawDefinition:s,matchUpId:C}))==null?void 0:n.matchUp);if(M){const{completedTieMatchUps:N,order:R}=mC({matchUps:[M]});if(N&&R!=null&&R.length){const A=R[0].participantId;w=(r=M.sides.find(({participantId:_})=>_===A))==null?void 0:r.sideNumber}}}}return w&&(I.winningSide=w),{scoreStringSide1:T,scoreStringSide2:S,winningSide:w,set:I}}function po(t){if(t)return ft(t,!1,!0)}function h3(t){const e=Ln(t,[{[Oo]:!0}]);return e.error?e:Object.keys(t.tournamentRecords).reduce((i,n)=>{i.tournamentIdMap[n]=[];const r=t.tournamentRecords[n].events||[],o=r.map(({eventId:s})=>s),a=r.map(s=>(s.drawDefinitions||[]).map(({drawId:l})=>l)).flat();return i.tournamentIdMap[n].push(...o,...a),i.eventIds.push(...o),i.drawIds.push(...a),i},{eventIds:[],drawIds:[],tournamentIdMap:{}})}function Wde({tournamentRecords:t,eventId:e,drawId:i}){const{tournamentIdMap:n}=h3({tournamentRecords:t});return(n?Object.keys(n):[]).find(r=>e&&(n==null?void 0:n[r].includes(e))||i&&(n==null?void 0:n[r].includes(i)))}function yC({inContextDualMatchUp:t,drawDefinition:e,tournamentId:i,dualMatchUp:n,eventId:r}){var o,a;if(n){t||(t=(o=vn({matchUpId:n.matchUpId,inContext:!0,drawDefinition:e}))==null?void 0:o.matchUp);const{extension:s}=ei({element:e,name:Cp}),l=ft((s==null?void 0:s.value)||{},!1,!0),c=({displaySideNumber:u,drawPosition:d,sideNumber:p})=>({drawPosition:d,sideNumber:p,displaySideNumber:u});n.sides=(a=t==null?void 0:t.sides)==null?void 0:a.map(u=>{var d;const p=u.participantId,h=p&&l[p]||void 0,{lineUp:f,...m}=((d=n.sides)==null?void 0:d.find(({sideNumber:v})=>v===u.sideNumber))??{},g=f!=null&&f.length?f:h;return{...c(u),...m,lineUp:g}}),Ci({context:"ensureSidLineUps",matchUp:n,drawDefinition:e,tournamentId:i,eventId:r})}}function Od(t){var e,i,n,r;const{exitWhenNoValues:o,drawDefinition:a,matchUpStatus:s,removeScore:l,matchUpsMap:c,matchUpId:u,event:d}=t,p=t.tournamentRecords||t.tournamentRecord&&{[(e=t.tournamentRecord)==null?void 0:e.tournamentId]:t.tournamentRecord}||{},h=t.tournamentId||((i=t.tournamentRecord)==null?void 0:i.tournamentId);p&&Wde({tournamentRecords:p,...t});const f=h&&p[h];if(!f)return{error:je};const m=vn({drawDefinition:a,event:d,matchUpId:u});if(m.error)return m;if(!m.matchUp)return{error:xo};const{matchUp:g,structure:v}=m;if(!g.tieMatchUps)return{error:ja};yC({tournamentId:f==null?void 0:f.tournamentId,eventId:d==null?void 0:d.eventId,dualMatchUp:g,drawDefinition:a});const{extension:y}=ei({name:cw,element:g});if(y!=null&&y.value){if(!l)return{...le,score:g.score};ia({element:g,name:cw})}const b=(n=jo({drawDefinition:a,structure:v,matchUp:g,event:d}))==null?void 0:n.tieFormat;g.tieFormat=po(b);const I=OR({drawDefinition:a,matchUpsMap:c,structure:v,matchUp:g,event:d}),{winningSide:T,set:S,scoreStringSide1:w,scoreStringSide2:U}=I,D=(S==null?void 0:S.side1Score)||(S==null?void 0:S.side2Score);if(o&&!g.score&&!D)return{...le};const E={scoreStringSide1:w,scoreStringSide2:U,sets:S?[S]:[]},C=T&&[1,2].includes(T),M=C&&fr||CW({matchUpStatus:s??g.matchUpStatus,tieMatchUps:g.tieMatchUps,winningSide:g.winningSide,score:E})&&Kc||qn,N=!(!g.winningSide||C),R=g.tieMatchUps.find(({score:_,winningSide:k,matchUpStatus:O})=>{var F;return((F=_==null?void 0:_.sets)==null?void 0:F.length)&&(_.sets[0].side1Score||_.sets[0].side2Score)||O&&no.includes(O)||k});let A;if(g.tieFormat&&!C&&!R){const _=(r=jo({drawDefinition:a,structure:v,event:d}))==null?void 0:r.tieFormat;_&&JSON.stringify(b)===JSON.stringify(_)&&(g.tieFormatId=void 0,g.tieFormat=void 0,A=!0)}return fu({matchUpStatus:M,score:E,removeWinningSide:N,tournamentRecord:f,drawDefinition:a,removeScore:l,winningSide:T,matchUpId:u,matchUp:g,event:d}),{...le,score:E,removeWinningSide:N,tieFormatRemoved:A,winningSide:T}}function qde(t){const e=d3(t);if(e.error)return e;const i=YP({matchUpStatus:t.matchUpStatus}),{dualWinningSideChange:n,projectedWinningSide:r,inContextDrawMatchUps:o,tournamentRecord:a,drawDefinition:s,matchUpStatus:l,dualMatchUp:c,matchUpsMap:u,winningSide:d,targetData:p,matchUpId:h,structure:f,matchUp:m,event:g}=t,v="directParticipants",y=!!m.collectionId,b=Zl({drawDefinition:s,structure:f});let I,T=m.drawPositions;if(y){const{matchUpTieId:S,matchUpsMap:w}=t,U=Od({matchUpId:S,tournamentRecord:a,drawDefinition:s,matchUpsMap:w,event:g});I=U&&{tieMatchUpResult:U};const D=o.find(({matchUpId:E})=>E===S);if(T=D==null?void 0:D.drawPositions,!n)return ce({result:{...le,...I},stack:v})}if(b)return ce({result:{...le,...I},stack:v});if(!T)return ce({result:{error:q_},stack:v});{const S=r?r-1:d-1,w=1-S,U=T[S],D=T[w],{targetLinks:{loserTargetLink:E,winnerTargetLink:C,byeTargetLink:M},targetMatchUps:{winnerMatchUpDrawPositionIndex:N,loserMatchUpDrawPositionIndex:R,winnerMatchUp:A,loserMatchUp:_,byeMatchUp:k}}=p;if(A){const O=function({winnerMatchUpDrawPositionIndex:F,inContextDrawMatchUps:B,projectedWinningSide:$,sourceMatchUpStatus:V,winningDrawPosition:H,tournamentRecord:z,winnerTargetLink:G,sourceMatchUpId:W,drawDefinition:K,winnerMatchUp:Z,dualMatchUp:Y,matchUpsMap:X,event:Q}){var te,J,ie;const oe="directWinner";if(G){const ne=Z.drawPositions||[],re=ne[F],me=G.source.structureId,he=kt({structureId:me,drawDefinition:K});if(he.error)return he;const{structure:be}=he,{positionAssignments:Se}=Lr({structureId:me,drawDefinition:K}),De=Se==null?void 0:Se.find(Ie=>Ie.drawPosition===H),Oe=De==null?void 0:De.participantId,xe=G.target.structureId,{positionAssignments:$e}=Lr({structureId:xe,drawDefinition:K}),Ae=$e==null?void 0:$e.find(Ie=>Ie.participantId===Oe),ve=Ae==null?void 0:Ae.drawPosition,ke=$e==null?void 0:$e.filter(Ie=>{const Ne=ne.includes(Ie.drawPosition),Fe=!Ie.participantId&&!Ie.bye&&!Ie.qualifier;return Ne&&Fe}).map(Ie=>Ie.drawPosition),ye=ke==null?void 0:ke.includes(re);if(Oe&&G.target.roundNumber===1&&ye)lu({drawPosition:re,participantId:Oe,structureId:xe,inContextDrawMatchUps:B,sourceMatchUpStatus:V,tournamentRecord:z,drawDefinition:K,matchUpsMap:X,event:Q});else if(Oe&&ke!=null&&ke.length){const Ie=ke.pop();Ie&&lu({participantId:Oe,structureId:xe,inContextDrawMatchUps:B,sourceMatchUpStatus:V,tournamentRecord:z,drawDefinition:K,drawPosition:Ie,matchUpsMap:X,event:Q})}else if(ve){const Ie=mw({drawPosition:ve,matchUpId:Z.matchUpId,inContextDrawMatchUps:B,sourceMatchUpStatus:V,tournamentRecord:z,sourceMatchUpId:W,drawDefinition:K,matchUpsMap:X});if(Ie.error)return ce({result:Ie,stack:oe})}else if((be==null?void 0:be.stage)!==St){const Ie="winner target position unavaiallble";return console.log(Ie),{error:Ie}}if(be!=null&&be.seedAssignments&&be.structureId!==xe){const Ie=be.seedAssignments.find(({participantId:Fe})=>Fe===Oe),Ne=Ie==null?void 0:Ie.participantId;Ie&&Ne&&vw({eventId:Z==null?void 0:Z.eventId,structureId:xe,...Ie,tournamentRecord:z,drawDefinition:K,participantId:Ne})}}else{const ne=mw({matchUpId:Z.matchUpId,drawPosition:H,inContextDrawMatchUps:B,sourceMatchUpStatus:V,tournamentRecord:z,sourceMatchUpId:W,drawDefinition:K,matchUpsMap:X});if(ne.error)return ne}if(Y&&$){const ne=(te=Y.sides)==null?void 0:te.find(re=>re.sideNumber===$);if(ne!=null&&ne.lineUp){const re=Y.roundPosition,me=Z.roundPosition,he=re===me&&re!==1||Math.floor(re/2)===me?2:1,be=(J=X==null?void 0:X.drawMatchUps)==null?void 0:J.find(({matchUpId:Oe})=>Oe===Z.matchUpId),Se=[1,2].map(Oe=>{var xe;return{...((xe=be.sides)==null?void 0:xe.find($e=>$e.sideNumber===Oe))||{},sideNumber:Oe}});be.sides=Se;const De=be.sides.find(Oe=>Oe.sideNumber===he);if(De){const Oe=(ie=ne.lineUp)==null?void 0:ie.filter(xe=>xe==null?void 0:xe.participantId);De.lineUp=X2({lineUp:Oe}),Ci({tournamentId:z==null?void 0:z.tournamentId,eventId:Z==null?void 0:Z.eventId,matchUp:be,context:oe,drawDefinition:K})}}}return{...le}}({sourceMatchUpStatus:i&&l||fr,winnerMatchUpDrawPositionIndex:N,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:r,winningDrawPosition:U,tournamentRecord:a,winnerTargetLink:C,drawDefinition:s,winnerMatchUp:A,dualMatchUp:c,matchUpsMap:u,event:g});if(O.error)return ce({result:O,stack:v})}if(_){const O=function(F){var B,$;const{loserMatchUpDrawPositionIndex:V,inContextDrawMatchUps:H,projectedWinningSide:z,sourceMatchUpStatus:G,loserDrawPosition:W,tournamentRecord:K,loserTargetLink:Z,drawDefinition:Y,loserMatchUp:X,dualMatchUp:Q,matchUpsMap:te,event:J}=F,ie="directLoser",oe=Z.linkCondition,ne=X.drawPositions||[],re=oe===Md&&X.roundNumber===2&&Math.min(...ne.filter(Boolean)),me=re||ne[V],he=re||ne[1-V],be=Z.source.structureId,{structure:Se}=kt({structureId:be,drawDefinition:Y}),{matchUps:De}=zi({afterRecoveryTimes:!1,inContext:!0,drawDefinition:Y,structure:Se,event:J}),Oe=De.filter(fe=>{var Te;return(Te=fe.drawPositions)==null?void 0:Te.includes(W)}).filter(fe=>{const Te=fe.sides.find(de=>de.drawPosition===W),ue=fe.matchUpStatus===Li||fe.matchUpStatus===Mi&&!lo(fe);return(Te==null?void 0:Te.sideNumber)===fe.winningSide&&!ue}),xe=oe===Md&&Oe.length===0,{positionAssignments:$e}=Lr({structureId:be,drawDefinition:Y}),Ae=$e==null?void 0:$e.find(fe=>fe.drawPosition===W),ve=Ae==null?void 0:Ae.participantId,ke=Z.target.structureId,{positionAssignments:ye}=Lr({structureId:ke,drawDefinition:Y}),Ie=ye==null?void 0:ye.filter(({drawPosition:fe})=>ne.includes(fe));if(Ie!=null&&Ie.some(fe=>fe.participantId===ve))return{...le};const Ne=Ie==null?void 0:Ie.filter(fe=>{const Te=ne.includes(fe.drawPosition),ue=!fe.participantId&&!fe.bye&&!fe.qualifier;return Te&&ue}).map(fe=>fe.drawPosition),Fe=Ne==null?void 0:Ne.includes(me),Le=Z.target.roundNumber>1&&(Ne==null?void 0:Ne.length),ge=Z.target.roundNumber===1&&Fe;if(re){const fe=function(){const Te="loserLinkFedFMLC";return ce(xe?{result:we(),stack:Te}:{result:Ee(),stack:Te})}();if(fe.error)return ce({result:fe,stack:ie})}else if(ge){const fe=we();if(fe.error)return ce({result:fe,stack:ie})}else{if(!ve||!Le)return ce({result:{error:kP},context:{loserDrawPosition:W,loserTargetLink:Z},stack:ie});{Ne.sort(Sr);const fe=Ne[0],Te=lu({participantId:ve,structureId:ke,drawPosition:fe,inContextDrawMatchUps:H,sourceMatchUpStatus:G,tournamentRecord:K,drawDefinition:Y,matchUpsMap:te,event:J});if(Te.error)return ce({result:Te,stack:ie})}}if(Se!=null&&Se.seedAssignments&&Se.structureId!==ke){const fe=Se.seedAssignments.find(({participantId:ue})=>ue===ve),Te=fe==null?void 0:fe.participantId;fe&&Te&&vw({eventId:X==null?void 0:X.eventId,structureId:ke,...fe,tournamentRecord:K,drawDefinition:Y,participantId:Te})}if(Q&&z){const fe=(B=Q.sides)==null?void 0:B.find(Te=>Te.sideNumber===3-z);if(fe!=null&&fe.lineUp){const{roundNumber:Te,eventId:ue}=X,{roundPosition:de}=Q,_e=Te===1?2-de%2:1,Ue=($=te==null?void 0:te.drawMatchUps)==null?void 0:$.find(({matchUpId:He})=>He===X.matchUpId),Ce=[1,2].map(He=>{var Be;return{...((Be=Ue.sides)==null?void 0:Be.find(et=>et.sideNumber===He))||{},sideNumber:He}});Ue.sides=Ce;const We=Ue.sides.find(He=>He.sideNumber===_e);We&&(We.lineUp=X2({lineUp:fe.lineUp}),Ci({tournamentId:K==null?void 0:K.tournamentId,matchUp:Ue,context:ie,drawDefinition:Y,eventId:ue}))}}return{...le};function Ee(){return ce({result:Ms({drawPosition:he,structureId:ke,tournamentRecord:K,drawDefinition:Y,event:J}),stack:"assignLoserPositionBye"})}function we(){return ce({result:ve?lu({drawPosition:me,participantId:ve,structureId:ke,inContextDrawMatchUps:H,sourceMatchUpStatus:G,tournamentRecord:K,drawDefinition:Y,matchUpsMap:te,event:J}):{error:Hr},stack:"assignLoserDrawPosition"})}}({sourceMatchUpStatus:i&&l||fr,loserMatchUpDrawPositionIndex:R,sourceMatchUpId:h,inContextDrawMatchUps:o,projectedWinningSide:r,loserDrawPosition:D,tournamentRecord:a,loserTargetLink:E,drawDefinition:s,loserMatchUp:_,winningSide:d,matchUpsMap:u,dualMatchUp:c,event:g});if(O.error)return ce({result:O,stack:v})}if(k){const O=k.drawPositions||[],F=Ms({drawPosition:Math.min(...O.filter(Boolean)),structureId:M.target.structureId,tournamentRecord:a,drawDefinition:s,event:g});if(F.error)return ce({result:F,stack:v})}}return ce({result:{...le,...I},stack:v})}function f3(t){var e,i;const n="genPlayoffStructure";if(!t.drawDefinition)return ce({result:{error:rt},stack:n});const r=hC(t);if(r.error)return ce({result:r,stack:n});const{structureId:o,addNameBaseToAttributeName:a,playoffStructureNameBase:s,finishingPositionNaming:l,finishingPositionLimit:c,playoffAttributes:u,playoffPositions:d,roundOffsetLimit:p,tournamentRecord:h,exitProfileLimit:f,roundProfiles:m,roundNumbers:g,idPrefix:v,isMock:y,event:b,uuids:I}=t,T=ft(t.drawDefinition,!1,!0),{structure:S}=kt({structureId:o,drawDefinition:T});if(!S)return ce({result:{error:Cn},stack:n});if(S.structureType===na||S.structures)return function(Q){var te,J,ie;const oe="generateAndPopulateRRplayoffStructures";if(!Q.playoffGroups)return ce({result:{error:bt},info:"playoffGroups required",stack:oe});const{sourceStructureId:ne,requireSequential:re,tournamentRecord:me,drawDefinition:he,playoffGroups:be,groupCount:Se,groupSize:De,event:Oe}=Q,{structures:xe=[],links:$e=[],finishingPositionTargets:Ae,positionRangeMap:ve,error:ke}=Nde({requireSequential:re,sourceStructureId:ne,playoffGroups:be,groupCount:Se,groupSize:De,...Q});if(ke)return{error:ke};const ye=Ae==null?void 0:Ae.map(({finishingPositions:Te})=>Te).flat().map(Te=>ve[Te].finishingPositions).flat();he.structures.push(...xe),he.links.push(...$e);const{matchUps:Ie,matchUpsMap:Ne}=Ar({inContext:!0,drawDefinition:he}),Fe=xe.map(({structureId:Te})=>Te),Le=Ie==null?void 0:Ie.filter(({structureId:Te})=>Fe.includes(Te)).map($r),ge=(te=Ne==null?void 0:Ne.drawMatchUps)==null?void 0:te.filter(({matchUpId:Te})=>Le==null?void 0:Le.includes(Te));if(ge!=null&&ge.length){const Te=(J=jo({drawDefinition:he,event:Oe}))==null?void 0:J.tieFormat;Te&&ge.forEach(ue=>{const{tieMatchUps:de}=NU({isMock:Q.isMock,tieFormat:Te,matchUp:ue});Object.assign(ue,{tieMatchUps:de,matchUpType:Ad})})}const{positionAssignments:Ee}=Ki({structureId:ne,drawDefinition:he}),we={};Ee==null||Ee.forEach(Te=>{var ue;const de=ei({element:Te,name:tf}),_e=(ue=de==null?void 0:de.extension)==null?void 0:ue.value,Ue=_e==null?void 0:_e.groupOrder;Ue&&(we[Ue]||(we[Ue]=[]),we[Ue].push(Te.participantId))});const fe=dC({provisionalPositioning:Q.provisionalPositioning,structureId:ne,applyPositioning:!0,event:Q.event,tournamentRecord:me,drawDefinition:he});return fe.error&&((ie=fe.error)==null?void 0:ie.code)!==Yle.code?ce({result:fe,stack:oe}):{structures:xe,links:$e,positionsPlayedOff:ye,drawDefinition:he,...le}}({sourceStructureId:S.structureId,...t,...r,drawDefinition:T});const{playoffRoundsRanges:w,playoffRounds:U}=r,{playoffPositionsReturned:D,error:E,playoffSourceRounds:C,playoffRoundsRanges:M}=Cde(t);if(E)return ce({result:{error:E},stack:n});const N=(m==null?void 0:m.length)&&Object.assign({},...m),R=g||typeof m=="object"&&m.map(Q=>Object.keys(Q)).flat(),A=Array.isArray(R)&&R.map(Q=>!isNaN(Q)&&Ct(Q)).filter(Boolean);if(A){if(!Array.isArray(A))return ce({result:{error:Re},context:{validRoundNumbers:A},stack:n});A.forEach(Q=>{if(!(U!=null&&U.includes(Q)))return ce({result:{error:Re},context:{roundNumber:Q},stack:n})})}d&&d.forEach(Q=>{if(!(D!=null&&D.includes(Q)))return ce({result:{error:Re},context:{playoffPosition:Q},stack:n})});const _=A||C,k=A?w:M,O=[],F=[];for(const Q of _??[]){const te=k==null?void 0:k.find(be=>be.roundNumber===Q);if(!te)return ce({result:{error:Re},context:{roundNumber:Q},stack:n});const J=te.finishingPositions.length,ie=Math.min(...te.finishingPositions)-1,oe=2,ne=Q&&(N==null?void 0:N[Q])&&oe+N[Q]-1,re=SI({exitProfile:`0-${Q}`,addNameBaseToAttributeName:a,playoffStructureNameBase:s,finishingPositionOffset:ie,playoffAttributes:u,exitProfileLimit:f,stage:Vn,roundOffset:0,drawDefinition:T,sequenceLimit:ne,stageSequence:oe,drawSize:J,idPrefix:v,isMock:y,uuids:I,finishingPositionNaming:l,finishingPositionLimit:c,roundOffsetLimit:p});if(re.error)return ce({result:re,stack:n});const{structures:me,links:he}=re;if(me!=null&&me.length&&O.push(...me),he!=null&&he.length&&F.push(...he),re.structureId&&Q){const be={linkType:Ed,source:{structureId:o,roundNumber:Q},target:{structureId:re.structureId,feedProfile:_l,roundNumber:1}};F.push(be)}}if(!O.length)return ce({result:{error:Re},info:"No structures generated",stack:n});T.structures.push(...O),T.links.push(...F);const{matchUps:B,matchUpsMap:$}=Ar({inContext:!0,drawDefinition:T}),V=O.map(({structureId:Q})=>Q),H=B==null?void 0:B.filter(({structureId:Q})=>V.includes(Q)).map($r),z=(e=$==null?void 0:$.drawMatchUps)==null?void 0:e.filter(({matchUpId:Q})=>H==null?void 0:H.includes(Q));if(z!=null&&z.length){const Q=(i=jo({drawDefinition:T,event:b}))==null?void 0:i.tieFormat;Q&&z.forEach(te=>{const{tieMatchUps:J}=NU({matchUp:te,tieFormat:Q,isMock:y});Object.assign(te,{tieMatchUps:J,matchUpType:gn})})}const G=B==null?void 0:B.filter(Q=>gm({matchUp:Q})&&Q.structureId===o);G==null||G.forEach(Q=>{const{matchUpId:te,score:J,winningSide:ie}=Q,oe=pa({inContextDrawMatchUps:B,drawDefinition:T,matchUpId:te}),ne=qde({inContextDrawMatchUps:B,tournamentRecord:h,drawDefinition:T,matchUpsMap:$,winningSide:ie,targetData:oe,matchUpId:te,structure:S,matchUp:Q,score:J,event:b});ne.error&&console.log(ne.error)});const W=B==null?void 0:B.filter(Q=>Q.matchUpStatus===Ri&&Q.structureId===o);W==null||W.forEach(Q=>{const{matchUpId:te}=Q,J=pa({inContextDrawMatchUps:B,drawDefinition:T,matchUpId:te}),{targetLinks:{loserTargetLink:ie},targetMatchUps:{loserMatchUpDrawPositionIndex:oe,loserMatchUp:ne}}=J;if(ie&&ne){const re=ie.target.structureId,me=Ms({drawPosition:ne.drawPositions[oe],structureId:re,tournamentRecord:h,drawDefinition:T,event:b});me.error&&console.log(me.error)}});const K=[],Z=EU({inContextDrawMatchUps:B,drawDefinition:T,matchUpsMap:$}).goesToMap,{structure:Y}=kt({drawDefinition:t.drawDefinition,structureId:o}),{matchUps:X}=zi({structure:Y});return X.forEach(Q=>{var te,J;const ie=Z==null?void 0:Z.loserMatchUpIds[Q.matchUpId];if(ie&&Q.loserMatchUpId!==ie){Q.loserMatchUpId=ie;const ne={tournamentId:h==null?void 0:h.tournamentId,eventId:(te=t.event)==null?void 0:te.eventId,context:n,matchUp:Q};K.push(ne)}const oe=Z==null?void 0:Z.winnerMatchUpIds[Q.matchUpId];if(oe&&Q.winnerMatchUpId!==oe){Q.winnerMatchUpId=oe;const ne={tournamentId:h==null?void 0:h.tournamentId,eventId:(J=t.event)==null?void 0:J.eventId,context:n,matchUp:Q};K.push(ne)}}),{structures:O,matchUpModifications:K,links:F,drawDefinition:T,...le}}function Yde(t){return Vk({...t,itemType:"attachConsolationStructures"})}function m3(t){return Vk({...t,itemType:"attachPlayoffStructures"})}function Vk({itemType:t="attachStructures",matchUpModifications:e,tournamentRecord:i,drawDefinition:n,structures:r,links:o=[],event:a}){var s,l,c;const u="attachStructures";if(!n)return{error:rt};if(!Array.isArray(r)||!Array.isArray(o))return ce({result:{error:Re},stack:u});const d=b=>{var I;return[b.source.structureId,b.source.roundNumber||((I=b.source.finishingPositions)==null?void 0:I.join("|")),b.target.roundNumber].join("|")},p=(s=n.links)==null?void 0:s.map(d);if(o.some(b=>{const I=d(b);return p==null?void 0:p.includes(I)}))return ce({result:{error:wce},info:"playoff structure exists",stack:u});o.length&&((l=n.links)==null||l.push(...o));const h=r.map(({structureId:b})=>b),f=(c=n.structures)==null?void 0:c.map(({structureId:b})=>b);n.structures=(n.structures??[]).map(b=>h.includes(b.structureId)?r.find(({structureId:I})=>I===b.structureId):b);const m=r==null?void 0:r.filter(({structureId:b})=>!(f!=null&&f.includes(b)));m.length&&n.structures.push(...m),EU({drawDefinition:n});const g=r.map(b=>{var I;return((I=zi({structure:b}))==null?void 0:I.matchUps)||[]}).flat();rf({tournamentId:i==null?void 0:i.tournamentId,eventId:a==null?void 0:a.eventId,drawDefinition:n,matchUps:g});const v=r.map(({structureId:b})=>b);if(un({drawDefinition:n,structureIds:v}),e==null?void 0:e.length){const b={};e.forEach(T=>{var S;const w=(S=T.matchUp)==null?void 0:S.matchUpId;w&&(b[w]=T)});const I=T=>{T.matchUps.forEach(S=>{if(b[S.matchUpId]){const{tieMatchUps:w,...U}=b[S.matchUpId].matchUp;if(Object.assign(S,U),w==null?void 0:w.length){const D={};w.forEach(E=>b[E.matchUpId]=E),S.tieMatchUps.forEach(E=>Object.assign(E,D[E.matchUpId]))}b[S.matchUpId].matchUp=S,Ci(b[S.matchUpId])}})};n.structures.forEach(T=>{if(f!=null&&f.includes(T.structureId))if(T.structures)for(const S of T.structures)I(S);else I(T)})}const y=m.map(Ts("structureId"));return i&&xf({element:i,timeItem:{itemValue:{structureIds:v,drawId:n.drawId},itemType:t}}),{...le,addedStructureIds:y}}function jk(t){var e,i;const{structures:n,links:r,matchUpModifications:o,error:a}=f3(t);if(a)return{error:a};const s=t.drawDefinition;return m3({tournamentId:(e=t.tournamentRecord)==null?void 0:e.tournamentId,eventId:((i=t.event)==null?void 0:i.eventId)||t.eventId,matchUpModifications:o,drawDefinition:s,structures:n,links:r})}function vm(t){const e=Ln(t,[{_anyOf:{[Oo]:!1,[qp]:!1,[Yy]:!1,[VP]:!1},[cW]:!0}]);if(e.error)return e;const i=[],n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n){const r=dY(t,n);if(r.error)return r;i.push(...(r==null?void 0:r.applied)??[]),t.drawDefinition&&un({drawDefinition:t.drawDefinition,tournamentId:t.tournamentId})}else{if(!t.tournamentRecords)return{error:je};{const r=Object.keys(t.tournamentRecords);if(!r.length)return{error:je};for(const o of r){const a=dY(t,t.tournamentRecords[o]);if(a.error)return a;i.push(...(a==null?void 0:a.applied)??[])}}}return i.length?{...le,applied:i}:{error:oce}}function dY(t,e){const i=Gi(t).appliedPolicies??{};e.extensions||(e.extensions=[]);const n=[],r=Object.keys(t.policyDefinitions);if(!r.length)return{error:Kz};for(const o of r)if(!i[o]||t.allowReplacement){const a=t.policyDefinitions[o];if(!a)continue;if(!bn(a))return{error:Re};const{policyName:s,...l}=a;if(!l||!Object.keys(l).length||s&&!La(s))return{error:Re};i[o]=t.policyDefinitions[o],n.push(o)}return n!=null&&n.length?{...Ii({element:e,extension:{name:fU,value:i}}),applied:n}:{applied:n,error:oce}}function g3({tournamentRecord:t,drawDefinition:e,flightProfile:i,drawName:n,drawId:r,event:o}){var a;if(!n||typeof n!="string")return ce({result:{error:Re},context:{drawName:n}});i||(i=Zn({event:o}).flightProfile);const s=(a=i==null?void 0:i.flights)==null?void 0:a.find(l=>l.drawId===r);return s&&(s.drawName=n,kf({event:o,extension:{name:ql,value:{...i,flights:i.flights}}})),e&&(e.drawName=n,un({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),s||e?{...le,flight:s}:{error:rt}}function Kde({tournamentRecord:t,drawDefinition:e,drawUpdates:i,drawId:n,event:r}){var o;if(!bn(i))return{error:Re};const a=Zn({event:r}).flightProfile,s=i.drawName&&g3({drawName:i.drawName,tournamentRecord:t,drawDefinition:e,flightProfile:a,drawId:n,event:r});if(s!=null&&s.error)return s==null?void 0:s.error;const l=(s==null?void 0:s.flight)||((o=a==null?void 0:a.flights)==null?void 0:o.find(c=>c.drawId===n));return!l&&!e?{error:rt}:(l&&kf({event:r,extension:{name:ql,value:{...a,flights:a.flights}}}),e&&(i.policyDefinitions&&vm({policyDefinitions:i.policyDefinitions,drawDefinition:e}),un({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e})),{...le})}function Zde({tournamentRecord:t,removeScheduling:e,drawDefinition:i}){var n;if(!i)return{error:rt};const r=ma({drawDefinition:i}),o=a=>{var s;return(s=r==null?void 0:r.drawMatchUps)==null?void 0:s.find(l=>l.matchUpId===a)};for(const a of i.structures||[]){const{positionAssignments:s,stage:l,stageSequence:c}=a;!s||c===1&&[St,ct].includes(l)||(a.positionAssignments=s.map(d=>(delete d.participantId,d)),a.seedAssignments=[]);const{matchUps:u}=zi({afterRecoveryTimes:!1,inContext:!0,matchUpsMap:r,structure:a});for(const d of u){const{matchUpId:p,roundNumber:h,sides:f}=d,m=o(p);if(m){if(delete m.extensions,delete m.notes,m.matchUpStatus!==Ri&&Object.assign(m,Lk),h&&h>1&&m.drawPositions){const g=f==null?void 0:f.map(({drawPosition:y,participantFed:b})=>!b&&y).filter(Boolean),v=m.drawPositions.map(y=>g.includes(y)?void 0:y);m.drawPositions=v}e?delete m.timeItems:(n=m.timeItems)!=null&&n.length&&(m.timeItems=m.timeItems.filter(g=>g.itemType&&![sf,iy,ZP,jke,XP,JP].includes(g.itemType))),Ci({tournamentId:t==null?void 0:t.tournamentId,context:"resetDrawDefiniton",drawDefinition:i,matchUp:m})}}}return un({drawDefinition:i,structureIds:(i.structures||[]).map(({structureId:a})=>a)}),{...le}}function bC({tournamentRecord:t}){var e;if(!t)return{error:je};const i={positionsNoOutcomes:[],canBePruned:[],matchPlay:[],inactive:[],drawAnalysis:{}},n={};return((e=t.events)==null?void 0:e.map(r=>{const o=r.eventId;return n[o]=r,((r==null?void 0:r.drawDefinitions)||[]).map(a=>({drawDefinition:a,eventId:o}))}).flat().filter(Boolean)).forEach(({drawDefinition:r,eventId:o})=>{let a=0,s=0,l=0;const{allStructuresLinked:c}=Ok({drawDefinition:r}),u=n[o],d=((r==null?void 0:r.structures)||[]).map(I=>{const{stage:T,stageSequence:S,structureId:w}=I,U=Qv[T],{inContextStructureMatchUps:D}=oC({drawDefinition:r,structure:I,event:u}),E=D==null?void 0:D.filter(({winningSide:H})=>H),C=E.filter(Boolean).length||0;s+=C,l+=D.length-s;const M=Math.max(E.filter(({roundNumber:H})=>H===1).map(({roundPosition:H})=>H)),{positionAssignments:N}=Ki({structure:I}),R=N==null?void 0:N.filter(({participantId:H})=>H);a+=(R==null?void 0:R.length)??0;const A=((N==null?void 0:N.length)??0)-((R==null?void 0:R.length)??0),{roundMatchUps:_,roundProfile:k,roundNumbers:O,maxMatchUpsCount:F}=ba({matchUps:D}),B=k&&Object.keys(k).filter(H=>!k[H].inactiveRound).map(H=>parseInt(H)),$=k&&Object.keys(k).filter(H=>k[H].inactiveRound).map(H=>parseInt(H)),V=k&&Object.values(k).every(H=>H.inactiveRound);return{positionsAssignedCount:(R==null?void 0:R.length)??0,maxWinningSideFirstRoundPosition:M,unassignedPositionsCount:A,inactiveStructure:V,maxMatchUpsCount:F,inactiveRounds:$,roundMatchUps:_,activeRounds:B,roundNumbers:O,roundProfile:k,structureId:w,stageSequence:S,orderNumber:U,stage:T}}),p=d.find(I=>I.orderNumber===2&&I.stageSequence===1),h=d.filter(({inactiveStructure:I})=>!I).length,{links:f}=j0({structureId:p.structureId,drawDefinition:r}),m=Ct(p.activeRounds[0])===1&&p.activeRounds.length===1&&h===1,g=d==null?void 0:d.every(({inactiveStructure:I})=>I),v=!f.length&&p.activeRounds.length&&(p.roundProfile[1].inactiveCount||p.inactiveRounds.length),y=r.drawId;a&&!s&&i.positionsNoOutcomes.push(y),g&&i.inactive.push(y),m&&i.matchPlay.push(y),v&&i.canBePruned.push(y);const b={matchUpsWithWinningSideCount:s,matchUpsNoOutcomeCount:l,positionsAssignedCount:a,allStructuresLinked:c,structuresData:d,inactiveDraw:g,isMatchPlay:m,drawId:y};i.drawAnalysis[y]=b}),{...le,drawsAnalysis:i}}function Xde({matchPlayDrawPositions:t=!0,tournamentRecord:e,drawDefinition:i,drawId:n}){var r;if(!e)return{error:je};if(!i)return{error:rt};let o=[];const{drawsAnalysis:a}=bC({tournamentRecord:e});if(a.canBePruned.includes(n)){const s=a.matchPlay.includes(n),l=a.drawAnalysis[n],{structures:[c]}=Nd({stageSequence:1,drawDefinition:i,stage:ct}),u=l.structuresData.find(({structureId:f})=>c.structureId===f),d=(c.matchUps??[]).sort((f,m)=>f.roundPosition-m.roundPosition);o=d.filter(({roundNumber:f})=>!u.inactiveRounds.includes(f));const p=o.map($r),h=d.map($r).filter(f=>!p.includes(f));if(s){const f=o.filter(({roundNumber:b})=>!u.inactiveRounds.includes(b)).filter(({winningSide:b})=>b),m=f.map($r),g=p.filter(b=>!m.includes(b));h.push(...g);const v=f.flatMap(b=>b.drawPositions??[]).filter(Boolean).flat(),y=Object.assign({},...v.map((b,I)=>({[b]:I+1})));if(f.forEach(b=>{t?b.drawPositions=b.drawPositions.map(I=>y[I]):delete b.drawPositions}),t){const b=(r=c==null?void 0:c.positionAssignments)==null?void 0:r.filter(I=>v.includes(I.drawPosition)).map(I=>(I.drawPosition=y[I.drawPosition],I));c.positionAssignments=b}else c.positionAssignments=[];c.matchUps=f,o=f}Kp({tournamentId:e==null?void 0:e.tournamentId,matchUpIds:h,drawDefinition:i}),un({drawDefinition:i})}return{...le,matchUps:o}}function Jde({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,qualifier:o,event:a,bye:s}){if(!e)return{error:rt};if(!n)return{error:xP};if(!r)return{error:Va};if(s){const l=Ms({tournamentRecord:t,drawDefinition:e,drawPosition:n,structureId:r,event:a});if(l.error)return l}else{if(o)return{error:eW};{const l=lu({tournamentRecord:t,drawDefinition:e,participantId:i,drawPosition:n,structureId:r,event:a});if(l.error)return l}}return{...le}}function Qde(t){var e,i,n;const{tournamentRecord:r,matchUpIds:o=[],drawDefinition:a,event:s}=t;if(typeof a!="object")return{error:rt};if(!Array.isArray(o))return{error:Re};const l=t.structureId??((i=(e=a==null?void 0:a.structures)==null?void 0:e.find(g=>{var v;return(v=g.matchUps)==null?void 0:v.some(({matchUpId:y})=>o.includes(y))}))==null?void 0:i.structureId);if(!l)return{error:Cn};const c=(n=a.structures)==null?void 0:n.find(g=>g.structureId===l);if(!c)return{error:Cn};const u=c==null?void 0:c.matchUps,d=u==null?void 0:u.find(g=>!!g.roundPosition);if(c.structures||d||c.finishingPosition===Ky)return{error:_P};const p=[],h=(u==null?void 0:u.filter(({matchUpId:g,score:v})=>(lo({score:v})&&p.push(g),o.includes(g))))??[],f=h.map($r),m=h.map(({tieMatchUps:g})=>g==null?void 0:g.map($r)).filter(Boolean).flat();if(f.length){c.matchUps=(c.matchUps??[]).filter(({matchUpId:v})=>!f.includes(v)),Kp({tournamentId:r==null?void 0:r.tournamentId,matchUpIds:[...m,...f],action:"deleteAdHocMatchUps",eventId:s==null?void 0:s.eventId,drawDefinition:a});const g=function(v,y=1){return Array.isArray(v)&&v.every($t)?nt(Math.min(...v,y),Math.max(...v)+1).filter(b=>!v.includes(b)):[]}(ti(c.matchUps.map(Ts("roundNumber"))));if(g.length){g.reverse();for(const v of g)c.matchUps.forEach(y=>{y.roundNumber&&y.roundNumber>v&&(y.roundNumber-=1,Ci({tournamentId:r==null?void 0:r.tournamentId,context:["adHoc round deletion"],eventId:s==null?void 0:s.eventId,drawDefinition:a,matchUp:y}))})}if(p.length){c.positionAssignments=ti(c.matchUps.flatMap(b=>(b.sides??[]).map(I=>I.participantId)).filter(Boolean)).map(b=>({participantId:b}));const v=(c==null?void 0:c.matchUpFormat)??(a==null?void 0:a.matchUpFormat)??(s==null?void 0:s.matchUpFormat),y=u3({positionAssignments:c.positionAssignments,matchUps:c.matchUps,tournamentRecord:r,drawDefinition:a,matchUpFormat:v,event:s});y.error&&console.log(y)}un({structureIds:[l],eventId:s==null?void 0:s.eventId,drawDefinition:a})}return{...le}}function epe({removeCompletedMatchUps:t,tournamentRecord:e,drawDefinition:i,structureId:n,roundNumber:r,event:o}){if(!e)return{error:je};if(!i)return{error:rt};if(!r)return ce({result:{error:bt},info:"roundNumber required"});const a=kt({drawDefinition:i,structureId:n});if(a.error)return a;const s=a.structure;return s!=null&&s.structures?{error:_P}:Zl({drawDefinition:i,structure:s})?function({removeCompletedMatchUps:l,drawDefinition:c,tournamentId:u,roundNumber:d,structure:p,eventId:h}){const f=(p==null?void 0:p.matchUps)??[],m=[],g=[];let v=!1;if(f.reduce((y,b)=>{const I=b==null?void 0:b.roundNumber;return I?y.includes(I)?y:y.concat(I):y},[]).sort(Sr).includes(d)){const y=f.filter(b=>{const I=b.roundNumber===d&&(!no.includes(b.matchUpStatus)||l);return I&&(g.push(b.matchUpId),b.tieMatchUps&&m.push(...b.tieMatchUps.map($r))),!I});g.length&&(Kp({matchUpIds:[...m,...g],drawDefinition:c,tournamentId:u,eventId:h}),y.some(b=>b.roundNumber===d)||(y.forEach(b=>{b.roundNumber>d&&(b.roundNumber-=1,Ci({drawDefinition:c,tournamentId:u,eventId:h,matchUp:b}))}),v=!0),p.matchUps=y)}return{deletedMatchUpsCount:g.length,roundRemoved:v,...le}}({tournamentId:e.tournamentId,removeCompletedMatchUps:t,eventId:o.eventId,drawDefinition:i,roundNumber:r,structure:s}):(console.log("not implemented"),{...le})}function LR(t){var e,i,n,r,o,a;const{suppressNotifications:s,tournamentRecord:l,drawDefinition:c,matchUps:u,event:d}=t;if(typeof c!="object")return{error:rt};let p=t==null?void 0:t.structureId;if(p||((e=c.structures)==null?void 0:e.length)!==1||(p=(n=(i=c.structures)==null?void 0:i[0])==null?void 0:n.structureId),typeof p!="string")return{error:Va};if(!vl(u))return{error:Re,info:_d("matchUps")};const h=(r=c.structures)==null?void 0:r.find(v=>v.structureId===p);if(!h)return{error:Cn};const f=h==null?void 0:h.matchUps,m=f.find(v=>!!v.roundPosition);if(h.structures||m||h.finishingPosition===Ky)return{error:_P};if(ua(((a=(o=Vr({tournamentRecord:l,inContext:!1}))==null?void 0:o.matchUps)==null?void 0:a.map($r))??[],u.map($r)))return{error:X_e,info:"One or more matchUpIds already present in tournamentRecord"};h.matchUps.push(...u);const g=u.map(({tieMatchUps:v})=>v).filter(Boolean).flat();return s||(rf({tournamentId:l==null?void 0:l.tournamentId,matchUps:[...g,...u],eventId:d==null?void 0:d.eventId,drawDefinition:c}),un({drawDefinition:c,structureIds:[p]})),{...le}}function tpe({tournamentRecord:t,drawDefinition:e,drawPosition:i,structureId:n,subOrder:r,event:o}){var a;if(!e)return{error:rt};if(!n)return{error:Va};if(!i)return{error:xP};const{structure:s}=kt({drawDefinition:e,structureId:n});if(!s)return{error:Cn};let l=s;s.structures&&s.structureType===na&&(l=(a=s.structures)==null?void 0:a.find(h=>{var f;return(f=h.positionAssignments)==null?void 0:f.find(m=>m.drawPosition===i)}));const c=l==null?void 0:l.positionAssignments,u=c==null?void 0:c.find(h=>h.drawPosition===i);u&&Ii({element:u,extension:{name:II,value:r}});const d=((o==null?void 0:o.eventType)===gn||e.matchUpType===gn||((o==null?void 0:o.tieFormat)??(e==null?void 0:e.tieFormat)??(s==null?void 0:s.tieFormat)))&&{matchUpTypes:[gn]},{matchUps:p}=zi({structure:l,afterRecoveryTimes:!1,inContext:!0,matchUpFilters:d,event:o});return u3({positionAssignments:c,tournamentRecord:t,drawDefinition:e,matchUpFormat:(s==null?void 0:s.matchUpFormat)??e.matchUpFormat,matchUps:p,event:o}),un({drawDefinition:e,structureIds:[n]}),{...le}}function ipe({scaleAttributes:t,scaledEntries:e,stageEntries:i,seedsCount:n,scaleName:r}){if(!t)return{error:bt,info:"missing scaleAttributes"};const o=Object.assign({},...(e||[]).slice(0,n).map(({participantId:s},l)=>({[s]:l+1})));r=r||t.scaleName;const a=new Date().toISOString();return{scaleItemsWithParticipantIds:i.map(({participantId:s})=>({scaleItems:[{scaleValue:o[s],eventType:t.eventType,scaleType:ap,scaleName:r,scaleDate:a}],participantId:s}))}}function npe({participantsCount:t,participantCount:e}){if(!(t=t??e))return{error:Re};const i=R0(t);return i?{drawSize:i}:ce({result:{error:Re},stack:"getEliminationDrawSize",context:{participantsCount:t}})}function IC(t){let{drawSizeProgression:e=!1,policyDefinitions:i,drawSize:n}=t||{};const{requireParticipantCount:r=!0,tournamentRecord:o,drawDefinition:a,event:s}=t||{},l="getSeedsCount",c=(t==null?void 0:t.participantsCount)??(t==null?void 0:t.participantCount);if(!i){const f=Zp({tournamentRecord:o,drawDefinition:a,event:s});if(f.error)return ce({result:f,stack:l});i=f.policyDefinitions}const u=$t(c);if(c&&!u)return ce({result:{error:Re},context:{participantsCount:c},stack:l});if(r&&!u)return ce({result:{error:P_e},stack:l});if(isNaN(n)){if(!c)return ce({result:{error:Y_},stack:l});({drawSize:n}=npe({participantsCount:c}))}const d=r&&c||n;if(d&&d>n)return{error:uce};const p=i==null?void 0:i[mc];if(!p)return{error:m_e};const h=p.seedsCountThresholds;return h?(p.drawSizeProgression!==void 0&&(e=p.drawSizeProgression),{seedsCount:h.filter(f=>e?f.drawSize<=n:n===f.drawSize).reduce((f,m)=>c&&c>=m.minimumParticipantCount?m.seedsCount:f,0)}):{error:e_e}}function Hk({policyDefinitions:t,drawDefinition:e,drawSize:i,drawId:n,event:r,stage:o}){if(!r)return{error:Fi};const{entries:a,stageEntries:s}=Jue({drawDefinition:e,drawId:n,stage:o,event:r}),l=s.length,{drawSize:c}=npe({participantsCount:l}),u=IC({drawSize:i??c,participantsCount:l,policyDefinitions:t});if(u.error)return ce({result:u,stack:"getEntriesAndSeedsCount"});const{seedsCount:d}=u;return{entries:a,seedsCount:d,stageEntries:s}}function yw(t){const{tournamentRecord:e,scaleAttributes:i,participantId:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!n)return{error:Hr};const{participant:o,tournamentId:a}=Dg({tournamentRecords:r,tournamentRecord:e,participantId:n});return o?{...ud({participant:o,scaleAttributes:i}),tournamentId:a}:{error:rr}}function ry({sortDescending:t=!1,tournamentRecord:e,scaleAttributes:i,scaleSortMethod:n,stageSequence:r,entries:o,event:a,stage:s}){if(!e)return{error:je};return{scaledEntries:(o=o??(a==null?void 0:a.entries)??[]).filter(c=>(!s||!c.entryStage||c.entryStage===s)&&(!r||!c.entryStageSequence||c.entryStageSequence===r)&&Zc.includes(c.entryStatus)).map(c=>{const{participantId:u}=c,{scaleItem:d}=yw({tournamentRecord:e,scaleAttributes:i,participantId:u});return{...c,...d}}).filter(c=>{const u=c.scaleValue;return!!(n||!isNaN(u)&&parseFloat(u))&&u}).sort(n||function(c,u){return t?l(u)-l(c):l(c)-l(u)})};function l(c){return parseFloat(c.scaleValue||(t?-1:1e5))}}function rpe({tournamentRecord:t,drawDefinition:e,policyDefinitions:i,scaleAttributes:n,scaleName:r,drawSize:o,drawId:a,event:s,stage:l,sortDescending:c,scaleSortMethod:u}){const d=Hk({policyDefinitions:i,drawDefinition:e,drawSize:o,drawId:a,event:s,stage:l});if(d.error)return d;const{entries:p,seedsCount:h,stageEntries:f}=d;if(!f||!h)return{error:Re};const m=ry({tournamentRecord:t,scaleAttributes:n,scaleSortMethod:u,sortDescending:c,entries:p,stage:l}).scaledEntries??[],{scaleItemsWithParticipantIds:g}=ipe({scaleAttributes:n,scaledEntries:m,stageEntries:f,seedsCount:h,scaleName:r});return{scaleItemsWithParticipantIds:g}}var Fxe=Object.freeze({__proto__:null,addAdHocMatchUps:LR,addDrawDefinitionTimeItem:r3,addPlayoffStructures:jk,addQualifyingStructure:Dde,addVoluntaryConsolationStage:Tde,addVoluntaryConsolationStructure:qW,alternateDrawPositionAssignment:cde,assignDrawPosition:Jde,assignDrawPositionBye:Ms,attachConsolationStructures:Yde,attachPlayoffStructures:m3,attachQualifyingStructure:n3,attachStructures:Vk,autoSeeding:rpe,automatedPlayoffPositioning:dC,automatedPositioning:uC,deleteAdHocMatchUps:Qde,luckyLoserDrawPositionAssignment:lde,modifyDrawDefinition:Kde,modifyDrawName:g3,modifySeedAssignment:hde,pruneDrawDefinition:Xde,qualifierDrawPositionAssignment:dde,removeDrawPositionAssignment:MU,removeRoundMatchUps:epe,removeSeededParticipant:Ude,removeStructure:wde,renameStructures:Ide,resetDrawDefinition:Zde,resetVoluntaryConsolationStructure:wue,setDrawParticipantRepresentativeIds:Zce,setPositionAssignments:ude,setStructureOrder:yde,setSubOrder:tpe,swapDrawPositionAssignments:pde,updateTeamLineUp:cb,withdrawParticipantAtDrawPosition:tde});function v3({excludedMatchUpStatuses:t=[],includeEventParticipants:e,includeQualifyingStage:i,finishingRoundLimit:n,policyDefinitions:r,roundNumberLimit:o,tournamentRecord:a,drawDefinition:s,matchUpsLimit:l,requirePlay:c,requireLoss:u,allEntries:d,winsLimit:p,event:h}){var f,m,g,v,y;if(!s)return{error:rt};const b=[ct,Vn];i&&b.push(St);const I=h!=null&&h.eventType?{matchUpTypes:[h.eventType]}:void 0,T=s!=null&&s.matchUpType?{matchUpTypes:[s.matchUpType]}:void 0,S=e&&h?((f=Qp({contextFilters:{stages:b},matchUpFilters:I,tournamentRecord:a,inContext:!0,event:h}))==null?void 0:f.matchUps)??[]:((m=Fa({contextFilters:{stages:b},matchUpFilters:T,tournamentRecord:a,inContext:!0,drawDefinition:s}))==null?void 0:m.matchUps)??[],w=Qy({stage:qr,drawDefinition:s}).map(({participantId:_})=>_),U={},D={},E={},C={};r||(r=Zp({policyTypes:[A7],tournamentRecord:a,drawDefinition:s,event:h}).policyDefinitions);const M=r==null?void 0:r[A7];t=t.length&&t||(M==null?void 0:M.excludedMatchUpStatuses)||[],e=e??(M==null?void 0:M.includeEventParticipants),d=d??(M==null?void 0:M.allEntries),n=n??(M==null?void 0:M.finishingRoundLimit),o=o??(M==null?void 0:M.roundNumberLimit),l=l??(M==null?void 0:M.matchUpsLimit),c===void 0&&(c=(M==null?void 0:M.requirePlay)===void 0||M.requirePlay),u===void 0&&(u=(M==null?void 0:M.requireLoss)===void 0||M.requireLoss),p=p??(M==null?void 0:M.winsLimit);for(const _ of S){if(c&&_.winningSide&&![1,2].includes(_.winningSide)&&_.matchUpStatus!==gr||_.finishingRound&&n&&_.finishingRound>=n||_.finishingRound&&o&&_.finishingRound<=o)continue;const k=(g=_.sides)==null?void 0:g.find(({sideNumber:F})=>_.winningSide&&F===3-_.winningSide),O=(v=_.sides)==null?void 0:v.find(({sideNumber:F})=>_.winningSide&&F===_.winningSide);if((y=_.sides)==null||y.forEach(F=>{var B;const $=(B=F==null?void 0:F.participant)==null?void 0:B.participantId;$&&(E[$]=F.participant,_.matchUpStatus!==gr||c||(D[$]=F.participant,U[$]||(U[$]=0),_.matchUpStatus&&t.includes(_.matchUpStatus)||(U[$]+=1)))}),k==null?void 0:k.participant){const F=k.participant.participantId;D[F]=k.participant,U[F]||(U[F]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(U[F]+=1)}if(O!=null&&O.participant){const F=O.participant.participantId;C[F]||(C[F]=0),C[F]+=1,U[F]||(U[F]=0),_.matchUpStatus&&!t.includes(_.matchUpStatus)&&(U[F]+=1)}}const N=(a==null?void 0:a.participants)&&!c&&!u&&d,R=N?((e&&h?h.entries:s.entries)??[]).filter(_=>![af,Fc].includes(_.entryStatus)).map(({participantId:_})=>_):[],A=Object.keys(D);return{eligibleParticipants:(N?((a==null?void 0:a.participants)??[]).filter(({participantId:_})=>R.includes(_)):u&&Object.values(D)||Object.values(E)).filter(_=>{return k=_.participantId,(!u||A.includes(k))&&(O=>!c||(U[O]||0)>=0)(_.participantId)&&(O=>!p||(C[O]||0)<=p)(_.participantId)&&(O=>!l||U[O]<=l)(_.participantId)&&(O=>!w.includes(O))(_.participantId);var k}).map(_=>{var k;return{..._,individualParticipants:(k=_.individualParticipantIds)==null?void 0:k.map(O=>{var F;return(F=a==null?void 0:a.participants)==null?void 0:F.find(B=>B.participantId===O)})}}),losingParticipantIds:A,...le}}function y3({drawDefinition:t}){var e;const i=ei({name:"participantRepresentatives",element:t});return i.error?i:{representativeParticipantIds:((e=i.extension)==null?void 0:e.value)||[]}}function b3({byeAdvancements:t=!1,tournamentRecord:e,drawDefinition:i}){if(!i)return{error:rt};const{participantIds:n,participantIdMatchUps:r}=function({tournamentParticipants:a,drawDefinition:s,event:l}){if(!s)return{error:rt};const c=ft(Ar({tournamentParticipants:a,inContext:!0,drawDefinition:s,event:l}).matchUps,!1,!0),u=ti(c.reduce((p,h)=>p.concat(...h.sides.map(f=>f.participantId).filter(Boolean)),[])),d=Object.assign({},...u.map(p=>{const h=c.filter(f=>f.sides.map(m=>m.participantId).filter(Boolean).includes(p));return{[p]:h}}));return{participantIds:u,participantIdMatchUps:d}}({tournamentParticipants:e==null?void 0:e.participants,drawDefinition:i}),o=(n==null?void 0:n.map(a=>{const s=r[a].filter(d=>[fr,Ri].includes(d.matchUpStatus)||d.winningSide),l=s.map(d=>{const p=d.sides.find(f=>f.bye),h=d.sides.find(f=>f.participantId===a).sideNumber;return(d.winningSide||t&&p&&h)===h?d.finishingPositionRange.winner:d.finishingPositionRange.loser}),c=d=>Math.abs(d[0]-d[1]),u=l.reduce((d,p)=>d&&c(d)<c(p)?d:p,void 0);return{[a]:{relevantMatchUps:s,finishingPositionRanges:l,finishingPositionRange:u}}}))||[];return Object.assign({},...o)}function cf({tournamentRecords:t,tournamentRecord:e,tournamentId:i,drawId:n}){if(!e&&!t)return{error:je};if(!n)return{error:Yc};if(!e&&t){if(typeof i!="string"&&!(i=Wde({tournamentRecords:t,drawId:n})))return{error:sU};if(!(e=t[i]))return{error:je}}const r=e&&us({tournamentRecord:e,drawId:n});return r!=null&&r.drawDefinition?{drawDefinition:r.drawDefinition,event:r.event,tournamentRecord:e,...le}:ce({result:{error:ml},stack:"findDrawDefinition"})}function I3(t){const{drawDefinition:e,error:i}=cf(t);return i?{error:i}:{drawDefinition:ft(e)}}function rL({targetRoundNumber:t,finishingPosition:e,drawDefinition:i,structureId:n,linkType:r}){const{links:o}=j0({drawDefinition:i,structureId:n})||{},a=((o==null?void 0:o.target)||[]).filter(({linkType:s})=>s===r).filter(({target:s})=>!t||t===s.roundNumber).map(s=>{const l=s.source.structureId,{structure:c}=kt({structureId:l,drawDefinition:i});if(!e||(c==null?void 0:c.finishingPosition)===e)return s}).filter(Boolean);return{sourceStructureIds:a.map(({source:s})=>s.structureId),relevantLinks:a}}const Bxe="qualifierDrawPositionAssignment",$xe="alternateDrawPositionAssignment",Vxe="luckyLoserDrawPositionAssignment",pY="removeDrawPositionAssignment",jxe="swapDrawPositionAssignments",Hxe="modifyPairAssignment",hY="assignDrawPosition",Gxe="assignDrawPositionBye",ope="addPenalty",fY="MODIFY_PAIR",iB="QUALIFIER",mY="ALTERNATE",ape="WITHDRAW",dI="ASSIGN",gY="REMOVE",vY="LUCKY",VE="REMOVE_SEED",spe="SWAP",FR="NICKNAME",TI="SEED_VALUE",bw="PENALTY",oL="BYE";function lpe({restrictQualifyingAlternates:t,structure:e,entry:i}){const{stage:n}=e;if(!i.entryStage||i.entryStage===n||n===St&&!t||i.entryStage===ct&&n===So)return!0}function zxe(t,e){return t.bye||gw(t.seedValue)<gw(e.seedValue)||t.seedValue&&!e.seedValue?-1:(t.seedNumber||0)-(e.seedNumber||0)}function Wxe({onlyAssignedPositions:t=!0,possiblyDisablingAction:e,tournamentParticipants:i,inactiveDrawPositions:n,activeDrawPositions:r,positionAssignments:o,returnParticipants:a,byeDrawPositions:s,drawDefinition:l,isByePosition:c,drawPosition:u,structureId:d,structure:p,drawId:h,event:f}){if(r.includes(u))return{};const m=n==null?void 0:n.filter(D=>D!==u&&!(c&&s.includes(D))),g=(o==null?void 0:o.filter(D=>(E=>!t||E.participantId||E.qualifier||E.bye)(D)&&(m==null?void 0:m.includes(D.drawPosition))))??[],v=g.map(({drawPosition:D})=>D),{matchUps:y}=zi({afterRecoveryTimes:!1,inContext:!0,drawDefinition:l,structure:p,event:f}),b=y.filter(({drawPositions:D})=>ua(D,v)),I=Object.assign({},...b.map(D=>{var E;return(E=D.sides)==null?void 0:E.filter(({sourceDrawPositionRange:C})=>C).map(({drawPosition:C,sourceDrawPositionRange:M})=>({[C]:M}))}).flat()),T=g.map(D=>D.participantId).filter(Boolean),S=(i??[]).filter(D=>T.includes(D.participantId)),w=Object.assign({},...S.map(D=>({[D.participantId]:D}))),U=g.map(D=>{const E=w==null?void 0:w[D.participantId],C=I[D.drawPosition];return It({...D,participant:a?ft(E,!1,!0):void 0,sourceDrawPositionRange:C})});return U.length?{validSwapAction:{payload:{drawId:h,structureId:d,drawPositions:[u]},willDisableLinks:e,method:jxe,type:spe,availableAssignments:U}}:{}}function Km(t){var e,i;const{inContextDrawMatchUps:n,targetData:r,drawDefinition:o,relevantLink:a}=t;if((a==null?void 0:a.linkCondition)===Md&&((e=r==null?void 0:r.matchUp)==null?void 0:e.matchUpStatus)===Ri)return!1;const{targetMatchUps:{loserMatchUp:s,winnerMatchUp:l},targetLinks:c}=r,u=[Mi,Li].includes(s==null?void 0:s.matchUpStatus),d=((i=l==null?void 0:l.drawPositions)==null?void 0:i.filter(Boolean).length)||0;if(s!=null&&s.winningSide&&!u||l!=null&&l.winningSide&&d===2&&(!l.feedRound||![Li,Mi].includes(l==null?void 0:l.matchUpStatus)))return!0;const p=s&&pa({matchUpId:s.matchUpId,inContextDrawMatchUps:n,drawDefinition:o}),h=l&&pa({matchUpId:l.matchUpId,inContextDrawMatchUps:n,drawDefinition:o}),f=p&&Km({relevantLink:c==null?void 0:c.loserTargetLink,targetData:p,inContextDrawMatchUps:n,drawDefinition:o});return!(!(h&&Km({targetData:h,inContextDrawMatchUps:n,drawDefinition:o}))&&!f)}const cpe={[xh]:{policyName:"positionActionsDefault",enabledStructures:[{stages:[St,ct],stageSequences:[1],enabledActions:[],disabledActions:[]},{stages:[],stageSequences:[],enabledActions:[FR,bw,iB,TI],disabledActions:[]}],disbledStructures:[],otherFlightEntries:!1,activePositionOverrides:[]}},jE="positionAction",nB="matchUpAction";function upe({actionType:t=jE,appliedPolicies:e,drawDefinition:i,structure:n}){var r;const o=t===jE&&xh||t===nB&&so,a=t===jE&&cpe||t===nB&&ab,s=o&&((e==null?void 0:e[o])||(a==null?void 0:a[o])),l=(r=i.links)==null?void 0:r.filter(h=>{var f;return((f=h==null?void 0:h.target)==null?void 0:f.structureId)===(n==null?void 0:n.structureId)}),c=(l==null?void 0:l.map(({target:h})=>h.feedProfile))??[],{enabledStructures:u,disabledStructures:d}=s||{},p=d==null?void 0:d.find(h=>{const{stages:f,stageSequences:m,structureTypes:g,feedProfiles:v}=h;return(!(v!=null&&v.length)||Array.isArray(v)&&v.some(y=>c.includes(y)))&&(!(f!=null&&f.length)||Array.isArray(f)&&(f==null?void 0:f.includes(n==null?void 0:n.stage)))&&(!(g!=null&&g.length)||Array.isArray(g)&&(g==null?void 0:g.includes(n==null?void 0:n.structureType)))&&(!(m!=null&&m.length)||Array.isArray(m)&&m.includes(n==null?void 0:n.stageSequence))});return{enabledStructures:u,actionsDisabled:p,actionsPolicy:s}}function yY({activePositionOverrides:t,activeDrawPositions:e,action:i}){return!(!i||!t.includes(i))||!e.length}function dpe({enabledStructures:t,drawDefinition:e,structure:i}){var n;if(t===!1)return{};if(!(t!=null&&t.length))return{policyActions:{enabledActions:[],disabledActions:[]}};const{stage:r,stageSequence:o,structureType:a}=i||{},s=(n=e.links)==null?void 0:n.filter(c=>{var u;return((u=c==null?void 0:c.target)==null?void 0:u.structureId)===(i==null?void 0:i.structureId)}),l=(s==null?void 0:s.map(({target:c})=>c.feedProfile))||[];return{policyActions:t.find(c=>{const{stages:u,stageSequences:d,structureTypes:p,feedProfiles:h}=c||{},f=!(u!=null&&u.length)||Array.isArray(u)&&u.includes(r),m=!(d!=null&&d.length)||Array.isArray(d)&&d.includes(o),g=!(p!=null&&p.length)||Array.isArray(p)&&p.includes(a),v=!(h!=null&&h.length)||Array.isArray(h)&&h.some(y=>l.includes(y));return m&&g&&v&&c&&f})}}function ka({action:t,policyActions:e}){var i;const n=!(e!=null&&e.enabledActions)||((i=e==null?void 0:e.disabledActions)==null?void 0:i.length)&&e.disabledActions.includes(t);return n?!1:((e==null?void 0:e.enabledActions.length)===0||(e==null?void 0:e.enabledActions.includes(t)))&&!n}const qxe="replaceTieMatchUpParticipantId",Yxe="assignTieMatchUpParticipantId",bY="removeTieMatchUpParticipantId",IY="assignMatchUpSideParticipant",Kxe="removeMatchUpSideParticipant",Zxe="substituteParticipant",wY="REMOVE_SUBSTITUTION",Xxe="REPLACE_PARTICIPANT",ppe="REMOVE_PARTICIPANT",SY="setMatchUpStatus",TY="SUBSTITUTION",Jxe="SCHEDULE",UY="REFEREE",Qxe="STATUS",DY="START",eOe="SCORE",PY="END";function tOe({restrictAdHocRoundParticipants:t,tournamentParticipants:e,matchUpParticipantIds:i,otherFlightEntries:n,drawDefinition:r,structureId:o,sideNumber:a,matchUpId:s,structure:l,matchUp:c,drawId:u,event:d}){var p,h,f;const m=[],g=((l==null?void 0:l.matchUps)??[]).filter(({roundNumber:U})=>U===c.roundNumber),v=((p=r==null?void 0:r.entries)==null?void 0:p.filter(({entryStatus:U})=>U&&Jy.includes(U)).map(li))??[],y=g.map(U=>(U.sides??[]).flatMap(li)).flat().filter(Boolean),b=v.filter(U=>!(i.includes(U)||t&&y.includes(U))),I=e==null?void 0:e.filter(U=>b==null?void 0:b.includes(U.participantId)).map(U=>ft(U,void 0,!0));I==null||I.forEach(U=>{const D=(r.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=D==null?void 0:D.entryPosition}),b.length&&m.push({payload:{drawId:u,matchUpId:s,structureId:o,sideNumber:a},method:IY,type:dI,availableParticipantIds:b,participantsAvailable:I});const T=function({eventEntries:U,structure:D}){return U.filter(E=>E.entryStatus===Nc&&lpe({structure:D,entry:E})).sort((E,C)=>(E.entryPosition||1/0)-(C.entryPosition||1/0)).map(li)}({eventEntries:(d==null?void 0:d.entries)??[],structure:l});let S=ti(v.concat(T));if(n){const U=d?Zn({event:d}):void 0,D=(h=U==null?void 0:U.flights)==null?void 0:h.filter(E=>E.drawId!==u).flatMap(E=>E.drawEntries.filter(C=>C.participantId&&![af,Fc,ty].includes(C.entryStatus)).map(({participantId:C})=>C)).filter(Boolean);D!=null&&D.length&&S.push(...D)}S=S.filter(U=>!(i.includes(U)||b.includes(U)||t&&y.includes(U)));const w=e==null?void 0:e.filter(U=>S.includes(U.participantId)).map(U=>ft(U,void 0,!0));if(w==null||w.forEach(U=>{const D=(r.entries??[]).find(E=>E.participantId===U.participantId);U.entryPosition=D==null?void 0:D.entryPosition}),w==null||w.sort((U,D)=>(U.entryPosition||1/0)-(D.entryPosition||1/0)),S.length&&m.push({payload:{drawId:u,matchUpId:s,structureId:o,sideNumber:a},availableParticipantIds:S,participantsAvailable:w,method:IY,type:Nc}),!lo(c)&&a){const U=(f=c.sides)==null?void 0:f.find(D=>D.sideNumber===a);U!=null&&U.participantId&&m.push({payload:{drawId:u,matchUpId:s,structureId:o,sideNumber:a},method:Kxe,type:ppe})}return m}function Gk(t){var e,i,n,r,o,a,s,l,c;if(!t)return{error:Re};let u,d;const{restrictAdHocRoundParticipants:p=!0,policyDefinitions:h,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v}=t,y=t.tournamentRecord??(t.tournamentId&&La(t.tournamentId)&&((e=t.tournamentRecords)==null?void 0:e[t.tournamentId]));if(!y)return{error:je};if(!v||!La(v))return{error:co};if(g&&![1,2].includes(g))return ce({result:{error:Re},context:{sideNumber:g}});if(!u){const re=(Vr({tournamentRecord:y}).matchUps??[]).find(me=>me.matchUpId===v);d=((y==null?void 0:y.events)??[]).find(me=>me.eventId===(re==null?void 0:re.eventId)),u=((d==null?void 0:d.drawDefinitions)??[]).find(me=>me.drawId===(re==null?void 0:re.drawId))}if(!u)return{error:rt};const b=Qn({tournamentRecord:y,withIndividualParticipants:!0}).participants,{drawId:I}=u,{matchUp:T,structure:S}=vn({drawDefinition:u,matchUpId:v,event:d});if(!T)return{error:xo};const w=Gi({tournamentRecord:y,drawDefinition:u,structure:S,event:d}).appliedPolicies??{};Object.assign(w,h??{});const U=(i=w==null?void 0:w[xh])==null?void 0:i.otherFlightEntries,D=(w==null?void 0:w[so])??ab[so],{enabledStructures:E}=upe({actionType:nB,appliedPolicies:w,drawDefinition:u,structure:S}),{policyActions:C}=dpe({enabledStructures:E,drawDefinition:u,structure:S}),M=t.matchUpsMap??ma({drawDefinition:u}),N=t.inContextDrawMatchUps??Ar({tournamentParticipants:b,inContext:!0,drawDefinition:u,matchUpsMap:M,event:d}).matchUps,R=N==null?void 0:N.find(re=>re.matchUpId===v),A=g&&((n=R==null?void 0:R.sides)==null?void 0:n.find(re=>re.sideNumber===g)),_=((r=R==null?void 0:R.sides)==null?void 0:r.map(re=>{var me;return re.participantId||((me=re.participant)==null?void 0:me.participantid)}).filter(Boolean))??[],{assignedPositions:k,allPositionsAssigned:O}=Lr({structure:S}),{structureId:F}=S??{},B=[];if(!F)return{validActions:B};const $=Zl({drawDefinition:u,structure:S}),V=T.collectionId;if($&&!V){const re=tOe({restrictAdHocRoundParticipants:p,tournamentParticipants:b,matchUpParticipantIds:_,otherFlightEntries:U,drawDefinition:u,structureId:F,sideNumber:g,matchUpId:v,structure:S,matchUp:T,drawId:I,event:d});B.push(...re)}const H=Bh({drawDefinition:u,structure:S}),z=k==null?void 0:k.filter(re=>re.participantId).map(re=>re.drawPosition),G=k==null?void 0:k.filter(re=>re.bye).map(re=>re.drawPosition),W=T.matchUpStatus===Ri||!V&&((o=T.drawPositions)==null?void 0:o.reduce((re,me)=>(G==null?void 0:G.includes(me))||re,!1));if(W)return{validActions:B,isByeMatchUp:W};ka({policyActions:C,action:UY})&&B.push({type:UY,payload:{matchUpId:v}});const K=!YP({matchUpStatus:T.matchUpStatus}),Z=(a=w==null?void 0:w.scoring)==null?void 0:a.structures,Y=(S==null?void 0:S.stage)&&(Z==null?void 0:Z.stage)&&(Z==null?void 0:Z.stage[S.stage]),X=(S==null?void 0:S.stageSequence)&&(Y==null?void 0:Y.stageSequence)&&Y.stageSequence[S.stageSequence],Q=!((s=w==null?void 0:w.scoring)!=null&&s.requireAllPositionsAssigned||Y!=null&&Y.requireAllPositionsAssigned||X!=null&&X.requireAllPositionsAssigned)||O,te=T.sides&&T.sides.filter(re=>re==null?void 0:re.participantId).length===2,J=T.matchUpStatus&&[gr,Mr].includes(T.matchUpStatus),ie=Km({inContextDrawMatchUps:N,drawDefinition:u,targetData:pa({inContextDrawMatchUps:N,drawDefinition:u,matchUpId:v})}),oe=(((l=R==null?void 0:R.drawPositions)==null?void 0:l.length)===2&&R.drawPositions.every(re=>z==null?void 0:z.includes(re))&&((c=R==null?void 0:R.sides)==null?void 0:c.length)===2&&R.sides.every(({participantId:re})=>re)||te)&&!(J&&ie),ne={method:ope,type:bw,payload:{drawId:I,matchUpId:v,penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0}};if(K&&B.push({payload:{drawId:I,matchUpId:v,schedule:{}},method:SY,type:Jxe}),ka({policyActions:C,action:bw})&&(A!=null&&A.participant||!g&&_!=null&&_.length)&&B.push(ne),K&&oe&&B.push({type:Qxe}),Q&&oe){const{matchUpId:re,matchUpFormat:me}=T,he={drawId:I,matchUpId:re,matchUpFormat:me,outcome:{scoreStringSide1:void 0,scoreStringSide2:void 0,sets:[]},winningSide:void 0};B.push({info:"set outcome and winningSide",method:SY,type:eOe,payload:he}),ka({policyActions:C,action:DY})&&B.push({type:DY}),ka({policyActions:C,action:PY})&&B.push({type:PY})}if(V&&R){const re=function({specifiedPolicyDefinitions:me,inContextDrawMatchUps:he,matchUpParticipantIds:be,matchUpActionsPolicy:Se,inContextMatchUp:De,policyActions:Oe,enforceGender:xe,participantId:$e,sideNumber:Ae,matchUpId:ve,matchUp:ke,drawId:ye,side:Ie}){var Ne,Fe,Le,ge,Ee,we,fe,Te,ue,de,_e,Ue,Ce;const We=[],He=(Ne=De.sides)==null?void 0:Ne.find(Yt=>Yt.participant),Be=De.gender===is&&De.sideNumber&&((Fe=De.sides)==null?void 0:Fe.filter(Yt=>Yt.particiapntId).length)===1&&((ge=(Le=He==null?void 0:He.participant)==null?void 0:Le.person)==null?void 0:ge.sex),et=De.matchUpType,ot=(xe??((Ee=Se==null?void 0:Se.participants)==null?void 0:Ee.enforceGender))!==!1?De.gender:void 0,mt=(we=De.sides)==null?void 0:we.flatMap(Yt=>{var _n;return((_n=Yt.participant)==null?void 0:_n.individualParticipants)||Yt.participant}).filter(Boolean),Rt=mt==null?void 0:mt.map(li),Ft=(fe=De.sides)==null?void 0:fe.filter(Yt=>!Ae||Yt.sideNumber===Ae).flatMap(Yt=>{var _n;return((_n=Yt.participant)==null?void 0:_n.individualParticipants)||Yt.participant}).filter(Boolean),Je=Ft==null?void 0:Ft.map(li),_t=he==null?void 0:he.find(Yt=>Yt.matchUpId===De.matchUpTieId),pt=(Te=_t==null?void 0:_t.sides)==null?void 0:Te.map(Yt=>{var _n;return(_n=Yt.participant)==null?void 0:_n.individualParticipants.filter(({participantId:Gr,person:qo})=>!(Je!=null&&Je.includes(Gr))&&(!ot||ot===Ru||qo.sex===ot||ot===is&&!Be||Be&&qo.sex!==Be))}),Ke=Ae?pt==null?void 0:pt[Ae-1]:pt==null?void 0:pt.map((Yt,_n)=>({participants:Yt,sideNumber:_n+1})),ci=Ae?(ue=pt==null?void 0:pt[Ae-1])==null?void 0:ue.map(li):pt==null?void 0:pt.map((Yt,_n)=>({participants:Yt==null?void 0:Yt.map(li),sideNumber:_n+1})),ni=Ae&&(et===wI&&!(Je!=null&&Je.length)||et===ey&&((Je==null?void 0:Je.length)??0)<2)||!Ae&&(et===wI&&((Je==null?void 0:Je.length)??0)<2||et===ey&&((Je==null?void 0:Je.length)??0)<4),Ht=ci==null?void 0:ci.filter(Yt=>!(Rt!=null&&Rt.includes(Yt))),Zi=Ke==null?void 0:Ke.filter(({participantId:Yt})=>Ht.includes(Yt));if(ni&&Ht!=null&&Ht.length&&We.push({availableParticipantIds:Ht,method:Yxe,availableParticipants:Zi,type:dI,payload:{participantId:void 0,tieMatchUpId:ve,sideNumber:Ae,drawId:ye}}),!(Je!=null&&Je.length)||lo(ke)&&!((de=Ie==null?void 0:Ie.substitutions)!=null&&de.length)||We.push({method:bY,type:ppe,existingParticipantIds:Je,payload:{participantId:void 0,tieMatchUpId:ve,drawId:ye}}),Zi!=null&&Zi.length&&(!Ae&&Je!=null&&Je.length||Ae&&Ie!=null&&Ie.participant)&&We.push({availableParticipantIds:Ht,method:qxe,availableParticipants:Zi,type:Xxe,existingParticipantIds:Je,payload:{existingParticipantId:void 0,participantId:void 0,tieMatchUpId:ve,drawId:ye}}),ka({policyActions:Oe,action:wY})&&((_e=Ie==null?void 0:Ie.substitutions)==null?void 0:_e.length)){const Yt=((Ue=Ie.participant)==null?void 0:Ue.participantType)===ui&&[Ie.participantId]||((Ce=Ie.participant)==null?void 0:Ce.participantType)===qt&&Ie.participant.individualParticipantIds||[],_n=Ie.substitutions.map(Gr=>Gr.participantId).filter(Gr=>Yt.includes(Gr));$e&&!_n.includes($e)||We.push({method:bY,type:wY,substitutedParticipantIds:_n,payload:{participantId:void 0,tieMatchUpId:ve,drawId:ye}})}const Xi=me==null?void 0:me[so],wi=Xi==null?void 0:Xi.substituteWithoutScore,Ji=Xi==null?void 0:Xi.substituteAfterCompleted;if(ka({policyActions:Oe,action:TY})&&be.length===2&&(!Ae&&Je!=null&&Je.length||Ae&&Ie!=null&&Ie.participant)&&(wi||lo(ke))&&(Ji||ke.matchUpStatus&&!no.includes(ke.matchUpStatus))&&Ft!=null&&Ft.length&&Ke.length){const Yt=Ft.map(li);We.push({info:"list of team players available for substitution",method:Zxe,availableParticipantIds:ci,existingParticipantIds:Yt,availableParticipants:Ke,existingParticipants:Ft,type:TY,payload:{substituteParticipantId:void 0,existingParticipantId:void 0,sideNumber:Ae,matchUpId:ve,drawId:ye}})}return We}({specifiedPolicyDefinitions:h,inContextDrawMatchUps:N,matchUpParticipantIds:_,matchUpActionsPolicy:D,inContextMatchUp:R,policyActions:C,enforceGender:f,participantId:m,sideNumber:g,matchUpId:v,matchUp:T,drawId:I,side:A});B.push(...re)}return{structureIsComplete:H,validActions:B,isDoubleExit:J}}function w3(t){const{policyDefinitions:e,returnParticipants:i=!0,provisionalPositioning:n,tournamentRecord:r,drawDefinition:o,drawPosition:a,event:s}=t;if(!s)return{error:Fi};if(!o)return{error:rt};if(!t.structureId)return{error:Va};const l=t.tournamentParticipants??(r&&Qn({withIndividualParticipants:!0,tournamentRecord:r}).participants)??[];let c=kt({structureId:t.structureId,drawDefinition:o});if(c.error)return c;const u=c.containingStructure||c.structure;if(!u)return{error:Cn};const d=u.structureId;if(c=oC({drawDefinition:o,structureId:d}),a===void 0&&!c.isAdHoc)return{error:xP};if(c.isAdHoc)return Gk(t);if(c.error)return c;const{drawPositionInitialRounds:p,inactiveDrawPositions:h,activeDrawPositions:f,byeDrawPositions:m}=c,g=Gi({tournamentRecord:r,drawDefinition:o,structure:u,event:s}).appliedPolicies??{};Object.assign(g,e??{});const{actionsPolicy:v,enabledStructures:y,actionsDisabled:b}=upe({actionType:jE,appliedPolicies:g,drawDefinition:o,structure:u}),I=(v==null?void 0:v.activePositionOverrides)||[],{sourceStructureIds:T}=rL({finishingPosition:$0,targetRoundNumber:1,linkType:Mp,drawDefinition:o,structureId:d})||{};let S;T!=null&&T.length&&(S=T.reduce((K,Z)=>Bh({structureId:Z,drawDefinition:o})&&K,!0));const w=T.length,U=T.length&&!S,{policyActions:D}=dpe({enabledStructures:y,drawDefinition:o,structure:u}),E=![St,ct].includes(u.stage)||u.stageSequence!==1,{drawId:C}=o,M=[],{assignedPositions:N,positionAssignments:R}=Lr({structure:u}),A=N==null?void 0:N.find(K=>K.drawPosition===a),_=R==null?void 0:R.map(K=>K.drawPosition);if(!(_!=null&&_.includes(a)))return{error:kP};const{stage:k,stageSequence:O}=u,F=[k];k===So&&F.push(ct),k===ct&&F.push(So);const B=Qy({entryStatuses:Jy,provisionalPositioning:n,drawDefinition:o,stageSequence:O,structureId:d,stages:F}),$=Pg({drawDefinition:o,stages:F}).assignedParticipantIds??[],V=B.filter(K=>!$.includes(K.participantId)).map(K=>K.participantId),H=m.includes(a),z=f.includes(a);if(b)return{hasPositionAssigned:!!A,info:"Actions Disabled for structure",isActiveDrawPosition:z,isDrawPosition:!0,validActions:[],isByePosition:H};if(ka({policyActions:D,action:dI})&&!z&&R&&!U&&(!A||H)){const{validAssignmentActions:K}=function({positionSourceStructureIds:Z,unassignedParticipantIds:Y,possiblyDisablingAction:X,provisionalPositioning:Q,tournamentParticipants:te,isWinRatioFedStructure:J,positionAssignments:ie,returnParticipants:oe,appliedPolicies:ne,drawDefinition:re,seedingProfile:me,isByePosition:he,drawPosition:be,structureId:Se,event:De}){var Oe,xe,$e;const{drawId:Ae}=re,ve=[];let ke,ye,Ie=[];const Ne=(xe=(Oe=ne==null?void 0:ne[mc])==null?void 0:Oe.validSeedPositions)==null?void 0:xe.ignore;if(Ne||({unplacedSeedParticipantIds:ke,unplacedSeedAssignments:ye,unfilledPositions:Ie}=ade({provisionalPositioning:Q,returnAllProxies:!0,randomize:!0,drawDefinition:re,seedingProfile:me,structureId:Se,event:De})),Ie!=null&&Ie.length||(Ie=ie.filter(Fe=>!Fe.participantId&&!Fe.bye&&!Fe.qualifier).map(Fe=>Fe.drawPosition)),he||ve.push({payload:{drawId:Ae,structureId:Se,drawPosition:be,isPositionAction:!0},willDisableLinks:X,method:Gxe,type:oL}),J&&Ne){const Fe=ie.map(fe=>fe.participantId).filter(Boolean),Le={structureIds:Z},{completedMatchUps:ge}=H0({inContext:!0,matchUpFilters:Le,drawDefinition:re}),Ee=ti(($e=(ge??[]).filter(({matchUpType:fe})=>(De==null?void 0:De.eventType)!==Yr||fe===Yr))==null?void 0:$e.map(({sides:fe})=>fe==null?void 0:fe.map(li)).flat().filter(fe=>fe&&!Fe.includes(fe))),we=oe?te==null?void 0:te.filter(fe=>Ee==null?void 0:Ee.includes(fe.participantId)).map(fe=>ft(fe,void 0,!0)):void 0;return we==null||we.forEach(fe=>{const Te=(re.entries??[]).find(ue=>ue.participantId===fe.participantId);fe.entryPosition=Te==null?void 0:Te.entryPosition}),we!=null&&we.length&&ve.push(It({payload:{drawId:Ae,structureId:Se,drawPosition:be},willDisableLinks:X,method:hY,type:dI,availableParticipantIds:Ee,participantsAvailable:we})),{validAssignmentActions:ve}}if(Ie.includes(be)||he){let Fe;if(ye!=null&&ye.length){const ge=ye.filter(Ee=>ke==null?void 0:ke.includes(Ee.participantId));ge.sort(zxe),Fe=ge.map(Ee=>Ee.participantId)}else Fe=Y;const Le=oe?te==null?void 0:te.filter(ge=>Fe.includes(ge.participantId)).map(ge=>ft(ge,void 0,!0)):void 0;Le!=null&&Le.length&&ve.push(It({payload:{drawId:Ae,structureId:Se,drawPosition:be},willDisableLinks:X,method:hY,type:dI,availableParticipantIds:Fe,participantsAvailable:Le}))}return{validAssignmentActions:ve}}({positionSourceStructureIds:T,unassignedParticipantIds:V,possiblyDisablingAction:E,isWinRatioFedStructure:w,tournamentParticipants:l,positionAssignments:R,returnParticipants:i,appliedPolicies:g,drawDefinition:o,isByePosition:H,drawPosition:a,structureId:d,event:s});K==null||K.forEach(Z=>M.push(Z))}if(ka({policyActions:D,action:iB})){const{validAssignmentActions:K}=function({drawPositionInitialRounds:Z,tournamentParticipants:Y,positionAssignments:X,returnParticipants:Q,appliedPolicies:te,drawDefinition:J,drawPosition:ie,structureId:oe,drawId:ne}){var re,me,he;const be=[],Se=[],De=[],Oe=[],xe=X.map(Fe=>Fe.participantId).filter(Boolean),$e=te==null?void 0:te[xh],Ae=!($e!=null&&$e.disableRoundRestrictions)&&Z[ie],ve=$e==null?void 0:$e.requireCompletedStructures,{sourceStructureIds:ke,relevantLinks:ye}=rL({targetRoundNumber:Ae,linkType:Rp,drawDefinition:J,structureId:oe})||{};ke!=null&&ke.length&&Oe.push(...ke);const{sourceStructureIds:Ie,relevantLinks:Ne}=rL({targetRoundNumber:Ae,linkType:Mp,drawDefinition:J,structureId:oe})||{};Ie!=null&&Ie.length&&Oe.push(...Ie);for(const Fe of ye){const Le=(re=J.structures)==null?void 0:re.find(Ee=>Ee.structureId===Fe.source.structureId);if((Le==null?void 0:Le.stage)!==St)continue;const ge=Bh({structureId:Fe.source.structureId,drawDefinition:J});if(!ve||ge){const Ee=Le.qualifyingRoundNumber,{matchUps:we}=zi({matchUpFilters:{roundNumbers:[Ee],hasWinningSide:!0},afterRecoveryTimes:!1,tournamentParticipants:Y,inContext:!0,structure:Le});for(const fe of we){const Te=fe.sides.find(de=>(de==null?void 0:de.sideNumber)===fe.winningSide),ue=fe.matchUpStatus===Ri&&((me=fe.sides)==null?void 0:me.find(({participantId:de})=>de));if(Te||ue){const{participantId:de,participant:_e}=Te||ue||{};de&&!xe.includes(de)&&(_e&&Q&&be.push(_e),Se.push(de))}}}}for(const Fe of Ne){const Le=(he=J.structures)==null?void 0:he.find(Ee=>Ee.structureId===Fe.source.structureId);if((Le==null?void 0:Le.stage)!==St)continue;const ge=Bh({structureId:Fe.source.structureId,drawDefinition:J});if(!ve||ge){const{positionAssignments:Ee}=Ki({structure:Le}),we=(Ee==null?void 0:Ee.map(fe=>{var Te;const ue=fe.participantId,de=(Te=ei({element:fe,name:tf}).extension)==null?void 0:Te.value;return de?{participantId:ue,groupOrder:de==null?void 0:de.groupOrder}:{}}).filter(({groupOrder:fe,participantId:Te})=>fe===1&&!xe.includes(Te)).map(({participantId:fe})=>fe))??[];if(we&&Se.push(...we),Q){const fe=Y.filter(({participantId:Te})=>we.includes(Te));be.push(...fe)}}}return Se.length&&De.push(It({payload:{qualifyingParticipantId:void 0,drawPosition:ie,structureId:oe,drawId:ne},method:Bxe,type:iB,qualifyingParticipantIds:Se,qualifyingParticipants:Q?be:void 0})),{validAssignmentActions:De,sourceStructureIds:Oe}}({drawPositionInitialRounds:p,tournamentParticipants:l,positionAssignments:R,returnParticipants:i,appliedPolicies:g,drawDefinition:o,drawPosition:a,structureId:d,drawId:C});K==null||K.forEach(Z=>M.push(Z))}const{participantId:G}=A||{},W=G&&l.find(K=>K.participantId===G);if(A){ka({policyActions:D,action:gY})&&!z&&(M.push({type:gY,method:pY,payload:{drawId:C,structureId:d,drawPosition:a},willDisableLinks:E}),H||M.push({type:ape,method:"withdrawParticipantAtDrawPosition",payload:{drawId:C,structureId:d,drawPosition:a},willDisableLinks:E}),ka({policyActions:D,action:oL})&&!H&&M.push({type:oL,method:pY,payload:{drawId:C,structureId:d,drawPosition:a,replaceWithBye:!0},willDisableLinks:E}));const K=u.stage===St||u.stage===ct&&u.stageSequence===1;if(!H&&yY({activePositionOverrides:I,activeDrawPositions:f,action:TI})&&ka({policyActions:D,action:TI})&&NR({drawDefinition:o,structureId:d,drawPosition:a})&&K){const{seedAssignments:Z}=ul({returnAllProxies:!0,drawDefinition:o,structure:u}),{seedNumber:Y,seedValue:X}=(Z==null?void 0:Z.find(Q=>Q.participantId===G))??{};M.push({type:TI,method:"modifySeedAssignment",participant:W,seedNumber:Y,payload:{drawId:C,structureId:d,participantId:G,seedValue:X}})}if(!H&&yY({activePositionOverrides:I,activeDrawPositions:f,action:VE})&&ka({policyActions:D,action:VE})&&NR({drawDefinition:o,structureId:d,drawPosition:a})&&K){const{seedAssignments:Z}=ul({returnAllProxies:!0,drawDefinition:o,structure:u}),{seedNumber:Y}=(Z==null?void 0:Z.find(X=>X.participantId===G))??{};M.push({method:"removeSeededParticipant",type:VE,participant:W,seedNumber:Y,payload:{participantId:G,structureId:d,drawId:C}})}if(!H&&G){if(ka({policyActions:D,action:bw})){const Z={type:bw,method:ope,participant:W,payload:{penaltyCode:void 0,penaltyType:void 0,participantIds:[],notes:void 0,drawId:C}};M.push(Z)}if(ka({policyActions:D,action:FR})){const Z={type:FR,method:"modifyParticipantOtherName",participant:W,payload:{participantId:G,otherName:void 0}};M.push(Z)}}if(ka({policyActions:D,action:spe})){const{validSwapAction:Z}=Wxe({possiblyDisablingAction:E,tournamentParticipants:l,inactiveDrawPositions:h,activeDrawPositions:f,positionAssignments:R,returnParticipants:i,byeDrawPositions:m,drawDefinition:o,isByePosition:H,drawPosition:a,structureId:d,structure:u,drawId:C});Z&&M.push(Z)}}if(ka({policyActions:D,action:mY})&&!U){const{validAlternatesAction:K}=function({tournamentParticipants:Z=[],possiblyDisablingAction:Y,activeDrawPositions:X,positionAssignments:Q,returnParticipants:te,appliedPolicies:J,drawDefinition:ie,drawPosition:oe,validActions:ne,structureId:re,structure:me,drawId:he,event:be}){var Se,De,Oe,xe;if(X.includes(oe))return{};const $e=(Se=ne.find(Ee=>Ee.type===dI))==null?void 0:Se.availableParticipantIds,Ae=(De=J==null?void 0:J[xh])==null?void 0:De.otherFlightEntries,ve=(Oe=J==null?void 0:J[xh])==null?void 0:Oe.restrictQualifyingAlternates,ke=(ie.entries??[]).filter(({entryStage:Ee})=>!ve||(me.stage===St?Ee===St:Ee!==St)).sort((Ee,we)=>(Ee.entryPosition??1/0)-(we.entryPosition??1/0)).map(({participantId:Ee})=>Ee).filter(Boolean),{allPositionedParticipantIds:ye}=oue({drawDefinition:ie}),Ie=Q.map(Ee=>Ee.participantId).filter(Boolean),Ne=ke.filter(Ee=>me.stage&&[St,ct,Vn].includes(me.stage)?!(ye!=null&&ye.includes(Ee)):!Ie.includes(Ee)),Fe=((be==null?void 0:be.entries)??[]).filter(Ee=>Ee.entryStatus===Nc&&lpe({restrictQualifyingAlternates:ve,structure:me,entry:Ee})&&(me.stage&&[St,ct,Vn].includes(me.stage)?!(ye!=null&&ye.includes(Ee.participantId)):!Ie.includes(Ee.participantId))).sort((Ee,we)=>(Ee.entryPosition??1/0)-(we.entryPosition??1/0)).map(Ee=>Ee.participantId);let Le=ti(Ne.concat(Fe));if(Ae){const Ee=be?Zn({event:be}).flightProfile:void 0,we=(xe=Ee==null?void 0:Ee.flights)==null?void 0:xe.filter(fe=>fe.drawId!==he).map(fe=>fe.drawEntries.filter(Te=>Te.participantId&&![af,Fc,ty].includes(Te.entryStatus)&&!ke.includes(Te.participantId)).map(({participantId:Te})=>Te)).flat().filter(Boolean);we!=null&&we.length&&Le.push(...we)}$e!=null&&$e.length&&(Le=Le.filter(Ee=>!$e.includes(Ee)));const ge=te?Z==null?void 0:Z.filter(Ee=>Le.includes(Ee.participantId)):void 0;return ge==null||ge.forEach(Ee=>{const we=(ie.entries??[]).find(fe=>fe.participantId===Ee.participantId);Ee.entryPosition=we==null?void 0:we.entryPosition}),ge==null||ge.sort((Ee,we)=>(Ee.entryPosition||1/0)-(we.entryPosition||1/0)),Le.length?{validAlternatesAction:It({payload:{drawId:he,structureId:re,drawPosition:oe},willDisableLinks:Y,method:$xe,availableAlternatesParticipantIds:Le,type:mY,availableAlternates:ge})}:{}}({possiblyDisablingAction:E,tournamentParticipants:l,positionAssignments:R,activeDrawPositions:f,returnParticipants:i,appliedPolicies:g,drawDefinition:o,drawPosition:a,validActions:M,structureId:d,structure:u,drawId:C,event:s});K&&M.push(K)}if(ka({policyActions:D,action:vY})&&!U&&R){const{validLuckyLosersAction:K}=function({tournamentParticipants:Z=[],sourceStructuresComplete:Y,possiblyDisablingAction:X,isWinRatioFedStructure:Q,activeDrawPositions:te,positionAssignments:J,drawDefinition:ie,drawPosition:oe,structureId:ne,structure:re,drawId:me,event:he}){var be,Se,De,Oe,xe;if(te.includes(oe)||Q&&!Y)return{};const{sourceStructureIds:$e,targetStructureIds:Ae}=((be=ie.links)==null?void 0:be.reduce((Ie,Ne)=>{var Fe,Le;const ge=(Fe=Ne.source)==null?void 0:Fe.structureId,Ee=(Le=Ne.target)==null?void 0:Le.structureId;return Ie.sourceStructureIds.includes(ge)||Ie.sourceStructureIds.push(ge),Ie.targetStructureIds.includes(Ee)||Ie.targetStructureIds.push(Ee),Ie},{sourceStructureIds:[],targetStructureIds:[]}))||{},ve=[],ke=((Se=ie.links)==null?void 0:Se.filter(Ie=>{var Ne;return((Ne=Ie.target)==null?void 0:Ne.structureId)===re.structureId}))??[];for(const Ie of ke){const Ne=(De=Ie==null?void 0:Ie.source)==null?void 0:De.structureId,{structure:Fe}=kt({structureId:Ne,drawDefinition:ie}),Le={};if((Fe==null?void 0:Fe.finishingPosition)===Ky&&(($e==null?void 0:$e.length)!==1||(Ae==null?void 0:Ae.length)!==1)){const{matchUps:fe}=zi({drawDefinition:ie,structure:re,event:he}),{initialRoundNumber:Te}=ny({drawPosition:oe,matchUps:fe}),ue=(Oe=ie.links)==null?void 0:Oe.find(_e=>{var Ue;return((Ue=_e.target)==null?void 0:Ue.structureId)===(re==null?void 0:re.structureId)&&_e.target.roundNumber===Te}),de=(xe=ue==null?void 0:ue.source)==null?void 0:xe.roundNumber;Le.roundNumbers=[de]}const{completedMatchUps:ge}=Ek({structureId:Ne,inContext:!0,matchUpFilters:Le,drawDefinition:ie}),Ee=J.map(fe=>fe.participantId).filter(Boolean),we=ge==null?void 0:ge.filter(({matchUpType:fe,winningSide:Te})=>Te&&((he==null?void 0:he.eventType)!==Yr||fe===Yr)).map(({winningSide:fe,sides:Te})=>fe&&(Te==null?void 0:Te[1-(fe-1)])).map(li).filter(fe=>fe&&!Ee.includes(fe));we==null||we.forEach(fe=>{ve.includes(fe)||ve.push(fe)})}const ye=Z==null?void 0:Z.filter(Ie=>ve==null?void 0:ve.includes(Ie.participantId));return ye==null||ye.forEach(Ie=>{const Ne=(ie.entries??[]).find(Fe=>Fe.participantId===Ie.participantId);Ie.entryPosition=Ne==null?void 0:Ne.entryPosition}),ve!=null&&ve.length?{validLuckyLosersAction:{type:vY,method:Vxe,availableLuckyLosers:ye,availableLuckyLoserParticipantIds:ve,willDisableLinks:X,payload:{drawId:me,structureId:ne,drawPosition:oe}}}:{}}({sourceStructuresComplete:S,possiblyDisablingAction:E,isWinRatioFedStructure:w,tournamentParticipants:l,activeDrawPositions:f,positionAssignments:R,drawDefinition:o,drawPosition:a,structureId:d,structure:u,drawId:C});K&&M.push(K)}if((W==null?void 0:W.participantType)===qt&&ka({policyActions:D,action:fY})){const{validModifyAssignedPairAction:K}=function({tournamentParticipants:Z,returnParticipants:Y,drawPosition:X,participant:Q,drawId:te,event:J}){var ie;const oe=((ie=J==null?void 0:J.entries)==null?void 0:ie.filter(({entryStatus:ne})=>[Fc,ty].includes(ne)).map(({participantId:ne})=>ne))||[];if(oe.length){const ne=Q.individualParticipantIds,re=Y?Z.filter(({participantId:he})=>oe.includes(he)):void 0,me=Y?Z.filter(({participantId:he})=>ne.includes(he)):void 0;return{validModifyAssignedPairAction:It({payload:{participantId:Q.participantId,replacementIndividualParticipantId:void 0,existingIndividualParticipantId:void 0,drawPosition:X,drawId:te},method:Hxe,availableIndividualParticipantIds:oe,availableIndividualParticipants:re,existingIndividualParticipantIds:ne,existingIndividualParticipants:me,type:fY},!1,!1,!0)}}return{}}({tournamentParticipants:l,returnParticipants:i,drawPosition:a,participant:W,drawId:C,event:s});K&&M.push(K)}return{hasPositionAssigned:!!A,isActiveDrawPosition:z,isDrawPosition:!0,isByePosition:H,validActions:M}}function wC({policyDefinitions:t,appliedPolicies:e,drawType:i}){var n,r;const o=(n=t==null?void 0:t[$2])==null?void 0:n.drawTypeCoercion,a=(r=e==null?void 0:e[$2])==null?void 0:r.drawTypeCoercion;return(typeof o=="boolean"?o:void 0)??(i&&(o==null?void 0:o[i]))??(typeof a=="boolean"?a:void 0)??(i&&(a==null?void 0:a[i]))??!0}function _U({tournamentRecord:t,drawDefinition:e,stage:i=ct,structureId:n,structure:r}){var o;if(!t)return{error:je};if(!r&&!e)return{error:rt};if(r||n||((o=e==null?void 0:e.structures)==null?void 0:o.filter(l=>l.stage===i).length)!==1||(r=e.structures.find(l=>l.stage===i)),!r&&!n)return{error:Va};const{error:a,positionAssignments:s}=Ki({drawDefinition:e,structureId:n,structure:r});return{positionAssignments:s??[],structureId:r==null?void 0:r.structureId,error:a}}function S3({structureId:t,drawDefinition:e}){if(!e)return{error:rt};if(!La(t))return{error:Re};const i=j0({drawDefinition:e,structureId:t});if(i.error)return i;const n=i.links.target.flatMap(o=>o.target.feedProfile).filter(Boolean),r=!sr([nf,_l,hk,Hm],n).length;return{...le,valid:r}}function zk({consideredEntries:t,policyDefinitions:e,tournamentRecord:i,appliedPolicies:n,participantMap:r,enforceGender:o,participants:a,event:s}){var l;if(a&&r||!i||({participants:a,participantMap:r}=Qn({tournamentRecord:i})),!a)return{error:X_};if(!Array.isArray(a))return{error:Re};if(!s)return{error:Fi};const c=(e==null?void 0:e[so])??(n==null?void 0:n[so])??ab[so],u=(o??((l=c==null?void 0:c.participants)==null?void 0:l.enforceGender))!==!1,{eventType:d,gender:p}=s,h=d===Wm,f=d===$c&&on||h&&qt||ui,m=Object.assign({},...(t??s.entries??[]).map(y=>({[y.participantId]:y.entryStatus}))),g=Object.keys(m),v=a.filter(y=>g.includes(y.participantId)).filter(y=>{const b=function({participant:T,participantType:S,eventType:w,entryStatusMap:U}){const D=U[T.participantId],E=w&&[Wm,$c].includes(w)&&T.participantType===ui&&(im(D)||D===af);return T.participantType!==S&&!E}({participant:y,participantType:f,eventType:d,entryStatusMap:m}),I=function(T){var S,w,U;const{participant:D,participantMap:E,eventGender:C,mismatch:M,isDoubles:N,genderEnforced:R}=T,A=!M&&N&&ti(((S=D==null?void 0:D.individualParticipantIds)==null?void 0:S.map(F=>{var B,$,V;return(V=($=(B=E==null?void 0:E[F])==null?void 0:B.participant)==null?void 0:$.person)==null?void 0:V.sex}).filter(Boolean))??[])||[],_=!C||!(A!=null&&A.length)||Ru===C||[rn,Dn].includes(C)&&A[0]===C||is===C&&(A.length==1&&((w=D.individualParticipantIds)==null?void 0:w.length)===1||A.length===2),k=(U=D==null?void 0:D.person)==null?void 0:U.sex,O=!(D!=null&&D.person)||!C||[Ru,is].includes(C)||[rn,Dn].includes(C)&&k===C;return!R||_&&O}({genderEnforced:u,participantMap:r,eventGender:p,participant:y,isDoubles:h,mismatch:b});return b||!I});if(v.length){const y=v.map(b=>b.participantId);return{error:c_e,invalidParticipantIds:y}}return{...le,valid:!0}}var iOe=Object.freeze({__proto__:null,allPlayoffPositionsFilled:t3,checkValidEntries:zk,findDrawDefinition:I3,getAssignedParticipantIds:Pg,getAvailablePlayoffProfiles:hC,getDrawDefinitionTimeItem:BW,getDrawParticipantRepresentativeIds:y3,getDrawTypeCoercion:wC,getEligibleVoluntaryConsolationParticipants:v3,getParticipantIdFinishingPositions:b3,getPositionAssignments:_U,getPositionsPlayedOff:z0,getSeedingThresholds:JW,getSeedsCount:IC,getStructureSeedAssignments:ul,getTeamLineUp:Ym,getValidGroupSizes:cC,isAdHoc:Zl,isCompletedStructure:Bh,isValidForQualifying:S3,positionActions:w3});function hpe({qualifyingProfiles:t,appliedPolicies:e,idPrefix:i,isMock:n,uuids:r}){var o;const a=[],s=[],l=[],c=(m,g)=>m.stageSequence-g.stageSequence,u=(m,g)=>m.roundTarget-g.roundTarget;let d,p=0,h=0,f=1;for(const m of t.sort(u)){const g=m.structureProfiles||[];f=m.roundTarget||f;let v,y,b,I=1,T=0;for(const S of(g||[]).sort(c)){let w=Hz(S.drawSize||S.participantsCount);const{qualifyingRoundNumber:U,structureOptions:D,matchUpFormat:E,structureName:C,structureId:M,drawType:N}=S,R=S.matchUpType,A=S.qualifyingPositions||nOe({drawSize:w,qualifyingRoundNumber:U});let _,k,O;if(!$t(w))return ce({result:{error:Y_},stack:"generateQualifyingSTructures"});const F=t.length>1?`${f}-`:"",B=g.length>1||F?I:"",$=C||(F||B?`${yo(St)} ${F}${B}`:yo(St));if(N===Yl){const{structures:V,groupCount:H,maxRoundNumber:z}=RU({structureName:S.structureName||$,structureId:M||(r==null?void 0:r.pop()),stage:St,structureOptions:D,appliedPolicies:e,stageSequence:I,matchUpType:R,roundTarget:f,drawSize:w,idPrefix:i,isMock:n,uuids:r});T=H,_=z,k=V[0],d=[1]}else({drawSize:w,matchUps:O,roundLimit:_}=Nu({qualifyingRoundNumber:U,qualifyingPositions:A,matchUpType:R,drawSize:w,idPrefix:i,isMock:n,uuids:r})),k=fo({structureName:S.structureName||$,structureId:M||(r==null?void 0:r.pop()),qualifyingRoundNumber:_,stage:St,matchUpFormat:E,stageSequence:I,matchUpType:R,roundLimit:_,matchUps:O}),f&&Ii({extension:{name:$u,value:f},element:k}),T=((o=O==null?void 0:O.filter(V=>V.roundNumber===_))==null?void 0:o.length)||0;if(I>1){const{link:V}=pC({sourceStructureId:y,sourceRoundNumber:v,targetStructureId:k.structureId,finishingPositions:b===Mp?[1]:void 0,linkType:b});l.push(V),p+=(w||0)-T}else p+=w||0;b=N===Yl?Mp:Rp,y=k.structureId,v=_,s.push(k),I+=1}h+=T,a.push({qualifiersCount:T,finalQualifyingRoundNumber:v,finalQualifyingStructureId:y,finishingPositions:d,roundTarget:f,linkType:b}),f+=1}return{qualifiersCount:h,qualifyingDrawPositionsCount:p,qualifyingDetails:a,structures:s,...le,links:l}}function nOe({drawSize:t,qualifyingRoundNumber:e}){let i=t,n=0;for(;n<e;)i=Math.floor(i/2),n+=1;return i}function fpe(t){const{drawTypeCoercion:e,enforceMinimumDrawSize:i}=t,n=Ct(t.drawSize);let r=e&&(typeof e=="boolean"||e<=2)&&n===2&&hu||t.drawType||hu;const o=rue.includes(r);if(n&&o){if(e&&(typeof e=="boolean"&&n<4||n<=e))r=hu;else if(n<4&&i)return{...ce({context:{enforceMinimumDrawSize:i,drawSize:n,drawType:r},result:{error:qz},stack:"getCoercedDrawType"}),drawType:r}}return{drawType:r}}function rOe({structureName:t,matchUpType:e,idPrefix:i,drawSize:n,isMock:r,uuids:o}){const a=[],{matchUps:s}=lf({linkFedFinishingRoundNumbers:[1],drawSize:n+1,matchUpType:e,idPrefix:i,isMock:r}),l=fo({structureName:t||yo(ct),structureId:o==null?void 0:o.pop(),stageSequence:1,stage:ct,matchUpType:e,matchUps:s});a.push(l);const c=n/2,{matchUps:u}=lf({finishingPositionOffset:c,idPrefix:i&&`${i}-c`,drawSize:n-1,isConsolation:!0,matchUpType:e,isMock:r,uuids:o}),d=fo({structureName:yo(nue),matchUps:u,structureId:o==null?void 0:o.pop(),stage:So,stageSequence:2,matchUpType:e});a.push(d);const{matchUps:p}=Nu({idPrefix:i&&`${i}-p1t2`,drawSize:2,matchUpType:e,isMock:r}),h=fo({structureName:yo(iue),matchUps:p,structureId:o==null?void 0:o.pop(),stageSequence:3,stage:Vn,matchUpType:e});a.push(h);const f=function({mainStructure:m,consolationStructure:g,deciderStructure:v}){const y=g.matchUps.reduce((T,S)=>(S.drawPositions||[]).filter(Boolean).length&&!T.includes(S.roundNumber)?T.concat(S.roundNumber):T,[]),b=m.matchUps.reduce((T,S)=>!T||S.roundNumber>T?S.roundNumber:T,void 0),I=g.matchUps.reduce((T,S)=>!T||S.roundNumber>T?S.roundNumber:T,void 0);return[...y.map((T,S)=>{const w=y.indexOf(T)%2?_l:nf;return{linkType:Ed,source:{roundNumber:1+S,structureId:m.structureId},target:{feedProfile:w,roundNumber:T,structureId:g.structureId}}}),{linkType:Rp,source:{roundNumber:I,structureId:g.structureId},target:{feedProfile:_l,roundNumber:b,structureId:m.structureId}},{linkType:Rp,source:{roundNumber:b,structureId:m.structureId},target:{feedProfile:_l,roundNumber:1,structureId:v.structureId}},{linkType:Ed,source:{roundNumber:b,structureId:m.structureId},target:{feedProfile:_l,roundNumber:1,structureId:v.structureId}}]}({mainStructure:l,consolationStructure:d,deciderStructure:h});return{structures:a,links:f,...le}}function oOe(t){const{qualifyingRoundNumber:e,finishingPositionOffset:i,qualifyingPositions:n,matchUpType:r,idPrefix:o,drawSize:a,isMock:s,uuids:l}=t;if(!$t(a)||a<2)return{matchUps:[],roundsCount:0};if(Lc(a))return Nu(t);const c=function(g){const v=Ct(g);let y=v%2?v+1:v;const b=!!(Math.ceil(y/2)%2),I=[{participantsCount:y,preFeedRound:b}];for(;y>2;){const T=Math.ceil(y/2),S=T===1,w=!(S||!(T%2));y=!S&&w?T+1:T;const U=!!(y!==2&&Math.ceil(y/2)%2);I.push({participantsCount:y,preFeedRound:U,feedRound:w})}return I}(a),u=c.shift(),d=nt(1,((u==null?void 0:u.participantsCount)||0)+1).map(g=>({drawPosition:g}));let p=[],h=1;({matchUps:p}=kR({roundNumber:h,matchUpType:r,idPrefix:o,matchUps:p,isMock:s,nodes:d,uuids:l})),h++;let f=t.roundLimit||e;for(const g of c){const v=g.participantsCount/2,y=nt(1,v+1);n&&v===n&&(f=h-1);const b=y.map(I=>{const T=o3({roundPosition:I,roundNumber:h,idPrefix:o,uuids:l});return{roundPosition:I,roundNumber:h,matchUpId:T}});p.push(...b),h++}const m=h-1;return p=Mk({finishingPositionOffset:i,lucky:!0,roundsCount:m,roundLimit:f,matchUps:p}),f&&(p=p.filter(g=>g.roundNumber<=f)),{matchUps:p,roundsCount:m,roundLimit:f}}function mpe(t){var e,i;const{playoffAttributes:n,stageSequence:r=1,stage:o=ct,matchUpType:a,drawSize:s,uuids:l}=t,c=t.structureId||(()=>{if(!(!t.isMock&&!t.idPrefix))return`${t.drawDefinition.drawId}-s-0`})()||(l==null?void 0:l.pop()),{appliedPolicies:u}=Gi(t),d=((e=t.policyDefinitions)==null?void 0:e[bR])||(u==null?void 0:u[bR]);t.skipRounds=t.skipRounds||s<=4&&(d!=null&&d.feedMainFinal?0:1)||0;const p=t.structureName??((i=n==null?void 0:n[0])==null?void 0:i.name)??yo(ct);return{generators:{[ll]:()=>({structures:[fo({finishingPosition:$0,stageSequence:r,structureName:p,matchUps:[],matchUpType:a,structureId:c,stage:o})],links:[],...le}),[Gm]:()=>{const{matchUps:h}=oOe(t);return{structures:[fo({stageSequence:r,structureName:p,matchUpType:a,structureId:c,matchUps:h,stage:o})],links:[],...le}},[hu]:()=>(()=>{const{matchUps:h}=Nu(t);return{structures:[fo({stageSequence:r,structureName:p,matchUpType:a,structureId:c,matchUps:h,stage:o})],links:[],...le}})(),[mU]:()=>rOe(t),[dw]:()=>SI({...t,roundOffsetLimit:3,playoffAttributes:n??TW}),[pw]:()=>SI({...t,roundOffsetLimit:2,playoffAttributes:n??UW}),[Vn]:()=>SI(t),[uw]:()=>{const{matchUps:h}=lf({drawSize:s,uuids:l,matchUpType:a});return{structures:[fo({stageSequence:r,structureName:p,matchUpType:a,structureId:c,stage:ct,matchUps:h})],links:[],...le}},[gU]:()=>Ede(t),[hw]:()=>zg({...t,feedRounds:1,fmlc:!0}),[tue]:()=>zg({...t,feedRounds:1}),[IW]:()=>zg({...t,feedsFromFinal:1}),[wW]:()=>zg({...t,feedsFromFinal:2}),[SW]:()=>zg({...t,feedsFromFinal:3}),[wU]:()=>zg(t),[UR]:()=>Rde(t),[Yl]:()=>RU(t),[Rd]:()=>function(h){const{drawDefinition:f,structureOptions:m,requireSequential:g}=h,v={structureName:yo(ct),...h,stage:ct},{structures:y,groupCount:b,groupSize:I}=RU(v);if(b<1)return{error:z_e};const T=(m==null?void 0:m.playoffGroups)||[{finishingPositions:[1],structureName:yo(Vn)}],[S]=y,{structures:w,links:U}=Nde({sourceStructureId:S.structureId,requireSequential:g,drawDefinition:f,playoffGroups:T,groupCount:b,groupSize:I,...h});return w&&y.push(...w),{...le,structures:y,links:U}}(t)}}}function T3(t){var e,i,n,r,o;const{enforceMinimumDrawSize:a=!0,overwriteExisting:s,appliedPolicies:l,staggeredEntry:c,drawDefinition:u,tieFormat:d,isMock:p,uuids:h}=t||{},f=Ct(t.drawSize),m=t.drawTypeCoercion??wC({appliedPolicies:l,drawType:t.drawType}),g=fpe({drawType:t.drawType,enforceMinimumDrawSize:a,drawTypeCoercion:m,drawSize:f});if(g.error)return g;const v=g.drawType,y=[],b=[],I=(t==null?void 0:t.matchUpType)??vr,T=(e=u==null?void 0:u.structures)==null?void 0:e.filter(({stage:W})=>W===St);T&&y.push(...T);const S=T==null?void 0:T.map(({structureId:W})=>W),w=(i=u==null?void 0:u.structures)==null?void 0:i.find(({stage:W,stageSequence:K})=>W===ct&&K===1),U=(n=u==null?void 0:u.links)==null?void 0:n.filter(W=>W.target.structureId===(w==null?void 0:w.structureId)&&(S==null?void 0:S.includes(W.source.structureId))),D=(W,K)=>{var Z;if(W.linkType===Mp&&K!=null&&K.structures){const Y=W.source.finishingPositions||[];return K.structures.length*Y.length}if(W.linkType===Rp&&(Z=K==null?void 0:K.matchUps)!=null&&Z.length){const Y=W.source.roundNumber;return K.matchUps.filter(({roundNumber:X})=>X===Y).length}},E=T==null?void 0:T.map(W=>{var K,Z,Y;const X=U==null?void 0:U.find(ie=>ie.target.structureId===W.structureId),Q=((Z=(K=Ki({structure:W}))==null?void 0:K.positionAssignments)==null?void 0:Z.length)??0;if(!X)return Q;const te=X==null?void 0:X.source.structureId,J=(Y=u.structures)==null?void 0:Y.find(ie=>ie.structureId===te);return Q-(D(X,J)||0)}).filter(Boolean).reduce((W,K)=>W+K,0),C=U==null?void 0:U.map(W=>{const K=W.source.structureId,Z=T==null?void 0:T.find(Y=>Y.structureId===K);return D(W,Z)}).filter(Boolean).reduce((W,K)=>W+K,0),M=!(!w||(r=w==null?void 0:w.matchUps)!=null&&r.length);if(T!=null&&T.length&&!M)return{error:P7};const N=!(T!=null&&T.length)&&t.qualifyingProfiles,R=(N==null?void 0:N.length)&&hpe({idPrefix:t.idPrefix,qualifyingProfiles:N,appliedPolicies:l,isMock:p,uuids:h});if(R!=null&&R.error)return R;const{qualifyingDrawPositionsCount:A,qualifyingDetails:_,qualifiersCount:k}=R||{qualifyingDrawPositionsCount:E,qualifiersCount:C};A&&(R!=null&&R.structures&&y.push(...R.structures),R!=null&&R.links&&b.push(...R.links)),Object.assign(t,It({drawSize:f,matchUpType:I,tieFormat:d}));const O=v!==ll&&(!f||f<2||!c&&![uw,Gm].includes(v)&&([Rd,Yl].includes(v)&&f<3||![Yl,Rd].includes(v)&&!Lc(f)));if(O&&!A)return ce({context:{drawSize:f,invalidDrawSize:O},result:{error:qz},stack:"generateDrawStructuresAndLinks"});const{generators:F,error:B}=mpe(t);if(B)return{error:B};const $=F[v];if(!$)return{error:Zle};const V=$==null?void 0:$();if(V.error)return V;const{structures:H,links:z}=V;if(H!=null&&H.length){const W=H.find(({stage:K,stageSequence:Z})=>K===ct&&Z===1);if(w&&W){if(M){const K=W.structureId;if(W.structureId=w.structureId,z==null?void 0:z.length)for(const Z of z)Z.source.structureId===K&&(Z.source.structureId=w.structureId),Z.target.structureId===K&&(Z.target.structureId=w.structureId)}else if(!s)return{error:P7}}y.push(...H)}y.sort(Zy),z!=null&&z.length&&b.push(...z);const G=V.structures.find(({stage:W,stageSequence:K})=>W===ct&&K===1);for(const W of _||[]){const{finalQualifyingRoundNumber:K,finalQualifyingStructureId:Z,roundTarget:Y,finishingPositions:X,linkType:Q}=W,te=G&&((o=pC({targetStructureId:G.structureId,sourceStructureId:Z,sourceRoundNumber:K,finishingPositions:X,targetEntryRound:Y,linkType:Q}))==null?void 0:o.link);if(te!=null&&te.error)return te;te&&b.push(te)}return U&&b.push(...U),{...le,qualifyingResult:{qualifyingDrawPositionsCount:A,qualifiersCount:k},structures:y,links:b}}function U3(t){var e,i;const{modifyOriginal:n=!0,stageSequence:r=1,isMock:o}=t||{},a="generateDrawTypeAndModifyDrawDefinition";if(!t.drawDefinition)return ce({result:{error:rt},stack:a});const s=n?t.drawDefinition:ft(t.drawDefinition,!1,!0);let{tieFormat:l,matchUpType:c}=t;if(l){const T=ds({tieFormat:l});if(T.error)return T}l=po(l??((e=jo({drawDefinition:s}))==null?void 0:e.tieFormat)),c=c??(s.matchUpType||vr),t.tieFormat=l,t.matchUpType=c;const u=RR({drawDefinition:s,stage:ct});t.drawSize=t.drawSize??u,!u&&t.drawSize&&_R({drawSize:t.drawSize,drawDefinition:s,stageSequence:r,stage:ct});const d=ma({drawDefinition:s}).drawMatchUps.map($r),p=T3(t);if(p.error)return ce({result:p,stack:a});const{structures:h,links:f,qualifyingResult:m}=p;s.structures=h,s.links=f;const g=Math.max(t.qualifiersCount??0,(m==null?void 0:m.qualifiersCount)||0);if(m!=null&&m.qualifyingDrawPositionsCount&&!RR({stage:St,drawDefinition:s})){const T=_R({drawSize:m.qualifyingDrawPositionsCount,stage:St,drawDefinition:s});if(T.error)return T}if(g){const T=Sde({qualifiersCount:g,drawDefinition:s,stage:ct});if(T.error)return T}const v=t.drawSize??u;Object.assign(t,It({drawSize:v,matchUpType:c,tieFormat:l}));const{matchUps:y,matchUpsMap:b}=Ar({drawDefinition:s});l&&(y==null||y.forEach(T=>{if(!d.includes(T.matchUpId)){const{tieMatchUps:S}=NU({tieFormat:l,matchUp:T,isMock:o});Object.assign(T,{tieMatchUps:S,matchUpType:c})}}));const{inContextDrawMatchUps:I}=EU({drawDefinition:s,matchUpsMap:b});return un({tournamentId:(i=t.tournamentRecord)==null?void 0:i.tournamentId,drawDefinition:s}),{inContextDrawMatchUps:I,drawDefinition:s,matchUpsMap:b,...le,structures:h,matchUps:y,links:f}}function gpe(t){var e,i,n,r;const{drawType:o=hu,attachConsolation:a=!0,applyPositioning:s=!0,tournamentRecord:l,staggeredEntry:c,automated:u,placeByes:d,isMock:p,event:h}=t;let f=t==null?void 0:t.drawDefinition;if(!f)return{error:rt};const m=qr,g=Qy({stageSequence:1,drawDefinition:f,stage:m}),v=[Yl,mU,Rd].includes(o)?g.length:R0(g.length);if(!c&&o===uw&&g.length<2||o===Yl&&g.length<3)return{error:qz};let{tieFormat:y,matchUpType:b}=t;if(y){const A=ds({tieFormat:y});if(A.error)return A}y=po(y??((e=jo({drawDefinition:f}))==null?void 0:e.tieFormat)),b=b??f.matchUpType??vr;const{structures:I}=Nd({stageSequence:1,drawDefinition:f,stage:m});if(I.length>1)return{error:u_e};if((n=(i=I==null?void 0:I[0])==null?void 0:i.matchUps)!=null&&n.length)return{error:wce};const T=(r=I==null?void 0:I[0])==null?void 0:r.structureId;Object.assign(t,It({structureName:t.structureName??yo(qr),structureId:T,matchUpType:b,tieFormat:y,drawSize:v,stage:m}));const S=mpe(t);if(S.error)return S;const w=S.generators[o];if(!w)return{error:Zle};const U=w==null?void 0:w();if(U.error)return U;const{structures:D,links:E}=U,C=D.map(A=>zi({structure:A}).matchUps).flat();y&&C.forEach(A=>{const{tieMatchUps:_}=NU({matchUp:A,tieFormat:y,isMock:p});Object.assign(A,{tieMatchUps:_,matchUpType:b})}),s&&a||(f=ft(f,!1,!0)),f.links||(f.links=[]),E.length&&f.links.push(...E);const M=D.map(({structureId:A})=>A);f.structures||(f.structures=[]);const N=f.structures.map(({structureId:A})=>A);f.structures=f.structures.map(A=>M.includes(A.structureId)?D.find(({structureId:_})=>_===A.structureId):A);const R=D.filter(({structureId:A})=>!N.includes(A));return R.length&&f.structures.push(...R),u&&uC({seedingProfile:t.seedingProfile,applyPositioning:s,tournamentRecord:l,drawDefinition:f,structureId:T,placeByes:d,drawSize:v,event:h}),a&&un({drawDefinition:f}),{links:E,structures:D,...le}}function Wk(t){var e,i,n,r,o,a,s,l;const{matchUpIds:c=[],drawDefinition:u,roundNumber:d,newRound:p,isMock:h,event:f}=t;if(typeof u!="object")return{error:rt};let{participantIdPairings:m,matchUpsCount:g}=t;const v=t.structureId??(((e=u.structures)==null?void 0:e.length)===1&&((n=(i=u.structures)==null?void 0:i[0])==null?void 0:n.structureId));if(typeof v!="string")return{error:Va};const y=(r=u.structures)==null?void 0:r.find(U=>U.structureId===v);if(!y)return{error:Cn};let b;const I=y.matchUps??[],T=I==null?void 0:I.reduce((U,D)=>(D.roundPosition&&(b=!0),((D==null?void 0:D.roundNumber)||0)>U?D.roundNumber:U),0);if(!g){const U=((o=u==null?void 0:u.entries)==null?void 0:o.filter(E=>{const C=E.entryStatus;return Zc.includes(C)}))??[],D=Math.floor((U==null?void 0:U.length)/2)||1;if(p)g=D;else{const E=d??T??1,C=D-(((s=(a=y.matchUps)==null?void 0:a.filter(M=>M.roundNumber===E))==null?void 0:s.length)??0);C>0&&(g=C)}}if(m&&!Array.isArray(m)||g&&!$t(g)||c&&!Array.isArray(c)||!m&&!g)return{error:Re,info:"matchUpsCount or pairings error"};if(y.structures||b||y.finishingPosition===Ky)return{error:_P};if(d&&!t.ignoreLastRoundNumber&&d-1>(T||0))return{error:Re,info:"roundNumber error"};const S=d??(p&&(T??0)+1||T||1);m=m??nt(0,g).map(()=>({participantIds:[void 0,void 0]}));const w=m==null?void 0:m.map((U,D)=>{const E=(U==null?void 0:U.participantIds)??[void 0,void 0];E.push(void 0,void 0);const C=E.slice(0,2).map((N,R)=>It({sideNumber:R+1,participantId:N})),M=c[D]??(N=>{if(!(!t.idPrefix&&!h))return`${u.drawId}-${t.idPrefix??"ah"}-${S}-${N}`})(D)??Hi();return{roundNumber:S,matchUpStatus:qn,matchUpId:M,sides:C}});if(w!=null&&w.length){const U=(l=jo({drawDefinition:u,event:f}))==null?void 0:l.tieFormat;U&&w.forEach(D=>{const{tieMatchUps:E}=NU({tieFormat:U,matchUp:D,isMock:h});Object.assign(D,{tieMatchUps:E,matchUpType:gn})})}return{roundNumber:S,matchUpsCount:(w==null?void 0:w.length)??0,matchUps:w,...le}}function aL(t){return t.participantIdPairings.map(({participantIds:e})=>e.sort().join("|")).sort().join("/")}function CY({valueSortedPairings:t,stipulated:e=[],pairingValueMap:i,deltaObjects:n,valueObjects:r,actorsCount:o}){const a=[].concat(...e),s=[];let l=0;e.filter(Boolean).forEach(d=>{const[p,h]=d,f=Dv(p,h),m=i[f];s.push({participantIds:d,value:m}),l+=i[f]}),Kr(t,o).map(d=>Qo(d).map(p=>({...p,value:p.value+Math.random()*Math.round(Math.random())}))).flat().forEach(d=>{const p=d.pairing.split("|");if(!p.reduce((h,f)=>a.includes(f)||h,!1)){a.push(...p);const h=d.value;l+=h,s.push({participantIds:p,value:h})}}),s.sort((d,p)=>d.value-p.value);const c=s.reduce((d,p)=>{const[h,f]=p.participantIds,m=Dv(h,f),g=n[m];return g>d?g:d},0),u=s.reduce((d,p)=>{const[h,f]=p.participantIds,m=Dv(h,f),g=r[m];return g>d?g:d},0);return{value:l,participantIdPairings:s,maxDelta:c,maxDiff:u}}function Dv(t,e){return[t,e].sort(Rk).join("|")}function EY({participantIds:t}){const e={},i=[];t.forEach(r=>{e[r]=t.filter(o=>o!==r),e[r].forEach(o=>{const a=Dv(o,r);i.includes(a)||i.push(a)})});const n=Object.assign({},...i.map(r=>({[r]:0})));return{uniquePairings:i,possiblePairings:e,deltaObjects:n}}const Yg="ELO",aOe="NTRP",vpe="WTN",Gs={[Yg]:{defaultInitialization:1500,decimalsCount:0,range:[0,3e3],ascending:!0},[aOe]:{accessors:["ntrpRating","dntrpRatingHundredths"],attributes:{ustaRatingType:""},accessor:"dntrpRatingHundredths",defaultInitialization:3,decimalsCount:1,ascending:!0,range:[1,7]},UTR:{defaultInitialization:6,accessors:["utrRating"],accessor:"utrRating",decimalsCount:2,ascending:!0,range:[1,16]},[vpe]:{attributes:{confidence:{generator:!0,range:[60,100]}},accessors:["wtnRating","confidence"],defaultInitialization:23,accessor:"wtnRating",ascending:!1,decimalsCount:2,range:[40,1]}},sOe=0;function lOe({tournamentParticipants:t,adHocRatings:e={},possiblePairings:i,uniquePairings:n,maxIterations:r,deltaObjects:o,valueObjects:a,eventType:s,scaleName:l,salted:c}){n.forEach(v=>{const y=function({tournamentParticipants:w,adHocRatings:U,eventType:D,scaleName:E,pairing:C}){var M;const N=((M=Gs[E])==null?void 0:M.defaultInitialization)??sOe;return C.split("|").map(R=>{var A;if(D===Bc){const _=(A=w==null?void 0:w.find(k=>k.participantId===R))==null?void 0:A.individualParticipantIds;return _?_==null?void 0:_.map(k=>U[k]||N):2*N}return U[R]||N})}({tournamentParticipants:t,adHocRatings:e,scaleName:l,eventType:s,pairing:v}),b=typeof c=="number"&&c||.5,I=c&&(Math.round(Math.random())?b:-1*b)||0,T=Math.abs(y[0]-y[1])+I,S=Math.abs(y[0]-y[1]);o[v]=S,a[v]||(a[v]=0),a[v]+=T?Math.pow(T,2):0});const u=n.map(v=>({pairing:v,value:a[v]})).sort((v,y)=>v.value-y.value),{pairingValues:d}=function({possiblePairings:v,valueObjects:y}){const b={};for(const T of Object.keys(v)){const S=v[T].map(w=>I(T,w));b[T]=S.sort((w,U)=>w.value-U.value)}function I(T,S){const w=Dv(T,S);return{opponent:S,value:y[w]}}return{pairingValues:b}}({possiblePairings:i,valueObjects:a}),{candidate:p,candidatesCount:h,deltaCandidate:f,iterations:m}=function({maxIterations:v=4e3,valueSortedPairings:y,pairingValues:b,valueObjects:I,deltaObjects:T}){const S=Object.assign({},...y.map(F=>({[F.pairing]:F.value}))),w=Object.keys(b);let U=[];const D=CY({actorsCount:w.length,valueSortedPairings:y,pairingValueMap:S,deltaObjects:T,valueObjects:I}),E=[aL(D)];U.push(D);let C,M=D.value,N=D,R=0,A=0,_=w.length;do _-=1,C=w.length*b[w[0]].length;while(C>v&&_>5);const k=[];w.forEach(F=>{b[F].slice(0,_).forEach(B=>{A+=1;const $=Dv(F,B.opponent);if(!k.includes($)){const V=CY({stipulated:[[F,B.opponent]],actorsCount:w.length,valueSortedPairings:y,pairingValueMap:S,deltaObjects:T,valueObjects:I});if(!E.includes(aL(V))){E.push(aL(V)),U.push(V);const{maxDelta:H,value:z}=V;H<N.maxDelta&&(N=V),(z<M||z===M&&Math.round(Math.random()))&&(M=z),k.push($),R+=1}}}),U=U.filter(B=>Math.abs(B.value-M)<5)}),U.sort((F,B)=>F.maxDiff-B.maxDiff);const O=es(U);return{candidatesCount:R,deltaCandidate:N,maxIterations:v,iterations:A,candidate:O}}({valueSortedPairings:u,maxIterations:r,pairingValues:d,deltaObjects:o,valueObjects:a}),{participantIdPairings:g}=p;return{participantIdPairings:g,candidatesCount:h,deltaCandidate:f,iterations:m,candidate:p}}const cOe=100,uOe=100,dOe=4e3;function D3({encounterValue:t=cOe,sameTeamValue:e=uOe,maxIterations:i=dOe,generateMatchUps:n=!0,ignoreLastRoundNumber:r,iterationMatchUps:o,tournamentRecord:a,participantIds:s,drawDefinition:l,adHocRatings:c,salted:u=.5,roundNumber:d,structureId:p,matchUpIds:h,eventType:f,structure:m,scaleName:g,idPrefix:v,isMock:y,event:b}){if(!l)return{error:rt};if(!m&&!p)return{error:Cn};if(m||(m=kt({drawDefinition:l,structureId:p}).structure),!bn(m))return{error:bg};if(!(s!=null&&s.length))return{error:Ig};const I=[...o??[],...(m==null?void 0:m.matchUps)??[]],{encounters:T}=function({matchUps:B}){const $=[];for(const V of B){const H=V.sides.map(li);if(H.length===2){const[z,G]=H,W=Dv(z,G);$.includes(W)||$.push(W)}}return{encounters:$}}({matchUps:I}),S=(a==null?void 0:a.participants)??[],{valueObjects:w}=function({encounters:B,tournamentParticipants:$,encounterValue:V,sameTeamValue:H}){const z={};for(const W of B)z[W]||(z[W]=0),z[W]+=V;const G=$==null?void 0:$.filter(({participantType:W})=>W===on);if(G)for(const W of G){const K=W.individualParticipantIds??[],{uniquePairings:Z}=EY({participantIds:K});for(const Y of Z)z[Y]||(z[Y]=0),z[Y]+=H}return{valueObjects:z}}({tournamentParticipants:S,encounterValue:t,sameTeamValue:e,encounters:T}),{uniquePairings:U,possiblePairings:D,deltaObjects:E}=EY({participantIds:s}),C={tournamentParticipants:S,possiblePairings:D,drawDefinition:l,participantIds:s,uniquePairings:U,maxIterations:i,adHocRatings:c,deltaObjects:E,valueObjects:w,eventType:f,scaleName:g,structure:m,salted:u},{candidatesCount:M,participantIdPairings:N,iterations:R,candidate:A}=lOe(C);if(!M)return{error:Jz};let _,k;if(n){const B=Wk({structureId:m==null?void 0:m.structureId,ignoreLastRoundNumber:r,participantIdPairings:N,newRound:!0,drawDefinition:l,roundNumber:d,matchUpIds:h,idPrefix:v,isMock:y,event:b});if(B.error)return B;_=B.roundNumber,k=B.matchUps}const{maxDelta:O,maxDiff:F}=A;return{roundNumber:_,participantIdPairings:N,candidatesCount:M,...le,iterations:R,matchUps:k,maxDelta:O,maxDiff:F}}function P3(t){const{tournamentRecords:e}=t||{};if(typeof e!="object"||!Object.keys(e).length)return{error:Wn};const i=[],n={},r={},o={},a=[],s={},l=[];for(const c of Object.values(e)){const{participantIdsWithConflicts:u,mappedMatchUps:d,participantMap:p,participants:h,matchUps:f,derivedEventInfo:m,derivedDrawInfo:g}=Qn({...t,tournamentRecord:c});Object.assign(s,d),Object.assign(n,p),Object.assign(r,m),Object.assign(o,g),i.push(...h??[]),a.push(...f??[]),u==null||u.forEach(v=>{l.includes(v)||l.push(v)})}return{participantIdsWithConflicts:l,derivedEventInfo:r,derivedDrawInfo:o,participantMap:n,mappedMatchUps:s,participants:i,...le,matchUps:a}}function C3({tournamentRecord:t,participantId:e}){if(!t)return{error:je};if(!e)return{error:Hr};const i=[e].concat((t.participants??[]).filter(n=>{var r;return(n==null?void 0:n.participantType)&&[on,qt].includes(n.participantType)&&((r=n.individualParticipantIds)==null?void 0:r.includes(e))}).map(n=>n.participantId));return{eventDetails:(t.events??[]).filter(n=>ua(((n==null?void 0:n.entries)??[]).map(r=>r.participantId),i)).map(n=>({eventName:n.eventName,eventId:n.eventId}))}}function E3({tournamentRecord:t,participantId:e}){if(!t)return{error:je};if(!e)return{error:Hr};const{participants:i}=Qn({participantFilters:{participantTypes:[on,qt,gl]},tournamentRecord:t});return(i??[]).filter(n=>{var r;return(r=n.individualParticipantIds)==null?void 0:r.includes(e)}).reduce((n,r)=>{const o=r.participantType;return o&&(n[o]||(n[o]=[]),n[o].push(r)),n},{})}function M3({participantFilters:t={},tournamentRecord:e}){if(!e)return{error:je};if(typeof t!="object")return{error:Af,context:{participantFilters:t}};const i=Vr({tournamentRecord:e,contextFilters:{eventIds:t.eventIds}}).matchUps??[],n=Object.assign({},...i.map(s=>({[s.matchUpId]:s}))),r=i.filter(({schedule:s})=>s&&Object.keys(s).length),o=rc({tournamentRecord:e,matchUps:i}).sourceMatchUpIds??[],a={};for(const s of r){const{sides:l}=s;let c;const u=(l==null?void 0:l.map(p=>{if(p.participant)return[p.participant].concat(...p.participant.individualParticipants||[]);o[s.matchUpId]&&!c&&(c=(o[s.matchUpId]||[]).map(h=>n[h]).filter(({winningSide:h,bye:f})=>!h&&!f))}).filter(Boolean).flat())??[];for(const p of u){const{participantId:h}=p;a[h]||(a[h]={potentialMatchUps:[],participant:p,matchUps:[]}),a[h].matchUps.push(s)}const d=(c==null?void 0:c.map(({sides:p})=>p).flat().map(({participant:p})=>p&&[p].concat(...p.individualParticipants||[])).filter(Boolean).flat())||[];for(const p of d){const{participantId:h}=p;a[h]||(a[h]={potentialMatchUps:[],participant:p,matchUps:[]}),a[h].potentialMatchUps.push(s)}}return{participantSchedules:Object.values(a).filter(({participant:s})=>!(t.participantIds&&!t.participantIds.includes(s.participantId)||t.participantTypes&&!t.participantTypes.includes(s.participantType))),...le}}function R3({tournamentRecord:t,participantId:e}){if(!t)return{error:je};if(!e)return{error:Hr};const{participant:i}=Dg({tournamentRecord:t,participantId:e});if(!i)return{error:rr};const{timeItem:n}=Hu({itemType:vk,element:i});return n&&n.itemValue===PR&&PR}var pOe=Object.freeze({__proto__:null,filterParticipants:sC,getCompetitionParticipants:P3,getPairedParticipant:Kl,getParticipantEventDetails:C3,getParticipantMembership:E3,getParticipantScaleItem:yw,getParticipantSchedules:M3,getParticipantSignInStatus:R3,getParticipantTimeItem:$W,getParticipants:Qn,getScaleValues:O0,participantScaleItem:ud,validateLineUp:kk});function N3({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:je};const{appliedPolicies:n}=Gi({tournamentRecord:t}),r=n==null?void 0:n[jm];return((r==null?void 0:r.matchUpFormats)||[]).filter(({categoryNames:o,categoryTypes:a})=>!e&&!a||e&&(o==null?void 0:o.includes(e))||i&&(a==null?void 0:a.includes(i)))}function qk({tournamentRecord:t,categoryName:e,categoryType:i}){if(!t)return{error:je};const{appliedPolicies:n}=Gi({tournamentRecord:t}),r=n==null?void 0:n[$2];return((r==null?void 0:r.allowedDrawTypes)||[]).filter(({categoryNames:o,categoryTypes:a})=>!e&&!a||e&&(o==null?void 0:o.includes(e))||i&&(a==null?void 0:a.includes(i)))}function Yk({tournamentRecord:t}){if(!t)return{error:je};const e=((t==null?void 0:t.participants)??[]).reduce((i,n)=>{const{participantId:r}=n;return(n.penalties??[]).forEach(o=>{const{penaltyId:a}=o||{};i[a]?i[a].participants.push(r):i[a]={...o,participantIds:[r]}}),i},{});return{penalties:Object.values(e)}}function A3({tournamentRecords:t}){if(typeof t!="object"||!Object.keys(t).length)return{error:Wn};const e=[];for(const i of Object.values(t)){const{penalties:n}=Yk({tournamentRecord:i});e.push(...n??[])}return{penalties:e}}function pb({tournamentRecord:t}){if(!t)return{error:je};const e=(({tournamentId:i,tournamentRank:n,tournamentStatus:r,formalName:o,tournamentName:a,promotionalName:s,onlineResources:l,localTimeZone:c,startDate:u,endDate:d,hostCountryCode:p,tournamentContacts:h,tournamentAddresses:f})=>({tournamentId:i,tournamentRank:n,tournamentStatus:r,formalName:o,tournamentName:a,promotionalName:s,onlineResources:l,localTimeZone:c,startDate:u,endDate:d,hostCountryCode:p,tournamentContacts:h,tournamentAddresses:f}))(t);return{...le,tournamentInfo:ft(e,!1,!0)}}function Kk({tournamentRecords:t}){if(!bn(t))return{error:Wn};const e=Object.keys(t??{}).reduce((r,o)=>{const a=t[o],{tournamentInfo:{startDate:s,endDate:l}}=pb({tournamentRecord:a}),c=s&&new Date(zt(s));(!r.startDate||c&&c<r.startDate)&&(r.startDate=c);const u=l&&new Date(zt(l));return(!r.endDate||u&&u>r.endDate)&&(r.endDate=u),r},{startDate:void 0,endDate:void 0}),i=e.startDate&&zt(e.startDate.toISOString()),n=e.endDate&&zt(e.endDate.toISOString());return i&&n?{startDate:i,endDate:n}:{error:sce}}function _3({tournamentRecord:t,participantFilters:e}){if(!t)return{error:je};let i=t.participants||[];e&&(i=sC({participants:i,participantFilters:e,tournamentRecord:t}));const n={};return i.forEach(r=>{r.person&&(o=>{if(o.person){const{personId:a}=o.person;n[a]?n[a].participantIds.push(o.participantId):n[a]={...o.person,participantIds:[o.participantId]}}})(r)}),{tournamentPersons:Object.values(n)}}function hOe(t){var e,i,n,r,o;const a=(e=t.participants)==null?void 0:e.filter(({participantType:p})=>p===on),s=(a==null?void 0:a.length)===2,l=((i=t.events)==null?void 0:i.length)===1&&t.events[0],c=((n=l==null?void 0:l.drawDefinitions)==null?void 0:n.length)===1&&l.drawDefinitions[0],u=((r=c==null?void 0:c.structures)==null?void 0:r.length)===1&&c.structures[0],d=((o=u==null?void 0:u.positionAssignments)==null?void 0:o.length)===2;return!!(l.tieFormat&&s&&d)}function k3({tournamentRecord:t}){if(!t)return{error:je};const{drawsAnalysis:e}=bC({tournamentRecord:t}),i={isDual:hOe(t),drawsAnalysis:e};return{...le,analysis:i}}var fOe=Object.freeze({__proto__:null,analyzeDraws:bC,analyzeTournament:k3,getAllowedDrawTypes:qk,getAllowedMatchUpFormats:N3,getAppliedPolicies:Gi,getCompetitionDateRange:Kk,getCompetitionPenalties:A3,getPolicyDefinitions:Zp,getTournamentInfo:pb,getTournamentPenalties:Yk,getTournamentPersons:_3,getTournamentStructures:e3,getTournamentTimeItem:rC});function BR(t){var e;if(!t)return{};const i=[],n=t.tieFormatName,r=(e=t.collectionDefinitions)==null?void 0:e.map(o=>{const{matchUpType:a,matchUpFormat:s,matchUpCount:l,category:c,gender:u}=o;i.includes(s)||i.push(s);const d=c==null?void 0:c.ageCategoryCode;return[l,a===ey?"D":"S",d,s,u].join(";")}).join("|");return{tieFormatName:t&&n||"UNNAMED",matchUpFormats:i,tieFormatDesc:r}}function Ap({considerations:t={},descendant:e,ancestor:i}){var n,r;const o={},a={},{matchUpFormats:s,tieFormatDesc:l}=BR(e),{matchUpFormats:c,tieFormatDesc:u}=BR(i),d=ti((s??[]).filter(w=>!(c??[]).includes(w)).concat((c??[]).filter(w=>!(s??[]).includes(w)))),p=!(!(t!=null&&t.collectionName)||e.collectionDefinitions.map(({collectionName:w})=>w).join("|")===i.collectionDefinitions.map(({collectionName:w})=>w).join("|")),h=!(!(t!=null&&t.collectionOrder)||e.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")===i.collectionDefinitions.map(({collectionOrder:w})=>w).join("|")),f=Object.assign({},...((e==null?void 0:e.collectionDefinitions)||[]).map(w=>({[w.collectionId]:w}))),m=Object.assign({},...((i==null?void 0:i.collectionDefinitions)||[]).map(w=>({[w.collectionId]:w})));o.collectionIds=y7(Object.keys(f),Object.keys(m)),a.collectionIds=y7(Object.keys(m),Object.keys(f)),o.collectionsValue=MY(f),a.collectionsValue=MY(m),o.groupsCount=((n=i==null?void 0:i.collectionGroups)==null?void 0:n.length)??(0-(((r=e==null?void 0:e.collectionGroups)==null?void 0:r.length)??0)||0),a.groupsCount=o.groupsCount?-1*o.groupsCount:0;const g=o.collectionsValue.totalValue-a.collectionsValue.totalValue,v=o.collectionsValue.totalMatchUps-a.collectionsValue.totalMatchUps,y=a.collectionsValue.assignmentValues.length!==o.collectionsValue.assignmentValues.length,b=a.collectionsValue.assignmentValues.some((w,U)=>{const D=o.collectionsValue.assignmentValues[U];return!D||w.valueKey!==D.valueKey||w.value!==D.value||!!Array.isArray(w.value)&&w.value.every((E,C)=>D.value[C]===E)}),I=p||h||u!==l||y||b||g!==0,T=[...a.collectionsValue.invalidValues,...o.collectionsValue.invalidValues],S=T.length&&T;return{matchUpFormatDifferences:d,matchUpCountDifference:v,descendantDifferences:o,ancestorDifferences:a,orderDifference:h,valueDifference:g,nameDifference:p,descendantDesc:l,ancestorDesc:u,...le,different:I,invalid:S}}function MY(t){const e=[],i=[];let n=0;return{totalValue:Object.keys(t).sort(Rk).reduce((r,o)=>{const a=t[o],{collectionValueProfiles:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=a,h={collectionValueProfiles:s,collectionValue:l,matchUpValue:u,scoreValue:d,setValue:p},f=Object.keys(h).filter(g=>![void 0,null].includes(h[g]));f.length!==1&&e.push({collectionId:o});const m=f[0];if(m){const g=m==="collectionValueProfiles"?Object.values(s):h[m];i.push({valueKey:m,value:g})}return n+=c,s?r+s.reduce((g,v)=>g+v.value,0):c?$t(u)?r+u*c:$t(d)?r+d*c:$t(p)?r+p*c:r+l:r},0),totalMatchUps:n,invalidValues:e,assignmentValues:i}}function x3(t){Object.assign(t,{inContext:!0});const{matchUp:e,error:i}=ype(t);return{matchUp:ft(e,!0,!0),error:i}}function ype({participantsProfile:t,afterRecoveryTimes:e,tournamentRecord:i,contextContent:n,contextProfile:r,drawDefinition:o,nextMatchUps:a,matchUpId:s,inContext:l,eventId:c,drawId:u,event:d}){var p;if(!i)return{error:je};if(typeof s!="string")return{error:co};if(!o||!d){const m=(Vr({tournamentRecord:i,nextMatchUps:a}).matchUps??[]).find(g=>g.matchUpId===s);if(!m)return{error:xo};({eventId:c,drawId:u}=m),{event:d,drawDefinition:o}=us({tournamentRecord:i,eventId:c,drawId:u})}if(!o)return{error:ml};r&&!n&&(n=Xp({tournamentRecord:i,contextProfile:r}));const h={surfaceCategory:(d==null?void 0:d.surfaceCategory)??i.surfaceCategory,indoorOutDoor:(d==null?void 0:d.indoorOutdoor)??i.indoorOutdoor,endDate:(d==null?void 0:d.endDate)??i.endDate,tournamentId:i.tournamentId,eventId:c??(d==null?void 0:d.eventId),drawId:u},{participants:f=[]}=rb({participantsProfile:t,tournamentRecord:i,contextProfile:r,inContext:l});if(a){const m=(Fa({context:l?h:void 0,participants:f,afterRecoveryTimes:e,contextContent:n,contextProfile:r,drawDefinition:o,nextMatchUps:a,inContext:l,event:d}).matchUps??[]).find(v=>v.matchUpId===s);if(!m)return{error:xo};const g=(p=o==null?void 0:o.structures)==null?void 0:p.find(v=>v.structureId===m.structureId);return{drawDefinition:o,structure:g,matchUp:m}}{const{matchUp:m,structure:g}=vn({context:l?h:void 0,tournamentParticipants:f,afterRecoveryTimes:e,contextContent:n,drawDefinition:o,contextProfile:r,matchUpId:s,inContext:l,event:d});return{matchUp:m,structure:g,drawDefinition:o}}}function O3({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,structure:r,eventId:o,drawId:a,event:s}){var l,c,u,d,p;if(!t)return{error:je};if(!(a||s||i||n))return ce({result:{error:bt},stack:"getTieFormat"});o&&!s&&(s=(l=t.events)==null?void 0:l.find(y=>y.eventId===o));const h=x3({tournamentRecord:t,drawDefinition:e,matchUpId:n,drawId:a,event:s});if(n&&h!=null&&h.error)return h;if(!e&&h!=null&&h.drawDefinition&&(e=h==null?void 0:h.drawDefinition),!(r=r??(h==null?void 0:h.structure))&&i&&!n){if(!e)return{error:Yc};const y=kt({drawDefinition:e,structureId:i});if(y.error)return y;r=y.structure}const f=((r==null?void 0:r.tieFormat)||(r==null?void 0:r.tieFormatId))&&((c=jo({structure:r,drawDefinition:e,event:s}))==null?void 0:c.tieFormat),m=((e==null?void 0:e.tieFormat)||(e==null?void 0:e.tieFormatId))&&((u=jo({drawDefinition:e,event:s}))==null?void 0:u.tieFormat),g=(d=jo({event:s}))==null?void 0:d.tieFormat,v=(p=jo({matchUp:h==null?void 0:h.matchUp,drawDefinition:e,structure:r,event:s}))==null?void 0:p.tieFormat;return{...le,matchUp:h==null?void 0:h.matchUp,structureDefaultTieFormat:po(f),eventDefaultTieFormat:po(g),drawDefaultTieFormat:po(m),tieFormat:po(v),structure:r}}var mOe=Object.freeze({__proto__:null,compareTieFormats:Ap,getTieFormat:O3,tieFormatGenderValidityCheck:Bk,validateCollectionDefinition:vC});function Zk({defaultRecoveryMinutes:t=0,defaultAverageMinutes:e,tournamentRecords:i,matchUpFormat:n,categoryName:r,categoryType:o,tournamentId:a,eventType:s,eventId:l}){if(!Rs({matchUpFormat:n}))return{error:K_};let c;return Object.keys(i).filter(u=>!a||u===a).forEach(u=>{var d;if(c)return;const p=i[u],h=l?(d=us({tournamentRecord:p,eventId:l}))==null?void 0:d.event:void 0;return c=eC({tournamentRecord:p,matchUpFormat:n,categoryName:r,categoryType:o,eventType:s,event:h}),(c==null?void 0:c.averageMinutes)||(c==null?void 0:c.recoveryMinutes)}),{recoveryMinutes:(c==null?void 0:c.recoveryMinutes)||t,averageMinutes:(c==null?void 0:c.averageMinutes)||e,typeChangeRecoveryMinutes:(c==null?void 0:c.typeChangeRecoveryMinutes)||(c==null?void 0:c.recoveryMinutes)||t}}function SC({scheduleCompletedMatchUps:t,containedStructureIds:e,tournamentRecords:i,periodLength:n=30,matchUps:r,rounds:o}){if(typeof i!="object")return{error:Wn};if(!Array.isArray(o))return{error:bt,info:_d("rounds")};const a={},s=[];o.sort((p,h)=>(p.sortOrder??0)-(h.sortOrder??0)),e=e??Object.assign({},...Object.values(i).map(p=>V0({tournamentRecord:p}).containedStructures)),r||({matchUps:r}=Vc({nextMatchUps:!0,tournamentRecords:i}));let l=0;const c={},u={},d={};return{scheduledRoundsDetails:o.flatMap(p=>{var h;const f=p.periodLength||n,m=[];e!=null&&e[p.structureId]?m.push(...e[p.structureId]):m.push(p.structureId);let g=r?ev({tournamentIds:[p.tournamentId],roundNumbers:[p.roundNumber],matchUpIds:p.matchUpIds,eventIds:[p.eventId],drawIds:[p.drawId],processContext:!0,structureIds:m,matchUps:r}).sort(ob):[];const{segmentNumber:v,segmentsCount:y}=p.roundSegment||{};if($t(v)&&Lc(g==null?void 0:g.length)&&Lc(y)&&v>0&&v<=y&&y<(g==null?void 0:g.length)&&!((h=p.matchUpIds)!=null&&h.length)){const S=g.length/y,w=S*(v-1);g=g.slice(w,w+S)}const b=i[p.tournamentId],I=us({drawId:p.drawId,tournamentRecord:b}).event,T=[];for(const S of g){const w=S.matchUpFormat;w&&(a[w]||(a[w]=[],a[w].push(S)),T.push(w))}for(const S of T){const{eventType:w,category:U}=I??{},{categoryName:D,ageCategoryCode:E}=U??{},{typeChangeRecoveryMinutes:C,recoveryMinutes:M,averageMinutes:N,error:R}=Zk({categoryName:D??E,categoryType:U==null?void 0:U.categoryType,tournamentId:p.tournamentId,eventId:p.eventId,tournamentRecords:i,matchUpFormat:S,eventType:w});if(R)return{error:R,round:p};const A=g.filter(_=>(t||!no.includes(_.matchUpStatus))&&_.matchUpStatus!==Ri).map($r);return A.forEach(_=>{d[_]={typeChangeRecoveryMinutes:C,recoveryMinutes:M,averageMinutes:N},c[_]=M,u[_]=N}),s.push(...A),l=Math.max(N||0,l),{roundPeriodLength:f,recoveryMinutes:M,averageMinutes:N,matchUpIds:A,hash:`${N}|${f}`}}}),greatestAverageMinutes:l,matchUpFormatCohorts:a,recoveryMinutesMap:c,averageMinutesMap:u,orderedMatchUpIds:s,minutesMap:d,...le}}function bpe({schedulingProfile:t,venueIds:e,eventIds:i,drawIds:n}){const r=[];return{updatedSchedulingProfile:t==null?void 0:t.map(o=>{const a=zt(o==null?void 0:o.scheduleDate);if(!a)return void r.push(`Invalid date: ${o==null?void 0:o.scheduledDate}`);const s=((o==null?void 0:o.venues)||[]).map(l=>{const{rounds:c,venueId:u}=l;if(!(e!=null&&e.includes(u)))return void r.push(`Missing venueId: ${u}`);const d=c.filter(p=>{const h=i.includes(p.eventId)&&n.includes(p.drawId);return h||r.push(`Invalid eventId: ${p.eventId} or drawId: ${p.drawId}`),h});return d.length?{venueId:u,rounds:d}:void 0}).filter(Boolean);return s.length&&a&&{...o,venues:s}}).filter(Boolean),modifications:r.length,issues:r}}function Xk({tournamentRecords:t,schedulingProfile:e}){if(!e)return{valid:!0};if(!Array.isArray(e))return{valid:!1,error:Re};const{venueIds:i,tournamentsMap:n}=function(s){const l=(s==null?void 0:s.tournamentRecords)&&Object.values(s==null?void 0:s.tournamentRecords)||[],c={},{venueIds:u,eventIds:d,drawIds:p,structureIds:h,tournamentIds:f}=l.reduce((m,g)=>{const{tournamentIds:v,tournamentMap:y,structureIds:b,venueIds:I,eventIds:T,drawIds:S}=function(w){const{tournamentRecord:U={},tournamentMap:D={},requireCourts:E}=w,C=[],M=[],N=[],R=[],A=((U==null?void 0:U.venues)||[]).map(({venueId:k,courts:O})=>(!E||(O==null?void 0:O.length))&&k),_=U==null?void 0:U.tournamentId;return _&&(C.push(_),D[_]={},((U==null?void 0:U.events)||[]).forEach(k=>{const O=k.eventId;N.push(O),D[_][O]={},(k.drawDefinitions||[]).forEach(F=>{const B=F.drawId;R.push(B),D[_][O][B]={};const{structures:$}=Nd({drawDefinition:F});($||[]).forEach(V=>{var H;const z=V.structureId,{matchUps:G}=zi({structure:V}),{roundMatchUps:W}=ba({matchUps:G}),K=W&&Object.keys(W).map(Z=>parseInt(Z));D[_][O][B][z]=K,M.push(z),(H=V.structures)!=null&&H.length&&V.structures.forEach(Z=>{M.push(Z.structureId),D[_][O][B][Z.structureId]=K})})})})),{tournamentMap:D,tournamentIds:C,structureIds:M,venueIds:A,eventIds:N,drawIds:R}}({tournamentRecord:g});return I.forEach(w=>{m.venueIds.includes(w)||m.venueIds.push(w)}),m.tournamentIds.push(...v),m.structureIds.push(...b),m.eventIds.push(...T),m.drawIds.push(...S),Object.assign(c,y),m},{tournamentIds:[],structureIds:[],venueIds:[],eventIds:[],drawIds:[]});return{tournamentsMap:c,tournamentIds:f,structureIds:h,venueIds:u,eventIds:d,drawIds:p}}({tournamentRecords:t});let r,o;const a=e.every(s=>{const{scheduleDate:l,venues:c}=s;return!!Ss(l)&&c.every(u=>{const{venueId:d,rounds:p}=u;return typeof d!="string"?(o="venueId should be a string",!1):Array.isArray(p)?i.includes(d)?!!p.every(h=>{var f,m,g;if(!h)return o="empty round",!1;const{roundSegment:v,tournamentId:y,structureId:b,roundNumber:I,eventId:T,drawId:S}=h,w=(g=(m=(f=n==null?void 0:n[y])==null?void 0:f[T])==null?void 0:m[S])==null?void 0:g[b],U=w==null?void 0:w.includes(I);U||(o="Invalid rounds");const{segmentNumber:D,segmentsCount:E}=v||{},C=!v||$t(D)&&Lc(E)&&D<=E;return C||(o="Invalid segment"),U&&C}):(r=_0,!1):(o="rounds should be an array",!1)})});return a||r||(r=Re),{valid:!!a,error:r,info:o}}function Ipe({dates:t=[],extension:e}){var i;if(!e)return!1;if(typeof e.value=="boolean"&&e.value)return!0;if(!t.length)return!1;const n=bn(e.value)?(i=e.value)==null?void 0:i.dates:void 0;if(Array.isArray(n))return n!=null&&n.length?!!n.filter(r=>!t.length||t.includes(r)).length:!1}function wpe({convertExtensions:t,ignoreDisabled:e,venue:i,court:n}){var r;const o={...ft(n,t,!0),venueId:i.venueId},{extension:a}=ei({name:Rc,element:n});if(e&&a){const s=bn(a.value)?(r=a.value)==null?void 0:r.dates:void 0,l=(a==null?void 0:a.value)===!0?[]:o.dateAvailability.map(c=>{const u=c.date;if(u&&!s.includes(u))return c}).filter(Boolean);o.dateAvailability=l}return{inContextCourt:o}}function eh(t){const{convertExtensions:e,ignoreDisabled:i,venueIds:n=[],dates:r}=t,o=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},a=[],s=[],l=[],c=[];return Object.keys(o).filter(u=>!t.tournamentId||u===t.tournamentId).forEach(u=>{const d=o[u];for(const p of d.venues??[])if(!n.length||n.includes(p.venueId)){if(i){const{extension:h}=ei({name:Rc,element:p});if(h!=null&&h.value)continue}a.includes(p.venueId)||(c.push(ft(p,e,!0)),a.push(p.venueId));for(const h of p.courts??[])if(!s.includes(h.courtId)){if(i){const{extension:m}=ei({name:Rc,element:h});if(Ipe({extension:m,dates:r}))continue}const{inContextCourt:f}=wpe({convertExtensions:e,ignoreDisabled:i,venue:p,court:h});l.push(f),s.push(h.courtId)}}}),{courts:l,venues:c,...le}}function TC({tournamentRecords:t,requireCourts:e,dates:i}){return typeof t!="object"||!Object.keys(t).length?{error:Wn}:Object.keys(t).reduce((n,r)=>{const o=t[r],{venues:a}=function({convertExtensions:s,tournamentRecord:l,ignoreDisabled:c,dates:u}){if(!l)return{error:Wn};const d=ft(l.venues??[],s).filter(h=>{if(!c)return h;const{extension:f}=ei({name:Rc,element:h});return!(f!=null&&f.value)&&h}).filter(Boolean),p=d.reduce((h,f)=>{const m=((f==null?void 0:f.courts)||[]).filter(g=>{if(!c&&!(u!=null&&u.length))return g;const{extension:v}=ei({name:Rc,element:g});return Ipe({extension:v,dates:u})}).filter(Boolean).map(g=>{const{inContextCourt:v}=wpe({convertExtensions:s,ignoreDisabled:c,venue:f,court:g});return v});return m.length?h.concat(m):h},[]);return{venues:d,courts:p}}({tournamentRecord:o,dates:i});return a==null||a.forEach(s=>{const{venueId:l,courts:c}=s;(!e||c!=null&&c.length)&&!n.venueIds.includes(l)&&(n.venues.push(s),n.venueIds.push(l))}),n},{venues:[],venueIds:[]})}function th({tournamentRecords:t,tournamentRecord:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Wn};const{extension:i}=ei({element:e,name:Xv,tournamentRecords:t,discover:!0});let n=(i==null?void 0:i.value)||[];if(n.length){const{venueIds:r}=TC({requireCourts:!0,tournamentRecords:t}),{eventIds:o,drawIds:a}=h3({tournamentRecords:t}),{updatedSchedulingProfile:s,modifications:l,issues:c}=bpe({schedulingProfile:n,venueIds:r,eventIds:o,drawIds:a});if(l){n=s;const u=W0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:n});return u.error?u:{schedulingProfile:n,modifications:l,issues:c}}}return{schedulingProfile:n,modifications:0}}function W0({tournamentRecords:t,tournamentRecord:e,schedulingProfile:i}){const n=Xk({tournamentRecords:t,schedulingProfile:i});return n.error?n:i?Ii({tournamentRecords:t,discover:!0,extension:{name:Xv,value:i}}):ia({element:e,name:Xv,tournamentRecords:t,discover:!0})}function UC(t){const{tournamentRecord:e}=t,i=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(!t.schedulingProfile){const{modifications:c,issues:u}=th({tournamentRecords:i,tournamentRecord:e});return{success:!c,modifications:c,issues:u}}const{venueIds:n}=TC({tournamentRecords:i}),{eventIds:r,drawIds:o}=h3({tournamentRecords:i}),{updatedSchedulingProfile:a,modifications:s,issues:l}=bpe({schedulingProfile:t.schedulingProfile,venueIds:n,eventIds:r,drawIds:o});return s?{...W0({schedulingProfile:a,tournamentRecords:i}),modifications:s,issues:l}:{...le,modifications:s,issues:l}}function L3(t){const{scheduleDates:e=[],tournamentRecords:i,periodLength:n=30}=t??{};if(typeof i!="object")return{error:W_};if(!Array.isArray(e))return{error:Re};if(!e.every(Ss))return{error:Ha};const r=[];let o=0;const a={},{schedulingProfile:s}=th({tournamentRecords:i});if(!s)return{issues:r,...le};const{matchUps:l}=Vc({nextMatchUps:!0,tournamentRecords:i});for(const u of s){const{scheduleDate:d,venues:p=[]}=u;if(!(e!=null&&e.length)||e.includes(d)){for(const h of p||[])if(h){const{rounds:f}=h,m=[],{orderedMatchUpIds:g,scheduledRoundsDetails:v}=SC({tournamentRecords:i,periodLength:n,matchUps:l,rounds:f}),{matchUpDependencies:y}=rc({tournamentRecords:i,matchUps:l}),b=I=>{let T;return v==null||v.find((S,w)=>{const U=S.matchUpIds.includes(I);return U&&(T=w),U}),T};if(g==null||g.forEach((I,T)=>{var S;const w=sr(g.slice(T+1),((S=y==null?void 0:y[I])==null?void 0:S.matchUpIds)||[]);w.length&&m.push({matchUpId:I,shouldBeAfter:w})}),m.length){o+=m.length;const I=m.map(({matchUpId:T,shouldBeAfter:S})=>{const w=b(T),U=ti(S.map(b));return a[d]||(a[d]={}),a[d][w]||(a[d][w]=[]),U.forEach(D=>{a[d][w].includes(D)||a[d][w].push(D)}),{matchUpId:T,matchUpRoundIndex:w,earlierRoundIndices:U,shouldBeAfter:S}});r.push(...I)}}}}const c={matchUpIdShouldBeAfter:Object.assign({},...r.map(u=>{const{matchUpId:d,shouldBeAfter:p,earlierRoundIndices:h}=u;return{[d]:{earlierRoundIndices:h,shouldBeAfter:p}}}))};return{issuesCount:o,profileIssues:c,roundIndexShouldBeAfter:a,...le}}function Cg(t){const{tournamentRecords:e,requestType:i}=t,n=Ln(t,[{[Oo]:!0}]);if(n.error)return n;const r={};for(const o of Object.values(e)){const{extension:a}=ei({element:o,name:L0}),s=(a==null?void 0:a.value)||[];for(const l of s){const{personId:c,requests:u}=l||{};r[c]||(r[c]=[]);for(const d of u)i&&d.requestType!==i||r[c].push(d)}}return{personRequests:r,...le}}var gOe=Object.freeze({__proto__:null,getPersonRequests:Cg,getScheduledRoundsDetails:SC,getSchedulingProfile:th,getSchedulingProfileIssues:L3});function F3(t){const{entries:e=[],entryStatus:i,stage:n}=t;return Math.max(...e.filter(r=>!(n&&n!==r.entryStage||i&&r.entryStatus!==i||isNaN(r.entryPosition))).map(({entryPosition:r})=>Ct(r||0)),0)}var vOe=Object.freeze({__proto__:null,getEntriesAndSeedsCount:Hk,getMaxEntryPosition:F3});function Spe({tournamentRecords:t,extensionName:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Wn};const i=[];let n;for(const r of Object.values(t)){const{extension:o}=ei({element:r,name:e});o&&!n&&(i.push({params:{extension:o,discover:!0},method:"addExtension"}),n=!0);const a=r.events??[];for(const s of a){const{eventId:l}=s,{extension:c}=ei({name:e,element:s});c&&i.push({params:{eventId:l,extension:c},method:"addEventExtension"})}}return{methods:i}}function B3({tournamentRecords:t}){return Spe({extensionName:Ep,tournamentRecords:t})}const sL="ADULT",lL="JUNIOR",C1="WHEELCHAIR",Tpe={[wg]:{allowModificationWhenMatchUpsScheduled:{courts:!1,venues:!1},defaultTimes:{averageTimes:[{categoryNames:[],minutes:{default:90}}],recoveryTimes:[{minutes:{[Pn]:30,default:60}}]},defaultDailyLimits:{[vr]:2,[Pn]:2,total:3},matchUpAverageTimes:[{matchUpFormatCodes:[Xs],averageTimes:[{categoryNames:[],minutes:{default:90}},{categoryTypes:[C1],minutes:{default:120}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:85}}]},{matchUpFormatCodes:["SET3-S:6/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:70}}]},{matchUpFormatCodes:["SET3-S:4NOAD-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB7"],averageTimes:[{categoryNames:[],minutes:{default:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7"],averageTimes:[{categoryNames:[],minutes:{default:50}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB10"],averageTimes:[{categoryNames:[],minutes:{default:55}}]},{matchUpFormatCodes:["SET3-S:4/TB5@3"],averageTimes:[{categoryNames:[],minutes:{default:45}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7"],averageTimes:[{categoryNames:[],minutes:{default:40}}]},{matchUpFormatCodes:["SET1-S:5/TB9@4"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6/TB7"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:6NOAD"],averageTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB7","SET1-S:4/TB5@3","SET3-S:TB10","SET1-S:T20"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:4NOAD"],averageTimes:[{categoryNames:[],minutes:{default:20}}]},{matchUpFormatCodes:["SET1-S:TB10"],averageTimes:[{categoryNames:[],minutes:{default:10}}]}],matchUpRecoveryTimes:[{matchUpFormatCodes:["SET3-S:6/TB7","SET3-S:6/TB7-F:TB10","SET3-S:6/TB7-F:TB7"],recoveryTimes:[{categoryTypes:[sL,C1],minutes:{default:60,[Pn]:30}},{categoryTypes:[lL],minutes:{default:60,[Pn]:60}}]},{matchUpFormatCodes:["SET3-S:4/TB7-F:TB7","SET3-S:4/TB7-F:TB10","SET3-S:4NOAD-F:TB7","SET3-S:4/TB7","SET3-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[sL,C1],minutes:{default:30}},{categoryTypes:[lL],minutes:{default:60}}]},{matchUpFormatCodes:["SET1-S:8/TB7","SET1-S:8/TB7@7","SET1-S:5/TB9@4","SET1-S:6/TB7","SET1-S:6NOAD","SET1-S:4/TB7","SET1-S:4NOAD","SET3-S:TB10","SET1-S:T20"],recoveryTimes:[{categoryNames:[],minutes:{default:30}}]},{matchUpFormatCodes:["SET1-S:4/TB5@3"],recoveryTimes:[{categoryTypes:[sL,lL],minutes:{default:30}},{categoryTypes:[C1],minutes:{default:15}}]},{matchUpFormatCodes:["SET1-S:TB10"],recoveryTimes:[{categoryNames:[],minutes:{default:15}}]}],matchUpDailyLimits:[]}};function $3({tournamentRecord:t,matchUpFormats:e,categoryType:i,event:n}){if(!n)return{error:Fi};let r,o=[];if(e!=null&&e.length){const u=[];o=e.map(d=>{const p=typeof d=="string"?{matchUpFormat:d}:d;if(!u.includes(p==null?void 0:p.matchUpFormat)&&Rs({matchUpFormat:p==null?void 0:p.matchUpFormat}))return u.push(p.matchUpFormat),p}).filter(Boolean)}else{const{policy:u}=Tg({policyType:jm,tournamentRecord:t,event:n});if(u!=null&&u.matchUpFormats)o=u==null?void 0:u.matchUpFormats;else{const{extension:d}=ei({name:Ep,element:n});let p,h;({matchUpAverageTimes:p,matchUpRecoveryTimes:h}=d!=null&&d.value?d.value:Tpe[wg]),o=ti([...(p||[]).map(f=>f.matchUpFormatCodes),...(h||[]).map(f=>f.matchUpFormatCodes)].flat()).map(f=>({matchUpFormat:f})),r="default scheduling policy in use"}}const{eventType:a,eventId:s,category:l}=n,c=(l==null?void 0:l.categoryName)??(l==null?void 0:l.ageCategoryCode)??s;return s?It({eventMatchUpFormatTiming:o.map(({matchUpFormat:u,description:d})=>({matchUpFormat:u,description:d,...eC({tournamentRecord:t,matchUpFormat:u,categoryName:c,categoryType:i,eventType:a,event:n})})),info:r}):{error:Fi}}function Jk(t){const e=Ln(t,[{[qp]:!0},{[Ch]:u=>Rs({matchUpFormat:u}),[Yv]:K_,[hke]:!0}]);if(e.error)return e;const{tournamentRecord:i,matchUpFormat:n,event:r}=t,{extension:o}=ei({name:Ep,element:r}),a=o==null?void 0:o.value,{extension:s}=ei({element:i,name:Ep}),l=s==null?void 0:s.value,c=[(a==null?void 0:a.matchUpAverageTimes)&&oT({...a,matchUpFormat:n}),(l==null?void 0:l.matchUpAverageTimes)&&oT({...l,matchUpFormat:n})].find(u=>u);return{matchUpFormat:n,recoveryTimes:[(a==null?void 0:a.matchUpRecoveryTimes)&&aT({...a,matchUpFormat:n}),(l==null?void 0:l.matchUpRecoveryTimes)&&aT({...l,matchUpFormat:n})].find(u=>u),averageTimes:c}}function V3({tournamentRecords:t}){return Spe({extensionName:GP,tournamentRecords:t})}const DC=({scheduleAttributes:t=["scheduledDate","scheduledTime"],schedule:e={}})=>!!Object.keys(e).filter(i=>t.includes(i)).filter(i=>e[i]).length;function j3({scheduleAttributes:t=["scheduledDate","scheduledTime"],matchUps:e=[]}){if(!vl(e))return{error:Nf};if(!Array.isArray(t))return{error:Re};const i=e.filter(Boolean).filter(({schedule:n})=>DC({schedule:n,scheduleAttributes:t})).reduce((n,r)=>{const{schedule:o}=r,a=zt(o==null?void 0:o.scheduledDate),s=mn(o==null?void 0:o.scheduledTime);return a&&s&&(n[a]?n[a].push(r):n[a]=[r]),n},{});return Object.keys(i).forEach(n=>{i[n].sort((r,o)=>{var a,s;return Mce(mn((a=r.schedule)==null?void 0:a.scheduledTime),mn((s=o.schedule)==null?void 0:s.scheduledTime))})}),{...le,scheduledMatchUps:i}}function $R({schedulingProfile:t,matchUps:e=[]}){const i={},n=({eventId:s,drawId:l,structureId:c,roundNumber:u})=>`${s}|${l}|${c}${u}`;t!=null&&t.length&&t.map(({venues:s})=>s.map(({rounds:l})=>l)).flat().forEach(s=>{s.sort((l,c)=>(l.sortOrder||0)-(c.sortOrder||0)).forEach(({eventId:l,drawId:c,structureId:u,roundNumber:d},p)=>{const h=n({eventId:l,drawId:c,structureId:u,roundNumber:d});i[h]=p})});const r=[],o={noScheduledDate:[]};for(const s of e){const l=s.schedule||{},c=l.scheduledDate&&zt(l.scheduledDate)||l.scheduledTime&&zt(l.scheduledTime)||"noScheduledDate";o[c]||(o[c]=[]),o[c].push(s)}const a=Object.keys(o).sort();for(const s of a){const l=o[s],c={noScheduledTime:[]};for(const d of l){const p=d.schedule||{},h=p.scheduledTime&&mn(p.scheduledTime)||"noScheduledTime";c[h]||(c[h]=[]),c[h].push(d)}const u=Object.keys(c).sort();for(const d of u){const p=c[d];p.sort((h,f)=>(i[n(h)]||0)-(i[n(f)]||0)),r.push(...p)}}return r}function H3({courtPrefix:t="C|",minRowsCount:e,courtsData:i}){if(!Array.isArray(i))return{error:Re};const n=i==null?void 0:i.reduce((o,a)=>{const s=a.matchUps||[],l=Math.max(0,...s.map(c=>c.schedule.courtOrder||0));return l>o?l:o},1),r=nt(0,e?Math.max(e,n):n).map(o=>({matchUps:nt(0,i.length).map(a=>{const s=i[a],{courtId:l,venueId:c}=s;return{schedule:{courtOrder:o+1,venueId:c,courtId:l}}})}));return i.forEach((o,a)=>{var s;for(const l of o.matchUps){const c=(s=l.schedule)==null?void 0:s.courtOrder;c&&(r[c-1].matchUps[a]=l)}}),{courtPrefix:t,rows:r.map((o,a)=>Object.assign({rowId:`rowId-${a+1}`},...o.matchUps.map((s,l)=>({[`${t}${l}`]:s}))))}}function Qk(t){let{participants:e,contextContent:i,participantMap:n}=t;const{tournamentAppliedPolicies:r,scheduleVisibilityFilters:o,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,usePublishState:d,contextFilters:p,matchUpFilters:h,contextProfile:f,nextMatchUps:m,tournamentId:g,inContext:v,context:y,event:b}=t;if(!b)return{error:Fi};const{eventId:I,eventName:T,endDate:S}=b,w={...y,...It({eventId:I,eventName:T,endDate:S??(u==null?void 0:u.endDate),tournamentId:g??(u==null?void 0:u.tournamentId),indoorOutDoor:b.indoorOutdoor??(u==null?void 0:u.indoorOutdoor),surfaceCategory:b.surfaceCategory??(u==null?void 0:u.surfaceCategory)})};let U;!e&&u&&({participants:e,participantMap:n,groupInfo:U}=rb({participantsProfile:a,policyDefinitions:l,useParticipantMap:c,tournamentRecord:u,contextProfile:f,inContext:v})),f&&!i&&(i=Xp({policyDefinitions:l,tournamentRecord:u,contextProfile:f,event:b}));const D=Xc({event:b});return{...(b.drawDefinitions??[]).reduce((E,C)=>{const M=H0({context:w,tournamentAppliedPolicies:r,scheduleVisibilityFilters:o,tournamentParticipants:e,participantsProfile:a,afterRecoveryTimes:s,policyDefinitions:l,tournamentRecord:u,usePublishState:d,contextContent:i,contextFilters:p,matchUpFilters:h,participantMap:n,publishStatus:D,contextProfile:f,drawDefinition:C,nextMatchUps:m,inContext:v,event:b}),N=Object.keys(M);return N==null||N.forEach(R=>{Array.isArray(M[R])&&(E[R]||(E[R]=[]),E[R]=E[R].concat(M[R]))}),E},{}),...le,groupInfo:U}}function ex(t){if(!(t!=null&&t.tournamentRecord))return{error:je};let e=t.contextContent;const{scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,inContext:l=!0,usePublishState:c,contextFilters:u,matchUpFilters:d,contextProfile:p,nextMatchUps:h,context:f}=t,m=t.tournamentId??s.tournamentId,g=(s==null?void 0:s.events)??[],{participants:v,participantMap:y,groupInfo:b}=rb({participantsProfile:n,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,contextProfile:p,inContext:l});p&&!e&&(e=Xp({policyDefinitions:o,tournamentRecord:s,contextProfile:p}));const{appliedPolicies:I}=Gi({tournamentRecord:s}),T=(u==null?void 0:u.eventIds)??[];return{...g.filter(S=>!T.includes(S.eventId)).map(S=>{var w,U;const D=Zn({event:S}).flightProfile;return Qk({context:{eventDrawsCount:((w=D==null?void 0:D.flights)==null?void 0:w.length)||((U=S.drawDefinitions)==null?void 0:U.length)||0,...f},tournamentAppliedPolicies:I,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:s,usePublishState:c,contextFilters:u,contextProfile:p,contextContent:e,matchUpFilters:d,participantMap:y,participants:v,tournamentId:m,nextMatchUps:h,inContext:l,event:S})}).reduce((S,w)=>{const U=w&&Object.keys(w).filter(D=>!["success","matchUpsMap"].includes(D));return U==null||U.forEach(D=>{Array.isArray(w[D])&&(S[D]||(S[D]=[]),S[D]=S[D].concat(w[D]),S.matchUpsCount+=w[D].length)}),S},{matchUpsCount:0}),groupInfo:b}}function kU({scheduleVisibilityFilters:t,participantsProfile:e,tournamentRecords:i,policyDefinitions:n,usePublishState:r,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l}){if(typeof i!="object"||!Object.keys(i).length)return{error:Wn};const c=Object.keys(i).map(d=>{const p=i[d];return ex({scheduleVisibilityFilters:t,participantsProfile:e,policyDefinitions:n,tournamentRecord:p,usePublishState:r,matchUpFilters:o,contextFilters:a,nextMatchUps:s,inContext:l})}),u={};return{...c.reduce((d,p)=>(Object.keys(p).forEach(h=>{Array.isArray(p[h])&&(d[h]||(d[h]=[]),d[h]=d[h].concat(p[h])),h==="groupInfo"&&Object.assign(u,p[h])}),d),{}),groupInfo:u}}function PC(t){var e,i,n,r,o,a,s,l;if(typeof(t==null?void 0:t.tournamentRecords)!="object"||!Object.keys(t==null?void 0:t.tournamentRecords).length)return{error:Wn};const{courts:c,venues:u}=eh(t),d=th(t).schedulingProfile,{sortDateMatchUps:p=!0,courtCompletedMatchUps:h,alwaysReturnCompleted:f,activeTournamentId:m,tournamentRecords:g,withCourtGridRows:v,minCourtGridRows:y,usePublishState:b,status:I=ju,sortCourtsData:T}=t,S=b?(i=(e=rC({tournamentRecord:g[m??bI()],itemType:`${eb}.${tb}`}).timeItem)==null?void 0:e.itemValue)==null?void 0:i[I]:void 0,w=f?kU({...t,matchUpFilters:{...t.matchUpFilters,matchUpStatuses:[fr]},contextFilters:t.contextFilters}).completedMatchUps:[];if(b&&(!S||!Object.keys(S).length))return{completedMatchUps:w,dateMatchUps:[],courtsData:[],venues:u};let U,D;b&&({drawIds:U,detailsMap:D}=function({tournamentRecords:O}){var F;const B=[],$={};for(const V of Object.values(O))for(const H of V.events??[]){const z=Xc({event:H}),G=z==null?void 0:z.drawDetails;bn(G)?(Object.assign($,G),B.push(...Object.keys(G).filter(W=>HW({drawId:W,drawDetails:G})))):(F=z==null?void 0:z.drawIds)!=null&&F.length&&B.push(...z.drawIds)}return{drawIds:B,detailsMap:$}}({tournamentRecords:g})),U!=null&&U.length&&(t.contextFilters||(t.contextFilters={}),(n=t.contextFilters)!=null&&n.drawIds?t.contextFilters.drawIds=t.contextFilters.drawIds.filter(O=>U.includes(O)):t.contextFilters.drawIds=U),(r=S==null?void 0:S.eventIds)!=null&&r.length&&(t.matchUpFilters||(t.matchUpFilters={}),(o=t.matchUpFilters)!=null&&o.eventIds&&t.matchUpFilters.eventIds.length?t.matchUpFilters.eventIds=t.matchUpFilters.eventIds.filter(O=>S.eventIds.includes(O)):t.matchUpFilters.eventIds=S.eventIds),(a=S==null?void 0:S.scheduledDates)!=null&&a.length&&(t.matchUpFilters||(t.matchUpFilters={}),t.matchUpFilters.scheduledDates&&t.matchUpFilters.scheduledDates.length?t.matchUpFilters.scheduledDates=t.matchUpFilters.scheduledDates.filter(O=>S.scheduledDates.includes(O)):t.matchUpFilters.scheduledDates=S.scheduledDates),f&&(t.matchUpFilters||(t.matchUpFilters={}),(l=(s=t.matchUpFilters)==null?void 0:s.excludeMatchUpStatuses)!=null&&l.length?t.matchUpFilters.excludeMatchUpStatuses.includes(fr)||t.matchUpFilters.excludeMatchUpStatuses.push(fr):t.matchUpFilters.excludeMatchUpStatuses=[fr]);const{completedMatchUps:E,upcomingMatchUps:C,pendingMatchUps:M,groupInfo:N}=kU({...t,matchUpFilters:t.matchUpFilters,contextFilters:t.contextFilters});let R=[...C??[],...M??[]];D&&Object.keys(D).length&&(R=R.filter(O=>{const{drawId:F,structureId:B,stage:$}=O;if(!D[F])return!1;if(D[F].stageDetails){const V=Object.keys(D[F].stageDetails),H=V.filter(G=>!D[F].stageDetails[G].published),z=V.filter(G=>D[F].stageDetails[G].published);return(!H.length||!H.includes($))&&(!(!z.length||!z.includes($))||H.length&&!H.includes($)&&!z.length)}if(D[F].structureDetails){const V=Object.keys(D[F].structureDetails),H=V.filter(G=>!D[F].structureDetails[G].published),z=V.filter(G=>D[F].structureDetails[G].published);return(!H.length||!H.includes(B))&&(!(!z.length||!z.includes(B))||H.length&&!H.includes(B)&&!z.length)}return!0}));const A=p?$R({matchUps:R,schedulingProfile:d}):R,_=c==null?void 0:c.map(O=>{const F=function({courtId:B}){const $=(h?A.concat(E??[]):A).filter(V=>{var H,z,G;return((H=V.schedule)==null?void 0:H.courtId)===B||((G=(z=V.schedule)==null?void 0:z.allocatedCourts)==null?void 0:G.map(({courtId:W})=>W).includes(B))});return T?$R({matchUps:$,schedulingProfile:d}):$}(O);return{surfaceCategory:(O==null?void 0:O.surfaceCategory)??"",matchUps:F,...O}}),k={completedMatchUps:f?w:E,dateMatchUps:A,courtsData:_,groupInfo:N,venues:u};if(v){const{rows:O,courtPrefix:F}=H3({minRowsCount:y,courtsData:_});k.courtPrefix=F,k.rows=O}return{...k,...le}}function tx({tournamentRecords:t,tournamentId:e}){if(typeof t!="object"||!Object.keys(t).length)return{error:Wn};let i;return Object.keys(t).filter(n=>!e||n===e).forEach(n=>{const r=t[n],{matchUpDailyLimits:o}=function(a){var s;const l=Ln(a,[{[qp]:!0}]);if(l.error)return l;const{tournamentRecord:c}=a,{policy:u}=Tg({policyType:wg,tournamentRecord:c}),{extension:d}=ei({element:c,name:GP}),p=(s=d==null?void 0:d.value)==null?void 0:s.dailyLimits,h=u==null?void 0:u.defaultDailyLimits;return{matchUpDailyLimits:p||h}}({tournamentRecord:r});i=o}),{matchUpDailyLimits:i}}function G3(t){var e,i,n,r;let{matchUps:o}=t;const{singlesForDoubles:a,tournamentRecord:s,drawDefinition:l,excludeMargin:c,exclusionRule:u,zoneDoubling:d,matchUpType:p,scaleName:h,eventId:f,zonePct:m,drawId:g,event:v}=t;if(!s&&!o)return{error:je};if(p&&![vr,Pn].includes(p))return{error:Re,info:{matchUpType:p}};if(o&&!vl(o))return{error:Re,context:{matchUps:o}};const y=Gs[h],b=(y==null?void 0:y.ascending)??t.ascending??!1,I=(y==null?void 0:y.accessor)??t.valueAccessor,T=Array.isArray(y==null?void 0:y.range)?Math.abs(y.range[0]-y.range[1]):0,S=$t(m)&&T?(m??0)*T:t.zoneMargin??T,w={withScaleValues:!0,withCompetitiveness:!0},U={matchUpTypes:p?[p]:[vr,Pn]},D=s==null?void 0:s.participants;(e=o==null?void 0:o[0])!=null&&e.hasContext?g?o=o.filter(O=>O.drawId===g):f&&(o=o.filter(O=>O.eventId===f)):o===void 0&&(o=g&&!l&&[]||!g&&f&&!v&&[]||g&&((i=Fa({inContext:!0,drawDefinition:l,contextFilters:U,contextProfile:w,participants:D}))==null?void 0:i.matchUps)||!g&&f&&((n=Qp({inContext:!0,contextFilters:U,contextProfile:w,participants:D,event:v}))==null?void 0:n.matchUps)||((r=Vr({tournamentRecord:s,contextFilters:U,contextProfile:w}))==null?void 0:r.matchUps)||[]),p&&(o=o.filter(O=>O.matchUpType===p));const E=o.filter(({winningSide:O,score:F,sides:B,matchUpStatus:$})=>![da,Mi,Li,B0,Es].includes($??"")&&lo({score:F})&&(B==null?void 0:B.length)===2&&O),C=function({excludeMargin:O,exclusionRule:F,valueAccessor:B,ascending:$,scaleName:V,matchUps:H}){const z={affirmative:[],negative:[],excluded:[]};for(const K of H){const{matchUpType:Z,sides:Y,score:X,winningSide:Q}=K;if(!Q)continue;if(F&&(!F.valueAccessor||!F.range))return{info:"exclusionRule requires valueAccessor and range",error:bt};const te=Q-1,J=RY({exclusionRule:F,valueAccessor:B,matchUpType:Z,scaleName:V,sides:Y});if(F){const he=J.map(({exclusionValues:be})=>be).flat();if(he.length){z.excluded.push({scoreString:X==null?void 0:X.scoreStringSide1,exclusionValues:he,winningSide:Q,sideValues:J});continue}}if(J.filter(he=>![void 0,"",null].includes(he.value)).length<2){z.excluded.push({scoreString:X==null?void 0:X.scoreStringSide1,missingValues:!0,winningSide:Q,sideValues:J});continue}const ie=J[te].value-J[1-te].value,oe=parseFloat(O||0),ne=oe&&Math.abs(ie)<oe;if(ne){z.excluded.push({scoreString:X==null?void 0:X.scoreStringSide1,excludeMargin:O,winningSide:Q,excludeGap:ne,sideValues:J,valuesGap:ie});continue}const re=$?ie:-1*ie,me=Q===1?X==null?void 0:X.scoreStringSide1:X==null?void 0:X.scoreStringSide2;re>0?z.affirmative.push({winningScoreString:me,winningSide:Q,sideValues:J,valuesGap:ie,score:X}):z.negative.push({winningScoreString:me,winningSide:Q,sideValues:J,valuesGap:ie,score:X})}const G=z.affirmative.length+z.negative.length,W=G&&z.affirmative.length/G*100;return z.percent=W?Math.round(100*W)/100:0,z}({matchUps:E,excludeMargin:c,exclusionRule:u,valueAccessor:I,ascending:b,scaleName:h}),M=d&&p!==vr?2*(S||0):S,N=S?E.map(({competitiveProfile:O,matchUpType:F,score:B,sides:$})=>{const V=RY({singlesForDoubles:a,valueAccessor:I,matchUpType:F,scaleName:h,sides:$}),H=Math.abs(V[0].value-V[1].value);return{competitiveness:O==null?void 0:O.competitiveness,valuesGap:H,score:B}}).filter(({valuesGap:O})=>O<=M):[],R=function({zoneData:O}){const F={[MW]:[],[TU]:[],[UU]:[]};for(const B of O){const{competitiveness:$,score:V,valuesGap:H}=B;F[$]&&F[$].push({score:V,valuesGap:H})}return F}({zoneData:N}),A=R&&[].concat(Object.values(R)).flat().length,_=A&&Object.assign({},...Object.keys(R).map(O=>({[O]:Math.round(1e4*R[O].length/A)/100}))),k=E.length-((N==null?void 0:N.length)||0);return{...le,relevantMatchUps:E,zoneDistribution:_,zoneData:N,accuracy:C,nonZone:k}}function RY({singlesForDoubles:t,exclusionRule:e,valueAccessor:i,matchUpType:n,scaleName:r,sides:o}){const a=e==null?void 0:e.range.sort(),s=l=>{const c=l==null?void 0:l[e==null?void 0:e.valueAccessor];return{exclude:e&&c>=a[0]&&c<=a[1],exclusionValue:c}};return o.sort((l,c)=>l.sideNumber-c.sideNumber).map(({participant:l})=>{const c=[],u=l==null?void 0:l.individualParticipants;if(u!=null&&u.length){const d=[];let p=0;for(const h of u){const{scaleValue:f,value:m}=NY({singlesForDoubles:t,valueAccessor:i,participant:h,matchUpType:n,scaleName:r}),{exclude:g,exclusionValue:v}=s(f);g&&c.push(v),d.push(f),m&&!isNaN(p)?p+=m:p=void 0}return{participantName:l.participantName,exclusionValues:c,scaleValues:d,value:p}}if(l){const{scaleValue:d,value:p}=NY({singlesForDoubles:t,valueAccessor:i,matchUpType:n,participant:l,scaleName:r}),{exclude:h,exclusionValue:f}=s(d);return h&&c.push(f),{participantName:l.participantName,exclusionValues:c,scaleValue:d,value:p}}return{}})}function NY({singlesForDoubles:t,valueAccessor:e,matchUpType:i,participant:n,scaleName:r}){var o,a,s,l,c;const u=t?vr:i,d=(a=(o=n==null?void 0:n.rankings)==null?void 0:o[u])==null?void 0:a.find(f=>f.scaleName===r),p=(l=(s=n==null?void 0:n.ratings)==null?void 0:s[u])==null?void 0:l.find(f=>f.scaleName===r),h=(c=p||d)==null?void 0:c.scaleValue;return{scaleValue:h,value:e?h==null?void 0:h[e]:h}}function hb({collectionDefinitions:t=[],collectionGroups:e=[]}){let i=0;const{groupValueNumbers:n}=zde({collectionGroups:e});let r;for(const o of t||[]){const{collectionValueProfiles:a,collectionGroupNumber:s,collectionValue:l,matchUpCount:c,matchUpValue:u,scoreValue:d,setValue:p}=o,h=s&&n.includes(s);if($t(p||d))r=!0;else{if(h)continue;if(typeof l=="number"&&$t(l))i+=l;else if(a!=null&&a.length)for(const f of a)i+=f.matchUpValue;else typeof u=="number"&&$t(u)&&(i+=(c??0)*u)}}for(const o of e)i+=o.groupValue??0;return r||!i?{aggregateValue:!0,...le}:{valueGoal:Math.floor(i/2)+1,...le}}function z3({matchUps:t,matchUpId:e}){if(!vl(t))return{error:Re};const i=t.find(s=>s.matchUpId===e),{drawId:n,eventId:r,structureId:o,tournamentId:a}=i||{};return{matchUpId:e,drawId:n,eventId:r,structureId:o,tournamentId:a}}function CC(t,e){if(!bn(t))return{error:Re};if(!Array.isArray(e))return{error:Re};const i={};for(const{param:n,error:r,attr:o}of e){const a=yOe({params:t,param:n,attr:o,error:r});if(a!=null&&a.error)return a;i[n]=a}return i}function yOe({params:t,param:e,attr:i,error:n}){if(e===pW&&bn(t.drawDefinition)&&La(t.structureId)){const r=(t.drawDefinition.structures??[]).find(({structureId:o})=>o===t.structureId);return!r.length&&n?{error:n}:{structure:r}}if(e===_f){const r=ype({...t,...i});return r.error&&n?{...r,error:n}:r}return{error:zo,info:{param:e}}}function W3(t){var e;const{structureId:i,matchUpId:n,event:r}=t;let o=t.drawDefinition;const a=Ln(t,[{[qp]:!0},{_anyOf:{[_ce]:!1,[x0]:!1,[Bce]:!1,[VP]:!1}}]);if(a[Sv])return a;const s=CC(t,[{[jP]:_f,[Sv]:bt}]),l=s==null?void 0:s.matchUp;if(n&&l!=null&&l.error)return l;!o&&l!=null&&l.drawDefinition&&(o=l==null?void 0:l.drawDefinition);let c=l==null?void 0:l.structure;if(!c&&i&&!n){if(!o)return{error:Yc};const h=kt({drawDefinition:o,structureId:i});if(h.error)return h;c=h.structure}const u=c==null?void 0:c.matchUpFormat,d=o==null?void 0:o.matchUpFormat,p=r==null?void 0:r.matchUpFormat;return{structureDefaultMatchUpFormat:u,eventDefaultMatchUpFormat:p,drawDefaultMatchUpFormat:d,matchUpFormat:((e=l==null?void 0:l.matchUp)==null?void 0:e.matchUpFormat)||u||d||p}}function q3({profileBands:t,tournamentRecord:e,matchUps:i}){if(!vl(i))return{error:Nf};const n=!t&&Tg({policyType:Rh,tournamentRecord:e}).policy,r=t||(n==null?void 0:n.profileBands)||RW[Rh].profileBands,o=i.filter(({winningSide:d})=>d),a=o.map(Cue),s=Eue(a).reduce((d,p)=>((h,f)=>(h[Pue(f,r)]+=1,h))(d,p),{[MW]:0,[TU]:0,[UU]:0,[Uue]:0}),l=Object.keys(s).reduce((d,p)=>(s[p]||0)+d,0),c=Object.keys(s).map(d=>({[d]:100*parseFloat((s[d]/l).toFixed(4))})),u=o.filter(({matchUpStatus:d})=>d===x7).length;return c.push({[x7]:100*parseFloat((u/l).toFixed(4))}),{competitiveBands:Object.assign({},...c),...le}}function rB(t){const{containerStructureId:e,roundSegment:i,isRoundRobin:n,tournamentId:r,roundNumber:o,structureId:a,eventId:s,drawId:l}=t,c=n?e:a,u=[r,s,l,c,o].join("|");return It({structureId:c,roundSegment:i,tournamentId:r,roundNumber:o,eventId:s,drawId:l,id:u})}function AY({round:t,matchUps:e,events:i,tournamentRecords:n}){const r=i.find(p=>p.eventId===t.eventId),{eventType:o,category:a,categoryType:s}=r||{},{categoryName:l,ageCategoryCode:c}=a||{},u=cs(e.map(({matchUpFormat:p})=>p));let d=0;return Object.keys(u).forEach(p=>{const h=u[p],f=Zk({categoryName:l||c,tournamentId:t.tournamentId,eventId:t.eventId,tournamentRecords:n,matchUpFormat:p,categoryType:s,eventType:o});if(f.error)return f;const m=f.averageMinutes*h;isNaN(d)||(d+=m)}),{roundMinutes:d}}function _Y(t){const e=t.length,i=t.filter(({sides:a})=>a==null?void 0:a.some(({bye:s})=>s)).length||0,n=t.filter(({winningSide:a,matchUpStatus:s})=>a||no.includes(s)).length||0,r=t.filter(({schedule:a,matchUpStatus:s})=>(a==null?void 0:a.scheduledDate)&&(a==null?void 0:a.scheduledTime)&&s!==Ri).length||0,o=e-i;return{unscheduledCount:o-r,incompleteCount:o-r,scheduledCount:r,completedCount:n,matchUpsCount:e,isScheduled:o===r,isComplete:o===n,byeCount:i}}function Y3({tournamentRecords:t,schedulingProfile:e,tournamentRecord:i,withRoundId:n}){if(i&&!t){if(typeof i!="object")return{error:W_};t={[i.tournamentId]:i}}if(e){const o=Xk({tournamentRecords:t,schedulingProfile:e});if(o.error)return o}if(!e&&t){const o=th({tournamentRecords:t});if(o.error)return o;e=o.schedulingProfile}if(!e)return{error:zo};const r={};return{profileRounds:e.map(({venues:o,scheduleDate:a})=>o.map(({rounds:s})=>s.map(l=>{var c;const u=rB(l);return(c=u.roundSegment)!=null&&c.segmentsCount&&(r[u.id]=u.roundSegment.segmentsCount),It({id:n?u.id:void 0,scheduleDate:a,...u})}))).flat(1/0),segmentedRounds:r}}const{stageOrder:kY}=Mke;function bOe(t,e){return t.eventName.localeCompare(e.eventName)||t.eventId.localeCompare(e.eventId)||(kY[t==null?void 0:t.stage]||0)-(kY[e==null?void 0:e.stage]||0)||e.matchUpsCount-t.matchUpsCount||`${t.stageSequence}-${t.roundNumber}-${t.minFinishingSum}`.localeCompare(`${e.stageSequence}-${e.roundNumber}-${e.minFinishingSum}`)}function K3({excludeScheduleDateProfileRounds:t,excludeScheduledRounds:e,excludeCompletedRounds:i,inContextMatchUps:n,tournamentRecords:r,schedulingProfile:o,tournamentRecord:a,withSplitRounds:s,matchUpFilters:l,scheduleDate:c,withRoundId:u,venueId:d,context:p}){var h;if(n&&!Array.isArray(n||typeof n[0]!="object"))return{error:Re,inContextMatchUps:n};if(a&&!r){if(typeof a!="object")return{error:W_};r={[a.tournamentId]:a}}const f=typeof r!="object"||!Object.keys(r).length;if((d||c||!n||!o&&(t||i||o||s))&&f)return{error:Wn};const m=Object.assign({},...Object.values(r??{}).map(({venues:w=[],tournamentId:U})=>({[U]:w==null?void 0:w.map(({venueId:D})=>D)}))),g=Object.values(r??{}).map(({events:w=[],tournamentId:U,startDate:D,endDate:E})=>w.map(C=>({...C,validVenueIds:m[U],startDate:C.startDate??D,endDate:C.endDate??E}))).flat(),{segmentedRounds:v,profileRounds:y}=r&&(t||i||o||s)&&Y3({tournamentRecords:r,schedulingProfile:o})||{},b=t&&Object.assign({},...y.map(w=>({[w.id]:w}))),I=n||r&&((h=Vc({tournamentRecords:r,matchUpFilters:l}))==null?void 0:h.matchUps)||[],T=[],S=I&&Object.values(I.reduce((w,U)=>{var D;const E=rB(U).id,C=v==null?void 0:v[E],M=[...((D=w[E])==null?void 0:D.matchUps)??[],U],{containerStructureId:N,stageSequence:R,structureName:A,tournamentId:_,isRoundRobin:k,matchUpType:O,roundNumber:F,roundOffset:B,structureId:$,eventName:V,roundName:H,drawName:z,eventId:G,drawId:W}=U,K=k?N:$;return{...w,[E]:{id:u?E:void 0,structureId:K,stageSequence:R,segmentsCount:C,structureName:A,tournamentId:_,matchUpType:O,roundNumber:F,roundOffset:B,eventName:V,roundName:H,drawName:z,matchUps:M,eventId:G,drawId:W}}},{})).map(w=>{const{minFinishingSum:U,winnerFinishingPositionRange:D}=(w.matchUps||[]).reduce((O,F)=>{var B,$;const V=(((B=F.finishingPositionRange)==null?void 0:B.winner)||[]).reduce((z,G)=>z+G,0),H=((($=F.finishingPositionRange)==null?void 0:$.winner)||[]).join("-")||"";return!O.minFinishingSum||V<O.minFinishingSum?{minFinishingSum:V,winnerFinishingPositionRange:H}:O},{minFinishingSum:0,winnerFinishingPositionRange:""}),E=w.segmentsCount;if(E){const O=w.matchUps.length/E;return Kr(w.matchUps.sort((F,B)=>F.roundPosition-B.roundPosition),O).map((F,B)=>{const{unscheduledCount:$,incompleteCount:V,matchUpsCount:H,isScheduled:z,isComplete:G,byeCount:W}=_Y(F),K=AY({matchUps:w.matchUps,tournamentRecords:r,events:g,round:w});return It({...w,...p,roundSegment:{segmentsCount:E,segmentNumber:B+1},winnerFinishingPositionRange:D,unscheduledCount:$,incompleteCount:V,minFinishingSum:U,matchUpsCount:H,isScheduled:z,roundTiming:K,isComplete:G,byeCount:W,matchUps:F})})}const{unscheduledCount:C,incompleteCount:M,matchUpsCount:N,isScheduled:R,isComplete:A,byeCount:_}=_Y(w.matchUps),k=AY({matchUps:w.matchUps,tournamentRecords:r,events:g,round:w});return It({...w,...p,winnerFinishingPositionRange:D,unscheduledCount:C,incompleteCount:M,minFinishingSum:U,matchUpsCount:N,isScheduled:R,roundTiming:k,isComplete:A,byeCount:_})}).flat().filter(w=>{if(t){const B=zt(t),$=u?w.id:rB(w).id;if(B&&b[$]&&zt(b[$].scheduleDate)===B)return!1}const{isComplete:U,isScheduled:D}=w,E=!i||!U,C=!e||!D,M=d||c?g==null?void 0:g.find(({eventId:B})=>B===w.eventId):void 0,N=(M==null?void 0:M.startDate)??(a==null?void 0:a.startDate),R=(M==null?void 0:M.endDate)??(a==null?void 0:a.endDate),A=!c||!N||new Date(c)>=new Date(N),_=!c||!R||new Date(c)<=new Date(R),k=A&&_,O=!d||(M==null?void 0:M.validVenueIds.includes(d)),F=E&&C&&O&&k;return F||T.push(w),F}).sort(bOe)||[];return{...le,rounds:S,excludedRounds:T}}function Z3({ignoreTiebreak:t=!1,matchUpScoringFormat:e,matchUpFormat:i,isTiebreakSet:n,isDecidingSet:r,set:o}){var a;if(!o)return{error:bt,info:"missing set"};e=e||i&&Ga(i);const s=r&&e.finalSetFormat||(e==null?void 0:e.setFormat)||{},{side1Score:l,side2Score:c}=o,{setTo:u,tiebreakAt:d}=s,p=ix({set:o}),h=Math.abs(l-c),f=l>=u||c>=u,m=n||l>=u&&c>=u||d&&d<u&&(l===d||c===d),g=t||m&&(p===1&&o.side1TiebreakScore>o.side2TiebreakScore||p===2&&o.side2TiebreakScore>o.side1TiebreakScore),v=!m&&s.NoAD||m||n&&(a=s.tiebreakFormat)!=null&&a.NoAD?1:2;return!(!(f&&(h>=v||m))&&!n||m&&!g)}function ix({set:t}){if(t.side1Score||t.side2Score){if(t.side1Score>t.side2Score)return 1;if(t.side2Score>t.side1Score)return 2}else if(t.side1TiebreakScore||t.side2TiebreakScore){if(t.side1TiebreakScore>t.side2TiebreakScore)return 1;if(t.side2TiebreakScore>t.side1TiebreakScore)return 2}}function VR(t){const{setObject:e,matchUpScoringFormat:i}=t;if(!e)return{error:zO};const{setNumber:n}=e||{},{bestOf:r}=i||{},o=!(!n||!r||n!==r),a=o&&(i==null?void 0:i.finalSetFormat)||(i==null?void 0:i.setFormat),s=!!(a!=null&&a.tiebreakSet),l=!!(a!=null&&a.timed),c=!s&&!l,u=!!(n&&r&&n<=r),d=[e==null?void 0:e.side1Score,e==null?void 0:e.side2Score],p=[e==null?void 0:e.side1PointScore,e==null?void 0:e.side2PointScore],h=[e==null?void 0:e.side1TiebreakScore,e==null?void 0:e.side2TiebreakScore],f=d.filter(_=>_!==void 0).length,m=p.filter(_=>_!==void 0).length,g=h.filter(_=>_!==void 0).length,v=d==null?void 0:d.filter(_=>!isNaN(_)).length,y=h==null?void 0:h.filter(_=>!isNaN(_)).length,{tiebreakAt:b}=a||{},I=b&&d.filter(_=>_>=b).length===2,T=I&&((d[0]>d[1]?1:d[1]>d[0]&&2)||void 0),S=!(!y||v),w=!!(e!=null&&e.winningSide),{error:U,result:D}=function({setObject:_,setFormat:k,sideGameScores:O,sideTiebreakScores:F}){if(!_)return{result:!1,error:zO};const B=!!(k!=null&&k.tiebreakSet),$=!!(k!=null&&k.timed);if(!k||B||$)return{result:!1,error:Re};if((O==null?void 0:O.filter(he=>!isNaN(he)).length)!==2)return{result:!1,error:T7};const{setTo:V,tiebreakAt:H,tiebreakFormat:z,NoAD:G}=k||{};if(!V||!(O!=null&&O.find(he=>he>=V)))return{result:!1,error:T7};const W=[1,2].includes(_==null?void 0:_.winningSide);if(!_||!W)return{result:!1,error:U7};const K=(_==null?void 0:_.winningSide)-1,Z=1-K,Y=O[K],X=O[Z],Q=Y-X;if(!(Y>X))return{result:!1,error:{message:"winningSide game scoreString is not high"}};const te=H&&z,J=(F==null?void 0:F.filter(he=>!isNaN(he)).length)===2,ie=F==null?void 0:F[K],oe=F==null?void 0:F[Z],ne=H&&O.filter(he=>he>=H).length===2;if(te){const{NoAD:he,tiebreakTo:be}=z;if(ne){if(Q>1)return{result:!1,error:{message:"invalid winning game scoreString (5)"}};if(!J)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(be))return{result:!1,error:{message:"tiebreakTo error"}};if(!be||!(F!=null&&F.find(De=>De>=be)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};if(Y>(H<V?V:V+1))return{result:!1,error:{message:"invalid winning game scoreString (1)"}};if(!ie||!oe||ie<oe)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const Se=ie-oe;if(Se&&oe>=be-1&&Se<(he?1:2))return{result:!1,error:{message:"invalid tiebreak scores (3)"}}}if(Y>V&&!ne)return{result:!1,error:{message:"invalid winning game scoreString (2)"}}}const re=G?1:2,me=X>=V-1;return Q&&me&&!ne&&Q<re?{result:!1,error:{message:"invalid winning game scoreString (3)"}}:Q>re&&Y>V?{result:!1,error:{message:"invalid winning game scoreString (4)"}}:{result:!0}}({setObject:e,setFormat:a,sideGameScores:d,sideTiebreakScores:h}),{error:E,result:C}=function({setObject:_,setFormat:k,sideTiebreakScores:O}){if(!_)return{result:!1,error:zO};const F=!!(k!=null&&k.tiebreakSet),B=!!(k!=null&&k.timed);if(!k||!F||B)return{result:!1,error:{message:"not tiebreak set"}};const $=[1,2].includes(_==null?void 0:_.winningSide);if(!_||!$)return{result:!1,error:U7};const{tiebreakSet:V}=k||{},{NoAD:H,tiebreakTo:z}=V||{};if((O==null?void 0:O.filter(te=>!isNaN(te)).length)!==2)return{result:!1,error:{message:"invalid tiebreak scores (1)"}};if(isNaN(z))return{result:!1,error:{message:"tiebreakTo error"}};if(!(O!=null&&O.find(te=>te>=z)))return{result:!1,error:{message:"invalid tiebreak scores (2)"}};const G=(_==null?void 0:_.winningSide)-1,W=1-G,K=O[G],Z=O[W];if(!K||!Z||K<Z)return{result:!1,error:{message:"winningSide tiebreak value is not high"}};const Y=H?1:2,X=K-Z,Q=Z>=z-1;return X&&Q&&X<Y?{result:!1,error:{message:"invalid tiebreak scores (3)"}}:{result:!0}}({setObject:e,setFormat:a,sideTiebreakScores:h}),M=c&&!S&&D||s&&S&&C,N=u&&!(s&&!S)&&!(c&&S)&&(!w||M),R=function({matchUpScoringFormat:_,isDecidingSet:k,isTiebreakSet:O,setObject:F}){if(!F)return;const B=ix({set:F});return Z3({matchUpScoringFormat:_,set:F,isDecidingSet:k,isTiebreakSet:O})&&B||void 0}({isDecidingSet:o,isTiebreakSet:S,matchUpScoringFormat:i,setObject:e}),A={expectTiebreakSet:s,expectTimedSet:l,hasTiebreakCondition:I,isCompletedSet:w,isDecidingSet:o,isTiebreakSet:S,isValidSet:N,isValidSetNumber:u,isValidSetOutcome:M,leadingSide:T,setFormat:a,sideGameScores:d,sideGameScoresCount:f,sidePointScores:p,sidePointScoresCount:m,sideTiebreakScores:h,sideTiebreakScoresCount:g,winningSide:R};return(e==null?void 0:e.winningSide)!==void 0&&(S?(A.isValidTiebreakSetOutcome=C,C||(A.tiebreakSetError=E)):(A.isValidStandardSetOutcome=D,D||(A.standardSetError=U))),A}function xU(t){var e;const{matchUp:i,sideNumber:n,setNumber:r,isTiebreakValue:o,isPointValue:a}=t||{};let{matchUpFormat:s}=t||{};if(!i)return{error:Cs};s=s||(i==null?void 0:i.matchUpFormat);const l=Ga(s),c=!!(i!=null&&i.winningSide),u=(e=i.score)==null?void 0:e.sets,d=u==null?void 0:u.length,p=r&&r-1,h=!!(u!=null&&u.find((z,G)=>z.setNumber===r&&G===p)),f=(u==null?void 0:u.filter(z=>z==null?void 0:z.winningSide))||[],m=(f==null?void 0:f.length)||0,g=r&&(u==null?void 0:u.slice(r))||[],v=!!(d&&r&&g!=null&&g.reduce((z,G)=>(!G||!G.side1Score&&!G.side2Score&&!G.side1TiebreakScore&&!G.side2TiebreakScore&&!G.side1PointScore&&!G.side2PointScore)&&z,!0)),y=r<=d&&u.find(z=>z.setNumber===r),b=y&&VR({setObject:y,matchUpScoringFormat:l}),{isCompletedSet:I,sideGameScores:T,sideTiebreakScores:S}=b||{},w=!!(y&&!I&&v||r&&r===d+1&&!c),U=[1,2].includes(n),D=U?n-1:0,E=y&&U&&(!o&&!a&&T[D]!==void 0&&T[D]||o&&S[D]!==void 0&&S[D]),C=!!E,M=f==null?void 0:f.map(z=>VR({setObject:z,matchUpScoringFormat:l}).isValidSetOutcome).reduce((z,G)=>z&&G,!0),N=f.reduce((z,G)=>{const{winningSide:W}=G;return z[W-1]++,z},[0,0]),R=i==null?void 0:i.winningSide,A=R&&R-1,_=1-A,k=N[A],O=N[_],F=Math.max(...N),B=cs(N)[F],{bestOf:$}=l??{},V=F===($&&Math.ceil($/2)||1)&&B===1&&N.indexOf(F)+1||void 0,H=k>O&&R===V;return{completedSetsHaveValidOutcomes:M,validMatchUpWinningSide:H,calculatedWinningSide:V,matchUpScoringFormat:l,validMatchUpOutcome:V&&M&&H,isLastSetWithValues:v,completedSetsCount:m,isCompletedMatchUp:c,isValidSideNumber:U,hasExistingValue:C,existingValue:E,isExistingSet:h,isActiveSet:w,...b}}function X3({participants:t,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,usePublishState:l,contextFilters:c,contextContent:u,matchUpFilters:d,participantMap:p,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,tournamentId:v,inContext:y,context:b,event:I}){const{eventId:T,eventName:S,endDate:w}=I??{},U={...b,...It({eventId:T,eventName:S,endDate:w??(I==null?void 0:I.endDate)??(s==null?void 0:s.endDate),tournamentId:v??(s==null?void 0:s.tournamentId),indoorOutDoor:(I==null?void 0:I.indoorOutdoor)??(s==null?void 0:s.indoorOutdoor),surfaceCategory:(I==null?void 0:I.surfaceCategory)??(s==null?void 0:s.surfaceCategory)})};let D;return!(t!=null&&t.length)&&s&&({participants:t,participantMap:p,groupInfo:D}=rb({participantsProfile:n,policyDefinitions:o,useParticipantMap:a,tournamentRecord:s,contextProfile:f,inContext:y})),I&&f&&!u&&(u=Xp({policyDefinitions:o,tournamentRecord:s,contextProfile:f,drawDefinition:m,event:I})),{...H0({context:U,tournamentAppliedPolicies:e,scheduleVisibilityFilters:i,tournamentParticipants:t,participantsProfile:n,afterRecoveryTimes:r,policyDefinitions:o,tournamentRecord:s,usePublishState:l,participantMap:p,contextContent:u,contextFilters:c,matchUpFilters:d,publishStatus:h,contextProfile:f,drawDefinition:m,nextMatchUps:g,inContext:y,event:I}),groupInfo:D}}var IOe=Object.freeze({__proto__:null,allCompetitionMatchUps:Vc,allDrawMatchUps:Fa,allEventMatchUps:Qp,allTournamentMatchUps:Vr,analyzeMatchUp:xU,calculateWinCriteria:hb,checkMatchUpIsComplete:gm,competitionScheduleMatchUps:PC,drawMatchUps:X3,eventMatchUps:Qk,getAllDrawMatchUps:Ar,getCheckedInParticipantIds:ib,getCompetitionMatchUps:kU,getEventMatchUpFormatTiming:$3,getMatchUpCompetitiveProfile:KP,getMatchUpContextIds:z3,getMatchUpDailyLimits:tx,getMatchUpDailyLimitsUpdate:V3,getMatchUpDependencies:rc,getMatchUpFormat:W3,getMatchUpFormatTiming:eC,getMatchUpFormatTimingUpdate:B3,getMatchUpScheduleDetails:Pk,getMatchUpType:Ck,getMatchUpsStats:q3,getModifiedMatchUpFormatTiming:Jk,getPredictiveAccuracy:G3,getRoundMatchUps:ba,getRounds:K3,isValidMatchUpFormat:Rs,matchUpActions:Gk,participantScheduledMatchUps:j3,tallyParticipantResults:mC,tournamentMatchUps:ex,validMatchUp:yk,validMatchUps:vl});function J3({tournamentRecord:t,venueId:e,venueIds:i}){return t?{courts:(t.venues||[]).filter(n=>e?n.venueId===e:!i||i.includes(n.venueId)).map(n=>{const{venueId:r}=n,o=ft(n.courts||[]);return o.forEach(a=>Object.assign(a,{venueId:r})),o}).flat()}:{error:je}}var wOe=Object.freeze({__proto__:null,getCompetitionVenues:TC,getCourts:J3,getVenuesAndCourts:eh,publicFindVenue:_W});function EC({tournamentRecord:t,outcomes:e}){var i;if(!t)return{error:je};if(!(e!=null&&e.length))return{error:bt,info:"Missing outcomes"};const n=e.reduce((o,a)=>{const{drawId:s,eventId:l}=a;return l&&s&&(o[l]?o[l].includes(s)||o[l].push(s):o[l]=[s]),o},{}),r=Object.keys(n);return{publishedEventIds:((i=t.events)==null?void 0:i.filter(o=>r.includes(o.eventId))).filter(o=>{const a=Xc({event:o}),{drawDetails:s,drawIds:l}=a??{},{eventId:c}=o;return n[c].filter(u=>{const d=s?Object.keys(a.drawDetails).filter(p=>HW({drawId:p,drawDetails:s})):[];return(l==null?void 0:l.includes(u))||d.includes(u)}).length}).map(o=>o.eventId),eventIdPublishedDrawIdsMap:n}}function Q3({tournamentRecord:t,event:e}){var i,n;if(!t)return{error:je};if(!e)return{error:Fi};const r=e.entries||[],o=t.participants||[],a=((i=e.category)==null?void 0:i.categoryName)||((n=e.category)==null?void 0:n.ageCategoryCode),{eventType:s}=e,l=r.map(p=>p.participantId);let c,u,d;return{entryScaleAttributes:o.filter(p=>l.includes(p.participantId)).map(p=>{var h,f,m,g,v,y;const{participantId:b,participantName:I,name:T}=p;let S={scaleType:Aue,eventType:s,scaleName:a};const w=(f=(h=ud({participant:p,scaleAttributes:S}))==null?void 0:h.scaleItem)==null?void 0:f.scaleValue;S={scaleType:Zke,eventType:s,scaleName:a};const U=(g=(m=ud({participant:p,scaleAttributes:S}))==null?void 0:m.scaleItem)==null?void 0:g.scaleValue;S={scaleType:Kke,eventType:s,scaleName:a};const D=(y=(v=ud({participant:p,scaleAttributes:S}))==null?void 0:v.scaleItem)==null?void 0:y.scaleValue;return c=!(!c&&!w),u=!(!u&&!U),d=!(!d&&!D),{participantId:b,participantName:I||T,seed:w,ranking:U,rating:D}}),hasSeededParticipants:c,hasRankedParticipants:u,hasRatedParticipants:d}}function eq({tournamentRecord:t,withScaleValues:e,scaleEventType:i,inContext:n,eventIds:r,drawIds:o,context:a}){var s,l,c,u;if(!t)return{error:je};const{tournamentId:d}=t,p=(t.events??[]).filter(({eventId:f})=>!r||Array.isArray(r)&&r.includes(f)).map(f=>{var m;const g=(m=f.drawDefinitions)==null?void 0:m.map(TR);if(o!=null&&o.length&&!sr(o,g).length)return;const v=ft(f);return n&&Object.assign(v,{tournamentId:d}),a&&Object.assign(v,a),v}).filter(Boolean),h={};if(e){const f=Qn({withScaleValues:!0,tournamentRecord:t}).participantMap,m=g=>g.reduce((v,y)=>v+parseFloat(y),0);for(const g of p){const v=i??g.eventType,y=g.eventId;h[y]||(h[y]={ratingsStats:{},ratings:{},ranking:{},draws:{}});const b=(g.entries??[]).filter(({entryStatus:E})=>Zc.includes(E)).map(li),I=E=>{var C,M,N,R,A,_;if((C=E==null?void 0:E.ratings)!=null&&C[v])for(const k of((M=E==null?void 0:E.ratings)==null?void 0:M[v])??[]){const O=k.scaleName;h[y].ratings[O]||(h[y].ratings[O]=[]);const F=(N=Gs[O])==null?void 0:N.accessor;if(F){const B=parseFloat((R=k.scaleValue)==null?void 0:R[F]);B&&h[y].ratings[O].push(B)}}if((A=E==null?void 0:E.rankings)!=null&&A[v])for(const k of((_=E==null?void 0:E.rankings)==null?void 0:_[v])??[]){const O=k.scaleName;h[y].ranking[O]||(h[y].ranking[O]=[]),k.scaleValue&&h[y].ranking[O].push(k.scaleValue)}};for(const E of b){const C=(s=f==null?void 0:f[E])==null?void 0:s.participant;if((C==null?void 0:C.participantType)!==ui)for(const M of(C==null?void 0:C.individualParticipantIds)??[]){const N=(l=f==null?void 0:f[M])==null?void 0:l.participant;I(N)}else I(C)}const T=h[y].ratings;for(const E of Object.keys(T)){const C=T[E];if(!C.length)continue;const M=(c=g7(C))==null?void 0:c.toFixed(2);h[y].ratingsStats[E]={avg:parseFloat((m(C)/C.length).toFixed(2)),median:M?parseFloat(M):void 0,max:Math.max(...C),min:Math.min(...C)}}const S=(E,C)=>{var M,N;const R=A=>{var _,k,O,F,B,$,V,H,z,G;if((_=h[y].draws)!=null&&_[E]&&(k=A==null?void 0:A.ratings)!=null&&k[v])for(const W of((O=A==null?void 0:A.ratings)==null?void 0:O[v])??[]){const K=W.scaleName;(F=h[y].draws[E])!=null&&F.ratings[K]||(h[y].draws[E].ratings[K]=[]);const Z=(B=Gs[K])==null?void 0:B.accessor;if(Z){const Y=parseFloat(($=W.scaleValue)==null?void 0:$[Z]);Y&&h[y].draws[E].ratings[K].push(Y)}}if((V=h[y].draws)!=null&&V[E]&&(H=A==null?void 0:A.rankings)!=null&&H[v])for(const W of((z=A==null?void 0:A.rankings)==null?void 0:z[v])??[]){const K=W.scaleName;(G=h[y].draws[E])!=null&&G.ranking[K]||(h[y].draws[E].ranking[K]=[]);const Z=W.scaleValue;Z&&h[y].draws[E].ranking[K].push(Z)}};for(const A of C.filter(Boolean)){const _=(M=f==null?void 0:f[A])==null?void 0:M.participant;if((_==null?void 0:_.participantType)!==ui)for(const k of(_==null?void 0:_.individualParticipantIds)??[]){const O=(N=f==null?void 0:f[k])==null?void 0:N.participant;R(O)}else R(_)}},w=[],U=E=>(o==null?void 0:o.length)&&o.includes(E)||w.includes(E);for(const E of g.drawDefinitions??[]){const C=E.drawId;if(U(C))continue;const M=Pg({drawDefinition:E}).assignedParticipantIds??[];h[y].draws[C]||(h[y].draws[C]={ratingsStats:{},ratings:{},ranking:{}}),w.push(C),S(C,M)}const D=Zn({event:g}).flightProfile;for(const E of(D==null?void 0:D.flights)??[]){const C=E.drawId;U(C)||S(C,E.drawEntries.map(li))}for(const E of w){const C=h[y].draws[E].ratings;for(const M of Object.keys(C)){const N=C[M];if(!N.length)continue;const R=(u=g7(N))==null?void 0:u.toFixed(2);h[y].draws[E].ratingsStats[M]={avg:parseFloat((m(N)/N.length).toFixed(2)),median:R?parseFloat(R):void 0,max:Math.max(...N),min:Math.min(...N)}}}}}return It({eventScaleValues:h,events:p,...le})}function tq({tournamentRecord:t,drawDefinition:e,context:i,event:n}){var r;if(!t)return{error:je};if(!n)return{error:Fi};const o=ft(n);return i&&Object.assign(o,i),It({drawDefinition:e&&((r=o.drawDefinitions)==null?void 0:r.find(({drawId:a})=>e.drawId===a)),event:o})}var SOe=Object.freeze({__proto__:null,bulkUpdatePublishedEventIds:EC,categoryCanContain:$k,getCategoryAgeDetails:gC,getEvent:tq,getEventProperties:Q3,getEventStructures:xk,getEventTimeItem:nC,getEvents:eq,getFlightProfile:Zn,getScaledEntries:ry}),TOe=Object.freeze({__proto__:null,allCompetitionMatchUps:Vc,allDrawMatchUps:Fa,allEventMatchUps:Qp,allPlayoffPositionsFilled:t3,allTournamentMatchUps:Vr,analyzeDraws:bC,analyzeMatchUp:xU,analyzeTournament:k3,bulkUpdatePublishedEventIds:EC,calculateWinCriteria:hb,categoryCanContain:$k,checkMatchUpIsComplete:gm,checkValidEntries:zk,compareTieFormats:Ap,competitionScheduleMatchUps:PC,credits:function(){return`
    This project would not have been possible without the generous input and patience
    of tournament organizers and directors who worked with early versions of CourtHive/TMX.

    Thanks to Pavel, Ivan, Mladen, Zdenko, Antonia, Jakov, Kreso, Barry, Jeff, Bobby... to name just a few. 

    The project would not have even begun without the support of Miro, or the introduction by Sretchko.
    The project would not have succeeded without the enthusiasm of Randy and Bruce.
    Thanks to serendipity and Luca and the ensuing TODS conversations with ITF.
    Thanks to Scott and Jake for sanity checks, suggestions, and camaraderie.
    Thanks to Zoran for inspiring the async support and getting into the weeds with subscriptions.
    Thanks to Dave for backing the conversion of TMX 1.x source into the factory repository.
    Thanks to Vuk and Pavle and Rich and Chris and Deepa for the direct engagement with the APIs.
    Thanks to Joe for repeatedly challenging me and the many pointers to useful tooling.
    Thanks to Shannon for the validation of the approach from his deep domain experience.
    Thanks to Nikola for the ongoing camaraderie and explorations of what we can do with TODS.

    And a special thanks to my family for putting up with the long days and weeks and months of coding
    and conversations at all hours.
  `},drawMatchUps:X3,eventMatchUps:Qk,filterParticipants:sC,findDrawDefinition:I3,findExtension:ei,getAllDrawMatchUps:Ar,getAllowedDrawTypes:qk,getAllowedMatchUpFormats:N3,getAppliedPolicies:Gi,getAssignedParticipantIds:Pg,getAvailablePlayoffProfiles:hC,getCategoryAgeDetails:gC,getCheckedInParticipantIds:ib,getCompetitionDateRange:Kk,getCompetitionMatchUps:kU,getCompetitionParticipants:P3,getCompetitionPenalties:A3,getCompetitionVenues:TC,getCourts:J3,getDrawDefinitionTimeItem:BW,getDrawParticipantRepresentativeIds:y3,getDrawTypeCoercion:wC,getEligibleVoluntaryConsolationParticipants:v3,getEntriesAndSeedsCount:Hk,getEvent:tq,getEventMatchUpFormatTiming:$3,getEventProperties:Q3,getEventStructures:xk,getEventTimeItem:nC,getEvents:eq,getFlightProfile:Zn,getLinkedTournamentIds:WP,getMatchUpCompetitiveProfile:KP,getMatchUpContextIds:z3,getMatchUpDailyLimits:tx,getMatchUpDailyLimitsUpdate:V3,getMatchUpDependencies:rc,getMatchUpFormat:W3,getMatchUpFormatTiming:eC,getMatchUpFormatTimingUpdate:B3,getMatchUpScheduleDetails:Pk,getMatchUpType:Ck,getMatchUpsStats:q3,getMaxEntryPosition:F3,getModifiedMatchUpFormatTiming:Jk,getPairedParticipant:Kl,getParticipantEventDetails:C3,getParticipantIdFinishingPositions:b3,getParticipantMembership:E3,getParticipantScaleItem:yw,getParticipantSchedules:M3,getParticipantSignInStatus:R3,getParticipantTimeItem:$W,getParticipants:Qn,getPersonRequests:Cg,getPolicyDefinitions:Zp,getPositionAssignments:_U,getPositionsPlayedOff:z0,getPredictiveAccuracy:G3,getRoundMatchUps:ba,getRounds:K3,getScaleValues:O0,getScaledEntries:ry,getScheduledRoundsDetails:SC,getSchedulingProfile:th,getSchedulingProfileIssues:L3,getSeedingThresholds:JW,getSeedsCount:IC,getStructureSeedAssignments:ul,getTeamLineUp:Ym,getTieFormat:O3,getTimeItem:Hu,getTournamentIds:zP,getTournamentInfo:pb,getTournamentPenalties:Yk,getTournamentPersons:_3,getTournamentStructures:e3,getTournamentTimeItem:rC,getValidGroupSizes:cC,getVenuesAndCourts:eh,isAdHoc:Zl,isCompletedStructure:Bh,isValidForQualifying:S3,isValidMatchUpFormat:Rs,matchUpActions:Gk,participantScaleItem:ud,participantScheduledMatchUps:j3,positionActions:w3,publicFindVenue:_W,tallyParticipantResults:mC,tieFormatGenderValidityCheck:Bk,tournamentMatchUps:ex,validMatchUp:yk,validMatchUps:vl,validateCollectionDefinition:vC,validateLineUp:kk});const UOe=["collectionId","collectionPosition","drawPositions","extensions","finishingPositionRange","finishingRound","isMock","matchUpId","matchUpStatus","matchUpStatusCodes","orderOfFinish","processCodes","roundNumber","tieFormat","tieMatchUps","roundPosition","score","sides","winnerMatchUpId","loserMatchUpId","matchUpDuration","winningSide"];function oB(t,e=".",i=[]){return typeof t=="object"&&Object.keys(t).reduce((n,r)=>typeof t[r]!="object"?(n[i.concat(r).join(e)]=t[r],n):Object.assign(n,oB(t[r],e,i.concat(r))),{})}function Upe(t=0){(typeof t!="number"||isNaN(t))&&(t=0);const e=new Date;return e.setHours(e.getHours()+t),e.getTime().toString(36).slice(-6).toUpperCase()}var Dpe=Object.freeze({__proto__:null,JSON2CSV:function(t,e){if(e&&typeof e!="object")return{error:Re};let{columnTransform:i={}}=e||{};const{includeTransformAccessors:n,includeHeaderRow:r=!0,returnTransformedJSON:o,removeEmptyColumns:a,onlyHeaderRow:s,columnAccessors:l=[],functionMap:c={},columnMap:u={},valuesMap:d={},context:p={},delimiter:h='"',columnJoiner:f=",",rowJoiner:m=`\r
`,keyJoiner:g="."}=e||{};if(!Array.isArray(t)||!Array.isArray(l)||typeof p!="object"||typeof u!="object"||typeof i!="object"||typeof c!="object"||typeof d!="object"||typeof f!="string"||typeof m!="string"||typeof g!="string"||typeof h!="string")return{error:Re};i=Object.assign({},...Object.keys(i).reverse().map(M=>({[M]:Array.isArray(i[M])?i[M]:[typeof i[M]=="string"&&i[M]].filter(Boolean)})));const v=t.filter(Boolean).map(M=>oB(M,g)),y=Object.values(i).flat();n&&l.push(...y);const b=v.reduce((M,N)=>Object.keys(N).every(R=>!M.includes(R)&&M.push(R)||!0)&&M,[]).filter(M=>!(l!=null&&l.length)||l.includes(M)),I=Object.assign({},...Object.keys(i).reverse().map(M=>i[M].map(N=>({[N]:M})).flat()).flat()),T=b.reduce((M,N)=>{const R=I[N];return R?M.includes(R)||M.push(R):M.push(N),M},[]).sort((M,N)=>e!=null&&e.sortOrder?e.sortOrder.includes(M)&&e.sortOrder.includes(N)&&e.sortOrder.indexOf(M)-e.sortOrder.indexOf(N)||!e.sortOrder.includes(N)&&-1:0);Object.keys(u).forEach(M=>!T.includes(M)&&T.unshift(M)),Object.keys(i).forEach(M=>!T.includes(M)&&T.unshift(M)),typeof p=="object"&&Object.keys(p).forEach(M=>!T.includes(M)&&T.unshift(M));let S=T.map(M=>u[M]||M);if(s)return[S];const w=M=>`${h}${M}${h}`,U=[];let D=v.map(M=>Object.values(T.reduce((N,R,A)=>{var _;const k=i[R],O=(k!=null&&k.length?M[k.find($=>M[$])]:M[R])||(p==null?void 0:p[R])||"",F=((_=d[R])==null?void 0:_[O])||O,B=typeof c[R]=="function"?c[R](F):F;return N[R]=w(B),B&&(U[A]=(U[A]||0)+1),N},{})));const E=a&&[...U].map((M,N)=>!M&&N).filter(ir).reverse();if(E){const M=N=>N.filter((R,A)=>!E.includes(A));D=D.map(M),S=M(S)}const C=D.map(M=>M.join(f));return o?C.map(M=>{const N=M.split(f);return Object.assign({},...N.map((R,A)=>({[S[A]]:R})))}):r?[S.map(w).join(f),...C].join(m):C.join(m)},UUID:Hi,UUIDS:function(t=1){return nt(0,t).map(Hi)},allNumeric:Wle,attributeFilter:Kv,chunkArray:Kr,chunkByNth:k2,chunkSizeProfile:function t(e,[i,...n]){return e.length?[e.slice(0,i),...t(e.slice(i),[...n,i])]:[]},constantToString:yo,countValues:function(t){return v7(cs(t))},createMap:Rce,dateTime:dke,definedAttributes:It,dehydrateMatchUps:function({tournamentRecord:t}){if(!t)return{error:je};if(typeof t!="object"||!t.tournamentId)return{error:Re};const{matchUps:e}=Vr({tournamentRecord:t,inContext:!1});if(e!=null&&e.length){const i=function({tournamentRecord:n}){const r={};for(const o of n.events||[]){o.matchUpFormat&&(r[o.eventId]=o.matchUpFormat);for(const a of o.drawDefinitions||[]){a.matchUpFormat&&(r[a.drawId]=a.matchUpFormat);for(const s of a.structures||[]){s.matchUpFormat&&(r[s.structureId]=s.matchUpFormat);for(const l of s.structures||[])l.matchUpFormat&&(r[l.structureId]=l.matchUpFormat)}}}return r}({tournamentRecord:t});(function(n,r={}){for(const o of n){const{structureId:a,drawId:s,eventId:l}=o,c=r[a]||r[s]||r[l],u=o.matchUpFormat===c?void 0:o.matchUpFormat;for(const d of Object.keys(o))UOe.includes(d)||delete o[d];o.sides&&o.drawPositions&&!o.tieMatchUps&&delete o.sides,u&&(o.matchUpFormat=u)}})(e,i)}return{...le}},extractAttributes:Nce,flattenJSON:oB,generateDateRange:ik,generateHashCode:function(t){if(t===null||typeof t!="object")return;const e=JSON.stringify(t),i=B2(t),n=e.split("").reduce((r,o)=>r+o.charCodeAt(0),0);return[e.length,i,n].map(r=>r.toString(36)).join("")},generateRange:nt,generateTimeCode:Upe,groupValues:v7,hasAttributeValues:t=>e=>Object.keys(t).every(i=>e[i]===t[i]),instanceCount:cs,intersection:sr,isConvertableInteger:$t,isNumeric:ir,isOdd:Hle,isPowerOf2:Lc,makeDeepCopy:ft,matchUpSort:ob,nearestPowerOf2:Gz,nextPowerOf2:R0,noNulls:function(t){return Array.isArray(t)?t==null?void 0:t.map(e=>e===null?void 0:e):t},noNumeric:qle,numericSort:Sr,occurrences:function(t,e){return Array.isArray(e)&&e.reduce((i,n)=>(i[n]=1+i[n]||1,i),{})[t]||0},overlap:ua,randomMember:Al,randomPop:es,shuffleArray:Qo,structureSort:Zy,subSort:function(t,e,i,n){return Array.isArray(t)?[].concat(...t.slice(0,e),...t.slice(e,e+i).sort(n),...t.slice(e+i,t.length)):[]},undefinedToNull:function t(e,i){if(e===void 0)return null;if(typeof e!="object"||e===null)return e;const n=Object.keys(e);return Object.assign({},...n.map(r=>{return Array.isArray(e[r])?{[r]:i?e[r]:e[r].map(a=>t(a))}:{[r]:i?(o=e[r],o===void 0?null:o):t(e[r])};var o}))},unique:ti,visualizeScheduledMatchUps:function({scheduledMatchUps:t,showGlobalLog:e}){ER.length=0;const i=t==null?void 0:t.reduce((r,{structureId:o})=>r.includes(o)?r:r.concat(o),[]),n=Array.isArray(i)&&{...i.map(r=>{const{structureName:o,matchUpType:a}=t.find(s=>s.structureId===r);return{[r]:`${o} ${a}`}})};i==null||i.forEach(r=>{var o;nl({color:"blue",method:"draw",structure:n[r],keyColors:{structure:"magenta"}},!0);const a=t.filter(l=>l.structureId===r),s=((o=ba({matchUps:a}))==null?void 0:o.roundMatchUps)||[];Object.keys(s).forEach(l=>{nl({roundNumber:l,keyColors:{roundNumber:"brightcyan"}},!0),s[l].forEach(({matchUpId:c,schedule:u})=>{nl({matchUpId:c,time:mn(u.scheduledTime),date:u.scheduledDate,venue:u.venueId,keyColors:{time:"brightcyan",date:"brightcyan",matchUpId:"yellow",venue:"magenta"}},!0)})})}),e&&cxe()}});const jR={[mc]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:{drawTypes:{[Rd]:{positioning:Hm},[Yl]:{positioning:Hm}},positioning:"SEPARATE"},policyName:"USTA SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}};function DOe(t){var e,i;const n="validateAndDeriveDrawValues",{appliedPolicies:r,policyDefinitions:o}=function(m){const{tournamentRecord:g,event:v}=m,y=Gi({tournamentRecord:g,event:v}).appliedPolicies??{},b=ft(m.policyDefinitions??{},!1,!0);return{appliedPolicies:y,policyDefinitions:b}}(t),a=function({enforceGender:m,policyDefinitions:g,appliedPolicies:v}){var y,b,I,T;return m??((b=(y=g==null?void 0:g[so])==null?void 0:y.participants)==null?void 0:b.enforceGender)??((T=(I=v==null?void 0:v[so])==null?void 0:I.participants)==null?void 0:T.enforceGender)}({...t,policyDefinitions:o,appliedPolicies:r}),s=function({considerEventEntries:m=!0,drawEntries:g,eventEntries:v,qualifyingOnly:y}){return(y&&[]||g||(m?v:[])).filter(({entryStage:b})=>!b||b===ct)}(t),l=function(m){const{consideredEntries:g,appliedPolicies:v,policyDefinitions:y,enforceGender:b,participantMap:I,participants:T,event:S}=m;return S&&T&&zk({consideredEntries:g,policyDefinitions:y,appliedPolicies:v,participantMap:I,enforceGender:b,participants:T,event:S})}({...t,appliedPolicies:r});if(l!=null&&l.error)return ce({result:l,stack:n});const c=function(m){return!m.drawSize&&m.consideredEntries.length&&![ll,mU,uw,Yl,Rd].includes(m.drawType??"")&&R0(m.consideredEntries.length)||m.drawSize&&Ct(m.drawSize)||!1}({...t,consideredEntries:s}),u=function(m){const{policyDefinitions:g,appliedPolicies:v,enforceMinimumDrawSize:y=!0,drawSize:b}=m,I=m.drawTypeCoercion??wC({drawType:m.drawType,policyDefinitions:g,appliedPolicies:v}),T=fpe({drawType:m.drawType,enforceMinimumDrawSize:y,drawTypeCoercion:I,drawSize:b});return T.error?T:{drawType:T.drawType}}({...t,appliedPolicies:r,policyDefinitions:o,drawSize:c});if(u.error)return ce({result:u,stack:n});const d=u.drawType;if(isNaN(c)&&d!==ll)return ce({result:{error:Y_},stack:n});const p=(o==null?void 0:o[mc])??(r==null?void 0:r[mc]),h=t.seedingProfile??((i=(e=p==null?void 0:p.seedingProfile)==null?void 0:e.drawTypes)==null?void 0:i[d??""])??(p==null?void 0:p.seedingProfile);t.seedingProfile&&(o[mc]||(o[mc]={...jR[mc]}),o[mc].seedingProfile=h);const f=function(m){var g,v;const{tournamentRecord:y,event:b,ignoreAllowedDrawTypes:I,drawType:T}=m,S=!I&&y&&qk({tournamentRecord:y,categoryType:(g=b==null?void 0:b.category)==null?void 0:g.categoryType,categoryName:(v=b==null?void 0:b.category)==null?void 0:v.categoryName});return S!=null&&S.length&&!S.includes(T)?{error:Wz}:{...le}}({...t,drawType:d});return f!=null&&f.error?ce({result:f,stack:n}):{drawSize:c,drawType:d,enforceGender:a,seedingProfile:h,appliedPolicies:r,policyDefinitions:o}}function POe(t){var e,i,n,r,o;const a=t.drawDefinition,{existingQualifyingPlaceholderStructureId:s,drawEntries:l,appliedPolicies:c,structureId:u,idPrefix:d,isMock:p}=t,h=t.qualifyingProfiles,f=h!=null&&h.length?hpe({uuids:t.uuids,qualifyingProfiles:h,appliedPolicies:c,idPrefix:d,isMock:p}):void 0;if(f!=null&&f.error)return f;a.structures=(e=a.structures)==null?void 0:e.filter(({structureId:S})=>S!==s),a.links=(i=a.links)==null?void 0:i.filter(({source:S})=>S.structureId!==s);const{qualifiersCount:m,qualifyingDrawPositionsCount:g,qualifyingDetails:v}=f??{};g&&(f!=null&&f.structures&&((n=a.structures)==null||n.push(...f.structures)),f!=null&&f.links&&((r=a.links)==null||r.push(...f.links)));const y=(o=a.structures)==null?void 0:o.find(({stage:S,stageSequence:w})=>S===ct&&w===1),{qualifiersCount:b}=G0({stageSequence:1,drawDefinition:a,structureId:u,stage:ct});let I=Sde({qualifiersCount:Math.max(m??0,b??0),drawDefinition:a,stage:ct});if(I.error||(I=_R({drawSize:g,stage:St,drawDefinition:a}),I.error))return I;(function({drawDefinition:S,drawEntries:w}){for(const U of(w??[]).filter(({entryStage:D})=>D===St))que({...U,entryStage:U.entryStage??ct,drawDefinition:S})})({drawDefinition:a,drawEntries:l});const T=function({mainStructure:S,qualifyingDetails:w,drawDefinition:U}){var D;for(const E of w||[]){const{finalQualifyingRoundNumber:C,finalQualifyingStructureId:M,roundTarget:N,finishingPositions:R,linkType:A}=E,_=S&&((D=pC({targetStructureId:S.structureId,sourceStructureId:M,sourceRoundNumber:C,finishingPositions:R,targetEntryRound:N,linkType:A}))==null?void 0:D.link);if(_!=null&&_.error)return _;_&&(U.links||(U.links=[]),U.links.push(_))}return{error:void 0}}({mainStructure:y,qualifyingDetails:v,drawDefinition:a});return T.error?T:{drawDefinition:a,structureId:u}}function iq({roundsCount:t=1,drawDefinition:e,matchUpsCount:i,structureId:n,idPrefix:r,isMock:o,event:a}){var s;const l=[];let c;for(const u of nt(1,t+1)){const d=Wk({ignoreLastRoundNumber:!!c,newRound:!c,drawDefinition:e,matchUpsCount:i,structureId:n,roundNumber:c,idPrefix:r,isMock:o,event:a});if(d.error)return ce({result:d,info:{iteration:u}});(s=d.matchUps)!=null&&s.length&&l.push(...d.matchUps),c=((d==null?void 0:d.roundNumber)??1)+1}return{matchUps:l}}function nq(t){var e,i;const n=function(p){var h;return p.roundsCount&&typeof p.roundsCount!="number"?{error:Re,info:"roundsCount must be a number"}:typeof p.drawDefinition!="object"||p.drawDefinition.drawType&&p.drawDefinition.drawType!==ll?{error:yI}:!Array.isArray((h=p.drawDefinition)==null?void 0:h.entries)&&p.participantIds&&!Array.isArray(p.participantIds)?{error:Re,info:"Missing Entries"}:{error:void 0}}(t);if(n!=null&&n.error)return n;const r=function(p){var h,f;let{participantIds:m}=p;const g=((f=(h=p.drawDefinition)==null?void 0:h.entries)==null?void 0:f.filter(v=>{const y=v.entryStatus;return!p.restrictEntryStatus||Zc.includes(y)}).map(li))??[];if(m){const v=m.filter(y=>!(g!=null&&g.includes(y)));if(v!=null&&v.length)return ce({result:{error:Dd},info:{invalidParticipantIds:v}})}else m=g;return p.roundsCount&&p.roundsCount>m.length-1&&(!p.enableDoubleRobin||p.roundsCount>2*(m.length-1))?{error:Re,info:"Not enough participants for roundsCount"}:{participantIds:m}}(t);if(r.error)return r;const o=function(p){var h,f,m;if(p.structureId)return p.structureId;const g=p.drawDefinition,v=(f=(h=g==null?void 0:g.structures)==null?void 0:h.filter(b=>b.stageSequence===1))==null?void 0:f.reduce((b,I)=>{const T=I.stage&&Qv[I.stage];return Zl({drawDefinition:g,structure:I})&&T>(Qv[b==null?void 0:b.stage]||1)?I:b},void 0),y=(m=g==null?void 0:g.structures)==null?void 0:m.find(b=>b.structureId===(v==null?void 0:v.structureId));return y?Zl({drawDefinition:g,structure:y})?{structure:y}:{error:yI}:{error:Cn}}(t);if(o.error)return o;const a=function(p){const{tournamentRecord:h,participantIds:f,scaleAccessor:m,scaleName:g,eventType:v,adHocRatings:y={}}=p,b=h.participants??[];for(const I of f??[]){const T=b==null?void 0:b.find(w=>w.participantId===I);let S=xY({scaleName:`${g}.${$ce}`,scaleAccessor:m,participant:T,eventType:v});!S&&g&&(S=xY({scaleAccessor:m,participant:T,scaleName:g,eventType:v})),S&&!y[I]&&(y[I]=S)}return y}(t),s=((e=t.tournamentRecord)==null?void 0:e.isMock)??t.isMock,l=t.eventType??((i=t.event)==null?void 0:i.eventType),c=[],u=[];let d;for(const p of nt(1,(t.roundsCount??1)+1)){const h=D3({...t,participantIds:r.participantIds,structure:o.structure,ignoreLastRoundNumber:!0,iterationMatchUps:c,adHocRatings:a,roundNumber:d,eventType:l,isMock:s});if(h.error)return h;const{matchUps:f,...m}=h;u.push({...m,iteration:p,matchUpsCount:f==null?void 0:f.length}),d=((m==null?void 0:m.roundNumber)??1)+1,f!=null&&f.length&&c.push(...f)}return{...le,matchUps:c,roundResults:u}}function xY({scaleType:t=Tv,scaleAccessor:e,participant:i,scaleName:n,eventType:r}){var o;const a=i&&ud({scaleAttributes:{eventType:r??fw,scaleType:t,scaleName:n},participant:i}),s=(o=a==null?void 0:a.scaleItem)==null?void 0:o.scaleValue;return e&&bn(s)?s[e]:s}function COe(t){var e,i;const{tournamentRecord:n,drawDefinition:r,structureId:o,idPrefix:a,isMock:s,event:l}=t,c=(e=l==null?void 0:l.entries)==null?void 0:e.filter(({entryStage:p,entryStatus:h})=>(!p||p===ct)&&h&&Zc.includes(h)),u=c==null?void 0:c.map(li),d=c?Math.floor(c.length/2):0;if(t.automated)return function(p){var h,f;const{restrictEntryStatus:m,generateMatchUps:g,structureId:v,matchUpIds:y,scaleName:b}=p.drawMatic??{},I=nq({...p,eventType:((h=p.drawMatic)==null?void 0:h.eventType)??p.matchUpType,generateMatchUps:g??!0,participantIds:p.participantIds,roundsCount:p.roundsCount,restrictEntryStatus:m,structureId:v,matchUpIds:y,scaleName:b});return I.error?I:((f=I==null?void 0:I.matchUps)!=null&&f.length&&LR({tournamentRecord:p.tournamentRecord,drawDefinition:p.drawDefinition,suppressNotifications:!0,matchUps:I.matchUps,event:p.event,structureId:v}),{...le})}({...t,participantIds:u});{const p=iq({roundsCount:t.roundsCount,drawDefinition:r,matchUpsCount:d,idPrefix:a,isMock:s,event:l});if(p.error)return p;(i=p.matchUps)!=null&&i.length&&LR({matchUps:p.matchUps,suppressNotifications:!0,tournamentRecord:n,drawDefinition:r,structureId:o,event:l})}return{...le}}function Ppe(t){const e="prepareStage",{drawDefinition:i}=t,{structures:n}=Nd({stageSequence:t.stageSequence||1,roundTarget:t.roundTarget,stage:t.stage,drawDefinition:i}),r=t.preparedStructureIds||[],o=n==null?void 0:n.find(({structureId:h})=>!r.includes(h));if(!o)return ce({result:{error:Cn},stack:e});const a=o==null?void 0:o.structureId,{seedsCount:s,stageEntries:l,seedLimit:c}=function(h){let{seedsCount:f}=h;h.seededParticipants&&(f=h.seededParticipants.length),f>h.drawSize&&(f=h.drawSize);const m=function({entries:v,stage:y,stageSequence:b,roundTarget:I}){return v.filter(T=>{var S,w;const U=(w=(S=ei({name:$u,element:T}))==null?void 0:S.extension)==null?void 0:w.value;return(!T.entryStage||T.entryStage===y)&&(!b||!T.entryStageSequence||T.entryStageSequence===b)&&(!I||!U||U===I)&&Jy.includes(T.entryStatus)})}(h);f>m.length&&(f=m.length);const{seedLimit:g}=function({requireParticipantCount:v=!0,enforcePolicyLimits:y=!0,drawSizeProgression:b,participantsCount:I,participantCount:T,appliedPolicies:S,drawDefinition:w,seedingProfile:U,structureId:D,seedsCount:E}){var C,M;I=I??T;const N=kt({drawDefinition:w,structureId:D});if(N.error)return N;const R=N.structure;if(!R)return{error:Cn};const{positionAssignments:A}=Lr({structure:R}),_=(A==null?void 0:A.length)||0;if(E>_)return{error:QAe};const k=(C=R.structures)==null?void 0:C.length,O=$t(U==null?void 0:U.groupSeedingThreshold)&&(U==null?void 0:U.groupSeedingThreshold),F=(M=XW({roundRobinGroupsCount:k,drawSize:_}))==null?void 0:M.seedGroups,{seedsCount:B}=IC({policyDefinitions:S,requireParticipantCount:v,drawSizeProgression:b,participantsCount:I,drawSize:_});return B&&S!=null&&S[mc]&&E>B&&y&&(E=B),R.seedLimit=E,R.seedAssignments=nt(1,E+1).map($=>{const V=F==null?void 0:F.find(z=>z.includes($)),H=V&&Math.min(...V);return{participantId:void 0,seedNumber:$,seedValue:O&&$>=O?H:$}}),un({drawDefinition:w,structureIds:[D]}),{...le,seedLimit:E}}({enforcePolicyLimits:h.enforcePolicyLimits??!0,appliedPolicies:h.appliedPolicies,participantsCount:m.length,seedingProfile:h.seedingProfile,drawDefinition:h.drawDefinition,structureId:h.structureId,seedsCount:f});return g&&g<f&&(f=g),{seedsCount:f,stageEntries:m,seedLimit:g}}({...t,structureId:a});(t.seededParticipants||t.event||t.seedingScaleName)&&function(h){const{seededParticipants:f,seedingScaleName:m,entries:g,event:v}=h,y=g.map(li);f?function(b){const{provisionalPositioning:I,enteredParticipantIds:T,seededParticipants:S,tournamentRecord:w,appliedPolicies:U,drawDefinition:D,seedingProfile:E,structureId:C,structure:M,event:N}=b,R=M?lb({provisionalPositioning:I,appliedPolicies:U,drawDefinition:D,seedingProfile:E,structure:M}):void 0;S.filter(({participantId:A})=>T.includes(A)).filter(A=>!A.seedNumber||A.seedNumber<=S.length).sort((A,_)=>A.seedNumber<_.seedNumber?-1:A.seedNumber<_.seedNumber?1:0).forEach(A=>{const{participantId:_,seedNumber:k,seedValue:O}=A;vw({provisionalPositioning:I,tournamentRecord:w,drawDefinition:D,seedingProfile:E,participantId:_,seedBlockInfo:R,structureId:C,seedNumber:k,seedValue:O,event:N})})}({...h,enteredParticipantIds:y}):(v||m)&&function(b){let I=b.seedsCount;const{provisionalPositioning:T,enteredParticipantIds:S,seedAssignmentProfile:w,assignSeedsCount:U,tournamentRecord:D,drawDefinition:E,seedByRanking:C,seedingProfile:M,structureId:N,event:R}=b,{categoryName:A,ageCategoryCode:_}=(R==null?void 0:R.category)||{},k=R==null?void 0:R.eventType,O=function(B){const{tournamentRecord:$,seedingScaleName:V,stageSequence:H,entries:z,stage:G,event:W}=B,{categoryName:K,ageCategoryCode:Z}=(W==null?void 0:W.category)||{},Y=W==null?void 0:W.eventType,X={scaleName:V||K||Z||W.eventId,scaleType:ap,eventType:Y};return ry({scaleAttributes:X,tournamentRecord:$,stageSequence:H,entries:z,stage:G}).scaledEntries}({...b,ageCategoryCode:_,categoryName:A,eventType:k})||C&&function(B){const{tournamentRecord:$,stageSequence:V,event:H,entries:z,stage:G}=B,{categoryName:W,ageCategoryCode:K}=(H==null?void 0:H.category)||{},Z=H==null?void 0:H.eventType;return ry({scaleAttributes:{scaleName:W||K,scaleType:Vm,eventType:Z},tournamentRecord:$,stageSequence:V,entries:z,stage:G}).scaledEntries}({...b,ageCategoryCode:_,categoryName:A,eventType:k}),F=(O==null?void 0:O.length)??0;F<I&&(I=F),O==null||O.filter(({participantId:B})=>S.includes(B)).slice(0,U||I).forEach((B,$)=>{const V=$+1,{participantId:H,scaleValue:z}=B;vw({provisionalPositioning:T,tournamentRecord:D,drawDefinition:E,seedingProfile:M,participantId:H,structureId:N,seedNumber:V,seedValue:(w==null?void 0:w[V])||z||V,event:R})})}({...h,enteredParticipantIds:y})}({...t,seedsCount:s,structure:o,structureId:a});const u=t.automated!==!1&&t.drawType!==ll&&!(t.qualifyingOnly&&t.stage!==St),d=((n==null?void 0:n.length)||0)>1,p=u?function(h){const f=typeof h.automated=="object"&&h.automated.seedsOnly,m=uC({...h,seedsOnly:f});if(m.error)return m;const g=m==null?void 0:m.positionAssignments,v=m==null?void 0:m.positioningReport;return{conflicts:m.conflicts,positionAssignments:g,positioningReport:v}}({...t,multipleStructures:d,seedLimit:c,structureId:a}):{};return p!=null&&p.error?ce({result:p,stack:e}):{...p,stageEntries:l,structureId:a,seedsCount:s}}function EOe(t){var e;const i=U3({...t,modifyOriginal:!1});if(i.error)return i;const n=i.drawDefinition,{ignoreStageSpace:r,appliedPolicies:o,qualifyingOnly:a,seedingProfile:s,participants:l,drawEntries:c,placeByes:u,drawSize:d,drawType:p,entries:h}=t,f=[];let m=[];const g=function(I){const{ignoreStageSpace:T,drawDefinition:S,drawEntries:w,drawType:U,entries:D}=I;for(const E of D){if(w&&E.entryStage&&E.entryStage!==ct)continue;const C=que({...E,ignoreStageSpace:T??U===ll,entryStage:E.entryStage??ct,drawDefinition:S,drawType:U});if(w&&C.error)return C}return{error:void 0}}({ignoreStageSpace:r,drawDefinition:n,drawEntries:c,drawType:p,entries:h});if(g.error)return g;const v=p===Gm?0:Ct(t.seedsCount??0),y=Ppe({...t,qualifyingOnly:!d||a,appliedPolicies:o,drawDefinition:n,seedingProfile:s,participants:l,stage:ct,seedsCount:v,placeByes:u,drawSize:d,entries:h});if(y.error&&!y.conflicts)return y;(e=y.positioningReport)!=null&&e.length&&f.push({[ct]:y.positioningReport});const b=y.structureId;return y.conflicts&&(m=y.conflicts),p===ll&&t.roundsCount&&COe({...t,drawDefinition:n,structureId:b}),{drawDefinition:n,positioningReports:f,conflicts:m,structureId:b}}function rq(t){let e=t.structureIds;const{tournamentRecord:i,drawDefinition:n,matchUpFormat:r,structureId:o,matchUpId:a,event:s}=t;if(!n)return{error:rt};if(!r)return{error:Yz};if(!Rs({matchUpFormat:r}))return{error:K_};if(a){const l=vn({drawDefinition:n,matchUpId:a,event:s});if(l.error)return l;if(!l.matchUp)return{error:xo};const c=l.matchUp;if((c==null?void 0:c.matchUpType)===Yr)return{error:ja,info:"Cannot set matchUpFormat when { matchUpType: TEAM }"};c.matchUpFormat=r,Ci({tournamentId:i==null?void 0:i.tournamentId,eventId:s==null?void 0:s.eventId,context:"setMatchUpFormat",drawDefinition:n,matchUp:c})}else if(Array.isArray(e)){if((s==null?void 0:s.eventType)===Yr)return{error:Lm};for(const l of e){const c=kt({drawDefinition:n,structureId:l});if(c.error)return c;if(!c.structure)return{error:Cn};c.structure.matchUpFormat=r}}else if(o){if((s==null?void 0:s.eventType)===Yr)return{error:Lm};const l=kt({drawDefinition:n,structureId:o});if(l.error)return l;if(!l.structure)return{error:Cn};l.structure.matchUpFormat=r}else n&&(n.matchUpFormat=r);return e=e??(o?[o]:void 0),un({drawDefinition:n,structureIds:e}),{...le}}function MOe({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,matchUpType:n,tieFormat:r,event:o}){if((i||r)&&!(i&&(o==null?void 0:o.matchUpFormat)===i||o!=null&&o.tieFormat&&r&&JSON.stringify(o.tieFormat)===JSON.stringify(r))){if(r){const a=function({tieFormat:s}){const l=ds({checkCollectionIds:!1,tieFormat:s});if(l.error)return l;for(const c of s.collectionDefinitions)c.collectionId||(c.collectionId=Hi());return{tieFormat:s}}({tieFormat:r});if(a.error)return a;e.tieFormat=a.tieFormat??r}else if(i){const a=rq({tournamentRecord:t,drawDefinition:e,matchUpFormat:i,event:o});if(a.error)return{info:"matchUpFormat or tieFormat error",error:a.error}}n&&(e.matchUpType=n)}return{error:void 0}}function Cpe(t){const e=Ln(t,[{policyType:!0,_anyOf:{[Oo]:!1,[qp]:!1,[Yy]:!1,[VP]:!1}}]);if(e.error)return e;let i;const n=t.drawDefinition??t.event??((t.tournamentId||!t.tournamentRecords)&&t.tournamentRecord);if(n)return OY(t,n);if(!t.tournamentRecords)return{error:je};{const r=Object.keys(t.tournamentRecords);if(!r.length)return{error:je};for(const o of r){const a=OY(t,t.tournamentRecords[o]);if(a.error)return a;i=!0}}return i?{...le}:{error:uU}}function OY(t,e){const i=Gi(t).appliedPolicies??{};return i[t.policyType]?(delete i[t.policyType],Object.keys(i).length?Ii({element:e,extension:{name:fU,value:i}}):ia({element:e,name:fU}),{...le}):{error:uU}}var ROe=Object.freeze({__proto__:null,attachPolicies:vm,removePolicy:Cpe}),NOe=Object.freeze({__proto__:null,findPolicy:Tg,getAppliedPolicies:Gi,getPolicyDefinitions:Zp}),AOe=Object.freeze({__proto__:null,attachPolicies:vm,findPolicy:Tg,getAppliedPolicies:Gi,getPolicyDefinitions:Zp,mutate:ROe,query:NOe,removePolicy:Cpe});function _Oe({appliedPolicies:t,policyDefinitions:e,drawDefinition:i,stack:n}){if(e&&typeof e!="object")return ce({info:"policyDefinitions must be an object",result:{error:Re},stack:n});const r={[yR]:t==null?void 0:t[yR]};return e?function({policyDefinitions:o,appliedPolicies:a,policiesToAttach:s,drawDefinition:l}){for(const c of Object.keys(o))JSON.stringify(a==null?void 0:a[c])!==JSON.stringify(o[c])&&(s[c]=o[c]);Object.keys(s).length&&(vm({policyDefinitions:s,drawDefinition:l}),a&&Object.assign(a,s))}({policyDefinitions:e,appliedPolicies:t,policiesToAttach:r,drawDefinition:i}):r.avoidance&&vm({drawDefinition:i,policyDefinitions:r}),t!=null&&t[mc]||e!=null&&e[mc]||(vm({policyDefinitions:jR,drawDefinition:i}),t&&Object.assign(t,jR)),{error:void 0}}const kOe=()=>({matchUpType:void 0,drawName:void 0,drawId:void 0,structures:[],entries:[],links:[]});function xOe(t){var e,i,n,r,o;const{tournamentRecord:a,matchUpFormat:s,appliedPolicies:l,policyDefinitions:c,matchUpType:u,tieFormat:d,drawType:p,stack:h,event:f}=t,m=t.drawId?(e=f==null?void 0:f.drawDefinitions)==null?void 0:e.find(T=>T.drawId===t.drawId):void 0;m&&p!==m.drawType&&(m.drawType=p);const g=m??function(T){const{drawId:S=Hi(),processCodes:w,matchUpType:U,drawType:D}=T??{},E=kOe();return Object.assign(E,{processCodes:w,matchUpType:U,drawType:D,drawId:S})}({processCodes:t.processCodes,drawId:t.drawId,drawType:p}),v=MOe({tournamentRecord:a,drawDefinition:g,matchUpFormat:s,matchUpType:u,tieFormat:d,event:f});if(v.error)return ce({result:v,stack:h});const y=_Oe({appliedPolicies:l,policyDefinitions:c,drawDefinition:g,stack:h});if(y.error)return y;const b=(n=(i=m==null?void 0:m.structures)==null?void 0:i.find(T=>T.stage===ct&&T.stageSequence===1))==null?void 0:n.structureId,I=m?(r=m.structures)==null?void 0:r.filter(T=>T.stage===St):[];return{drawDefinition:g,structureId:b,existingDrawDefinition:m,existingQualifyingPlaceholderStructureId:(I==null?void 0:I.length)===1&&!((o=I[0].matchUps)!=null&&o.length)&&I[0].structureId}}function Kd(t){const{winnerFirst:e=!0,addOutcomeString:i,reversed:n=!1,matchUpStatus:r,matchUpFormat:o,autoComplete:a,winningSide:s,sets:l}=t;if(!l)return{error:bt,info:"missing sets"};const c=o&&Ga(o),{bestOf:u,finalSetFormat:d,setFormat:p}=c??{},h=n||!(!e||!s||s===1),f=i?function({matchUpStatus:g}){const v={[da]:"RET",[Li]:"WO",[Mr]:"DF/DF",[gr]:"WO/WO",[Sg]:"SUS",[Es]:"ABN",[Mi]:"DEF",[B0]:"DR"};return g&&v[g]||""}({matchUpStatus:r}):"",m=(l==null?void 0:l.sort(OOe).map(function(g){const v=u&&g.setNumber===u&&d?d:p,y=(v==null?void 0:v.tiebreakSet)||(D=g,!(ir(D==null?void 0:D.side1Score)||ir(D==null?void 0:D.side2Score))&&(A=>ir(A==null?void 0:A.side1TiebreakScore)||ir(A==null?void 0:A.side2TiebreakScore))(g)),{side1Score:b,side2Score:I,side1TiebreakScore:T,side2TiebreakScore:S}=g,w=T||(ir(T)||a?0:""),U=S||(ir(S)||a?0:"");var D;if(y)return`[${(h?[U,w]:[w,U]).join("-")}]`;const E=Math.min(w,U),C=E?`(${E})`:"",M=b||(ir(b)||a?0:""),N=I||(ir(I)||a?0:"");let R=h?`${[N,M].join("-")}${C}`:`${[M,N].join("-")}${C}`;return["-"," "].includes(R)&&(R=""),R}).filter(Boolean).join(" "))||"";return f?s===2?`${f} ${m}`:`${m} ${f}`:m}function OOe(t,e){return t.setNumber-e.setNumber}const HR="\\d+-\\d+",cT="\\d+-\\d+\\(\\d+\\)",aB="\\[\\d+-\\d+\\]",LOe=new RegExp(`(${HR}),`,"g"),FOe=new RegExp(`(${cT}),`,"g"),BOe=[HR,cT,aB,"\\d+-\\d+\\(\\d+-\\d+\\)"],$Oe=["0","1","2","00","01","10","11","002","012","102","112","000","001","010","100","011","101","110","111","002","012","102","112","0002","0012","0102","1002","0112","1012","1102","1112","3","03","13","013","103"].map(t=>{const e=t.split("").map(i=>BOe[i]).join(" ");return new RegExp(`^${e}$`)});function LY(t){return!t||$Oe.some(e=>e.test(t))}function E1(t){return/^\(\d+\)$/.test(t)||/^\(\d+$/.test(t)}function xb(t){const e=(i=t,i==null?void 0:i.split("-").join("").split("/").join(""));var i;if(/^\d+$/.test(e)&&e.length===2){const n=e.split("");return Math.abs(n.reduce((r,o)=>+r-+o))===1}return!1}function GR(t,e){const i=[t.slice(e,e+2),e?t.slice(0,1):t.slice(2)].map(r=>parseInt(r.join("")));e&&i.reverse();const n=i;if(Math.abs(n.reduce((r,o)=>+r-+o))>=2)return n.join("-")}function FY(t){return t.length===2?t.split("").join("-"):([", ",",","/"," "].forEach(e=>t=t.split(e).join("-")),t=t.replace(/-{2,}/,"-"))}function VOe(t){return t.startsWith("(")&&t.endsWith(")")}function M1(t){if(!/^[\d-]+(\(\d\))*$/.test(t))return t;const e=au("-",t.split(""));if(!e.length)return t;const i=t.split("-"),n=!(i.length%2),r=!!(e.length%2);return n&&r&&e.length>i.length/2&&e.filter((o,a)=>a%2).forEach(o=>{t=t.substring(0,o)+" "+t.substring(o+1)}),t}function Epe({score:t}){const e=t.split(""),i=[];let n;const r=()=>n=[void 0,void 0,void 0],o=()=>{let s=`${n[0]}-${n[1]}`;return n[2]&&(s+=` (${n[2]})`),r(),n.push(n),s};r();const a=()=>n[0]!==void 0&&n[1]!==void 0&&Math.abs(parseInt(n[0])-parseInt(n[1]));for(;e.length;){const s=e.shift(),l=ir(s)&&parseInt(s),c=n[0]!==void 0&&n[1]!==void 0;if(ir(l)){if(n[0]===void 0){n[0]=l;continue}if(n[1]===void 0&&(n[1]=l,a())){i.push(o()),n=[void 0,void 0];continue}if(c&&e.length===1&&ir(e[0])){const u=e.pop();n[0]=n[0].toString()+n[1].toString(),n[1]=u,i.push(o()),n=[void 0,void 0]}c&&a()}}return{sets:i}}function sB(t){const e=t.indexOf("1"),i=t.split(""),n=i.every(r=>!isNaN(r));if(n&&t.length===3&&e===0){const r=GR(i,e);if(r)return r}if(n&&t.length===7&&e>3){const r=GR(i.slice(4),e-4);if(r)return`${i[0]}-${i[1]} ${i[2]}-${i[3]} ${r}`}}function BY(t){let{score:e}=t;const{applied:i,matchUpStatus:n}=t,r=e==null?void 0:e.toString().split(""),o=r==null?void 0:r.every(s=>ir(s)),a=s=>Math.abs(s[0]-s[1]);if(typeof e=="number"||o){e=e.toString().toLowerCase(),o&&(e=r.join(""));const s=o?r.map(l=>parseInt(l)):e.split("").map(l=>parseInt(l));if(Epe({score:e}),s.length,e.length===3&&a(s.slice(0,2))===1){const[l,c,u]=s;e=`${l}-${c}(${u})`,i.push("numericTiebreakPattern1")}else if(e.length===3&&s[0]===1){const[l,c,u]=s;e=`[${l}${c}-${u}]`,i.push("numericTiebreakPattern2")}else if(e.length===4&&a(s.slice(0,2))===1&&"987654".split("").includes(s[0].toString())){const[l,c,u,d]=s;e=`${l}-${c}(${Math.min(u,d)})`,i.push("numericTiebreakPattern3")}else if(e.length===4&&s[0]===1&&s[2]===1){const[l,c,u,d]=s;e=`[${l}${c}-${u}${d}]`,i.push("bigSuper")}else if(e.length===4){const[l,c,u,d]=s;e=`${l}${c} ${u}${d}`,i.push("split4")}else if(e.length===5&&a(s.slice(0,2))===1){const[l,c,u,d,p]=s;e=`${l}-${c}(${u}) ${d}-${p}`,i.push("numericTiebreakPattern4")}else if(e.length===5&&a(s.slice(3))===1){const[l,c,u,d,p]=s;e=`${l}-${c} ${u}-${d}(${p})`,i.push("numericTiebreakPattern5")}else if(s.length===7)if(a(s.slice(0,2))>1&&a(s.slice(2,4))>1&&s[4]===1){const[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} [${p}${h}-${f}]`,i.push("numericTiebreakPattern6")}else if(a(s.slice(0,2))===1&&a(s.slice(3,5))>1&&a(s.slice(5,7))>1){const[l,c,u,d,p,h,f]=s;e=`${l}-${c}(${u}) ${d}-${p} ${h}-${f}`,i.push("numericTiebreakPattern7")}else if(a(s.slice(0,2))>1&&a(s.slice(2,4))===1&&a(s.slice(5,7))>1){const[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d}(${p}) ${h}-${f}`,i.push("numericTiebreakPattern8")}else if(a(s.slice(0,2))>1&&a(s.slice(2,4))>1&&a(s.slice(4,6))===1){const[l,c,u,d,p,h,f]=s;e=`${l}-${c} ${u}-${d} ${p}-${h}(${f})`,i.push("numericTiebreakPattern9")}else e=e.slice(0,2)+" "+e.slice(2,4)+" "+e.slice(4),i.push("numericMatchTiebreakPattern");else if(e.length%2){const l=sB(e);l&&e!==l&&i.push("parsedSuperPattern"),e=l??e}else{const l=Kr(e.split(""),2).map(m=>m.join("")),c=l.map(m=>{const[g,v]=m.split("").map(b=>parseInt(b)),y=g>v?1:2;return Math.abs(g-v)>1&&y||-1*y}),u=c.reduce((m,g)=>m>0&&g>0,1),d=cs(c),p=cs(c.map(m=>Math.abs(m))),h=c[0]<0,f=!h&&c[1]<0;if(c[0]>0&&c[1]>0&&c[0]!==c[1])e=[l.slice(0,2).join(" "),l.slice(2).join("-")].join(" "),i.push("numeric3rdSetTiebreakPattern");else if(u)e=l.join(" "),i.push("chunkSplit");else if(s.length==6){if(d[1]==2||d[2]===2)if(Object.values(p).includes(3)){const[m,g,v,y,b,I]=s,T=c.reduce((S,w,U)=>w<0?U:S,void 0);T===0?(e=`${m}-${g}(${Math.min(v,y)}) ${b}-${I}`,i.push("chunkSplitTiebreak1")):T===1?(e=`${m}-${g} ${v}-${y}(${Math.min(b,I)})`,i.push("chunkSplitTiebreak2")):(e=`${m}-${g} ${v}-${y}`,i.push("chunkSplitTrimExtraneous"))}else e=l.join(" "),i.push("chunkSplit")}else if(s.length===8){const[m,g,v,y,b,I,T,S]=s;h||f?s[5]===1&&(e=h?`${m}-${g}(${v}) ${y}-${b} [${I}${T}-${S}]`:`${m}-${g} ${v}-${y}(${b}) [${I}${T}-${S}]`):(c[0],c[1])}}}return{score:e,applied:i,matchUpStatus:n}}function $Y(t){const e=[0,0],i=[],n=t.split(" "),r=/(\d+)-(\d+)/;n.forEach(l=>{if(r.test(l)){const c=l.match(r).slice(1).map(d=>parseInt(d)),u=c[0]>c[1]?1:c[1]>c[0]&&2;u&&(e[u-1]+=1,i.push(u))}});const o=e[0]>e[1]?1:e[1]>e[0]&&2,a=e[0]>0&&e[0]===e[1],s=e.reduce((l,c)=>l+c,0);return{setsWon:e,setsTied:a,setWinners:i,totalSets:s,winningSide:o}}const jOe={handleTiebreakSlashSeparation:function({score:t}){const e=new RegExp(/\(\d+\/\d+\)/g),i=t.match(e);for(const n of i||[]){const r=n.replace("/","-");t=t.replace(n,r)}return{score:t}},handleSetSlashSeparation:function({score:t}){return new RegExp(/-\d+\/\d+-/).test(t)&&(t=t.split("/").join(" ")),{score:t}},punctuationAdjustments:function({score:t,applied:e}){t=function(I){const T="[];",S="()",w=T+S,U=[T[0],S[0]],D=Object.assign({},...w.split("").map(M=>({[M]:0})));let E="";const C=I.split("").map(M=>{const N=w.includes(M)&&M,R=U.includes(N);if(R&&N)return D[N]+=1,E=N,M;if(!R&&N&&E&&N!==E){D[E]-=1;const A=T.includes(E)&&T||S.includes(E)&&S||"",_=A.split("").find(k=>k!==E);if(!A.includes(N))return D[N]||(E=""),_;D[E]||(E="")}return M}).join("");return I!==C?C:I}(t);const i=/\)(\d+)/g;if(i.test(t))for(const I of t.match(i)){const T=I.replace(")",") ");t=t.replace(I,T)}const n=/\(([\d- ]+)\)/,r=(t=(t=t.replace(/\)\//g,") / ")).replace(/\/\)/g,")")).match(/\(([\d- ]+)\)/g);for(const I of r||[]){const[T]=I.match(n).slice(1),S=T.replace(/ /g,"");t=t.replace(I,`(${S})`)}let o=/\(\(\d-\d\)\)/g;if(o.test(t)){const I=t.match(o);I.length&&I.forEach(T=>{const S=T.match(/\((\(\d-\d\))\)/).slice(1)[0];t=t.replace(T,S)})}if(o=/\(\((\d)\)\)/g,o.test(t)){const I=t.match(o);I.length&&I.forEach(T=>{const S=T.match(/\((\(\d\))\)/).slice(1)[0];t=t.replace(T,S)})}/(^|\s)6-,/.test(t)&&(t=t.replace(/(^|\s)6-,/g,"6-0,"));const a=new RegExp(/[-,]{2,}/g);t=t.replace(a,"-"),["- "," -"].forEach(I=>{const T=new RegExp(`(\\d+)${I}(\\d+)`,"g"),S=t.match(T);S&&S.forEach(w=>t=t.replace(w,w.split(I).join("-")))}),/^[(-/,]+$/.test(t)&&(t=""),/\)[-/,]+$/.test(t)&&(t=t.slice(0,t.length-1)),/\d \/\d/.test(t)&&(t=t.replace(/ \//g,"/")),t.includes(" /")&&(t=t.replace(/ \//g," "));const s=/\(\d+, \)/g;s.test(t)&&t.match(s).forEach(I=>{const[T]=I.match(/\((\d+), \)/).slice(1);T.length===2?t=t.replace(I,`(${T})`):T.length===1&&T==="6"&&(t=t.replace(I,"(6-0)"))});const l=/\((\d+)\/\)/g;l.test(t)&&t.match(l).forEach(I=>{const[T]=I.match(/\((\d+)\/\)/).slice(1);t=T.length===2?t.replace(I,`(${T})`):T.length===1&&T==="6"?t.replace(I,"(6-0)"):t.replace(I,`(${T})`)});const c=/\d\/\d\/,/g;c.test(t)&&t.match(c).forEach(I=>{const[T]=I.match(/(\d\/\d)\/,/).slice(1);t=t.replace(I,`${T},`),e.push("slashComma")});const u=/\(\/(\d+)\)/g;u.test(t)&&t.match(u).forEach(I=>{const[T]=I.match(/\(\/(\d+)\)/).slice(1);t=T.length===2?t.replace(I,`(${T})`):T.length===1&&parseInt(T)<6?t.replace(I,`(6-${T})`):t.replace(I,`(${T})`)});let d,p,h,f,m;const g=()=>{m=cs(t.split("")),p=m["("]===(m[")"]||0)+1,d=(m["("]||0)+1===m[")"],h=m["["]===m["]"]+1,f=p&&!h};g();const v=/(\d+-\d+\(\d+)0,/;if(v.test(t)){const[I]=t.match(v).slice(1);t=t.replace(v,I+")")}if(m["("]===m[")"]&&m["("]>1){const I=t.split(")(").join(") (").split(" ");t=I.every(VOe)?I.map(T=>{const S=T.slice(1,T.length-1);return S.length>2?S:T}).join(" "):I.join(" ")}g();const y=/[A-Za-z]+/.test(t),b=/\d+/.test(t);if(!y&&!b)return{score:""};if(/^\[.+\]$/.test(t)&&"()/,- ".split("").some(I=>m[I])&&(t=t.slice(1,t.length-1)),/^\(.+\)$/.test(t)&&m["("]===1&&m[")"]===1&&"[]/,".split("").some(I=>m[I]>1)&&(t=t.slice(1,t.length-1)),t.startsWith("(")&&t.endsWith("))")&&(t=t.slice(1,t.length-1)),m["("]>(m[")"]||0)&&t[t.length-1]==="("&&(t=t.slice(0,t.length-1)+")",g()),m["("]!==1||m[")"]||t[0]!=="("||(t+=")",g()),m["("]>(m[")"]||0)&&t.slice(0,2)==="(("&&(t=t.slice(1)),d){if(/^9\d/.test(t))t="("+t.slice(1);else if(t[0]!=="(")t="("+t;else{const I=[];let T=0;for(const S of t.split("").reverse())S===")"&&(T?I.push("("):T+=1),S==="("&&(T-=1),I.push(S);I.reverse(),t=I.join("")}g()}if(m[")"]>(m["("]||0)&&t[0]===")"&&(t="("+t.slice(1),g()),f&&(t.endsWith(9)||/\d+0$/.test(t))&&(t=t.slice(0,t.length-1)+")",g()),!f||t.endsWith(")")&&!t.startsWith("((")||(t+=")",g()),f){let I="",T=0;for(const S of t.split(""))S==="("&&(T?I+=")":T+=1),S===")"&&(T-=1),I+=S;t=I}if(g(),h&&!p&&(t+="]"),t.includes("([")&&t.includes("])")&&(t=t.split("([").join("[").split("])").join("]"),g()),/\(\d+0$/.test(t)&&(t=t.slice(0,t.length-1)+")"),g(),m[")"]===1&&!m["("]&&t.endsWith(")")&&(t=t.slice(0,t.length-1)),t.startsWith("(")&&t.endsWith(")")&&m["("]===1&&m[")"]===1&&(t=t.slice(1,t.length-1),g()),/^\([\d ]+.*[\d ]+\)$/.test(t)&&m["("]===m[")"]){const I=t.slice(1,t.length-1);(T=>{const S=T.indexOf("("),w=T.indexOf(")");return S>=0&&w>=0&&S<w})(I)&&(t=I,g())}return{score:t,applied:e}},handleGameSeparation:function({score:t}){const e=new RegExp(/^\d+\/\d+/),i=t.split(" ");i.some(r=>e.test(r))&&(t=i.map(r=>e.test(r)?r.replace("/","-"):r).join(" "));const n=/^(\d+), *(\d+)$/;if(n.test(t)){const[r,o]=t.match(n).slice(1);t=[r,o].join("-")}return{score:t}},joinFloatingTiebreak:function({score:t}){if(typeof t!="string")return{score:t};const e=p=>p==null?void 0:p.split("-").join("").split("/").join(""),i=p=>p.split("[").join("(").split("]").join(")");let n=(t=t.split(", ").join(" ")).split(" ");t=n.map(p=>{const h=/^-(\d+)$/;if(h.test(p)){const[f]=p.match(h).slice(1);if(f.length===2)return f.split("").join("-")}return p}).join(" "),n=t.split(" ");const r=n.filter(E1);let o=0,a="";for(const p of r){const h=au(p,n).filter(v=>!o||v>o)[0],f=n.slice(o,h-1),m=n[h-1],g=e(m);if(/^\d+$/.test(g)&&g.length===2){const v=g.split(""),y=Math.abs(v.reduce((b,I)=>+b-+I));if(y===1)a+=[f.join(" "),[m,p].join("")].join(" "),o=h+1;else if(y===0){const b=Math.max(...v);if([4,5,6,7,8,9].includes(b)){const I=[b,[6,4].includes(b)?b+1:b-1].sort().reverse().join("-");a+=[f.join(" "),[I,p].join("")].join(" "),o=h+1}}}}if(r.length&&a.length)return a=[a,n.slice(o).join(" ")].join(" "),{score:a.trim()};if(n.length===2&&["(","["].some(p=>n[1].includes(p))){const p=e(n[0]).split("");if(Math.abs(p.reduce((h,f)=>+h-+f,0))===1)return n[1]=i(n[1]),{score:n.join("")}}const s=n.map(p=>function(h){return/^\(\d+-\d+\)$/.test(h)||/^\[\d+-\d+\]$/.test(h)}(p)?"bracket":xb(p)&&"set");if(s.includes("set")&&s.includes("bracket")){let p,h="";return n.forEach((f,m)=>{s[m]==="bracket"&&p==="set"?(f=i(f),h+=f):h+=` ${f}`,p=s[m]}),{score:h.trim()}}let l;n=t.split(" ");let c=n.map(p=>{const h=new RegExp(/^(\d+)-(\d+)$/);if(h.test(p)){const[f,m]=p.match(h).slice(1),g=Math.abs([f,m].reduce((y,b)=>+y-+b)),v=Math.max(f,m);if(g===1)return l="tiebreakSet",l;if(g>=2&&v>=7&&l==="tiebreakSet")return l="tiebreak",l}});const u=au("tiebreak",c);if(u.length){let p="";n.forEach((h,f)=>{u.includes(f)?p+=`(${h}) `:u.includes(f+1)?p+=`${h}`:p+=`${h} `}),t=p.trim()}const d=/(\d+-\d+)\((\d+)-(\d+)\)$/;if(d.test(t)){const[p,h,f]=t.match(d).slice(1),m=Math.max(h,f)>=10;!xb(p)&&m&&(t=t.replace(d,`${p} [${h}-${f}]`))}return c=[],t=t.split(" ").map(p=>{const h=/^\((.*)\)$/,f=h.test(p),m=(new RegExp(aB).test(p)?"super":new RegExp(cT).test(p)&&"tiebreak")||new RegExp(HR).test(p)&&"standard"||"unknown";return c.push(m),m==="standard"&&f?p.match(h)[1]:p}).join(" "),{score:t}},handleBracketSpacing:function({score:t,applied:e}){return t.includes("( ")&&(e.push("removeParenSpacingAfterOpen"),t=t.split("( ").map(i=>i.trim()).join("(")),t.includes(" )")&&(e.push("removeParenSpacingBeforeClose"),t=t.split(" )").map(i=>i.trim()).join(")")),[LOe,FOe].forEach(i=>{const n=t.match(i);n!=null&&n.length&&(n.forEach(r=>{t=t.replace(r,r.slice(0,r.length-1)+" ")}),e.push("setsEndComma"))}),{score:t=t.split(" ").filter(Boolean).map(M1).join(" "),applied:e}},handleSpaceSeparator:function({score:t}){if(t.includes(",")){const e=t.split(",").map(n=>n.trim()),i=n=>/\d \d/.test(n);e.every(i)&&(t=e.map(n=>{const r=/\d+ \d+/g;for(const o of n.match(r)){const[a,s]=o.match(/(\d+) (\d+)/).slice(1);n=n.replace(o,`${a}-${s}`)}return n}).join(" "))}if(t.includes(" ")){const e=t.replace(/[ ,]/g,"");e.split("").every(i=>ir(i))&&e.length===4&&(t=e)}return{score:t}},separateScoreBlocks:function({score:t,applied:e}){return typeof t!="string"?{score:t}:{score:t=t.toLowerCase().split(" ").map(i=>{if(/^\d+$/.test(i)&&i.length>2){const n=i.indexOf("1");if(i.length%2){if(i.length===3&&n===0){const r=GR(i.split(""),n);return e.push("getSuper"),r}}else{const{score:r,applied:o}=BY({score:i,applied:[]});r!==i&&(i=r,e.push(...o))}}return i}).join(" "),applied:e}},matchKnownPatterns:function({score:t,applied:e}){for(const w of[".",","," ","/"]){const U=new RegExp(`^(\\d+)\\${w}(\\d+)$`);if(U.test(t)){const D=t.match(U).slice(1).map(C=>parseInt(C)),E=Math.abs(D[0]-D[1]);E<=10&&E>=2&&(t=t.split(w).join("-"),e.push("variedJoinerPattern"))}}t.includes(";")&&(t=t.split(";").join(" "),e.push("semicolon set separation"));const i=/(^|\s)(\d)\/(\d)(\d)\/(\d)(\(|$)/;if(i.test(t)){const[w,U,D,E,C,M]=t.match(i).slice(1);t=t.replace(i,`${w}${U}-${D} ${E}-${C}${M}`),e.push("smashSlashPattern")}/.*\s6[/-]+$/.test(t)&&(t+="0",e.push("incompleteFinalSetPattern"));const n=/\(6,\)/g;n.test(t)&&(t=t.replace(n,"(6, 0)"),e.push("missingZeroPattern1"));const r=/^\d{3,}\(/,o=/\(\d+\)\d+/;[r,o].forEach(()=>{t=t.split(" ").map(w=>(r.test(w)&&(w=w.replace("("," (")),o.test(w)&&(w=w.replace(")",") ")),w)).join(" "),e.push("spaceConsiderationPatterns")});const a=M1(t);a!==t&&(t=a,e.push("deDashMash"));const s=/^(\d)[-/,]+(\d{2})[-/,]+(\d)$/;if(s.test(t)){const[w,U,D]=t.match(s).slice(1),[E,C]=U.split("");t=`${w}-${E} ${C}-${D}`,e.push("smashSetPattern")}const l=/^(\d+)[ -](\d+)$/,c=/^([\d -]+)\/([\d -]+)$/;if(c.test(t)){const[w,U]=t.match(c).slice(1),D=w.trim(),E=U.trim();if(l.test(D)&&l.test(E)){const C=D.match(l).slice(1,3).join("-"),M=E.match(l).slice(1,3).join("-");t=`${C} ${M}`,e.push("slashSeparationPattern")}}const u=/^([\d -]+),([\d -]+)$/;if(u.test(t)){const[w,U]=t.match(u).slice(1),D=w.trim(),E=U.trim();if(l.test(D)&&l.test(E)){const C=D.match(l).slice(1,3).join("-"),M=E.match(l).slice(1,3).join("-");t=`${C} ${M}`,e.push("commaSeparationPattern")}}const d=/^\d \d,/;if(d.test(t)){const w=t.match(d)[0],U=w.slice(0,w.length-1).split(" ").join("-");t=t.replace(w,U),e.push("singleSetCommaSeparationPattern")}let p=0;const h=/(\d+)-(\d{2})-(\d+)/;for(;h.test(t)&&p<3;){const[w,U,D]=t.match(h).slice(1),E=U.split(""),C=`${w}-${E[0]} ${E[1]}-${D}`;t=t.replace(h,C),e.push("noSetSeparationPattern"),p+=1}const f=t.match(/(^|\s)7-6\s(\d+)\s/g);if(f!=null&&f.length){const w=/(^|\s)7-6\s(\d+)\s/;f.forEach(U=>{const D=U.match(w).slice(2)[0];t=t.replace(U,`7-6(${D}) `),e.push("floatingTiebreakPattern1")})}let m=t.match(/\d \d /);m==null||m.forEach(w=>{const U=w.slice(0,w.length-1).split(" ").join("-");t=t.replace(w,U),e.push("spaceSeparatedSetPattern1")}),m=t.match(/ \d \d$/),m==null||m.forEach(w=>{const U=" "+w.slice(1).split(" ").join("-");t=t.replace(w,U),e.push("spaceSeparatedSetPattern2")});const g=/^\d, *\d\/\d, *\d/;if(g.test(t)){const w=t.match(g)[0],U=w.split("/").map(D=>`(${D})`).join(" ")+" ";t=t.replace(w,U),e.push("slashCommaSetPattern")}const v=/\(6-\)/g;v.test(t)&&(t=t.replace(v,"(6-0)"),e.push("missingZeroPattern2"));const y=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)","g");if(y.test(t)){const w=t.match(y),U=new RegExp("(?<!-)(\\d+)\\/(\\d+)(?!-)");let D=t;w.forEach(E=>{const[C,M]=E.match(U).slice(1),N=`${C}-${M}`;D=D.replace(E,N)}),t=D,e.push("slashSetPattern")}const b=/(.*)\s(1\d)\s(\d+)$/;if(b.test(t)){const[w,U,D]=t.match(b).slice(1);w.replace(/\D/g,"").length>=4&&(t=w+` ${U}${D}`,e.push("spaceSeparatedSuperPattern"))}const I=/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/g;for(const w of t.match(I)||[]){const[U,D,E,C]=w.match(/(^|\s)(\d+-\d+)\s(\d+)(\s|$)/).slice(1),[M,N]=D.split("-").map(R=>parseInt(R));Math.abs(M-N)===1&&(t=t.replace(w,`${U}${D}(${E})${C}`),e.push("spaceSeparatedSetPattern"))}const T=/\d-\d \(\d{1,2}\)(\s|$|,)/g;for(const w of t.match(T)||[]){const U=/(\d-\d) \((\d{1,2})\)(\s|$|,)/,[D,E,C]=w.match(U).slice(1),[M,N]=D.split("-").map(R=>parseInt(R));Math.abs(M-N)===1&&(t=t.replace(w,`${D}(${E})${C}`),e.push("floatingTiebreakPattern2"))}const S=/(^|\s)(\d \d)\(/g;for(const w of t.match(S)||[]){const U=/(^|\s)(\d \d)\(/,[D,E]=w.match(U).slice(1);t=t.replace(w,`${D}${E.split(" ").join("-")}(`),e.push("spacedTiebreakPattern")}return{score:t,applied:e}},removeDanglingBits:function({score:t,attributes:e}){(t.endsWith(" am")||t.endsWith(" pm"))&&(t=""),t=t.replace(/[A-Za-z]+/g,"").trim(),[".",","].some(r=>t.endsWith(r))&&(t=t.slice(0,t.length-1));const i="()/-".split("").some(r=>t.includes(r));/ \d$/.test(t)&&i&&(e={removed:t.slice(t.length-2).trim()},t=t.slice(0,t.length-2));const n=/(.*)[A-Za-z]+$/;return n.test(t)&&(t=t.match(n).slice(1)[0].trim()),{score:t,attributes:e}},removeErroneous:function({score:t,applied:e}){return typeof t!="string"?{score:t}:[3,4].includes(t.length)&&sB(t)?{score:sB(t)}:{score:t=t.toLowerCase().split(" ").map(i=>{if(!/^\d+$/.test(i)||i.length!==1)return i;e.push("removeErroneous1")}).filter(Boolean).join(" "),applied:e}},handleWalkover:function({score:t,applied:e}){return["walkover","wo","w/o","w-o"].includes(t==null?void 0:t.toString().toLowerCase())?(e.push("handleWalkover"),{matchUpStatus:"walkover",score:"",applied:e}):{score:t}},properTiebreak:function({score:t,matchUpStatus:e}){var i;let n=t==null?void 0:t.split(" ");t=n.map(l=>{if(l.endsWith("]")){const c=l.split("[");if(xb(c[0]))return c[0]+`(${c[1].slice(0,c[1].length-1)})`}return l}).join(" ");const r=new RegExp(/(\([\d ]+\))/g);if(r.test(t))for(const l of t.match(r)){let c=(i=l.replace(" ","-").match(/\((.*)\)/))==null?void 0:i[1];if(ir(c)&&(c==null?void 0:c[0])>2){if([2,4].includes(c.length))c=c.split("").join("-");else if(c.length===3){const u=c.indexOf("1");c=GR(c.split(""),u)}}t=t.replace(l,`(${c})`)}n=t==null?void 0:t.split(" ");let o=new RegExp(/^(\d[-/]+\d)\((\d+)[-/]+(\d+)\)$/);const a=n.length-1;t=n.map((l,c)=>{const u=[void 0,"","COMPLETED"].includes(e)||c!==a;if(o.test(l)&&u){const[d,p,h]=Array.from(l.match(o)).slice(1);return`${d}(${Math.min(p,h)})`}return l}).join(" "),n=t==null?void 0:t.split(" "),o=new RegExp(/^(\d{2})\((\d+)\)$/),t=n.map(l=>{if(o.test(l)){const[c,u]=Array.from(l.match(o)).slice(1),d=c.split("");return`${d[0]}-${d[1]}(${u})`}return l}).join(" "),n=t==null?void 0:t.split(" "),o=new RegExp(/^\((\d[-/]+\d)\)(\d+)$/),t=n.map(l=>{if(o.test(l)){const[c,u]=Array.from(l.match(o)).slice(1);return xb(c)?`${c}(${u})`:c}return l}).join(" "),n=t==null?void 0:t.split(" "),o=new RegExp(/^1-0\((\d+)\)$/),t=n.map(l=>{if(o.test(l)){const[c]=l.match(o).slice(1);return`[${c<9?10:parseInt(c)+2}-${c}]`}return l}).join(" ");const s=/\((\d)+0 /;if(s.test(t)){const l=t.match(s)[1];t=t.replace(s,`(${l}) `)}return{score:t}},handleNumeric:BY,handleRetired:function({score:t,profile:e,applied:i}){var n;t=t==null?void 0:t.toString().toLowerCase();const r=/^(.*\d+.*)(ret|con)+[A-Za-z ]*$/;if(r.test(t)){const[s]=t.match(r).slice(1);return i.push("handleRetired"),{score:s.trim(),matchUpStatus:"retired",applied:i}}const o=(n=e==null?void 0:e.matchUpStatuses)==null?void 0:n.retired,a=["rtd",...Array.isArray(o)?o:[o].filter(Boolean)].find(s=>t==null?void 0:t.endsWith(s));return a?(i.push("handleRetired"),{matchUpStatus:"retired",score:t==null?void 0:t.replace(a,"").trim(),applied:i}):{score:t}},containedSets:function({score:t,attributes:e,identifier:i}){var n;if(typeof t!="string")return{score:t,identifier:i};const r=new RegExp(/\([\d,/ ]+\)/g),o=t.match(r);for(const d of o||[]){const p=d.match(/^\((.*)\)$/),h=(n=p==null?void 0:p.slice(1))==null?void 0:n[0],f=t.split(d)[0].split(")").reverse()[0].replace(/\D/g,"");if((h==null?void 0:h.length)===2&&(f==null?void 0:f.length)>=2){const g=f.slice(f.length-2).split("").map(v=>parseInt(v));if(Math.abs(g[0]-g[1])===1)continue}const m=M1(FY(h));t=t.replace(d,`(${m})`).trim()}const a=new RegExp(/\[[\d,/ ]+\]/g),s=t.match(a);s==null||s.forEach(d=>{const p=FY(d.match(/^\[(.*)\]$/)[1]);t=t.replace(d,`(${p}) `).trim()});const l=[")(","), (",") (",")[",") [","](","] ("];if(t.startsWith("(")&&[")","]"].some(d=>t.endsWith(d))&&l.some(d=>t.includes(d))){let d="";const p=t.split(/[)\]]/).filter(Boolean).map(v=>(v.startsWith(",")&&(v=v.slice(1)),v.trim())),h=p.every(v=>v.includes(",")||E1(v)),f=p.every(v=>v.includes("/")||E1(v)),m=p.every(v=>v.includes("-")||E1(v)),g=(h?",":m&&"-")||f&&"/";if(g){let v;p.forEach(y=>{if(y.startsWith("("))if(v==="set"&&(d+=" "),y.includes(g))d+=y.slice(1).split(g).map(b=>b.trim()).join("-"),v="set";else{const b=y.slice(1);d+=`(${b}) `,v="tiebreak"}else if(y.startsWith("[")){const b=y.slice(1).split(g).map(T=>parseInt(T.trim())),I=Math.min(...b);d+=v==="set"?`(${I}) `:`[${b.join("-")}] `,v="tiebreak"}}),t=d.trim()}}const c=cs(t.split(""));c["("]===1&&c[")"]===1&&t.startsWith("(")&&t.endsWith(")")&&(t=t.slice(1,t.length-1),c["-"]===1&&xb(t)&&ir(e==null?void 0:e.removed)&&(t+=`(${e.removed})`,e.removed=void 0));const u=/\(\)/g;return u.test(t)&&(t=t.replace(u,"").trim()),{score:t}},sensibleSets:function({score:t,matchUpStatus:e,attributes:i}){const n=[];let r;const o=t.split(" "),a=o.length;t=o.map((u,d)=>{if(new RegExp(cT).test(u)){const h=u.slice(3),f=u.slice(0,3),m=f.split("-");if(!xb(f)&&!e){const g=Math.max(...m),v=[g,g-1];return f.indexOf(g)&&v.reverse(),v.join("-")+h}}else if(u.length===2&&ir(u))return u.split("").join("-");u=M1(u);const p=(new RegExp(`^${aB}$`).test(u)?"super":new RegExp(`^${cT}$`).test(u)&&"tiebreak")||new RegExp(`^${HR}$`).test(u)&&"standard"||"unknown";if(n.push(p),a>1&&p==="standard"&&d<2){const[h,f]=u.split("-"),m=Math.abs(parseInt(h)-parseInt(f)),g=Math.max(h,f),v=Math.min(h,f),y=[parseInt(h),parseInt(f)].indexOf(v);if(g>9&&m>2){const b=g.toString().split(""),I=b.find(T=>parseInt(T)>v||d&&parseInt(T)<=r)??b[0];I&&(u=y?[I,v].join("-"):[v,I].join("-"))}g>(r||0)&&(r=g)}if(p==="standard"){const[h,f]=u.split("-");if(!Math.abs(parseInt(h)-parseInt(f))&&e!=="RETIRED")return""}return u}).filter(Boolean).join(" ");const{setsWon:s,setWinners:l,totalSets:c}=$Y(t);if(c===1&&(i==null?void 0:i.removed)==="6"&&(t+=" 6-0"),t.split(" ").length>2&&Math.max(...s)>=2&&l[0]===l[1]&&(t=t.split(" ").slice(0,2).join(" ")),Math.max(...s)>2){const u=[0,0];t=t.split(" ").map((d,p)=>(u[l[p]]+=1,Math.max(...u)>2?void 0:d)).filter(Boolean).join(" ")}return{score:t,profile:n}},stringScore:function({score:t}){return{score:t=(t==null?void 0:t.toString().toLowerCase())||""}},superSquare:function({score:t}){const{setsTied:e,winningSide:i}=$Y(t),n=/\s\((\d+)\)$/;if(!i&&e&&n.test(t)){const s=t.match(n).slice(1)[0],l=s<=8?10:s+2;t=t.replace(n,` [${l}-${s}]`)}const r=t.split(" "),o=r[r.length-1];if(!o.includes("-")||o.indexOf("(")>0)return{score:t};let a=o.split("(").join("").split(")").join("").split("-");if(!a.every(s=>ir(s)))return{score:t};if(a[0]==="76"){const s=a[1].length===2?Math.min(...a[1].split("").map(l=>parseInt(l))):a[1];t=[...r.slice(0,r.length-1),`7-6(${s})`].join(" ")}else{a=a.map(c=>parseInt(c));const s=Math.max(...a);let l=Math.abs(a[0]-a[1]);if(s>=10){if(l>2&&a.every(c=>+c>=10)){const c=a.map(u=>u===s?u-10:10).sort();l=Math.abs(c[0]-c[1]),l>2&&(a=c)}t=[...r.slice(0,r.length-1),`[${a.join("-")}]`].join(" ")}else r.length===3&&s>=7&&l>2&&(t=[...r.slice(0,r.length-1),`[${a.join("-")}]`].join(" "))}return{score:t}},setBuilder:Epe,excisions:function({score:t}){const e=new RegExp(/^\[\d+\](.*)$/);e.test(t)&&(t=t.match(e).slice(1)[0].trim());const i=/\(,/g;return i.test(t)&&(t=t.replace(i,"(")),{score:t}},replaceOh:function({score:t,applied:e}){return typeof t!="string"?{score:t}:(t.toLowerCase().includes("o")&&(t=t.toLowerCase().split(" ").map(i=>i.split("o").join("0")).join(" "),e.push("replaceOh")),{score:t,applied:e})}};let cL={};const HOe=["handleNumeric","handleWalkover","handleRetired","replaceOh","stringScore","punctuationAdjustments","excisions","handleSpaceSeparator","matchKnownPatterns","removeDanglingBits","handleBracketSpacing","matchKnownPatterns","containedSets","separateScoreBlocks","handleGameSeparation","removeErroneous","joinFloatingTiebreak","handleSetSlashSeparation","handleTiebreakSlashSeparation","properTiebreak","sensibleSets","superSquare"],GOe=["handleNumeric","separateScoreBlocks","sensibleSets","superSquare"];function Mpe({existingMatchUpStatus:t,matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}){if(typeof r!="object")return{error:Re};const{sets:o,scoreStringSide1:a,scoreStringSide2:s}=r,l="scoreString must be a string!";if(a!==void 0&&typeof a!="string")return{error:Re,info:l};if(s!==void 0&&typeof s!="string")return{error:Re,info:l};if(o!==void 0&&!Array.isArray(o))return{error:Re,info:_d("sets")};if(o!=null&&o.length){const c=o.map(d=>d==null?void 0:d.setNumber).filter(Boolean);if(c.length!==ti(c).length)return{error:Re,info:"setNumbers not unique"};for(const d of o){const{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,side1PointScore:g,side2PointScore:v,winningSide:y,setNumber:b}=d;if(![[p,h],[f,m],[g,v]].filter(I=>I.some(T=>T!==void 0)).every(I=>I.every(T=>$t(T))))return{error:Re,info:"non-numeric values"};if(![b,y].filter(I=>I!==void 0).every(I=>$t(I)))return{error:Re,info:"non-numeric values"};if(y&&![1,2].includes(y))return{error:Re,info:"winningSide must be 1 or 2"}}const{valid:u}=function({existingMatchUpStatus:d,matchUpFormat:p,matchUpStatus:h,winningSide:f,score:m}){const g=(m==null?void 0:m.sets)??[],v=((g==null?void 0:g.filter(A=>A==null?void 0:A.winningSide))||[]).reduce((A,_)=>{const{winningSide:k}=_;return k&&A[k-1]++,A},[0,0]),y=f?f-1:void 0,b=y!==void 0?1-y:void 0,I=y!==void 0&&v[y],T=b!==void 0&&v[b],S=p?Ga(p):void 0,w=Math.max(...v),U=cs(v)[w],D=S==null?void 0:S.bestOf,E=D&&Math.ceil(D/2)||1,C=h??d,M=C&&[Mi,da,Li].includes(C),N=!S||!g.length||g.every((A,_)=>{const k=_+1,O=k===D,F=k===g.length,{side1Score:B,side2Score:$,side1TiebreakScore:V,side2TiebreakScore:H,winningSide:z}=A,G=Math.max(B??0,$??0),W=V??H,{finalSetFormat:K,setFormat:Z}=S,Y=O&&K||Z;if(W){const{tiebreakTo:X,NoAD:Q}=(Y==null?void 0:Y.tiebreakFormat)||{},te=Math.max(V??0,H??0);if(Q&&te>X||te<X&&z&&(F&&!M||!F))return!1}return!Y.setTo||!(!Y.noTiebreak&&G>Y.setTo+1)}),R=(!p||w===E)&&U===1&&v.indexOf(w)+1||void 0;return{valid:N&&(f&&I>T&&f===R||!f&&!R||M)}}({existingMatchUpStatus:t,matchUpStatus:i,matchUpFormat:e,winningSide:n,score:r});if(!u)return{error:b_e,info:"score is invalid for matchUpFormat or winningSide does not match calculated winningSide"}}return{valid:!0}}const Rpe=t=>{const{isSide1:e,lowValue:i,setTo:n,tiebreakAt:r,NoAD:o}=t;if(i===void 0)return!1;let a,s=Ct(i);return(s==null?void 0:s.toString().length)>2&&(s=parseInt(s.toString().slice(0,2))),r&&r<n&&s>r&&(s=r),o&&!r?(s>n&&(a=n),a=s<n?n:n-1):a=s+1<n&&n||r&&r<n&&s===r&&n||!r&&s+2||n+1,[e?s:a,e?a:s]},oq=t=>{const{isSide1:e,lowValue:i,tiebreakTo:n,tiebreakNoAd:r}=t;if(i===void 0)return!1;let o=typeof i=="string"?parseInt(i):i;(o==null?void 0:o.toString().length)>2&&(o=parseInt(o.toString().slice(0,2))),r&&o>n-1&&(o=n-1);const a=function(s){const{lowValue:l,NoAD:c,tiebreakTo:u}=s,d=c?1:2;return l+1>=u?l+d:u}({lowValue:o,NoAD:r,tiebreakTo:n});return[e?o:a,e?a:o]},Pv=" ",lB="DEF",Npe="WO",Ape="ABN",_pe="SUS",kpe="RET",xpe="INT",Ope=[kpe,lB,Npe,"WO/WO",Ape,_pe,xpe],cB="DEFAULTED",Lpe="WALKOVER",Fpe="ABANDONED",Bpe="SUSPENDED",$pe="RETIRED",Vpe="INTERRUPTED",zOe=[$pe,cB,Lpe],iv="()",ym="[]",WOe=["up","left","shift+tab"],qOe=["enter","down","tab","right"],HE="backspace",jpe="r",Hpe="s",Gpe="a",zpe="d",Wpe="w",qpe="i",uB=[jpe,zpe,Wpe,Gpe,Hpe,qpe],zR="space",uL=["[","("],WR=[...WOe,...qOe,zR,"]"],Kg="-",Ju="-",Ype=["/"],Kpe=["0","1","2","3","4","5","6","7","8","9"].concat(uB),YOe=Kpe.map(t=>`shift+${t}`),KOe=[Kg,HE].concat(WR,Ype),ZOe=[Kpe,YOe,KOe].join(",");function Ob({scoreString:t,lowSide:e,outcome:i}){return{scoreString:t}=Zpe({scoreString:t}),e===2?t+((t&&t[t.length-1])!==Pv?Pv:"")+i:i+Pv+t}function Zpe({scoreString:t}){if(!t)return{scoreString:""};let e=!1;for(const i of Ope){const n=t==null?void 0:t.indexOf(i);n===0?t=t.slice(i.length+1).trim()+Pv:n>0&&(t=t.slice(0,n)),n>=0&&(e=!0)}return t!=null&&t.trim()||(t=""),{scoreString:t,removed:e}}function dL({analysis:t,scoreString:e,sets:i,lowSide:n}){var r,o,a;let s,l;if(!e)return{scoreString:e,sets:i};const{scoreString:c,removed:u}=Zpe({scoreString:e});if(e=c,u)return{scoreString:e,sets:i,outcomeRemoved:!0};let d=i[i.length-1]||{};const p=Object.values(d).filter(y=>y!==void 0).length;d.setNumber&&p===1&&(d=(i=i.slice(0,i.length-1))[i.length-1]||{});const{tiebreakSet:h}=t.setFormat,{tiebreakTo:f,NoAD:m}=h||{},{isTiebreakEntry:g}=UI({brackets:ym,scoreString:e}),v=function(y){return y.split("").reduce((b,I,T)=>(I.match(/\d+/g)&&b.push(T),b),[]).pop()}(e);if(v>=0){s=e.slice(0,v);const{isTiebreakEntry:y}=UI({brackets:iv,scoreString:s}),{lastOpenBracketIndex:b,isTiebreakEntry:I}=UI({brackets:ym,scoreString:s}),T=s&&s[s.length-1].trim(),S=s&&!isNaN(T);let w=t.isIncompleteSetScore;if(g&&I){const U=s.slice(b+1).split(Ju),D=(U==null?void 0:U.length)>0&&U[0]!==void 0&&!isNaN(parseInt(U[0]))&&parseInt(U[0])||void 0,E=(U==null?void 0:U.length)>1&&U[1]!==void 0&&parseInt(U[1])||void 0,C=[D,E];if(E){const M=n===1?1:0;C[M]=((C==null?void 0:C[1-M])||0)+(m?1:2),(C[M]||0)<f&&(C[M]=f),s=e.slice(0,b+1),s+=C.join(Ju)}else D!==void 0?(s=e.slice(0,b+1),s+=D):(s=e.slice(0,b),w=!0);d.side1TiebreakScore=C[0]||0,d.side2TiebreakScore=C[1]||0}if(s.length||(s=void 0),w){const U=(r=d.side1Score)==null?void 0:r.toString();if(U){const D=U==null?void 0:U.slice(0,U.length-1);d.side1Score=!isNaN(D)&&parseInt(D)||void 0,d.side1Score===void 0&&(d.side2Score=void 0)}t.isTimedSet?(l=d.side1Score?i:(i==null?void 0:i.slice(0,i.length-1))||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]}else if(S){const U=(o=d.side2Score)==null?void 0:o.toString(),D=(a=d.side1Score)==null?void 0:a.toString();if(!t.isTiebreakEntry&&!t.isMatchTiebreak)if(d.side2Score){const E=U==null?void 0:U.slice(0,U.length-1);d.side2Score=!isNaN(E)&&parseInt(E)||void 0}else{const E=D==null?void 0:D.slice(0,D.length-1);d.side1Score=!isNaN(E)&&parseInt(E)||void 0}t.isTimedSet?d.side1Score?(l=i||[],l[i.length-1]=d):l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i||[],l[i.length-1]=d),l[l.length-1]&&Object.assign(l[l.length-1],{winningSide:void 0})}else y?(l=i||[],Object.assign(l[l.length-1]||{},{winningSide:void 0,side1TiebreakScore:void 0,side2TiebreakScore:void 0})):(g&&!I?l=(i==null?void 0:i.slice(0,i.length-1))||[]:(l=i,l[i.length-1]=d),g||(l[l.length-1].side2Score=0,l[l.length-1].winningSide=void 0));return{scoreString:s,sets:l}}return{scoreString:e,sets:i}}function UI({brackets:t=iv,scoreString:e}){if(!e)return{};const[i,n]=t.split(""),r=e.split(""),o=Math.max(...au(i,r));return{isTiebreakEntry:o>Math.max(...au(n,r)),lastOpenBracketIndex:o}}function VY(t){const{lowValue:e=0,NoAD:i=!1,tiebreakTo:n}=t||{};return e+1>=n?e+(i?1:2):parseInt(n)}function jY({matchUpFormat:t,matchUpStatus:e,winningSide:i,sets:n}){const r=Ga(t),{bestOf:o}=r,a=Math.ceil(o/2),s=n==null?void 0:n.reduce((c,u)=>{const{winningSide:d}=u;return d&&c[d-1]++,c},[0,0]);let l=(s==null?void 0:s.indexOf(a))+1||void 0;return zOe.includes(e)&&i&&(l=i),{matchUpWinningSide:l}}function pL({analysis:t,set:e}){const i=ix({set:e}),{isDecidingSet:n,isTiebreakSet:r,matchUpScoringFormat:o}=t;return Z3({matchUpScoringFormat:o,isDecidingSet:n,isTiebreakSet:r,set:e})&&i}function HY({lowSide:t,value:e,sets:i,scoreString:n,winningSide:r,matchUpStatus:o}){let a;return e===jpe?n?(a=!0,n=Ob({scoreString:n,lowSide:t,outcome:kpe}),r=t===2?1:2,o=$pe):(a=!0,n=Ob({scoreString:n,lowSide:t,outcome:lB}),r=t===2?1:2,o=cB):e===zpe?(a=!0,n=Ob({scoreString:n,lowSide:t,outcome:lB}),r=t===2?1:2,o=cB):e===Wpe?(a=!0,i=[],n=Npe,r=t===2?1:2,o=Lpe):e===Hpe&&n?(a=!0,n=Ob({scoreString:n,lowSide:t,outcome:_pe}),o=Bpe,r=void 0):e===Gpe?(a=!0,n=Ob({scoreString:n,lowSide:t,outcome:Ape}),o=Fpe,r=void 0):e===qpe&&n&&(a=!0,n=Ob({scoreString:n,lowSide:t,outcome:xpe}),o=Vpe,r=void 0),{updated:a,sets:i,scoreString:n,matchUpStatus:o,winningSide:r}}function XOe({matchUpFormat:t,scoreString:e,winningSide:i,value:n,sets:r}){var o,a,s;const l=(((o=r==null?void 0:r.filter(V=>V==null?void 0:V.winningSide))==null?void 0:o.length)||0)+(i?0:1),c=Ga(t),u=l===(c==null?void 0:c.bestOf),d=u&&(c==null?void 0:c.finalSetFormat)||(c==null?void 0:c.setFormat)||{},p=d==null?void 0:d.timed,h=u&&r[(c==null?void 0:c.bestOf)-1],f=h==null?void 0:h.winningSide,{isTiebreakEntry:m}=UI({brackets:iv,scoreString:e}),{isTiebreakEntry:g}=UI({brackets:ym,scoreString:e}),v=m||g,y=!!d.tiebreakSet,b=(a=e==null?void 0:e[e.length-1])==null?void 0:a.trim(),I=e&&!isNaN(b),T=!v&&b===Kg,S=m&&uL.includes(b),w=g&&uL.includes(b),U=g&&b===Ju,D=e==null?void 0:e.split(""),[E]=ym.split(""),C=D&&Math.max(...au(E,D)),M=D&&Math.max(...au(Ju,D)),N=D&&M>C,R=(s=r[r.length-1])==null?void 0:s.winningSide,A=(r==null?void 0:r.length)&&!R,_=Ope.find(V=>(e==null?void 0:e.indexOf(V))>=0),k=!isNaN(n),O=n===zR,F=WR.includes(n),B=e==null?void 0:e.split("").find(V=>uL.includes(V)),$=F&&g&&!w&&(U||!function({scoreString:V}){if(!V)return!1;const H=V&&V[V.length-1].trim(),z=V&&!isNaN(H),[G,W]=ym.split(""),K=V.split(""),Z=Math.max(...au(G,K)),Y=Math.max(...au(W,K)),X=Math.max(...au(Ju,K));return z&&Z>Y&&X>Z}({scoreString:e}));return{isTiebreakSetValue:y&&k,matchUpScoringFormat:c,setNumber:l,setFormat:d,matchTiebreakHasJoiner:N,isGameScoreEntry:A,isSpace:O,isCloser:F,isTiebreakCloser:F&&B&&v&&I,isDecidingSet:u,isTiebreakSet:y,isTimedSet:p,isNumericEnding:I,isNumericValue:k,hasOpener:B,hasOutcome:_,finalSet:h,finalSetIsComplete:f,lastSetIsComplete:R,isInvalidSetTiebreakValue:O&&v&&S,isInvalidMatchTiebreakValue:$,isTiebreakEntry:v,isSetTiebreakEntry:m,isMatchTiebreakEntry:g,isIncompleteSetScore:T,isIncompleteSetTiebreak:S,isIncompleteMatchTiebreak:w,isPartialMatchTiebreakValue:U}}function dB({tiebreakTo:t=7,scoreString:e=""}){return e==null?void 0:e.split(" ").filter(Boolean).map((i,n)=>function({set:r,setNumber:o}){const a=(r==null?void 0:r.startsWith("["))&&r.split("[")[1].split("]")[0].split("-").map(g=>parseInt(g)),s=r.includes("(")&&r.split("(")[0]||r.includes("[")&&r.split("[")[0]||r,l=!a&&s.split("-").map(g=>parseInt(g)),c=a?(a[0]>a[1]?1:a[0]<a[1]&&2)||void 0:(l[0]>l[1]?1:l[0]<l[1]&&2)||void 0,u=r.includes("(")?r.split("(")[1].split(")")[0]:void 0,d=(u&&oq({lowValue:u,isSide1:c===2,tiebreakTo:t}))??[],[p,h]=l||[],[f,m]=a||d||[];return{side1Score:p,side2Score:h,side1TiebreakScore:f,side2TiebreakScore:m,winningSide:c,setNumber:o}}({set:i,setNumber:n+1}))}function Hf({matchUp:t}){const{extension:e}=ei({name:uk,element:t});if(!e)return{error:zo};const{history:i=[],undoHistory:n=[]}=e.value;return{history:i,undoHistory:n,...le}}function Gf({undoHistory:t,history:e,matchUp:i}){return Ii({element:i,extension:{value:{history:e,undoHistory:t},name:uk}})}var Xpe=Object.freeze({__proto__:null,addGame:function({matchUp:t,game:e}){if(typeof e!="object")return{error:Re,context:{game:e}};const{history:i=[]}=Hf({matchUp:t});return i.push(e),Gf({matchUp:t,history:i})},addPoint:function({matchUp:t,point:e}){if(!e||!t)return{error:bt};if(typeof e!="object")return{error:Re,context:{point:e}};const{history:i=[]}=Hf({matchUp:t});return i.push(e),Gf({matchUp:t,history:i})},addSet:function({matchUp:t,set:e}){if(typeof e!="object")return{error:bt};const{history:i=[]}=Hf({matchUp:t});return i.push(e),Gf({matchUp:t,history:i})},addShot:function({matchUp:t,shot:e}){if(typeof e!="object")return{error:bt};const{history:i=[]}=Hf({matchUp:t});return i.push(e),Gf({matchUp:t,history:i})},analyzeSet:VR,calculateHistoryScore:function(t){var e;if(!t)return{error:bt};const{matchUp:i,updateScore:n}=t;if(!i)return{error:Cs};const r=((e=Hf({matchUp:i}))==null?void 0:e.history)||[];if(!Array.isArray(r))return{error:Re,info:"history is not an array"};const{matchUpFormat:o}=i;if(!o)return{error:Yz};if(!Rs({matchUpFormat:o}))return{error:ice};const a=Ga(o),{bestOf:s,finalSetFormat:l,setFormat:c}=a,u=["0","15","30","40","A","G"],d={sets:[]};let p,h,f=[],m=[0,0],g=1,v=0,y=0;const b=D=>[1,2].includes(D),I=()=>(v+=1,{winningSide:void 0,side1Score:0,side2Score:0,setNumber:v,games:[]});let T={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},S={winningSide:void 0,points:[]},w=I(),U=0;for(const D of r){U+=1,h=d.sets.length+1===s;const E=h&&l?l:c,{tiebreakAt:C,setTo:M,NoAD:N,tiebbreakFormat:R}=E,A=w.side1Score===C&&w.side1Score===w.side2Score,_=!!E.tiebreakSet,k=_?E.tiebreakSet:R,{tiebreakTo:O,NoAD:F}=k||{},B=()=>{p=void 0,m=[0,0],g=3-g,w.side1TiebreakScore=0,w.side2TiebreakScore=0,w.side1PointScore="",w.side2PointScore="",y=0},$=z=>{w.winningSide=z;const{s:G,...W}=w;d.sets.push(W),T={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},S={winningSide:void 0,points:[]},w=I(),B()},V=z=>{S.winningSide=z;const{g:G,...W}=S;w.games.push(W),T={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},S={winningSide:void 0,points:[]},B(),w[`side${z}Score`]+=1},H=z=>{T.winningSide=z;const{p:G,...W}=T;S.points.push(W),T={winningSide:void 0,side1Score:"",side2Score:"",shots:[]},y=0;const K=z-1;if(A||_){m[K]+=1,p=m.reduce((Y,X)=>Y+X)%4/4>.5?g:3-g,w[`side${z}TiebreakScore`]=m[K],w[`side${3-z}TiebreakScore`]=m[1-K];const Z=F?1:2;if(m[K]>=O&&m[K]>=m[1-K]+Z)return V(z),{gameCompleted:!0}}else if(m[1-K]===4&&m[K]===3?m[1-K]-=1:m[K]+=1,w.side1PointScore=u[m[0]],w.side2PointScore=u[m[1]],m[K]===5||m[K]===4&&m[1-K]<3||N&&m[K]===4)return V(z),{gameCompleted:!0}};if(b(D.srv)&&(g=D.srv),["p","s","g","o"].includes(D.u)&&f.push(D.u),D.shotOutcome&&(T.shots.push(D),D.shotType==="SERVE"&&["OUT","NET"].includes(D.shotOutcome)&&(y+=1),y===2&&H(3-g)),b(D.p)||$t(D.pointNumber)){const z=H(D.winningSide||D.p);if(z!=null&&z.gameCompleted)continue}if(b(D.g)||$t(D.gameNumber)){const z=D.winningSide||D.g;S.winningSide=z;const G=`side${z}Score`,W=`side${3-z}Score`;if(f.length&&(f.includes("p"),f=[]),V(z),w[G]===M&&w[G]-w[W]>=(N?1:2)&&($(z),h))break}if((b(D.s)||$t(D.setNumber))&&($(D.winningSide||D.s),f.length&&(f.includes("p"),f.includes("g"),f=[]),h))break}return U!==r.length&&console.log({error:"Match completed with excess history"}),(w.side1Score||w.side2Score||w.games.length||w.side1TiebreakScore||w.side2TiebreakScore)&&d.sets.push(w),d.scoreStringSide1=Kd({...d,matchUpFormat:o}),d.scoreStringSide2=Kd({...d,matchUpFormat:o,reversed:!0}),g=p||g,n&&(i.score=d),{...le,servingSide:g,score:d}},checkScoreHasValue:lo,checkSetIsComplete:Z3,clearHistory:function({matchUp:t}){return Gf({matchUp:t})},generateScoreString:Kd,generateTieMatchUpScore:OR,getSetComplement:Rpe,getTiebreakComplement:oq,isValidMatchUpFormat:Rs,keyValueScore:function(t){let{lowSide:e=1,value:i}=t,{scoreString:n,sets:r,winningSide:o,matchUpStatus:a}=t;const{matchUpFormat:s,shiftFirst:l,auto:c=!0}=t;let u,d;const p=l&&e===2||!l&&e===1;if(!ZOe.includes(i))return{updated:!1,info:"invalid key"};l&&(e=3-e);const{matchUpWinningSide:h}=jY({sets:r,winningSide:o,matchUpStatus:a,matchUpFormat:s});o=h;const f=XOe({value:i,winningSide:o,scoreString:n,sets:r,matchUpFormat:s});if(Ype.includes(i)&&(i=Kg),f.hasOpener&&f.isTiebreakEntry&&!f.isTiebreakSet&&p&&Ct(i)===0&&(f.isTiebreakCloser=!0),WR.includes(i)&&f.hasOpener&&(i=""),WR.includes(i)&&(i=zR),f.lastSetIsComplete){const m=(n==null?void 0:n.length)&&n[n.length-1];n&&m!==" "&&(n+=" ")}if(f.isTimedSet)({info:d,sets:r,scoreString:n,updated:u,matchUpStatus:a,winningSide:o}=function(m){let{sets:g,info:v,scoreString:y,winningSide:b,matchUpStatus:I}=m;const{analysis:T,lowSide:S,value:w}=m;let U,D;g!=null&&g.length||w===HE||(g=[{setNumber:1}]);const E=g.length-1;if(uB.includes(w)){const C=g[g.length-1]||{},{side1Score:M,side2Score:N}=C;M&&!N?v="missing side2Score":T.finalSetIsComplete||b?v="final set is already complete":T.isIncompleteSetScore?v="incomplete set scoreString":T.isIncompleteSetScore||({sets:g,scoreString:y,winningSide:b,matchUpStatus:I,updated:U}=HY({lowSide:S,value:w,sets:g,scoreString:y,matchUpStatus:I,winningSide:b}))}else if(w===HE){if({scoreString:y,sets:g,outcomeRemoved:D}=dL({analysis:T,scoreString:y,sets:g}),(y==null?void 0:y.trim())===""&&(y=y.trim()),y||(g=[]),D){const C=g[g.length-1]||{},{side1Score:M,side2Score:N}=C;if(M&&N){const R=(M>N?1:N>M&&2)||void 0;R&&(C.winningSide=R,g.push({setNumber:g.length+1}))}}I=void 0,b=void 0,U=!0}else if(T.hasOutcome)v="has outcome";else{if(b)return{sets:g,scoreString:y,winningSide:b,matchUpStatus:I,updated:!1,info:"matchUp is complete"};if(w===zR){const C=g[g.length-1]||{},{side1Score:M,side2Score:N}=C,R=(M>N?1:N>M&&2)||void 0;!R||b||T.isIncompleteSetScore||(g[g.length-1].winningSide=R,g.push({setNumber:g.length+1}),y+=" ",U=!0)}else if(w===Kg&&g[E].side1Score!==void 0&&g[E].side2Score===void 0&&y&&T.isNumericEnding)y+="-",g[E].side2Score=0,I=void 0,b=void 0,U=!0;else if(!isNaN(w)){let C;if(g[E].side2Score===void 0){const M=Ct((g[E].side1Score||0).toString()+w).toString().slice(0,2);g[E].side1Score=Ct(M),C=g[E].side1Score.toString(),U=!0}else{const M=Ct((g[E].side2Score||0).toString()+w).toString().slice(0,2);g[E].side2Score=Ct(M),C=[g[E].side1Score,g[E].side2Score].join("-"),U=!0}if(U){const M=(g.slice(0,E)||[]).filter(N=>N).map(N=>{const{side1Score:R,side2Score:A}=N;return[R,A].join("-")}).join(" ");y=M?M+" "+C:C}}}return{sets:g,scoreString:y,winningSide:b,matchUpStatus:I,info:v,updated:U}}({analysis:f,lowSide:e,scoreString:n,sets:r,matchUpStatus:a,winningSide:o,value:i}));else if(uB.includes(i))f.finalSetIsComplete||o?d="final set is already complete":f.isTiebreakEntry||f.isIncompleteSetScore?f.isTiebreakEntry||f.isIncompleteSetScore?d="incomplete set scoreString or tiebreak entry":console.log("handle case",{value:i}):{sets:r,scoreString:n,matchUpStatus:a,winningSide:o,updated:u}=HY({lowSide:e,sets:r,scoreString:n,matchUpStatus:a,winningSide:o,value:i});else if(i===HE)u=!0,{scoreString:n,sets:r}=dL({analysis:f,scoreString:n,sets:r,lowSide:e}),n||(r=[]),a=void 0,o=void 0;else if(f.hasOutcome)d="has outcome";else if(i!==Kg||f.isMatchTiebreakEntry)if(i===Ju&&f.isMatchTiebreakEntry&&!f.isSetTiebreakEntry)f.matchTiebreakHasJoiner?d="existing joiner":f.isNumericEnding&&(u=!0,n+=Ju);else if([Kg,Ju].includes(i))d="invalid location for joiner";else{if(o)return{updated:!1,info:"matchUp is complete"};if(f.isIncompleteSetScore)f.isNumericValue&&({sets:r,scoreString:n,updated:u}=function({analysis:m,scoreString:g,sets:v,value:y}){let b;if(!(v!=null&&v.length))return{sets:[]};const I=v[v.length-1];y=Ct(y);const{validSide2Score:T,requiresTiebreak:S}=function({analysis:w,set:U={},value:D}){const E=w.isDecidingSet&&w.matchUpScoringFormat.finalSetFormat||w.matchUpScoringFormat.setFormat,{tiebreakAt:C,setTo:M,NoAD:N}=E,{side1Score:R}=U;let A,_;return A=C&&C<M?R===C?D<=M:D<=C:R===M?N?D<M:D<=M+1:R===M-1?N?D<=M:D<=M+1:R===M+1?D===M||D===M-1:D<=M,A&&(_=C&&C<M?R===M&&D===C||R===C&&D===M:R>=M&&D>=M&&R!==D),{validSide2Score:A,requiresTiebreak:_}}({analysis:m,set:I,value:y});if(T){b=!0,g=(g||"")+y,I.side2Score=y;const w=pL({analysis:m,set:v[v.length-1]});I.winningSide=w||void 0,S?g+=iv.split("")[0]:m.isDecidingSet||(g+=Pv)}return{sets:v,scoreString:g,updated:b}}({analysis:f,scoreString:n,sets:r,value:i}));else if(f.isInvalidMatchTiebreakValue)d="invalid matchUp tiebreak character";else if(f.isInvalidSetTiebreakValue)d="invalid set tiebreak character";else if(f.isTiebreakCloser){const m=f.isSetTiebreakEntry?iv:ym,g=m.split("").reverse()[0],v=m.split("")[0],y=r[r.length-1],{tiebreakFormat:b}=f.setFormat,{tiebreakTo:I,NoAD:T}=b||{},S=ix({set:y});if(!f.isTiebreakSet){const U=parseInt(n.split(v).reverse()[0]),D=VY({lowValue:U,tiebreakTo:I,NoAD:T});S===1?(y.side1TiebreakScore=D,y.side2TiebreakScore=U):(y.side1TiebreakScore=U,y.side2TiebreakScore=D)}n=(n||"")+g,f.isDecidingSet||(n+=Pv);const w=pL({analysis:f,set:y});y.winningSide=w||void 0,u=!0}else if(f.isTiebreakSetValue)({info:d,scoreString:n,sets:r,updated:u}=function({analysis:m,auto:g,lowSide:v,scoreString:y="",sets:b,value:I}){var T;let S,w;const{tiebreakSet:{tiebreakTo:U,NoAD:D}}=m.setFormat,[E]=ym.split("");if(m.isMatchTiebreakEntry||(y+=E),b[m.setNumber-1]){const{lastOpenBracketIndex:C}=UI({brackets:ym,scoreString:y}),M=(y.slice((C??0)+1)+(g?"":I)).split(Ju);if((((T=M[v-1])==null?void 0:T.length)||0)>=2)w="tiebreak digit limit";else if(g){v===1&&(M[0]=(M[0]||"")+I),v===2&&(M[1]=(M[1]||"")+I);const N=[M[0]||0,M[1]||0].map(_=>Ct(_)),R=v===1?1:0;N[R]=N[1-R]+(D?1:2),N[R]<U&&(N[R]=U);const A=b[b.length-1];A.side1TiebreakScore=N[0],A.side2TiebreakScore=N[1],y=y.slice(0,(C??0)+1),y+=N.join(Ju),S=!0}else{const N=[M[0]||0,M[1]||0].map(A=>Ct(A)),R=b[b.length-1];R.side1TiebreakScore=N[0],R.side2TiebreakScore=N[1],y+=I,S=!0}}else{const C=VY({lowValue:Ct(I||0),tiebreakTo:U,NoAD:D}),M=[Ct(I),C];v===2&&M.reverse();const N={side1TiebreakScore:M[0],side2TiebreakScore:M[1],setNumber:(b==null?void 0:b.length)+1||1};b.push(N),y+=M.join(Ju),S=!0}return{info:w,scoreString:y,sets:b,updated:S}}({analysis:f,auto:c,lowSide:e,scoreString:n,sets:r,value:i}));else if(f.isSetTiebreakEntry){const[m]=iv.split(""),g=Math.max(...au(m,n.split(""))),v=n.slice(g+1),y=v&&Ct(v)===0,b=Ct(v?v+i:i),{tiebreakFormat:I}=f.setFormat,{tiebreakTo:T,NoAD:S}=I||{};!y&&v.length<2?S&&b>T-1?d="invalid low value for NoAD tiebreak":(u=!0,n=(n||"")+i):d=y?"tiebreak begins with zero":"tiebreak digit limit"}else if(f.isCloser)d=`invalid key: ${i}`;else if(f.isGameScoreEntry)d="game scoreString entry";else if(f.lastSetIsComplete||!r.length){u=!0;const{scoreString:m,set:g}=function({analysis:v,lowSide:y,scoreString:b,value:I}){const{setTo:T,tiebreakAt:S,NoAD:w}=(v==null?void 0:v.setFormat)||{},U=I===parseInt(S||T);if(S&&S<T&&I>S)return{scoreString:b};if(w&&I===T||I>T)return{scoreString:b};const D=U?I+1:I+1===T?I+(w?1:2):T,E=[I,D];y===2&&E.reverse();const C=iv.split("")[0];b=(b||"")+(E.join(Kg)+(U?C:Pv));const M={side1Score:E[0],side2Score:E[1]},N=pL({analysis:v,set:M});return M.winningSide=N||void 0,{scoreString:b,set:M}}({analysis:f,lowSide:e,scoreString:n,value:Ct(i)});g&&(g.setNumber=(r==null?void 0:r.length)+1||1),r=(r==null?void 0:r.concat(g).filter(Boolean))||[g],n=m||void 0}else console.log("error: unknown outcome")}else(!f.isSetTiebreakEntry||f.isSetTiebreakEntry&&!f.isNumericEnding)&&(u=!0,{scoreString:n,sets:r}=dL({analysis:f,scoreString:n,sets:r,lowSide:e}),a=void 0);if(u){r=r==null?void 0:r.filter(Boolean);const{matchUpWinningSide:m}=jY({sets:r,winningSide:o,matchUpStatus:a,matchUpFormat:s});return o=m,!m||a&&![qn,Cd].includes(a)?!n||o||[Bpe,Fpe,Vpe].includes(a)||(a=void 0):(a="COMPLETED",r=r.filter(g=>{const{side1Score:v,side2Score:y,side1TiebreakScore:b,side2TiebreakScore:I}=g;return v||y||b||I})),{updated:u,scoreString:n,sets:r,winningSide:o,matchUpStatus:a,info:d}}return{updated:u,scoreString:n,sets:r,winningSide:o,matchUpStatus:a,info:d}},parseMatchUpFormat:Ga,parseScoreString:dB,redo:function({matchUp:t}){const{history:e=[],undoHistory:i=[]}=Hf({matchUp:t});return i.length&&e.push(i.pop()),Gf({matchUp:t,history:e,undoHistory:i})},reverseScore:function(t){if(!(t!=null&&t.score))return{error:bt};const{sets:e}=t.score,i=e.map(n=>{const{side1TiebreakScore:r,side2TiebreakScore:o,winningSide:a,side1Score:s,side2Score:l,setNumber:c}=n;return It({winningSide:a?3-a:void 0,side1TiebreakScore:o,side2TiebreakScore:r,side1Score:l,side2Score:s,setNumber:c})});return{reversedScore:{sets:i,scoreStringSide1:Kd({sets:i}),scoreStringSide2:Kd({sets:i,reversed:!0})},...le}},setServingSide:function({matchUp:t,sideNumber:e}){if(![1,2].includes(e))return{error:ace};const{history:i=[]}=Hf({matchUp:t});return i.push({srv:e}),Gf({matchUp:t,history:i})},stringifyMatchUpFormat:p3,tidyScore:function(t){if(!t.score)return{error:Re};const{score:e,sheetName:i,identifier:n,fileName:r,stepLog:o,fullLog:a,profile:s}=t,l=[];let c,u,d,p=[],h=e;const f=g=>{g.forEach(v=>{d=jOe[v]({profile:s,identifier:n,matchUpStatus:c,attributes:u,applied:p,score:h});const y=d.score!==h;y&&l.push({method:v,score:d.score}),o&&(a||y||d.matchUpStatus!==c)&&console.log(c?{score:d.score,matchUpStatus:c}:{score:d.score},v),d.matchUpStatus&&(c=d.matchUpStatus),d.attributes&&(u=d.attributes),d.applied&&(p=d.applied),h=d.score})};f(HOe);let m=LY(h);return m||(h=e.toString().replace(/\D/g,""),u!=null&&u.removed&&(u.removed=void 0),f(GOe),m=LY(h),m||(h="")),p.forEach(g=>{cL[g]||(cL[g]=0),cL[g]+=1}),{matchUpStatus:c==null?void 0:c.toUpperCase(),modifications:l,attributes:u,isValid:m,score:h}},umo:{},undo:function({matchUp:t}){const{history:e=[],undoHistory:i=[]}=Hf({matchUp:t});return i.push(e.pop()),Gf({matchUp:t,history:e,undoHistory:i})},updateTieMatchUpScore:Od,validateScore:Mpe,validateTieFormat:ds}),Jpe={collectionDefinitions:[{collectionName:"Male Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpCount:4,matchUpValue:1,gender:"MALE"},{collectionName:"Female Singles",matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:4,matchUpValue:1},{collectionName:"Male Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:2,matchUpValue:1,gender:"MALE"},{collectionName:"Female Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:2,matchUpValue:1},{collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpCount:4,matchUpValue:1,gender:"MIXED"}],tieFormatName:"USTA_GOLD_TEAM_CHALLENGE",winCriteria:{valueGoal:9}},Qpe={collectionDefinitions:[{collectionName:"Round 1",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 2",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Round 3",matchUpCount:3,matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"Doubles Shuffle",unrestrictedSelections:!0,winCriteria:{aggregateValue:!0}},ehe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_SOUTHERN_LEVEL_5",winCriteria:{valueGoal:8}},the={collectionDefinitions:[{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:4,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",matchUpCount:2,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Tiebreak Doubles",matchUpCount:1,matchUpFormat:"SET1-S:TB10",matchUpType:"DOUBLES",matchUpValue:1,processCodes:["RANKING.IGNORE"]}],tieFormatName:"USTA_SECTION_BATTLE",winCriteria:{valueGoal:9}},ihe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_INTERSECTIONAL",winCriteria:{valueGoal:8}},nhe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Pro Circuit",winCriteria:{aggregateValue:!0}},rhe={collectionDefinitions:[{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO_MIXED",winCriteria:{valueGoal:2}},ohe={collectionDefinitions:[{scoreValue:1,matchUpType:"SINGLES",collectionName:"Men's Singles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:3},{scoreValue:1,matchUpType:"SINGLES",collectionName:"Women's Singles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:3},{scoreValue:1,matchUpType:"DOUBLES",collectionName:"Men's Doubles",matchUpFormat:"SET1-S:T60",gender:"MALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Women's Doubles",matchUpFormat:"SET1-S:T60",gender:"FEMALE",matchUpCount:1},{matchUpValue:1,matchUpType:"DOUBLES",collectionName:"Mixed Doubles",matchUpFormat:"SET1-S:T60",gender:"MIXED",matchUpCount:1}],tieFormatName:"Time Tennis Dual",winCriteria:{aggregateValue:!0}},ahe={collectionDefinitions:[{category:{ageCategoryCode:"14U"},collectionName:"14U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Doubles",collectionGroupNumber:1,matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],collectionGroups:[{groupNumber:1,groupName:"Doubles",groupValue:1,winCriteria:{valueGoal:2}}],tieFormatName:"USTA_BREWER_CUP",winCriteria:{valueGoal:4}},she={winCriteria:{valueGoal:23},tieFormatName:"USTA_OZAKI_CUP",collectionDefinitions:[{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"18U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"18U"},collectionName:"18U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"18U"},collectionName:"18U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"16U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"16U"},collectionName:"16U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"16U"},collectionName:"16U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"14U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"14U"},collectionName:"14U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"14U"},collectionName:"14U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Boys Singles",matchUpType:"SINGLES",matchUpCount:3,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},matchUpFormat:"SET3-S:6/TB7-F:TB10",collectionName:"12U Girls Singles",matchUpType:"SINGLES",gender:"FEMALE",matchUpCount:3,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Boys Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",matchUpCount:1,matchUpValue:1,gender:"MALE"},{category:{ageCategoryCode:"12U"},collectionName:"12U Girls Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"FEMALE",matchUpCount:1,matchUpValue:1},{category:{ageCategoryCode:"12U"},collectionName:"12U Mixed Doubles",matchUpFormat:"SET1-S:8/TB8",matchUpType:"DOUBLES",gender:"MIXED",matchUpCount:1,matchUpValue:1}]},lhe={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:2,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"DOMINANT_DUO",winCriteria:{valueGoal:2}},che={collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",collectionValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"USTA_COLLEGE",winCriteria:{valueGoal:4}},uhe={collectionDefinitions:[{collectionName:"Male Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_LEVEL_1",winCriteria:{valueGoal:10}},dhe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_WTT_ITT",winCriteria:{aggregateValue:!0}},phe={collectionDefinitions:[{collectionName:"Male Singles",gender:"MALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpType:"SINGLES",matchUpValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Mixed Doubles",gender:"MIXED",matchUpCount:1,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1}],tieFormatName:"USTA_ZONAL",winCriteria:{valueGoal:10}},hhe={collectionDefinitions:[{collectionGroupNumber:1,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:1,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:1},{collectionGroupNumber:2,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:2,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:2},{collectionGroupNumber:3,matchUpType:"DOUBLES",matchUpCount:1,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3},{collectionGroupNumber:3,matchUpType:"SINGLES",matchUpCount:3,matchUpFormat:"SET3-S:6/TB7-F:TB10",matchUpValue:3}],collectionGroups:[{groupNumber:1,groupName:"Day 1"},{groupNumber:2,groupName:"Day 2"},{groupNumber:3,groupName:"Day 3"}],tieFormatName:"LAVER_CUP",winCriteria:{valueGoal:13}},fhe={collectionDefinitions:[{collectionName:"Female Doubles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Male Doubles",gender:"MALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Female Singles",gender:"FEMALE",matchUpCount:1,matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Male Singles",matchUpCount:1,gender:"MALE",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"SINGLES",scoreValue:1},{collectionName:"Mixed Doubles",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:6/TB5NOAD@5",matchUpType:"DOUBLES",scoreValue:1},{collectionName:"Overtime",matchUpCount:1,gender:"MIXED",matchUpFormat:"SET1-S:T20",matchUpType:"DOUBLES",scoreValue:1}],tieFormatName:"USTA_TOC",winCriteria:{aggregateValue:!0}};const GY="COLLEGE_DEFAULT",zY="COLLEGE_JUCO",WY="COLLEGE_D3",JOe="DOMINANT_DUO",QOe="DOMINANT_DUO_MIXED",eLe="LAVER_CUP",tLe="TEAM_DOUBLES_3_AGGREGATION",iLe="TIME_TENNIS_DUAL",nLe="TIME_TENNIS_PRO_CIRCUIT",rLe="USTA_BREWER_CUP",oLe="USTA_OZAKI_CUP",aLe="USTA_COLLEGE",sLe="USTA_GOLD_TEAM_CHALLENGE",lLe="USTA_LEVEL_1",cLe="USTA_INTERSECTIONAL",uLe="USTA_SECTION_BATTLE",dLe="USTA_SOUTHERN_LEVEL_5",pLe="USTA_TOC",hLe="USTA_WTT_ITT",fLe="USTA_ZONAL",mhe="STANDARD",qY={[mhe]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1},singles:{matchUpCount:6,matchUpValue:1},valueGoal:5},[WY]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7@7"},singles:{matchUpFormat:Xs,matchUpCount:6,matchUpValue:1},tieFormatName:WY,valueGoal:5},[GY]:{hydrate:!0,doubles:{matchUpCount:3,collectionValue:1,matchUpFormat:Xs},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Xs},tieFormatName:GY,valueGoal:4},[zY]:{hydrate:!0,doubles:{matchUpCount:3,matchUpValue:1,matchUpFormat:"SET1-S:8/TB7"},singles:{matchUpCount:6,matchUpValue:1,matchUpFormat:Xs},tieFormatName:zY,valueGoal:5},[eLe]:hhe,[JOe]:lhe,[QOe]:rhe,[tLe]:Qpe,[iLe]:ohe,[nLe]:nhe,[rLe]:ahe,[oLe]:she,[aLe]:che,[sLe]:Jpe,[cLe]:ihe,[lLe]:uhe,[uLe]:the,[dLe]:ehe,[hLe]:dhe,[pLe]:fhe,[fLe]:phe},oy=t=>{const e=t!=null&&t.namedFormat&&Object.keys(qY).includes(t.namedFormat)?t.namedFormat:mhe,i=Array.isArray(t==null?void 0:t.uuids)?t==null?void 0:t.uuids:[];let n;const{category:r,gender:o}=(t==null?void 0:t.event)??{},a=ft(qY[e],!1,!0),s=l=>{var c,u;if(!(t!=null&&t.isMock)&&!((c=t==null?void 0:t.event)!=null&&c.isMock)||!t.event)return(i==null?void 0:i.pop())??Hi();const d=(u=t==null?void 0:t.event)==null?void 0:u.eventId;return i.pop()??`${d}-COL-${l+1}`};return a.hydrate?(n={winCriteria:{valueGoal:a.valueGoal},collectionDefinitions:[{collectionId:s(0),matchUpFormat:Ade,collectionName:"Doubles",matchUpType:Pn,...a.doubles},{collectionId:s(1),matchUpFormat:Xs,collectionName:"Singles",matchUpType:vr,...a.singles}]},a.tieFormatName&&(n.tieFormatName=a.tieFormatName)):(a.collectionDefinitions.forEach((l,c)=>l.collectionId=s(c)),n=a),t!=null&&t.hydrateCollections&&n.collectionDefinitions.forEach(l=>{r&&!l.category&&(l.category=r),o&&!l.gender&&(l.gender=o)}),n};function nx(t){var e;const{voluntaryConsolation:i,tournamentRecord:n,event:r}=t,o="generateDrawDefinition",{participants:a,participantMap:s}=Qn({withIndividualParticipants:!0,convertExtensions:!0,internalUse:!0,tournamentRecord:n}),l=((e=r==null?void 0:r.entries)==null?void 0:e.filter(R=>R.entryStatus&&[...Zc,Tk].includes(R.entryStatus)))??[],c=DOe({...t,participantMap:s,participants:a,eventEntries:l});if(c.error)return ce({result:c,stack:o});const{appliedPolicies:u,policyDefinitions:d,drawSize:p,drawType:h,enforceGender:f,seedingProfile:m}=c,g=r==null?void 0:r.eventType,v=t.matchUpType??g,y=function(R){var A,_,k;const{existingDrawDefinition:O,hydrateCollections:F,enforceGender:B,tieFormatName:$,matchUpType:V,eventType:H,isMock:z,event:G}=R;let{tieFormat:W,matchUpFormat:K}=R;if(V===Yr&&H===Yr){const Z=(_=(A=O==null?void 0:O.structures)==null?void 0:A.find(({stage:Y})=>Y===ct))==null?void 0:_.tieFormat;W=W||Z||$&&((k=G==null?void 0:G.tieFormat)==null?void 0:k.tieFormatName)===$&&G.tieFormat||$&&oy({namedFormat:$,hydrateCollections:F,isMock:z,event:G})||(G==null?void 0:G.tieFormat)||oy({event:G,isMock:z,hydrateCollections:F}),K=void 0}else K||(W=void 0,G!=null&&G.matchUpFormat||(K=Xs));if(W){const Z=ds({gender:G==null?void 0:G.gender,enforceGender:B,tieFormat:W});if(Z.error)return Z}return{tieFormat:W,matchUpFormat:K}}({...t,enforceGender:f,eventType:g,matchUpType:v});if(y.error)return ce({result:y,stack:o});const{matchUpFormat:b,tieFormat:I}=y;if(t.drawId&&typeof t.drawId!="string")return ce({result:{error:Re},stack:o});const T=function(R){var A,_;const k="generateOrGetExisting",O=[],F=[],B=xOe(R);if(B.error)return ce({result:B,stack:k});const $=B.existingDrawDefinition;let V=B.drawDefinition??{},H=B.structureId;const z=R.drawEntries??R.eventEntries??[],G=B.existingQualifyingPlaceholderStructureId&&POe({...R,...B})||EOe({...R,...B,entries:z});return G.error?ce({result:G,stack:k}):((A=G.positioningReports)!=null&&A.length&&O.push(...G.positioningReports??[]),(_=G.conflicts)!=null&&_.length&&F.push(...G.conflicts??[]),V=G.drawDefinition,H=G.structureId,{existingDrawDefinition:$,positioningReports:O,drawDefinition:V,structureId:H,conflicts:F,entries:z})}({...t,isMock:t.isMock??!0,policyDefinitions:d,tournamentRecord:n,appliedPolicies:u,matchUpFormat:b,seedingProfile:m,participants:a,eventEntries:l,matchUpType:v,tieFormat:I,drawSize:p,drawType:h,event:r});if(T.error)return ce({result:T,stack:o});const{existingDrawDefinition:S,positioningReports:w,drawDefinition:U,structureId:D,conflicts:E,entries:C}=T;if(!U)return ce({result:{error:Re},stack:o});const M=function(R){var A,_,k;const{qualifyingPlaceholder:O,qualifyingProfiles:F,existingDrawDefinition:B,positioningReports:$,appliedPolicies:V,qualifyingOnly:H,drawDefinition:z,seedingProfile:G,participants:W,structureId:K,entries:Z,stack:Y}=R,X=O&&!(F!=null&&F.length)&&!B,Q=[];if(F){const te=(ne,re)=>ne.stageSequence-re.stageSequence,J=(ne,re)=>ne.roundTarget-re.roundTarget,ie=[];let oe=1;F.sort(J);for(const ne of F){if(!Array.isArray(ne.structureProfiles))return ce({info:_d("structureProfiles"),result:{error:bt},stack:Y});oe=ne.roundTarget||oe;const re=((A=ne.structureProfiles)==null?void 0:A.sort(te))||[];let me=1;for(const he of re){const{qualifyingRoundNumber:be,qualifyingPositions:Se,seededParticipants:De,seedingScaleName:Oe,seedsCount:xe=0,seedByRanking:$e,placeByes:Ae,drawSize:ve}=he,ke=Ppe({...R,seedingProfile:he.seedingProfile??G,stageSequence:me,qualifyingRoundNumber:be,preparedStructureIds:ie,qualifyingPositions:Se,seededParticipants:De,stage:St,seedingScaleName:Oe,appliedPolicies:V,drawDefinition:z,qualifyingOnly:H,seedByRanking:$e,participants:W,roundTarget:oe,seedsCount:xe,placeByes:Ae,drawSize:ve,entries:Z});if(ke.error)return ke;ke.structureId&&ie.push(ke.structureId),me+=1,(_=ke.conflicts)!=null&&_.length&&Q.push(...ke.conflicts),(k=ke.positioningReport)!=null&&k.length&&$.push({[St]:ke.positioningReport})}oe+=1}}else if(K&&X){const te=fo({structureName:yo(St),stage:St}),{link:J}=pC({sourceStructureId:te.structureId,targetStructureId:K,sourceRoundNumber:0,linkType:Mp});z.structures||(z.structures=[]),z.structures.push(te),z.links||(z.links=[]),z.links.push(J)}return{qualifyingConflicts:Q,error:void 0}}({...t,existingDrawDefinition:S,positioningReports:w,appliedPolicies:u,drawDefinition:U,seedingProfile:m,participants:a,structureId:D,entries:C,params:t,stack:o});if(M.error)return M;const{qualifyingConflicts:N}=M;return U.drawName=t.drawName??(h&&yo(h)),p&&typeof i=="object"&&p>=4&&qW({...i,drawDefinition:U,matchUpType:v}),{existingDrawDefinition:!!S,qualifyingConflicts:N,positioningReports:w,drawDefinition:U,structureId:D,...le,conflicts:E}}var mLe=Object.freeze({__proto__:null,addAdHocMatchUps:LR,addDrawDefinitionTimeItem:r3,addPlayoffStructures:jk,addQualifyingStructure:Dde,addVoluntaryConsolationStage:Tde,addVoluntaryConsolationStructure:qW,allPlayoffPositionsFilled:t3,alternateDrawPositionAssignment:cde,assignDrawPosition:Jde,assignDrawPositionBye:Ms,attachConsolationStructures:Yde,attachPlayoffStructures:m3,attachQualifyingStructure:n3,attachStructures:Vk,autoSeeding:rpe,automatedPlayoffPositioning:dC,automatedPositioning:uC,checkValidEntries:zk,deleteAdHocMatchUps:Qde,drawMatic:nq,findDrawDefinition:I3,generateAdHocMatchUps:Wk,generateAdHocRounds:iq,generateAndPopulatePlayoffStructures:f3,generateDrawDefinition:nx,generateDrawMaticRound:D3,generateDrawStructuresAndLinks:T3,generateDrawTypeAndModifyDrawDefinition:U3,generateQualifyingStructure:a3,generateVoluntaryConsolation:gpe,getAssignedParticipantIds:Pg,getAvailablePlayoffProfiles:hC,getDrawDefinitionTimeItem:BW,getDrawParticipantRepresentativeIds:y3,getDrawTypeCoercion:wC,getEligibleVoluntaryConsolationParticipants:v3,getParticipantIdFinishingPositions:b3,getPositionAssignments:_U,getPositionsPlayedOff:z0,getSeedingThresholds:JW,getSeedsCount:IC,getStructureSeedAssignments:ul,getTeamLineUp:Ym,getValidGroupSizes:cC,isAdHoc:Zl,isCompletedStructure:Bh,isValidForQualifying:S3,luckyLoserDrawPositionAssignment:lde,modifyDrawDefinition:Kde,modifyDrawName:g3,modifySeedAssignment:hde,mutate:Fxe,positionActions:w3,pruneDrawDefinition:Xde,qualifierDrawPositionAssignment:dde,query:iOe,removeDrawPositionAssignment:MU,removeRoundMatchUps:epe,removeSeededParticipant:Ude,removeStructure:wde,renameStructures:Ide,resetDrawDefinition:Zde,resetVoluntaryConsolationStructure:wue,setDrawParticipantRepresentativeIds:Zce,setPositionAssignments:ude,setStructureOrder:yde,setSubOrder:tpe,swapDrawPositionAssignments:pde,updateTeamLineUp:cb,withdrawParticipantAtDrawPosition:tde});function aq({tournamentRecord:t,drawDefinition:e,participantId:i,entryPosition:n,skipRefresh:r,event:o}){if(!t)return{error:je};if(!i)return ce({result:{error:Hr},stack:"setEntryPositions"});if(n!==void 0&&!Number.isSafeInteger(n))return{error:Re,entryPosition:n};((o==null?void 0:o.entries)||[]).forEach(s=>{s.participantId===i&&(s.entryPosition=n)}),((e==null?void 0:e.entries)||[]).forEach(s=>{s.participantId===i&&(s.entryPosition=n)});const a=s=>{s.entries.forEach(l=>{l.entryPosition===n&&l.participantId!==i&&(l.entryPosition+=.1)})};return r||(o!=null&&o.entries&&(a(o),o.entries=Ac({entries:o.entries})),e!=null&&e.entries&&(a(e),e.entries=Ac({entries:e.entries}))),{...le}}function ghe({tournamentRecord:t,entryPositions:e,drawDefinition:i,event:n}){if(!t)return{error:je};if(!Array.isArray(e))return{error:Re};for(const r of e){const{participantId:o,entryPosition:a}=r,s=aq({skipRefresh:!0,tournamentRecord:t,drawDefinition:i,participantId:o,entryPosition:a,event:n});if(s.error)return s}return n!=null&&n.entries&&(n.entries=Ac({entries:n.entries})),i!=null&&i.entries&&(i.entries=Ac({entries:i.entries})),{...le}}function vhe(t){const{participantId:e}=t;return e&&typeof e!="string"?{error:Re,participantId:e}:sq({...t,participantIds:[e].filter(Boolean)})}function sq({tournamentRecord:t,drawDefinition:e,participantIds:i,stageSequence:n,stage:r=ct,eventId:o,event:a}){if(!t)return{error:je};if(!Array.isArray(i))return{error:Re,participantIds:i};if(!a)return{error:Fi};if(a){const s=YY({element:a,participantIds:i,stageSequence:n,stage:r});if(s.error)return s}if(e){const s=YY({element:e,participantIds:i,stageSequence:n,stage:r});if(s.error)return o?ce({context:{drawPromotionError:s.error,drawId:e.drawId},result:{...le},stack:"promoteAlternates"}):s}return{...le}}function YY({participantIds:t,stageSequence:e,element:i,stage:n}){const r=(i.entries||[]).filter(d=>d.entryStatus===Nc),o=(i.entries||[]).filter(d=>t.includes(d.participantId)),a=r.reduce((d,p)=>{const{entryPosition:h}=p;return isNaN(h)&&d||(!d||h<d.entryPosition)&&p||d},void 0),s=o.length?o:[a].filter(Boolean);if(!(s!=null&&s.length))return{error:dce};const l=s.filter(({entryStatus:d})=>d!==Nc);if(l.length)return{error:O2,invalidEntryStatus:l};const c=s.filter(({entryStage:d})=>d&&d!==n);if(c.length)return{error:M_e,invalidStage:c};const u=e&&s.filter(d=>d.stageSequence!==e);if(u!=null&&u.length)return{error:R_e,invalidStageSequence:u};for(const d of s){d.entryStatus=cl;const p=d==null?void 0:d.entryPosition;isNaN(p)||i.entries.forEach(f=>{f.entryStatus===Nc&&f.entryPosition>p&&(f.entryPosition=f.entryPosition-1)});const h=Math.max(...i.entries.filter(f=>f.entryStatus===cl&&!isNaN(f.entryPosition)).map(({entryPosition:f})=>Ct(f||0)),0);d.entryPosition=h||0}return{...le}}function yhe({autoEntryPositions:t=!0,participantIds:e,drawDefinition:i,drawId:n,stages:r,event:o}){var a;if(!o)return{error:Fi};if(!n)return{error:Yc};if(!(e!=null&&e.length))return{error:Ig};if(ua(Pg({drawDefinition:i,stages:r}).assignedParticipantIds??[],e))return{error:FP};const s=u=>{const d=u.participantId;return!e.includes(d)},{flightProfile:l}=Zn({event:o}),c=(a=l==null?void 0:l.flights)==null?void 0:a.find(u=>u.drawId===n);return c!=null&&c.drawEntries&&(c.drawEntries=c.drawEntries.filter(s),t&&(c.drawEntries=Ac({entries:c.drawEntries}))),i!=null&&i.entries&&(i.entries=i.entries.filter(s),t&&(i.entries=Ac({entries:i.entries}))),{...le}}function Au(t){var e,i,n,r,o;const a="addParticipant",{allowDuplicateParticipantIdPairs:s,returnParticipant:l,disableNotice:c,pairOverride:u,participant:d}=t,p=t.tournamentId?(e=t.tournamentRecords)==null?void 0:e[t.tournamentId]:t.tournamentRecord??(t.activeTournamentId&&((i=t.tournamentRecords)==null?void 0:i[t.activeTournamentId]));if(!p)return{error:je};if(!d)return ce({result:{error:A0},stack:a});d.participantId||(d.participantId=Hi()),p.participants||(p.participants=[]);const{participantId:h,individualParticipantIds:f}=d;if(p.participants.reduce((b,I)=>I.participantId===h||b,!1))return{error:U_e};const{participantType:m,participantRole:g}=d;if(!m||!Object.keys(LE).includes(m))return{error:Cu,participantType:m};if(!g)return{error:T_e};const v=p.participants||[],y=v.filter(b=>b.participantType===ui).map(b=>b.participantId);if(m!==ui&&d.person)return{error:Re,person:d.person};if(f&&!Array.isArray(f))return{error:Re,individualParticipantIds:f};if(m===qt){if(d.person)return{error:Re,person:d.person};if(!d.individualParticipantIds)return ce({result:{error:Ig},stack:a});if(d.individualParticipantIds.length!==2&&!u)return ce({info:"PAIR must be 2 individualParticipantIds",result:{error:Ec},stack:a});{const T=v.filter(S=>S.participantType===ui).map(S=>S.participantId);if(!Array.isArray(d.individualParticipantIds))return ce({result:{error:Ec},stack:a});if(!d.individualParticipantIds.reduce((S,w)=>T.includes(w)&&S,!0))return ce({result:{error:Ec},stack:a})}const b=v.filter(T=>T.participantType===qt).map(T=>({individualParticipantIds:T.individualParticipantIds,participant:T})),I=d.participantType===qt&&b.find(T=>sr(T.individualParticipantIds,d.individualParticipantIds).length===2);if(I&&!s)return{...le,existingParticipant:!0,participant:l&&ft(I.participant)};if(!d.participantName){const T=v.filter(w=>{var U;return(U=d.individualParticipantIds)==null?void 0:U.includes(w.participantId)});let S=T.map(w=>{var U;return(U=w.person)==null?void 0:U.standardFamilyName}).filter(Boolean).join("/");T.length===1&&(S+="/Unknown"),d.participantName=S}}else if(m===ui){if(!((n=d.person)!=null&&n.standardFamilyName)||!((r=d.person)!=null&&r.standardGivenName))return{error:E_e};if(!d.participantName){const b=`${d.person.standardFamilyName.toUpperCase()}, ${d.person.standardGivenName}`;d.participantName=b}}else{if(!m||![on,gl].includes(m))return{error:Cu};if(f||(d.individualParticipantIds=[]),(o=d.individualParticipantIds)==null?void 0:o.length)for(const b of d.individualParticipantIds){if(typeof b!="string")return ce({result:{participantId:b,error:Re},stack:a});if(!y.includes(b))return ce({result:{participantId:b,error:rr},stack:a})}}return p.participants.push(d),c||bi({payload:{tournamentId:p.tournamentId,participants:[d]},topic:zm}),It({participant:l&&ft(d),...le})}function jc({allowDuplicateParticipantIdPairs:t,returnParticipants:e,tournamentRecord:i,participants:n=[]}){if(!i)return{error:je};i.participants||(i.participants=[]);const r=i.participants.map(d=>d.participantId)||[];n.forEach(d=>{d.participantId||(d.participantId=Hi())});const o=n.filter(d=>!r.includes(d.participantId)),a=n.filter(d=>r.includes(d.participantId)),s=o.filter(d=>d.participantType===ui),l=o.filter(d=>d.participantType!==ui),c=s.concat(...l),u=[];if(c.length){for(const p of c){const h=Au({allowDuplicateParticipantIdPairs:t,returnParticipant:!0,disableNotice:!0,tournamentRecord:i,participant:p});if(h.error)return h;h.success&&!h.existingParticipant&&u.push(h.participant)}u.length&&bi({topic:zm,payload:{tournamentId:i.tournamentId,participants:u}});const d={participants:e&&ft(u),addedCount:u.length,...le};return a.length&&Object.assign(d,{notAdded:a,info:Xz}),It(d)}return{info:"No new participants to add",addedCount:0,...le}}function bhe({allowDuplicateParticipantIdPairs:t,entryStage:e=ct,entryStatus:i=Nc,participantIdPairs:n=[],tournamentRecord:r,drawDefinition:o,event:a,uuids:s}){if(!r)return{error:je};if(!a)return{error:Fi};if(a.eventType!==Pn)return{error:Lm};const l=[],c=new Map;for(const g of r.participants??[]){const{participantType:v,participantId:y,person:b,individualParticipantIds:I}=g;v===ui&&b!=null&&b.sex?c.set(y,b.sex):v===qt&&I&&l.push(I)}const u=n.filter(g=>{if(g.length!==2||!c.has(g[0])||!c.has(g[1]))return!0;if(!a.gender||a.gender===Ru)return!1;const v=g.map(b=>c.get(b));let y=a.gender===rn&&(v[0]!==rn||v[1]!==rn)||a.gender===Dn&&(v[0]!==Dn||v[1]!==Dn);return a.gender===is&&(v.sort(Rk),v[0]===Dn&&v[1]===rn||(y=!0)),y});if(u.length)return{error:Ec,invalidParticipantIdPairs:u};const d=n.map(g=>({participantId:(s==null?void 0:s.pop())??Hi(),participantRole:Ro,individualParticipantIds:g,participantType:qt})),p=t?d:d.filter(g=>!l.find(v=>sr(v,g.individualParticipantIds).length===2));let h,f=[];if(p){const g=jc({allowDuplicateParticipantIdPairs:t,participants:p,returnParticipants:!0,tournamentRecord:r});if(g.error)return g;f=g.participants||[],h=g.info}const m=dd({participantIds:n.map(g=>{const v=f.find(b=>sr(b.individualParticipantIds,g).length===2);if(v)return v;const{participant:y}=Kl({tournamentRecord:r,participantIds:g});return y}).map(g=>g.participantId),tournamentRecord:r,drawDefinition:o,entryStatus:i,entryStage:e,event:a});return p.length&&bi({payload:{participants:p},topic:zm}),{...m,info:h,newParticipantIds:p.map(li)}}function Ihe({entryStatus:t=cl,unpairedParticipantIds:e=[],participantIdPairs:i=[],entryStage:n=ct,tournamentRecord:r,event:o}){if(!r)return{error:je};if(!o)return{error:Fi};const a=r.participants??[],s=a.filter(f=>f.participantType===ui).map(f=>f.participantId),l=e.concat(...i).flat(1/0).filter(f=>!s.includes(f));if(l.length)return{error:Ec,invalidParticipantIds:l};const c=i.filter(f=>f.length!==2);if(c.length)return{error:Ec,invalidParticipantIdPairs:c};const u=a.filter(f=>f.participantType===qt).map(f=>f.individualParticipantIds),d=jc({participants:i.filter(f=>!u.find(m=>sr(m,f).length===2)).map(f=>({participantType:qt,participantRole:Ro,individualParticipantIds:f})),tournamentRecord:r});if(d.error)return d;const p=i.map(f=>{const{participant:m}=Kl({tournamentRecord:r,participantIds:f});return m}).map(f=>({participantId:f,entryStatus:t,entryStage:n})),h=e.map(f=>({entryStatus:Fc,participantId:f,entryStage:n}));return o.entries=(o.entries??[]).filter(f=>f.entryStage===n),o.entries=o.entries.concat(...p,...h),{...le}}var gLe=Object.freeze({__proto__:null,addDrawEntries:GW,addEventEntries:dd,addEventEntryPairs:bhe,destroyPairEntries:ede,destroyPairEntry:WW,modifyEntriesStatus:MR,modifyEventEntries:Ihe,promoteAlternate:vhe,promoteAlternates:sq,removeDrawEntries:yhe,removeEventEntries:lC,setEntryPosition:aq,setEntryPositions:ghe}),vLe=Object.freeze({__proto__:null,addDrawEntries:GW,addEventEntries:dd,addEventEntryPairs:bhe,destroyPairEntries:ede,destroyPairEntry:WW,getEntriesAndSeedsCount:Hk,getMaxEntryPosition:F3,modifyEntriesStatus:MR,modifyEventEntries:Ihe,mutate:gLe,promoteAlternate:vhe,promoteAlternates:sq,query:vOe,removeDrawEntries:yhe,removeEventEntries:lC,setEntryPosition:aq,setEntryPositions:ghe});function q0({removePriorValues:t=!0,status:e=ju,statusObject:i,event:n}){if(!bn(i))return{error:Re};const r=Xc({event:n,status:e}),o=`${eb}.${tb}`;return db({timeItem:{itemValue:{[e]:{...r,...i}},itemType:o},removePriorValues:t,event:n})}function lq(t){const{tournamentParticipants:e=[],includePositionAssignments:i,policyDefinitions:n,tournamentRecord:r,inContext:o=!0,usePublishState:a,drawDefinition:s,publishStatus:l,noDeepCopy:c,sortConfig:u,context:d,event:p}=t;if(!s)return{error:rt};const h=(({matchUpFormat:w,updatedAt:U,drawType:D,drawName:E,drawId:C})=>({matchUpFormat:w,updatedAt:U,drawName:E,drawType:D,drawId:C}))(s);let f,m;const{allStructuresLinked:g,sourceStructureIds:v,hasDrawFeedProfile:y,structureGroups:b}=Ok({drawDefinition:s});if(!g)return{error:a_e};let I=!1,T=!1;const S=b.map(w=>{const U={},D=w.map(E=>{const{structure:C}=kt({drawDefinition:s,structureId:E}),{seedAssignments:M}=ul({drawDefinition:s,structure:C});return(C==null?void 0:C.stage)===ct&&C.stageSequence===1&&(f=M),(C==null?void 0:C.stage)===St&&C.stageSequence===1&&(m=M),C}).sort((E,C)=>Zy(E,C,u)).map(E=>{var C;if(!E)return;const M=E==null?void 0:E.structureId;let N=[];E.stage&&[ct,So,Vn].includes(E.stage)&&(N=f),(E==null?void 0:E.stage)===St&&(N=m);const{matchUps:R,roundMatchUps:A,roundProfile:_}=zi({seedAssignments:(C=E==null?void 0:E.seedAssignments)!=null&&C.length?void 0:N,context:{drawId:h.drawId,...d},tournamentParticipants:e,policyDefinitions:n,tournamentRecord:r,usePublishState:a,publishStatus:l,drawDefinition:s,inContext:o,structure:E,event:p}),{positionAssignments:k}=Ki({structure:E}),O=k==null?void 0:k.filter(Ts(Pp)).map($=>{T=!0;const{drawPosition:V,participantId:H}=$,{extension:z}=ei({element:$,name:tf});return z&&{drawPosition:V,participantId:H,participantResult:z.value}}).filter($=>$==null?void 0:$.participantResult),F=E?(({stageSequence:$,structureName:V,structureType:H,matchUpFormat:z,stage:G})=>({stageSequence:$,structureName:V,structureType:H,matchUpFormat:z,stage:G}))(E):{};F.sourceStructureIds=v[M],F.hasDrawFeedProfile=y[M],F.positionAssignments=k,F.structureActive=R.reduce(($,V)=>{var H;const z=[fr,Yp,Mi,da,Li,Kc,Mr,gr].includes(V.matchUpStatus);return $||z||!!V.winningSide||!!((H=V.score)!=null&&H.scoreStringSide1)},!1);const B=R.reduce(($,V)=>$&&[Ri,fr,da,Li,Mi,Es].includes(V.matchUpStatus),!!R.length);return F.structureCompleted=B,U[M]=B,F.structureActive&&(I=!0),{...F,participantResults:O,seedAssignments:N,roundMatchUps:A,roundProfile:_,structureId:M}});return D.forEach(E=>{var C;i||delete E.positionAssignments,E.sourceStructuresComplete=(C=E.sourceStructureIds)==null?void 0:C.every(M=>U[M])}),D}).flat();return h.drawActive=I,h.participantPlacements=T,h.drawGenerated=S==null?void 0:S.reduce((w,U)=>w||!!(U!=null&&U.roundMatchUps),!1),h.drawCompleted=S==null?void 0:S.reduce((w,U)=>w&&U.structureCompleted,!0),{structures:c?S:ft(S,!1,!0),drawInfo:c?h:ft(h,!1,!0),...le}}function cq(t){const{includePositionAssignments:e,tournamentRecord:i,participantsProfile:n,policyDefinitions:r,usePublishState:o,status:a=ju,sortConfig:s,event:l}=t,c=ft(i,!1,!0),u=ft(l,!1,!0);if(!c)return{error:je};if(!u)return{error:Fi};const{eventId:d}=u,{tournamentId:p,endDate:h}=c,f=Xc({event:u,status:a}),{publishState:m}=Nk({event:u}),{participants:g}=Qn({withGroupings:!0,withEvents:!1,withDraws:!1,...n,tournamentRecord:c}),v=(u.drawDefinitions||[]).filter(({drawId:I})=>{var T,S;return!o||(f.drawDetails?(S=(T=f.drawDetails[I])==null?void 0:T.publishingDetail)==null?void 0:S.published:!f.drawIds||f.drawIds.includes(I))}).map(I=>(({drawInfo:T,structures:S})=>({...T,structures:S}))(lq({context:{eventId:d,tournamentId:p,endDate:h},includePositionAssignments:e,tournamentParticipants:g,noDeepCopy:!0,policyDefinitions:r,tournamentRecord:c,usePublishState:o,drawDefinition:I,publishStatus:f,sortConfig:s,event:u}))).map(({structures:I,...T})=>{const S=I==null?void 0:I.filter(({stage:w,structureId:U})=>(({structureId:D,drawId:E})=>{var C,M,N;if(!o)return!0;const R=(M=(C=f==null?void 0:f.drawDetails)==null?void 0:C[E])==null?void 0:M.structureDetails;return!R||!Object.keys(R).length||((N=R[D])==null?void 0:N.published)})({structureId:U,drawId:T.drawId})&&(({stage:D,drawId:E})=>{var C,M,N;if(!o)return!0;const R=(M=(C=f==null?void 0:f.drawDetails)==null?void 0:C[E])==null?void 0:M.stageDetails;return!R||!Object.keys(R).length||((N=R[D])==null?void 0:N.published)})({stage:w,drawId:T.drawId})).map(w=>(({drawId:U,structure:D})=>{var E,C,M,N;if(!o)return D;const R=(N=(M=(C=(E=f==null?void 0:f.drawDetails)==null?void 0:E[U])==null?void 0:C.structureDetails)==null?void 0:M[D.structureId])==null?void 0:N.roundLimit;if($t(R)){const A=nt(1,R+1),_={},k={};for(const O of A)D.roundMatchUps[O]&&(_[O]=D.roundMatchUps[O],k[O]=D.roundProfile[O]);D.roundMatchUps=_,D.roundProfile=k}return D})({drawId:T.drawId,structure:w}));return{...T,structures:S}}).filter(I=>{var T;return(T=I.structures)==null?void 0:T.length}),{tournamentInfo:y}=pb({tournamentRecord:c}),b={tournamentInfo:y,venuesData:(c.venues||[]).map(I=>(({venueData:T})=>({...T}))(CU({tournamentRecord:c,venueId:I.venueId}))),eventInfo:(({eventId:I,eventName:T,eventType:S,eventLevel:w,surfaceCategory:U,matchUpFormat:D,category:E,gender:C,startDate:M,endDate:N,ballType:R,discipline:A})=>({eventId:I,eventName:T,eventType:S,eventLevel:w,surfaceCategory:U,matchUpFormat:D,category:E,gender:C,startDate:M,endDate:N,ballType:R,discipline:A}))(u),drawsData:v};return b.eventInfo.publishState=m,b.eventInfo.publish=f,{...le,eventData:b}}function Y0(t){var e,i,n,r,o,a;const{includePositionAssignments:s,removePriorValues:l,tournamentRecord:c,status:u=ju,event:d,drawIdsToRemove:p,drawIdsToAdd:h}=t;if(!c)return{error:je};if(!d)return{error:Fi};const{appliedPolicies:f}=Gi({tournamentRecord:c,event:d}),m={...f,...t.policyDefinitions},g=((e=d.drawDefinitions)==null?void 0:e.map(({drawId:U})=>U))??[],v=t.drawDetails?Object.keys(t.drawDetails):[],y=v.length?[]:t.drawIds,b=(h??[]).concat(...p??[],...y??[],...v),I=b.filter(U=>!g.includes(U));if(I.length)return ce({result:{error:ml},context:{invalidDrawIds:I}});const T=Xc({event:d,status:u}),S=Object.keys((T==null?void 0:T.drawDetails)||{}).filter(U=>g.includes(U)).reduce((U,D)=>(U[D]=T.drawDetails[D],U),{});for(const U of g)if(b.length&&!b.includes(U)||(p!=null&&p.includes(U)||y!=null&&y.length&&!y.includes(U)?S[U]={...S[U],publishingDetail:{published:!1}}:(h!=null&&h.includes(U)||y!=null&&y.includes(U)||!(y!=null&&y.length))&&(S[U]={...S[U],publishingDetail:{published:!0}})),(i=t.drawDetails)==null?void 0:i[U]){const D=t.drawDetails[U];let E=D.structureDetails??S[U].structureDetails;const C=D.stageDetails??S[U].stageDetails??{},{structureIdsToRemove:M=[],structureIdsToAdd:N=[],publishingDetail:R={},stagesToRemove:A=[],stagesToAdd:_=[]}=D;if((N||_)&&(R.published=!0),S[U]={publishingDetail:R,structureDetails:E,stageDetails:C},N.length||M.length){const O=(((r=(n=d.drawDefinitions)==null?void 0:n.find(B=>B.drawId===U))==null?void 0:r.structures)??[]).map(({structureId:B})=>B),F=(N??[]).concat(M??[]).filter(B=>!O.includes(B));if(F.length)return ce({result:{error:Cn},context:{invalidStructureIds:F}});E=E??{};for(const B of O)M.includes(B)?E[B]={published:!1}:E[B]={published:!0};S[U].structureDetails=E}const k=(((a=(o=d.drawDefinitions)==null?void 0:o.find(O=>O.drawId===U))==null?void 0:a.structures)??[]).map(({stage:O})=>O);if(_.length){for(const O of _)C[O]={published:!0};for(const O of k)C[O]||(C[O]={published:!1})}if(_.length||A.length){for(const O of A)C[O]={published:!1};for(const O of k)C[O]||(C[O]={published:!0})}(_.length||A.length)&&(S[U].stageDetails=C)}q0({statusObject:{drawDetails:S},removePriorValues:l,status:u,event:d});const{eventData:w}=cq({includePositionAssignments:s,usePublishState:!0,tournamentRecord:c,policyDefinitions:m,event:d});return bi({payload:{eventData:w,tournamentId:c.tournamentId},topic:_ke}),{...le,eventData:w}}const yLe="deleteDrawDefinitions",bLe="autoSchedulingAudit",KY="deleteEvents";function rx(t){var e,i,n;if(!t.tournamentRecord)return{error:je};const r="deleteDrawDefinitions";let o=t.drawIds??[],a=t.event;const{autoPublish:s=!0,tournamentRecord:l,auditData:c,eventId:u,force:d}=t,{appliedPolicies:p}=Gi({tournamentRecord:l,event:a}),h={...p,...t.policyDefinitions},f=Array.isArray(o)?o[0]:void 0;if(!a){const C=us({tournamentRecord:l,eventId:u,drawId:f});if(C.error)return C;a=C.event}const m=[],g=[],v=[];if(!(a!=null&&a.drawDefinitions))return ce({info:"event has no drawDefinition",result:{...le},stack:r});const y=a.drawDefinitions.map(({drawId:C})=>C);if(o.length||(o=y),o=o.filter(C=>y.includes(C)),!o.length)return ce({info:"nothing to do; no matching drawIds in event.",result:{...le},stack:r});const b=ft(Zn({event:a}).flightProfile,!1,!0),I=({participantId:C,drawPosition:M,qualifier:N,bye:R})=>({bye:R,qualifier:N,drawPosition:M,participantId:C}),T=d??((i=(e=p==null?void 0:p[jm])==null?void 0:e.allowDeletionWithScoresPresent)==null?void 0:i.drawDefinitions),S=Xc({event:a})??{};let w,U=S.drawIds??(S.drawDetails&&Object.keys(S.drawDetails))??[];const D=[],E=a.drawDefinitions.filter(C=>{var M,N,R,A,_,k,O;if(o.includes(C.drawId)){const F=((M=Fa({event:a,drawDefinition:C}))==null?void 0:M.matchUps)??[];if(F.some(({score:X})=>lo({score:X}))&&!T)return D.push(C.drawId),!0;const{drawId:B,drawType:$,drawName:V}=C,H=(N=b==null?void 0:b.flights)==null?void 0:N.find(X=>X.drawId===C.drawId);H&&(H.drawEntries=(R=H.drawEntries)==null?void 0:R.filter(X=>Zc.includes(X.entryStatus))),U.includes(B)&&(U=U.filter(X=>X!==B),w=!0);const z=(_=(A=Nd({stageSequence:1,drawDefinition:C,stage:ct}))==null?void 0:A.structures)==null?void 0:_[0],G=z?_U({structureId:z.structureId,tournamentRecord:l,drawDefinition:C}):void 0,W=(k=G==null?void 0:G.positionAssignments)==null?void 0:k.map(I),K=(O=Nd({stage:St,drawDefinition:C}))==null?void 0:O.structures,Z=K!=null&&K.length?K.map(X=>{const Q=X.stageSequence,te=_U({structureId:X.structureId,tournamentRecord:l,drawDefinition:C});return{positionAssignments:te==null?void 0:te.positionAssignments.map(I),stageSequence:Q}}):void 0,Y={action:yLe,payload:{drawDefinitions:[C],eventId:u??(a==null?void 0:a.eventId),auditData:c}};v.push(Y),m.push(It({tournamentId:l.tournamentId,eventId:u??(a==null?void 0:a.eventId),qualifyingPositionAssignments:Z,positionAssignments:W,auditData:c,drawType:$,drawName:V,drawId:B})),F==null||F.forEach(({matchUpId:X})=>g.push(X))}return!o.includes(C.drawId)});if(D.length&&!d)return ce({context:{drawIdsWithScoresPresent:D},result:{error:Sce},stack:r});if(a.drawDefinitions=E,b&&kf({event:a,extension:{name:ql,value:b}}),UC({tournamentRecord:l}),w){const C={};for(const N of U)C[N]=((n=S.drawDetails)==null?void 0:n[N])??{published:!0};const M=q0({statusObject:{drawDetails:C},event:a});if(M.error)return{error:M.error}}if(v.length&&bi({topic:SU,payload:v}),g.length&&Kp({tournamentId:l==null?void 0:l.tournamentId,matchUpIds:g}),o.forEach(C=>{(function({tournamentId:M,eventId:N,drawId:R}){bi({payload:{drawId:R,tournamentId:M,eventId:N},topic:due,key:R}),Pce({key:R})})({drawId:C})}),function({event:C,deletedDrawsDetail:M,auditData:N}){const{extension:R}=ei({name:wR,element:C}),A={...N,deletedDrawsDetail:M},_={name:wR,value:Array.isArray(R==null?void 0:R.value)?R==null?void 0:R.value.concat(A):[A]};Ii({element:C,extension:_})}({event:a,deletedDrawsDetail:m,auditData:c}),s&&w){const C=Y0({drawIdsToRemove:o,policyDefinitions:h,tournamentRecord:l,event:a});if(C.error)return{...le,info:C.error}}return{...le}}function whe({autoPublish:t=!0,tournamentRecord:e,auditData:i,event:n,force:r}){var o;if(!e)return{error:je};if(!n)return{error:Fi};const{flightProfile:a}=Zn({event:n});if(a){const s=(o=a.flights)==null?void 0:o.map(({drawId:c})=>c).filter(Boolean),l=rx({eventId:n.eventId,tournamentRecord:e,autoPublish:t,auditData:i,drawIds:s,event:n,force:r});return l.error?l:sk({event:n,name:ql})}return{...le}}function uq(t){const{matchUpFormat:e,recoveryTimes:i,averageTimes:n,tournamentId:r,eventId:o}=t,a=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(a).length)return{error:Wn};const s=Object.keys(a).filter(c=>!r||r===c);if(r&&!s.includes(r))return{error:Re};let l;for(const c of s){const u=a[c],{event:d}=us({tournamentRecord:u,eventId:o});o&&d&&(l=!0);const p=ILe({tournamentRecord:u,event:d,matchUpFormat:e,averageTimes:n,recoveryTimes:i});if(p.error)return p}return!o||l?{...le}:{error:sl}}function ILe({tournamentRecord:t,recoveryTimes:e,matchUpFormat:i,averageTimes:n,event:r}){if(!t)return{error:je};if(n&&!Array.isArray(n))return{error:Re};if(e&&!Array.isArray(e))return{error:Re};const o=Ep;if(r){const{extension:a}=ei({element:r,name:o});Ii({element:r,extension:{name:o,value:ZY({...(a==null?void 0:a.value)||{},matchUpFormat:i,averageTimes:n,recoveryTimes:e})}})}else{const{extension:a}=ei({element:t,name:o});Ii({extension:{name:o,value:ZY({...(a==null?void 0:a.value)||{},matchUpFormat:i,averageTimes:n,recoveryTimes:e})},element:t})}return{...le}}function ZY(t){const{matchUpRecoveryTimes:e=[],matchUpAverageTimes:i=[],matchUpFormat:n}=t;let{averageTimes:r,recoveryTimes:o}=t;r=(r||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});const a=(r==null?void 0:r.length)&&i.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l})=>l==null?void 0:l.length).concat({matchUpFormatCodes:[n],averageTimes:r});o=(o||[]).filter(l=>{var c,u;return((c=l==null?void 0:l.categoryNames)==null?void 0:c.length)||((u=l==null?void 0:l.categoryTypes)==null?void 0:u.length)});const s=(o==null?void 0:o.length)&&e.map(l=>{var c;return l!=null&&l.matchUpFormatCodes.includes(n)?{...l,matchUpFormatCodes:(c=l.matchUpFormatCodes)==null?void 0:c.filter(u=>u!==n)}:l}).filter(({matchUpFormatCodes:l,averageTimes:c})=>(l==null?void 0:l.length)||c).concat({matchUpFormatCodes:[n],recoveryTimes:o});return{matchUpAverageTimes:(a==null?void 0:a.length)&&a||i,matchUpRecoveryTimes:(s==null?void 0:s.length)&&s||e}}function She(t){const{tournamentRecord:e,recoveryMinutes:i,averageMinutes:n,matchUpFormat:r,categoryType:o,eventId:a,event:s}=t;if(!e)return{error:je};if(!Rs({matchUpFormat:r}))return{error:Re};if(!s)return{error:Fi};const{averageTimes:l=[],recoveryTimes:c=[]}=Jk({tournamentRecord:e,matchUpFormat:r,event:s}),u=s.category,d=(u==null?void 0:u.categoryName)||(u==null?void 0:u.ageCategoryCode)||(s==null?void 0:s.eventId);let p={categoryNames:[d],minutes:{}};const h={categoryNames:[d],minutes:{}},f=b=>{var I,T;if((I=b.categoryTypes)!=null&&I.includes(o)&&console.log("encountered:",{categoryType:o}),!((T=b.categoryNames)!=null&&T.includes(d))||(b.categoryNames=b.categoryNames.filter(S=>S!==d),p={minutes:b.minutes,categoryNames:[d]},b.categoryNames.length))return b},m=n&&!isNaN(Ct(n)),g=i&&!isNaN(Ct(i)),v=l.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length}),y=c.map(f).filter(b=>{var I;return(I=b==null?void 0:b.categoryNames)==null?void 0:I.length});return m&&(Object.assign(p.minutes,{[(s==null?void 0:s.eventType)||vr]:n}),v.push(p)),g&&(Object.assign(h.minutes,{[(s==null?void 0:s.eventType)||vr]:i}),y.push(h)),m||g?uq({averageTimes:m&&v,recoveryTimes:g&&y,tournamentRecord:e,matchUpFormat:r,eventId:a,event:s}):{error:Re}}function ox(t){if(t.event)return XY({event:t.event});{t.tournamentRecord&&!t.tournamentRecords&&(t.tournamentRecords={[t.tournamentRecord.tournamentId]:t.tournamentRecord});const e=Ln(t,[{[Oo]:!0,[Fce]:!0}]);if(e.error)return e;const{tournamentRecords:i,eventId:n}=t;for(const r of Object.values(i??{})){const{event:o}=us({tournamentRecord:r,eventId:n});if(o)return XY({event:o})}}return{error:sl}}function XY({event:t}){return sk({event:t,name:Ep})}function dq({tournamentRecord:t,event:e,startDate:i}){if(!t)return{error:je};if(!e)return{error:Fi};if(!Mu.test(i))return{error:Ha};const n=Uhe(t);if(n.error)return n;const{tournamentStartDate:r,tournamentEndDate:o}=n,a=new Date(zt(i)).getTime();if(!r||!o||a<r||a>o)return{error:Ha};const s=e.endDate&&new Date(zt(e.endDate)).getTime();return s&&a>s&&(e.endDate=i),e.startDate=i,{...le}}function pq({tournamentRecord:t,event:e,endDate:i}){if(!t)return{error:je};if(!e)return{error:Fi};if(!Mu.test(i))return{error:Ha};const n=Uhe(t);if(n.error)return n;const{tournamentStartDate:r,tournamentEndDate:o}=n,a=new Date(zt(i)).getTime();if(!r||!o||a<r||a>o)return{error:Ha};const s=e.startDate&&new Date(zt(e.startDate)).getTime();return s&&a<s&&(e.startDate=i),e.endDate=i,{...le}}function The({tournamentRecord:t,event:e,startDate:i,endDate:n}){if(!t)return{error:je};if(!e)return{error:Fi};if(!i&&!n)return{error:bt,info:"missing date"};if(i&&!Mu.test(i))return{error:Ha};if(n&&!Mu.test(n))return{error:Ha};if(i&&n&&new Date(zt(i)).getTime()>new Date(zt(n)).getTime())return{error:Re};if(i){const r=dq({tournamentRecord:t,event:e,startDate:i});if(r.error)return r}if(n){const r=pq({tournamentRecord:t,event:e,endDate:n});if(r.error)return r}return{...le}}function Uhe(t){const{startDate:e,endDate:i}=t;return Mu.test(e)&&Mu.test(i)?{tournamentStartDate:new Date(zt(e)).getTime(),tournamentEndDate:new Date(zt(i)).getTime()}:ce({result:{error:y_e},context:{startDate:e,endDate:i}})}function hq({event:t,orderedDrawIdsMap:e}){var i,n;if(typeof t!="object")return{error:Fi};if(!e)return{error:bt,info:"Missing drawIdsOrderMap"};if(typeof e!="object")return{error:Re,info:"orderedDrawIdsMap must be an object"};const r=Object.values(e);if(!r.every(a=>!isNaN(a)))return{error:Re,info:"drawOrder must be numeric"};if(ti(r).length!==r.length)return{error:Re,info:"drawOrder values must be unique"};if((i=t.drawDefinitions)!=null&&i.length){const a=(t.drawDefinitions||[]).map(({drawId:l})=>l),s=Object.keys(e);if(s!=null&&s.length&&sr(a,s).length!==a.length)return{error:Re,info:"Missing drawIds"};t.drawDefinitions.forEach(l=>{l.drawOrder=e[l.drawId]})}const{flightProfile:o}=Zn({event:t});return(n=o==null?void 0:o.flights)==null||n.forEach(a=>{a.flightNumber=e[a.drawId]}),{...le}}function fq({tournamentRecord:t,event:e}){var i;if(!t)return{error:je};if(!e)return{error:Fi};const{flightProfile:n}=Zn({event:e}),r=(n==null?void 0:n.flights)&&Object.assign({},...n.flights.sort((o,a)=>o.flightNumber-a.flightNumber).map((o,a)=>({[o.drawId]:a+1})))||((i=e.drawDefinitions)==null?void 0:i.length)&&Object.assign({},...e.drawDefinitions.sort((o,a)=>o.drawOrder-a.drawOrder).map((o,a)=>({[o.drawId]:a+1})))||void 0;return r?hq({event:e,orderedDrawIdsMap:r}):{...le}}function Dhe({autoPublish:t=!0,tournamentRecord:e,auditData:i,drawId:n,event:r,force:o}){var a,s;if(!e)return{error:je};if(!n)return{error:Yc};if(!r)return{error:Fi};const{flightProfile:l}=Zn({event:r});if(l&&((a=l.flights)!=null&&a.find(c=>c.drawId===n))){const c=l.flights.filter(u=>u.drawId!==n);kf({event:r,extension:{name:ql,value:{...l,flights:c}}})}if((s=r.drawDefinitions)!=null&&s.find(c=>c.drawId===n)){const c=rx({drawIds:[n],eventId:r.eventId,tournamentRecord:e,autoPublish:t,auditData:i,event:r,force:o});if(c.error)return c}return fq({tournamentRecord:e,event:r})}function Phe({replacementIndividualParticipantId:t,existingIndividualParticipantId:e,tournamentRecord:i,drawDefinition:n,participantId:r,event:o,uuids:a}){var s,l;if(!o)return{error:Fi};if((o==null?void 0:o.eventType)!==Bc)return{error:Lm};if(a&&!Array.isArray(a))return{error:Re};if(!i)return{error:je};if(![t,e,r].every(g=>typeof g=="string"))return{error:Hr};if(!(((s=o==null?void 0:o.entries)==null?void 0:s.filter(({entryStatus:g})=>[Fc,ty].includes(g)).map(({participantId:g})=>g))||[]).includes(t))return{error:Dd};const c=(i.participants||[]).find(g=>g.participantId===r);if((c==null?void 0:c.participantType)!==qt)return{error:LP,participant:c};const u=c.individualParticipantIds,d=[t,...u.filter(g=>g!==e)],{participant:p}=Kl({participantIds:d,tournamentRecord:i});let h;if(p)h=p.participantId;else{const g=Au({participant:{participantId:a==null?void 0:a.pop(),participantRole:Ro,individualParticipantIds:d,participantType:qt},returnParticipant:!0,tournamentRecord:i});if(g.error)return g;h=g.participant.participantId}const{flightProfile:f}=Zn({event:o});if(n){const g=(l=f==null?void 0:f.flights)==null?void 0:l.find(({drawId:v})=>v===n.drawId);g&&(g.drawEntries=g.drawEntries.map(v=>v.participantId===r?{...v,participantId:h}:v)),n.entries=n.entries.map(v=>v.participantId===r?{...v,participantId:h}:v);for(const v of n.structures||[])if(v.positionAssignments)v.positionAssignments=v.positionAssignments.map(y=>y.participantId===r?{...y,participantId:h}:y);else if(v.structures)for(const y of v.structures)y.positionAssignments=y.positionAssignments.map(b=>b.participantId===r?{...b,participantId:h}:b)}o.entries=o.entries.map(g=>g.participantId===r&&{...g,participantId:h}||g.participantId===t&&{...g,participantId:e}||g);const m=i.events.some(({entries:g,eventId:v,drawDefinitions:y})=>o.eventId===v?y.some(({drawId:b,entries:I})=>b!==(n==null?void 0:n.drawId)&&(I==null?void 0:I.find(T=>T.participantId===r))):g==null?void 0:g.find(b=>b.participantId===r));if(!m){const g=sb({addIndividualParticipantsToEvents:!1,participantIds:[r],tournamentRecord:i});if(g.error)return g}return{...le,participantOtherEntries:m,newPairParticipantId:h}}function ax(t){var e,i,n,r,o,a,s,l,c,u,d;const{flight:p,suppressNotifications:h,modifyEventEntries:f,existingDrawCount:m,allowReplacement:g,checkEntryStatus:v,tournamentRecord:y,drawDefinition:b,event:I}=t;if(!b)return{error:rt};if(!I)return{error:Fi};I.drawDefinitions||(I.drawDefinitions=[]);const{drawId:T,drawName:S,entries:w}=b,{entries:U}=I;let D=0;if(m!==void 0&&m!==I.drawDefinitions.length)return{error:Re,info:"drawDefintions count mismatch"};const{flightProfile:E}=Zn({event:I}),C=p&&((e=E==null?void 0:E.flights)==null?void 0:e.find(H=>H.flightNumber===p.flightNumber)),M=(r=(n=(i=E==null?void 0:E.links)==null?void 0:i.find(H=>{var z;return((z=H==null?void 0:H.target)==null?void 0:z.drawId)===T}))==null?void 0:n.source)==null?void 0:r.drawId;if(M&&!I.drawDefinitions.find(H=>H.drawId===M))return ce({result:{error:rt},info:{sourceDrawId:M}});if(C&&C.drawId!==b.drawId)return ce({result:{error:yI},info:{relevantFlight:C}});const N=w==null?void 0:w.every(({participantId:H,entryStatus:z})=>{const G=C==null?void 0:C.drawEntries.find(W=>W.participantId===H);return!z||(G==null?void 0:G.entryStatus)===z}),R=!v||U&&(w==null?void 0:w.every(({participantId:H,entryStatus:z,entryStage:G})=>{const W=U.find(K=>K.participantId===H&&(!K.entryStage||K.entryStage===G));return(W==null?void 0:W.entryStatus)===z}));if(C&&!N)return ce({result:{error:yI},context:{drawEntriesPresentInFlight:N,matchingEventEntries:R,relevantFlight:C},info:"Draw entries are not present in flight or do not match entryStatuses"});if(f&&(w==null||w.filter(Boolean).forEach(H=>{if(H!=null&&H.entryStatus&&Zc.includes(H==null?void 0:H.entryStatus)){const z=U==null?void 0:U.filter(Boolean).find(G=>G.participantId===H.participantId);z&&H.entryStatus&&(z==null?void 0:z.entryStatus)!==H.entryStatus&&(z.entryStatus=H.entryStatus,D+=1)}})),U&&!R)return ce({result:{info:"Draw entries do not match event entryStatuses",context:{matchingEventEntries:R,eventEntries:U},error:yI}});const A=((a=(o=E==null?void 0:E.flights)==null?void 0:o.map(({flightNumber:H})=>!isNaN(H)&&Ct(H)))==null?void 0:a.filter(Boolean))||[],_=((s=I.drawDefinitions.map(({drawOrder:H})=>H&&Ct(H)))==null?void 0:s.filter(Boolean))||[];let k=Math.max(0,..._,...A)+1;const O=(l=E==null?void 0:E.flights)==null?void 0:l.find(H=>H.drawId===T);let F;if(O){O.drawName=b.drawName,F={name:ql,value:{...E,flights:E.flights}};const H=O.flightNumber;H&&!_.includes(H)?k=H:O.flightNumber=k}else{const H=(E==null?void 0:E.flights)||[];H.push({manuallyAdded:!0,flightNumber:k,drawEntries:w,drawName:S,drawId:T}),F={name:ql,value:{...E||{},flights:H}}}kf({event:I,extension:F}),Object.assign(b,{drawOrder:k});const B=I.drawDefinitions.find(H=>H.drawId===T),$=y==null?void 0:y.tournamentId,V=I.eventId;if(B){if(!g)return{error:XAe};const H=(c=Fa({drawDefinition:B}))==null?void 0:c.matchUps,z=(H==null?void 0:H.map($r))??[],G=(u=Fa({drawDefinition:b}))==null?void 0:u.matchUps;if(!h){z!=null&&z.length&&Kp({matchUpIds:z,action:"modifyDrawDefinition",tournamentId:$,eventId:V}),G!=null&&G.length&&rf({matchUps:G,tournamentId:$,eventId:V}),I.drawDefinitions=I.drawDefinitions.map(K=>K.drawId===T?b:K);const W=(d=b.structures)==null?void 0:d.map(({structureId:K})=>K);un({drawDefinition:b,tournamentId:$,structureIds:W,eventId:V})}}else if(I.drawDefinitions.push(b),!h){const{matchUps:H}=Fa({drawDefinition:b,event:I});H&&rf({tournamentId:y==null?void 0:y.tournamentId,matchUps:H}),qP({drawDefinition:b,tournamentId:$,eventId:V})}return{...le,modifiedEventEntryStatusCount:D}}function Che(t){const{provisionalPositioning:e,useExistingSeedLimit:i,tournamentRecord:n,drawDefinition:r,seedingProfile:o,structureId:a,assignments:s,drawId:l,event:c}=t;let u=0;if(!(s!=null&&s.length))return{error:ece};if(!n)return{error:je};if(!l)return{error:Yc};const d=ul({provisionalPositioning:e,drawDefinition:r,structureId:a});if(d.error)return d;const{seedAssignments:p,seedLimit:h}=d,f=Object.assign({},...(p??[]).filter(v=>v.seedNumber).map(v=>({[v.seedNumber]:v})));s.forEach(v=>{const{seedNumber:y}=v;h&&y<=h&&(!i||f[y])&&(f[y]=v)});const m=Object.values(f),g=m.map(v=>v==null?void 0:v.participantId).filter(Boolean);if(g.length!==zle(g).length)return{error:JAe};for(const v of m){const y=vw({...v,provisionalPositioning:e,tournamentRecord:n,drawDefinition:r,seedingProfile:o,structureId:a,event:c});if(y!=null&&y.error)return y;y!=null&&y.success&&u++}return u?{...le,modifications:u}:{error:BP}}function mq({deleteExisting:t,event:e,flightProfile:i}){var n;const r="attachFlightProfile";if(!i)return ce({result:{error:bt},stack:r});if(!e)return ce({result:{error:Fi},stack:r});const{flightProfile:o}=Zn({event:e});return o&&!t?ce({result:{error:Ice},stack:r}):(n=e.drawDefinitions)!=null&&n.length?ce({result:{error:YAe},stack:r}):(kf({event:e,extension:{name:ql,value:i}}),{flightProfile:ft(i,!1,!0),...le})}function gq({tournamentRecord:t,scaleAttributes:e,drawDefinition:i,entryStatuses:n,drawId:r,event:o,stage:a}){var s;if(!o)return{error:Fi};if(n&&!Array.isArray(n))return ce({result:{error:Re},info:_d("entryStatus"),stack:"removeScaleValues"});let l=o.entries;if(r){const{flightProfile:c}=Zn({event:o}),u=(s=c==null?void 0:c.flights)==null?void 0:s.find(d=>d.drawId===r);l=u?u.drawEntries:i==null?void 0:i.entries}return function({tournamentRecord:c,scaleAttributes:u,participantIds:d}){var p;if(!c)return{error:je};if(!d)return{error:Ig};if(!u)return{error:bt,info:"scaleAttributes required"};const{scaleType:h,eventType:f,scaleName:m}=u,g=[Yke,h,f,m].join(".");return(p=c.participants)==null||p.forEach(v=>{d.includes(v.participantId)&&v.timeItems&&(v.timeItems=v.timeItems.filter(y=>y&&(y==null?void 0:y.itemType)!==g))}),{...le}}({tournamentRecord:t,scaleAttributes:e,participantIds:(l||[]).filter(c=>(!a||!c.entryStage||c.entryStage===a)&&(!n||n.includes(c.entryStatus))).map(li)})}function sx({removePriorValues:t,tournamentRecord:e,displaySettings:i,status:n=ju,event:r}){if(!e)return ce({result:{error:je}});if(!r)return ce({result:{error:Fi}});if(!bn(i))return ce({result:{error:bt}});if(bn(i.draws))for(const a of Object.keys(i.draws)){const s=i.draws[a].scheduleDetails??[];if(s.length){const l=[];for(const c of s){const u=l.find(d=>pke(d.attributes,c.attributes));u!=null&&u.dates&&c.dates?u.dates.push(...c.dates):l.push(c)}i.draws[a].scheduleDetails=l}}const o=q0({statusObject:{displaySettings:i},removePriorValues:t,status:n,event:r});return o.error?o:{...le}}function Ehe({tournamentRecord:t,drawDefinition:e,entryStatuses:i,scaleName:n,drawId:r,event:o,stage:a}){var s,l;return t?o?(n=n||((s=o.category)==null?void 0:s.categoryName)||((l=o.category)==null?void 0:l.ageCategoryCode),gq({tournamentRecord:t,scaleAttributes:{eventType:o.eventType,scaleType:ap,scaleName:n},drawDefinition:e,entryStatuses:i,drawId:r,event:o,stage:a})):{error:Fi}:{error:je}}function Mhe({removePairParticipants:t,tournamentRecord:e,eventIds:i}){if(!e)return{error:je};if(!e.events)return{error:sl};if(!Array.isArray(i))return{error:bt,info:_d("drawIds")};const n=[],r=[],o=[],a=[];if(e.events=(e.events||[]).filter(s=>{if(i.includes(s.eventId)){const u={action:KY,payload:{events:[s]}};n.push(u),r.push({tournamentId:e.tournamentId,eventName:s.eventName,eventType:s.eventType,category:s.category,eventId:s.eventId,gender:s.gender})}const l=s.eventType===Bc?(s.entries||[]).map(({entryStatus:u,participantId:d})=>u!==Fc&&d).filter(Boolean):[],c=i.includes(s.eventId);return c?a.push(...l):o.push(...l),!c}),t){const s=a.filter(l=>!o.includes(l));e.participants=e.participants.filter(({participantId:l})=>!s.includes(l))}return UC({tournamentRecord:e}),n.length&&(bi({topic:SU,payload:n}),ub({tournamentRecord:e,timeItem:{itemType:KY,itemValue:r}})),{...le}}function Rhe({tournamentRecord:t,eventUpdates:e,eventId:i,event:n}){var r;const o="modifyEvent";if(!t)return ce({result:{error:je},stack:o});if(!La(i))return ce({result:{error:Fi},context:{eventId:i},stack:o});if(!bn(e))return ce({result:{error:Re},context:{eventUpdates:e},stack:o});const a=((r=n==null?void 0:n.entries)==null?void 0:r.filter(({entryStatus:h})=>{const f=h;return[...Zc,Nc].includes(f)}).map(({participantId:h})=>h))??[],s=a?Qn({participantFilters:{participantIds:a},withIndividualParticipants:!0,tournamentRecord:t}).participants??[]:[],l=[],c=s.reduce((h,f)=>{var m,g;const v=(m=f.person)!=null&&m.sex?[f.person.sex]:((g=f.individualParticpants)==null?void 0:g.map(y=>{var b;return(b=y.person)==null?void 0:b.sex}))||[];return l.push(...v),h.includes(f.participantType)?h:h.concat(f.participantType)},[]),u=ti(l),d=!u.length||[is,Ru].includes(e.gender??"")||u.length===1&&u[0]===e.gender;if(e.gender&&!d)return ce({context:{gender:e.gender,validGender:d},result:{error:Re},stack:o});const p=(c.includes(Yr)&&[Yr]||c.includes(ui)&&[Np]||c.includes(qt)&&[Bc]||[Bc,Np,Yr]).includes(e.eventType??"");return e.eventType&&!p?ce({context:{participantType:e.eventType,validEventType:p},result:{error:Re},stack:o}):(e.eventType&&(n.eventType=e.eventType),e.eventName&&(n.eventName=e.eventName),e.gender&&(n.gender=e.gender),{...le})}function lx({qualifyingPositions:t,drawEntries:e=[],drawName:i,drawId:n,event:r,stage:o}){var a,s,l;const c="addFlight";if(!r)return ce({result:{error:Fi},stack:c});if(!i)return ce({result:{error:bt},stack:c});if(e!=null&&e.length){const m=(r.entries??[]).map(li),g=e.map(li);if(sr(g,m).length!==g.length)return ce({result:{error:Re},stack:c})}const u=(a=Zn({event:r}))==null?void 0:a.flightProfile,d=((l=(s=u==null?void 0:u.flights)==null?void 0:s.map(({flightNumber:m})=>!isNaN(m)&&Ct(m)))==null?void 0:l.filter(Boolean))||[],p=Math.max(0,...d)+1,h={drawId:n||Hi(),flightNumber:p,drawEntries:e,drawName:i};if(o&&(h.stage=o),t&&(h.qualifyingPositions=t),((u==null?void 0:u.flights)||[]).find(({drawId:m})=>m===h.drawId))return ce({result:{error:K_e},stack:c});const f=((u==null?void 0:u.flights)||[]).concat(h);return kf({event:r,extension:{name:ql,value:{...u||{},flights:f}}})}const Nhe={COLLEGE_D3:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7@7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_D3",winCriteria:{valueGoal:5}},COLLEGE_DEFAULT:{collectionDefinitions:[{collectionName:"Doubles",collectionValue:1,matchUpCount:3,matchUpFormat:"SET1-S:6/TB7",matchUpType:"DOUBLES"},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_DEFAULT",winCriteria:{valueGoal:5}},COLLEGE_JUCO:{collectionDefinitions:[{collectionName:"Doubles",matchUpCount:3,matchUpFormat:"SET1-S:8/TB7",matchUpType:"DOUBLES",matchUpValue:1},{collectionName:"Singles",matchUpCount:6,matchUpFormat:"SET3-S:6/TB7",matchUpType:"SINGLES",matchUpValue:1}],tieFormatName:"COLLEGE_JUCO",winCriteria:{valueGoal:5}},DOMINANT_DUO:lhe,DOMINANT_DUO_MIXED:rhe,LAVER_CUP:hhe,TEAM_DOUBLES_3_AGGREGATION:Qpe,TIME_TENNIS_DUAL:ohe,TIME_TENNIS_PRO_CIRCUIT:nhe,USTA_BREWER_CUP:ahe,USTA_OZAKI_CUP:she,USTA_COLLEGE:che,USTA_GOLD_TEAM_CHALLENGE:Jpe,USTA_INTERSECTIONAL:ihe,USTA_LEVEL_1:uhe,USTA_SECTION_BATTLE:the,USTA_SOUTHERN_LEVEL_5:ehe,USTA_TOC:fhe,USTA_WTT_ITT:dhe,USTA_ZONAL:phe};function MC({suppressNotifications:t,tournamentRecord:e,internalUse:i,event:n}){var r,o,a,s;if(!e)return{error:je};if(e.events||(e.events=[]),!n)return{error:Fi};const{startDate:l,endDate:c}=e;if(!i&&((r=n.entries)!=null&&r.length||(o=n.drawDefinitions)!=null&&o.length)){const d=It({drawDefinitions:!!((a=n.drawDefinitions)!=null&&a.length),entries:!!((s=n.entries)!=null&&s.length)});return{info:"entries/drawDefinitions cannot exist",error:Re,context:d}}const u={eventType:fw,drawDefinitions:[],entries:[],startDate:l,endDate:c,...n};if(n.eventType===$c){if(n.tieFormat){const d=ds({tieFormat:n.tieFormat});if(d.error)return d}else if(n.tieFormatName){if(!Nhe[n.tieFormatName])return{context:{tieFormatName:n.tieFormatName},error:Re};const d=oy({isMock:e==null?void 0:e.isMock,namedFormat:n.tieFormatName,event:n});u.tieFormat=d}}if(u.eventId||(u.eventId=Hi()),e.events.reduce((d,p)=>d||p.eventId===u.eventId,void 0))return{error:s_e};{const d=u;if(e.events.push(d),!t){const{topics:p}=Bu();if(p.includes(DW)){const h=Qp({event:n}).matchUps??[];rf({tournamentId:e==null?void 0:e.tournamentId,eventId:n.eventId,matchUps:h})}for(const h of n.drawDefinitions||[])qP({drawDefinition:h})}return{...le,event:u}}}var wLe=Object.freeze({__proto__:null,addDrawDefinition:ax,addEvent:MC,addFlight:lx,assignSeedPositions:Che,attachFlightProfile:mq,deleteDrawDefinitions:rx,deleteEvents:Mhe,deleteFlightAndFlightDraw:Dhe,deleteFlightProfileAndFlightDraws:whe,modifyEvent:Rhe,modifyEventMatchUpFormatTiming:She,modifyPairAssignment:Phe,refreshEventDrawOrder:fq,removeEventMatchUpFormatTiming:ox,removeScaleValues:gq,removeSeeding:Ehe,setEventDates:The,setEventDisplay:sx,setEventEndDate:pq,setEventStartDate:dq,updateDrawIdsOrder:hq,validateCategory:xR}),SLe=Object.freeze({__proto__:null,addDrawDefinition:ax,addEvent:MC,addFlight:lx,assignSeedPositions:Che,attachFlightProfile:mq,bulkUpdatePublishedEventIds:EC,categoryCanContain:$k,deleteDrawDefinitions:rx,deleteEvents:Mhe,deleteFlightAndFlightDraw:Dhe,deleteFlightProfileAndFlightDraws:whe,getCategoryAgeDetails:gC,getEvent:tq,getEventProperties:Q3,getEventStructures:xk,getEventTimeItem:nC,getEvents:eq,getFlightProfile:Zn,getScaledEntries:ry,modifyEvent:Rhe,modifyEventMatchUpFormatTiming:She,modifyPairAssignment:Phe,mutate:wLe,query:SOe,refreshEventDrawOrder:fq,removeEventMatchUpFormatTiming:ox,removeScaleValues:gq,removeSeeding:Ehe,setEventDates:The,setEventDisplay:sx,setEventEndDate:pq,setEventStartDate:dq,updateDrawIdsOrder:hq,validateCategory:xR});const TLe="splitWaterfall",ULe="splitShuttle",DLe="ASC",JY="DESC";function Ahe(t){var e,i,n,r,o;let{tieFormat:a}=t;const{useDefaultEventRanking:s,tournamentRecord:l,drawDefinition:c,scaleAccessor:u,singlesOnly:d,attach:p,event:h}=t;if((h==null?void 0:h.eventType)!==$c)return{error:Lm};if(!l)return{error:je};if(!a&&!c)return{error:ml};if(a=a??((e=jo({drawDefinition:c,event:h}))==null?void 0:e.tieFormat),ds({tieFormat:a}).error)return{error:Ph};if(typeof u!="object"&&!s)return{error:Re,context:{scaleAccessor:u}};const f={},m=((c==null?void 0:c.entries)??(h==null?void 0:h.entries)??[]).filter(A=>(A==null?void 0:A.entryStatus)===cl).map(li),{participants:g=[]}=Qn({withIndividualParticipants:!0,withScaleValues:!0,tournamentRecord:l}),v=g.filter(({participantId:A})=>m.includes(A)),y=((i=h==null?void 0:h.category)==null?void 0:i.categoryName)??((n=h==null?void 0:h.category)==null?void 0:n.ageCategoryCode),{scaleName:b=y,scaleType:I=Vm,sortOrder:T,accessor:S}=u||{},w=I===Vm?"rankings":"ratings",U=(A,_)=>{var k,O,F;let B=(k=A[w])==null?void 0:k[_];if(!B&&s&&(B=(O=A[w])==null?void 0:O[wI]),Array.isArray(B)){const $=(F=B.find(V=>V.scaleName===b))==null?void 0:F.scaleValue;if(ir($))return $;if(S&&typeof $=="object")return $[S]}return 0},D=(A,_,k)=>{const O=T===JY?A:_;return U(T===JY?_:A,k)-U(O,k)},E=(A,_)=>D(A,_,wI),C=(A,_)=>D(A,_,ey),M=[],N=(a==null?void 0:a.collectionDefinitions)??[];for(const A of v){const _=((r=A.individualParticipants)==null?void 0:r.sort(E))??[],k=d?_:((o=A.individualParticipants)==null?void 0:o.sort(C))??[],O={};for(const B of N){const $=[],{collectionId:V,matchUpCount:H,matchUpType:z,gender:G}=B,W=z===wI;nt(0,H).forEach(K=>{const Z=W?_:k??[],Y=K+1,X=[];nt(0,W?1:2).forEach(Q=>{var te;const J=(te=Z==null?void 0:Z.find(ie=>{var oe;const ne=G&&([rn,Dn].includes(G)&&G||G===is&&[rn,Dn][Q]);return!(ne&&ne!==((oe=ie.person)==null?void 0:oe.sex)||$.includes(ie.participantId))}))==null?void 0:te.participantId;J&&(X.push(J),$.push(J),O[J]||(O[J]=[]),O[J].push({collectionPosition:Y,collectionId:V}))}),W||M.push(X)})}const F=Object.keys(O).map(B=>({collectionAssignments:O[B],participantId:B}));f[A.participantId]=F}const R=[];for(const A of M){const{participant:_}=Kl({tournamentParticipants:g,participantIds:A});if(!_){const k={individualParticipantIds:A,participantRole:Ro,participantType:qt};R.push(k)}}if(p){for(;R.length;)Au({participant:R.pop(),tournamentRecord:l});Ii({element:c,extension:{name:Cp,value:f}})}return{...le,lineUps:f,participantsToAdd:R}}function vq(t){if(!t)return{error:bt};const e=Ln(t,[{dates:!1,[Ch]:a=>Array.isArray(a)&&a.every(Ss)},{uuids:!1,[Ch]:a=>Array.isArray(a)&&a.every(La)},{startTime:!1,endTime:!1,[Ch]:aW},{idPrefix:!1,namePrefix:!1,[Ch]:La},{count:!0,[Ch]:ir}]);if(e.error)return e;const{startDate:i,endDate:n}=t.tournamentRecord??{},r=t.dates||i&&n&&ik(i,n)||[],o=nt(1,t.count+1).map(a=>{var s,l;return It({courtId:((s=t.uuids)==null?void 0:s.pop())??(t.idPrefix&&`${t.idPrefix}-${a}`)??Hi(),courtName:((l=t.courtNames)==null?void 0:l.pop())??(t.namePrefix&&`${t.namePrefix} ${a}`),dateAvailability:r.map(c=>({startTime:t.startTime??"08:00",endTime:t.endTime??"20:00",date:c}))})});return{...le,courts:o}}function RC({court:t,date:e}){const i=e&&t.dateAvailability.find(r=>Pd(r.date,e)),n=t.dateAvailability.find(r=>!r.date);return i||n}function K0(t){const e=Ln(t,[{courtDate:!0,_ofType:zd}]);if(e.error)return e;const{includeBookingTypes:i=[],courtDate:n}=t,r=[];let o=hr(n.startTime);(n.bookings||[]).filter(s=>!s.bookingType||!i.includes(s.bookingType)).sort((s,l)=>mR(s.startTime).localeCompare(mR(l.startTime))).forEach(s=>{const l={startTime:mn(o.toISOString()),endTime:s.startTime};hr(s.startTime)>o&&r.push(l),hr(s.endTime)>o&&(o=hr(s.endTime))});const a={startTime:mn(o.toISOString()),endTime:n.endTime};return hr(n.endTime)>o&&r.push(a),{timeSlots:r}}function _he(t){const e=Ln(t,[{periodStart:!0,date:!0},{courts:!0,_ofType:El}]);if(e.error)return e;const{averageMatchUpMinutes:i,includeBookingTypes:n,periodStart:r,date:o}=t,a=t.courts,s=hr(r),l=sW(s,i),{enoughTime:c}=function({averageMatchUpMinutes:u,includeBookingTypes:d,periodStartTime:p,periodEndTime:h}){function f(m){const g=hr(m.startTime),v=hr(m.endTime);return!(g>p)&&!(v<h)&&$P(p,v)>=u}return{enoughTime:m=>{const{timeSlots:g}=K0({includeBookingTypes:d,courtDate:m}),v=g==null?void 0:g.filter(f);return!!(v!=null&&v.length)}}}({averageMatchUpMinutes:i,includeBookingTypes:n,periodStartTime:s,periodEndTime:l});return{availableToScheduleCount:((a==null?void 0:a.filter(u=>{if(!Array.isArray(u.dateAvailability))return!1;const d=RC({date:o,court:u});return!(!d||!c(d))}))||[]).length,...le}}function cx(t){const{remainingScheduleTimes:e=[],clearScheduleDates:i,periodLength:n=30,scheduleDate:r,courts:o=[]}=t;let{bookings:a=[]}=t;if(!Array.isArray(o)||!o.length)return{error:Re,courts:o};if(!Array.isArray(a))return{error:x2};if(!Ss(r))return{error:Ha};i&&(Array.isArray(i)?i.includes(r)&&(a=[]):a=[]);const{courtBookings:s,unassignedBookings:l}=a.reduce((d,p)=>{const{courtId:h}=p;return h?d.courtBookings[h]?d.courtBookings[h].push(p):d.courtBookings[h]=[p]:d.unassignedBookings.push(p),d},{courtBookings:{},unassignedBookings:[]}),c=o.map((d,p)=>{const{courtId:h,courtName:f}=d,m=s[h]||[],g=RC({date:r,court:d})||{},{bookings:v=[],startTime:y,endTime:b,date:I}=g;return{courtId:h,courtName:f,dateAvailability:{bookings:[e[p]&&{startTime:y,endTime:e[p]},...ft(v,!1,!0),...m].filter(Boolean),startTime:y,endTime:b,date:I}}});l.sort((d,p)=>gi(d.startTime)-gi(p.startTime));const u=[];for(const d of l){const{startTime:p,endTime:h,averageMinutes:f,recoveryMinutes:m,matchUpId:g}=d,v=gi(p),y=gi(h),b=c.map(I=>{const T=I.dateAvailability,{timeSlots:S=[]}=K0({courtDate:T});return{courtName:I.courtName,courtId:I.courtId,timeSlots:S}}).flat().reduce((I,{courtId:T,courtName:S,timeSlots:w})=>{let U;return w.find(({startTime:D,endTime:E})=>{U=gi(D)-v;const C=v>=gi(D);return y<=gi(E)&&I.startDifference!==0&&((U===0||U+n>=0)&&(I.startDifference===void 0||U<I.startDifference)||C)})?{courtName:S,courtId:T,startDifference:U}:I},{});if(b.courtId){const I={averageMinutes:f,recoveryMinutes:m,matchUpId:g,startTime:p,endTime:h};u.push(I);const T=c.find(({courtId:S})=>S===b.courtId);T==null||T.dateAvailability.bookings.push(I)}else console.log({unassignedBooking:d})}return{virtualCourts:c.map(({courtId:d,courtName:p,dateAvailability:h})=>({dateAvailability:[h],courtName:p,courtId:d})),assignedBookings:u}}function ux({averageMatchUpMinutes:t,periodLength:e=30,recoveryMinutes:i}){const n=(t||90)+(i||0);return e>n?n:e||30}function khe(t){const{startTime:e="8:00",endTime:i="20:30",count:n=10,date:r}=t??{};return nt(0,n).map(()=>({dateAvailability:[{date:r,startTime:e,endTime:i}]}))}function Iw({scheduleDate:t,startTime:e,endTime:i,courts:n}){const r=(e?"startTime":i&&"endTime")||void 0;return n.reduce((o,a)=>{const s=RC({date:t,court:a}),l=r&&((s==null?void 0:s[r])||a[r]);return l&&(!o||e&&gi(l)<gi(o)||i&&gi(l)>gi(o))?l:o},void 0)}function yq(t){const e=Ln(t,[{courts:!0,_ofType:El}]);if(e.error)return e;let{date:i=oW(),startTime:n="08:00",endTime:r="19:00",periodLength:o,courts:a}=t;const{calculateStartTimeFromCourts:s=!0,remainingScheduleTimes:l,averageMatchUpMinutes:c,clearScheduleDates:u,courtsCount:d,bookings:p}=t;o=o||ux({averageMatchUpMinutes:c}),i=zt(i),n=mn(n),r=mn(r);let h=0,f=0,m=0,g=0,v=0;!a&&d&&(a=khe({startTime:n,endTime:r,count:d,date:i}));const{virtualCourts:y}=cx({remainingScheduleTimes:l,clearScheduleDates:u,scheduleDate:i,periodLength:o,bookings:p,courts:a}),{firstTimeSlotStartTime:b}=function({averageMinutes:w,startTime:U,endTime:D,courts:E,date:C}){let M;if(U=U||Iw({courts:E,scheduleDate:C,startTime:!0}),D=D||Iw({courts:E,scheduleDate:C,endTime:!0}),U&&D){const N=hr(U),R=hr(D);for(const A of E||[]){if(!Array.isArray(A.dateAvailability))continue;const _=RC({court:A,date:C}),{timeSlots:k}=K0({courtDate:_});k==null||k.forEach(O=>{const F=hr(O.startTime),B=hr(O.endTime);if(F>R||F<N||B<N)return!1;if($P(F,B)>=w){const $=mn(F.toISOString());(!M||$<M)&&(M=$)}})}}return{firstTimeSlotStartTime:M}}({averageMinutes:c,courts:y,startTime:n,endTime:r,date:i});s&&b&&(n=b||n);const I=gi(n),T=gi(r)-I,S=nt(0,Math.floor(T/o)+1).map(w=>{const U=function(_){let k=Math.floor(_/60);const O=_-60*k;return k>23&&(k%=24),[Zs(k),Zs(O)].join(":")}(I+w*o),D=_he({courts:y||[],averageMatchUpMinutes:c,periodStart:U,date:i});if(D.error)return{error:D.error};const{availableToScheduleCount:E=0}=D,C=E>f?E-f:0;v+=w?E:0;const M=w?v/w:E,N=w?o*M/c*(w-1)+M:M,R=E?f&&N-h||C:0;h=N,f=E,m+=R;const A=Ct(m)-g;return g+=A,{periodStart:U,add:A,availableToScheduleCount:E,newCourts:C,totalMatchUps:g}});return{scheduleTimes:S.reduce((w,U)=>{const D=nt(0,U.add).map(()=>({scheduleTime:U.periodStart}));return w.concat(...D)},[]).flat(),timingProfile:S,totalMatchUps:g}}const QY={getCourtsAvailableAtPeriodStart:_he,generateTimeSlots:K0,getScheduleTimes:yq,courtGenerator:khe};var PLe=Object.freeze({__proto__:null,default:QY,garman:QY}),CLe=Object.freeze({__proto__:null,drawMatic:nq,garman:PLe,generateAdHocMatchUps:Wk,generateAdHocRounds:iq,generateAndPopulatePlayoffStructures:f3,generateCourts:vq,generateDrawDefinition:nx,generateDrawMaticRound:D3,generateDrawStructuresAndLinks:T3,generateDrawTypeAndModifyDrawDefinition:U3,generateFlightProfile:function(t){const{drawNameRoot:e="Flight",attachFlightProfile:i,tournamentRecord:n,scaleAttributes:r,scaleSortMethod:o,deleteExisting:a,sortDescending:s,drawNames:l=[],flightsCount:c,splitMethod:u,uuids:d=[],event:p,stage:h}=t;if(!p)return{error:Fi};const f=p.entries??[],{flightProfile:m}=Zn({event:p});if(m&&i&&!a)return{error:Ice};const g=t.scaledEntries??ry({tournamentRecord:n,scaleAttributes:r,scaleSortMethod:o,sortDescending:s,event:p,stage:h}).scaledEntries,v=g.map(li),y=Qo(f.filter(({participantId:U})=>!v.includes(U)).filter(U=>(!h||!U.entryStage||U.entryStage===h)&&(!U.entryStatus||Jy.includes(U.entryStatus)))),b=g.concat(...y),I=b.length;let T=Kr(b,Math.ceil(I/c));u===TLe?T=k2(b,c):u===ULe&&(T=k2(b,c,!0));const S=nt(0,c).map(U=>{const D=U+1;return{flightNumber:D,drawId:(d==null?void 0:d.pop())??Hi(),drawEntries:(E=T[U],(E||[]).map(({participantId:C,scaleValue:M})=>{const N=f.find(R=>R.participantId===C);return N!=null&&N.scaleValue&&M&&(N.scaleValue=M),N}).sort((C,M)=>C.scaleValue-M.scaleValue).map((C,M)=>(C.scaleValue&&(C.seedNumber=M+1),C))),drawName:(l==null?void 0:l.length)&&l[U]||`${e} ${D}`};var E}),w={scaleAttributes:r,splitMethod:u,flights:S};if(i){const U=mq({flightProfile:w,deleteExisting:a,event:p});return{splitEntries:Wl()&&T||void 0,...U}}return{flightProfile:w,...le}},generateLineUps:Ahe,generateQualifyingStructure:a3,generateSeedingScaleItems:ipe,generateVoluntaryConsolation:gpe,roundRobinGroups:hxe}),ELe=Object.freeze({__proto__:null,isValid:Rs,isValidMatchUpFormat:Rs,parse:Ga,stringify:p3});function xhe({tournamentRecord:t,drawDefinition:e,participantId:i,sideNumber:n,matchUpId:r,event:o}){var a,s;if(i&&typeof i!="string")return{error:Dd};if(!e)return{error:rt};if(!r)return{error:co};const l=n===void 0;if(l&&(n=1),![1,2].includes(n))return ce({result:{error:Re,context:{sideNumber:n}}});const{matchUp:c,structure:u}=vn({drawDefinition:e,matchUpId:r,event:o});if(!c)return{error:xo};if(u!=null&&u.structures||e.drawType&&e.drawType!==ll||(a=u==null?void 0:u.matchUps)!=null&&a.find(({roundPosition:d})=>!!d))return{error:Wz};if(!i&&((s=c==null?void 0:c.score)!=null&&s.scoreStringSide1||no.includes(c==null?void 0:c.matchUpstatus)||c!=null&&c.matchUpStatus&&[gr,Mr].includes(c.matchUpStatus)))return{error:Zz,info:"matchUp has completed status or score"};if(c){if(c.sides=[1,2].map(d=>{var p;const h=((p=c.sides)==null?void 0:p.find(f=>f.sideNumber===d))??{sideNumber:d};return n===d?{...h,participantId:i}:h}),l)for(const d of c.sides)d.sideNumber&&(d.sideNumber=3-d.sideNumber);Ci({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:c})}return{...le,sidesSwapped:l}}function Ns({removePriorValues:t,tournamentRecord:e,duplicateValues:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:a,event:s}){const{matchUp:l}=vn({drawDefinition:n,event:s,matchUpId:o});if(!l)return{error:xo};const c=xf({removePriorValues:t,element:l,duplicateValues:i,timeItem:a});return r||Ci({tournamentId:e==null?void 0:e.tournamentId,eventId:s==null?void 0:s.eventId,context:"addTimeItem",drawDefinition:n,matchUp:l}),c}function bq(t){var e;const i=Ln(t,[{[qp]:!0},{[Yy]:!0},{[Pp]:!0},{[x0]:!0}]);if(i.error)return i;const n=CC(t,[{[jP]:_f,attr:{[xce]:!0}}]);if(n.error)return n;const{tournamentRecord:r,drawDefinition:o,participantId:a,matchUpId:s}=t,l=(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp,{matchUpStatus:c,score:u}=l??{};if(c&&Xce.includes(c)||c&&no.includes(c)||lo({score:u}))return{error:t_e};const d=ib({matchUp:l});if(d!=null&&d.error)return d;const{checkedInParticipantIds:p,allRelevantParticipantIds:h}=d??{};if(!(h!=null&&h.includes(a)))return{error:Dd};if(!(p!=null&&p.includes(a)))return{error:C_e};const f=Mue({matchUp:l});if(f!=null&&f.error)return f;const{sideParticipantIds:m,nestedIndividualParticipantIds:g}=f??{},v=m==null?void 0:m.indexOf(a);return v!==void 0&&[0,1].includes(v)&&((g==null?void 0:g[v])??[]).forEach(y=>{Ns({drawDefinition:o,matchUpId:s,timeItem:{itemType:q2,itemValue:y}})}),Ns({tournamentRecord:r,drawDefinition:o,matchUpId:s,timeItem:{itemValue:a,itemType:q2}})}function Iq(t){var e;const i=Ln(t,[{[qp]:!0},{[Yy]:!0},{[Pp]:!0},{[x0]:!0}]);if(i[Sv])return i;const n=CC(t,[{[jP]:_f,attr:{[xce]:!0}}]);if(n[Sv])return n;const{tournamentRecord:r,drawDefinition:o,participantId:a,matchUpId:s}=t,l=ib({matchUp:(e=n==null?void 0:n.matchUp)==null?void 0:e.matchUp});if(l!=null&&l.error)return l;const{checkedInParticipantIds:c,allRelevantParticipantIds:u}=l??{};return c!=null&&c.includes(a)?{...le}:u!=null&&u.includes(a)?Ns({tournamentRecord:r,drawDefinition:o,matchUpId:s,timeItem:{itemValue:a,itemType:W2}}):{[Sv]:Dd}}function dx(t){var e,i;const n=Ln(t,[{[Pp]:!0,[Yy]:!0,[x0]:!0}]);if(n.error)return n;const r=t.tournamentId??t.activeTournamentId,o=t.tournamentRecord??(r&&((e=t.tournamentRecords)==null?void 0:e[r])),{participantId:a,matchUpId:s,drawDefinition:l}=t;if(!o)return{error:je};const c=CC(t,[{[jP]:_f,[Sv]:xo}]),u=(i=c.matchUp)==null?void 0:i.matchUp;if(!u)return{error:xo};const{checkedInParticipantIds:d=[]}=ib({matchUp:u});return a&&d.includes(a)?bq({tournamentRecord:o,drawDefinition:l,participantId:a,matchUpId:s,matchUp:u}):Iq({tournamentRecord:o,drawDefinition:l,participantId:a,matchUpId:s,matchUp:u})}function wq({tournamentRecord:t,drawDefinition:e,tieMatchUpId:i,event:n}){var r,o;if(!t)return{error:je};if(!e)return{error:Yc};if(!n)return{error:sl};const a=ma({drawDefinition:e}),{matchUp:s}=vn({matchUpId:i,drawDefinition:e,matchUpsMap:a});if(!s)return{error:xo};const{matchUp:l,structure:c}=vn({tournamentParticipants:t.participants,matchUpId:i,inContext:!0,drawDefinition:e,matchUpsMap:a,event:n});if(!l)return{error:xo};const{collectionPosition:u,drawPositions:d,collectionId:p,matchUpTieId:h,matchUpType:f}=l;if(f&&![vr,Pn].includes(f))return{error:ja};const{positionAssignments:m}=Ki({structure:c}),g=m==null?void 0:m.filter(S=>d==null?void 0:d.includes(S.drawPosition)),{matchUp:v}=vn({matchUpId:h,drawDefinition:e,matchUpsMap:a}),y=[...((r=v==null?void 0:v.sides)==null?void 0:r.map(li))??[],...(g==null?void 0:g.map(li))??[]],{participants:b}=Qn({tournamentRecord:t,participantFilters:{participantTypes:[on],participantIds:y}}),{matchUp:I}=vn({matchUpId:h,inContext:!0,drawDefinition:e,matchUpsMap:a}),T=(o=jo({matchUp:v,drawDefinition:e,structure:c,event:n}))==null?void 0:o.tieFormat;return{inContextDualMatchUp:I,inContextTieMatchUp:l,relevantAssignments:g,collectionPosition:u,teamParticipants:b,collectionId:p,matchUpType:f,dualMatchUp:v,tieMatchUp:s,tieFormat:T,structure:c,...le}}function Sq(t){var e,i,n,r,o,a,s,l,c,u,d,p,h,f,m;const g=wq(t);if(g.error)return g;const v="replaceTieMatchUpParticipantid",{existingParticipantId:y,tournamentRecord:b,newParticipantId:I,drawDefinition:T,substitution:S,event:w}=t;if(!y||!I)return ce({result:{error:Hr},stack:v});if(y===I)return{...le};const{inContextDualMatchUp:U,inContextTieMatchUp:D,collectionPosition:E,collectionId:C,dualMatchUp:M,tieMatchUp:N,tieFormat:R}=g,A=D==null?void 0:D.matchUpType,_=(e=D==null?void 0:D.sides)==null?void 0:e.find(ie=>{var oe,ne,re;return((oe=ie.participant)==null?void 0:oe.participantId)===y||((re=(ne=ie.participant)==null?void 0:ne.individualParticipantIds)==null?void 0:re.includes(y))});if(!_)return{error:rr};const k=((i=Qn({tournamentRecord:b,participantFilters:{participantIds:[y,I]}}))==null?void 0:i.participants)??[];if(k.length!==2)return ce({result:{error:Hr},stack:v});if(k[0].participantType!==k[1].participantType)return ce({result:{error:Cu},stack:v});const{appliedPolicies:O}=Gi({tournamentRecord:b,drawDefinition:T,event:w}),F=((n=t.policyDefinitions)==null?void 0:n[so])??(O==null?void 0:O[so])??ab[so],B=k.find(({participantId:ie})=>ie===I);if((t.enforceGender??((r=F==null?void 0:F.participants)==null?void 0:r.enforceGender))!==!1&&[rn,Dn].includes(D==null?void 0:D.gender)&&(D==null?void 0:D.gender)!==((o=B==null?void 0:B.person)==null?void 0:o.sex))return{error:LP,info:"Gender mismatch"};const $=(a=F==null?void 0:F.processCodes)==null?void 0:a.substitution;yC({tournamentId:b.tournamentId,eventId:w.eventId,inContextDualMatchUp:U,drawDefinition:T,dualMatchUp:M});const V=(s=M==null?void 0:M.sides)==null?void 0:s.find(({sideNumber:ie})=>ie===_.sideNumber);if(!V)return ce({result:{sideNumber:_.sideNumber,existingParticipantId:y,error:zo},stack:v});const H=(l=D==null?void 0:D.sides)==null?void 0:l.flatMap(ie=>{var oe,ne;return((oe=ie.participant)==null?void 0:oe.individualParticipantIds)||((ne=ie.participant)==null?void 0:ne.participantId)||[]});if(H!=null&&H.includes(I))return ce({result:{error:Xz},stack:v});const z=(u=(c=U==null?void 0:U.sides)==null?void 0:c.find(({sideNumber:ie})=>ie===_.sideNumber))==null?void 0:u.participantId,G=V.lineUp,W=G==null?void 0:G.find(({participantId:ie})=>I===ie),K=G==null?void 0:G.reduce((ie,oe)=>oe.substitutionOrder>ie?oe.substitutionOrder:ie,0),Z=(G==null?void 0:G.map(ie=>{var oe;const ne=ft(ie,!1,!0);if(![y,I].includes(ne.participantId))return ne;if(!S&&[y,I].includes(ne.participantId)&&(ne.collectionAssignments=(oe=ne.collectionAssignments)==null?void 0:oe.filter(re=>!(re.collectionPosition===E&&re.collectionId===C))),S&&y===ne.participantId&&(ne.collectionAssignments=ne.collectionAssignments.map(re=>re.collectionPosition===E&&re.collectionId===C&&re.substitutionOrder===void 0?{...re,substitutionOrder:K}:re)),ne.participantId===I){ne.collectionAssignments||(ne.collectionAssignments=[]);const re={collectionId:C,collectionPosition:E};S&&(re.previousParticipantId=y,re.substitutionOrder=(K??0)+1),ne.collectionAssignments.push(re)}return ne}))??[];if(!W){const ie={collectionId:C,collectionPosition:E};S&&(ie.substitutionOrder=(K??0)+1,ie.previousParticipantId=y);const oe={collectionAssignments:[ie],participantId:I};Z.push(oe)}const Y=A===Pn,{assignedParticipantIds:X}=CR({lineUp:G,collectionPosition:E,collectionId:C}),{assignedParticipantIds:Q}=CR({lineUp:Z,collectionPosition:E,collectionId:C});if(V.lineUp=Z,z&&R){const ie=cb({participantId:z,lineUp:Z,drawDefinition:T,tieFormat:R});if(ie.error)return ce({result:ie,stack:v})}else console.log("team participantId not found");let te,J;if(Y){const{tournamentRecord:ie}=t;let oe=Kl({participantIds:Q,tournamentRecord:ie});if(!oe.participant){const re=Au({returnParticipant:!0,pairOverride:!0,tournamentRecord:ie,participant:{participantRole:Ro,individualParticipantIds:Q,participantType:qt}});if(re.error)return ce({result:re,stack:v});te=(d=re.participant)==null?void 0:d.participantId}oe=Kl({participantIds:X,tournamentRecord:ie});const ne=(p=oe.participant)==null?void 0:p.participantId;ne&&sb({participantIds:[ne],tournamentRecord:ie}).success&&(J=ne)}if(S||((h=_.substitutions)==null?void 0:h.length)===1){if(S)$&&N&&(N.processCodes=ti([...(N==null?void 0:N.processCodes)??[],...$]));else for(const ie of $||[]){const oe=(f=N==null?void 0:N.processCodes)==null?void 0:f.lastIndexOf(ie);oe!==void 0&&((m=N==null?void 0:N.processCodes)==null||m.splice(oe,1))}N&&Ci({tournamentId:b==null?void 0:b.tournamentId,matchUp:N,context:v,drawDefinition:T})}return M&&Ci({tournamentId:b==null?void 0:b.tournamentId,matchUp:M,context:v,drawDefinition:T}),{...le,modifiedLineUp:Z,participantRemoved:J,participantAdded:te}}function Ohe({collectionPosition:t,teamParticipantId:e,dualMatchUpSide:i,drawDefinition:n,participantIds:r,collectionId:o}){var a;if(!o||!t||!Array.isArray(r))return{modifiedLineUp:(i==null?void 0:i.lineUp)||[],error:Re};const s=(i==null?void 0:i.lineUp)||((a=Ym({participantId:e,drawDefinition:n}))==null?void 0:a.lineUp),l=[],c=[];return{modifiedLineUp:(s==null?void 0:s.map(u=>{var d;if(!r.includes(u.participantId))return u;const p=(d=u.collectionAssignments)==null?void 0:d.filter(h=>{const f=h.collectionId===o&&h.collectionPosition===t;return f&&(h.previousParticipantId&&l.push(h.previousParticipantId),c.push({participantId:u.participantId,...h})),!f});return{participantId:u.participantId,collectionAssignments:p}}).filter(Boolean))||[],assignmentsRemoved:c,previousParticipantIds:l}}function px({individualParticipantIds:t,groupingParticipantId:e,removeFromOtherTeams:i,tournamentRecord:n}){const r="addIndividualParticipantIds";if(!n)return ce({result:{error:je},stack:r});if(!e||!t)return ce({result:{error:bt},stack:r});const o=n.participants??[],a=o.find(d=>d.participantId===e);if(!a)return ce({result:{error:rr},stack:r});if(a!=null&&a.participantType&&![on,gl].includes(a.participantType))return ce({context:{participantType:a.participantType},result:{error:Cu},stack:r});const s=t.filter(d=>{const p=o.find(h=>h.participantId===d);return(p==null?void 0:p.participantType)!==ui});if(s.length)return ce({result:{error:Ec,invalidParticipantIds:s},stack:r});a.individualParticipantIds||(a.individualParticipantIds=[]);const l=a.individualParticipantIds,c=t.filter(d=>!l.includes(d));c.length&&(i&&Ak({individualParticipantIds:c,tournamentRecord:n}),a.individualParticipantIds=a.individualParticipantIds.concat(...c));const{topics:u}=Bu();if(u.includes(Lo)){const d=o.find(({participantId:p})=>p===e);bi({topic:Lo,payload:{participants:[d]}})}return function({individualParticipantIds:d,groupingParticipantId:p,tournamentRecord:h}){var f,m;const g=(h.events||[]).filter(y=>{var b;return(y==null?void 0:y.eventType)===Yr&&((b=y==null?void 0:y.entries)==null?void 0:b.some(I=>I.participantId===p))}),v=y=>!d.includes(y.participantId);for(const y of g){y.entries=(y.entries||[]).filter(v);const{flightProfile:b}=Zn({event:y});(f=b==null?void 0:b.flights)==null||f.forEach(I=>{I.drawEntries=(I.drawEntries||[]).filter(v)}),(m=y==null?void 0:y.drawDefinitions)==null||m.forEach(I=>{I.entries=(I.entries||[]).filter(v)})}}({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:n}),{groupingParticipant:ft(a,!1,!0),added:c.length,...le}}function hx(t){const{updateParticipantName:e=!0,groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r,pairOverride:o,participant:a}=t;if(!r)return{error:je};if(!a)return{error:A0};if(!a.participantId)return Au({tournamentRecord:r,participant:a});const{participant:s}=Dg({participantId:a.participantId,tournamentRecord:r});if(!s)return Au({tournamentRecord:r,participant:a});const{participantRoleResponsibilties:l,individualParticipantIds:c,participantOtherName:u,participantName:d,participantRole:p,participantType:h,onlineResources:f,contacts:m,person:g}=a;if(h&&s.participantType!==h)return{error:w_e};const v={};if(m&&(v.contacts=m),f&&(v.onlineResources=f),d&&typeof d=="string"&&(v.participantName=d),u&&typeof u=="string"&&(v.participantOtherName=u),Array.isArray(c)){const{participants:y}=Qn({participantFilters:{participantTypes:[ui]},tournamentRecord:r}),b=y==null?void 0:y.map(li);if(b){const I=c.filter(T=>typeof T=="string"&&b.includes(T));([gl,gn].includes(h||s.participantType)||h===qt&&(I.length===2||o))&&(v.individualParticipantIds=I),s.participantType===LE.PAIR&&e&&(v.participantName=function({individualParticipants:T,newValues:S}){const w=S.individualParticipantIds;let U=T.filter(({participantId:D})=>w.includes(D)).map(({person:D})=>D==null?void 0:D.standardFamilyName).filter(Boolean).sort().join("/");return w.length===1&&(U+="/Unknown"),U}({individualParticipants:y,newValues:v}))}}return Object.keys(Zue).includes(p)&&(v.participantRole=p),Object.keys(LE).includes(h)&&(v.participantType=h),Array.isArray(l)&&(v.participantRoleResponsibilties=l),s.participantType===LE.INDIVIDUAL&&g&&function({updateParticipantName:y,existingParticipant:b,newValues:I,person:T}){const S={},{standardFamilyName:w,standardGivenName:U,nationalityCode:D,personId:E,sex:C}=T;C&&Object.keys($ue).includes(C)&&(S.sex=C);let M;E&&typeof E=="string"&&(S.personId=E),D&&typeof D=="string"&&(N=D,Fh.flatMap(({iso:R,ioc:A})=>[R,A]).filter(Boolean).includes(N)||D==="")&&(S.nationalityCode=D);var N;if(w&&typeof w=="string"&&w.length>1&&(S.standardFamilyName=w,M=!0),U&&typeof U=="string"&&U.length>1&&(S.standardGivenName=U,M=!0),M&&y){const R=`${S.standardGivenName} ${S.standardFamilyName}`;I.participantName=R}Object.assign(b.person,S)}({updateParticipantName:e,existingParticipant:s,newValues:v,person:g}),Object.assign(s,It(v)),i&&px({individualParticipantIds:[s.participantId],groupingParticipantId:i,removeFromOtherTeams:n,tournamentRecord:r}),bi({topic:Lo,payload:{tournamentId:r.tournamentId,participants:[s]}}),{participant:ft(s),...le}}function qR(t){var e,i,n,r,o,a,s,l,c,u,d,p,h,f,m,g;const v=wq(t);if(v.error)return v;const y="assignTieMatchUpParticipantId";let b=t.teamParticipantId;const{tournamentRecord:I,drawDefinition:T,participantId:S,event:w}=t;if(!S)return ce({result:{error:Hr},stack:y});if(t.sideNumber&&![1,2].includes(t.sideNumber))return ce({result:{error:ace},stack:y});const{inContextDualMatchUp:U,inContextTieMatchUp:D,relevantAssignments:E,collectionPosition:C,teamParticipants:M,collectionId:N,matchUpType:R,dualMatchUp:A,tieFormat:_}=v,k=(e=D==null?void 0:D.sides)==null?void 0:e.flatMap(he=>{var be,Se;return((be=he.participant)==null?void 0:be.individualParticipantIds)||((Se=he.participant)==null?void 0:Se.participantId)||[]});if(k!=null&&k.includes(S))return ce({result:{...le},stack:y});b=b??(t.sideNumber?(n=(i=U==null?void 0:U.sides)==null?void 0:i.find(he=>he.sideNumber===t.sideNumber))==null?void 0:n.participantId:void 0);const O=(o=(r=Qn({participantFilters:{participantIds:[S]},tournamentRecord:I}))==null?void 0:r.participants)==null?void 0:o[0];if(!O)return ce({result:{error:rr},stack:y});const{appliedPolicies:F}=Gi({tournamentRecord:I,drawDefinition:T,event:w}),B=((a=t.policyDefinitions)==null?void 0:a[so])??(F==null?void 0:F[so])??ab[so];if((t.enforceGender??((s=B==null?void 0:B.participants)==null?void 0:s.enforceGender))!==!1&&[rn,Dn].includes(D==null?void 0:D.gender)&&(D==null?void 0:D.gender)!==((l=O.person)==null?void 0:l.sex))return{error:LP,info:"Gender mismatch"};const{individualParticipantIds:$,participantType:V}=O;if(R===vr&&V!==ui)return{error:Cu};const H=V===ui?[S]:$,z=b&&(M==null?void 0:M.find(({participantId:he})=>he===b))||(M==null?void 0:M.find(({individualParticipantIds:he})=>ua(H,he)));if(!z)return{error:yce};if(b||(b=z.participantId),!b)return{error:rr};const G=E==null?void 0:E.find(he=>he.participantId===(z==null?void 0:z.participantId)),W=G==null?void 0:G.drawPosition,K=(u=(c=A==null?void 0:A.sides)==null?void 0:c.find(he=>he.participantId===b))==null?void 0:u.sideNumber,Z=(p=(d=D==null?void 0:D.sides)==null?void 0:d.find(he=>W&&he.drawPosition===W))==null?void 0:p.sideNumber,Y=K??Z??t.sideNumber;if(!_)return{error:Z_};if(!((h=_.collectionDefinitions)!=null&&h.find(he=>he.collectionId===N)))return{error:h_e};yC({tournamentId:I.tournamentId,eventId:w.eventId,inContextDualMatchUp:U,drawDefinition:T,dualMatchUp:A});const X=(f=A==null?void 0:A.sides)==null?void 0:f.find(he=>he.sideNumber===Y),Q=(m=D==null?void 0:D.sides)==null?void 0:m.find(he=>he.sideNumber===Y),te=(X==null?void 0:X.lineUp)??((g=Ym({participantId:b,drawDefinition:T}))==null?void 0:g.lineUp),J=te==null?void 0:te.filter(he=>{var be;return(be=he.collectionAssignments)==null?void 0:be.find(Se=>Se.collectionPosition===C&&Se.collectionId===N&&!Se.previousParticipantId)}),ie=J==null?void 0:J.map(he=>he==null?void 0:he.participantId),oe=(ie==null?void 0:ie.length)>1&&ie||(V===qt?O.individualParticipantIds:[S]),ne=Ohe({collectionPosition:C,teamParticipantId:b,dualMatchUpSide:X,drawDefinition:T,participantIds:oe,collectionId:N});if(ne.error)return ce({result:ne,stack:y});const{modifiedLineUp:re}=ne;let me;if(R===Pn){if(V!==qt){let he=hL({collectionPosition:C,teamParticipantId:b,drawDefinition:T,modifiedLineUp:re,participantId:S,collectionId:N,tieFormat:_});if(he!=null&&he.error)return ce({result:he,stack:y});if(he=function({side:be}){let Se;if(be.participant){const De=be.participant.individualParticipantIds||[];if(De.filter(Boolean).length===1){const{participant:Oe}=Kl({participantIds:De,tournamentRecord:I});De.push(S);const{participant:xe}=Kl({participantIds:De,tournamentRecord:I});if(!xe&&Oe){Oe.individualParticipantIds=De;const $e=hx({pairOverride:!0,tournamentRecord:I,participant:Oe});if($e.error)return $e}else Se=Oe==null?void 0:Oe.participantId}}else{const De=Au({participant:{individualParticipantIds:[S],participantRole:Ro,participantType:qt},pairOverride:!0,tournamentRecord:I});if(De.error)return De}return{...le,deletedParticipantId:Se}}({side:Q}),he.error)return he;me=he.deletedParticipantId,X&&(X.lineUp=re),A&&Ci({tournamentId:I==null?void 0:I.tournamentId,matchUp:A,context:y,drawDefinition:T})}else if(V===qt)for(const he of oe)hL({collectionPosition:C,teamParticipantId:b,drawDefinition:T,modifiedLineUp:re,participantId:he,collectionId:N,tieFormat:_})}else{const he=hL({collectionPosition:C,teamParticipantId:b,drawDefinition:T,modifiedLineUp:re,participantId:S,collectionId:N,tieFormat:_});if(he!=null&&he.error)return he}if(X&&(X.lineUp=re),A&&Ci({tournamentId:I==null?void 0:I.tournamentId,matchUp:A,context:y,drawDefinition:T}),me){const{error:he}=sb({participantIds:[me],tournamentRecord:I});he&&console.log("cleanup")}return{...le,modifiedLineUp:re}}function hL({collectionPosition:t,teamParticipantId:e,drawDefinition:i,modifiedLineUp:n,participantId:r,collectionId:o,tieFormat:a}){var s,l;const c=(s=Ym({participantId:e,drawDefinition:i}))==null?void 0:s.lineUp,u=(l=n||c)==null?void 0:l.find(p=>(p==null?void 0:p.participantId)===r),d={collectionId:o,collectionPosition:t};if(u)u.collectionAssignments.push(d);else{const p={collectionAssignments:[d],participantId:r};n.push(p)}return cb({participantId:e,lineUp:n,drawDefinition:i,tieFormat:a})}function Lhe(t){var e,i,n,r,o,a,s,l,c,u,d,p,h,f,m,g,v,y,b,I;const{tournamentRecord:T,drawDefinition:S,participantId:w,event:U}=t,D="removeTieMatchUpParticiapantId";if(!w)return ce({result:{error:Hr},stack:D});const E=wq(t);if(E.error)return E;const{appliedPolicies:C}=Gi({tournamentRecord:T,drawDefinition:S,event:U}),M=((e=t.policyDefinitions)==null?void 0:e[so])??(C==null?void 0:C[so])??ab[so],N=(i=M==null?void 0:M.processCodes)==null?void 0:i.substitution,{inContextDualMatchUp:R,inContextTieMatchUp:A,relevantAssignments:_,collectionPosition:k,teamParticipants:O,collectionId:F,matchUpType:B,dualMatchUp:$,tieMatchUp:V,tieFormat:H}=E;if(!$)return ce({result:{error:Cs},stack:D});const z=(n=A==null?void 0:A.sides)==null?void 0:n.find(Q=>{var te,J,ie;return((te=Q.participant)==null?void 0:te.participantId)===w||((ie=(J=Q.participant)==null?void 0:J.individualParticipantIds)==null?void 0:ie.includes(w))});if(!z)return ce({result:{error:rr},stack:D});if(!((r=z.substitutions)!=null&&r.length)&&(lo({score:A==null?void 0:A.score})||A!=null&&A.winningSide))return ce({result:{error:Z_e},stack:D});const G=(a=(o=R==null?void 0:R.sides)==null?void 0:o.find(({sideNumber:Q})=>Q===z.sideNumber))==null?void 0:a.participantId;if(!G)return ce({result:{error:rr},stack:D});const W=(l=(s=Qn({participantFilters:{participantIds:[w]},tournamentRecord:T}))==null?void 0:s.participants)==null?void 0:l[0];if(!W)return ce({result:{error:rr},stack:D});if(B===vr&&W.participantType===qt)return ce({result:{error:LP},stack:D});const K=W.participantType===ui?[w]:W.individualParticipantIds;yC({tournamentId:T.tournamentId,eventId:U.eventId,inContextDualMatchUp:R,drawDefinition:S,dualMatchUp:$});let Z=(c=$.sides)==null?void 0:c.find(({sideNumber:Q})=>Q===z.sideNumber);if(!Z&&(((u=$.sides)==null?void 0:u.filter(({lineUp:Q})=>!Q).length)||0)<2){const Q=O==null?void 0:O.map(({participantId:te})=>{var J;return{drawPosition:(J=_==null?void 0:_.find(ie=>ie.participantId===te))==null?void 0:J.drawPosition,teamParticipantId:te}});Z=(d=$.sides)==null?void 0:d.find(te=>{var J;return((J=Q==null?void 0:Q.find(({drawPosition:ie})=>ie===te.drawPosition))==null?void 0:J.teamParticipantId)===G})}if(!Z)return ce({result:{error:rr,context:{participantId:w}}});const{modifiedLineUp:Y,previousParticipantIds:X}=Ohe({collectionPosition:k,teamParticipantId:G,dualMatchUpSide:Z,participantIds:K,drawDefinition:S,collectionId:F});if(Z.lineUp=Y,G&&H&&cb({participantId:G,lineUp:Y,drawDefinition:S,tieFormat:H}),B===Pn&&W.participantType===ui){const Q=(p=A==null?void 0:A.sides)==null?void 0:p.find(ie=>ie.sideNumber===(Z==null?void 0:Z.sideNumber)),{participantId:te}=Q??{},J=te&&((f=(h=Qn({participantFilters:{participantIds:[te]},tournamentRecord:T,withDraws:!0}))==null?void 0:h.participants)==null?void 0:f[0]);if(!J)return ce({result:{error:rr},stack:D});{const ie=((m=J==null?void 0:J.individualParticipantIds)==null?void 0:m.filter(oe=>oe!==w))??[];if(X&&ie.push(...X),ie.length>2)return ce({result:{error:Ec},stack:D});if((g=J.draws)!=null&&g.length){if(ie.length===1){const{participant:oe}=Kl({participantIds:ie,tournamentRecord:T});if(!oe){const ne=Au({participant:{participantRole:Ro,individualParticipantIds:ie,participantType:qt},pairOverride:!0,tournamentRecord:T});if(ne.error)return ce({result:ne,stack:D})}}}else if(ie.length){J.individualParticipantIds=ie;const oe=hx({participant:J,pairOverride:!0,tournamentRecord:T});if(oe.error)return ce({result:oe,stack:D})}else{const oe=sb({participantIds:[te],tournamentRecord:T});oe.error&&console.log("cleanup",{result:oe})}}}if(((v=z.substitutions)==null?void 0:v.length)===1){const Q=(y=A==null?void 0:A.sides)==null?void 0:y.find(te=>te.sideNumber!==z.sideNumber);if(!((b=Q==null?void 0:Q.substitutions)!=null&&b.length)&&(I=V==null?void 0:V.processCodes)!=null&&I.length){for(const te of N||[]){const J=V.processCodes.lastIndexOf(te);V.processCodes.splice(J,1)}Ci({tournamentId:T==null?void 0:T.tournamentId,matchUp:V,context:D,drawDefinition:S})}}return Ci({tournamentId:T==null?void 0:T.tournamentId,matchUp:$,context:D,drawDefinition:S}),{...le,modifiedLineUp:Y}}function Fhe({tournamentRecord:t,drawDefinition:e,sideNumber:i,matchUpId:n,event:r}){var o,a;if(!t)return{error:je};if(!e)return{error:rt};if(!n)return{error:co};if(!i)return{error:bt};if(![1,2].includes(i))return{error:Re,sideNumber:i};const{matchUp:s,structure:l}=vn({drawDefinition:e,matchUpId:n,event:r});return s?l!=null&&l.structures||e.drawType&&e.drawType!==ll||(o=l==null?void 0:l.matchUps)!=null&&o.find(({roundPosition:c})=>!!c)?{error:Wz}:((a=s.sides)==null||a.forEach(c=>{c.sideNumber===i&&delete c.participantId}),Ci({tournamentId:t==null?void 0:t.tournamentId,context:"assignSideParticipant",drawDefinition:e,matchUp:s}),{...le}):{error:xo}}function MLe({inContextDrawMatchUps:t,positionAssignments:e,sourceMatchUpStatus:i,targetDrawPosition:n,tournamentRecord:r,sourceMatchUpId:o,drawDefinition:a,dualMatchUp:s,matchUpsMap:l,matchUp:c,event:u}){var d,p,h;if(s){const m=t.find(({matchUpId:y})=>c.matchUpId===y),g=(p=(d=m.sides)==null?void 0:d.find(y=>y.drawPosition===n))==null?void 0:p.sideNumber,v=(h=c.sides)==null?void 0:h.find(y=>y.sideNumber===g);v&&delete v.lineUp}c.drawPositions=(c.drawPositions||[]).map(m=>m===n?void 0:m).filter(Boolean);const f=e.filter(({drawPosition:m})=>{var g;return(g=c.drawPositions)==null?void 0:g.includes(m)}).filter(m=>m.bye).length;return c.matchUpStatus=f&&Ri||[Mi,Li].includes(c.matchUpStatus)&&c.matchUpStatus||qn,[Li,Mi].includes(c.matchUpStatus)&&(c.winningSide=void 0),c.matchUpStatusCodes&&rde({inContextDrawMatchUps:t,sourceMatchUpStatus:i,sourceMatchUpId:o,matchUpsMap:l,matchUp:c}),Ci({tournamentId:r==null?void 0:r.tournamentId,eventId:u==null?void 0:u.eventId,context:`removeSubsequentDrawPosition-${n}`,drawDefinition:a,matchUp:c}),{...le}}function ww(t){const{dualWinningSideChange:e,inContextDrawMatchUps:i,tournamentRecord:n,drawDefinition:r,matchUpStatus:o,matchUpsMap:a,dualMatchUp:s,targetData:l,matchUpId:c,structure:u,event:d}=t,p=!!t.matchUp.collectionId,h=Zl({drawDefinition:r,structure:u}),{drawPositions:f,winningSide:m}=l.matchUp||{};if(!h&&!f)return{error:q_};const{targetLinks:{loserTargetLink:g,winnerTargetLink:v,byeTargetLink:y},targetMatchUps:{loserMatchUp:b,winnerMatchUp:I,byeMatchUp:T}}=l,S=fu({...t,matchUpStatus:o||qn,removeWinningSide:!0});if(S.error)return S;let w;if(p){const{matchUpTieId:k,matchUpsMap:O}=t;if(w=Od({matchUpId:k,tournamentRecord:n,drawDefinition:r,matchUpsMap:O,event:d}),!e&&!w.removeWinningSide)return{...le}}if(h)return{...le};const{matchUps:U}=zi({afterRecoveryTimes:!1,inContext:!0,drawDefinition:r,matchUpsMap:a,structure:u}),{positionAssignments:D}=Lr({structure:u}),E=m-1,C=1-E,M=f[E],N=f[C],{winnerParticipantId:R,loserParticipantId:A}=(D==null?void 0:D.reduce((k,O)=>(O.drawPosition===N&&(k.loserParticipantId=O.participantId),O.drawPosition===M&&(k.winnerParticipantId=O.participantId),k),{winnerParticipantId:void 0,loserParticipantId:void 0}))||{},_=U.filter(k=>{var O;return(O=k.drawPositions)==null?void 0:O.includes(N)});if(I&&Bhe({sourceMatchUpStatus:o,sourceMatchUpId:c,inContextDrawMatchUps:i,winningDrawPosition:M,winnerParticipantId:R,tournamentRecord:n,winnerTargetLink:v,drawDefinition:r,winnerMatchUp:I,dualMatchUp:s,matchUpsMap:a}),b){const{winnerHadMatchUpStatus:k}=function({matchUpStatuses:B=[Ri,Li,Mi],drawPositionMatchUps:$,loserDrawPosition:V,sourceMatchUps:H}){var z;const G=$==null?void 0:$.reduce((Y,X)=>!Y||X.roundNumber>Y.roundNumber?X:Y,void 0),W=(z=G==null?void 0:G.drawPositions)==null?void 0:z.find(Y=>Y!==V),K=H.filter(Y=>{var X;return(X=Y==null?void 0:Y.drawPositions)==null?void 0:X.includes(W)}).map(Y=>Y.matchUpStatus),Z=H.filter(Y=>{var X;return(X=Y==null?void 0:Y.drawPositions)==null?void 0:X.includes(V)}).map(Y=>Y.matchUpStatus);return{sourceMatchUp:G,winnerHadMatchUpStatus:ua(K||[],B),winnerMatchUpStatuses:K,loserHadMatchUpStatus:ua(Z||[],B),loserMatchUpStatuses:Z}}({drawPositionMatchUps:_,loserDrawPosition:N,sourceMatchUps:U}),O=g.linkCondition;k&&O===Md&&pB({targetLink:g,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:Math.min(...b.drawPositions),matchUpsMap:a,event:d});const F=function({sourceMatchUpStatus:B,loserParticipantId:$,tournamentRecord:V,loserTargetLink:H,sourceMatchUpId:z,drawDefinition:G,loserMatchUp:W,matchUpsMap:K,dualMatchUp:Z,event:Y}){var X,Q,te;const J="removeDirectedLoser",ie=H.target.structureId,{structure:oe}=kt({drawDefinition:G,structureId:ie});if(!oe)return{error:Cn};const{positionAssignments:ne}=Lr({structure:oe}),re=(X=ne==null?void 0:ne.find(me=>me.participantId===$))==null?void 0:X.drawPosition;if(ne==null||ne.forEach(me=>{me.participantId===$&&delete me.participantId}),oe.seedAssignments=(oe.seedAssignments??[]).filter(me=>me.participantId!==$),Z){const me=W==null?void 0:W.sides.reduce((Se,De,Oe)=>De.drawPosition===re?Oe:Se,void 0),he=(Q=K==null?void 0:K.drawMatchUps)==null?void 0:Q.find(({matchUpId:Se})=>Se===W.matchUpId),be=(te=he==null?void 0:he.sides)==null?void 0:te[me];be&&(delete be.lineUp,Ci({tournamentId:V==null?void 0:V.tournamentId,eventId:Y==null?void 0:Y.eventId,matchUp:he,context:J,drawDefinition:G}))}return{...le}}({sourceMatchUpStatus:o,sourceMatchUpId:c,loserParticipantId:A,tournamentRecord:n,loserTargetLink:g,drawDefinition:r,loserMatchUp:b,dualMatchUp:s,matchUpsMap:a,event:d});if(F.error)return F}return T&&pB({sourceMatchUpId:c,targetLink:y,inContextDrawMatchUps:i,drawDefinition:r,drawPosition:Math.min(...T.drawPositions),matchUpsMap:a,event:d}),{...le,...w&&{tieMatchUpResult:w}}}function Bhe({inContextDrawMatchUps:t,winningDrawPosition:e,sourceMatchUpStatus:i,winnerParticipantId:n,tournamentRecord:r,winnerTargetLink:o,sourceMatchUpId:a,drawDefinition:s,winnerMatchUp:l,matchUpsMap:c,dualMatchUp:u,event:d}){var p;const{structureId:h,roundNumber:f}=l;if(o){const m=o.target.structureId,{structure:g}=kt({drawDefinition:s,structureId:m});if(!g)return{error:Cn};const{positionAssignments:v}=Lr({structure:g});g.seedAssignments=(g.seedAssignments??[]).filter(w=>w.participantId!==n);const y=v==null?void 0:v.find(w=>w.participantId===n),b=y==null?void 0:y.drawPosition,{matchUps:I}=zi({drawDefinition:s,structure:g,event:d}),T=cs(I.map(w=>w.drawPositions).flat(1/0).filter(Boolean));if((b?T[b]:void 0)===1)v==null||v.forEach(w=>{w.participantId===n&&delete w.participantId});else{const w=I.filter(({drawPositions:U})=>U.includes(b));console.log("not removing from position assignments since instances > 1",{drawPositionMatchUps:w,winnerTargetLink:o})}const S=(p=c==null?void 0:c.drawMatchUps)==null?void 0:p.find(({matchUpId:w})=>w===l.matchUpId);S&&Ci({tournamentId:r==null?void 0:r.tournamentId,eventId:d==null?void 0:d.eventId,matchUp:S,context:"removeDirectedWinner",drawDefinition:s})}return f&&function({inContextDrawMatchUps:m,sourceMatchUpStatus:g,targetDrawPosition:v,tournamentRecord:y,sourceMatchUpId:b,drawDefinition:I,structureId:T,dualMatchUp:S,roundNumber:w,matchUpsMap:U,event:D}){const{structure:E}=kt({drawDefinition:I,structureId:T});if((E==null?void 0:E.structureType)===na)return{...le};U=U??ma({drawDefinition:I});const C=((U==null?void 0:U.mappedMatchUps)||{})[T].matchUps,{initialRoundNumber:M}=ny({drawPosition:v,matchUps:C}),N=C==null?void 0:C.filter(A=>{var _;return A.roundNumber>=w&&A.roundNumber!==M&&((_=A.drawPositions)==null?void 0:_.includes(v))}),{positionAssignments:R}=Ki({drawDefinition:I,structureId:T});for(const A of N??[])MLe({inContextDrawMatchUps:m,sourceMatchUpStatus:g,positionAssignments:R,targetDrawPosition:v,tournamentRecord:y,sourceMatchUpId:b,drawDefinition:I,dualMatchUp:S,matchUpsMap:U,matchUp:A,event:D})}({targetDrawPosition:e,inContextDrawMatchUps:t,sourceMatchUpStatus:i,tournamentRecord:r,sourceMatchUpId:a,drawDefinition:s,dualMatchUp:u,matchUpsMap:c,roundNumber:f,structureId:h}),{...le}}function pB({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,drawPosition:n,matchUpsMap:r,targetLink:o,event:a}){return aC({inContextDrawMatchUps:t,tournamentRecord:e,drawDefinition:i,matchUpsMap:r,drawPosition:n,structureId:o.target.structureId,event:a}),{...le}}function uT(t){var e;const{tournamentRecord:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:o,targetData:a,structure:s,event:l}=t,c="doubleExitAdvancement";if(s.structureType===na)return ce({result:{...le},stack:c});const{matchUp:u,targetMatchUps:d,targetLinks:p}=a,{loserMatchUp:h,winnerMatchUp:f,loserTargetDrawPosition:m}=d;if(h&&h.matchUpStatus!==Ri){const{loserTargetLink:g}=p;if((e=n==null?void 0:n.progression)!=null&&e.doubleExitPropagateBye){const v=$he({loserTargetDrawPosition:m,tournamentRecord:i,loserTargetLink:g,drawDefinition:r,loserMatchUp:h,matchUpsMap:o,event:l});if(v.error)return ce({result:v,stack:c})}else{const{feedRound:v,drawPositions:y,matchUpId:b}=h,I=v?2:2-y.indexOf(m),T=e8({...t,targetMatchUp:h,walkoverWinningSide:I,tournamentRecord:i,sourceMatchUp:u,matchUpId:b});if(T.error)return ce({result:T,stack:c})}}if(f){const g=e8({...t,matchUpId:f.matchUpId,targetMatchUp:f,tournamentRecord:i,sourceMatchUp:u});if(g.error)return ce({result:g,stack:c})}return ce({result:{...le},stack:c})}function e8(t){var e,i,n;const{inContextDrawMatchUps:r,tournamentRecord:o,drawDefinition:a,sourceMatchUp:s,targetMatchUp:l,matchUpsMap:c}=t,u=a.structures.find(({structureId:Z})=>Z===l.structureId),d=t.matchUpStatus===Mr?Mr:gr,p=t.matchUpStatus===Mr?Mi:Li,h="conditionallyAdvanceDrawPosition",f=c.drawMatchUps.find(Z=>Z.matchUpId===l.matchUpId);if(!f)return{error:Cs};const m=(s==null?void 0:s.drawPositions)||[];let g=(e=f.drawPositions)==null?void 0:e.filter(Boolean);const v=(s==null?void 0:s.structureId)===l.structureId;if(v&&ua(m,g)&&(g=g.filter(Z=>!m.includes(Z))),v&&g.length>1)return ce({result:{error:lU},stack:h});const{pairedPreviousMatchUpIsDoubleExit:y,pairedPreviousMatchUp:b}=ide(t),I=pa({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawDefinition:a}),{targetMatchUps:T,targetLinks:S}=I,{loserTargetDrawPosition:w,winnerMatchUp:U,loserMatchUp:D}=T;if(D){const{loserTargetLink:Z}=S,Y=$he({loserTargetDrawPosition:w,loserMatchUp:D,tournamentRecord:o,loserTargetLink:Z,drawDefinition:a,matchUpsMap:c});if(Y.error)return ce({result:Y,stack:h})}const E=((i=f.drawPositions)==null?void 0:i.filter(Boolean))||[],C=E.length===1,M=t.walkoverWinningSide||C&&$E({drawPosition:E[0],matchUpId:l.matchUpId,inContextDrawMatchUps:r})||void 0,N=[Li,Mi].includes(f.matchUpStatus)&&!E.length,R=f.finishingRound===1,A=N&&!R?d:p,_=r.find(Z=>Z.matchUpId===b.matchUpId);let k,O=[];s&&((s==null?void 0:s.structureId)===(_==null?void 0:_.structureId)?k=s.roundPosition<(b==null?void 0:b.roundPosition)?1:2:l.feedRound?k=s.structureId===l.structureId?2:1:M&&(k=3-M));const F=t.matchUpStatus,B=b==null?void 0:b.matchUpStatus;k===1?O=[{matchUpStatus:R1(F),previousMatchUpStatus:F,sideNumber:1},{matchUpStatus:R1(B),previousMatchUpStatus:B,sideNumber:2}]:k===2&&(O=[{matchUpStatus:R1(B),previousMatchUpStatus:B,sideNumber:1},{matchUpStatus:R1(F),previousMatchUpStatus:F,sideNumber:2}]),O.length&&(O=O.map(Z=>It(Z)));const $=fu({...t,matchUp:f,winningSide:M,matchUpStatusCodes:O,matchUpStatus:A});if($.error)return ce({result:$,stack:h});if(N)return uT({...t,matchUpStatus:A,targetData:I});if(!U)return ce({result:{...le},stack:h});const V=g.length===2?g[M-1]:g[0],{positionAssignments:H}=Ki({structure:u}),z=H==null?void 0:H.find(Z=>Z.drawPosition===V),G=c.drawMatchUps.find(Z=>Z.matchUpId===U.matchUpId),W=(n=G==null?void 0:G.drawPositions)==null?void 0:n.filter(Boolean),K=W.length===1;if(V){if(z!=null&&z.bye){const Z=pa({matchUpId:G.matchUpId,inContextDrawMatchUps:r,drawDefinition:a});if(K){const Y=W.filter(Boolean)[0],X=$E({drawPosition:Y,matchUpId:G.matchUpId,inContextDrawMatchUps:r}),Q=fu({matchUpId:G.matchUpId,matchUp:G,matchUpStatus:p,matchUpStatusCodes:[],removeScore:!0,drawDefinition:a,winningSide:X});return Q.error?ce({result:Q,stack:h}):VW({drawPositionToAdvance:Y,matchUpId:G.matchUpId,inContextDrawMatchUps:r,drawDefinition:a,matchUpsMap:c})}if([Li,Mi].includes(U.matchUpStatus)){const Y=uT({...t,matchUpId:G.matchUpId,matchUpStatus:A,targetData:Z});if(Y.error)return ce({result:Y,stack:h})}return ce({result:{...le},stack:h})}return mw({matchUpId:U.matchUpId,drawPosition:V,inContextDrawMatchUps:r,drawDefinition:a})}if(y){if(!G)return{error:Cs};if(K){const X=W[0],Q=$E({matchUpId:l.matchUpId,inContextDrawMatchUps:r,drawPosition:X});console.log("existing drawPosition is winningSide",{walkoverWinningSide:Q})}const Z=[Li,Mi].includes(G.matchUpStatus)?p:d,Y=fu({matchUpId:G.matchUpId,matchUp:G,matchUpStatusCodes:[],removeScore:!0,drawDefinition:a,matchUpStatus:Z});if(Y.error)return ce({result:Y,stack:h});if(Z===d){const X=uT({...t,matchUpId:l.matchUpId,matchUpStatus:Z,targetData:I});if(X.error)return X}}return ce({result:{...le},stack:h})}function $he(t){var e;const{loserTargetDrawPosition:i,tournamentRecord:n,loserTargetLink:r,drawDefinition:o,matchUpsMap:a,event:s}=t,l=(e=r==null?void 0:r.target)==null?void 0:e.structureId,{structure:c}=kt({drawDefinition:o,structureId:l});return c?Ms({drawPosition:i,tournamentRecord:n,drawDefinition:o,structureId:l,matchUpsMap:a,event:s}):{error:bg}}function R1(t){return t===gr?Li:t===Mr?Mi:t}function RLe(t){const{tournamentRecord:e,drawDefinition:i,matchUpStatus:n,structure:r,matchUp:o}=t,a=!(!o.tieMatchUps||o.rondPosition||!t.inContextDrawMatchUps.find(m=>m.matchUpId===o.matchUpId).containerStructureId),s=n===Ri,l=o.winningSide,c=[gr,Mr].includes(n),u=YP({matchUpStatus:n}),d=G2({matchUpStatus:n}),p=!u&&!d,h=t.matchUpTieId||l&&u&&!c,f=l&&c;return p&&{error:S7}||h&&fL(t)||f&&function(m){const g=ww(m);return g.error?g:uT(m)}(t)||l&&ww(t)||d&&fu({...t,removeScore:[Yp,Li].includes(n),matchUpStatus:n||qn})||s&&function({tournamentRecord:m,drawDefinition:g,structure:v,matchUp:y}){var b;const I="attemptToSetMatchUpStatusBYE";if(y!=null&&y.winningSide)return ce({result:{error:cU},context:{matchUpStatus:Ri},stack:I});const{positionAssignments:T}=Lr({structure:v}),S=T==null?void 0:T.filter(w=>w.bye).map(w=>w.drawPosition);return(b=y.drawPositions)!=null&&b.some(w=>S==null?void 0:S.includes(w))?(y.matchUpStatus=Ri,y.matchUpStatusCodes=[],Ci({tournamentId:m==null?void 0:m.tournamentId,context:I,drawDefinition:g,matchUp:y}),{...le}):ce({result:{error:p_e},info:"matchUp does not include BYE",stack:I})}({tournamentRecord:e,drawDefinition:i,structure:r,matchUp:o})||!u&&{error:S7}||c&&function(m){const g=fL({...m,removeScore:!0});return g.error?g:uT(m)}(t)||a&&fL(t)||ce({result:{error:cU},stack:"attemptToSetMatchUpStatus"})}function fL(t){var e;const i="scoreModification";if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){const o=ww(t);if(o.error)return ce({result:o,stack:i})}const n=!!t.matchUp.collectionId,r=fu(t);if(n){const{matchUpTieId:o,drawDefinition:a,matchUpsMap:s}=t,l=Od({tournamentRecord:t.tournamentRecord,matchUpId:o,event:t.event,drawDefinition:a,matchUpsMap:s});if(l.error)return ce({result:l,stack:i});Object.assign(r,{tieMatchUpResult:l})}return ce({result:r,stack:i})}function Vhe({drawDefinition:t,structure:e,matchUp:i}){const n=[];if(e.finishingPosition===$0&&Bh({drawDefinition:t,structure:e})){const{structureIds:r}=function({drawDefinition:o,structure:a,matchUp:s}){var l,c;const{drawPositions:u}=s,{positionAssignments:d}=Ki({drawDefinition:o,structure:a}),p=d==null?void 0:d.filter(({drawPosition:v})=>u==null?void 0:u.includes(v)),h=p==null?void 0:p.map(v=>{var y;const{extension:b}=ei({element:v,name:tf});return(y=b==null?void 0:b.value)==null?void 0:y.groupOrder}),{containerStructures:f}=V0({drawDefinition:o}),m=f[a.structureId],g=(c=(l=j0({drawDefinition:o,structureId:m}))==null?void 0:l.links)==null?void 0:c.source;return{structureIds:g==null?void 0:g.filter(v=>{var y;return ua(h,((y=v.source)==null?void 0:y.finishingPositions)||[])}).map(v=>v.source.structureId)}}({drawDefinition:t,structure:e,matchUp:i});r!=null&&r.length&&n.push(...r)}return{connectedStructureIds:n}}function NLe(t){var e,i;const n="attemptToSetWinningSide";let r;const{appliedPolicies:o,disableAutoCalc:a,drawDefinition:s,dualMatchUp:l,winningSide:c,structure:u,matchUp:d}=t;if(l!=null&&l._disableAutoCalc&&a!==!1)return d3(t);if(d.winningSide&&d.winningSide!==c){const{connectedStructureIds:m}=Vhe({drawDefinition:s,structure:u,matchUp:d});m.length&&(console.log({connectedStructureIds:m}),r=!0);const g=ww(t);if(g.error)return g}const p=qde(t);if(p.error)return ce({result:p,stack:n});let h,f;return t.qualifierChanging&&(e=o==null?void 0:o[vR])!=null&&e.autoReplaceQualifiers&&(h=function(m){var g,v,y;let b;const{inContextDrawMatchUps:I,inContextMatchUp:T,drawDefinition:S,winningSide:w}=m,U=(g=m.targetData.targetLinks)==null?void 0:g.winnerTargetLink;if(U.target.feedProfile===Ic){const D=T.sides.find(({sideNumber:C})=>C!==w).participantId,E=I.find(C=>C.structureId===U.target.structureId&&C.roundNumber===U.target.roundNumber&&C.sides.some(({participantId:M})=>M===D));if((E==null?void 0:E.matchUpStatus)===qn&&!Km({inContextDrawMatchUps:I,drawDefinition:S,targetData:pa({matchUpId:E.matchUpId,inContextDrawMatchUps:I,drawDefinition:S})})){const{structure:C}=kt({structureId:E.structureId,drawDefinition:S}),M=Ki({structure:C}).positionAssignments;for(const N of M||[])if(N.participantId===D){const R=T.sides.find(({sideNumber:A})=>A===w).participantId;if(N.participantId=R,C==null?void 0:C.positionAssignments)C.positionAssignments=M;else if(C!=null&&C.structures){const A=Object.assign({},...(M||[]).map(_=>({[_.drawPosition]:_.participantId})));for(const _ of C.structures)(v=_.positionAssignments)==null||v.forEach(k=>k.participantId=A[k.drawPosition])}of({tournamentId:(y=m.tournamentRecord)==null?void 0:y.tournamentId,event:m.event,drawDefinition:S,structure:C}),b=!0}}}return{...le,qualifierReplaced:b}}(t).qualifierReplaced),t.qualifierAdvancing&&(i=o==null?void 0:o[vR])!=null&&i.autoPlaceQualifiers&&(f=function(m){var g,v,y,b,I;let T;const{inContextDrawMatchUps:S,inContextMatchUp:w,drawDefinition:U,winningSide:D}=m,E=(g=m.targetData.targetLinks)==null?void 0:g.winnerTargetLink;if(E.target.feedProfile===Ic){const C=(v=w.sides.find(({sideNumber:N})=>N===D))==null?void 0:v.participantId,M=Al(S.filter(N=>N.structureId===E.target.structureId&&N.roundNumber===E.target.roundNumber&&N.sides.some(({participantId:R,qualifier:A})=>A&&!R)));if((M==null?void 0:M.matchUpStatus)===qn&&!Km({inContextDrawMatchUps:S,drawDefinition:U,targetData:pa({matchUpId:M.matchUpId,inContextDrawMatchUps:S,drawDefinition:U})})){const N=(y=M.sides.find(_=>_.qualifier&&!_.participantId))==null?void 0:y.drawPosition,{structure:R}=kt({structureId:M.structureId,drawDefinition:U});if(!R)return{error:Cn};const A=Ki({structure:R}).positionAssignments;for(const _ of A||[])if(_.drawPosition===N&&!_.participantId){if(_.participantId=C,R.positionAssignments)R.positionAssignments=A;else if(R.structures){const k=Object.assign({},...(A||[]).map(O=>({[O.drawPosition]:O.participantId})));for(const O of R.structures)(b=O.positionAssignments)==null||b.forEach(F=>F.participantId=k[F.drawPosition])}of({tournamentId:(I=m.tournamentRecord)==null?void 0:I.tournamentId,event:m.event,drawDefinition:U,structure:R}),T=!0}}}return{...le,qualifierPlaced:T}}(t).qualifierPlaced),ce({result:It({...le,...p,connectedStructures:r,qualifierReplaced:h,qualifierPlaced:f}),stack:n})}const GE={drawPositionToRemove:"green",iteration:"brightred",winner:"green",loser:"brightred"};function jhe(t){var e;const{inContextDrawMatchUps:i,appliedPolicies:n,drawDefinition:r,matchUpsMap:o,targetData:a,matchUp:s}=t;let{iteration:l=0}=t;l+=1;const c="removeDoubleExit";nl({method:c,color:"brightyellow",iteration:l,keyColors:GE});const{targetLinks:{loserTargetLink:u},targetMatchUps:{loserMatchUp:d,winnerMatchUp:p,loserTargetDrawPosition:h}}=a;if(p&&p.matchUpStatus!==Ri){const{stage:f,roundNumber:m,roundPosition:g}=p;nl({winner:"winner",stage:f,roundNumber:m,roundPosition:g,keyColors:GE}),t8({...t,targetMatchUp:p,sourceMatchUp:s,iteration:l})}if(d&&d.matchUpStatus!==Ri){const f=i.find(({matchUpId:I})=>I===d.matchUpId),{structure:m}=kt({drawDefinition:r,structureId:f.structureId}),{stage:g,roundNumber:v,roundPosition:y,feedRound:b}=d;if(nl({loser:"loser",stage:g,roundNumber:v,roundPosition:y,keyColors:GE,feedRound:b}),(e=n==null?void 0:n.progression)==null?void 0:e.doubleExitPropagateBye)pB({drawPosition:h,targetLink:u,inContextDrawMatchUps:i,drawDefinition:r,matchUpsMap:o});else{const I=t8({...t,structure:m,targetMatchUp:d,iteration:l});if(I.error)return ce({result:I,stack:c})}}return ce({result:{...le},stack:c})}function t8(t){var e,i,n,r,o;const{inContextDrawMatchUps:a,appliedPolicies:s,drawDefinition:l,sourceMatchUp:c,targetMatchUp:u,matchUpsMap:d,structure:p,iteration:h}=t,f="conditionallyRemoveDrawPosition";nl({method:f});const m=pa({matchUpId:u.matchUpId,inContextDrawMatchUps:a,drawDefinition:l}),{targetMatchUps:{winnerMatchUp:g}}=m,v=d==null?void 0:d.drawMatchUps.find(U=>U.matchUpId===u.matchUpId);let y,b,I,T=[];if(u.feedRound){const U=(e=g==null?void 0:g.drawPositions)==null?void 0:e.filter(Boolean);I=U==null?void 0:U.find(D=>u.drawPositions.includes(D))}else if(c){if(b=(i=nde({structureId:p.structureId,matchUp:c,matchUpsMap:d}))==null?void 0:i.pairedPreviousMatchUp,y=[gr,Mr].includes(b==null?void 0:b.matchUpStatus),T=((n=b==null?void 0:b.drawPositions)==null?void 0:n.filter(Boolean))||[],[...no,Ri].includes(b==null?void 0:b.matchUpStatus)||b!=null&&b.winningSide){const U=c.drawPositions||[];let D=(r=u.drawPositions)==null?void 0:r.filter(Boolean);ua(U,D)&&(D=D==null?void 0:D.filter(E=>!U.includes(E))),I=U.concat(T).find(E=>D==null?void 0:D.includes(E))}}else I=(o=sr((u==null?void 0:u.drawPositions)||[],(g==null?void 0:g.drawPositions)||[]))==null?void 0:o[0];if(g&&I){const{stage:U,roundNumber:D,roundPosition:E}=g;nl({method:"removeDirectedWinner",drawPositionToRemove:I,keyColors:GE,color:"brightgreen",stage:U,roundNumber:D,roundPosition:E}),Bhe({winningDrawPosition:I,winnerMatchUp:g,inContextDrawMatchUps:a,drawDefinition:l,matchUpsMap:d})}let S=jhe({targetData:m,matchUp:u,inContextDrawMatchUps:a,appliedPolicies:s,drawDefinition:l,matchUpsMap:d,structure:p,iteration:h});if(S.error)return ce({result:S,stack:f});const w=function({pairedPreviousDoubleExit:U,noContextTargetMatchUp:D}){return D.matchUpStatus===Ri?Ri:U?[Mr,Mi].includes(D==null?void 0:D.matchUpStatus)?Mi:Li:qn}({pairedPreviousDoubleExit:y,noContextTargetMatchUp:v});return S=fu({...t,matchUpStatus:w,removeScore:!y,score:{scoreStringSide1:"",scoreStringSide2:"",sets:void 0},removeWinningSide:!0,matchUp:v,matchUpId:u.matchUpId,matchUpStatusCodes:[]}),S.error?ce({result:S,stack:f}):{...le}}function ALe(t){var e;const{matchUp:i,matchUpStatus:n,score:r,winningSide:o}=t,a="noDownStreamDependencies";if([gr,Mr].includes(i==null?void 0:i.matchUpStatus)&&![gr,Mr].includes(n)){const m=jhe(t);if(m.error)return ce({result:m,stack:a})}const s=n===gr,l=lo({score:r})&&!s&&(t.isCollectionMatchUp&&!t.projectedWinningSide||!o),c=((e=t==null?void 0:t.inContextMatchUp)==null?void 0:e.collectionId)&&function(m){var g;const{matchUpFormat:v,score:y}=m,b=(g=y==null?void 0:y.sets)==null?void 0:g.length,I=v&&Ga(v),{setFormat:T,finalSetFormat:S,bestOf:w}=I??{},U=w&&b===w&&S||T;return(U==null?void 0:U.timed)||!1}(t.inContextMatchUp),u=t.removeScore||!c&&![Cd,Es].includes(n||Cd),d=t.isCollectionMatchUp&&t.dualMatchUp.winningSide&&!t.projectedWinningSide||i.winningSide&&!o&&!lo({score:r}),p=n&&n!==qn,h=m=>{var g,v;let y;const{structure:b,drawDefinition:I,dualMatchUp:T,disableAutoCalc:S}=t;if(T!=null&&T._disableAutoCalc&&S!==!1)return d3(t);const{connectedStructureIds:w}=Vhe({drawDefinition:I,structure:b,matchUp:i});w.length&&(console.log({connectedStructureIds:w}),y=!0),Object.assign(t,{removeScore:m});const U=ww(t);if(U.error)return U;if(t.removingQualifier&&(v=(g=t.appliedPolicies)==null?void 0:g[vR])!=null&&v.autoRemoveQualifiers){const D=function(E){var C,M,N,R,A;let _;const{inContextDrawMatchUps:k,inContextMatchUp:O,drawDefinition:F}=E,B=(C=E.targetData.targetLinks)==null?void 0:C.winnerTargetLink;if(B.target.feedProfile===Ic){const $=(N=(M=O.sides)==null?void 0:M.find(({sideNumber:H})=>H===O.winningSide))==null?void 0:N.participantId,V=k.find(H=>{var z;return H.structureId===B.target.structureId&&H.roundNumber===B.target.roundNumber&&((z=H.sides)==null?void 0:z.some(({participantId:G})=>G===$))});if(V&&V.matchUpStatus===qn&&!Km({inContextDrawMatchUps:k,drawDefinition:F,targetData:pa({matchUpId:V.matchUpId,inContextDrawMatchUps:k,drawDefinition:F})})){const{structure:H}=kt({structureId:V.structureId,drawDefinition:F}),z=Ki({structure:H}).positionAssignments;for(const G of z||[])if(G.participantId===$){if(G.participantId=void 0,H==null?void 0:H.positionAssignments)H.positionAssignments=z;else if(H!=null&&H.structures){const W=Object.assign({},...(z||[]).map(K=>({[K.drawPosition]:K.participantId})));for(const K of(H==null?void 0:H.structures)||[])(R=K.positionAssignments)==null||R.forEach(Z=>Z.participantId=W[Z.drawPosition])}of({tournamentId:(A=E.tournamentRecord)==null?void 0:A.tournamentId,event:E.event,drawDefinition:F,structure:H}),_=!0}}}return{qualifierRemoved:_}}(t);return{...le,connectedStructures:y,...D}}return{...le,connectedStructures:y}};if(d&&o&&t.isCollectionMatchUp)return i8(t);const f=[Yp,Es].includes(n)&&t.dualWinningSideChange;return ce({result:(o||f)&&NLe(t)||l&&h(u)||p&&RLe(t)||d&&h(u)||i&&i8({...t,removeScore:!0})||{...le},stack:a})}function i8(t){var e;if(t.isCollectionMatchUp&&(e=t.dualMatchUp)!=null&&e.winningSide&&!t.projectedWinningSide){const n=ww(t);if(n.error)return n}const i=fu({...t});if(t.isCollectionMatchUp){const{matchUpTieId:n,drawDefinition:r,event:o,matchUpsMap:a}=t,{removeWinningSide:s}=Od({tournamentRecord:t.tournamentRecord,matchUpId:n,drawDefinition:r,matchUpsMap:a,event:o});s&&console.log("REMOVE WINNING SIDE")}return ce({result:i,stack:"scoreModification"})}function fx({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:o,matchUpId:a,courtIds:s}){var l,c;if(!i&&!e)return{error:je};if(!a)return{error:co};const u=vn({drawDefinition:n,matchUpId:a});if(u.error)return u;if(((l=u==null?void 0:u.matchUp)==null?void 0:l.matchUpType)!==Ad)return{error:ja};if(!(s===void 0||Array.isArray(s)&&s.length&&s.every(p=>typeof p=="string")))return{error:Re,context:{courtIds:s}};let d;if(s){const p=eh({tournamentRecords:e||i&&{[i.tournamentId]:i}});if(p.error)return p;const h=(c=p.courts)==null?void 0:c.filter(f=>s.includes(f.courtId));if((h==null?void 0:h.length)!==s.length)return{error:Re,context:{courtIds:s}};d=h==null?void 0:h.map(f=>({venueId:f.venueId,courtId:f.courtId}))}return Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:sf,itemDate:o,itemValue:d}})}function Z0({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,venueId:a}){if(!i)return{error:je};if(!o)return{error:co};if(a){const s=Jp({tournamentRecords:e,tournamentRecord:i,venueId:a});if(s.error)return s}return Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:ZP,itemValue:a}})}function fb({removePriorValues:t,tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,courtDayDate:o,matchUpId:a,courtId:s}){var l;if(!i&&!e)return{error:je};if(!a)return{error:co};if(s){const c=nb({tournamentRecords:e,tournamentRecord:i,courtId:s});if(c.error)return c;const u=(l=c.venue)==null?void 0:l.venueId;Z0({tournamentRecords:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,venueId:u})}return Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:a,timeItem:{itemType:iy,itemDate:o,itemValue:s}})}function uf(t){const e="addMatchUpScheduledTime";let i=t.matchUp;const{removePriorValues:n,tournamentRecord:r,drawDefinition:o,disableNotice:a,scheduledTime:s,matchUpId:l}=t;if(!l)return ce({result:{error:co},stack:e});if(!k0(s))return ce({result:{error:hc},stack:e});if(!i){const f=vn({drawDefinition:o,matchUpId:l});if(f.error)return ce({result:f,stack:e});i=f.matchUp}const c=zt(s),u=qm({matchUp:i}).scheduledDate,d=c&&!u,p=xW({matchUp:i}).timeModifiers||[];if(p!=null&&p.length){const f=Hhe({disableNotice:!0,removePriorValues:n,tournamentRecord:r,timeModifiers:[],drawDefinition:o,matchUpId:l,matchUp:i});if(f!=null&&f.error)return ce({result:f,stack:e})}const h=qy(s,!0,d);return Ns({duplicateValues:!1,removePriorValues:n,tournamentRecord:r,drawDefinition:o,disableNotice:a,matchUpId:l,timeItem:{itemType:JP,itemValue:h}})}function Hhe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,timeModifiers:r,matchUpId:o,matchUp:a}){const s="addMatchUpTimeModifiers";if(!o)return ce({result:{error:co},stack:s});if(r!==void 0&&!Array.isArray(r))return ce({info:_d("timeModifiers"),result:{error:Re},stack:s});if(!a){const d=vn({drawDefinition:i,matchUpId:o});if(d.error)return ce({result:d,stack:s});a=d.matchUp}let l=xW({matchUp:a}).timeModifiers||[];const c=r.filter(d=>!l.includes(d));if(r.length&&!c.length)return{...le};if(c.some(d=>O7.includes(d))){l=l.filter(p=>!O7.includes(p));const d=uf({disableNotice:!0,removePriorValues:t,scheduledTime:"",tournamentRecord:e,drawDefinition:i,matchUpId:o});if(d.error)return ce({result:d,stack:s})}const u=r!=null&&r.length?[...c,...l]:void 0;return Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:Nue,itemValue:u}})}function cu(t,e){const i=Ece.test(t)?t:mn(t),n=zt(t)||zt(e)||Mc(new Date);return new Date(`${n}T${i}`).getTime()}function mx({errorOnAnachronism:t=!1,checkChronology:e=!0,matchUpDependencies:i,inContextMatchUps:n,removePriorValues:r,tournamentRecords:o,tournamentRecord:a,drawDefinition:s,disableNotice:l,drawMatchUps:c,matchUpId:u,schedule:d,event:p}){var h;if(!d)return{error:bt,info:"Missing schedule"};if(!s)return{error:rt};if(!u)return{error:co};const f="addMatchUpScheduleItems";let m,g;if(c)m=c.find(N=>N.matchUpId===u);else{const N=vn({drawDefinition:s,event:p,matchUpId:u});if(N.error)return N;m=N.matchUp}const{endTime:v,courtId:y,courtIds:b,courtOrder:I,resumeTime:T,scheduledDate:S,scheduledTime:w,startTime:U,stopTime:D,timeModifiers:E,venueId:C}=d;!e||i&&n||({matchUpDependencies:i,matchUps:n}=rc({drawDefinition:s}));const M=(h=i==null?void 0:i[u])==null?void 0:h.matchUpIds;if(d.scheduledDate&&e&&M){const N=n==null?void 0:n.filter(R=>{var A,_;return(((A=R.schedule)==null?void 0:A.scheduledDate)||zt((_=R.schedule)==null?void 0:_.scheduledTime))&&M.includes(R.matchUpId)}).map(({schedule:R})=>{const A=hR(R);return new Date(A).getTime()});if(N!=null&&N.length){const R=hR(d),A=new Date(R).getTime();if(Math.max(...N)>=A){if(t)return ce({result:{error:b7},stack:f});g=b7}}}if(S!==void 0){const N=gx({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,scheduledDate:S,matchUpId:u});if(N!=null&&N.error)return ce({result:N,stack:f,context:{scheduledDate:S}})}if(w!==void 0){const N=uf({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,scheduledTime:w,matchUpId:u,matchUp:m});if(N!=null&&N.error)return ce({result:N,stack:f,context:{scheduledTime:w}})}if(U!==void 0){const N=Uq({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,startTime:U,event:p});if(N!=null&&N.error)return ce({result:N,stack:f,context:{startTime:U}})}if(D!==void 0){const N=Pq({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,stopTime:D,event:p});if(N!=null&&N.error)return ce({result:N,stack:f,context:{stopTime:D}})}if(T!==void 0){const N=Cq({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,resumeTime:T,matchUpId:u,event:p});if(N!=null&&N.error)return ce({result:N,stack:f,context:{resumeTime:T}})}if(v!==void 0){const N=Dq({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,endTime:v,event:p});if(N!=null&&N.error)return ce({result:N,stack:f,context:{endTime:v}})}if(b!==void 0){const N=fx({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,matchUpId:u,courtIds:b});if(N!=null&&N.error)return ce({result:N,stack:f,context:{courtIds:b}})}if(y!==void 0&&S!==void 0){const N=fb({courtDayDate:S,disableNotice:!0,removePriorValues:r,tournamentRecords:o,tournamentRecord:a,drawDefinition:s,matchUpId:u,courtId:y});if(N!=null&&N.error)return ce({result:N,stack:f,context:{courtId:y}})}if(C!==void 0){const N=Z0({disableNotice:!0,removePriorValues:r,tournamentRecords:o,tournamentRecord:a,drawDefinition:s,matchUpId:u,venueId:C});if(N!=null&&N.error)return ce({result:N,stack:f,context:{venueId:C}})}if(I!==void 0&&$t(I)){const N=Tq({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,courtOrder:I,matchUpId:u});if(N!=null&&N.error)return ce({result:N,stack:f,context:{courtOrder:I}})}if(E!==void 0){const N=Hhe({disableNotice:!0,removePriorValues:r,tournamentRecord:a,drawDefinition:s,timeModifiers:E,matchUpId:u,matchUp:m});if(N!=null&&N.error)return ce({result:N,stack:f,context:{timeModifiers:E}})}return l||Ci({tournamentId:a==null?void 0:a.tournamentId,eventId:p==null?void 0:p.eventId,context:f,drawDefinition:s,matchUp:m}),g?{...le,warnings:[g]}:{...le}}function gx({scheduledDate:t,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o}){if(!o)return{error:co};const a=t&&Mu.test(t);return t&&!a?{error:Ha}:Ns({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemValue:zt(t),itemType:XP}})}function Tq({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,courtOrder:r,matchUpId:o}){if(!o)return{error:co};if(r&&!$t(r))return{error:Re,info:"courtOrder must be numeric"};const a=r&&Ct(r);return Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemType:Rue,itemValue:a}})}function Ghe({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,participantId:r,officialType:o,matchUpId:a}){if(!a)return{error:co};if(!r)return{error:Hr};if(e&&!ef({tournamentParticipants:Qn({tournamentRecord:e,participantFilters:{participantTypes:[ui],participantRoles:[Yue]}}).participants??[],participantId:r}))return{error:rr};const s={itemType:"SCHEDULE.ASSIGNMENT.OFFICIAL",itemValue:r};return o&&(s.itemSubTypes=[o]),Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:a,timeItem:s})}function Uq({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,startTime:o,event:a}){if(!r)return{error:co};if(!k0(o))return{error:hc};const{matchUp:s}=vn({drawDefinition:i,event:a,matchUpId:r}),{scheduledDate:l}=qm({matchUp:s}),c=((s==null?void 0:s.timeItems)??[]).filter(u=>[Oh,sp,Lh].includes(u==null?void 0:u.itemType)).map(u=>cu(u.itemValue,l)).reduce((u,d)=>!u||d<u?d:u,void 0);if(!c||cu(o,l)<c){s!=null&&s.timeItems&&(s.timeItems=s.timeItems.filter(d=>d.itemType!==ru));const u=qy(o,!0,!0);return Ns({duplicateValues:!1,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemType:ru,itemValue:u}})}return{error:$_e}}function Dq({validateTimeSeries:t=!0,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,endTime:a,event:s}){if(!o)return{error:co};if(!k0(a))return{error:hc};const{matchUp:l}=vn({drawDefinition:n,event:s,matchUpId:o}),{scheduledDate:c}=qm({matchUp:l}),u=((l==null?void 0:l.timeItems)??[]).filter(d=>[ru,sp,Oh].includes(d==null?void 0:d.itemType)).map(d=>cu(d.itemValue,c)).reduce((d,p)=>!d||p>d?p:d,void 0);if(!t||!u||cu(a,c)>u){l!=null&&l.timeItems&&(l.timeItems=l.timeItems.filter(p=>p.itemType!==Lh));const d=qy(a,!0,!0);return Ns({duplicateValues:!1,removePriorValues:e,tournamentRecord:i,drawDefinition:n,disableNotice:r,matchUpId:o,timeItem:{itemType:Lh,itemValue:d}})}return{error:F_e}}function Pq({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,stopTime:o,event:a}){if(!r)return{error:co};if(!k0(o))return{error:hc};const{matchUp:s}=vn({drawDefinition:i,event:a,matchUpId:r}),{scheduledDate:l}=qm({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Lh||f,void 0))return{error:fce};const u=c.filter(f=>[ru,sp,Oh].includes(f==null?void 0:f.itemType)).sort((f,m)=>cu(f.itemValue,l)-cu(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===Oh,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>cu(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(cu(o,l)>h){if(s!=null&&s.timeItems&&p){const f=d.createdAt;s.timeItems=s.timeItems.filter(m=>m.createdAt!==f)}return Ns({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:r,timeItem:{itemValue:qy(o,!0,!0),itemType:Oh}})}return{error:B_e}}function Cq({removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,resumeTime:r,matchUpId:o,event:a}){if(!o)return{error:co};if(!k0(r))return{error:hc};const{matchUp:s}=vn({drawDefinition:i,event:a,matchUpId:o}),{scheduledDate:l}=qm({matchUp:s}),c=(s==null?void 0:s.timeItems)??[];if(c.reduce((f,m)=>m.itemType===Lh||f,void 0))return{error:fce};const u=c.filter(f=>[ru,sp,Oh].includes(f==null?void 0:f.itemType)).sort((f,m)=>cu(f.itemValue,l)-cu(m.itemValue,l)),d=u[u.length-1],p=d&&d.itemType===sp,h=u.filter(f=>!p||f.createdAt!==d.createdAt).map(f=>cu(f.itemValue,l)).reduce((f,m)=>!f||m>f?m:f,void 0);if(cu(r,l)>h){if(s!=null&&s.timeItems&&p){const f=d.createdAt;s.timeItems=s.timeItems.filter(m=>m.createdAt!==f)}return Ns({duplicateValues:!0,removePriorValues:t,tournamentRecord:e,drawDefinition:i,disableNotice:n,matchUpId:o,timeItem:{itemValue:qy(r,!0,!0),itemType:sp}})}return{error:V_e}}function vx(t){var e,i,n,r;const o="setMatchUpStatus";t.matchUpStatus&&[Li,gr].includes(t.matchUpStatus)&&(t.score=void 0);const{allowChangePropagation:a,disableScoreValidation:s,tournamentRecords:l,tournamentRecord:c,disableAutoCalc:u,enableAutoCalc:d,drawDefinition:p,matchUpStatus:h,winningSide:f,matchUpId:m,event:g,score:v}=t;if(!p)return{error:rt};if(h&&[Yp,Cd,Es,qn].includes(h)&&f)return{error:Re,winningSide:f,matchUpStatus:h};if(![void 0,...Ske].includes(h))return ce({result:{error:cU},info:"matchUpStatus does not exist",stack:"setMatchUpStatus"});const y=ma({drawDefinition:p}),{matchUps:b}=Ar({nextMatchUps:!0,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g}),I=y.drawMatchUps.find(G=>G.matchUpId===m),T=b==null?void 0:b.find(G=>G.matchUpId===m);if(!I||!b)return{error:xo};if((I.winningSide||f)&&h===Ri)return{context:"Cannot have Bye with winningSide",error:GO,matchUpStatus:h};const S=T==null?void 0:T.structureId,{structure:w}=kt({drawDefinition:p,structureId:S}),U=(e=T==null?void 0:T.drawPositions)==null?void 0:e.filter(Boolean);let D;if(I.matchUpType===gn){if(u)Ii({extension:{name:cw,value:!0},element:I});else if(d){const G=I.winningSide;ia({name:cw,element:I});const{winningSide:W,scoreStringSide1:K,scoreStringSide2:Z,set:Y}=OR({drawDefinition:p,matchUpsMap:y,structure:w,matchUp:I,event:g}),X={scoreStringSide1:K,scoreStringSide2:Z,sets:Y?[Y]:[]};D=W!==G,Object.assign(t,{winningSide:W,dualWinningSideChange:D,projectedWinningSide:W,score:X})}yC({tournamentId:c==null?void 0:c.tournamentId,inContextDualMatchUp:T,eventId:g==null?void 0:g.eventId,drawDefinition:p,dualMatchUp:I})}if(I.matchUpType===gn&&h&&[F0].includes(h))return{error:Re,info:"Not supported for matchUpType: TEAM"};const E=T==null?void 0:T.matchUpTieId,C=pa({matchUpId:E||m,inContextDrawMatchUps:b,drawDefinition:p});if(v&&I.matchUpType!==gn&&!s){const G=I.matchUpFormat??(w==null?void 0:w.matchUpFormat)??(p==null?void 0:p.matchUpFormat)??(g==null?void 0:g.matchUpFormat),W=Mpe({existingMatchUpStatus:I.matchUpStatus,matchUpFormat:G,matchUpStatus:h,winningSide:f,score:v});if(W.error)return W}const M=I!=null&&I.sides?[]:Ki({drawDefinition:p,structureId:S}).positionAssignments,N=((i=T==null?void 0:T.sides)==null?void 0:i.map(G=>G.participantId).filter(Boolean).length)===2||(U==null?void 0:U.length)===2&&(M==null?void 0:M.filter(G=>U.includes(G.drawPosition)).every(G=>G.participantId));if(h&&wke.includes(h)&&!N)return ce({info:"present in participantRequiredMatchUpStatuses",context:{matchUpStatus:h,bothSideParticipants:N},result:{error:cU}});const R=((n=Gi({policyTypes:[vR],tournamentRecord:c,drawDefinition:p,event:g}))==null?void 0:n.appliedPolicies)??{};typeof t.policyDefinitions=="object"&&Object.assign(R,t.policyDefinitions);const A=(T==null?void 0:T.stage)===St&&T.finishingRound===1,_=A&&f,k=A&&I.winningSide&&!f&&(!t.matchUpStatus||t.matchUpStatus&&G2({matchUpStatus:t.matchUpStatus}))&&(!t.outcome||!lo({outcome:t.outcome})),O=_&&f!==I.winningSide&&I.winningSide;if(Object.assign(t,{inContextDrawMatchUps:b,qualifierAdvancing:_,qualifierChanging:O,removingQualifier:k,inContextMatchUp:T,appliedPolicies:R,matchUpTieId:E,matchUpsMap:y,targetData:C,structure:w,matchUp:I}),E){const{matchUp:G}=vn({matchUpId:E,inContext:!0,drawDefinition:p,matchUpsMap:y,event:g});if(G){const W=(r=jo({matchUp:G,drawDefinition:p,structure:w,event:g}))==null?void 0:r.tieFormat,{projectedWinningSide:K}=function({drawDefinition:Z,matchUpStatus:Y,matchUpsMap:X,winningSide:Q,dualMatchUp:te,tieFormat:J,structure:ie,matchUp:oe,event:ne,score:re}){var me;const he=ft(te,void 0,!0);for(const Se of(he==null?void 0:he.tieMatchUps)||[])Se.matchUpId===oe.matchUpId&&(Se.winningSide=Q,Se.score=re,lo({score:re})||Y?Y&&(Se.matchUpStatus=Y):Object.assign(Se,{...Lk}));J=J??((me=jo({matchUp:oe,structure:ie,drawDefinition:Z,event:ne}))==null?void 0:me.tieFormat);const{winningSide:be}=OR({matchUp:he,drawDefinition:Z,matchUpsMap:X,structure:ie,tieFormat:J,event:ne});return{projectedWinningSide:be}}({drawDefinition:p,matchUpStatus:h,dualMatchUp:G,matchUpsMap:y,winningSide:f,tieFormat:W,structure:w,matchUp:I,event:g,score:v});D=K!==G.winningSide,Object.assign(t,{isCollectionMatchUp:!0,dualWinningSideChange:D,projectedWinningSide:K,matchUpTieId:E,dualMatchUp:G,tieFormat:W})}}const F=Km(t),B=YP({matchUpStatus:h});if(!E){if(F&&!f&&(h&&G2({matchUpStatus:h})||h&&[gr,Mr].includes(h)))return{error:GO,activeDownstream:F,winningSide:f};if(f&&f===I.winningSide&&h&&!B)return{context:"winningSide must include directing matchUpStatus",error:GO,directingMatchUpStatus:B,matchUpStatus:h}}const{schedule:$}=t;if($){const G=mx({disableNotice:!0,tournamentRecords:l,tournamentRecord:c,drawDefinition:p,matchUpId:m,schedule:$});if(G.error)return G}const V=I.matchUpType!==gn&&!D&&f&&I.winningSide&&I.winningSide!==f;if(a&&V&&I.roundPosition)return function(G){var W;const{tournamentRecord:K,inContextMatchUp:Z,structure:Y,drawDefinition:X}=G,Q=Z.roundNumber,te=Z.sides.find(Ae=>Ae.sideNumber===Z.winningSide),J=Z.sides.find(Ae=>Ae.sideNumber!==Z.winningSide),{drawPosition:ie,participantId:oe}=te,{drawPosition:ne,participantId:re}=J,{matchUps:me}=zi(G),he=me.filter(({drawPositions:Ae,roundNumber:ve})=>(Ae==null?void 0:Ae.includes(ie))&&ve>Q);Wl({changeWinner:!0})&&console.log({existingWinnerSubsequentMatchUps:he}),he.forEach(Ae=>{var ve,ke;Ae.drawPositions=((ve=Ae.drawPositions)==null?void 0:ve.map(ye=>ye===ie?ne:ye))||[],Ci({tournamentId:K==null?void 0:K.tournamentId,eventId:(ke=G.event)==null?void 0:ke.eventId,context:"swapWinnerLoser",drawDefinition:X,matchUp:Ae})});const{stage:be,stageSequence:Se}=Y,De=X.structures.filter(({stage:Ae,stageSequence:ve})=>Ae===be&&ve>Se).map(({structureId:Ae})=>Ae),{targetLinks:{loserTargetLink:Oe,winnerTargetLink:xe}}=G.targetData,$e=[Oe==null?void 0:Oe.target.structureId,(W=xe==null?void 0:xe.target)==null?void 0:W.structureId].filter(Boolean);return X.structures.filter(({stage:Ae,structureId:ve})=>Ae!==be&&$e.includes(ve)).forEach(({stage:Ae,stageSequence:ve,structureId:ke})=>{De.includes(ke)||De.push(ke),X.structures.filter(({stage:ye,stageSequence:Ie})=>ye===Ae&&Ie>ve).forEach(({structureId:ye})=>{De.includes(ye)||De.push(ye)})}),X.structures.filter(({structureId:Ae})=>De.includes(Ae)).forEach(Ae=>{const{positionAssignments:ve}=Ki({structure:Ae}),ke=ve==null?void 0:ve.find(({participantId:Ie})=>Ie===oe),ye=ve==null?void 0:ve.find(({participantId:Ie})=>Ie===re);ke&&(ke.participantId=re),ye&&(ye.participantId=oe)}),fu(G)}(t);const H=f&&!E||t.projectedWinningSide;nl({method:o,activeDownstream:F,matchUpWinner:H,winningSide:f});const z=!F&&ALe(t)||H&&function(G){const{matchUp:W,winningSide:K,matchUpTieId:Z,dualWinningSideChange:Y}=G;return K===W.winningSide||Z&&!Y?n8(G):ce({stack:"winningSideWithDownstreamDependencies",result:{error:cce},context:{winningSide:K,matchUp:W}})}(t)||B&&n8(t)||{error:Y_e};return ce({result:z,stack:o})}function n8(t){const{tournamentRecord:e,matchUp:i,event:n}=t,r=t.isCollectionMatchUp&&i.winningSide&&!t.winningSide&&!lo({score:t.score}),o=t.isCollectionMatchUp?t.matchUpStatus||r&&qn||fr:t.matchUpStatus||fr,a=t.removeScore||[Yp,Li].includes(o)&&![Cd,Es].includes(o),s=fu({...t,matchUpStatus:o,removeWinningSide:r,removeScore:a});if(s.error)return s;if(t.isCollectionMatchUp){const{matchUpTieId:l,drawDefinition:c,matchUpsMap:u}=t,d=Od({matchUpId:l,tournamentRecord:e,drawDefinition:c,matchUpsMap:u,event:n});if(d.error)return d;Object.assign(s,{tieMatchUpResult:d})}return s}function zhe({tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n}){if(!e)return{error:rt};const{matchUp:r}=vn({drawDefinition:e,matchUpId:i,event:n});return(r==null?void 0:r.matchUpType)!==Ad?{error:ja}:vx({enableAutoCalc:!0,tournamentRecord:t,drawDefinition:e,matchUpId:i,event:n})}function Whe({drawDefinition:t,event:e,matchUpId:i}){if(!t)return{error:rt};if(!i)return{error:co};const{matchUp:n}=vn({drawDefinition:t,event:e,matchUpId:i});return n?ia({name:lk,element:n}):{error:xo}}function qhe(t){return function({substituteParticipantId:e,existingParticipantId:i,tournamentRecord:n,drawDefinition:r,sideNumber:o,matchUpId:a,event:s}){var l,c,u;const d="substituteParticipant";if(!r)return{error:rt};if(!a)return{error:co};if(!i||!e)return ce({result:{error:Hr},stack:d});const{matchUp:p}=vn({drawDefinition:r,matchUpId:a,event:s});if(!p)return{error:xo};if(!p.collectionId)return ce({result:{error:ja},stack:d});const h=ma({drawDefinition:r}),{matchUps:f}=Ar({tournamentParticipants:n==null?void 0:n.participants,inContext:!0,drawDefinition:r,matchUpsMap:h}),m=f==null?void 0:f.find(b=>b.matchUpId===a),g=f==null?void 0:f.find(b=>b.matchUpId===(m==null?void 0:m.matchUpTieId)),v=(l=g==null?void 0:g.sides)==null?void 0:l.find(b=>b.participant.individualParticipants.some(({participantId:I})=>I===i));if(!v||o&&v.sideNumber!==o)return{error:Dd};const y=(u=(c=v.participant)==null?void 0:c.individualParticipants)==null?void 0:u.map(li).filter(b=>b!==i);return y!=null&&y.includes(e)?Sq({newParticipantId:e,tieMatchUpId:a,existingParticipantId:i,substitution:!0,tournamentRecord:n,drawDefinition:r,event:s}):ce({result:{error:Dd},stack:d})}(t)}function Yhe({drawDefinition:t,matchUpId:e,event:i}){if(!t)return{error:rt};const{matchUp:n}=vn({drawDefinition:t,matchUpId:e,event:i});return Ii({extension:{name:cw,value:!0},element:n})}function Khe(t){const e="setMatchUpFormat",{tournamentRecord:i,drawDefinition:n,scheduledDates:r,stageSequences:o,matchUpFormat:a,structureId:s,eventType:l,matchUpId:c,eventId:u,stages:d,drawId:p,event:h,force:f}=t;if(!i)return{error:je};if(!a)return{error:Yz};if(a&&!Rs({matchUpFormat:a}))return ce({result:{error:K_,matchUpFormat:a},stack:e});if(r&&!Array.isArray(r))return ce({result:{error:Re,scheduledDates:r},stack:e});if(l&&![Np,Bc].includes(l))return ce({result:{error:Lm},stack:e});let m=0;const g=t.structureIds||s&&[s].filter(Boolean)||[],v=t.eventIds||u&&[u].filter(Boolean)||[],y=t.drawIds||p&&[p].filter(Boolean)||[];if((s||g!=null&&g.length)&&!n)return ce({result:{error:rt},stack:e});if(p&&c&&n){const I=rq({tournamentRecord:i,drawDefinition:n,matchUpFormat:a,structureIds:g,structureId:s,matchUpId:c});if(I.error)return I;m+=1}const b=I=>{const T=[];for(const S of I.structures||[]){if(Array.isArray(d)&&!d.includes(S.stage)||Array.isArray(o)&&!o.includes(S.stageSequence)||g!=null&&g.length&&!g.includes(S.structureId))continue;g!=null&&g.length&&S.matchUpFormat!==a&&(S.matchUpFormat=a,T.push(S.structureId),m+=1);const w=(f||r)&&zi({matchUpFilters:{matchUpStatuses:[qn]},structure:S}).matchUps,U=r&&zi({matchUpFilters:{matchUpStatuses:[qn]},contextFilters:{scheduledDates:r},afterRecoveryTimes:!1,inContext:!0,structure:S}).matchUps;if(w!=null&&w.length){const D=U?U.map($r):w.map($r);for(const E of w)D.includes(E.matchUpId)&&(E.matchUpFormat=r!=null&&r.length?a:void 0,Ci({tournamentId:i==null?void 0:i.tournamentId,eventId:h==null?void 0:h.eventId,context:e,drawDefinition:I,matchUp:E}))}}return T.length||I.matchUpFormat===a||(I.matchUpFormat=a,m+=1),T};for(const I of i.events||[])if(!(v!=null&&v.length&&!v.includes(I.eventId)||l&&l!==I.eventType||l===Yr))if(Array.isArray(o)||Array.isArray(d)||g!=null&&g.length||y!=null&&y.length)for(const T of I.drawDefinitions||[])Array.isArray(y)&&!y.includes(T.drawId)||un({structureIds:b(T),drawDefinition:T});else I.matchUpFormat!==a&&(I.matchUpFormat=a,m+=1);return m?{...le,modificationsCount:m}:{...le,info:BP}}function Zhe({inheritance:t=!0,tournamentRecord:e,drawDefinition:i,matchUpId:n,event:r}){var o,a;if(!i)return{error:rt};const s=(o=vn({drawDefinition:i,matchUpId:n}))==null?void 0:o.matchUp;if(!(s!=null&&s.tieMatchUps))return{error:ja};const l=(a=vn({inContext:!0,drawDefinition:i,matchUpId:n,event:r}))==null?void 0:a.matchUp;let c=0;return((s==null?void 0:s.sides)||[]).forEach(u=>{u.lineUp&&delete u.lineUp}),((l==null?void 0:l.sides)||[]).forEach(u=>{if(c+=1,t===!1){const d=l==null?void 0:l.tieFormat,p=u.participantId;d&&p&&cb({drawDefinition:i,participantId:p,lineUp:[],tieFormat:d})}Ci({tournamentId:e==null?void 0:e.tournamentId,context:"resetMatchUpLineUps",eventId:r==null?void 0:r.eventId,drawDefinition:i,matchUp:s})}),{...le,modificationsCount:c}}function Xhe(t){const{matchUpFormat:e,matchUpStatus:i,winningSide:n,score:r}=t;if(!r)return{sets:[]};const o=r.sets||[];let a=Kd({winnerFirst:!1,matchUpFormat:e,matchUpStatus:i,sets:o}),s=Kd({winnerFirst:!1,reversed:!0,matchUpFormat:e,matchUpStatus:i,sets:o});const l=Kd({matchUpFormat:e,matchUpStatus:i,winningSide:n,sets:o}),c=a===l?s:a;return n&&(a=n===1?l:c,s=n===2?l:c),{score:{sets:o,scoreStringSide1:a,scoreStringSide2:s}}}function NC(t){var e;const i=Vu(t);if(!t.drawDefinition){const v=t.tournamentRecord??(t.tournamentId&&i[t.tournamentId]);t.tournamentRecord||(t.tournamentRecord=v);const y=us({eventId:t.eventId,drawId:t.drawId,tournamentRecord:v});if(y.error)return y;y.drawDefinition&&(t.drawDefinition=y.drawDefinition),t.event=y.event}const{disableScoreValidation:n,policyDefinitions:r,tournamentRecord:o,disableAutoCalc:a,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:u,schedule:d,event:p,notes:h}=t;if(!l)return{error:Yc};if(!u)return{error:co};const{policy:f}=Tg({policyType:jm,tournamentRecord:o,event:p}),m=t.allowChangePropagation!==void 0&&t.allowChangePropagation||(f==null?void 0:f.allowChangePropagation)!==void 0&&f.allowChangePropagation||void 0,{outcome:g}=t;if(c){const v=rq({tournamentRecord:o,drawDefinition:l,matchUpFormat:c,matchUpId:u,event:p});if(v.error)return v}if((e=g==null?void 0:g.score)!=null&&e.sets&&!g.score.scoreStringSide1){const{score:v}=Xhe(g);g.score=v,g.score.sets=g.score.sets.filter(y=>y.side1Score||y.side2Score||y.side1TiebreakScore||y.side2TiebreakScore)}return vx({matchUpStatusCodes:g==null?void 0:g.matchUpStatusCodes,matchUpStatus:g==null?void 0:g.matchUpStatus,winningSide:g==null?void 0:g.winningSide,allowChangePropagation:m,disableScoreValidation:n,score:g==null?void 0:g.score,tournamentRecords:i,policyDefinitions:r,tournamentRecord:o,disableAutoCalc:a,enableAutoCalc:s,drawDefinition:l,matchUpFormat:c,matchUpId:u,schedule:d,event:p,notes:h})}function Jhe(t){if(!(t!=null&&t.outcomes))return{error:bt};if(!Array.isArray(t.outcomes))return{error:bt,info:{outcomes:t.outcomes}};const e=t.tournamentRecords||t.tournamentRecord&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord}||{},i=t.outcomes??[],n=i.reduce((r,o)=>r.includes(o.tournamentId)?r:r.concat(o.tournamentId),[]);for(const r of n){const o=e[r];if(!o)return{error:je};const a=i.filter(s=>s.tournamentId===r);if(a.length){const s=_Le({outcomes:a,tournamentRecord:o});if(s.error)return s}}return{...le}}function _Le(t){var e;const{tournamentRecords:i,tournamentRecord:n,outcomes:r,policyDefinitions:o}=t,a={};r.forEach(s=>{const{eventId:l}=s;a[l]||(a[l]=[]),a[l].push(s)});for(const s of Object.keys(a)){const{event:l}=us({tournamentRecord:n,eventId:s});for(const c of a[s]){const{drawId:u}=c,d=(e=l==null?void 0:l.drawDefinitions)==null?void 0:e.find(p=>p.drawId===u);if(d&&u){const{matchUpFormat:p,matchUpId:h}=c,f=NC({schedule:c==null?void 0:c.schedule,tournamentRecords:i,policyDefinitions:o,tournamentRecord:n,drawDefinition:d,matchUpFormat:p,matchUpId:h,outcome:c,drawId:u,event:l});if(f.error)return f}}}return{...le}}function Qhe(t){return function({drawDefinition:e,matchUpId:i,outcome:n,matchUp:r}){var o,a;if(!r&&!e)return{error:rt};if(!n)return{error:bt,info:"missing outcome"};if(!r&&!i)return{error:Cs};if(!r){const s=vn({drawDefinition:e,matchUpId:i});if(s.error)return s;r=s.matchUp}return typeof n=="object"&&(o=n.score)!=null&&o.scoreStringSide1&&(a=n.score)!=null&&a.scoreStringSide2?Ii({element:r,extension:{name:lk,value:n}}):{error:Re}}(t)}function efe(t){return function({drawDefinition:e,finishingOrder:i}){var n;if(!e)return{error:rt};const r="setOrderOfFinish";if(!Array.isArray(i))return ce({info:_d("finishingOrder"),result:{error:Re},stack:r});const{completedMatchUps:o,matchUpsMap:a}=H0({inContext:!0,drawDefinition:e}),s=(o==null?void 0:o.map($r))??[],l=i.map($r),{matchUpTypes:c,roundNumbers:u,structureIds:d,matchUpTieIds:p}=(o??[]).filter(({matchUpId:b})=>l.includes(b)).reduce((b,I)=>{const{matchUpTieId:T,matchUpType:S,roundNumber:w,structureId:U}=I;return b.matchUpTypes.includes(S)||b.matchUpTypes.push(S),b.roundNumbers.includes(w)||b.roundNumbers.push(w),b.structureIds.includes(U)||b.structureIds.push(U),b.matchUpTieIds.includes(T)||b.matchUpTieIds.push(T),b},{matchUpTypes:[],roundNumbers:[],structureIds:[],matchUpTieIds:[]});if(c.length>1||p.length>1||u.length>1||d.length>1)return ce({info:"matchUpType, structureId and roundNumber must be equivalent",result:{error:Re},stack:r});let h,f;const m={},g=[],v=[];if(!i.every(({orderOfFinish:b,matchUpId:I})=>(g.push(I),b&&v.push(b),m[I]=b,h=s.includes(I),f=b===void 0||$t(b)&&Math.floor(b)>0,h&&f)))return ce({result:{error:h?Re:cU},info:(h?!f&&"orderOfFinish must be integer > 0 or undefined":"matchUps must be completed")||void 0,stack:r});const y=o==null?void 0:o.filter(b=>b.structureId===d[0]&&b.roundNumber===u[0]&&b.matchUpType===c[0]&&b.matchUpTieId===p[0]&&!g.includes(b.matchUpId));for(const b of y??[]){const{orderOfFinish:I}=b||{};if(I){if(!$t(I))return ce({context:{orderOfFinish:I,matchUp:b},result:{error:Re},stack:r});v.push(I)}}if(zle(v).length!==v.length||Math.max(...v)>v.length)return ce({info:"Values not unique or greater than expected number of values",result:{error:Re},stack:r});if(d.length){const b=Ek({matchUpFilters:{matchUpIds:l},structureId:d[0],drawDefinition:e,matchUpsMap:a});if(b.error)return ce({result:b,stack:r});(n=b.completedMatchUps)==null||n.forEach(I=>I.orderOfFinish=m[I.matchUpId])}return{...le}}(t)}function tfe({tournamentRecord:t,drawDefinition:e,matchUpId:i,lineUps:n,event:r}){var o,a,s,l;if(!t)return{error:je};if(!e)return{error:ml};if(typeof i!="string")return{error:ja};if(!Array.isArray(n))return{error:Re,lineUps:n};const c=t.participants||[];let u=vn({tournamentParticipants:c,inContext:!0,drawDefinition:e,matchUpId:i});if(u.error)return u;if(!u.matchUp)return{error:xo};const{matchUp:d,structure:p}=u,{drawPositions:h,matchUpType:f}=d;if(f!==gn)return{error:ja};if(!(h!=null&&h.length))return{error:q_};const m=(o=jo({matchUp:d,drawDefinition:e,structure:p,event:r}))==null?void 0:o.tieFormat,g={};for(const y of n){if(!Array.isArray(y))return{error:Re,lineUp:y};const b={},I=[];for(const D of y){if(typeof D!="object")return{error:Re,lineUpAssignment:D};const{participantId:E,collectionAssignments:C=[]}=D;if(!Array.isArray(C))return{error:Re,collectionAssignments:C};const M=c.find(R=>R.participantId===E);if(!M)return{error:rr};if(M.participantType!==ui)return{error:Cu};const N=(s=(a=d.sides)==null?void 0:a.find(R=>{var A,_;return(_=(A=R.participant)==null?void 0:A.individualParticipantIds)==null?void 0:_.includes(E)}))==null?void 0:s.sideNumber;N&&I.push(N);for(const R of C){if(typeof R!="object")return{error:Re,collectionAssignment:R};const{collectionId:A,collectionPosition:_}=R,k=(l=m==null?void 0:m.collectionDefinitions)==null?void 0:l.find(B=>B.collectionId===A);if(!k)return{error:Re,collectionId:A};const O=`${A}-${_}`;b[O]||(b[O]=[]);const F=b[O].length;if(k.matchUpType===vr&&F||k.matchUpType===Pn&&F>1)return{info:"Excessive collectionPosition assignments",error:Re};b[O].push(E)}}const T=Object.values(b);for(const D of T)if(D.length===2){const{participant:E}=Kl({tournamentParticipants:c,participantIds:D});if(!E){const C=Au({participant:{participantType:qt,participantRole:Ro,individualParticipantIds:D},pairOverride:!0,tournamentRecord:t});if(C.error)return C}}const S=cs(I),w=((S[1]||0)>(S[2]||0)?1:(S[2]||0)>(S[1]||0)&&2)||void 0,U=Object.keys(g).map(D=>parseInt(D));w&&!U.includes(w)&&(g[w]=y)}if(!Object.keys(g).length)return{error:bce};if(u=vn({drawDefinition:e,matchUpId:i}),u.error)return u;if(!u.matchUp)return{error:xo};const{matchUp:v}=u;v.sides||(v.sides=[]);for(const y of[1,2]){const b=v.sides.find(T=>T.sideNumber===y),I=g[y];I&&(b?b.lineUp=I:v.sides.push({lineUp:I,sideNumber:y}))}return Ci({tournamentId:t==null?void 0:t.tournamentId,context:"applyLineUps",drawDefinition:e,matchUp:v}),{...le}}function Eq(t){var e,i;const n="resetTieFormat",{drawDefinition:r,event:o,uuids:a}=t,s=Ln(t,[{[qp]:!0,[x0]:!0}],n);if(s.error)return s;const l=CC(t,[{[jP]:_f}]);if(l[Sv])return l;const c=(e=t.tournamentRecord)==null?void 0:e.tournamentId,{matchUp:u,structure:d}=(l==null?void 0:l.matchUp)??{};if(!(u!=null&&u.tieMatchUps))return ce({result:{error:ja},info:"Must be a TEAM matchUp",stack:n});if(!u.tieFormat)return{...le};const p=(i=jo({structure:d,drawDefinition:r,event:o}))==null?void 0:i.tieFormat;if(!p)return ce({result:{error:zo},info:"No inherited tieFormat",stack:n});const h=[],f=[],m=[],g=[];for(const v of p.collectionDefinitions){const{matchUpCount:y,collectionId:b}=v;f.push(b);const I=(u.tieMatchUps||[]).filter(T=>T.collectionId===b);if(I.length>y)I.sort((T,S)=>(T.matchUpStatus===qn?1:0)-(S.matchUpStatus===qn?1:0)),m.push(...I.slice(0,y)),h.push(...I.slice(3).map($r));else if(m.push(...I),I.length<y){const T=fC({collectionDefinition:v,matchUpsLimit:y-I.length,matchUp:u,uuids:a});g.push(...T)}}for(const v of(u==null?void 0:u.tieMatchUps)||[])v.collectionId&&!f.includes(v.collectionId)&&h.push(v.matchUpId);return g.length&&(m.push(...g),rf({eventId:o==null?void 0:o.eventId,matchUps:g,drawDefinition:r,tournamentId:c})),h.length&&Kp({matchUpIds:h,eventId:o==null?void 0:o.eventId,drawDefinition:r,tournamentId:c}),u&&(u.tieMatchUps=m,u.tieFormatId=void 0,u.tieFormat=void 0,Ci({structureId:d==null?void 0:d.structureId,eventId:o==null?void 0:o.eventId,context:n,drawDefinition:r,tournamentId:c,matchUp:u})),{...le,newMatchUps:g,deletedMatchUpIds:h}}function ife(t){var e,i;const{tournamentRecord:n,drawDefinition:r,matchUpId:o,event:a}=t,s="resetScorecard";if(!r)return ce({result:{error:rt},stack:s});if(!o)return ce({result:{error:co},stack:s});if(!La(o))return ce({result:{error:Re,matchUpId:o},stack:s});const l=ma({drawDefinition:r}),{matchUps:c}=Ar({nextMatchUps:!0,inContext:!0,drawDefinition:r,matchUpsMap:l}),u=l.drawMatchUps.find(g=>g.matchUpId===o),d=c==null?void 0:c.find(g=>g.matchUpId===o);if(!u||!c)return{error:xo};if(u.matchUpType!==$c)return{error:ja};const p=pa({inContextDrawMatchUps:c,drawDefinition:r,matchUpId:o}),h=d==null?void 0:d.structureId,{structure:f}=kt({drawDefinition:r,structureId:h});if(Object.assign(t,{inContextDrawMatchUps:c,inContextMatchUp:d,matchUpsMap:l,targetData:p,structure:f,matchUp:u}),Km(t))return{error:cce};if((e=u.tieMatchUps)!=null&&e.length)for(const g of u.tieMatchUps){const v=vx({matchUpId:g.matchUpId,matchUpTieId:o,winningSide:void 0,removeScore:!0,tournamentRecord:n,drawDefinition:r,event:a});if(v.error)return ce({result:v,stack:s})}const m=Od({event:t.event,removeScore:!0,tournamentRecord:n,drawDefinition:r,matchUpsMap:l,matchUpId:o});if(m.error)return ce({result:m,stack:s});if(t.tiebreakReset&&!m.tieFormatRemoved){const g=(i=jo({drawDefinition:r,structure:f,event:a}))==null?void 0:i.tieFormat;if(u.tieFormat&&g){const{matchUpCountDifference:v,descendantDifferences:y,ancestorDifferences:b,valueDifference:I}=Ap({descendant:u.tieFormat,ancestor:g});if(y.collectionIds.length===1&&!b.collectionIds.length&&!b.groupsCount&&v===1&&I===1){const T=Eq({tournamentRecord:n,drawDefinition:r,matchUpId:o,event:a});if(T.error)return T}}}return{...le}}var kLe=Object.freeze({__proto__:null,applyLineUps:tfe,assignMatchUpSideParticipant:xhe,assignTieMatchUpParticipantId:qR,bulkMatchUpStatusUpdate:Jhe,checkInParticipant:Iq,checkOutParticipant:bq,disableTieAutoCalc:Yhe,enableTieAutoCalc:zhe,findMatchUp:x3,removeDelegatedOutcome:Whe,removeMatchUpSideParticipant:Fhe,removeTieMatchUpParticipantId:Lhe,replaceTieMatchUpParticipantId:Sq,resetMatchUpLineUps:Zhe,resetScorecard:ife,resetTieFormat:Eq,setDelegatedOutcome:Qhe,setMatchUpFormat:Khe,setMatchUpStatus:NC,setOrderOfFinish:efe,substituteParticipant:qhe,toggleParticipantCheckInState:dx,updateTieMatchUpScore:Od}),xLe=Object.freeze({__proto__:null,allCompetitionMatchUps:Vc,allDrawMatchUps:Fa,allEventMatchUps:Qp,allTournamentMatchUps:Vr,analyzeMatchUp:xU,applyLineUps:tfe,assignMatchUpSideParticipant:xhe,assignTieMatchUpParticipantId:qR,bulkMatchUpStatusUpdate:Jhe,calculateWinCriteria:hb,checkInParticipant:Iq,checkMatchUpIsComplete:gm,checkOutParticipant:bq,competitionScheduleMatchUps:PC,disableTieAutoCalc:Yhe,drawMatchUps:X3,enableTieAutoCalc:zhe,eventMatchUps:Qk,findMatchUp:x3,getAllDrawMatchUps:Ar,getCheckedInParticipantIds:ib,getCompetitionMatchUps:kU,getEventMatchUpFormatTiming:$3,getMatchUpCompetitiveProfile:KP,getMatchUpContextIds:z3,getMatchUpDailyLimits:tx,getMatchUpDailyLimitsUpdate:V3,getMatchUpDependencies:rc,getMatchUpFormat:W3,getMatchUpFormatTiming:eC,getMatchUpFormatTimingUpdate:B3,getMatchUpScheduleDetails:Pk,getMatchUpType:Ck,getMatchUpsStats:q3,getModifiedMatchUpFormatTiming:Jk,getPredictiveAccuracy:G3,getRoundMatchUps:ba,getRounds:K3,isValidMatchUpFormat:Rs,matchUpActions:Gk,mutate:kLe,participantScheduledMatchUps:j3,query:IOe,removeDelegatedOutcome:Whe,removeMatchUpSideParticipant:Fhe,removeTieMatchUpParticipantId:Lhe,replaceTieMatchUpParticipantId:Sq,resetMatchUpLineUps:Zhe,resetScorecard:ife,resetTieFormat:Eq,setDelegatedOutcome:Qhe,setMatchUpFormat:Khe,setMatchUpStatus:NC,setOrderOfFinish:efe,substituteParticipant:qhe,tallyParticipantResults:mC,toggleParticipantCheckInState:dx,tournamentMatchUps:ex,updateTieMatchUpScore:Od,validMatchUp:yk,validMatchUps:vl});function Mq(t){const{matchUpFormat:e,matchUpStatus:i,winningSide:n,scoreString:r}=t;if(!r)return{outcome:{...Lk,winningSide:n,matchUpStatus:i}};if(n&&![1,2,void 0].includes(n))return{error:Re,winningSide:n};const o=r&&dB({scoreString:r}),a={},s=Kd({sets:o,matchUpFormat:e}),l=Kd({sets:o,reversed:!0,matchUpFormat:e});return n===2?(a.scoreStringSide1=l,a.scoreStringSide2=s):(a.scoreStringSide1=s,a.scoreStringSide2=l),a.sets=dB({scoreString:a.scoreStringSide1}),It({outcome:{matchUpStatus:i,winningSide:n,score:a}})}function hB({matchUpScheduleTimes:t,matchUpDependencies:e,allDateMatchUpIds:i,matchUp:n}){var r;const o=(((r=e==null?void 0:e[n.matchUpId])==null?void 0:r.matchUpIds)||[]).filter(s=>i.includes(s)),a=o.filter(s=>!t[s]);return{dependenciesScheduled:!(a!=null&&a.length),remainingDependencies:a}}function Sw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:e,timeAfterRecovery:i,matchUp:n}){var r,o,a,s;const{individualParticipantIds:l}=gk(n);i=i??((r=n.schedule)==null?void 0:r.timeAfterRecovery);const c=h=>{t[h]||(t[h]=[]),t[h]=ti(t[h].concat(...l))},u=h=>{i&&(!e[h]||i>e[h])&&(e[h]=i)},d=((o=n.winnerTo)==null?void 0:o.matchUpId)||n.winnerMatchUpId;d&&(i&&u(d),c(d));const p=((a=n.loserTo)==null?void 0:a.matchUpId)||n.loserMatchUpId;p&&(i&&u(p),c(p)),(s=n.sidesTo)!=null&&s.length&&n.sidesTo.forEach(({matchUpId:h})=>{h&&(i&&u(h),c(h))})}function AC({individualParticipantProfiles:t,participantId:e}){t[e]||(t[e]={typeChangeTimeAfterRecovery:void 0,timeAfterRecovery:void 0,priorMatchUpType:void 0,potentialRecovery:{},potentialCounted:{},potentialBookings:{},bookings:[],counters:{}})}function OU({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,typeChangeRecoveryMinutes:i,averageMatchUpMinutes:n=0,matchUpNotBeforeTimes:r,matchUpDependencies:o,recoveryMinutes:a=0,scheduleTime:s,matchUp:l}){var c,u;const d=mn((c=l==null?void 0:l.schedule)==null?void 0:c.endTime),p=d?Oa(d,Ct(a)):Oa(s,Ct(n)+Ct(a)),h=i&&(d?Oa(mn(d),i):Oa(s,Ct(n)+Ct(i))),f=((u=o==null?void 0:o[l.matchUpId])==null?void 0:u.participantIds)||[],m=(l.roundPosition&&t[l.matchUpId]||[]).flat();f.forEach(g=>{AC({individualParticipantProfiles:e,participantId:g});const v=e[g].priorMatchUpType!==l.matchUpType&&h||p;m.includes(g)?function({individualParticipantProfiles:y,recoveryValue:b,participantId:I,scheduleTime:T,drawId:S}){y[I].potentialRecovery[S]||(y[I].potentialRecovery[S]=[]),y[I].potentialRecovery[S].push(b),y[I].potentialBookings[S]||(y[I].potentialBookings[S]=[]),y[I].potentialBookings[S].push({timeAfterRecovery:b,scheduleTime:T})}({individualParticipantProfiles:e,drawId:l.drawId,recoveryValue:v,participantId:g,scheduleTime:s}):(e[g].timeAfterRecovery=v,e[g].bookings.push({scheduleTime:s,timeAfterRecovery:v}))}),Sw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:r,timeAfterRecovery:p,matchUp:l})}function r8({matchUpScheduleTimes:t,matchUpDependencies:e,scheduleTime:i,matchUpId:n,details:r}){var o,a,s,l,c;let u;const d=(a=(o=r.minutesMap)==null?void 0:o[n])==null?void 0:a.recoveryMinutes,p=(l=(s=r.minutesMap)==null?void 0:s[n])==null?void 0:l.averageMinutes,h=Oa(i,(p||0)+(d||0)),f=((c=e==null?void 0:e[n])==null?void 0:c.dependentMatchUpIds)||[];if(f.length){const m=f.reduce((g,v)=>{const y=t[v];if(!y)return g;const b={scheduleTime:y,matchUpId:v};return y&&!g.matchUpId||gi(y)<gi(g.scheduleTime)?b:g},{});m.scheduleTime&&gi(h)>gi(m.scheduleTime)&&(u=m)}return{scheduledDependent:u}}const yx="DO_NOT_SCHEDULE";function fB({averageMatchUpMinutes:t=90,requestConflicts:e={},potentials:i=!0,personRequests:n,scheduleTime:r,scheduleDate:o,matchUp:a}){const s=function(h){const{sides:f,matchUpType:m}=h||{};return(f||[]).map(g=>{var v;return m===Pn&&(((v=g==null?void 0:g.participant)==null?void 0:v.individualParticipants)||[])||(g==null?void 0:g.participant)&&[g.participant]||[]}).flat()}(a).map(({person:h})=>h==null?void 0:h.personId);if(i){const h=((a==null?void 0:a.potentialParticipants)||[]).flat().map(({person:f})=>f==null?void 0:f.personId);s.push(...h)}const l=s.map(h=>{var f;return(f=n[h])==null?void 0:f.map(m=>({...m,personId:h}))}).filter(Boolean).flat().filter(h=>h.requestType===yx&&Pd(o,h.date)),c=[],u=a==null?void 0:a.matchUpId,d=hr(mn(r),zt(o)),p=mn(sW(d,t).toISOString());for(const h of l){const{requestId:f,startTime:m,endTime:g}=h;(r>m&&r<g||p>m&&p<g)&&(c.push({matchUpId:u,request:h,scheduleTime:r}),e[f]?(e[f].scheduleTimes.includes(r)||e[f].scheduleTimes.push(r),e[f].matchUpIds.includes(u)||e[f].matchUpIds.push(u)):e[f]={request:h,scheduleTimes:[r],matchUpIds:[u]})}return{conflicts:c}}function OLe({scheduledRoundsDetails:t,greatestAverageMinutes:e,garmanSinglePass:i}){const n=[];let r,o,a,s,l=[];for(const c of t.filter(Boolean))s||(s=c.hash),(c.hash===s||i)&&(l=l.concat(c.matchUpIds)),c.hash===s||i||(s=c.hash,n.push({averageMinutes:a,recoveryMinutes:o,roundPeriodLength:r,matchUpIds:l}),l=c.matchUpIds),a=i?e:c.averageMinutes,o=c.recoveryMinutes,r=c.roundPeriodLength;return l.length&&n.push({matchUpIds:l,roundPeriodLength:r,recoveryMinutes:o,averageMinutes:a}),{groupedRounds:n}}function mB({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,matchUp:i,value:n}){const{matchUpType:r}=i,{individualParticipantIds:o}=gk(i),a=(t[i.matchUpId]||[]).filter(s=>!ua(s,o)).flat();[...o,...a].forEach(s=>{if(AC({individualParticipantProfiles:e,participantId:s}),!e[s].potentialCounted[i.drawId]){const l=e[s].counters;l[r]?l[r]+=n:n>0&&(l[r]=n),l[gc]?l[gc]+=n:n>0&&(l[gc]=n),a.includes(s)&&(e[s].potentialCounted[i.drawId]=!0)}})}function LLe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:i,greatestAverageMinutes:n,dateScheduledMatchUps:r,matchUpNotBeforeTimes:o,matchUpScheduleTimes:a,matchUpDependencies:s,clearScheduleDates:l,scheduleDate:c,minutesMap:u,matchUps:d}){var p,h;const f=[];i||(r=d==null?void 0:d.filter(v=>{const y=v.schedule||{},b=v.matchUpStatus===Ri;return b&&f.push({tournamentId:v.tournamentId,matchUpId:v.matchUpId}),!b&&DC({schedule:y})&&(!c||v.schedule.scheduledDate===c)}),i=r.map($r));const m=Array.isArray(l)?l.includes(c):l,g=m?[]:d.filter(({matchUpId:v})=>i.includes(v));for(const v of g){mB({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,value:1,matchUp:v});const y=(p=v.schedule)==null?void 0:p.scheduledTime;if(y){a[v.matchUpId]=y;const b=(h=u==null?void 0:u[v.matchUpId])==null?void 0:h.recoveryMinutes;OU({individualParticipantProfiles:e,matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:o,matchUpDependencies:s,averageMatchUpMinutes:n,recoveryMinutes:b,scheduleTime:y,matchUp:v})}}return{dateScheduledMatchUpIds:i,byeScheduledMatchUpDetails:f,dateScheduledMatchUps:r,clearDate:m}}function FLe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:e,dateScheduledMatchUpIds:i,matchUpNotBeforeTimes:n,matchUpScheduleTimes:r,orderedMatchUpIds:o,clearDate:a,matchUps:s}){const l=Object.keys(r),c=o.map(d=>s.find(p=>p.matchUpId===d)).filter(Boolean).filter(d=>{const p=!a&&(i.includes(d.matchUpId)||l.includes(d.matchUpId)),h=[Ri,Mi,fr,Es,da,Li,gr,Mr].includes(d==null?void 0:d.matchUpStatus);return e||!p&&!d.winningSide&&!h}),{matchUpMap:u}=c.reduce((d,p)=>{const{drawId:h,tournamentId:f}=p;return d.matchUpMap[f]||(d.matchUpMap[f]={}),d.matchUpMap[f][h]?d.matchUpMap[f][h].push(p):d.matchUpMap[f][h]=[p],Sw({matchUpPotentialParticipantIds:t,matchUpNotBeforeTimes:n,matchUp:p}),d},{matchUpMap:{}});return{matchUpsToSchedule:c,matchUpMap:u}}function bx({defaultRecoveryMinutes:t=0,averageMatchUpMinutes:e=90,dateScheduledMatchUps:i,tournamentRecords:n,venueIds:r=[],periodLength:o,scheduleDate:a,matchUps:s}){if(typeof n!="object")return{error:Wn};if(!vl(s)&&!Array.isArray(i))return{error:Nf};o=o??ux({recoveryMinutes:t,averageMatchUpMinutes:e});const l=Object.assign({},...Object.values(n).map(d=>(d.events??[]).map(p=>{const{scheduleTiming:h}=QP({tournamentRecord:d,event:p});return{[p.eventId]:{event:p,scheduleTiming:h}}})).flat()),c={averageTimes:[{minutes:{default:e}}],recoveryTimes:[{minutes:{default:t}}]};i||(i=s==null?void 0:s.filter(d=>{const p=d.schedule;return DC({schedule:p})&&(!a||d.schedule.scheduledDate===a)}));const u=i==null?void 0:i.filter(d=>(!r.length||r.includes(d.schedule.venueId))&&d.matchUpStatus!==Ri);return{bookings:u==null?void 0:u.map(({eventId:d,schedule:p,matchUpFormat:h})=>{const{event:f,scheduleTiming:m}=l[d],g=f==null?void 0:f.eventType,v={...m,defaultTiming:c,matchUpFormat:h},{averageMinutes:y,recoveryMinutes:b}=Dk({timingDetails:v,eventType:g}),{courtId:I,venueId:T}=p,S=mn(p.scheduledTime),w=Oa(S,y);return{recoveryMinutes:b,averageMinutes:y,periodLength:o,startTime:S,courtId:I,endTime:w,venueId:T}}).filter(Boolean),relevantMatchUps:u,dateScheduledMatchUps:i}}function BLe({calculateStartTimeFromCourts:t=!0,remainingScheduleTimes:e,defaultRecoveryMinutes:i,averageMatchUpMinutes:n,clearScheduleDates:r,tournamentRecords:o,tournamentRecord:a,periodLength:s,scheduleDate:l,startTime:c,venueIds:u,matchUps:d,endTime:p}){if(a&&!o&&(o={[a.tournamentId]:a}),typeof o!="object"||!Object.keys(o).length)return{error:Wn};s=s??ux({recoveryMinutes:i,averageMatchUpMinutes:n});const{courts:h,venues:f}=eh({dates:[l],ignoreDisabled:!0,tournamentRecords:o}),m=(h==null?void 0:h.filter(T=>!u||u.includes(T.venueId)))??[];c=c??Iw({courts:m,scheduleDate:l,startTime:!0}),p=p??Iw({courts:m,scheduleDate:l,endTime:!0});const{bookings:g,dateScheduledMatchUps:v}=bx({defaultRecoveryMinutes:i,averageMatchUpMinutes:n,tournamentRecords:o,scheduleDate:l,periodLength:s,venueIds:u,matchUps:d}),y={calculateStartTimeFromCourts:t,remainingScheduleTimes:e,averageMatchUpMinutes:n,clearScheduleDates:r,date:l,periodLength:s,startTime:c,bookings:g,endTime:p,courts:m},{scheduleTimes:b}=yq(y),I=(u==null?void 0:u.length)===1&&u[0]||(f==null?void 0:f.length)===1&&f[0].venueId||void 0;return{dateScheduledMatchUpIds:v==null?void 0:v.map(Ts("matchUpId")),dateScheduledMatchUps:v,scheduleTimes:b,venueId:I}}function o8({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,scheduleCompletedMatchUps:i,containedStructureIds:n,matchUpNotBeforeTimes:r,matchUpScheduleTimes:o,matchUpDependencies:a,clearScheduleDates:s,tournamentRecords:l,periodLength:c,scheduleDate:u,useGarman:d,matchUps:p,courts:h,venues:f}){var m;const g={},v=[],y=[],b=[];for(const I of f){const{rounds:T=[],venueId:S}=I,{scheduledRoundsDetails:w,greatestAverageMinutes:U,orderedMatchUpIds:D,minutesMap:E}=SC({scheduleCompletedMatchUps:i,containedStructureIds:n,tournamentRecords:l,periodLength:c,matchUps:p,rounds:T});b.push(...D??[]);const{groupedRounds:C}=OLe({scheduledRoundsDetails:w,greatestAverageMinutes:U,garmanSinglePass:!0});let M,N,R=[];d&&({scheduleTimes:R,dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=BLe({averageMatchUpMinutes:(m=C[0])==null?void 0:m.averageMinutes,scheduleDate:zt(u),venueIds:[I.venueId],clearScheduleDates:s,tournamentRecords:l,periodLength:c,matchUps:p}));const A=LLe({matchUpPotentialParticipantIds:t,individualParticipantProfiles:e,dateScheduledMatchUpIds:M,greatestAverageMinutes:U,matchUpNotBeforeTimes:r,matchUpScheduleTimes:o,matchUpDependencies:a,clearScheduleDates:s,scheduleDate:u,minutesMap:E,matchUps:p});({dateScheduledMatchUpIds:M,dateScheduledMatchUps:N}=A);const{byeScheduledMatchUpDetails:_,clearDate:k}=A;_!=null&&_.length&&y.push(..._);const{matchUpsToSchedule:O,matchUpMap:F}=FLe({matchUpPotentialParticipantIds:t,scheduleCompletedMatchUps:i,dateScheduledMatchUpIds:M,matchUpNotBeforeTimes:r,matchUpScheduleTimes:o,orderedMatchUpIds:D,clearDate:k,matchUps:p}),B=h.filter($=>$.venueId===S);g[S]={previousRemainingScheduleTimes:[],courtsCount:B.length,greatestAverageMinutes:U,scheduledRoundsDetails:w,dateScheduledMatchUps:N,matchUpsToSchedule:O,scheduleTimes:R,groupedRounds:C,venueCourts:B,minutesMap:E,matchUpMap:F},s||v.push(...M)}return{allDateScheduledByeMatchUpDetails:y,allDateScheduledMatchUpIds:v,venueScheduledRoundDetails:g,allDateMatchUpIds:b}}function gB({individualParticipantProfiles:t,matchUpNotBeforeTimes:e,matchUpDependencies:i,scheduleTime:n,matchUp:r,details:o}){var a,s,l,c,u;const d=(((a=i==null?void 0:i[r.matchUpId])==null?void 0:a.participantIds)||[]).flat(),p=((l=(s=o==null?void 0:o.minutesMap)==null?void 0:s[r.matchUpId])==null?void 0:l.averageMinutes)||0,h=((u=(c=o==null?void 0:o.minutesMap)==null?void 0:c[r.matchUpId])==null?void 0:u.recoveryMinutes)||0,f=d.every(v=>{var y;AC({individualParticipantProfiles:t,participantId:v});const b=t[v];if(!b.timeAfterRecovery)return!0;const I=mn((y=r==null?void 0:r.schedule)==null?void 0:y.endTime),T=I?Oa(I,Ct(h)):Oa(n,Ct(p)+Ct(h));return![...Object.keys(b.potentialBookings).filter(S=>S!==r.drawId).map(S=>b.potentialBookings[S]).flat(),...b.bookings].find(S=>function(w,U){const D=gi(w.scheduleTime),E=gi(w.timeAfterRecovery),C=gi(U.scheduleTime),M=gi(U.timeAfterRecovery),N=D>C&&D<M,R=C>D&&C<E,A=E>C&&E<M,_=M>D&&M<E;return It({hasOverlap:D===C||E===M||N||A||R||_,startAisContained:N,endAisContained:A,startBisContained:R,endBisContained:_},!0)}({scheduleTime:n,timeAfterRecovery:T},S).hasOverlap)}),m=e[r.matchUpId],g=m?$P(hr(m),hr(n),!1):0;return{enoughTime:f&&g>=0}}function vB({individualParticipantProfiles:t,matchUpPotentialParticipantIds:e,matchUpDailyLimits:i={},matchUp:n}){const{matchUpId:r,matchUpType:o}=n,{enteredIndividualParticipantIds:a}=gk(n),s=(n.roundPosition&&e[r]||[]).flat(),l=ti(a.concat(...s));return l.forEach(c=>{AC({individualParticipantProfiles:t,participantId:c})}),{participantIdsAtLimit:l.filter(c=>{const u=t[c];if(u)return[o,gc].find(d=>{var p;const h=((p=u.counters)==null?void 0:p[d])||0,f=i[d]||0;return h&&f&&h>=f})}),relevantParticipantIds:l}}function LU({scheduleCompletedMatchUps:t=!1,scheduleByeMatchUps:e=!1,errorOnAnachronism:i=!1,checkChronology:n=!0,matchUpDependencies:r,removePriorValues:o,tournamentRecords:a,tournamentRecord:s,matchUpDetails:l,matchUpIds:c,schedule:u}){var d,p,h;if(!s)return{error:je};if(!(l||c&&Array.isArray(c)))return{error:OP};if(!(l||u&&typeof u=="object"))return{error:j_e};let f;const m=[];let g=0;if(n&&!r){const b=rc({tournamentRecords:a,tournamentRecord:s});r=b.matchUpDependencies,f=b.matchUps}f||(f=((d=Vr({tournamentRecord:s}))==null?void 0:d.matchUps)??[]);const v=f.reduce((b,I)=>{const{matchUpId:T,drawId:S,matchUpStatus:w}=I;return!e&&w===Ri||!t&&no.includes(w)||(b[S]?b[S].push(T):b[S]=[T]),b},{}),y=l==null?void 0:l.map(b=>b.matchUpId);for(const b of Object.keys(v)){const{drawDefinition:I}=cf({tournamentRecord:s,drawId:b});if(!I)continue;const T=v[b].filter(w=>(c==null?void 0:c.includes(w))??(y==null?void 0:y.includes(w))),S=Fa({inContext:!1,drawDefinition:I}).matchUps;for(const w of T){const U=mx({schedule:((p=l==null?void 0:l.find(D=>D.matchUpId===w))==null?void 0:p.schedule)||u,matchUpDependencies:r,errorOnAnachronism:i,removePriorValues:o,inContextMatchUps:f,tournamentRecords:a,tournamentRecord:s,checkChronology:n,drawDefinition:I,drawMatchUps:S,matchUpId:w});if((h=U==null?void 0:U.warnings)!=null&&h.length&&m.push(...U.warnings),U!=null&&U.success&&(g+=1),U.error)return U}}return m.length?{...le,scheduled:g,warnings:m}:{...le,scheduled:g}}function FU(t){var e;const{scheduleCompletedMatchUps:i=!1,scheduleByeMatchUps:n=!1,errorOnAnachronism:r,matchUpContextIds:o,removePriorValues:a,tournamentRecords:s,checkChronology:l,matchUpDetails:c,schedule:u}=t;if(t.matchUpIds&&!o)return LU(t);const d=Ln(t,[{[Oo]:!0},{[fke]:{matchUpContextIds:!1,matchUpDetails:!1},[Yv]:Re,[HP]:El}]);if(d.error)return d;if((!c||o)&&!u)return{error:bt,info:"schedule is required"};const p=[];let h=0;const{matchUpDependencies:f}=rc({tournamentRecords:s});for(const m of Object.values(s)){const{tournamentId:g}=m,v=o==null?void 0:o.filter(b=>b.tournamentId===g).map($r),y=c==null?void 0:c.filter(b=>(b==null?void 0:b.tournamentId)===g);if(v!=null&&v.length||y!=null&&y.length){const b=LU({matchUpDetails:y,scheduleCompletedMatchUps:i,scheduleByeMatchUps:n,matchUpDependencies:f,errorOnAnachronism:r,removePriorValues:a,tournamentRecords:s,tournamentRecord:m,checkChronology:l,matchUpIds:v,schedule:u});if((e=b.warnings)!=null&&e.length&&p.push(...b.warnings),b.scheduled&&(h+=b.scheduled),b.error)return b}}return p.length?{...le,scheduled:h,warnings:p}:{...le,scheduled:h}}function a8({autoSchedulingAudit:t,tournamentRecords:e}){var i;bi({topic:SU,payload:t});const n=s=>s?Object.values(s).reduce((l,c)=>l+c.length||0,0):0,r=((t==null?void 0:t.schedulingProfile)||[]).reduce((s,l)=>s+l.venues.reduce((c,u)=>c+u.rounds.length,0),0),o={scheduledDatesCount:(i=t.scheduledDates)==null?void 0:i.length,noTimeMatchUpIdsCount:n(t==null?void 0:t.noTimeMatchUpIds),scheduledMatchUpIdsCount:n(t==null?void 0:t.scheduledMatchUpIds),overLimitMatchUpIdsCount:n(t==null?void 0:t.overLimitMatchUpIds),requestConflictsCount:n(t==null?void 0:t.requestConflicts),profileRoundsCount:r},a={itemType:bLe,itemValue:o};for(const s of Object.values(e))ub({tournamentRecord:s,timeItem:a})}function s8({averageMinutes:t,startTime:e,endTime:i,court:n,date:r}){if(!Array.isArray(n.dateAvailability))return{error:bt,stack:"getEarliestCourtTime"};const o=Iw({scheduleDate:r,courts:[n],startTime:!0}),a=Iw({scheduleDate:r,courts:[n],endTime:!0});e=e||o,i=i||a;const s=RC({court:n,date:r}),{timeSlots:l}=K0({courtDate:s}),c=hr(e),u=hr(i);return{earliestCourtTime:l==null?void 0:l.reduce((d,p)=>{const h=hr(p.startTime),f=hr(p.endTime);if(h>u||f<c)return d;const m=c>h?c:h;if($P(m,f)>=t){const g=mn(m.toISOString());(!d||g<d)&&(d=g)}return d},void 0),courtStartTime:o,courtEndTime:a}}function Ix(t){const{scheduleAttributes:e=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:i=no,scheduledDates:n,venueIds:r}=t,o=Vu(t),a=bn(o)?Object.values(o).map(({tournamentId:l})=>l).filter(Boolean):[];if(!(a!=null&&a.length))return{error:Wn};let s=0;for(const l of a){const c=$Le({ignoreMatchUpStatuses:i,scheduleAttributes:e,tournamentRecord:o[l],scheduledDates:n,venueIds:r});if(c.error)return c;s+=c.clearedScheduleCount||0}return{...le,clearedScheduleCount:s}}function $Le({scheduleAttributes:t=["scheduledDate","scheduledTime"],ignoreMatchUpStatuses:e=no,tournamentRecord:i,scheduledDates:n,venueIds:r=[]}){if(typeof i!="object")return{error:je};if(!Array.isArray(e)||!Array.isArray(r))return{error:Re};r.length&&t.push("venueId");const o=(Vr({matchUpFilters:{scheduledDates:n},tournamentRecord:i}).matchUps??[]).filter(l=>l.matchUpStatus&&!e.includes(l.matchUpStatus)&&DC({schedule:l.schedule,scheduleAttributes:t})&&(!(r!=null&&r.length)||r.includes(l.schedule.venueId))).map($r),a=Vr({tournamentRecord:i,inContext:!1}).matchUps??[];let s=0;for(const l of a)o.includes(l.matchUpId)&&(l.timeItems=(l.timeItems??[]).filter(c=>(c==null?void 0:c.itemType)&&![sf,iy,ZP,XP,JP].includes(c==null?void 0:c.itemType)),s+=1);return{...le,clearedScheduleCount:s}}function wx(t){const{checkPotentialRequestConflicts:e=!0,scheduleCompletedMatchUps:i,clearScheduleDates:n,scheduleDates:r=[],tournamentRecords:o,periodLength:a,useGarman:s,dryRun:l,pro:c}=t,u=Ln(t,[{[Oo]:!0},{[Ch]:U=>!U||Array.isArray(U)&&U.every(Ss),[Ace]:!1,[HP]:El}]);if(u.error)return u;const d=th({tournamentRecords:o});if(d.error)return d;if(!d.schedulingProfile.length)return{...le};const{modifications:p,issues:h=[],schedulingProfile:f=[]}=d,m=Object.assign({},...Object.values(o).map(U=>V0({tournamentRecord:U}).containedStructures)),g=r.map(U=>{if(Ss(U))return zt(U)}).filter(Boolean),v=f.map(U=>U.scheduleDate).map(U=>Ss(U)&&zt(U)).filter(U=>U&&(!r.length||g.includes(U)));if(!v.length)return{error:g_e};n&&!l&&Ix({tournamentRecords:o,scheduledDates:Array.isArray(n)?n:[]});const y=eh({ignoreDisabled:!1,tournamentRecords:o}).courts,{matchUps:b}=Vc({matchUpFilters:{matchUpTypes:[vr,Pn]},afterRecoveryTimes:!0,nextMatchUps:!0,tournamentRecords:o}),{matchUpDependencies:I}=rc({includeParticipantDependencies:!0,tournamentRecords:o,matchUps:b}),{matchUpDailyLimits:T}=tx({tournamentRecords:o}),{personRequests:S}=Cg({requestType:yx,tournamentRecords:o}),w={schedulingProfileModifications:p,checkPotentialRequestConflicts:e,scheduleCompletedMatchUps:i,schedulingProfileIssues:h,dateSchedulingProfiles:f.filter(U=>{const D=zt(U==null?void 0:U.scheduleDate);return v.includes(D)}).sort((U,D)=>new Date(U.scheduleDate).getTime()-new Date(D.scheduleDate).getTime()),containedStructureIds:m,matchUpDependencies:I,matchUpDailyLimits:T,clearScheduleDates:n,tournamentRecords:o,schedulingProfile:f,personRequests:S,periodLength:a,useGarman:s,matchUps:b,dryRun:l,courts:y};return c?function({schedulingProfileModifications:U,checkPotentialRequestConflicts:D,scheduleCompletedMatchUps:E,schedulingProfileIssues:C,dateSchedulingProfiles:M,containedStructureIds:N,matchUpDependencies:R,matchUpDailyLimits:A,clearScheduleDates:_,tournamentRecords:k,periodLength:O=30,schedulingProfile:F,personRequests:B,matchUps:$=[],courts:V,dryRun:H}){var z;const G={},W={},K={},Z={},Y={},X={},Q={},te={},J={};for(const ne of M??[]){const re=zt(ne==null?void 0:ne.scheduleDate),me=(ne==null?void 0:ne.venues)||[],he={},be={},Se=(we,fe)=>{we.forEach(Te=>{const ue=be[Te].counters;ue[fe]?ue[fe]+=1:ue[fe]=1,ue[gc]?ue[gc]+=1:ue[gc]=1})};G[re]={},W[re]={},X[re]=[],Q[re]=[],te[re]=[],J[re]=[];const De={};$==null||$.forEach(we=>{var fe;(fe=we.schedule)!=null&&fe.scheduledDate&&Pd(re,zt(we.schedule.scheduledDate))&&Sw({matchUpPotentialParticipantIds:he,matchUpNotBeforeTimes:De,matchUp:we})});const{allDateScheduledByeMatchUpDetails:Oe,allDateScheduledMatchUpIds:xe,venueScheduledRoundDetails:$e,allDateMatchUpIds:Ae}=o8({matchUpPotentialParticipantIds:he,individualParticipantProfiles:be,scheduleCompletedMatchUps:E,containedStructureIds:N,matchUpNotBeforeTimes:De,matchUpScheduleTimes:Y,matchUpDependencies:R,clearScheduleDates:_,tournamentRecords:k,periodLength:O,scheduleDate:re,matchUps:$,courts:V,venues:me}),ve=$==null?void 0:$.filter(({matchUpId:we})=>xe.includes(we)),{bookings:ke}=bx({dateScheduledMatchUps:ve,tournamentRecords:k,scheduleDate:re,periodLength:O}),{virtualCourts:ye}=cx({scheduleDate:re,periodLength:O,bookings:ke,courts:V}),Ie=ye==null?void 0:ye.reduce((we,fe)=>{const{earliestCourtTime:Te,courtEndTime:ue}=s8({date:re,averageMinutes:0,court:fe});return(!we.startTime||hr(Te)<hr(we.startTime))&&(we.startTime=Te),(!we.endTime||hr(ue)>hr(we.endTime))&&(we.endTime=ue),we},{});let Ne=Ie.startTime;const Fe=({courtId:we,booking:fe})=>{var Te;return(Te=ye==null?void 0:ye.find(ue=>ue.courtId===we))==null?void 0:Te.dateAvailability[0].bookings.push(fe)},Le=10;let ge,Ee=0;for(;!ge;){for(const{venueId:we}of me){const fe=$e[we],Te=fe.matchUpsToSchedule.length,ue=[],de=[];let _e,Ue=0;for(;!_e;){for(const Ce of fe.matchUpsToSchedule){if(de.length===fe.courtsCount||ue.length===fe.courtsCount){_e=!0;break}const{matchUpId:We,matchUpType:He}=Ce,{participantIdsAtLimit:Be,relevantParticipantIds:et}=vB({matchUpPotentialParticipantIds:he,individualParticipantProfiles:be,matchUpDailyLimits:A,matchUp:Ce});if(Be.length){Q[re].includes(We)||Q[re].push(We);continue}const{dependenciesScheduled:ot,remainingDependencies:mt}=hB({matchUpScheduleTimes:Y,matchUpDependencies:R,allDateMatchUpIds:Ae,matchUp:Ce});if(!ot){W[re][We]||(W[re][We]=[]),W[re][We].push({remainingDependencies:mt});continue}const Rt=[],Ft=ye==null?void 0:ye.reduce((Je,_t)=>{var pt,Ke,ci,ni;if(de.includes(_t.courtId))return Je;const{earliestCourtTime:Ht}=s8({averageMinutes:fe.greatestAverageMinutes,startTime:Ne,date:re,court:_t});if(Je.scheduleTime&&gi(Ht)>=gi(Je.scheduleTime))return Je;const{scheduledDependent:Zi}=r8({matchUpScheduleTimes:Y,matchUpDependencies:R,scheduleTime:Ht,matchUpId:We,details:fe});if(Zi)return Je;const{enoughTime:Xi}=gB({individualParticipantProfiles:be,matchUpNotBeforeTimes:De,matchUpDependencies:R,scheduleTime:Ht,details:fe,matchUp:Ce});if(!Xi)return G[re][We]||(G[re][We]=[]),G[re][We].includes(Ht)||G[re][We].push(Ht),Je;const wi=((Ke=(pt=fe.minutesMap)==null?void 0:pt[We])==null?void 0:Ke.averageMinutes)||fe.greatestAverageMinutes,{conflicts:Ji}=fB({potentials:D,averageMatchUpMinutes:wi,requestConflicts:J,personRequests:B,scheduleTime:Ht,scheduleDate:re,matchUp:Ce});if(Ji!=null&&Ji.length)return Rt.push(...Ji),!1;Se(et,He);const Yt=(ni=(ci=fe.minutesMap)==null?void 0:ci[We])==null?void 0:ni.recoveryMinutes;return OU({matchUpPotentialParticipantIds:he,individualParticipantProfiles:be,matchUpNotBeforeTimes:De,averageMatchUpMinutes:wi,matchUpDependencies:R,recoveryMinutes:Yt,scheduleTime:Ht,matchUp:Ce}),(!Je.scheduleTime||gi(Ht)<gi(Je.scheduleTime))&&(Je.averageMatchUpMinutes=wi,Je.recoveryMinutes=Yt,Je.scheduleTime=Ht,Je.courtName=_t.courtName,Je.courtId=_t.courtId),Je},{});if(Ft.scheduleTime){const{averageMatchUpMinutes:Je,recoveryMinutes:_t,scheduleTime:pt,courtId:Ke}=Ft;Y[We]=pt,Z[We]=Ke,ue.push(We),de.push(Ke);const ci=pt,ni=Oa(ci,Je);Fe({courtId:Ke,booking:{averageMatchUpMinutes:Je,recoveryMinutes:_t,periodLength:O,matchUpId:We,startTime:ci,courtId:Ke,endTime:ni,venueId:we}}),fe.matchUpsToSchedule=fe.matchUpsToSchedule.filter(Ht=>Ht.matchUpId!==We)}else Rt!=null&&Rt.length&&(K[re]||(K[re]=[]),K[re].push(...Rt))}de.length!==fe.courtsCount&&ue.length!==fe.courtsCount&&fe.matchUpsToSchedule.length||(_e=!0),fe.matchUpsToSchedule.length&&ue<fe.courtsCount&&(hr(Ne)<hr(Ie.endTime)?Ne=Oa(Ne,O):(_e=!0,fe.complete=!0)),Ue+=1,!_e&&Ue>=Te&&(_e=!0)}(z=fe.matchUpsToSchedule)!=null&&z.length||(fe.complete=!0)}Ee+=1,ge=me.every(({venueId:we})=>$e[we].complete)||Ee===Le}for(const{venueId:we}of me){const fe=$e[we].matchUpMap;Object.keys(fe).forEach(Te=>{const ue=k[Te];ue&&Object.keys(fe[Te]).forEach(de=>{const{drawDefinition:_e}=cf({tournamentRecord:ue,drawId:de});_e&&fe[Te][de].forEach(({matchUpId:Ue})=>{const Ce=Y[Ue],We=Z[Ue];if(Ce){const He=Ce.split(":").map(Zs).join(":"),Be=`${zt(re)}T${He}`;H||(uf({drawDefinition:_e,scheduledTime:Be,matchUpId:Ue}),fb({courtDayDate:re,tournamentRecords:k,tournamentRecord:ue,drawDefinition:_e,matchUpId:Ue,courtId:We})),X[re].push(Ue)}})})}),te[re]=$e[we].matchUpsToSchedule.map($r)}!H&&Oe!=null&&Oe.length&&FU({matchUpDetails:Oe,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:k,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(const we of ne.venues)for(const fe of we.rounds){const Te=(fe.matchUps??[]).map(({matchUpId:_e})=>_e),ue=Te==null?void 0:Te.filter(_e=>X[re].includes(_e));fe.canScheduledMatchUpIds=ue;let de=Math.round(((ue==null?void 0:ue.length)||0)/fe.matchUpsCount*1e4)/100;(de===1/0||isNaN(de))&&(de=void 0),fe.possibleToSchedulePct=de,fe.matchUpsCount===(ue==null?void 0:ue.length)&&(fe.possibleToSchedule=!0)}}const ie=(M??[]).map(({scheduleDate:ne})=>ne),oe={timeStamp:Date.now(),overLimitMatchUpIds:Q,scheduledMatchUpIds:X,schedulingProfile:F,noTimeMatchUpIds:te,requestConflicts:J,scheduledDates:ie};return a8({tournamentRecords:k,autoSchedulingAudit:oe}),{...le,schedulingProfileModifications:U,schedulingProfileIssues:C,dateSchedulingProfiles:M,recoveryTimeDeferredMatchUpIds:G,dependencyDeferredMatchUpIds:W,matchUpScheduleTimes:Y,overLimitMatchUpIds:Q,scheduledMatchUpIds:X,noTimeMatchUpIds:te,requestConflicts:J,scheduledDates:ie}}(w):function({schedulingProfileModifications:U,checkPotentialRequestConflicts:D,scheduleCompletedMatchUps:E,schedulingProfileIssues:C,dateSchedulingProfiles:M,containedStructureIds:N,matchUpDependencies:R,matchUpDailyLimits:A,clearScheduleDates:_,tournamentRecords:k,schedulingProfile:O,personRequests:F,periodLength:B,matchUps:$,courts:V,dryRun:H}){var z,G,W,K,Z,Y,X;const Q={},te={},J={},ie={},oe={},ne={},re={},me={},he={},be={};for(const Oe of M){const xe=zt(Oe==null?void 0:Oe.scheduleDate),$e=(Oe==null?void 0:Oe.venues)||[],Ae={},ve={},ke=(fe,Te)=>{fe.forEach(ue=>{const de=ve[ue].counters;de[Te]?de[Te]+=1:de[Te]=1,de[gc]?de[gc]+=1:de[gc]=1})};J[xe]={},ie[xe]={},Q[xe]={},te[xe]={},re[xe]=[],me[xe]=[],he[xe]=[],be[xe]=[];const ye={};$.forEach(fe=>{var Te;(Te=fe.schedule)!=null&&Te.scheduledDate&&Pd(xe,zt(fe.schedule.scheduledDate))&&Sw({matchUpPotentialParticipantIds:Ae,matchUpNotBeforeTimes:ye,matchUp:fe})});const{allDateScheduledByeMatchUpDetails:Ie,venueScheduledRoundDetails:Ne,allDateMatchUpIds:Fe}=o8({matchUpPotentialParticipantIds:Ae,individualParticipantProfiles:ve,scheduleCompletedMatchUps:E,containedStructureIds:N,matchUpNotBeforeTimes:ye,matchUpScheduleTimes:ne,matchUpDependencies:R,clearScheduleDates:_,tournamentRecords:k,useGarman:!0,periodLength:B,scheduleDate:xe,matchUps:$,courts:V,venues:$e}),Le=10;let ge,Ee=0;const we=10;for(;!ge;){for(const{venueId:fe}of $e){let Te=0;const ue=Ne[fe];for(;ue.courtsCount&&(z=ue.scheduleTimes)!=null&&z.length&&(G=ue.matchUpsToSchedule)!=null&&G.length&&Te<=ue.courtsCount;){const{scheduleTime:de,attempts:_e=0}=ue.scheduleTimes.shift(),Ue=ue.matchUpsToSchedule.find(Ce=>{var We,He;const{matchUpId:Be,matchUpType:et}=Ce,{participantIdsAtLimit:ot,relevantParticipantIds:mt}=vB({matchUpPotentialParticipantIds:Ae,individualParticipantProfiles:ve,matchUpDailyLimits:A,matchUp:Ce});if(ot.length)return me[xe].includes(Be)||me[xe].push(Be),!1;const{scheduledDependent:Rt}=r8({matchUpScheduleTimes:ne,matchUpDependencies:R,scheduleTime:de,matchUpId:Be,details:ue});if(Rt)return!1;const{dependenciesScheduled:Ft,remainingDependencies:Je}=hB({matchUpScheduleTimes:ne,matchUpDependencies:R,allDateMatchUpIds:Fe,matchUp:Ce});if(!Ft)return ie[xe][Be]||(ie[xe][Be]=[]),ie[xe][Be].push({scheduleTime:de,remainingDependencies:Je}),!1;const{enoughTime:_t}=gB({individualParticipantProfiles:ve,matchUpNotBeforeTimes:ye,matchUpDependencies:R,scheduleTime:de,details:ue,matchUp:Ce});if(!_t)return J[xe][Be]||(J[xe][Be]=[]),J[xe][Be].push({scheduleTime:de}),!1;const pt=ue.greatestAverageMinutes,{conflicts:Ke}=fB({potentials:D,averageMatchUpMinutes:pt,requestConflicts:be,personRequests:F,scheduleTime:de,scheduleDate:xe,matchUp:Ce});if(Ke!=null&&Ke.length)return oe[xe]||(oe[xe]=[]),oe[xe].push(...Ke),!1;ke(mt,et);const ci=(He=(We=ue.minutesMap)==null?void 0:We[Be])==null?void 0:He.recoveryMinutes;return OU({matchUpPotentialParticipantIds:Ae,individualParticipantProfiles:ve,matchUpNotBeforeTimes:ye,averageMatchUpMinutes:pt,matchUpDependencies:R,recoveryMinutes:ci,scheduleTime:de,matchUp:Ce}),ne[Be]=de,!0});ue.matchUpsToSchedule=ue.matchUpsToSchedule.filter(({matchUpId:Ce})=>Ce!==(Ue==null?void 0:Ue.matchUpId)),Ue?Te+=1:(te[xe][fe]||(te[xe][fe]=[]),te[xe][fe].push({scheduleTime:de,attempts:_e+1}))}(W=ue.matchUpsToSchedule)!=null&&W.length&&(te[xe][fe]=(K=te[xe][fe])==null?void 0:K.filter(de=>{const _e=de.attempts<Le;return _e&&ue.scheduleTimes.push(de),!_e})),(Z=ue.scheduleTimes)!=null&&Z.length&&(Y=ue.matchUpsToSchedule)!=null&&Y.length||(ue.complete=!0)}Ee+=1,ge=$e.every(({venueId:fe})=>Ne[fe].complete)||Ee===we}for(const{venueId:fe}of $e){const Te=Ne[fe].matchUpMap;Object.keys(Te).forEach(ue=>{const de=k[ue];de&&Object.keys(Te[ue]).forEach(_e=>{const{drawDefinition:Ue}=cf({tournamentRecord:de,drawId:_e});Ue&&Te[ue][_e].forEach(({matchUpId:Ce})=>{const We=ne[Ce];if(We){const He=We.split(":").map(Zs).join(":"),Be=`${zt(xe)}T${He}`;H?re[xe].push(Ce):(uf({drawDefinition:Ue,scheduledTime:Be,matchUpId:Ce}).success&&re[xe].push(Ce),fe&&Z0({tournamentRecord:de,drawDefinition:Ue,matchUpId:Ce,venueId:fe}))}})})}),he[xe]=Ne[fe].matchUpsToSchedule.map($r),Q[xe][fe]=Ne[fe].scheduleTimes.sort((ue,de)=>gi(ue.scheduleTime)-gi(de.scheduleTime))}!H&&Ie!=null&&Ie.length&&FU({matchUpDetails:Ie,scheduleByeMatchUps:!0,removePriorValues:!0,tournamentRecords:k,schedule:{scheduledDate:"",scheduledTime:"",courtOrder:"",courtId:"",venueId:""}});for(const fe of Oe.venues)for(const Te of fe.rounds){const ue=((X=Te.matchUps)==null?void 0:X.map(({matchUpId:Ue})=>Ue))||[],de=ue.filter(Ue=>re[xe].includes(Ue));Te.canScheduledMatchUpIds=de;let _e=Math.round(de.length/Te.matchUpsCount*1e4)/100;(_e===1/0||isNaN(_e))&&(_e=0),Te.possibleToSchedulePct=_e,Te.matchUpsCount===de.length&&(Te.possibleToSchedule=!0)}}const Se=M.map(({scheduleDate:Oe})=>Oe),De={timeStamp:Date.now(),overLimitMatchUpIds:me,scheduledMatchUpIds:re,schedulingProfile:O,noTimeMatchUpIds:he,requestConflicts:be,scheduledDates:Se};return a8({tournamentRecords:k,autoSchedulingAudit:De}),{...le,schedulingProfileModifications:U,schedulingProfileIssues:C,scheduleTimesRemaining:Q,dateSchedulingProfiles:M,skippedScheduleTimes:te,recoveryTimeDeferredMatchUpIds:J,dependencyDeferredMatchUpIds:ie,matchUpScheduleTimes:ne,overLimitMatchUpIds:me,scheduledMatchUpIds:re,noTimeMatchUpIds:he,requestConflicts:be,scheduledDates:Se}}(w)}function nfe(t){const e=t||{};return e.tournamentId||(e.tournamentId=Hi()),(!e.startDate||Bm(e.startDate)||pR.test(e.startDate))&&(!e.endDate||Bm(e.endDate)||pR.test(e.endDate))?(e.extensions&&(e.extensions=e.extensions.filter(Eu)),{...e}):{error:Ha}}function Rq({addParticipants:t=!0,participantAttribute:e,tournamentRecord:i,personAttribute:n,teamNames:r,accessor:o,uuids:a}){var s,l;if(!i)return{error:je};const c={},u=(i.participants??[]).filter(({participantType:g,participantRole:v})=>g===ui&&v===Ro);let d=0;for(const g of u){const v=o&&((s=wv({element:g,accessor:o}))==null?void 0:s.value)||n&&((l=g.person)==null?void 0:l[n])||e&&g[e];if(v){if(!Object.keys(c).includes(v)){c[v]={participantName:(r==null?void 0:r[d])??v,participantId:(a==null?void 0:a.pop())??Hi(),individualParticipantIds:[],participantRole:Ro,participantType:on};const y={value:n??e,name:V2};Ii({element:c[v],extension:y}),d+=1}c[v].individualParticipantIds.push(g.participantId)}}const p=Object.keys(c),h=(i.participants??[]).map(g=>{if(g.participantType!==on||g.participantRole!==Ro)return;const{extension:v}=ei({name:V2,element:g}),y=v==null?void 0:v.value;return p.includes(y)?g.participantId:void 0}).filter(Boolean);let f=0;const m=[];return Object.keys(c).forEach(g=>{const v=c[g],{participantId:y}=v;h.includes(y)||(i.participants||(i.participants=[]),t&&i.participants.push(v),m.push(v),f++)}),t&&f?(bi({payload:{tournamentId:i.tournamentId,participants:m},topic:zm}),{...le,participantsAdded:f}):m.length?{...le,newParticipants:m}:{error:I_e}}var VLe=[{AA:"Annexia"},{BA:"Bacteria"},{BO:"Borduria"},{BM:"Bensalem"},{BS:"Basenji"},{BI:"Balnibarbi"},{BV:"Bartovia"},{BZ:"Berzerkistan"},{CA:"Caldonia"},{CC:"Concordia"},{CH:"Chula"},{DA:"Deltora"},{DW:"Discworld"},{EA:"Eastasia"},{EP:"Ecotopia"},{ER:"Erewhon"},{FA:"Freedonia"},{FN:"Florin"},{FG:"Fogg"},{FK:"Fourecks"},{GA:"Genovia"},{GL:"Gilead"},{GD:"Gilead"},{GL:"Gondal"},{GO:"Gondor"},{GR:"Gruzinia"},{GT:"Goritania"},{GU:"Guilder"},{HA:"Heldscalla"},{HO:"Hidalgo"},{IL:"Illyria"},{KA:"Kinakuta"},{KG:"Kangan"},{KN:"Kreplachistan"},{KS:"Kallipolis"},{LH:"Lugash"},{LI:"Listenbourg"},{LT:"Lilliput"},{LU:"Luggnagg"},{LV:"Lichtenslava"},{MR:"Moher"},{NA:"Narnia"},{NV:"Novaria"},{OA:"Oceania"},{OS:"Orsinia"},{OV:"Octavia"},{PA:"Palombia"},{PG:"Penguina"},{QA:"Qasha"},{PM:"Panem"},{SA:"Solymbria"},{SD:"Syldavia"},{SG:"San Glucose"},{SL:"San Lorenzo"},{SR:"Sontar"},{SY:"Sylvania"},{TF:"Tralfamadore"},{TH:"Themyscira"},{UA:"Utopia"},{VA:"Vespugia"},{WA:"Wakanda"},{WX:"Wessex"},{ZA:"Zamunda"},{ZK:"Zubrowka"}],jLe=["Amber","Ansul","Atlantis","Braavos","Busytown","Castle Rock","Centralia","Coober Pedy","Chefchaouen","Chronopolis","Damanhur","Diaspar","Dictionopolis","Diomira","El Dorado","Elista","Ephesus","Gotham","Hadleyburg","Hallstatt","Hierusalem","Ilium","Inverness","Kowloon","Laputa","Longyearbyen","Lys","Matmata","Maycomb","Metropolis","Miyake-jima","Monowi","Nagoro","Navarre","New New York","Nimbin","Pemberley","Pseudopolis","Rivendell","Roswell","Shangri-La","Springfield","Supilinn","Thneedville","Trantor","Wobegon","Yonwood","Xanadu","Xylar","Zion"];function rfe({count:t=1,participantsCount:e=32}={}){const i=Qo(jLe),n=i.slice(0,t);return{cities:nt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Al(n))}}function ofe({count:t=1,participantsCount:e=32}={}){const i=Qo(VLe),n=i.slice(0,t).map(r=>Object.keys(r)).flat();return{states:nt(0,e).map(r=>r<Math.min(t,i.length)?n[r]:Al(n))}}function afe({count:t=1,participantsCount:e=32}={}){const i=nt(0,t).map(()=>nt(0,5).map(()=>js(0,9)).join(""));return{postalCodes:nt(0,e).map(n=>n<t?i[n]:Al(i))}}function sfe(t){const{cities:e,states:i,postalCodes:n,nationalityCode:r,participantIndex:o}=t;return{postalCode:n==null?void 0:n[o],state:i==null?void 0:i[o],city:e==null?void 0:e[o],countryCode:r}}var HLe={lastNames:["Abbey","Ahern","Ampleforth","Ananiadis","Andelic","Assange","Atreides","Austen","Bach","Banks","Barrington","Batty","Bauers","Beals","Beer","Bennett","Berry","Bonaparte","Brockovich","Bukowski","Cassidy","Catton","Calvino","Carson","Chip","Constant","Crane","Crowne","Cummings","Curie","Dallas","Diamond","Deckard","Drazic","Dunbar","Earhart","Eisenstein","Eldritch","Elliot","Escher","Eyre","Faulkner","Fulcher","Fukuoka","Godel","Goldstein","Greer","Hedges","Herbert","Holmgren","Humperdinck","Huxley","Illich","Jeffers","Jensen","Jevons","Johnson","Johnstone","Jovovich","Kingsnorth","Langer","Fernwright","Fuller","Le Guin","Lem","Lovelace","Mander","Midgely","Mond","Montoya","Moore","Murry","Nagle","Nearing","Ogden","Ophuls","Parks","Paz","Peet","Perfect","Pendejo","Pevensie","Postman","Ripley","Rodda","Rumfoord","Runciter","Rugen","Sale","Schumacher","Shaftoe","Shelley","Shepard","Smith","Stratton","Stewart","Swift","Tillich","Turing","Tyrell","Twain","Yeats","Veblen","Yates","Vonnegut","Waterhouse","Watson","Wolin","Wirt","Waschuk","Wormwood"],firstFemale:["Ada","Amelia","Amelie","America","Anne","Antonia","Aravis","Astrid","Beatrice","Brienne","Buttercup","Caitlin","Cimorene","Cordelia","Desdemona","Ellen","Elizabeth","Emily","Emmie","Erin","Eva","Evelyn","Heather","Helen","Hermia","Hypatia","Imogen","Jane","Jasmine","Juliana","Juliet","Katniss","Leeloo","Lenina","Lilith","Linda","Lizzie","Louise","Lucy","Marie","Mary","Martha","Matilda","Milla","Miranda","Meg","Melba","Nicole","Ola","Portia","Pris","Rachael","Rachel","Rebecca","River","Rosa","Rosalind","Scout","Sharn","Susanne","Titania","Uhura","Ursula","Valentina","Viola","Virginia","Xena","Zoe"],firstMale:["Alan","Aldous","August","Axel","Barda","Barry","Bill","Bruce","Charles","Chris","Constantine","Darwin","David","Derrick","Edward","Emmanuel","Ernst","Estlin","Fezzik","Filby","Frank","Frito","George","Glen","Helmholtz","Inigo","Italo","Ivan","James","Jared","Jerry","Joe","Johann","Julian","John Michael","Jonathan","Korben","Kirkpatrick","Kurt","Lief","Malachi","Mark","Masanobu","Maurits","Michael","Mustapha","Neil","Nikola","Octavio","Palmer","Paul","Pierre","Robinson","Rick","Rincewind","Roy","Shannon","Sheldon","Stafford","Stanislaw","Stanley","Syme","Thorstein","Thomas","Tyrone","Vizzini","Walton","Walker","Warren","Wendell","Westley","William","Winston","Zoran"]};function mL(t){const{count:e=100,sex:i}=t||{};if(!e||i&&![rn,Dn].includes(i))return{personData:[],error:Re};const n=Math.ceil(1.3*e),{lastNames:r,firstFemale:o,firstMale:a}=HLe,s=Fh.map(({iso:m})=>m).filter(Boolean),l=Math.ceil(n/r.length),c=Math.ceil(n/o.length),u=Math.ceil(n/a.length),d=nt(0,l).flatMap(()=>{const m=ft(r,!1,!0);return nt(0,r.length).map(()=>es(m))}),p=nt(0,c).flatMap(()=>{const m=ft(o,!1,!0);return nt(0,o.length).map(()=>es(m))}),h=nt(0,u).flatMap(()=>{const m=ft(a,!1,!0);return nt(0,a.length).map(()=>es(m))}),f={};for(let m=0;m<n;m++){const g=d.pop(),v=i||Al([rn,Dn]),y=v===rn?h.pop():p.pop(),b=Al(s);f[`${y}${g}`]={nationalityCode:b,sex:v,firstName:y,lastName:g}}return{personData:Object.values(f).slice(0,e)}}function lfe(t){let e=(t==null?void 0:t.count)||1;const{personExtensions:i,consideredDate:n,isMock:r=!0,gendersCount:o,personData:a,category:s,sex:l}=t||{};if(isNaN(e))return{error:Re};const c=(o==null?void 0:o[rn])||l===rn&&e||0,u=(o==null?void 0:o[Dn])||l===Dn&&e||0;e=Math.max(e,c+u);const d=e-(c+u),p=[...c&&mL({count:c,sex:rn}).personData||[],...u&&mL({count:u,sex:Dn}).personData||[],...d&&mL({count:d}).personData||[]];let h=p.filter(S=>!l||c&&u||S.sex===l);const f=[];if(Array.isArray(a)){const S=a.filter(w=>typeof w.firstName=="string"&&typeof w.lastName=="string"&&!(w.sex&&![rn,Dn].includes(w.sex))&&!(w.nationalityCode&&(typeof w.nationalityCode!="string"||w.nationalityCode.length>3||!Fh.find(({iso:U,ioc:D})=>[U,D].includes(w.nationalityCode))))&&(w.nationalityCode&&f.push(w.nationalityCode),!0));if(!S.length)return{error:Re};h=S}const m=a?h:Qo(h);if(m.length<e){const{maleFirstNames:S,maleLastNames:w,femaleFirstNames:U,femaleLastNames:D,nationalityCodes:E}=p.reduce((C,M)=>{const{firstName:N,lastName:R,nationalityCode:A}=M;return M.sex===rn?(C.maleFirstNames.includes(N)||C.maleFirstNames.push(N),C.maleLastNames.includes(R)||C.maleLastNames.push(R)):(C.femaleFirstNames.includes(N)||C.femaleFirstNames.push(N),C.femaleLastNames.includes(R)||C.femaleLastNames.push(R)),C.nationalityCodes.includes(A)||C.nationalityCodes.push(A),C},{maleFirstNames:[],maleLastNames:[],femaleFirstNames:[],femaleLastNames:[],nationalityCodes:[]});nt(0,e-m.length).forEach(()=>{const C=l||Al([rn,Dn]),M=Al(E),N={firstName:Al(C===rn?S:U),lastName:Al(C===rn?w:D),sex:C,nationalityCode:M};m.push(N)})}const{ageMinDate:g,ageMaxDate:v}=gC({consideredDate:n,category:s}),y=Ct((g==null?void 0:g.slice(0,4))||0)||Ct((v==null?void 0:v.slice(0,4))||0)-3,b=Ct((v==null?void 0:v.slice(0,4))||0)||Ct((g==null?void 0:g.slice(0,4))||0)+3,I=(g||v)&&[y,b],T=m.slice(0,e).map((S,w)=>{const[U,D]=I||[],E=I&&es(nt(U,D)),C=es(nt(0,365)),M=E&&function(N,R,A){const _=new Date(N,0);return Mc(new Date(_.setDate(R)),A)}(E,C);return Object.assign(It({extensions:i||[{name:"regionCode",value:w+1}],birthDate:M,isMock:r}),S)});return{persons:T.length&&T||m[0],nationalityCodes:f}}var GLe=["Ace Academy","Avengers","Ball Bouncers","Baseliners","Captivators","Civil Disobedients","Continentals","Court Royal","Court Sharks","Diamond Dogs","Danger Zone","Doubles Dominators","Double Faults","Tricksters","Eliminators","Court Crusaders","Fuzz Busters","Game Changers","Goal Gurus","Good Volley","Green Machine","Hawk Eyes","Inside Outers","Killer Instinct","Line Toers","Masters of Mayhem","Matter Catchers","Cheap Shot","Mean Machines","Mindspace Invaders","Net Centric","Net Positive","Smash Mullet","Over Your Head","Spin Meisters","Aggressors","Racket Machine","Slice Happy","Refs Nightmare","Sandeaters","Sun Seekers","Slicer Dicers","Sparkle Soul Tribe","Stacked Deck","Cross Stringers","The Emergence","Total Demolition","Touch and Go","Upside Downers","Vertically Challenged","Visual Spectacle"];function yB({nameRoot:t="TEAM",count:e=1}={}){const i=Qo(GLe).slice(0,e);return i.length<e&&nt(0,e-i.length).forEach(n=>i.push(`${t} ${n+1}`)),{names:i}}function bB({idPrefix:t,participantType:e,index:i,uuids:n}){return t?`${t}-${e===ui?"I":"P"}-${i}`:(n==null?void 0:n.pop())||Hi()}function _C(t){let{rankingRange:e,scaledParticipantsCount:i}=t;const{ratingsParameters:n=Gs,valuesInstanceLimit:r,consideredDate:o,category:a,nationalityCodesCount:s,nationalityCodeType:l,nationalityCodes:c,participantsCount:u=32,participantType:d,personIds:p,idPrefix:h,uuids:f,personExtensions:m,addressProps:g,gendersCount:v,matchUpType:y,personData:b,sex:I,inContext:T,withISO2:S,withIOC:w,scaleAllParticipants:U}=t,D=d===qt||y===ey,E=d===on||y===on;!e||Array.isArray(e)&&e.every(te=>ir(te))&&e.length===2||(e=void 0),i=U?u:i,e=e||[1,i&&i>1e3?i:1e3],e[1]+=1;const C=u*(D?2:E?8:1),M=lfe({count:C,personExtensions:m,consideredDate:o,gendersCount:v,personData:b,category:a,sex:I});if(M.error)return M;const{nationalityCodes:N,persons:R}=M;let A=[],_=[],k=[],O=[];if(typeof a=="object"){const{categoryName:te,ageCategoryCode:J,ratingType:ie}=a;if((te||J)&&!ie){const[oe,ne]=e||[];if(_=Qo(nt(oe,ne)).slice(0,i||js(20,30)),[qt,on].includes(d)){const[re,me]=e||[];A=Qo(nt(re,me)).slice(0,i||js(20,30))}}if(ie&&n[ie]){const{ratingMax:oe,ratingMin:ne,ratingAttributes:re}=a,me={...n[ie],...re||{}},{attributes:he={},decimalsCount:be,accessors:Se,range:De,step:Oe}=me,xe=ye=>{const Ie={},Ne=Object.keys(ye||{});for(const Fe of Ne){const Le=ye[Fe];if(typeof Le=="object"&&Le.generator){const{range:ge}=Le,[Ee,we]=ge.slice().sort();Ie[Fe]=js(Ee,we)}else Ie[Fe]=Le}return Ie},$e=De[0]>De[1]?2:.5,[Ae,ve]=De.slice().sort(),ke=()=>nt(0,2e3).map(()=>Gle(Ae,ve,$e,Oe,be)).filter(ye=>(!oe||ye<=oe)&&(!ne||ye>=ne)).slice(0,i||js(20,30)).map(ye=>Se?Object.assign({},...Se.map(Ie=>({[Ie]:ye})),xe(he)):ye);k=ke(),[qt,on].includes(d)&&(O=ke())}}const F=Fh.filter(te=>l==="IOC"&&te.ioc||te.iso),{postalCodesProfile:B,postalCodesCount:$,statesProfile:V,citiesProfile:H,citiesCount:z,statesCount:G}=g||{},W=te=>Object.keys(te).map(J=>nt(0,V[J]).map(()=>J)).flat(),K={cities:H&&W(H)||(g==null?void 0:g.cities)||rfe({count:z||C,participantsCount:C}).cities,states:V&&W(V)||(g==null?void 0:g.states)||ofe({count:G||C,participantsCount:C}).states,postalCodes:B&&W(B)||(g==null?void 0:g.postalCodes)||afe({count:$||C,participantsCount:C}).postalCodes},Z=function(te){const J=Math.ceil(C/te);return r&&J>r?Math.ceil(C/r):te}(s),Y=Z?Qo(F).slice(0,s):c?F.filter(te=>c.includes(te.iso)):F,X=Qo(nt(0,Math.ceil(C/(Z||1))).map(()=>Y).flat(1/0)),Q=yB({count:u}).names;return{participants:nt(0,u).map(te=>{const J=D?2:E?8:1,ie=nt(0,J).map(he=>function(be){const Se=R[be],{nationalityCode:De,participantExtensions:Oe,participantTimeItems:xe,extensions:$e,firstName:Ae,birthDate:ve,lastName:ke,personId:ye,sex:Ie}=Se||{},Ne=Ae||"GivenName",Fe=ke||"FamilyName",Le=`${Ne} ${Fe}`,ge=X[be],Ee=(N==null?void 0:N.length)&&De||ge&&(l==="IOC"?ge.ioc||ge.iso:ge.iso||ge.ioc)||De;!(X!=null&&X.length)||Ee||De||console.log("%c Invalid Nationality Code",{participantIndex:be,country:ge});const we=sfe({...K,participantIndex:be,nationalityCode:Ee}),fe=It({participantId:bB({participantType:ui,index:be,idPrefix:h,uuids:f}),extensions:Oe,timeItems:xe,participantRole:Ro,participantType:ui,participantName:Le,person:{addresses:[we],personId:ye||(p==null?void 0:p.length)&&p[be]||Hi(),standardFamilyName:Fe,standardGivenName:Ne,nationalityCode:Ee,extensions:$e,birthDate:Ss(ve)?ve:void 0,sex:Ie}});if(w&&Ee){const Te=Fh.find(({iso:ue})=>ue===Ee);Te!=null&&Te.ioc&&(fe.person.iocNationalityCode=Te.ioc),Te!=null&&Te.label&&(fe.person.countryName=Te.label)}if(S&&Ee){const Te=Fh.find(({iso:ue})=>ue===Ee);Te!=null&&Te.iso2&&(fe.person.iso2NationalityCode=Te.iso2),Te!=null&&Te.label&&(fe.person.countryName=Te.label)}if(a){const Te=_[be],ue=A[be];N1({scaleValue:Te,eventType:fw,scaleType:Vm,participant:fe,category:a}),N1({scaleValue:ue,eventType:Wm,scaleType:Vm,participant:fe,category:a});const de=k[be],_e=O[be];N1({scaleValue:de,eventType:fw,scaleType:Tv,participant:fe,category:a}),N1({scaleValue:_e,eventType:Wm,scaleType:Tv,participant:fe,category:a})}return fe}(te*J+he)),oe=ie.map(he=>he.participantId),ne=ie.map(he=>he.person.standardFamilyName).join("/"),re=D?qt:on,me={participantId:bB({participantType:re,idPrefix:h,index:te,uuids:f}),participantRole:Ro,participantName:D?ne:Q[te],individualParticipantIds:oe,participantType:re};return T&&(me.individualParticipants=ie),D||E?[me,...ie]:ie}).flat(),...le}}function N1({scaleValue:t,participant:e,eventType:i,scaleType:n,category:r}){const o=r.categoryName||r.ratingType||r.ageCategoryCode,a={itemValue:t,itemType:[lw,n,i,o].join(".")};o&&t&&(e.timeItems||(e.timeItems=[]),e.timeItems.push(a))}function cfe({alternatesCount:t=0,tieFormatName:e,tieFormat:i,drawSize:n}){var r;let o=0,a=0,s=0,l=0;const c={},u={[rn]:0,[Dn]:0,[is]:0,[tv]:0,[Ru]:0};i=typeof i=="object"?i:oy({namedFormat:e}),(r=i==null?void 0:i.collectionDefinitions)==null||r.filter(Boolean).forEach(p=>{const{category:h,collectionId:f,matchUpType:m,matchUpCount:g,gender:v}=p;if([rn,Dn].includes(v)){const y=g*(m===Pn?2:1);u[v]<y&&(u[v]=y)}else v===is&&(u[rn]<g&&(u[rn]=g),u[Dn]<g&&(u[Dn]=g));if(h){const y=JSON.stringify(h);c[y]=h}if(f||(p.collectionId=Hi()),m===Pn){const y=g;l+=g,o=Math.max(o,y)}if(m===vr){const y=g;s+=g,a=Math.max(a,y)}});const d=Object.keys(c).length?Math.max(s,2*l):Math.max(a,2*o);return{maxDoublesDraw:o*(n+t),maxSinglesDraw:a*(n+t),teamSize:d,genders:u}}function ufe({participantsProfile:t,tournamentRecord:e,eventProfiles:i,drawProfiles:n,startDate:r,uuids:o}){const{participantsCount:a,participantType:s,largestTeamDraw:l,largestTeamSize:c,gendersCount:u}=function({participantsProfile:v,eventProfiles:y,drawProfiles:b}){let{participantsCount:I,participantType:T=ui}=v||{};const S=I||0,w={[Dn]:0,[is]:0,[tv]:0,[rn]:0,[Ru]:0};let U=0,D=0,E=0,C=0,M=0;const N=({alternatesCount:A=0,uniqueParticipants:_,tieFormatName:k,drawSize:O=0,eventType:F,tieFormat:B,category:$,gender:V,stage:H})=>{const z=F===Bc,G=F===Yr,W=!!(_||H===St||$||V);if(G){C=Math.max(C,O+A),B=typeof B=="object"?B:oy({namedFormat:k});const{teamSize:K,maxDoublesDraw:Z,maxSinglesDraw:Y,genders:X}=cfe({alternatesCount:A,tieFormatName:k,tieFormat:B,drawSize:O});E=Math.max(E,K),D=Math.max(D,Y),W||(U=Math.max(U,Z)),Object.keys(X).forEach(Q=>w[Q]+=X[Q])}else if(z)if(W){const K=2*(O+A);M+=K,V&&(w[V]+=K)}else O+A&&O+A>U&&(U=O+A);else if(W){const K=O+A;V&&(w[V]+=K),M+=K}else O&&O>D&&(D=O+A)};if(y==null||y.forEach(A=>{const{tieFormatName:_,tieFormat:k,drawProfiles:O,eventType:F,category:B,gender:$}=A;if(O)for(const V of O){const{tieFormatName:H,tieFormat:z}=V;N({...V,tieFormatName:H||_,tieFormat:z||k,eventType:F,category:B,gender:$})}}),Array.isArray(b))for(const A of b)N(A);const R=Math.max(C*E,2*U,D);return U&&(T=qt),(I||S)<R&&(I=R),I&&U&&[qt,Yr].includes(T)&&(D&&Math.floor(D/2)>U?I=Math.floor(D/2):(!D||2*U>=D)&&(I=Math.ceil(I/2))),I===void 0&&(I=y!=null&&y.length||b!=null&&b.length?0:32),I<S&&(I=S),{uniqueParticipantsCount:M,participantsCount:I,largestTeamDraw:C,largestTeamSize:E,participantType:T,gendersCount:w}}({participantsProfile:t,eventProfiles:i,drawProfiles:n}),d=t==null?void 0:t.teamKey,p=_C({uuids:o,...t,consideredDate:r,participantsCount:a,participantType:s,gendersCount:u}).participants;let h=0,f=jc({tournamentRecord:e,participants:p});if(f.error)return f;if(h+=f.addedCount,d){const v=Rq({tournamentRecord:e,...d});if(v.error)return v}const m=p.filter(({participantType:v})=>v===ui).map(li),g=t!=null&&t.idPrefix?`${on}-${t.idPrefix}`:void 0;return f=jc({participants:nt(0,l).map(v=>{const y=m.slice(v*c,(v+1)*c),b=bB({index:v,participantType:s,idPrefix:g,uuids:o});return{participantName:`Team ${v+1}`,participantRole:Ro,individualParticipantIds:y,participantType:on,participantId:b}}),tournamentRecord:e}),f.error?f:(h+=f.addedCount,{addedCount:h,...le})}const dfe=()=>({altitude:void 0,courtId:void 0,courtName:"",courtDimensions:void 0,latitude:void 0,longitude:void 0,surfaceCategory:void 0,surfaceType:void 0,surfacedDate:void 0,dateAvailability:[],onlineResources:[],pace:void 0,notes:void 0});function YR(t){return parseInt(t)}function l8({startTime:t="",endTime:e=""}={}){if(!(t&&e&&um.test(t)&&um.test(e)))return!1;const[i,n]=t.split(":").map(YR),[r,o]=e.split(":").map(YR);return!(r<i)&&!(i===r&&o<n)}function zLe(t,e){const[i,n]=t.startTime.split(":").map(YR),[r,o]=e.startTime.split(":").map(YR);return i<r?-1:i>r?1:n<o?-1:n>o?1:0}function pfe({dateAvailability:t}){if(!t)return{error:v_e};if(!Array.isArray(t))return{error:WO};const e="Times must be 24 hour => 00:00";for(const i of t){if(typeof i!="object")return{error:WO};const{date:n,startTime:r,endTime:o,bookings:a=[]}=i;if(!r||!o)return{error:WO};if(n&&!Mu.test(n))return{error:Ha,dateAvailability:{date:n},info:"Dates must be formated => YYYY-MM-DD"};if(!um.test(r))return{error:hc,dateAvailability:{startTime:r},info:e};if(!um.test(o))return{error:hc,dateAvailability:{endTime:o},info:e};if(r===o)return{error:hc,dateAvailability:{startTime:r,endTime:o},info:"startTime and endTime are equivalent"};if(!l8({startTime:r,endTime:o}))return{error:hc,dateAvailability:{startTime:r,endTime:o},info:"endTime must be after startTime"};if(a){if(!Array.isArray(a))return{error:x2};for(const s of a){if(typeof s!="object")return{error:x2};const{startTime:l,endTime:c}=s;if(!um.test(l))return{error:hc,booking:{startTime:l},info:e};if(!um.test(c))return{error:hc,booking:{endTime:c},info:e};if(l===c)return{error:hc,dateAvailability:{startTime:l,endTime:c},info:"startTime and endTime are equivalent"};if(!l8({startTime:l,endTime:c}))return{error:hc,dateAvailability:{startTime:l,endTime:c},info:"endTime must be after startTime"}}}}return{valid:!0}}function Sx({tournamentRecord:t,disableNotice:e,venueId:i,courtId:n,court:r}){const{venue:o}=Jp({tournamentRecord:t,venueId:i});if(!o)return{error:_0};o.courts||(o.courts=[]);const a={...dfe(),venueId:i,courtId:n};if(a.courtId||(a.courtId=Hi()),o.courts.some(s=>s.courtId===a.courtId))return{error:O_e};{const s=((r==null?void 0:r.dateAvailability)||[]).map(u=>{var d;return{...u,date:zt(u.date),startTime:mn(u.startTime),endTime:mn(u.endTime),bookings:(d=u.bookings)==null?void 0:d.map(({startTime:p,endTime:h,bookingType:f})=>({startTime:mn(p),endTime:mn(h),bookingType:f}))}}),l=Object.keys(a);for(const u of l)if(r!=null&&r[u])if(u==="dateAvailability"){const d=pfe({dateAvailability:s});if(!d.valid&&d.error)return d;a.dateAvailability=s}else a[u]=r[u];const c=a;return o.courts.push(c),e||bi({payload:{venue:o,tournamentId:t.tournamentId},topic:Xy,key:o.venueId}),{...le,court:ft(a),venueId:i}}}function Nq(t){const{tournamentRecord:e,venueId:i}=t;if(typeof i!="string"||!i)return{error:Fm};const n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{},r=[];let o;for(const a of Object.values(n)){const{venue:s}=Jp({tournamentRecord:a,venueId:i});if(s){const l=WLe({...t,tournamentRecord:a});for(const c of(l==null?void 0:l.courts)??[])r.push(c==null?void 0:c.courtId);if(l.error)return l;o=!0}}return o?{...le,courtIds:r}:{error:_0}}function WLe({courtNameRoot:t="Court",dateAvailability:e=[],venueAbbreviationRoot:i,tournamentRecord:n,courtNames:r=[],courtTimings:o,courtsCount:a,startTime:s,courtIds:l,endTime:c,idPrefix:u,venueId:d,dates:p}){if(!d)return{error:Fm};const h=Jp({tournamentRecord:n,venueId:d});if(h.error)return h;const{venue:f}=h;if(!ir(a)||!r)return{error:x_e};const m=nt(0,a=a??r.length).map(g=>{const v=o==null?void 0:o[g],y=v?p.map(b=>({date:Mc(b),startTime:s,endTime:c,...v})):e;return v&&s&&c&&y.push({startTime:s,endTime:c}),{courtName:r[g]||i&&(f==null?void 0:f.venueAbbreviation)&&`${f==null?void 0:f.venueAbbreviation} ${g+1}`||`${t} ${g+1}`,dateAvailability:y}}).map((g,v)=>{const y=(l==null?void 0:l.pop())||u&&`${u}-${v+1}`;return Sx({disableNotice:!0,tournamentRecord:n,courtId:y,venueId:d,court:g})}).map(g=>g.court).filter(Boolean);return m.length!==a?ce({info:"not all courts could be generated",result:{error:Re}}):(f&&bi({payload:{venue:f,tournamentId:n.tournamentId},topic:Xy,key:f.venueId}),{...le,courts:ft(m)})}function hfe({tournamentRecord:t,venueProfiles:e,uuids:i}){const{startDate:n,endDate:r}=t,o=[];for(const[a,s]of e.entries()){const{venueAbbreviation:l,venueId:c=(i==null?void 0:i.pop())??Hi(),dateAvailability:u,startTime:d="07:00",endTime:p="19:00",courtTimings:h,courtsCount:f,courtNames:m,venueName:g,idPrefix:v,courtIds:y}=s,b=tC({tournamentRecord:t,venue:{venueName:g||`Venue ${a+1}`,venueAbbreviation:l,venueId:c}});if(b.error)return b;o.push(c);const I=ik(n,r),T=!Array.isArray(u)&&[{startTime:d,endTime:p}].concat(I.map(w=>({date:Mc(w),startTime:d,endTime:p}))),S=Nq({dateAvailability:u||T,tournamentRecord:t,courtTimings:h,courtsCount:f,courtNames:m,startTime:d,idPrefix:v,courtIds:y,endTime:p,venueId:c,dates:I});if(S.error)return S}return o}function ffe({drawProfiles:t,category:e,gender:i}){const n={},r=t==null?void 0:t.reduce((a,s)=>{const{qualifyingPositions:l=0,participantsCount:c=0,uniqueParticipants:u,stage:d=ct,drawSize:p=0}=s||{};Object.keys(a).includes(d)||(a[d]=0);const h=(c||p)-l;return u||i||e||d===St?(Object.keys(n).includes(d)||(n[d]=0),n[d]+=h):a[d]=Math.max(a[d],h),a},{}),o=Object.keys(n);return o.forEach(a=>r[a]+=n[a]),{stageParticipantsCount:r,uniqueParticipantsCount:n,uniqueParticipantStages:o}}function mfe({allUniqueParticipantIds:t,stageParticipantsCount:e,eventParticipantType:i,targetParticipants:n}){const r=e[ct]||0,o=e[St]||0;return{stageParticipants:{QUALIFYING:n.filter(({participantType:a})=>a===i).filter(({participantId:a})=>!t.includes(a)).slice(0,o),MAIN:n.filter(({participantType:a})=>a===i).filter(({participantId:a})=>!t.includes(a)).slice(o,o+r)}}}function Tw(t){const{removePriorValues:e,tournamentRecord:i,participantId:n,scaleItem:r}=t;let o,a;if(!vfe({scaleItem:r}))return{error:ek};if(n&&Array.isArray(i.participants)&&(a=i.participants.find(s=>s.participantId===n),a)){const s=yfe({removePriorValues:e,participant:a,scaleItem:r});if(s.error)return s;o=!s.valueChanged;const{topics:l}=Bu();l.includes(Lo)&&bi({topic:Lo,payload:{tournamentId:i.tournamentId,participants:[a]}})}return o&&{...le,info:bce,existingValue:r==null?void 0:r.scaleValue}||a&&{...le,newValue:r==null?void 0:r.scaleValue}||{error:rr}}function gfe(t){var e;const{scaleItemsWithParticipantIds:i=[],removePriorValues:n,tournamentRecord:r,auditData:o,context:a}=t;if(!r)return{error:je};if(!r.participants)return{error:X_};let s=0;const l={},c=[];for(const p of i){const h=p==null?void 0:p.participantId;if(Array.isArray(p==null?void 0:p.scaleItems))for(const f of p.scaleItems){if(!vfe({scaleItem:f}))return{error:ek};Array.isArray(l[h])||(l[h]=[]),l[h].push(f)}}r.participants.forEach(p=>{const{participantId:h}=p||{};Array.isArray(l[h])&&l[h].forEach(f=>{yfe({participant:p,scaleItem:f,removePriorValues:n}),c.push(p),s++})});const u=s?void 0:BP,{topics:d}=Bu();if(d.includes(Lo)&&s&&bi({topic:Lo,payload:{tournamentId:r.tournamentId,participants:c}}),a){const{eventId:p,drawId:h,...f}=a,m=((e=f.scaleAttributes)==null?void 0:e.scaleType)&&[f.scaleAttributes.scaleType];if(Object.keys(f).length){const g={itemType:sue,itemValue:f};if(m&&(g.itemSubTypes=m),h||p){const{drawDefinition:v,event:y}=us({tournamentRecord:r,eventId:p,drawId:h});h&&r3({drawDefinition:v,timeItem:g}),p&&db({event:y,timeItem:g})}else ub({tournamentRecord:r,timeItem:g})}}return o&&d.includes(SU)&&bi({topic:SU,payload:o}),It({...le,modificationsApplied:s,info:u})}function vfe({scaleItem:t}){const e=t&&Object.keys(t),i=["scaleType","eventType","scaleName"];return i.filter(n=>e==null?void 0:e.includes(n)).length===i.length}function yfe({removePriorValues:t,participant:e,scaleItem:i}){if(!e)return{error:A0};const n=i&&Object.keys(i),r=["scaleType","eventType","scaleName"];if(r.filter(c=>n.includes(c)&&i[c]).length!==r.length)return{error:ek};const o=new Date().toISOString();e.timeItems||(e.timeItems=[]);const{scaleItem:a}=ud({scaleAttributes:i,participant:e}),s=c=>[void 0,null,""].includes(c),l=!(s(a==null?void 0:a.scaleValue)&&s(i.scaleValue))&&JSON.stringify(a==null?void 0:a.scaleValue)!==JSON.stringify(i.scaleValue);if(l){const{scaleType:c,eventType:u,scaleName:d}=i,p=[lw,c,u,d].join("."),h=It({itemValue:i.scaleValue,itemDate:i.scaleDate,createdAt:o,itemType:p});i.scaleId&&(h.itemSubTypes=[i.scaleId]),t&&(e.timeItems=e.timeItems.filter(f=>f.itemType!==p)),e.timeItems.push(h)}return{...le,valueChanged:l,newValue:i.scaleValue}}const qLe={[Li]:2,[gr]:1,[Mr]:1,[da]:1,[Mi]:4};function Aq(t){let{defaultWithScorePercent:e=2,winningSide:i}=t;const{matchUpStatusProfile:n=qLe,matchUpFormat:r=Xs,pointsPerMinute:o=1,sideWeight:a=4}=t;if(!Rs({matchUpFormat:r}))return{error:ice};if(typeof n!="object")return{error:Re};if(e>100&&(e=100),isNaN(e)||isNaN(o)||isNaN(a))return{error:Re};const s=Object.keys(n).filter(U=>Object.keys(Pke).includes(U)&&U!==fr);if(Object.keys(s).reduce((U,D)=>U+n[D],0)>100)return{error:Re,matchUpStatusProfile:n};const l=s.reduce((U,D)=>(U.pointer=U.pointer+n[D],U.valueMap.push([U.pointer,D]),U),{pointer:0,valueMap:[]}),c=js(1,100),u=(l.valueMap.find(U=>c<=U[0])??[100,fr])[1],d={sets:[],scoreStringSide1:"",side2ScoreString:""};if([Li,Mi].includes(u)){i=i||js(1,2);const U={score:d,winningSide:i,matchUpStatus:u};if(!(u===Mi&&js(1,100)>100-e))return{outcome:U}}else if([gr,Mr].includes(u))return{outcome:{score:d,matchUpStatus:u}};const p=Ga(r),{bestOf:h,setFormat:f,finalSetFormat:m}=p??{},g=[],v=js(0,1),y=i?[i-1]:[...nt(0,a).map(()=>v),1-v],b=[da,Mi,Cd,Sg].includes(u)&&(es(nt(1,h))||1);let I;for(const U of nt(1,(h??0)+1)){const D=U===h,{set:E,incomplete:C,winningSideNumber:M}=YLe({incomplete:b===U,matchUpStatus:u,pointsPerMinute:o,setFormat:D&&m||f,setNumber:U,weightedRange:y});if(g.push(E),C){I=M;break}if(xU({matchUp:{score:{sets:g},matchUpFormat:r}}).calculatedWinningSide)break}const T=xU({matchUp:{score:{sets:g},matchUpFormat:r}}),S=I?i||I:T.calculatedWinningSide,{score:w}=Xhe({score:{sets:g},winningSide:S,matchUpStatus:u});return{outcome:{score:w,winningSide:S,matchUpStatus:u}}}function YLe({weightedRange:t=[0,1],pointsPerMinute:e,matchUpStatus:i,incomplete:n,setFormat:r,setNumber:o}){const a={setNumber:o},{setTo:s,tiebreakFormat:l,tiebreakAt:c,tiebreakSet:u,timed:d,minutes:p}=r,h=js(0,t.length-1),f=t[h];let m;if(d){const g=p*e,v=Math.round(.2*g),y=g+es([1,-1])*v,b=function(U=1,D=3,E=!0){let C=0;for(let M=0;M<D;M++)C+=Math.random()*(U/D);return E&&U>1?Math.round(C):C}(y,2),I=[b,y-b];f&&I.reverse(),m=t[h]+1;let T=(I[0]>I[1]?1:I[1]>I[0]&&2)||0;if(n){const[U,D]=I;return Object.assign(a,{side1Score:U,side2Score:D}),no.includes(i)?{set:a,incomplete:n,winningSideNumber:m}:{set:a,incomplete:n}}T||(I[js(0,1)]+=1),T=I[0]>I[1]?1:2,T!==m&&I.reverse();const[S,w]=I;return Object.assign(a,{side1Score:S,side2Score:w,winningSide:m}),{set:a}}if(n)return a.side1Score=js(0,c),a.side2Score=js(0,c),no.includes(i)&&(m=t[h]+1),{set:a,incomplete:n,winningSideNumber:m};{const g=nt(1,s+1).map(w=>nt(0,s+2-w).map(()=>w)).flat(),v=g[js(0,g.length-1)],y=s&&Rpe({isSide1:!0,tiebreakAt:c,lowValue:v,setTo:s}),b=!y,I=t.length===1&&t[h]+1;if(!b){I?(y[0]>y[1]?1:2)!==I&&y.reverse():f&&y.reverse();const[w,U]=y;Object.assign(a,{side1Score:w,side2Score:U})}const T=VR({matchUpScoringFormat:{setFormat:r},setObject:a});let S;if(T.hasTiebreakCondition||b){const{NoAD:w,tiebreakTo:U}=l||u||{},D=nt(1,U+1).map(M=>nt(0,U+2-M).map(()=>M)).flat(),E=D[js(0,D.length-1)],C=oq({isSide1:!0,tiebreakNoAd:w,tiebreakTo:U,lowValue:E});if(C)if(b){const M=C[0]>C[1]?1:2;I?M!==I&&C.reverse():f&&C.reverse(),[a.side1TiebreakScore,a.side2TiebreakScore]=C,S=(C[0]>C[1]?1:C[1]>C[0]&&2)||void 0}else T.leadingSide===2?[a.side1TiebreakScore,a.side2TiebreakScore]=C:[a.side2TiebreakScore,a.side1TiebreakScore]=C}a.winningSide=T.winningSide||T.leadingSide||I||S}return{set:a}}function KR(t){var e,i,n;const{matchUpStatusProfile:r,completeAllMatchUps:o,randomWinningSide:a,tournamentRecord:s,completionGoal:l,drawDefinition:c,event:u}=t;if(!c)return{error:rt};const d=t.matchUpFormat||c.matchUpFormat||(u==null?void 0:u.matchUpFormat),p=c.structures.slice().sort(Zy);let h=0;const{matchUps:f,matchUpsMap:m}=Ar({contextFilters:{stages:[ct,St]},matchUpFilters:{matchUpTypes:[gn],roundNumbers:[1]},inContext:!0,drawDefinition:c});if(f!=null&&f.length){const y=((e=u==null?void 0:u.category)==null?void 0:e.ageCategoryCode)||((i=u==null?void 0:u.category)==null?void 0:i.categoryName);if(y){const b=Ahe({singlesOnly:!0,tournamentRecord:s,drawDefinition:c,scaleAccessor:{scaleName:y,sortOrder:DLe,scaleType:Vm},event:u});if(b.error)return b;const{lineUps:I,participantsToAdd:T}=b;jc({tournamentRecord:s,participants:T}),Ii({element:c,extension:{name:Cp,value:I}})}else{const b=(n=f[0])==null?void 0:n.structureId,{positionAssignments:I}=Ki({drawDefinition:c,structureId:b});if(I!=null&&I.length){const{participants:T}=Qn({participantFilters:{participantTypes:[gn]},tournamentRecord:s}),S=w=>{const U=w.tieMatchUps.filter(({matchUpType:E})=>E===vr),D=w.tieMatchUps.filter(({matchUpType:E})=>E===Pn);U.forEach((E,C)=>{const M=E.matchUpId;E.sides.forEach(N=>{var R;const{drawPosition:A}=N,_=T==null?void 0:T.find(k=>{const{participantId:O}=k,F=I.find(B=>B.participantId===O);return(F==null?void 0:F.drawPosition)===A});if(_){const k=(R=_.individualParticipantIds)==null?void 0:R[C];k&&qR({teamParticipantId:_.participantId,participantId:k,tournamentRecord:s,drawDefinition:c,tieMatchUpId:M,event:u})}})}),D.forEach((E,C)=>{const M=E.matchUpId;E.sides.forEach(N=>{var R;const{drawPosition:A}=N,_=T==null?void 0:T.find(k=>{const{participantId:O}=k,F=I.find(B=>B.participantId===O);return(F==null?void 0:F.drawPosition)===A});if(_){const k=(R=_.individualParticipantIds)==null?void 0:R.slice(2*C,2*C+2);k==null||k.forEach(O=>{qR({teamParticipantId:_.participantId,participantId:O,tournamentRecord:s,drawDefinition:c,tieMatchUpId:M,event:u})})}})})};f.forEach(S)}}}const g=typeof o=="string"&&o,v=g&&fr;for(const y of p){if(h>=l)break;const{matchUps:b}=zi({matchUpFilters:{matchUpTypes:[Pn,vr]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:y,event:u}),I=b.filter(({winningSide:T})=>!T).sort(ob).map($r);for(const T of I){if(!isNaN(l)&&h>=l)break;const{matchUps:S}=zi({matchUpFilters:{matchUpTypes:[Pn,vr]},afterRecoveryTimes:!1,tournamentRecord:s,inContext:!0,drawDefinition:c,matchUpsMap:m,structure:y,event:u}),w=S.find(D=>D.matchUpId===T),U=[gr,Mr].includes(w.matchUpStatus);if(w!=null&&w.readyToScore&&!U){const D=KLe({winningSide:!a&&1,matchUpStatusProfile:r,tournamentRecord:s,drawDefinition:c,targetMatchUp:w,matchUpFormat:d,matchUpStatus:v,scoreString:g,event:u});if(D!=null&&D.error)return D;h+=1}}}return{...le,completedCount:h}}function bfe(t){const{matchUpStatusCodes:e,policyDefinitions:i,tournamentRecord:n,drawDefinition:r,targetMatchUp:o,matchUpStatus:a,matchUpFormat:s,scoreString:l,winningSide:c,event:u}=t;if(!o||o.matchUpStatus===Ri)return;const{matchUpId:d}=o||{},{outcome:p}=Mq({matchUpFormat:s,matchUpStatus:a,scoreString:l,winningSide:c});return e&&(p.matchUpStatusCodes=e),NC({tournamentRecord:n,policyDefinitions:i,drawDefinition:r,matchUpFormat:s,matchUpId:d,outcome:p,event:u})}function KLe(t){const{matchUpStatusProfile:e={},tournamentRecord:i,policyDefinitions:n,drawDefinition:r,matchUpStatus:o,matchUpFormat:a,targetMatchUp:s,scoreString:l,winningSide:c,event:u}=t;if(l||o)return bfe(t);const{matchUpId:d}=s||{},{outcome:p}=Aq({matchUpStatusProfile:e,matchUpFormat:a,winningSide:c});return NC({policyDefinitions:n,tournamentRecord:i,drawDefinition:r,matchUpFormat:a,matchUpId:d,outcome:p,event:u})}function Ife({matchUpStatusProfile:t,completeAllMatchUps:e,randomWinningSide:i,tournamentRecord:n,drawProfiles:r,event:o}){var a,s,l,c;const u=Zn({event:o}).flightProfile,{eventName:d,eventType:p,category:h}=o,{startDate:f}=n,m=[],g=(h==null?void 0:h.categoryName)||(h==null?void 0:h.ageCategoryCode)||(h==null?void 0:h.ratingType),v=(a=o.drawDefinitions)==null?void 0:a.map(({drawId:y})=>y);if(Array.isArray(u==null?void 0:u.flights))for(const[y,b]of u.flights.entries()){const{drawId:I,stage:T,drawName:S,drawEntries:w}=b;m.push(b.drawId);const U=r[y],{seedsCount:D,generate:E=!0}=U||{};if(E){const C=w.filter(Ts(Pp)).map(Ts(Pp)),M=g||d;if(n&&D&&D<=C.length&&nt(1,D+1).forEach((k,O)=>{const F={scaleValue:k,scaleName:M,scaleType:ap,eventType:p,scaleDate:f},B=C[O];Tw({tournamentRecord:n,participantId:B,scaleItem:F})}),v!=null&&v.includes(I))break;let N=nx({...U,matchUpType:p,seedingScaleName:M,tournamentRecord:n,isMock:!0,drawEntries:w,drawName:S,drawId:I,event:o,stage:T});if(N.error)return{error:N.error,drawIds:[]};const{drawDefinition:R}=N;if(!R)return{error:ml};const A=(s=r[y])==null?void 0:s.drawExtensions;if(Array.isArray(A)&&A.filter(Eu).forEach(k=>Ii({element:R,extension:k})),N=ax({suppressNotifications:!0,tournamentRecord:n,drawDefinition:R,event:o}),N.error)return{error:N.error,drawIds:[]};if(U!=null&&U.withPlayoffs){const k=(l=R.structures)==null?void 0:l[0].structureId,O=jk({idPrefix:U.idPrefix,...U.withPlayoffs,tournamentRecord:n,drawDefinition:R,isMock:!0,structureId:k,event:o});if(O!=null&&O.error)return O}const _=U==null?void 0:U.completionGoal;if((U==null?void 0:U.automated)!==!1&&(e||_)){const k=U==null?void 0:U.matchUpFormat,O=KR({completeAllMatchUps:!_&&e,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,completionGoal:_,drawDefinition:R,matchUpFormat:k,event:o});if(O.error)return{error:O.error,drawIds:[]};const F=O.completedCount;if((U==null?void 0:U.drawType)===Rd){const B=(c=R.structures)==null?void 0:c.find(V=>V.stage===ct);if(!B)return{error:Cn};let $=dC({structureId:B.structureId,tournamentRecord:n,drawDefinition:R,event:o});if($.error)return{error:$.error,drawIds:[]};if($=KR({completeAllMatchUps:!_&&e,completionGoal:_&&_?_-(F??0):void 0,matchUpStatusProfile:t,randomWinningSide:i,tournamentRecord:n,drawDefinition:R,matchUpFormat:k,event:o}),$.error)return{error:$.error,drawIds:[]}}}}}return{...le,drawIds:m}}function wfe(t){var e,i;const{participantsProfile:n={},uniqueParticipantsCount:r,ratingsParameters:o,tournamentRecord:a,eventProfile:s,eventIndex:l,event:c,uuids:u}=t,{category:d,gender:p,eventType:h}=c,f=h===Np&&ui||h===Bc&&qt||h,m=r[ct]||0,g=r[St]||0,v=(e=s.drawProfiles)!=null&&e.length?m+g:((i=s.participantsProfile)==null?void 0:i.participantsCount)??0,y=[rn,Dn].includes(p)?p:void 0,b=n!=null&&n.idPrefix?`E-${l}-${n==null?void 0:n.idPrefix}`:void 0,{participants:I}=_C({uuids:s.uuids||u,...n,scaledParticipantsCount:s.scaledParticipantsCount,consideredDate:a==null?void 0:a.startDate,rankingRange:s.rankingRange,participantType:f,participantsCount:v,ratingsParameters:o,category:d,idPrefix:b,sex:y}),T=jc({tournamentRecord:a,participants:I});if(T.error)return T;const S=I==null?void 0:I.filter(({participantType:U})=>U===f),w=I==null?void 0:I.map(li);return{uniqueDrawParticipants:S,uniqueParticipantIds:w}}function ZLe({autoEntryPositions:t,tournamentRecord:e,drawParticipants:i,drawProfile:n,event:r}){const{drawType:o=hu,qualifyingPositions:a=0,stage:s=ct,drawSize:l=0,drawName:c,drawId:u}=n,d=l-a,p=i.slice(0,d).map(li);if(p.length){const f=dd({participantIds:p,autoEntryPositions:t,entryStage:s,tournamentRecord:e,event:r});if(f.error)return f}const h=lx({drawName:c||o,qualifyingPositions:a,drawEntries:p.map(f=>({entryStatus:cl,entryStage:s,participantId:f})),drawId:u,event:r,stage:s});return h.error?h:{...le}}function Sfe({uniqueDrawParticipants:t,autoEntryPositions:e,stageParticipants:i,tournamentRecord:n,drawProfiles:r,category:o,gender:a,event:s}){let l=0;for(const c of r){const{qualifyingPositions:u=0,uniqueParticipants:d,stage:p=ct,drawSize:h=0}=c,f=h-u,m=d||a||o||p===St,g=m?t.slice(l,l+f):i[p||ct]||[];m&&(l+=f);const v=ZLe({autoEntryPositions:e,drawParticipants:g,tournamentRecord:n,drawProfile:c,event:s});if(v.error)return v}return{...le}}function Tfe(t){var e;const{allUniqueParticipantIds:i,matchUpStatusProfile:n,participantsProfile:r,completeAllMatchUps:o,autoEntryPositions:a,hydrateCollections:s,randomWinningSide:l,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,publish:h,isMock:f,uuids:m}=t;let g=d.gender,v=d.eventName;const{eventType:y=Np,policyDefinitions:b,drawProfiles:I=[],eventExtensions:T,surfaceCategory:S,tieFormatName:w,processCodes:U,discipline:D,eventLevel:E,timeItems:C,ballType:M,category:N}=d,R=d.eventId||Hi(),A=d.tieFormat||(y===Yr?oy({namedFormat:w,event:{eventId:R,category:N,gender:g},hydrateCollections:s,isMock:f}):void 0),_=u.participants;for(const X of I)!g&&X.gender&&(g=X==null?void 0:X.gender);const{stageParticipantsCount:k,uniqueParticipantsCount:O,uniqueParticipantStages:F}=ffe({drawProfiles:I,category:N,gender:g}),B=y===Np&&ui||y===Bc&&qt||y,{uniqueDrawParticipants:$=[],uniqueParticipantIds:V=[]}=F?wfe({event:{eventType:y,category:N,gender:g},uniqueParticipantsCount:O,participantsProfile:r,ratingsParameters:c,tournamentRecord:u,eventProfile:d,eventIndex:p,uuids:m}):{};let{eventAttributes:H}=d;typeof H!="object"&&(H={});const z=(N==null?void 0:N.categoryName)||(N==null?void 0:N.ageCategoryCode)||(N==null?void 0:N.ratingType);v=v||z||"Generated Event";const G={...H,surfaceCategory:S,processCodes:U,discipline:D,eventLevel:E,eventName:v,eventType:y,tieFormat:A,ballType:M,category:N,eventId:R,gender:g};if(T!=null&&T.length&&Array.isArray(T)){const X=T.filter(Eu);X!=null&&X.length&&Object.assign(G,{extensions:X})}if(Array.isArray(C)&&C.forEach(X=>db({event:Z,timeItem:X})),typeof b=="object")for(const X of Object.keys(b))vm({policyDefinitions:{[X]:b[X]},event:G});let W;G.category&&(G.category.categoryName=z);const K=MC({suppressNotifications:!1,internalUse:!0,tournamentRecord:u,event:G});if(K.error)return K;const Z=K==null?void 0:K.event,{stageParticipants:Y}=mfe({allUniqueParticipantIds:i,stageParticipantsCount:k,eventParticipantType:B,targetParticipants:_});if(I!=null&&I.length){const X=Sfe({uniqueDrawParticipants:$,autoEntryPositions:a,stageParticipants:Y,tournamentRecord:u,drawProfiles:I,category:N,gender:g,event:Z});if(X.error)return X;const Q=Ife({matchUpStatusProfile:n,completeAllMatchUps:o,randomWinningSide:l,tournamentRecord:u,drawProfiles:I,event:Z});if(Q.error)return Q;W=Q.drawIds}else if((e=d==null?void 0:d.participantsProfile)!=null&&e.participantsCount){const X=$.map(li);if(X.length){const Q=dd({participantIds:X,autoEntryPositions:a,tournamentRecord:u,entryStage:ct,event:Z});if(Q.error)return Q}}return h&&Y0({tournamentRecord:u,event:Z}),{drawIds:W,eventId:R,uniqueParticipantIds:V}}function _q({tournamentRecords:t,scheduleDate:e,venueId:i,round:n}){if(!Ss(e))return{error:Ha};const{extension:r}=ei({name:Xv,tournamentRecords:t,discover:!0}),o=(r==null?void 0:r.value)||[];let a=o.find(d=>Pd(e,d.scheduleDate));if(!a){const{startDate:d,endDate:p}=Kk({tournamentRecords:t}),h=new Date(e);if(d&&h<new Date(d)||p&&h>new Date(p))return{error:Ha};a={scheduleDate:e,venues:[]},o.push(a)}let s=a.venues.find(d=>d.venueId===i);s||(s={venueId:i,rounds:[]},a.venues.push(s));const l=["notBeforeTime"],c=d=>Object.keys(d).filter(p=>!l.includes(p)).sort().map(p=>bn(d[p])?c(d[p]):d[p]).flat().join("|");if(s.rounds.find(d=>c(d)===c(n)))return ce({result:{error:o_e},stack:"addSchedulingProfileRound"});s.rounds.push(n);const u=W0({tournamentRecords:t,schedulingProfile:o});return u.error?u:{...le}}function Tx(t){var e,i;const n=Ln(t,[{drawProfile:!0,_ofType:zd}]);if(n.error)return n;const{allUniqueParticipantIds:r=[],participantsProfile:o={},matchUpStatusProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,ratingsParameters:d,tournamentRecord:p,isMock:h=!0,drawProfile:f,startDate:m,drawIndex:g,uuids:v}=t,y=ft(f,!1,!0),{excessParticipantAlternates:b=!0,matchUpFormat:I=Xs,drawType:T=hu,tournamentAlternates:S=0,alternatesCount:w=0,qualifyingPositions:U,qualifyingProfiles:D,generate:E=!0,eventExtensions:C,drawExtensions:M,completionGoal:N,tieFormatName:R,seedsCount:A,timeItems:_,drawName:k,category:O,idPrefix:F,publish:B,gender:$,stage:V}=y,H=y.drawSize||(y.ignoreDefaults?void 0:32),z=y.eventId||Hi(),G=f.eventType||f.matchUpType||Np,W=G===Bc?qt:ui,K=typeof f.tieFormat=="object"&&f.tieFormat||G===on&&oy({event:{eventId:z,category:O,gender:$},namedFormat:R,hydrateCollections:c,isMock:h})||void 0,Z=(O==null?void 0:O.categoryName)||(O==null?void 0:O.ageCategoryCode)||(O==null?void 0:O.ratingType),Y=f.eventName||Z||`Generated ${G}`;let X=(p==null?void 0:p.participants)||[];const Q=((D==null?void 0:D.map(Ae=>Ae.structureProfiles||[]).flat().reduce((Ae,ve)=>Ae+(!ve.participantsCount||ve.participantsCount>ve.drawSize?ve.drawSize:ve.participantsCount||0),0))||0)*(W===qt?2:1),te=(!f.participantsCount||f.participantsCount>H?H:f.participantsCount)||0,J={eventName:Y,eventType:G,tieFormat:K,category:O,eventId:z,gender:$};Array.isArray(_)&&_.forEach(Ae=>db({event:J,timeItem:Ae}));let{eventAttributes:ie}=f;if(typeof ie!="object"&&(ie={}),Object.assign(J,ie),(C==null?void 0:C.length)&&Array.isArray(C)){const Ae=C.filter(Eu);Ae!=null&&Ae.length&&Object.assign(J,{extensions:Ae})}const oe=[];if(Q||f.uniqueParticipants||!p||$||O){const Ae=(te||0)+w+Q;let ve=Ae;const ke={[rn]:0,[Dn]:0};let ye,Ie;G===on&&({teamSize:ye,genders:Ie}=cfe({alternatesCount:w,tieFormatName:R,tieFormat:K,drawSize:H}),Object.keys(Ie).forEach(Le=>{[rn,Dn].includes(Le)&&Ie[Le]&&(ke[Le]=H*Ie[Le])}),ve=ye*((H||0)+Q));const Ne=o!=null&&o.idPrefix?`D-${g}-${o==null?void 0:o.idPrefix}`:void 0,Fe=_C({...o,scaledParticipantsCount:f.scaledParticipantsCount||o.scaledParticipantsCount,participantsCount:ve,consideredDate:p==null?void 0:p.startDate,sex:$||(o==null?void 0:o.sex),rankingRange:f.rankingRange,uuids:f.uuids||v,ratingsParameters:d,participantType:W,gendersCount:ke,idPrefix:Ne,category:O}).participants;if(J.category&&(J.category.categoryName=Z),p){const Le=jc({participants:Fe,tournamentRecord:p});if(Le.error)return Le}if(Fe.forEach(({participantId:Le})=>oe.push(Le)),X=Fe,G===on){const Le=Ie[rn]?Fe.filter(({participantType:Ue,person:Ce})=>Ue===ui&&(Ce==null?void 0:Ce.sex)===rn).map(li):[],ge=Ie[Dn]?Fe.filter(({participantType:Ue,person:Ce})=>Ue===ui&&(Ce==null?void 0:Ce.sex)===Dn).map(li):[],Ee=Fe.filter(({participantType:Ue})=>Ue===ui).map(li).filter(Ue=>!Le.includes(Ue)&&!ge.includes(Ue)),we=ye-(Ie[rn]+Ie[Dn]);let fe=0,Te=0,ue=0;const de=nt(0,Ae).map(Ue=>{const Ce=ge.slice(fe,fe+Ie[Dn]),We=Le.slice(Te,Te+Ie[rn]),He=Ee.slice(ue,ue+we);return fe+=Ie[Dn],Te+=Ie[rn],ue+=we,{individualParticipantIds:[...Ce,...We,...He],participantOtherName:`TM${Ue+1}`,participantName:`Team ${Ue+1}`,participantRole:Ro,participantType:on,participantId:Hi()}}),_e=jc({participants:de,tournamentRecord:p});if(!_e.success)return _e;X=de}}const ne=Ae=>{const{participantType:ve}=Ae;return G===Np&&ve===ui||G===Bc&&ve===qt||G===on&&ve===on},re=Ae=>{var ve,ke;return!f.gender||((ve=Ae.person)==null?void 0:ve.sex)===f.gender||((ke=Ae.individualParticipantIds)==null?void 0:ke.some(ye=>{const Ie=X.find(Ne=>Ne.participantId===ye);return Ie&&re(Ie)}))},me=X.filter(ne).filter(re).filter(({participantId:Ae})=>!r.includes(Ae)),he=me.slice(0,te).map(Ae=>Ae.participantId);if(h&&he!=null&&he.length){const Ae=dd({autoEntryPositions:l,entryStage:V,tournamentRecord:p,participantIds:he,event:J});if(Ae.error)return Ae}const be=Q?me.slice(te,te+Q).map(Ae=>Ae.participantId):0;if(h&&be!=null&&be.length){let Ae=0,ve=1;const ke=(Ie,Ne)=>Ie.stageSequence-Ne.stageSequence,ye=(Ie,Ne)=>Ie.roundTarget-Ne.roundTarget;for(const Ie of D.sort(ye)){ve=Ie.roundTarget||ve;let Ne,Fe=1;for(const Le of Ie.structureProfiles.sort(ke)){const ge=(Le.drawSize||Hz(Le.participantsCount))-(Ne||0),Ee=be.slice(Ae,Ae+ge),we=dd({entryStage:St,entryStageSequence:Fe,autoEntryPositions:l,tournamentRecord:p,participantIds:Ee,roundTarget:ve,event:J});if(we.error)return we;Ne=Le.qualifyingPositions,Ae+=ge,Fe+=1}ve+=1}}const Se=b&&((e=p==null?void 0:p.participants)==null?void 0:e.filter(({participantId:Ae})=>!he.includes(Ae)).filter(ne).filter(re).slice(0,w||H-te||S).map(Ae=>Ae.participantId));if(h&&Se!=null&&Se.length){const Ae=dd({participantIds:Se,autoEntryPositions:!1,entryStatus:Nc,tournamentRecord:p,event:J});if(Ae.error)return Ae.error}const De=Z||Y;p&&A&&A<=he.length&&nt(1,A+1).forEach((Ae,ve)=>{const ke={scaleName:De,scaleDate:m,scaleType:Aue,scaleValue:Ae,eventType:G},ye=he[ve];Tw({tournamentRecord:p,participantId:ye,scaleItem:ke})});const Oe=nx({...ft(f,!1,!0),tournamentRecord:p,seedingScaleName:De,matchUpFormat:I,eventId:z,isMock:h,event:J});if(Oe.error)return Oe;if(!Oe.drawDefinition)return{error:ml};const{drawDefinition:xe}=Oe,$e=xe.drawId;if(Array.isArray(M)&&M.filter(Eu).forEach(Ae=>Ii({element:xe,extension:Ae})),E){if(ax({drawDefinition:xe,event:J,suppressNotifications:!0}),f.withPlayoffs){const ve=(i=xe.structures)==null?void 0:i[0].structureId,ke=jk({...f.withPlayoffs,tournamentRecord:p,drawDefinition:xe,structureId:ve,idPrefix:F,isMock:h,event:J});if(ke!=null&&ke.error)return ke}const Ae=f.automated===!1;if(h&&!Ae){const ve=ke=>{var ye;const Ie=KR({completeAllMatchUps:ke.completeAllMatchUps,completionGoal:ke.completionGoal,matchUpStatusProfile:a,randomWinningSide:u,tournamentRecord:p,drawDefinition:xe,matchUpFormat:I,event:J});if(Ie.error)return Ie;const Ne=Ie.completedCount;if(T===Rd){const Fe=(ye=xe.structures)==null?void 0:ye.find(ge=>ge.stage===ct);if(!Fe)return{error:Cn};dC({structureId:Fe.structureId,tournamentRecord:p,drawDefinition:xe,event:J});const Le=KR({completionGoal:N&&N?N-(Ne??0):void 0,matchUpStatusProfile:a,completeAllMatchUps:s,randomWinningSide:u,tournamentRecord:p,drawDefinition:xe,matchUpFormat:I,event:J});if(Le.error)return Le}};if(N&&ve({completionGoal:N}),f.outcomes){const{matchUps:ke}=Fa({inContext:!0,drawDefinition:xe,event:J});for(const ye of f.outcomes){const{matchUpStatus:Ie=fr,matchUpStatusCodes:Ne,stageSequence:Fe=1,matchUpIndex:Le=0,structureOrder:ge,matchUpFormat:Ee,drawPositions:we,roundPosition:fe,stage:Te=ct,roundNumber:ue,winningSide:de,scoreString:_e}=ye,Ue=(ke==null?void 0:ke.reduce((et,ot)=>{const{structureId:mt,matchUpId:Rt}=ot;return et[mt]?et[mt].push(Rt):et[mt]=[Rt],et},{}))??[],Ce=Object.assign({},...Object.keys(Ue).map((et,ot)=>({[et]:ot+1}))),We=ke==null?void 0:ke.filter(et=>!(Te&&et.stage!==Te||Fe&&et.stageSequence!==Fe||ue&&et.roundNumber!==ue||fe&&et.roundPosition!==fe||ge&&Ce[et.structureId]!==ge||we&&sr(we,et.drawPositions).length!==2)),He=We==null?void 0:We[Le],Be=bfe({matchUpStatusCodes:Ne,tournamentRecord:p,drawDefinition:xe,targetMatchUp:He,matchUpFormat:Ee,matchUpStatus:Ie,scoreString:_e,winningSide:de});if(Be!=null&&Be.error)return Be}}s&&ve({completeAllMatchUps:s})}B&&Y0({tournamentRecord:p,event:J})}else{const Ae=lx({drawEntries:xe.entries,drawName:k||T,qualifyingPositions:U,drawId:$e,event:J,stage:V});if(Ae.error)return Ae}return{...le,event:It(J),uniqueParticipantIds:oe,targetParticipants:X,drawDefinition:xe,eventId:z,drawId:$e}}const XLe=["Mock Tournament","CourtHive Challenge","Racket Rally","Generated Tournament","Factory Follies","Open Competition"];function Ufe(t){let{tournamentAttributes:e,startDate:i,endDate:n}=t??{};const{tournamentName:r=es(XLe),ratingsParameters:o=Gs,scheduleCompletedMatchUps:a,tournamentExtensions:s,matchUpStatusProfile:l,completeAllMatchUps:c,participantsProfile:u,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,policyDefinitions:f,schedulingProfile:m,periodLength:g,autoSchedule:v,eventProfiles:y,venueProfiles:b,drawProfiles:I,uuids:T}=t??{};if(i&&!Ss(i)||n&&!Ss(n))return{error:Ha};if(y&&!Array.isArray(y))return{error:Re};if(!i){const R=new Date;i=Mc(n??R),n=Mc(R.setDate(R.getDate()+7))}if(!n){const R=new Date(i);n=Mc(R.setDate(R.getDate()+7))}typeof e!="object"&&(e={});const S=nfe({...e,tournamentName:r,isMock:!0,startDate:i,endDate:n});if(s!=null&&s.length&&Array.isArray(s)){const R=s.filter(A=>Eu({extension:A}));R!=null&&R.length&&Object.assign(S,{extensions:R,isMock:!0})}if(typeof f=="object")for(const R of Object.keys(f))vm({policyDefinitions:{[R]:f[R]},tournamentRecord:S});const w=ufe({participantsProfile:u,tournamentRecord:S,eventProfiles:y,drawProfiles:I,startDate:i,uuids:T});if(!w.success)return w;const U=[],D=[],E=[];if(Array.isArray(I)){let R=0;for(const A of I){let _=Tx({allUniqueParticipantIds:U,matchUpStatusProfile:l,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,participantsProfile:u,randomWinningSide:h,ratingsParameters:o,tournamentRecord:S,isMock:!0,drawProfile:A,startDate:i,drawIndex:R,uuids:T});if(_.error)return _;const{drawId:k,eventId:O,event:F,uniqueParticipantIds:B}=_;if(_=MC({suppressNotifications:!1,internalUse:!0,tournamentRecord:S,event:F}),_.error)return _;k&&E.push(k),D.push(O),B!=null&&B.length&&U.push(...B),R+=1}}if(y){let R=0;for(const A of y){const _=Tfe({allUniqueParticipantIds:U,matchUpStatusProfile:l,participantsProfile:u,completeAllMatchUps:c,autoEntryPositions:d,hydrateCollections:p,randomWinningSide:h,ratingsParameters:o,tournamentRecord:S,eventProfile:A,eventIndex:R,startDate:i,uuids:T});if(_.error)return _;const{eventId:k,drawIds:O,uniqueParticipantIds:F}=_;O&&E.push(...O),D.push(k),F!=null&&F.length&&U.push(...F),R+=1}}const C=b!=null&&b.length?hfe({tournamentRecord:S,venueProfiles:b,uuids:T}):[];let M,N={};if(m){const R=function({schedulingProfile:A,tournamentRecord:_}){if(typeof A!="object")return{error:Re};const k=V0({tournamentRecord:_}).containedStructures,O=Vr({tournamentRecord:_}).matchUps??[],{tournamentId:F}=_,B=[];for(const $ of A){const{scheduleDate:V,venues:H=[]}=$;for(const z of H){const{rounds:G,venueId:W}=z;for(const K of G){const{drawId:Z,winnerFinishingPositionRange:Y,roundSegment:X}=K,Q=O.filter(te=>{var J;const ie=(Y==null?void 0:Y.indexOf("-"))>0&&Y.split("-").map(ne=>+ne),oe=(J=te.finishingPositionRange)==null?void 0:J.winner;return!(te.drawId!==Z||K.roundNumber&&te.roundNumber!==K.roundNumber||oe&&ie&&sr(oe,ie).length!==2&&(ti(oe).length!==ti(ie).length||sr(oe,ie).length!==ti(oe).length))})[0];if(Q){const{eventId:te,roundNumber:J,drawName:ie,structureName:oe,roundName:ne}=Q;let re=Q.structureId;J&&!Y&&(re=Object.keys(k).find(be=>k[be].includes(re))??re);const me={tournamentId:F,structureId:re,roundNumber:J,roundSegment:X,eventId:te,drawId:Z},he=_q({tournamentRecords:{[F]:_},round:me,scheduleDate:V,venueId:W});if(he.error)return he;B.push({structureName:oe,roundName:ne,drawName:ie,...me})}}}}return{scheduledRounds:B}}({schedulingProfile:m,tournamentRecord:S});if(R.error)return R;if(M=R.scheduledRounds,v){const{tournamentId:A}=S;N=wx({scheduleCompletedMatchUps:a,tournamentRecords:{[A]:S},periodLength:g})}}return Dce(),It({...le,tournamentRecord:S,scheduledRounds:M,schedulerResult:N,eventIds:D,venueIds:C,drawIds:E})}var JLe=Object.freeze({__proto__:null,generateEventWithDraw:Tx,generateOutcome:Aq,generateOutcomeFromScoreString:Mq,generateParticipants:_C,generateTournamentRecord:Ufe});function Dfe({keepExtensions:t=[],anonymizeParticipantNames:e=!0,tournamentRecord:i,tournamentName:n,personIds:r=[],tournamentId:o}){var a,s,l,c,u;if(!i)return{error:je};const d=Array.isArray(t)?_7.concat(...t):_7,p=$=>{var V;return Array.isArray(t)?(V=$==null?void 0:$.extensions)==null?void 0:V.filter(H=>d.includes(H.name)):$==null?void 0:$.extensions},h={};i.extensions=p(i);const f=o||Hi();h[i.tournamentId]=f,i.tournamentId=f,i.createdAt=new Date().toISOString(),i.tournamentName=n||`Anonymized: ${Mc(new Date)}`,i.isMock=!0,delete i.parentOrganisation;for(const $ of i.participants||[]){const V=Hi();h[$.participantId]=V,$.participantId=V}for(const $ of i.participants||[])Array.isArray($.individualParticipantIds)&&($.individualParticipantIds=$.individualParticipantIds.map(V=>h[V]));let m=0;for(const $ of i.venues||[]){$.extensions=p($),$.venueName=`Venue #${m}`,$.venueAbbreviation=`V${m}`;const V=Hi();h[$.venueId]=V,$.isMock=!0,m+=1}let g=1;for(const $ of i.events||[]){$.extensions=p($),$.isMock=!0;const V=Hi();h[$.eventId]=V,$.eventId=V;const H=((a=$.category)==null?void 0:a.categoryName)||((s=$.category)==null?void 0:s.ageCategoryCode)||((l=$.category)==null?void 0:l.ratingType)||$.gender;if($.eventName=`Event ${g} ${H}`,Array.isArray($.entries))for(const G of $.entries)G.participantId=h[G.participantId];for(const G of $.drawDefinitions||[]){G.extensions=p(G);const W=Hi();if(h[G.drawId]=W,G.drawId=W,G.isMock=!0,Array.isArray(G.entries))for(const Z of G.entries)Z.participantId=h[Z.participantId];const K=Z=>{Z.extensions=p(Z);const Y=Hi();h[Z.structureId]=Y,Z.structureId=Y;for(const X of Z.positionAssignments||[])X.participantId&&(X.participantId=h[X.participantId]);for(const X of Z.seedAssignments||[])X.participantId&&(X.participantId=h[X.participantId]);for(const X of Z.matchUps||[]){X.isMock=!0;for(const Q of X.sides||[])Q.lineUp&&(Q.lineUp=Q.lineUp.map(({participantId:te,collectionAssignments:J})=>({participantId:h[te],collectionAssignments:J})))}};for(const Z of G.structures||[])if(K(Z),Array.isArray(Z.structures))for(const Y of Z.structures)K(Y);for(const Z of G.links||[])Z.source.structureId=h[Z.source.structureId],Z.target.structureId=h[Z.target.structureId]}const{extension:z}=ei({name:ql,element:$});Array.isArray((c=z==null?void 0:z.value)==null?void 0:c.flights)&&((u=z==null?void 0:z.value.flights)==null||u.forEach(G=>{if(G.drawId=h[G.drawId],Array.isArray(G.drawEntries))for(const W of G.drawEntries)W.participantId=h[W.participantId]})),g+=1}const v=i.startDate||Mc(new Date),y=(i.participants||[]).filter(({participantType:$})=>$===ui),b=y.reduce(($,V)=>{var H;const z=(H=V.person)==null?void 0:H.sex;return[rn,Dn].includes(z)?$[z]+=1:$[tv]+=1,$},{[rn]:0,[Dn]:0,[tv]:0}),I=Object.assign({},...Object.keys(b).map($=>{var V;return{[$]:((V=lfe({category:{ageCategoryCode:"O18"},count:b[$],addressProps:{citiesCount:10},personExtensions:[],consideredDate:v,sex:$}))==null?void 0:V.persons)||[]}})),T={[rn]:0,[Dn]:0,[tv]:0},S=y.length,w=y.reduce(($,V)=>{var H,z;const G=((z=(H=V.person)==null?void 0:H.addresses)==null?void 0:z[0])||{},{city:W,state:K,postalCode:Z}=G;return $.cities.includes(W)||$.cities.push(W),$.states.includes(K)||$.states.push(K),$.postalCodes.includes(Z)||$.postalCodes.push(Z),$},{cities:[],postalCodes:[],states:[]}),U=w.postalCodes.length,D=w.cities.length,E=w.states.length,{cities:C}=rfe({count:D||S,participantsCount:S}),{states:M}=ofe({count:E||S,participantsCount:S}),{postalCodes:N}=afe({count:U||S,participantsCount:S}),R={cities:C,states:M,postalCodes:N};y.forEach(($,V)=>{var H,z;const G=$==null?void 0:$.person,W=(G==null?void 0:G.sex)||tv,K=(H=zt(G==null?void 0:G.birthDate))==null?void 0:H.split("-")[0],Z=T[W],Y=I[W][Z];if(T[W]+=1,K){const[,X,Q]=((z=Y==null?void 0:Y.birthDate)==null?void 0:z.split("-"))||[],te=[K,X,Q].join("-");Y.birthDate=te}if(G!=null&&G.addresses){const X=sfe({...R,participantIndex:V,nationalityCode:Y.nationalityCode});Y.addresses=[X]}Y.personId=(r==null?void 0:r[V])||Hi(),e?(Y.standardFamilyName=Y.lastName,Y.standardGivenName=Y.firstName,$.participantName=`${Y.standardGivenName} ${Y.standardFamilyName}`):(Y.standardFamilyName=G==null?void 0:G.standardFamilyName,Y.standardGivenName=G==null?void 0:G.standardGivenName),delete Y.firstName,delete Y.lastName,Y.extensions=p(G),$.person=Y,h[G==null?void 0:G.personId]=Y.personId}),(i.participants||[]).filter(({participantType:$})=>$===qt).forEach($=>{const{individualParticipantIds:V}=$;$.participantName=function({individualParticipantIds:H,individualParticipants:z}){let G=z.filter(({participantId:W})=>H.includes(W)).map(({person:W})=>W==null?void 0:W.standardFamilyName).filter(Boolean).sort().join("/");return H.length===1&&(G+="/Unknown"),G}({individualParticipantIds:V,individualParticipants:y})});const A=(i.participants||[]).filter(({participantType:$})=>$===on),_=yB({count:A.length}).names;A.forEach(($,V)=>{$.participantName=_[V]});const k=(i.participants||[]).filter(({participantType:$})=>$===gl),O=yB({count:k.length,nameRoot:"Group"}).names;k.forEach(($,V)=>{$.participantName=O[V]});const{extension:F}=ei({element:i,name:Xv});Array.isArray(F==null?void 0:F.value)&&(F==null||F.value.forEach($=>{$.tournamentId=h[$.tournamentId],$.structureId=h[$.structureId],$.eventId=h[$.eventId],$.drawId=h[$.drawId]}));const{extension:B}=ei({element:i,name:L0});return Array.isArray(B==null?void 0:B.value)&&(B==null||B.value.forEach($=>{$.personId=h[$.personId]})),{...le}}function Pfe(t){var e,i,n;const{ratingsParameters:r=Gs,participantsProfile:o={},matchUpStatusProfile:a,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,schedulingProfile:d,tournamentRecord:p,eventProfiles:h,periodLength:f,venueProfiles:m,autoSchedule:g,drawProfiles:v,uuids:y}=t;if(!p)return{error:je};const b=[],I=[],T=[];h==null||h.forEach(E=>{var C;const M=(C=p.events)==null?void 0:C.find((N,R)=>E.eventIndex!==void 0&&R===E.eventIndex||E.eventName&&N.eventName===E.eventName||E.eventId&&N.eventId===E.eventId);M!=null&&M.gender&&(E.gender=M.gender)});const S=((e=p.participants)==null?void 0:e.length)||void 0;S&&o!=null&&o.idPrefix&&(o.idPrefix=`${o.idPrefix}-${S}`);const w=ufe({startDate:p.startDate,participantsProfile:o,tournamentRecord:p,eventProfiles:h,drawProfiles:v,uuids:y});if(!w.success)return w;if(h){let E=((i=p.events)==null?void 0:i.length)||0;for(const C of h){const{ratingsParameters:M}=C,N=(n=p.events)==null?void 0:n.find((R,A)=>C.eventIndex!==void 0&&A===C.eventIndex||C.eventName&&R.eventName===C.eventName||C.eventId&&R.eventId===C.eventId);if(N){const{gender:R,category:A,eventType:_}=N,{drawProfiles:k,publish:O}=C,F=_===Np&&ui||_===Bc&&qt||_;if(k){const{stageParticipantsCount:B,uniqueParticipantsCount:$,uniqueParticipantStages:V}=ffe({drawProfiles:k,category:A,gender:R}),{uniqueDrawParticipants:H=[],uniqueParticipantIds:z=[]}=V?wfe({event:{eventType:_,category:A,gender:R},uniqueParticipantsCount:$,participantsProfile:o,ratingsParameters:M,tournamentRecord:p,eventProfile:C,uuids:y}):{};b.push(...z);const{stageParticipants:G}=mfe({targetParticipants:p.participants||[],allUniqueParticipantIds:b,stageParticipantsCount:B,eventParticipantType:F});let W=Sfe({uniqueDrawParticipants:H,autoEntryPositions:l,stageParticipants:G,tournamentRecord:p,drawProfiles:k,category:A,gender:R,event:N});if(W.error||(W=Ife({matchUpStatusProfile:a,completeAllMatchUps:s,randomWinningSide:u,tournamentRecord:p,drawProfiles:k,event:N}),W.error))return W;T.push(...W.drawIds)}O&&Y0({tournamentRecord:p,event:N})}else{const R=Tfe({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:l,randomWinningSide:u,ratingsParameters:M,tournamentRecord:p,eventProfile:C,eventIndex:E,uuids:y});if(R.error)return R;const{eventId:A,drawIds:_,uniqueParticipantIds:k}=R;_&&T.push(..._),I.push(A),k!=null&&k.length&&b.push(...k),E+=1}}}if(v){let E=(p.events||[]).map(C=>{var M;return((M=C.drawDefinitions)==null?void 0:M.map(()=>1))||[]}).flat().reduce((C,M)=>C+M,0);for(const C of v){let M=Tx({startDate:p.startDate,allUniqueParticipantIds:b,matchUpStatusProfile:a,participantsProfile:o,completeAllMatchUps:s,autoEntryPositions:l,hydrateCollections:c,randomWinningSide:u,ratingsParameters:r,tournamentRecord:p,drawProfile:C,drawIndex:E,uuids:y});if(M.error)return M;const{drawId:N,eventId:R,event:A,uniqueParticipantIds:_}=M;if(M=MC({tournamentRecord:p,event:A,internalUse:!0}),M.error)return M;N&&T.push(N),I.push(R),_!=null&&_.length&&b.push(..._),E+=1}}const U=m!=null&&m.length?hfe({tournamentRecord:p,venueProfiles:m}):[];let D={};if(d!=null&&d.length){const E=W0({tournamentRecords:{[p.tournamentId]:p},schedulingProfile:d});if(E.error)return E;if(g){const{tournamentId:C}=p;D=wx({tournamentRecords:{[C]:p},periodLength:f})}}return{totalParticipantsCount:p.participants.length,scheduledRounds:void 0,schedulerResult:D,...le,eventIds:I,venueIds:U,drawIds:T}}var QLe=Object.freeze({__proto__:null,anonymizeTournamentRecord:Dfe,modifyTournamentRecord:Pfe}),Cfe=Object.freeze({__proto__:null,anonymizeTournamentRecord:Dfe,generate:JLe,generateEventWithDraw:Tx,generateOutcome:Aq,generateOutcomeFromScoreString:Mq,generateParticipants:_C,generateTournamentRecord:Ufe,modifyTournamentRecord:Pfe,mutate:QLe});function Efe({personRequests:t,personId:e,requests:i}){t[e]||(t[e]=[]);const n=i.filter(({requestType:r})=>r).map(r=>{let{date:o,startTime:a,endTime:s}=r;return r.requestType===yx&&(o=zt(o),a=mn(a),s=mn(s),o&&a&&s)?{date:o,startTime:a,endTime:s,requestType:r.requestType}:r}).filter(Boolean);for(const r of n)r.requestId=Upe(),t[e].push(r);return{mergeCount:n.length}}function kq(t){const{tournamentRecords:e,personRequests:i}=t,n=Ln(t,[{[Oo]:!0}]);if(n.error)return n;if(!i)return{...le};const r=Object.values(e);for(const o of r){const a=o.participants??[],s=[];for(const l of Object.keys(i))if(ef({tournamentParticipants:a,personId:l})){const c=i[l];c.length&&s.push({personId:l,requests:c})}Object.keys(s).length&&Ii({element:o,extension:{value:s,name:L0}})}return{...le}}function Mfe(t){const{tournamentRecords:e,requests:i,personId:n}=t,r=Ln(t,[{[Oo]:!0},{requests:!0,[HP]:El,[Yv]:Re}]);if(r.error)return r;const o=i.map(({requestId:c})=>c).filter(Boolean),{personRequests:a}=Cg({tournamentRecords:e}),s=c=>{a&&(a[c]=a[c].map(u=>{if(!o.includes(u.requestId))return u;const d=i.find(p=>p.requestId===u.requestId);return d.requestType?Object.assign(u,d):void 0}).filter(Boolean))};if(n&&a!=null&&a[n])s(n);else if(a)for(const c of Object.keys(a))s(c);const l=i.filter(c=>!c.requestId);return l.length&&Efe({personRequests:a,personId:n,requests:l}),kq({tournamentRecords:e,personRequests:a})}function Rfe(t){const{tournamentRecords:e,requestType:i,requestId:n,personId:r,date:o}=t,a=Ln(t,[{[Oo]:!0}]);if(a.error)return a;const{personRequests:s}=Cg({tournamentRecords:e}),l=u=>{var d;s&&(s[u]=s[u].filter(p=>!(i&&p.requestType===i||n&&p.requestId===n||o&&p.date===o)),(d=s==null?void 0:s[u])!=null&&d.length||delete s[u])},c=!(i||n||r||o);if(!c){if(r&&s!=null&&s[r])l(r);else if(s)for(const u of Object.keys(s))l(u)}return!c&&s&&Object.keys(s).length?kq({tournamentRecords:e,personRequests:s}):ia({name:L0,tournamentRecords:e,discover:!0})}function Nfe(t){const{tournamentRecords:e,personId:i,requests:n}=t,r=Ln(t,[{[Oo]:!0,personId:!0},{requests:!0,[HP]:El,[Yv]:Re}]);if(r.error)return r;const{personRequests:o}=Cg({tournamentRecords:e}),{mergeCount:a}=Efe({personRequests:o,personId:i,requests:n});return a&&o?kq({tournamentRecords:e,personRequests:o}):{error:Re}}function Afe({individualParticipantIds:t,groupingParticipantId:e,tournamentRecord:i}){const n="modifyIndividualParticipantIds";if(!i)return ce({result:{error:je},stack:n});if(!e||!t)return ce({result:{error:bt},stack:n});const r=i.participants||[],o=r.find(h=>h.participantId===e);if(!o)return ce({result:{error:rr},stack:n});if(![on,gl].includes(o.participantType))return ce({result:{error:Cu},context:{participantType:o.participantType},stack:n});const a=t.filter(h=>{const f=r.find(m=>m.participantId===h);return(f==null?void 0:f.participantType)!==ui});if(a.length)return ce({result:{error:Ec,invalidParticipantIds:a},stack:n});const s=o.individualParticipantIds||[],l=t.filter(h=>!s.includes(h)),c=s.filter(h=>!t.includes(h)),u=px({individualParticipantIds:l,groupingParticipantId:e,tournamentRecord:i});if(u.error)return ce({result:u,stack:n});const d=zW({individualParticipantIds:c,groupingParticipantId:e,tournamentRecord:i});if(d.error)return ce({result:d,stack:n});const{topics:p}=Bu();if(p.includes(Lo)){const h=r.find(({participantId:f})=>f===e);bi({topic:Lo,payload:{tournamentId:i.tournamentId,participants:[h]}})}return{...u,...d}}function _fe({tournamentRecord:t,participantIds:e,signInState:i}){if(!t)return{error:je};if(!Array.isArray(e))return{error:bt};if(![PR,Oke].includes(i))return{error:Re,signInState:i};const n=t.participants||[];if(!n.length)return{error:X_};const r=n.map(li),o=e.filter(c=>!r.includes(c));if(o.length)return{error:Re,context:{invalidParticipantIds:o}};const a=[],s=new Date().toISOString();for(const c of n){const{participantId:u}=c;if(e.includes(u)){const d=i3({duplicateValues:!1,tournamentRecord:t,participantId:u,timeItem:{itemType:vk,itemValue:i,createdAt:s}});if(d.error)return d;a.push(c)}}const{topics:l}=Bu();return a.length&&l.includes(Lo)&&bi({topic:Lo,payload:{tournamentId:t.tournamentId,participants:a}}),{...le}}function kfe({tournamentRecord:t,participantId:e,participantOtherName:i}){if(!t)return{error:je};if(!e)return{error:Hr};const{participant:n}=Dg({tournamentRecord:t,participantId:e});if(!n)return{error:rr};n.participantOtherName=i;const{topics:r}=Bu();return r.includes(Lo)&&bi({topic:Lo,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...le}}function c8({personFormat:t,person:e}){const i=c=>c.replace(/\W/g,""),n=c=>c.toLowerCase().indexOf("l")<c.toLowerCase().indexOf("f"),r=c=>c.indexOf(",")>=0;if(!e)return;const o=t.indexOf(" ")>0?" ":"";let a=Z2((e==null?void 0:e.standardGivenName)??""),s=Z2((e==null?void 0:e.standardFamilyName)??"");if(!t)return`${a}${o}${s}`;!(c=>c.toLowerCase().indexOf("f.")>=0)(t)||r(t)||n(t)||(a=`${a[0]}.`),(c=>/^[a-z]*$/.test(i(c)))(t)?(a=a.toLowerCase(),s=s.toLowerCase()):(c=>/^[A-Z]*$/.test(i(c)))(t)?(a=a.toUpperCase(),s=s.toUpperCase()):(c=>/^[LAST]{4}/.test(i(c)))(t)&&(s=s.toUpperCase());let l=`${a}${o}${s}`;return(c=>c.toLowerCase().indexOf("f")<0)(t)?l=s:n(t)&&(l=r(t)?`${s},${o}${a}`:`${s}${o}${a}`),l}function eFe({participantMap:t,participant:e,formats:i}){const{participantType:n,individualParticipantIds:r,person:o}=e,a=n&&i[n];if(n!==il&&a){const{personFormat:s,doublesJoiner:l}=a;n===ui&&(e.participantName=c8({person:o,personFormat:s})),n===qt&&(e.participantName=r==null?void 0:r.map(c=>{var u;const d=(u=t[c])==null?void 0:u.person;return c8({person:d,personFormat:s})}).filter(Boolean).join(l??"/"))}}function xfe({tournamentRecord:t,formats:e}){if(!t)return{error:je};if(!bn(e))return{error:bt};const i=t.participants??[],n=Rce(i,"participantId");for(const r of i)eFe({participant:r,participantMap:n,formats:e});return{...le}}function Ofe(t){const{tournamentRecord:e,policyDefinitions:i,contextProfile:n,participantId:r,personId:o}=t,a=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="string"&&typeof o!="string")return{error:bt,stack:"publicFindParticipant"};let s,l;for(const c of Object.values(a))if(l=c.tournamentId,s=ef({tournamentParticipants:c.participants||[],internalUse:!0,policyDefinitions:i,contextProfile:n,participantId:r,personId:o}),s)break;return{participant:s,tournamentId:l,...le}}function Lfe({individualParticipantIds:t=[],participantRoleResponsibilities:e,participantRole:i=Kue,tournamentRecord:n,participantId:r,groupName:o}){if(!n)return{error:je};if(!o)return{error:bt,info:"Missing groupName"};if(!Array.isArray(t))return{info:"Invalid individualParticipantIds",error:Re};const a=(Qn({participantFilters:{participantTypes:[ui]},tournamentRecord:n}).participants??[]).map(u=>u.participantId);for(const u of t)if(!a.includes(u))return{error:Cu,participantId:u};const s=It({participantId:r||Hi(),participantRoleResponsibilities:e,participantName:o,individualParticipantIds:t,participantType:gl,participantRole:i}),l=Au({participant:s,tournamentRecord:n});if(l.error)return l;const{topics:c}=Bu();return c.includes(zm)&&bi({topic:zm,payload:{tournamentId:n.tournamentId,participants:[s]}}),{...le,participant:ft(s)}}function Ffe({tournamentRecord:t,participantName:e,participantId:i}){if(!t)return{error:je};if(!i)return{error:Hr};if(!e)return{error:bt,info:"Missing participantName"};const{participant:n}=Dg({tournamentRecord:t,participantId:i});if(!n)return{error:rr};n.participantName=e;const{topics:r}=Bu();return r.includes(Lo)&&bi({topic:Lo,payload:{tournamentId:t.tournamentId,participants:[n]}}),{...le}}function Bfe({clearExistingAssignments:t=!0,individualParticipantIds:e,reverseAssignmentOrder:i,initialTeamIndex:n=0,scaledParticipants:r=[],teamParticipantIds:o,tournamentRecord:a,scaleAttributes:s,teamNameBase:l,teamsCount:c,eventId:u,event:d}){var p,h,f,m;if(!a)return{error:je};if(!Array.isArray(o)&&!$t(c)&&!u||!$t(n)||r&&!Array.isArray(r)||s&&(typeof s!="object"||!Object.keys(s).length))return{error:Re};if(!s&&!r.length||!r&&(!e||!s))return{error:bt,info:"Missing scaling details"};if(u&&!o){if((d==null?void 0:d.eventType)!==$c)return{error:Lm};o=(p=d==null?void 0:d.entries)==null?void 0:p.filter(({entryStatus:T})=>T===cl).map(li)}if(!(o!=null&&o.length)&&!c)return{info:"Missing teamParticipantIds or teamsCount",error:bt};let g=e??r.map(({participantId:T})=>T);i&&(o==null||o.reverse(),n+=1),n>((o==null?void 0:o.length)||0)-1&&(n=0);const v=(o==null?void 0:o.slice(n).concat(...o.slice(0,n)))??[],y=[];for(const T of a.participants??[]){const{participantId:S,participantType:w}=T;if(v.includes(S)){if(w!==il)return{error:Cu,participant:T};y.push(T)}}if(c&&y.length<c){const T=l??"Team",S=nt(0,c-((y==null?void 0:y.length)||0)).map(E=>({participantName:`${T} ${E+1}`,participantType:il,participantRole:Ro})),{participants:w=[]}=jc({participants:S,returnParticipants:!0,tournamentRecord:a}),U=w.map(li),D=((h=a.participants)==null?void 0:h.filter(({participantId:E})=>U.includes(E)))??[];y.push(...D)}if(!y.length)return{error:yce};if(t)for(const T of y)T.individualParticipantIds=[];else{const T=y.map(S=>S).flat();e!=null&&e.length?g=g.filter(S=>!T.includes(S)):r=r==null?void 0:r.filter(({participantId:S})=>!T.includes(S))}if(!(e!=null&&e.length)&&!(r!=null&&r.length))return{error:Jz,info:"Nothing to be done"};if(!r.length){for(const T of a.participants??[]){const{participantId:S,participantType:w}=T;if(!g.includes(S))continue;if(w!==ui)return{error:Cu,participant:T};const U=(f=ud({scaleAttributes:s,participant:T}))==null?void 0:f.scaleItem,D={participantId:S,scaleValue:s!=null&&s.accessor?(m=U==null?void 0:U.scaleValue)==null?void 0:m[s==null?void 0:s.accessor]:U==null?void 0:U.scaleValue};r.push(D)}if(!r.length)return{error:rr}}r.sort((T,S)=>s!=null&&s.sortOrder?((S==null?void 0:S.scaleValue)||0)-((T==null?void 0:T.scaleValue)||0):((T==null?void 0:T.scaleValue)||1/0)-((S==null?void 0:S.scaleValue)||1/0));for(const T of r)if(!T.participantId)return{error:Re,scaledParticipant:T};let b=0;for(;b<r.length;){for(const T of y){if(b+1>r.length)break;const S=r[b];T.individualParticipantIds.push(S.participantId),b++}y.reverse()}const I=y.map(li);for(const T of a.events??[]){if(T.eventType!==$c)continue;const S=(T.entries??[]).filter(w=>I.includes(w.participantId));for(const w of S){const U=w.participantId,D=y.find(M=>M.participantId===U),E=D==null?void 0:D.individualParticipantIds;T.entries=(T.entries??[]).filter(M=>!E.includes(M.participantId)),(T.drawDefinitions??[]).forEach(M=>{M.entries=(M.entries??[]).filter(N=>!E.includes(N.participantId))});const{flightProfile:C}=Zn({event:T});((C==null?void 0:C.flights)||[]).forEach(M=>{M.drawEntries=(M.drawEntries||[]).filter(N=>!E.includes(N.participantId))})}}return{...le,scaledParticipants:r}}function $fe(t){const{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Wn};for(const i of Object.values(e)){const n=tFe({...t,tournamentRecord:i});if(n.error&&n.error!==dU)return n}return{...le}}function tFe({tournamentRecord:t,penaltyId:e}){if(!t)return{error:je};if(!e)return{error:hce};const i=[];let n,r=!1;return((t==null?void 0:t.participants)??[]).forEach(o=>{let a=!1;o.penalties=(o.penalties??[]).filter(s=>(s.penaltyId===e&&(a=!0,r||(n=s,r=!0)),a&&i.push(o),s.penaltyId!==e))}),n&&bi({topic:Lo,payload:{tournamentId:t.tournamentId,participants:i}}),n?{...le,penalty:n}:{error:dU}}const Vfe=({penaltyId:t=Hi()}={})=>({refereeParticipantId:void 0,penaltyCode:void 0,penaltyType:void 0,extensions:void 0,matchUpId:void 0,createdAt:void 0,issuedAt:void 0,notes:void 0,penaltyId:t});function jfe(t){const{tournamentRecords:e}=t;if(typeof e!="object"||!Object.keys(e).length)return{error:Wn};for(const i of Object.values(e)){const n=iFe({...t,tournamentRecord:i});if(n.error&&n.error!==dU||n.success)return n}return{error:dU}}function iFe({tournamentRecord:t,modifications:e,penaltyId:i}){if(!t)return{error:je};if(!e)return{error:Re,modifications:e};if(!i)return{error:hce};const n=(t==null?void 0:t.participants)??[],r=Object.keys(Vfe()).filter(l=>l!=="penaltyId"),o=Object.keys(e).filter(l=>r.includes(l));if(!o.length)return{error:Qz};let a;const s=[];return n.forEach(l=>{let c=!1;l.penalties=(l.penalties??[]).map(u=>(u.penaltyId===i&&(c=!0,o.forEach(d=>Object.assign(u,{[d]:e[d]})),a||(a=u)),u)),c&&s.push(l)}),a&&bi({topic:Lo,payload:{tournamentId:t.tournamentId,participants:s}}),a?{...le,penalty:a}:{error:dU}}function Hfe(t,e,i){return!t&&e?e:t&&!e||typeof t!="object"||typeof e!="object"?t:ti(Object.keys(t).concat(Object.keys(e))).reduce((n,r)=>{if(e[r])if(t[r])if(typeof t[r]!=typeof e[r])n[r]=e[r];else if(Array.isArray(t[r]))if(i===!0||Array.isArray(i)&&i.includes(r)){const o=ti(t[r].map(a=>JSON.stringify(a)).concat(e[r].map(a=>JSON.stringify(a)))).map(a=>JSON.parse(a));n[r]=o}else n[r]=e[r];else typeof t[r]=="object"?n[r]=Hfe(t[r],e[r],i):n[r]=e[r];else n[r]=e[r];else n[r]=t[r];return n},{})}function Gfe({participants:t=[],tournamentRecord:e,arraysToMerge:i}){if(!e)return{error:je};e.participants||(e.participants=[]);const n=t.filter(Ts(Pp)).map(c=>({[c.participantId]:c})),r=Object.assign({},...n),o=[];e.participants=e.participants.map(c=>{if(r[c.participantId]){const u=Hfe(c,r[c.participantId],i);return o.push(u),u}return c});const a=e.participants.map(Ts(Pp))||[],s=t.filter(({participantId:c})=>!a.includes(c)),{topics:l}=Bu();return s.length&&(e.participants=e.participants.concat(...s),l.includes(zm)&&bi({topic:zm,payload:{participants:s}})),o.length&&l.includes(Lo)&&bi({topic:Lo,payload:{tournamentId:e.tournamentId,participants:o}}),{modifiedParticipantsCount:o.length,newParticipantsCount:s.length,...le}}function zfe(t){const{tournamentRecord:e,participantIds:i}=t,n=t.tournamentRecords??(e&&{[e.tournamentId]:e})??{};let r;for(const o of Object.values(n)){const a=Qn({tournamentRecord:o}).participants??[],s=a==null?void 0:a.map(li).filter(l=>i.includes(l));s.length&&(r=nFe({...t,penaltyId:t.penaltyId??r,tournamentRecord:o,participantIds:s}).penaltyId)}return r?{...le,penaltyId:r}:{error:rr}}function nFe({refereeParticipantId:t,tournamentRecord:e,participantIds:i,penaltyCode:n,penaltyType:r,extensions:o,penaltyId:a,matchUpId:s,issuedAt:l,notes:c}){if(!e)return{error:je};if(!i)return{error:Hr};if(!r)return{error:k_e};const u=((e==null?void 0:e.participants)??[]).filter(h=>i.includes(h.participantId));if(!u.length)return{error:rr};const d=new Date().toISOString(),p=Object.assign(Vfe({penaltyId:a}),{refereeParticipantId:t,penaltyCode:n,penaltyType:r,matchUpId:s,notes:c,issuedAt:l,createdAt:d});return Array.isArray(o)&&o.forEach(h=>Ii({element:p,extension:h})),u.forEach(h=>{h.penalties||(h.penalties=[]),h.penalties.push(p)}),bi({topic:Lo,payload:{tournamentId:e.tournamentId,participants:u}}),{...le,penaltyId:p.penaltyId}}function Wfe({participantRole:t=Ro,tournamentRecord:e,persons:i}){var n;if(!e)return{error:je};if(!Array.isArray(i))return{error:Re};if(!Object.keys(Zue).includes(t))return{error:S_e};const r=(e.participants||[]).map(({person:h})=>h==null?void 0:h.personId).filter(Boolean),o=[],a=i.filter(h=>h&&(!h.personId||!r.includes(h.personId))).map(h=>(h.personId||(h.personId=Hi()),o.push(h.personId),h));let s=0,l=0,c=jc({participants:a.map(h=>{return It({extensions:h.participantExtensions,timeItems:h.participantTimeItems,participantType:ui,participantRole:t,person:(f=h,m=["participantExtensions","participantTimeItems","pairedPersons"],Object.assign({},...Object.keys(f).filter(g=>!m.includes(g)).map(g=>({[g]:f[g]}))))});var f,m}),tournamentRecord:e});if(c.error)return c;l=c.addedCount||0;const u=[],d=((n=Qn({participantFilters:{participantTypes:[ui]},tournamentRecord:e}))==null?void 0:n.participants)??[];if(t===Ro&&i.filter(({pairedPersons:h})=>h).forEach(({personId:h,pairedPersons:f})=>{Array.isArray(f)&&f.forEach(m=>{const g=[h,m.personId].map(v=>ef({tournamentParticipants:d,personId:v})).filter(Boolean);if(g.length===2){const v=g.map(li);u.push(It({extensions:m.participantExtensions,timeItems:m.timeItems,participantRole:Ro,individualParticipantIds:v,participantType:qt}))}})}),u.length){if(c=jc({participants:u,tournamentRecord:e}),c.error)return c;s=c.addedCount||0}const p=l+s;return{...le,addedCount:p,newPersonIds:o}}var rFe=Object.freeze({__proto__:null,addIndividualParticipantIds:px,addParticipant:Au,addParticipants:jc,addPenalty:zfe,addPersonRequests:Nfe,addPersons:Wfe,createGroupParticipant:Lfe,createTeamsFromParticipantAttributes:Rq,deleteParticipants:sb,findParticipant:Ofe,mergeParticipants:Gfe,modifyIndividualParticipantIds:Afe,modifyParticipant:hx,modifyParticipantName:Ffe,modifyParticipantOtherName:kfe,modifyParticipantsSignInStatus:_fe,modifyPenalty:jfe,modifyPersonRequests:Mfe,regenerateParticipantNames:xfe,removeIndividualParticipantIds:zW,removeParticipantIdsFromAllTeams:Ak,removePenalty:$fe,removePersonRequests:Rfe,scaledTeamAssignment:Bfe,setParticipantScaleItem:Tw,setParticipantScaleItems:gfe}),oFe=Object.freeze({__proto__:null,addIndividualParticipantIds:px,addParticipant:Au,addParticipants:jc,addPenalty:zfe,addPersonRequests:Nfe,addPersons:Wfe,createGroupParticipant:Lfe,createTeamsFromParticipantAttributes:Rq,deleteParticipants:sb,filterParticipants:sC,findParticipant:Ofe,getCompetitionParticipants:P3,getPairedParticipant:Kl,getParticipantEventDetails:C3,getParticipantMembership:E3,getParticipantScaleItem:yw,getParticipantSchedules:M3,getParticipantSignInStatus:R3,getParticipantTimeItem:$W,getParticipants:Qn,getScaleValues:O0,mergeParticipants:Gfe,modifyIndividualParticipantIds:Afe,modifyParticipant:hx,modifyParticipantName:Ffe,modifyParticipantOtherName:kfe,modifyParticipantsSignInStatus:_fe,modifyPenalty:jfe,modifyPersonRequests:Mfe,mutate:rFe,participantScaleItem:ud,query:pOe,regenerateParticipantNames:xfe,removeIndividualParticipantIds:zW,removeParticipantIdsFromAllTeams:Ak,removePenalty:$fe,removePersonRequests:Rfe,scaledTeamAssignment:Bfe,setParticipantScaleItem:Tw,setParticipantScaleItems:gfe,validateLineUp:kk});function qfe({removePriorValues:t=!0,stageSeedingScaleNames:e,seedingScaleNames:i,tournamentRecord:n,status:r=ju,drawIds:o=[],event:a}){var s,l,c,u;if(!n)return{error:je};if(!a)return{error:Fi};const d=Xc({event:a,status:r}),p=(((s=d==null?void 0:d.seeding)==null?void 0:s.seedingScaleNames)||i)&&{...(l=d==null?void 0:d.seeding)==null?void 0:l.seedingScaleNames,...i};return q0({statusObject:{seeding:It({stageSeedingScaleNames:(((c=d==null?void 0:d.seeding)==null?void 0:c.stageSeedingScaleNames)||e)&&{...(u=d==null?void 0:d.seeding)==null?void 0:u.stageSeedingScaleNames,...e},seedingScaleNames:p,published:!0,drawIds:o})},removePriorValues:t,status:r,event:a}),bi({topic:kke,payload:{tournamentId:n.tournamentId,eventId:a.eventId,drawIds:o}}),{...le}}function Yfe({removePriorValues:t=!0,seedingScaleNames:e,tournamentRecord:i,status:n=ju,drawIds:r,stages:o,event:a}){var s,l;if(!i)return{error:je};if(!a)return{error:Fi};const c=Xc({event:a});if(c){const u=c.seeding;if(Array.isArray(o)&&u.stageSeedingScaleNames)for(const d of o)u.stageSeedingScaleNames[d]&&delete u.stageSeedingScaleNames[d];Array.isArray(e)&&u!=null&&u.seedingScaleNames&&(u.seedingScaleNames=u.seedingScaleNames.filter(d=>!e.includes(d))),Array.isArray(r)&&u!=null&&u.drawIds&&(u.drawIds=u.drawIds.filter(d=>!r.includes(d))),(Object.values(u.stageSeedingScaleNames??{}).length||(s=u.seedingScaleNames)!=null&&s.length||(l=u.drawIds)!=null&&l.length)&&(o||e||r!=null&&r.length)||(delete u.stageSeedingScaleNames,delete u.seedingScaleNames,delete u.drawIds,u.published=!1),q0({statusObject:{seeding:u},removePriorValues:t,status:n,event:a})}return bi({topic:yue,payload:{tournamentId:i.tournamentId,eventId:a.eventId}}),{...le}}function Kfe(t){const e=(t==null?void 0:t.tournamentRecords)??((t==null?void 0:t.tournamentRecord)&&{[t.tournamentRecord.tournamentId]:t.tournamentRecord})??{};if(!Object.keys(e).length)return{error:Wn};for(const i of Object.values(e)){const n=aFe({tournamentRecord:i,...t});if(n.error)return n}return{...le}}function aFe({removePriorValues:t=!0,tournamentRecord:e,status:i=ju}){if(!e)return{error:je};const n=`${eb}.${tb}`,{timeItem:r}=Hu({element:e,itemType:n}),o=(r==null?void 0:r.itemValue)||{[i]:{}};return o[i]&&delete o[i].orderOfPlay,xf({timeItem:{itemValue:o,itemType:n},element:e,removePriorValues:t}),bi({topic:bue,payload:{tournamentId:e.tournamentId}}),{...le}}function Zfe(t){const e=Vu(t);if(!Object.keys(e).length)return{error:Wn};for(const i of Object.values(e)){const n=sFe({tournamentRecord:i,...t});if(n.error)return n}return{...le}}function sFe({scheduledDates:t=[],removePriorValues:e,tournamentRecord:i,status:n=ju,eventIds:r=[]}){if(!i)return{error:je};const o=`${eb}.${tb}`,{timeItem:a}=Hu({element:i,itemType:o}),s=(a==null?void 0:a.itemValue)||{[n]:{}};return s[n].orderOfPlay={published:!0,scheduledDates:t,eventIds:r},xf({timeItem:{itemValue:s,itemType:o},element:i,removePriorValues:e}),bi({topic:xke,payload:{tournamentId:i.tournamentId,scheduledDates:t,eventIds:r}}),{...le}}function Xfe({removePriorValues:t=!0,tournamentRecord:e,status:i=ju,event:n}){if(!e)return{error:je};if(!n)return{error:Fi};const r=`${eb}.${tb}`,{timeItem:o}=nC({itemType:r,event:n}),a=(o==null?void 0:o.itemValue)||{[i]:{}};return delete a[i].structureIds,delete a[i].drawDetails,delete a[i].drawIds,db({event:n,timeItem:{itemValue:a,itemType:r},removePriorValues:t}),q0({statusObject:{structureIds:void 0,drawIds:void 0,seeding:void 0},removePriorValues:t,status:i,event:n}),bi({topic:vue,payload:{tournamentId:e.tournamentId,eventId:n.eventId}}),{eventId:n.eventId,...le}}var lFe=Object.freeze({__proto__:null,publishEvent:Y0,publishEventSeeding:qfe,publishOrderOfPlay:Zfe,setEventDisplay:sx,unPublishEvent:Xfe,unPublishEventSeeding:Yfe,unPublishOrderOfPlay:Kfe});function Jfe({tournamentRecord:t,policyDefinitions:e}){if(!t)return{error:je};const i=t.events||[],n=(t==null?void 0:t.participants)||[],{tournamentInfo:r}=pb({tournamentRecord:t}),{venues:o}=eh({tournamentRecord:t});return{allEventData:{tournamentInfo:r,venuesData:o,eventsData:i.map(a=>{const{eventId:s}=a,l=(({eventId:p,eventName:h,eventType:f,eventLevel:m,surfaceCategory:g,matchUpFormat:v,category:y,gender:b,startDate:I,endDate:T,ballType:S,discipline:w})=>({eventId:p,eventName:h,eventType:f,eventLevel:m,surfaceCategory:g,matchUpFormat:v,category:y,gender:b,startDate:I,endDate:T,ballType:S,discipline:w}))(a),c=QP({tournamentRecord:t,event:a}).scheduleTiming,u=(a.drawDefinitions||[]).map(p=>{const h=(({drawId:y,drawName:b,matchUpFormat:I,updatedAt:T})=>({matchUpFormat:I,updatedAt:T,drawName:b,drawId:y}))(p),{abandonedMatchUps:f,completedMatchUps:m,upcomingMatchUps:g,pendingMatchUps:v}=H0({requireParticipants:!0,tournamentParticipants:n,context:{eventId:s},policyDefinitions:e,tournamentRecord:t,inContext:!0,scheduleTiming:c,drawDefinition:p,event:a});return{drawInfo:h,matchUps:{abandonedMatchUps:f,completedMatchUps:m,upcomingMatchUps:g,pendingMatchUps:v}}}),d=Xc({event:a});return Object.assign(l,{drawsData:u,publish:d}),l})}}}var cFe=Object.freeze({__proto__:null,bulkUpdatePublishedEventIds:EC,getAllEventData:Jfe,getCourtInfo:kW,getDrawData:lq,getEventData:cq,getEventPublishStatus:Xc,getPublishState:Nk,getTournamentPublishStatus:jW,getVenueData:CU}),uFe=Object.freeze({__proto__:null,bulkUpdatePublishedEventIds:EC,getAllEventData:Jfe,getCourtInfo:kW,getDrawData:lq,getEventData:cq,getEventPublishStatus:Xc,getPublishState:Nk,getTournamentPublishStatus:jW,getVenueData:CU,mutate:lFe,publishEvent:Y0,publishEventSeeding:qfe,publishOrderOfPlay:Zfe,query:cFe,setEventDisplay:sx,unPublishEvent:Xfe,unPublishEventSeeding:Yfe,unPublishOrderOfPlay:Kfe});function zE({participant:t,eventType:e}){var i,n,r,o,a,s;const l=(i=t==null?void 0:t.person)==null?void 0:i.personId,c=(r=(n=t==null?void 0:t.person)==null?void 0:n.personOtherIds)==null?void 0:r[0],u=(o=t==null?void 0:t.person)==null?void 0:o.tennisId,d=(s=(a=t==null?void 0:t.ratings)==null?void 0:a[e])==null?void 0:s.find(({scaleName:m})=>m===vpe),p=d==null?void 0:d.scaleValue,{wtnRating:h,confidence:f}=p||{};return{timeStamp:d==null?void 0:d.scaleDate,personOtherId:c,confidence:f,wtnRating:h,personId:l,tennisId:u}}function dFe({eventType:t,matchUps:e,eventId:i,drawId:n}){const r={},o=e.filter(h=>i?h.eventId===i:h.drawId===n).reduce((h,f)=>((m=>{const g=m==null?void 0:m.matchUpFormat;g&&(r[g]||(r[g]=0),r[g]+=1)})(f),(f.sides??[]).flatMap(m=>{var g;return(((g=m==null?void 0:m.participant)==null?void 0:g.individualParticipants)||[m==null?void 0:m.participant]).filter(Boolean)}).forEach(m=>h[m.participantId]=m),h),{}),a=Object.values(o),s=a.map(h=>zE({participant:h,eventType:t})).filter(({wtnRating:h})=>h),l=(a.length-s.length)/a.length*100,c=s.reduce((h,f)=>{const{wtnRating:m,confidence:g}=f;return h.totalWTN+=m,h.totalConfidence+=g,h},{totalWTN:0,totalConfidence:0}),u=s!=null&&s.length?c.totalWTN/s.length:0,d=s!=null&&s.length?c.totalConfidence/s.length:0,p=Object.values(r).reduce((h,f)=>h+(f||0),0);return{matchUpFormatCounts:r,matchUpsCount:p,avgConfidence:d,pctNoRating:l,avgWTN:u}}var pFe=Object.freeze({__proto__:null,getEntryStatusReports:function({tournamentRecord:t}){if(!t)return{error:je};const e=t.tournamentId,{participantMap:i}=Qn({withScaleValues:!0,withEvents:!0,withSeeding:!0,tournamentRecord:t,withDraws:!0}),n=(Vr({matchUpFilters:{matchUpTypes:[wI,ey]},tournamentRecord:t}).matchUps??[]).flatMap(({sides:h,matchUpType:f})=>h==null?void 0:h.flatMap(m=>{var g,v;return f===ey?(g=m==null?void 0:m.participant)==null?void 0:g.individualParticipantIds:((v=m==null?void 0:m.participant)==null?void 0:v.participantId)||m.participantId}).filter(Boolean)).filter(Boolean),r=[],o={},a={},s={};let l=0;const c=({id:h,entry:f,eventId:m,eventType:g})=>{var v;const{qualifyingSeeding:y,mainSeeding:b,entryStatus:I,entryStage:T,drawId:S}=f;o[h]||(o[h]=[]);const{participant:w,events:U}=(i==null?void 0:i[h])??{},D=zE({participant:w,eventType:g}),E=(v=U==null?void 0:U[m])==null?void 0:v.ranking;I===ape&&r.push(h),o[h].push({participantType:w==null?void 0:w.participantType,participantId:h,tournamentId:e,eventType:g,eventId:m,drawId:S,entryStatus:I,entryStage:T,...D,ranking:E,mainSeeding:b,qualifyingSeeding:y})};for(const h of t.events??[]){const f={},m=w=>{f[w]||(f[w]={count:0}),f[w].count+=1},{drawDefinitions:g=[],eventType:v,eventId:y}=h,b=g.flatMap(w=>{const{drawId:U,entries:D}=w;l+=1;const E=(w.structures??[]).filter(({stage:C,stageSequence:M})=>C===ct&&M===1||C===St).flatMap(({positionAssignments:C})=>C).filter(Boolean).map(({participantId:C})=>C);return D==null?void 0:D.filter(({participantId:C})=>E.includes(C)).map(C=>{var M,N,R,A,_,k,O,F;const{participantId:B,entryStatus:$,entryStage:V}=C;m($);const H=(A=(R=(N=(M=i==null?void 0:i[B])==null?void 0:M.draws)==null?void 0:N[U])==null?void 0:R.seedAssignments)==null?void 0:A[ct];return{qualifyingSeeding:(F=(O=(k=(_=i==null?void 0:i[B])==null?void 0:_.draws)==null?void 0:k[U])==null?void 0:O.seedAssignments)==null?void 0:F[St],participantId:B,mainSeeding:H,entryStatus:$,entryStage:V,drawId:U}})}),I=w=>{var U;const D=w.participantId,E=(U=i==null?void 0:i[D].participant.individualParticipantIds)==null?void 0:U.filter(C=>n.includes(C));return D&&{[D]:{individualParticipantIds:E}}};v===Wm?(()=>{const w=Object.assign({},...b.map(I).filter(Boolean));b.forEach(U=>{w[U.participantId].individualParticipantIds.forEach(D=>{c({id:D,eventType:v,eventId:y,entry:U})})})})():b.forEach(w=>{c({id:w==null?void 0:w.participantId,eventType:v,eventId:y,entry:w})});const T=Object.values(f).reduce((w,U)=>w+U.count,0);Object.keys(f).forEach(w=>{f[w].pct=f[w].count/T*100}),s[y]={tournamentId:e,eventId:y,entries:b,entryStatuses:f};const S=Object.assign({},...Zc.flatMap(w=>{var U,D;return[{[w+"_count"]:(U=f[w])==null?void 0:U.count},{[w+"_pct"]:(D=f[w])==null?void 0:D.pct}]}));a[y]={tournamentId:e,eventId:y,...S}}const u=Object.values(i??{}).filter(({participant:{participantType:h,participantRole:f}})=>h===ui&&f===Ro),d=u.filter(({participant:h})=>!n.includes(h.participantId)).map(({participant:h})=>h.participantId),p={nonParticipatingEntriesCount:d.length,individualParticipantsCount:u.length,eventsCount:Object.values(s).length,nonParticipatingParticipantIds:d,drawDefinitionsCount:l,tournamentId:e};return{entryStatusReports:Object.values(a).flat(),participantEntryReports:Object.values(o).flat(),eventReports:Object.values(s).flat(),withDrawnParticipantIds:r,tournamentEntryReport:p}},getParticipantStats:function({withCompetitiveProfiles:t,opponentParticipantId:e,withIndividualStats:i,teamParticipantId:n,tournamentRecord:r,withScaleValues:o,tallyPolicy:a,matchUps:s}){var l,c,u,d,p;if(!r)return{error:je};if(s&&!Array.isArray(s))return{error:ja};if(s=s??Vr({tournamentRecord:r,participantsProfile:o?{withScaleValues:o}:void 0}).matchUps,!(s!=null&&s.length))return{error:Nf};const h=[];e&&h.push(e),n&&h.push(n);const f=Qn({participantFilters:h.length?{participantIds:h}:{participantTypes:[il]},tournamentRecord:r}).participants??[];if(!f.every(({participantType:C})=>C===il))return{error:Ec};h.length||h.push(...f.map(li));const m=new Map,g=new Map,v=new Map,y=new Map,b=(C,M="")=>g.get(C)||g.set(C,{participantName:M,participantId:C,competitorIds:[],competitiveness:{},matchUpStatuses:{},tiebreaks:[0,0],matchUps:[0,0],points:[0,0],games:[0,0],sets:[0,0]})&&g.get(C);for(const C of f){const{participantId:M,individualParticipantIds:N}=C;y.set(M,N??[]),b(M,C.participantName)}if(n&&!y.get(n))return ce({result:{error:rr},context:{teamParticipantId:n}});if(e&&!y.get(e))return ce({result:{error:rr},context:{opponentParticipantId:e}});const I=[],T=C=>{const M=[[],[]];for(const R of C){const A=R.participant;if(A!=null&&A.participantName){m.set(A.participantId,{participantName:A.participantName,ratings:A.ratings});const _=g.get(A.participantId);_&&(_.participantName=A.participantName)}}const N=({side:R,individualParticipantIds:A})=>{var _,k,O,F,B;return R.participantId&&(!(A!=null&&A.length)||A.includes(R.participantId))&&[R.participantId]||((k=(_=R.participant)==null?void 0:_.individualParticipantIds)==null?void 0:k.length)&&(!(A!=null&&A.length)||sr(A,(O=R.participant)==null?void 0:O.individualParticipantIds).length===((B=(F=R.participant)==null?void 0:F.individualParticipantIds)==null?void 0:B.length))&&R.participant.individualParticipantIds};if(y.size){const R=(A,_)=>{for(const k of C){if(!k.participant)continue;const O=N({individualParticipantIds:_,side:k});if(O!=null&&O.length){const F=k.sideNumber;if(!F)continue;const B=[A];i&&B.push(...O),M[F-1]=B;const $=g.get(A);for(const V of O.filter(Boolean))$&&!$.competitorIds.includes(V)&&$.competitorIds.push(V)}}};if(n)(!e||C.every(A=>A.participant&&(N({individualParticipantIds:y.get(n),side:A})||N({individualParticipantIds:y.get(e),side:A}))))&&R(n,y.get(n));else for(const[A,_]of y)R(A,_)}else if(i)for(const R of C){if(!R.participant)continue;const A=N({individualParticipantIds:[],side:R}),_=R.sideNumber;_&&(M[_-1]=A)}return M};for(const C of s){if(!bn(C))return{error:ja};const{matchUpStatus:M,matchUpFormat:N,matchUpType:R,winningSide:A,score:_,sides:k}=C;if(!k||!_||R===Ad||M===Ri)continue;const O=T(k);if(!O.filter(Boolean).length)continue;const F=t&&A&&((l=KP({matchUp:C}))==null?void 0:l.competitiveness);I.push(C);const B=l3({matchUpStatus:M,matchUpFormat:N,tallyPolicy:a,winningSide:A,score:_}),$=_de({matchUpStatus:M,matchUpFormat:N,tallyPolicy:a,winningSide:A,score:_}),{pointsTally:V,tiebreaksTally:H}=kde({matchUpFormat:N,score:_});O.forEach((z,G)=>{var W;for(const K of z){const Z=(W=m.get(K))==null?void 0:W.participantName,Y=b(K,Z);if(Y){const X=(oe,ne)=>ne.forEach((re,me)=>Y[oe][me]+=re),Q=G?[...H].reverse():H,te=G?[...V].reverse():V,J=G?[...$].reverse():$,ie=G?[...B].reverse():B;if(X("tiebreaks",Q),X("points",te),X("games",J),X("sets",ie),A){const oe=A-1===G?0:1;Y.matchUps[oe]+=1}if(F){const oe=F.toLowerCase();Y.competitiveness[oe]||(Y.competitiveness[oe]=[0,0]),Y.competitiveness[oe][G]+=1}if(M){const oe=M.toLowerCase();Y.matchUpStatuses[oe]||(Y.matchUpStatuses[oe]=0),Y.matchUpStatuses[oe]+=1}}}})}const S=["tiebreaks","matchUps","points","games","sets"],w=["competitive","routine","decisive"],U=new Map,D=(C,M)=>(C??0)+(M??0);for(const[C,M]of g.entries()){for(const N of S){const R=M[N].reduce(D);if(R){const A=M[N][0]/R,_=`${N}Ratio`,k=parseFloat(A.toFixed(2));M[_]=k,v.set(C,!0),U.has(_)||U.set(_,[]),(c=U.get(_))==null||c.push(k)}}for(const N of w){const R=(d=(u=M.competitiveness)==null?void 0:u[N])==null?void 0:d.reduce(D);if(R){const A=M.competitiveness[N][0]/R,_=`${N}Ratio`,k=parseFloat(A.toFixed(2));M[_]=k}}}if(!n){const C=(M,N)=>N-M;for(const M of g.values())for(const N of S){const R=`${N}Ratio`;if(typeof M[R]=="number"){const A=(p=U.get(R))==null?void 0:p.sort(C).indexOf(M[R]);typeof A=="number"&&A>=0&&(M[`${N}Rank`]=A+1)}}}const E={relevantMatchUps:I,...le};return n?(E.teamStats=g.get(n),e&&(E.opponentStats=g.get(e))):E.participatingTeamsCount=v.size,E.allParticipantStats=[...g.values()],E},getStructureReports:function({firstFlightOnly:t=!0,extensionProfiles:e,tournamentRecord:i}){var n;if(!i)return{error:sU};const r={},o=Object.assign({},...(e??[]).map(({name:u,label:d,accessor:p})=>{var h,f,m;const g=(f=(h=ei({element:i,name:u}))==null?void 0:h.extension)==null?void 0:f.value;return{[d||u]:p?(m=wv({element:g,accessor:p}))==null?void 0:m.value:g}})),a=i==null?void 0:i.tournamentId,s=Vr({participantsProfile:{withScaleValues:!0},tournamentRecord:i}).matchUps??[],l=u=>{var d,p;const h=(d=Hu({itemType:sue,itemSubTypes:[ap],element:{timeItems:u}}))==null?void 0:d.timeItem;return(p=h==null?void 0:h.itemValue)==null?void 0:p.scaleBasis},c=(n=i==null?void 0:i.events)==null?void 0:n.flatMap(({timeItems:u,drawDefinitions:d=[],extensions:p,eventType:h,eventId:f,category:m})=>{var g,v,y,b;const I=p==null?void 0:p.find(C=>C.name===ql),T=(v=(g=I==null?void 0:I.value)==null?void 0:g.flights)==null?void 0:v.map(C=>({[C.drawId]:C.flightNumber})),S=T&&Object.assign({},...T),w=((b=(y=p==null?void 0:p.find(C=>C.name===wR))==null?void 0:y.value)==null?void 0:b.length)||0,U=Object.values(S),D=S&&Math.min(...U),E=l(u);return r[f]={totalPositionManipulations:0,maxPositionManipulations:0,generatedDrawsCount:0,drawDeletionsCount:w,seedingBasis:E?JSON.stringify(E):void 0,tournamentId:a,eventId:f},d.filter(C=>!t||!T||S[C.drawId]===D).flatMap(C=>{const{matchUpFormat:M,tieFormat:N,timeItems:R,extensions:A,structures:_,drawType:k,drawId:O}=C,{matchUpFormatCounts:F,matchUpsCount:B,avgConfidence:$,pctNoRating:V,avgWTN:H}=dFe({eventType:h,matchUps:s,drawId:O}),z=l(R)||E,G=function({extensions:K}){var Z,Y;return(Y=(Z=K==null?void 0:K.find(({name:X})=>X===IR))==null?void 0:Z.value)==null?void 0:Y.slice(1)}({extensions:A}),W=(G==null?void 0:G.length)||0;return r[f].totalPositionManipulations+=W,r[f].generatedDrawsCount+=1,W>r[f].maxPositionManipulations&&(r[f].maxPositionManipulations=W),_==null?void 0:_.filter(K=>K.stageSequence===1&&[St,ct,So,Vn].includes(K.stage)).map(K=>{var Z,Y;const X=[ct,Vn].includes(K.stage)?s.find(de=>de.structureId===K.structureId&&de.finishingRound===1&&de.winningSide):void 0,Q=(Z=X==null?void 0:X.sides)==null?void 0:Z.find(de=>de.sideNumber===X.winningSide),te=Q==null?void 0:Q.participant,J=(te==null?void 0:te.participantType)===il&&te.participantId,ie=(te==null?void 0:te.participantType)===qt?te.individualParticipants:[],oe=zE({participant:(ie==null?void 0:ie[0])||te,eventType:h}),{personId:ne,personOtherId:re,tennisId:me,confidence:he,wtnRating:be}=oe||{},Se=zE({participant:ie==null?void 0:ie[1],eventType:h}),{personId:De,personOtherId:Oe,tennisId:xe,confidence:$e,wtnRating:Ae}=Se||{},{ageCategoryCode:ve,categoryName:ke,subType:ye}=m??{},Ie=K.matchUpFormat||M,Ne=(F[Ie]||0)/B*100,{tieFormatName:Fe,tieFormatDesc:Le}=BR(N),{tieFormatName:ge,tieFormatDesc:Ee}=BR(K.tieFormat),we=Le===Ee,fe=!we&&ge,Te=K.tieFormat&&!we&&Ee,ue=((Y=G==null?void 0:G.filter(de=>de.structureId===K.structureId))==null?void 0:Y.length)||0;return{...o,tournamentId:a,eventId:f,structureId:K.structureId,drawId:O,eventType:h,category:ye,categoryName:ke,ageCategoryCode:ve,flightNumber:S[O],drawType:k,stage:K.stage,seedingBasis:z?JSON.stringify(z):void 0,winningPersonId:ne,winningPersonOtherId:re,winningPersonTennisId:me,winningPersonWTNrating:be,winningPersonWTNconfidence:he,winningPerson2Id:De,winningPerson2OtherId:Oe,winningPerson2TennisId:xe,winningPerson2WTNrating:Ae,winningPerson2WTNconfidence:$e,winningTeamId:J,positionManipulations:ue,pctNoRating:V,matchUpFormat:Ie,pctInitialMatchUpFormat:Ne,matchUpsCount:B,drawTieFormatName:Fe,drawTieFormatDesc:Le,tieFormatName:fe,tieFormatDesc:Te,avgConfidence:$,avgWTN:H}})})});return{eventStructureReports:Object.values(r),structureReports:c}},getVenuesReport:function({ignoreDisabled:t=!0,tournamentRecords:e,tournamentId:i,venueIds:n=[],dates:r=[]}){var o,a;if(!Array.isArray(r))return{error:Re,dates:r};if(!Array.isArray(n))return{error:Re,venueIds:n};if(!(e&&Object.keys(e).filter(p=>!i||p===i)||[]).length)return{error:Wn};if(!r.every(Ss))return{error:Ha};const s=eh({tournamentRecords:e,ignoreDisabled:t,dates:r});if(s.error)return s;const l=(o=s==null?void 0:s.venues)==null?void 0:o.filter(({venueId:p})=>!(n!=null&&n.length)||n.includes(p)),c=(a=s.courts)==null?void 0:a.reduce((p,h)=>{var f;return(f=h.dateAvailability)==null||f.forEach(m=>{const g=m.date;p.includes(g)||p.push(g)}),p},[]).filter(p=>!r.length||r.includes(p)),u={venueIds:l==null?void 0:l.map(({venueId:p})=>p)},{matchUps:d}=Vc({afterRecoveryTimes:!0,tournamentRecords:e,matchUpFilters:u});return{venuesReport:l==null?void 0:l.map(p=>function(h,f,m){const{venueId:g,courts:v,venueName:y}=f,b={};return h.forEach(I=>{let T=0,S=0,w=0;for(const E of v){const C=E.dateAvailability.find(R=>R.date===I),M=C&&K0({courtDate:C}).timeSlots,N=M==null?void 0:M.reduce((R,A)=>{const{startTime:_,endTime:k}=A;return R+(gi(k)-gi(_))},0);N&&(w+=1),T+=N}const U=m.filter(({schedule:E})=>E.venueId===g&&Pd(I,E.scheduledDate));U.forEach(({schedule:E})=>{const C=mn(E.scheduledTime),M=gi(Oa(C,E.averageMinutes))-gi(C);S+=M});const D=T?(S/T*100).toFixed(2):"100";b[I]={scheduledMatchUpsCount:U.length,availableCourts:w,availableMinutes:T,scheduledMinutes:S,percentUtilization:D}}),{venueId:g,venueName:y,venueReport:b}}(c,p,d))}}});function xq({calculateStartTimeFromCourts:t=!0,defaultRecoveryMinutes:e=0,averageMatchUpMinutes:i=90,remainingScheduleTimes:n,clearScheduleDates:r,tournamentRecords:o,periodLength:a,scheduleDate:s,startTime:l,venueIds:c,endTime:u}){if(typeof o!="object"||!Object.keys(o).length)return{error:Wn};a=a??ux({recoveryMinutes:e,averageMatchUpMinutes:i});const{courts:d,venues:p}=eh({dates:[s],ignoreDisabled:!0,tournamentRecords:o}),h=d==null?void 0:d.filter(U=>!c||c.includes(U.venueId));l||(l=h==null?void 0:h.reduce((U,D)=>{var E;const C=(E=D.dateAvailability)==null?void 0:E.find(N=>!N.date||Pd(s,N.date)),M=(C==null?void 0:C.startTime)??D.startTime;return M&&(!U||gi(M)<gi(U))?M:U},void 0)),u||(u=h==null?void 0:h.reduce((U,D)=>{var E;const C=(E=D.dateAvailability)==null?void 0:E.find(N=>!N.date||Pd(s,N.date)),M=(C==null?void 0:C.endTime)??D.endTime;return M&&(!U||gi(M)>gi(U))?M:U},void 0));const f=Object.values(o),m=Object.assign({},...f.map(U=>(U.events??[]).map(D=>{const{scheduleTiming:E}=QP({tournamentRecord:U,event:D});return{[D.eventId]:{event:D,scheduleTiming:E}}})).flat()),g=PC({sortDateMatchUps:!1,tournamentRecords:o,matchUpFilters:{scheduledDate:s,venueIds:c}}),v=(g==null?void 0:g.dateMatchUps)??[],y=(g==null?void 0:g.completedMatchUps)??[],b=[];b.push(...v),b.push(...y);const I={averageTimes:[{minutes:{default:i}}],recoveryTimes:[{minutes:{default:e}}]},T=b==null?void 0:b.map(({eventId:U,schedule:D,matchUpFormat:E})=>{const{event:C,scheduleTiming:M}=m[U],N=C==null?void 0:C.eventType,R={...M,defaultTiming:I,matchUpFormat:E},{averageMinutes:A,recoveryMinutes:_}=Dk({eventType:N,timingDetails:R}),{courtId:k,venueId:O}=D,F=mn(D.scheduledTime),B=Oa(F,A);return{recoveryMinutes:_,averageMinutes:A,periodLength:a,startTime:F,endTime:B,courtId:k,venueId:O}}),S={calculateStartTimeFromCourts:t,remainingScheduleTimes:n,averageMatchUpMinutes:i,date:s,clearScheduleDates:r,periodLength:a,startTime:l,endTime:u,bookings:T,courts:h},{scheduleTimes:w}=yq(S);return{venueId:(c==null?void 0:c.length)===1&&c[0]||(p==null?void 0:p.length)===1&&p[0].venueId||void 0,scheduleTimes:w,dateScheduledMatchUpIds:b.map($r)}}function Qfe(t){var e;const i=Ln(t,[{[Oo]:!0}]);if(i.error)return i;const{removePriorValues:n,tournamentRecords:r,tournamentId:o,courtDayDate:a,matchUpId:s,courtId:l,drawId:c}=t,u=r[o];if(!u)return{error:je};const{drawDefinition:d,event:p}=cf({tournamentRecord:u,drawId:c});if(!d)return{error:rt};const h=vn({drawDefinition:d,event:p,matchUpId:s});if(h.error)return h;if(((e=h==null?void 0:h.matchUp)==null?void 0:e.matchUpType)===Ad){const{itemValue:f}=Ug({timeItems:h.matchUp.timeItems??[],itemType:sf}),m=l&&f.filter(g=>g.courtId!==l);return Ns({duplicateValues:!1,removePriorValues:n,tournamentRecord:u,drawDefinition:d,matchUpId:s,timeItem:{itemType:sf,itemValue:m}})}return fb({tournamentRecord:u,drawDefinition:d,courtDayDate:a,courtId:"",matchUpId:s})}function eme({scheduleCompletedMatchUps:t,tournamentRecords:e,scheduledDate:i,matchUps:n}){if(!vl(n))return{error:Re};if(n.some(({hasContext:h})=>!h))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Q_};let r=PC({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,tournamentRecords:e,matchUpFilters:{localPerspective:!0,scheduledDate:i}});if(r.error)return r;const{rows:o}=r,a=[],s=h=>[(h.sides||[]).map(f=>{var m;return[f.participantId,(m=f.participant)==null?void 0:m.individualParticipantIds]}),(h.potentialParticipants||[]).flat().map(f=>[f.participantId,f.individualParticipantIds])].flat(1/0).filter(Boolean),l=o==null?void 0:o.reduce((h,f)=>{const m=[],g=[];Object.values(f).forEach(y=>{if(bn(y)&&(y.matchUpId&&(m.push(y.matchUpId),a.push(y)),y.sides)){const b=s(y);g.push(...b)}});const v=Object.values(f).filter(y=>bn(y)&&!y.matchUpId);return h.concat({matchUpIds:m,availableCourts:v,rowId:f.rowId,participantIds:g})},[]);n.filter(({matchUpStatus:h})=>h&&h!==Ri&&(t||!no.includes(h))).sort(ob);const c=rc({matchUps:n.concat(a),includeParticipantDependencies:!0,tournamentRecords:e}).matchUpDependencies,u=[],d=[];for(;n.length&&l.length;){const h=l.shift(),f=[];for(;n.length&&h.availableCourts.length;){const m=n.concat(f).map(U=>U.matchUpId),g=n.shift(),v=g==null?void 0:g.matchUpId,y=v&&c[v].matchUpIds.concat(c[v].dependentMatchUpIds),b=v&&m.some(U=>c[v].matchUpIds.includes(U)),I=v&&d.some(U=>c[v].dependentMatchUpIds.includes(U)),T=h.matchUpIds.some(U=>y.includes(U)),S=s(g),w=h.participantIds.some(U=>S.includes(U));if(!g||T||b||w||I)g&&f.push(g);else{const U=h.availableCourts.shift();Object.assign(g.schedule,U.schedule),Object.assign(U,g),u.push(g),h.participantIds.push(...S),h.matchUpIds.push(v)}}n.push(...f),d.push(...h.matchUpIds)}const p=u.map(({matchUpId:h,tournamentId:f,schedule:m,drawId:g})=>({tournamentId:f,matchUpId:h,drawId:g,schedule:{...m,scheduledDate:i}}));return r=FU({tournamentRecords:e,matchUpDetails:p}),{...r,scheduled:u,notScheduled:n}}function tme(t){const{courtDayDate:e}=t,i=Ln(t,[{courtAssignments:!0,[HP]:El,[Yv]:bt},{[Oo]:!0}]);if(i.error)return i;const n=t.courtAssignments.reduce((o,a)=>{const{tournamentId:s}=a;return o[s]||(o[s]=[]),o[s].push(a),o},{});let r;return Object.keys(n).every(o=>{const a=t[Oo][o];if(!a)return r={error:je},!1;const s=n[o].reduce((l,c)=>{const{drawId:u}=c;return l[u]||(l[u]=[]),l[u].push(c),l},{});Object.keys(s).every(l=>{const{drawDefinition:c}=us({tournamentRecord:a,drawId:l});return c?(s[l].every(u=>{const{matchUpId:d,courtId:p}=u,h=fb({tournamentRecord:a,drawDefinition:c,courtDayDate:e,matchUpId:d,courtId:p});if(h.success)return h==null?void 0:h.success;r={error:G_e}}),!0):(r={error:rt},!1)})}),r||le}function ime(t){const{tournamentRecords:e,allDateMatchUpIds:i=[],averageMatchUpMinutes:n=90,recoveryMinutes:r=0,recoveryMinutesMap:o,matchUpPotentialParticipantIds:a={},individualParticipantProfiles:s={},matchUpNotBeforeTimes:l={},matchUpDailyLimits:c={},checkPotentialRequestConflicts:u=!0,remainingScheduleTimes:d,clearScheduleDates:p,periodLength:h=30,scheduleDate:f,matchUpIds:m,venueIds:g,startTime:v,endTime:y,dryRun:b}=t,I=Ln(t,[{[Oo]:!0,[dW]:!0},{[Ch]:Ss,[Yv]:Ha,scheduleDate:!0},{[Ch]:G=>!G||!isNaN(G),averageMatchUpMinutes:!1,[Yv]:Re,recoveryMinutes:!1,periodLength:!1}]);if(I.error)return I;const T=t.competitionMatchUps??Vc({nextMatchUps:!0,tournamentRecords:e}).matchUps??[],S=t.matchUpDependencies??rc({includeParticipantDependencies:!0,matchUps:T,tournamentRecords:e}).matchUpDependencies;T.forEach(G=>{var W;(W=G.schedule)!=null&&W.scheduledDate&&Pd(f,zt(G.schedule.scheduledDate))&&Sw({matchUpPotentialParticipantIds:a,matchUpNotBeforeTimes:l,matchUp:G})});const w=m.map(G=>T.find(W=>W.matchUpId===G)).filter(Boolean),{venueId:U,scheduleTimes:D,dateScheduledMatchUpIds:E}=xq({tournamentRecords:e,remainingScheduleTimes:d,startTime:mn(v),endTime:mn(y),scheduleDate:zt(f),averageMatchUpMinutes:n,clearScheduleDates:p,periodLength:h,venueIds:g}),C={},M=[],N={},R={},A={};T.filter(({matchUpId:G})=>E==null?void 0:E.includes(G)).forEach(G=>{var W;mB({matchUpPotentialParticipantIds:a,individualParticipantProfiles:s,matchUp:G,value:1});const K=(W=G.schedule)==null?void 0:W.scheduledTime;if(K){N[G.matchUpId]=K;const Z=o==null?void 0:o[G.matchUpId];OU({recoveryMinutes:Z||r,matchUpPotentialParticipantIds:a,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:S,scheduleTime:K,matchUp:G})}});let _=w.filter(G=>{const W=E==null?void 0:E.includes(G.matchUpId),K=[Ri,Mi,fr,Es,da,Li].includes(G==null?void 0:G.matchUpStatus);return!W&&!G.winningSide&&!K});const{matchUpMap:k,overLimitMatchUpIds:O,participantIdsAtLimit:F}=_.reduce((G,W)=>{const{drawId:K,tournamentId:Z,matchUpType:Y}=W,{participantIdsAtLimit:X,relevantParticipantIds:Q}=vB({individualParticipantProfiles:s,matchUpPotentialParticipantIds:a,matchUpDailyLimits:c,matchUp:W});return X!=null&&X.length?(G.overLimitMatchUpIds.push(W.matchUpId),G.participantIdsAtLimit.push(...X),G):(Q.forEach(te=>{AC({individualParticipantProfiles:s,participantId:te});const J=s[te].counters;J[Y]?J[Y]+=1:J[Y]=1,J[gc]?J[gc]+=1:J[gc]=1}),G.matchUpMap[Z]||(G.matchUpMap[Z]={}),G.matchUpMap[Z][K]?G.matchUpMap[Z][K].push(W):G.matchUpMap[Z][K]=[W],Sw({matchUpPotentialParticipantIds:a,matchUpNotBeforeTimes:l,matchUp:W}),G)},{matchUpMap:{},overLimitMatchUpIds:[],participantIdsAtLimit:[]});_=_.filter(({matchUpId:G})=>!O.includes(G));let B=0;const $=(D==null?void 0:D.length)??0,{personRequests:V}=Cg({tournamentRecords:e,requestType:yx});for(;D!=null&&D.length&&_.length&&B<=$;){B++;const{scheduleTime:G}=D.shift(),W=_.find(K=>{const{matchUpId:Z}=K,{dependenciesScheduled:Y,remainingDependencies:X}=hB({matchUpScheduleTimes:N,matchUpDependencies:S,allDateMatchUpIds:i,matchUp:K});if(!Y)return A[Z]||(A[Z]=[]),A[Z].push({scheduleTime:G,remainingDependencies:X}),!1;const{enoughTime:Q}=gB({individualParticipantProfiles:s,matchUpNotBeforeTimes:l,matchUpDependencies:S,scheduleTime:G,matchUp:K});if(!Q)return R[Z]||(R[Z]=[]),R[Z].push({scheduleTime:G}),!1;const{conflicts:te}=fB({potentials:u,averageMatchUpMinutes:n,requestConflicts:C,personRequests:V,scheduleTime:G,scheduleDate:f,matchUp:K});if(te!=null&&te.length)return!1;const J=o==null?void 0:o[K.matchUpId];return OU({recoveryMinutes:J||r,matchUpPotentialParticipantIds:a,individualParticipantProfiles:s,matchUpNotBeforeTimes:l,averageMatchUpMinutes:n,matchUpDependencies:S,scheduleTime:G,matchUp:K}),N[K.matchUpId]=G,!0});_=_.filter(({matchUpId:K})=>K!==(W==null?void 0:W.matchUpId)),W||M.push(G)}_.forEach(G=>{mB({individualParticipantProfiles:s,matchUpPotentialParticipantIds:a,value:-1,matchUp:G})});const H=[];Object.keys(k).forEach(G=>{const W=e[G];W&&Object.keys(k[G]).forEach(K=>{const{drawDefinition:Z}=cf({tournamentRecord:W,drawId:K});Z&&k[G][K].forEach(({matchUpId:Y})=>{const X=N[Y];if(X){const Q=X.split(":").map(Zs).join(":"),te=`${zt(f)}T${Q}`;b?H.push(Y):(uf({drawDefinition:Z,matchUpId:Y,scheduledTime:te}).success&&H.push(Y),U&&Z0({tournamentRecords:e,tournamentRecord:W,drawDefinition:Z,matchUpId:Y,venueId:U}))}})})});const z=vW(_);return{...le,requestConflicts:Object.values(C),remainingScheduleTimes:D==null?void 0:D.map(({scheduleTime:G})=>G),individualParticipantProfiles:s,matchUpNotBeforeTimes:l,participantIdsAtLimit:F,skippedScheduleTimes:M,overLimitMatchUpIds:O,scheduledMatchUpIds:H,noTimeMatchUpIds:z,recoveryTimeDeferred:R,dependencyDeferred:A}}function nme({tournamentRecords:t,matchUps:e}){if(!vl(e))return{error:Nf};if(e.some(({matchUpId:u,hasContext:d})=>u&&!d))return{info:"matchUps must have { inContext: true, nextMatchUps: true }",error:Q_};const i=nt(1,Math.max(...e.map(({schedule:u})=>(u==null?void 0:u.courtOrder)||1).map(u=>Ct(u)))+1).map(u=>e.filter(d=>{var p;return Ct((p=d.schedule)==null?void 0:p.courtOrder)===u})),n={},r={},o={};i.flat().filter(Boolean).sort(ob).forEach(({schedule:u})=>delete u[eL]);const a=rc({includeParticipantDependencies:!0,tournamentRecords:t,drawIds:ti(e.map(({drawId:u})=>u))}).matchUpDependencies,s=i.map((u,d)=>u.reduce((p,h)=>{if(!h.matchUpId)return p;const{matchUpId:f,winnerMatchUpId:m,loserMatchUpId:g,schedule:v,sides:y,potentialParticipants:b}=h,I=v==null?void 0:v.courtId;n[f]=d,r[I]=[],p.matchUpIds.push(f),o[f]=h;const T=a[f].matchUpIds;T.length&&p.sourceMatchUpIds.push(...T);const S=(y==null?void 0:y.map(U=>{var D;return[(D=U.participant)==null?void 0:D.individualParticipantIds,U.participantId]}).flat().filter(Boolean))??[],w=(b==null?void 0:b.flat().map(({individualParticipantIds:U,participantId:D})=>[U,D]).flat().filter(Boolean))||[];return p.participantIds.push(...w,...S),m&&p.targetMatchUpIds.push(m),g&&p.targetMatchUpIds.push(g),p},{sourceMatchUpIds:[],targetMatchUpIds:[],participantIds:[],matchUpIds:[]})),l=s.map(()=>[]),c=(u,d,p,h)=>{if(!o[u].schedule[eL]){o[u].schedule[eL]=d,o[u].schedule[Qke]=h,l[n[u]].push({matchUpId:u,issueType:p,issueIds:h,issue:d});const f=o[u].schedule.courtId;r[f]||(r[f]=[]),r[f].push({matchUpId:u,issue:d,issueType:p,issueIds:h})}};return s.forEach((u,d)=>{const p=d?s[d-1]:void 0,h=s.slice(d+1),f={},m=cs(u.participantIds),g=Object.keys(m).filter(b=>m[b]>1),v=u.matchUpIds.filter(b=>a[b].participantIds.some(I=>g.includes(I)));v.forEach(b=>{f[b]||(f[b]={}),f[b][kg]||(f[b][kg]=v.filter(I=>I!==b))});const y=p&&u.participantIds.filter(b=>p.participantIds.includes(b));y&&y.forEach(b=>{const I=u.matchUpIds.concat(p.matchUpIds).filter(T=>a[T].participantIds.includes(b));I.forEach(T=>{f[T]||(f[T]={}),f[T][xg]||(f[T][xg]=I.filter(S=>S!==T))})}),u.matchUpIds.forEach(b=>{var I,T,S,w;const U=a[b].matchUpIds;for(const E of h){const C=E.matchUpIds.filter(M=>U.includes(M));C!=null&&C.length&&(C.forEach(M=>c(M,B7,jf,[b])),c(b,B7,jf,C))}if((I=f[b])!=null&&I[kg]&&c(b,kg,F7,f[b][kg]),u.sourceMatchUpIds.includes(b)){const E=u.matchUpIds.filter(C=>a[C].matchUpIds.includes(b));c(b,kg,jf,E),u.matchUpIds.filter(C=>a[C].matchUpIds.includes(b)).forEach(C=>c(C,kg,jf,[b]))}const D=(T=p==null?void 0:p.matchUpIds)==null?void 0:T.filter(E=>{return C=E,a[b].sources.reduce((M,N,R)=>N.includes(C)&&R+1||M,0)>1;var C});if(D!=null&&D.length&&(c(b,$7,jf,D),D.forEach(E=>c(E,$7,jf,[b]))),(S=f[b])!=null&&S[xg]&&c(b,xg,F7,f[b][xg]),(w=p==null?void 0:p.targetMatchUpIds)==null?void 0:w.includes(b)){const E=o[b].schedule.courtId,C=U.filter(M=>p.matchUpIds.includes(M));C.some(M=>o[M].schedule.courtId===E)||(C.forEach(M=>c(M,xg,jf,[b])),c(b,xg,jf,C))}})}),{courtIssues:r,rowIssues:l}}function rme(t){const e="reorderUpcomingMatchUps",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return ce({result:{error:Wn},stack:e});const{matchUpsContextIds:n,firstToLast:r}=t;if(!n)return ce({result:{error:bt},stack:e});const o=n==null?void 0:n.length;if(!o)return{...le};let a=0;return n.forEach((s,l)=>{const{tournamentId:c,drawId:u,matchUpId:d}=s;let p=l+(r?-1:1);p<0&&(p=o-1),p===o&&(p=0);const h=function({tournamentId:f,scheduledTime:m,matchUpId:g,drawId:v}){const y=i[f],{drawDefinition:b}=cf({tournamentRecord:y,drawId:v});return b?uf({drawDefinition:b,scheduledTime:m,matchUpId:g}):{error:ml}}({tournamentId:c,scheduledTime:n[p].schedule.scheduledTime,matchUpId:d,drawId:u});if(!h.success)return h;a++}),a===o?le:ce({result:{error:H_e},stack:e})}function ome(t){var e,i;const{scheduleChange:n,matchUpIds:r,dryRun:o}=t;if(!r||!Array.isArray(r))return{error:OP};if(typeof n!="object")return{error:Re};const a=Vu(t),s=[];let l=[];for(const u of Object.values(a)){const d=hFe({tournamentRecord:u,scheduleChange:n,matchUpIds:r,dryRun:o});if(d.error)return d;Array.isArray(d.notRescheduled)&&l.push(...d.notRescheduled);const p=vW(d.notRescheduled),h=[];(e=d.rescheduled)==null||e.forEach(f=>{const{matchUpId:m}=f;p.includes(m)&&h.push(m),s.push(f)}),h.length&&(l=((i=d==null?void 0:d.notRescheduled)==null?void 0:i.filter(({matchUpId:f})=>!h.includes(f)))||[])}const c=!(!s.length||l.length);return{...le,rescheduled:s,notRescheduled:l,allRescheduled:c}}function hFe({tournamentRecord:t,scheduleChange:e,matchUpIds:i,dryRun:n}){if(!t)return{error:je};if(!i||!Array.isArray(i))return{error:OP};if(typeof e!="object")return{error:Re};const r=[],o=[],{minutesChange:a,daysChange:s}=e;if(!a&&!s)return{...le};if(a&&isNaN(a))return{error:Re};if(s&&isNaN(s))return{error:Re};const{matchUps:l}=Vr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}),c=l==null?void 0:l.filter(y=>DC({schedule:y.schedule})).filter(y=>(({matchUpStatus:b})=>!no.includes(b))({matchUpStatus:y.matchUpStatus}));if(!(c!=null&&c.length))return{...le};const{tournamentInfo:u}=pb({tournamentRecord:t}),{startDate:d,endDate:p}=u,h=c==null?void 0:c.reduce((y,b)=>{const{matchUpId:I,drawId:T}=b;return y[T]?y[T].push(I):y[T]=[I],y},{});for(const y of Object.keys(h)){const b=cf({tournamentRecord:t,drawId:y});if(b.error)return b;const I=b.drawDefinition,T=h[y].filter(S=>i.includes(S));for(const S of T)if(S&&I){const w=c.find(R=>R.matchUpId===S),U=w==null?void 0:w.schedule,{scheduledTime:D,scheduledDate:E}=U;let C,M,N;if(!C&&s&&E&&(N=LS(zt(E),s),C=new Date(N)<new Date(d)||new Date(N)>new Date(p)),a&&D){const R=zt(D),A=gi(mn(D))+a;if(C=A<0||A>1440,!C){const _=Oa(D,a),k=R&&N||E===R&&R;M=k?`${k}T${_}`:_}}if(C)o.push(S);else{if(!n){if(M){const R=uf({scheduledTime:M,drawDefinition:I,matchUpId:S});if(R.error)return R}if(N){const R=gx({scheduledDate:N,drawDefinition:I,matchUpId:S});if(R.error)return R}}(M||N)&&r.push(S)}}}const f=Vr({matchUpFilters:{matchUpIds:i},tournamentRecord:t}).matchUps??[],m=f.filter(({matchUpId:y})=>r.includes(y)),g=f.filter(({matchUpId:y})=>o.includes(y)),v=m.length&&!g.length;return{...le,rescheduled:m,notRescheduled:g,allRescheduled:v}}function ame(t){const e="matchUpScheduleChange",{tournamentRecords:i}=t;if(typeof i!="object"||!Object.keys(i).length)return{error:Wn};const{sourceMatchUpContextIds:n,targetMatchUpContextIds:r,sourceCourtId:o,targetCourtId:a,courtDayDate:s}=t||{},{drawId:l,matchUpId:c,tournamentId:u}=n||{},{drawId:d,matchUpId:p,tournamentId:h}=r||{};if(!c&&!p)return ce({result:{error:bt},stack:e});const{matchUps:f}=Vc({matchUpFilters:{matchUpIds:[c,p].filter(Boolean),drawIds:[l,d].filter(Boolean)},tournamentRecords:t.tournamentRecords}),m=f==null?void 0:f.find(({matchUpId:b})=>b===c),g=f==null?void 0:f.find(({matchUpId:b})=>b===p);let v=0;if(a&&c&&!p){const b=y({tournamentId:u,matchUpId:c,courtId:a,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:o,courtDayDate:s});if(b!=null&&b.success&&v++,b.error)return ce({result:b,stack:e})}else{if(!(o&&a&&c&&p))return{error:bt};{const b=y({tournamentId:u,matchUpId:c,courtId:a,matchUp:m,drawId:l,tournamentRecords:i,sourceCourtId:o,courtDayDate:s});if(b.success&&v++,b.error)return ce({result:b,stack:e,info:"source"});const I=y({tournamentId:h,sourceCourtId:a,matchUpId:p,matchUp:g,courtId:o,drawId:d,tournamentRecords:i,courtDayDate:s});if(I.success&&v++,I.error)return ce({result:I,stack:e,info:"target"})}}return v?le:ce({result:{error:BP},stack:e});function y(b){const{tournamentRecords:I,tournamentId:T,matchUp:S,drawId:w}=b,U=I[T],{drawDefinition:D}=cf({tournamentRecord:U,drawId:w});return S.matchUpType===gn?function({removePriorValues:E,tournamentRecords:C,tournamentRecord:M,drawDefinition:N,sourceCourtId:R,courtDayDate:A,matchUpId:_,matchUp:k,courtId:O}){const F=[O].concat(k.schedule.allocatedCourts.map(({courtId:B})=>B).filter(B=>B!==R));return fx({removePriorValues:E,tournamentRecords:C,tournamentRecord:M,drawDefinition:N,courtDayDate:A,matchUpId:_,courtIds:F})}({...b,tournamentRecord:U,drawDefinition:D}):fb({...b,tournamentRecord:U,drawDefinition:D})}}function sme({scheduleAttributes:t=[sf,iy,ZP,XP,JP,ru,Lh,sp,Oh],tournamentRecord:e,drawDefinition:i,matchUpId:n}){var r,o;const a=i?(r=Fa({matchUpFilters:{matchUpIds:[n]},inContext:!1,drawDefinition:i}).matchUps)==null?void 0:r[0]:(o=Vr({matchUpFilters:{matchUpIds:[n]},tournamentRecord:e,inContext:!1}).matchUps)==null?void 0:o[0];if(!a)return{error:xo};const s=(a.timeItems??[]).filter(l=>(l==null?void 0:l.itemType)&&!t.includes(l==null?void 0:l.itemType));return a.timeItems=s,Ci({tournamentId:e.tournamentId,context:"clearMatchUpSchedule",drawDefinition:i,matchUp:a}),{...le}}function lme(t){const{tournamentRecord:e,tournamentId:i,dailyLimits:n}=t,r=t.tournamentRecords||e&&{[e.tournamentId]:e}||{};if(typeof r!="object"||!Object.keys(r).length)return{error:Wn};if(typeof n!="object")return{error:Af};const o=Object.keys(r).filter(a=>!i||i===a);if(i&&!o.includes(i))return{error:Re};for(const a of o){const s=Ii({element:r[a],extension:{name:GP,value:{dailyLimits:n}}});if(s.error)return s}return{...le}}var fFe=Object.freeze({__proto__:null,addMatchUpCourtOrder:Tq,addMatchUpEndTime:Dq,addMatchUpOfficial:Ghe,addMatchUpResumeTime:Cq,addMatchUpScheduleItems:mx,addMatchUpScheduledDate:gx,addMatchUpScheduledTime:uf,addMatchUpStartTime:Uq,addMatchUpStopTime:Pq,addSchedulingProfileRound:_q,allocateTeamMatchUpCourts:fx,assignMatchUpCourt:fb,assignMatchUpVenue:Z0,bulkRescheduleMatchUps:ome,bulkScheduleMatchUps:FU,bulkScheduleTournamentMatchUps:LU,bulkUpdateCourtAssignments:tme,calculateScheduleTimes:xq,clearMatchUpSchedule:sme,clearScheduledMatchUps:Ix,courtGridRows:H3,findMatchUpFormatTiming:Zk,findVenue:Jp,generateBookings:bx,generateVirtualCourts:cx,getProfileRounds:Y3,matchUpScheduleChange:ame,modifyMatchUpFormatTiming:uq,proAutoSchedule:eme,proConflicts:nme,publicFindCourt:Oue,removeEventMatchUpFormatTiming:ox,removeMatchUpCourtAssignment:Qfe,reorderUpcomingMatchUps:rme,scheduleMatchUps:ime,scheduleProfileRounds:wx,setMatchUpDailyLimits:lme,setSchedulingProfile:W0,toggleParticipantCheckInState:dx,validateSchedulingProfile:Xk}),mFe=Object.freeze({__proto__:null,addMatchUpCourtOrder:Tq,addMatchUpEndTime:Dq,addMatchUpOfficial:Ghe,addMatchUpResumeTime:Cq,addMatchUpScheduleItems:mx,addMatchUpScheduledDate:gx,addMatchUpScheduledTime:uf,addMatchUpStartTime:Uq,addMatchUpStopTime:Pq,addSchedulingProfileRound:_q,allocateTeamMatchUpCourts:fx,assignMatchUpCourt:fb,assignMatchUpVenue:Z0,bulkRescheduleMatchUps:ome,bulkScheduleMatchUps:FU,bulkScheduleTournamentMatchUps:LU,bulkUpdateCourtAssignments:tme,calculateScheduleTimes:xq,clearMatchUpSchedule:sme,clearScheduledMatchUps:Ix,courtGridRows:H3,findMatchUpFormatTiming:Zk,findVenue:Jp,generateBookings:bx,generateVirtualCourts:cx,getPersonRequests:Cg,getProfileRounds:Y3,getScheduledRoundsDetails:SC,getSchedulingProfile:th,getSchedulingProfileIssues:L3,matchUpScheduleChange:ame,modifyMatchUpFormatTiming:uq,mutate:fFe,proAutoSchedule:eme,proConflicts:nme,publicFindCourt:Oue,query:gOe,removeEventMatchUpFormatTiming:ox,removeMatchUpCourtAssignment:Qfe,reorderUpcomingMatchUps:rme,scheduleMatchUps:ime,scheduleProfileRounds:wx,setMatchUpDailyLimits:lme,setSchedulingProfile:W0,toggleParticipantCheckInState:dx,validateSchedulingProfile:Xk});function bm({drawDefinition:t,structureId:e,matchUpId:i,structure:n,matchUp:r,eventId:o,event:a}){var s;const l="getTieFormat";let c;if(e=(n==null?void 0:n.structureId)??e,((i=(r==null?void 0:r.matchUpId)??i)||e)&&!t)return{error:rt};if(o&&a)c=wh(a);else if(i){if(t&&(!r||!n)){const u=vn({drawDefinition:t,matchUpId:i});if(u.error)return u;if(((s=u.matchUp)==null?void 0:s.matchUpType)!==Ad)return ce({result:{error:ja},stack:l});n||(n=u.structure),r||(r=u.matchUp)}c=sT({item:r,drawDefinition:t,structure:n,event:a})||sT({item:n,drawDefinition:t,structure:n,event:a})||wh(t)||wh(a)}else if(t&&e){if(!n){const u=kt({drawDefinition:t,structureId:e});if(u.error)return u;n=u==null?void 0:u.structure}c=sT({item:n,drawDefinition:t,structure:n,event:a})||wh(t)||wh(a)}else c=wh(t)||wh(a);return c?{...le,structure:n,tieFormat:c,matchUp:r}:ce({result:{error:Z_},stack:l})}function ZR({matchUp:t,updateInProgressMatchUps:e}){return!t.winningSide&&![no].includes(t.matchUpStatus)&&(e||t.matchUpStatus!==Kc&&!lo(t))}function gL({from:t,to:e}){const i=Object.keys(t),n=sr(i,Object.keys(e)).length===i.length,r=i.filter(a=>t[a]!==e[a]).map(a=>({countChange:e[a]-t[a],collectionId:a})),o=i.every(a=>t[a]===e[a]);return{equivalent:n&&o,matchUpsCountChanges:r}}function u8({check:t,matchUp:e}){let i="";const n=[];return{changesArePossible:t.matchUpsCountChanges.every(({collectionId:r,countChange:o})=>{const a=e.tieMatchUps.filter(l=>l.collectionId===r&&l.matchUpStatus===qn).map(Ts("matchUpId")),s=a.length+o>=0||o>0;return!s&&o<0&&(i="Insufficient TO_BE_PLAYED matchUps"),n.push({toBePlayedTieMatchUpIds:a,collectionId:r,countChange:o}),s}),changes:n,cannotChangeReaon:i}}function Ux({drawDefinition:t,auditData:e}){const{extension:i}=ei({name:Jv,element:t});Ii({element:t,extension:{name:Jv,value:Array.isArray(i==null?void 0:i.value)?i==null?void 0:i.value.concat(e):[e]}})}function Oq({updateInProgressMatchUps:t=!1,tournamentRecord:e,collectionOrder:i,collectionName:n,tieFormatName:r,drawDefinition:o,matchUpFormat:a,matchUpCount:s,collectionId:l,matchUpType:c,structureId:u,matchUpId:d,category:p,eventId:h,gender:f,event:m,collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I}){var T;const S="modifyCollectionDefinition";if(a&&!Rs({matchUpFormat:a}))return ce({result:{error:Re},context:{matchUpFormat:a},stack:S});if(n&&typeof n!="string")return ce({result:{error:Re},context:{collectionName:n},stack:S});if(f&&!Object.values($ue).includes(f))return ce({result:{error:Re},context:{gender:f},stack:S});if(p&&typeof p!="object")return ce({result:{error:Re},context:{category:p},stack:S});const w={collectionValueProfiles:g,collectionValue:v,matchUpValue:y,scoreValue:b,setValue:I};if(!(Object.values(w).filter(Boolean).length||i||n||a||s||c))return ce({result:{error:bt},stack:S});if(Object.values(w).filter(Boolean).length>1)return ce({info:"Only one value assignment allowed per collectionDefinition",result:{error:Re},stack:S});let U=bm({drawDefinition:o,structureId:u,matchUpId:d,eventId:h,event:m});if(U.error)return ce({result:U,stack:S});const{matchUp:D,structure:E,tieFormat:C}=U,M=po(C),N=C==null?void 0:C.collectionDefinitions.find(z=>z.collectionId===l),R=M==null?void 0:M.collectionDefinitions.find(z=>z.collectionId===l);if(!N)return ce({info:"source collectionDefinition",result:{error:zo},context:{collectionId:l},stack:S});const A=v??y??b??I;if(g){const z=Hde({matchUpCount:s??(N==null?void 0:N.matchUpCount)??0,collectionValueProfiles:g});if(z.errors)return ce({result:{error:Re},info:z.errors,stack:S})}else if(A&&!$t(A))return ce({result:{error:Re},info:"value is not an integer",context:{value:A},stack:S});const _=g&&(!N.collectionValueProfiles||(k=N.collectionValueProfiles,O=g,!(sr(Object.keys(k),Object.keys(O)).length===Object.keys(k).length&&sr(Object.values(k),Object.values(O)).length===Object.values(k).length)));var k,O;const F=[];if(($t(v)&&N.collectionValue!==v||$t(y)&&N.matchUpValue!==y||$t(b)&&N.scoreValue!==b||$t(I)&&N.setValue!==I||_)&&(R.collectionValueProfiles=void 0,R.collectionValue=void 0,R.matchUpValue=void 0,R.scoreValue=void 0,R.setValue=void 0,Object.assign(R,w),F.push({collectionId:l,...It(w)})),($t(b)||$t(I))&&R.collectionGroupNumber){const z=R.collectionGroupNumber;M.collectionDefinitions=M.collectionDefinitions.map(G=>{const{collectionGroupNumber:W,...K}=G;return W===z?K:G}),M.collectionGroups=M.collectionGroups.filter(({groupNumber:G})=>G!==z),F.push({collectionId:l,change:"collectionGroupNumber removed"})}const{aggregateValue:B,valueGoal:$}=hb(M),V=It({aggregateValue:B,valueGoal:$});if(V.aggregateValue===(C==null?void 0:C.winCriteria.aggregateValue)&&V.valueGoal===(C==null?void 0:C.winCriteria.valueGoal)||(M.winCriteria=V,F.push({collectionId:l,winCriteria:V})),$t(i)&&N.collectionOrder!==i&&(R.collectionOrder=i,F.push({collectionId:l,collectionOrder:i})),n&&N.collectionName!==n&&(R.collectionName=n,F.push({collectionId:l,collectionName:n})),a&&N.matchUpFormat!==a&&(R.matchUpFormat=a,F.push({collectionId:l,matchUpFormat:a})),$t(s)&&N.matchUpCount!==s&&(R.matchUpCount=s,F.push({collectionId:l,matchUpCount:s})),c&&N.matchUpType!==c)return ce({result:{error:eW},context:{matchUpType:c},stack:S});p&&N.category!==p&&(R.category=p,F.push({collectionId:l,category:p})),f&&N.gender!==f&&(R.gender=f,F.push({collectionId:l,gender:f}));const H=It(M);if(U=ds({tieFormat:H}),U.error)return ce({result:U,stack:S});if(!F.length)return ce({result:{...le,modifications:F}});if((C==null?void 0:C.tieFormatName)!==r?(H.tieFormatName=r,F.push({tieFormatName:r})):F.length&&(delete H.tieFormatName,F.push("tieFormatName removed: modifications without new tieFormatName")),U=function({updateInProgressMatchUps:z,tournamentRecord:G,drawDefinition:W,structure:K,tieFormat:Z,eventId:Y,matchUp:X,event:Q,uuids:te}){var J,ie,oe,ne;const re="updateTieFormat",me=G==null?void 0:G.tournamentId;let he=0,be=0,Se=0,De=0;const Oe=Z==null?void 0:Z.collectionDefinitions.reduce((Ie,Ne)=>(Ie[Ne.collectionId]=(Ie[Ne.collectionId]||0)+Ne.matchUpCount,Ie),{}),xe=({tieFormat:Ie})=>{const Ne=Ie==null?void 0:Ie.collectionDefinitions.reduce((Fe,Le)=>(Fe[Le.collectionId]=(Fe[Le.collectionId]||0)+Le.matchUpCount,Fe),{});return gL({from:Ne,to:Oe}).equivalent},$e=(J=bm({drawDefinition:W}))==null?void 0:J.tieFormat,Ae=(ie=bm({event:Q}))==null?void 0:ie.tieFormat;if(Q&&Y){for(const Ie of Q.drawDefinitions??[])ve({drawDefinition:Ie});Q.tieFormat=po(Z),De+=1}else if(X){if(!X.tieMatchUps)return ce({result:{error:ja},stack:re});const Ie=cs((oe=X.tieMatchUps)==null?void 0:oe.map(({collectionId:Ee})=>Ee)),Ne=gL({to:Oe,from:Ie}),{changes:Fe,changesArePossible:Le,cannotChangeReaon:ge}=u8({matchUp:X,check:Ne});if(Ne.equivalent){if(!ZR({matchUp:X,updateInProgressMatchUps:z}))return ce({result:{error:lce},info:"matchUp is IN_PROGRESS or COMPLETE",stack:re});X.tieFormat=po(Z),De+=1}else{if(!Le)return ce({context:{collectionMap:Oe,matchUpMap:Ie},result:{error:Ph},info:ge||"specified changes not possible",stack:re});ye({tieFormat:Z,matchUp:X,changes:Fe,uuids:te})}be+=1,Ci({eventId:Q==null?void 0:Q.eventId,context:re,drawDefinition:W,tournamentId:me,matchUp:X})}else if(K){const Ie=$e??Ae,Ne=(ne=ke({inheritedTieFormat:Ie,structure:K}))==null?void 0:ne.modifiedMatchUpsCount;Ne&&(be+=Ne,he+=1,De+=1);const Fe=!K.tieFormat||Ap({ancestor:K.tieFormat,descendant:Z}).different;Fe&&(K.tieFormat=po(Z),he+=1,De+=1),(Ne||Fe)&&W&&un({structureIds:[K.structureId],eventId:Q==null?void 0:Q.eventId,drawDefinition:W})}else{if(!W)return{error:rt};ve({drawDefinition:W}),W.tieFormat=po(Z),De+=1}return{modifiedStructuresCount:he,modifiedMatchUpsCount:be,addedMatchUpsCount:Se,modifiedCount:De,...le,tieFormat:Z};function ve({drawDefinition:Ie}){var Ne;const Fe=Ie.structures||[],Le=[];for(const ge of Fe){if(ge.tieFormat)continue;const Ee=Ae,we=(Ne=ke({inheritedTieFormat:Ee,structure:ge}))==null?void 0:Ne.modifiedMatchUpsCount;if(we){he+=1,be+=we;const fe=ge.structureId;Le.push(fe)}}return un({structureIds:Le,eventId:Q==null?void 0:Q.eventId,drawDefinition:Ie}),Le.length}function ke({inheritedTieFormat:Ie,structure:Ne}){var Fe,Le;let ge=0;const Ee=((Fe=zi({matchUpFilters:{matchUpTypes:[gn]},structure:Ne}))==null?void 0:Fe.matchUps)||[];for(const we of Ee){const fe=ZR({matchUp:we,updateInProgressMatchUps:z});let Te=!1;const ue=gL({from:cs((Le=we.tieMatchUps)==null?void 0:Le.map(({collectionId:de})=>de)),to:Oe});if(ue.equivalent)we.tieFormat&&xe(we)&&fe&&(we.tieFormat=po(Z),Te=!0);else{const{changes:de,changesArePossible:_e}=u8({matchUp:we,check:ue});if(_e&&!we.tieFormat)ye({changes:de,matchUp:we,tieFormat:Z,uuids:te});else{if(!Ie)return ce({result:{error:Z_},stack:re});(!we.tieFormat||Ap({ancestor:Ie,descendant:we.tieFormat}).different)&&(we.tieFormat=Ie,Te=!0)}}Te&&(ge+=1,Ci({tournamentId:G==null?void 0:G.tournamentId,drawDefinition:W,context:re,eventId:Y,matchUp:we}))}return{modifiedMatchUpsCount:ge}}function ye({uuids:Ie,matchUp:Ne,tieFormat:Fe,changes:Le}){Ne.tieFormat=po(Fe);const ge=[],Ee=[];return Le.forEach(we=>{if(we.countChange>0){const fe=Math.max(0,...Ne.tieMatchUps.filter(de=>de.collectionId===we.collectionId).map(Ts("collectionPosition"))),Te=Fe.collectionDefinitions.find(de=>de.collectionId===we.collectionId),ue=fC({matchUpsLimit:we.countChange,collectionPositionOffset:fe,collectionDefinition:Te,matchUp:Ne,uuids:Ie});Ee.push(...ft(ue,!1,!0)),Se+=Ee.length,Ne.tieMatchUps.push(...ue)}else{const fe=we.toBePlayedTieMatchUpIds.slice(0,Math.abs(we.countChange));console.log("remove",fe.length),ge.push(...fe),Ne.tieMatchUps=Ne.tieMatchUps.filter(({matchUpId:Te})=>!fe.includes(Te))}}),Ee.length&&rf({matchUps:Ee,drawDefinition:W,tournamentId:me,eventId:Y}),ge.length&&Kp({matchUpIds:ge,action:"updateTieFormat",drawDefinition:W,tournamentId:me,eventId:Y}),{matchUpIdsRemoved:ge,matchUpsAdded:Ee}}}({tieFormat:H,updateInProgressMatchUps:t,tournamentRecord:e,drawDefinition:o,structure:E,eventId:h,matchUp:D,event:m}),!U.error){const{appliedPolicies:z}=Gi({tournamentRecord:e});(T=z==null?void 0:z.audit)!=null&&T[Jv]&&Ux({drawDefinition:o,auditData:It({collectionDefinition:R,drawId:o==null?void 0:o.drawId,action:S,structureId:u,matchUpId:d,eventId:h})})}return ce({result:{...U,modifications:F},stack:S})}function cme({updateInProgressMatchUps:t,originalValueGoal:e,tournamentRecord:i,wasAggregateValue:n,tieFormatName:r,drawDefinition:o,structureId:a,structure:s,tieFormat:l,matchUpId:c,matchUp:u,eventId:d,event:p}){const{aggregateValue:h,valueGoal:f}=hb(l);l.winCriteria=It({aggregateValue:h,valueGoal:f}),(e&&e!==f||h&&!n)&&(r?l.tieFormatName=r:delete l.tieFormatName);const{targetMatchUps:m}=function({updateInProgressMatchUps:y,drawDefinition:b,structureId:I,structure:T,matchUpId:S,matchUp:w}){var U,D;let E=[];return S&&w?E=[w]:I&&T?E=((U=zi({matchUpFilters:{matchUpTypes:[gn]},structure:T}))==null?void 0:U.matchUps)??[]:b&&(E=((D=Fa({matchUpFilters:{matchUpTypes:[gn]},drawDefinition:b}))==null?void 0:D.matchUps)??[]),{targetMatchUps:E.filter(C=>!C.winningSide&&C.matchUpStatus!==fr&&(y||C.matchUpStatus!==Kc&&!lo(C)))}}({updateInProgressMatchUps:t,drawDefinition:o,structureId:a,structure:s,matchUpId:c,matchUp:u});(function({updateInProgressMatchUps:y,tournamentRecord:b,drawDefinition:I,targetMatchUps:T,tieFormat:S,event:w}){for(const U of T){const D=!!U.tieFormat;let E;if(D&&(U.tieFormat=po(S)),y){const C=Od({matchUpId:U.matchUpId,exitWhenNoValues:!0,tournamentRecord:b,drawDefinition:I,event:w});if(C.error)return C;E=C.score}D&&!E&&Ci({tournamentId:b==null?void 0:b.tournamentId,context:"updateTargetTeamMatchUps",eventId:w==null?void 0:w.eventId,matchUp:U,drawDefinition:I})}})({updateInProgressMatchUps:t,tournamentRecord:i,targetMatchUps:m,drawDefinition:o,tieFormat:l,event:p});const g=It(l),v=ds({tieFormat:g});if(v.error)return v;if(d&&p)p.tieFormat=g;else if(c&&u)u.tieFormat=l;else if(s)s.tieFormat=g;else if(o)o.tieFormat=g;else if(!u||!o)return{error:rt};return un({drawDefinition:o,eventId:p==null?void 0:p.eventId}),{...le}}function ume({updateInProgressMatchUps:t=!0,collectionGroupNumber:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:o,matchUpId:a,matchUp:s,eventId:l,event:c}){var u;if(!e)return{error:bt};if(isNaN(e))return{error:Re};const d="removeCollectionGroup";let p=s?void 0:bm({drawDefinition:n,structureId:o,matchUpId:a,eventId:l,event:c});if(p!=null&&p.error)return ce({result:p,stack:d});const h=p==null?void 0:p.structure;s=s??(p==null?void 0:p.matchUp);const f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=f==null?void 0:f.winCriteria.aggregateValue,v=po(f);if(p=ds({tieFormat:v}),p.error)return ce({result:p,stack:d});const y=[];if(v.collectionDefinitions=v.collectionDefinitions.map(b=>{const{collectionGroupNumber:I,...T}=b;return I!==e?b:(y.push(b.collectionId),T)}),v.collectionGroups=v.collectionGroups.filter(({groupNumber:b})=>b!==e),p=cme({updateInProgressMatchUps:t,originalValueGoal:m,wasAggregateValue:g,tournamentRecord:i,drawDefinition:n,tieFormatName:r,structureId:o,structure:h,tieFormat:v,matchUpId:a,matchUp:s,eventId:l,event:c}),!p.error){const{appliedPolicies:b}=Gi({tournamentRecord:i});(u=b==null?void 0:b.audit)!=null&&u[Jv]&&Ux({drawDefinition:n,auditData:It({drawId:n==null?void 0:n.drawId,collectionGroupNumber:e,action:d,structureId:o,matchUpId:a,eventId:l})})}return ce({result:{...p,modifiedCollectionIds:y},stack:d})}function Uw({tieFormat:t,orderMap:e}){const i=po(t);return i.collectionDefinitions.forEach(n=>{const r=e[n.collectionId];r&&(n.collectionOrder=r)}),i.collectionDefinitions.sort((n,r)=>aw(n.collectionOrder)-aw(r.collectionOrder)),i}function dme({tournamentRecord:t,drawDefinition:e,structureId:i,matchUpId:n,orderMap:r,eventId:o,matchUp:a,event:s}){if(typeof r!="object"||!Object.values(r).every(l=>$t(l)))return ce({result:{error:Re},context:{orderMap:r}});if(o&&s!=null&&s.tieFormat)d8({tournamentRecord:t,event:s,orderMap:r});else if(n){const l=e&&vn({drawDefinition:e,matchUpId:n});if(l!=null&&l.error)return l;if(!(a=l.matchUp))return{error:Cs};a!=null&&a.tieFormat&&(a.tieFormat=Uw({tieFormat:a.tieFormat,orderMap:r}),Ci({tournamentId:t==null?void 0:t.tournamentId,eventId:s==null?void 0:s.eventId,drawDefinition:e,matchUp:a}))}else if(i){const l=kt({drawDefinition:e,structureId:i});if(l.error)return l;const c=l.structure;if(c!=null&&c.tieFormat)c.tieFormat=Uw({tieFormat:c.tieFormat,orderMap:r}),pme({eventId:s==null?void 0:s.eventId,tournamentRecord:t,drawDefinition:e,structure:c,orderMap:r}),un({drawDefinition:e,structureIds:[c.structureId]});else if(e.tieFormat)IB({structureIds:[i],tournamentRecord:t,drawDefinition:e,orderMap:r,event:s});else{if(!(s!=null&&s.tieFormat))return{error:zo};d8({structureIds:[i],tournamentRecord:t,orderMap:r,event:s})}}else{if(!(e!=null&&e.tieFormat))return{error:zo};IB({tournamentRecord:t,drawDefinition:e,orderMap:r,event:s})}return{...le}}function d8({tournamentRecord:t,structureIds:e,orderMap:i,event:n}){const r=Uw({tieFormat:n.tieFormat,orderMap:i});e!=null&&e.length||(n.tieFormat=r);for(const o of n.drawDefinitions??[])IB({tournamentRecord:t,drawDefinition:o,structureIds:e,orderMap:i,event:n})}function IB({tournamentRecord:t,drawDefinition:e,structureIds:i,orderMap:n,event:r}){const o=Uw({tieFormat:e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n});i!=null&&i.length||(e.tieFormat=o);const a=[];for(const s of e.structures??[])i!=null&&i.length&&!i.includes(s.structureId)||((s.tieFormat||i!=null&&i.includes(s.structureId))&&(s.tieFormat=Uw({tieFormat:s.tieFormat??e.tieFormat??(r==null?void 0:r.tieFormat),orderMap:n})),pme({eventId:r==null?void 0:r.eventId,tournamentRecord:t,drawDefinition:e,structure:s,orderMap:n}),a.push(s.structureId));un({drawDefinition:e,structureIds:a})}function pme({tournamentRecord:t,drawDefinition:e,structure:i,orderMap:n,eventId:r}){var o;const a=(o=zi({matchUpFilters:{matchUpTypes:[gn]},structure:i}))==null?void 0:o.matchUps;for(const s of a)s.tieFormat&&(s.tieFormat=Uw({tieFormat:s.tieFormat,orderMap:n}),Ci({tournamentId:t==null?void 0:t.tournamentId,drawDefinition:e,eventId:r,matchUp:s}))}function Lq({updateInProgressMatchUps:t=!0,tieFormatComparison:e,tournamentRecord:i,drawDefinition:n,tieFormatName:r,collectionId:o,structureId:a,matchUpId:s,eventId:l,matchUp:c,event:u}){var d,p,h,f,m,g;const v="removeCollectionDefinition";let y=c?void 0:bm({drawDefinition:n,structureId:a,matchUpId:s,eventId:l,event:u});if(y!=null&&y.error)return ce({result:y,stack:v});const b=y==null?void 0:y.structure;c=c??(y==null?void 0:y.matchUp);const I=y==null?void 0:y.tieFormat,T=po(I);if(y=ds({tieFormat:T}),y.error)return ce({result:y,stack:v});const S=(d=T==null?void 0:T.collectionDefinitions)==null?void 0:d.find(_=>_.collectionId===o);if(!S)return ce({result:{error:zo,collectionId:o}});T.collectionDefinitions=T.collectionDefinitions.filter(_=>_.collectionId!==o),S.collectionGroupNumber&&(T.collectionDefinitions=T.collectionDefinitions.map(_=>{const{collectionGroupNumber:k,...O}=_;return O}),T.collectionGroups=T.collectionGroups.filter(({groupNumber:_})=>_!==S.collectionGroupNumber));const{aggregateValue:w,valueGoal:U}=hb(T);T.winCriteria=It({aggregateValue:w,valueGoal:U});const D=I==null?void 0:I.winCriteria.valueGoal,E=I==null?void 0:I.winCriteria.aggregateValue;(D&&D!==U||w&&!E)&&(r?T.tieFormatName=r:delete T.tieFormatName);let C=[];s&&c?C=[c]:a&&b?C=((p=zi({matchUpFilters:{matchUpTypes:[gn]},structure:b}))==null?void 0:p.matchUps)??[]:n?C=((h=Fa({matchUpFilters:{matchUpTypes:[gn]},drawDefinition:n}))==null?void 0:h.matchUps)??[]:u&&(C=((f=Qp({matchUpFilters:{matchUpTypes:[gn]},drawDefinition:n}))==null?void 0:f.matchUps)??[]);const M=(C||[]).filter(_=>{var k,O;const F=(k=_.tieMatchUps)==null?void 0:k.filter(V=>V.collectionId===o),B=F==null?void 0:F.some(lo),$=!(!e||!_.tieFormat)&&((O=Ap({descendant:_.tieFormat,ancestor:T}))==null?void 0:O.different);return t&&!B||!_.winningSide&&_.matchUpStatus!==fr&&(t||_.matchUpStatus!==Kc&&!lo(_)&&!$)});if(!M.length)return{error:BP};if(s&&c&&t){const _=(m=c.tieMatchUps)==null?void 0:m.filter(k=>k.collectionId===o);for(const k of _??[]){let O=vx({matchUpId:k.matchUpId,tieMatchUpId:c==null?void 0:c.matchUpId,winningSide:void 0,removeScore:!0,tournamentRecord:i,drawDefinition:n,event:u});if(O.error||(O=vn({drawDefinition:n,matchUpId:s}),O.error))return O;c=O==null?void 0:O.matchUp}}const N=[];for(const _ of M){for(const k of(_==null?void 0:_.sides)??[])k.lineUp=(k.lineUp??[]).map(O=>({participantId:O.participantId,collectionAssignments:((O==null?void 0:O.collectionAssignments)??[]).filter(F=>F.collectionId!==o)}));if(_.tieMatchUps=(_.tieMatchUps??[]).filter(k=>{const O=k.collectionId===o;return O&&N.push(k.matchUpId),!O}),_.tieFormat&&(_.tieFormat=po(T)),t){const k=Od({matchUpId:_.matchUpId,exitWhenNoValues:!0,tournamentRecord:i,drawDefinition:n,event:u});if(k.error)return k}Ci({tournamentId:i==null?void 0:i.tournamentId,eventId:u==null?void 0:u.eventId,drawDefinition:n,context:v,matchUp:_})}N.length&&Kp({tournamentId:i==null?void 0:i.tournamentId,matchUpIds:N,eventId:u==null?void 0:u.eventId,drawDefinition:n});const R=It(T);if(y=ds({tieFormat:R}),y.error)return ce({result:y,stack:v});if(l&&u)u.tieFormat=R;else if(s&&c)c.tieFormat=R;else if(b)b.tieFormat=R;else if(n)n.tieFormat=R;else if(!c||!n)return{error:rt};un({drawDefinition:n,eventId:u==null?void 0:u.eventId});const{appliedPolicies:A}=Gi({tournamentRecord:i});return(g=A==null?void 0:A.audit)!=null&&g[Jv]&&Ux({drawDefinition:n,auditData:It({drawId:n==null?void 0:n.drawId,action:v,collectionId:o,structureId:a,matchUpId:s,eventId:l})}),{tieFormat:R,deletedMatchUpIds:N,targetMatchUps:M,...le}}function hme({updateInProgressMatchUps:t=!0,tournamentRecord:e,groupDefinition:i,drawDefinition:n,collectionIds:r,tieFormatName:o,structureId:a,matchUpId:s,matchUp:l,eventId:c,event:u}){const d="addCollectionGroup";if(!Array.isArray(r))return ce({result:{error:bt},stack:d});let p=l?void 0:bm({drawDefinition:n,structureId:a,matchUpId:s,eventId:c,event:u});if(p!=null&&p.error)return ce({result:p,stack:d});const h=p==null?void 0:p.structure;l=l||(p==null?void 0:p.matchUp);const f=p==null?void 0:p.tieFormat,m=f==null?void 0:f.winCriteria.valueGoal,g=po(f);if(p=ds({tieFormat:g}),p.error)return ce({result:p,stack:d});for(const y of g.collectionDefinitions){const{collectionId:b,collectionGroupNumber:I}=y;if(I&&r.includes(b))return ce({info:"collectionIds cannot be part of other collectionGroups",result:{error:Re},stack:d})}const v=(g.collectionGroups||[]).reduce((y,b)=>b.groupNumber>y?b.groupNumber:y,0)+1;return i.groupNumber=v,g.collectionDefinitions=g.collectionDefinitions.map(y=>r.includes(y.collectionId)?{...y,collectionGroupNumber:v}:y),g.collectionGroups=[...g.collecitonGroups||[],i],cme({updateInProgressMatchUps:t,originalValueGoal:m,tournamentRecord:e,drawDefinition:n,tieFormatName:o,structureId:a,structure:h,tieFormat:g,matchUpId:s,matchUp:l,eventId:c,event:u})}function Fq({updateInProgressMatchUps:t=!0,collectionDefinition:e,referenceCategory:i,tournamentRecord:n,policyDefinitions:r,enforceCategory:o,referenceGender:a,drawDefinition:s,tieFormatName:l,enforceGender:c,structureId:u,matchUpId:d,matchUp:p,eventId:h,uuids:f,event:m}){var g,v,y;const b="addCollectionDefinition",I=Gi({tournamentRecord:n,drawDefinition:s,event:m}).appliedPolicies??{},T=(r==null?void 0:r[so])??(I==null?void 0:I[so]);o=o??((g=T==null?void 0:T.participants)==null?void 0:g.enforceCategory);const S=(c??((v=T==null?void 0:T.participants)==null?void 0:v.enforceGender))!==!1,w=!(!(i??(m==null?void 0:m.category))||o===!1),U=!(!(a??(m==null?void 0:m.gender))||!S),D=vC({referenceCategory:i??(m==null?void 0:m.category),collectionDefinition:e,referenceGender:a,checkCategory:w,checkGender:U,event:m});if(D.error)return ce({result:D,stack:b});let E=p!=null&&p.tieFormat?void 0:bm({drawDefinition:s,structureId:u,matchUpId:d,eventId:h,event:m});if(E!=null&&E.error)return ce({result:{error:E.error},stack:b});const C=E==null?void 0:E.structure;p=p??(E==null?void 0:E.matchUp);const M=(p==null?void 0:p.tieFormat)??(E==null?void 0:E.tieFormat),N=po(M);if(E=ds({tieFormat:N}),E==null?void 0:E.error)return ce({result:{error:E.error},stack:b});if(e.collectionId){if(N.collectionDefinitions.map(({collectionId:V})=>V).includes(e.collectionId))return ce({context:{collectionId:e.collectionId},result:{error:q_e}})}else e.collectionId=Hi();N.collectionDefinitions.push(e),N.collectionDefinitions.sort((V,H)=>(V.collectionOrder||0)-(H.collectionOrder||0)).forEach((V,H)=>V.collectionOrder=H+1);const{aggregateValue:R,valueGoal:A}=hb(N);N.winCriteria=It({aggregateValue:R,valueGoal:A});const _=M==null?void 0:M.winCriteria.valueGoal,k=M==null?void 0:M.winCriteria.aggregateValue;(_&&_!==A||R&&!k)&&(l?N.tieFormatName=l:delete N.tieFormatName);const O=[],F=[];let B=[];const $=It(N);if(E=ds({tieFormat:$}),E==null?void 0:E.error)return ce({result:{error:E.error},stack:b});if(h&&m){m.tieFormat=$;for(const V of m.drawDefinitions??[])if(!V.tieFormat)for(const H of V.structures??[]){if(H.tieFormat)continue;const z=vL({updateInProgressMatchUps:t,collectionDefinition:e,structure:H,uuids:f});F.push(...z.newMatchUps),B.push(...z.targetMatchUps),O.push(H.structureId)}A1({modifiedMatchUps:B,eventId:m==null?void 0:m.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else if(u&&C){C.tieFormat=$;const V=vL({updateInProgressMatchUps:t,collectionDefinition:e,structure:C,uuids:f});F.push(...V.newMatchUps),B=V.targetMatchUps,A1({modifiedMatchUps:B,eventId:m==null?void 0:m.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else if(d&&p){if(!ZR({matchUp:p,updateInProgressMatchUps:t}))return ce({result:{error:lce},stack:b});p.tieFormat=$;const V=fC({collectionDefinition:e,matchUp:p,uuids:f});Array.isArray(p.tieMatchUps)||(p.tieMatchUps=[]),p.tieMatchUps.push(...V),F.push(...V),A1({modifiedMatchUps:[p],eventId:m==null?void 0:m.eventId,modifiedStructureIds:O,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}else{if(!s)return{error:rt};s.tieFormat=$;for(const V of s.structures??[]){const H=vL({updateInProgressMatchUps:t,collectionDefinition:e,structure:V,uuids:f});O.push(V.structureId),F.push(...H.newMatchUps),B.push(...H.targetMatchUps)}A1({modifiedMatchUps:B,eventId:m==null?void 0:m.eventId,tournamentRecord:n,drawDefinition:s,addedMatchUps:F,stack:b})}return(y=I==null?void 0:I.audit)!=null&&y[Jv]&&Ux({drawDefinition:s,auditData:It({drawId:s==null?void 0:s.drawId,collectionDefinition:e,action:b,structureId:u,matchUpId:d,eventId:h})}),{tieFormat:$,targetMatchUps:B,addedMatchUps:F,...le}}function vL({updateInProgressMatchUps:t,collectionDefinition:e,structure:i,uuids:n}){var r;const o=[],a=(r=zi({matchUpFilters:{matchUpTypes:[gn]},structure:i}))==null?void 0:r.matchUps,s=a.filter(l=>ZR({matchUp:l,updateInProgressMatchUps:t})&&!l.tieFormat);for(const l of s){const c=fC({collectionDefinition:e,matchUp:l,uuids:n});Array.isArray(l.tieMatchUps)||(l.tieMatchUps=[]),l.tieMatchUps.push(...c),o.push(...c)}return{newMatchUps:o,targetMatchUps:s}}function A1({modifiedStructureIds:t,tournamentRecord:e,modifiedMatchUps:i,drawDefinition:n,addedMatchUps:r,eventId:o,stack:a}){rf({tournamentId:e==null?void 0:e.tournamentId,matchUps:r,drawDefinition:n,eventId:o}),i==null||i.forEach(s=>{Ci({tournamentId:e==null?void 0:e.tournamentId,drawDefinition:n,context:a,matchUp:s,eventId:o})}),un({structureIds:t,drawDefinition:n,eventId:o})}function fme({updateInProgressMatchUps:t=!1,tieFormatComparison:e,modifiedTieFormat:i,tournamentRecord:n,drawDefinition:r,structureId:o,matchUpId:a,eventId:s,uuids:l,event:c}){const u="modifyTieFormat";if(!ds({tieFormat:i}).valid)return ce({result:{error:Ph},info:"falied validation",stack:u});const d=bm({drawDefinition:r,structureId:o,matchUpId:a,eventId:s,event:c});if(d.error)return ce({result:d,stack:u});const{matchUp:p,tieFormat:h}=d,f=po(h),m=Ap({descendant:i,ancestor:f});if(m.invalid)return ce({context:{invalid:m.invalid},result:{error:Ph},stack:u});if(!(m!=null&&m.different))return ce({result:{...le},info:"Nothing to do",stack:u});const g=f.collectionDefinitions.map(({collectionId:U})=>U),v=i.collectionDefinitions.map(({collectionId:U})=>U),y=g.filter(U=>!v.includes(U)),b=i.collectionDefinitions.filter(({collectionId:U})=>!g.includes(U)),I=b.map(Ts("collectionId")),T=[];let S;const w=i.tieFormatName;for(const U of i.collectionDefinitions){if(I.includes(U.collectionId))continue;const D=Oq({updateInProgressMatchUps:t,...U,tournamentRecord:n,tieFormatName:w,drawDefinition:r,structureId:o,matchUpId:a,eventId:s,event:c});if(D.modifications&&T.push(...D.modifications),D.error)return ce({result:D,stack:u});D.tieFormat&&(S=D.tieFormat)}for(const U of b){const D=Fq({updateInProgressMatchUps:t,collectionDefinition:U,tournamentRecord:n,drawDefinition:r,tieFormatName:w,structureId:o,matchUpId:a,matchUp:p,eventId:s,uuids:l,event:c});if(D.error)return ce({result:D,stack:u});D.tieFormat&&(S=D.tieFormat)}for(const U of y){const D=Lq({updateInProgressMatchUps:t,tieFormatComparison:e,tournamentRecord:n,drawDefinition:r,tieFormatName:w,collectionId:U,structureId:o,matchUpId:a,eventId:s,matchUp:p,event:c});if(D.error)return ce({result:D,stack:u});D.tieFormat&&(S=D.tieFormat)}return(h==null?void 0:h.tieFormatName)!==w?(S.tieFormatName=w,T.push({tieFormatName:w})):(T.length||I.length||y.length)&&(delete S.tieFormatName,T.push("tieFormatName removed: modifications without new tieFormatName")),S.collectionDefinitions=S.collectionDefinitions.sort((U,D)=>aw(U.collectionOrder)-aw(D.collectionOrder)).map((U,D)=>({...U,collectionOrder:D+1})),{processedTieFormat:po(S),modifications:T,...le}}function mme({tournamentRecord:t}){if(!t)return{error:je};let e=0;for(const i of t.events??[]){const n=i.tieFormats??[],r=u=>{if(!u.tieFormat)return;let d;for(const p of n)Ap({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);if(d)u.tieFormatId=d,delete u.tieFormat;else{const p=ft(u.tieFormat,void 0,!0);p.tieFormatId||(p.tieFormatId=Hi()),u.tieFormatId=p.tieFormatId,delete u.tieFormat,n.push(p),e+=1}},o=i.eventType;r({tieFormat:i.tieFormat,eventType:o});for(const u of i.drawDefinitions??[]){r({tieFormat:u.tieFormat,eventType:o});for(const d of u.structures??[])r({tieFormat:d.tieFormat,eventType:o})}const a=(u,d)=>{var p;const h=(p=l.matchUps)==null?void 0:p.find(f=>f.matchUpId===u);h&&(h.tieFormatId=d,delete h.tieFormat,Ci({tournamentId:t==null?void 0:t.tournamentId,eventId:i.eventId,matchUp:h}))},s=u=>{const d=ft(u.tieFormat,void 0,!0);d.tieFormatId||(d.tieFormatId=Hi()),n.push(d),e+=1,a(u.matchUpId,d.tieFormatId)},l=Qp({matchUpFilters:{matchUpTypes:[Ad]},event:i}),c=l.matchUps??[];for(const u of c){let d;for(const p of n)u.tieFormat&&Ap({descendant:u.tieFormat,ancestor:p}).different||(d=p.tieFormatId);d?a(u.matchUpId,d):s(u)}n.length&&(i.tieFormats=n)}return{...le,addedCount:e}}var gFe=Object.freeze({__proto__:null,addCollectionDefinition:Fq,addCollectionGroup:hme,aggregateTieFormats:mme,modifyCollectionDefinition:Oq,modifyTieFormat:fme,orderCollectionDefinitions:dme,removeCollectionDefinition:Lq,removeCollectionGroup:ume}),vFe=Object.freeze({__proto__:null,addCollectionDefinition:Fq,addCollectionGroup:hme,aggregateTieFormats:mme,compareTieFormats:Ap,getTieFormat:O3,modifyCollectionDefinition:Oq,modifyTieFormat:fme,mutate:gFe,orderCollectionDefinitions:dme,query:mOe,removeCollectionDefinition:Lq,removeCollectionGroup:ume,tieFormatGenderValidityCheck:Bk,validateCollectionDefinition:vC});const yFe={ABANDONED:"ABANDONED",ACTIVE:"ACTIVE",CANCELLED:"CANCELLED",COMPLETED:"COMPLETED",IN_PROGRESS:"IN_PROGRESS"};function gme({tournamentRecord:t,status:e}){return t?e&&!Object.keys(yFe).includes(e)?{error:Re,info:"Unknown status"}:(t.tournamentStatus=e,{...le}):{error:je}}function vme({tournamentRecord:t,onlineResource:e,organisationId:i,participantId:n,personId:r,courtId:o,venueId:a}){var s,l,c;if(!t)return{error:je};if(!bn(e))return{error:bt};if(sr(Object.keys(e),["resourceSubType","resourceType","identifier"]).length!==3)return ce({result:{error:Af},context:{onlineResource:e}});if(i){if(((s=t.parentOrganisation)==null?void 0:s.parentOrganisationId)!==i)return ce({result:{error:zo}});t.parentOrganisation.onlineResources||(t.parentOrganisation.onlineResources=[]),t.parentOrganisation.onlineResources.push(e)}else if(n||r){const u=(t.participants??[]).find(d=>{var p;return r&&((p=d.person)==null?void 0:p.personId)===r||d.participantId===n});if(!u)return ce(r?{result:{error:zo}}:{result:{error:rr}});if(r){if(((l=u.person)==null?void 0:l.personId)!==r)return ce({result:{error:LP}});u.person.onlineResources||(u.person.onlineResources=[]),u.person.onlineResources.push(e)}else u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(o){const u=(c=(t.venues??[]).filter(d=>!a||d.venueId===a).flatMap(d=>(d.courts??[]).filter(p=>p.courtId===o)))==null?void 0:c[0];if(!u)return ce({result:{error:J_}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else if(a){const u=(t.venues??[]).find(d=>d.venueId===a);if(!u)return ce({result:{error:_0}});u.onlineResources||(u.onlineResources=[]),u.onlineResources.push(e)}else t.onlineResources||(t.onlineResources=[]),t.onlineResources.push(e);return{...le}}function yme({tournamentRecord:t,promotionalName:e,tournamentName:i,formalName:n}){return t?(i&&(t.tournamentName=i),e&&(t.promotionalName=e),n&&(t.formalName=n),t.promotionalName===t.tournamentName&&delete t.promotionalName,t.formalName===t.tournamentName&&delete t.formalName,{...le}):{error:je}}function bme({tournamentRecord:t,notes:e}){return t?Fk({element:t,notes:e}):{error:je}}function Ime({tournamentRecord:t,categories:e}){return t?(e=(e||[]).filter(i=>i.categoryName&&i.type),t.tournamentCategories=e,{...le}):{error:je}}function Dx({tournamentRecord:t,startDate:e,endDate:i}){var n;if(!t)return{error:je};if(e&&!Mu.test(e)||i&&!Mu.test(i))return{error:Ha};if(!e&&!i)return{error:sce};if(i&&e&&new Date(i)<new Date(e))return{error:Re};let r;(e&&t.startDate&&new Date(e)>new Date(t.startDate)||i&&t.endDate&&new Date(i)<new Date(t.endDate))&&(r=!0),e&&(t.startDate=e),i&&(t.endDate=i),e&&t.endDate&&new Date(e)>new Date(t.endDate)&&(t.endDate=e),i&&t.startDate&&new Date(i)<new Date(t.startDate)&&(t.startDate=i);const o=r&&((n=function({tournamentRecord:a}){const s=Vr({tournamentRecord:a}).matchUps??[],l=a.startDate&&new Date(a.startDate),c=a.endDate&&new Date(a.endDate),u=[],d=[];for(const p of s){const{schedule:h,matchUpId:f}=p;if(h&&h.scheduledDate){const m=new Date(h.scheduledDate);(l&&m<l||c&&m>c)&&(d.push(f),u.includes(h.scheduledDate)||u.push(h.scheduledDate))}}return u.length&&!Ix({scheduledDates:u,tournamentRecord:a}).clearedScheduleCount?{error:KAe}:{unscheduledMatchUpIds:d}}({tournamentRecord:t}))==null?void 0:n.unscheduledMatchUpIds);return function({tournamentRecord:a}){var s,l;if(!a)return{error:je};const{startDate:c,endDate:u}=a,d=ik(c,u),p=[];for(const h of a.venues||[])(s=h==null?void 0:h.courts)!=null&&s.length&&p.push(...h.courts);for(const h of p){const{startTime:f,endTime:m}=(h.dateAvailability??[]).reduce((y,b)=>{const I=gi(y.startTime),T=gi(y.endTime);return b.startTime&&gi(b.startTime)<I&&(y.startTime=b.startTime),b.endTime&&gi(b.endTime)>T&&(y.endTime=b.endTime),y},{startTime:"08:00",endTime:"18:00"}),g=d.map(y=>{var b;return((b=h.dateAvailability)==null?void 0:b.find(I=>I.date===y))??{date:y,startTime:f,endTime:m}}),v=(l=h.dateAvailability)==null?void 0:l.find(y=>!y.date);v&&g.unshift(v),h.dateAvailability=g}}({tournamentRecord:t}),bi({topic:Ake,payload:{startDate:e,endDate:i}}),{...le,unscheduledMatchUpIds:o}}function wme({tournamentRecord:t,startDate:e}){return Dx({tournamentRecord:t,startDate:e})}function Sme({tournamentRecord:t,endDate:e}){return Dx({tournamentRecord:t,endDate:e})}var bFe=Object.freeze({__proto__:null,addDrawDefinitionExtension:ak,addEventExtension:kf,addEventTimeItem:db,addExtension:Ii,addNotes:Fk,addOnlineResource:vme,addParticipantExtension:jce,addParticipantTimeItem:i3,addTimeItem:xf,addTournamentExtension:hW,addTournamentTimeItem:ub,removeDrawDefinitionExtension:Hce,removeEventExtension:sk,removeExtension:ia,removeNotes:jde,removeParticipantExtension:Gce,removeTournamentExtension:fW,setTournamentCategories:Ime,setTournamentDates:Dx,setTournamentEndDate:Sme,setTournamentName:yme,setTournamentNotes:bme,setTournamentStartDate:wme,setTournamentStatus:gme}),IFe=Object.freeze({__proto__:null,addDrawDefinitionExtension:ak,addEventExtension:kf,addEventTimeItem:db,addExtension:Ii,addNotes:Fk,addOnlineResource:vme,addParticipantExtension:jce,addParticipantTimeItem:i3,addTimeItem:xf,addTournamentExtension:hW,addTournamentTimeItem:ub,analyzeDraws:bC,analyzeTournament:k3,getAllowedDrawTypes:qk,getAllowedMatchUpFormats:N3,getAppliedPolicies:Gi,getCompetitionDateRange:Kk,getCompetitionPenalties:A3,getPolicyDefinitions:Zp,getTournamentInfo:pb,getTournamentPenalties:Yk,getTournamentPersons:_3,getTournamentStructures:e3,getTournamentTimeItem:rC,mutate:bFe,query:fOe,removeDrawDefinitionExtension:Hce,removeEventExtension:sk,removeExtension:ia,removeNotes:jde,removeParticipantExtension:Gce,removeTournamentExtension:fW,setTournamentCategories:Ime,setTournamentDates:Dx,setTournamentEndDate:Sme,setTournamentName:yme,setTournamentNotes:bme,setTournamentStartDate:wme,setTournamentStatus:gme}),wFe=Object.freeze({__proto__:null,generateCourts:vq});function Bq(t){if(!(t!=null&&t.tournamentRecord)&&!Array.isArray(t==null?void 0:t.venueMatchUps))return{error:je};if(!(t!=null&&t.courtId))return{error:N0};const{scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n,venueMatchUps:r,courtId:o}=t,{schedulingProfile:a}=th({tournamentRecord:i});if(Array.isArray(r))return{matchUps:l({matchUps:r,courtId:o})};const{matchUps:s}=Vr({scheduleVisibilityFilters:e,tournamentRecord:i,matchUpFilters:n});return{matchUps:l({matchUps:s,courtId:o})};function l({matchUps:c,courtId:u}){return $R({matchUps:c.filter(d=>{var p,h,f;const m=(h=(p=d.schedule)==null?void 0:p.allocatedCourts)==null?void 0:h.map(({courtId:g})=>g);return((f=d.schedule)==null?void 0:f.courtId)===u||(m==null?void 0:m.includes(u))}),schedulingProfile:a})}}function $q({tournamentRecord:t,dateAvailability:e,disableNotice:i,venueMatchUps:n,courtId:r,force:o}){var a,s,l;if(!t)return{error:je};if(!r)return{error:N0};const c=pfe({dateAvailability:e});if(c.error)return c;const{updatedDateAvailability:u,totalMergeCount:d}=function(g){let v=0;const y=g.reduce((I,T)=>{const{date:S,startTime:w,endTime:U,bookings:D}=T;return I[S]||(I[S]=[]),I[S].push({startTime:w,endTime:U,bookings:D}),I},{}),b=[];return Object.keys(y).forEach(I=>{y[I].sort(zLe);const{mergedAvailability:T,mergeCount:S}=function(w){let U,D,E,C=w.length,M=0;const N=[];for(;w.length&&C;){const A=w.shift(),{startTime:_,endTime:k,bookings:O}=A;if(C-=1,U)if($P(hr(D),hr(_),!1)>0){const F={startTime:U,endTime:D};E!=null&&E.length&&(F.bookings=E),N.push(F),U=_,E=O,D=k}else O&&(E?E.push(O):E=O),D=k,M+=1;else U=_,E=O,D=k}const R={startTime:U,endTime:D};return E!=null&&E.length&&(R.bookings=E),N.push(R),{mergedAvailability:N,mergeCount:M}}(y[I]);b.push(...T.map(w=>({date:I,...w}))),v+=S}),{updatedDateAvailability:b,totalMergeCount:v}}(e);e=u;const p=nb({tournamentRecord:t,courtId:r});if(p.error)return p;const{court:h,venue:f}=p,{matchUps:m}=Bq({tournamentRecord:t,venueMatchUps:n,courtId:r});if(m!=null&&m.length){const g=(a=Gi({tournamentRecord:t}))==null?void 0:a.appliedPolicies,v=o??((l=(s=g==null?void 0:g[wg])==null?void 0:s.allowDeletionWithScoresPresent)==null?void 0:l.courts),y=[];y.length&&(v||console.log("throw error: scheduled court matchUps",y.length))}return h&&(h.dateAvailability=e,!i&&f&&bi({payload:{venue:f,tournamentId:t.tournamentId},topic:Xy,key:f.venueId})),{...le,totalMergeCount:d}}function Vq({matchUpsCount:t=0}){return{error:J_e,info:`Schedule would be deleted from ${t} ${t===1?"matchUp":"matchUps"}; use { force: true }`}}function Tme({tournamentRecord:t,drawDefinition:e,matchUpId:i,drawId:n}){if(!i)return{error:co};if(!e&&!n)return{error:Yc};let r;if(!e){if(!t)return{error:je};({drawDefinition:e}=us({tournamentRecord:t,drawId:n}))}if(e)({matchUp:r}=vn({drawDefinition:e,matchUpId:i}));else{if(!t)return{error:je};const o=Vr({tournamentRecord:t,inContext:!1}).matchUps??[];({matchUp:r}=Vde({matchUps:o,matchUpId:i}))}return r?(r.timeItems&&r.timeItems.find(o=>[iy,sf].includes(o.itemType))&&(r.timeItems=r.timeItems.filter(({itemType:o})=>![iy,sf].includes(o)),Ci({tournamentId:t==null?void 0:t.tournamentId,context:"removeCourtAssignment",drawDefinition:e,matchUp:r})),{...le}):{error:xo}}function jq(t){var e,i,n;if(typeof(t==null?void 0:t.venueId)!="string")return{error:Fm};const{tournamentRecord:r,venueId:o,force:a}=t,s=t.tournamentRecords||r&&{[r.tournamentId]:r}||{};if(!Object.keys(s).length)return{error:je};const l=Vc({tournamentRecords:s,contextFilters:{venueIds:[o]}}).matchUps??[],c=(e=Gi({tournamentRecord:r}))==null?void 0:e.appliedPolicies,u=a??((n=(i=c==null?void 0:c[wg])==null?void 0:i.allowDeletionWithScoresPresent)==null?void 0:n.venues);if(l.length&&!u)return Vq({matchUpsCount:l.length});for(const d of Object.values(s)){for(const h of l){const f=Tme({matchUpId:h.matchUpId,drawId:h.drawId,tournamentRecord:d});if(f.error)return f}let p;d.venues=(d.venues??[]).filter(h=>(h==null?void 0:h.venueId)!==o||(p=!0,!1)),p&&bi({payload:{venueId:o,tournamentId:d.tournamentId},topic:uue,key:o})}return UC({tournamentRecords:s}),{...le}}function Ume({tournamentRecord:t,venueIds:e,force:i}){if(!t)return{error:je};if(!Array.isArray(e))return{error:Re};for(const n of t.venues||[]){const{venueId:r}=n;if(e.includes(r)){const{venueId:o}=n,a=jq({tournamentRecord:t,venueId:o,force:i});if(a.error)return a}}return{...le}}function Dme(t){const{courtIds:e,dates:i}=t,n=Vu(t),r=Ln(t,[{[Oo]:!0,[nk]:!0}]);if(r.error)return r;for(const o of Object.values(n))SFe({tournamentRecord:o,courtIds:e,dates:i});return{...le}}function SFe({tournamentRecord:t,courtIds:e,dates:i}){const n=!Array.isArray(i)||!i.length||{dates:i},r=o=>Ii({extension:{value:n,name:Rc},creationTime:!1,element:o});for(const o of t.venues||[])for(const a of o.courts||[])if(e!=null&&e.includes(a.courtId)){const s=r(a);if(s.error)return s}return{...le}}function Pme(t){const{tournamentRecords:e,tournamentId:i,venueIds:n}=t,r=Ln(t,[{[Oo]:!0,[rk]:!0}]);if(r.error)return r;const o=Object.keys(e).filter(a=>!i||a===i);for(const a of o)TFe({tournamentRecord:e[a],venueIds:n});return{...le}}function TFe({tournamentRecord:t,venueIds:e}){for(const i of t.venues||[])if(e!=null&&e.includes(i.venueId)){const n=Ii({creationTime:!1,element:i,extension:{name:Rc,value:!0}});if(n.error)return n}return{...le}}function Cme(t){const e=Vu(t),i=[{[Oo]:!0}];!t.enableAll&&i.push({[nk]:!0});const n=Ln(t,i);if(n.error)return n;const{enableAll:r,courtIds:o,dates:a}=t;for(const s of Object.values(e))UFe({tournamentRecord:s,courtIds:o,enableAll:r,dates:a});return{...le}}function UFe({tournamentRecord:t,courtIds:e,enableAll:i,dates:n}){for(const r of t.venues||[])for(const o of r.courts||[])if(i||e!=null&&e.includes(o.courtId))if(Array.isArray(n)){const{extension:a}=ei({element:o,name:Rc});if(a){const s=a.value;Array.isArray(s.dates)&&(s.dates=s.dates.filter(l=>!n.includes(l))),Ii({extension:{name:Rc,value:s},creationTime:!1,element:o})}}else ia({element:o,name:Rc});return{...le}}function Eme(t){const e=Vu(t),i=[{[Oo]:!0}];!t.enableAll&&i.push({[rk]:!0});const n=Ln(t,i);if(n.error)return n;const{venueIds:r,enableAll:o}=t;for(const a of Object.values(e))for(const s of a.venues||[])(o||r!=null&&r.includes(s.venueId))&&ia({element:s,name:Rc});return{...le}}function Mme(t){const{courtId:e,disableNotice:i,force:n}=t,r=Vu(t),o=Ln(t,[{[Oo]:!0,[Lce]:!0}]);if(o.error)return o;let a,s;for(const l of Object.values(r)){if(s=DFe({tournamentRecord:l,disableNotice:i,courtId:e,force:n}),s.error&&s.error!==J_)return s;s.success&&(a=!0)}return a?{...le}:s}function DFe({tournamentRecord:t,disableNotice:e,courtId:i,force:n}){var r,o,a;const s=nb({tournamentRecord:t,courtId:i});if(s.error)return s;const l=s.venue,{matchUps:c}=Bq({tournamentRecord:t,courtId:i}),u=(r=Gi({tournamentRecord:t}))==null?void 0:r.appliedPolicies,d=n??((a=(o=u==null?void 0:u[wg])==null?void 0:o.allowDeletionWithScoresPresent)==null?void 0:a.courts);if(c!=null&&c.length&&!d)return Vq({matchUpsCount:c.length});for(const p of c??[]){const h=Tme({matchUpId:p.matchUpId,drawId:p.drawId,tournamentRecord:t});if(h.error)return h}return l&&(l.courts=(l.courts??[]).filter(p=>p.courtId!==i),e||bi({payload:{venue:l,tournamentId:t.tournamentId},topic:Xy,key:l.venueId})),{...le}}function Hq(t){const{disableNotice:e,modifications:i,courtId:n,force:r,venueMatchUps:o}=t,a=Vu(t);if(!Object.keys(a).length)return{error:Wn};let s;for(const l of Object.values(a)){const c=PFe({tournamentRecord:l,disableNotice:e,venueMatchUps:o,modifications:i,courtId:n,force:r});if(c!=null&&c.error)return c;s=!0}return s?{...le}:void 0}function PFe({tournamentRecord:t,disableNotice:e,venueMatchUps:i,modifications:n,courtId:r,force:o}){if(!t)return{error:je};if(!r)return{error:N0};if(!n||typeof n!="object")return{error:Af};const a=nb({tournamentRecord:t,courtId:r});if(a.error)return a;const{venue:s,court:l}=a,c=Object.keys(dfe()).filter(p=>p!=="courtId");if(!Object.keys(n).filter(p=>c.includes(p)).length)return{error:Qz};const u=c.filter(p=>!["dateAvailability"].includes(p)),d=Object.keys(n).filter(p=>u.includes(p));if(l&&d.forEach(p=>Object.assign(l,{[p]:n[p]})),n.dateAvailability){const p=$q({dateAvailability:n.dateAvailability,tournamentRecord:t,venueMatchUps:i,disableNotice:e,courtId:r,force:o});if(p.error)return p}return e||bi({payload:{venue:s,tournamentId:t.tournamentId},topic:Xy,key:s==null?void 0:s.venueId}),{...le,court:ft(l)}}const CFe=()=>({venueId:void 0,venueName:"",venueAbbreviation:"",onlineResources:[],venueType:void 0,addresses:[],contacts:[],courts:[],roles:[]});function Rme(t){const{modifications:e,venueId:i,force:n}=t,r=Vu(t);if(!Object.keys(r).length)return{error:Wn};if(typeof i!="string")return{error:Fm};let o,a;for(const s of Object.values(r)){const l=EFe({tournamentRecord:s,modifications:e,venueId:i,force:n});if(l.success&&(a=!0),l.error&&(o=l.error),l.error&&l.error!==_0)return l}return UC({tournamentRecords:r}),a?{...le}:{error:o}}function EFe({tournamentRecord:t,modifications:e,venueId:i,force:n}){var r,o,a,s,l,c,u;if(!t)return{error:je};if(!e||typeof e!="object")return{error:Af};if(!i)return{error:Fm};const d=(r=Gi({tournamentRecord:t}))==null?void 0:r.appliedPolicies,p=n??((a=(o=d==null?void 0:d[wg])==null?void 0:o.allowDeletionWithScoresPresent)==null?void 0:a.venues),{matchUps:h}=function({scheduleVisibilityFilters:w,tournamentRecord:U,matchUpFilters:D,venueId:E}){if(!U)return{error:je};if(!E)return{error:Fm};const{schedulingProfile:C}=th({tournamentRecord:U}),{matchUps:M}=Vr({scheduleVisibilityFilters:w,tournamentRecord:U,matchUpFilters:D});return{matchUps:function({matchUps:N,venueId:R}){return $R({matchUps:N.filter(A=>{var _,k,O;const F=(k=(_=A.schedule)==null?void 0:_.allocatedCourts)==null?void 0:k.map(({venueId:B})=>B);return((O=A.schedule)==null?void 0:O.venueId)===R||(F==null?void 0:F.includes(R))}),schedulingProfile:C})}({matchUps:M,venueId:E})}}({tournamentRecord:t,venueId:i}),f=Jp({tournamentRecord:t,venueId:i});if(f.error)return f;const m=f.venue,g=Object.keys(CFe()).filter(w=>w!=="venueId");if(!Object.keys(e).filter(w=>g.includes(w)).length)return{error:Qz};const v=g.filter(w=>!["courts","onlineResources"].includes(w)),y=Object.keys(e).filter(w=>v.includes(w));m&&y.forEach(w=>Object.assign(m,{[w]:e[w]}));const b=((s=m==null?void 0:m.courts)==null?void 0:s.map(w=>w.courtId))??[],I=((l=e.courts)==null?void 0:l.map(w=>w.courtId))||[],T=I.length&&b.filter(w=>!I.includes(w)),S=[];if(T.length){const w=(c=m==null?void 0:m.courts)==null?void 0:c.filter(D=>T.includes(D.courtId)),U=w==null?void 0:w.map(D=>{var E;const C=Bq({courtId:D.courtId,tournamentRecord:t,venueMatchUps:h});for(const M of C.matchUps??[])S.push({matchUpId:M.matchUpId,drawId:M.drawId});return((E=C.matchUps)==null?void 0:E.length)??0}).reduce((D,E)=>D+E);if(!m||U&&!p)return Vq({matchUpsCount:U});m.courts=(u=m.courts)==null?void 0:u.filter(D=>I.includes(D.courtId)),LU({schedule:{courtId:"",scheduledDate:""},matchUpDetails:S,removePriorValues:!0,tournamentRecord:t})}if(e.courts)for(const w of e.courts){const{courtId:U}=w||{};let D=Hq({modifications:w,disableNotice:!0,tournamentRecord:t,venueMatchUps:h,courtId:U,force:n});if(D.error===J_&&(D=Sx({disableNotice:!0,tournamentRecord:t,venueId:i,court:w})),D.error)return D}return UC({tournamentRecord:t}),m&&bi({payload:{venue:m,tournamentId:t.tournamentId},topic:Xy,key:m==null?void 0:m.venueId}),{...le,venue:ft(m)}}var MFe=Object.freeze({__proto__:null,addCourt:Sx,addCourts:Nq,addVenue:tC,deleteCourt:Mme,deleteVenue:jq,deleteVenues:Ume,disableCourts:Dme,disableVenues:Pme,enableCourts:Cme,enableVenues:Eme,modifyCourt:Hq,modifyCourtAvailability:$q,modifyVenue:Rme}),RFe=Object.freeze({__proto__:null,addCourt:Sx,addCourts:Nq,addVenue:tC,deleteCourt:Mme,deleteVenue:jq,deleteVenues:Ume,disableCourts:Dme,disableVenues:Pme,enableCourts:Cme,enableVenues:Eme,generate:wFe,generateCourts:vq,getCompetitionVenues:TC,getCourts:J3,getVenuesAndCourts:eh,modifyCourt:Hq,modifyCourtAvailability:$q,modifyVenue:Rme,mutate:MFe,publicFindVenue:_W,query:wOe}),NFe=Object.freeze({__proto__:null,competitionGovernor:Ike,drawsGovernor:mLe,entriesGovernor:vLe,eventGovernor:SLe,generationGovernor:CLe,matchUpFormatGovernor:ELe,matchUpGovernor:xLe,mocksGovernor:Cfe,participantGovernor:oFe,policyGovernor:AOe,publishingGovernor:uFe,queryGovernor:TOe,reportGovernor:pFe,scheduleGovernor:mFe,scoreGovernor:Xpe,tieFormatGovernor:vFe,tournamentGovernor:IFe,venueGovernor:RFe});function Px(t){const{mutationStatus:e,tournamentId:i,directives:n,timeStamp:r}=t||{},{topics:o}=Bu();for(const a of[...o].sort(AFe)){const s=nke({topic:a});s&&E7({topic:a,notices:s})}e&&r&&o.includes(k7)&&E7({notices:[{tournamentId:i,directives:n,timeStamp:r}],topic:k7})}const p8={[yue]:5,[vue]:5,[bue]:5,[gue]:5,[mue]:5,[hue]:5,[Rke]:5,[Nke]:5,[fue]:1,[H2]:1,[Lo]:5,[Xy]:5,[pue]:4,[cue]:4,[uue]:4,[due]:4,[DW]:3,[aue]:2};function AFe(t,e){return(p8[e]||0)-(p8[t]||0)}const{FACTORY:h8}=vke;function Nme({timeStamp:t}){const e=sw(),i=Dce();return i&&Object.values(e).forEach(n=>{(function({tournamentRecord:r,value:o}){const{extension:a}=ei({element:r,name:h8});Ii({element:r,extension:{name:h8,value:{...a==null?void 0:a.value,...o}}})})({tournamentRecord:n,value:{version:"2.0.7",timeStamp:t}})}),i}function Ame({engineType:t,methodName:e,elapsed:i,params:n,result:r}){var o,a;const s=Wl();if(typeof s!="object")return;const l={method:e},c=(r==null?void 0:r.error)&&(s.errors===!0||Array.isArray(s.errors)&&s.errors.includes(e)),u=Array.isArray(s.params)&&((o=s.params)==null?void 0:o.includes(e)),d=s.params&&!Array.isArray(s.params)||u,p=Array.isArray(s.exclude)&&s.exclude.includes(e);!p&&![void 0,!1].includes(s.perf)&&!isNaN(s.perf)&&i>=s.perf&&(l.elapsed=i),p||!c&&!d||(l.params=n),!p&&(c||s.result&&!Array.isArray(s.result)&&(!Array.isArray(s.params)||u)||Array.isArray(s.result)&&(a=s.result)!=null&&a.includes(e))&&(l.result=r),Object.keys(l).length>1&&ake(l,t)}function Gq({methodName:t,params:e,start:i}){const n={error:tW,methodName:t};return Ame({result:n,methodName:t,elapsed:i?Date.now()-i:0,params:e,engineType:"sync"}),n}function zq(t,e,i,n,r){delete t.success,delete t.error;const o=Date.now(),a=bI();i&&(i.activeTournamentId=a);const s=(i==null?void 0:i.tournamentRecord)||Cce(a),l=typeof(i==null?void 0:i.tournamentRecord)=="object"&&{[i==null?void 0:i.tournamentRecord.tournamentId]:i.tournamentRecord}||sw(),c=i?ft(i,void 0,!0):void 0,u=i?function(p,h){var f;if(h._middleware===!1)return h;if(h.tournamentId&&!p[h.tournamentId])return{error:je};const m=h.drawId||((f=h.matchUp)==null?void 0:f.drawId);if(m){const{event:y,drawDefinition:b,tournamentId:I}=us({tournamentRecords:p,drawId:m});b&&(h.drawDefinition=b),I&&(h.tournamentId=I),y&&(h.event=y)}if(h.eventId&&!h.event){const{event:y,tournamentId:b}=us({eventId:h.eventId,tournamentRecords:p});if(!y)return{error:sl};h.tournamentId=b,h.event=y}const g=h.tournamentId??bI();if(!g&&h)return h;const v=p[g];return g&&!v?{error:je}:(v&&(h.tournamentRecord=v),h)}(l,i):void 0;if(u!=null&&u.error)return u;const d=function({tournamentRecords:p,tournamentRecord:h,params:f,methodName:m,method:g}){if(Wl())return g({tournamentRecords:p,tournamentRecord:h,...f});try{return g({tournamentRecords:p,tournamentRecord:h,...f})}catch(v){return nW({engineName:"engine",methodName:m,params:f,err:v})}}({params:u,tournamentRecords:l,tournamentRecord:s,methodName:n,method:e});return Ame({result:d,methodName:n,elapsed:Date.now()-o,params:c,engineType:r}),d}function f8(t,e=!0){return typeof t!="object"||Array.isArray(t)?{error:Af}:t!=null&&t.tournamentId?rke(e?ft(t):t):{error:Re}}function Cx(t,e=!0){if(typeof t!="object")return{error:Af};if(dR(),Array.isArray(t)){if(t.filter(i=>i==null?void 0:i.tournamentId).length!==t.length)return{error:I7};t=Object.assign({},...t.map(i=>({[i.tournamentId]:i})))}else if(t!=null&&t.tournamentId)dR((t={[t.tournamentId]:t}).tournamentId);else if(!Object.keys(t).every(i=>t[i].tournamentId===i))return{error:I7};return F2(e?ft(t):t)}function Lb(t,e){return e!=null&&e.error?(t.error=e.error,t.success=!1):(t.error=void 0,t.success=!0),t}function _me(t,e){t.importMethods=(i,n,r)=>function(o,a,s,l,c){if(!bn(s))return{error:Re};const u=Array.isArray(l)?l:[],d={},p=(h,f=0)=>{Object.keys(h).forEach(m=>{$m(h[m])?d[m]=h[m]:bn(h[m])&&(l===!0||u!=null&&u.includes(m))&&(c===void 0||f<c)&&p(h[m],f+1)})};return p(s),tke(d),Object.keys(d).filter(h=>$m(d[h])).forEach(h=>{o[h]=f=>{const m=()=>a(o,{[h]:d[h],...f});if(Wl())return m();try{return m()}catch(g){nW({engineName:"engine",methodName:h,params:f,err:g})}}}),{...le,...o}}(t,e,i,n,r),t.getTournament=i=>function(n){const{convertExtensions:r=!1,removeExtensions:o=!1}=n??{},a=(n==null?void 0:n.tournamentId)??bI();return typeof a!="string"?{}:{tournamentRecord:ft(Cce(a),r,!1,o)}}(i),t.getState=i=>function({convertExtensions:n,removeExtensions:r}){const o=sw();return{tournamentId:bI(),tournamentRecords:ft(o,n,!1,r)}}({convertExtensions:i==null?void 0:i.convertExtensions,removeExtensions:i==null?void 0:i.removeExtensions}),t.version=()=>"2.0.7",t.reset=()=>(F2({}),Lb(t)),t.devContext=i=>(cR(i),Lb(t)),t.getDevContext=i=>Wl(i),t.newTournamentRecord=(i={})=>{const n=nfe(i),r=n.tournamentId;return n.error?n:(f8(n),dR(r),{...le,tournamentId:r})},t.setState=(i,n,r)=>{uR(n,r);const o=Cx(i,n);return Lb(t,o)},t.setTournamentId=i=>dR(i),t.getTournamentId=()=>bI(),t.setTournamentRecord=(i,n,r)=>{uR(n,r);const o=f8(i,n);return Lb(t,o)},t.removeTournamentRecord=i=>{const n=oke(i);return Lb(t,n)},t.removeUnlinkedTournamentRecords=()=>{const i=function(){var n;const r=sw(),{extension:o}=ei({name:Zv,tournamentRecords:r,discover:!0}),a=((n=o==null?void 0:o.value)==null?void 0:n.tournamentIds)||[];return Object.keys(r).forEach(s=>{a.includes(s)||delete r[s]}),F2(r)}();return Lb(t,i)}}function m8(t,e){if(!bn(e))return{error:Re,message:"args must be an object"};const i=Object.values(e).filter($m).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};const n=i?Object.keys(e).find(h=>$m(e[h])):La(e.method)&&e.method;if(!n)return{error:tW};const{[n]:r,...o}=e,a=(e==null?void 0:e.params)||{...o},s=a.rollbackOnError&&ft(sw(),!1,!0),l=r||t[n]||iW()[n];if(!l)return Gq({methodName:n,params:a});const c=zq(t,l,a,n,"sync")??{};c!=null&&c.error&&s&&Cx(s);const u=Date.now(),d=Nme({timeStamp:u}),p=(c==null?void 0:c.success)&&(a==null?void 0:a.delayNotify)!==!0&&(a==null?void 0:a.doNotNotify)!==!0;return p&&Px({directives:[{method:l,params:a}],mutationStatus:d,timeStamp:u}),(p||!(c!=null&&c.success)||a!=null&&a.doNotNotify)&&tk(),c}const Wq=(()=>{const t={executionQueue:(e,i)=>function(n,r,o){if(!Array.isArray(r))return{error:Re,message:"directives must be an array"};const a=ike(),s=Date.now(),l=o&&ft(sw(),!1,!0),c=[];for(const d of r){if(typeof d!="object")return{error:Re,message:"directive must be an object"};const{method:p,params:h={},pipe:f}=d;if(!a[p])return Gq({methodName:p,start:s,params:h});if(f){const g=c[c.length-1],v=Object.keys(f);for(const y of v)g[y]&&(h[y]=g[y])}const m=zq(n,a[p],h,p,"sync");if(m!=null&&m.error)return l&&Cx(l),{...m,rolledBack:!!l};c.push({...m,methodName:p})}const u=Date.now();return Px({directives:r,mutationStatus:Nme({timeStamp:u}),timeStamp:u}),tk(),{success:c.every(d=>d.success),results:c}}(t,e,i),execute:e=>m8(t,e)};return _me(t,m8),t})();function g8(t,e){if(!bn(e))return{error:Re,message:"args must be an object"};const i=Object.values(e).filter($m).length;if(i>1)return{message:"there must be only one arg with typeof function",error:Re};const n=i?Object.keys(e).find(l=>$m(e[l])):La(e.method)&&e.method;if(!n)return{error:tW};const{[n]:r,...o}=e,a=(e==null?void 0:e.params)||{...o},s=r||t[n]||iW()[n];return s?zq(t,s,a,n,"ask"):Gq({methodName:n,params:a})}(()=>{const t={execute:e=>g8(t,e)};return _me(t,g8),t})();let Uh,nv={};function v8(t,e=!0){if(!t)return{error:bt};if(typeof t!="object")return{error:Af};if(t.matchUpId)Uh=t.matchUpId,nv[Uh]=e?ft(t):t;else if(Array.isArray(t))for(const i of t.reverse())i.matchUpId&&(nv[i.matchUpId]=e?ft(i):i,Uh||(Uh=i.matchUpId));else for(const i of Object.values(t))i.matchUpId&&(nv[i.matchUpId]=e?ft(i):i,Uh||(Uh=i.matchUpId));return e?ft(t):t}(()=>{const t={getState:i=>function(n){return ft(nv[Uh],n==null?void 0:n.convertExtensions,!1,n==null?void 0:n.removeExtensions)}(i),version:()=>"2.0.7",reset:()=>(Uh=void 0,nv={},{...le}),drawId:void 0,error:void 0,success:!1,devContext:i=>(cR(i),t),setState:(i,n,r)=>(uR(n,r),function(o){return o!=null&&o.error?(t.error=o.error,t.success=!1):(t.error=void 0,t.success=!0,t.drawId=o.drawId),t}(v8(i)))};return function(i){i.forEach(n=>{Object.keys(n).forEach(r=>{t[r]=o=>{if(Wl())return e({params:o,governor:n,methodName:r});try{return e({params:o,governor:n,methodName:r})}catch(a){nW({engineName:"matchUpEngine",methodName:r,params:o,err:a})}}})})}([Xpe]),t;function e({params:i,governor:n,methodName:r}){t.error=void 0,t.success=!1;const o=(i==null?void 0:i.matchUp)||nv[Uh],a=(i==null?void 0:i.matchUps)||Object.values(nv),s=(i==null?void 0:i.rollbackOnError)&&ft(o,!1,!0);i={...i,matchUpId:o==null?void 0:o.matchUpId,matchUps:a,matchUp:o};const l=n[r](i);if(l!=null&&l.error)return s&&v8(s),{...l,rolledBack:!!s};const c=(l==null?void 0:l.success)&&(i==null?void 0:i.delayNotify)!==!0&&(i==null?void 0:i.doNotNotify)!==!0;return c&&Px(),(c||!(l!=null&&l.success)||i!=null&&i.doNotNotify)&&tk(),l}})();let yL=!1;(()=>{const t={version:()=>"2.0.7",setDeepCopy:(e,i)=>(uR(e,i),t),devContext:e=>(cR(e),yL=!0,t)};return function(e){e.forEach(i=>{Object.keys(i).forEach(n=>{t[n]=r=>{try{const o=function(a,s){const l=a({...s});return l!=null&&l.error||Px(),tk(),yL&&(cR(!1),yL=!1),l}(i[n],r);return!(o!=null&&o.error)&&r!=null&&r.setState&&o!=null&&o.tournamentRecord&&Cx(o.tournamentRecord),o}catch(o){let a;typeof o=="string"?a=o.toUpperCase():o instanceof Error&&(a=o.message),console.log("ERROR",{params:JSON.stringify(r),method:n,error:a})}}})})}([Cfe]),t})();Wq.importMethods(NFe,!0,1);const kme=Wq;function xme(t,e){return t&&e&&Array.isArray(e)&&e[t-1]||typeof e=="object"&&e[t]}function _Fe(t){const{participation:e={},awardProfiles:i,startDate:n,eventType:r,drawSize:o,drawType:a,category:s,endDate:l,level:c}=t,{participationOrder:u,flightNumber:d,rankingStage:p}=e;return{awardProfile:i.find(h=>{var f,m,g,v,y,b,I,T,S,w;return(U=>!n&&!l||!U.dateRanges||U.dateRanges.some(D=>{const E=!n||!D.startDate||new Date(n)>new Date(D.startDate),C=!l||!D.endDate||new Date(l)<=new Date(D.endDate);return E&&C}))(h)&&(!h.maxFlightNumber||d<=h.maxFlightNumber)&&(!((f=h.drawTypes)!=null&&f.length)||((m=h.drawTypes)==null?void 0:m.includes(a)))&&(!((g=h.drawSizes)!=null&&g.length)||h.drawSizes.includes(o))&&(!((v=h.stages)!=null&&v.length)||h.stages.includes(p))&&(!((y=h.levels)!=null&&y.length)||h.levels.includes(c))&&(!h.maxDrawSize||o<=h.maxDrawSize)&&(!h.drawSize||h.drawSize===o)&&(!h.maxLevel||c<=h.maxLevel)&&(!d||!((I=(b=h.flights)==null?void 0:b.flightNumbers)!=null&&I.length)||h.flights.flightNumbers.includes(d))&&(!h.participationOrder||h.participationOrder===u)&&(!((T=h.category)!=null&&T.ageCategoryCodes)||h.category.ageCategoryCodes.includes(s==null?void 0:s.ageCategoryCode))&&(!((S=h.eventTypes)!=null&&S.length)||((w=h.eventTypes)==null?void 0:w.includes(r)))})}}function y8({participantWon:t,flightNumber:e,valueObj:i,drawSize:n,flights:r,level:o}){var a,s;const l=(m,g)=>{const v=(m==null?void 0:m.value)||(m==null?void 0:m.v)||($t(m)?m:0),y=xme(o,m==null?void 0:m.level);return{value:((b,I)=>{if(b){if(Array.isArray(I)){const T=I.find(S=>S.flight===b||S.f===b);return T.value||T.v}if(typeof I=="object"){const T=I.flights||I.f;if(Array.isArray(T))return T[b-1]}}})(g,y)||$t(y)&&y||v}};let c,u,d,p,h=0;const f=(t?"won":t===!1&&"lost")||void 0;if(Array.isArray(i)){let m=i.find(y=>{var b;return y.drawSize===n||((b=y.drawSizes)==null?void 0:b.includes(n))}),g=i.find(y=>y.drawSize&&y.threshold&&n>y.drawSize),v=i.find(y=>{var b;return!y.drawSize&&!((b=y.drawSizes)!=null&&b.length)});f!==void 0&&(m=m==null?void 0:m[f],g=g==null?void 0:g[f],v=v==null?void 0:v[f]),u=l(m,e).value,d=l(g,e).value,p=l(v,e).value,h=u||d||p,c=u&&m.requireWin||d&&g.requireWin||(v==null?void 0:v.requireWin)}else if(typeof i=="object"){let m=(a=i==null?void 0:i.drawSizes)==null?void 0:a[n],g=i;f!==void 0&&(m=m==null?void 0:m[f],g=g==null?void 0:g[f]),u=l(m,e).value,p=l(g,e).value,h=u||p,c=u?m.requireWin:g==null?void 0:g.requireWin}else $t(i)&&f===void 0&&(h=i);return e&&(s=r==null?void 0:r.pct)!=null&&s[e]&&(h=Math.round(h*r.pct[e])),{awardPoints:h,requireWin:c}}const kFe={getTournamentPoints:function({participantFilters:t,policyDefinitions:e,tournamentRecord:i,saveRankings:n,level:r}){var o;if(!i)return{error:je};const{policyDefinitions:a}=Zp({policyTypes:[KO],tournamentRecord:i}),s=(e==null?void 0:e[KO])??(a==null?void 0:a[KO]);if(!s)return{error:Kz};const l=s.awardProfiles;let c=s.requireWinFirstRound;const u=s.requireWinForPoints,{participants:d,derivedEventInfo:p,derivedDrawInfo:h,mappedMatchUps:f}=Qn({withRankingProfile:!0,participantFilters:t,tournamentRecord:i}),m=d==null?void 0:d.filter(b=>{var I;return(I=b.draws)==null?void 0:I.length}),g={},v={},y={};for(const b of m??[]){const{participantType:I,participantId:T,person:S,draws:w}=b;for(const U of w){const{drawId:D,structureParticipation:E,eventId:C}=U,M=p[C],N=h[D],R=N==null?void 0:N.drawType,{category:A,eventType:_}=M||{},k=U.startDate||M.startDate||i.startDate,O=U.endDate||M.endDate||i.endDate;if(_===$c&&T!==il)continue;let F;if(l){let B,$=u,V=0,H=0,z=0;for(const G of E){const{finishingPositionRange:W,participationOrder:K,participantWon:Z,flightNumber:Y,rankingStage:X,winCount:Q}=G;V+=Q||0;const te=N==null?void 0:N.drawSize,{awardProfile:J}=_Fe({awardProfiles:l,participation:G,eventType:_,startDate:k,category:A,drawSize:te,drawType:R,endDate:O,level:r});if(J){if(!te)continue;const ie=Array.isArray(W)&&Math.max(...W),oe=ti(W||[]).join("-"),ne=ie&&X!==St&&(W==null?void 0:W.includes(te));J.requireWinForPoints!==void 0&&($=J.requireWinForPoints),J.requireWinFirstRound!==void 0&&(c=J.requireWinFirstRound);const{finishingPositionPoints:re={},finishingPositionRanges:me,finishingRound:he,pointsPerWin:be,flights:Se}=J,De=Array.isArray(J.perWinPoints)?(o=J.perWinPoints)==null?void 0:o.find(Ae=>{var ve;return(ve=Ae.participationOrders)==null?void 0:ve.includes(K)}):J.perWinPoints,Oe=re.participationOrders;let xe,$e=0;if((!Oe||Oe.includes(K))&&me&&ie){const Ae=me[ie];Ae&&({awardPoints:$e,requireWin:xe}=y8({flightNumber:Y,valueObj:Ae,drawSize:te,flights:Se,level:r}))}if(!$e&&he&&K===1&&ie){const Ae=he[ie];Ae&&({awardPoints:$e,requireWin:xe}=y8({participantWon:Z,flightNumber:Y,valueObj:Ae,drawSize:te,flights:Se,level:r}))}if(ne&&c!==void 0&&($=c),xe!==void 0&&($=xe),$e>H&&(!$||Q)&&(H=$e,B=ie),!$e&&be&&Q&&(z+=Q*be,B=oe),!$e&&Q&&De){const Ae=xme(r,De==null?void 0:De.level);Ae?z+=Q*Ae:De.value&&(z+=Q*De.value)}}if(F=H+z,I===il){const ie=(b.matchUps||[]).filter(({structureId:oe})=>oe===G.structureId);for(const{matchUpId:oe}of ie){const ne=f[oe],re=ne.sides.find(me=>me.participantId===T).sideNumber;if(ne.winningSice===re)for(const me of ne.tieMatchUps)me.winningSide}}}if(z||H){const G={winCount:V,positionPoints:H,rangeAccessor:B,perWinPoints:z,eventType:_,drawId:D,points:F},W=S==null?void 0:S.personId;W?(g[W]||(g[W]=[]),g[W].push(G)):I===qt?(y[T]||(y[T]=[]),y[T].push(G)):I===il&&(v[T]||(v[T]=[]),v[T].push(G))}}}}return n&&Ii({element:i,extension:{name:Wce,value:{personPoints:g,teamPoints:v,pairPoints:y}}}),{participantsWithOutcomes:m,personPoints:g,pairPoints:y,teamPoints:v,...le}}},eI={nSpread:400,diffThreshold:.125,kCalc:t=>250/Math.pow(t+5,.4),kMultiplier:function(t=3,e=2){const i=t/e;return isNaN(i)?eI.kDefault():i},kDefault:()=>1};function b8(t){let{winnerRating:e,loserRating:i,ratingRange:n}=t;const{ratings:r=Gs,winnerCountables:o=1,loserCountables:a=0,ratingType:s=Yg,maxCountables:l,countables:c}=t||{},u=r==null?void 0:r[s];if(!u)return{error:bt};n=u.range||n,e=e||u.defaultInitialization,i=i||u.defaultInitialization;const d=n[0]>n[1],p=u.decimalsCount||0,h=d?n.slice().reverse():n,f=(k,O)=>parseFloat(O)>=Math.min(...k)&&parseFloat(O)<=Math.max(...k);f(n,e)&&f(n,i)||(f(n,e)||(e=u.defaultInitialization),f(n,i)||(i=u.defaultInitialization));const m=({value:k,sourceRange:O,targetRange:F})=>(k-O[0])*(F[1]-F[0])/(O[1]-O[0])+F[0],g=m({targetRange:Gs[Yg].range,sourceRange:h,value:d?n[0]-e:e}),v=m({targetRange:Gs[Yg].range,sourceRange:h,value:d?n[0]-i:i}),y=(k,O)=>1/(1+Math.pow(10,(O-k)/eI.nSpread)),b=y(g,v),I=y(v,g),T=eI.kCalc(o),S=eI.kCalc(a),w=eI.kMultiplier(l,c),U=g+w*T*(1-b),D=v+w*S*(0-I),E=m({sourceRange:Gs[Yg].range,value:U,targetRange:h}),C=m({sourceRange:Gs[Yg].range,value:D,targetRange:h}),M=d?n[0]-E:E;let N=parseFloat(parseFloat(M).toFixed(p));const R=d?n[0]-C:C;let A=parseFloat(parseFloat(R).toFixed(p));const _=Math.max(...n)?Math.abs(e-i)/Math.max(...n):0;return(E>C&&_>eI.diffThreshold||N<0||A<0)&&(N=e,A=i),{newWinnerRating:N,newLoserRating:A}}const xFe={calculateNewRatings:b8,generateDynamicRatings:function({removePriorValues:t=!0,tournamentRecord:e,ratingType:i=Yg,considerGames:n,matchUpIds:r,asDynamic:o}){var a,s;if(!e)return{error:je};if(!Array.isArray(r))return{error:Nf};if(typeof i!="string")return{error:Re,ratingType:i};if(!Gs[i])return{error:Re};const l=Gs[i],{accessor:c}=l,u={},d=Vr({matchUpFilters:{matchUpIds:r,matchUpStatuses:no},tournamentRecord:e,inContext:!0}).matchUps??[];d.sort(ob);for(const f of d){const{endDate:m,matchUpFormat:g,score:v,sides:y,winningSide:b}=f,I=f.matchUpType,T={eventType:I,scaleName:i,scaleType:Tv},S=`${i}.${$ce}`,w={scaleName:S,eventType:I,scaleType:Tv},U=Object.assign({},...(y??[]).map(k=>{const{sideNumber:O,participant:F}=k;return O&&{[O]:[F==null?void 0:F.participantId,...(F==null?void 0:F.individualParticipantIds)??[]].filter(Boolean).flat()}})),D=o?S:i,E=Object.assign({},...Object.values(U).flat().map(k=>{const{scaleItem:O}=yw({scaleAttributes:w,tournamentRecord:e,participantId:k}),{scaleItem:F}=yw({tournamentRecord:e,scaleAttributes:T,participantId:k});return k&&{[k]:O??F??{scaleName:D,eventType:I,scaleDate:m,scaleType:Tv,scaleValue:c?{[c]:void 0}:void 0}}})),C=g?Ga(g):{},M=(C==null?void 0:C.bestOf)||1,N=n?M&((C==null?void 0:C.setsTo)||1):M,R=(v==null?void 0:v.sets)&&(p=v.sets,(p==null?void 0:p.reduce((k,O)=>(O.winningSide&&(k[O.winningSide-1]+=1),k),[0,0]))||[0,0])||b===1&&[1,0]||[0,1],A=b?U[b]:[],_=b?U[3-b]:[];for(const k of A){const O=(a=E[k])==null?void 0:a.scaleValue,F=typeof O=="object"?O[c]:O;for(const B of _){const $=(s=E[B])==null?void 0:s.scaleValue,V=typeof $=="object"?$[c]:$,H=b?R[b]:[0,0],z=b?R[3-b]:[0,0],{newWinnerRating:G,newLoserRating:W}=b8({winnerCountables:H,loserCountables:z,maxCountables:N,winnerRating:F,loserRating:V,ratingType:i}),K=c?{...O,[c]:G}:G,Z=c?{...$,[c]:W}:W;E[k].scaleValue=K,E[B].scaleValue=Z;let Y=Tw({participantId:k,removePriorValues:t,tournamentRecord:e,scaleItem:{...E[k],scaleName:D}});if(Y.error||(Y=Tw({participantId:B,removePriorValues:t,tournamentRecord:e,scaleItem:{...E[B],scaleName:D}}),Y.error))return Y}}Object.assign(u,E)}var p;const h=d.map(({matchUpId:f})=>f);return{...le,modifiedScaleValues:u,processedMatchUpIds:h}}},OFe={...kFe,...xFe};Wq.importMethods(OFe);const LFe={ratingsParameters:Gs,matchUpFormats:Mxe,countryToFlag:G7,tieFormats:Nhe,countries:Fh,policies:{POLICY_AVOIDANCE_COUNTRY:{[yR]:{roundsToSeparate:void 0,policyName:"Nationality Code",policyAttributes:[{key:"person.nationalityCode"},{key:"individualParticipants.person.nationalityCode"}]}},POLICY_POSITION_ACTIONS_DEFAULT:cpe,POLICY_POSITION_ACTIONS_DISABLED:{[xh]:{policyName:"positionActionsDisabled",enabledStructures:!1}},POLICY_POSITION_ACTIONS_NO_MOVEMENT:{[xh]:{policyName:"positionActionsNoMovement",enabledStructures:[{stages:[],stageSequences:[],enabledActions:[TI,FR,bw],disabledActions:[]}]}},POLICY_POSITION_ACTIONS_UNRESTRICTED:{[xh]:{policyName:"positionActionsUnrestricted",enabledStructures:[],otherFlightEntries:!0,disableRoundRestrictions:!0,activePositionOverrides:[TI,VE]}},POLICY_PRIVACY_DEFAULT:{[ok]:{policyName:"Participant Privacy Policy",participant:{contacts:!1,individualParticipants:{onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}},individualParticipantIds:!0,onlineResources:!1,participantName:!0,participantOtherName:!0,participantId:!0,participantRole:!0,participantStatus:!0,penalties:!1,representing:!0,participantRoleResponsibilities:!1,participantType:!0,person:{addresses:!1,biographicalInformation:!1,birthDate:!1,contacts:!1,nationalityCode:!0,nativeFamilyName:!1,nativeGivenName:!1,onlineResources:!1,otherNames:!0,parentOrganisationId:!1,passportFamilyName:!1,passportGivenName:!1,personId:!1,personOtherIds:!1,previousNames:!1,sex:!1,standardFamilyName:!0,standardGivenName:!0,status:!1,tennisId:!1,wheelchair:!0}}}},POLICY_ROUND_NAMING_DEFAULT:FW,POLICY_SCHEDULING_DEFAULT:Tpe,POLICY_SCORING_DEFAULT:{[jm]:{defaultMatchUpFormat:Xs,allowDeletionWithScoresPresent:{drawDefinitions:!1,structures:!1},requireAllPositionsAssigned:!1,processCodes:{incompleteAssignmentsOnDefault:["RANKING.IGNORE"]},stage:{[ct]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}}}},POLICY_SCORING_USTA:{[jm]:{requireAllPositionsAssigned:!1,stage:{[ct]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:Xs,matchUpFormats:[{description:"Best of 3 tiebreak sets",matchUpFormat:Xs,categoryNames:[],categoryTypes:[]},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One standard tiebreak set to 6, 7-point tiebreak at 6 games all",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three short sets to 4 with 5-point tiebreak at 3 games all",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One short set to 4, 7-point tiebreak at 4 games all",matchUpFormat:"SET1-S:4/TB7"},{description:"One short set to 4, 5-point tiebreak at 3 games all",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two short sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two short sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One no advantage set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5 games all",matchUpFormat:"SET1-S:6NOAD"},{description:"One short set to 4, deciding game is played at 3 games all",matchUpFormat:"SET1-S:4NOAD"},{description:"Two short sets to 4 with deciding game at 3-3, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4NOAD-F:TB7"},{description:"8 game pro-set with 7 point tiebreak at 8 games all",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7 games all",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"One 10-point tiebreak game",matchUpFormat:"SET1-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20"}]}},POLICY_SEEDING_ITF:{[mc]:{seedingProfile:{positioning:dk},validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,policyName:"ITF SEEDING",seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:97,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},POLICY_SEEDING_DEFAULT:jR},flagIOC:function(t){return G7(Object.assign({},...Fh.filter(e=>e.ioc).map(e=>({[e.ioc]:e.iso})))[t])}},FFe=ki({WebkitBoxSizing:"border-box",marginInlineEnd:".3em",display:"inline-block",boxSizing:"border-box",position:"relative",borderRadius:2,variants:{variant:{doubles:{width:".75rem"},singles:{width:"1rem"}}}});function BFe({matchUp:t,individualParticipant:e,spacer:i}){var n,r,o;const a=((n=e==null?void 0:e.person)==null?void 0:n.iso2NationalityCode)||"",s=a?(r=LFe.countryToFlag(a))==null?void 0:r.slice(0,4):"",l=document.createElement("span"),c=(o=t==null?void 0:t.matchUpType)==null?void 0:o.toLowerCase();return i||(l.className=FFe({variant:c})),l.innerHTML=i?"":s,l}function bL({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r,side:o,type:a}){if(a==="scale")return zAe({individualParticipant:t,composition:e,className:i,matchUp:n,spacer:r});const s=(e==null?void 0:e.configuration)||{},l=document.createElement("div");return a==="flag"&&s.flags&&BFe({className:i,matchUp:n,individualParticipant:t,spacer:r})||a==="seeding"&&HAe({className:i,composition:e,matchUp:n,side:o})||l}const $Fe=ki({willChange:"opacity",position:"fixed",zIndex:9998,bottom:0,right:0,left:0,top:0}),VFe=ki({display:"block"}),jFe=ki({position:"fixed",right:0,left:0}),HFe=ki({paddingRight:"15px",alignItems:"center",margin:"30px auto",paddingLeft:"15px",position:"fixed",height:"100vh",display:"flex",width:"100%",zIndex:9999,bottom:0,right:0,left:0,top:0}),GFe=ki({boxShadow:"0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23)",backgroundColor:"white",position:"relative",borderRadius:"3px",minHeight:"auto",width:"100%"}),zFe=ki({borderBottom:"1px solid rgba(0, 0, 0, 0.1)",alignItems:"center",position:"relative",display:"flex"}),WFe=ki({fontWeight:"600",fontSize:"20px"}),I8=ki({borderTop:"1px solid rgba(0, 0, 0, 0.1)",justifyContent:"right",alignItems:"center",position:"relative",display:"flex"}),w8="Nothing to see here";function Sc(t){return typeof t=="function"}function _1(t){return typeof t=="string"}function S8(t){return Array.isArray(t)}function IL(t){return typeof t=="object"&&!Array.isArray(t)}function qFe(t){if(t)for(;t.firstChild;)t.removeChild(t.firstChild)}const XR=(()=>{const t=jFe(),e={},i=".5";let n=[],r,o=[],a=[],s;const l=g=>{if(g){let v;a=a.filter(y=>(y.id===g&&(v=y),y.id!==g)),v&&document.body.removeChild(v)}else{const v=a.pop();v&&document.body.removeChild(v)}},c=()=>{s&&(s.style.opacity=0,s.style.display="none")},u=g=>{const v=a.length;if(g&&e[v]===!1)return;const y=o.pop(),b=n.pop();Sc(y)&&y({content:b}),document.body.classList.remove(t),document.body.style.top=null,window.scrollTo({top:r,behavior:"instant"}),c(),l()},d=()=>{s=document.createElement("div"),s.className=$Fe(),s.id="cmdl-backdrop",s.onclick=()=>u(!0),document.body.appendChild(s)},p=({config:g})=>{r=window.scrollY,document.body.classList.add(t),document.body.style.top=`-${r}px`,s||d(),s.style.display="",(g==null?void 0:g.backdrop)!==!1&&(s.style.backgroundColor="rgba(0, 0, 0, 0.2)",s.style.transition="opacity 0.15s linear",s.style.opacity=1)},h=({config:g,attr:v})=>{if(!_1(v))return;const y=v.split(".");for(const b of y)if(g=g==null?void 0:g[b],!g)return;return g},f=({config:g,attr:v,attrs:y,unit:b="em",value:I})=>{var T;let S;return _1(v)?S=h({config:g,attr:v}):S8(y)&&(S=(T=y.map(w=>h({config:g,attr:w})).filter(Boolean))==null?void 0:T[0]),S!==void 0&&(I=S),isNaN(I)?I:`${I}${b}`},m=({buttons:g,config:v,modalNumber:y})=>{var b,I;const T=document.createElement("div");T.className=I8(),T.style.padding=f({config:v,attrs:["footer.padding","padding"],value:i});const S={label:((b=v==null?void 0:v.dictionary)==null?void 0:b.close)||"Close",onClick:XR.close,intent:"is-info"};for(const w of g){if(w.hide)continue;const U=Object.assign({},S);IL(w)&&Object.assign(U,w);const D=document.createElement("button");U.disabled!==void 0&&(D.disabled=U.disabled),U.id&&(D.id=U.id),D.className=((I=U==null?void 0:U.footer)==null?void 0:I.className)||"button font-medium",D.classList.add(U.intent),D.style="margin-right: .5em;",D.innerHTML=U.label||U.text,D.onclick=E=>{E.stopPropagation(),Sc(U.onClick)&&U.onClick({e:E,content:n[y]}),U.close!==!1&&(Sc(U.close)&&U.close(),XR.close())},T.appendChild(D)}return T};return{close:u,open:({title:g="",content:v,buttons:y,footer:b,config:I,onClose:T}={})=>{p({config:I}),o.push(T);const S=a.length+1;e[S]=I==null?void 0:I.clickAway;const w=document.createElement("section"),U=`cmdl-${S}`;w.className=VFe(),w.role="dialog",w.tabIndex=-1,w.id=U;const D=document.createElement("div");D.className=HFe(),D.style.maxWidth=`${(I==null?void 0:I.maxWidth)||450}px`,D.onclick=()=>u(!0);const E=document.createElement("div");E.className=GFe(),E.onclick=F=>F.stopPropagation();const C=document.createElement("div"),M=document.createElement("div");C.appendChild(M),E.appendChild(C);const N=({title:F,config:B})=>{C.className=F?zFe():"",C.style.padding=f({config:B,attrs:["title.padding","padding"],value:i}),M.className=F?WFe():"",M.innerHTML=F};g&&N({title:g});const R=document.createElement("div");E.appendChild(R);const A=({content:F,config:B})=>{R.style.fontSize=f({config:B,attr:"fontSize",value:"15px"}),R.style.position="relative",R.style.padding=f({config:B,attrs:["content.padding","padding"],value:i}),Sc(F)?n[S]=F(R):IL(F)?R.appendChild(F):_1(F)?R.innerHTML=F:R.innerHTML=w8};if(A({content:v,config:I}),S8(y))b=m({buttons:y,config:I,modalNumber:S}),E.appendChild(b);else if(b){const F=document.createElement("div");F.className=I8(),F.style.padding=f({config:I,attrs:["footer.padding","padding"]}),IL(b)?F.appendChild(b):_1(b)?F.innerHTML=b:F.innerHTML=w8,E.appendChild(F)}D.appendChild(E),w.appendChild(D),document.body.appendChild(w),a.push(w);const _=({content:F,config:B})=>{n[S]=void 0,qFe(R),A({content:F,config:B})},k=({buttons:F,config:B})=>{E.removeChild(b),b=m({buttons:F,config:B,modalNumber:S}),E.appendChild(b)},O=({onClose:F})=>{o.length=0,o.push(F)};return{setContent:_,setButtons:k,update:({content:F,buttons:B,title:$,config:V,onClose:H})=>{I=V||I,F&&_({content:F,config:I}),B&&k({buttons:B,config:I}),H&&O({onClose:H}),$&&N({title:$,config:I})}}}}})(),YFe="Qualifier",KFe="BYE",ZFe="TBD";function T8(t){var e,i,n,r;const{isWinningSide:o,side:a,sideNumber:s,individualParticipant:l,matchUp:c,composition:u}=t||{},d=o?"winner":void 0,p=t.eventHandlers||{},h=u==null?void 0:u.configuration,f={QUALIFIER:((e=h==null?void 0:h.placeHolders)==null?void 0:e.qualifier)||YFe,BYE:((i=h==null?void 0:h.placeHolders)==null?void 0:i.bye)||KFe,TBD:((n=h==null?void 0:h.placeHolders)==null?void 0:n.tbd)||ZFe},m=l==null?void 0:l.participantName,g=w=>{Sc(p==null?void 0:p.participantClick)&&(w.stopPropagation(),p.participantClick({individualParticipant:l,pointerEvent:w,matchUp:c,side:a}))},v=document.createElement("div");v.classList.add("tmx-i"),v.setAttribute("sideNumber",s),v.setAttribute("id",l==null?void 0:l.participantId),v.onclick=g;const y=document.createElement("div");y.className=AAe({variant:d});const b=(h==null?void 0:h.flags)&&bL({...t,type:"flag"});if(b)y.appendChild(b);else{const w=bL({type:"scale",...t});w&&y.appendChild(w)}const I=document.createElement("div");if(I.className=_Ae({variant:d}),m){const w=document.createElement("span");if(o&&h!=null&&h.winnerColor)w.style.color=typeof h.winnerColor=="string"?h.winnerColor:"green";else if(h!=null&&h.genderColor){const U=(r=l==null?void 0:l.person)==null?void 0:r.sex,D=U==="MALE"&&"#2E86C1"||U==="FEMALE"&&"#AA336A"||"";w.style.color=typeof h.genderColor=="string"?h.genderColor:D}w.innerHTML=m,I.appendChild(w)}else{const w=document.createElement("abbr");w.className=NAe({variant:h.showAddress?"showAddress":""}),w.innerHTML=(a==null?void 0:a.bye)&&f.BYE||(a==null?void 0:a.qualifier)&&f.QUALIFIER||f.TBD,I.appendChild(w)}const T=bL({...t,className:jAe(),type:"seeding"});T&&I.appendChild(T),y.appendChild(I),v.appendChild(y);const S=VAe(t);return v.appendChild(S),{element:v}}const XFe=ki({width:"auto",display:"inline-block",textTransform:"uppercase",fontFamily:"Sharp Sans, Arial, sans-serif",fontSize:"0.625rem",lineHeight:"1rem",marginInline:"0.25rem 0.25rem",paddingInline:"0.25rem 0.25rem",fontWeight:700,borderRadius:"4px",color:"#fff",textAlign:"center",whiteSpace:"nowrap",variants:{variant:{defaulted:{backgroundColor:"#df164c"},retired:{backgroundColor:"#df164c"},walkover:{backgroundColor:"black"},double_walkover:{backgroundColor:"black"}}}});function JFe({matchUpStatus:t}){const e=t==null?void 0:t.toLowerCase(),i=["WALKOVER","DOUBLE_WALKOVER"].includes(t)?"WO":(t==null?void 0:t.slice(0,3))||"",n=document.createElement("div");n.className=XFe({variant:e});const r=document.createElement("abbr");return r.setAttribute("title",t),r.style.textDecoration="none",r.style.borderBottom="none",r.innerHTML=i,n.appendChild(r),n}function QFe(t){return t instanceof Element||t}const e2e=ki({marginInlineEnd:".5rem",backgroundColor:"pink",marginInlineStart:2,height:40,width:40});function t2e({teamLogo:t}){console.log({teamLogo:t});const e=document.createElement("div");return e.className=e2e(),e}const i2e=ki({flexDirection:"column",position:"relative",display:"flex"}),n2e=ki({alignItems:"stretch",display:"flex"}),r2e=ki({marginInlineEnd:".25rem",color:"green"});function o2e({dim:t="20px"}={}){const e=r2e();return`
    <div style="line-height: 0;">
      <svg height="${t}" viewBox="0 0 18 24" width="${t}" xmlns="http://www.w3.org/2000/svg" class="${e}" style="fill: currentcolor;">
        <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"></path>
      </svg>
    </div>
  `}function Ome({initialRoundNumber:t=1,eventHandlers:e,sideContainer:i,composition:n,participant:r,placeholder:o,sideNumber:a,matchUp:s}){var l,c,u;const{winningSide:d,matchUpType:p,isRoundRobin:h,matchUpStatus:f}=s||{},m=n==null?void 0:n.configuration;let g;const v=a?(l=s==null?void 0:s.sides)==null?void 0:l.find(R=>R.sideNumber===a):void 0;r||(r=v==null?void 0:v.participant,g=m!=null&&m.allDrawPositions||m!=null&&m.drawPositions&&v!=null&&v.drawPosition&&((s==null?void 0:s.roundNumber)===t||v!=null&&v.participantFed||h)?v==null?void 0:v.drawPosition:"");const y=p==="DOUBLES",b=y?(c=r==null?void 0:r.individualParticipants)==null?void 0:c[0]:r,I=y&&((u=r==null?void 0:r.individualParticipants)==null?void 0:u[1]),T=a===d||f==="BYE"&&r,S=(m==null?void 0:m.winnerChevron)&&T,w=m==null?void 0:m.teamLogo,U=["RETIRED","DOUBLE_WALKOVER","WALKOVER","DEFAULTED"].includes(f)&&!T,D=m==null?void 0:m.gameScoreOnly,E=document.createElement("div");if(E.className=i&&xAe({drawPosition:g,sideNumber:a}),E.classList.add("tmx-p"),E.setAttribute("id",r==null?void 0:r.participantId),w){const R=t2e({teamLogo:w});E.appendChild(R)}const C=document.createElement("div");C.className=kAe({variant:y?"doubles":"singles"});const M=document.createElement("div");M.className=OAe({winnerChevron:S,isDoubles:y});const N=T8({individualParticipant:b,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:a,matchUp:s,side:v}).element;if(M.appendChild(N),I){const R=T8({individualParticipant:I,eventHandlers:e,isWinningSide:T,composition:n,sideNumber:a,matchUp:s,side:v}).element;M.appendChild(R)}else y&&o&&QFe(o)&&M.appendChild(o);if(C.appendChild(M),E.appendChild(C),i){const R=document.createElement("div");if(T&&!D){const A=o2e();typeof A=="string"?R.innerHTML=A:R.appendChild(A)}else if(U){const A=JFe({matchUpStatus:f});R.appendChild(A)}E.appendChild(R)}return E}const a2e=ki({borderBottom:"solid 1px black",marginInlineStart:"16px",marginInlineEnd:"16px",fontWeight:"bold",width:"460px",height:"1.5em"});function s2e({eventHandlers:t,roundMatchUps:e,roundProfile:i,roundNumber:n,context:r}){var o;const a=document.createElement("div");a.className=a2e(),a.classList.add("tmx-rh"),a.setAttribute("roundNumber",n);const s=Sc(t==null?void 0:t.roundHeaderClick);s&&(a.onclick=d=>t.roundHeaderClick({roundNumber:n,roundProfile:i,roundMatchUps:e,context:r,pointerEvent:d}));const l=s?"⋮":"",c=(o=i==null?void 0:i[n])==null?void 0:o.roundName,u=c&&` <div style="display: flex; flex-direction: row; justify-content: space-between">
        <div>${c}</div>
        <div style="font-weight: bold">${l}</div>
      </div>
  `;return a.innerHTML=u||"",a}const Lme=ki({flexDirection:"column",display:"flex"}),l2e=ki({flexDirection:"row",display:"flex"}),Fme=ki({justifyContent:"space-around",marginInlineStart:"16px",marginInlineEnd:"16px",flexDirection:"column",height:"100%",display:"flex",width:"460px",variants:{variant:{adHoc:{justifyContent:"flex-start"}}}}),c2e=ki({borderTop:"solid 1px black",marginRight:"-1em",marginLeft:"-1em",paddingTop:".5em",marginTop:".2em",variants:{variant:{0:{marginTop:"1em",borderTop:"none",paddingTop:"0px"}},roundOrder:{first:{marginLeft:"0em"},last:{marginRight:"0em"}}}}),u2e=ki({fontWeight:"bold",color:"blue",height:"1em"}),U8=ki({width:"$score$setWidth",display:"inline-block",fontSize:9,variants:{variant:{set:{textAlign:"center"},points:{marginInlineEnd:3}}}}),d2e=ki({transform:"translateY(-50%)",textTransform:"uppercase",backgroundColor:"#fff",position:"absolute",textAlign:"center",top:"calc(50%)",color:"#bbb",fontSize:0,right:4});function p2e(){return ki({backgroundColor:"magenta",position:"absolute",opacity:"0.2",height:"100%",width:"100%",top:0})}const h2e=ki({});function f2e({configuration:t}){const e={backgroundColor:"$matchUpBackgroundColor",WebkitTransition:"all 0.30s linear",boxShadow:"$matchUp$boxShadow",transition:"all 0.30s linear",border:"solid $border",marginBottom:"$space$1",marginTop:"$space$1",position:"relative",display:"grid",width:"100%",borderInlineStartWidth:"$borderWidths$borderInlineStart"};if(t!=null&&t.matchUpHover){const i=typeof t.matchUpHover=="string"?t.matchUpHover:"cyan";e["&:hover"]={backgroundColor:i}}else e["&:hover"]={borderColor:"$borderHover"};return ki(e)}function m2e({variant:t}){return ki({borderBottom:"solid 1px lightgray",backgroundColor:"$matchUp",position:"relative",width:"100%",height:"$lineHeights$centerInfo",variants:{variant:{1:{borderBottom:"solid 1px black"},2:{borderBottom:"solid 1px lightgray"}}}})({variant:t})}const g2e=ki({justifyContent:"center",alignContent:"center",flexDirection:"column",height:"100%",display:"flex"}),v2e=ki({fontFamily:"Lato,Arial,Helvetica,sans-serif",WebkitFontSmooting:"antialiased",marginInlineStart:"calc(20%)",WebkitBoxOrient:"horizontal",WebKitBoxDirection:"normal",WebkitBoxPack:"center",boxSizing:"inherit",flexDirection:"row",display:"flex"}),D8=ki({alignContent:"center",boxSizing:"inherit",fontFamily:"Lato",fontWeight:900,fontSize:9});function y2e({eventHandlers:t,entryStatus:e,sideNumber:i,className:n,matchUp:r}){const o=document.createElement("div");Sc(t==null?void 0:t.centerInfoClick)&&(o.onclick=u=>t.centerInfoClick({matchUp:r,sideNumber:i,pointerEvent:u})),o.className=zy(m2e({variant:i}),n),o.classList.add("tmx-ci"),o.setAttribute("sideNumber",i);const a=document.createElement("div");a.className=g2e();const s=document.createElement("div");s.className=v2e();const l=document.createElement("div");l.className=D8(),l.innerHTML=e?"Entry status:&nbsp;":"",s.appendChild(l);const c=document.createElement("div");return c.className=D8(),c.innerHTML=e||"",s.appendChild(c),a.appendChild(s),o.appendChild(a),{element:o}}const dT={scheduleInfo:1.8,centerInfo:1.5,gameScore:2};function b2e({composition:t,isDoubles:e,roundFactor:i=1}){const n=parseInt(window.getComputedStyle(document.body).getPropertyValue("font-size")),r=(t==null?void 0:t.configuration)||{},o=(r==null?void 0:r.connectorWidth)||16,a=r.centerInfo?dT.centerInfo*n:0,s=r.scheduleInfo?dT.scheduleInfo*n:0,l=(60+(r.showAddress?n:0))*(e?1.3:1)+a,c=l*i,u=(l+s)*i;return ki({"&::before":{borderBlockStart:"$borderWidths$matchUp solid #999",left:-o,width:o,position:"absolute",borderRadius:2,top:-1},"&::after":{width:o,position:"absolute",borderRadius:2,left:"100%"},"&::after, &::before":{borderWidth:"$borderWidths$matchUp",borderColor:"$connector",display:"block",content:""},variants:{isFirstRound:{true:{"&::before":{height:0,width:0,borderWidth:0}}},link:{m1:{"&::after":{borderInlineEnd:"$borderWidths$matchUp solid $connector",borderTopStyle:"solid",height:c,top:-1}},m2:{"&::after":{bottom:"calc(100%)",borderInlineEnd:"$borderWidths$matchUp solid $connector",borderBottomStyle:"solid",height:u}},m0:{"&::after":{borderTopStyle:"solid",borderColor:"$connector",top:-1}},mr:{"&::before":{height:0,width:0,borderWidth:0},"&::after":{height:0,width:0,borderWidth:0}},noProgression:{true:{"&::after":{height:0,width:0,borderWidth:0}}}}}})}const Bme=t=>ki({display:"flex",alignItems:"center",height:t,justifyContent:"flex-end",backgroundColor:"$matchUp",variants:{sideNumber:{1:{borderBottom:"1px solid $internalDividers"}},fontSize:{small:{fontSize:"smaller",paddingRight:"1em",color:"blue"}}}}),I2e=ki({lineHeight:"0.75rem",fontSize:"0.625rem",left:"1.1rem",top:".4rem"}),$me=ki({lineHeight:"$lineHeights$gameScore",justifyContent:"center",width:"$score$setWidth",position:"relative",textAlign:"center",cursor:"pointer",fontWeight:500,fontSize:"$1",display:"flex",margin:0,variants:{variant:{winner:{color:"$winner!important",fontWeight:700},loser:{color:"$loser!important"}}}}),w2e=ki({marginInlineEnd:"$space$gameMarginInlineEnd",justifyContent:"flex-end",alignItems:"center",display:"flex"});function S2e({value:t}={}){const e=document.createElement("input");return e.onclick=i=>i.target.select(),e.className=$me(),e.value=t,e}function T2e({gameScoreOnly:t,scoreStripes:e,set:i,sideNumber:n}){const r=n===(i==null?void 0:i.winningSide)||i!=null&&i.winningSide?"loser":void 0,o=n===2?i.side2Score:i.side1Score,a=i.side2TiebreakScore||i.side1TiebreakScore,s=n===2?i.side2TiebreakScore:i.side1TiebreakScore,l=o===void 0&&s,c=l||o,u=e&&i.setNumber%2?"lightgray":"transparent",d=i.editing?i.editing===n:void 0;let p;if(d)p=S2e({value:c});else if(p=document.createElement("p"),p.className=$me({variant:r}),p.classList.add("tmx-st"),p.setAttribute("setNumber",i.setNumber),p.style.backgroundColor=u,p.innerHTML=isNaN(c)?"":c,!t){const h=document.createElement("span");h.className=I2e(),h.innerHTML=a&&!l?s:"",p.appendChild(h)}return p}function U2e({participantHeight:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:r}){var o,a,s,l;const c=(o=i==null?void 0:i.configuration)==null?void 0:o.winnerChevron,u=(a=i==null?void 0:i.configuration)==null?void 0:a.gameScoreOnly,d=((s=r==null?void 0:r.score)==null?void 0:s.sets)||[],p=(l=i==null?void 0:i.configuration)==null?void 0:l.scoreBox,h=n===2?t:t-1,f=Bme(h),m=y=>{Sc(e==null?void 0:e.scoreClick)&&(y.stopPropagation(),e.scoreClick({pointerEvent:y,matchUp:r}))},g=document.createElement("div");g.className=f({sideNumber:!p&&n,fontSize:"5px"}),g.classList.add("sideScore"),g.classList.add("tmx-scr"),g.onclick=m;const v=document.createElement("div");v.className=w2e();for(const y of d||[]){const b=T2e({gameScoreOnly:u,scoreStripes:c,sideNumber:n,set:y});v.appendChild(b)}return g.appendChild(v),g}const D2e=ki({height:"$lineHeights$scheduleInfo",borderBottom:"1px solid darkgray",justifyContent:"space-between",backgroundColor:"#F8F9F9",boxSizing:"border-box",paddingRight:"0.2rem",paddingLeft:"0.5rem",alignItems:"center",cursor:"pointer",color:"#7F8080",display:"flex",width:"100%"});var Vme={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(LAe,function(){var i=1e3,n=6e4,r=36e5,o="millisecond",a="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(R){var A=["th","st","nd","rd"],_=R%100;return"["+R+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(R,A,_){var k=String(R);return!k||k.length>=A?R:""+Array(A+1-k.length).join(_)+R},I={s:b,z:function(R){var A=-R.utcOffset(),_=Math.abs(A),k=Math.floor(_/60),O=_%60;return(A<=0?"+":"-")+b(k,2,"0")+":"+b(O,2,"0")},m:function R(A,_){if(A.date()<_.date())return-R(_,A);var k=12*(_.year()-A.year())+(_.month()-A.month()),O=A.clone().add(k,d),F=_-O<0,B=A.clone().add(k+(F?-1:1),d);return+(-(k+(_-O)/(F?O-B:B-O))||0)},a:function(R){return R<0?Math.ceil(R)||0:Math.floor(R)},p:function(R){return{M:d,y:h,w:u,d:c,D:f,h:l,m:s,s:a,ms:o,Q:p}[R]||String(R||"").toLowerCase().replace(/s$/,"")},u:function(R){return R===void 0}},T="en",S={};S[T]=y;var w="$isDayjsObject",U=function(R){return R instanceof M||!(!R||!R[w])},D=function R(A,_,k){var O;if(!A)return T;if(typeof A=="string"){var F=A.toLowerCase();S[F]&&(O=F),_&&(S[F]=_,O=F);var B=A.split("-");if(!O&&B.length>1)return R(B[0])}else{var $=A.name;S[$]=A,O=$}return!k&&O&&(T=O),O||!k&&T},E=function(R,A){if(U(R))return R.clone();var _=typeof A=="object"?A:{};return _.date=R,_.args=arguments,new M(_)},C=I;C.l=D,C.i=U,C.w=function(R,A){return E(R,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var M=function(){function R(_){this.$L=D(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[w]=!0}var A=R.prototype;return A.parse=function(_){this.$d=function(k){var O=k.date,F=k.utc;if(O===null)return new Date(NaN);if(C.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var B=O.match(g);if(B){var $=B[2]-1||0,V=(B[7]||"0").substring(0,3);return F?new Date(Date.UTC(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)):new Date(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)}}return new Date(O)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return C},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,k){var O=E(_);return this.startOf(k)<=O&&O<=this.endOf(k)},A.isAfter=function(_,k){return E(_)<this.startOf(k)},A.isBefore=function(_,k){return this.endOf(k)<E(_)},A.$g=function(_,k,O){return C.u(_)?this[k]:this.set(O,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,k){var O=this,F=!!C.u(k)||k,B=C.p(_),$=function(Y,X){var Q=C.w(O.$u?Date.UTC(O.$y,X,Y):new Date(O.$y,X,Y),O);return F?Q:Q.endOf(c)},V=function(Y,X){return C.w(O.toDate()[Y].apply(O.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),O)},H=this.$W,z=this.$M,G=this.$D,W="set"+(this.$u?"UTC":"");switch(B){case h:return F?$(1,0):$(31,11);case d:return F?$(1,z):$(0,z+1);case u:var K=this.$locale().weekStart||0,Z=(H<K?H+7:H)-K;return $(F?G-Z:G+(6-Z),z);case c:case f:return V(W+"Hours",0);case l:return V(W+"Minutes",1);case s:return V(W+"Seconds",2);case a:return V(W+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,k){var O,F=C.p(_),B="set"+(this.$u?"UTC":""),$=(O={},O[c]=B+"Date",O[f]=B+"Date",O[d]=B+"Month",O[h]=B+"FullYear",O[l]=B+"Hours",O[s]=B+"Minutes",O[a]=B+"Seconds",O[o]=B+"Milliseconds",O)[F],V=F===c?this.$D+(k-this.$W):k;if(F===d||F===h){var H=this.clone().set(f,1);H.$d[$](V),H.init(),this.$d=H.set(f,Math.min(this.$D,H.daysInMonth())).$d}else $&&this.$d[$](V);return this.init(),this},A.set=function(_,k){return this.clone().$set(_,k)},A.get=function(_){return this[C.p(_)]()},A.add=function(_,k){var O,F=this;_=Number(_);var B=C.p(k),$=function(z){var G=E(F);return C.w(G.date(G.date()+Math.round(z*_)),F)};if(B===d)return this.set(d,this.$M+_);if(B===h)return this.set(h,this.$y+_);if(B===c)return $(1);if(B===u)return $(7);var V=(O={},O[s]=n,O[l]=r,O[a]=i,O)[B]||1,H=this.$d.getTime()+_*V;return C.w(H,this)},A.subtract=function(_,k){return this.add(-1*_,k)},A.format=function(_){var k=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var F=_||"YYYY-MM-DDTHH:mm:ssZ",B=C.z(this),$=this.$H,V=this.$m,H=this.$M,z=O.weekdays,G=O.months,W=O.meridiem,K=function(X,Q,te,J){return X&&(X[Q]||X(k,F))||te[Q].slice(0,J)},Z=function(X){return C.s($%12||12,X,"0")},Y=W||function(X,Q,te){var J=X<12?"AM":"PM";return te?J.toLowerCase():J};return F.replace(v,function(X,Q){return Q||function(te){switch(te){case"YY":return String(k.$y).slice(-2);case"YYYY":return C.s(k.$y,4,"0");case"M":return H+1;case"MM":return C.s(H+1,2,"0");case"MMM":return K(O.monthsShort,H,G,3);case"MMMM":return K(G,H);case"D":return k.$D;case"DD":return C.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return K(O.weekdaysMin,k.$W,z,2);case"ddd":return K(O.weekdaysShort,k.$W,z,3);case"dddd":return z[k.$W];case"H":return String($);case"HH":return C.s($,2,"0");case"h":return Z(1);case"hh":return Z(2);case"a":return Y($,V,!0);case"A":return Y($,V,!1);case"m":return String(V);case"mm":return C.s(V,2,"0");case"s":return String(k.$s);case"ss":return C.s(k.$s,2,"0");case"SSS":return C.s(k.$ms,3,"0");case"Z":return B}return null}(X)||B.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,k,O){var F,B=this,$=C.p(k),V=E(_),H=(V.utcOffset()-this.utcOffset())*n,z=this-V,G=function(){return C.m(B,V)};switch($){case h:F=G()/12;break;case d:F=G();break;case p:F=G()/3;break;case u:F=(z-H)/6048e5;break;case c:F=(z-H)/864e5;break;case l:F=z/r;break;case s:F=z/n;break;case a:F=z/i;break;default:F=z}return O?F:C.a(F)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return S[this.$L]},A.locale=function(_,k){if(!_)return this.$L;var O=this.clone(),F=D(_,k,!0);return F&&(O.$L=F),O},A.clone=function(){return C.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},R}(),N=M.prototype;return E.prototype=N,[["$ms",o],["$s",a],["$m",s],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(R){N[R[1]]=function(A){return this.$g(A,R[0],R[1])}}),E.extend=function(R,A){return R.$i||(R(A,M,E),R.$i=!0),E},E.locale=D,E.isDayjs=U,E.unix=function(R){return E(1e3*R)},E.en=S[T],E.Ls=S,E.p={},E})})(Vme);var P2e=Vme.exports;const C2e=Vle(P2e);function E2e({matchUp:t,eventHandlers:e}){const{scheduledTime:i,scheduledDate:n,venueAbbreviation:r,courtName:o}=(t==null?void 0:t.schedule)||{},{dateTime:{extractDate:a,extractTime:s}}=Dpe,l=s(i);let c=a(n),u="ddd D MMMM";l&&(u+=", hh:mm A",c+=`T${l}`);const d=n?C2e(c).format(u):"Not scheduled",p=r&&(o==null?void 0:o.toString().startsWith(r))&&o||r&&o&&`${r} ${o}`||o||r||"",h=document.createElement("div");h.className=D2e(),h.classList.add("tmx-sch"),Sc(e==null?void 0:e.scheduleClick)&&(h.onclick=y=>e.scheduleClick({matchUp:t,pointerEvent:y}));const f=document.createElement("div");f.innerHTML=d,h.append(f);const m=y=>{Sc(e==null?void 0:e.venueClick)&&(y.stopPropagation(),e.venueClick({pointerEvent:y,matchUp:t}))},g=document.createElement("div");g.style="display: flex; flex-direction: row";const v=document.createElement("div");if(v.style.paddingRight=".2rem",v.onclick=m,v.innerHTML=p,g.append(v),h.append(g),h.onclick){const y=document.createElement("div");y.innerHTML="⋮",g.append(y)}return h}function P8({initialRoundNumber:t=1,eventHandlers:e,composition:i,sideNumber:n,className:r,matchUp:o}){var a,s;const l=(i==null?void 0:i.configuration)||{},c=l==null?void 0:l.scheduleInfo,u=(a=o==null?void 0:o.score)==null?void 0:a.scoreStringSide1,d=((s=i==null?void 0:i.configuration)==null?void 0:s.scoreBox)&&u,p=(o==null?void 0:o.readyToScore)&&(e==null?void 0:e.scoreClick)&&!kme.checkScoreHasValue({matchUp:o}),h=document.createElement("div");if(h.className=zy(i2e(),r),h.classList.add("tmx-sd"),h.setAttribute("sideNumber",n),c&&n===1){const g=E2e({matchUp:o,eventHandlers:e});h.appendChild(g)}const f=document.createElement("div");f.className=n2e();const m=Ome({sideContainer:!0,initialRoundNumber:t,eventHandlers:e,composition:i,sideNumber:n,matchUp:o});if(f.appendChild(m),d){const g=document.createElement("div");g.style.border="1px solid lightgray",f.appendChild(g)}if(u){const g=U2e({eventHandlers:e,composition:i,sideNumber:n,matchUp:o});f.appendChild(g)}if(p){const g=Bme(),v=b=>{Sc(e==null?void 0:e.scoreClick)&&(event.stopPropagation(),e.scoreClick({pointerEvent:b,matchUp:o}))},y=document.createElement("div");y.className=g({sideNumber:!d&&n,fontSize:"small"}),y.onclick=v,y.innerHTML="[Score]",f.appendChild(y)}return h.appendChild(f),h}function M2e(t){const{composition:e,initialRoundNumber:i=1,matchUp:n,moeity:r,selectedMatchUpId:o,searchActive:a}=t,{roundFactor:s,roundNumber:l,finishingRound:c,matchUpType:u,preFeedRound:d,stage:p}=n,h=t.isFinalRound||parseInt(c)===1,f=p==="QUALIFYING"&&h,m=h,g=parseInt(l)===i,v=u==="DOUBLES",y=(a||n.isRoundRobin||n.collectionId||t.isLucky||t.isAdHoc)&&"mr"||m&&"noProgression"||(f||d)&&"m0"||r&&"m1"||"m2",b=b2e({composition:e,isDoubles:v,roundFactor:s})({isFirstRound:g,link:y}),I=(e==null?void 0:e.configuration)||{},{resultsInfo:T,centerInfo:S}=I||{},w=t.eventHandlers||{},U=R=>{Sc(w==null?void 0:w.matchUpClick)&&w.matchUpClick({pointerEvent:R,matchUp:n})},D=document.createElement("div");D.className=zy(e.theme,t==null?void 0:t.className,"matchup",h2e()),D.classList.add("tmx-m"),D.setAttribute("id",n==null?void 0:n.matchUpId),D.onclick=U;const E=document.createElement("div");E.className=f2e({configuration:I});const C=({sideNumber:R})=>{var A,_,k;const O=(k=(_=(A=n==null?void 0:n.sides.find(F=>F.sideNumber===R))==null?void 0:A.participant)==null?void 0:_.entryStatus)==null?void 0:k.replace("_"," ");return y2e({eventHandlers:w,entryStatus:O,sideNumber:R,className:R===2&&b,matchUp:n})},M=P8({initialRoundNumber:i,eventHandlers:w,sideNumber:1,composition:e,matchUp:n}),N=P8({className:!S&&b,initialRoundNumber:i,eventHandlers:w,sideNumber:2,composition:e,matchUp:n});if(E.appendChild(M),S){const R=C({sideNumber:1}),A=C({sideNumber:2});E.appendChild(R.element),E.appendChild(A.element)}if(E.appendChild(N),T){const R=R2e({score:n.score});E.appendChild(R)}if(D.appendChild(E),o===n.matchUpId){const R=document.createElement("div");R.className=p2e(),D.appendChild(R)}return D}function R2e({score:t}){var e;const i=(e=t==null?void 0:t.sets)==null?void 0:e.filter(Boolean).sort((a,s)=>(a.setNumber||0)-(s.setNumber||0)),n=i==null?void 0:i[i.length-1],r=(n==null?void 0:n.side1PointsScore)||(n==null?void 0:n.side2PointsScore),o=document.createElement("div");if(o.className=d2e(),r){const a=document.createElement("div");a.className=U8({variant:"points"}),a.innerHTML="PTS",o.appendChild(a)}for(const a of i||[]){const s=document.createElement("div");s.setAttribute("key",a.setNumber),s.className=U8({variant:"set"}),s.innerHTML=a.setNumber,o.appendChild(s)}return o}function N2e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,isRoundRobin:r,searchActive:o,composition:a,roundFactor:s,roundNumber:l,roundProfile:c,matchUps:u,context:d,isLucky:p}){const h=u.filter(D=>D.roundNumber===l).sort((D,E)=>(D.roundPosition||0)-(E.roundPosition||0)),f=h.every(({roundPosition:D,drawPositions:E})=>!D&&!E),m=(a==null?void 0:a.configuration)||{},g=document.createElement("div");if(g.className=Lme(),g.classList.add("tmx-rd"),g.setAttribute("roundNumber",l),m.roundHeader){const D=s2e({roundProfile:c,roundMatchUps:h,roundNumber:l,eventHandlers:i,context:d});g.appendChild(D)}const v=document.createElement("div");v.className=Fme({variant:f?"adHoc":void 0});let y,b,I;if(r){const D=C=>C.reduce((M,N)=>N+M,0);h.sort((C,M)=>{const N=D(C.drawPositions)-D(M.drawPositions),R=Math.min(...C.drawPositions??[])-Math.min(...M.drawPositions??[]);return N||R});const E=h.reduce((C,M)=>(C[M.structureId]=M.structureName,C),{});y=Object.values(E),b=Object.keys(E),I=Object.keys(Dpe.instanceCount(h.map(({structureId:C})=>C))).length}else f&&h.sort((D,E)=>(D.roundOrder??0)-(E.roundOrder??0));const T=I&&h.length/I,S=Object.keys(c).map(D=>parseInt(D)),w=S.indexOf(l),U=w===0&&"first"||w===S.length-1&&"last";return h.forEach((D,E)=>{const C=T&&!(E%T),M=T&&Math.floor(E/T),N=T&&y[M];if(C){const _=document.createElement("div");_.className=c2e({variant:M,roundOrder:U}),v.appendChild(_);const k=document.createElement("div");if(k.className=u2e(),Sc(i==null?void 0:i.groupHeaderClick)){const{drawId:O,containerStructureId:F}=h[0];v.onclick=B=>i.groupHeaderClick({drawId:O,structureId:b[M],containerStructureId:F,pointerEvent:B})}l===t&&(k.innerHTML=N),v.appendChild(k)}const R=E%2===0;s?D.roundFactor=s:t>1&&(D.roundFactor=Math.pow(2,l-t));const A=M2e({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:n,searchActive:o,composition:a,isAdHoc:f,isLucky:p,matchUp:D,moeity:R});v.appendChild(A)}),g.appendChild(v),g}function A2e({initialRoundNumber:t=1,selectedMatchUpId:e,eventHandlers:i,searchActive:n,composition:r,structureId:o,finalColumn:a,matchUps:s,context:l}){var c;const{roundNumbers:u,roundProfile:d,hasOddMatchUpsCount:p,isNotEliminationStructure:h}=kme.getRoundMatchUps({matchUps:s});o=o||(l==null?void 0:l.structureId)||((c=s==null?void 0:s[0])==null?void 0:c.structureId);const f=s.some(({isRoundRobin:y})=>y),m=p||h,g=document.createElement("div");g.className=l2e(),g.classList.add("tmx-str"),g.setAttribute("id",o);const v=Math.max(...u);for(const y of u){if(y<t)continue;const b=N2e({initialRoundNumber:t,selectedMatchUpId:e,eventHandlers:i,isFinalRound:y===v,isRoundRobin:f,searchActive:n,composition:r,roundNumber:y,roundProfile:d,matchUps:s,context:l,isLucky:m});g.appendChild(b)}if(a){const y=document.createElement("div");y.className=Lme();const b=document.createElement("div");b.className=Fme(),b.appendChild(a),y.appendChild(b),g.appendChild(y)}return g}const C8=ki({backgroundColor:"$colors$backgroundColor",color:"$colors$color",overflowX:"auto",height:1e3});function _2e({content:t,theme:e}){const i=document.createElement("div");return i.className=e?zy(C8(),e):C8(),e&&i.classList.add(e),typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}const{createTheme:mb}=Ble({theme:{lineHeights:{scheduleInfo:`${dT.scheduleInfo}rem`,centerInfo:`${dT.centerInfo}rem`,gameScore:`${dT.gameScore}rem`},borderWidths:{matchUpInline:"1px 1px",matchUp:"1px"},space:{1:"10px",2:"0.375rem",gameMarginInlineEnd:"0.25rem"},fontSizes:{1:"0.875rem"},colors:{internalDividers:"lightgray",backgroundColor:"white",connector:"lightgray",border:"darkgray",color:"black"},participant:{textTransform:"capitalize",minHeight:"2rem",seed:"gray"},score:{setWidth:"1.3rem"}}}),E8=mb("australian-theme",{colors:{borderHover:"#0091d2",connector:"#999"}}),k2e=mb("wimbledon-theme",{borderWidths:{borderInlineStart:"10px"},colors:{connector:"transparent",borderHover:"darkgrey",border:"#00703c",matchUp:"#fff"},participant:{textTransform:"uppercase"}}),x2e=mb("french-theme",{colors:{winnerName:"#01503d!important",winner:"#01503d!important",borderHover:"#0091d2",border:"#F8F9F9"},matchUp:{boxShadow:"0 0 30px 0 hsla(0,0%,89%,9)"}}),O2e=mb("usopen-theme",{colors:{matchUpBackgroundColor:"#F8F9F9",internalDividers:"darkgray",borderHover:"#0091d2",connector:"#999"}}),M8=mb("basic-theme",{colors:{internalDividers:"transparent",winner:"#50B649!important",loser:"#E61A1A!important",connector:"#999"},space:{gameMarginInlineEnd:"0.75rem"},participant:{seed:"transparent"},fontSizes:{1:"1.5rem"}}),L2e=mb("dark-theme",{colors:{backgroundColor:"#333333",borderHover:"#0091d2",color:"white"},participant:{seed:"cyan"}}),F2e=mb("itf-theme",{colors:{borderHover:"#0091d2",connector:"#999",matchUp:"#fff"},participant:{textTransform:"uppercase",seed:"gray"}}),k1={Australian:{configuration:{flags:!0},theme:E8},Basic:{configuration:{gameScoreOnly:!0,teamLogo:!1,roundHeader:!0,placeHolders:{tbd:"-",bye:"Bye"}},theme:M8},DrawPositions:{configuration:{gameScoreOnly:!0,drawPositions:!0,teamLogo:!1},theme:M8},French:{configuration:{bracketedSeeds:!0,flags:!0},theme:x2e},Wimbledon:{configuration:{resultsInfo:!0,flags:!0},theme:k2e},"US Open":{configuration:{scoreBox:!0,flags:!0},theme:O2e},ITF:{configuration:{winnerChevron:!0,centerInfo:!0,flags:!0,roundHeader:!0},theme:F2e},National:{configuration:{bracketedSeeds:"square",allDrawPositions:!0,drawPositions:!0,scheduleInfo:!0,roundHeader:!0,showAddress:!0,scaleAttributes:{scaleColor:"red",scaleType:"RATING",scaleName:"WTN",accessor:"wtnRating"}},theme:E8},Night:{configuration:{flags:!0},theme:L2e}};function Dw(){XR.close()}function lr(t){const{title:e,content:i,buttons:n,footer:r,onClose:o}=t,s={padding:!e&&!n?"":".5",maxWidth:500};return XR.open({title:e,content:i,footer:r,buttons:n,config:s,onClose:o})}function B2e(){const{tournamentRecord:t}=Ye.getTournament();if(!t)return;const i=[{label:"Cancel",intent:"none"},{label:$z,intent:"is-warning",onClick:iAe,close:!0},{label:"TODS",intent:"is-primary",onClick:()=>{t?eAe(`${t.tournamentId}.tods.json`,t):vi({message:"Error"})},close:!0}],n=`${Fn.tr("phrases.export")}: ${Fn.tr("trn")}`;lr({title:n,content:t.tournamentName,buttons:i})}function Zm(t){var n,r,o,a,s;const e=((n=t.tournamentName)==null?void 0:n.toLowerCase())||"Error",i=(o=(r=t.onlineResources)==null?void 0:r.find(({name:l,resourceType:c})=>l==="tournamentImage"&&c==="URL"))==null?void 0:o.identifier;return{tournamentId:t.tournamentId,id:t.tournamentId,searchText:e,tournament:{startDate:(a=new Date(t.startDate).toISOString())==null?void 0:a.split("T")[0],endDate:(s=new Date(t.endDate).toISOString())==null?void 0:s.split("T")[0],tournamentName:t.tournamentName,tournamentImageURL:i}}}const gb=t=>{let e;const i=Array.isArray(t)?t:[t];return n=>{if(e&&i.forEach(r=>r.removeFilter(e)),n){const r=n==null?void 0:n.toLowerCase();e=o=>{var a;return(a=o.searchText)==null?void 0:a.includes(r)},i.forEach(o=>o.addFilter(e))}else e=void 0}};function $2e({callback:t,autoClose:e=!0}={}){const i=s=>{const l=s.name.split(".").reverse()[0];let c=new FileReader;c.onload=function(u){if(u.target.error){console.log("file error",u.target.error);return}let d=u.target.result;d.length&&(vt(t)?t(d):console.log(d))},["csv","json"].includes(l)?c.readAsText(s):console.log("not loaded")},n=document.createElement("div");n.className="dzx-dropzone",n.id="tmxDropzone";const r=document.createElement("label");r.className="dzx-inputLabel",r.innerHTML="Drag and Drop files into this zone";const o=document.createElement("input");o.className="dzx-input",o.setAttribute("type","file"),o.setAttribute("accept","application/json"),r.appendChild(o),n.appendChild(r),lr({buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Done"}],title:"Import tournament records",content:n}),["drag","dragstart","dragend","dragover","dragenter","dragleave","drop"].forEach(s=>{n.addEventListener(s,function(l){l.preventDefault(),l.stopPropagation()})});const a="dropone-dragging";n.addEventListener("dragover",function(){this.classList.add(a)},!1),n.addEventListener("dragleave",function(){this.classList.remove(a)},!1),n.addEventListener("drop",function(s){const l=o.getAttribute("multiple");this.classList.remove(a);const c=s.dataTransfer.files,u=new DataTransfer;Array.prototype.forEach.call(c,p=>{if(u.items.add(p),!l)return!1});const d=u.files;Array.from(d).forEach(i),e&&Dw()},!1)}const Wr=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ra=Object.keys,Is=Array.isArray;function dl(t,e){return typeof e!="object"||ra(e).forEach(function(i){t[i]=e[i]}),t}typeof Promise>"u"||Wr.Promise||(Wr.Promise=Promise);const BU=Object.getPrototypeOf,V2e={}.hasOwnProperty;function Hc(t,e){return V2e.call(t,e)}function Pw(t,e){typeof e=="function"&&(e=e(BU(t))),(typeof Reflect>"u"?ra:Reflect.ownKeys)(e).forEach(i=>{$h(t,i,e[i])})}const jme=Object.defineProperty;function $h(t,e,i,n){jme(t,e,dl(i&&Hc(i,"get")&&typeof i.get=="function"?{get:i.get,set:i.set,configurable:!0}:{value:i,configurable:!0,writable:!0},n))}function DI(t){return{from:function(e){return t.prototype=Object.create(e.prototype),$h(t.prototype,"constructor",t),{extend:Pw.bind(null,t.prototype)}}}}const j2e=Object.getOwnPropertyDescriptor;function qq(t,e){let i;return j2e(t,e)||(i=BU(t))&&qq(i,e)}const H2e=[].slice;function JR(t,e,i){return H2e.call(t,e,i)}function Hme(t,e){return e(t)}function FS(t){if(!t)throw new Error("Assertion Failed")}function Gme(t){Wr.setImmediate?setImmediate(t):setTimeout(t,0)}function zme(t,e){return t.reduce((i,n,r)=>{var o=e(n,r);return o&&(i[o[0]]=o[1]),i},{})}function Vh(t,e){if(typeof e=="string"&&Hc(t,e))return t[e];if(!e)return t;if(typeof e!="string"){for(var i=[],n=0,r=e.length;n<r;++n){var o=Vh(t,e[n]);i.push(o)}return i}var a=e.indexOf(".");if(a!==-1){var s=t[e.substr(0,a)];return s===void 0?void 0:Vh(s,e.substr(a+1))}}function pd(t,e,i){if(t&&e!==void 0&&(!("isFrozen"in Object)||!Object.isFrozen(t)))if(typeof e!="string"&&"length"in e){FS(typeof i!="string"&&"length"in i);for(var n=0,r=e.length;n<r;++n)pd(t,e[n],i[n])}else{var o=e.indexOf(".");if(o!==-1){var a=e.substr(0,o),s=e.substr(o+1);if(s==="")i===void 0?Is(t)&&!isNaN(parseInt(a))?t.splice(a,1):delete t[a]:t[a]=i;else{var l=t[a];l&&Hc(t,a)||(l=t[a]={}),pd(l,s,i)}}else i===void 0?Is(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=i}}function Wme(t){var e={};for(var i in t)Hc(t,i)&&(e[i]=t[i]);return e}const G2e=[].concat;function qme(t){return G2e.apply([],t)}const Yme="BigUint64Array,BigInt64Array,Array,Boolean,String,Date,RegExp,Blob,File,FileList,FileSystemFileHandle,FileSystemDirectoryHandle,ArrayBuffer,DataView,Uint8ClampedArray,ImageBitmap,ImageData,Map,Set,CryptoKey".split(",").concat(qme([8,16,32,64].map(t=>["Int","Uint","Float"].map(e=>e+t+"Array")))).filter(t=>Wr[t]),z2e=Yme.map(t=>Wr[t]);zme(Yme,t=>[t,!0]);let nm=null;function kC(t){nm=typeof WeakMap<"u"&&new WeakMap;const e=wB(t);return nm=null,e}function wB(t){if(!t||typeof t!="object")return t;let e=nm&&nm.get(t);if(e)return e;if(Is(t)){e=[],nm&&nm.set(t,e);for(var i=0,n=t.length;i<n;++i)e.push(wB(t[i]))}else if(z2e.indexOf(t.constructor)>=0)e=t;else{const o=BU(t);for(var r in e=o===Object.prototype?{}:Object.create(o),nm&&nm.set(t,e),t)Hc(t,r)&&(e[r]=wB(t[r]))}return e}const{toString:W2e}={};function SB(t){return W2e.call(t).slice(8,-1)}const TB=typeof Symbol<"u"?Symbol.iterator:"@@iterator",q2e=typeof TB=="symbol"?function(t){var e;return t!=null&&(e=t[TB])&&e.apply(t)}:function(){return null},tI={};function Eh(t){var e,i,n,r;if(arguments.length===1){if(Is(t))return t.slice();if(this===tI&&typeof t=="string")return[t];if(r=q2e(t)){for(i=[];!(n=r.next()).done;)i.push(n.value);return i}if(t==null)return[t];if(typeof(e=t.length)=="number"){for(i=new Array(e);e--;)i[e]=t[e];return i}return[t]}for(e=arguments.length,i=new Array(e);e--;)i[e]=arguments[e];return i}const Yq=typeof Symbol<"u"?t=>t[Symbol.toStringTag]==="AsyncFunction":()=>!1;var ih=typeof location<"u"&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function Kme(t,e){ih=t,Zme=e}var Zme=()=>!0;const Y2e=!new Error("").stack;function vb(){if(Y2e)try{throw vb.arguments,new Error}catch(t){return t}return new Error}function UB(t,e){var i=t.stack;return i?(e=e||0,i.indexOf(t.name)===0&&(e+=(t.name+t.message).split(`
`).length),i.split(`
`).slice(e).filter(Zme).map(n=>`
`+n).join("")):""}var Xme=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Kq=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(Xme),K2e={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed",MissingAPI:"IndexedDB API missing. Please visit https://tinyurl.com/y2uuvskb"};function PI(t,e){this._e=vb(),this.name=t,this.message=e}function Jme(t,e){return t+". Errors: "+Object.keys(e).map(i=>e[i].toString()).filter((i,n,r)=>r.indexOf(i)===n).join(`
`)}function QR(t,e,i,n){this._e=vb(),this.failures=e,this.failedKeys=n,this.successCount=i,this.message=Jme(t,e)}function pT(t,e){this._e=vb(),this.name="BulkError",this.failures=Object.keys(e).map(i=>e[i]),this.failuresByPos=e,this.message=Jme(t,e)}DI(PI).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+UB(this._e,2))}},toString:function(){return this.name+": "+this.message}}),DI(QR).from(PI),DI(pT).from(PI);var Zq=Kq.reduce((t,e)=>(t[e]=e+"Error",t),{});const Z2e=PI;var Ti=Kq.reduce((t,e)=>{var i=e+"Error";function n(r,o){this._e=vb(),this.name=i,r?typeof r=="string"?(this.message=`${r}${o?`
 `+o:""}`,this.inner=o||null):typeof r=="object"&&(this.message=`${r.name} ${r.message}`,this.inner=r):(this.message=K2e[e]||i,this.inner=null)}return DI(n).from(Z2e),t[e]=n,t},{});Ti.Syntax=SyntaxError,Ti.Type=TypeError,Ti.Range=RangeError;var R8=Xme.reduce((t,e)=>(t[e+"Error"]=Ti[e],t),{}),WE=Kq.reduce((t,e)=>(["Syntax","Type","Range"].indexOf(e)===-1&&(t[e+"Error"]=Ti[e]),t),{});function Dr(){}function $U(t){return t}function X2e(t,e){return t==null||t===$U?e:function(i){return e(t(i))}}function ay(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function J2e(t,e){return t===Dr?e:function(){var i=t.apply(this,arguments);i!==void 0&&(arguments[0]=i);var n=this.onsuccess,r=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ay(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ay(r,this.onerror):r),o!==void 0?o:i}}function Q2e(t,e){return t===Dr?e:function(){t.apply(this,arguments);var i=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),i&&(this.onsuccess=this.onsuccess?ay(i,this.onsuccess):i),n&&(this.onerror=this.onerror?ay(n,this.onerror):n)}}function eBe(t,e){return t===Dr?e:function(i){var n=t.apply(this,arguments);dl(i,n);var r=this.onsuccess,o=this.onerror;this.onsuccess=null,this.onerror=null;var a=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ay(r,this.onsuccess):r),o&&(this.onerror=this.onerror?ay(o,this.onerror):o),n===void 0?a===void 0?void 0:a:dl(n,a)}}function tBe(t,e){return t===Dr?e:function(){return e.apply(this,arguments)!==!1&&t.apply(this,arguments)}}function Xq(t,e){return t===Dr?e:function(){var i=t.apply(this,arguments);if(i&&typeof i.then=="function"){for(var n=this,r=arguments.length,o=new Array(r);r--;)o[r]=arguments[r];return i.then(function(){return e.apply(n,o)})}return e.apply(this,arguments)}}WE.ModifyError=QR,WE.DexieError=PI,WE.BulkError=pT;var VU={};const Qme=100,[DB,eN,PB]=typeof Promise>"u"?[]:(()=>{let t=Promise.resolve();if(typeof crypto>"u"||!crypto.subtle)return[t,BU(t),t];const e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,BU(e),t]})(),ege=eN&&eN.then,qE=DB&&DB.constructor,Jq=!!PB;var CB=!1,iBe=PB?()=>{PB.then(x1)}:Wr.setImmediate?setImmediate.bind(null,x1):Wr.MutationObserver?()=>{var t=document.createElement("div");new MutationObserver(()=>{x1(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:()=>{setTimeout(x1,0)},hT=function(t,e){BS.push([t,e]),tN&&(iBe(),tN=!1)},EB=!0,tN=!0,Cv=[],YE=[],MB=null,RB=$U,CI={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:_8,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(t=>{try{_8(t[0],t[1])}catch{}})}},oi=CI,BS=[],Ev=0,KE=[];function Nt(t){if(typeof this!="object")throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Dr,this._lib=!1;var e=this._PSD=oi;if(ih&&(this._stackHolder=vb(),this._prev=null,this._numPrev=0),typeof t!="function"){if(t!==VU)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(this._state===!1&&AB(this,this._value))}this._state=null,this._value=null,++e.ref,ige(this,t)}const NB={get:function(){var t=oi,e=iN;function i(n,r){var o=!t.global&&(t!==oi||e!==iN);const a=o&&!df();var s=new Nt((l,c)=>{Qq(this,new tge(nN(n,t,o,a),nN(r,t,o,a),l,c,t))});return ih&&oge(s,this),s}return i.prototype=VU,i},set:function(t){$h(this,"then",t&&t.prototype===VU?NB:{get:function(){return t},set:NB.set})}};function tge(t,e,i,n,r){this.onFulfilled=typeof t=="function"?t:null,this.onRejected=typeof e=="function"?e:null,this.resolve=i,this.reject=n,this.psd=r}function ige(t,e){try{e(i=>{if(t._state===null){if(i===t)throw new TypeError("A promise cannot be resolved with itself.");var n=t._lib&&xC();i&&typeof i.then=="function"?ige(t,(r,o)=>{i instanceof Nt?i._then(r,o):i.then(r,o)}):(t._state=!0,t._value=i,nge(t)),n&&OC()}},AB.bind(null,t))}catch(i){AB(t,i)}}function AB(t,e){if(YE.push(e),t._state===null){var i=t._lib&&xC();e=RB(e),t._state=!1,t._value=e,ih&&e!==null&&typeof e=="object"&&!e._promise&&function(n,r,o){try{n.apply(null,o)}catch(a){r&&r(a)}}(()=>{var n=qq(e,"stack");e._promise=t,$h(e,"stack",{get:()=>CB?n&&(n.get?n.get.apply(e):n.value):t.stack})}),function(n){Cv.some(r=>r._value===n._value)||Cv.push(n)}(t),nge(t),i&&OC()}}function nge(t){var e=t._listeners;t._listeners=[];for(var i=0,n=e.length;i<n;++i)Qq(t,e[i]);var r=t._PSD;--r.ref||r.finalize(),Ev===0&&(++Ev,hT(()=>{--Ev==0&&e4()},[]))}function Qq(t,e){if(t._state!==null){var i=t._state?e.onFulfilled:e.onRejected;if(i===null)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Ev,hT(nBe,[i,t,e])}else t._listeners.push(e)}function nBe(t,e,i){try{MB=e;var n,r=e._value;e._state?n=t(r):(YE.length&&(YE=[]),n=t(r),YE.indexOf(r)===-1&&function(o){for(var a=Cv.length;a;)if(Cv[--a]._value===o._value)return void Cv.splice(a,1)}(e)),i.resolve(n)}catch(o){i.reject(o)}finally{MB=null,--Ev==0&&e4(),--i.psd.ref||i.psd.finalize()}}function rge(t,e,i){if(e.length===i)return e;var n="";if(t._state===!1){var r,o,a=t._value;a!=null?(r=a.name||"Error",o=a.message||a,n=UB(a,0)):(r=a,o=""),e.push(r+(o?": "+o:"")+n)}return ih&&((n=UB(t._stackHolder,2))&&e.indexOf(n)===-1&&e.push(n),t._prev&&rge(t._prev,e,i)),e}function oge(t,e){var i=e?e._numPrev+1:0;i<100&&(t._prev=e,t._numPrev=i)}function x1(){xC()&&OC()}function xC(){var t=EB;return EB=!1,tN=!1,t}function OC(){var t,e,i;do for(;BS.length>0;)for(t=BS,BS=[],i=t.length,e=0;e<i;++e){var n=t[e];n[0].apply(null,n[1])}while(BS.length>0);EB=!0,tN=!0}function e4(){var t=Cv;Cv=[],t.forEach(n=>{n._PSD.onunhandled.call(null,n._value,n)});for(var e=KE.slice(0),i=e.length;i;)e[--i]()}function O1(t){return new Nt(VU,!1,t)}function ao(t,e){var i=oi;return function(){var n=xC(),r=oi;try{return Jm(i,!0),t.apply(this,arguments)}catch(o){e&&e(o)}finally{Jm(r,!1),n&&OC()}}}Pw(Nt.prototype,{then:NB,_then:function(t,e){Qq(this,new tge(null,null,t,e,oi))},catch:function(t){if(arguments.length===1)return this.then(null,t);var e=arguments[0],i=arguments[1];return typeof e=="function"?this.then(null,n=>n instanceof e?i(n):O1(n)):this.then(null,n=>n&&n.name===e?i(n):O1(n))},finally:function(t){return this.then(e=>(t(),e),e=>(t(),O1(e)))},stack:{get:function(){if(this._stack)return this._stack;try{CB=!0;var t=rge(this,[],20).join(`
From previous: `);return this._state!==null&&(this._stack=t),t}finally{CB=!1}}},timeout:function(t,e){return t<1/0?new Nt((i,n)=>{var r=setTimeout(()=>n(new Ti.Timeout(e)),t);this.then(i,n).finally(clearTimeout.bind(null,r))}):this}}),typeof Symbol<"u"&&Symbol.toStringTag&&$h(Nt.prototype,Symbol.toStringTag,"Dexie.Promise"),CI.env=age(),Pw(Nt,{all:function(){var t=Eh.apply(null,arguments).map(L1);return new Nt(function(e,i){t.length===0&&e([]);var n=t.length;t.forEach((r,o)=>Nt.resolve(r).then(a=>{t[o]=a,--n||e(t)},i))})},resolve:t=>{if(t instanceof Nt)return t;if(t&&typeof t.then=="function")return new Nt((i,n)=>{t.then(i,n)});var e=new Nt(VU,!0,t);return oge(e,MB),e},reject:O1,race:function(){var t=Eh.apply(null,arguments).map(L1);return new Nt((e,i)=>{t.map(n=>Nt.resolve(n).then(e,i))})},PSD:{get:()=>oi,set:t=>oi=t},totalEchoes:{get:()=>iN},newPSD:Xm,usePSD:J0,scheduler:{get:()=>hT,set:t=>{hT=t}},rejectionMapper:{get:()=>RB,set:t=>{RB=t}},follow:(t,e)=>new Nt((i,n)=>Xm((r,o)=>{var a=oi;a.unhandleds=[],a.onunhandled=o,a.finalize=ay(function(){(function(s){function l(){s(),KE.splice(KE.indexOf(l),1)}KE.push(l),++Ev,hT(()=>{--Ev==0&&e4()},[])})(()=>{this.unhandleds.length===0?r():o(this.unhandleds[0])})},a.finalize),t()},e,i,n))}),qE&&(qE.allSettled&&$h(Nt,"allSettled",function(){const t=Eh.apply(null,arguments).map(L1);return new Nt(e=>{t.length===0&&e([]);let i=t.length;const n=new Array(i);t.forEach((r,o)=>Nt.resolve(r).then(a=>n[o]={status:"fulfilled",value:a},a=>n[o]={status:"rejected",reason:a}).then(()=>--i||e(n)))})}),qE.any&&typeof AggregateError<"u"&&$h(Nt,"any",function(){const t=Eh.apply(null,arguments).map(L1);return new Nt((e,i)=>{t.length===0&&i(new AggregateError([]));let n=t.length;const r=new Array(n);t.forEach((o,a)=>Nt.resolve(o).then(s=>e(s),s=>{r[a]=s,--n||i(new AggregateError(r))}))})}));const bs={awaits:0,echoes:0,id:0};var rBe=0,ZE=[],wL=0,iN=0,oBe=0;function Xm(t,e,i,n){var r=oi,o=Object.create(r);o.parent=r,o.ref=0,o.global=!1,o.id=++oBe;var a=CI.env;o.env=Jq?{Promise:Nt,PromiseProp:{value:Nt,configurable:!0,writable:!0},all:Nt.all,race:Nt.race,allSettled:Nt.allSettled,any:Nt.any,resolve:Nt.resolve,reject:Nt.reject,nthen:N8(a.nthen,o),gthen:N8(a.gthen,o)}:{},e&&dl(o,e),++r.ref,o.finalize=function(){--this.parent.ref||this.parent.finalize()};var s=J0(o,t,i,n);return o.ref===0&&o.finalize(),s}function X0(){return bs.id||(bs.id=++rBe),++bs.awaits,bs.echoes+=Qme,bs.id}function df(){return!!bs.awaits&&(--bs.awaits==0&&(bs.id=0),bs.echoes=bs.awaits*Qme,!0)}function L1(t){return bs.echoes&&t&&t.constructor===qE?(X0(),t.then(e=>(df(),e),e=>(df(),wa(e)))):t}function aBe(t){++iN,bs.echoes&&--bs.echoes!=0||(bs.echoes=bs.id=0),ZE.push(oi),Jm(t,!0)}function sBe(){var t=ZE[ZE.length-1];ZE.pop(),Jm(t,!1)}function Jm(t,e){var i=oi;if((e?!bs.echoes||wL++&&t===oi:!wL||--wL&&t===oi)||sge(e?aBe.bind(null,t):sBe),t!==oi&&(oi=t,i===CI&&(CI.env=age()),Jq)){var n=CI.env.Promise,r=t.env;eN.then=r.nthen,n.prototype.then=r.gthen,(i.global||t.global)&&(Object.defineProperty(Wr,"Promise",r.PromiseProp),n.all=r.all,n.race=r.race,n.resolve=r.resolve,n.reject=r.reject,r.allSettled&&(n.allSettled=r.allSettled),r.any&&(n.any=r.any))}}function age(){var t=Wr.Promise;return Jq?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(Wr,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:eN.then,gthen:t.prototype.then}:{}}function J0(t,e,i,n,r){var o=oi;try{return Jm(t,!0),e(i,n,r)}finally{Jm(o,!1)}}function sge(t){ege.call(DB,t)}function nN(t,e,i,n){return typeof t!="function"?t:function(){var r=oi;i&&X0(),Jm(e,!0);try{return t.apply(this,arguments)}finally{Jm(r,!1),n&&sge(df)}}}function N8(t,e){return function(i,n){return t.call(this,nN(i,e),nN(n,e))}}(""+ege).indexOf("[native code]")===-1&&(X0=df=Dr);const A8="unhandledrejection";function _8(t,e){var i;try{i=e.onuncatched(t)}catch{}if(i!==!1)try{var n,r={promise:e,reason:t};if(Wr.document&&document.createEvent?((n=document.createEvent("Event")).initEvent(A8,!0,!0),dl(n,r)):Wr.CustomEvent&&dl(n=new CustomEvent(A8,{detail:r}),r),n&&Wr.dispatchEvent&&(dispatchEvent(n),!Wr.PromiseRejectionEvent&&Wr.onunhandledrejection))try{Wr.onunhandledrejection(n)}catch{}ih&&n&&!n.defaultPrevented&&console.warn(`Unhandled rejection: ${t.stack||t}`)}catch{}}var wa=Nt.reject;function _B(t,e,i,n){if(t.idbdb&&(t._state.openComplete||oi.letThrough||t._vip)){var r=t._createTransaction(e,i,t._dbSchema);try{r.create(),t._state.PR1398_maxLoop=3}catch(o){return o.name===Zq.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>_B(t,e,i,n))):wa(o)}return r._promise(e,(o,a)=>Xm(()=>(oi.trans=r,n(o,a,r)))).then(o=>r._completion.then(()=>o))}if(t._state.openComplete)return wa(new Ti.DatabaseClosed(t._state.dbOpenError));if(!t._state.isBeingOpened){if(!t._options.autoOpen)return wa(new Ti.DatabaseClosed);t.open().catch(Dr)}return t._state.dbReadyPromise.then(()=>_B(t,e,i,n))}const k8="3.2.5",rv="￿",kB=-1/0,fh="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",lge="String expected.",fT=[],Ex=typeof navigator<"u"&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),lBe=Ex,cBe=Ex,cge=t=>!/(dexie\.js|dexie\.min\.js)/.test(t),Mx="__dbnames",SL="readonly",TL="readwrite";function sy(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}const uge={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function F1(t){return typeof t!="string"||/\./.test(t)?e=>e:e=>(e[t]===void 0&&t in e&&delete(e=kC(e))[t],e)}class uBe{_trans(e,i,n){const r=this._tx||oi.trans,o=this.name;function a(l,c,u){if(!u.schema[o])throw new Ti.NotFound("Table "+o+" not part of transaction");return i(u.idbtrans,u)}const s=xC();try{return r&&r.db===this.db?r===oi.trans?r._promise(e,a,n):Xm(()=>r._promise(e,a,n),{trans:r,transless:oi.transless||oi}):_B(this.db,e,[this.name],a)}finally{s&&OC()}}get(e,i){return e&&e.constructor===Object?this.where(e).first(i):this._trans("readonly",n=>this.core.get({trans:n,key:e}).then(r=>this.hook.reading.fire(r))).then(i)}where(e){if(typeof e=="string")return new this.db.WhereClause(this,e);if(Is(e))return new this.db.WhereClause(this,`[${e.join("+")}]`);const i=ra(e);if(i.length===1)return this.where(i[0]).equals(e[i[0]]);const n=this.schema.indexes.concat(this.schema.primKey).filter(c=>{if(c.compound&&i.every(u=>c.keyPath.indexOf(u)>=0)){for(let u=0;u<i.length;++u)if(i.indexOf(c.keyPath[u])===-1)return!1;return!0}return!1}).sort((c,u)=>c.keyPath.length-u.keyPath.length)[0];if(n&&this.db._maxKey!==rv){const c=n.keyPath.slice(0,i.length);return this.where(c).equals(c.map(u=>e[u]))}!n&&ih&&console.warn(`The query ${JSON.stringify(e)} on ${this.name} would benefit of a compound index [${i.join("+")}]`);const{idxByName:r}=this.schema,o=this.db._deps.indexedDB;function a(c,u){try{return o.cmp(c,u)===0}catch{return!1}}const[s,l]=i.reduce(([c,u],d)=>{const p=r[d],h=e[d];return[c||p,c||!p?sy(u,p&&p.multi?f=>{const m=Vh(f,d);return Is(m)&&m.some(g=>a(h,g))}:f=>a(h,Vh(f,d))):u]},[null,null]);return s?this.where(s.name).equals(e[s.keyPath]).filter(l):n?this.filter(l):this.where(i).equals("")}filter(e){return this.toCollection().and(e)}count(e){return this.toCollection().count(e)}offset(e){return this.toCollection().offset(e)}limit(e){return this.toCollection().limit(e)}each(e){return this.toCollection().each(e)}toArray(e){return this.toCollection().toArray(e)}toCollection(){return new this.db.Collection(new this.db.WhereClause(this))}orderBy(e){return new this.db.Collection(new this.db.WhereClause(this,Is(e)?`[${e.join("+")}]`:e))}reverse(){return this.toCollection().reverse()}mapToClass(e){this.schema.mappedClass=e;const i=n=>{if(!n)return n;const r=Object.create(e.prototype);for(var o in n)if(Hc(n,o))try{r[o]=n[o]}catch{}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=i,this.hook("reading",i),e}defineClass(){return this.mapToClass(function(e){dl(this,e)})}add(e,i){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=F1(r)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"add",keys:i!=null?[i]:null,values:[o]})).then(a=>a.numFailures?Nt.reject(a.failures[0]):a.lastResult).then(a=>{if(r)try{pd(e,r,a)}catch{}return a})}update(e,i){if(typeof e!="object"||Is(e))return this.where(":id").equals(e).modify(i);{const n=Vh(e,this.schema.primKey.keyPath);if(n===void 0)return wa(new Ti.InvalidArgument("Given object does not contain its primary key"));try{typeof i!="function"?ra(i).forEach(r=>{pd(e,r,i[r])}):i(e,{value:e,primKey:n})}catch{}return this.where(":id").equals(n).modify(i)}}put(e,i){const{auto:n,keyPath:r}=this.schema.primKey;let o=e;return r&&n&&(o=F1(r)(e)),this._trans("readwrite",a=>this.core.mutate({trans:a,type:"put",values:[o],keys:i!=null?[i]:null})).then(a=>a.numFailures?Nt.reject(a.failures[0]):a.lastResult).then(a=>{if(r)try{pd(e,r,a)}catch{}return a})}delete(e){return this._trans("readwrite",i=>this.core.mutate({trans:i,type:"delete",keys:[e]})).then(i=>i.numFailures?Nt.reject(i.failures[0]):void 0)}clear(){return this._trans("readwrite",e=>this.core.mutate({trans:e,type:"deleteRange",range:uge})).then(e=>e.numFailures?Nt.reject(e.failures[0]):void 0)}bulkGet(e){return this._trans("readonly",i=>this.core.getMany({keys:e,trans:i}).then(n=>n.map(r=>this.hook.reading.fire(r))))}bulkAdd(e,i,n){const r=Array.isArray(i)?i:void 0,o=(n=n||(r?void 0:i))?n.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:s,keyPath:l}=this.schema.primKey;if(l&&r)throw new Ti.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new Ti.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let u=l&&s?e.map(F1(l)):e;return this.core.mutate({trans:a,type:"add",keys:r,values:u,wantResults:o}).then(({numFailures:d,results:p,lastResult:h,failures:f})=>{if(d===0)return o?p:h;throw new pT(`${this.name}.bulkAdd(): ${d} of ${c} operations failed`,f)})})}bulkPut(e,i,n){const r=Array.isArray(i)?i:void 0,o=(n=n||(r?void 0:i))?n.allKeys:void 0;return this._trans("readwrite",a=>{const{auto:s,keyPath:l}=this.schema.primKey;if(l&&r)throw new Ti.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(r&&r.length!==e.length)throw new Ti.InvalidArgument("Arguments objects and keys must have the same length");const c=e.length;let u=l&&s?e.map(F1(l)):e;return this.core.mutate({trans:a,type:"put",keys:r,values:u,wantResults:o}).then(({numFailures:d,results:p,lastResult:h,failures:f})=>{if(d===0)return o?p:h;throw new pT(`${this.name}.bulkPut(): ${d} of ${c} operations failed`,f)})})}bulkDelete(e){const i=e.length;return this._trans("readwrite",n=>this.core.mutate({trans:n,type:"delete",keys:e})).then(({numFailures:n,lastResult:r,failures:o})=>{if(n===0)return r;throw new pT(`${this.name}.bulkDelete(): ${n} of ${i} operations failed`,o)})}}function mT(t){var e={},i=function(a,s){if(s){for(var l=arguments.length,c=new Array(l-1);--l;)c[l-1]=arguments[l];return e[a].subscribe.apply(null,c),t}if(typeof a=="string")return e[a]};i.addEventType=o;for(var n=1,r=arguments.length;n<r;++n)o(arguments[n]);return i;function o(a,s,l){if(typeof a!="object"){var c;s||(s=tBe),l||(l=Dr);var u={subscribers:[],fire:l,subscribe:function(d){u.subscribers.indexOf(d)===-1&&(u.subscribers.push(d),u.fire=s(u.fire,d))},unsubscribe:function(d){u.subscribers=u.subscribers.filter(function(p){return p!==d}),u.fire=u.subscribers.reduce(s,l)}};return e[a]=i[a]=u,u}ra(c=a).forEach(function(d){var p=c[d];if(Is(p))o(d,c[d][0],c[d][1]);else{if(p!=="asap")throw new Ti.InvalidArgument("Invalid event config");var h=o(d,$U,function(){for(var f=arguments.length,m=new Array(f);f--;)m[f]=arguments[f];h.subscribers.forEach(function(g){Gme(function(){g.apply(null,m)})})})}})}}function fS(t,e){return DI(e).from({prototype:t}),e}function Fb(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function UL(t,e){t.filter=sy(t.filter,e)}function DL(t,e,i){var n=t.replayFilter;t.replayFilter=n?()=>sy(n(),e()):e,t.justLimit=i&&!n}function XE(t,e){if(t.isPrimKey)return e.primaryKey;const i=e.getIndexByKeyPath(t.index);if(!i)throw new Ti.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return i}function x8(t,e,i){const n=XE(t,e.schema);return e.openCursor({trans:i,values:!t.keysOnly,reverse:t.dir==="prev",unique:!!t.unique,query:{index:n,range:t.range}})}function B1(t,e,i,n){const r=t.replayFilter?sy(t.filter,t.replayFilter()):t.filter;if(t.or){const o={},a=(s,l,c)=>{if(!r||r(l,c,p=>l.stop(p),p=>l.fail(p))){var u=l.primaryKey,d=""+u;d==="[object ArrayBuffer]"&&(d=""+new Uint8Array(u)),Hc(o,d)||(o[d]=!0,e(s,l,c))}};return Promise.all([t.or._iterate(a,i),O8(x8(t,n,i),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return O8(x8(t,n,i),sy(t.algorithm,r),e,!t.keysOnly&&t.valueMapper)}function O8(t,e,i,n){var r=ao(n?(o,a,s)=>i(n(o),a,s):i);return t.then(o=>{if(o)return o.start(()=>{var a=()=>o.continue();e&&!e(o,s=>a=s,s=>{o.stop(s),a=Dr},s=>{o.fail(s),a=Dr})||r(o.value,o,s=>a=s),a()})})}function zs(t,e){try{const i=L8(t),n=L8(e);if(i!==n)return i==="Array"?1:n==="Array"?-1:i==="binary"?1:n==="binary"?-1:i==="string"?1:n==="string"?-1:i==="Date"?1:n!=="Date"?NaN:-1;switch(i){case"number":case"Date":case"string":return t>e?1:t<e?-1:0;case"binary":return function(r,o){const a=r.length,s=o.length,l=a<s?a:s;for(let c=0;c<l;++c)if(r[c]!==o[c])return r[c]<o[c]?-1:1;return a===s?0:a<s?-1:1}(F8(t),F8(e));case"Array":return function(r,o){const a=r.length,s=o.length,l=a<s?a:s;for(let c=0;c<l;++c){const u=zs(r[c],o[c]);if(u!==0)return u}return a===s?0:a<s?-1:1}(t,e)}}catch{}return NaN}function L8(t){const e=typeof t;if(e!=="object")return e;if(ArrayBuffer.isView(t))return"binary";const i=SB(t);return i==="ArrayBuffer"?"binary":i}function F8(t){return t instanceof Uint8Array?t:ArrayBuffer.isView(t)?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):new Uint8Array(t)}class dBe{_read(e,i){var n=this._ctx;return n.error?n.table._trans(null,wa.bind(null,n.error)):n.table._trans("readonly",e).then(i)}_write(e){var i=this._ctx;return i.error?i.table._trans(null,wa.bind(null,i.error)):i.table._trans("readwrite",e,"locked")}_addAlgorithm(e){var i=this._ctx;i.algorithm=sy(i.algorithm,e)}_iterate(e,i){return B1(this._ctx,e,i,this._ctx.table.core)}clone(e){var i=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&dl(n,e),i._ctx=n,i}raw(){return this._ctx.valueMapper=null,this}each(e){var i=this._ctx;return this._read(n=>B1(i,e,n,i.table.core))}count(e){return this._read(i=>{const n=this._ctx,r=n.table.core;if(Fb(n,!0))return r.count({trans:i,query:{index:XE(n,r.schema),range:n.range}}).then(a=>Math.min(a,n.limit));var o=0;return B1(n,()=>(++o,!1),i,r).then(()=>o)}).then(e)}sortBy(e,i){const n=e.split(".").reverse(),r=n[0],o=n.length-1;function a(c,u){return u?a(c[n[u]],u-1):c[r]}var s=this._ctx.dir==="next"?1:-1;function l(c,u){var d=a(c,o),p=a(u,o);return d<p?-s:d>p?s:0}return this.toArray(function(c){return c.sort(l)}).then(i)}toArray(e){return this._read(i=>{var n=this._ctx;if(n.dir==="next"&&Fb(n,!0)&&n.limit>0){const{valueMapper:r}=n,o=XE(n,n.table.core.schema);return n.table.core.query({trans:i,limit:n.limit,values:!0,query:{index:o,range:n.range}}).then(({result:a})=>r?a.map(r):a)}{const r=[];return B1(n,o=>r.push(o),i,n.table.core).then(()=>r)}},e)}offset(e){var i=this._ctx;return e<=0||(i.offset+=e,Fb(i)?DL(i,()=>{var n=e;return(r,o)=>n===0||(n===1?(--n,!1):(o(()=>{r.advance(n),n=0}),!1))}):DL(i,()=>{var n=e;return()=>--n<0})),this}limit(e){return this._ctx.limit=Math.min(this._ctx.limit,e),DL(this._ctx,()=>{var i=e;return function(n,r,o){return--i<=0&&r(o),i>=0}},!0),this}until(e,i){return UL(this._ctx,function(n,r,o){return!e(n.value)||(r(o),i)}),this}first(e){return this.limit(1).toArray(function(i){return i[0]}).then(e)}last(e){return this.reverse().first(e)}filter(e){var i,n;return UL(this._ctx,function(r){return e(r.value)}),i=this._ctx,n=e,i.isMatch=sy(i.isMatch,n),this}and(e){return this.filter(e)}or(e){return new this.db.WhereClause(this._ctx.table,e,this)}reverse(){return this._ctx.dir=this._ctx.dir==="prev"?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this}desc(){return this.reverse()}eachKey(e){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(n,r){e(r.key,r)})}eachUniqueKey(e){return this._ctx.unique="unique",this.eachKey(e)}eachPrimaryKey(e){var i=this._ctx;return i.keysOnly=!i.isMatch,this.each(function(n,r){e(r.primaryKey,r)})}keys(e){var i=this._ctx;i.keysOnly=!i.isMatch;var n=[];return this.each(function(r,o){n.push(o.key)}).then(function(){return n}).then(e)}primaryKeys(e){var i=this._ctx;if(i.dir==="next"&&Fb(i,!0)&&i.limit>0)return this._read(r=>{var o=XE(i,i.table.core.schema);return i.table.core.query({trans:r,values:!1,limit:i.limit,query:{index:o,range:i.range}})}).then(({result:r})=>r).then(e);i.keysOnly=!i.isMatch;var n=[];return this.each(function(r,o){n.push(o.primaryKey)}).then(function(){return n}).then(e)}uniqueKeys(e){return this._ctx.unique="unique",this.keys(e)}firstKey(e){return this.limit(1).keys(function(i){return i[0]}).then(e)}lastKey(e){return this.reverse().firstKey(e)}distinct(){var e=this._ctx,i=e.index&&e.table.schema.idxByName[e.index];if(!i||!i.multi)return this;var n={};return UL(this._ctx,function(r){var o=r.primaryKey.toString(),a=Hc(n,o);return n[o]=!0,!a}),this}modify(e){var i=this._ctx;return this._write(n=>{var r;if(typeof e=="function")r=e;else{var o=ra(e),a=o.length;r=function(m){for(var g=!1,v=0;v<a;++v){var y=o[v],b=e[y];Vh(m,y)!==b&&(pd(m,y,b),g=!0)}return g}}const s=i.table.core,{outbound:l,extractKey:c}=s.schema.primaryKey,u=this.db._options.modifyChunkSize||200,d=[];let p=0;const h=[],f=(m,g)=>{const{failures:v,numFailures:y}=g;p+=m-y;for(let b of ra(v))d.push(v[b])};return this.clone().primaryKeys().then(m=>{const g=v=>{const y=Math.min(u,m.length-v);return s.getMany({trans:n,keys:m.slice(v,v+y),cache:"immutable"}).then(b=>{const I=[],T=[],S=l?[]:null,w=[];for(let D=0;D<y;++D){const E=b[D],C={value:kC(E),primKey:m[v+D]};r.call(C,C.value,C)!==!1&&(C.value==null?w.push(m[v+D]):l||zs(c(E),c(C.value))===0?(T.push(C.value),l&&S.push(m[v+D])):(w.push(m[v+D]),I.push(C.value)))}const U=Fb(i)&&i.limit===1/0&&(typeof e!="function"||e===PL)&&{index:i.index,range:i.range};return Promise.resolve(I.length>0&&s.mutate({trans:n,type:"add",values:I}).then(D=>{for(let E in D.failures)w.splice(parseInt(E),1);f(I.length,D)})).then(()=>(T.length>0||U&&typeof e=="object")&&s.mutate({trans:n,type:"put",keys:S,values:T,criteria:U,changeSpec:typeof e!="function"&&e}).then(D=>f(T.length,D))).then(()=>(w.length>0||U&&e===PL)&&s.mutate({trans:n,type:"delete",keys:w,criteria:U}).then(D=>f(w.length,D))).then(()=>m.length>v+y&&g(v+u))})};return g(0).then(()=>{if(d.length>0)throw new QR("Error modifying one or more objects",d,p,h);return m.length})})})}delete(){var e=this._ctx,i=e.range;return Fb(e)&&(e.isPrimKey&&!cBe||i.type===3)?this._write(n=>{const{primaryKey:r}=e.table.core.schema,o=i;return e.table.core.count({trans:n,query:{index:r,range:o}}).then(a=>e.table.core.mutate({trans:n,type:"deleteRange",range:o}).then(({failures:s,lastResult:l,results:c,numFailures:u})=>{if(u)throw new QR("Could not delete some values",Object.keys(s).map(d=>s[d]),a-u);return a-u}))}):this.modify(PL)}}const PL=(t,e)=>e.value=null;function pBe(t,e){return t<e?-1:t===e?0:1}function hBe(t,e){return t>e?-1:t===e?0:1}function dc(t,e,i){var n=t instanceof pge?new t.Collection(t):t;return n._ctx.error=i?new i(e):new TypeError(e),n}function Bb(t){return new t.Collection(t,()=>dge("")).limit(0)}function fBe(t,e,i,n,r,o){for(var a=Math.min(t.length,n.length),s=-1,l=0;l<a;++l){var c=e[l];if(c!==n[l])return r(t[l],i[l])<0?t.substr(0,l)+i[l]+i.substr(l+1):r(t[l],n[l])<0?t.substr(0,l)+n[l]+i.substr(l+1):s>=0?t.substr(0,s)+e[s]+i.substr(s+1):null;r(t[l],c)<0&&(s=l)}return a<n.length&&o==="next"?t+i.substr(t.length):a<t.length&&o==="prev"?t.substr(0,i.length):s<0?null:t.substr(0,s)+n[s]+i.substr(s+1)}function $1(t,e,i,n){var r,o,a,s,l,c,u,d=i.length;if(!i.every(m=>typeof m=="string"))return dc(t,lge);function p(m){r=function(v){return v==="next"?y=>y.toUpperCase():y=>y.toLowerCase()}(m),o=function(v){return v==="next"?y=>y.toLowerCase():y=>y.toUpperCase()}(m),a=m==="next"?pBe:hBe;var g=i.map(function(v){return{lower:o(v),upper:r(v)}}).sort(function(v,y){return a(v.lower,y.lower)});s=g.map(function(v){return v.upper}),l=g.map(function(v){return v.lower}),c=m,u=m==="next"?"":n}p("next");var h=new t.Collection(t,()=>Qf(s[0],l[d-1]+n));h._ondirectionchange=function(m){p(m)};var f=0;return h._addAlgorithm(function(m,g,v){var y=m.key;if(typeof y!="string")return!1;var b=o(y);if(e(b,l,f))return!0;for(var I=null,T=f;T<d;++T){var S=fBe(y,b,s[T],l[T],a,c);S===null&&I===null?f=T+1:(I===null||a(I,S)>0)&&(I=S)}return g(I!==null?function(){m.continue(I+u)}:v),!1}),h}function Qf(t,e,i,n){return{type:2,lower:t,upper:e,lowerOpen:i,upperOpen:n}}function dge(t){return{type:1,lower:t,upper:t}}class pge{get Collection(){return this._ctx.table.db.Collection}between(e,i,n,r){n=n!==!1,r=r===!0;try{return this._cmp(e,i)>0||this._cmp(e,i)===0&&(n||r)&&(!n||!r)?Bb(this):new this.Collection(this,()=>Qf(e,i,!n,!r))}catch{return dc(this,fh)}}equals(e){return e==null?dc(this,fh):new this.Collection(this,()=>dge(e))}above(e){return e==null?dc(this,fh):new this.Collection(this,()=>Qf(e,void 0,!0))}aboveOrEqual(e){return e==null?dc(this,fh):new this.Collection(this,()=>Qf(e,void 0,!1))}below(e){return e==null?dc(this,fh):new this.Collection(this,()=>Qf(void 0,e,!1,!0))}belowOrEqual(e){return e==null?dc(this,fh):new this.Collection(this,()=>Qf(void 0,e))}startsWith(e){return typeof e!="string"?dc(this,lge):this.between(e,e+rv,!0,!0)}startsWithIgnoreCase(e){return e===""?this.startsWith(e):$1(this,(i,n)=>i.indexOf(n[0])===0,[e],rv)}equalsIgnoreCase(e){return $1(this,(i,n)=>i===n[0],[e],"")}anyOfIgnoreCase(){var e=Eh.apply(tI,arguments);return e.length===0?Bb(this):$1(this,(i,n)=>n.indexOf(i)!==-1,e,"")}startsWithAnyOfIgnoreCase(){var e=Eh.apply(tI,arguments);return e.length===0?Bb(this):$1(this,(i,n)=>n.some(r=>i.indexOf(r)===0),e,rv)}anyOf(){const e=Eh.apply(tI,arguments);let i=this._cmp;try{e.sort(i)}catch{return dc(this,fh)}if(e.length===0)return Bb(this);const n=new this.Collection(this,()=>Qf(e[0],e[e.length-1]));n._ondirectionchange=o=>{i=o==="next"?this._ascending:this._descending,e.sort(i)};let r=0;return n._addAlgorithm((o,a,s)=>{const l=o.key;for(;i(l,e[r])>0;)if(++r,r===e.length)return a(s),!1;return i(l,e[r])===0||(a(()=>{o.continue(e[r])}),!1)}),n}notEqual(e){return this.inAnyRange([[kB,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})}noneOf(){const e=Eh.apply(tI,arguments);if(e.length===0)return new this.Collection(this);try{e.sort(this._ascending)}catch{return dc(this,fh)}const i=e.reduce((n,r)=>n?n.concat([[n[n.length-1][1],r]]):[[kB,r]],null);return i.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(i,{includeLowers:!1,includeUppers:!1})}inAnyRange(e,i){const n=this._cmp,r=this._ascending,o=this._descending,a=this._min,s=this._max;if(e.length===0)return Bb(this);if(!e.every(y=>y[0]!==void 0&&y[1]!==void 0&&r(y[0],y[1])<=0))return dc(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Ti.InvalidArgument);const l=!i||i.includeLowers!==!1,c=i&&i.includeUppers===!0;let u,d=r;function p(y,b){return d(y[0],b[0])}try{u=e.reduce(function(y,b){let I=0,T=y.length;for(;I<T;++I){const S=y[I];if(n(b[0],S[1])<0&&n(b[1],S[0])>0){S[0]=a(S[0],b[0]),S[1]=s(S[1],b[1]);break}}return I===T&&y.push(b),y},[]),u.sort(p)}catch{return dc(this,fh)}let h=0;const f=c?y=>r(y,u[h][1])>0:y=>r(y,u[h][1])>=0,m=l?y=>o(y,u[h][0])>0:y=>o(y,u[h][0])>=0;let g=f;const v=new this.Collection(this,()=>Qf(u[0][0],u[u.length-1][1],!l,!c));return v._ondirectionchange=y=>{y==="next"?(g=f,d=r):(g=m,d=o),u.sort(p)},v._addAlgorithm((y,b,I)=>{for(var T=y.key;g(T);)if(++h,h===u.length)return b(I),!1;return!!function(S){return!f(S)&&!m(S)}(T)||(this._cmp(T,u[h][1])===0||this._cmp(T,u[h][0])===0||b(()=>{d===r?y.continue(u[h][0]):y.continue(u[h][1])}),!1)}),v}startsWithAnyOf(){const e=Eh.apply(tI,arguments);return e.every(i=>typeof i=="string")?e.length===0?Bb(this):this.inAnyRange(e.map(i=>[i,i+rv])):dc(this,"startsWithAnyOf() only works with strings")}}function Wd(t){return ao(function(e){return jU(e),t(e.target.error),!1})}function jU(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}const HU="storagemutated",lm="x-storagemutated-1",Qm=mT(null,HU);class mBe{_lock(){return FS(!oi.global),++this._reculock,this._reculock!==1||oi.global||(oi.lockOwnerFor=this),this}_unlock(){if(FS(!oi.global),--this._reculock==0)for(oi.global||(oi.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{J0(e[1],e[0])}catch{}}return this}_locked(){return this._reculock&&oi.lockOwnerFor!==this}create(e){if(!this.mode)return this;const i=this.db.idbdb,n=this.db._state.dbOpenError;if(FS(!this.idbtrans),!e&&!i)switch(n&&n.name){case"DatabaseClosedError":throw new Ti.DatabaseClosed(n);case"MissingAPIError":throw new Ti.MissingAPI(n.message,n);default:throw new Ti.OpenFailed(n)}if(!this.active)throw new Ti.TransactionInactive;return FS(this._completion._state===null),(e=this.idbtrans=e||(this.db.core?this.db.core.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}):i.transaction(this.storeNames,this.mode,{durability:this.chromeTransactionDurability}))).onerror=ao(r=>{jU(r),this._reject(e.error)}),e.onabort=ao(r=>{jU(r),this.active&&this._reject(new Ti.Abort(e.error)),this.active=!1,this.on("abort").fire(r)}),e.oncomplete=ao(()=>{this.active=!1,this._resolve(),"mutatedParts"in e&&Qm.storagemutated.fire(e.mutatedParts)}),this}_promise(e,i,n){if(e==="readwrite"&&this.mode!=="readwrite")return wa(new Ti.ReadOnly("Transaction is readonly"));if(!this.active)return wa(new Ti.TransactionInactive);if(this._locked())return new Nt((o,a)=>{this._blockedFuncs.push([()=>{this._promise(e,i,n).then(o,a)},oi])});if(n)return Xm(()=>{var o=new Nt((a,s)=>{this._lock();const l=i(a,s,this);l&&l.then&&l.then(a,s)});return o.finally(()=>this._unlock()),o._lib=!0,o});var r=new Nt((o,a)=>{var s=i(o,a,this);s&&s.then&&s.then(o,a)});return r._lib=!0,r}_root(){return this.parent?this.parent._root():this}waitFor(e){var i=this._root();const n=Nt.resolve(e);if(i._waitingFor)i._waitingFor=i._waitingFor.then(()=>n);else{i._waitingFor=n,i._waitingQueue=[];var r=i.idbtrans.objectStore(i.storeNames[0]);(function a(){for(++i._spinCount;i._waitingQueue.length;)i._waitingQueue.shift()();i._waitingFor&&(r.get(-1/0).onsuccess=a)})()}var o=i._waitingFor;return new Nt((a,s)=>{n.then(l=>i._waitingQueue.push(ao(a.bind(null,l))),l=>i._waitingQueue.push(ao(s.bind(null,l)))).finally(()=>{i._waitingFor===o&&(i._waitingFor=null)})})}abort(){this.active&&(this.active=!1,this.idbtrans&&this.idbtrans.abort(),this._reject(new Ti.Abort))}table(e){const i=this._memoizedTables||(this._memoizedTables={});if(Hc(i,e))return i[e];const n=this.schema[e];if(!n)throw new Ti.NotFound("Table "+e+" not part of transaction");const r=new this.db.Table(e,n,this);return r.core=this.db.core.table(e),i[e]=r,r}}function xB(t,e,i,n,r,o,a){return{name:t,keyPath:e,unique:i,multi:n,auto:r,compound:o,src:(i&&!a?"&":"")+(n?"*":"")+(r?"++":"")+hge(e)}}function hge(t){return typeof t=="string"?t:t?"["+[].join.call(t,"+")+"]":""}function fge(t,e,i){return{name:t,primKey:e,indexes:i,mappedClass:null,idxByName:zme(i,n=>[n.name,n])}}let GU=t=>{try{return t.only([[]]),GU=()=>[[]],[[]]}catch{return GU=()=>rv,rv}};function OB(t){return t==null?()=>{}:typeof t=="string"?function(e){return e.split(".").length===1?n=>n[e]:n=>Vh(n,e)}(t):e=>Vh(e,t)}function B8(t){return[].slice.call(t)}let gBe=0;function gT(t){return t==null?":id":typeof t=="string"?t:`[${t.join("+")}]`}function vBe(t,e,i){function n(l){if(l.type===3)return null;if(l.type===4)throw new Error("Cannot convert never type to IDBKeyRange");const{lower:c,upper:u,lowerOpen:d,upperOpen:p}=l;return c===void 0?u===void 0?null:e.upperBound(u,!!p):u===void 0?e.lowerBound(c,!!d):e.bound(c,u,!!d,!!p)}const{schema:r,hasGetAll:o}=function(l,c){const u=B8(l.objectStoreNames);return{schema:{name:l.name,tables:u.map(d=>c.objectStore(d)).map(d=>{const{keyPath:p,autoIncrement:h}=d,f=Is(p),m=p==null,g={},v={name:d.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:m,compound:f,keyPath:p,autoIncrement:h,unique:!0,extractKey:OB(p)},indexes:B8(d.indexNames).map(y=>d.index(y)).map(y=>{const{name:b,unique:I,multiEntry:T,keyPath:S}=y,w={name:b,compound:Is(S),keyPath:S,unique:I,multiEntry:T,extractKey:OB(S)};return g[gT(S)]=w,w}),getIndexByKeyPath:y=>g[gT(y)]};return g[":id"]=v.primaryKey,p!=null&&(g[gT(p)]=v.primaryKey),v})},hasGetAll:u.length>0&&"getAll"in c.objectStore(u[0])&&!(typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,i),a=r.tables.map(l=>function(c){const u=c.name;return{name:u,schema:c,mutate:function({trans:d,type:p,keys:h,values:f,range:m}){return new Promise((g,v)=>{g=ao(g);const y=d.objectStore(u),b=y.keyPath==null,I=p==="put"||p==="add";if(!I&&p!=="delete"&&p!=="deleteRange")throw new Error("Invalid operation type: "+p);const{length:T}=h||f||{length:1};if(h&&f&&h.length!==f.length)throw new Error("Given keys array must have same length as given values array.");if(T===0)return g({numFailures:0,failures:{},results:[],lastResult:void 0});let S;const w=[],U=[];let D=0;const E=M=>{++D,jU(M)};if(p==="deleteRange"){if(m.type===4)return g({numFailures:D,failures:U,results:[],lastResult:void 0});m.type===3?w.push(S=y.clear()):w.push(S=y.delete(n(m)))}else{const[M,N]=I?b?[f,h]:[f,null]:[h,null];if(I)for(let R=0;R<T;++R)w.push(S=N&&N[R]!==void 0?y[p](M[R],N[R]):y[p](M[R])),S.onerror=E;else for(let R=0;R<T;++R)w.push(S=y[p](M[R])),S.onerror=E}const C=M=>{const N=M.target.result;w.forEach((R,A)=>R.error!=null&&(U[A]=R.error)),g({numFailures:D,failures:U,results:p==="delete"?h:w.map(R=>R.result),lastResult:N})};S.onerror=M=>{E(M),C(M)},S.onsuccess=C})},getMany:({trans:d,keys:p})=>new Promise((h,f)=>{h=ao(h);const m=d.objectStore(u),g=p.length,v=new Array(g);let y,b=0,I=0;const T=w=>{const U=w.target;v[U._pos]=U.result,++I===b&&h(v)},S=Wd(f);for(let w=0;w<g;++w)p[w]!=null&&(y=m.get(p[w]),y._pos=w,y.onsuccess=T,y.onerror=S,++b);b===0&&h(v)}),get:({trans:d,key:p})=>new Promise((h,f)=>{h=ao(h);const m=d.objectStore(u).get(p);m.onsuccess=g=>h(g.target.result),m.onerror=Wd(f)}),query:function(d){return p=>new Promise((h,f)=>{h=ao(h);const{trans:m,values:g,limit:v,query:y}=p,b=v===1/0?void 0:v,{index:I,range:T}=y,S=m.objectStore(u),w=I.isPrimaryKey?S:S.index(I.name),U=n(T);if(v===0)return h({result:[]});if(d){const D=g?w.getAll(U,b):w.getAllKeys(U,b);D.onsuccess=E=>h({result:E.target.result}),D.onerror=Wd(f)}else{let D=0;const E=g||!("openKeyCursor"in w)?w.openCursor(U):w.openKeyCursor(U),C=[];E.onsuccess=M=>{const N=E.result;return N?(C.push(g?N.value:N.primaryKey),++D===v?h({result:C}):void N.continue()):h({result:C})},E.onerror=Wd(f)}})}(o),openCursor:function({trans:d,values:p,query:h,reverse:f,unique:m}){return new Promise((g,v)=>{g=ao(g);const{index:y,range:b}=h,I=d.objectStore(u),T=y.isPrimaryKey?I:I.index(y.name),S=f?m?"prevunique":"prev":m?"nextunique":"next",w=p||!("openKeyCursor"in T)?T.openCursor(n(b),S):T.openKeyCursor(n(b),S);w.onerror=Wd(v),w.onsuccess=ao(U=>{const D=w.result;if(!D)return void g(null);D.___id=++gBe,D.done=!1;const E=D.continue.bind(D);let C=D.continuePrimaryKey;C&&(C=C.bind(D));const M=D.advance.bind(D),N=()=>{throw new Error("Cursor not stopped")};D.trans=d,D.stop=D.continue=D.continuePrimaryKey=D.advance=()=>{throw new Error("Cursor not started")},D.fail=ao(v),D.next=function(){let R=1;return this.start(()=>R--?this.continue():this.stop()).then(()=>this)},D.start=R=>{const A=new Promise((k,O)=>{k=ao(k),w.onerror=Wd(O),D.fail=O,D.stop=F=>{D.stop=D.continue=D.continuePrimaryKey=D.advance=N,k(F)}}),_=()=>{if(w.result)try{R()}catch(k){D.fail(k)}else D.done=!0,D.start=()=>{throw new Error("Cursor behind last entry")},D.stop()};return w.onsuccess=ao(k=>{w.onsuccess=_,_()}),D.continue=E,D.continuePrimaryKey=C,D.advance=M,_(),A},g(D)},v)})},count({query:d,trans:p}){const{index:h,range:f}=d;return new Promise((m,g)=>{const v=p.objectStore(u),y=h.isPrimaryKey?v:v.index(h.name),b=n(f),I=b?y.count(b):y.count();I.onsuccess=ao(T=>m(T.target.result)),I.onerror=Wd(g)})}}}(l)),s={};return a.forEach(l=>s[l.name]=l),{stack:"dbcore",transaction:t.transaction.bind(t),table(l){if(!s[l])throw new Error(`Table '${l}' not found`);return s[l]},MIN_KEY:-1/0,MAX_KEY:GU(e),schema:r}}function LB({_novip:t},e){const i=e.db,n=function(r,o,{IDBKeyRange:a,indexedDB:s},l){return{dbcore:function(u,d){return d.reduce((p,{create:h})=>({...p,...h(p)}),u)}(vBe(o,a,l),r.dbcore)}}(t._middlewares,i,t._deps,e);t.core=n.dbcore,t.tables.forEach(r=>{const o=r.name;t.core.schema.tables.some(a=>a.name===o)&&(r.core=t.core.table(o),t[o]instanceof t.Table&&(t[o].core=r.core))})}function rN({_novip:t},e,i,n){i.forEach(r=>{const o=n[r];e.forEach(a=>{const s=qq(a,r);(!s||"value"in s&&s.value===void 0)&&(a===t.Transaction.prototype||a instanceof t.Transaction?$h(a,r,{get(){return this.table(r)},set(l){jme(this,r,{value:l,writable:!0,configurable:!0,enumerable:!0})}}):a[r]=new t.Table(r,o))})})}function FB({_novip:t},e){e.forEach(i=>{for(let n in i)i[n]instanceof t.Table&&delete i[n]})}function yBe(t,e){return t._cfg.version-e._cfg.version}function bBe(t,e,i,n){const r=t._dbSchema,o=t._createTransaction("readwrite",t._storeNames,r);o.create(i),o._completion.catch(n);const a=o._reject.bind(o),s=oi.transless||oi;Xm(()=>{oi.trans=o,oi.transless=s,e===0?(ra(r).forEach(l=>{CL(i,l,r[l].primKey,r[l].indexes)}),LB(t,i),Nt.follow(()=>t.on.populate.fire(o)).catch(a)):function({_novip:l},c,u,d){const p=[],h=l._versions;let f=l._dbSchema=$B(l,l.idbdb,d),m=!1;const g=h.filter(y=>y._cfg.version>=c);function v(){return p.length?Nt.resolve(p.shift()(u.idbtrans)).then(v):Nt.resolve()}return g.forEach(y=>{p.push(()=>{const b=f,I=y._cfg.dbschema;VB(l,b,d),VB(l,I,d),f=l._dbSchema=I;const T=mge(b,I);T.add.forEach(w=>{CL(d,w[0],w[1].primKey,w[1].indexes)}),T.change.forEach(w=>{if(w.recreate)throw new Ti.Upgrade("Not yet support for changing primary key");{const U=d.objectStore(w.name);w.add.forEach(D=>BB(U,D)),w.change.forEach(D=>{U.deleteIndex(D.name),BB(U,D)}),w.del.forEach(D=>U.deleteIndex(D))}});const S=y._cfg.contentUpgrade;if(S&&y._cfg.version>c){LB(l,d),u._memoizedTables={},m=!0;let w=Wme(I);T.del.forEach(C=>{w[C]=b[C]}),FB(l,[l.Transaction.prototype]),rN(l,[l.Transaction.prototype],ra(w),w),u.schema=w;const U=Yq(S);let D;U&&X0();const E=Nt.follow(()=>{if(D=S(u),D&&U){var C=df.bind(null,null);D.then(C,C)}});return D&&typeof D.then=="function"?Nt.resolve(D):E.then(()=>D)}}),p.push(b=>{(!m||!lBe)&&function(I,T){[].slice.call(T.db.objectStoreNames).forEach(S=>I[S]==null&&T.db.deleteObjectStore(S))}(y._cfg.dbschema,b),FB(l,[l.Transaction.prototype]),rN(l,[l.Transaction.prototype],l._storeNames,l._dbSchema),u.schema=l._dbSchema})}),v().then(()=>{var y,b;b=d,ra(y=f).forEach(I=>{b.db.objectStoreNames.contains(I)||CL(b,I,y[I].primKey,y[I].indexes)})})}(t,e,o,i).catch(a)})}function mge(t,e){const i={del:[],add:[],change:[]};let n;for(n in t)e[n]||i.del.push(n);for(n in e){const r=t[n],o=e[n];if(r){const a={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(r.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||r.primKey.auto!==o.primKey.auto&&!Ex)a.recreate=!0,i.change.push(a);else{const s=r.idxByName,l=o.idxByName;let c;for(c in s)l[c]||a.del.push(c);for(c in l){const u=s[c],d=l[c];u?u.src!==d.src&&a.change.push(d):a.add.push(d)}(a.del.length>0||a.add.length>0||a.change.length>0)&&i.change.push(a)}}else i.add.push([n,o])}return i}function CL(t,e,i,n){const r=t.db.createObjectStore(e,i.keyPath?{keyPath:i.keyPath,autoIncrement:i.auto}:{autoIncrement:i.auto});return n.forEach(o=>BB(r,o)),r}function BB(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function $B(t,e,i){const n={};return JR(e.objectStoreNames,0).forEach(r=>{const o=i.objectStore(r);let a=o.keyPath;const s=xB(hge(a),a||"",!1,!1,!!o.autoIncrement,a&&typeof a!="string",!0),l=[];for(let u=0;u<o.indexNames.length;++u){const d=o.index(o.indexNames[u]);a=d.keyPath;var c=xB(d.name,a,!!d.unique,!!d.multiEntry,!1,a&&typeof a!="string",!1);l.push(c)}n[r]=fge(r,s,l)}),n}function VB({_novip:t},e,i){const n=i.db.objectStoreNames;for(let r=0;r<n.length;++r){const o=n[r],a=i.objectStore(o);t._hasGetAll="getAll"in a;for(let s=0;s<a.indexNames.length;++s){const l=a.indexNames[s],c=a.index(l).keyPath,u=typeof c=="string"?c:"["+JR(c).join("+")+"]";if(e[o]){const d=e[o].idxByName[u];d&&(d.name=l,delete e[o].idxByName[u],e[o].idxByName[l]=d)}}}typeof navigator<"u"&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&Wr.WorkerGlobalScope&&Wr instanceof Wr.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}class IBe{_parseStoresSpec(e,i){ra(e).forEach(n=>{if(e[n]!==null){var r=e[n].split(",").map((a,s)=>{const l=(a=a.trim()).replace(/([&*]|\+\+)/g,""),c=/^\[/.test(l)?l.match(/^\[(.*)\]$/)[1].split("+"):l;return xB(l,c||null,/\&/.test(a),/\*/.test(a),/\+\+/.test(a),Is(c),s===0)}),o=r.shift();if(o.multi)throw new Ti.Schema("Primary key cannot be multi-valued");r.forEach(a=>{if(a.auto)throw new Ti.Schema("Only primary key can be marked as autoIncrement (++)");if(!a.keyPath)throw new Ti.Schema("Index must have a name and cannot be an empty string")}),i[n]=fge(n,o,r)}})}stores(e){const i=this.db;this._cfg.storesSource=this._cfg.storesSource?dl(this._cfg.storesSource,e):e;const n=i._versions,r={};let o={};return n.forEach(a=>{dl(r,a._cfg.storesSource),o=a._cfg.dbschema={},a._parseStoresSpec(r,o)}),i._dbSchema=o,FB(i,[i._allTables,i,i.Transaction.prototype]),rN(i,[i._allTables,i,i.Transaction.prototype,this._cfg.tables],ra(o),o),i._storeNames=ra(o),this}upgrade(e){return this._cfg.contentUpgrade=Xq(this._cfg.contentUpgrade||Dr,e),this}}function t4(t,e){let i=t._dbNamesDB;return i||(i=t._dbNamesDB=new lp(Mx,{addons:[],indexedDB:t,IDBKeyRange:e}),i.version(1).stores({dbnames:"name"})),i.table("dbnames")}function i4(t){return t&&typeof t.databases=="function"}function jB(t){return Xm(function(){return oi.letThrough=!0,t()})}function wBe(){var t;return!navigator.userAgentData&&/Safari\//.test(navigator.userAgent)&&!/Chrom(e|ium)\//.test(navigator.userAgent)&&indexedDB.databases?new Promise(function(e){var i=function(){return indexedDB.databases().finally(e)};t=setInterval(i,100),i()}).finally(function(){return clearInterval(t)}):Promise.resolve()}function SBe(t){const e=t._state,{indexedDB:i}=t._deps;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(()=>e.dbOpenError?wa(e.dbOpenError):t);ih&&(e.openCanceller._stackHolder=vb()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;const n=e.openCanceller;function r(){if(e.openCanceller!==n)throw new Ti.DatabaseClosed("db.open() was cancelled")}let o=e.dbReadyResolve,a=null,s=!1;const l=()=>new Nt((c,u)=>{if(r(),!i)throw new Ti.MissingAPI;const d=t.name,p=e.autoSchema?i.open(d):i.open(d,Math.round(10*t.verno));if(!p)throw new Ti.MissingAPI;p.onerror=Wd(u),p.onblocked=ao(t._fireOnBlocked),p.onupgradeneeded=ao(h=>{if(a=p.transaction,e.autoSchema&&!t._options.allowEmptyDB){p.onerror=jU,a.abort(),p.result.close();const m=i.deleteDatabase(d);m.onsuccess=m.onerror=ao(()=>{u(new Ti.NoSuchDatabase(`Database ${d} doesnt exist`))})}else{a.onerror=Wd(u);var f=h.oldVersion>Math.pow(2,62)?0:h.oldVersion;s=f<1,t._novip.idbdb=p.result,bBe(t,f/10,a,u)}},u),p.onsuccess=ao(()=>{a=null;const h=t._novip.idbdb=p.result,f=JR(h.objectStoreNames);if(f.length>0)try{const g=h.transaction((m=f).length===1?m[0]:m,"readonly");e.autoSchema?function({_novip:v},y,b){v.verno=y.version/10;const I=v._dbSchema=$B(0,y,b);v._storeNames=JR(y.objectStoreNames,0),rN(v,[v._allTables],ra(I),I)}(t,h,g):(VB(t,t._dbSchema,g),function(v,y){const b=mge($B(0,v.idbdb,y),v._dbSchema);return!(b.add.length||b.change.some(I=>I.add.length||I.change.length))}(t,g)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),LB(t,g)}catch{}var m;fT.push(t),h.onversionchange=ao(g=>{e.vcFired=!0,t.on("versionchange").fire(g)}),h.onclose=ao(g=>{t.on("close").fire(g)}),s&&function({indexedDB:g,IDBKeyRange:v},y){!i4(g)&&y!==Mx&&t4(g,v).put({name:y}).catch(Dr)}(t._deps,d),c()},u)}).catch(c=>c&&c.name==="UnknownError"&&e.PR1398_maxLoop>0?(e.PR1398_maxLoop--,console.warn("Dexie: Workaround for Chrome UnknownError on open()"),l()):Nt.reject(c));return Nt.race([n,(typeof navigator>"u"?Nt.resolve():wBe()).then(l)]).then(()=>(r(),e.onReadyBeingFired=[],Nt.resolve(jB(()=>t.on.ready.fire(t.vip))).then(function c(){if(e.onReadyBeingFired.length>0){let u=e.onReadyBeingFired.reduce(Xq,Dr);return e.onReadyBeingFired=[],Nt.resolve(jB(()=>u(t.vip))).then(c)}}))).finally(()=>{e.onReadyBeingFired=null,e.isBeingOpened=!1}).then(()=>t).catch(c=>{e.dbOpenError=c;try{a&&a.abort()}catch{}return n===e.openCanceller&&t._close(),wa(c)}).finally(()=>{e.openComplete=!0,o()})}function HB(t){var e=o=>t.next(o),i=r(e),n=r(o=>t.throw(o));function r(o){return a=>{var s=o(a),l=s.value;return s.done?l:l&&typeof l.then=="function"?l.then(i,n):Is(l)?Promise.all(l).then(i,n):i(l)}}return r(e)()}function TBe(t,e,i){var n=arguments.length;if(n<2)throw new Ti.InvalidArgument("Too few arguments");for(var r=new Array(n-1);--n;)r[n-1]=arguments[n];return i=r.pop(),[t,qme(r),i]}function gge(t,e,i,n,r){return Nt.resolve().then(()=>{const o=oi.transless||oi,a=t._createTransaction(e,i,t._dbSchema,n),s={trans:a,transless:o};if(n)a.idbtrans=n.idbtrans;else try{a.create(),t._state.PR1398_maxLoop=3}catch(d){return d.name===Zq.InvalidState&&t.isOpen()&&--t._state.PR1398_maxLoop>0?(console.warn("Dexie: Need to reopen db"),t._close(),t.open().then(()=>gge(t,e,i,null,r))):wa(d)}const l=Yq(r);let c;l&&X0();const u=Nt.follow(()=>{if(c=r.call(a,a),c)if(l){var d=df.bind(null,null);c.then(d,d)}else typeof c.next=="function"&&typeof c.throw=="function"&&(c=HB(c))},s);return(c&&typeof c.then=="function"?Nt.resolve(c).then(d=>a.active?d:wa(new Ti.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))):u.then(()=>c)).then(d=>(n&&a._resolve(),a._completion.then(()=>d))).catch(d=>(a._reject(d),wa(d)))})}function V1(t,e,i){const n=Is(t)?t.slice():[t];for(let r=0;r<i;++r)n.push(e);return n}const UBe={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(t){return{...t,table(e){const i=t.table(e),{schema:n}=i,r={},o=[];function a(u,d,p){const h=gT(u),f=r[h]=r[h]||[],m=u==null?0:typeof u=="string"?1:u.length,g=d>0,v={...p,isVirtual:g,keyTail:d,keyLength:m,extractKey:OB(u),unique:!g&&p.unique};return f.push(v),v.isPrimaryKey||o.push(v),m>1&&a(m===2?u[0]:u.slice(0,m-1),d+1,p),f.sort((y,b)=>y.keyTail-b.keyTail),v}const s=a(n.primaryKey.keyPath,0,n.primaryKey);r[":id"]=[s];for(const u of n.indexes)a(u.keyPath,0,u);function l(u){const d=u.query.index;return d.isVirtual?{...u,query:{index:d,range:(p=u.query.range,h=d.keyTail,{type:p.type===1?2:p.type,lower:V1(p.lower,p.lowerOpen?t.MAX_KEY:t.MIN_KEY,h),lowerOpen:!0,upper:V1(p.upper,p.upperOpen?t.MIN_KEY:t.MAX_KEY,h),upperOpen:!0})}}:u;var p,h}return{...i,schema:{...n,primaryKey:s,indexes:o,getIndexByKeyPath:function(u){const d=r[gT(u)];return d&&d[0]}},count:u=>i.count(l(u)),query:u=>i.query(l(u)),openCursor(u){const{keyTail:d,isVirtual:p,keyLength:h}=u.query.index;return p?i.openCursor(l(u)).then(f=>f&&function(m){return Object.create(m,{continue:{value:function(v){v!=null?m.continue(V1(v,u.reverse?t.MAX_KEY:t.MIN_KEY,d)):u.unique?m.continue(m.key.slice(0,h).concat(u.reverse?t.MIN_KEY:t.MAX_KEY,d)):m.continue()}},continuePrimaryKey:{value(v,y){m.continuePrimaryKey(V1(v,t.MAX_KEY,d),y)}},primaryKey:{get:()=>m.primaryKey},key:{get(){const v=m.key;return h===1?v[0]:v.slice(0,h)}},value:{get:()=>m.value}})}(f)):i.openCursor(u)}}}}}};function n4(t,e,i,n){return i=i||{},n=n||"",ra(t).forEach(r=>{if(Hc(e,r)){var o=t[r],a=e[r];if(typeof o=="object"&&typeof a=="object"&&o&&a){const s=SB(o);s!==SB(a)?i[n+r]=e[r]:s==="Object"?n4(o,a,i,n+r+"."):o!==a&&(i[n+r]=e[r])}else o!==a&&(i[n+r]=e[r])}else i[n+r]=void 0}),ra(e).forEach(r=>{Hc(t,r)||(i[n+r]=e[r])}),i}const DBe={stack:"dbcore",name:"HooksMiddleware",level:2,create:t=>({...t,table(e){const i=t.table(e),{primaryKey:n}=i.schema;return{...i,mutate(o){const a=oi.trans,{deleting:s,creating:l,updating:c}=a.table(e).hook;switch(o.type){case"add":if(l.fire===Dr)break;return a._promise("readwrite",()=>u(o),!0);case"put":if(l.fire===Dr&&c.fire===Dr)break;return a._promise("readwrite",()=>u(o),!0);case"delete":if(s.fire===Dr)break;return a._promise("readwrite",()=>u(o),!0);case"deleteRange":if(s.fire===Dr)break;return a._promise("readwrite",()=>function(p){return d(p.trans,p.range,1e4)}(o),!0)}return i.mutate(o);function u(p){const h=oi.trans,f=p.keys||function(m,g){return g.type==="delete"?g.keys:g.keys||g.values.map(m.extractKey)}(n,p);if(!f)throw new Error("Keys missing");return(p=p.type==="add"||p.type==="put"?{...p,keys:f}:{...p}).type!=="delete"&&(p.values=[...p.values]),p.keys&&(p.keys=[...p.keys]),function(m,g,v){return g.type==="add"?Promise.resolve([]):m.getMany({trans:g.trans,keys:v,cache:"immutable"})}(i,p,f).then(m=>{const g=f.map((v,y)=>{const b=m[y],I={onerror:null,onsuccess:null};if(p.type==="delete")s.fire.call(I,v,b,h);else if(p.type==="add"||b===void 0){const T=l.fire.call(I,v,p.values[y],h);v==null&&T!=null&&(v=T,p.keys[y]=v,n.outbound||pd(p.values[y],n.keyPath,v))}else{const T=n4(b,p.values[y]),S=c.fire.call(I,T,v,b,h);if(S){const w=p.values[y];Object.keys(S).forEach(U=>{Hc(w,U)?w[U]=S[U]:pd(w,U,S[U])})}}return I});return i.mutate(p).then(({failures:v,results:y,numFailures:b,lastResult:I})=>{for(let T=0;T<f.length;++T){const S=y?y[T]:f[T],w=g[T];S==null?w.onerror&&w.onerror(v[T]):w.onsuccess&&w.onsuccess(p.type==="put"&&m[T]?p.values[T]:S)}return{failures:v,results:y,numFailures:b,lastResult:I}}).catch(v=>(g.forEach(y=>y.onerror&&y.onerror(v)),Promise.reject(v)))})}function d(p,h,f){return i.query({trans:p,values:!1,query:{index:n,range:h},limit:f}).then(({result:m})=>u({type:"delete",keys:m,trans:p}).then(g=>g.numFailures>0?Promise.reject(g.failures[0]):m.length<f?{failures:[],numFailures:0,lastResult:void 0}:d(p,{...h,lower:m[m.length-1],lowerOpen:!0},f)))}}}}})};function vge(t,e,i){try{if(!e||e.keys.length<t.length)return null;const n=[];for(let r=0,o=0;r<e.keys.length&&o<t.length;++r)zs(e.keys[r],t[o])===0&&(n.push(i?kC(e.values[r]):e.values[r]),++o);return n.length===t.length?n:null}catch{return null}}const PBe={stack:"dbcore",level:-1,create:t=>({table:e=>{const i=t.table(e);return{...i,getMany:n=>{if(!n.cache)return i.getMany(n);const r=vge(n.keys,n.trans._cache,n.cache==="clone");return r?Nt.resolve(r):i.getMany(n).then(o=>(n.trans._cache={keys:n.keys,values:n.cache==="clone"?kC(o):o},o))},mutate:n=>(n.type!=="add"&&(n.trans._cache=null),i.mutate(n))}}})};function r4(t){return!("from"in t)}const Dh=function(t,e){if(!this){const i=new Dh;return t&&"d"in t&&dl(i,t),i}dl(this,arguments.length?{d:1,from:t,to:arguments.length>1?e:t}:{d:0})};function zU(t,e,i){const n=zs(e,i);if(isNaN(n))return;if(n>0)throw RangeError();if(r4(t))return dl(t,{from:e,to:i,d:1});const r=t.l,o=t.r;if(zs(i,t.from)<0)return r?zU(r,e,i):t.l={from:e,to:i,d:1,l:null,r:null},$8(t);if(zs(e,t.to)>0)return o?zU(o,e,i):t.r={from:e,to:i,d:1,l:null,r:null},$8(t);zs(e,t.from)<0&&(t.from=e,t.l=null,t.d=o?o.d+1:1),zs(i,t.to)>0&&(t.to=i,t.r=null,t.d=t.l?t.l.d+1:1);const a=!t.r;r&&!t.l&&oN(t,r),o&&a&&oN(t,o)}function oN(t,e){r4(e)||function i(n,{from:r,to:o,l:a,r:s}){zU(n,r,o),a&&i(n,a),s&&i(n,s)}(t,e)}function CBe(t,e){const i=GB(e);let n=i.next();if(n.done)return!1;let r=n.value;const o=GB(t);let a=o.next(r.from),s=a.value;for(;!n.done&&!a.done;){if(zs(s.from,r.to)<=0&&zs(s.to,r.from)>=0)return!0;zs(r.from,s.from)<0?r=(n=i.next(s.from)).value:s=(a=o.next(r.from)).value}return!1}function GB(t){let e=r4(t)?null:{s:0,n:t};return{next(i){const n=arguments.length>0;for(;e;)switch(e.s){case 0:if(e.s=1,n)for(;e.n.l&&zs(i,e.n.from)<0;)e={up:e,n:e.n.l,s:1};else for(;e.n.l;)e={up:e,n:e.n.l,s:1};case 1:if(e.s=2,!n||zs(i,e.n.to)<=0)return{value:e.n,done:!1};case 2:if(e.n.r){e.s=3,e={up:e,n:e.n.r,s:0};continue}case 3:e=e.up}return{done:!0}}}}function $8(t){var e,i;const n=(((e=t.r)===null||e===void 0?void 0:e.d)||0)-(((i=t.l)===null||i===void 0?void 0:i.d)||0),r=n>1?"r":n<-1?"l":"";if(r){const o=r==="r"?"l":"r",a={...t},s=t[r];t.from=s.from,t.to=s.to,t[r]=s[r],a[r]=s[o],t[o]=a,a.d=V8(a)}t.d=V8(t)}function V8({r:t,l:e}){return(t?e?Math.max(t.d,e.d):t.d:e?e.d:0)+1}Pw(Dh.prototype,{add(t){return oN(this,t),this},addKey(t){return zU(this,t,t),this},addKeys(t){return t.forEach(e=>zU(this,e,e)),this},[TB](){return GB(this)}});const EBe={stack:"dbcore",level:0,create:t=>{const e=t.schema.name,i=new Dh(t.MIN_KEY,t.MAX_KEY);return{...t,table:n=>{const r=t.table(n),{schema:o}=r,{primaryKey:a}=o,{extractKey:s,outbound:l}=a,c={...r,mutate:p=>{const h=p.trans,f=h.mutatedParts||(h.mutatedParts={}),m=S=>{const w=`idb://${e}/${n}/${S}`;return f[w]||(f[w]=new Dh)},g=m(""),v=m(":dels"),{type:y}=p;let[b,I]=p.type==="deleteRange"?[p.range]:p.type==="delete"?[p.keys]:p.values.length<50?[[],p.values]:[];const T=p.trans._cache;return r.mutate(p).then(S=>{if(Is(b)){y!=="delete"&&(b=S.results),g.addKeys(b);const w=vge(b,T);w||y==="add"||v.addKeys(b),(w||I)&&function(U,D,E,C){function M(N){const R=U(N.name||"");function A(k){return k!=null?N.extractKey(k):null}const _=k=>N.multiEntry&&Is(k)?k.forEach(O=>R.addKey(O)):R.addKey(k);(E||C).forEach((k,O)=>{const F=E&&A(E[O]),B=C&&A(C[O]);zs(F,B)!==0&&(F!=null&&_(F),B!=null&&_(B))})}D.indexes.forEach(M)}(m,o,w,I)}else if(b){const w={from:b.lower,to:b.upper};v.add(w),g.add(w)}else g.add(i),v.add(i),o.indexes.forEach(w=>m(w.name).add(i));return S})}},u=({query:{index:p,range:h}})=>{var f,m;return[p,new Dh((f=h.lower)!==null&&f!==void 0?f:t.MIN_KEY,(m=h.upper)!==null&&m!==void 0?m:t.MAX_KEY)]},d={get:p=>[a,new Dh(p.key)],getMany:p=>[a,new Dh().addKeys(p.keys)],count:u,query:u,openCursor:u};return ra(d).forEach(p=>{c[p]=function(h){const{subscr:f}=oi;if(f){const m=I=>{const T=`idb://${e}/${n}/${I}`;return f[T]||(f[T]=new Dh)},g=m(""),v=m(":dels"),[y,b]=d[p](h);if(m(y.name||"").add(b),!y.isPrimaryKey){if(p!=="count"){const I=p==="query"&&l&&h.values&&r.query({...h,values:!1});return r[p].apply(this,arguments).then(T=>{if(p==="query"){if(l&&h.values)return I.then(({result:w})=>(g.addKeys(w),T));const S=h.values?T.result.map(s):T.result;h.values?g.addKeys(S):v.addKeys(S)}else if(p==="openCursor"){const S=T,w=h.values;return S&&Object.create(S,{key:{get:()=>(v.addKey(S.primaryKey),S.key)},primaryKey:{get(){const U=S.primaryKey;return v.addKey(U),U}},value:{get:()=>(w&&g.addKey(S.primaryKey),S.value)}})}return T})}v.add(i)}}return r[p].apply(this,arguments)}}),c}}}};class lp{constructor(e,i){this._middlewares={},this.verno=0;const n=lp.dependencies;this._options=i={addons:lp.addons,autoOpen:!0,indexedDB:n.indexedDB,IDBKeyRange:n.IDBKeyRange,...i},this._deps={indexedDB:i.indexedDB,IDBKeyRange:i.IDBKeyRange};const{addons:r}=i;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null,this._novip=this;const o={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:Dr,dbReadyPromise:null,cancelOpen:Dr,openCanceller:null,autoSchema:!0,PR1398_maxLoop:3};var a;o.dbReadyPromise=new Nt(s=>{o.dbReadyResolve=s}),o.openCanceller=new Nt((s,l)=>{o.cancelOpen=l}),this._state=o,this.name=e,this.on=mT(this,"populate","blocked","versionchange","close",{ready:[Xq,Dr]}),this.on.ready.subscribe=Hme(this.on.ready.subscribe,s=>(l,c)=>{lp.vip(()=>{const u=this._state;if(u.openComplete)u.dbOpenError||Nt.resolve().then(l),c&&s(l);else if(u.onReadyBeingFired)u.onReadyBeingFired.push(l),c&&s(l);else{s(l);const d=this;c||s(function p(){d.on.ready.unsubscribe(l),d.on.ready.unsubscribe(p)})}})}),this.Collection=(a=this,fS(dBe.prototype,function(s,l){this.db=a;let c=uge,u=null;if(l)try{c=l()}catch(f){u=f}const d=s._ctx,p=d.table,h=p.hook.reading.fire;this._ctx={table:p,index:d.index,isPrimKey:!d.index||p.schema.primKey.keyPath&&d.index===p.schema.primKey.name,range:c,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:u,or:d.or,valueMapper:h!==$U?h:null}})),this.Table=function(s){return fS(uBe.prototype,function(l,c,u){this.db=s,this._tx=u,this.name=l,this.schema=c,this.hook=s._allTables[l]?s._allTables[l].hook:mT(null,{creating:[J2e,Dr],reading:[X2e,$U],updating:[eBe,Dr],deleting:[Q2e,Dr]})})}(this),this.Transaction=function(s){return fS(mBe.prototype,function(l,c,u,d,p){this.db=s,this.mode=l,this.storeNames=c,this.schema=u,this.chromeTransactionDurability=d,this.idbtrans=null,this.on=mT(this,"complete","error","abort"),this.parent=p||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Nt((h,f)=>{this._resolve=h,this._reject=f}),this._completion.then(()=>{this.active=!1,this.on.complete.fire()},h=>{var f=this.active;return this.active=!1,this.on.error.fire(h),this.parent?this.parent._reject(h):f&&this.idbtrans&&this.idbtrans.abort(),wa(h)})})}(this),this.Version=function(s){return fS(IBe.prototype,function(l){this.db=s,this._cfg={version:l,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(s){return fS(pge.prototype,function(l,c,u){this.db=s,this._ctx={table:l,index:c===":id"?null:c,or:u};const d=s._deps.indexedDB;if(!d)throw new Ti.MissingAPI;this._cmp=this._ascending=d.cmp.bind(d),this._descending=(p,h)=>d.cmp(h,p),this._max=(p,h)=>d.cmp(p,h)>0?p:h,this._min=(p,h)=>d.cmp(p,h)<0?p:h,this._IDBKeyRange=s._deps.IDBKeyRange})}(this),this.on("versionchange",s=>{s.newVersion>0?console.warn(`Another connection wants to upgrade database '${this.name}'. Closing db now to resume the upgrade.`):console.warn(`Another connection wants to delete database '${this.name}'. Closing db now to resume the delete request.`),this.close()}),this.on("blocked",s=>{!s.newVersion||s.newVersion<s.oldVersion?console.warn(`Dexie.delete('${this.name}') was blocked`):console.warn(`Upgrade '${this.name}' blocked by other connection holding version ${s.oldVersion/10}`)}),this._maxKey=GU(i.IDBKeyRange),this._createTransaction=(s,l,c,u)=>new this.Transaction(s,l,c,this._options.chromeTransactionDurability,u),this._fireOnBlocked=s=>{this.on("blocked").fire(s),fT.filter(l=>l.name===this.name&&l!==this&&!l._state.vcFired).map(l=>l.on("versionchange").fire(s))},this.use(UBe),this.use(DBe),this.use(EBe),this.use(PBe),this.vip=Object.create(this,{_vip:{value:!0}}),r.forEach(s=>s(this))}version(e){if(isNaN(e)||e<.1)throw new Ti.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new Ti.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);const i=this._versions;var n=i.filter(r=>r._cfg.version===e)[0];return n||(n=new this.Version(e),i.push(n),i.sort(yBe),n.stores({}),this._state.autoSchema=!1,n)}_whenReady(e){return this.idbdb&&(this._state.openComplete||oi.letThrough||this._vip)?e():new Nt((i,n)=>{if(this._state.openComplete)return n(new Ti.DatabaseClosed(this._state.dbOpenError));if(!this._state.isBeingOpened){if(!this._options.autoOpen)return void n(new Ti.DatabaseClosed);this.open().catch(Dr)}this._state.dbReadyPromise.then(i,n)}).then(e)}use({stack:e,create:i,level:n,name:r}){r&&this.unuse({stack:e,name:r});const o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:i,level:n??10,name:r}),o.sort((a,s)=>a.level-s.level),this}unuse({stack:e,name:i,create:n}){return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(r=>n?r.create!==n:!!i&&r.name!==i)),this}open(){return SBe(this)}_close(){const e=this._state,i=fT.indexOf(this);if(i>=0&&fT.splice(i,1),this.idbdb){try{this.idbdb.close()}catch{}this._novip.idbdb=null}e.dbReadyPromise=new Nt(n=>{e.dbReadyResolve=n}),e.openCanceller=new Nt((n,r)=>{e.cancelOpen=r})}close(){this._close();const e=this._state;this._options.autoOpen=!1,e.dbOpenError=new Ti.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError)}delete(){const e=arguments.length>0,i=this._state;return new Nt((n,r)=>{const o=()=>{this.close();var a=this._deps.indexedDB.deleteDatabase(this.name);a.onsuccess=ao(()=>{(function({indexedDB:s,IDBKeyRange:l},c){!i4(s)&&c!==Mx&&t4(s,l).delete(c).catch(Dr)})(this._deps,this.name),n()}),a.onerror=Wd(r),a.onblocked=this._fireOnBlocked};if(e)throw new Ti.InvalidArgument("Arguments not allowed in db.delete()");i.isBeingOpened?i.dbReadyPromise.then(o):o()})}backendDB(){return this.idbdb}isOpen(){return this.idbdb!==null}hasBeenClosed(){const e=this._state.dbOpenError;return e&&e.name==="DatabaseClosed"}hasFailed(){return this._state.dbOpenError!==null}dynamicallyOpened(){return this._state.autoSchema}get tables(){return ra(this._allTables).map(e=>this._allTables[e])}transaction(){const e=TBe.apply(this,arguments);return this._transaction.apply(this,e)}_transaction(e,i,n){let r=oi.trans;r&&r.db===this&&e.indexOf("!")===-1||(r=null);const o=e.indexOf("?")!==-1;let a,s;e=e.replace("!","").replace("?","");try{if(s=i.map(c=>{var u=c instanceof this.Table?c.name:c;if(typeof u!="string")throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return u}),e=="r"||e===SL)a=SL;else{if(e!="rw"&&e!=TL)throw new Ti.InvalidArgument("Invalid transaction mode: "+e);a=TL}if(r){if(r.mode===SL&&a===TL){if(!o)throw new Ti.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach(c=>{if(r&&r.storeNames.indexOf(c)===-1){if(!o)throw new Ti.SubTransaction("Table "+c+" not included in parent transaction.");r=null}}),o&&r&&!r.active&&(r=null)}}catch(c){return r?r._promise(null,(u,d)=>{d(c)}):wa(c)}const l=gge.bind(null,this,a,s,r,n);return r?r._promise(a,l,"lock"):oi.trans?J0(oi.transless,()=>this._whenReady(l)):this._whenReady(l)}table(e){if(!Hc(this._allTables,e))throw new Ti.InvalidTable(`Table ${e} does not exist`);return this._allTables[e]}}const MBe=typeof Symbol<"u"&&"observable"in Symbol?Symbol.observable:"@@observable";class RBe{constructor(e){this._subscribe=e}subscribe(e,i,n){return this._subscribe(e&&typeof e!="function"?e:{next:e,error:i,complete:n})}[MBe](){return this}}function yge(t,e){return ra(e).forEach(i=>{oN(t[i]||(t[i]=new Dh),e[i])}),t}function NBe(t){let e,i=!1;const n=new RBe(r=>{const o=Yq(t);let a=!1,s={},l={};const c={get closed(){return a},unsubscribe:()=>{a=!0,Qm.storagemutated.unsubscribe(h)}};r.start&&r.start(c);let u=!1,d=!1;function p(){return ra(l).some(m=>s[m]&&CBe(s[m],l[m]))}const h=m=>{yge(s,m),p()&&f()},f=()=>{if(u||a)return;s={};const m={},g=function(v){o&&X0();const y=()=>Xm(t,{subscr:v,trans:null}),b=oi.trans?J0(oi.transless,y):y();return o&&b.then(df,df),b}(m);d||(Qm(HU,h),d=!0),u=!0,Promise.resolve(g).then(v=>{i=!0,e=v,u=!1,a||(p()?f():(s={},l=m,r.next&&r.next(v)))},v=>{u=!1,i=!1,r.error&&r.error(v),c.unsubscribe()})};return f(),c});return n.hasValue=()=>i,n.getValue=()=>e,n}let zB;try{zB={indexedDB:Wr.indexedDB||Wr.mozIndexedDB||Wr.webkitIndexedDB||Wr.msIndexedDB,IDBKeyRange:Wr.IDBKeyRange||Wr.webkitIDBKeyRange}}catch{zB={indexedDB:null,IDBKeyRange:null}}const Lg=lp;function JE(t){let e=Ah;try{Ah=!0,Qm.storagemutated.fire(t)}finally{Ah=e}}Pw(Lg,{...WE,delete:t=>new Lg(t,{addons:[]}).delete(),exists:t=>new Lg(t,{addons:[]}).open().then(e=>(e.close(),!0)).catch("NoSuchDatabaseError",()=>!1),getDatabaseNames(t){try{return function({indexedDB:e,IDBKeyRange:i}){return i4(e)?Promise.resolve(e.databases()).then(n=>n.map(r=>r.name).filter(r=>r!==Mx)):t4(e,i).toCollection().primaryKeys()}(Lg.dependencies).then(t)}catch{return wa(new Ti.MissingAPI)}},defineClass:()=>function(t){dl(this,t)},ignoreTransaction:t=>oi.trans?J0(oi.transless,t):t(),vip:jB,async:function(t){return function(){try{var e=HB(t.apply(this,arguments));return e&&typeof e.then=="function"?e:Nt.resolve(e)}catch(i){return wa(i)}}},spawn:function(t,e,i){try{var n=HB(t.apply(i,e||[]));return n&&typeof n.then=="function"?n:Nt.resolve(n)}catch(r){return wa(r)}},currentTransaction:{get:()=>oi.trans||null},waitFor:function(t,e){const i=Nt.resolve(typeof t=="function"?Lg.ignoreTransaction(t):t).timeout(e||6e4);return oi.trans?oi.trans.waitFor(i):i},Promise:Nt,debug:{get:()=>ih,set:t=>{Kme(t,t==="dexie"?()=>!0:cge)}},derive:DI,extend:dl,props:Pw,override:Hme,Events:mT,on:Qm,liveQuery:NBe,extendObservabilitySet:yge,getByKeyPath:Vh,setByKeyPath:pd,delByKeyPath:function(t,e){typeof e=="string"?pd(t,e,void 0):"length"in e&&[].map.call(e,function(i){pd(t,i,void 0)})},shallowClone:Wme,deepClone:kC,getObjectDiff:n4,cmp:zs,asap:Gme,minKey:kB,addons:[],connections:fT,errnames:Zq,dependencies:zB,semVer:k8,version:k8.split(".").map(t=>parseInt(t)).reduce((t,e,i)=>t+e/Math.pow(10,2*i))}),Lg.maxKey=GU(Lg.dependencies.IDBKeyRange),typeof dispatchEvent<"u"&&typeof addEventListener<"u"&&(Qm(HU,t=>{if(!Ah){let e;Ex?(e=document.createEvent("CustomEvent"),e.initCustomEvent(lm,!0,!0,t)):e=new CustomEvent(lm,{detail:t}),Ah=!0,dispatchEvent(e),Ah=!1}}),addEventListener(lm,({detail:t})=>{Ah||JE(t)}));let Ah=!1;if(typeof BroadcastChannel<"u"){const t=new BroadcastChannel(lm);typeof t.unref=="function"&&t.unref(),Qm(HU,e=>{Ah||t.postMessage(e)}),t.onmessage=e=>{e.data&&JE(e.data)}}else if(typeof self<"u"&&typeof navigator<"u"){Qm(HU,e=>{try{Ah||(typeof localStorage<"u"&&localStorage.setItem(lm,JSON.stringify({trig:Math.random(),changedParts:e})),typeof self.clients=="object"&&[...self.clients.matchAll({includeUncontrolled:!0})].forEach(i=>i.postMessage({type:lm,changedParts:e})))}catch{}}),typeof addEventListener<"u"&&addEventListener("storage",e=>{if(e.key===lm){const i=JSON.parse(e.newValue);i&&JE(i.changedParts)}});const t=self.document&&navigator.serviceWorker;t&&t.addEventListener("message",function({data:e}){e&&e.type===lm&&JE(e.changedParts)})}Nt.rejectionMapper=function(t,e){if(!t||t instanceof PI||t instanceof TypeError||t instanceof SyntaxError||!t.name||!R8[t.name])return t;var i=new R8[t.name](e||t.message,t);return"stack"in t&&$h(i,"stack",{get:function(){return this.inner.stack}}),i},Kme(ih,cge);const No=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{try{t.dex=new lp("TMX",{autoOpen:!0}),t.dex.version(2).stores({tournaments:"&tournamentId, tournamentName, startDate, endDate",providers:"&providerId, settings, calendar",idioms:"ioc"}),e()}catch(n){return i(n)}}),t.resetDB=e=>{t.dex.close(),lp.delete("TMX").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{const r=t.dex[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findAllProviders=()=>t.findAll("providers"),t.findAllIdioms=()=>t.findAll("idioms"),t.findWhere=(e,i,n)=>new Promise((r,o)=>t.dex[e].where(i).equals(n).toArray(r,o).catch(o)),t.deleteTournament=e=>new Promise((i,n)=>{t.dex.tournaments.where("tournamentId").equals(e).delete().then(i,n)}),t.deleteProvider=e=>t.dex.providers.where("providerId").equals(e).delete(),t.deleteAllTournamentAttr=e=>t.dex.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,o)=>{t.findWhere(e,i,n).then(a=>r(a!=null&&a.length?a[0]:void 0),o)}),t.findProvider=e=>t.findUnique("providers","providerId",e),t.findIdiom=e=>t.findUnique("idioms","ioc",e),t.findTournament=e=>t.findUnique("tournaments","tournamentId",e),t.findProviderTournaments=e=>t.findWhere("tournaments","providerId",e),t.addItem=(e,i)=>new Promise((n,r)=>t.dex[e].put(i).then(n,r).catch(o=>{alert("try again:",o),r(o)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((o,a)=>{t.dex[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return o("exists");t.addItem(e,r).then(o,a)},s=>{console.log({err:s}),a(s)})}),t.addIdiom=e=>t.modifyOrAddUnique("idioms","ioc",e.ioc,e),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tournamentId",e.tournamentId,e),t.addProvider=e=>t.modifyOrAddUnique("providers","providerId",e.providerId,e),t.modify=(e,i,n,r,o)=>new Promise((a,s)=>{t.dex[e].where(i).equals(n).modify(l=>{Object.assign(o,{item:l}),r(o)}).then(a,l=>{console.log("error:",l),s()})}),t}();function ABe(t){const e=t.getData().map(i=>i.tournamentId);$2e({callback:i=>{const n=z_({data:i});if(n){let r,o;n.tournamentId&&n.startDate?o=n:n.tuid&&n.start&&vi({message:"TMX Classic file not converted"}),r=Ye.setState(o),r.success?Rx({tournamentRecord:o,tournamentIds:e,table:t}):console.log(r)}}})}function Rx({tournamentRecord:t,tournamentIds:e,table:i,callback:n}){const r=Zm(t),o=e==null?void 0:e.includes(t.tournamentId);o?i==null||i.updateOrAddData([r],!0):i==null||i.addData([r],!0),_Be({existsInCalendar:o,tournamentRecord:t}),vt(n)&&n()}function _Be({existsInCalendar:t,tournamentRecord:e}){var n;const i=(n=e.parentOrganisation)==null?void 0:n.organisationId;if(i){const r=o=>{o?kBe({provider:o,existsInCalendar:t,tournamentRecord:e}):j8({providerId:i,tournamentRecord:e})};No.findProvider(i).then(r,o4)}else j8({providerId:i,tournamentRecord:e})}function o4(t){console.log("database error",{error:t})}function bge({tournamentRecord:t}){const e=()=>{};No.addTournament(t).then(e,o4)}function WB({provider:t,tournamentRecord:e}){const i=()=>{e&&bge({tournamentRecord:e})};No.addProvider(t).then(i,o4)}function j8({providerId:t="tmxDefault",tournamentRecord:e}){const i=e.parentOrganisation;if(i)i.providerId=t,i.calendar=[Zm(e)],WB({provider:i,tournamentRecord:e});else{const n={calendar:[Zm(e)],providerId:t};WB({provider:n,tournamentRecord:e})}}function kBe({provider:t,existsInCalendar:e,tournamentRecord:i}){var r;const n=(r=t.calendar)==null?void 0:r.find(o=>o.tournamentId===i.tournamentId);!e||!n?(t.calendar||(t.calendar=[]),t.calendar.push(Zm(i)),WB({provider:t,tournamentRecord:i})):bge({tournamentRecord:i})}function Ige(t,e){return function(){return t.apply(e,arguments)}}const{toString:xBe}=Object.prototype,{getPrototypeOf:a4}=Object,Nx=(t=>e=>{const i=xBe.call(e);return t[i]||(t[i]=i.slice(8,-1).toLowerCase())})(Object.create(null)),nh=t=>(t=t.toLowerCase(),e=>Nx(e)===t),Ax=t=>e=>typeof e===t,{isArray:Q0}=Array,WU=Ax("undefined");function OBe(t){return t!==null&&!WU(t)&&t.constructor!==null&&!WU(t.constructor)&&mu(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const wge=nh("ArrayBuffer");function LBe(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&wge(t.buffer),e}const FBe=Ax("string"),mu=Ax("function"),Sge=Ax("number"),_x=t=>t!==null&&typeof t=="object",BBe=t=>t===!0||t===!1,QE=t=>{if(Nx(t)!=="object")return!1;const e=a4(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in t)&&!(Symbol.iterator in t)},$Be=nh("Date"),VBe=nh("File"),jBe=nh("Blob"),HBe=nh("FileList"),GBe=t=>_x(t)&&mu(t.pipe),zBe=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||mu(t.append)&&((e=Nx(t))==="formdata"||e==="object"&&mu(t.toString)&&t.toString()==="[object FormData]"))},WBe=nh("URLSearchParams"),qBe=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function LC(t,e,{allOwnKeys:i=!1}={}){if(t===null||typeof t>"u")return;let n,r;if(typeof t!="object"&&(t=[t]),Q0(t))for(n=0,r=t.length;n<r;n++)e.call(null,t[n],n,t);else{const o=i?Object.getOwnPropertyNames(t):Object.keys(t),a=o.length;let s;for(n=0;n<a;n++)s=o[n],e.call(null,t[s],s,t)}}function Tge(t,e){e=e.toLowerCase();const i=Object.keys(t);let n=i.length,r;for(;n-- >0;)if(r=i[n],e===r.toLowerCase())return r;return null}const Uge=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Dge=t=>!WU(t)&&t!==Uge;function qB(){const{caseless:t}=Dge(this)&&this||{},e={},i=(n,r)=>{const o=t&&Tge(e,r)||r;QE(e[o])&&QE(n)?e[o]=qB(e[o],n):QE(n)?e[o]=qB({},n):Q0(n)?e[o]=n.slice():e[o]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&LC(arguments[n],i);return e}const YBe=(t,e,i,{allOwnKeys:n}={})=>(LC(e,(r,o)=>{i&&mu(r)?t[o]=Ige(r,i):t[o]=r},{allOwnKeys:n}),t),KBe=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),ZBe=(t,e,i,n)=>{t.prototype=Object.create(e.prototype,n),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),i&&Object.assign(t.prototype,i)},XBe=(t,e,i,n)=>{let r,o,a;const s={};if(e=e||{},t==null)return e;do{for(r=Object.getOwnPropertyNames(t),o=r.length;o-- >0;)a=r[o],(!n||n(a,t,e))&&!s[a]&&(e[a]=t[a],s[a]=!0);t=i!==!1&&a4(t)}while(t&&(!i||i(t,e))&&t!==Object.prototype);return e},JBe=(t,e,i)=>{t=String(t),(i===void 0||i>t.length)&&(i=t.length),i-=e.length;const n=t.indexOf(e,i);return n!==-1&&n===i},QBe=t=>{if(!t)return null;if(Q0(t))return t;let e=t.length;if(!Sge(e))return null;const i=new Array(e);for(;e-- >0;)i[e]=t[e];return i},e$e=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&a4(Uint8Array)),t$e=(t,e)=>{const n=(t&&t[Symbol.iterator]).call(t);let r;for(;(r=n.next())&&!r.done;){const o=r.value;e.call(t,o[0],o[1])}},i$e=(t,e)=>{let i;const n=[];for(;(i=t.exec(e))!==null;)n.push(i);return n},n$e=nh("HTMLFormElement"),r$e=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(i,n,r){return n.toUpperCase()+r}),H8=(({hasOwnProperty:t})=>(e,i)=>t.call(e,i))(Object.prototype),o$e=nh("RegExp"),Pge=(t,e)=>{const i=Object.getOwnPropertyDescriptors(t),n={};LC(i,(r,o)=>{let a;(a=e(r,o,t))!==!1&&(n[o]=a||r)}),Object.defineProperties(t,n)},a$e=t=>{Pge(t,(e,i)=>{if(mu(t)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const n=t[i];if(mu(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")})}})},s$e=(t,e)=>{const i={},n=r=>{r.forEach(o=>{i[o]=!0})};return Q0(t)?n(t):n(String(t).split(e)),i},l$e=()=>{},c$e=(t,e)=>(t=+t,Number.isFinite(t)?t:e),EL="abcdefghijklmnopqrstuvwxyz",G8="0123456789",Cge={DIGIT:G8,ALPHA:EL,ALPHA_DIGIT:EL+EL.toUpperCase()+G8},u$e=(t=16,e=Cge.ALPHA_DIGIT)=>{let i="";const{length:n}=e;for(;t--;)i+=e[Math.random()*n|0];return i};function d$e(t){return!!(t&&mu(t.append)&&t[Symbol.toStringTag]==="FormData"&&t[Symbol.iterator])}const p$e=t=>{const e=new Array(10),i=(n,r)=>{if(_x(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const o=Q0(n)?[]:{};return LC(n,(a,s)=>{const l=i(a,r+1);!WU(l)&&(o[s]=l)}),e[r]=void 0,o}}return n};return i(t,0)},h$e=nh("AsyncFunction"),f$e=t=>t&&(_x(t)||mu(t))&&mu(t.then)&&mu(t.catch),Xe={isArray:Q0,isArrayBuffer:wge,isBuffer:OBe,isFormData:zBe,isArrayBufferView:LBe,isString:FBe,isNumber:Sge,isBoolean:BBe,isObject:_x,isPlainObject:QE,isUndefined:WU,isDate:$Be,isFile:VBe,isBlob:jBe,isRegExp:o$e,isFunction:mu,isStream:GBe,isURLSearchParams:WBe,isTypedArray:e$e,isFileList:HBe,forEach:LC,merge:qB,extend:YBe,trim:qBe,stripBOM:KBe,inherits:ZBe,toFlatObject:XBe,kindOf:Nx,kindOfTest:nh,endsWith:JBe,toArray:QBe,forEachEntry:t$e,matchAll:i$e,isHTMLForm:n$e,hasOwnProperty:H8,hasOwnProp:H8,reduceDescriptors:Pge,freezeMethods:a$e,toObjectSet:s$e,toCamelCase:r$e,noop:l$e,toFiniteNumber:c$e,findKey:Tge,global:Uge,isContextDefined:Dge,ALPHABET:Cge,generateString:u$e,isSpecCompliantForm:d$e,toJSONObject:p$e,isAsyncFn:h$e,isThenable:f$e};function Mn(t,e,i,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),i&&(this.config=i),n&&(this.request=n),r&&(this.response=r)}Xe.inherits(Mn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Xe.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const Ege=Mn.prototype,Mge={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{Mge[t]={value:t}});Object.defineProperties(Mn,Mge);Object.defineProperty(Ege,"isAxiosError",{value:!0});Mn.from=(t,e,i,n,r,o)=>{const a=Object.create(Ege);return Xe.toFlatObject(t,a,function(l){return l!==Error.prototype},s=>s!=="isAxiosError"),Mn.call(a,t.message,e,i,n,r),a.cause=t,a.name=t.name,o&&Object.assign(a,o),a};const m$e=null;function YB(t){return Xe.isPlainObject(t)||Xe.isArray(t)}function Rge(t){return Xe.endsWith(t,"[]")?t.slice(0,-2):t}function z8(t,e,i){return t?t.concat(e).map(function(r,o){return r=Rge(r),!i&&o?"["+r+"]":r}).join(i?".":""):e}function g$e(t){return Xe.isArray(t)&&!t.some(YB)}const v$e=Xe.toFlatObject(Xe,{},null,function(e){return/^is[A-Z]/.test(e)});function kx(t,e,i){if(!Xe.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,i=Xe.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,g){return!Xe.isUndefined(g[m])});const n=i.metaTokens,r=i.visitor||u,o=i.dots,a=i.indexes,l=(i.Blob||typeof Blob<"u"&&Blob)&&Xe.isSpecCompliantForm(e);if(!Xe.isFunction(r))throw new TypeError("visitor must be a function");function c(f){if(f===null)return"";if(Xe.isDate(f))return f.toISOString();if(!l&&Xe.isBlob(f))throw new Mn("Blob is not supported. Use a Buffer instead.");return Xe.isArrayBuffer(f)||Xe.isTypedArray(f)?l&&typeof Blob=="function"?new Blob([f]):Buffer.from(f):f}function u(f,m,g){let v=f;if(f&&!g&&typeof f=="object"){if(Xe.endsWith(m,"{}"))m=n?m:m.slice(0,-2),f=JSON.stringify(f);else if(Xe.isArray(f)&&g$e(f)||(Xe.isFileList(f)||Xe.endsWith(m,"[]"))&&(v=Xe.toArray(f)))return m=Rge(m),v.forEach(function(b,I){!(Xe.isUndefined(b)||b===null)&&e.append(a===!0?z8([m],I,o):a===null?m:m+"[]",c(b))}),!1}return YB(f)?!0:(e.append(z8(g,m,o),c(f)),!1)}const d=[],p=Object.assign(v$e,{defaultVisitor:u,convertValue:c,isVisitable:YB});function h(f,m){if(!Xe.isUndefined(f)){if(d.indexOf(f)!==-1)throw Error("Circular reference detected in "+m.join("."));d.push(f),Xe.forEach(f,function(v,y){(!(Xe.isUndefined(v)||v===null)&&r.call(e,v,Xe.isString(y)?y.trim():y,m,p))===!0&&h(v,m?m.concat(y):[y])}),d.pop()}}if(!Xe.isObject(t))throw new TypeError("data must be an object");return h(t),e}function W8(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function s4(t,e){this._pairs=[],t&&kx(t,this,e)}const Nge=s4.prototype;Nge.append=function(e,i){this._pairs.push([e,i])};Nge.toString=function(e){const i=e?function(n){return e.call(this,n,W8)}:W8;return this._pairs.map(function(r){return i(r[0])+"="+i(r[1])},"").join("&")};function y$e(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Age(t,e,i){if(!e)return t;const n=i&&i.encode||y$e,r=i&&i.serialize;let o;if(r?o=r(e,i):o=Xe.isURLSearchParams(e)?e.toString():new s4(e,i).toString(n),o){const a=t.indexOf("#");a!==-1&&(t=t.slice(0,a)),t+=(t.indexOf("?")===-1?"?":"&")+o}return t}class q8{constructor(){this.handlers=[]}use(e,i,n){return this.handlers.push({fulfilled:e,rejected:i,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Xe.forEach(this.handlers,function(n){n!==null&&e(n)})}}const _ge={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},b$e=typeof URLSearchParams<"u"?URLSearchParams:s4,I$e=typeof FormData<"u"?FormData:null,w$e=typeof Blob<"u"?Blob:null,S$e={isBrowser:!0,classes:{URLSearchParams:b$e,FormData:I$e,Blob:w$e},protocols:["http","https","file","blob","url","data"]},kge=typeof window<"u"&&typeof document<"u",T$e=(t=>kge&&["ReactNative","NativeScript","NS"].indexOf(t)<0)(typeof navigator<"u"&&navigator.product),U$e=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",D$e=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:kge,hasStandardBrowserEnv:T$e,hasStandardBrowserWebWorkerEnv:U$e},Symbol.toStringTag,{value:"Module"})),ep={...D$e,...S$e};function P$e(t,e){return kx(t,new ep.classes.URLSearchParams,Object.assign({visitor:function(i,n,r,o){return ep.isNode&&Xe.isBuffer(i)?(this.append(n,i.toString("base64")),!1):o.defaultVisitor.apply(this,arguments)}},e))}function C$e(t){return Xe.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function E$e(t){const e={},i=Object.keys(t);let n;const r=i.length;let o;for(n=0;n<r;n++)o=i[n],e[o]=t[o];return e}function xge(t){function e(i,n,r,o){let a=i[o++];if(a==="__proto__")return!0;const s=Number.isFinite(+a),l=o>=i.length;return a=!a&&Xe.isArray(r)?r.length:a,l?(Xe.hasOwnProp(r,a)?r[a]=[r[a],n]:r[a]=n,!s):((!r[a]||!Xe.isObject(r[a]))&&(r[a]=[]),e(i,n,r[a],o)&&Xe.isArray(r[a])&&(r[a]=E$e(r[a])),!s)}if(Xe.isFormData(t)&&Xe.isFunction(t.entries)){const i={};return Xe.forEachEntry(t,(n,r)=>{e(C$e(n),r,i,0)}),i}return null}function M$e(t,e,i){if(Xe.isString(t))try{return(e||JSON.parse)(t),Xe.trim(t)}catch(n){if(n.name!=="SyntaxError")throw n}return(i||JSON.stringify)(t)}const l4={transitional:_ge,adapter:["xhr","http"],transformRequest:[function(e,i){const n=i.getContentType()||"",r=n.indexOf("application/json")>-1,o=Xe.isObject(e);if(o&&Xe.isHTMLForm(e)&&(e=new FormData(e)),Xe.isFormData(e))return r?JSON.stringify(xge(e)):e;if(Xe.isArrayBuffer(e)||Xe.isBuffer(e)||Xe.isStream(e)||Xe.isFile(e)||Xe.isBlob(e))return e;if(Xe.isArrayBufferView(e))return e.buffer;if(Xe.isURLSearchParams(e))return i.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let s;if(o){if(n.indexOf("application/x-www-form-urlencoded")>-1)return P$e(e,this.formSerializer).toString();if((s=Xe.isFileList(e))||n.indexOf("multipart/form-data")>-1){const l=this.env&&this.env.FormData;return kx(s?{"files[]":e}:e,l&&new l,this.formSerializer)}}return o||r?(i.setContentType("application/json",!1),M$e(e)):e}],transformResponse:[function(e){const i=this.transitional||l4.transitional,n=i&&i.forcedJSONParsing,r=this.responseType==="json";if(e&&Xe.isString(e)&&(n&&!this.responseType||r)){const a=!(i&&i.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(s){if(a)throw s.name==="SyntaxError"?Mn.from(s,Mn.ERR_BAD_RESPONSE,this,null,this.response):s}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ep.classes.FormData,Blob:ep.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Xe.forEach(["delete","get","head","post","put","patch"],t=>{l4.headers[t]={}});const c4=l4,R$e=Xe.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),N$e=t=>{const e={};let i,n,r;return t&&t.split(`
`).forEach(function(a){r=a.indexOf(":"),i=a.substring(0,r).trim().toLowerCase(),n=a.substring(r+1).trim(),!(!i||e[i]&&R$e[i])&&(i==="set-cookie"?e[i]?e[i].push(n):e[i]=[n]:e[i]=e[i]?e[i]+", "+n:n)}),e},Y8=Symbol("internals");function mS(t){return t&&String(t).trim().toLowerCase()}function eM(t){return t===!1||t==null?t:Xe.isArray(t)?t.map(eM):String(t)}function A$e(t){const e=Object.create(null),i=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=i.exec(t);)e[n[1]]=n[2];return e}const _$e=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function ML(t,e,i,n,r){if(Xe.isFunction(n))return n.call(this,e,i);if(r&&(e=i),!!Xe.isString(e)){if(Xe.isString(n))return e.indexOf(n)!==-1;if(Xe.isRegExp(n))return n.test(e)}}function k$e(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,i,n)=>i.toUpperCase()+n)}function x$e(t,e){const i=Xe.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(t,n+i,{value:function(r,o,a){return this[n].call(this,e,r,o,a)},configurable:!0})})}class xx{constructor(e){e&&this.set(e)}set(e,i,n){const r=this;function o(s,l,c){const u=mS(l);if(!u)throw new Error("header name must be a non-empty string");const d=Xe.findKey(r,u);(!d||r[d]===void 0||c===!0||c===void 0&&r[d]!==!1)&&(r[d||l]=eM(s))}const a=(s,l)=>Xe.forEach(s,(c,u)=>o(c,u,l));return Xe.isPlainObject(e)||e instanceof this.constructor?a(e,i):Xe.isString(e)&&(e=e.trim())&&!_$e(e)?a(N$e(e),i):e!=null&&o(i,e,n),this}get(e,i){if(e=mS(e),e){const n=Xe.findKey(this,e);if(n){const r=this[n];if(!i)return r;if(i===!0)return A$e(r);if(Xe.isFunction(i))return i.call(this,r,n);if(Xe.isRegExp(i))return i.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,i){if(e=mS(e),e){const n=Xe.findKey(this,e);return!!(n&&this[n]!==void 0&&(!i||ML(this,this[n],n,i)))}return!1}delete(e,i){const n=this;let r=!1;function o(a){if(a=mS(a),a){const s=Xe.findKey(n,a);s&&(!i||ML(n,n[s],s,i))&&(delete n[s],r=!0)}}return Xe.isArray(e)?e.forEach(o):o(e),r}clear(e){const i=Object.keys(this);let n=i.length,r=!1;for(;n--;){const o=i[n];(!e||ML(this,this[o],o,e,!0))&&(delete this[o],r=!0)}return r}normalize(e){const i=this,n={};return Xe.forEach(this,(r,o)=>{const a=Xe.findKey(n,o);if(a){i[a]=eM(r),delete i[o];return}const s=e?k$e(o):String(o).trim();s!==o&&delete i[o],i[s]=eM(r),n[s]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const i=Object.create(null);return Xe.forEach(this,(n,r)=>{n!=null&&n!==!1&&(i[r]=e&&Xe.isArray(n)?n.join(", "):n)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,i])=>e+": "+i).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...i){const n=new this(e);return i.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[Y8]=this[Y8]={accessors:{}}).accessors,r=this.prototype;function o(a){const s=mS(a);n[s]||(x$e(r,a),n[s]=!0)}return Xe.isArray(e)?e.forEach(o):o(e),this}}xx.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Xe.reduceDescriptors(xx.prototype,({value:t},e)=>{let i=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(n){this[i]=n}}});Xe.freezeMethods(xx);const jh=xx;function RL(t,e){const i=this||c4,n=e||i,r=jh.from(n.headers);let o=n.data;return Xe.forEach(t,function(s){o=s.call(i,o,r.normalize(),e?e.status:void 0)}),r.normalize(),o}function Oge(t){return!!(t&&t.__CANCEL__)}function FC(t,e,i){Mn.call(this,t??"canceled",Mn.ERR_CANCELED,e,i),this.name="CanceledError"}Xe.inherits(FC,Mn,{__CANCEL__:!0});function O$e(t,e,i){const n=i.config.validateStatus;!i.status||!n||n(i.status)?t(i):e(new Mn("Request failed with status code "+i.status,[Mn.ERR_BAD_REQUEST,Mn.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i))}const L$e=ep.hasStandardBrowserEnv?{write(t,e,i,n,r,o){const a=[t+"="+encodeURIComponent(e)];Xe.isNumber(i)&&a.push("expires="+new Date(i).toGMTString()),Xe.isString(n)&&a.push("path="+n),Xe.isString(r)&&a.push("domain="+r),o===!0&&a.push("secure"),document.cookie=a.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function F$e(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function B$e(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function Lge(t,e){return t&&!F$e(e)?B$e(t,e):e}const $$e=ep.hasStandardBrowserEnv?function(){const e=/(msie|trident)/i.test(navigator.userAgent),i=document.createElement("a");let n;function r(o){let a=o;return e&&(i.setAttribute("href",a),a=i.href),i.setAttribute("href",a),{href:i.href,protocol:i.protocol?i.protocol.replace(/:$/,""):"",host:i.host,search:i.search?i.search.replace(/^\?/,""):"",hash:i.hash?i.hash.replace(/^#/,""):"",hostname:i.hostname,port:i.port,pathname:i.pathname.charAt(0)==="/"?i.pathname:"/"+i.pathname}}return n=r(window.location.href),function(a){const s=Xe.isString(a)?r(a):a;return s.protocol===n.protocol&&s.host===n.host}}():function(){return function(){return!0}}();function V$e(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function j$e(t,e){t=t||10;const i=new Array(t),n=new Array(t);let r=0,o=0,a;return e=e!==void 0?e:1e3,function(l){const c=Date.now(),u=n[o];a||(a=c),i[r]=l,n[r]=c;let d=o,p=0;for(;d!==r;)p+=i[d++],d=d%t;if(r=(r+1)%t,r===o&&(o=(o+1)%t),c-a<e)return;const h=u&&c-u;return h?Math.round(p*1e3/h):void 0}}function K8(t,e){let i=0;const n=j$e(50,250);return r=>{const o=r.loaded,a=r.lengthComputable?r.total:void 0,s=o-i,l=n(s),c=o<=a;i=o;const u={loaded:o,total:a,progress:a?o/a:void 0,bytes:s,rate:l||void 0,estimated:l&&a&&c?(a-o)/l:void 0,event:r};u[e?"download":"upload"]=!0,t(u)}}const H$e=typeof XMLHttpRequest<"u",G$e=H$e&&function(t){return new Promise(function(i,n){let r=t.data;const o=jh.from(t.headers).normalize();let{responseType:a,withXSRFToken:s}=t,l;function c(){t.cancelToken&&t.cancelToken.unsubscribe(l),t.signal&&t.signal.removeEventListener("abort",l)}let u;if(Xe.isFormData(r)){if(ep.hasStandardBrowserEnv||ep.hasStandardBrowserWebWorkerEnv)o.setContentType(!1);else if((u=o.getContentType())!==!1){const[m,...g]=u?u.split(";").map(v=>v.trim()).filter(Boolean):[];o.setContentType([m||"multipart/form-data",...g].join("; "))}}let d=new XMLHttpRequest;if(t.auth){const m=t.auth.username||"",g=t.auth.password?unescape(encodeURIComponent(t.auth.password)):"";o.set("Authorization","Basic "+btoa(m+":"+g))}const p=Lge(t.baseURL,t.url);d.open(t.method.toUpperCase(),Age(p,t.params,t.paramsSerializer),!0),d.timeout=t.timeout;function h(){if(!d)return;const m=jh.from("getAllResponseHeaders"in d&&d.getAllResponseHeaders()),v={data:!a||a==="text"||a==="json"?d.responseText:d.response,status:d.status,statusText:d.statusText,headers:m,config:t,request:d};O$e(function(b){i(b),c()},function(b){n(b),c()},v),d=null}if("onloadend"in d?d.onloadend=h:d.onreadystatechange=function(){!d||d.readyState!==4||d.status===0&&!(d.responseURL&&d.responseURL.indexOf("file:")===0)||setTimeout(h)},d.onabort=function(){d&&(n(new Mn("Request aborted",Mn.ECONNABORTED,t,d)),d=null)},d.onerror=function(){n(new Mn("Network Error",Mn.ERR_NETWORK,t,d)),d=null},d.ontimeout=function(){let g=t.timeout?"timeout of "+t.timeout+"ms exceeded":"timeout exceeded";const v=t.transitional||_ge;t.timeoutErrorMessage&&(g=t.timeoutErrorMessage),n(new Mn(g,v.clarifyTimeoutError?Mn.ETIMEDOUT:Mn.ECONNABORTED,t,d)),d=null},ep.hasStandardBrowserEnv&&(s&&Xe.isFunction(s)&&(s=s(t)),s||s!==!1&&$$e(p))){const m=t.xsrfHeaderName&&t.xsrfCookieName&&L$e.read(t.xsrfCookieName);m&&o.set(t.xsrfHeaderName,m)}r===void 0&&o.setContentType(null),"setRequestHeader"in d&&Xe.forEach(o.toJSON(),function(g,v){d.setRequestHeader(v,g)}),Xe.isUndefined(t.withCredentials)||(d.withCredentials=!!t.withCredentials),a&&a!=="json"&&(d.responseType=t.responseType),typeof t.onDownloadProgress=="function"&&d.addEventListener("progress",K8(t.onDownloadProgress,!0)),typeof t.onUploadProgress=="function"&&d.upload&&d.upload.addEventListener("progress",K8(t.onUploadProgress)),(t.cancelToken||t.signal)&&(l=m=>{d&&(n(!m||m.type?new FC(null,t,d):m),d.abort(),d=null)},t.cancelToken&&t.cancelToken.subscribe(l),t.signal&&(t.signal.aborted?l():t.signal.addEventListener("abort",l)));const f=V$e(p);if(f&&ep.protocols.indexOf(f)===-1){n(new Mn("Unsupported protocol "+f+":",Mn.ERR_BAD_REQUEST,t));return}d.send(r||null)})},KB={http:m$e,xhr:G$e};Xe.forEach(KB,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const Z8=t=>`- ${t}`,z$e=t=>Xe.isFunction(t)||t===null||t===!1,Fge={getAdapter:t=>{t=Xe.isArray(t)?t:[t];const{length:e}=t;let i,n;const r={};for(let o=0;o<e;o++){i=t[o];let a;if(n=i,!z$e(i)&&(n=KB[(a=String(i)).toLowerCase()],n===void 0))throw new Mn(`Unknown adapter '${a}'`);if(n)break;r[a||"#"+o]=n}if(!n){const o=Object.entries(r).map(([s,l])=>`adapter ${s} `+(l===!1?"is not supported by the environment":"is not available in the build"));let a=e?o.length>1?`since :
`+o.map(Z8).join(`
`):" "+Z8(o[0]):"as no adapter specified";throw new Mn("There is no suitable adapter to dispatch the request "+a,"ERR_NOT_SUPPORT")}return n},adapters:KB};function NL(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new FC(null,t)}function X8(t){return NL(t),t.headers=jh.from(t.headers),t.data=RL.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),Fge.getAdapter(t.adapter||c4.adapter)(t).then(function(n){return NL(t),n.data=RL.call(t,t.transformResponse,n),n.headers=jh.from(n.headers),n},function(n){return Oge(n)||(NL(t),n&&n.response&&(n.response.data=RL.call(t,t.transformResponse,n.response),n.response.headers=jh.from(n.response.headers))),Promise.reject(n)})}const J8=t=>t instanceof jh?t.toJSON():t;function Cw(t,e){e=e||{};const i={};function n(c,u,d){return Xe.isPlainObject(c)&&Xe.isPlainObject(u)?Xe.merge.call({caseless:d},c,u):Xe.isPlainObject(u)?Xe.merge({},u):Xe.isArray(u)?u.slice():u}function r(c,u,d){if(Xe.isUndefined(u)){if(!Xe.isUndefined(c))return n(void 0,c,d)}else return n(c,u,d)}function o(c,u){if(!Xe.isUndefined(u))return n(void 0,u)}function a(c,u){if(Xe.isUndefined(u)){if(!Xe.isUndefined(c))return n(void 0,c)}else return n(void 0,u)}function s(c,u,d){if(d in e)return n(c,u);if(d in t)return n(void 0,c)}const l={url:o,method:o,data:o,baseURL:a,transformRequest:a,transformResponse:a,paramsSerializer:a,timeout:a,timeoutMessage:a,withCredentials:a,withXSRFToken:a,adapter:a,responseType:a,xsrfCookieName:a,xsrfHeaderName:a,onUploadProgress:a,onDownloadProgress:a,decompress:a,maxContentLength:a,maxBodyLength:a,beforeRedirect:a,transport:a,httpAgent:a,httpsAgent:a,cancelToken:a,socketPath:a,responseEncoding:a,validateStatus:s,headers:(c,u)=>r(J8(c),J8(u),!0)};return Xe.forEach(Object.keys(Object.assign({},t,e)),function(u){const d=l[u]||r,p=d(t[u],e[u],u);Xe.isUndefined(p)&&d!==s||(i[u]=p)}),i}const Bge="1.6.7",u4={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{u4[t]=function(n){return typeof n===t||"a"+(e<1?"n ":" ")+t}});const Q8={};u4.transitional=function(e,i,n){function r(o,a){return"[Axios v"+Bge+"] Transitional option '"+o+"'"+a+(n?". "+n:"")}return(o,a,s)=>{if(e===!1)throw new Mn(r(a," has been removed"+(i?" in "+i:"")),Mn.ERR_DEPRECATED);return i&&!Q8[a]&&(Q8[a]=!0,console.warn(r(a," has been deprecated since v"+i+" and will be removed in the near future"))),e?e(o,a,s):!0}};function W$e(t,e,i){if(typeof t!="object")throw new Mn("options must be an object",Mn.ERR_BAD_OPTION_VALUE);const n=Object.keys(t);let r=n.length;for(;r-- >0;){const o=n[r],a=e[o];if(a){const s=t[o],l=s===void 0||a(s,o,t);if(l!==!0)throw new Mn("option "+o+" must be "+l,Mn.ERR_BAD_OPTION_VALUE);continue}if(i!==!0)throw new Mn("Unknown option "+o,Mn.ERR_BAD_OPTION)}}const ZB={assertOptions:W$e,validators:u4},zf=ZB.validators;class aN{constructor(e){this.defaults=e,this.interceptors={request:new q8,response:new q8}}async request(e,i){try{return await this._request(e,i)}catch(n){if(n instanceof Error){let r;Error.captureStackTrace?Error.captureStackTrace(r={}):r=new Error;const o=r.stack?r.stack.replace(/^.+\n/,""):"";n.stack?o&&!String(n.stack).endsWith(o.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+o):n.stack=o}throw n}}_request(e,i){typeof e=="string"?(i=i||{},i.url=e):i=e||{},i=Cw(this.defaults,i);const{transitional:n,paramsSerializer:r,headers:o}=i;n!==void 0&&ZB.assertOptions(n,{silentJSONParsing:zf.transitional(zf.boolean),forcedJSONParsing:zf.transitional(zf.boolean),clarifyTimeoutError:zf.transitional(zf.boolean)},!1),r!=null&&(Xe.isFunction(r)?i.paramsSerializer={serialize:r}:ZB.assertOptions(r,{encode:zf.function,serialize:zf.function},!0)),i.method=(i.method||this.defaults.method||"get").toLowerCase();let a=o&&Xe.merge(o.common,o[i.method]);o&&Xe.forEach(["delete","get","head","post","put","patch","common"],f=>{delete o[f]}),i.headers=jh.concat(a,o);const s=[];let l=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(i)===!1||(l=l&&m.synchronous,s.unshift(m.fulfilled,m.rejected))});const c=[];this.interceptors.response.forEach(function(m){c.push(m.fulfilled,m.rejected)});let u,d=0,p;if(!l){const f=[X8.bind(this),void 0];for(f.unshift.apply(f,s),f.push.apply(f,c),p=f.length,u=Promise.resolve(i);d<p;)u=u.then(f[d++],f[d++]);return u}p=s.length;let h=i;for(d=0;d<p;){const f=s[d++],m=s[d++];try{h=f(h)}catch(g){m.call(this,g);break}}try{u=X8.call(this,h)}catch(f){return Promise.reject(f)}for(d=0,p=c.length;d<p;)u=u.then(c[d++],c[d++]);return u}getUri(e){e=Cw(this.defaults,e);const i=Lge(e.baseURL,e.url);return Age(i,e.params,e.paramsSerializer)}}Xe.forEach(["delete","get","head","options"],function(e){aN.prototype[e]=function(i,n){return this.request(Cw(n||{},{method:e,url:i,data:(n||{}).data}))}});Xe.forEach(["post","put","patch"],function(e){function i(n){return function(o,a,s){return this.request(Cw(s||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:o,data:a}))}}aN.prototype[e]=i(),aN.prototype[e+"Form"]=i(!0)});const tM=aN;class d4{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let i;this.promise=new Promise(function(o){i=o});const n=this;this.promise.then(r=>{if(!n._listeners)return;let o=n._listeners.length;for(;o-- >0;)n._listeners[o](r);n._listeners=null}),this.promise.then=r=>{let o;const a=new Promise(s=>{n.subscribe(s),o=s}).then(r);return a.cancel=function(){n.unsubscribe(o)},a},e(function(o,a,s){n.reason||(n.reason=new FC(o,a,s),i(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const i=this._listeners.indexOf(e);i!==-1&&this._listeners.splice(i,1)}static source(){let e;return{token:new d4(function(r){e=r}),cancel:e}}}const q$e=d4;function Y$e(t){return function(i){return t.apply(null,i)}}function K$e(t){return Xe.isObject(t)&&t.isAxiosError===!0}const XB={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(XB).forEach(([t,e])=>{XB[e]=t});const Z$e=XB;function $ge(t){const e=new tM(t),i=Ige(tM.prototype.request,e);return Xe.extend(i,tM.prototype,e,{allOwnKeys:!0}),Xe.extend(i,e,null,{allOwnKeys:!0}),i.create=function(r){return $ge(Cw(t,r))},i}const ha=$ge(c4);ha.Axios=tM;ha.CanceledError=FC;ha.CancelToken=q$e;ha.isCancel=Oge;ha.VERSION=Bge;ha.toFormData=kx;ha.AxiosError=Mn;ha.Cancel=ha.CanceledError;ha.all=function(e){return Promise.all(e)};ha.spread=Y$e;ha.isAxiosError=K$e;ha.mergeConfig=Cw;ha.AxiosHeaders=jh;ha.formToJSON=t=>xge(Xe.isHTMLForm(t)?new FormData(t):t);ha.getAdapter=Fge.getAdapter;ha.HttpStatusCode=Z$e;ha.default=ha;const Vge=_le(),X$e=window.location.host.includes("localhost")||window.location.hostname==="127.0.0.1";var wJ;const J$e=(wJ=window.dev)!=null&&wJ.baseURL||X$e?"http://localhost:8383":"https://courthive.net",BC=ha.create({baseURL:J$e});BC.interceptors.request.use(t=>{const e=localStorage.getItem(Vge);return e&&(t.headers.Authorization=`Bearer ${e}`),t},t=>Promise.reject(t));BC.interceptors.response.use(t=>{var e;return(e=t.data)!=null&&e.error&&vi({message:t.data.error,intent:"is-danger"}),t},t=>{var e;if(t.message==="Network Error"&&vi({message:t.message,intent:"is-danger"}),t.response){((e=t.response)==null?void 0:e.status)===401&&jge();const i=t.response.data.message||t.response.data.error||t.response.data;vi({message:i,intent:"is-danger"})}});const Q$e=()=>{const t=localStorage.getItem(Vge);BC.defaults.headers.common.Authorization=`Bearer ${t}`},jge=()=>{BC.defaults.headers.common.Authorization=void 0},Eg={...BC,addAuthorization:Q$e,removeAuthorization:jge};async function p4({tournamentId:t}){return await Eg.post("/factory/fetch",{tournamentId:t})}async function eVe({providerId:t}){return await Eg.post("/provider/detail",{providerId:t})}async function tVe({providerAbbr:t}){return await Eg.post("/provider/calendar",{providerAbbr:t})}async function Hge(){return await Eg.post("/provider/allProviders",{})}async function iVe({tournamentRecord:t}){return await Eg.post("/factory/save",{tournamentRecord:t})}const Xl=(t,e)=>i=>i.length>=t&&(!e||e&&i.length<=e);function yb(t,e,i){if(!t)return;const n={};for(const r of e||[]){if(!(r!=null&&r.label)||r.hide)continue;const o=document.createElement("button");r.id&&(n[r.id]=o,o.id=r.id),o.style="margin-right: .5em;",o.className="button font-medium",r.intent&&o.classList.add(r.intent),o.innerHTML=r.label,o.onclick=a=>{a.stopPropagation(),!r.disabled&&vt(r.onClick)&&r.onClick(),vt(i)&&i()},t.appendChild(o)}return{elements:n}}function h4(t){return t[t.length-1]}function $C(t,...e){return e.forEach(i=>{t.includes(i)||t.push(i)}),t}function eK(t,e){return t?t.split(e):[]}function f4(t,e,i){const n=e===void 0||t>=e,r=i===void 0||t<=i;return n&&r}function Gge(t,e,i){return t<e?e:t>i?i:t}function Ew(t,e,i={},n=0,r=""){const o=Object.keys(i).reduce((s,l)=>{let c=i[l];return typeof c=="function"&&(c=c(n)),`${s} ${l}="${c}"`},t);r+=`<${o}></${t}>`;const a=n+1;return a<e?Ew(t,e,i,a,r):r}function m4(t){return t.replace(/>\s+/g,">").replace(/\s+</,"<")}function JB(t){return new Date(t).setHours(0,0,0,0)}function bb(){return new Date().setHours(0,0,0,0)}function Mw(...t){switch(t.length){case 0:return bb();case 1:return JB(t[0])}const e=new Date(0);return e.setFullYear(...t),e.setHours(0,0,0,0)}function qU(t,e){const i=new Date(t);return i.setDate(i.getDate()+e)}function nVe(t,e){return qU(t,e*7)}function sN(t,e){const i=new Date(t),n=i.getMonth()+e;let r=n%12;r<0&&(r+=12);const o=i.setMonth(n);return i.getMonth()!==r?i.setDate(0):o}function YU(t,e){const i=new Date(t),n=i.getMonth(),r=i.setFullYear(i.getFullYear()+e);return n===1&&i.getMonth()===2?i.setDate(0):r}function tK(t,e){return(t-e+7)%7}function Mv(t,e,i=0){const n=new Date(t).getDay();return qU(t,tK(e,i)-tK(n,i))}function zge(t,e){return Math.round((t-e)/6048e5)+1}function rVe(t){const e=Mv(t,4,1),i=Mv(new Date(e).setMonth(0,4),4,1);return zge(e,i)}function Wge(t,e){const i=Mv(new Date(t).setMonth(0,1),e,e),n=Mv(t,e,e),r=zge(n,i);if(r<53)return r;const o=Mv(new Date(t).setDate(32),e,e);return n===o?1:r}function oVe(t){return Wge(t,0)}function aVe(t){return Wge(t,6)}function $b(t,e){const i=new Date(t).getFullYear();return Math.floor(i/e)*e}function Im(t,e,i){if(e!==1&&e!==2)return t;const n=new Date(t);return e===1?i?n.setMonth(n.getMonth()+1,0):n.setDate(1):i?n.setFullYear(n.getFullYear()+1,0,0):n.setMonth(0,1),n.setHours(0,0,0,0)}const QB=/dd?|DD?|mm?|MM?|yy?(?:yy)?/,sVe=/[\s!-/:-@[-`{-~年月日]+/;let AL={};const iK={y(t,e){return new Date(t).setFullYear(parseInt(e,10))},m(t,e,i){const n=new Date(t);let r=parseInt(e,10)-1;if(isNaN(r)){if(!e)return NaN;const o=e.toLowerCase(),a=s=>s.toLowerCase().startsWith(o);if(r=i.monthsShort.findIndex(a),r<0&&(r=i.months.findIndex(a)),r<0)return NaN}return n.setMonth(r),n.getMonth()!==qge(r)?n.setDate(0):n.getTime()},d(t,e){return new Date(t).setDate(parseInt(e,10))}},lVe={d(t){return t.getDate()},dd(t){return j1(t.getDate(),2)},D(t,e){return e.daysShort[t.getDay()]},DD(t,e){return e.days[t.getDay()]},m(t){return t.getMonth()+1},mm(t){return j1(t.getMonth()+1,2)},M(t,e){return e.monthsShort[t.getMonth()]},MM(t,e){return e.months[t.getMonth()]},y(t){return t.getFullYear()},yy(t){return j1(t.getFullYear(),2).slice(-2)},yyyy(t){return j1(t.getFullYear(),4)}};function qge(t){return t>-1?t%12:qge(t+12)}function j1(t,e){return t.toString().padStart(e,"0")}function Yge(t){if(typeof t!="string")throw new Error("Invalid date format.");if(t in AL)return AL[t];const e=t.split(QB),i=t.match(new RegExp(QB,"g"));if(e.length===0||!i)throw new Error("Invalid date format.");const n=i.map(o=>lVe[o]),r=Object.keys(iK).reduce((o,a)=>(i.find(l=>l[0]!=="D"&&l[0].toLowerCase()===a)&&o.push(a),o),[]);return AL[t]={parser(o,a){const s=o.split(sVe).reduce((l,c,u)=>{if(c.length>0&&i[u]){const d=i[u][0];d==="M"?l.m=c:d!=="D"&&(l[d]=c)}return l},{});return r.reduce((l,c)=>{const u=iK[c](l,s[c],a);return isNaN(u)?l:u},bb())},formatter(o,a){let s=n.reduce((l,c,u)=>l+=`${e[u]}${c(o,a)}`,"");return s+=h4(e)}}}function ly(t,e,i){if(t instanceof Date||typeof t=="number"){const n=JB(t);return isNaN(n)?void 0:n}if(t){if(t==="today")return bb();if(e&&e.toValue){const n=e.toValue(t,e,i);return isNaN(n)?void 0:JB(n)}return Yge(e).parser(t,i)}}function VC(t,e,i){if(isNaN(t)||!t&&t!==0)return"";const n=typeof t=="number"?new Date(t):t;return e.toDisplay?e.toDisplay(n,e,i):Yge(e).formatter(n,i)}const cVe=document.createRange();function pf(t){return cVe.createContextualFragment(t)}function Kge(t){return t.parentElement||(t.parentNode instanceof ShadowRoot?t.parentNode.host:void 0)}function Ox(t){return t.getRootNode().activeElement===t}function vT(t){t.style.display!=="none"&&(t.style.display&&(t.dataset.styleDisplay=t.style.display),t.style.display="none")}function yT(t){t.style.display==="none"&&(t.dataset.styleDisplay?(t.style.display=t.dataset.styleDisplay,delete t.dataset.styleDisplay):t.style.display="")}function lN(t){t.firstChild&&(t.removeChild(t.firstChild),lN(t))}function uVe(t,e){lN(t),e instanceof DocumentFragment?t.appendChild(e):typeof e=="string"?t.appendChild(pf(e)):typeof e.forEach=="function"&&e.forEach(i=>{t.appendChild(i)})}const cN=new WeakMap,{addEventListener:dVe,removeEventListener:pVe}=EventTarget.prototype;function uN(t,e){let i=cN.get(t);i||(i=[],cN.set(t,i)),e.forEach(n=>{dVe.call(...n),i.push(n)})}function Zge(t){let e=cN.get(t);e&&(e.forEach(i=>{pVe.call(...i)}),cN.delete(t))}if(!Event.prototype.composedPath){const t=(e,i=[])=>{i.push(e);let n;return e.parentNode?n=e.parentNode:e.host?n=e.host:e.defaultView&&(n=e.defaultView),n?t(n,i):i};Event.prototype.composedPath=function(){return t(this.target)}}function Xge(t,e,i){const[n,...r]=t;if(e(n))return n;if(!(n===i||n.tagName==="HTML"||r.length===0))return Xge(r,e,i)}function Jge(t,e){const i=typeof e=="function"?e:n=>n instanceof Element&&n.matches(e);return Xge(t.composedPath(),i,t.currentTarget)}const gS={en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],today:"Today",clear:"Clear",titleFormat:"MM y"}},g4={autohide:!1,beforeShowDay:null,beforeShowDecade:null,beforeShowMonth:null,beforeShowYear:null,clearButton:!1,dateDelimiter:",",datesDisabled:[],daysOfWeekDisabled:[],daysOfWeekHighlighted:[],defaultViewDate:void 0,disableTouchKeyboard:!1,enableOnReadonly:!0,format:"mm/dd/yyyy",language:"en",maxDate:null,maxNumberOfDates:1,maxView:3,minDate:null,nextArrow:"»",orientation:"auto",pickLevel:0,prevArrow:"«",showDaysOfWeek:!0,showOnClick:!0,showOnFocus:!0,startView:0,title:"",todayButton:!1,todayButtonMode:0,todayHighlight:!1,updateOnBlur:!0,weekNumbers:0,weekStart:0},{language:_L,format:hVe,weekStart:fVe}=g4;function nK(t,e){return t.length<6&&e>=0&&e<7?$C(t,e):t}function Qge(t,e){switch(t===4?e===6?3:!e+1:t){case 1:return rVe;case 2:return oVe;case 3:return aVe}}function rK(t,e,i){return e.weekStart=t,e.weekEnd=(t+6)%7,i===4&&(e.getWeekNumber=Qge(4,t)),t}function oK(t,e,i,n){const r=ly(t,e,i);return r!==void 0?r:n}function kL(t,e,i=3){const n=parseInt(t,10);return n>=0&&n<=i?n:e}function H1(t,e,i,n=void 0){e in t&&(i in t||(t[i]=n?n(t[e]):t[e]),delete t[e])}function xL(t,e){const i=Object.assign({},t),n={},r=e.constructor.locales,o=!!e.rangeSideIndex;let{datesDisabled:a,format:s,language:l,locale:c,maxDate:u,maxView:d,minDate:p,pickLevel:h,startView:f,weekNumbers:m,weekStart:g}=e.config||{};if(H1(i,"calendarWeeks","weekNumbers",S=>S?1:0),H1(i,"clearBtn","clearButton"),H1(i,"todayBtn","todayButton"),H1(i,"todayBtnMode","todayButtonMode"),i.language){let S;if(i.language!==l&&(r[i.language]?S=i.language:(S=i.language.split("-")[0],r[S]||(S=!1))),delete i.language,S){l=n.language=S;const w=c||r[_L];c=Object.assign({format:hVe,weekStart:fVe},r[_L]),l!==_L&&Object.assign(c,r[l]),n.locale=c,s===w.format&&(s=n.format=c.format),g===w.weekStart&&(g=rK(c.weekStart,n,m))}}if(i.format){const S=typeof i.format.toDisplay=="function",w=typeof i.format.toValue=="function",U=QB.test(i.format);(S&&w||U)&&(s=n.format=i.format),delete i.format}let v=h;"pickLevel"in i&&(v=kL(i.pickLevel,h,2),delete i.pickLevel),v!==h&&(v>h&&("minDate"in i||(i.minDate=p),"maxDate"in i||(i.maxDate=u)),a&&!i.datesDisabled&&(i.datesDisabled=[]),h=n.pickLevel=v);let y=p,b=u;if("minDate"in i){const S=Mw(0,0,1);y=i.minDate===null?S:oK(i.minDate,s,c,y),y!==S&&(y=Im(y,h,!1)),delete i.minDate}if("maxDate"in i&&(b=i.maxDate===null?void 0:oK(i.maxDate,s,c,b),b!==void 0&&(b=Im(b,h,!0)),delete i.maxDate),b<y?(p=n.minDate=b,u=n.maxDate=y):(p!==y&&(p=n.minDate=y),u!==b&&(u=n.maxDate=b)),i.datesDisabled){const S=i.datesDisabled;if(typeof S=="function")n.datesDisabled=null,n.checkDisabled=(w,U)=>S(new Date(w),U,o);else{const w=n.datesDisabled=S.reduce((U,D)=>{const E=ly(D,s,c);return E!==void 0?$C(U,Im(E,h,o)):U},[]);n.checkDisabled=U=>w.includes(U)}delete i.datesDisabled}if("defaultViewDate"in i){const S=ly(i.defaultViewDate,s,c);S!==void 0&&(n.defaultViewDate=S),delete i.defaultViewDate}if("weekStart"in i){const S=Number(i.weekStart)%7;isNaN(S)||(g=rK(S,n,m)),delete i.weekStart}if(i.daysOfWeekDisabled&&(n.daysOfWeekDisabled=i.daysOfWeekDisabled.reduce(nK,[]),delete i.daysOfWeekDisabled),i.daysOfWeekHighlighted&&(n.daysOfWeekHighlighted=i.daysOfWeekHighlighted.reduce(nK,[]),delete i.daysOfWeekHighlighted),"weekNumbers"in i){let S=i.weekNumbers;if(S){const w=typeof S=="function"?(U,D)=>S(new Date(U),D):Qge(S=parseInt(S,10),g);w&&(m=n.weekNumbers=S,n.getWeekNumber=w)}else m=n.weekNumbers=0,n.getWeekNumber=null;delete i.weekNumbers}if("maxNumberOfDates"in i){const S=parseInt(i.maxNumberOfDates,10);S>=0&&(n.maxNumberOfDates=S,n.multidate=S!==1),delete i.maxNumberOfDates}i.dateDelimiter&&(n.dateDelimiter=String(i.dateDelimiter),delete i.dateDelimiter);let I=d;"maxView"in i&&(I=kL(i.maxView,d),delete i.maxView),I=h>I?h:I,I!==d&&(d=n.maxView=I);let T=f;if("startView"in i&&(T=kL(i.startView,T),delete i.startView),T<h?T=h:T>d&&(T=d),T!==f&&(n.startView=T),i.prevArrow){const S=pf(i.prevArrow);S.childNodes.length>0&&(n.prevArrow=S.childNodes),delete i.prevArrow}if(i.nextArrow){const S=pf(i.nextArrow);S.childNodes.length>0&&(n.nextArrow=S.childNodes),delete i.nextArrow}if("disableTouchKeyboard"in i&&(n.disableTouchKeyboard="ontouchstart"in document&&!!i.disableTouchKeyboard,delete i.disableTouchKeyboard),i.orientation){const S=i.orientation.toLowerCase().split(/\s+/g);n.orientation={x:S.find(w=>w==="left"||w==="right")||"auto",y:S.find(w=>w==="top"||w==="bottom")||"auto"},delete i.orientation}if("todayButtonMode"in i){switch(i.todayButtonMode){case 0:case 1:n.todayButtonMode=i.todayButtonMode}delete i.todayButtonMode}return Object.entries(i).forEach(([S,w])=>{w!==void 0&&S in g4&&(n[S]=w)}),n}const aK={show:{key:"ArrowDown"},hide:null,toggle:{key:"Escape"},prevButton:{key:"ArrowLeft",ctrlOrMetaKey:!0},nextButton:{key:"ArrowRight",ctrlOrMetaKey:!0},viewSwitch:{key:"ArrowUp",ctrlOrMetaKey:!0},clearButton:{key:"Backspace",ctrlOrMetaKey:!0},todayButton:{key:".",ctrlOrMetaKey:!0},exitEditMode:{key:"ArrowDown",ctrlOrMetaKey:!0}};function mVe(t){return Object.keys(aK).reduce((e,i)=>{const n=t[i]===void 0?aK[i]:t[i],r=n&&n.key;if(!r||typeof r!="string")return e;const o={key:r,ctrlOrMetaKey:!!(n.ctrlOrMetaKey||n.ctrlKey||n.metaKey)};return r.length>1&&(o.altKey=!!n.altKey,o.shiftKey=!!n.shiftKey),e[i]=o,e},{})}const sK=t=>t.map(e=>`<button type="button" class="%buttonClass% ${e}" tabindex="-1"></button>`).join(""),gVe=m4(`<div class="datepicker">
  <div class="datepicker-picker">
    <div class="datepicker-header">
      <div class="datepicker-title"></div>
      <div class="datepicker-controls">
        ${sK(["prev-button prev-btn","view-switch","next-button next-btn"])}
      </div>
    </div>
    <div class="datepicker-main"></div>
    <div class="datepicker-footer">
      <div class="datepicker-controls">
        ${sK(["today-button today-btn","clear-button clear-btn"])}
      </div>
    </div>
  </div>
</div>`),vVe=m4(`<div class="days">
  <div class="days-of-week">${Ew("span",7,{class:"dow"})}</div>
  <div class="datepicker-grid">${Ew("span",42)}</div>
</div>`),yVe=m4(`<div class="week-numbers calendar-weeks">
  <div class="days-of-week"><span class="dow"></span></div>
  <div class="weeks">${Ew("span",6,{class:"week"})}</div>
</div>`);let v4=class{constructor(e,i){Object.assign(this,i,{picker:e,element:pf('<div class="datepicker-view"></div>').firstChild,selected:[],isRangeEnd:!!e.datepicker.rangeSideIndex}),this.init(this.picker.datepicker.config)}init(e){"pickLevel"in e&&(this.isMinView=this.id===e.pickLevel),this.setOptions(e),this.updateFocus(),this.updateSelection()}prepareForRender(e,i,n){this.disabled=[];const r=this.picker;r.setViewSwitchLabel(e),r.setPrevButtonDisabled(i),r.setNextButtonDisabled(n)}setDisabled(e,i){i.add("disabled"),$C(this.disabled,e)}performBeforeHook(e,i){let n=this.beforeShow(new Date(i));switch(typeof n){case"boolean":n={enabled:n};break;case"string":n={classes:n}}if(n){const r=e.classList;if(n.enabled===!1&&this.setDisabled(i,r),n.classes){const o=n.classes.split(/\s+/);r.add(...o),o.includes("disabled")&&this.setDisabled(i,r)}n.content&&uVe(e,n.content)}}renderCell(e,i,n,r,{selected:o,range:a},s,l=[]){e.textContent=i,this.isMinView&&(e.dataset.date=r);const c=e.classList;if(e.className=`datepicker-cell ${this.cellClass}`,n<this.first?c.add("prev"):n>this.last&&c.add("next"),c.add(...l),(s||this.checkDisabled(r,this.id))&&this.setDisabled(r,c),a){const[u,d]=a;n>u&&n<d&&c.add("range"),n===u&&c.add("range-start"),n===d&&c.add("range-end")}o.includes(n)&&c.add("selected"),n===this.focused&&c.add("focused"),this.beforeShow&&this.performBeforeHook(e,r)}refreshCell(e,i,n,[r,o]){const a=e.classList;a.remove("range","range-start","range-end","selected","focused"),i>r&&i<o&&a.add("range"),i===r&&a.add("range-start"),i===o&&a.add("range-end"),n.includes(i)&&a.add("selected"),i===this.focused&&a.add("focused")}changeFocusedCell(e){this.grid.querySelectorAll(".focused").forEach(i=>{i.classList.remove("focused")}),this.grid.children[e].classList.add("focused")}};class bVe extends v4{constructor(e){super(e,{id:0,name:"days",cellClass:"day"})}init(e,i=!0){if(i){const n=pf(vVe).firstChild;this.dow=n.firstChild,this.grid=n.lastChild,this.element.appendChild(n)}super.init(e)}setOptions(e){let i;if("minDate"in e&&(this.minDate=e.minDate),"maxDate"in e&&(this.maxDate=e.maxDate),e.checkDisabled&&(this.checkDisabled=e.checkDisabled),e.daysOfWeekDisabled&&(this.daysOfWeekDisabled=e.daysOfWeekDisabled,i=!0),e.daysOfWeekHighlighted&&(this.daysOfWeekHighlighted=e.daysOfWeekHighlighted),"todayHighlight"in e&&(this.todayHighlight=e.todayHighlight),"weekStart"in e&&(this.weekStart=e.weekStart,this.weekEnd=e.weekEnd,i=!0),e.locale){const n=this.locale=e.locale;this.dayNames=n.daysMin,this.switchLabelFormat=n.titleFormat,i=!0}if("beforeShowDay"in e&&(this.beforeShow=typeof e.beforeShowDay=="function"?e.beforeShowDay:void 0),"weekNumbers"in e)if(e.weekNumbers&&!this.weekNumbers){const n=pf(yVe).firstChild;this.weekNumbers={element:n,dow:n.firstChild,weeks:n.lastChild},this.element.insertBefore(n,this.element.firstChild)}else this.weekNumbers&&!e.weekNumbers&&(this.element.removeChild(this.weekNumbers.element),this.weekNumbers=null);"getWeekNumber"in e&&(this.getWeekNumber=e.getWeekNumber),"showDaysOfWeek"in e&&(e.showDaysOfWeek?(yT(this.dow),this.weekNumbers&&yT(this.weekNumbers.dow)):(vT(this.dow),this.weekNumbers&&vT(this.weekNumbers.dow))),i&&Array.from(this.dow.children).forEach((n,r)=>{const o=(this.weekStart+r)%7;n.textContent=this.dayNames[o],n.className=this.daysOfWeekDisabled.includes(o)?"dow disabled":"dow"})}updateFocus(){const e=new Date(this.picker.viewDate),i=e.getFullYear(),n=e.getMonth(),r=Mw(i,n,1),o=Mv(r,this.weekStart,this.weekStart);this.first=r,this.last=Mw(i,n+1,0),this.start=o,this.focused=this.picker.viewDate}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e,i&&(this.range=i.dates)}render(){if(this.today=this.todayHighlight?bb():void 0,this.prepareForRender(VC(this.focused,this.switchLabelFormat,this.locale),this.first<=this.minDate,this.last>=this.maxDate),this.weekNumbers){const e=this.weekStart,i=Mv(this.first,e,e);Array.from(this.weekNumbers.weeks.children).forEach((n,r)=>{const o=nVe(i,r);n.textContent=this.getWeekNumber(o,e),r>3&&n.classList[o>this.last?"add":"remove"]("next")})}Array.from(this.grid.children).forEach((e,i)=>{const n=qU(this.start,i),r=new Date(n),o=r.getDay(),a=[];this.today===n&&a.push("today"),this.daysOfWeekHighlighted.includes(o)&&a.push("highlighted"),this.renderCell(e,r.getDate(),n,n,this,n<this.minDate||n>this.maxDate||this.daysOfWeekDisabled.includes(o),a)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.dataset.date),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/864e5))}}function lK(t,e){if(!t||!t[0]||!t[1])return;const[[i,n],[r,o]]=t;if(!(i>e||r<e))return[i===e?n:-1,r===e?o:12]}class IVe extends v4{constructor(e){super(e,{id:1,name:"months",cellClass:"month"})}init(e,i=!0){i&&(this.grid=this.element,this.element.classList.add("months","datepicker-grid"),this.grid.appendChild(pf(Ew("span",12,{"data-month":n=>n}))),this.first=0,this.last=11),super.init(e)}setOptions(e){if(e.locale&&(this.monthNames=e.locale.monthsShort),"minDate"in e)if(e.minDate===void 0)this.minYear=this.minMonth=this.minDate=void 0;else{const i=new Date(e.minDate);this.minYear=i.getFullYear(),this.minMonth=i.getMonth(),this.minDate=i.setDate(1)}if("maxDate"in e)if(e.maxDate===void 0)this.maxYear=this.maxMonth=this.maxDate=void 0;else{const i=new Date(e.maxDate);this.maxYear=i.getFullYear(),this.maxMonth=i.getMonth(),this.maxDate=Mw(this.maxYear,this.maxMonth+1,0)}e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),"beforeShowMonth"in e&&(this.beforeShow=typeof e.beforeShowMonth=="function"?e.beforeShowMonth:void 0)}updateFocus(){const e=new Date(this.picker.viewDate);this.year=e.getFullYear(),this.focused=e.getMonth()}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>{const o=new Date(r),a=o.getFullYear(),s=o.getMonth();return n[a]===void 0?n[a]=[s]:$C(n[a],s),n},{}),i&&i.dates&&(this.range=i.dates.map(n=>{const r=new Date(n);return isNaN(r)?void 0:[r.getFullYear(),r.getMonth()]}))}render(){this.prepareForRender(this.year,this.year<=this.minYear,this.year>=this.maxYear);const e=this.selected[this.year]||[],i=this.year<this.minYear||this.year>this.maxYear,n=this.year===this.minYear,r=this.year===this.maxYear,o=lK(this.range,this.year);Array.from(this.grid.children).forEach((a,s)=>{const l=Im(new Date(this.year,s,1),1,this.isRangeEnd);this.renderCell(a,this.monthNames[s],s,l,{selected:e,range:o},i||n&&s<this.minMonth||r&&s>this.maxMonth)})}refresh(){const e=this.selected[this.year]||[],i=lK(this.range,this.year)||[];Array.from(this.grid.children).forEach((n,r)=>{this.refreshCell(n,r,e,i)})}refreshFocus(){this.changeFocusedCell(this.focused)}}function wVe(t){return[...t].reduce((e,i,n)=>e+=n?i:i.toUpperCase(),"")}class cK extends v4{constructor(e,i){super(e,i)}init(e,i=!0){i&&(this.navStep=this.step*10,this.beforeShowOption=`beforeShow${wVe(this.cellClass)}`,this.grid=this.element,this.element.classList.add(this.name,"datepicker-grid"),this.grid.appendChild(pf(Ew("span",12)))),super.init(e)}setOptions(e){if("minDate"in e&&(e.minDate===void 0?this.minYear=this.minDate=void 0:(this.minYear=$b(e.minDate,this.step),this.minDate=Mw(this.minYear,0,1))),"maxDate"in e&&(e.maxDate===void 0?this.maxYear=this.maxDate=void 0:(this.maxYear=$b(e.maxDate,this.step),this.maxDate=Mw(this.maxYear,11,31))),e.checkDisabled&&(this.checkDisabled=this.isMinView||e.datesDisabled===null?e.checkDisabled:()=>!1),this.beforeShowOption in e){const i=e[this.beforeShowOption];this.beforeShow=typeof i=="function"?i:void 0}}updateFocus(){const e=new Date(this.picker.viewDate),i=$b(e,this.navStep),n=i+9*this.step;this.first=i,this.last=n,this.start=i-this.step,this.focused=$b(e,this.step)}updateSelection(){const{dates:e,rangepicker:i}=this.picker.datepicker;this.selected=e.reduce((n,r)=>$C(n,$b(r,this.step)),[]),i&&i.dates&&(this.range=i.dates.map(n=>{if(n!==void 0)return $b(n,this.step)}))}render(){this.prepareForRender(`${this.first}-${this.last}`,this.first<=this.minYear,this.last>=this.maxYear),Array.from(this.grid.children).forEach((e,i)=>{const n=this.start+i*this.step,r=Im(new Date(n,0,1),2,this.isRangeEnd);e.dataset.year=n,this.renderCell(e,n,n,r,this,n<this.minYear||n>this.maxYear)})}refresh(){const e=this.range||[];Array.from(this.grid.children).forEach(i=>{this.refreshCell(i,Number(i.textContent),this.selected,e)})}refreshFocus(){this.changeFocusedCell(Math.round((this.focused-this.start)/this.step))}}function iI(t,e){const i={bubbles:!0,cancelable:!0,detail:{date:t.getDate(),viewDate:new Date(t.picker.viewDate),viewId:t.picker.currentView.id,datepicker:t}};t.element.dispatchEvent(new CustomEvent(e,i))}function dN(t,e){const{config:i,picker:n}=t,{currentView:r,viewDate:o}=n;let a;switch(r.id){case 0:a=sN(o,e);break;case 1:a=YU(o,e);break;default:a=YU(o,e*r.navStep)}a=Gge(a,i.minDate,i.maxDate),n.changeFocus(a).render()}function eve(t){const e=t.picker.currentView.id;e!==t.config.maxView&&t.picker.changeView(e+1).render()}function tve(t){t.setDate({clear:!0})}function ive(t){const e=bb();t.config.todayButtonMode===1?t.setDate(e,{forceRefresh:!0,viewDate:e}):t.setFocusedDate(e,!0)}function nve(t){const e=()=>{t.config.updateOnBlur?t.update({revert:!0}):t.refresh("input"),t.hide()},i=t.element;Ox(i)?i.addEventListener("blur",e,{once:!0}):e()}function uK(t,e){const i=t.picker,n=new Date(i.viewDate),r=i.currentView.id,o=r===1?sN(n,e-n.getMonth()):YU(n,e-n.getFullYear());i.changeFocus(o).changeView(r-1).render()}function SVe(t){eve(t)}function TVe(t){dN(t,-1)}function UVe(t){dN(t,1)}function DVe(t,e){const i=Jge(e,".datepicker-cell");if(!i||i.classList.contains("disabled"))return;const{id:n,isMinView:r}=t.picker.currentView,o=i.dataset;r?t.setDate(Number(o.date)):n===1?uK(t,Number(o.month)):uK(t,Number(o.year))}function PVe(t){t.preventDefault()}const OL=["left","top","right","bottom"].reduce((t,e)=>(t[e]=`datepicker-orient-${e}`,t),{}),dK=t=>t&&`${t}px`;function pK(t,e){if("title"in e&&(e.title?(t.controls.title.textContent=e.title,yT(t.controls.title)):(t.controls.title.textContent="",vT(t.controls.title))),e.prevArrow){const i=t.controls.prevButton;lN(i),e.prevArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.nextArrow){const i=t.controls.nextButton;lN(i),e.nextArrow.forEach(n=>{i.appendChild(n.cloneNode(!0))})}if(e.locale&&(t.controls.todayButton.textContent=e.locale.today,t.controls.clearButton.textContent=e.locale.clear),"todayButton"in e&&(e.todayButton?yT(t.controls.todayButton):vT(t.controls.todayButton)),"minDate"in e||"maxDate"in e){const{minDate:i,maxDate:n}=t.datepicker.config;t.controls.todayButton.disabled=!f4(bb(),i,n)}"clearButton"in e&&(e.clearButton?yT(t.controls.clearButton):vT(t.controls.clearButton))}function hK(t){const{dates:e,config:i,rangeSideIndex:n}=t,r=e.length>0?h4(e):Im(i.defaultViewDate,i.pickLevel,n);return Gge(r,i.minDate,i.maxDate)}function fK(t,e){!("_oldViewDate"in t)&&e!==t.viewDate&&(t._oldViewDate=t.viewDate),t.viewDate=e;const{id:i,year:n,first:r,last:o}=t.currentView,a=new Date(e).getFullYear();switch(i){case 0:return e<r||e>o;case 1:return a!==n;default:return a<r||a>o}}function LL(t){return window.getComputedStyle(t).direction}function rve(t){const e=Kge(t);if(!(e===document.body||!e))return window.getComputedStyle(e).overflow!=="visible"?e:rve(e)}class CVe{constructor(e){const{config:i,inputField:n}=this.datepicker=e,r=gVe.replace(/%buttonClass%/g,i.buttonClass),o=this.element=pf(r).firstChild,[a,s,l]=o.firstChild.children,c=a.firstElementChild,[u,d,p]=a.lastElementChild.children,[h,f]=l.firstChild.children,m={title:c,prevButton:u,viewSwitch:d,nextButton:p,todayButton:h,clearButton:f};this.main=s,this.controls=m;const g=n?"dropdown":"inline";o.classList.add(`datepicker-${g}`),pK(this,i),this.viewDate=hK(e),uN(e,[[o,"mousedown",PVe],[s,"click",DVe.bind(null,e)],[m.viewSwitch,"click",SVe.bind(null,e)],[m.prevButton,"click",TVe.bind(null,e)],[m.nextButton,"click",UVe.bind(null,e)],[m.todayButton,"click",ive.bind(null,e)],[m.clearButton,"click",tve.bind(null,e)]]),this.views=[new bVe(this),new IVe(this),new cK(this,{id:2,name:"years",cellClass:"year",step:1}),new cK(this,{id:3,name:"decades",cellClass:"decade",step:10})],this.currentView=this.views[i.startView],this.currentView.render(),this.main.appendChild(this.currentView.element),i.container?i.container.appendChild(this.element):n.after(this.element)}setOptions(e){pK(this,e),this.views.forEach(i=>{i.init(e,!1)}),this.currentView.render()}detach(){this.element.remove()}show(){if(this.active)return;const{datepicker:e,element:i}=this,n=e.inputField;if(n){const r=LL(n);r!==LL(Kge(i))?i.dir=r:i.dir&&i.removeAttribute("dir"),this.place(),i.classList.add("active"),e.config.disableTouchKeyboard&&n.blur()}else i.classList.add("active");this.active=!0,iI(e,"show")}hide(){this.active&&(this.datepicker.exitEditMode(),this.element.classList.remove("active"),this.active=!1,iI(this.datepicker,"hide"))}place(){const{classList:e,style:i}=this.element;i.display="block";const{width:n,height:r}=this.element.getBoundingClientRect(),o=this.element.offsetParent;i.display="";const{config:a,inputField:s}=this.datepicker,{left:l,top:c,right:u,bottom:d,width:p,height:h}=s.getBoundingClientRect();let{x:f,y:m}=a.orientation,g=l,v=c;if(o===document.body||!o)g+=window.scrollX,v+=window.scrollY;else{const U=o.getBoundingClientRect();g-=U.left-o.scrollLeft,v-=U.top-o.scrollTop}const y=rve(s);let b=0,I=0,{clientWidth:T,clientHeight:S}=document.documentElement;if(y){const U=y.getBoundingClientRect();U.top>0&&(I=U.top),U.left>0&&(b=U.left),U.right<T&&(T=U.right),U.bottom<S&&(S=U.bottom)}let w=0;f==="auto"&&(l<b?(f="left",w=b-l):l+n>T?(f="right",T<u&&(w=T-u)):LL(s)==="rtl"?f=u-n<b?"left":"right":f="left"),f==="right"&&(g+=p-n),g+=w,m==="auto"&&(c-r>I?m=d+r>S?"top":"bottom":m="bottom"),m==="top"?v-=r:v+=h,e.remove(...Object.values(OL)),e.add(OL[f],OL[m]),i.left=dK(g),i.top=dK(v)}setViewSwitchLabel(e){this.controls.viewSwitch.textContent=e}setPrevButtonDisabled(e){this.controls.prevButton.disabled=e}setNextButtonDisabled(e){this.controls.nextButton.disabled=e}changeView(e){const i=this.currentView;return e!==i.id&&(this._oldView||(this._oldView=i),this.currentView=this.views[e],this._renderMethod="render"),this}changeFocus(e){return this._renderMethod=fK(this,e)?"render":"refreshFocus",this.views.forEach(i=>{i.updateFocus()}),this}update(e=void 0){const i=e===void 0?hK(this.datepicker):e;return this._renderMethod=fK(this,i)?"render":"refresh",this.views.forEach(n=>{n.updateFocus(),n.updateSelection()}),this}render(e=!0){const{currentView:i,datepicker:n,_oldView:r}=this,o=new Date(this._oldViewDate),a=e&&this._renderMethod||"render";if(delete this._oldView,delete this._oldViewDate,delete this._renderMethod,i[a](),r&&(this.main.replaceChild(i.element,r.element),iI(n,"changeView")),!isNaN(o)){const s=new Date(this.viewDate);s.getFullYear()!==o.getFullYear()&&iI(n,"changeYear"),s.getMonth()!==o.getMonth()&&iI(n,"changeMonth")}}}function ove(t,e,i,n,r,o){if(f4(t,r,o)){if(n(t)){const a=e(t,i);return ove(a,e,i,n,r,o)}return t}}function EVe(t,e,i){const n=t.picker,r=n.currentView,o=r.step||1;let a=n.viewDate,s;switch(r.id){case 0:a=qU(a,i?e*7:e),s=qU;break;case 1:a=sN(a,i?e*4:e),s=sN;break;default:a=YU(a,e*(i?4:1)*o),s=YU}a=ove(a,s,e<0?-o:o,l=>r.disabled.includes(l),r.minDate,r.maxDate),a!==void 0&&n.changeFocus(a).render()}function MVe(t,e){const{config:i,picker:n,editMode:r}=t,o=n.active,{key:a,altKey:s,shiftKey:l}=e,c=e.ctrlKey||e.metaKey,u=()=>{e.preventDefault(),e.stopPropagation()};if(a==="Tab"){nve(t);return}if(a==="Enter"){if(!o)t.update();else if(r)t.exitEditMode({update:!0,autohide:i.autohide});else{const m=n.currentView;m.isMinView?t.setDate(n.viewDate):(n.changeView(m.id-1).render(),u())}return}const d=i.shortcutKeys,p={key:a,ctrlOrMetaKey:c,altKey:s,shiftKey:l},h=Object.keys(d).find(m=>{const g=d[m];return!Object.keys(g).find(v=>g[v]!==p[v])});if(h){let m;if(h==="toggle"?m=h:r?h==="exitEditMode"&&(m=h):o?h==="hide"?m=h:h==="prevButton"?m=[dN,[t,-1]]:h==="nextButton"?m=[dN,[t,1]]:h==="viewSwitch"?m=[eve,[t]]:i.clearButton&&h==="clearButton"?m=[tve,[t]]:i.todayButton&&h==="todayButton"&&(m=[ive,[t]]):h==="show"&&(m=h),m){Array.isArray(m)?m[0].apply(null,m[1]):t[m](),u();return}}if(!o||r)return;const f=(m,g)=>{l||c||s?t.enterEditMode():(EVe(t,m,g),e.preventDefault())};a==="ArrowLeft"?f(-1,!1):a==="ArrowRight"?f(1,!1):a==="ArrowUp"?f(-1,!0):a==="ArrowDown"?f(1,!0):(a==="Backspace"||a==="Delete"||a&&a.length===1&&!c)&&t.enterEditMode()}function RVe(t){t.config.showOnFocus&&!t._showing&&t.show()}function NVe(t,e){const i=e.target;(t.picker.active||t.config.showOnClick)&&(i._active=Ox(i),i._clicking=setTimeout(()=>{delete i._active,delete i._clicking},2e3))}function AVe(t,e){const i=e.target;i._clicking&&(clearTimeout(i._clicking),delete i._clicking,i._active&&t.enterEditMode(),delete i._active,t.config.showOnClick&&t.show())}function _Ve(t,e){e.clipboardData.types.includes("text/plain")&&t.enterEditMode()}function kVe(t,e){const{element:i,picker:n}=t;if(!n.active&&!Ox(i))return;const r=n.element;Jge(e,o=>o===i||o===r)||nve(t)}function ave(t,e){return t.map(i=>VC(i,e.format,e.locale)).join(e.dateDelimiter)}function sve(t,e,i=!1){if(e.length===0)return i?[]:void 0;const{config:n,dates:r,rangeSideIndex:o}=t,{pickLevel:a,maxNumberOfDates:s}=n;let l=e.reduce((c,u)=>{let d=ly(u,n.format,n.locale);return d===void 0||(d=Im(d,a,o),f4(d,n.minDate,n.maxDate)&&!c.includes(d)&&!n.checkDisabled(d,a)&&(a>0||!n.daysOfWeekDisabled.includes(new Date(d).getDay()))&&c.push(d)),c},[]);if(l.length!==0)return n.multidate&&!i&&(l=l.reduce((c,u)=>(r.includes(u)||c.push(u),c),r.filter(c=>!l.includes(c)))),s&&l.length>s?l.slice(s*-1):l}function pN(t,e=3,i=!0,n=void 0){const{config:r,picker:o,inputField:a}=t;if(e&2){const s=o.active?r.pickLevel:r.startView;o.update(n).changeView(s).render(i)}e&1&&a&&(a.value=ave(t.dates,r))}function mK(t,e,i){const n=t.config;let{clear:r,render:o,autohide:a,revert:s,forceRefresh:l,viewDate:c}=i;o===void 0&&(o=!0),o?a===void 0&&(a=n.autohide):a=l=!1,c=ly(c,n.format,n.locale);const u=sve(t,e,r);!u&&!s||(u&&u.toString()!==t.dates.toString()?(t.dates=u,pN(t,o?3:1,!0,c),iI(t,"changeDate")):pN(t,l?3:1,!0,c),a&&t.hide())}function gK(t,e){return e?i=>VC(i,e,t.config.locale):i=>new Date(i)}class lve{constructor(e,i={},n=void 0){e.datepicker=this,this.element=e,this.dates=[];const r=this.config=Object.assign({buttonClass:i.buttonClass&&String(i.buttonClass)||"button",container:null,defaultViewDate:bb(),maxDate:void 0,minDate:void 0},xL(g4,this));let o;if(e.tagName==="INPUT"?(o=this.inputField=e,o.classList.add("datepicker-input"),i.container&&(r.container=i.container instanceof HTMLElement?i.container:document.querySelector(i.container))):r.container=e,n){const u=n.inputs.indexOf(o),d=n.datepickers;if(u<0||u>1||!Array.isArray(d))throw Error("Invalid rangepicker object.");d[u]=this,this.rangepicker=n,this.rangeSideIndex=u}this._options=i,Object.assign(r,xL(i,this)),r.shortcutKeys=mVe(i.shortcutKeys||{});const a=eK(e.value||e.dataset.date,r.dateDelimiter);delete e.dataset.date;const s=sve(this,a);s&&s.length>0&&(this.dates=s),o&&(o.value=ave(this.dates,r));const l=this.picker=new CVe(this),c=[e,"keydown",MVe.bind(null,this)];o?uN(this,[c,[o,"focus",RVe.bind(null,this)],[o,"mousedown",NVe.bind(null,this)],[o,"click",AVe.bind(null,this)],[o,"paste",_Ve.bind(null,this)],[document,"mousedown",kVe.bind(null,this)],[window,"resize",l.place.bind(l)]]):(uN(this,[c]),this.show())}static formatDate(e,i,n){return VC(e,i,n&&gS[n]||gS.en)}static parseDate(e,i,n){return ly(e,i,n&&gS[n]||gS.en)}static get locales(){return gS}get active(){return!!(this.picker&&this.picker.active)}get pickerElement(){return this.picker?this.picker.element:void 0}setOptions(e){const i=xL(e,this);Object.assign(this._options,e),Object.assign(this.config,i),this.picker.setOptions(i),pN(this,3)}show(){if(this.inputField){const{config:e,inputField:i}=this;if(i.disabled||i.readOnly&&!e.enableOnReadonly)return;!Ox(i)&&!e.disableTouchKeyboard&&(this._showing=!0,i.focus(),delete this._showing)}this.picker.show()}hide(){this.inputField&&(this.picker.hide(),this.picker.update().changeView(this.config.startView).render())}toggle(){this.picker.active?this.inputField&&this.picker.hide():this.show()}destroy(){this.hide(),Zge(this),this.picker.detach();const e=this.element;return e.classList.remove("datepicker-input"),delete e.datepicker,this}getDate(e=void 0){const i=gK(this,e);if(this.config.multidate)return this.dates.map(i);if(this.dates.length>0)return i(this.dates[0])}setDate(...e){const i=[...e],n={},r=h4(e);r&&typeof r=="object"&&!Array.isArray(r)&&!(r instanceof Date)&&Object.assign(n,i.pop());const o=Array.isArray(i[0])?i[0]:i;mK(this,o,n)}update(e=void 0){if(!this.inputField)return;const i=Object.assign(e||{},{clear:!0,render:!0,viewDate:void 0}),n=eK(this.inputField.value,this.config.dateDelimiter);mK(this,n,i)}getFocusedDate(e=void 0){return gK(this,e)(this.picker.viewDate)}setFocusedDate(e,i=!1){const{config:n,picker:r,active:o,rangeSideIndex:a}=this,s=n.pickLevel,l=ly(e,n.format,n.locale);l!==void 0&&(r.changeFocus(Im(l,s,a)),o&&i&&r.changeView(s),r.render())}refresh(e=void 0,i=!1){e&&typeof e!="string"&&(i=e,e=void 0);let n;e==="picker"?n=2:e==="input"?n=1:n=3,pN(this,n,!i)}enterEditMode(){const e=this.inputField;!e||e.readOnly||!this.picker.active||this.editMode||(this.editMode=!0,e.classList.add("in-edit"))}exitEditMode(e=void 0){if(!this.inputField||!this.editMode)return;const i=Object.assign({update:!1},e);delete this.editMode,this.inputField.classList.remove("in-edit"),i.update&&this.update(i)}}function vK(t){const e=Object.assign({},t);return delete e.inputs,delete e.allowOneSidedRange,delete e.maxNumberOfDates,e}function xVe(t,e,i,n){uN(t,[[i,"changeDate",e]]),new lve(i,n,t)}function vS(t,e){if(t._updating)return;t._updating=!0;const i=e.target;if(i.datepicker===void 0)return;const n=t.datepickers,[r,o]=n,a={render:!1},s=t.inputs.indexOf(i),l=s===0?1:0,c=n[s].dates[0],u=n[l].dates[0];c!==void 0&&u!==void 0?s===0&&c>u?(r.setDate(u,a),o.setDate(c,a)):s===1&&c<u&&(r.setDate(c,a),o.setDate(u,a)):t.allowOneSidedRange||(c!==void 0||u!==void 0)&&(a.clear=!0,n[l].setDate(n[s].dates,a)),n.forEach(d=>{d.picker.update().render()}),delete t._updating}class OVe{constructor(e,i={}){let n=Array.isArray(i.inputs)?i.inputs:Array.from(e.querySelectorAll("input"));if(n.length<2)return;e.rangepicker=this,this.element=e,this.inputs=n=n.slice(0,2),Object.freeze(n),this.allowOneSidedRange=!!i.allowOneSidedRange;const r=vS.bind(null,this),o=vK(i),a=this.datepickers=[];n.forEach(s=>{xVe(this,r,s,o)}),Object.freeze(a),Object.defineProperty(this,"dates",{get(){return a.map(s=>s.dates[0])}}),a[0].dates.length>0?vS(this,{target:n[0]}):a[1].dates.length>0&&vS(this,{target:n[1]})}setOptions(e){this.allowOneSidedRange=!!e.allowOneSidedRange;const i=vK(e);this.datepickers.forEach(n=>{n.setOptions(i)})}destroy(){this.datepickers.forEach(e=>{e.destroy()}),Zge(this),delete this.element.rangepicker}getDates(e=void 0){const i=e?n=>VC(n,e,this.datepickers[0].config.locale):n=>new Date(n);return this.dates.map(n=>n===void 0?n:i(n))}setDates(e,i){const{datepickers:[n,r],inputs:[o,a],dates:[s,l]}=this;this._updating=!0,n.setDate(e),r.setDate(i),delete this._updating,r.dates[0]!==l?vS(this,{target:a}):n.dates[0]!==s&&vS(this,{target:o})}}var cve=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function y4(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function LVe(t){if(t.__esModule)return t;var e=t.default;if(typeof e=="function"){var i=function n(){return this instanceof n?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};i.prototype=e.prototype}else i={};return Object.defineProperty(i,"__esModule",{value:!0}),Object.keys(t).forEach(function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(i,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})}),i}var uve={exports:{}};(function(t){(function(){var e=function(l,c){var u=this;e.count=(e.count||0)+1,this.count=e.count,this.isOpened=!1,this.input=o(l),this.input.setAttribute("autocomplete","off"),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-owns","awesomplete_list_"+this.count),this.input.setAttribute("role","combobox"),this.options=c=c||{},n(this,{minChars:2,maxItems:10,autoFirst:!1,data:e.DATA,filter:e.FILTER_CONTAINS,sort:c.sort===!1?!1:e.SORT_BYLENGTH,container:e.CONTAINER,item:e.ITEM,replace:e.REPLACE,tabSelect:!1},c),this.index=-1,this.container=this.container(l),this.ul=o.create("ul",{hidden:"hidden",role:"listbox",id:"awesomplete_list_"+this.count,inside:this.container}),this.status=o.create("span",{className:"visually-hidden",role:"status","aria-live":"assertive","aria-atomic":!0,inside:this.container,textContent:this.minChars!=0?"Type "+this.minChars+" or more characters for results.":"Begin typing for results."}),this._events={input:{input:this.evaluate.bind(this),blur:this.close.bind(this,{reason:"blur"}),keydown:function(d){var p=d.keyCode;u.opened&&(p===13&&u.selected?(d.preventDefault(),u.select(void 0,void 0,d)):p===9&&u.selected&&u.tabSelect?u.select(void 0,void 0,d):p===27?u.close({reason:"esc"}):(p===38||p===40)&&(d.preventDefault(),u[p===38?"previous":"next"]()))}},form:{submit:this.close.bind(this,{reason:"submit"})},ul:{mousedown:function(d){d.preventDefault()},click:function(d){var p=d.target;if(p!==this){for(;p&&!/li/i.test(p.nodeName);)p=p.parentNode;p&&d.button===0&&(d.preventDefault(),u.select(p,d.target,d))}}}},o.bind(this.input,this._events.input),o.bind(this.input.form,this._events.form),o.bind(this.ul,this._events.ul),this.input.hasAttribute("list")?(this.list="#"+this.input.getAttribute("list"),this.input.removeAttribute("list")):this.list=this.input.getAttribute("data-list")||c.list||[],e.all.push(this)};e.prototype={set list(l){if(Array.isArray(l))this._list=l;else if(typeof l=="string"&&l.indexOf(",")>-1)this._list=l.split(/\s*,\s*/);else if(l=o(l),l&&l.children){var c=[];r.apply(l.children).forEach(function(u){if(!u.disabled){var d=u.textContent.trim(),p=u.value||d,h=u.label||d;p!==""&&c.push({label:h,value:p})}}),this._list=c}document.activeElement===this.input&&this.evaluate()},get selected(){return this.index>-1},get opened(){return this.isOpened},close:function(l){this.opened&&(this.input.setAttribute("aria-expanded","false"),this.ul.setAttribute("hidden",""),this.isOpened=!1,this.index=-1,this.status.setAttribute("hidden",""),o.fire(this.input,"awesomplete-close",l||{}))},open:function(){this.input.setAttribute("aria-expanded","true"),this.ul.removeAttribute("hidden"),this.isOpened=!0,this.status.removeAttribute("hidden"),this.autoFirst&&this.index===-1&&this.goto(0),o.fire(this.input,"awesomplete-open")},destroy:function(){if(o.unbind(this.input,this._events.input),o.unbind(this.input.form,this._events.form),!this.options.container){var l=this.container.parentNode;l.insertBefore(this.input,this.container),l.removeChild(this.container)}this.input.removeAttribute("autocomplete"),this.input.removeAttribute("aria-autocomplete");var c=e.all.indexOf(this);c!==-1&&e.all.splice(c,1)},next:function(){var l=this.ul.children.length;this.goto(this.index<l-1?this.index+1:l?0:-1)},previous:function(){var l=this.ul.children.length,c=this.index-1;this.goto(this.selected&&c!==-1?c:l-1)},goto:function(l){var c=this.ul.children;this.selected&&c[this.index].setAttribute("aria-selected","false"),this.index=l,l>-1&&c.length>0&&(c[l].setAttribute("aria-selected","true"),this.status.textContent=c[l].textContent+", list item "+(l+1)+" of "+c.length,this.input.setAttribute("aria-activedescendant",this.ul.id+"_item_"+this.index),this.ul.scrollTop=c[l].offsetTop-this.ul.clientHeight+c[l].clientHeight,o.fire(this.input,"awesomplete-highlight",{text:this.suggestions[this.index]}))},select:function(l,c,u){if(l?this.index=o.siblingIndex(l):l=this.ul.children[this.index],l){var d=this.suggestions[this.index],p=o.fire(this.input,"awesomplete-select",{text:d,origin:c||l,originalEvent:u});p&&(this.replace(d),this.close({reason:"select"}),o.fire(this.input,"awesomplete-selectcomplete",{text:d,originalEvent:u}))}},evaluate:function(){var l=this,c=this.input.value;c.length>=this.minChars&&this._list&&this._list.length>0?(this.index=-1,this.ul.innerHTML="",this.suggestions=this._list.map(function(u){return new i(l.data(u,c))}).filter(function(u){return l.filter(u,c)}),this.sort!==!1&&(this.suggestions=this.suggestions.sort(this.sort)),this.suggestions=this.suggestions.slice(0,this.maxItems),this.suggestions.forEach(function(u,d){l.ul.appendChild(l.item(u,c,d))}),this.ul.children.length===0?(this.status.textContent="No results found",this.close({reason:"nomatches"})):(this.open(),this.status.textContent=this.ul.children.length+" results found")):(this.close({reason:"nomatches"}),this.status.textContent="No results found")}},e.all=[],e.FILTER_CONTAINS=function(l,c){return RegExp(o.regExpEscape(c.trim()),"i").test(l)},e.FILTER_STARTSWITH=function(l,c){return RegExp("^"+o.regExpEscape(c.trim()),"i").test(l)},e.SORT_BYLENGTH=function(l,c){return l.length!==c.length?l.length-c.length:l<c?-1:1},e.CONTAINER=function(l){return o.create("div",{className:"awesomplete",around:l})},e.ITEM=function(l,c,u){var d=c.trim()===""?l:l.replace(RegExp(o.regExpEscape(c.trim()),"gi"),"<mark>$&</mark>");return o.create("li",{innerHTML:d,role:"option","aria-selected":"false",id:"awesomplete_list_"+this.count+"_item_"+u})},e.REPLACE=function(l){this.input.value=l.value},e.DATA=function(l){return l};function i(l){var c=Array.isArray(l)?{label:l[0],value:l[1]}:typeof l=="object"&&"label"in l&&"value"in l?l:{label:l,value:l};this.label=c.label||c.value,this.value=c.value}Object.defineProperty(i.prototype=Object.create(String.prototype),"length",{get:function(){return this.label.length}}),i.prototype.toString=i.prototype.valueOf=function(){return""+this.label};function n(l,c,u){for(var d in c){var p=c[d],h=l.input.getAttribute("data-"+d.toLowerCase());typeof p=="number"?l[d]=parseInt(h):p===!1?l[d]=h!==null:p instanceof Function?l[d]=null:l[d]=h,!l[d]&&l[d]!==0&&(l[d]=d in u?u[d]:p)}}var r=Array.prototype.slice;function o(l,c){return typeof l=="string"?(c||document).querySelector(l):l||null}function a(l,c){return r.call((c||document).querySelectorAll(l))}o.create=function(l,c){var u=document.createElement(l);for(var d in c){var p=c[d];if(d==="inside")o(p).appendChild(u);else if(d==="around"){var h=o(p);h.parentNode.insertBefore(u,h),u.appendChild(h),h.getAttribute("autofocus")!=null&&h.focus()}else d in u?u[d]=p:u.setAttribute(d,p)}return u},o.bind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.addEventListener(p,d)})}},o.unbind=function(l,c){if(l)for(var u in c){var d=c[u];u.split(/\s+/).forEach(function(p){l.removeEventListener(p,d)})}},o.fire=function(l,c,u){var d=document.createEvent("HTMLEvents");d.initEvent(c,!0,!0);for(var p in u)d[p]=u[p];return l.dispatchEvent(d)},o.regExpEscape=function(l){return l.replace(/[-\\^$*+?.()|[\]{}]/g,"\\$&")},o.siblingIndex=function(l){for(var c=0;l=l.previousElementSibling;c++);return c};function s(){a("input.awesomplete").forEach(function(l){new e(l)})}return typeof self<"u"&&(self.Awesomplete=e),typeof Document<"u"&&(document.readyState!=="loading"?s():document.addEventListener("DOMContentLoaded",s)),e.$=o,e.$$=a,t.exports&&(t.exports=e),e})()})(uve);var FVe=uve.exports;const BVe=y4(FVe);function $Ve({list:t,element:e,callback:i,currentValue:n,withCatchTab:r,onChange:o}){var c;const a=new BVe(e,{list:t});let s=!1;const l=u=>{s=!0,vt(i)&&i(u.text.value),e.value=u.text.label,a.suggestions=[]};if(r){const u=d=>d.which===9&&d.preventDefault();e.addEventListener("keydown",u,!1),e.addEventListener("keyup",u,!1)}if(typeof o=="function"&&e.addEventListener("change",o),e.setAttribute("autocomplete","cc-number"),e.addEventListener("awesomplete-selectcomplete",u=>l(u),!1),e.addEventListener("keyup",function(u){var d;(u.which===13||u.which===9)&&!s&&((d=a.suggestions)!=null&&d.length)&&(a.next(),a.select(0)),s=!1}),n){const u=(c=t.find(d=>d.value===n))==null?void 0:c.label;u&&(e.value=u)}return{typeAhead:a}}function dve(t,e,i,n,r){if(r){const o=e.target.value;r(o)?(n.innerHTML="",n.classList.remove("is-danger"),i.classList.remove("is-danger"),i.classList.add("is-success")):(n.innerHTML=t.error||"Invalid",i.classList.remove("is-success"),i.classList.add("is-danger"),n.classList.add("is-danger"))}}function b4(t,e){for(const i of e.options){if(i.hide)continue;const n=document.createElement("option");n.className="font-medium",i.value&&n.setAttribute("value",i.value),(i.selected||e.value===i.value)&&n.setAttribute("selected","true"),i.disabled&&n.setAttribute("disabled","true"),n.innerHTML=i.label,t.appendChild(n)}}function bT(t){var o,a;const e=document.createElement("div");if(e.className="field font-medium",t.class&&e.classList.add(t.class),t.width?e.style=`width: ${t.width}`:e.style="flex-grow: 1",t.label&&!t.checkbox){const s=document.createElement("label");s.style=t.labelStyle||"font-weight: bold; font-size: larger;",s.innerHTML=t.label,e.appendChild(s)}let i,n;const r=document.createElement("div");if(r.className="control font-medium",t.text){const s=document.createElement("div");t.id&&(s.id=t.id),s.className="content",s.innerHTML=t.text,r.appendChild(s)}else if(t.radio){const s=document.createElement("div");s.id=t.id,s.className="control";for(const l of t.options??[]){const c=document.createElement("label");c.className="radio";const u=document.createElement("input");u.name=t.id,u.type="radio",u.value=l.text,l.checked&&(u.checked=!0),c.appendChild(u),s.appendChild(c);const d=document.createElement("span");d.style.marginLeft=".25em",d.style.marginRight="1em",d.innerHTML=l.text,s.appendChild(d)}r.appendChild(s),i=s}else if(t.options){const s=document.createElement("div");s.className="select font-medium",s.style="width: 100%";const l=document.createElement("select");if(t.id&&(s.id=t.id),t.disabled&&(l.disabled=!0),l.style="width: 100%",b4(l,t),s.appendChild(l),r.appendChild(s),t.help){const c=document.createElement("p");c.className="help font-medium is-info",c.innerHTML=(o=t.help)==null?void 0:o.text,c.style.display=(a=t.help)!=null&&a.visible?"":ht,r.appendChild(c)}i=l,vt(t.onChange)&&l.addEventListener("change",c=>t.onChange(c,t))}else if(t.checkbox){const s=document.createElement("div");s.className="flexrow field nowrap",s.style.display="inline-block";const l=document.createElement("input");i=l;const c=t.intent??"is-success";l.className=`is-checkradio ${c}`,l.type="checkbox",l.id=t.id,t.checked&&(l.checked=!0),s.appendChild(l);const u=document.createElement("label");u.setAttribute("for",t.id),t.color&&(u.style.color=t.color),u.innerHTML=t.label,s.appendChild(u),r.appendChild(s)}else{const s=document.createElement("input");if(s.className="input font-medium",t.class&&s.classList.add(t.class),s.setAttribute("type",t.type||"text"),s.setAttribute("autocomplete",t.autocomplete||"cc-number"),s.setAttribute("placeholder",t.placeholder||""),t.disabled&&s.setAttribute("disabled",!0),t.id&&s.setAttribute("id",t.id),r.appendChild(s),t.iconLeft){r.classList.add("has-icons-left");const c=document.createElement("span");c.className="icon is-small is-left font-medium";const u=document.createElement("i");u.className=t.iconLeft,c.appendChild(u),r.appendChild(c)}if(t.type==="password"){r.classList.add("has-icons-right");const c=document.createElement("span");c.className="icon is-small is-right font-medium";const u=document.createElement("i");u.className=t.iconRight,c.appendChild(u),r.appendChild(c)}i=s;const l=document.createElement("p");l.className="help font-medium",r.appendChild(l),t.validator&&s.addEventListener("input",c=>dve(t,c,s,l,t.validator)),t.date?n=new lve(i,{format:"yyyy-mm-dd",autohide:!0}):t.typeAhead?$Ve({...t.typeAhead,element:s}):(vt(t.onKeyDown)&&s.addEventListener("keydown",c=>t.onKeyDown(c,t)),vt(t.onChange)&&s.addEventListener("change",c=>t.onChange(c,t)),vt(t.onInput)&&s.addEventListener("input",c=>t.onInput(c,t)),vt(t.onKeyUp)&&s.addEventListener("keyup",c=>t.onKeyUp(c,t)),t.value!==void 0&&(s.value=t.value)),t.selectOnFocus&&s.addEventListener("focus",()=>s.select())}return e.appendChild(r),t.visible===!1&&(e.style.display=ht),{field:e,inputElement:i,datepicker:n}}function ro(t,e,i){const n=document.createElement("div");n.style="display: flex; width: 100%;",n.classList.add("flexcol");const r={},o={};let a;for(const s of e){if((s.text||s.html)&&!s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const c=document.createElement("div");c.className="flexaligncenter",c.style="height: 2.5em; padding-right: 1em;";const u=document.createElement("div");if(s.id&&(u.id=s.id),u.className="content",u.innerHTML=s.text,c.appendChild(u),l){l.appendChild(c);const{field:d,inputElement:p,datepicker:h}=bT(s.fieldPair);h&&(r[`${s.field}.date`]=h),p&&(r[s.fieldPair.field]=p),o[s.fieldPair.field]=d,l.appendChild(d),n.appendChild(l)}else n.appendChild(c);continue}if(s.divider){const l=document.createElement("hr");l.classList.add("dropdown-divider"),n.appendChild(l);continue}if(s.spacer){const l=document.createElement("div"),c=typeof s.spacer=="number"&&`${s.spacer}em`||typeof s.spacer=="string"&&s.spacer||"1em";l.style.marginBlockEnd=c,n.appendChild(l);continue}if(!(!s.label&&!s.field||s.hide)&&s.field){const l=s.fieldPair&&document.createElement("div");l&&(l.className="flexrow");const{field:c,inputElement:u,datepicker:d}=bT(s);if(d&&(r[`${s.field}.date`]=d),s.focus&&(a=u),r[s.field]=u,o[s.field]=c,l){l.appendChild(c);const{field:p,inputElement:h,datepicker:f}=bT(s.fieldPair);f&&(r[`${s.field}.date`]=f),h&&(r[s.fieldPair.field]=h),o[s.fieldPair.field]=p,l.appendChild(p),n.appendChild(l)}else n.appendChild(c)}}if(a&&setTimeout(()=>a.focus(),200),t.appendChild(n),i!=null&&i.length)for(const s of i){if(s.dateRange&&Array.isArray(s.fields)){const[l,c]=s.fields,u=new OVe(r[l],{inputs:[r[l],r[c]],format:"yyyy-mm-dd",autohide:!0});r[`${l}.date`]=u}s.control&&(vt(s.onChange)&&r[s.control].addEventListener("change",l=>s.onChange({e:l,inputs:r,fields:o})),vt(s.onInput)&&r[s.control]&&r[s.control].addEventListener("input",l=>s.onInput({e:l,inputs:r,fields:o})))}return r}const Qe={tables:[],ee:null,drawer:null,modal:null,state:{authorized:!1,admin:!1},displayed:{schedule_day:null,draw_event:null},columns:{}};function VVe({table:t}){let e;const i=[{error:"minimum of 5 characters",placeholder:"Tournament name",validator:Xl(5),label:"Tournament name",field:"tournamentName",focus:!0},{placeholder:"YYYY-MM-DD",label:"Start date",field:"startDate"},{placeholder:"YYYY-MM-DD",label:"End date",field:"endDate"}],n=[{fields:["startDate","endDate"],dateRange:!0}],r=u=>{e=ro(u,i,n)},s=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-primary",onClick:()=>{const u=e.tournamentName.value,d=e.startDate.value,p=e.endDate.value;if(Ye.newTournamentRecord({tournamentName:u,startDate:d,endDate:p}).success){const f=oc(),{tournamentRecord:m}=Ye.getTournament();if(f!=null&&f.providerId){const g=v=>{var b;const y=(b=v.data)==null?void 0:b.provider;if(m.parentOrganisation=y,y){const I=T=>console.log("sendTournament",T);iVe({tournamentRecord:m}).then(I,I)}yK({tournamentRecord:m,table:t})};eVe({providerId:f.providerId}).then(g)}else yK({tournamentRecord:m,table:t})}},close:()=>Xl(5)(e.drawName.value)}],l="New tournament",c=(u,d)=>yb(u,s,d);Qe.drawer.open({title:l,content:r,footer:c,side:Ut,width:"300px"})}function yK({tournamentRecord:t,table:e}){Rx({tournamentRecord:t,callback:()=>e==null?void 0:e.addData([Zm(t)],!0)})}function jVe({table:t}){const e=t.getData().map(s=>s.tournamentId);let i;const n=s=>i=ro(s,[{iconLeft:"fa-solid fa-fingerprint",placeholder:"tournamentId",label:"Tournament Id",field:"tournamentId"}]),r=()=>{vi({onClose:()=>Qe.router.navigate("/tournaments"),message:"Tournament not found",intent:"is-warning",pauseOnHover:!0,action:"show"})},o=s=>{var d;const l=i.tournamentId.value,c=(d=s.data.tournamentRecords)==null?void 0:d[l];Rx({tournamentRecord:c,tournamentIds:e,table:t,callback:()=>{}})};lr({title:"Login",content:n,buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Load",intent:"is-primary",onClick:()=>{const s=i.tournamentId.value;p4({tournamentId:s}).then(o,r)},close:!0}]})}const FL="font-medium";function e$({target:t,button:e,stateChange:i}){var v;let n=0;const r=()=>(n+=1,`Item${n}`),o=document.createElement("div");e.class&&o.classList.add(e.class),o.classList.add("dropdown"),e.id&&(o.id=e.id),e.align===Ut?(o.classList.add("is-right"),o.style="margin-left: 1em"):o.style="margin-right: 1em";const a=y=>y.classList.contains("is-active"),s=()=>{a(o)&&o.classList.remove("is-active")},l=y=>{if(a(y))y.classList.remove("is-active");else return y.classList.add("is-active"),!0};o.onmouseleave=s,o.onclick=()=>l(o);const c=document.createElement("div");c.classList.add("dropdown-trigger");const u=document.createElement("button");u.className="button font-medium",e.intent&&u.classList.add(e.intent),u.setAttribute("aria-haspopup","true");const d=document.createElement("span");vt(e.onClick)&&(d.onclick=e.onClick),d.style="margin-right: 1em",d.innerHTML=e.label,u.appendChild(d);const p=document.createElement("span");vt(e.onClick)&&(p.onclick=e.onClick),p.innerHTML=`
      <span class="icon is-small font-medium">
        <i class="fas fa-angle-down font-medium" aria-hidden="true"></i>
      </span>
  `,u.appendChild(p),c.appendChild(u),o.appendChild(c);const h=document.createElement("div");h.classList.add("dropdown-menu"),h.zIndex=99998;const f=document.createElement("div");f.classList.add("dropdown-content");const m=()=>{const y=h.querySelectorAll(".dropdown-item");for(const b of Array.from(y))b.classList.remove("is-active")},g=y=>{const b=document.createElement("a");b.className=FL;const I=y.disabled?"0.4":"1";return b.style=`text-decoration: none; opacity: ${I};`,y.color&&(b.style.color=y.color),b.classList.add("dropdown-item"),y.isActive&&b.classList.add("is-active"),y.value&&(b.value=y.value),y.class&&b.classList.add(y.class),b.onclick=T=>{if(y.disabled)return;y.value&&(u.value=y.value,o.value=y.value),T.stopPropagation(),vt(y.onClick)&&(vt(i)&&i(),y.onClick(T)),y.close&&s();const S=a(b);m(),S?d.innerHTML=e.label:(e.selection&&l(b),e.modifyLabel&&y.modifyLabel!==!1&&(d.innerHTML=`${e.append?e.label+": ":""}${(y==null?void 0:y.label)||r()}`))},b.innerHTML=(y==null?void 0:y.label)||r(),b};for(const y of e.options||[])if(y.heading){const b=document.createElement("div");b.style="font-weight: bold",b.classList.add("dropdown-item"),b.classList.add(FL),b.innerHTML=y.heading,f.appendChild(b)}else if(y.divider){const b=document.createElement("hr");b.classList.add("dropdown-divider"),b.classList.add(FL),f.appendChild(b)}else y.hide||f.appendChild(g(y));return(v=e.options)!=null&&v.length&&(e.options[0].value&&(o.value=e.options[0].value),h.appendChild(f)),o.appendChild(h),t&&t.appendChild(o),o}class yl{constructor(e){this.table=e}reloadData(e,i,n){return this.table.dataLoader.load(e,void 0,void 0,void 0,i,n)}langText(){return this.table.modules.localize.getText(...arguments)}langBind(){return this.table.modules.localize.bind(...arguments)}langLocale(){return this.table.modules.localize.getLocale(...arguments)}commsConnections(){return this.table.modules.comms.getConnections(...arguments)}commsSend(){return this.table.modules.comms.send(...arguments)}layoutMode(){return this.table.modules.layout.getMode()}layoutRefresh(e){return this.table.modules.layout.layout(e)}subscribe(){return this.table.eventBus.subscribe(...arguments)}unsubscribe(){return this.table.eventBus.unsubscribe(...arguments)}subscribed(e){return this.table.eventBus.subscribed(e)}subscriptionChange(){return this.table.eventBus.subscriptionChange(...arguments)}dispatch(){return this.table.eventBus.dispatch(...arguments)}chain(){return this.table.eventBus.chain(...arguments)}confirm(){return this.table.eventBus.confirm(...arguments)}dispatchExternal(){return this.table.externalEvents.dispatch(...arguments)}subscribedExternal(e){return this.table.externalEvents.subscribed(e)}subscriptionChangeExternal(){return this.table.externalEvents.subscriptionChange(...arguments)}options(e){return this.table.options[e]}setOption(e,i){return typeof i<"u"&&(this.table.options[e]=i),this.table.options[e]}deprecationCheck(e,i,n){return this.table.deprecationAdvisor.check(e,i,n)}deprecationCheckMsg(e,i){return this.table.deprecationAdvisor.checkMsg(e,i)}deprecationMsg(e){return this.table.deprecationAdvisor.msg(e)}module(e){return this.table.module(e)}}class Jr{static elVisible(e){return!(e.offsetWidth<=0&&e.offsetHeight<=0)}static elOffset(e){var i=e.getBoundingClientRect();return{top:i.top+window.pageYOffset-document.documentElement.clientTop,left:i.left+window.pageXOffset-document.documentElement.clientLeft}}static retrieveNestedData(e,i,n){var r=e?i.split(e):[i],o=r.length,a;for(let s=0;s<o&&(n=n[r[s]],a=n,!!n);s++);return a}static deepClone(e,i,n=[]){var r={}.__proto__,o=[].__proto__;i||(i=Object.assign(Array.isArray(e)?[]:{},e));for(var a in e){let s=e[a],l,c;s!=null&&typeof s=="object"&&(s.__proto__===r||s.__proto__===o)&&(l=n.findIndex(u=>u.subject===s),l>-1?i[a]=n[l].copy:(c=Object.assign(Array.isArray(s)?[]:{},s),n.unshift({subject:s,copy:c}),i[a]=this.deepClone(s,c,n)))}return i}}let HVe=class pve extends yl{constructor(e,i,n){super(e),this.element=i,this.container=this._lookupContainer(),this.parent=n,this.reversedX=!1,this.childPopup=null,this.blurable=!1,this.blurCallback=null,this.blurEventsBound=!1,this.renderedCallback=null,this.visible=!1,this.hideable=!0,this.element.classList.add("tabulator-popup-container"),this.blurEvent=this.hide.bind(this,!1),this.escEvent=this._escapeCheck.bind(this),this.destroyBinding=this.tableDestroyed.bind(this),this.destroyed=!1}tableDestroyed(){this.destroyed=!0,this.hide(!0)}_lookupContainer(){var e=this.table.options.popupContainer;return typeof e=="string"?(e=document.querySelector(e),e||console.warn("Menu Error - no container element found matching selector:",this.table.options.popupContainer,"(defaulting to document body)")):e===!0&&(e=this.table.element),e&&!this._checkContainerIsParent(e)&&(e=!1,console.warn("Menu Error - container element does not contain this table:",this.table.options.popupContainer,"(defaulting to document body)")),e||(e=document.body),e}_checkContainerIsParent(e,i=this.table.element){return e===i?!0:i.parentNode?this._checkContainerIsParent(e,i.parentNode):!1}renderCallback(e){this.renderedCallback=e}containerEventCoords(e){var i=!(e instanceof MouseEvent),n=i?e.touches[0].pageX:e.pageX,r=i?e.touches[0].pageY:e.pageY;if(this.container!==document.body){let o=Jr.elOffset(this.container);n-=o.left,r-=o.top}return{x:n,y:r}}elementPositionCoords(e,i="right"){var n=Jr.elOffset(e),r,o,a;switch(this.container!==document.body&&(r=Jr.elOffset(this.container),n.left-=r.left,n.top-=r.top),i){case"right":o=n.left+e.offsetWidth,a=n.top-1;break;case"bottom":o=n.left,a=n.top+e.offsetHeight;break;case"left":o=n.left,a=n.top-1;break;case"top":o=n.left,a=n.top;break;case"center":o=n.left+e.offsetWidth/2,a=n.top+e.offsetHeight/2;break}return{x:o,y:a,offset:n}}show(e,i){var n,r,o,a,s;return this.destroyed||this.table.destroyed?this:(e instanceof HTMLElement?(o=e,s=this.elementPositionCoords(e,i),a=s.offset,n=s.x,r=s.y):typeof e=="number"?(a={top:0,left:0},n=e,r=i):(s=this.containerEventCoords(e),n=s.x,r=s.y,this.reversedX=!1),this.element.style.top=r+"px",this.element.style.left=n+"px",this.container.appendChild(this.element),typeof this.renderedCallback=="function"&&this.renderedCallback(),this._fitToScreen(n,r,o,a,i),this.visible=!0,this.subscribe("table-destroy",this.destroyBinding),this.element.addEventListener("mousedown",l=>{l.stopPropagation()}),this)}_fitToScreen(e,i,n,r,o){var a=this.container===document.body?document.documentElement.scrollTop:this.container.scrollTop;if((e+this.element.offsetWidth>=this.container.offsetWidth||this.reversedX)&&(this.element.style.left="",n?this.element.style.right=this.container.offsetWidth-r.left+"px":this.element.style.right=this.container.offsetWidth-e+"px",this.reversedX=!0),i+this.element.offsetHeight>Math.max(this.container.offsetHeight,a?this.container.scrollHeight:0))if(n)switch(o){case"bottom":this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight-n.offsetHeight-1+"px";break;default:this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+n.offsetHeight+1+"px"}else this.element.style.top=parseInt(this.element.style.top)-this.element.offsetHeight+"px"}isVisible(){return this.visible}hideOnBlur(e){return this.blurable=!0,this.visible&&(setTimeout(()=>{this.visible&&(this.table.rowManager.element.addEventListener("scroll",this.blurEvent),this.subscribe("cell-editing",this.blurEvent),document.body.addEventListener("click",this.blurEvent),document.body.addEventListener("contextmenu",this.blurEvent),document.body.addEventListener("mousedown",this.blurEvent),window.addEventListener("resize",this.blurEvent),document.body.addEventListener("keydown",this.escEvent),this.blurEventsBound=!0)},100),this.blurCallback=e),this}_escapeCheck(e){e.keyCode==27&&this.hide()}blockHide(){this.hideable=!1}restoreHide(){this.hideable=!0}hide(e=!1){return this.visible&&this.hideable&&(this.blurable&&this.blurEventsBound&&(document.body.removeEventListener("keydown",this.escEvent),document.body.removeEventListener("click",this.blurEvent),document.body.removeEventListener("contextmenu",this.blurEvent),document.body.removeEventListener("mousedown",this.blurEvent),window.removeEventListener("resize",this.blurEvent),this.table.rowManager.element.removeEventListener("scroll",this.blurEvent),this.unsubscribe("cell-editing",this.blurEvent),this.blurEventsBound=!1),this.childPopup&&this.childPopup.hide(),this.parent&&(this.parent.childPopup=null),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.visible=!1,this.blurCallback&&!e&&this.blurCallback(),this.unsubscribe("table-destroy",this.destroyBinding)),this}child(e){return this.childPopup&&this.childPopup.hide(),this.childPopup=new pve(this.table,e,this),this.childPopup}};class dn extends yl{constructor(e,i){super(e),this._handler=null}initialize(){}registerTableOption(e,i){this.table.optionsList.register(e,i)}registerColumnOption(e,i){this.table.columnManager.optionsList.register(e,i)}registerTableFunction(e,i){typeof this.table[e]>"u"?this.table[e]=(...n)=>(this.table.initGuard(e),i(...n)):console.warn("Unable to bind table function, name already in use",e)}registerComponentFunction(e,i,n){return this.table.componentFunctionBinder.bind(e,i,n)}registerDataHandler(e,i){this.table.rowManager.registerDataPipelineHandler(e,i),this._handler=e}registerDisplayHandler(e,i){this.table.rowManager.registerDisplayPipelineHandler(e,i),this._handler=e}displayRows(e){var i=this.table.rowManager.displayRows.length-1,n;if(this._handler&&(n=this.table.rowManager.displayPipeline.findIndex(r=>r.handler===this._handler),n>-1&&(i=n)),e&&(i=i+e),this._handler)return i>-1?this.table.rowManager.getDisplayRows(i):this.activeRows()}activeRows(){return this.table.rowManager.activeRows}refreshData(e,i){i||(i=this._handler),i&&this.table.rowManager.refreshActiveData(i,!1,e)}footerAppend(e){return this.table.footerManager.append(e)}footerPrepend(e){return this.table.footerManager.prepend(e)}footerRemove(e){return this.table.footerManager.remove(e)}popup(e,i){return new HVe(this.table,e,i)}alert(e,i){return this.table.alertManager.alert(e,i)}clearAlert(){return this.table.alertManager.clear()}}var GVe={};class Rw extends dn{constructor(e){super(e),this.allowedTypes=["","data","download","clipboard","print","htmlOutput"],this.registerColumnOption("accessor"),this.registerColumnOption("accessorParams"),this.registerColumnOption("accessorData"),this.registerColumnOption("accessorDataParams"),this.registerColumnOption("accessorDownload"),this.registerColumnOption("accessorDownloadParams"),this.registerColumnOption("accessorClipboard"),this.registerColumnOption("accessorClipboardParams"),this.registerColumnOption("accessorPrint"),this.registerColumnOption("accessorPrintParams"),this.registerColumnOption("accessorHtmlOutput"),this.registerColumnOption("accessorHtmlOutputParams")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-retrieve",this.transformRow.bind(this))}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var o="accessor"+(r.charAt(0).toUpperCase()+r.slice(1)),a;e.definition[o]&&(a=this.lookupAccessor(e.definition[o]),a&&(i=!0,n[o]={accessor:a,params:e.definition[o+"Params"]||{}}))}),i&&(e.modules.accessor=n)}lookupAccessor(e){var i=!1;switch(typeof e){case"string":Rw.accessors[e]?i=Rw.accessors[e]:console.warn("Accessor Error - No such accessor found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i){var n="accessor"+(i.charAt(0).toUpperCase()+i.slice(1)),r=e.getComponent(),o=Jr.deepClone(e.data||{});return this.table.columnManager.traverse(function(a){var s,l,c,u;a.modules.accessor&&(l=a.modules.accessor[n]||a.modules.accessor.accessor||!1,l&&(s=a.getFieldValue(o),s!="undefined"&&(u=a.getComponent(),c=typeof l.params=="function"?l.params(s,o,i,u,r):l.params,a.setFieldValue(o,l.accessor(s,o,i,c,u,r)))))}),o}}Rw.moduleName="accessor";Rw.accessors=GVe;var zVe={method:"GET"};function t$(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,o)=>{i=i.concat(t$(r,e?e+"["+o+"]":o))});else if(typeof t=="object")for(var n in t)i=i.concat(t$(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}function WVe(t){var e=t$(t),i=[];return e.forEach(function(n){i.push(encodeURIComponent(n.key)+"="+encodeURIComponent(n.value))}),i.join("&")}function hve(t,e,i){return t&&i&&Object.keys(i).length&&(!e.method||e.method.toLowerCase()=="get")&&(e.method="get",t+=(t.includes("?")?"&":"?")+WVe(i)),t}function qVe(t,e,i){var n;return new Promise((r,o)=>{if(t=this.urlGenerator.call(this.table,t,e,i),e.method.toUpperCase()!="GET")if(n=typeof this.table.options.ajaxContentType=="object"?this.table.options.ajaxContentType:this.contentTypeFormatters[this.table.options.ajaxContentType],n){for(var a in n.headers)e.headers||(e.headers={}),typeof e.headers[a]>"u"&&(e.headers[a]=n.headers[a]);e.body=n.body.call(this,t,e,i)}else console.warn("Ajax Error - Invalid ajaxContentType value:",this.table.options.ajaxContentType);t?(typeof e.headers>"u"&&(e.headers={}),typeof e.headers.Accept>"u"&&(e.headers.Accept="application/json"),typeof e.headers["X-Requested-With"]>"u"&&(e.headers["X-Requested-With"]="XMLHttpRequest"),typeof e.mode>"u"&&(e.mode="cors"),e.mode=="cors"?(typeof e.headers.Origin>"u"&&(e.headers.Origin=window.location.origin),typeof e.credentials>"u"&&(e.credentials="same-origin")):typeof e.credentials>"u"&&(e.credentials="include"),fetch(t,e).then(s=>{s.ok?s.json().then(l=>{r(l)}).catch(l=>{o(l),console.warn("Ajax Load Error - Invalid JSON returned",l)}):(console.error("Ajax Load Error - Connection Error: "+s.status,s.statusText),o(s))}).catch(s=>{console.error("Ajax Load Error - Connection Error: ",s),o(s)})):(console.warn("Ajax Load Error - No URL Set"),r([]))})}function i$(t,e){var i=[];if(e=e||"",Array.isArray(t))t.forEach((r,o)=>{i=i.concat(i$(r,e?e+"["+o+"]":o))});else if(typeof t=="object")for(var n in t)i=i.concat(i$(t[n],e?e+"["+n+"]":n));else i.push({key:e,value:t});return i}var YVe={json:{headers:{"Content-Type":"application/json"},body:function(t,e,i){return JSON.stringify(i)}},form:{headers:{},body:function(t,e,i){var n=i$(i),r=new FormData;return n.forEach(function(o){r.append(o.key,o.value)}),r}}};class td extends dn{constructor(e){super(e),this.config={},this.url="",this.urlGenerator=!1,this.params=!1,this.loaderPromise=!1,this.registerTableOption("ajaxURL",!1),this.registerTableOption("ajaxURLGenerator",!1),this.registerTableOption("ajaxParams",{}),this.registerTableOption("ajaxConfig","get"),this.registerTableOption("ajaxContentType","form"),this.registerTableOption("ajaxRequestFunc",!1),this.registerTableOption("ajaxRequesting",function(){}),this.registerTableOption("ajaxResponse",!1),this.contentTypeFormatters=td.contentTypeFormatters}initialize(){this.loaderPromise=this.table.options.ajaxRequestFunc||td.defaultLoaderPromise,this.urlGenerator=this.table.options.ajaxURLGenerator||td.defaultURLGenerator,this.table.options.ajaxURL&&this.setUrl(this.table.options.ajaxURL),this.setDefaultConfig(this.table.options.ajaxConfig),this.registerTableFunction("getAjaxUrl",this.getUrl.bind(this)),this.subscribe("data-loading",this.requestDataCheck.bind(this)),this.subscribe("data-params",this.requestParams.bind(this)),this.subscribe("data-load",this.requestData.bind(this))}requestParams(e,i,n,r){var o=this.table.options.ajaxParams;return o&&(typeof o=="function"&&(o=o.call(this.table)),r=Object.assign(Object.assign({},o),r)),r}requestDataCheck(e,i,n,r){return!!(!e&&this.url||typeof e=="string")}requestData(e,i,n,r,o){var a;return!o&&this.requestDataCheck(e)?(e&&this.setUrl(e),a=this.generateConfig(n),this.sendRequest(this.url,i,a)):o}setDefaultConfig(e={}){this.config=Object.assign({},td.defaultConfig),typeof e=="string"?this.config.method=e:Object.assign(this.config,e)}generateConfig(e={}){var i=Object.assign({},this.config);return typeof e=="string"?i.method=e:Object.assign(i,e),i}setUrl(e){this.url=e}getUrl(){return this.url}sendRequest(e,i,n){return this.table.options.ajaxRequesting.call(this.table,e,i)!==!1?this.loaderPromise(e,n,i).then(r=>(this.table.options.ajaxResponse&&(r=this.table.options.ajaxResponse.call(this.table,e,i,r)),r)):Promise.reject()}}td.moduleName="ajax";td.defaultConfig=zVe;td.defaultURLGenerator=hve;td.defaultLoaderPromise=qVe;td.contentTypeFormatters=YVe;var KVe={replace:function(t){return this.table.setData(t)},update:function(t){return this.table.updateOrAddData(t)},insert:function(t){return this.table.addData(t)},range:function(t){var e=[],i=this.table.modules.selectRange.activeRange,n=!1,r,o,a,s,l;return l=t.length,i&&(r=i.getBounds(),o=r.start,r.start===r.end&&(n=!0),o&&(e=this.table.rowManager.activeRows.slice(),a=e.indexOf(o.row),n?s=t.length:s=e.indexOf(r.end.row)-a+1,a>-1&&(this.table.blockRedraw(),e=e.slice(a,a+s),e.forEach((c,u)=>{c.updateData(t[u%l])}),this.table.restoreRedraw()))),e}},ZVe={table:function(t){var e=[],i=!0,n=this.table.columnManager.columns,r=[],o=[];return t=t.split(`
`),t.forEach(function(a){e.push(a.split("	"))}),e.length&&!(e.length===1&&e[0].length<2)?(e[0].forEach(function(a){var s=n.find(function(l){return a&&l.definition.title&&a.trim()&&l.definition.title.trim()===a.trim()});s?r.push(s):i=!1}),i||(i=!0,r=[],e[0].forEach(function(a){var s=n.find(function(l){return a&&l.field&&a.trim()&&l.field.trim()===a.trim()});s?r.push(s):i=!1}),i||(r=this.table.columnManager.columnsByIndex)),i&&e.shift(),e.forEach(function(a){var s={};a.forEach(function(l,c){r[c]&&(s[r[c].field]=l)}),o.push(s)}),o):!1},range:function(t){var e=[],i=[],n=this.table.modules.selectRange.activeRange,r=!1,o,a,s,l,c;return n&&(o=n.getBounds(),a=o.start,o.start===o.end&&(r=!0),a&&(t=t.split(`
`),t.forEach(function(u){e.push(u.split("	"))}),e.length&&(l=this.table.columnManager.getVisibleColumnsByIndex(),c=l.indexOf(a.column),c>-1)))?(r?s=e[0].length:s=l.indexOf(o.end.column)-c+1,l=l.slice(c,c+s),e.forEach(u=>{var d={},p=u.length;l.forEach(function(h,f){d[h.field]=u[f%p]}),i.push(d)}),i):!1}};class cy extends dn{constructor(e){super(e),this.mode=!0,this.pasteParser=function(){},this.pasteAction=function(){},this.customSelection=!1,this.rowRange=!1,this.blocked=!0,this.registerTableOption("clipboard",!1),this.registerTableOption("clipboardCopyStyled",!0),this.registerTableOption("clipboardCopyConfig",!1),this.registerTableOption("clipboardCopyFormatter",!1),this.registerTableOption("clipboardCopyRowRange","active"),this.registerTableOption("clipboardPasteParser","table"),this.registerTableOption("clipboardPasteAction","insert"),this.registerColumnOption("clipboard"),this.registerColumnOption("titleClipboard")}initialize(){this.mode=this.table.options.clipboard,this.rowRange=this.table.options.clipboardCopyRowRange,(this.mode===!0||this.mode==="copy")&&this.table.element.addEventListener("copy",e=>{var i,n,r;this.blocked||(e.preventDefault(),this.customSelection?(i=this.customSelection,this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i))):(r=this.table.modules.export.generateExportList(this.table.options.clipboardCopyConfig,this.table.options.clipboardCopyStyled,this.rowRange,"clipboard"),n=this.table.modules.export.generateHTMLTable(r),i=n?this.generatePlainContent(r):"",this.table.options.clipboardCopyFormatter&&(i=this.table.options.clipboardCopyFormatter("plain",i),n=this.table.options.clipboardCopyFormatter("html",n))),window.clipboardData&&window.clipboardData.setData?window.clipboardData.setData("Text",i):e.clipboardData&&e.clipboardData.setData?(e.clipboardData.setData("text/plain",i),n&&e.clipboardData.setData("text/html",n)):e.originalEvent&&e.originalEvent.clipboardData.setData&&(e.originalEvent.clipboardData.setData("text/plain",i),n&&e.originalEvent.clipboardData.setData("text/html",n)),this.dispatchExternal("clipboardCopied",i,n),this.reset())}),(this.mode===!0||this.mode==="paste")&&this.table.element.addEventListener("paste",e=>{this.paste(e)}),this.setPasteParser(this.table.options.clipboardPasteParser),this.setPasteAction(this.table.options.clipboardPasteAction),this.registerTableFunction("copyToClipboard",this.copy.bind(this))}reset(){this.blocked=!0,this.customSelection=!1}generatePlainContent(e){var i=[];return e.forEach(n=>{var r=[];n.columns.forEach(o=>{var a="";if(o)if(n.type==="group"&&(o.value=o.component.getKey()),o.value===null)a="";else switch(typeof o.value){case"object":a=JSON.stringify(o.value);break;case"undefined":a="";break;default:a=o.value}r.push(a)}),i.push(r.join("	"))}),i.join(`
`)}copy(e,i){var n,r;this.blocked=!1,this.customSelection=!1,(this.mode===!0||this.mode==="copy")&&(this.rowRange=e||this.table.options.clipboardCopyRowRange,typeof window.getSelection<"u"&&typeof document.createRange<"u"?(e=document.createRange(),e.selectNodeContents(this.table.element),n=window.getSelection(),n.toString()&&i&&(this.customSelection=n.toString()),n.removeAllRanges(),n.addRange(e)):typeof document.selection<"u"&&typeof document.body.createTextRange<"u"&&(r=document.body.createTextRange(),r.moveToElementText(this.table.element),r.select()),document.execCommand("copy"),n&&n.removeAllRanges())}setPasteAction(e){switch(typeof e){case"string":this.pasteAction=cy.pasteActions[e],this.pasteAction||console.warn("Clipboard Error - No such paste action found:",e);break;case"function":this.pasteAction=e;break}}setPasteParser(e){switch(typeof e){case"string":this.pasteParser=cy.pasteParsers[e],this.pasteParser||console.warn("Clipboard Error - No such paste parser found:",e);break;case"function":this.pasteParser=e;break}}paste(e){var i,n,r;this.checkPasteOrigin(e)&&(i=this.getPasteData(e),n=this.pasteParser.call(this,i),n?(e.preventDefault(),this.table.modExists("mutator")&&(n=this.mutateData(n)),r=this.pasteAction.call(this,n),this.dispatchExternal("clipboardPasted",i,n,r)):this.dispatchExternal("clipboardPasteError",i))}mutateData(e){var i=[];return Array.isArray(e)?e.forEach(n=>{i.push(this.table.modules.mutator.transformRow(n,"clipboard"))}):i=e,i}checkPasteOrigin(e){var i=!0,n=this.confirm("clipboard-paste",[e]);return(n||!["DIV","SPAN"].includes(e.target.tagName))&&(i=!1),i}getPasteData(e){var i;return window.clipboardData&&window.clipboardData.getData?i=window.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData?i=e.clipboardData.getData("text/plain"):e.originalEvent&&e.originalEvent.clipboardData.getData&&(i=e.originalEvent.clipboardData.getData("text/plain")),i}}cy.moduleName="clipboard";cy.pasteActions=KVe;cy.pasteParsers=ZVe;class XVe{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getTable(){return this._row.table}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}_getSelf(){return this._row}}class fve{constructor(e){return this._cell=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._cell.table.componentFunctionBinder.handle("cell",i._cell,n)}})}getValue(){return this._cell.getValue()}getOldValue(){return this._cell.getOldValue()}getInitialValue(){return this._cell.initialValue}getElement(){return this._cell.getElement()}getRow(){return this._cell.row.getComponent()}getData(e){return this._cell.row.getData(e)}getType(){return"cell"}getField(){return this._cell.column.getField()}getColumn(){return this._cell.column.getComponent()}setValue(e,i){typeof i>"u"&&(i=!0),this._cell.setValue(e,i)}restoreOldValue(){this._cell.setValueActual(this._cell.getOldValue())}restoreInitialValue(){this._cell.setValueActual(this._cell.initialValue)}checkHeight(){this._cell.checkHeight()}getTable(){return this._cell.table}_getSelf(){return this._cell}}class jC extends yl{constructor(e,i){super(e.table),this.table=e.table,this.column=e,this.row=i,this.element=null,this.value=null,this.initialValue,this.oldValue=null,this.modules={},this.height=null,this.width=null,this.minWidth=null,this.component=null,this.loaded=!1,this.build()}build(){this.generateElement(),this.setWidth(),this._configureCell(),this.setValueActual(this.column.getFieldValue(this.row.data)),this.initialValue=this.value}generateElement(){this.element=document.createElement("div"),this.element.className="tabulator-cell",this.element.setAttribute("role","gridcell")}_configureCell(){var e=this.element,i=this.column.getField(),n={top:"flex-start",bottom:"flex-end",middle:"center"},r={left:"flex-start",right:"flex-end",center:"center"};if(e.style.textAlign=this.column.hozAlign,this.column.vertAlign&&(e.style.display="inline-flex",e.style.alignItems=n[this.column.vertAlign]||"",this.column.hozAlign&&(e.style.justifyContent=r[this.column.hozAlign]||"")),i&&e.setAttribute("tabulator-field",i),this.column.definition.cssClass){var o=this.column.definition.cssClass.split(" ");o.forEach(a=>{e.classList.add(a)})}this.dispatch("cell-init",this),this.column.visible||this.hide()}_generateContents(){var e;switch(e=this.chain("cell-format",this,null,()=>this.element.innerHTML=this.value),typeof e){case"object":if(e instanceof Node){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.appendChild(e)}else this.element.innerHTML="",e!=null&&console.warn("Format Error - Formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",e);break;case"undefined":this.element.innerHTML="";break;default:this.element.innerHTML=e}}cellRendered(){this.dispatch("cell-rendered",this)}getElement(e){return this.loaded||(this.loaded=!0,e||this.layoutElement()),this.element}getValue(){return this.value}getOldValue(){return this.oldValue}setValue(e,i,n){var r=this.setValueProcessData(e,i,n);r&&(this.dispatch("cell-value-updated",this),this.cellRendered(),this.column.definition.cellEdited&&this.column.definition.cellEdited.call(this.table,this.getComponent()),this.dispatchExternal("cellEdited",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()))}setValueProcessData(e,i,n){var r=!1;return(this.value!==e||n)&&(r=!0,i&&(e=this.chain("cell-value-changing",[this,e],null,e))),this.setValueActual(e),r&&this.dispatch("cell-value-changed",this),r}setValueActual(e){this.oldValue=this.value,this.value=e,this.dispatch("cell-value-save-before",this),this.column.setFieldValue(this.row.data,e),this.dispatch("cell-value-save-after",this),this.loaded&&this.layoutElement()}layoutElement(){this._generateContents(),this.dispatch("cell-layout",this)}setWidth(){this.width=this.column.width,this.element.style.width=this.column.widthStyled}clearWidth(){this.width="",this.element.style.width=""}getWidth(){return this.width||this.element.offsetWidth}setMinWidth(){this.minWidth=this.column.minWidth,this.element.style.minWidth=this.column.minWidthStyled}setMaxWidth(){this.maxWidth=this.column.maxWidth,this.element.style.maxWidth=this.column.maxWidthStyled}checkHeight(){this.row.reinitializeHeight()}clearHeight(){this.element.style.height="",this.height=null,this.dispatch("cell-height",this,"")}setHeight(){this.height=this.row.height,this.element.style.height=this.row.heightStyled,this.dispatch("cell-height",this,this.row.heightStyled)}getHeight(){return this.height||this.element.offsetHeight}show(){this.element.style.display=this.column.vertAlign?"inline-flex":""}hide(){this.element.style.display="none"}delete(){this.dispatch("cell-delete",this),!this.table.rowManager.redrawBlock&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.column.deleteCell(this),this.row.deleteCell(this),this.calcs={}}getIndex(){return this.row.getCellIndex(this)}getComponent(){return this.component||(this.component=new fve(this)),this.component}}class mve{constructor(e){return this._column=e,this.type="ColumnComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._column.table.componentFunctionBinder.handle("column",i._column,n)}})}getElement(){return this._column.getElement()}getDefinition(){return this._column.getDefinition()}getField(){return this._column.getField()}getTitleDownload(){return this._column.getTitleDownload()}getCells(){var e=[];return this._column.cells.forEach(function(i){e.push(i.getComponent())}),e}isVisible(){return this._column.visible}show(){this._column.isGroup?this._column.columns.forEach(function(e){e.show()}):this._column.show()}hide(){this._column.isGroup?this._column.columns.forEach(function(e){e.hide()}):this._column.hide()}toggle(){this._column.visible?this.hide():this.show()}delete(){return this._column.delete()}getSubColumns(){var e=[];return this._column.columns.length&&this._column.columns.forEach(function(i){e.push(i.getComponent())}),e}getParentColumn(){return this._column.parent instanceof cp?this._column.parent.getComponent():!1}_getSelf(){return this._column}scrollTo(e,i){return this._column.table.columnManager.scrollToColumn(this._column,e,i)}getTable(){return this._column.table}move(e,i){var n=this._column.table.columnManager.findColumn(e);n?this._column.table.columnManager.moveColumn(this._column,n,i):console.warn("Move Error - No matching column found:",n)}getNextColumn(){var e=this._column.nextColumn();return e?e.getComponent():!1}getPrevColumn(){var e=this._column.prevColumn();return e?e.getComponent():!1}updateDefinition(e){return this._column.updateDefinition(e)}getWidth(){return this._column.getWidth()}setWidth(e){var i;return e===!0?i=this._column.reinitializeWidth(!0):i=this._column.setWidth(e),this._column.table.columnManager.rerenderColumns(!0),i}}var gve={title:void 0,field:void 0,columns:void 0,visible:void 0,hozAlign:void 0,vertAlign:void 0,width:void 0,minWidth:40,maxWidth:void 0,maxInitialWidth:void 0,cssClass:void 0,variableHeight:void 0,headerVertical:void 0,headerHozAlign:void 0,headerWordWrap:!1,editableTitle:void 0};class cp extends yl{constructor(e,i){super(i.table),this.definition=e,this.parent=i,this.type="column",this.columns=[],this.cells=[],this.element=this.createElement(),this.contentElement=!1,this.titleHolderElement=!1,this.titleElement=!1,this.groupElement=this.createGroupElement(),this.isGroup=!1,this.hozAlign="",this.vertAlign="",this.field="",this.fieldStructure="",this.getFieldValue="",this.setFieldValue="",this.titleDownload=null,this.titleFormatterRendered=!1,this.mapDefinitions(),this.setField(this.definition.field),this.modules={},this.width=null,this.widthStyled="",this.maxWidth=null,this.maxWidthStyled="",this.maxInitialWidth=null,this.minWidth=null,this.minWidthStyled="",this.widthFixed=!1,this.visible=!0,this.component=null,this.definition.columns?(this.isGroup=!0,this.definition.columns.forEach((n,r)=>{var o=new cp(n,this);this.attachColumn(o)}),this.checkColumnVisibility()):i.registerColumnField(this),this._initialize()}createElement(){var e=document.createElement("div");switch(e.classList.add("tabulator-col"),e.setAttribute("role","columnheader"),e.setAttribute("aria-sort","none"),this.table.options.columnHeaderVertAlign){case"middle":e.style.justifyContent="center";break;case"bottom":e.style.justifyContent="flex-end";break}return e}createGroupElement(){var e=document.createElement("div");return e.classList.add("tabulator-col-group-cols"),e}mapDefinitions(){var e=this.table.options.columnDefaults;if(e)for(let i in e)typeof this.definition[i]>"u"&&(this.definition[i]=e[i]);this.definition=this.table.columnManager.optionsList.generate(cp.defaultOptionList,this.definition)}checkDefinition(){Object.keys(this.definition).forEach(e=>{cp.defaultOptionList.indexOf(e)===-1&&console.warn("Invalid column definition option in '"+(this.field||this.definition.title)+"' column:",e)})}setField(e){this.field=e,this.fieldStructure=e?this.table.options.nestedFieldSeparator?e.split(this.table.options.nestedFieldSeparator):[e]:[],this.getFieldValue=this.fieldStructure.length>1?this._getNestedData:this._getFlatData,this.setFieldValue=this.fieldStructure.length>1?this._setNestedData:this._setFlatData}registerColumnPosition(e){this.parent.registerColumnPosition(e)}registerColumnField(e){this.parent.registerColumnField(e)}reRegisterPosition(){this.isGroup?this.columns.forEach(function(e){e.reRegisterPosition()}):this.registerColumnPosition(this)}_initialize(){for(var e=this.definition;this.element.firstChild;)this.element.removeChild(this.element.firstChild);e.headerVertical&&(this.element.classList.add("tabulator-col-vertical"),e.headerVertical==="flip"&&this.element.classList.add("tabulator-col-vertical-flip")),this.contentElement=this._buildColumnHeaderContent(),this.element.appendChild(this.contentElement),this.isGroup?this._buildGroupHeader():this._buildColumnHeader(),this.dispatch("column-init",this)}_buildColumnHeader(){var e=this.definition;if(this.dispatch("column-layout",this),typeof e.visible<"u"&&(e.visible?this.show(!0):this.hide(!0)),e.cssClass){var i=e.cssClass.split(" ");i.forEach(n=>{this.element.classList.add(n)})}e.field&&this.element.setAttribute("tabulator-field",e.field),this.setMinWidth(parseInt(e.minWidth)),e.maxInitialWidth&&(this.maxInitialWidth=parseInt(e.maxInitialWidth)),e.maxWidth&&this.setMaxWidth(parseInt(e.maxWidth)),this.reinitializeWidth(),this.hozAlign=this.definition.hozAlign,this.vertAlign=this.definition.vertAlign,this.titleElement.style.textAlign=this.definition.headerHozAlign}_buildColumnHeaderContent(){var e=document.createElement("div");return e.classList.add("tabulator-col-content"),this.titleHolderElement=document.createElement("div"),this.titleHolderElement.classList.add("tabulator-col-title-holder"),e.appendChild(this.titleHolderElement),this.titleElement=this._buildColumnHeaderTitle(),this.titleHolderElement.appendChild(this.titleElement),e}_buildColumnHeaderTitle(){var e=this.definition,i=document.createElement("div");if(i.classList.add("tabulator-col-title"),e.headerWordWrap&&i.classList.add("tabulator-col-title-wrap"),e.editableTitle){var n=document.createElement("input");n.classList.add("tabulator-title-editor"),n.addEventListener("click",r=>{r.stopPropagation(),n.focus()}),n.addEventListener("mousedown",r=>{r.stopPropagation()}),n.addEventListener("change",()=>{e.title=n.value,this.dispatchExternal("columnTitleChanged",this.getComponent())}),i.appendChild(n),e.field?this.langBind("columns|"+e.field,r=>{n.value=r||e.title||"&nbsp;"}):n.value=e.title||"&nbsp;"}else e.field?this.langBind("columns|"+e.field,r=>{this._formatColumnHeaderTitle(i,r||e.title||"&nbsp;")}):this._formatColumnHeaderTitle(i,e.title||"&nbsp;");return i}_formatColumnHeaderTitle(e,i){var n=this.chain("column-format",[this,i,e],null,()=>i);switch(typeof n){case"object":n instanceof Node?e.appendChild(n):(e.innerHTML="",console.warn("Format Error - Title formatter has returned a type of object, the only valid formatter object return is an instance of Node, the formatter returned:",n));break;case"undefined":e.innerHTML="";break;default:e.innerHTML=n}}_buildGroupHeader(){if(this.element.classList.add("tabulator-col-group"),this.element.setAttribute("role","columngroup"),this.element.setAttribute("aria-title",this.definition.title),this.definition.cssClass){var e=this.definition.cssClass.split(" ");e.forEach(i=>{this.element.classList.add(i)})}this.titleElement.style.textAlign=this.definition.headerHozAlign,this.element.appendChild(this.groupElement)}_getFlatData(e){return e[this.field]}_getNestedData(e){var i=e,n=this.fieldStructure,r=n.length,o;for(let a=0;a<r&&(i=i[n[a]],o=i,!!i);a++);return o}_setFlatData(e,i){this.field&&(e[this.field]=i)}_setNestedData(e,i){var n=e,r=this.fieldStructure,o=r.length;for(let a=0;a<o;a++)if(a==o-1)n[r[a]]=i;else{if(!n[r[a]])if(typeof i<"u")n[r[a]]={};else break;n=n[r[a]]}}attachColumn(e){this.groupElement?(this.columns.push(e),this.groupElement.appendChild(e.getElement()),e.columnRendered()):console.warn("Column Warning - Column being attached to another column instead of column group")}verticalAlign(e,i){var n=this.parent.isGroup?this.parent.getGroupElement().clientHeight:i||this.parent.getHeadersElement().clientHeight;this.element.style.height=n+"px",this.dispatch("column-height",this,this.element.style.height),this.isGroup&&(this.groupElement.style.minHeight=n-this.contentElement.offsetHeight+"px"),this.columns.forEach(function(r){r.verticalAlign(e)})}clearVerticalAlign(){this.element.style.paddingTop="",this.element.style.height="",this.element.style.minHeight="",this.groupElement.style.minHeight="",this.columns.forEach(function(e){e.clearVerticalAlign()}),this.dispatch("column-height",this,"")}getElement(){return this.element}getGroupElement(){return this.groupElement}getField(){return this.field}getTitleDownload(){return this.titleDownload}getFirstColumn(){return this.isGroup?this.columns.length?this.columns[0].getFirstColumn():!1:this}getLastColumn(){return this.isGroup?this.columns.length?this.columns[this.columns.length-1].getLastColumn():!1:this}getColumns(e){var i=[];return e?this.columns.forEach(n=>{i.push(n),i=i.concat(n.getColumns(!0))}):i=this.columns,i}getCells(){return this.cells}getTopColumn(){return this.parent.isGroup?this.parent.getTopColumn():this}getDefinition(e){var i=[];return this.isGroup&&e&&(this.columns.forEach(function(n){i.push(n.getDefinition(!0))}),this.definition.columns=i),this.definition}checkColumnVisibility(){var e=!1;this.columns.forEach(function(i){i.visible&&(e=!0)}),e?(this.show(),this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1)):this.hide()}show(e,i){this.visible||(this.visible=!0,this.element.style.display="",this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.show()}),!this.isGroup&&this.width===null&&this.reinitializeWidth(),this.table.columnManager.verticalAlignHeaders(),this.dispatch("column-show",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!0),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}hide(e,i){this.visible&&(this.visible=!1,this.element.style.display="none",this.table.columnManager.verticalAlignHeaders(),this.parent.isGroup&&this.parent.checkColumnVisibility(),this.cells.forEach(function(n){n.hide()}),this.dispatch("column-hide",this,i),e||this.dispatchExternal("columnVisibilityChanged",this.getComponent(),!1),this.parent.isGroup&&this.parent.matchChildWidths(),this.silent||this.table.columnManager.rerenderColumns())}matchChildWidths(){var e=0;this.contentElement&&this.columns.length&&(this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}),this.contentElement.style.maxWidth=e-1+"px",this.parent.isGroup&&this.parent.matchChildWidths())}removeChild(e){var i=this.columns.indexOf(e);i>-1&&this.columns.splice(i,1),this.columns.length||this.delete()}setWidth(e){this.widthFixed=!0,this.setWidthActual(e)}setWidthActual(e){isNaN(e)&&(e=Math.floor(this.table.element.clientWidth/100*parseInt(e))),e=Math.max(this.minWidth,e),this.maxWidth&&(e=Math.min(this.maxWidth,e)),this.width=e,this.widthStyled=e?e+"px":"",this.element.style.width=this.widthStyled,this.isGroup||this.cells.forEach(function(i){i.setWidth()}),this.parent.isGroup&&this.parent.matchChildWidths(),this.dispatch("column-width",this)}checkCellHeights(){var e=[];this.cells.forEach(function(i){i.row.heightInitialized&&(i.row.getElement().offsetParent!==null?(e.push(i.row),i.row.clearCellHeight()):i.row.heightInitialized=!1)}),e.forEach(function(i){i.calcHeight()}),e.forEach(function(i){i.setCellHeight()})}getWidth(){var e=0;return this.isGroup?this.columns.forEach(function(i){i.visible&&(e+=i.getWidth())}):e=this.width,e}getLeftOffset(){var e=this.element.offsetLeft;return this.parent.isGroup&&(e+=this.parent.getLeftOffset()),e}getHeight(){return Math.ceil(this.element.getBoundingClientRect().height)}setMinWidth(e){this.maxWidth&&e>this.maxWidth&&(e=this.maxWidth,console.warn("the minWidth ("+e+"px) for column '"+this.field+"' cannot be bigger that its maxWidth ("+this.maxWidthStyled+")")),this.minWidth=e,this.minWidthStyled=e?e+"px":"",this.element.style.minWidth=this.minWidthStyled,this.cells.forEach(function(i){i.setMinWidth()})}setMaxWidth(e){this.minWidth&&e<this.minWidth&&(e=this.minWidth,console.warn("the maxWidth ("+e+"px) for column '"+this.field+"' cannot be smaller that its minWidth ("+this.minWidthStyled+")")),this.maxWidth=e,this.maxWidthStyled=e?e+"px":"",this.element.style.maxWidth=this.maxWidthStyled,this.cells.forEach(function(i){i.setMaxWidth()})}delete(){return new Promise((e,i)=>{this.isGroup&&this.columns.forEach(function(r){r.delete()}),this.dispatch("column-delete",this);var n=this.cells.length;for(let r=0;r<n;r++)this.cells[0].delete();this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=!1,this.contentElement=!1,this.titleElement=!1,this.groupElement=!1,this.parent.isGroup&&this.parent.removeChild(this),this.table.columnManager.deregisterColumn(this),this.table.columnManager.rerenderColumns(!0),this.dispatch("column-deleted",this),e()})}columnRendered(){this.titleFormatterRendered&&this.titleFormatterRendered(),this.dispatch("column-rendered",this)}generateCell(e){var i=new jC(this,e);return this.cells.push(i),i}nextColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._nextVisibleColumn(e+1):!1}_nextVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._nextVisibleColumn(e+1)}prevColumn(){var e=this.table.columnManager.findColumnIndex(this);return e>-1?this._prevVisibleColumn(e-1):!1}_prevVisibleColumn(e){var i=this.table.columnManager.getColumnByIndex(e);return!i||i.visible?i:this._prevVisibleColumn(e-1)}reinitializeWidth(e){this.widthFixed=!1,typeof this.definition.width<"u"&&!e&&this.setWidth(this.definition.width),this.dispatch("column-width-fit-before",this),this.fitToData(e),this.dispatch("column-width-fit-after",this)}fitToData(e){if(!this.isGroup){this.widthFixed||(this.element.style.width="",this.cells.forEach(r=>{r.clearWidth()}));var i=this.element.offsetWidth;if((!this.width||!this.widthFixed)&&(this.cells.forEach(r=>{var o=r.getWidth();o>i&&(i=o)}),i)){var n=i+1;this.maxInitialWidth&&!e&&(n=Math.min(n,this.maxInitialWidth)),this.setWidthActual(n)}}}updateDefinition(e){var i;return this.isGroup||this.parent.isGroup?(console.error("Column Update Error - The updateDefinition function is only available on ungrouped columns"),Promise.reject("Column Update Error - The updateDefinition function is only available on columns, not column groups")):(i=Object.assign({},this.getDefinition()),i=Object.assign(i,e),this.table.columnManager.addColumn(i,!1,this).then(n=>(i.field==this.field&&(this.field=!1),this.delete().then(()=>n.getComponent()))))}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}getComponent(){return this.component||(this.component=new mve(this)),this.component}getPosition(){return this.table.columnManager.getVisibleColumnsByIndex().indexOf(this)+1}}cp.defaultOptionList=gve;class Lx{constructor(e){return this._row=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._row.table.componentFunctionBinder.handle("row",i._row,n)}})}getData(e){return this._row.getData(e)}getElement(){return this._row.getElement()}getCells(){var e=[];return this._row.getCells().forEach(function(i){e.push(i.getComponent())}),e}getCell(e){var i=this._row.getCell(e);return i?i.getComponent():!1}getIndex(){return this._row.getData("data")[this._row.table.options.index]}getPosition(){return this._row.getPosition()}watchPosition(e){return this._row.watchPosition(e)}delete(){return this._row.delete()}scrollTo(e,i){return this._row.table.rowManager.scrollToRow(this._row,e,i)}move(e,i){this._row.moveToRow(e,i)}update(e){return this._row.updateData(e)}normalizeHeight(){this._row.normalizeHeight(!0)}_getSelf(){return this._row}reformat(){return this._row.reinitialize()}getTable(){return this._row.table}getNextRow(){var e=this._row.nextRow();return e&&e.getComponent()}getPrevRow(){var e=this._row.prevRow();return e&&e.getComponent()}}class Hs extends yl{constructor(e,i,n="row"){super(i.table),this.parent=i,this.data={},this.type=n,this.element=!1,this.modules={},this.cells=[],this.height=0,this.heightStyled="",this.manualHeight=!1,this.outerHeight=0,this.initialized=!1,this.heightInitialized=!1,this.position=0,this.positionWatchers=[],this.component=null,this.created=!1,this.setData(e)}create(){this.created||(this.created=!0,this.generateElement())}createElement(){var e=document.createElement("div");e.classList.add("tabulator-row"),e.setAttribute("role","row"),this.element=e}getElement(){return this.create(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}generateElement(){this.createElement(),this.dispatch("row-init",this)}generateCells(){this.cells=this.table.columnManager.generateCells(this)}initialize(e,i){if(this.create(),!this.initialized||e){for(this.deleteCells();this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.dispatch("row-layout-before",this),this.generateCells(),this.initialized=!0,this.table.columnManager.renderer.renderRowCells(this,i),e&&this.normalizeHeight(),this.dispatch("row-layout",this),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent()),this.dispatch("row-layout-after",this)}else this.table.columnManager.renderer.rerenderRowCells(this,i)}rendered(){this.cells.forEach(e=>{e.cellRendered()})}reinitializeHeight(){this.heightInitialized=!1,this.element&&this.element.offsetParent!==null&&this.normalizeHeight(!0)}deinitialize(){this.initialized=!1}deinitializeHeight(){this.heightInitialized=!1}reinitialize(e){this.initialized=!1,this.heightInitialized=!1,this.manualHeight||(this.height=0,this.heightStyled=""),this.element&&this.element.offsetParent!==null&&this.initialize(!0),this.dispatch("row-relayout",this)}calcHeight(e){var i=0,n;this.table.options.rowHeight?this.height=this.table.options.rowHeight:(n=this.table.options.resizableRows?this.element.clientHeight:0,this.cells.forEach(function(r){var o=r.getHeight();o>i&&(i=o)}),e?this.height=Math.max(i,n):this.height=this.manualHeight?this.height:Math.max(i,n)),this.heightStyled=this.height?this.height+"px":"",this.outerHeight=this.element.offsetHeight}setCellHeight(){this.cells.forEach(function(e){e.setHeight()}),this.heightInitialized=!0}clearCellHeight(){this.cells.forEach(function(e){e.clearHeight()})}normalizeHeight(e){e&&!this.table.options.rowHeight&&this.clearCellHeight(),this.calcHeight(e),this.setCellHeight()}setHeight(e,i){(this.height!=e||i)&&(this.manualHeight=!0,this.height=e,this.heightStyled=e?e+"px":"",this.setCellHeight(),this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getWidth(){return this.element.offsetWidth}deleteCell(e){var i=this.cells.indexOf(e);i>-1&&this.cells.splice(i,1)}setData(e){this.data=this.chain("row-data-init-before",[this,e],void 0,e),this.dispatch("row-data-init-after",this)}updateData(e){var i=this.element&&Jr.elVisible(this.element),n={},r;return new Promise((o,a)=>{typeof e=="string"&&(e=JSON.parse(e)),this.dispatch("row-data-save-before",this),this.subscribed("row-data-changing")&&(n=Object.assign(n,this.data),n=Object.assign(n,e)),r=this.chain("row-data-changing",[this,n,e],null,e);for(let s in r)this.data[s]=r[s];this.dispatch("row-data-save-after",this);for(let s in e)this.table.columnManager.getColumnsByFieldRoot(s).forEach(c=>{let u=this.getCell(c.getField());if(u){let d=c.getFieldValue(r);u.getValue()!==d&&(u.setValueProcessData(d),i&&u.cellRendered())}});i?(this.normalizeHeight(!0),this.table.options.rowFormatter&&this.table.options.rowFormatter(this.getComponent())):(this.initialized=!1,this.height=0,this.heightStyled=""),this.dispatch("row-data-changed",this,i,e),this.dispatchExternal("rowUpdated",this.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),o()})}getData(e){return e?this.chain("row-data-retrieve",[this,e],null,this.data):this.data}getCell(e){var i=!1;return e=this.table.columnManager.findColumn(e),!this.initialized&&this.cells.length===0&&this.generateCells(),i=this.cells.find(function(n){return n.column===e}),i}getCellIndex(e){return this.cells.findIndex(function(i){return i===e})}findCell(e){return this.cells.find(i=>i.element===e)}getCells(){return!this.initialized&&this.cells.length===0&&this.generateCells(),this.cells}nextRow(){var e=this.table.rowManager.nextDisplayRow(this,!0);return e||!1}prevRow(){var e=this.table.rowManager.prevDisplayRow(this,!0);return e||!1}moveToRow(e,i){var n=this.table.rowManager.findRow(e);n?(this.table.rowManager.moveRowActual(this,n,!i),this.table.rowManager.refreshActiveData("display",!1,!0)):console.warn("Move Error - No matching row found:",e)}delete(){return this.dispatch("row-delete",this),this.deleteActual(),Promise.resolve()}deleteActual(e){this.detachModules(),this.table.rowManager.deleteRow(this,e),this.deleteCells(),this.initialized=!1,this.heightInitialized=!1,this.element=!1,this.dispatch("row-deleted",this)}detachModules(){this.dispatch("row-deleting",this)}deleteCells(){var e=this.cells.length;for(let i=0;i<e;i++)this.cells[0].delete()}wipe(){if(this.detachModules(),this.deleteCells(),this.element){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.element.parentNode&&this.element.parentNode.removeChild(this.element)}this.element=!1,this.modules={}}isDisplayed(){return this.table.rowManager.getDisplayRows().includes(this)}getPosition(){return this.isDisplayed()?this.position:!1}setPosition(e){e!=this.position&&(this.position=e,this.positionWatchers.forEach(i=>{i(this.position)}))}watchPosition(e){this.positionWatchers.push(e),e(this.position)}getGroup(){return this.modules.group||!1}getComponent(){return this.component||(this.component=new Lx(this)),this.component}}var JVe={avg:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:2;return t.length&&(n=t.reduce(function(o,a){return Number(o)+Number(a)}),n=n/t.length,n=r!==!1?n.toFixed(r):n),parseFloat(n).toString()},max:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(o){o=Number(o),(o>n||n===null)&&(n=o)}),n!==null?r!==!1?n.toFixed(r):n:""},min:function(t,e,i){var n=null,r=typeof i.precision<"u"?i.precision:!1;return t.forEach(function(o){o=Number(o),(o<n||n===null)&&(n=o)}),n!==null?r!==!1?n.toFixed(r):n:""},sum:function(t,e,i){var n=0,r=typeof i.precision<"u"?i.precision:!1;return t.length&&t.forEach(function(o){o=Number(o),n+=isNaN(o)?0:Number(o)}),r!==!1?n.toFixed(r):n},concat:function(t,e,i){var n=0;return t.length&&(n=t.reduce(function(r,o){return String(r)+String(o)})),n},count:function(t,e,i){var n=0;return t.length&&t.forEach(function(r){r&&n++}),n},unique:function(t,e,i){var n=t.filter((r,o)=>(t||r===0)&&t.indexOf(r)===o);return n.length}};class pm extends dn{constructor(e){super(e),this.topCalcs=[],this.botCalcs=[],this.genColumn=!1,this.topElement=this.createElement(),this.botElement=this.createElement(),this.topRow=!1,this.botRow=!1,this.topInitialized=!1,this.botInitialized=!1,this.blocked=!1,this.recalcAfterBlock=!1,this.registerTableOption("columnCalcs",!0),this.registerColumnOption("topCalc"),this.registerColumnOption("topCalcParams"),this.registerColumnOption("topCalcFormatter"),this.registerColumnOption("topCalcFormatterParams"),this.registerColumnOption("bottomCalc"),this.registerColumnOption("bottomCalcParams"),this.registerColumnOption("bottomCalcFormatter"),this.registerColumnOption("bottomCalcFormatterParams")}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-calcs-holder"),e}initialize(){this.genColumn=new cp({field:"value"},this),this.subscribe("cell-value-changed",this.cellValueChanged.bind(this)),this.subscribe("column-init",this.initializeColumnCheck.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("column-moved",this.recalcActiveRows.bind(this)),this.subscribe("column-add",this.recalcActiveRows.bind(this)),this.subscribe("data-refreshed",this.recalcActiveRowsRefresh.bind(this)),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this)),this.subscribe("redraw-blocked",this.blockRedraw.bind(this)),this.subscribe("redraw-restored",this.restoreRedraw.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this)),this.registerTableFunction("getCalcResults",this.getResults.bind(this)),this.registerTableFunction("recalc",this.userRecalc.bind(this)),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}tableRedraw(e){this.recalc(this.table.rowManager.activeRows),e&&this.redraw()}blockRedraw(){this.blocked=!0,this.recalcAfterBlock=!1}restoreRedraw(){this.blocked=!1,this.recalcAfterBlock&&(this.recalcAfterBlock=!1,this.recalcActiveRowsRefresh())}userRecalc(){this.recalc(this.table.rowManager.activeRows)}blockCheck(){return this.blocked&&(this.recalcAfterBlock=!0),this.blocked}visibleRows(e,i){return this.topRow&&i.unshift(this.topRow),this.botRow&&i.push(this.botRow),i}rowsUpdated(e){this.table.options.groupBy?this.recalcRowGroup(e):this.recalcActiveRows()}recalcActiveRowsRefresh(){this.table.options.groupBy&&this.table.options.dataTreeStartExpanded&&this.table.options.dataTree?this.recalcAll():this.recalcActiveRows()}recalcActiveRows(){this.recalc(this.table.rowManager.activeRows)}cellValueChanged(e){(e.column.definition.topCalc||e.column.definition.bottomCalc)&&(this.table.options.groupBy?((this.table.options.columnCalcs=="table"||this.table.options.columnCalcs=="both")&&this.recalcActiveRows(),this.table.options.columnCalcs!="table"&&this.recalcRowGroup(e.row)):this.recalcActiveRows())}initializeColumnCheck(e){(e.definition.topCalc||e.definition.bottomCalc)&&this.initializeColumn(e)}initializeColumn(e){var i=e.definition,n={topCalcParams:i.topCalcParams||{},botCalcParams:i.bottomCalcParams||{}};if(i.topCalc){switch(typeof i.topCalc){case"string":pm.calculations[i.topCalc]?n.topCalc=pm.calculations[i.topCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.topCalc);break;case"function":n.topCalc=i.topCalc;break}n.topCalc&&(e.modules.columnCalcs=n,this.topCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeTopRow())}if(i.bottomCalc){switch(typeof i.bottomCalc){case"string":pm.calculations[i.bottomCalc]?n.botCalc=pm.calculations[i.bottomCalc]:console.warn("Column Calc Error - No such calculation found, ignoring: ",i.bottomCalc);break;case"function":n.botCalc=i.bottomCalc;break}n.botCalc&&(e.modules.columnCalcs=n,this.botCalcs.push(e),this.table.options.columnCalcs!="group"&&this.initializeBottomRow())}}registerColumnField(){}removeCalcs(){var e=!1;this.topInitialized&&(this.topInitialized=!1,this.topElement.parentNode.removeChild(this.topElement),e=!0),this.botInitialized&&(this.botInitialized=!1,this.footerRemove(this.botElement),e=!0),e&&this.table.rowManager.adjustTableSize()}reinitializeCalcs(){this.topCalcs.length&&this.initializeTopRow(),this.botCalcs.length&&this.initializeBottomRow()}initializeTopRow(){var e=document.createDocumentFragment();this.topInitialized||(e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.topInitialized=!0)}initializeBottomRow(){this.botInitialized||(this.footerPrepend(this.botElement),this.botInitialized=!0)}scrollHorizontal(e){this.botInitialized&&this.botRow&&(this.botElement.scrollLeft=e)}recalc(e){var i,n;if(!this.blockCheck()&&(this.topInitialized||this.botInitialized)){if(i=this.rowsToData(e),this.topInitialized){for(this.topRow&&this.topRow.deleteCells(),n=this.generateRow("top",i),this.topRow=n;this.topElement.firstChild;)this.topElement.removeChild(this.topElement.firstChild);this.topElement.appendChild(n.getElement()),n.initialize(!0)}if(this.botInitialized){for(this.botRow&&this.botRow.deleteCells(),n=this.generateRow("bottom",i),this.botRow=n;this.botElement.firstChild;)this.botElement.removeChild(this.botElement.firstChild);this.botElement.appendChild(n.getElement()),n.initialize(!0)}this.table.rowManager.adjustTableSize(),this.table.modExists("frozenColumns")&&this.table.modules.frozenColumns.layout()}}recalcRowGroup(e){this.recalcGroup(this.table.modules.groupRows.getRowGroup(e))}recalcAll(){if((this.topCalcs.length||this.botCalcs.length)&&(this.table.options.columnCalcs!=="group"&&this.recalcActiveRows(),this.table.options.groupBy&&this.table.options.columnCalcs!=="table")){var e=this.table.modules.groupRows.getChildGroups();e.forEach(i=>{this.recalcGroup(i)})}}recalcGroup(e){var i,n;this.blockCheck()||e&&e.calcs&&(e.calcs.bottom&&(i=this.rowsToData(e.rows),n=this.generateRowData("bottom",i),e.calcs.bottom.updateData(n),e.calcs.bottom.reinitialize()),e.calcs.top&&(i=this.rowsToData(e.rows),n=this.generateRowData("top",i),e.calcs.top.updateData(n),e.calcs.top.reinitialize()))}generateTopRow(e){return this.generateRow("top",this.rowsToData(e))}generateBottomRow(e){return this.generateRow("bottom",this.rowsToData(e))}rowsToData(e){var i=[];return e.forEach(n=>{if(i.push(n.getData()),this.table.options.dataTree&&this.table.options.dataTreeChildColumnCalcs&&n.modules.dataTree&&n.modules.dataTree.open){var r=this.rowsToData(this.table.modules.dataTree.getFilteredTreeChildren(n));i=i.concat(r)}}),i}generateRow(e,i){var n=this.generateRowData(e,i),r;return this.table.modExists("mutator")&&this.table.modules.mutator.disable(),r=new Hs(n,this,"calc"),this.table.modExists("mutator")&&this.table.modules.mutator.enable(),r.getElement().classList.add("tabulator-calcs","tabulator-calcs-"+e),r.component=!1,r.getComponent=()=>(r.component||(r.component=new XVe(r)),r.component),r.generateCells=()=>{var o=[];this.table.columnManager.columnsByIndex.forEach(a=>{this.genColumn.setField(a.getField()),this.genColumn.hozAlign=a.hozAlign,a.definition[e+"CalcFormatter"]&&this.table.modExists("format")?this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter(a.definition[e+"CalcFormatter"]),params:a.definition[e+"CalcFormatterParams"]||{}}:this.genColumn.modules.format={formatter:this.table.modules.format.getFormatter("plaintext"),params:{}},this.genColumn.definition.cssClass=a.definition.cssClass;var s=new jC(this.genColumn,r);s.getElement(),s.column=a,s.setWidth(),a.cells.push(s),o.push(s),a.visible||s.hide()}),r.cells=o},r}generateRowData(e,i){var n={},r=e=="top"?this.topCalcs:this.botCalcs,o=e=="top"?"topCalc":"botCalc",a,s;return r.forEach(function(l){var c=[];l.modules.columnCalcs&&l.modules.columnCalcs[o]&&(i.forEach(function(u){c.push(l.getFieldValue(u))}),s=o+"Params",a=typeof l.modules.columnCalcs[s]=="function"?l.modules.columnCalcs[s](c,i):l.modules.columnCalcs[s],l.setFieldValue(n,l.modules.columnCalcs[o](c,i,a)))}),n}hasTopCalcs(){return!!this.topCalcs.length}hasBottomCalcs(){return!!this.botCalcs.length}redraw(){this.topRow&&this.topRow.normalizeHeight(!0),this.botRow&&this.botRow.normalizeHeight(!0)}getResults(){var e={},i;return this.table.options.groupBy&&this.table.modExists("groupRows")?(i=this.table.modules.groupRows.getGroups(!0),i.forEach(n=>{e[n.getKey()]=this.getGroupResults(n)})):e={top:this.topRow?this.topRow.getData():{},bottom:this.botRow?this.botRow.getData():{}},e}getGroupResults(e){var i=e._getSelf(),n=e.getSubGroups(),r={},o={};return n.forEach(a=>{r[a.getKey()]=this.getGroupResults(a)}),o={top:i.calcs.top?i.calcs.top.getData():{},bottom:i.calcs.bottom?i.calcs.bottom.getData():{},groups:r},o}adjustForScrollbar(e){this.botRow&&(this.table.rtl?this.botElement.style.paddingLeft=e+"px":this.botElement.style.paddingRight=e+"px")}}pm.moduleName="columnCalcs";pm.calculations=JVe;class vve extends dn{constructor(e){super(e),this.indent=10,this.field="",this.collapseEl=null,this.expandEl=null,this.branchEl=null,this.elementField=!1,this.startOpen=function(){},this.registerTableOption("dataTree",!1),this.registerTableOption("dataTreeFilter",!0),this.registerTableOption("dataTreeSort",!0),this.registerTableOption("dataTreeElementColumn",!1),this.registerTableOption("dataTreeBranchElement",!0),this.registerTableOption("dataTreeChildIndent",9),this.registerTableOption("dataTreeChildField","_children"),this.registerTableOption("dataTreeCollapseElement",!1),this.registerTableOption("dataTreeExpandElement",!1),this.registerTableOption("dataTreeStartExpanded",!1),this.registerTableOption("dataTreeChildColumnCalcs",!1),this.registerTableOption("dataTreeSelectPropagate",!1),this.registerComponentFunction("row","treeCollapse",this.collapseRow.bind(this)),this.registerComponentFunction("row","treeExpand",this.expandRow.bind(this)),this.registerComponentFunction("row","treeToggle",this.toggleRow.bind(this)),this.registerComponentFunction("row","getTreeParent",this.getTreeParent.bind(this)),this.registerComponentFunction("row","getTreeChildren",this.getRowChildren.bind(this)),this.registerComponentFunction("row","addTreeChild",this.addTreeChildRow.bind(this)),this.registerComponentFunction("row","isTreeExpanded",this.isRowExpanded.bind(this))}initialize(){if(this.table.options.dataTree){var e=null,i=this.table.options;switch(this.field=i.dataTreeChildField,this.indent=i.dataTreeChildIndent,this.options("movableRows")&&console.warn("The movableRows option is not available with dataTree enabled, moving of child rows could result in unpredictable behavior"),i.dataTreeBranchElement?i.dataTreeBranchElement===!0?(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch")):typeof i.dataTreeBranchElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeBranchElement,this.branchEl=e.firstChild):this.branchEl=i.dataTreeBranchElement:(this.branchEl=document.createElement("div"),this.branchEl.classList.add("tabulator-data-tree-branch-empty")),i.dataTreeCollapseElement?typeof i.dataTreeCollapseElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeCollapseElement,this.collapseEl=e.firstChild):this.collapseEl=i.dataTreeCollapseElement:(this.collapseEl=document.createElement("div"),this.collapseEl.classList.add("tabulator-data-tree-control"),this.collapseEl.tabIndex=0,this.collapseEl.innerHTML="<div class='tabulator-data-tree-control-collapse'></div>"),i.dataTreeExpandElement?typeof i.dataTreeExpandElement=="string"?(e=document.createElement("div"),e.innerHTML=i.dataTreeExpandElement,this.expandEl=e.firstChild):this.expandEl=i.dataTreeExpandElement:(this.expandEl=document.createElement("div"),this.expandEl.classList.add("tabulator-data-tree-control"),this.expandEl.tabIndex=0,this.expandEl.innerHTML="<div class='tabulator-data-tree-control-expand'></div>"),typeof i.dataTreeStartExpanded){case"boolean":this.startOpen=function(n,r){return i.dataTreeStartExpanded};break;case"function":this.startOpen=i.dataTreeStartExpanded;break;default:this.startOpen=function(n,r){return i.dataTreeStartExpanded[r]};break}this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("row-deleted",this.rowDelete.bind(this),0),this.subscribe("row-data-changed",this.rowDataChanged.bind(this),10),this.subscribe("cell-value-updated",this.cellValueChanged.bind(this)),this.subscribe("edit-cancelled",this.cellValueChanged.bind(this)),this.subscribe("column-moving-rows",this.columnMoving.bind(this)),this.subscribe("table-built",this.initializeElementField.bind(this)),this.subscribe("table-redrawing",this.tableRedrawing.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),30)}}tableRedrawing(e){var i;e&&(i=this.table.rowManager.getRows(),i.forEach(n=>{this.reinitializeRowChildren(n)}))}initializeElementField(){var e=this.table.columnManager.getFirstVisibleColumn();this.elementField=this.table.options.dataTreeElementColumn||(e?e.field:!1)}getRowChildren(e){return this.getTreeChildren(e,!0)}columnMoving(){var e=[];return this.table.rowManager.rows.forEach(i=>{e=e.concat(this.getTreeChildren(i,!1,!0))}),e}rowDataChanged(e,i,n){this.redrawNeeded(n)&&(this.initializeRow(e),i&&(this.layoutRow(e),this.refreshData(!0)))}cellValueChanged(e){var i=e.column.getField();i===this.elementField&&this.layoutRow(e.row)}initializeRow(e){var i=e.getData()[this.field],n=Array.isArray(i),r=n||!n&&typeof i=="object"&&i!==null;!r&&e.modules.dataTree&&e.modules.dataTree.branchEl&&e.modules.dataTree.branchEl.parentNode.removeChild(e.modules.dataTree.branchEl),!r&&e.modules.dataTree&&e.modules.dataTree.controlEl&&e.modules.dataTree.controlEl.parentNode.removeChild(e.modules.dataTree.controlEl),e.modules.dataTree={index:e.modules.dataTree?e.modules.dataTree.index:0,open:r?e.modules.dataTree?e.modules.dataTree.open:this.startOpen(e.getComponent(),0):!1,controlEl:e.modules.dataTree&&r?e.modules.dataTree.controlEl:!1,branchEl:e.modules.dataTree&&r?e.modules.dataTree.branchEl:!1,parent:e.modules.dataTree?e.modules.dataTree.parent:!1,children:r}}reinitializeRowChildren(e){var i=this.getTreeChildren(e,!1,!0);i.forEach(function(n){n.reinitialize(!0)})}layoutRow(e){var i=this.elementField?e.getCell(this.elementField):e.getCells()[0],n=i.getElement(),r=e.modules.dataTree;r.branchEl&&(r.branchEl.parentNode&&r.branchEl.parentNode.removeChild(r.branchEl),r.branchEl=!1),r.controlEl&&(r.controlEl.parentNode&&r.controlEl.parentNode.removeChild(r.controlEl),r.controlEl=!1),this.generateControlElement(e,n),e.getElement().classList.add("tabulator-tree-level-"+r.index),r.index&&(this.branchEl?(r.branchEl=this.branchEl.cloneNode(!0),n.insertBefore(r.branchEl,n.firstChild),this.table.rtl?r.branchEl.style.marginRight=(r.branchEl.offsetWidth+r.branchEl.style.marginLeft)*(r.index-1)+r.index*this.indent+"px":r.branchEl.style.marginLeft=(r.branchEl.offsetWidth+r.branchEl.style.marginRight)*(r.index-1)+r.index*this.indent+"px"):this.table.rtl?n.style.paddingRight=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-right"))+r.index*this.indent+"px":n.style.paddingLeft=parseInt(window.getComputedStyle(n,null).getPropertyValue("padding-left"))+r.index*this.indent+"px")}generateControlElement(e,i){var n=e.modules.dataTree,r=n.controlEl;i=i||e.getCells()[0].getElement(),n.children!==!1&&(n.open?(n.controlEl=this.collapseEl.cloneNode(!0),n.controlEl.addEventListener("click",o=>{o.stopPropagation(),this.collapseRow(e)})):(n.controlEl=this.expandEl.cloneNode(!0),n.controlEl.addEventListener("click",o=>{o.stopPropagation(),this.expandRow(e)})),n.controlEl.addEventListener("mousedown",o=>{o.stopPropagation()}),r&&r.parentNode===i?r.parentNode.replaceChild(n.controlEl,r):i.insertBefore(n.controlEl,i.firstChild))}getRows(e){var i=[];return e.forEach((n,r)=>{var o,a;i.push(n),n instanceof Hs&&(n.create(),o=n.modules.dataTree,!o.index&&o.children!==!1&&(a=this.getChildren(n),a.forEach(s=>{s.create(),i.push(s)})))}),i}getChildren(e,i){var n=e.modules.dataTree,r=[],o=[];return n.children!==!1&&(n.open||i)&&(Array.isArray(n.children)||(n.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(n.children):r=n.children,this.table.modExists("sort")&&this.table.options.dataTreeSort&&this.table.modules.sort.sort(r),r.forEach(a=>{o.push(a);var s=this.getChildren(a);s.forEach(l=>{o.push(l)})})),o}generateChildren(e){var i=[],n=e.getData()[this.field];return Array.isArray(n)||(n=[n]),n.forEach(r=>{var o=new Hs(r||{},this.table.rowManager);o.create(),o.modules.dataTree.index=e.modules.dataTree.index+1,o.modules.dataTree.parent=e,o.modules.dataTree.children&&(o.modules.dataTree.open=this.startOpen(o.getComponent(),o.modules.dataTree.index)),i.push(o)}),i}expandRow(e,i){var n=e.modules.dataTree;n.children!==!1&&(n.open=!0,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowExpanded",e.getComponent(),e.modules.dataTree.index))}collapseRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open=!1,e.reinitialize(),this.refreshData(!0),this.dispatchExternal("dataTreeRowCollapsed",e.getComponent(),e.modules.dataTree.index))}toggleRow(e){var i=e.modules.dataTree;i.children!==!1&&(i.open?this.collapseRow(e):this.expandRow(e))}isRowExpanded(e){return e.modules.dataTree.open}getTreeParent(e){return e.modules.dataTree.parent?e.modules.dataTree.parent.getComponent():!1}getTreeParentRoot(e){return e.modules.dataTree&&e.modules.dataTree.parent?this.getTreeParentRoot(e.modules.dataTree.parent):e}getFilteredTreeChildren(e){var i=e.modules.dataTree,n=[],r;return i.children&&(Array.isArray(i.children)||(i.children=this.generateChildren(e)),this.table.modExists("filter")&&this.table.options.dataTreeFilter?r=this.table.modules.filter.filter(i.children):r=i.children,r.forEach(o=>{o instanceof Hs&&n.push(o)})),n}rowDelete(e){var i=e.modules.dataTree.parent,n;i&&(n=this.findChildIndex(e,i),n!==!1&&i.data[this.field].splice(n,1),i.data[this.field].length||delete i.data[this.field],this.initializeRow(i),this.layoutRow(i)),this.refreshData(!0)}addTreeChildRow(e,i,n,r){var o=!1;typeof i=="string"&&(i=JSON.parse(i)),Array.isArray(e.data[this.field])||(e.data[this.field]=[],e.modules.dataTree.open=this.startOpen(e.getComponent(),e.modules.dataTree.index)),typeof r<"u"&&(o=this.findChildIndex(r,e),o!==!1&&e.data[this.field].splice(n?o:o+1,0,i)),o===!1&&(n?e.data[this.field].unshift(i):e.data[this.field].push(i)),this.initializeRow(e),this.layoutRow(e),this.refreshData(!0)}findChildIndex(e,i){var n=!1;return typeof e=="object"?e instanceof Hs?n=e.data:e instanceof Lx?n=e._getSelf().data:typeof HTMLElement<"u"&&e instanceof HTMLElement?i.modules.dataTree&&(n=i.modules.dataTree.children.find(r=>r instanceof Hs?r.element===e:!1),n&&(n=n.data)):e===null&&(n=!1):typeof e>"u"?n=!1:n=i.data[this.field].find(r=>r.data[this.table.options.index]==e),n&&(Array.isArray(i.data[this.field])&&(n=i.data[this.field].indexOf(n)),n==-1&&(n=!1)),n}getTreeChildren(e,i,n){var r=e.modules.dataTree,o=[];return r&&r.children&&(Array.isArray(r.children)||(r.children=this.generateChildren(e)),r.children.forEach(a=>{a instanceof Hs&&(o.push(i?a.getComponent():a),n&&(o=o.concat(this.getTreeChildren(a,i,n))))})),o}getChildField(){return this.field}redrawNeeded(e){return(this.field?typeof e[this.field]<"u":!1)||(this.elementField?typeof e[this.elementField]<"u":!1)}}vve.moduleName="dataTree";function QVe(t,e={},i){var n=e.delimiter?e.delimiter:",",r=[],o=[];t.forEach(a=>{var s=[];switch(a.type){case"group":console.warn("Download Warning - CSV downloader cannot process row groups");break;case"calc":console.warn("Download Warning - CSV downloader cannot process column calculations");break;case"header":a.columns.forEach((l,c)=>{l&&l.depth===1&&(o[c]=typeof l.value>"u"||l.value===null?"":'"'+String(l.value).split('"').join('""')+'"')});break;case"row":a.columns.forEach(l=>{if(l){switch(typeof l.value){case"object":l.value=l.value!==null?JSON.stringify(l.value):"";break;case"undefined":l.value="";break}s.push('"'+String(l.value).split('"').join('""')+'"')}}),r.push(s.join(n));break}}),o.length&&r.unshift(o.join(n)),r=r.join(`
`),e.bom&&(r="\uFEFF"+r),i(r,"text/csv")}function eje(t,e,i){var n=[];t.forEach(r=>{var o={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(a=>{a&&(o[a.component.getTitleDownload()||a.component.getField()]=a.value)}),n.push(o);break}}),n=JSON.stringify(n,null,"	"),i(n,"application/json")}function tje(t,e={},i){var n=[],r=[],o={},a=e.rowGroupStyles||{fontStyle:"bold",fontSize:12,cellPadding:6,fillColor:220},s=e.rowCalcStyles||{fontStyle:"bold",fontSize:10,cellPadding:4,fillColor:232},l=e.jsPDF||{},c=e.title?e.title:"";l.orientation||(l.orientation=e.orientation||"landscape"),l.unit||(l.unit="pt"),t.forEach(p=>{switch(p.type){case"header":n.push(u(p));break;case"group":r.push(u(p,a));break;case"calc":r.push(u(p,s));break;case"row":r.push(u(p));break}});function u(p,h){var f=[];return p.columns.forEach(m=>{var g;if(m){switch(typeof m.value){case"object":m.value=m.value!==null?JSON.stringify(m.value):"";break;case"undefined":m.value="";break}g={content:m.value,colSpan:m.width,rowSpan:m.height},h&&(g.styles=h),f.push(g)}}),f}var d=new jspdf.jsPDF(l);e.autoTable&&(typeof e.autoTable=="function"?o=e.autoTable(d)||{}:o=e.autoTable),c&&(o.didDrawPage=function(p){d.text(c,40,30)}),o.head=n,o.body=r,d.autoTable(o),e.documentProcessing&&e.documentProcessing(d),i(d.output("arraybuffer"),"application/pdf")}function ije(t,e,i){var n=this,r=e.sheetName||"Sheet1",o=XLSX.utils.book_new(),a=new yl(this),s="compress"in e?e.compress:!0,l=e.writeOptions||{bookType:"xlsx",bookSST:!0,compression:s},c;l.type="binary",o.SheetNames=[],o.Sheets={};function u(){var h=[],f=[],m={},g={s:{c:0,r:0},e:{c:t[0]?t[0].columns.reduce((v,y)=>v+(y&&y.width?y.width:1),0):0,r:t.length}};return t.forEach((v,y)=>{var b=[];v.columns.forEach(function(I,T){I?(b.push(!(I.value instanceof Date)&&typeof I.value=="object"?JSON.stringify(I.value):I.value),(I.width>1||I.height>-1)&&(I.height>1||I.width>1)&&f.push({s:{r:y,c:T},e:{r:y+I.height-1,c:T+I.width-1}})):b.push("")}),h.push(b)}),XLSX.utils.sheet_add_aoa(m,h),m["!ref"]=XLSX.utils.encode_range(g),f.length&&(m["!merges"]=f),m}if(e.sheetOnly){i(u());return}if(e.sheets)for(var d in e.sheets)e.sheets[d]===!0?(o.SheetNames.push(d),o.Sheets[d]=u()):(o.SheetNames.push(d),a.commsSend(e.sheets[d],"download","intercept",{type:"xlsx",options:{sheetOnly:!0},active:n.active,intercept:function(h){o.Sheets[d]=h}}));else o.SheetNames.push(r),o.Sheets[r]=u();e.documentProcessing&&(o=e.documentProcessing(o));function p(h){for(var f=new ArrayBuffer(h.length),m=new Uint8Array(f),g=0;g!=h.length;++g)m[g]=h.charCodeAt(g)&255;return f}c=XLSX.write(o,l),i(p(c),"application/octet-stream")}function nje(t,e,i){this.modExists("export",!0)&&i(this.modules.export.generateHTMLTable(t),"text/html")}function rje(t,e,i){const n=[];t.forEach(r=>{const o={};switch(r.type){case"header":break;case"group":console.warn("Download Warning - JSON downloader cannot process row groups");break;case"calc":console.warn("Download Warning - JSON downloader cannot process column calculations");break;case"row":r.columns.forEach(a=>{a&&(o[a.component.getTitleDownload()||a.component.getField()]=a.value)}),n.push(JSON.stringify(o));break}}),i(n.join(`
`),"application/x-ndjson")}var oje={csv:QVe,json:eje,jsonLines:rje,pdf:tje,xlsx:ije,html:nje};class Nw extends dn{constructor(e){super(e),this.registerTableOption("downloadEncoder",function(i,n){return new Blob([i],{type:n})}),this.registerTableOption("downloadReady",void 0),this.registerTableOption("downloadConfig",{}),this.registerTableOption("downloadRowRange","active"),this.registerColumnOption("download"),this.registerColumnOption("titleDownload")}initialize(){this.deprecatedOptionsCheck(),this.registerTableFunction("download",this.download.bind(this)),this.registerTableFunction("downloadToTab",this.downloadToTab.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("downloadReady","downloadEncoder")}downloadToTab(e,i,n,r){this.download(e,i,n,r,!0)}download(e,i,n,r,o){var a=!1;function s(c,u){o?o===!0?this.triggerDownload(c,u,e,i,!0):o(c):this.triggerDownload(c,u,e,i)}if(typeof e=="function"?a=e:Nw.downloaders[e]?a=Nw.downloaders[e]:console.warn("Download Error - No such download type found: ",e),a){var l=this.generateExportList(r);a.call(this.table,l,n||{},s.bind(this))}}generateExportList(e){var i=this.table.modules.export.generateExportList(this.table.options.downloadConfig,!1,e||this.table.options.downloadRowRange,"download"),n=this.table.options.groupHeaderDownload;return n&&!Array.isArray(n)&&(n=[n]),i.forEach(r=>{var o;r.type==="group"&&(o=r.columns[0],n&&n[r.indent]&&(o.value=n[r.indent](o.value,r.component._group.getRowCount(),r.component._group.getData(),r.component)))}),i}triggerDownload(e,i,n,r,o){var a=document.createElement("a"),s=this.table.options.downloadEncoder(e,i);s&&(o?window.open(window.URL.createObjectURL(s)):(r=r||"Tabulator."+(typeof n=="function"?"txt":n),navigator.msSaveOrOpenBlob?navigator.msSaveOrOpenBlob(s,r):(a.setAttribute("href",window.URL.createObjectURL(s)),a.setAttribute("download",r),a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a))),this.dispatchExternal("downloadComplete"))}commsReceived(e,i,n){switch(i){case"intercept":this.download(n.type,"",n.options,n.active,n.intercept);break}}}Nw.moduleName="download";Nw.downloaders=oje;function Fx(t,e){var i=e.mask,n=typeof e.maskLetterChar<"u"?e.maskLetterChar:"A",r=typeof e.maskNumberChar<"u"?e.maskNumberChar:"9",o=typeof e.maskWildcardChar<"u"?e.maskWildcardChar:"*";function a(s){var l=i[s];typeof l<"u"&&l!==o&&l!==n&&l!==r&&(t.value=t.value+""+l,a(s+1))}t.addEventListener("keydown",s=>{var l=t.value.length,c=s.key;if(s.keyCode>46&&!s.ctrlKey&&!s.metaKey){if(l>=i.length)return s.preventDefault(),s.stopPropagation(),!1;switch(i[l]){case n:if(c.toUpperCase()==c.toLowerCase())return s.preventDefault(),s.stopPropagation(),!1;break;case r:if(isNaN(c))return s.preventDefault(),s.stopPropagation(),!1;break;case o:break;default:if(c!==i[l])return s.preventDefault(),s.stopPropagation(),!1}}}),t.addEventListener("keyup",s=>{s.keyCode>46&&e.maskAutoFill&&a(t.value.length)}),t.placeholder||(t.placeholder=i),e.maskAutoFill&&a(t.value.length)}function aje(t,e,i,n,r){var o=t.getValue(),a=document.createElement("input");if(a.setAttribute("type",r.search?"search":"text"),a.style.padding="4px",a.style.width="100%",a.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),a.setAttribute(l,a.getAttribute(l)+r.elementAttributes["+"+l])):a.setAttribute(l,r.elementAttributes[l]);a.value=typeof o<"u"?o:"",e(function(){t.getType()==="cell"&&(a.focus({preventScroll:!0}),a.style.height="100%",r.selectContents&&a.select())});function s(l){(o===null||typeof o>"u")&&a.value!==""||a.value!==o?i(a.value)&&(o=a.value):n()}return a.addEventListener("change",s),a.addEventListener("blur",s),a.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break;case 35:case 36:l.stopPropagation();break}}),r.mask&&Fx(a,r),a}function sje(t,e,i,n,r){var o=t.getValue(),a=r.verticalNavigation||"hybrid",s=String(o!==null&&typeof o<"u"?o:""),l=document.createElement("textarea"),c=0;if(l.style.display="block",l.style.padding="2px",l.style.height="100%",l.style.width="100%",l.style.boxSizing="border-box",l.style.whiteSpace="pre-wrap",l.style.resize="none",r.elementAttributes&&typeof r.elementAttributes=="object")for(let d in r.elementAttributes)d.charAt(0)=="+"?(d=d.slice(1),l.setAttribute(d,l.getAttribute(d)+r.elementAttributes["+"+d])):l.setAttribute(d,r.elementAttributes[d]);l.value=s,e(function(){t.getType()==="cell"&&(l.focus({preventScroll:!0}),l.style.height="100%",l.scrollHeight,l.style.height=l.scrollHeight+"px",t.getRow().normalizeHeight(),r.selectContents&&l.select())});function u(d){(o===null||typeof o>"u")&&l.value!==""||l.value!==o?(i(l.value)&&(o=l.value),setTimeout(function(){t.getRow().normalizeHeight()},300)):n()}return l.addEventListener("change",u),l.addEventListener("blur",u),l.addEventListener("keyup",function(){l.style.height="";var d=l.scrollHeight;l.style.height=d+"px",d!=c&&(c=d,t.getRow().normalizeHeight())}),l.addEventListener("keydown",function(d){switch(d.keyCode){case 13:d.shiftKey&&r.shiftEnterSubmit&&u();break;case 27:n();break;case 38:(a=="editor"||a=="hybrid"&&l.selectionStart)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 40:(a=="editor"||a=="hybrid"&&l.selectionStart!==l.value.length)&&(d.stopImmediatePropagation(),d.stopPropagation());break;case 35:case 36:d.stopPropagation();break}}),r.mask&&Fx(l,r),l}function lje(t,e,i,n,r){var o=t.getValue(),a=r.verticalNavigation||"editor",s=document.createElement("input");if(s.setAttribute("type","number"),typeof r.max<"u"&&s.setAttribute("max",r.max),typeof r.min<"u"&&s.setAttribute("min",r.min),typeof r.step<"u"&&s.setAttribute("step",r.step),s.style.padding="4px",s.style.width="100%",s.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let u in r.elementAttributes)u.charAt(0)=="+"?(u=u.slice(1),s.setAttribute(u,s.getAttribute(u)+r.elementAttributes["+"+u])):s.setAttribute(u,r.elementAttributes[u]);s.value=o;var l=function(u){c()};e(function(){t.getType()==="cell"&&(s.removeEventListener("blur",l),s.focus({preventScroll:!0}),s.style.height="100%",s.addEventListener("blur",l),r.selectContents&&s.select())});function c(){var u=s.value;!isNaN(u)&&u!==""&&(u=Number(u)),u!==o?i(u)&&(o=u):n()}return s.addEventListener("keydown",function(u){switch(u.keyCode){case 13:c();break;case 27:n();break;case 38:case 40:a=="editor"&&(u.stopImmediatePropagation(),u.stopPropagation());break;case 35:case 36:u.stopPropagation();break}}),r.mask&&Fx(s,r),s}function cje(t,e,i,n,r){var o=t.getValue(),a=document.createElement("input");if(a.setAttribute("type","range"),typeof r.max<"u"&&a.setAttribute("max",r.max),typeof r.min<"u"&&a.setAttribute("min",r.min),typeof r.step<"u"&&a.setAttribute("step",r.step),a.style.padding="4px",a.style.width="100%",a.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let l in r.elementAttributes)l.charAt(0)=="+"?(l=l.slice(1),a.setAttribute(l,a.getAttribute(l)+r.elementAttributes["+"+l])):a.setAttribute(l,r.elementAttributes[l]);a.value=o,e(function(){t.getType()==="cell"&&(a.focus({preventScroll:!0}),a.style.height="100%")});function s(){var l=a.value;!isNaN(l)&&l!==""&&(l=Number(l)),l!=o?i(l)&&(o=l):n()}return a.addEventListener("blur",function(l){s()}),a.addEventListener("keydown",function(l){switch(l.keyCode){case 13:s();break;case 27:n();break}}),a}function uje(t,e,i,n,r){var o=r.format,a=r.verticalNavigation||"editor",s=o?window.DateTime||luxon.DateTime:null,l=t.getValue(),c=document.createElement("input");function u(p){var h;return s.isDateTime(p)?h=p:o==="iso"?h=s.fromISO(String(p)):h=s.fromFormat(String(p),o),h.toFormat("yyyy-MM-dd")}if(c.type="date",c.style.padding="4px",c.style.width="100%",c.style.boxSizing="border-box",r.max&&c.setAttribute("max",o?u(r.max):r.max),r.min&&c.setAttribute("min",o?u(r.min):r.min),r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),c.setAttribute(p,c.getAttribute(p)+r.elementAttributes["+"+p])):c.setAttribute(p,r.elementAttributes[p]);l=typeof l<"u"?l:"",o&&(s?l=u(l):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),c.value=l,e(function(){t.getType()==="cell"&&(c.focus({preventScroll:!0}),c.style.height="100%",r.selectContents&&c.select())});function d(){var p=c.value,h;if((l===null||typeof l>"u")&&p!==""||p!==l){if(p&&o)switch(h=s.fromFormat(String(p),"yyyy-MM-dd"),o){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(o)}i(p)&&(l=c.value)}else n()}return c.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==c)&&d()}),c.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:a=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),c}function dje(t,e,i,n,r){var o=r.format,a=r.verticalNavigation||"editor",s=o?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="time",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",o&&(s?(s.isDateTime(c)?l=c:o==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),o),c=l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),console.log("val",c),u.value=c,e(function(){t.getType()=="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&o)switch(h=s.fromFormat(String(p),"hh:mm"),o){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(o)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:a=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}function pje(t,e,i,n,r){var o=r.format,a=r.verticalNavigation||"editor",s=o?window.DateTime||luxon.DateTime:null,l,c=t.getValue(),u=document.createElement("input");if(u.type="datetime-local",u.style.padding="4px",u.style.width="100%",u.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let p in r.elementAttributes)p.charAt(0)=="+"?(p=p.slice(1),u.setAttribute(p,u.getAttribute(p)+r.elementAttributes["+"+p])):u.setAttribute(p,r.elementAttributes[p]);c=typeof c<"u"?c:"",o&&(s?(s.isDateTime(c)?l=c:o==="iso"?l=s.fromISO(String(c)):l=s.fromFormat(String(c),o),c=l.toFormat("yyyy-MM-dd")+"T"+l.toFormat("HH:mm")):console.error("Editor Error - 'date' editor 'format' param is dependant on luxon.js")),u.value=c,e(function(){t.getType()==="cell"&&(u.focus({preventScroll:!0}),u.style.height="100%",r.selectContents&&u.select())});function d(){var p=u.value,h;if((c===null||typeof c>"u")&&p!==""||p!==c){if(p&&o)switch(h=s.fromISO(String(p)),o){case!0:p=h;break;case"iso":p=h.toISO();break;default:p=h.toFormat(o)}i(p)&&(c=u.value)}else n()}return u.addEventListener("blur",function(p){(p.relatedTarget||p.rangeParent||p.explicitOriginalTarget!==u)&&d()}),u.addEventListener("keydown",function(p){switch(p.keyCode){case 13:d();break;case 27:n();break;case 35:case 36:p.stopPropagation();break;case 38:case 40:a=="editor"&&(p.stopImmediatePropagation(),p.stopPropagation());break}}),u}class I4{constructor(e,i,n,r,o,a){this.edit=e,this.table=e.table,this.cell=i,this.params=this._initializeParams(a),this.data=[],this.displayItems=[],this.currentItems=[],this.focusedItem=null,this.input=this._createInputElement(),this.listEl=this._createListElement(),this.initialValues=null,this.isFilter=i.getType()==="header",this.filterTimeout=null,this.filtered=!1,this.typing=!1,this.values=[],this.popup=null,this.listIteration=0,this.lastAction="",this.filterTerm="",this.blurable=!0,this.actions={success:r,cancel:o},this._deprecatedOptionsCheck(),this._initializeValue(),n(this._onRendered.bind(this))}_deprecatedOptionsCheck(){this.params.listItemFormatter&&this.cell.getTable().deprecationAdvisor.msg("The listItemFormatter editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.sortValuesList&&this.cell.getTable().deprecationAdvisor.msg("The sortValuesList editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchFunc&&this.cell.getTable().deprecationAdvisor.msg("The searchFunc editor param has been deprecated, please see the latest editor documentation for updated options"),this.params.searchingPlaceholder&&this.cell.getTable().deprecationAdvisor.msg("The searchingPlaceholder editor param has been deprecated, please see the latest editor documentation for updated options")}_initializeValue(){var e=this.cell.getValue();typeof e>"u"&&typeof this.params.defaultValue<"u"&&(e=this.params.defaultValue),this.initialValues=this.params.multiselect?e:[e],this.isFilter&&(this.input.value=this.initialValues?this.initialValues.join(","):"",this.headerFilterInitialListGen())}_onRendered(){var e=this.cell.getElement();function i(n){n.stopPropagation()}this.isFilter||(this.input.style.height="100%",this.input.focus({preventScroll:!0})),e.addEventListener("click",i),setTimeout(()=>{e.removeEventListener("click",i)},1e3),this.input.addEventListener("mousedown",this._preventPopupBlur.bind(this))}_createListElement(){var e=document.createElement("div");return e.classList.add("tabulator-edit-list"),e.addEventListener("mousedown",this._preventBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e}_setListWidth(){var e=this.isFilter?this.input:this.cell.getElement();this.listEl.style.minWidth=e.offsetWidth+"px",this.params.maxWidth&&(this.params.maxWidth===!0?this.listEl.style.maxWidth=e.offsetWidth+"px":typeof this.params.maxWidth=="number"?this.listEl.style.maxWidth=this.params.maxWidth+"px":this.listEl.style.maxWidth=this.params.maxWidth)}_createInputElement(){var e=this.params.elementAttributes,i=document.createElement("input");if(i.setAttribute("type",this.params.clearable?"search":"text"),i.style.padding="4px",i.style.width="100%",i.style.boxSizing="border-box",this.params.autocomplete||(i.style.cursor="default",i.style.caretColor="transparent"),e&&typeof e=="object")for(let n in e)n.charAt(0)=="+"?(n=n.slice(1),i.setAttribute(n,i.getAttribute(n)+e["+"+n])):i.setAttribute(n,e[n]);return this.params.mask&&Fx(i,this.params),this._bindInputEvents(i),i}_initializeParams(e){var i=["values","valuesURL","valuesLookup"],n;return e=Object.assign({},e),e.verticalNavigation=e.verticalNavigation||"editor",e.placeholderLoading=typeof e.placeholderLoading>"u"?"Searching ...":e.placeholderLoading,e.placeholderEmpty=typeof e.placeholderEmpty>"u"?"No Results Found":e.placeholderEmpty,e.filterDelay=typeof e.filterDelay>"u"?300:e.filterDelay,e.emptyValue=Object.keys(e).includes("emptyValue")?e.emptyValue:"",n=Object.keys(e).filter(r=>i.includes(r)).length,n?n>1&&console.warn("list editor config error - only one of the values, valuesURL, or valuesLookup options can be set on the same editor"):console.warn("list editor config error - either the values, valuesURL, or valuesLookup option must be set"),e.autocomplete?e.multiselect&&(e.multiselect=!1,console.warn("list editor config error - multiselect option is not available when autocomplete is enabled")):(e.freetext&&(e.freetext=!1,console.warn("list editor config error - freetext option is only available when autocomplete is enabled")),e.filterFunc&&(e.filterFunc=!1,console.warn("list editor config error - filterFunc option is only available when autocomplete is enabled")),e.filterRemote&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option is only available when autocomplete is enabled")),e.mask&&(e.mask=!1,console.warn("list editor config error - mask option is only available when autocomplete is enabled")),e.allowEmpty&&(e.allowEmpty=!1,console.warn("list editor config error - allowEmpty option is only available when autocomplete is enabled")),e.listOnEmpty&&(e.listOnEmpty=!1,console.warn("list editor config error - listOnEmpty option is only available when autocomplete is enabled"))),e.filterRemote&&!(typeof e.valuesLookup=="function"||e.valuesURL)&&(e.filterRemote=!1,console.warn("list editor config error - filterRemote option should only be used when values list is populated from a remote source")),e}_bindInputEvents(e){e.addEventListener("focus",this._inputFocus.bind(this)),e.addEventListener("click",this._inputClick.bind(this)),e.addEventListener("blur",this._inputBlur.bind(this)),e.addEventListener("keydown",this._inputKeyDown.bind(this)),e.addEventListener("search",this._inputSearch.bind(this)),this.params.autocomplete&&e.addEventListener("keyup",this._inputKeyUp.bind(this))}_inputFocus(e){this.rebuildOptionsList()}_filter(){this.params.filterRemote?(clearTimeout(this.filterTimeout),this.filterTimeout=setTimeout(()=>{this.rebuildOptionsList()},this.params.filterDelay)):this._filterList()}_inputClick(e){e.stopPropagation()}_inputBlur(e){this.blurable&&(this.popup?this.popup.hide():this._resolveValue(!0))}_inputSearch(){this._clearChoices()}_inputKeyDown(e){switch(e.keyCode){case 38:this._keyUp(e);break;case 40:this._keyDown(e);break;case 37:case 39:this._keySide(e);break;case 13:this._keyEnter();break;case 27:this._keyEsc();break;case 36:case 35:this._keyHomeEnd(e);break;case 9:this._keyTab(e);break;default:this._keySelectLetter(e)}}_inputKeyUp(e){switch(e.keyCode){case 38:case 37:case 39:case 40:case 13:case 27:break;default:this._keyAutoCompLetter(e)}}_preventPopupBlur(){this.popup&&this.popup.blockHide(),setTimeout(()=>{this.popup&&this.popup.restoreHide()},10)}_preventBlur(){this.blurable=!1,setTimeout(()=>{this.blurable=!0},10)}_keyTab(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem,!0)}_keyUp(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i>0&&this._focusItem(this.displayItems[i-1]))}_keyDown(e){var i=this.displayItems.indexOf(this.focusedItem);(this.params.verticalNavigation=="editor"||this.params.verticalNavigation=="hybrid"&&i<this.displayItems.length-1)&&(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault(),i<this.displayItems.length-1&&(i==-1?this._focusItem(this.displayItems[0]):this._focusItem(this.displayItems[i+1])))}_keySide(e){this.params.autocomplete||(e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault())}_keyEnter(e){this.params.autocomplete&&this.lastAction==="typing"?this._resolveValue(!0):this.focusedItem&&this._chooseItem(this.focusedItem)}_keyEsc(e){this._cancel()}_keyHomeEnd(e){this.params.autocomplete&&e.stopImmediatePropagation()}_keySelectLetter(e){this.params.autocomplete||(e.preventDefault(),e.keyCode>=38&&e.keyCode<=90&&this._scrollToValue(e.keyCode))}_keyAutoCompLetter(e){this._filter(),this.lastAction="typing",this.typing=!0}_scrollToValue(e){clearTimeout(this.filterTimeout);var i=String.fromCharCode(e).toLowerCase();this.filterTerm+=i.toLowerCase();var n=this.displayItems.find(r=>typeof r.label<"u"&&r.label.toLowerCase().startsWith(this.filterTerm));n&&this._focusItem(n),this.filterTimeout=setTimeout(()=>{this.filterTerm=""},800)}_focusItem(e){this.lastAction="focus",this.focusedItem&&this.focusedItem.element&&this.focusedItem.element.classList.remove("focused"),this.focusedItem=e,e&&e.element&&(e.element.classList.add("focused"),e.element.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}headerFilterInitialListGen(){this._generateOptions(!0)}rebuildOptionsList(){this._generateOptions().then(this._sortOptions.bind(this)).then(this._buildList.bind(this)).then(this._showList.bind(this)).catch(e=>{Number.isInteger(e)||console.error("List generation error",e)})}_filterList(){this._buildList(this._filterOptions()),this._showList()}_generateOptions(e){var i=[],n=++this.listIteration;return this.filtered=!1,this.params.values?i=this.params.values:this.params.valuesURL?i=this._ajaxRequest(this.params.valuesURL,this.input.value):typeof this.params.valuesLookup=="function"?i=this.params.valuesLookup(this.cell,this.input.value):this.params.valuesLookup&&(i=this._uniqueColumnValues(this.params.valuesLookupField)),i instanceof Promise?(e||this._addPlaceholder(this.params.placeholderLoading),i.then().then(r=>this.listIteration===n?this._parseList(r):Promise.reject(n))):Promise.resolve(this._parseList(i))}_addPlaceholder(e){var i=document.createElement("div");typeof e=="function"&&(e=e(this.cell.getComponent(),this.listEl)),e&&(this._clearList(),e instanceof HTMLElement?i=e:(i.classList.add("tabulator-edit-list-placeholder"),i.innerHTML=e),this.listEl.appendChild(i),this._showList())}_ajaxRequest(e,i){var n=this.params.filterRemote?{term:i}:{};return e=hve(e,{},n),fetch(e).then(r=>r.ok?r.json().catch(o=>(console.warn("List Ajax Load Error - Invalid JSON returned",o),Promise.reject(o))):(console.error("List Ajax Load Error - Connection Error: "+r.status,r.statusText),Promise.reject(r))).catch(r=>(console.error("List Ajax Load Error - Connection Error: ",r),Promise.reject(r)))}_uniqueColumnValues(e){var i={},n=this.table.getData(this.params.valuesLookup),r;return e?r=this.table.columnManager.getColumnByField(e):r=this.cell.getColumn()._getSelf(),r?n.forEach(o=>{var a=r.getFieldValue(o);a!==null&&typeof a<"u"&&a!==""&&(i[a]=!0)}):(console.warn("unable to find matching column to create select lookup list:",e),i=[]),Object.keys(i)}_parseList(e){var i=[];return Array.isArray(e)||(e=Object.entries(e).map(([n,r])=>({label:r,value:n}))),e.forEach(n=>{typeof n!="object"&&(n={label:n,value:n}),this._parseListItem(n,i,0)}),!this.currentItems.length&&this.params.freetext&&(this.input.value=this.initialValues,this.typing=!0,this.lastAction="typing"),this.data=i,i}_parseListItem(e,i,n){var r={};e.options?r=this._parseListGroup(e,n+1):(r={label:e.label,value:e.value,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,selected:!1,visible:!0,level:n,original:e},this.initialValues&&this.initialValues.indexOf(e.value)>-1&&this._chooseItem(r,!0)),i.push(r)}_parseListGroup(e,i){var n={label:e.label,group:!0,itemParams:e.itemParams,elementAttributes:e.elementAttributes,element:!1,visible:!0,level:i,options:[],original:e};return e.options.forEach(r=>{this._parseListItem(r,n.options,i)}),n}_sortOptions(e){var i;return this.params.sort&&(i=typeof this.params.sort=="function"?this.params.sort:this._defaultSortFunction.bind(this),this._sortGroup(i,e)),e}_sortGroup(e,i){i.sort((n,r)=>e(n.label,r.label,n.value,r.value,n.original,r.original)),i.forEach(n=>{n.group&&this._sortGroup(e,n.options)})}_defaultSortFunction(e,i){var n,r,o,a,s=0,l,c=/(\d+)|(\D+)/g,u=/\d/,d=0;if(this.params.sort==="desc"&&([e,i]=[i,e]),!e&&e!==0)d=!i&&i!==0?0:-1;else if(!i&&i!==0)d=1;else{if(isFinite(e)&&isFinite(i))return e-i;if(n=String(e).toLowerCase(),r=String(i).toLowerCase(),n===r)return 0;if(!(u.test(n)&&u.test(r)))return n>r?1:-1;for(n=n.match(c),r=r.match(c),l=n.length>r.length?r.length:n.length;s<l;)if(o=n[s],a=r[s++],o!==a)return isFinite(o)&&isFinite(a)?(o.charAt(0)==="0"&&(o="."+o),a.charAt(0)==="0"&&(a="."+a),o-a):o>a?1:-1;return n.length>r.length}return d}_filterOptions(){var e=this.params.filterFunc||this._defaultFilterFunc,i=this.input.value;return i?(this.filtered=!0,this.data.forEach(n=>{this._filterItem(e,i,n)})):this.filtered=!1,this.data}_filterItem(e,i,n){var r=!1;return n.group?(n.options.forEach(o=>{this._filterItem(e,i,o)&&(r=!0)}),n.visible=r):n.visible=e(i,n.label,n.value,n.original),n.visible}_defaultFilterFunc(e,i,n,r){return e=String(e).toLowerCase(),i!==null&&typeof i<"u"&&(String(i).toLowerCase().indexOf(e)>-1||String(n).toLowerCase().indexOf(e)>-1)}_clearList(){for(;this.listEl.firstChild;)this.listEl.removeChild(this.listEl.firstChild);this.displayItems=[]}_buildList(e){this._clearList(),e.forEach(i=>{this._buildItem(i)}),this.displayItems.length||this._addPlaceholder(this.params.placeholderEmpty)}_buildItem(e){var i=e.element,n;if(!this.filtered||e.visible){if(!i){if(i=document.createElement("div"),i.tabIndex=0,n=this.params.itemFormatter?this.params.itemFormatter(e.label,e.value,e.original,i):e.label,n instanceof HTMLElement?i.appendChild(n):i.innerHTML=n,e.group?i.classList.add("tabulator-edit-list-group"):i.classList.add("tabulator-edit-list-item"),i.classList.add("tabulator-edit-list-group-level-"+e.level),e.elementAttributes&&typeof e.elementAttributes=="object")for(let r in e.elementAttributes)r.charAt(0)=="+"?(r=r.slice(1),i.setAttribute(r,this.input.getAttribute(r)+e.elementAttributes["+"+r])):i.setAttribute(r,e.elementAttributes[r]);e.group?i.addEventListener("click",this._groupClick.bind(this,e)):i.addEventListener("click",this._itemClick.bind(this,e)),i.addEventListener("mousedown",this._preventBlur.bind(this)),e.element=i}this._styleItem(e),this.listEl.appendChild(i),e.group?e.options.forEach(r=>{this._buildItem(r)}):this.displayItems.push(e)}}_showList(){var e=this.popup&&this.popup.isVisible();if(this.input.parentNode){if(this.params.autocomplete&&this.input.value===""&&!this.params.listOnEmpty){this.popup&&this.popup.hide(!0);return}this._setListWidth(),this.popup||(this.popup=this.edit.popup(this.listEl)),this.popup.show(this.cell.getElement(),"bottom"),e||setTimeout(()=>{this.popup.hideOnBlur(this._resolveValue.bind(this,!0))},10)}}_styleItem(e){e&&e.element&&(e.selected?e.element.classList.add("active"):e.element.classList.remove("active"))}_itemClick(e,i){i.stopPropagation(),this._chooseItem(e)}_groupClick(e,i){i.stopPropagation()}_cancel(){this.popup.hide(!0),this.actions.cancel()}_clearChoices(){this.typing=!0,this.currentItems.forEach(e=>{e.selected=!1,this._styleItem(e)}),this.currentItems=[],this.focusedItem=null}_chooseItem(e,i){var n;this.typing=!1,this.params.multiselect?(n=this.currentItems.indexOf(e),n>-1?(this.currentItems.splice(n,1),e.selected=!1):(this.currentItems.push(e),e.selected=!0),this.input.value=this.currentItems.map(r=>r.label).join(","),this._styleItem(e)):(this.currentItems=[e],e.selected=!0,this.input.value=e.label,this._styleItem(e),i||this._resolveValue()),this._focusItem(e)}_resolveValue(e){var i,n;if(this.popup&&this.popup.hide(!0),this.params.multiselect)i=this.currentItems.map(r=>r.value);else if(e&&this.params.autocomplete&&this.typing)if(this.params.freetext||this.params.allowEmpty&&this.input.value==="")i=this.input.value;else{this.actions.cancel();return}else this.currentItems[0]?i=this.currentItems[0].value:(n=Array.isArray(this.initialValues)?this.initialValues[0]:this.initialValues,n===null||typeof n>"u"||n===""?i=n:i=this.params.emptyValue);i===""&&(i=this.params.emptyValue),this.actions.success(i),this.isFilter&&(this.initialValues=i&&!Array.isArray(i)?[i]:i,this.currentItems=[])}}function hje(t,e,i,n,r){this.deprecationMsg("The select editor has been deprecated, please use the new list editor");var o=new I4(this,t,e,i,n,r);return o.input}function fje(t,e,i,n,r){var o=new I4(this,t,e,i,n,r);return o.input}function mje(t,e,i,n,r){this.deprecationMsg("The autocomplete editor has been deprecated, please use the new list editor with the 'autocomplete' editorParam"),r.autocomplete=!0;var o=new I4(this,t,e,i,n,r);return o.input}function gje(t,e,i,n,r){var o=this,a=t.getElement(),s=t.getValue(),l=a.getElementsByTagName("svg").length||5,c=a.getElementsByTagName("svg")[0]?a.getElementsByTagName("svg")[0].getAttribute("width"):14,u=[],d=document.createElement("div"),p=document.createElementNS("http://www.w3.org/2000/svg","svg");function h(v){u.forEach(function(y,b){b<v?(o.table.browser=="ie"?y.setAttribute("class","tabulator-star-active"):y.classList.replace("tabulator-star-inactive","tabulator-star-active"),y.innerHTML='<polygon fill="#488CE9" stroke="#014AAE" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>'):(o.table.browser=="ie"?y.setAttribute("class","tabulator-star-inactive"):y.classList.replace("tabulator-star-active","tabulator-star-inactive"),y.innerHTML='<polygon fill="#010155" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>')})}function f(v){var y=document.createElement("span"),b=p.cloneNode(!0);u.push(b),y.addEventListener("mouseenter",function(I){I.stopPropagation(),I.stopImmediatePropagation(),h(v)}),y.addEventListener("mousemove",function(I){I.stopPropagation(),I.stopImmediatePropagation()}),y.addEventListener("click",function(I){I.stopPropagation(),I.stopImmediatePropagation(),i(v),a.blur()}),y.appendChild(b),d.appendChild(y)}function m(v){s=v,h(v)}if(a.style.whiteSpace="nowrap",a.style.overflow="hidden",a.style.textOverflow="ellipsis",d.style.verticalAlign="middle",d.style.display="inline-block",d.style.padding="4px",p.setAttribute("width",c),p.setAttribute("height",c),p.setAttribute("viewBox","0 0 512 512"),p.setAttribute("xml:space","preserve"),p.style.padding="0 1px",r.elementAttributes&&typeof r.elementAttributes=="object")for(let v in r.elementAttributes)v.charAt(0)=="+"?(v=v.slice(1),d.setAttribute(v,d.getAttribute(v)+r.elementAttributes["+"+v])):d.setAttribute(v,r.elementAttributes[v]);for(var g=1;g<=l;g++)f(g);return s=Math.min(parseInt(s),l),h(s),d.addEventListener("mousemove",function(v){h(0)}),d.addEventListener("click",function(v){i(0)}),a.addEventListener("blur",function(v){n()}),a.addEventListener("keydown",function(v){switch(v.keyCode){case 39:m(s+1);break;case 37:m(s-1);break;case 13:i(s);break;case 27:n();break}}),d}function vje(t,e,i,n,r){var o=t.getElement(),a=typeof r.max>"u"?o.getElementsByTagName("div")[0]&&o.getElementsByTagName("div")[0].getAttribute("max")||100:r.max,s=typeof r.min>"u"?o.getElementsByTagName("div")[0]&&o.getElementsByTagName("div")[0].getAttribute("min")||0:r.min,l=(a-s)/100,c=t.getValue()||0,u=document.createElement("div"),d=document.createElement("div"),p,h;function f(){var m=window.getComputedStyle(o,null),g=l*Math.round(d.offsetWidth/((o.clientWidth-parseInt(m.getPropertyValue("padding-left"))-parseInt(m.getPropertyValue("padding-right")))/100))+s;i(g),o.setAttribute("aria-valuenow",g),o.setAttribute("aria-label",c)}if(u.style.position="absolute",u.style.right="0",u.style.top="0",u.style.bottom="0",u.style.width="5px",u.classList.add("tabulator-progress-handle"),d.style.display="inline-block",d.style.position="relative",d.style.height="100%",d.style.backgroundColor="#488CE9",d.style.maxWidth="100%",d.style.minWidth="0%",r.elementAttributes&&typeof r.elementAttributes=="object")for(let m in r.elementAttributes)m.charAt(0)=="+"?(m=m.slice(1),d.setAttribute(m,d.getAttribute(m)+r.elementAttributes["+"+m])):d.setAttribute(m,r.elementAttributes[m]);return o.style.padding="4px 4px",c=Math.min(parseFloat(c),a),c=Math.max(parseFloat(c),s),c=Math.round((c-s)/l),d.style.width=c+"%",o.setAttribute("aria-valuemin",s),o.setAttribute("aria-valuemax",a),d.appendChild(u),u.addEventListener("mousedown",function(m){p=m.screenX,h=d.offsetWidth}),u.addEventListener("mouseover",function(){u.style.cursor="ew-resize"}),o.addEventListener("mousemove",function(m){p&&(d.style.width=h+m.screenX-p+"px")}),o.addEventListener("mouseup",function(m){p&&(m.stopPropagation(),m.stopImmediatePropagation(),p=!1,h=!1,f())}),o.addEventListener("keydown",function(m){switch(m.keyCode){case 39:m.preventDefault(),d.style.width=d.clientWidth+o.clientWidth/100+"px";break;case 37:m.preventDefault(),d.style.width=d.clientWidth-o.clientWidth/100+"px";break;case 9:case 13:f();break;case 27:n();break}}),o.addEventListener("blur",function(){n()}),d}function yje(t,e,i,n,r){var o=t.getValue(),a=document.createElement("input"),s=r.tristate,l=typeof r.indeterminateValue>"u"?null:r.indeterminateValue,c=!1,u=Object.keys(r).includes("trueValue"),d=Object.keys(r).includes("falseValue");if(a.setAttribute("type","checkbox"),a.style.marginTop="5px",a.style.boxSizing="border-box",r.elementAttributes&&typeof r.elementAttributes=="object")for(let h in r.elementAttributes)h.charAt(0)=="+"?(h=h.slice(1),a.setAttribute(h,a.getAttribute(h)+r.elementAttributes["+"+h])):a.setAttribute(h,r.elementAttributes[h]);a.value=o,s&&(typeof o>"u"||o===l||o==="")&&(c=!0,a.indeterminate=!0),this.table.browser!="firefox"&&this.table.browser!="safari"&&e(function(){t.getType()==="cell"&&a.focus({preventScroll:!0})}),a.checked=u?o===r.trueValue:o===!0||o==="true"||o==="True"||o===1;function p(h){var f=a.checked;return u&&f?f=r.trueValue:d&&!f&&(f=r.falseValue),s?h?c?l:f:a.checked&&!c?(a.checked=!1,a.indeterminate=!0,c=!0,l):(c=!1,f):f}return a.addEventListener("change",function(h){i(p())}),a.addEventListener("blur",function(h){i(p(!0))}),a.addEventListener("keydown",function(h){h.keyCode==13&&i(p()),h.keyCode==27&&n()}),a}var bje={input:aje,textarea:sje,number:lje,range:cje,date:uje,time:dje,datetime:pje,select:hje,list:fje,autocomplete:mje,star:gje,progress:vje,tickCross:yje};class HC extends dn{constructor(e){super(e),this.currentCell=!1,this.mouseClick=!1,this.recursionBlock=!1,this.invalidEdit=!1,this.editedCells=[],this.editors=HC.editors,this.registerColumnOption("editable"),this.registerColumnOption("editor"),this.registerColumnOption("editorParams"),this.registerColumnOption("cellEditing"),this.registerColumnOption("cellEdited"),this.registerColumnOption("cellEditCancelled"),this.registerTableOption("editTriggerEvent","focus"),this.registerTableFunction("getEditedCells",this.getEditedCells.bind(this)),this.registerTableFunction("clearCellEdited",this.clearCellEdited.bind(this)),this.registerTableFunction("navigatePrev",this.navigatePrev.bind(this)),this.registerTableFunction("navigateNext",this.navigateNext.bind(this)),this.registerTableFunction("navigateLeft",this.navigateLeft.bind(this)),this.registerTableFunction("navigateRight",this.navigateRight.bind(this)),this.registerTableFunction("navigateUp",this.navigateUp.bind(this)),this.registerTableFunction("navigateDown",this.navigateDown.bind(this)),this.registerComponentFunction("cell","isEdited",this.cellIsEdited.bind(this)),this.registerComponentFunction("cell","clearEdited",this.clearEdited.bind(this)),this.registerComponentFunction("cell","edit",this.editCell.bind(this)),this.registerComponentFunction("cell","cancelEdit",this.cellCancelEdit.bind(this)),this.registerComponentFunction("cell","navigatePrev",this.navigatePrev.bind(this)),this.registerComponentFunction("cell","navigateNext",this.navigateNext.bind(this)),this.registerComponentFunction("cell","navigateLeft",this.navigateLeft.bind(this)),this.registerComponentFunction("cell","navigateRight",this.navigateRight.bind(this)),this.registerComponentFunction("cell","navigateUp",this.navigateUp.bind(this)),this.registerComponentFunction("cell","navigateDown",this.navigateDown.bind(this))}initialize(){this.subscribe("cell-init",this.bindEditor.bind(this)),this.subscribe("cell-delete",this.clearEdited.bind(this)),this.subscribe("cell-value-changed",this.updateCellClass.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("column-delete",this.columnDeleteCheck.bind(this)),this.subscribe("row-deleting",this.rowDeleteCheck.bind(this)),this.subscribe("row-layout",this.rowEditableCheck.bind(this)),this.subscribe("data-refreshing",this.cancelEdit.bind(this)),this.subscribe("clipboard-paste",this.pasteBlocker.bind(this)),this.subscribe("keybinding-nav-prev",this.navigatePrev.bind(this,void 0)),this.subscribe("keybinding-nav-next",this.keybindingNavigateNext.bind(this)),this.subscribe("keybinding-nav-up",this.navigateUp.bind(this,void 0)),this.subscribe("keybinding-nav-down",this.navigateDown.bind(this,void 0))}pasteBlocker(e){if(this.currentCell)return!0}keybindingNavigateNext(e){var i=this.currentCell,n=this.options("tabEndNewRow");i&&(this.navigateNext(i,e)||n&&(i.getElement().firstChild.blur(),this.invalidEdit||(n===!0?n=this.table.addRow({}):typeof n=="function"?n=this.table.addRow(n(i.row.getComponent())):n=this.table.addRow(Object.assign({},n)),n.then(()=>{setTimeout(()=>{i.getComponent().navigateNext()})}))))}cellIsEdited(e){return!!e.modules.edit&&e.modules.edit.edited}cellCancelEdit(e){e===this.currentCell?this.table.modules.edit.cancelEdit():console.warn("Cancel Editor Error - This cell is not currently being edited ")}updateCellClass(e){this.allowEdit(e)?e.getElement().classList.add("tabulator-editable"):e.getElement().classList.remove("tabulator-editable")}clearCellEdited(e){e||(e=this.table.modules.edit.getEditedCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.table.modules.edit.clearEdited(i._getSelf())})}navigatePrev(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateLeft(),n)return!0;if(r=this.table.rowManager.prevDisplayRow(e.row,!0),r&&(n=this.findPrevEditableCell(r,r.cells.length),n))return n.getComponent().edit(),!0}return!1}navigateNext(e=this.currentCell,i){var n,r;if(e){if(i&&i.preventDefault(),n=this.navigateRight(),n)return!0;if(r=this.table.rowManager.nextDisplayRow(e.row,!0),r&&(n=this.findNextEditableCell(r,-1),n))return n.getComponent().edit(),!0}return!1}navigateLeft(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findPrevEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateRight(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.findNextEditableCell(e.row,n),r)?(r.getComponent().edit(),!0):!1}navigateUp(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.prevDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}navigateDown(e=this.currentCell,i){var n,r;return e&&(i&&i.preventDefault(),n=e.getIndex(),r=this.table.rowManager.nextDisplayRow(e.row,!0),r)?(r.cells[n].getComponent().edit(),!0):!1}findNextEditableCell(e,i){var n=!1;if(i<e.cells.length-1)for(var r=i+1;r<e.cells.length;r++){let o=e.cells[r];if(o.column.modules.edit&&Jr.elVisible(o.getElement())&&this.allowEdit(o)){n=o;break}}return n}findPrevEditableCell(e,i){var n=!1;if(i>0)for(var r=i-1;r>=0;r--){let o=e.cells[r];if(o.column.modules.edit&&Jr.elVisible(o.getElement())&&this.allowEdit(o)){n=o;break}}return n}initializeColumnCheck(e){typeof e.definition.editor<"u"&&this.initializeColumn(e)}columnDeleteCheck(e){this.currentCell&&this.currentCell.column===e&&this.cancelEdit()}rowDeleteCheck(e){this.currentCell&&this.currentCell.row===e&&this.cancelEdit()}rowEditableCheck(e){e.getCells().forEach(i=>{i.column.modules.edit&&typeof i.column.modules.edit.check=="function"&&this.updateCellClass(i)})}initializeColumn(e){var i={editor:!1,blocked:!1,check:e.definition.editable,params:e.definition.editorParams||{}};switch(typeof e.definition.editor){case"string":this.editors[e.definition.editor]?i.editor=this.editors[e.definition.editor]:console.warn("Editor Error - No such editor found: ",e.definition.editor);break;case"function":i.editor=e.definition.editor;break;case"boolean":e.definition.editor===!0&&(typeof e.definition.formatter!="function"?this.editors[e.definition.formatter]?i.editor=this.editors[e.definition.formatter]:i.editor=this.editors.input:console.warn("Editor Error - Cannot auto lookup editor for a custom formatter: ",e.definition.formatter));break}i.editor&&(e.modules.edit=i)}getCurrentCell(){return this.currentCell?this.currentCell.getComponent():!1}clearEditor(e){var i=this.currentCell,n;if(this.invalidEdit=!1,i){for(this.currentCell=!1,n=i.getElement(),this.dispatch("edit-editor-clear",i,e),n.classList.remove("tabulator-editing");n.firstChild;)n.removeChild(n.firstChild);i.row.getElement().classList.remove("tabulator-editing"),i.table.element.classList.remove("tabulator-editing")}}cancelEdit(){if(this.currentCell){var e=this.currentCell,i=this.currentCell.getComponent();this.clearEditor(!0),e.setValueActual(e.getValue()),e.cellRendered(),(e.column.definition.editor=="textarea"||e.column.definition.variableHeight)&&e.row.normalizeHeight(!0),e.column.definition.cellEditCancelled&&e.column.definition.cellEditCancelled.call(this.table,i),this.dispatch("edit-cancelled",e),this.dispatchExternal("cellEditCancelled",i)}}bindEditor(e){if(e.column.modules.edit){var i=this,n=e.getElement(!0);this.updateCellClass(e),n.setAttribute("tabindex",0),n.addEventListener("mousedown",function(r){r.button===2?r.preventDefault():i.mouseClick=!0}),this.options("editTriggerEvent")==="dblclick"&&n.addEventListener("dblclick",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),(this.options("editTriggerEvent")==="focus"||this.options("editTriggerEvent")==="click")&&n.addEventListener("click",function(r){n.classList.contains("tabulator-editing")||(n.focus({preventScroll:!0}),i.edit(e,r,!1))}),this.options("editTriggerEvent")==="focus"&&n.addEventListener("focus",function(r){i.recursionBlock||i.edit(e,r,!1)})}}focusCellNoEvent(e,i){this.recursionBlock=!0,i&&this.table.browser==="ie"||e.getElement().focus({preventScroll:!0}),this.recursionBlock=!1}editCell(e,i){this.focusCellNoEvent(e),this.edit(e,!1,i)}focusScrollAdjust(e){if(this.table.rowManager.getRenderMode()=="virtual"){var i=this.table.rowManager.element.scrollTop,n=this.table.rowManager.element.clientHeight+this.table.rowManager.element.scrollTop,r=e.row.getElement();r.offsetTop<i?this.table.rowManager.element.scrollTop-=i-r.offsetTop:r.offsetTop+r.offsetHeight>n&&(this.table.rowManager.element.scrollTop+=r.offsetTop+r.offsetHeight-n);var o=this.table.rowManager.element.scrollLeft,a=this.table.rowManager.element.clientWidth+this.table.rowManager.element.scrollLeft,s=e.getElement();this.table.modExists("frozenColumns")&&(o+=parseInt(this.table.modules.frozenColumns.leftMargin||0),a-=parseInt(this.table.modules.frozenColumns.rightMargin||0)),this.table.options.renderHorizontal==="virtual"&&(o-=parseInt(this.table.columnManager.renderer.vDomPadLeft),a-=parseInt(this.table.columnManager.renderer.vDomPadLeft)),s.offsetLeft<o?this.table.rowManager.element.scrollLeft-=o-s.offsetLeft:s.offsetLeft+s.offsetWidth>a&&(this.table.rowManager.element.scrollLeft+=s.offsetLeft+s.offsetWidth-a)}}allowEdit(e){var i=!!e.column.modules.edit;if(e.column.modules.edit)switch(typeof e.column.modules.edit.check){case"function":e.row.initialized&&(i=e.column.modules.edit.check(e.getComponent()));break;case"string":i=!!e.row.data[e.column.modules.edit.check];break;case"boolean":i=e.column.modules.edit.check;break}return i}edit(e,i,n){var r=this,o=!0,a=function(){},s=e.getElement(),l=!1,c,u,d;if(this.currentCell){!this.invalidEdit&&this.currentCell!==e&&this.cancelEdit();return}function p(v){if(r.currentCell===e&&!l){var y=r.chain("edit-success",[e,v],!0,!0);return y===!0||r.table.options.validationMode==="highlight"?(l=!0,r.clearEditor(),e.modules.edit||(e.modules.edit={}),e.modules.edit.edited=!0,r.editedCells.indexOf(e)==-1&&r.editedCells.push(e),e.setValue(v,!0),y===!0):(l=!0,r.invalidEdit=!0,r.focusCellNoEvent(e,!0),a(),setTimeout(()=>{l=!1},10),!1)}}function h(){r.currentCell===e&&!l&&r.cancelEdit()}function f(v){a=v}if(e.column.modules.edit.blocked)return this.mouseClick=!1,this.blur(s),!1;if(i&&i.stopPropagation(),o=this.allowEdit(e),o||n){if(r.cancelEdit(),r.currentCell=e,this.focusScrollAdjust(e),u=e.getComponent(),this.mouseClick&&(this.mouseClick=!1,e.column.definition.cellClick&&e.column.definition.cellClick.call(this.table,i,u)),e.column.definition.cellEditing&&e.column.definition.cellEditing.call(this.table,u),this.dispatch("cell-editing",e),this.dispatchExternal("cellEditing",u),d=typeof e.column.modules.edit.params=="function"?e.column.modules.edit.params(u):e.column.modules.edit.params,c=e.column.modules.edit.editor.call(r,u,f,p,h,d),this.currentCell&&c!==!1)if(c instanceof Node){for(s.classList.add("tabulator-editing"),e.row.getElement().classList.add("tabulator-editing"),e.table.element.classList.add("tabulator-editing");s.firstChild;)s.removeChild(s.firstChild);s.appendChild(c),a();for(var m=s.children,g=0;g<m.length;g++)m[g].addEventListener("click",function(v){v.stopPropagation()})}else return console.warn("Edit Error - Editor should return an instance of Node, the editor returned:",c),this.blur(s),!1;else return this.blur(s),!1;return!0}else return this.mouseClick=!1,this.blur(s),!1}blur(e){this.confirm("edit-blur",[e])||e.blur()}getEditedCells(){var e=[];return this.editedCells.forEach(i=>{e.push(i.getComponent())}),e}clearEdited(e){var i;e.modules.edit&&e.modules.edit.edited&&(e.modules.edit.edited=!1,this.dispatch("edit-edited-clear",e)),i=this.editedCells.indexOf(e),i>-1&&this.editedCells.splice(i,1)}}HC.moduleName="edit";HC.editors=bje;class bK{constructor(e,i,n,r){this.type=e,this.columns=i,this.component=n||!1,this.indent=r||0}}class BL{constructor(e,i,n,r,o){this.value=e,this.component=i||!1,this.width=n,this.height=r,this.depth=o}}class yve extends dn{constructor(e){super(e),this.config={},this.cloneTableStyle=!0,this.colVisProp="",this.registerTableOption("htmlOutputConfig",!1),this.registerColumnOption("htmlOutput"),this.registerColumnOption("titleHtmlOutput")}initialize(){this.registerTableFunction("getHtml",this.getHtml.bind(this))}generateExportList(e,i,n,r){this.cloneTableStyle=i,this.config=e||{},this.colVisProp=r;var o,a;if(n==="range"){var s=this.table.modules.selectRange.selectedColumns();o=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders(s)):[],a=this.bodyToExportRows(this.rowLookup(n),this.table.modules.selectRange.selectedColumns(!0))}else o=this.config.columnHeaders!==!1?this.headersToExportRows(this.generateColumnGroupHeaders()):[],a=this.bodyToExportRows(this.rowLookup(n));return o.concat(a)}generateTable(e,i,n,r){var o=this.generateExportList(e,i,n,r);return this.generateTableElement(o)}rowLookup(e){var i=[];if(typeof e=="function")e.call(this.table).forEach(n=>{n=this.table.rowManager.findRow(n),n&&i.push(n)});else switch(e){case!0:case"visible":i=this.table.rowManager.getVisibleRows(!1,!0);break;case"all":i=this.table.rowManager.rows;break;case"selected":i=this.table.modules.selectRow.selectedRows;break;case"range":i=this.table.modules.selectRange.selectedRows();break;case"active":default:this.table.options.pagination?i=this.table.rowManager.getDisplayRows(this.table.rowManager.displayRows.length-2):i=this.table.rowManager.getDisplayRows()}return Object.assign([],i)}generateColumnGroupHeaders(e){var i=[];return e||(e=this.config.columnGroups!==!1?this.table.columnManager.columns:this.table.columnManager.columnsByIndex),e.forEach(n=>{var r=this.processColumnGroup(n);r&&i.push(r)}),i}processColumnGroup(e){var i=e.columns,n=0,r=e.definition["title"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))]||e.definition.title,o={title:r,column:e,depth:1};if(i.length){if(o.subGroups=[],o.width=0,i.forEach(a=>{var s=this.processColumnGroup(a);s&&(o.width+=s.width,o.subGroups.push(s),s.depth>n&&(n=s.depth))}),o.depth+=n,!o.width)return!1}else if(this.columnVisCheck(e))o.width=1;else return!1;return o}columnVisCheck(e){var i=e.definition[this.colVisProp];return typeof i=="function"&&(i=i.call(this.table,e.getComponent())),i!==!1&&(e.visible||!e.visible&&i)}headersToExportRows(e){var i=[],n=0,r=[];function o(a,s){var l=n-s;if(typeof i[s]>"u"&&(i[s]=[]),a.height=a.subGroups?1:l-a.depth+1,i[s].push(a),a.height>1)for(let c=1;c<a.height;c++)typeof i[s+c]>"u"&&(i[s+c]=[]),i[s+c].push(!1);if(a.width>1)for(let c=1;c<a.width;c++)i[s].push(!1);a.subGroups&&a.subGroups.forEach(function(c){o(c,s+1)})}return e.forEach(function(a){a.depth>n&&(n=a.depth)}),e.forEach(function(a){o(a,0)}),i.forEach(a=>{var s=[];a.forEach(l=>{if(l){let c=typeof l.title>"u"?"":l.title;s.push(new BL(c,l.column.getComponent(),l.width,l.height,l.depth))}else s.push(null)}),r.push(new bK("header",s))}),r}bodyToExportRows(e,i=[]){var n=[];return i.length===0&&this.table.columnManager.columnsByIndex.forEach(r=>{this.columnVisCheck(r)&&i.push(r.getComponent())}),this.config.columnCalcs!==!1&&this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&e.unshift(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&e.push(this.table.modules.columnCalcs.botRow)),e=e.filter(r=>{switch(r.type){case"group":return this.config.rowGroups!==!1;case"calc":return this.config.columnCalcs!==!1;case"row":return!(this.table.options.dataTree&&this.config.dataTree===!1&&r.modules.dataTree.parent)}return!0}),e.forEach((r,o)=>{var a=r.getData(this.colVisProp),s=[],l=0;switch(r.type){case"group":l=r.level,s.push(new BL(r.key,r.getComponent(),i.length,1));break;case"calc":case"row":i.forEach(c=>{s.push(new BL(c._column.getFieldValue(a),c,1,1))}),this.table.options.dataTree&&this.config.dataTree!==!1&&(l=r.modules.dataTree.index);break}n.push(new bK(r.type,s,r.getComponent(),l))}),n}generateTableElement(e){var i=document.createElement("table"),n=document.createElement("thead"),r=document.createElement("tbody"),o=this.lookupTableStyles(),a=this.table.options["rowFormatter"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],s={};return s.rowFormatter=a!==null?a:this.table.options.rowFormatter,this.table.options.dataTree&&this.config.dataTree!==!1&&this.table.modExists("columnCalcs")&&(s.treeElementField=this.table.modules.dataTree.elementField),s.groupHeader=this.table.options["groupHeader"+(this.colVisProp.charAt(0).toUpperCase()+this.colVisProp.slice(1))],s.groupHeader&&!Array.isArray(s.groupHeader)&&(s.groupHeader=[s.groupHeader]),i.classList.add("tabulator-print-table"),this.mapElementStyles(this.table.columnManager.getHeadersElement(),n,["border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),e.length>1e3&&console.warn("It may take a long time to render an HTML table with more than 1000 rows"),e.forEach((l,c)=>{let u;switch(l.type){case"header":n.appendChild(this.generateHeaderElement(l,s,o));break;case"group":r.appendChild(this.generateGroupElement(l,s,o));break;case"calc":r.appendChild(this.generateCalcElement(l,s,o));break;case"row":u=this.generateRowElement(l,s,o),this.mapElementStyles(c%2&&o.evenRow?o.evenRow:o.oddRow,u,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r.appendChild(u);break}}),n.innerHTML&&i.appendChild(n),i.appendChild(r),this.mapElementStyles(this.table.element,i,["border-top","border-left","border-right","border-bottom"]),i}lookupTableStyles(){var e={};return this.cloneTableStyle&&window.getComputedStyle&&(e.oddRow=this.table.element.querySelector(".tabulator-row-odd:not(.tabulator-group):not(.tabulator-calcs)"),e.evenRow=this.table.element.querySelector(".tabulator-row-even:not(.tabulator-group):not(.tabulator-calcs)"),e.calcRow=this.table.element.querySelector(".tabulator-row.tabulator-calcs"),e.firstRow=this.table.element.querySelector(".tabulator-row:not(.tabulator-group):not(.tabulator-calcs)"),e.firstGroup=this.table.element.getElementsByClassName("tabulator-group")[0],e.firstRow&&(e.styleCells=e.firstRow.getElementsByClassName("tabulator-cell"),e.firstCell=e.styleCells[0],e.lastCell=e.styleCells[e.styleCells.length-1])),e}generateHeaderElement(e,i,n){var r=document.createElement("tr");return e.columns.forEach(o=>{if(o){var a=document.createElement("th"),s=o.component._column.definition.cssClass?o.component._column.definition.cssClass.split(" "):[];a.colSpan=o.width,a.rowSpan=o.height,a.innerHTML=o.value,this.cloneTableStyle&&(a.style.boxSizing="border-box"),s.forEach(function(l){a.classList.add(l)}),this.mapElementStyles(o.component.getElement(),a,["text-align","border-top","border-left","border-right","border-bottom","background-color","color","font-weight","font-family","font-size"]),this.mapElementStyles(o.component._column.contentElement,a,["padding-top","padding-left","padding-right","padding-bottom"]),o.component._column.visible?this.mapElementStyles(o.component.getElement(),a,["width"]):o.component._column.definition.width&&(a.style.width=o.component._column.definition.width+"px"),o.component._column.parent&&this.mapElementStyles(o.component._column.parent.groupElement,a,["border-top"]),r.appendChild(a)}}),r}generateGroupElement(e,i,n){var r=document.createElement("tr"),o=document.createElement("td"),a=e.columns[0];return r.classList.add("tabulator-print-table-row"),i.groupHeader&&i.groupHeader[e.indent]?a.value=i.groupHeader[e.indent](a.value,e.component._group.getRowCount(),e.component._group.getData(),e.component):i.groupHeader!==!1&&(a.value=e.component._group.generator(a.value,e.component._group.getRowCount(),e.component._group.getData(),e.component)),o.colSpan=a.width,o.innerHTML=a.value,r.classList.add("tabulator-print-table-group"),r.classList.add("tabulator-group-level-"+e.indent),a.component.isVisible()&&r.classList.add("tabulator-group-visible"),this.mapElementStyles(n.firstGroup,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),this.mapElementStyles(n.firstGroup,o,["padding-top","padding-left","padding-right","padding-bottom"]),r.appendChild(o),r}generateCalcElement(e,i,n){var r=this.generateRowElement(e,i,n);return r.classList.add("tabulator-print-table-calcs"),this.mapElementStyles(n.calcRow,r,["border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","background-color"]),r}generateRowElement(e,i,n){var r=document.createElement("tr");if(r.classList.add("tabulator-print-table-row"),e.columns.forEach((o,a)=>{if(o){var s=document.createElement("td"),l=o.component._column,c=this.table,u=c.columnManager.findColumnIndex(l),d=o.value,p,h={modules:{},getValue:function(){return d},getField:function(){return l.definition.field},getElement:function(){return s},getType:function(){return"cell"},getColumn:function(){return l.getComponent()},getData:function(){return e.component.getData()},getRow:function(){return e.component},getTable:function(){return c},getComponent:function(){return h},column:l},f=l.definition.cssClass?l.definition.cssClass.split(" "):[];if(f.forEach(function(m){s.classList.add(m)}),this.table.modExists("format")&&this.config.formatCells!==!1)d=this.table.modules.format.formatExportValue(h,this.colVisProp);else switch(typeof d){case"object":d=d!==null?JSON.stringify(d):"";break;case"undefined":d="";break}d instanceof Node?s.appendChild(d):s.innerHTML=d,p=n.styleCells&&n.styleCells[u]?n.styleCells[u]:n.firstCell,p&&(this.mapElementStyles(p,s,["padding-top","padding-left","padding-right","padding-bottom","border-top","border-left","border-right","border-bottom","color","font-weight","font-family","font-size","text-align"]),l.definition.align&&(s.style.textAlign=l.definition.align)),this.table.options.dataTree&&this.config.dataTree!==!1&&(i.treeElementField&&i.treeElementField==l.field||!i.treeElementField&&a==0)&&(e.component._row.modules.dataTree.controlEl&&s.insertBefore(e.component._row.modules.dataTree.controlEl.cloneNode(!0),s.firstChild),e.component._row.modules.dataTree.branchEl&&s.insertBefore(e.component._row.modules.dataTree.branchEl.cloneNode(!0),s.firstChild)),r.appendChild(s),h.modules.format&&h.modules.format.renderedCallback&&h.modules.format.renderedCallback()}}),i.rowFormatter&&e.type==="row"&&this.config.formatCells!==!1){let o=Object.assign(e.component);o.getElement=function(){return r},i.rowFormatter(e.component)}return r}generateHTMLTable(e){var i=document.createElement("div");return i.appendChild(this.generateTableElement(e)),i.innerHTML}getHtml(e,i,n,r){var o=this.generateExportList(n||this.table.options.htmlOutputConfig,i,e,r||"htmlOutput");return this.generateHTMLTable(o)}mapElementStyles(e,i,n){if(this.cloneTableStyle&&e&&i){var r={"background-color":"backgroundColor",color:"fontColor",width:"width","font-weight":"fontWeight","font-family":"fontFamily","font-size":"fontSize","text-align":"textAlign","border-top":"borderTop","border-left":"borderLeft","border-right":"borderRight","border-bottom":"borderBottom","padding-top":"paddingTop","padding-left":"paddingLeft","padding-right":"paddingRight","padding-bottom":"paddingBottom"};if(window.getComputedStyle){var o=window.getComputedStyle(e);n.forEach(function(a){i.style[r[a]]||(i.style[r[a]]=o.getPropertyValue(a))})}}}}yve.moduleName="export";var Ije={"=":function(t,e,i,n){return e==t},"<":function(t,e,i,n){return e<t},"<=":function(t,e,i,n){return e<=t},">":function(t,e,i,n){return e>t},">=":function(t,e,i,n){return e>=t},"!=":function(t,e,i,n){return e!=t},regex:function(t,e,i,n){return typeof t=="string"&&(t=new RegExp(t)),t.test(e)},like:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().indexOf(t.toLowerCase())>-1:!1},keywords:function(t,e,i,n){var r=t.toLowerCase().split(typeof n.separator>"u"?" ":n.separator),o=String(e===null||typeof e>"u"?"":e).toLowerCase(),a=[];return r.forEach(s=>{o.includes(s)&&a.push(!0)}),n.matchAll?a.length===r.length:!!a.length},starts:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().startsWith(t.toLowerCase()):!1},ends:function(t,e,i,n){return t===null||typeof t>"u"?e===t:typeof e<"u"&&e!==null?String(e).toLowerCase().endsWith(t.toLowerCase()):!1},in:function(t,e,i,n){return Array.isArray(t)?t.length?t.indexOf(e)>-1:!0:(console.warn("Filter Error - filter value is not an array:",t),!1)}};class Mh extends dn{constructor(e){super(e),this.filterList=[],this.headerFilters={},this.headerFilterColumns=[],this.prevHeaderFilterChangeCheck="",this.prevHeaderFilterChangeCheck="{}",this.changed=!1,this.tableInitialized=!1,this.registerTableOption("filterMode","local"),this.registerTableOption("initialFilter",!1),this.registerTableOption("initialHeaderFilter",!1),this.registerTableOption("headerFilterLiveFilterDelay",300),this.registerTableOption("placeholderHeaderFilter",!1),this.registerColumnOption("headerFilter"),this.registerColumnOption("headerFilterPlaceholder"),this.registerColumnOption("headerFilterParams"),this.registerColumnOption("headerFilterEmptyCheck"),this.registerColumnOption("headerFilterFunc"),this.registerColumnOption("headerFilterFuncParams"),this.registerColumnOption("headerFilterLiveFilter"),this.registerTableFunction("searchRows",this.searchRows.bind(this)),this.registerTableFunction("searchData",this.searchData.bind(this)),this.registerTableFunction("setFilter",this.userSetFilter.bind(this)),this.registerTableFunction("refreshFilter",this.userRefreshFilter.bind(this)),this.registerTableFunction("addFilter",this.userAddFilter.bind(this)),this.registerTableFunction("getFilters",this.getFilters.bind(this)),this.registerTableFunction("setHeaderFilterFocus",this.userSetHeaderFilterFocus.bind(this)),this.registerTableFunction("getHeaderFilterValue",this.userGetHeaderFilterValue.bind(this)),this.registerTableFunction("setHeaderFilterValue",this.userSetHeaderFilterValue.bind(this)),this.registerTableFunction("getHeaderFilters",this.getHeaderFilters.bind(this)),this.registerTableFunction("removeFilter",this.userRemoveFilter.bind(this)),this.registerTableFunction("clearFilter",this.userClearFilter.bind(this)),this.registerTableFunction("clearHeaderFilter",this.userClearHeaderFilter.bind(this)),this.registerComponentFunction("column","headerFilterFocus",this.setHeaderFilterFocus.bind(this)),this.registerComponentFunction("column","reloadHeaderFilter",this.reloadHeaderFilter.bind(this)),this.registerComponentFunction("column","getHeaderFilterValue",this.getHeaderFilterValue.bind(this)),this.registerComponentFunction("column","setHeaderFilterValue",this.setHeaderFilterValue.bind(this))}initialize(){this.subscribe("column-init",this.initializeColumnHeaderFilter.bind(this)),this.subscribe("column-width-fit-before",this.hideHeaderFilterElements.bind(this)),this.subscribe("column-width-fit-after",this.showHeaderFilterElements.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.subscribe("placeholder",this.generatePlaceholder.bind(this)),this.table.options.filterMode==="remote"&&this.subscribe("data-params",this.remoteFilterParams.bind(this)),this.registerDataHandler(this.filter.bind(this),10)}tableBuilt(){this.table.options.initialFilter&&this.setFilter(this.table.options.initialFilter),this.table.options.initialHeaderFilter&&this.table.options.initialHeaderFilter.forEach(e=>{var i=this.table.columnManager.findColumn(e.field);if(i)this.setHeaderFilterValue(i,e.value);else return console.warn("Column Filter Error - No matching column found:",e.field),!1}),this.tableInitialized=!0}remoteFilterParams(e,i,n,r){return r.filter=this.getFilters(!0,!0),r}generatePlaceholder(e){if(this.table.options.placeholderHeaderFilter&&Object.keys(this.headerFilters).length)return this.table.options.placeholderHeaderFilter}userSetFilter(e,i,n,r){this.setFilter(e,i,n,r),this.refreshFilter()}userRefreshFilter(){this.refreshFilter()}userAddFilter(e,i,n,r){this.addFilter(e,i,n,r),this.refreshFilter()}userSetHeaderFilterFocus(e){var i=this.table.columnManager.findColumn(e);if(i)this.setHeaderFilterFocus(i);else return console.warn("Column Filter Focus Error - No matching column found:",e),!1}userGetHeaderFilterValue(e){var i=this.table.columnManager.findColumn(e);if(i)return this.getHeaderFilterValue(i);console.warn("Column Filter Error - No matching column found:",e)}userSetHeaderFilterValue(e,i){var n=this.table.columnManager.findColumn(e);if(n)this.setHeaderFilterValue(n,i);else return console.warn("Column Filter Error - No matching column found:",e),!1}userRemoveFilter(e,i,n){this.removeFilter(e,i,n),this.refreshFilter()}userClearFilter(e){this.clearFilter(e),this.refreshFilter()}userClearHeaderFilter(){this.clearHeaderFilter(),this.refreshFilter()}searchRows(e,i,n){return this.search("rows",e,i,n)}searchData(e,i,n){return this.search("data",e,i,n)}initializeColumnHeaderFilter(e){var i=e.definition;i.headerFilter&&this.initializeColumn(e)}initializeColumn(e,i){var n=this,r=e.getField();function o(a){var s=e.modules.filter.tagType=="input"&&e.modules.filter.attrType=="text"||e.modules.filter.tagType=="textarea"?"partial":"match",l="",c="",u;if(typeof e.modules.filter.prevSuccess>"u"||e.modules.filter.prevSuccess!==a){if(e.modules.filter.prevSuccess=a,e.modules.filter.emptyFunc(a))delete n.headerFilters[r];else{switch(e.modules.filter.value=a,typeof e.definition.headerFilterFunc){case"string":Mh.filters[e.definition.headerFilterFunc]?(l=e.definition.headerFilterFunc,u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(a,h,d):p,Mh.filters[e.definition.headerFilterFunc](a,h,d,p)}):console.warn("Header Filter Error - Matching filter function not found: ",e.definition.headerFilterFunc);break;case"function":u=function(d){var p=e.definition.headerFilterFuncParams||{},h=e.getFieldValue(d);return p=typeof p=="function"?p(a,h,d):p,e.definition.headerFilterFunc(a,h,d,p)},l=u;break}if(!u)switch(s){case"partial":u=function(d){var p=e.getFieldValue(d);return typeof p<"u"&&p!==null?String(p).toLowerCase().indexOf(String(a).toLowerCase())>-1:!1},l="like";break;default:u=function(d){return e.getFieldValue(d)==a},l="="}n.headerFilters[r]={value:a,func:u,type:l}}e.modules.filter.value=a,c=JSON.stringify(n.headerFilters),n.prevHeaderFilterChangeCheck!==c&&(n.prevHeaderFilterChangeCheck=c,n.trackChanges(),n.refreshFilter())}return!0}e.modules.filter={success:o,attrType:!1,tagType:!1,emptyFunc:!1},this.generateHeaderFilterElement(e)}generateHeaderFilterElement(e,i,n){var r=this,o=e.modules.filter.success,a=e.getField(),s,l,c,u,d,p,h,f;e.modules.filter.value=i;function m(){}function g(v){f=v}if(e.modules.filter.headerElement&&e.modules.filter.headerElement.parentNode&&e.contentElement.removeChild(e.modules.filter.headerElement.parentNode),a){switch(e.modules.filter.emptyFunc=e.definition.headerFilterEmptyCheck||function(v){return!v&&v!==0},s=document.createElement("div"),s.classList.add("tabulator-header-filter"),typeof e.definition.headerFilter){case"string":r.table.modules.edit.editors[e.definition.headerFilter]?(l=r.table.modules.edit.editors[e.definition.headerFilter],(e.definition.headerFilter==="tick"||e.definition.headerFilter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):console.warn("Filter Error - Cannot build header filter, No such editor found: ",e.definition.editor);break;case"function":l=e.definition.headerFilter;break;case"boolean":e.modules.edit&&e.modules.edit.editor?l=e.modules.edit.editor:e.definition.formatter&&r.table.modules.edit.editors[e.definition.formatter]?(l=r.table.modules.edit.editors[e.definition.formatter],(e.definition.formatter==="tick"||e.definition.formatter==="tickCross")&&!e.definition.headerFilterEmptyCheck&&(e.modules.filter.emptyFunc=function(v){return v!==!0&&v!==!1})):l=r.table.modules.edit.editors.input;break}if(l){if(u={getValue:function(){return typeof i<"u"?i:""},getField:function(){return e.definition.field},getElement:function(){return s},getColumn:function(){return e.getComponent()},getTable:()=>this.table,getType:()=>"header",getRow:function(){return{normalizeHeight:function(){}}}},h=e.definition.headerFilterParams||{},h=typeof h=="function"?h.call(r.table,u):h,c=l.call(this.table.modules.edit,u,g,o,m,h),!c){console.warn("Filter Error - Cannot add filter to "+a+" column, editor returned a value of false");return}if(!(c instanceof Node)){console.warn("Filter Error - Cannot add filter to "+a+" column, editor should return an instance of Node, the editor returned:",c);return}r.langBind("headerFilters|columns|"+e.definition.field,function(v){c.setAttribute("placeholder",typeof v<"u"&&v?v:e.definition.headerFilterPlaceholder||r.langText("headerFilters|default"))}),c.addEventListener("click",function(v){v.stopPropagation(),c.focus()}),c.addEventListener("focus",v=>{var y=this.table.columnManager.contentsElement.scrollLeft,b=this.table.rowManager.element.scrollLeft;y!==b&&(this.table.rowManager.scrollHorizontal(y),this.table.columnManager.scrollHorizontal(y))}),d=!1,p=function(v){d&&clearTimeout(d),d=setTimeout(function(){o(c.value)},r.table.options.headerFilterLiveFilterDelay)},e.modules.filter.headerElement=c,e.modules.filter.attrType=c.hasAttribute("type")?c.getAttribute("type").toLowerCase():"",e.modules.filter.tagType=c.tagName.toLowerCase(),e.definition.headerFilterLiveFilter!==!1&&(e.definition.headerFilter==="autocomplete"||e.definition.headerFilter==="tickCross"||(e.definition.editor==="autocomplete"||e.definition.editor==="tickCross")&&e.definition.headerFilter===!0||(c.addEventListener("keyup",p),c.addEventListener("search",p),e.modules.filter.attrType=="number"&&c.addEventListener("change",function(v){o(c.value)}),e.modules.filter.attrType=="text"&&this.table.browser!=="ie"&&c.setAttribute("type","search")),(e.modules.filter.tagType=="input"||e.modules.filter.tagType=="select"||e.modules.filter.tagType=="textarea")&&c.addEventListener("mousedown",function(v){v.stopPropagation()})),s.appendChild(c),e.contentElement.appendChild(s),n||r.headerFilterColumns.push(e),f&&f()}}else console.warn("Filter Error - Cannot add header filter, column has no field set:",e.definition.title)}hideHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="none")})}showHeaderFilterElements(){this.headerFilterColumns.forEach(function(e){e.modules.filter&&e.modules.filter.headerElement&&(e.modules.filter.headerElement.style.display="")})}setHeaderFilterFocus(e){e.modules.filter&&e.modules.filter.headerElement?e.modules.filter.headerElement.focus():console.warn("Column Filter Focus Error - No header filter set on column:",e.getField())}getHeaderFilterValue(e){if(e.modules.filter&&e.modules.filter.headerElement)return e.modules.filter.value;console.warn("Column Filter Error - No header filter set on column:",e.getField())}setHeaderFilterValue(e,i){e&&(e.modules.filter&&e.modules.filter.headerElement?(this.generateHeaderFilterElement(e,i,!0),e.modules.filter.success(i)):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}reloadHeaderFilter(e){e&&(e.modules.filter&&e.modules.filter.headerElement?this.generateHeaderFilterElement(e,e.modules.filter.value,!0):console.warn("Column Filter Error - No header filter set on column:",e.getField()))}refreshFilter(){this.tableInitialized&&(this.table.options.filterMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0))}trackChanges(){this.changed=!0,this.dispatch("filter-changed")}hasChanged(){var e=this.changed;return this.changed=!1,e}setFilter(e,i,n,r){this.filterList=[],Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),this.addFilter(e)}addFilter(e,i,n,r){var o=!1;Array.isArray(e)||(e=[{field:e,type:i,value:n,params:r}]),e.forEach(a=>{a=this.findFilter(a),a&&(this.filterList.push(a),o=!0)}),o&&this.trackChanges()}findFilter(e){var i;if(Array.isArray(e))return this.findSubFilters(e);var n=!1;return typeof e.field=="function"?n=function(r){return e.field(r,e.type||{})}:Mh.filters[e.type]?(i=this.table.columnManager.getColumnByField(e.field),i?n=function(r){return Mh.filters[e.type](e.value,i.getFieldValue(r),r,e.params||{})}:n=function(r){return Mh.filters[e.type](e.value,r[e.field],r,e.params||{})}):console.warn("Filter Error - No such filter type found, ignoring: ",e.type),e.func=n,e.func?e:!1}findSubFilters(e){var i=[];return e.forEach(n=>{n=this.findFilter(n),n&&i.push(n)}),i.length?i:!1}getFilters(e,i){var n=[];return e&&(n=this.getHeaderFilters()),i&&n.forEach(function(r){typeof r.type=="function"&&(r.type="function")}),n=n.concat(this.filtersToArray(this.filterList,i)),n}filtersToArray(e,i){var n=[];return e.forEach(r=>{var o;Array.isArray(r)?n.push(this.filtersToArray(r,i)):(o={field:r.field,type:r.type,value:r.value},i&&typeof o.type=="function"&&(o.type="function"),n.push(o))}),n}getHeaderFilters(){var e=[];for(var i in this.headerFilters)e.push({field:i,type:this.headerFilters[i].type,value:this.headerFilters[i].value});return e}removeFilter(e,i,n){Array.isArray(e)||(e=[{field:e,type:i,value:n}]),e.forEach(r=>{var o=-1;typeof r.field=="object"?o=this.filterList.findIndex(a=>r===a):o=this.filterList.findIndex(a=>r.field===a.field&&r.type===a.type&&r.value===a.value),o>-1?this.filterList.splice(o,1):console.warn("Filter Error - No matching filter type found, ignoring: ",r.type)}),this.trackChanges()}clearFilter(e){this.filterList=[],e&&this.clearHeaderFilter(),this.trackChanges()}clearHeaderFilter(){this.headerFilters={},this.prevHeaderFilterChangeCheck="{}",this.headerFilterColumns.forEach(e=>{typeof e.modules.filter.value<"u"&&delete e.modules.filter.value,e.modules.filter.prevSuccess=void 0,this.reloadHeaderFilter(e)}),this.trackChanges()}search(e,i,n,r){var o=[],a=[];return Array.isArray(i)||(i=[{field:i,type:n,value:r}]),i.forEach(s=>{s=this.findFilter(s),s&&a.push(s)}),this.table.rowManager.rows.forEach(s=>{var l=!0;a.forEach(c=>{this.filterRecurse(c,s.getData())||(l=!1)}),l&&o.push(e==="data"?s.getData("data"):s.getComponent())}),o}filter(e,i){var n=[],r=[];return this.subscribedExternal("dataFiltering")&&this.dispatchExternal("dataFiltering",this.getFilters(!0)),this.table.options.filterMode!=="remote"&&(this.filterList.length||Object.keys(this.headerFilters).length)?e.forEach(o=>{this.filterRow(o)&&n.push(o)}):n=e.slice(0),this.subscribedExternal("dataFiltered")&&(n.forEach(o=>{r.push(o.getComponent())}),this.dispatchExternal("dataFiltered",this.getFilters(!0),r)),n}filterRow(e,i){var n=!0,r=e.getData();this.filterList.forEach(a=>{this.filterRecurse(a,r)||(n=!1)});for(var o in this.headerFilters)this.headerFilters[o].func(r)||(n=!1);return n}filterRecurse(e,i){var n=!1;return Array.isArray(e)?e.forEach(r=>{this.filterRecurse(r,i)&&(n=!0)}):n=e.func(i),n}}Mh.moduleName="filter";Mh.filters=Ije;function wje(t,e,i){return this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Sje(t,e,i){return t.getValue()}function Tje(t,e,i){return t.getElement().style.whiteSpace="pre-wrap",this.emptyToSpace(this.sanitizeHTML(t.getValue()))}function Uje(t,e,i){var n=parseFloat(t.getValue()),r="",o,a,s,l,c,u=e.decimal||".",d=e.thousand||",",p=e.negativeSign||"-",h=e.symbol||"",f=!!e.symbolAfter,m=typeof e.precision<"u"?e.precision:2;if(isNaN(n))return this.emptyToSpace(this.sanitizeHTML(t.getValue()));if(n<0&&(n=Math.abs(n),r=p),o=m!==!1?n.toFixed(m):n,o=String(o).split("."),a=o[0],s=o.length>1?u+o[1]:"",e.thousand!==!1)for(l=/(\d+)(\d{3})/;l.test(a);)a=a.replace(l,"$1"+d+"$2");return c=a+s,r===!0?(c="("+c+")",f?c+h:h+c):f?r+c+h:r+h+c}function Dje(t,e,i){var n=t.getValue(),r=e.urlPrefix||"",o=e.download,a=n,s=document.createElement("a"),l;function c(u,d){var p=u.shift(),h=d[p];return u.length&&typeof h=="object"?c(u,h):h}if(e.labelField&&(l=t.getData(),a=c(e.labelField.split(this.table.options.nestedFieldSeparator),l)),e.label)switch(typeof e.label){case"string":a=e.label;break;case"function":a=e.label(t);break}if(a){if(e.urlField&&(l=t.getData(),n=Jr.retrieveNestedData(this.table.options.nestedFieldSeparator,e.urlField,l)),e.url)switch(typeof e.url){case"string":n=e.url;break;case"function":n=e.url(t);break}return s.setAttribute("href",r+n),e.target&&s.setAttribute("target",e.target),e.download&&(typeof o=="function"?o=o(t):o=o===!0?"":o,s.setAttribute("download",o)),s.innerHTML=this.emptyToSpace(this.sanitizeHTML(a)),s}else return"&nbsp;"}function Pje(t,e,i){var n=document.createElement("img"),r=t.getValue();switch(e.urlPrefix&&(r=e.urlPrefix+t.getValue()),e.urlSuffix&&(r=r+e.urlSuffix),n.setAttribute("src",r),typeof e.height){case"number":n.style.height=e.height+"px";break;case"string":n.style.height=e.height;break}switch(typeof e.width){case"number":n.style.width=e.width+"px";break;case"string":n.style.width=e.width;break}return n.addEventListener("load",function(){t.getRow().normalizeHeight()}),n}function Cje(t,e,i){var n=t.getValue(),r=t.getElement(),o=e.allowEmpty,a=e.allowTruthy,s=Object.keys(e).includes("trueValue"),l=typeof e.tickElement<"u"?e.tickElement:'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>',c=typeof e.crossElement<"u"?e.crossElement:'<svg enable-background="new 0 0 24 24" height="14" width="14"  viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>';return s&&n===e.trueValue||!s&&(a&&n||n===!0||n==="true"||n==="True"||n===1||n==="1")?(r.setAttribute("aria-checked",!0),l||""):o&&(n==="null"||n===""||n===null||typeof n>"u")?(r.setAttribute("aria-checked","mixed"),""):(r.setAttribute("aria-checked",!1),c||"")}function Eje(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",o=e.outputFormat||"dd/MM/yyyy HH:mm:ss",a=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",s=t.getValue();if(typeof n<"u"){var l;return n.isDateTime(s)?l=s:r==="iso"?l=n.fromISO(String(s)):l=n.fromFormat(String(s),r),l.isValid?(e.timezone&&(l=l.setZone(e.timezone)),l.toFormat(o)):a===!0||!s?s:typeof a=="function"?a(s):a}else console.error("Format Error - 'datetime' formatter is dependant on luxon.js")}function Mje(t,e,i){var n=window.DateTime||luxon.DateTime,r=e.inputFormat||"yyyy-MM-dd HH:mm:ss",o=typeof e.invalidPlaceholder<"u"?e.invalidPlaceholder:"",a=typeof e.suffix<"u"?e.suffix:!1,s=typeof e.unit<"u"?e.unit:"days",l=typeof e.humanize<"u"?e.humanize:!1,c=typeof e.date<"u"?e.date:n.now(),u=t.getValue();if(typeof n<"u"){var d;return n.isDateTime(u)?d=u:r==="iso"?d=n.fromISO(String(u)):d=n.fromFormat(String(u),r),d.isValid?l?d.diff(c,s).toHuman()+(a?" "+a:""):parseInt(d.diff(c,s)[s])+(a?" "+a:""):o===!0?u:typeof o=="function"?o(u):o}else console.error("Format Error - 'datetimediff' formatter is dependant on luxon.js")}function Rje(t,e,i){var n=t.getValue();return typeof e[n]>"u"?(console.warn("Missing display value for "+n),n):e[n]}function Nje(t,e,i){var n=t.getValue(),r=t.getElement(),o=e&&e.stars?e.stars:5,a=document.createElement("span"),s=document.createElementNS("http://www.w3.org/2000/svg","svg"),l='<polygon fill="#FFEA00" stroke="#C1AB60" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>',c='<polygon fill="#D2D2D2" stroke="#686868" stroke-width="37.6152" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" points="259.216,29.942 330.27,173.919 489.16,197.007 374.185,309.08 401.33,467.31 259.216,392.612 117.104,467.31 144.25,309.08 29.274,197.007 188.165,173.919 "/>';a.style.verticalAlign="middle",s.setAttribute("width","14"),s.setAttribute("height","14"),s.setAttribute("viewBox","0 0 512 512"),s.setAttribute("xml:space","preserve"),s.style.padding="0 1px",n=n&&!isNaN(n)?parseInt(n):0,n=Math.max(0,Math.min(n,o));for(var u=1;u<=o;u++){var d=s.cloneNode(!0);d.innerHTML=u<=n?l:c,a.appendChild(d)}return r.style.whiteSpace="nowrap",r.style.overflow="hidden",r.style.textOverflow="ellipsis",r.setAttribute("aria-label",n),a}function Aje(t,e,i){var n=this.sanitizeHTML(t.getValue())||0,r=document.createElement("span"),o=e&&e.max?e.max:100,a=e&&e.min?e.min:0,s=e&&typeof e.color<"u"?e.color:["red","orange","green"],l="#666666",c,u;if(!(isNaN(n)||typeof t.getValue()>"u")){switch(r.classList.add("tabulator-traffic-light"),u=parseFloat(n)<=o?parseFloat(n):o,u=parseFloat(u)>=a?parseFloat(u):a,c=(o-a)/100,u=Math.round((u-a)/c),typeof s){case"string":l=s;break;case"function":l=s(n);break;case"object":if(Array.isArray(s)){var d=100/s.length,p=Math.floor(u/d);p=Math.min(p,s.length-1),p=Math.max(p,0),l=s[p];break}}return r.style.backgroundColor=l,r}}function _je(t,e={},i){var n=this.sanitizeHTML(t.getValue())||0,r=t.getElement(),o=e.max?e.max:100,a=e.min?e.min:0,s=e.legendAlign?e.legendAlign:"center",l,c,u,d,p;switch(c=parseFloat(n)<=o?parseFloat(n):o,c=parseFloat(c)>=a?parseFloat(c):a,l=(o-a)/100,c=Math.round((c-a)/l),typeof e.color){case"string":u=e.color;break;case"function":u=e.color(n);break;case"object":if(Array.isArray(e.color)){let g=100/e.color.length,v=Math.floor(c/g);v=Math.min(v,e.color.length-1),v=Math.max(v,0),u=e.color[v];break}default:u="#2DC214"}switch(typeof e.legend){case"string":d=e.legend;break;case"function":d=e.legend(n);break;case"boolean":d=n;break;default:d=!1}switch(typeof e.legendColor){case"string":p=e.legendColor;break;case"function":p=e.legendColor(n);break;case"object":if(Array.isArray(e.legendColor)){let g=100/e.legendColor.length,v=Math.floor(c/g);v=Math.min(v,e.legendColor.length-1),v=Math.max(v,0),p=e.legendColor[v]}break;default:p="#000"}r.style.minWidth="30px",r.style.position="relative",r.setAttribute("aria-label",c);var h=document.createElement("div");h.style.display="inline-block",h.style.width=c+"%",h.style.backgroundColor=u,h.style.height="100%",h.setAttribute("data-max",o),h.setAttribute("data-min",a);var f=document.createElement("div");if(f.style.position="relative",f.style.width="100%",f.style.height="100%",d){var m=document.createElement("div");m.style.position="absolute",m.style.top=0,m.style.left=0,m.style.textAlign=s,m.style.width="100%",m.style.color=p,m.innerHTML=d}return i(function(){if(!(t instanceof fve)){var g=document.createElement("div");g.style.position="absolute",g.style.top="4px",g.style.bottom="4px",g.style.left="4px",g.style.right="4px",r.appendChild(g),r=g}r.appendChild(f),f.appendChild(h),d&&f.appendChild(m)}),""}function kje(t,e,i){return t.getElement().style.backgroundColor=this.sanitizeHTML(t.getValue()),""}function xje(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#2DC214" clip-rule="evenodd" d="M21.652,3.211c-0.293-0.295-0.77-0.295-1.061,0L9.41,14.34  c-0.293,0.297-0.771,0.297-1.062,0L3.449,9.351C3.304,9.203,3.114,9.13,2.923,9.129C2.73,9.128,2.534,9.201,2.387,9.351  l-2.165,1.946C0.078,11.445,0,11.63,0,11.823c0,0.194,0.078,0.397,0.223,0.544l4.94,5.184c0.292,0.296,0.771,0.776,1.062,1.07  l2.124,2.141c0.292,0.293,0.769,0.293,1.062,0l14.366-14.34c0.293-0.294,0.293-0.777,0-1.071L21.652,3.211z" fill-rule="evenodd"/></svg>'}function Oje(t,e,i){return'<svg enable-background="new 0 0 24 24" height="14" width="14" viewBox="0 0 24 24" xml:space="preserve" ><path fill="#CE1515" d="M22.245,4.015c0.313,0.313,0.313,0.826,0,1.139l-6.276,6.27c-0.313,0.312-0.313,0.826,0,1.14l6.273,6.272  c0.313,0.313,0.313,0.826,0,1.14l-2.285,2.277c-0.314,0.312-0.828,0.312-1.142,0l-6.271-6.271c-0.313-0.313-0.828-0.313-1.141,0  l-6.276,6.267c-0.313,0.313-0.828,0.313-1.141,0l-2.282-2.28c-0.313-0.313-0.313-0.826,0-1.14l6.278-6.269  c0.313-0.312,0.313-0.826,0-1.14L1.709,5.147c-0.314-0.313-0.314-0.827,0-1.14l2.284-2.278C4.308,1.417,4.821,1.417,5.135,1.73  L11.405,8c0.314,0.314,0.828,0.314,1.141,0.001l6.276-6.267c0.312-0.312,0.826-0.312,1.141,0L22.245,4.015z"/></svg>'}function Lje(t,e,i){var n=document.createElement("span"),r=t.getRow(),o=t.getTable();return r.watchPosition(a=>{e.relativeToPage&&(a+=o.modules.page.getPageSize()*(o.modules.page.getPage()-1)),n.innerText=a}),n}function Fje(t,e,i){return t.getElement().classList.add("tabulator-row-handle"),"<div class='tabulator-row-handle-box'><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div><div class='tabulator-row-handle-bar'></div></div>"}function Bje(t,e,i){var n=document.createElement("div"),r=t.getRow()._row.modules.responsiveLayout;n.classList.add("tabulator-responsive-collapse-toggle"),n.innerHTML=`<svg class='tabulator-responsive-collapse-toggle-open' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12" fill="none" stroke-width="3" stroke-linecap="round" />
  <line y1="7" x1="12" y2="17" x2="12" fill="none" stroke-width="3" stroke-linecap="round" />
</svg>

<svg class='tabulator-responsive-collapse-toggle-close' viewbox="0 0 24 24">
  <line x1="7" y1="12" x2="17" y2="12"  fill="none" stroke-width="3" stroke-linecap="round" />
</svg>`,t.getElement().classList.add("tabulator-row-handle");function o(a){var s=r.element;r.open=a,s&&(r.open?(n.classList.add("open"),s.style.display=""):(n.classList.remove("open"),s.style.display="none"))}return n.addEventListener("click",function(a){a.stopImmediatePropagation(),o(!r.open),t.getTable().rowManager.adjustTableSize()}),o(r.open),n}function $je(t,e,i){var n=document.createElement("input"),r=!1;if(n.type="checkbox",n.setAttribute("aria-label","Select Row"),this.table.modExists("selectRow",!0))if(n.addEventListener("click",a=>{a.stopPropagation()}),typeof t.getRow=="function"){var o=t.getRow();o instanceof Lx?(n.addEventListener("change",a=>{this.table.options.selectableRowsRangeMode==="click"&&r?r=!1:o.toggleSelect()}),this.table.options.selectableRowsRangeMode==="click"&&n.addEventListener("click",a=>{r=!0,this.table.modules.selectRow.handleComplexRowClick(o._row,a)}),n.checked=o.isSelected&&o.isSelected(),this.table.modules.selectRow.registerRowSelectCheckbox(o,n)):n=""}else n.addEventListener("change",a=>{this.table.modules.selectRow.selectedRows.length?this.table.deselectRow():this.table.selectRow(e.rowRange)}),this.table.modules.selectRow.registerHeaderSelectCheckbox(n);return n}var Vje={plaintext:wje,html:Sje,textarea:Tje,money:Uje,link:Dje,image:Pje,tickCross:Cje,datetime:Eje,datetimediff:Mje,lookup:Rje,star:Nje,traffic:Aje,progress:_je,color:kje,buttonTick:xje,buttonCross:Oje,rownum:Lje,handle:Fje,responsiveCollapse:Bje,rowSelection:$je};class nu extends dn{constructor(e){super(e),this.registerColumnOption("formatter"),this.registerColumnOption("formatterParams"),this.registerColumnOption("formatterPrint"),this.registerColumnOption("formatterPrintParams"),this.registerColumnOption("formatterClipboard"),this.registerColumnOption("formatterClipboardParams"),this.registerColumnOption("formatterHtmlOutput"),this.registerColumnOption("formatterHtmlOutputParams"),this.registerColumnOption("titleFormatter"),this.registerColumnOption("titleFormatterParams")}initialize(){this.subscribe("cell-format",this.formatValue.bind(this)),this.subscribe("cell-rendered",this.cellRendered.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-format",this.formatHeader.bind(this))}initializeColumn(e){e.modules.format=this.lookupFormatter(e,""),typeof e.definition.formatterPrint<"u"&&(e.modules.format.print=this.lookupFormatter(e,"Print")),typeof e.definition.formatterClipboard<"u"&&(e.modules.format.clipboard=this.lookupFormatter(e,"Clipboard")),typeof e.definition.formatterHtmlOutput<"u"&&(e.modules.format.htmlOutput=this.lookupFormatter(e,"HtmlOutput"))}lookupFormatter(e,i){var n={params:e.definition["formatter"+i+"Params"]||{}},r=e.definition["formatter"+i];switch(typeof r){case"string":nu.formatters[r]?n.formatter=nu.formatters[r]:(console.warn("Formatter Error - No such formatter found: ",r),n.formatter=nu.formatters.plaintext);break;case"function":n.formatter=r;break;default:n.formatter=nu.formatters.plaintext;break}return n}cellRendered(e){e.modules.format&&e.modules.format.renderedCallback&&!e.modules.format.rendered&&(e.modules.format.renderedCallback(),e.modules.format.rendered=!0)}formatHeader(e,i,n){var r,o,a,s;return e.definition.titleFormatter?(r=this.getFormatter(e.definition.titleFormatter),a=l=>{e.titleFormatterRendered=l},s={getValue:function(){return i},getElement:function(){return n},getType:function(){return"header"},getColumn:function(){return e.getComponent()},getTable:()=>this.table},o=e.definition.titleFormatterParams||{},o=typeof o=="function"?o():o,r.call(this,s,o,a)):i}formatValue(e){var i=e.getComponent(),n=typeof e.column.modules.format.params=="function"?e.column.modules.format.params(i):e.column.modules.format.params;function r(o){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=o,e.modules.format.rendered=!1}return e.column.modules.format.formatter.call(this,i,n,r)}formatExportValue(e,i){var n=e.column.modules.format[i],r;if(n){let o=function(a){e.modules.format||(e.modules.format={}),e.modules.format.renderedCallback=a,e.modules.format.rendered=!1};return r=typeof n.params=="function"?n.params(e.getComponent()):n.params,n.formatter.call(this,e.getComponent(),r,o)}else return this.formatValue(e)}sanitizeHTML(e){if(e){var i={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};return String(e).replace(/[&<>"'`=/]/g,function(n){return i[n]})}else return e}emptyToSpace(e){return e===null||typeof e>"u"||e===""?"&nbsp;":e}getFormatter(e){switch(typeof e){case"string":nu.formatters[e]?e=nu.formatters[e]:(console.warn("Formatter Error - No such formatter found: ",e),e=nu.formatters.plaintext);break;case"function":break;default:e=nu.formatters.plaintext;break}return e}}nu.moduleName="format";nu.formatters=Vje;class bve extends dn{constructor(e){super(e),this.leftColumns=[],this.rightColumns=[],this.initializationMode="left",this.active=!1,this.blocked=!0,this.registerColumnOption("frozen")}reset(){this.initializationMode="left",this.leftColumns=[],this.rightColumns=[],this.active=!1}initialize(){this.subscribe("cell-layout",this.layoutCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-width",this.layout.bind(this)),this.subscribe("row-layout-after",this.layoutRow.bind(this)),this.subscribe("table-layout",this.layout.bind(this)),this.subscribe("columns-loading",this.reset.bind(this)),this.subscribe("column-add",this.reinitializeColumns.bind(this)),this.subscribe("column-deleted",this.reinitializeColumns.bind(this)),this.subscribe("column-hide",this.reinitializeColumns.bind(this)),this.subscribe("column-show",this.reinitializeColumns.bind(this)),this.subscribe("columns-loaded",this.reinitializeColumns.bind(this)),this.subscribe("table-redraw",this.layout.bind(this)),this.subscribe("layout-refreshing",this.blockLayout.bind(this)),this.subscribe("layout-refreshed",this.unblockLayout.bind(this)),this.subscribe("scrollbar-vertical",this.adjustForScrollbar.bind(this))}blockLayout(){this.blocked=!0}unblockLayout(){this.blocked=!1}layoutCell(e){this.layoutElement(e.element,e.column)}reinitializeColumns(){this.reset(),this.table.columnManager.columnsByIndex.forEach(e=>{this.initializeColumn(e)}),this.layout()}initializeColumn(e){var i={margin:0,edge:!1};e.isGroup||(this.frozenCheck(e)?(i.position=this.initializationMode,this.initializationMode=="left"?this.leftColumns.push(e):this.rightColumns.unshift(e),this.active=!0,e.modules.frozen=i):this.initializationMode="right")}frozenCheck(e){return e.parent.isGroup&&e.definition.frozen&&console.warn("Frozen Column Error - Parent column group must be frozen, not individual columns or sub column groups"),e.parent.isGroup?this.frozenCheck(e.parent):e.definition.frozen}layoutCalcRows(){this.table.modExists("columnCalcs")&&(this.table.modules.columnCalcs.topInitialized&&this.table.modules.columnCalcs.topRow&&this.layoutRow(this.table.modules.columnCalcs.topRow),this.table.modules.columnCalcs.botInitialized&&this.table.modules.columnCalcs.botRow&&this.layoutRow(this.table.modules.columnCalcs.botRow),this.table.modExists("groupRows")&&this.layoutGroupCalcs(this.table.modules.groupRows.getGroups()))}layoutGroupCalcs(e){e.forEach(i=>{i.calcs.top&&this.layoutRow(i.calcs.top),i.calcs.bottom&&this.layoutRow(i.calcs.bottom),i.groupList&&i.groupList.length&&this.layoutGroupCalcs(i.groupList)})}layoutColumnPosition(e){var i=[],n=0,r=0;this.leftColumns.forEach((o,a)=>{if(o.modules.frozen.marginValue=n,o.modules.frozen.margin=o.modules.frozen.marginValue+"px",o.visible&&(n+=o.getWidth()),a==this.leftColumns.length-1?o.modules.frozen.edge=!0:o.modules.frozen.edge=!1,o.parent.isGroup){var s=this.getColGroupParentElement(o);i.includes(s)||(this.layoutElement(s,o),i.push(s)),s.classList.toggle("tabulator-frozen-left",o.modules.frozen.edge&&o.modules.frozen.position==="left"),s.classList.toggle("tabulator-frozen-right",o.modules.frozen.edge&&o.modules.frozen.position==="right")}else this.layoutElement(o.getElement(),o);e&&o.cells.forEach(l=>{this.layoutElement(l.getElement(!0),o)})}),this.rightColumns.forEach((o,a)=>{o.modules.frozen.marginValue=r,o.modules.frozen.margin=o.modules.frozen.marginValue+"px",o.visible&&(r+=o.getWidth()),a==this.rightColumns.length-1?o.modules.frozen.edge=!0:o.modules.frozen.edge=!1,o.parent.isGroup?this.layoutElement(this.getColGroupParentElement(o),o):this.layoutElement(o.getElement(),o),e&&o.cells.forEach(s=>{this.layoutElement(s.getElement(!0),o)})})}getColGroupParentElement(e){return e.parent.isGroup?this.getColGroupParentElement(e.parent):e.getElement()}layout(){this.active&&!this.blocked&&(this.layoutColumnPosition(),this.reinitializeRows(),this.layoutCalcRows())}reinitializeRows(){var e=this.table.rowManager.getVisibleRows(!0),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));i.forEach(n=>{n.deinitialize()}),e.forEach(n=>{n.type==="row"&&this.layoutRow(n)})}layoutRow(e){this.table.options.layout==="fitDataFill"&&this.rightColumns.length&&(this.table.rowManager.getTableElement().style.minWidth="calc(100% - "+this.rightMargin+")"),this.leftColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)}),this.rightColumns.forEach(i=>{var n=e.getCell(i);n&&this.layoutElement(n.getElement(!0),i)})}layoutElement(e,i){var n;i.modules.frozen&&e&&(e.style.position="sticky",this.table.rtl?n=i.modules.frozen.position==="left"?"right":"left":n=i.modules.frozen.position,e.style[n]=i.modules.frozen.margin,e.classList.add("tabulator-frozen"),e.classList.toggle("tabulator-frozen-left",i.modules.frozen.edge&&i.modules.frozen.position==="left"),e.classList.toggle("tabulator-frozen-right",i.modules.frozen.edge&&i.modules.frozen.position==="right"))}adjustForScrollbar(e){this.rightColumns.length&&(this.table.columnManager.getContentsElement().style.width="calc(100% - "+e+"px)")}_calcSpace(e,i){var n=0;for(let r=0;r<i;r++)e[r].visible&&(n+=e[r].getWidth());return n}}bve.moduleName="frozenColumns";class Ive extends dn{constructor(e){super(e),this.topElement=document.createElement("div"),this.rows=[],this.registerComponentFunction("row","freeze",this.freezeRow.bind(this)),this.registerComponentFunction("row","unfreeze",this.unfreezeRow.bind(this)),this.registerComponentFunction("row","isFrozen",this.isRowFrozen.bind(this)),this.registerTableOption("frozenRowsField","id"),this.registerTableOption("frozenRows",!1)}initialize(){var e=document.createDocumentFragment();this.rows=[],this.topElement.classList.add("tabulator-frozen-rows-holder"),e.appendChild(document.createElement("br")),e.appendChild(this.topElement),this.table.columnManager.getContentsElement().insertBefore(e,this.table.columnManager.headersElement.nextSibling),this.subscribe("row-deleting",this.detachRow.bind(this)),this.subscribe("rows-visible",this.visibleRows.bind(this)),this.registerDisplayHandler(this.getRows.bind(this),10),this.table.options.frozenRows&&(this.subscribe("data-processed",this.initializeRows.bind(this)),this.subscribe("row-added",this.initializeRow.bind(this)),this.subscribe("table-redrawing",this.resizeHolderWidth.bind(this)),this.subscribe("column-resized",this.resizeHolderWidth.bind(this)),this.subscribe("column-show",this.resizeHolderWidth.bind(this)),this.subscribe("column-hide",this.resizeHolderWidth.bind(this))),this.resizeHolderWidth()}resizeHolderWidth(){this.topElement.style.minWidth=this.table.columnManager.headersElement.offsetWidth+"px"}initializeRows(){this.table.rowManager.getRows().forEach(e=>{this.initializeRow(e)})}initializeRow(e){var i=this.table.options.frozenRows,n=typeof i;n==="number"?e.getPosition()&&e.getPosition()+this.rows.length<=i&&this.freezeRow(e):n==="function"?i.call(this.table,e.getComponent())&&this.freezeRow(e):Array.isArray(i)&&i.includes(e.data[this.options("frozenRowsField")])&&this.freezeRow(e)}isRowFrozen(e){var i=this.rows.indexOf(e);return i>-1}isFrozen(){return!!this.rows.length}visibleRows(e,i){return this.rows.forEach(n=>{i.push(n)}),i}getRows(e){var i=e.slice(0);return this.rows.forEach(function(n){var r=i.indexOf(n);r>-1&&i.splice(r,1)}),i}freezeRow(e){e.modules.frozen?console.warn("Freeze Error - Row is already frozen"):(e.modules.frozen=!0,this.topElement.appendChild(e.getElement()),e.initialize(),e.normalizeHeight(),this.rows.push(e),this.refreshData(!1,"display"),this.table.rowManager.adjustTableSize(),this.styleRows())}unfreezeRow(e){e.modules.frozen?(e.modules.frozen=!1,this.detachRow(e),this.table.rowManager.adjustTableSize(),this.refreshData(!1,"display"),this.rows.length&&this.styleRows()):console.warn("Freeze Error - Row is already unfrozen")}detachRow(e){var i=this.rows.indexOf(e);if(i>-1){var n=e.getElement();n.parentNode&&n.parentNode.removeChild(n),this.rows.splice(i,1)}}styleRows(e){this.rows.forEach((i,n)=>{this.table.rowManager.styleRow(i,n)})}}Ive.moduleName="frozenRows";class jje{constructor(e){return this._group=e,this.type="GroupComponent",new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._group.groupManager.table.componentFunctionBinder.handle("group",i._group,n)}})}getKey(){return this._group.key}getField(){return this._group.field}getElement(){return this._group.element}getRows(){return this._group.getRows(!0)}getSubGroups(){return this._group.getSubGroups(!0)}getParentGroup(){return this._group.parent?this._group.parent.getComponent():!1}isVisible(){return this._group.visible}show(){this._group.show()}hide(){this._group.hide()}toggle(){this._group.toggleVisibility()}scrollTo(e,i){return this._group.groupManager.table.rowManager.scrollToRow(this._group,e,i)}_getSelf(){return this._group}getTable(){return this._group.groupManager.table}}class pI{constructor(e,i,n,r,o,a,s){this.groupManager=e,this.parent=i,this.key=r,this.level=n,this.field=o,this.hasSubGroups=n<e.groupIDLookups.length-1,this.addRow=this.hasSubGroups?this._addRowToGroup:this._addRow,this.type="group",this.old=s,this.rows=[],this.groups=[],this.groupList=[],this.generator=a,this.element=!1,this.elementContents=!1,this.height=0,this.outerHeight=0,this.initialized=!1,this.calcs={},this.initialized=!1,this.modules={},this.arrowElement=!1,this.visible=s?s.visible:typeof e.startOpen[n]<"u"?e.startOpen[n]:e.startOpen[0],this.component=null,this.createElements(),this.addBindings(),this.createValueGroups()}wipe(e){e||(this.groupList.length?this.groupList.forEach(function(i){i.wipe()}):this.rows.forEach(i=>{i.modules&&delete i.modules.group})),this.element=!1,this.arrowElement=!1,this.elementContents=!1}createElements(){var e=document.createElement("div");e.classList.add("tabulator-arrow"),this.element=document.createElement("div"),this.element.classList.add("tabulator-row"),this.element.classList.add("tabulator-group"),this.element.classList.add("tabulator-group-level-"+this.level),this.element.setAttribute("role","rowgroup"),this.arrowElement=document.createElement("div"),this.arrowElement.classList.add("tabulator-group-toggle"),this.arrowElement.appendChild(e),this.groupManager.table.options.movableRows!==!1&&this.groupManager.table.modExists("moveRow")&&this.groupManager.table.modules.moveRow.initializeGroupHeader(this)}createValueGroups(){var e=this.level+1;this.groupManager.allowedValues&&this.groupManager.allowedValues[e]&&this.groupManager.allowedValues[e].forEach(i=>{this._createGroup(i,e)})}addBindings(){var e;this.groupManager.table.options.groupToggleElement&&(e=this.groupManager.table.options.groupToggleElement=="arrow"?this.arrowElement:this.element,e.addEventListener("click",i=>{this.groupManager.table.options.groupToggleElement==="arrow"&&(i.stopPropagation(),i.stopImmediatePropagation()),setTimeout(()=>{this.toggleVisibility()})}))}_createGroup(e,i){var n=i+"_"+e,r=new pI(this.groupManager,this,i,e,this.groupManager.groupIDLookups[i].field,this.groupManager.headerGenerator[i]||this.groupManager.headerGenerator[0],this.old?this.old.groups[n]:!1);this.groups[n]=r,this.groupList.push(r)}_addRowToGroup(e){var i=this.level+1;if(this.hasSubGroups){var n=this.groupManager.groupIDLookups[i].func(e.getData()),r=i+"_"+n;this.groupManager.allowedValues&&this.groupManager.allowedValues[i]?this.groups[r]&&this.groups[r].addRow(e):(this.groups[r]||this._createGroup(n,i),this.groups[r].addRow(e))}}_addRow(e){this.rows.push(e),e.modules.group=this}insertRow(e,i,n){var r=this.conformRowData({});e.updateData(r);var o=this.rows.indexOf(i);o>-1?n?this.rows.splice(o+1,0,e):this.rows.splice(o,0,e):n?this.rows.push(e):this.rows.unshift(e),e.modules.group=this,this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this),this.groupManager.updateGroupRows(!0)}scrollHeader(e){this.arrowElement&&(this.arrowElement.style.marginLeft=e,this.groupList.forEach(function(i){i.scrollHeader(e)}))}getRowIndex(e){}conformRowData(e){return this.field?e[this.field]=this.key:console.warn("Data Conforming Error - Cannot conform row data to match new group as groupBy is a function"),this.parent&&(e=this.parent.conformRowData(e)),e}removeRow(e){var i=this.rows.indexOf(e),n=e.getElement();i>-1&&this.rows.splice(i,1),!this.groupManager.table.options.groupValues&&!this.rows.length?(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this),this.groupManager.updateGroupRows(!0)):(n.parentNode&&n.parentNode.removeChild(n),this.groupManager.blockRedraw||(this.generateGroupHeaderContents(),this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modules.columnCalcs.recalcGroup(this)))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1),this.groupList.length||(this.parent?this.parent.removeGroup(this):this.groupManager.removeGroup(this)))}getHeadersAndRows(){var e=[];return e.push(this),this._visSet(),this.calcs.top&&(this.calcs.top.detachElement(),this.calcs.top.deleteCells()),this.calcs.bottom&&(this.calcs.bottom.detachElement(),this.calcs.bottom.deleteCells()),this.visible?this.groupList.length?this.groupList.forEach(function(i){e=e.concat(i.getHeadersAndRows())}):(this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),e=e.concat(this.rows),this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))):!this.groupList.length&&this.groupManager.table.options.columnCalcs!="table"&&this.groupManager.table.modExists("columnCalcs")&&(this.groupManager.table.modules.columnCalcs.hasTopCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.top=this.groupManager.table.modules.columnCalcs.generateTopRow(this.rows),e.push(this.calcs.top)),this.groupManager.table.modules.columnCalcs.hasBottomCalcs()&&this.groupManager.table.options.groupClosedShowCalcs&&(this.calcs.bottom=this.groupManager.table.modules.columnCalcs.generateBottomRow(this.rows),e.push(this.calcs.bottom))),e}getData(e,i){var n=[];return this._visSet(),(!e||e&&this.visible)&&this.rows.forEach(r=>{n.push(r.getData(i||"data"))}),n}getRowCount(){var e=0;return this.groupList.length?this.groupList.forEach(i=>{e+=i.getRowCount()}):e=this.rows.length,e}toggleVisibility(){this.visible?this.hide():this.show()}hide(){this.visible=!1,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination?(this.element.classList.remove("tabulator-group-visible"),this.groupList.length?this.groupList.forEach(e=>{var i=e.getHeadersAndRows();i.forEach(n=>{n.detachElement()})}):this.rows.forEach(e=>{var i=e.getElement();i.parentNode.removeChild(i)}),this.groupManager.updateGroupRows(!0)):this.groupManager.updateGroupRows(!0),this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!1)}show(){if(this.visible=!0,this.groupManager.table.rowManager.getRenderMode()=="basic"&&!this.groupManager.table.options.pagination){this.element.classList.add("tabulator-group-visible");var e=this.generateElement();this.groupList.length?this.groupList.forEach(i=>{var n=i.getHeadersAndRows();n.forEach(r=>{var o=r.getElement();e.parentNode.insertBefore(o,e.nextSibling),r.initialize(),e=o})}):this.rows.forEach(i=>{var n=i.getElement();e.parentNode.insertBefore(n,e.nextSibling),i.initialize(),e=n}),this.groupManager.updateGroupRows(!0)}else this.groupManager.updateGroupRows(!0);this.groupManager.table.externalEvents.dispatch("groupVisibilityChanged",this.getComponent(),!0)}_visSet(){var e=[];typeof this.visible=="function"&&(this.rows.forEach(function(i){e.push(i.getData())}),this.visible=this.visible(this.key,this.getRowCount(),e,this.getComponent()))}getRowGroup(e){var i=!1;return this.groupList.length?this.groupList.forEach(function(n){var r=n.getRowGroup(e);r&&(i=r)}):this.rows.find(function(n){return n===e})&&(i=this),i}getSubGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getRows(e,i){var n=[];return i&&this.groupList.length?this.groupList.forEach(r=>{n=n.concat(r.getRows(e,i))}):this.rows.forEach(function(r){n.push(e?r.getComponent():r)}),n}generateGroupHeaderContents(){var e=[],i=this.getRows(!1,!0);for(i.forEach(function(n){e.push(n.getData())}),this.elementContents=this.generator(this.key,this.getRowCount(),e,this.getComponent());this.element.firstChild;)this.element.removeChild(this.element.firstChild);typeof this.elementContents=="string"?this.element.innerHTML=this.elementContents:this.element.appendChild(this.elementContents),this.element.insertBefore(this.arrowElement,this.element.firstChild)}getPath(e=[]){return e.unshift(this.key),this.parent&&this.parent.getPath(e),e}getElement(){return this.elementContents?this.element:this.generateElement()}generateElement(){this.addBindings=!1,this._visSet(),this.visible?this.element.classList.add("tabulator-group-visible"):this.element.classList.remove("tabulator-group-visible");for(var e=0;e<this.element.childNodes.length;++e)this.element.childNodes[e].parentNode.removeChild(this.element.childNodes[e]);return this.generateGroupHeaderContents(),this.element}detachElement(){this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element)}normalizeHeight(){this.setHeight(this.element.clientHeight)}initialize(e){(!this.initialized||e)&&(this.normalizeHeight(),this.initialized=!0)}reinitialize(){this.initialized=!1,this.height=0,Jr.elVisible(this.element)&&this.initialize(!0)}setHeight(e){this.height!=e&&(this.height=e,this.outerHeight=this.element.offsetHeight)}getHeight(){return this.outerHeight}getGroup(){return this}reinitializeHeight(){}calcHeight(){}setCellHeight(){}clearCellHeight(){}deinitializeHeight(){}rendered(){}getComponent(){return this.component||(this.component=new jje(this)),this.component}}class wve extends dn{constructor(e){super(e),this.groupIDLookups=!1,this.startOpen=[function(){return!1}],this.headerGenerator=[function(){return""}],this.groupList=[],this.allowedValues=!1,this.groups={},this.displayHandler=this.getRows.bind(this),this.blockRedraw=!1,this.registerTableOption("groupBy",!1),this.registerTableOption("groupStartOpen",!0),this.registerTableOption("groupValues",!1),this.registerTableOption("groupUpdateOnCellEdit",!1),this.registerTableOption("groupHeader",!1),this.registerTableOption("groupHeaderPrint",null),this.registerTableOption("groupHeaderClipboard",null),this.registerTableOption("groupHeaderHtmlOutput",null),this.registerTableOption("groupHeaderDownload",null),this.registerTableOption("groupToggleElement","arrow"),this.registerTableOption("groupClosedShowCalcs",!1),this.registerTableFunction("setGroupBy",this.setGroupBy.bind(this)),this.registerTableFunction("setGroupValues",this.setGroupValues.bind(this)),this.registerTableFunction("setGroupStartOpen",this.setGroupStartOpen.bind(this)),this.registerTableFunction("setGroupHeader",this.setGroupHeader.bind(this)),this.registerTableFunction("getGroups",this.userGetGroups.bind(this)),this.registerTableFunction("getGroupedData",this.userGetGroupedData.bind(this)),this.registerComponentFunction("row","getGroup",this.rowGetGroup.bind(this))}initialize(){this.subscribe("table-destroy",this._blockRedrawing.bind(this)),this.subscribe("rows-wipe",this._blockRedrawing.bind(this)),this.subscribe("rows-wiped",this._restore_redrawing.bind(this)),this.table.options.groupBy&&(this.table.options.groupUpdateOnCellEdit&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("row-data-changed",this.reassignRowToGroup.bind(this),0)),this.subscribe("table-built",this.configureGroupSetup.bind(this)),this.subscribe("row-deleting",this.rowDeleting.bind(this)),this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("scroll-horizontal",this.scrollHeaders.bind(this)),this.subscribe("rows-wipe",this.wipe.bind(this)),this.subscribe("rows-added",this.rowsUpdated.bind(this)),this.subscribe("row-moving",this.rowMoving.bind(this)),this.subscribe("row-adding-index",this.rowAddingIndex.bind(this)),this.subscribe("rows-sample",this.rowSample.bind(this)),this.subscribe("render-virtual-fill",this.virtualRenderFill.bind(this)),this.registerDisplayHandler(this.displayHandler,20),this.initialized=!0)}_blockRedrawing(){this.blockRedraw=!0}_restore_redrawing(){this.blockRedraw=!1}configureGroupSetup(){if(this.table.options.groupBy){var e=this.table.options.groupBy,i=this.table.options.groupStartOpen,n=this.table.options.groupHeader;if(this.allowedValues=this.table.options.groupValues,Array.isArray(e)&&Array.isArray(n)&&e.length>n.length&&console.warn("Error creating group headers, groupHeader array is shorter than groupBy array"),this.headerGenerator=[function(){return""}],this.startOpen=[function(){return!1}],this.langBind("groups|item",(o,a)=>{this.headerGenerator[0]=(s,l,c)=>(typeof s>"u"?"":s)+"<span>("+l+" "+(l===1?o:a.groups.items)+")</span>"}),this.groupIDLookups=[],e)this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="table"&&this.table.options.columnCalcs!="both"&&this.table.modules.columnCalcs.removeCalcs();else if(this.table.modExists("columnCalcs")&&this.table.options.columnCalcs!="group"){var r=this.table.columnManager.getRealColumns();r.forEach(o=>{o.definition.topCalc&&this.table.modules.columnCalcs.initializeTopRow(),o.definition.bottomCalc&&this.table.modules.columnCalcs.initializeBottomRow()})}Array.isArray(e)||(e=[e]),e.forEach((o,a)=>{var s,l;typeof o=="function"?s=o:(l=this.table.columnManager.getColumnByField(o),l?s=function(c){return l.getFieldValue(c)}:s=function(c){return c[o]}),this.groupIDLookups.push({field:typeof o=="function"?!1:o,func:s,values:this.allowedValues?this.allowedValues[a]:!1})}),i&&(Array.isArray(i)||(i=[i]),i.forEach(o=>{}),this.startOpen=i),n&&(this.headerGenerator=Array.isArray(n)?n:[n])}else this.groupList=[],this.groups={}}rowSample(e,i){if(this.table.options.groupBy){var n=this.getGroups(!1)[0];i.push(n.getRows(!1)[0])}return i}virtualRenderFill(){var e=this.table.rowManager.tableElement,i=this.table.rowManager.getVisibleRows();if(this.table.options.groupBy)i=i.filter(n=>n.type!=="group"),e.style.minWidth=i.length?"":this.table.columnManager.getWidth()+"px";else return i}rowAddingIndex(e,i,n){if(this.table.options.groupBy){this.assignRowToGroup(e);var r=e.modules.group.rows;return r.length>1&&(!i||i&&r.indexOf(i)==-1?n?r[0]!==e&&(i=r[0],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):r[r.length-1]!==e&&(i=r[r.length-1],this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)):this.table.rowManager.moveRowInArray(e.modules.group.rows,e,i,!n)),i}}trackChanges(){this.dispatch("group-changed")}setGroupBy(e){this.table.options.groupBy=e,this.initialized||this.initialize(),this.configureGroupSetup(),!e&&this.table.modExists("columnCalcs")&&this.table.options.columnCalcs===!0&&this.table.modules.columnCalcs.reinitializeCalcs(),this.refreshData(),this.trackChanges()}setGroupValues(e){this.table.options.groupValues=e,this.configureGroupSetup(),this.refreshData(),this.trackChanges()}setGroupStartOpen(e){this.table.options.groupStartOpen=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}setGroupHeader(e){this.table.options.groupHeader=e,this.configureGroupSetup(),this.table.options.groupBy?(this.refreshData(),this.trackChanges()):console.warn("Grouping Update - cant refresh view, no groups have been set")}userGetGroups(e){return this.getGroups(!0)}userGetGroupedData(){return this.table.options.groupBy?this.getGroupedData():this.getData()}rowGetGroup(e){return e.modules.group?e.modules.group.getComponent():!1}rowMoving(e,i,n){if(this.table.options.groupBy){!n&&i instanceof pI&&(i=this.table.rowManager.prevDisplayRow(e)||i);var r=i instanceof pI?i:i.modules.group,o=e instanceof pI?e:e.modules.group;r===o?this.table.rowManager.moveRowInArray(r.rows,e,i,n):(o&&o.removeRow(e),r.insertRow(e,i,n))}}rowDeleting(e){this.table.options.groupBy&&e.modules.group&&e.modules.group.removeRow(e)}rowsUpdated(e){this.table.options.groupBy&&this.updateGroupRows(!0)}cellUpdated(e){this.table.options.groupBy&&this.reassignRowToGroup(e.row)}getRows(e){return this.table.options.groupBy&&this.groupIDLookups.length?(this.dispatchExternal("dataGrouping"),this.generateGroups(e),this.subscribedExternal("dataGrouped")&&this.dispatchExternal("dataGrouped",this.getGroups(!0)),this.updateGroupRows()):e.slice(0)}getGroups(e){var i=[];return this.groupList.forEach(function(n){i.push(e?n.getComponent():n)}),i}getChildGroups(e){var i=[];return e||(e=this),e.groupList.forEach(n=>{n.groupList.length?i=i.concat(this.getChildGroups(n)):i.push(n)}),i}wipe(){this.table.options.groupBy&&(this.groupList.forEach(function(e){e.wipe()}),this.groupList=[],this.groups={})}pullGroupListData(e){var i=[];return e.forEach(n=>{var r={};r.level=0,r.rowCount=0,r.headerContent="";var o=[];n.hasSubGroups?(o=this.pullGroupListData(n.groupList),r.level=n.level,r.rowCount=o.length-n.groupList.length,r.headerContent=n.generator(n.key,r.rowCount,n.rows,n),i.push(r),i=i.concat(o)):(r.level=n.level,r.headerContent=n.generator(n.key,n.rows.length,n.rows,n),r.rowCount=n.getRows().length,i.push(r),n.getRows().forEach(a=>{i.push(a.getData("data"))}))}),i}getGroupedData(){return this.pullGroupListData(this.groupList)}getRowGroup(e){var i=!1;return this.options("dataTree")&&(e=this.table.modules.dataTree.getTreeParentRoot(e)),this.groupList.forEach(n=>{var r=n.getRowGroup(e);r&&(i=r)}),i}countGroups(){return this.groupList.length}generateGroups(e){var i=this.groups;this.groups={},this.groupList=[],this.allowedValues&&this.allowedValues[0]?(this.allowedValues[0].forEach(n=>{this.createGroup(n,0,i)}),e.forEach(n=>{this.assignRowToExistingGroup(n,i)})):e.forEach(n=>{this.assignRowToGroup(n,i)}),Object.values(i).forEach(n=>{n.wipe(!0)})}createGroup(e,i,n){var r=i+"_"+e,o;n=n||[],o=new pI(this,!1,i,e,this.groupIDLookups[0].field,this.headerGenerator[0],n[r]),this.groups[r]=o,this.groupList.push(o)}assignRowToExistingGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r="0_"+n;this.groups[r]&&this.groups[r].addRow(e)}assignRowToGroup(e,i){var n=this.groupIDLookups[0].func(e.getData()),r=!this.groups["0_"+n];return r&&this.createGroup(n,0,i),this.groups["0_"+n].addRow(e),!r}reassignRowToGroup(e){if(e.type==="row"){var i=e.modules.group,n=i.getPath(),r=this.getExpectedPath(e),o;o=n.length==r.length&&n.every((a,s)=>a===r[s]),o||(i.removeRow(e),this.assignRowToGroup(e,this.groups),this.refreshData(!0))}}getExpectedPath(e){var i=[],n=e.getData();return this.groupIDLookups.forEach(r=>{i.push(r.func(n))}),i}updateGroupRows(e){var i=[];return this.blockRedraw||(this.groupList.forEach(n=>{i=i.concat(n.getHeadersAndRows())}),e&&this.refreshData(!0)),i}scrollHeaders(e){this.table.options.groupBy&&(this.table.options.renderHorizontal==="virtual"&&(e-=this.table.columnManager.renderer.vDomPadLeft),e=e+"px",this.groupList.forEach(i=>{i.scrollHeader(e)}))}removeGroup(e){var i=e.level+"_"+e.key,n;this.groups[i]&&(delete this.groups[i],n=this.groupList.indexOf(e),n>-1&&this.groupList.splice(n,1))}checkBasicModeGroupHeaderWidth(){var e=this.table.rowManager.tableElement,i=!0;this.table.rowManager.getDisplayRows().forEach((n,r)=>{this.table.rowManager.styleRow(n,r),e.appendChild(n.getElement()),n.initialize(!0),n.type!=="group"&&(i=!1)}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}}wve.moduleName="groupRows";var Hje={cellEdit:function(t){t.component.setValueProcessData(t.data.oldValue),t.component.cellRendered()},rowAdd:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowMove:function(t){var e=t.data.posFrom-t.data.posTo>0;this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posFrom),e),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}},Gje={cellEdit:function(t){t.component.setValueProcessData(t.data.newValue),t.component.cellRendered()},rowAdd:function(t){var e=this.table.rowManager.addRowActual(t.data.data,t.data.pos,t.data.index);this.table.options.groupBy&&this.table.modExists("groupRows")&&this.table.modules.groupRows.updateGroupRows(!0),this._rebindRow(t.component,e),this.table.rowManager.checkPlaceholder()},rowDelete:function(t){t.component.deleteActual(),this.table.rowManager.checkPlaceholder()},rowMove:function(t){this.table.rowManager.moveRowActual(t.component,this.table.rowManager.getRowFromPosition(t.data.posTo),t.data.after),this.table.rowManager.regenerateRowPositions(),this.table.rowManager.reRenderInPosition()}};class uy extends dn{constructor(e){super(e),this.history=[],this.index=-1,this.registerTableOption("history",!1)}initialize(){this.table.options.history&&(this.subscribe("cell-value-updated",this.cellUpdated.bind(this)),this.subscribe("cell-delete",this.clearComponentHistory.bind(this)),this.subscribe("row-delete",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clear.bind(this)),this.subscribe("row-added",this.rowAdded.bind(this)),this.subscribe("row-move",this.rowMoved.bind(this))),this.registerTableFunction("undo",this.undo.bind(this)),this.registerTableFunction("redo",this.redo.bind(this)),this.registerTableFunction("getHistoryUndoSize",this.getHistoryUndoSize.bind(this)),this.registerTableFunction("getHistoryRedoSize",this.getHistoryRedoSize.bind(this)),this.registerTableFunction("clearHistory",this.clear.bind(this))}rowMoved(e,i,n){this.action("rowMove",e,{posFrom:e.getPosition(),posTo:i.getPosition(),to:i,after:n})}rowAdded(e,i,n,r){this.action("rowAdd",e,{data:i,pos:n,index:r})}rowDeleted(e){var i,n;this.table.options.groupBy?(n=e.getComponent().getGroup()._getSelf().rows,i=n.indexOf(e),i&&(i=n[i-1])):(i=e.table.rowManager.getRowIndex(e),i&&(i=e.table.rowManager.rows[i-1])),this.action("rowDelete",e,{data:e.getData(),pos:!i,index:i})}cellUpdated(e){this.action("cellEdit",e,{oldValue:e.oldValue,newValue:e.value})}clear(){this.history=[],this.index=-1}action(e,i,n){this.history=this.history.slice(0,this.index+1),this.history.push({type:e,component:i,data:n}),this.index++}getHistoryUndoSize(){return this.index+1}getHistoryRedoSize(){return this.history.length-(this.index+1)}clearComponentHistory(e){var i=this.history.findIndex(function(n){return n.component===e});i>-1&&(this.history.splice(i,1),i<=this.index&&this.index--,this.clearComponentHistory(e))}undo(){if(this.index>-1){let e=this.history[this.index];return uy.undoers[e.type].call(this,e),this.index--,this.dispatchExternal("historyUndo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Undo Error - No more history to undo":"History module not enabled"),!1}redo(){if(this.history.length-1>this.index){this.index++;let e=this.history[this.index];return uy.redoers[e.type].call(this,e),this.dispatchExternal("historyRedo",e.type,e.component.getComponent(),e.data),!0}else return console.warn(this.options("history")?"History Redo Error - No more history to redo":"History module not enabled"),!1}_rebindRow(e,i){this.history.forEach(function(n){if(n.component instanceof Hs)n.component===e&&(n.component=i);else if(n.component instanceof jC&&n.component.row===e){var r=n.component.column.getField();r&&(n.component=i.getCell(r))}})}}uy.moduleName="history";uy.undoers=Hje;uy.redoers=Gje;class Sve extends dn{constructor(e){super(e),this.fieldIndex=[],this.hasIndex=!1}initialize(){this.tableElementCheck()}tableElementCheck(){this.table.originalElement&&this.table.originalElement.tagName==="TABLE"&&(this.table.originalElement.childNodes.length?this.parseTable():console.warn("Unable to parse data from empty table tag, Tabulator should be initialized on a div tag unless importing data from a table element."))}parseTable(){var e=this.table.originalElement,i=this.table.options,n=e.getElementsByTagName("th"),r=e.getElementsByTagName("tbody")[0],o=[];this.hasIndex=!1,this.dispatchExternal("htmlImporting"),r=r?r.getElementsByTagName("tr"):[],this._extractOptions(e,i),n.length?this._extractHeaders(n,r):this._generateBlankHeaders(n,r);for(var a=0;a<r.length;a++){var s=r[a],l=s.getElementsByTagName("td"),c={};this.hasIndex||(c[i.index]=a);for(var u=0;u<l.length;u++){var d=l[u];typeof this.fieldIndex[u]<"u"&&(c[this.fieldIndex[u]]=d.innerHTML)}o.push(c)}i.data=o,this.dispatchExternal("htmlImported")}_extractOptions(e,i,n){var r=e.attributes,o=Object.keys(n||i),a={};o.forEach(u=>{a[u.toLowerCase()]=u});for(var s in r){var l=r[s],c;l&&typeof l=="object"&&l.name&&l.name.indexOf("tabulator-")===0&&(c=l.name.replace("tabulator-",""),typeof a[c]<"u"&&(i[a[c]]=this._attribValue(l.value)))}}_attribValue(e){return e==="true"?!0:e==="false"?!1:e}_findCol(e){var i=this.table.options.columns.find(n=>n.title===e);return i||!1}_extractHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],o=!1,a=this._findCol(r.textContent),s;a?o=!0:a={title:r.textContent.trim()},a.field||(a.field=r.textContent.trim().toLowerCase().replaceAll(" ","_")),s=r.getAttribute("width"),s&&!a.width&&(a.width=s),this._extractOptions(r,a,this.table.columnManager.optionsList.registeredDefaults),this.fieldIndex[n]=a.field,a.field==this.table.options.index&&(this.hasIndex=!0),o||this.table.options.columns.push(a)}}_generateBlankHeaders(e,i){for(var n=0;n<e.length;n++){var r=e[n],o={title:"",field:"col"+n};this.fieldIndex[n]=o.field;var a=r.getAttribute("width");a&&(o.width=a),this.table.options.columns.push(o)}}}Sve.moduleName="htmlTableImport";function zje(t){var e=[],i=0,n=0,r=!1;for(let o=0;o<t.length;o++){let a=t[o],s=t[o+1];if(e[i]||(e[i]=[]),e[i][n]||(e[i][n]=""),a=='"'&&r&&s=='"'){e[i][n]+=a,o++;continue}if(a=='"'){r=!r;continue}if(a==","&&!r){n++;continue}if(a=="\r"&&s==`
`&&!r){n=0,i++,o++;continue}if((a=="\r"||a==`
`)&&!r){n=0,i++;continue}e[i][n]+=a}return e}function Wje(t){try{return JSON.parse(t)}catch(e){return console.warn("JSON Import Error - File contents is invalid JSON",e),Promise.reject()}}function qje(t){return t}var Yje={csv:zje,json:Wje,array:qje};class GC extends dn{constructor(e){super(e),this.registerTableOption("importFormat"),this.registerTableOption("importReader","text")}initialize(){this.registerTableFunction("import",this.importFromFile.bind(this)),this.table.options.importFormat&&(this.subscribe("data-loading",this.loadDataCheck.bind(this),10),this.subscribe("data-load",this.loadData.bind(this),10))}loadDataCheck(e){return this.table.options.importFormat&&(typeof e=="string"||Array.isArray(e)&&e.length&&Array.isArray(e))}loadData(e,i,n,r,o){return this.importData(this.lookupImporter(),e).then(this.structureData.bind(this)).catch(a=>(console.error("Import Error:",a||"Unable to import data"),Promise.reject(a)))}lookupImporter(e){var i;return e||(e=this.table.options.importFormat),typeof e=="string"?i=GC.importers[e]:i=e,i||console.error("Import Error - Importer not found:",e),i}importFromFile(e,i){var n=this.lookupImporter(e);if(n)return this.pickFile(i).then(this.importData.bind(this,n)).then(this.structureData.bind(this)).then(this.setData.bind(this)).catch(r=>(console.error("Import Error:",r||"Unable to import file"),Promise.reject(r)))}pickFile(e){return new Promise((i,n)=>{var r=document.createElement("input");r.type="file",r.accept=e,r.addEventListener("change",o=>{var a=r.files[0],s=new FileReader;switch(this.table.options.importReader){case"buffer":s.readAsArrayBuffer(a);break;case"binary":s.readAsBinaryString(a);break;case"url":s.readAsDataURL(a);break;case"text":default:s.readAsText(a)}s.onload=l=>{i(s.result)},s.onerror=l=>{console.warn("File Load Error - Unable to read file"),n()}}),r.click()})}importData(e,i){var n=e.call(this.table,i);return n instanceof Promise?n:n?Promise.resolve(n):Promise.reject()}structureData(e){var i=[];return Array.isArray(e)&&e.length&&Array.isArray(e[0])?(this.table.options.autoColumns?i=this.structureArrayToObject(e):i=this.structureArrayToColumns(e),i):e}structureArrayToObject(e){var i=e.shift(),n=e.map(r=>{var o={};return i.forEach((a,s)=>{o[a]=r[s]}),o});return n}structureArrayToColumns(e){var i=[],n=this.table.getColumns();return n[0]&&e[0][0]&&n[0].getDefinition().title===e[0][0]&&e.shift(),e.forEach(r=>{var o={};r.forEach((a,s)=>{var l=n[s];l&&(o[l.getField()]=a)}),i.push(o)}),i}setData(e){return this.table.setData(e)}}GC.moduleName="import";GC.importers=Yje;class Tve extends dn{constructor(e){super(e),this.eventMap={rowClick:"row-click",rowDblClick:"row-dblclick",rowContext:"row-contextmenu",rowMouseEnter:"row-mouseenter",rowMouseLeave:"row-mouseleave",rowMouseOver:"row-mouseover",rowMouseOut:"row-mouseout",rowMouseMove:"row-mousemove",rowMouseDown:"row-mousedown",rowMouseUp:"row-mouseup",rowTap:"row",rowDblTap:"row",rowTapHold:"row",cellClick:"cell-click",cellDblClick:"cell-dblclick",cellContext:"cell-contextmenu",cellMouseEnter:"cell-mouseenter",cellMouseLeave:"cell-mouseleave",cellMouseOver:"cell-mouseover",cellMouseOut:"cell-mouseout",cellMouseMove:"cell-mousemove",cellMouseDown:"cell-mousedown",cellMouseUp:"cell-mouseup",cellTap:"cell",cellDblTap:"cell",cellTapHold:"cell",headerClick:"column-click",headerDblClick:"column-dblclick",headerContext:"column-contextmenu",headerMouseEnter:"column-mouseenter",headerMouseLeave:"column-mouseleave",headerMouseOver:"column-mouseover",headerMouseOut:"column-mouseout",headerMouseMove:"column-mousemove",headerMouseDown:"column-mousedown",headerMouseUp:"column-mouseup",headerTap:"column",headerDblTap:"column",headerTapHold:"column",groupClick:"group-click",groupDblClick:"group-dblclick",groupContext:"group-contextmenu",groupMouseEnter:"group-mouseenter",groupMouseLeave:"group-mouseleave",groupMouseOver:"group-mouseover",groupMouseOut:"group-mouseout",groupMouseMove:"group-mousemove",groupMouseDown:"group-mousedown",groupMouseUp:"group-mouseup",groupTap:"group",groupDblTap:"group",groupTapHold:"group"},this.subscribers={},this.touchSubscribers={},this.columnSubscribers={},this.touchWatchers={row:{tap:null,tapDbl:null,tapHold:null},cell:{tap:null,tapDbl:null,tapHold:null},column:{tap:null,tapDbl:null,tapHold:null},group:{tap:null,tapDbl:null,tapHold:null}},this.registerColumnOption("headerClick"),this.registerColumnOption("headerDblClick"),this.registerColumnOption("headerContext"),this.registerColumnOption("headerMouseEnter"),this.registerColumnOption("headerMouseLeave"),this.registerColumnOption("headerMouseOver"),this.registerColumnOption("headerMouseOut"),this.registerColumnOption("headerMouseMove"),this.registerColumnOption("headerMouseDown"),this.registerColumnOption("headerMouseUp"),this.registerColumnOption("headerTap"),this.registerColumnOption("headerDblTap"),this.registerColumnOption("headerTapHold"),this.registerColumnOption("cellClick"),this.registerColumnOption("cellDblClick"),this.registerColumnOption("cellContext"),this.registerColumnOption("cellMouseEnter"),this.registerColumnOption("cellMouseLeave"),this.registerColumnOption("cellMouseOver"),this.registerColumnOption("cellMouseOut"),this.registerColumnOption("cellMouseMove"),this.registerColumnOption("cellMouseDown"),this.registerColumnOption("cellMouseUp"),this.registerColumnOption("cellTap"),this.registerColumnOption("cellDblTap"),this.registerColumnOption("cellTapHold")}initialize(){this.initializeExternalEvents(),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("cell-dblclick",this.cellContentsSelectionFixer.bind(this)),this.subscribe("scroll-horizontal",this.clearTouchWatchers.bind(this)),this.subscribe("scroll-vertical",this.clearTouchWatchers.bind(this))}clearTouchWatchers(){var e=Object.values(this.touchWatchers);e.forEach(i=>{for(let n in i)i[n]=null})}cellContentsSelectionFixer(e,i){var n;if(!(this.table.modExists("edit")&&this.table.modules.edit.currentCell===i)){e.preventDefault();try{document.selection?(n=document.body.createTextRange(),n.moveToElementText(i.getElement()),n.select()):window.getSelection&&(n=document.createRange(),n.selectNode(i.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(n))}catch{}}}initializeExternalEvents(){for(let e in this.eventMap)this.subscriptionChangeExternal(e,this.subscriptionChanged.bind(this,e))}subscriptionChanged(e,i){i?this.subscribers[e]||(this.eventMap[e].includes("-")?(this.subscribers[e]=this.handle.bind(this,e),this.subscribe(this.eventMap[e],this.subscribers[e])):this.subscribeTouchEvents(e)):this.eventMap[e].includes("-")?this.subscribers[e]&&!this.columnSubscribers[e]&&!this.subscribedExternal(e)&&(this.unsubscribe(this.eventMap[e],this.subscribers[e]),delete this.subscribers[e]):this.unsubscribeTouchEvents(e)}subscribeTouchEvents(e){var i=this.eventMap[e];this.touchSubscribers[i+"-touchstart"]||(this.touchSubscribers[i+"-touchstart"]=this.handleTouch.bind(this,i,"start"),this.touchSubscribers[i+"-touchend"]=this.handleTouch.bind(this,i,"end"),this.subscribe(i+"-touchstart",this.touchSubscribers[i+"-touchstart"]),this.subscribe(i+"-touchend",this.touchSubscribers[i+"-touchend"])),this.subscribers[e]=!0}unsubscribeTouchEvents(e){var i=!0,n=this.eventMap[e];if(this.subscribers[e]&&!this.subscribedExternal(e)){delete this.subscribers[e];for(let r in this.eventMap)this.eventMap[r]===n&&this.subscribers[r]&&(i=!1);i&&(this.unsubscribe(n+"-touchstart",this.touchSubscribers[n+"-touchstart"]),this.unsubscribe(n+"-touchend",this.touchSubscribers[n+"-touchend"]),delete this.touchSubscribers[n+"-touchstart"],delete this.touchSubscribers[n+"-touchend"])}}initializeColumn(e){var i=e.definition;for(let n in this.eventMap)i[n]&&(this.subscriptionChanged(n,!0),this.columnSubscribers[n]||(this.columnSubscribers[n]=[]),this.columnSubscribers[n].push(e))}handle(e,i,n){this.dispatchEvent(e,i,n)}handleTouch(e,i,n,r){var o=this.touchWatchers[e];switch(e==="column"&&(e="header"),i){case"start":o.tap=!0,clearTimeout(o.tapHold),o.tapHold=setTimeout(()=>{clearTimeout(o.tapHold),o.tapHold=null,o.tap=null,clearTimeout(o.tapDbl),o.tapDbl=null,this.dispatchEvent(e+"TapHold",n,r)},1e3);break;case"end":o.tap&&(o.tap=null,this.dispatchEvent(e+"Tap",n,r)),o.tapDbl?(clearTimeout(o.tapDbl),o.tapDbl=null,this.dispatchEvent(e+"DblTap",n,r)):o.tapDbl=setTimeout(()=>{clearTimeout(o.tapDbl),o.tapDbl=null},300),clearTimeout(o.tapHold),o.tapHold=null;break}}dispatchEvent(e,i,n){var r=n.getComponent(),o;this.columnSubscribers[e]&&(n instanceof jC?o=n.column.definition[e]:n instanceof cp&&(o=n.definition[e]),o&&o(i,r)),this.dispatchExternal(e,i,r)}}Tve.moduleName="interaction";var Kje={navPrev:"shift + 9",navNext:9,navUp:38,navDown:40,navLeft:37,navRight:39,scrollPageUp:33,scrollPageDown:34,scrollToStart:36,scrollToEnd:35,undo:["ctrl + 90","meta + 90"],redo:["ctrl + 89","meta + 89"],copyToClipboard:["ctrl + 67","meta + 67"],rangeJumpUp:["ctrl + 38","meta + 38"],rangeJumpDown:["ctrl + 40","meta + 40"],rangeJumpLeft:["ctrl + 37","meta + 37"],rangeJumpRight:["ctrl + 39","meta + 39"],rangeExpandUp:"shift + 38",rangeExpandDown:"shift + 40",rangeExpandLeft:"shift + 37",rangeExpandRight:"shift + 39",rangeExpandJumpUp:["ctrl + shift + 38","meta + shift + 38"],rangeExpandJumpDown:["ctrl + shift + 40","meta + shift + 40"],rangeExpandJumpLeft:["ctrl + shift + 37","meta + shift + 37"],rangeExpandJumpRight:["ctrl + shift + 39","meta + shift + 39"]},Zje={keyBlock:function(t){t.stopPropagation(),t.preventDefault()},scrollPageUp:function(t){var e=this.table.rowManager,i=e.scrollTop-e.element.clientHeight;t.preventDefault(),e.displayRowsCount&&(i>=0?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[0])),this.table.element.focus()},scrollPageDown:function(t){var e=this.table.rowManager,i=e.scrollTop+e.element.clientHeight,n=e.element.scrollHeight;t.preventDefault(),e.displayRowsCount&&(i<=n?e.element.scrollTop=i:e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1])),this.table.element.focus()},scrollToStart:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[0]),this.table.element.focus()},scrollToEnd:function(t){var e=this.table.rowManager;t.preventDefault(),e.displayRowsCount&&e.scrollToRow(e.getDisplayRows()[e.displayRowsCount-1]),this.table.element.focus()},navPrev:function(t){this.dispatch("keybinding-nav-prev",t)},navNext:function(t){this.dispatch("keybinding-nav-next",t)},navLeft:function(t){this.dispatch("keybinding-nav-left",t)},navRight:function(t){this.dispatch("keybinding-nav-right",t)},navUp:function(t){this.dispatch("keybinding-nav-up",t)},navDown:function(t){this.dispatch("keybinding-nav-down",t)},rangeJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!1)},rangeJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!1)},rangeJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!1)},rangeJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!1)},rangeExpandLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!1,!0)},rangeExpandRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!1,!0)},rangeExpandUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!1,!0)},rangeExpandDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!1,!0)},rangeExpandJumpLeft:function(t){this.dispatch("keybinding-nav-range",t,"left",!0,!0)},rangeExpandJumpRight:function(t){this.dispatch("keybinding-nav-range",t,"right",!0,!0)},rangeExpandJumpUp:function(t){this.dispatch("keybinding-nav-range",t,"up",!0,!0)},rangeExpandJumpDown:function(t){this.dispatch("keybinding-nav-range",t,"down",!0,!0)},undo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.undo()))},redo:function(t){var e=!1;this.table.options.history&&this.table.modExists("history")&&this.table.modExists("edit")&&(e=this.table.modules.edit.currentCell,e||(t.preventDefault(),this.table.modules.history.redo()))},copyToClipboard:function(t){this.table.modules.edit.currentCell||this.table.modExists("clipboard",!0)&&this.table.modules.clipboard.copy(!1,!0)}};class wm extends dn{constructor(e){super(e),this.watchKeys=null,this.pressedKeys=null,this.keyupBinding=!1,this.keydownBinding=!1,this.registerTableOption("keybindings",{}),this.registerTableOption("tabEndNewRow",!1)}initialize(){var e=this.table.options.keybindings,i={};this.watchKeys={},this.pressedKeys=[],e!==!1&&(Object.assign(i,wm.bindings),Object.assign(i,e),this.mapBindings(i),this.bindEvents()),this.subscribe("table-destroy",this.clearBindings.bind(this))}mapBindings(e){for(let i in e)wm.actions[i]?e[i]&&(typeof e[i]!="object"&&(e[i]=[e[i]]),e[i].forEach(n=>{var r=Array.isArray(n)?n:[n];r.forEach(o=>{this.mapBinding(i,o)})})):console.warn("Key Binding Error - no such action:",i)}mapBinding(e,i){var n={action:wm.actions[e],keys:[],ctrl:!1,shift:!1,meta:!1},r=i.toString().toLowerCase().split(" ").join("").split("+");r.forEach(o=>{switch(o){case"ctrl":n.ctrl=!0;break;case"shift":n.shift=!0;break;case"meta":n.meta=!0;break;default:o=isNaN(o)?o.toUpperCase().charCodeAt(0):parseInt(o),n.keys.push(o),this.watchKeys[o]||(this.watchKeys[o]=[]),this.watchKeys[o].push(n)}})}bindEvents(){var e=this;this.keyupBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];r&&(e.pressedKeys.push(n),r.forEach(function(o){e.checkBinding(i,o)}))},this.keydownBinding=function(i){var n=i.keyCode,r=e.watchKeys[n];if(r){var o=e.pressedKeys.indexOf(n);o>-1&&e.pressedKeys.splice(o,1)}},this.table.element.addEventListener("keydown",this.keyupBinding),this.table.element.addEventListener("keyup",this.keydownBinding)}clearBindings(){this.keyupBinding&&this.table.element.removeEventListener("keydown",this.keyupBinding),this.keydownBinding&&this.table.element.removeEventListener("keyup",this.keydownBinding)}checkBinding(e,i){var n=!0;return e.ctrlKey==i.ctrl&&e.shiftKey==i.shift&&e.metaKey==i.meta?(i.keys.forEach(r=>{var o=this.pressedKeys.indexOf(r);o==-1&&(n=!1)}),n&&i.action.call(this,e),!0):!1}}wm.moduleName="keybindings";wm.bindings=Kje;wm.actions=Zje;class Uve extends dn{constructor(e){super(e),this.menuContainer=null,this.nestedMenuBlock=!1,this.currentComponent=null,this.rootPopup=null,this.columnSubscribers={},this.registerTableOption("menuContainer",void 0),this.registerTableOption("rowContextMenu",!1),this.registerTableOption("rowClickMenu",!1),this.registerTableOption("rowDblClickMenu",!1),this.registerTableOption("groupContextMenu",!1),this.registerTableOption("groupClickMenu",!1),this.registerTableOption("groupDblClickMenu",!1),this.registerColumnOption("headerContextMenu"),this.registerColumnOption("headerClickMenu"),this.registerColumnOption("headerDblClickMenu"),this.registerColumnOption("headerMenu"),this.registerColumnOption("headerMenuIcon"),this.registerColumnOption("contextMenu"),this.registerColumnOption("clickMenu"),this.registerColumnOption("dblClickMenu")}initialize(){this.deprecatedOptionsCheck(),this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheck("menuContainer","popupContainer")||(this.table.options.popupContainer=this.table.options.menuContainer)}initializeRowWatchers(){this.table.options.rowContextMenu&&(this.subscribe("row-contextmenu",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu)),this.table.on("rowTapHold",this.loadMenuEvent.bind(this,this.table.options.rowContextMenu))),this.table.options.rowClickMenu&&this.subscribe("row-click",this.loadMenuEvent.bind(this,this.table.options.rowClickMenu)),this.table.options.rowDblClickMenu&&this.subscribe("row-dblclick",this.loadMenuEvent.bind(this,this.table.options.rowDblClickMenu))}initializeGroupWatchers(){this.table.options.groupContextMenu&&(this.subscribe("group-contextmenu",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu)),this.table.on("groupTapHold",this.loadMenuEvent.bind(this,this.table.options.groupContextMenu))),this.table.options.groupClickMenu&&this.subscribe("group-click",this.loadMenuEvent.bind(this,this.table.options.groupClickMenu)),this.table.options.groupDblClickMenu&&this.subscribe("group-dblclick",this.loadMenuEvent.bind(this,this.table.options.groupDblClickMenu))}initializeColumn(e){var i=e.definition;i.headerContextMenu&&!this.columnSubscribers.headerContextMenu&&(this.columnSubscribers.headerContextMenu=this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextMenu),this.table.on("headerTapHold",this.loadMenuTableColumnEvent.bind(this,"headerContextMenu"))),i.headerClickMenu&&!this.columnSubscribers.headerClickMenu&&(this.columnSubscribers.headerClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerClickMenu"),this.subscribe("column-click",this.columnSubscribers.headerClickMenu)),i.headerDblClickMenu&&!this.columnSubscribers.headerDblClickMenu&&(this.columnSubscribers.headerDblClickMenu=this.loadMenuTableColumnEvent.bind(this,"headerDblClickMenu"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickMenu)),i.headerMenu&&this.initializeColumnHeaderMenu(e),i.contextMenu&&!this.columnSubscribers.contextMenu&&(this.columnSubscribers.contextMenu=this.loadMenuTableCellEvent.bind(this,"contextMenu"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextMenu),this.table.on("cellTapHold",this.loadMenuTableCellEvent.bind(this,"contextMenu"))),i.clickMenu&&!this.columnSubscribers.clickMenu&&(this.columnSubscribers.clickMenu=this.loadMenuTableCellEvent.bind(this,"clickMenu"),this.subscribe("cell-click",this.columnSubscribers.clickMenu)),i.dblClickMenu&&!this.columnSubscribers.dblClickMenu&&(this.columnSubscribers.dblClickMenu=this.loadMenuTableCellEvent.bind(this,"dblClickMenu"),this.subscribe("cell-dblclick",this.columnSubscribers.dblClickMenu))}initializeColumnHeaderMenu(e){var i=e.definition.headerMenuIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadMenuEvent(e.definition.headerMenu,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadMenuTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadMenuEvent(n.column.definition[e],i,n)}loadMenuTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadMenuEvent(n.definition[e],i,n)}loadMenuEvent(e,i,n){n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent()):e,this.loadMenu(i,n,e)}loadMenu(e,i,n,r,o){var a=!(e instanceof MouseEvent),s=document.createElement("div"),l;if(s.classList.add("tabulator-menu"),a||e.preventDefault(),!(!n||!n.length)){if(r)l=o.child(s);else{if(this.nestedMenuBlock){if(this.rootPopup)return}else this.nestedMenuBlock=setTimeout(()=>{this.nestedMenuBlock=!1},100);this.rootPopup&&this.rootPopup.hide(),this.rootPopup=l=this.popup(s)}n.forEach(c=>{var u=document.createElement("div"),d=c.label,p=c.disabled;c.separator?u.classList.add("tabulator-menu-separator"):(u.classList.add("tabulator-menu-item"),typeof d=="function"&&(d=d.call(this.table,i.getComponent())),d instanceof Node?u.appendChild(d):u.innerHTML=d,typeof p=="function"&&(p=p.call(this.table,i.getComponent())),p?(u.classList.add("tabulator-menu-item-disabled"),u.addEventListener("click",h=>{h.stopPropagation()})):c.menu&&c.menu.length?u.addEventListener("click",h=>{h.stopPropagation(),this.loadMenu(h,i,c.menu,u,l)}):c.action&&u.addEventListener("click",h=>{c.action(h,i.getComponent())}),c.menu&&c.menu.length&&u.classList.add("tabulator-menu-item-submenu")),s.appendChild(u)}),s.addEventListener("click",c=>{this.rootPopup&&this.rootPopup.hide()}),l.show(r||e),l===this.rootPopup&&(this.rootPopup.hideOnBlur(()=>{this.rootPopup=null,this.currentComponent&&(this.dispatch("menu-closed",n,l),this.dispatchExternal("menuClosed",this.currentComponent.getComponent()),this.currentComponent=null)}),this.currentComponent=i,this.dispatch("menu-opened",n,l),this.dispatchExternal("menuOpened",i.getComponent()))}}}Uve.moduleName="menu";class Dve extends dn{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=250,this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.startX=0,this.autoScrollMargin=40,this.autoScrollStep=5,this.autoScrollTimeout=!1,this.touchMove=!1,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.registerTableOption("movableColumns",!1)}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-col"),e.classList.add("tabulator-col-placeholder"),e}initialize(){this.table.options.movableColumns&&(this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("alert-show",this.abortMove.bind(this)))}abortMove(){clearTimeout(this.checkTimeout)}initializeColumn(e){var i=this,n={},r;!e.modules.frozen&&!e.isGroup&&(r=e.getElement(),n.mousemove=(function(o){e.parent===i.moving.parent&&((i.touchMove?o.touches[0].pageX:o.pageX)-Jr.elOffset(r).left+i.table.columnManager.contentsElement.scrollLeft>e.getWidth()/2?(i.toCol!==e||!i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r.nextSibling),i.moveColumn(e,!0)):(i.toCol!==e||i.toColAfter)&&(r.parentNode.insertBefore(i.placeholderElement,r),i.moveColumn(e,!1)))}).bind(i),r.addEventListener("mousedown",function(o){i.touchMove=!1,o.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(o,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(o){o.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),i.bindTouchEvents(e)),e.modules.moveColumn=n}bindTouchEvents(e){var i=e.getElement(),n=!1,r,o,a,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextColumn(),a=r?r.getWidth()/2:0,o=e.prevColumn(),s=o?o.getWidth()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),i.addEventListener("touchmove",u=>{var d,p;this.moving&&(this.moveHover(u),n||(n=u.touches[0].pageX),d=u.touches[0].pageX-n,d>0?r&&d-l>a&&(p=r,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveColumn(p,!0))):o&&-d-c>s&&(p=o,p!==e&&(n=u.touches[0].pageX,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveColumn(p,!1))),p&&(r=p.nextColumn(),l=a,a=r?r.getWidth()/2:0,o=p.prevColumn(),c=s,s=o?o.getWidth()/2:0))},{passive:!0}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&this.endMove(u)})}startMove(e,i){var n=i.getElement(),r=this.table.columnManager.getContentsElement(),o=this.table.columnManager.getHeadersElement();this.moving=i,this.startX=(this.touchMove?e.touches[0].pageX:e.pageX)-Jr.elOffset(n).left,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),r.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.bottom=r.clientHeight-o.offsetHeight+"px",this.touchMove||(this._bindMouseMove(),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove)),this.moveHover(e)}_bindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveColumn.mousemove)})}_unbindMouseMove(){this.table.columnManager.columnsByIndex.forEach(function(e){e.modules.moveColumn.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveColumn.mousemove)})}moveColumn(e,i){var n=this.moving.getCells();this.toCol=e,this.toColAfter=i,i?e.getCells().forEach(function(r,o){var a=r.getElement(!0);a.parentNode&&n[o]&&a.parentNode.insertBefore(n[o].getElement(),a.nextSibling)}):e.getCells().forEach(function(r,o){var a=r.getElement(!0);a.parentNode&&n[o]&&a.parentNode.insertBefore(n[o].getElement(),a)})}endMove(e){(e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toCol&&this.table.columnManager.moveColumnActual(this.moving,this.toCol,this.toColAfter),this.moving=!1,this.toCol=!1,this.toColAfter=!1,this.touchMove||(document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove)))}moveHover(e){var i=this.table.columnManager.getContentsElement(),n=i.scrollLeft,r=(this.touchMove?e.touches[0].pageX:e.pageX)-Jr.elOffset(i).left+n,o;this.hoverElement.style.left=r-this.startX+"px",r-n<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{o=Math.max(0,n-5),this.table.rowManager.getElement().scrollLeft=o,this.autoScrollTimeout=!1},1))),n+i.clientWidth-r<this.autoScrollMargin&&(this.autoScrollTimeout||(this.autoScrollTimeout=setTimeout(()=>{o=Math.min(i.clientWidth,n+5),this.table.rowManager.getElement().scrollLeft=o,this.autoScrollTimeout=!1},1)))}}Dve.moduleName="moveColumn";class Bx extends dn{constructor(e){super(e),this.placeholderElement=this.createPlaceholderElement(),this.hoverElement=!1,this.checkTimeout=!1,this.checkPeriod=150,this.moving=!1,this.toRow=!1,this.toRowAfter=!1,this.hasHandle=!1,this.startY=0,this.startX=0,this.moveHover=this.moveHover.bind(this),this.endMove=this.endMove.bind(this),this.tableRowDropEvent=!1,this.touchMove=!1,this.connection=!1,this.connectionSelectorsTables=!1,this.connectionSelectorsElements=!1,this.connectionElements=[],this.connections=[],this.connectedTable=!1,this.connectedRow=!1,this.registerTableOption("movableRows",!1),this.registerTableOption("movableRowsConnectedTables",!1),this.registerTableOption("movableRowsConnectedElements",!1),this.registerTableOption("movableRowsSender",!1),this.registerTableOption("movableRowsReceiver","insert"),this.registerColumnOption("rowHandle")}createPlaceholderElement(){var e=document.createElement("div");return e.classList.add("tabulator-row"),e.classList.add("tabulator-row-placeholder"),e}initialize(){this.table.options.movableRows&&(this.connectionSelectorsTables=this.table.options.movableRowsConnectedTables,this.connectionSelectorsElements=this.table.options.movableRowsConnectedElements,this.connection=this.connectionSelectorsTables||this.connectionSelectorsElements,this.subscribe("cell-init",this.initializeCell.bind(this)),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)))}initializeGroupHeader(e){var i=this,n={};n.mouseup=(function(r){i.tableRowDrop(r,e)}).bind(i),n.mousemove=(function(r){var o;r.pageY-Jr.elOffset(e.element).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(o=e.getElement(),o.parentNode.insertBefore(i.placeholderElement,o.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(o=e.getElement(),o.previousSibling&&(o.parentNode.insertBefore(i.placeholderElement,o),i.moveRow(e,!1)))}).bind(i),e.modules.moveRow=n}initializeRow(e){var i=this,n={},r;n.mouseup=(function(o){i.tableRowDrop(o,e)}).bind(i),n.mousemove=(function(o){var a=e.getElement();o.pageY-Jr.elOffset(a).top+i.table.rowManager.element.scrollTop>e.getHeight()/2?(i.toRow!==e||!i.toRowAfter)&&(a.parentNode.insertBefore(i.placeholderElement,a.nextSibling),i.moveRow(e,!0)):(i.toRow!==e||i.toRowAfter)&&(a.parentNode.insertBefore(i.placeholderElement,a),i.moveRow(e,!1))}).bind(i),this.hasHandle||(r=e.getElement(),r.addEventListener("mousedown",function(o){o.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(o,e)},i.checkPeriod))}),r.addEventListener("mouseup",function(o){o.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e,e.getElement())),e.modules.moveRow=n}initializeColumn(e){e.definition.rowHandle&&this.table.options.movableRows!==!1&&(this.hasHandle=!0)}initializeCell(e){if(e.column.definition.rowHandle&&this.table.options.movableRows!==!1){var i=this,n=e.getElement(!0);n.addEventListener("mousedown",function(r){r.which===1&&(i.checkTimeout=setTimeout(function(){i.startMove(r,e.row)},i.checkPeriod))}),n.addEventListener("mouseup",function(r){r.which===1&&i.checkTimeout&&clearTimeout(i.checkTimeout)}),this.bindTouchEvents(e.row,n)}}bindTouchEvents(e,i){var n=!1,r,o,a,s,l,c;i.addEventListener("touchstart",u=>{this.checkTimeout=setTimeout(()=>{this.touchMove=!0,r=e.nextRow(),a=r?r.getHeight()/2:0,o=e.prevRow(),s=o?o.getHeight()/2:0,l=0,c=0,n=!1,this.startMove(u,e)},this.checkPeriod)},{passive:!0}),this.moving,this.toRow,this.toRowAfter,i.addEventListener("touchmove",u=>{var d,p;this.moving&&(u.preventDefault(),this.moveHover(u),n||(n=u.touches[0].pageY),d=u.touches[0].pageY-n,d>0?r&&d-l>a&&(p=r,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement().nextSibling),this.moveRow(p,!0))):o&&-d-c>s&&(p=o,p!==e&&(n=u.touches[0].pageY,p.getElement().parentNode.insertBefore(this.placeholderElement,p.getElement()),this.moveRow(p,!1))),p&&(r=p.nextRow(),l=a,a=r?r.getHeight()/2:0,o=p.prevRow(),c=s,s=o?o.getHeight()/2:0))}),i.addEventListener("touchend",u=>{this.checkTimeout&&clearTimeout(this.checkTimeout),this.moving&&(this.endMove(u),this.touchMove=!1)})}_bindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().addEventListener("mousemove",e.modules.moveRow.mousemove)})}_unbindMouseMove(){this.table.rowManager.getDisplayRows().forEach(e=>{(e.type==="row"||e.type==="group")&&e.modules.moveRow&&e.modules.moveRow.mousemove&&e.getElement().removeEventListener("mousemove",e.modules.moveRow.mousemove)})}startMove(e,i){var n=i.getElement();this.setStartPosition(e,i),this.moving=i,this.table.element.classList.add("tabulator-block-select"),this.placeholderElement.style.width=i.getWidth()+"px",this.placeholderElement.style.height=i.getHeight()+"px",this.connection?(this.table.element.classList.add("tabulator-movingrow-sending"),this.connectToTables(i)):(n.parentNode.insertBefore(this.placeholderElement,n),n.parentNode.removeChild(n)),this.hoverElement=n.cloneNode(!0),this.hoverElement.classList.add("tabulator-moving"),this.connection?(document.body.appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this.hoverElement.style.width=this.table.element.clientWidth+"px",this.hoverElement.style.whiteSpace="nowrap",this.hoverElement.style.overflow="hidden",this.hoverElement.style.pointerEvents="none"):(this.table.rowManager.getTableElement().appendChild(this.hoverElement),this.hoverElement.style.left="0",this.hoverElement.style.top="0",this._bindMouseMove()),document.body.addEventListener("mousemove",this.moveHover),document.body.addEventListener("mouseup",this.endMove),this.dispatchExternal("rowMoving",i.getComponent()),this.moveHover(e)}setStartPosition(e,i){var n=this.touchMove?e.touches[0].pageX:e.pageX,r=this.touchMove?e.touches[0].pageY:e.pageY,o,a;o=i.getElement(),this.connection?(a=o.getBoundingClientRect(),this.startX=a.left-n+window.pageXOffset,this.startY=a.top-r+window.pageYOffset):this.startY=r-o.getBoundingClientRect().top}endMove(e){(!e||e.which===1||this.touchMove)&&(this._unbindMouseMove(),this.connection||(this.placeholderElement.parentNode.insertBefore(this.moving.getElement(),this.placeholderElement.nextSibling),this.placeholderElement.parentNode.removeChild(this.placeholderElement)),this.hoverElement.parentNode.removeChild(this.hoverElement),this.table.element.classList.remove("tabulator-block-select"),this.toRow?this.table.rowManager.moveRow(this.moving,this.toRow,this.toRowAfter):this.dispatchExternal("rowMoveCancelled",this.moving.getComponent()),this.moving=!1,this.toRow=!1,this.toRowAfter=!1,document.body.removeEventListener("mousemove",this.moveHover),document.body.removeEventListener("mouseup",this.endMove),this.connection&&(this.table.element.classList.remove("tabulator-movingrow-sending"),this.disconnectFromTables()))}moveRow(e,i){this.toRow=e,this.toRowAfter=i}moveHover(e){this.connection?this.moveHoverConnections.call(this,e):this.moveHoverTable.call(this,e)}moveHoverTable(e){var i=this.table.rowManager.getElement(),n=i.scrollTop,r=(this.touchMove?e.touches[0].pageY:e.pageY)-i.getBoundingClientRect().top+n;this.hoverElement.style.top=Math.min(r-this.startY,this.table.rowManager.element.scrollHeight-this.hoverElement.offsetHeight)+"px"}moveHoverConnections(e){this.hoverElement.style.left=this.startX+(this.touchMove?e.touches[0].pageX:e.pageX)+"px",this.hoverElement.style.top=this.startY+(this.touchMove?e.touches[0].pageY:e.pageY)+"px"}elementRowDrop(e,i,n){this.dispatchExternal("movableRowsElementDrop",e,i,n?n.getComponent():!1)}connectToTables(e){var i;this.connectionSelectorsTables&&(i=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStart",i),this.commsSend(this.connectionSelectorsTables,"moveRow","connect",{row:e})),this.connectionSelectorsElements&&(this.connectionElements=[],Array.isArray(this.connectionSelectorsElements)||(this.connectionSelectorsElements=[this.connectionSelectorsElements]),this.connectionSelectorsElements.forEach(n=>{typeof n=="string"?this.connectionElements=this.connectionElements.concat(Array.prototype.slice.call(document.querySelectorAll(n))):this.connectionElements.push(n)}),this.connectionElements.forEach(n=>{var r=o=>{this.elementRowDrop(o,n,this.moving)};n.addEventListener("mouseup",r),n.tabulatorElementDropEvent=r,n.classList.add("tabulator-movingrow-receiving")}))}disconnectFromTables(){var e;this.connectionSelectorsTables&&(e=this.commsConnections(this.connectionSelectorsTables),this.dispatchExternal("movableRowsSendingStop",e),this.commsSend(this.connectionSelectorsTables,"moveRow","disconnect")),this.connectionElements.forEach(i=>{i.classList.remove("tabulator-movingrow-receiving"),i.removeEventListener("mouseup",i.tabulatorElementDropEvent),delete i.tabulatorElementDropEvent})}connect(e,i){return this.connectedTable?(console.warn("Move Row Error - Table cannot accept connection, already connected to table:",this.connectedTable),!1):(this.connectedTable=e,this.connectedRow=i,this.table.element.classList.add("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(n=>{n.type==="row"&&n.modules.moveRow&&n.modules.moveRow.mouseup&&n.getElement().addEventListener("mouseup",n.modules.moveRow.mouseup)}),this.tableRowDropEvent=this.tableRowDrop.bind(this),this.table.element.addEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStart",i,e),!0)}disconnect(e){e===this.connectedTable?(this.connectedTable=!1,this.connectedRow=!1,this.table.element.classList.remove("tabulator-movingrow-receiving"),this.table.rowManager.getDisplayRows().forEach(i=>{i.type==="row"&&i.modules.moveRow&&i.modules.moveRow.mouseup&&i.getElement().removeEventListener("mouseup",i.modules.moveRow.mouseup)}),this.table.element.removeEventListener("mouseup",this.tableRowDropEvent),this.dispatchExternal("movableRowsReceivingStop",e)):console.warn("Move Row Error - trying to disconnect from non connected table")}dropComplete(e,i,n){var r=!1;if(n){switch(typeof this.table.options.movableRowsSender){case"string":r=this.senders[this.table.options.movableRowsSender];break;case"function":r=this.table.options.movableRowsSender;break}r?r.call(this,this.moving?this.moving.getComponent():void 0,i?i.getComponent():void 0,e):this.table.options.movableRowsSender&&console.warn("Mover Row Error - no matching sender found:",this.table.options.movableRowsSender),this.dispatchExternal("movableRowsSent",this.moving.getComponent(),i?i.getComponent():void 0,e)}else this.dispatchExternal("movableRowsSentFailed",this.moving.getComponent(),i?i.getComponent():void 0,e);this.endMove()}tableRowDrop(e,i){var n=!1,r=!1;switch(e.stopImmediatePropagation(),typeof this.table.options.movableRowsReceiver){case"string":n=this.receivers[this.table.options.movableRowsReceiver];break;case"function":n=this.table.options.movableRowsReceiver;break}n?r=n.call(this,this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):console.warn("Mover Row Error - no matching receiver found:",this.table.options.movableRowsReceiver),r?this.dispatchExternal("movableRowsReceived",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable):this.dispatchExternal("movableRowsReceivedFailed",this.connectedRow.getComponent(),i?i.getComponent():void 0,this.connectedTable),this.commsSend(this.connectedTable,"moveRow","dropcomplete",{row:i,success:r})}commsReceived(e,i,n){switch(i){case"connect":return this.connect(e,n.row);case"disconnect":return this.disconnect(e);case"dropcomplete":return this.dropComplete(e,n.row,n.success)}}}Bx.prototype.receivers={insert:function(t,e,i){return this.table.addRow(t.getData(),void 0,e),!0},add:function(t,e,i){return this.table.addRow(t.getData()),!0},update:function(t,e,i){return e?(e.update(t.getData()),!0):!1},replace:function(t,e,i){return e?(this.table.addRow(t.getData(),void 0,e),e.delete(),!0):!1}};Bx.prototype.senders={delete:function(t,e,i){t.delete()}};Bx.moduleName="moveRow";var Xje={};class Aw extends dn{constructor(e){super(e),this.allowedTypes=["","data","edit","clipboard"],this.enabled=!0,this.registerColumnOption("mutator"),this.registerColumnOption("mutatorParams"),this.registerColumnOption("mutatorData"),this.registerColumnOption("mutatorDataParams"),this.registerColumnOption("mutatorEdit"),this.registerColumnOption("mutatorEditParams"),this.registerColumnOption("mutatorClipboard"),this.registerColumnOption("mutatorClipboardParams"),this.registerColumnOption("mutateLink")}initialize(){this.subscribe("cell-value-changing",this.transformCell.bind(this)),this.subscribe("cell-value-changed",this.mutateLink.bind(this)),this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("row-data-init-before",this.rowDataChanged.bind(this)),this.subscribe("row-data-changing",this.rowDataChanged.bind(this))}rowDataChanged(e,i,n){return this.transformRow(i,"data",n)}initializeColumn(e){var i=!1,n={};this.allowedTypes.forEach(r=>{var o="mutator"+(r.charAt(0).toUpperCase()+r.slice(1)),a;e.definition[o]&&(a=this.lookupMutator(e.definition[o]),a&&(i=!0,n[o]={mutator:a,params:e.definition[o+"Params"]||{}}))}),i&&(e.modules.mutate=n)}lookupMutator(e){var i=!1;switch(typeof e){case"string":Aw.mutators[e]?i=Aw.mutators[e]:console.warn("Mutator Error - No such mutator found, ignoring: ",e);break;case"function":i=e;break}return i}transformRow(e,i,n){var r="mutator"+(i.charAt(0).toUpperCase()+i.slice(1)),o;return this.enabled&&this.table.columnManager.traverse(a=>{var s,l,c;a.modules.mutate&&(s=a.modules.mutate[r]||a.modules.mutate.mutator||!1,s&&(o=a.getFieldValue(typeof n<"u"?n:e),(i=="data"&&!n||typeof o<"u")&&(c=a.getComponent(),l=typeof s.params=="function"?s.params(o,e,i,c):s.params,a.setFieldValue(e,s.mutator(o,e,i,l,c)))))}),e}transformCell(e,i){if(e.column.modules.mutate){var n=e.column.modules.mutate.mutatorEdit||e.column.modules.mutate.mutator||!1,r={};if(n)return r=Object.assign(r,e.row.getData()),e.column.setFieldValue(r,i),n.mutator(i,r,"edit",n.params,e.getComponent())}return i}mutateLink(e){var i=e.column.definition.mutateLink;i&&(Array.isArray(i)||(i=[i]),i.forEach(n=>{var r=e.row.getCell(n);r&&r.setValue(r.getValue(),!0,!0)}))}enable(){this.enabled=!0}disable(){this.enabled=!1}}Aw.moduleName="mutator";Aw.mutators=Xje;function Jje(t,e,i,n,r){var o=document.createElement("span"),a=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{a.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),this.table.modules.localize.langBind("pagination|counter|rows",d=>{u.innerHTML=d}),n?(s.innerHTML=" "+e+"-"+Math.min(e+t-1,n)+" ",c.innerHTML=" "+n+" ",o.appendChild(a),o.appendChild(s),o.appendChild(l),o.appendChild(c),o.appendChild(u)):(s.innerHTML=" 0 ",o.appendChild(a),o.appendChild(s),o.appendChild(u)),o}function Qje(t,e,i,n,r){var o=document.createElement("span"),a=document.createElement("span"),s=document.createElement("span"),l=document.createElement("span"),c=document.createElement("span"),u=document.createElement("span");return this.table.modules.localize.langBind("pagination|counter|showing",d=>{a.innerHTML=d}),s.innerHTML=" "+i+" ",this.table.modules.localize.langBind("pagination|counter|of",d=>{l.innerHTML=d}),c.innerHTML=" "+r+" ",this.table.modules.localize.langBind("pagination|counter|pages",d=>{u.innerHTML=d}),o.appendChild(a),o.appendChild(s),o.appendChild(l),o.appendChild(c),o.appendChild(u),o}var eHe={rows:Jje,pages:Qje};class zC extends dn{constructor(e){super(e),this.mode="local",this.progressiveLoad=!1,this.element=null,this.pageCounterElement=null,this.pageCounter=null,this.size=0,this.page=1,this.count=5,this.max=1,this.remoteRowCountEstimate=null,this.initialLoad=!0,this.dataChanging=!1,this.pageSizes=[],this.registerTableOption("pagination",!1),this.registerTableOption("paginationMode","local"),this.registerTableOption("paginationSize",!1),this.registerTableOption("paginationInitialPage",1),this.registerTableOption("paginationCounter",!1),this.registerTableOption("paginationCounterElement",!1),this.registerTableOption("paginationButtonCount",5),this.registerTableOption("paginationSizeSelector",!1),this.registerTableOption("paginationElement",!1),this.registerTableOption("paginationAddRow","page"),this.registerTableOption("progressiveLoad",!1),this.registerTableOption("progressiveLoadDelay",0),this.registerTableOption("progressiveLoadScrollMargin",0),this.registerTableFunction("setMaxPage",this.setMaxPage.bind(this)),this.registerTableFunction("setPage",this.setPage.bind(this)),this.registerTableFunction("setPageToRow",this.userSetPageToRow.bind(this)),this.registerTableFunction("setPageSize",this.userSetPageSize.bind(this)),this.registerTableFunction("getPageSize",this.getPageSize.bind(this)),this.registerTableFunction("previousPage",this.previousPage.bind(this)),this.registerTableFunction("nextPage",this.nextPage.bind(this)),this.registerTableFunction("getPage",this.getPage.bind(this)),this.registerTableFunction("getPageMax",this.getPageMax.bind(this)),this.registerComponentFunction("row","pageTo",this.setPageToRow.bind(this))}initialize(){this.table.options.pagination?(this.subscribe("row-deleted",this.rowsUpdated.bind(this)),this.subscribe("row-added",this.rowsUpdated.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("footer-redraw",this.footerRedraw.bind(this)),this.table.options.paginationAddRow=="page"&&this.subscribe("row-adding-position",this.rowAddingPosition.bind(this)),this.table.options.paginationMode==="remote"&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this))),this.table.options.progressiveLoad&&console.error("Progressive Load Error - Pagination and progressive load cannot be used at the same time"),this.registerDisplayHandler(this.restOnRenderBefore.bind(this),40),this.registerDisplayHandler(this.getRows.bind(this),50),this.createElements(),this.initializePageCounter(),this.initializePaginator()):this.table.options.progressiveLoad&&(this.subscribe("data-params",this.remotePageParams.bind(this)),this.subscribe("data-loaded",this._parseRemoteData.bind(this)),this.subscribe("table-built",this.calculatePageSizes.bind(this)),this.subscribe("data-processed",this.initialLoadComplete.bind(this)),this.initializeProgressive(this.table.options.progressiveLoad),this.table.options.progressiveLoad==="scroll"&&this.subscribe("scroll-vertical",this.scrollVertical.bind(this)))}rowAddingPosition(e,i){var n=this.table.rowManager,r=n.getDisplayRows(),o;return i?r.length?o=r[0]:n.activeRows.length&&(o=n.activeRows[n.activeRows.length-1],i=!1):r.length&&(o=r[r.length-1],i=!(r.length<this.size)),{index:o,top:i}}calculatePageSizes(){var e,i;this.table.options.paginationSize?this.size=this.table.options.paginationSize:(e=document.createElement("div"),e.classList.add("tabulator-row"),e.style.visibility="hidden",i=document.createElement("div"),i.classList.add("tabulator-cell"),i.innerHTML="Page Row Test",e.appendChild(i),this.table.rowManager.getTableElement().appendChild(e),this.size=Math.floor(this.table.rowManager.getElement().clientHeight/e.offsetHeight),this.table.rowManager.getTableElement().removeChild(e)),this.dispatchExternal("pageSizeChanged",this.size),this.generatePageSizeSelectList()}initialLoadComplete(){this.initialLoad=!1}remotePageParams(e,i,n,r){return this.initialLoad||(this.progressiveLoad&&!n||!this.progressiveLoad&&!this.dataChanging)&&this.reset(!0),r.page=this.page,this.size&&(r.size=this.size),r}userSetPageToRow(e){return this.table.options.pagination&&(e=this.table.rowManager.findRow(e),e)?this.setPageToRow(e):Promise.reject()}userSetPageSize(e){return this.table.options.pagination?(this.setPageSize(e),this.setPage(1)):!1}scrollVertical(e,i){var n,r,o;!i&&!this.table.dataLoader.loading&&(n=this.table.rowManager.getElement(),r=n.scrollHeight-n.clientHeight-e,o=this.table.options.progressiveLoadScrollMargin||n.clientHeight*2,r<o&&this.nextPage().catch(()=>{}))}restOnRenderBefore(e,i){return i||this.mode==="local"&&this.reset(),e}rowsUpdated(){this.refreshData(!0,"all")}createElements(){var e;this.element=document.createElement("span"),this.element.classList.add("tabulator-paginator"),this.pagesElement=document.createElement("span"),this.pagesElement.classList.add("tabulator-pages"),e=document.createElement("button"),e.classList.add("tabulator-page"),e.setAttribute("type","button"),e.setAttribute("role","button"),e.setAttribute("aria-label",""),e.setAttribute("title",""),this.firstBut=e.cloneNode(!0),this.firstBut.setAttribute("data-page","first"),this.prevBut=e.cloneNode(!0),this.prevBut.setAttribute("data-page","prev"),this.nextBut=e.cloneNode(!0),this.nextBut.setAttribute("data-page","next"),this.lastBut=e.cloneNode(!0),this.lastBut.setAttribute("data-page","last"),this.table.options.paginationSizeSelector&&(this.pageSizeSelect=document.createElement("select"),this.pageSizeSelect.classList.add("tabulator-page-size"))}generatePageSizeSelectList(){var e=[];if(this.pageSizeSelect){if(Array.isArray(this.table.options.paginationSizeSelector))e=this.table.options.paginationSizeSelector,this.pageSizes=e,this.pageSizes.indexOf(this.size)==-1&&e.unshift(this.size);else if(this.pageSizes.indexOf(this.size)==-1){e=[];for(let i=1;i<5;i++)e.push(this.size*i);this.pageSizes=e}else e=this.pageSizes;for(;this.pageSizeSelect.firstChild;)this.pageSizeSelect.removeChild(this.pageSizeSelect.firstChild);e.forEach(i=>{var n=document.createElement("option");n.value=i,i===!0?this.langBind("pagination|all",function(r){n.innerHTML=r}):n.innerHTML=i,this.pageSizeSelect.appendChild(n)}),this.pageSizeSelect.value=this.size}}initializePageCounter(){var e=this.table.options.paginationCounter,i=null;e&&(typeof e=="function"?i=e:i=zC.pageCounters[e],i?(this.pageCounter=i,this.pageCounterElement=document.createElement("span"),this.pageCounterElement.classList.add("tabulator-page-counter")):console.warn("Pagination Error - No such page counter found: ",e))}initializePaginator(e){var i,n;e||(this.langBind("pagination|first",r=>{this.firstBut.innerHTML=r}),this.langBind("pagination|first_title",r=>{this.firstBut.setAttribute("aria-label",r),this.firstBut.setAttribute("title",r)}),this.langBind("pagination|prev",r=>{this.prevBut.innerHTML=r}),this.langBind("pagination|prev_title",r=>{this.prevBut.setAttribute("aria-label",r),this.prevBut.setAttribute("title",r)}),this.langBind("pagination|next",r=>{this.nextBut.innerHTML=r}),this.langBind("pagination|next_title",r=>{this.nextBut.setAttribute("aria-label",r),this.nextBut.setAttribute("title",r)}),this.langBind("pagination|last",r=>{this.lastBut.innerHTML=r}),this.langBind("pagination|last_title",r=>{this.lastBut.setAttribute("aria-label",r),this.lastBut.setAttribute("title",r)}),this.firstBut.addEventListener("click",()=>{this.setPage(1)}),this.prevBut.addEventListener("click",()=>{this.previousPage()}),this.nextBut.addEventListener("click",()=>{this.nextPage()}),this.lastBut.addEventListener("click",()=>{this.setPage(this.max)}),this.table.options.paginationElement&&(this.element=this.table.options.paginationElement),this.pageSizeSelect&&(i=document.createElement("label"),this.langBind("pagination|page_size",r=>{this.pageSizeSelect.setAttribute("aria-label",r),this.pageSizeSelect.setAttribute("title",r),i.innerHTML=r}),this.element.appendChild(i),this.element.appendChild(this.pageSizeSelect),this.pageSizeSelect.addEventListener("change",r=>{this.setPageSize(this.pageSizeSelect.value=="true"?!0:this.pageSizeSelect.value),this.setPage(1)})),this.element.appendChild(this.firstBut),this.element.appendChild(this.prevBut),this.element.appendChild(this.pagesElement),this.element.appendChild(this.nextBut),this.element.appendChild(this.lastBut),this.table.options.paginationElement||(this.table.options.paginationCounter&&(this.table.options.paginationCounterElement?this.table.options.paginationCounterElement instanceof HTMLElement?this.table.options.paginationCounterElement.appendChild(this.pageCounterElement):typeof this.table.options.paginationCounterElement=="string"&&(n=document.querySelector(this.table.options.paginationCounterElement),n?n.appendChild(this.pageCounterElement):console.warn("Pagination Error - Unable to find element matching paginationCounterElement selector:",this.table.options.paginationCounterElement)):this.footerAppend(this.pageCounterElement)),this.footerAppend(this.element)),this.page=this.table.options.paginationInitialPage,this.count=this.table.options.paginationButtonCount),this.mode=this.table.options.paginationMode}initializeProgressive(e){this.initializePaginator(!0),this.mode="progressive_"+e,this.progressiveLoad=!0}trackChanges(){this.dispatch("page-changed")}setMaxRows(e){e?this.max=this.size===!0?1:Math.ceil(e/this.size):this.max=1,this.page>this.max&&(this.page=this.max)}reset(e){this.initialLoad||(this.mode=="local"||e)&&(this.page=1,this.trackChanges())}setMaxPage(e){e=parseInt(e),this.max=e||1,this.page>this.max&&(this.page=this.max,this.trigger())}setPage(e){switch(e){case"first":return this.setPage(1);case"prev":return this.previousPage();case"next":return this.nextPage();case"last":return this.setPage(this.max)}return e=parseInt(e),e>0&&e<=this.max||this.mode!=="local"?(this.page=e,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Requested page is out of range of 1 - "+this.max+":",e),Promise.reject())}setPageToRow(e){var i=this.displayRows(-1),n=i.indexOf(e);if(n>-1){var r=this.size===!0?1:Math.ceil((n+1)/this.size);return this.setPage(r)}else return console.warn("Pagination Error - Requested row is not visible"),Promise.reject()}setPageSize(e){e!==!0&&(e=parseInt(e)),e>0&&(this.size=e,this.dispatchExternal("pageSizeChanged",e)),this.pageSizeSelect&&this.generatePageSizeSelectList(),this.trackChanges()}_setPageCounter(e,i,n){var r;if(this.pageCounter)switch(this.mode==="remote"&&(i=this.size,n=(this.page-1)*this.size+1,e=this.remoteRowCountEstimate),r=this.pageCounter.call(this,i,n,this.page,e,this.max),typeof r){case"object":if(r instanceof Node){for(;this.pageCounterElement.firstChild;)this.pageCounterElement.removeChild(this.pageCounterElement.firstChild);this.pageCounterElement.appendChild(r)}else this.pageCounterElement.innerHTML="",r!=null&&console.warn("Page Counter Error - Page Counter has returned a type of object, the only valid page counter object return is an instance of Node, the page counter returned:",r);break;case"undefined":this.pageCounterElement.innerHTML="";break;default:this.pageCounterElement.innerHTML=r}}_setPageButtons(){let e=Math.floor((this.count-1)/2),i=Math.ceil((this.count-1)/2),n=this.max-this.page+e+1<this.count?this.max-this.count+1:Math.max(this.page-e,1),r=this.page<=i?Math.min(this.count,this.max):Math.min(this.page+i,this.max);for(;this.pagesElement.firstChild;)this.pagesElement.removeChild(this.pagesElement.firstChild);this.page==1?(this.firstBut.disabled=!0,this.prevBut.disabled=!0):(this.firstBut.disabled=!1,this.prevBut.disabled=!1),this.page==this.max?(this.lastBut.disabled=!0,this.nextBut.disabled=!0):(this.lastBut.disabled=!1,this.nextBut.disabled=!1);for(let o=n;o<=r;o++)o>0&&o<=this.max&&this.pagesElement.appendChild(this._generatePageButton(o));this.footerRedraw()}_generatePageButton(e){var i=document.createElement("button");return i.classList.add("tabulator-page"),e==this.page&&i.classList.add("active"),i.setAttribute("type","button"),i.setAttribute("role","button"),this.langBind("pagination|page_title",n=>{i.setAttribute("aria-label",n+" "+e),i.setAttribute("title",n+" "+e)}),i.setAttribute("data-page",e),i.textContent=e,i.addEventListener("click",n=>{this.setPage(e)}),i}previousPage(){return this.page>1?(this.page--,this.trackChanges(),this.trigger()):(console.warn("Pagination Error - Previous page would be less than page 1:",0),Promise.reject())}nextPage(){return this.page<this.max?(this.page++,this.trackChanges(),this.trigger()):(this.progressiveLoad||console.warn("Pagination Error - Next page would be greater than maximum page of "+this.max+":",this.max+1),Promise.reject())}getPage(){return this.page}getPageMax(){return this.max}getPageSize(e){return this.size}getMode(){return this.mode}getRows(e){var i=0,n,r,o,a,s=e.filter(l=>l.type==="row");if(this.mode=="local"){n=[],this.setMaxRows(e.length),this.size===!0?(r=0,o=e.length):(r=this.size*(this.page-1),o=r+parseInt(this.size)),this._setPageButtons();for(let l=r;l<o;l++){let c=e[l];c&&(n.push(c),c.type==="row"&&(a||(a=c),i++))}return this._setPageCounter(s.length,i,a?s.indexOf(a)+1:0),n}else return this._setPageButtons(),this._setPageCounter(s.length),e.slice(0)}trigger(){var e;switch(this.mode){case"local":return e=this.table.rowManager.scrollLeft,this.refreshData(),this.table.rowManager.scrollHorizontal(e),this.dispatchExternal("pageLoaded",this.getPage()),Promise.resolve();case"remote":return this.dataChanging=!0,this.reloadData(null).finally(()=>{this.dataChanging=!1});case"progressive_load":case"progressive_scroll":return this.reloadData(null,!0);default:return console.warn("Pagination Error - no such pagination mode:",this.mode),Promise.reject()}}_parseRemoteData(e){var i;if(typeof e.last_page>"u"&&console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").last_page||"last_page")+"' property"),e.data)if(this.max=parseInt(e.last_page)||1,this.remoteRowCountEstimate=typeof e.last_row<"u"?e.last_row:e.last_page*this.size-(this.page==e.last_page?this.size-e.data.length:0),this.progressiveLoad){switch(this.mode){case"progressive_load":this.page==1?this.table.rowManager.setData(e.data,!1,this.page==1):this.table.rowManager.addRows(e.data),this.page<this.max&&setTimeout(()=>{this.nextPage()},this.table.options.progressiveLoadDelay);break;case"progressive_scroll":e=this.page===1?e.data:this.table.rowManager.getData().concat(e.data),this.table.rowManager.setData(e,this.page!==1,this.page==1),i=this.table.options.progressiveLoadScrollMargin||this.table.rowManager.element.clientHeight*2,this.table.rowManager.element.scrollHeight<=this.table.rowManager.element.clientHeight+i&&this.page<this.max&&setTimeout(()=>{this.nextPage()});break}return!1}else this.dispatchExternal("pageLoaded",this.getPage());else console.warn("Remote Pagination Error - Server response missing '"+(this.options("dataReceiveParams").data||"data")+"' property");return e.data}footerRedraw(){var e=this.table.footerManager.containerElement;Math.ceil(e.clientWidth)-e.scrollWidth<0?this.pagesElement.style.display="none":(this.pagesElement.style.display="",Math.ceil(e.clientWidth)-e.scrollWidth<0&&(this.pagesElement.style.display="none"))}}zC.moduleName="page";zC.pageCounters=eHe;var tHe={local:function(t,e){var i=localStorage.getItem(t+"-"+e);return i?JSON.parse(i):!1},cookie:function(t,e){var i=document.cookie,n=t+"-"+e,r=i.indexOf(n+"="),o,a;return r>-1&&(i=i.slice(r),o=i.indexOf(";"),o>-1&&(i=i.slice(0,o)),a=i.replace(n+"=","")),a?JSON.parse(a):!1}},iHe={local:function(t,e,i){localStorage.setItem(t+"-"+e,JSON.stringify(i))},cookie:function(t,e,i){var n=new Date;n.setDate(n.getDate()+1e4),document.cookie=t+"-"+e+"="+JSON.stringify(i)+"; expires="+n.toUTCString()}};class Pl extends dn{constructor(e){super(e),this.mode="",this.id="",this.defWatcherBlock=!1,this.config={},this.readFunc=!1,this.writeFunc=!1,this.registerTableOption("persistence",!1),this.registerTableOption("persistenceID",""),this.registerTableOption("persistenceMode",!0),this.registerTableOption("persistenceReaderFunc",!1),this.registerTableOption("persistenceWriterFunc",!1)}localStorageTest(){var e="_tabulator_test";try{return window.localStorage.setItem(e,e),window.localStorage.removeItem(e),!0}catch{return!1}}initialize(){if(this.table.options.persistence){var e=this.table.options.persistenceMode,i=this.table.options.persistenceID,n;this.mode=e!==!0?e:this.localStorageTest()?"local":"cookie",this.table.options.persistenceReaderFunc?typeof this.table.options.persistenceReaderFunc=="function"?this.readFunc=this.table.options.persistenceReaderFunc:Pl.readers[this.table.options.persistenceReaderFunc]?this.readFunc=Pl.readers[this.table.options.persistenceReaderFunc]:console.warn("Persistence Read Error - invalid reader set",this.table.options.persistenceReaderFunc):Pl.readers[this.mode]?this.readFunc=Pl.readers[this.mode]:console.warn("Persistence Read Error - invalid reader set",this.mode),this.table.options.persistenceWriterFunc?typeof this.table.options.persistenceWriterFunc=="function"?this.writeFunc=this.table.options.persistenceWriterFunc:Pl.writers[this.table.options.persistenceWriterFunc]?this.writeFunc=Pl.writers[this.table.options.persistenceWriterFunc]:console.warn("Persistence Write Error - invalid reader set",this.table.options.persistenceWriterFunc):Pl.writers[this.mode]?this.writeFunc=Pl.writers[this.mode]:console.warn("Persistence Write Error - invalid writer set",this.mode),this.id="tabulator-"+(i||this.table.element.getAttribute("id")||""),this.config={sort:this.table.options.persistence===!0||this.table.options.persistence.sort,filter:this.table.options.persistence===!0||this.table.options.persistence.filter,headerFilter:this.table.options.persistence===!0||this.table.options.persistence.headerFilter,group:this.table.options.persistence===!0||this.table.options.persistence.group,page:this.table.options.persistence===!0||this.table.options.persistence.page,columns:this.table.options.persistence===!0?["title","width","visible"]:this.table.options.persistence.columns},this.config.page&&(n=this.retrieveData("page"),n&&(typeof n.paginationSize<"u"&&(this.config.page===!0||this.config.page.size)&&(this.table.options.paginationSize=n.paginationSize),typeof n.paginationInitialPage<"u"&&(this.config.page===!0||this.config.page.page)&&(this.table.options.paginationInitialPage=n.paginationInitialPage))),this.config.group&&(n=this.retrieveData("group"),n&&(typeof n.groupBy<"u"&&(this.config.group===!0||this.config.group.groupBy)&&(this.table.options.groupBy=n.groupBy),typeof n.groupStartOpen<"u"&&(this.config.group===!0||this.config.group.groupStartOpen)&&(this.table.options.groupStartOpen=n.groupStartOpen),typeof n.groupHeader<"u"&&(this.config.group===!0||this.config.group.groupHeader)&&(this.table.options.groupHeader=n.groupHeader))),this.config.columns&&(this.table.options.columns=this.load("columns",this.table.options.columns),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-show",this.save.bind(this,"columns")),this.subscribe("column-hide",this.save.bind(this,"columns")),this.subscribe("column-moved",this.save.bind(this,"columns"))),this.subscribe("table-built",this.tableBuilt.bind(this),0),this.subscribe("table-redraw",this.tableRedraw.bind(this)),this.subscribe("filter-changed",this.eventSave.bind(this,"filter")),this.subscribe("filter-changed",this.eventSave.bind(this,"headerFilter")),this.subscribe("sort-changed",this.eventSave.bind(this,"sort")),this.subscribe("group-changed",this.eventSave.bind(this,"group")),this.subscribe("page-changed",this.eventSave.bind(this,"page")),this.subscribe("column-resized",this.eventSave.bind(this,"columns")),this.subscribe("column-width",this.eventSave.bind(this,"columns")),this.subscribe("layout-refreshed",this.eventSave.bind(this,"columns"))}this.registerTableFunction("getColumnLayout",this.getColumnLayout.bind(this)),this.registerTableFunction("setColumnLayout",this.setColumnLayout.bind(this))}eventSave(e){this.config[e]&&this.save(e)}tableBuilt(){var e,i,n;this.config.sort&&(e=this.load("sort"),e&&(this.table.options.initialSort=e)),this.config.filter&&(i=this.load("filter"),i&&(this.table.options.initialFilter=i)),this.config.headerFilter&&(n=this.load("headerFilter"),n&&(this.table.options.initialHeaderFilter=n))}tableRedraw(e){e&&this.config.columns&&this.save("columns")}getColumnLayout(){return this.parseColumns(this.table.columnManager.getColumns())}setColumnLayout(e){return this.table.columnManager.setColumns(this.mergeDefinition(this.table.options.columns,e,!0)),!0}initializeColumn(e){var i,n;this.config.columns&&(this.defWatcherBlock=!0,i=e.getDefinition(),n=this.config.columns===!0?Object.keys(i):this.config.columns,n.forEach(r=>{var o=Object.getOwnPropertyDescriptor(i,r),a=i[r];o&&Object.defineProperty(i,r,{set:s=>{a=s,this.defWatcherBlock||this.save("columns"),o.set&&o.set(s)},get:()=>(o.get&&o.get(),a)})}),this.defWatcherBlock=!1)}load(e,i){var n=this.retrieveData(e);return i&&(n=n?this.mergeDefinition(i,n):i),n}retrieveData(e){return this.readFunc?this.readFunc(this.id,e):!1}mergeDefinition(e,i,n){var r=[];return i=i||[],i.forEach((o,a)=>{var s=this._findColumn(e,o),l;s&&(n?l=Object.keys(o):this.config.columns===!0||this.config.columns==null?(l=Object.keys(s),l.push("width")):l=this.config.columns,l.forEach(c=>{c!=="columns"&&typeof o[c]<"u"&&(s[c]=o[c])}),s.columns&&(s.columns=this.mergeDefinition(s.columns,o.columns)),r.push(s))}),e.forEach((o,a)=>{var s=this._findColumn(i,o);s||(r.length>a?r.splice(a,0,o):r.push(o))}),r}_findColumn(e,i){var n=i.columns?"group":i.field?"field":"object";return e.find(function(r){switch(n){case"group":return r.title===i.title&&r.columns.length===i.columns.length;case"field":return r.field===i.field;case"object":return r===i}})}save(e){var i={};switch(e){case"columns":i=this.parseColumns(this.table.columnManager.getColumns());break;case"filter":i=this.table.modules.filter.getFilters();break;case"headerFilter":i=this.table.modules.filter.getHeaderFilters();break;case"sort":i=this.validateSorters(this.table.modules.sort.getSort());break;case"group":i=this.getGroupConfig();break;case"page":i=this.getPageConfig();break}this.writeFunc&&this.writeFunc(this.id,e,i)}validateSorters(e){return e.forEach(function(i){i.column=i.field,delete i.field}),e}getGroupConfig(){var e={};return this.config.group&&((this.config.group===!0||this.config.group.groupBy)&&(e.groupBy=this.table.options.groupBy),(this.config.group===!0||this.config.group.groupStartOpen)&&(e.groupStartOpen=this.table.options.groupStartOpen),(this.config.group===!0||this.config.group.groupHeader)&&(e.groupHeader=this.table.options.groupHeader)),e}getPageConfig(){var e={};return this.config.page&&((this.config.page===!0||this.config.page.size)&&(e.paginationSize=this.table.modules.page.getPageSize()),(this.config.page===!0||this.config.page.page)&&(e.paginationInitialPage=this.table.modules.page.getPage())),e}parseColumns(e){var i=[],n=["headerContextMenu","headerMenu","contextMenu","clickMenu"];return e.forEach(r=>{var o={},a=r.getDefinition(),s;r.isGroup?(o.title=a.title,o.columns=this.parseColumns(r.getColumns())):(o.field=r.getField(),this.config.columns===!0||this.config.columns==null?(s=Object.keys(a),s.push("width"),s.push("visible")):s=this.config.columns,s.forEach(l=>{switch(l){case"width":o.width=r.getWidth();break;case"visible":o.visible=r.visible;break;default:typeof a[l]!="function"&&n.indexOf(l)===-1&&(o[l]=a[l])}})),i.push(o)}),i}}Pl.moduleName="persistence";Pl.moduleInitOrder=-10;Pl.readers=tHe;Pl.writers=iHe;let Pve=class extends dn{constructor(e){super(e),this.columnSubscribers={},this.registerTableOption("rowContextPopup",!1),this.registerTableOption("rowClickPopup",!1),this.registerTableOption("rowDblClickPopup",!1),this.registerTableOption("groupContextPopup",!1),this.registerTableOption("groupClickPopup",!1),this.registerTableOption("groupDblClickPopup",!1),this.registerColumnOption("headerContextPopup"),this.registerColumnOption("headerClickPopup"),this.registerColumnOption("headerDblClickPopup"),this.registerColumnOption("headerPopup"),this.registerColumnOption("headerPopupIcon"),this.registerColumnOption("contextPopup"),this.registerColumnOption("clickPopup"),this.registerColumnOption("dblClickPopup"),this.registerComponentFunction("cell","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("column","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("row","popup",this._componentPopupCall.bind(this)),this.registerComponentFunction("group","popup",this._componentPopupCall.bind(this))}initialize(){this.initializeRowWatchers(),this.initializeGroupWatchers(),this.subscribe("column-init",this.initializeColumn.bind(this))}_componentPopupCall(e,i,n){this.loadPopupEvent(i,null,e,n)}initializeRowWatchers(){this.table.options.rowContextPopup&&(this.subscribe("row-contextmenu",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup)),this.table.on("rowTapHold",this.loadPopupEvent.bind(this,this.table.options.rowContextPopup))),this.table.options.rowClickPopup&&this.subscribe("row-click",this.loadPopupEvent.bind(this,this.table.options.rowClickPopup)),this.table.options.rowDblClickPopup&&this.subscribe("row-dblclick",this.loadPopupEvent.bind(this,this.table.options.rowDblClickPopup))}initializeGroupWatchers(){this.table.options.groupContextPopup&&(this.subscribe("group-contextmenu",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup)),this.table.on("groupTapHold",this.loadPopupEvent.bind(this,this.table.options.groupContextPopup))),this.table.options.groupClickPopup&&this.subscribe("group-click",this.loadPopupEvent.bind(this,this.table.options.groupClickPopup)),this.table.options.groupDblClickPopup&&this.subscribe("group-dblclick",this.loadPopupEvent.bind(this,this.table.options.groupDblClickPopup))}initializeColumn(e){var i=e.definition;i.headerContextPopup&&!this.columnSubscribers.headerContextPopup&&(this.columnSubscribers.headerContextPopup=this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"),this.subscribe("column-contextmenu",this.columnSubscribers.headerContextPopup),this.table.on("headerTapHold",this.loadPopupTableColumnEvent.bind(this,"headerContextPopup"))),i.headerClickPopup&&!this.columnSubscribers.headerClickPopup&&(this.columnSubscribers.headerClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerClickPopup"),this.subscribe("column-click",this.columnSubscribers.headerClickPopup)),i.headerDblClickPopup&&!this.columnSubscribers.headerDblClickPopup&&(this.columnSubscribers.headerDblClickPopup=this.loadPopupTableColumnEvent.bind(this,"headerDblClickPopup"),this.subscribe("column-dblclick",this.columnSubscribers.headerDblClickPopup)),i.headerPopup&&this.initializeColumnHeaderPopup(e),i.contextPopup&&!this.columnSubscribers.contextPopup&&(this.columnSubscribers.contextPopup=this.loadPopupTableCellEvent.bind(this,"contextPopup"),this.subscribe("cell-contextmenu",this.columnSubscribers.contextPopup),this.table.on("cellTapHold",this.loadPopupTableCellEvent.bind(this,"contextPopup"))),i.clickPopup&&!this.columnSubscribers.clickPopup&&(this.columnSubscribers.clickPopup=this.loadPopupTableCellEvent.bind(this,"clickPopup"),this.subscribe("cell-click",this.columnSubscribers.clickPopup)),i.dblClickPopup&&!this.columnSubscribers.dblClickPopup&&(this.columnSubscribers.dblClickPopup=this.loadPopupTableCellEvent.bind(this,"dblClickPopup"),this.subscribe("cell-click",this.columnSubscribers.dblClickPopup))}initializeColumnHeaderPopup(e){var i=e.definition.headerPopupIcon,n;n=document.createElement("span"),n.classList.add("tabulator-header-popup-button"),i?(typeof i=="function"&&(i=i(e.getComponent())),i instanceof HTMLElement?n.appendChild(i):n.innerHTML=i):n.innerHTML="&vellip;",n.addEventListener("click",r=>{r.stopPropagation(),r.preventDefault(),this.loadPopupEvent(e.definition.headerPopup,r,e)}),e.titleElement.insertBefore(n,e.titleElement.firstChild)}loadPopupTableCellEvent(e,i,n){n._cell&&(n=n._cell),n.column.definition[e]&&this.loadPopupEvent(n.column.definition[e],i,n)}loadPopupTableColumnEvent(e,i,n){n._column&&(n=n._column),n.definition[e]&&this.loadPopupEvent(n.definition[e],i,n)}loadPopupEvent(e,i,n,r){var o;function a(s){o=s}n._group?n=n._group:n._row&&(n=n._row),e=typeof e=="function"?e.call(this.table,i,n.getComponent(),a):e,this.loadPopup(i,n,e,o,r)}loadPopup(e,i,n,r,o){var a=!(e instanceof MouseEvent),s,l;n instanceof HTMLElement?s=n:(s=document.createElement("div"),s.innerHTML=n),s.classList.add("tabulator-popup"),s.addEventListener("click",c=>{c.stopPropagation()}),a||e.preventDefault(),l=this.popup(s),typeof r=="function"&&l.renderCallback(r),e?l.show(e):l.show(i.getElement(),o||"center"),l.hideOnBlur(()=>{this.dispatchExternal("popupClosed",i.getComponent())}),this.dispatchExternal("popupOpened",i.getComponent())}};Pve.moduleName="popup";class Cve extends dn{constructor(e){super(e),this.element=!1,this.manualBlock=!1,this.beforeprintEventHandler=null,this.afterprintEventHandler=null,this.registerTableOption("printAsHtml",!1),this.registerTableOption("printFormatter",!1),this.registerTableOption("printHeader",!1),this.registerTableOption("printFooter",!1),this.registerTableOption("printStyled",!0),this.registerTableOption("printRowRange","visible"),this.registerTableOption("printConfig",{}),this.registerColumnOption("print"),this.registerColumnOption("titlePrint")}initialize(){this.table.options.printAsHtml&&(this.beforeprintEventHandler=this.replaceTable.bind(this),this.afterprintEventHandler=this.cleanup.bind(this),window.addEventListener("beforeprint",this.beforeprintEventHandler),window.addEventListener("afterprint",this.afterprintEventHandler),this.subscribe("table-destroy",this.destroy.bind(this))),this.registerTableFunction("print",this.printFullscreen.bind(this))}destroy(){this.table.options.printAsHtml&&(window.removeEventListener("beforeprint",this.beforeprintEventHandler),window.removeEventListener("afterprint",this.afterprintEventHandler))}replaceTable(){this.manualBlock||(this.element=document.createElement("div"),this.element.classList.add("tabulator-print-table"),this.element.appendChild(this.table.modules.export.generateTable(this.table.options.printConfig,this.table.options.printStyled,this.table.options.printRowRange,"print")),this.table.element.style.display="none",this.table.element.parentNode.insertBefore(this.element,this.table.element))}cleanup(){document.body.classList.remove("tabulator-print-fullscreen-hide"),this.element&&this.element.parentNode&&(this.element.parentNode.removeChild(this.element),this.table.element.style.display="")}printFullscreen(e,i,n){var r=window.scrollX,o=window.scrollY,a=document.createElement("div"),s=document.createElement("div"),l=this.table.modules.export.generateTable(typeof n<"u"?n:this.table.options.printConfig,typeof i<"u"?i:this.table.options.printStyled,e||this.table.options.printRowRange,"print"),c,u;this.manualBlock=!0,this.element=document.createElement("div"),this.element.classList.add("tabulator-print-fullscreen"),this.table.options.printHeader&&(a.classList.add("tabulator-print-header"),c=typeof this.table.options.printHeader=="function"?this.table.options.printHeader.call(this.table):this.table.options.printHeader,typeof c=="string"?a.innerHTML=c:a.appendChild(c),this.element.appendChild(a)),this.element.appendChild(l),this.table.options.printFooter&&(s.classList.add("tabulator-print-footer"),u=typeof this.table.options.printFooter=="function"?this.table.options.printFooter.call(this.table):this.table.options.printFooter,typeof u=="string"?s.innerHTML=u:s.appendChild(u),this.element.appendChild(s)),document.body.classList.add("tabulator-print-fullscreen-hide"),document.body.appendChild(this.element),this.table.options.printFormatter&&this.table.options.printFormatter(this.element,l),window.print(),this.cleanup(),window.scrollTo(r,o),this.manualBlock=!1}}Cve.moduleName="print";class Eve extends dn{constructor(e){super(e),this.data=!1,this.blocked=!1,this.origFuncs={},this.currentVersion=0,this.registerTableOption("reactiveData",!1)}initialize(){this.table.options.reactiveData&&(this.subscribe("cell-value-save-before",this.block.bind(this,"cellsave")),this.subscribe("cell-value-save-after",this.unblock.bind(this,"cellsave")),this.subscribe("row-data-save-before",this.block.bind(this,"rowsave")),this.subscribe("row-data-save-after",this.unblock.bind(this,"rowsave")),this.subscribe("row-data-init-after",this.watchRow.bind(this)),this.subscribe("data-processing",this.watchData.bind(this)),this.subscribe("table-destroy",this.unwatchData.bind(this)))}watchData(e){var i=this,n;this.currentVersion++,n=this.currentVersion,this.unwatchData(),this.data=e,this.origFuncs.push=e.push,Object.defineProperty(this.data,"push",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),o;return!i.blocked&&n===i.currentVersion&&(i.block("data-push"),r.forEach(a=>{i.table.rowManager.addRowActual(a,!1)}),o=i.origFuncs.push.apply(e,arguments),i.unblock("data-push")),o}}),this.origFuncs.unshift=e.unshift,Object.defineProperty(this.data,"unshift",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),o;return!i.blocked&&n===i.currentVersion&&(i.block("data-unshift"),r.forEach(a=>{i.table.rowManager.addRowActual(a,!0)}),o=i.origFuncs.unshift.apply(e,arguments),i.unblock("data-unshift")),o}}),this.origFuncs.shift=e.shift,Object.defineProperty(this.data,"shift",{enumerable:!1,configurable:!0,value:function(){var r,o;return!i.blocked&&n===i.currentVersion&&(i.block("data-shift"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[0]),r&&r.deleteActual()),o=i.origFuncs.shift.call(e),i.unblock("data-shift")),o}}),this.origFuncs.pop=e.pop,Object.defineProperty(this.data,"pop",{enumerable:!1,configurable:!0,value:function(){var r,o;return!i.blocked&&n===i.currentVersion&&(i.block("data-pop"),i.data.length&&(r=i.table.rowManager.getRowFromDataObject(i.data[i.data.length-1]),r&&r.deleteActual()),o=i.origFuncs.pop.call(e),i.unblock("data-pop")),o}}),this.origFuncs.splice=e.splice,Object.defineProperty(this.data,"splice",{enumerable:!1,configurable:!0,value:function(){var r=Array.from(arguments),o=r[0]<0?e.length+r[0]:r[0],a=r[1],s=r[2]?r.slice(2):!1,l,c;if(!i.blocked&&n===i.currentVersion){if(i.block("data-splice"),s&&(l=e[o]?i.table.rowManager.getRowFromDataObject(e[o]):!1,l?s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,l,!0)}):(s=s.slice().reverse(),s.forEach(d=>{i.table.rowManager.addRowActual(d,!0,!1,!0)}))),a!==0){var u=e.slice(o,typeof r[1]>"u"?r[1]:o+a);u.forEach((d,p)=>{var h=i.table.rowManager.getRowFromDataObject(d);h&&h.deleteActual(p!==u.length-1)})}(s||a!==0)&&i.table.rowManager.reRenderInPosition(),c=i.origFuncs.splice.apply(e,arguments),i.unblock("data-splice")}return c}})}unwatchData(){if(this.data!==!1)for(var e in this.origFuncs)Object.defineProperty(this.data,e,{enumerable:!0,configurable:!0,writable:!0,value:this.origFuncs.key})}watchRow(e){var i=e.getData();for(var n in i)this.watchKey(e,i,n);this.table.options.dataTree&&this.watchTreeChildren(e)}watchTreeChildren(e){var i=this,n=e.getData()[this.table.options.dataTreeChildField],r={};n&&(r.push=n.push,Object.defineProperty(n,"push",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-push");var o=r.push.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-push")}return o}}),r.unshift=n.unshift,Object.defineProperty(n,"unshift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-unshift");var o=r.unshift.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-unshift")}return o}}),r.shift=n.shift,Object.defineProperty(n,"shift",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-shift");var o=r.shift.call(n);this.rebuildTree(e),i.unblock("tree-shift")}return o}}),r.pop=n.pop,Object.defineProperty(n,"pop",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-pop");var o=r.pop.call(n);this.rebuildTree(e),i.unblock("tree-pop")}return o}}),r.splice=n.splice,Object.defineProperty(n,"splice",{enumerable:!1,configurable:!0,value:()=>{if(!i.blocked){i.block("tree-splice");var o=r.splice.apply(n,arguments);this.rebuildTree(e),i.unblock("tree-splice")}return o}}))}rebuildTree(e){this.table.modules.dataTree.initializeRow(e),this.table.modules.dataTree.layoutRow(e),this.table.rowManager.refreshActiveData("tree",!1,!0)}watchKey(e,i,n){var r=this,o=Object.getOwnPropertyDescriptor(i,n),a=i[n],s=this.currentVersion;Object.defineProperty(i,n,{set:l=>{if(a=l,!r.blocked&&s===r.currentVersion){r.block("key");var c={};c[n]=l,e.updateData(c),r.unblock("key")}o.set&&o.set(l)},get:()=>(o.get&&o.get(),a)})}unwatchRow(e){var i=e.getData();for(var n in i)Object.defineProperty(i,n,{value:i[n]})}block(e){this.blocked||(this.blocked=e)}unblock(e){this.blocked===e&&(this.blocked=!1)}}Eve.moduleName="reactiveData";class Mve extends dn{constructor(e){super(e),this.startColumn=!1,this.startX=!1,this.startWidth=!1,this.latestX=!1,this.handle=null,this.initialNextColumn=null,this.nextColumn=null,this.initialized=!1,this.registerColumnOption("resizable",!0),this.registerTableOption("resizableColumnFit",!1)}initialize(){this.subscribe("column-rendered",this.layoutColumnHeader.bind(this))}initializeEventWatchers(){this.initialized||(this.subscribe("cell-rendered",this.layoutCellHandles.bind(this)),this.subscribe("cell-delete",this.deInitializeComponent.bind(this)),this.subscribe("cell-height",this.resizeHandle.bind(this)),this.subscribe("column-moved",this.columnLayoutUpdated.bind(this)),this.subscribe("column-hide",this.deInitializeColumn.bind(this)),this.subscribe("column-show",this.columnLayoutUpdated.bind(this)),this.subscribe("column-width",this.columnWidthUpdated.bind(this)),this.subscribe("column-delete",this.deInitializeComponent.bind(this)),this.subscribe("column-height",this.resizeHandle.bind(this)),this.initialized=!0)}layoutCellHandles(e){e.row.type==="row"&&(this.deInitializeComponent(e),this.initializeColumn("cell",e,e.column,e.element))}layoutColumnHeader(e){e.definition.resizable&&(this.initializeEventWatchers(),this.deInitializeComponent(e),this.initializeColumn("header",e,e,e.element))}columnLayoutUpdated(e){var i=e.prevColumn();this.reinitializeColumn(e),i&&this.reinitializeColumn(i)}columnWidthUpdated(e){e.modules.frozen&&(this.table.modules.frozenColumns.leftColumns.includes(e)?this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.reinitializeColumn(i)}):this.table.modules.frozenColumns.rightColumns.includes(e)&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.reinitializeColumn(i)}))}frozenColumnOffset(e){var i=!1;return e.modules.frozen&&(i=e.modules.frozen.marginValue,e.modules.frozen.position==="left"?i+=e.getWidth()-3:i&&(i-=3)),i!==!1?i+"px":!1}reinitializeColumn(e){var i=this.frozenColumnOffset(e);e.cells.forEach(n=>{n.modules.resize&&n.modules.resize.handleEl&&(i&&(n.modules.resize.handleEl.style[e.modules.frozen.position]=i,n.modules.resize.handleEl.style["z-index"]=11),n.element.after(n.modules.resize.handleEl))}),e.modules.resize&&e.modules.resize.handleEl&&(i&&(e.modules.resize.handleEl.style[e.modules.frozen.position]=i),e.element.after(e.modules.resize.handleEl))}initializeColumn(e,i,n,r){var o=this,a=!1,s=n.definition.resizable,l={},c=n.getLastColumn();if(e==="header"&&(a=n.definition.formatter=="textarea"||n.definition.variableHeight,l={variableHeight:a}),(s===!0||s==e)&&this._checkResizability(c)){var u=document.createElement("span");u.className="tabulator-col-resize-handle",u.addEventListener("click",function(p){p.stopPropagation()});var d=function(p){o.startColumn=n,o.initialNextColumn=o.nextColumn=c.nextColumn(),o._mouseDown(p,c,u)};u.addEventListener("mousedown",d),u.addEventListener("touchstart",d,{passive:!0}),u.addEventListener("dblclick",p=>{var h=c.getWidth();p.stopPropagation(),c.reinitializeWidth(!0),h!==c.getWidth()&&(o.dispatch("column-resized",c),o.table.externalEvents.dispatch("columnResized",c.getComponent()))}),n.modules.frozen&&(u.style.position="sticky",u.style[n.modules.frozen.position]=this.frozenColumnOffset(n)),l.handleEl=u,r.parentNode&&n.visible&&r.after(u)}i.modules.resize=l}deInitializeColumn(e){this.deInitializeComponent(e),e.cells.forEach(i=>{this.deInitializeComponent(i)})}deInitializeComponent(e){var i;e.modules.resize&&(i=e.modules.resize.handleEl,i&&i.parentElement&&i.parentElement.removeChild(i))}resizeHandle(e,i){e.modules.resize&&e.modules.resize.handleEl&&(e.modules.resize.handleEl.style.height=i)}_checkResizability(e){return e.definition.resizable}_mouseDown(e,i,n){var r=this;r.table.element.classList.add("tabulator-block-select");function o(s){var l=typeof s.screenX>"u"?s.touches[0].screenX:s.screenX,c=l-r.startX,u=l-r.latestX,d,p;if(r.latestX=l,r.table.rtl&&(c=-c,u=-u),d=i.width==i.minWidth||i.width==i.maxWidth,i.setWidth(r.startWidth+c),p=i.width==i.minWidth||i.width==i.maxWidth,u<0&&(r.nextColumn=r.initialNextColumn),r.table.options.resizableColumnFit&&r.nextColumn&&!(d&&p)){let h=r.nextColumn.getWidth();u>0&&h<=r.nextColumn.minWidth&&(r.nextColumn=r.nextColumn.nextColumn()),r.nextColumn&&r.nextColumn.setWidth(r.nextColumn.getWidth()-u)}r.table.columnManager.rerenderColumns(!0),!r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights()}function a(s){r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!1),r.table.browserSlow&&i.modules.resize&&i.modules.resize.variableHeight&&i.checkCellHeights(),document.body.removeEventListener("mouseup",a),document.body.removeEventListener("mousemove",o),n.removeEventListener("touchmove",o),n.removeEventListener("touchend",a),r.table.element.classList.remove("tabulator-block-select"),r.startWidth!==i.getWidth()&&(r.table.columnManager.verticalAlignHeaders(),r.dispatch("column-resized",i),r.table.externalEvents.dispatch("columnResized",i.getComponent()))}e.stopPropagation(),r.startColumn.modules.edit&&(r.startColumn.modules.edit.blocked=!0),r.startX=typeof e.screenX>"u"?e.touches[0].screenX:e.screenX,r.latestX=r.startX,r.startWidth=i.getWidth(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",a),n.addEventListener("touchmove",o,{passive:!0}),n.addEventListener("touchend",a)}}Mve.moduleName="resizeColumns";class Rve extends dn{constructor(e){super(e),this.startColumn=!1,this.startY=!1,this.startHeight=!1,this.handle=null,this.prevHandle=null,this.registerTableOption("resizableRows",!1)}initialize(){this.table.options.resizableRows&&this.subscribe("row-layout-after",this.initializeRow.bind(this))}initializeRow(e){var i=this,n=e.getElement(),r=document.createElement("div");r.className="tabulator-row-resize-handle";var o=document.createElement("div");o.className="tabulator-row-resize-handle prev",r.addEventListener("click",function(l){l.stopPropagation()});var a=function(l){i.startRow=e,i._mouseDown(l,e,r)};r.addEventListener("mousedown",a),r.addEventListener("touchstart",a,{passive:!0}),o.addEventListener("click",function(l){l.stopPropagation()});var s=function(l){var c=i.table.rowManager.prevDisplayRow(e);c&&(i.startRow=c,i._mouseDown(l,c,o))};o.addEventListener("mousedown",s),o.addEventListener("touchstart",s,{passive:!0}),n.appendChild(r),n.appendChild(o)}_mouseDown(e,i,n){var r=this;r.table.element.classList.add("tabulator-block-select");function o(s){i.setHeight(r.startHeight+((typeof s.screenY>"u"?s.touches[0].screenY:s.screenY)-r.startY))}function a(s){document.body.removeEventListener("mouseup",o),document.body.removeEventListener("mousemove",o),n.removeEventListener("touchmove",o),n.removeEventListener("touchend",a),r.table.element.classList.remove("tabulator-block-select"),r.dispatchExternal("rowResized",i.getComponent())}e.stopPropagation(),r.startY=typeof e.screenY>"u"?e.touches[0].screenY:e.screenY,r.startHeight=i.getHeight(),document.body.addEventListener("mousemove",o),document.body.addEventListener("mouseup",a),n.addEventListener("touchmove",o,{passive:!0}),n.addEventListener("touchend",a)}}Rve.moduleName="resizeRows";class Nve extends dn{constructor(e){super(e),this.binding=!1,this.visibilityObserver=!1,this.resizeObserver=!1,this.containerObserver=!1,this.tableHeight=0,this.tableWidth=0,this.containerHeight=0,this.containerWidth=0,this.autoResize=!1,this.visible=!1,this.initialized=!1,this.initialRedraw=!1,this.registerTableOption("autoResize",!0)}initialize(){if(this.table.options.autoResize){var e=this.table,i;this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),typeof IntersectionObserver<"u"&&typeof ResizeObserver<"u"&&e.rowManager.getRenderMode()==="virtual"?(this.initializeVisibilityObserver(),this.autoResize=!0,this.resizeObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),o=Math.floor(n[0].contentRect.width);(this.tableHeight!=r||this.tableWidth!=o)&&(this.tableHeight=r,this.tableWidth=o,e.element.parentNode&&(this.containerHeight=e.element.parentNode.clientHeight,this.containerWidth=e.element.parentNode.clientWidth),this.redrawTable())}}),this.resizeObserver.observe(e.element),i=window.getComputedStyle(e.element),this.table.element.parentNode&&!this.table.rowManager.fixedHeight&&(i.getPropertyValue("max-height")||i.getPropertyValue("min-height"))&&(this.containerObserver=new ResizeObserver(n=>{if(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell)){var r=Math.floor(n[0].contentRect.height),o=Math.floor(n[0].contentRect.width);(this.containerHeight!=r||this.containerWidth!=o)&&(this.containerHeight=r,this.containerWidth=o,this.tableHeight=e.element.clientHeight,this.tableWidth=e.element.clientWidth),this.redrawTable()}}),this.containerObserver.observe(this.table.element.parentNode)),this.subscribe("table-resize",this.tableResized.bind(this))):(this.binding=function(){(!e.browserMobile||e.browserMobile&&(!e.modules.edit||e.modules.edit&&!e.modules.edit.currentCell))&&(e.columnManager.rerenderColumns(!0),e.redraw())},window.addEventListener("resize",this.binding)),this.subscribe("table-destroy",this.clearBindings.bind(this))}}initializeVisibilityObserver(){this.visibilityObserver=new IntersectionObserver(e=>{this.visible=e[0].isIntersecting,this.initialized?this.visible&&(this.redrawTable(this.initialRedraw),this.initialRedraw=!1):(this.initialized=!0,this.initialRedraw=!this.visible)}),this.visibilityObserver.observe(this.table.element)}redrawTable(e){this.initialized&&this.visible&&(this.table.columnManager.rerenderColumns(!0),this.table.redraw(e))}tableResized(){this.table.rowManager.redraw()}clearBindings(){this.binding&&window.removeEventListener("resize",this.binding),this.resizeObserver&&this.resizeObserver.unobserve(this.table.element),this.visibilityObserver&&this.visibilityObserver.unobserve(this.table.element),this.containerObserver&&this.containerObserver.unobserve(this.table.element.parentNode)}}Nve.moduleName="resizeTable";class Ave extends dn{constructor(e){super(e),this.columns=[],this.hiddenColumns=[],this.mode="",this.index=0,this.collapseFormatter=[],this.collapseStartOpen=!0,this.collapseHandleColumn=!1,this.registerTableOption("responsiveLayout",!1),this.registerTableOption("responsiveLayoutCollapseStartOpen",!0),this.registerTableOption("responsiveLayoutCollapseUseFormatters",!0),this.registerTableOption("responsiveLayoutCollapseFormatter",!1),this.registerColumnOption("responsive")}initialize(){this.table.options.responsiveLayout&&(this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("column-show",this.updateColumnVisibility.bind(this)),this.subscribe("column-hide",this.updateColumnVisibility.bind(this)),this.subscribe("columns-loaded",this.initializeResponsivity.bind(this)),this.subscribe("column-moved",this.initializeResponsivity.bind(this)),this.subscribe("column-add",this.initializeResponsivity.bind(this)),this.subscribe("column-delete",this.initializeResponsivity.bind(this)),this.subscribe("table-redrawing",this.tableRedraw.bind(this)),this.table.options.responsiveLayout==="collapse"&&(this.subscribe("row-data-changed",this.generateCollapsedRowContent.bind(this)),this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-layout",this.layoutRow.bind(this))))}tableRedraw(e){["fitColumns","fitDataStretch"].indexOf(this.layoutMode())===-1&&(e||this.update())}initializeResponsivity(){var e=[];this.mode=this.table.options.responsiveLayout,this.collapseFormatter=this.table.options.responsiveLayoutCollapseFormatter||this.formatCollapsedData,this.collapseStartOpen=this.table.options.responsiveLayoutCollapseStartOpen,this.hiddenColumns=[],this.table.columnManager.columnsByIndex.forEach((i,n)=>{i.modules.responsive&&i.modules.responsive.order&&i.modules.responsive.visible&&(i.modules.responsive.index=n,e.push(i),!i.visible&&this.mode==="collapse"&&this.hiddenColumns.push(i))}),e=e.reverse(),e=e.sort((i,n)=>{var r=n.modules.responsive.order-i.modules.responsive.order;return r||n.modules.responsive.index-i.modules.responsive.index}),this.columns=e,this.mode==="collapse"&&this.generateCollapsedContent();for(let i of this.table.columnManager.columnsByIndex)if(i.definition.formatter=="responsiveCollapse"){this.collapseHandleColumn=i;break}this.collapseHandleColumn&&(this.hiddenColumns.length?this.collapseHandleColumn.show():this.collapseHandleColumn.hide())}initializeColumn(e){var i=e.getDefinition();e.modules.responsive={order:typeof i.responsive>"u"?1:i.responsive,visible:i.visible!==!1}}initializeRow(e){var i;e.type!=="calc"&&(i=document.createElement("div"),i.classList.add("tabulator-responsive-collapse"),e.modules.responsiveLayout={element:i,open:this.collapseStartOpen},this.collapseStartOpen||(i.style.display="none"))}layoutRow(e){var i=e.getElement();e.modules.responsiveLayout&&(i.appendChild(e.modules.responsiveLayout.element),this.generateCollapsedRowContent(e))}updateColumnVisibility(e,i){!i&&e.modules.responsive&&(e.modules.responsive.visible=e.visible,this.initializeResponsivity())}hideColumn(e){var i=this.hiddenColumns.length;e.hide(!1,!0),this.mode==="collapse"&&(this.hiddenColumns.unshift(e),this.generateCollapsedContent(),this.collapseHandleColumn&&!i&&this.collapseHandleColumn.show())}showColumn(e){var i;e.show(!1,!0),e.setWidth(e.getWidth()),this.mode==="collapse"&&(i=this.hiddenColumns.indexOf(e),i>-1&&this.hiddenColumns.splice(i,1),this.generateCollapsedContent(),this.collapseHandleColumn&&!this.hiddenColumns.length&&this.collapseHandleColumn.hide())}update(){for(var e=!0;e;){let i=this.table.modules.layout.getMode()=="fitColumns"?this.table.columnManager.getFlexBaseWidth():this.table.columnManager.getWidth(),n=(this.table.options.headerVisible?this.table.columnManager.element.clientWidth:this.table.element.clientWidth)-i;if(n<0){let r=this.columns[this.index];r?(this.hideColumn(r),this.index++):e=!1}else{let r=this.columns[this.index-1];r&&n>0&&n>=r.getWidth()?(this.showColumn(r),this.index--):e=!1}this.table.rowManager.activeRowsCount||this.table.rowManager.renderEmptyScroll()}}generateCollapsedContent(){var e=this.table.rowManager.getDisplayRows();e.forEach(i=>{this.generateCollapsedRowContent(i)})}generateCollapsedRowContent(e){var i,n;if(e.modules.responsiveLayout){for(i=e.modules.responsiveLayout.element;i.firstChild;)i.removeChild(i.firstChild);n=this.collapseFormatter(this.generateCollapsedRowData(e)),n&&i.appendChild(n)}}generateCollapsedRowData(e){var i=e.getData(),n=[],r;return this.hiddenColumns.forEach(o=>{var a=o.getFieldValue(i);if(o.definition.title&&o.field)if(o.modules.format&&this.table.options.responsiveLayoutCollapseUseFormatters){let s=function(l){l()};r={value:!1,data:{},getValue:function(){return a},getData:function(){return i},getType:function(){return"cell"},getElement:function(){return document.createElement("div")},getRow:function(){return e.getComponent()},getColumn:function(){return o.getComponent()},getTable:()=>this.table},n.push({field:o.field,title:o.definition.title,value:o.modules.format.formatter.call(this.table.modules.format,r,o.modules.format.params,s)})}else n.push({field:o.field,title:o.definition.title,value:a})}),n}formatCollapsedData(e){var i=document.createElement("table");return e.forEach(function(n){var r=document.createElement("tr"),o=document.createElement("td"),a=document.createElement("td"),s,l=document.createElement("strong");o.appendChild(l),this.langBind("columns|"+n.field,function(c){l.innerHTML=c||n.title}),n.value instanceof Node?(s=document.createElement("div"),s.appendChild(n.value),a.appendChild(s)):a.innerHTML=n.value,r.appendChild(o),r.appendChild(a),i.appendChild(r)},this),Object.keys(e).length?i:""}}Ave.moduleName="responsiveLayout";class _ve extends dn{constructor(e){super(e),this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],this.headerCheckboxElement=null,this.registerTableOption("selectableRows","highlight"),this.registerTableOption("selectableRowsRangeMode","drag"),this.registerTableOption("selectableRowsRollingSelection",!0),this.registerTableOption("selectableRowsPersistence",!0),this.registerTableOption("selectableRowsCheck",function(i,n){return!0}),this.registerTableFunction("selectRow",this.selectRows.bind(this)),this.registerTableFunction("deselectRow",this.deselectRows.bind(this)),this.registerTableFunction("toggleSelectRow",this.toggleRow.bind(this)),this.registerTableFunction("getSelectedRows",this.getSelectedRows.bind(this)),this.registerTableFunction("getSelectedData",this.getSelectedData.bind(this)),this.registerComponentFunction("row","select",this.selectRows.bind(this)),this.registerComponentFunction("row","deselect",this.deselectRows.bind(this)),this.registerComponentFunction("row","toggleSelect",this.toggleRow.bind(this)),this.registerComponentFunction("row","isSelected",this.isRowSelected.bind(this))}initialize(){this.deprecatedOptionsCheck(),this.table.options.selectableRows==="highlight"&&this.table.options.selectableRange&&(this.table.options.selectableRows=!1),this.table.options.selectableRows!==!1&&(this.subscribe("row-init",this.initializeRow.bind(this)),this.subscribe("row-deleting",this.rowDeleted.bind(this)),this.subscribe("rows-wipe",this.clearSelectionData.bind(this)),this.subscribe("rows-retrieve",this.rowRetrieve.bind(this)),this.table.options.selectableRows&&!this.table.options.selectableRowsPersistence&&this.subscribe("data-refreshing",this.deselectRows.bind(this)))}deprecatedOptionsCheck(){this.deprecationCheck("selectable","selectableRows",!0),this.deprecationCheck("selectableRollingSelection","selectableRowsRollingSelection",!0),this.deprecationCheck("selectableRangeMode","selectableRowsRangeMode",!0),this.deprecationCheck("selectablePersistence","selectableRowsPersistence",!0),this.deprecationCheck("selectableCheck","selectableRowsCheck",!0)}rowRetrieve(e,i){return e==="selected"?this.selectedRows:i}rowDeleted(e){this._deselectRow(e,!0)}clearSelectionData(e){var i=this.selectedRows.length;this.selecting=!1,this.lastClickedRow=!1,this.selectPrev=[],this.selectedRows=[],i&&e!==!0&&this._rowSelectionChanged()}initializeRow(e){var i=this,n=i.checkRowSelectability(e),r=e.getElement(),o=function(){setTimeout(function(){i.selecting=!1},50),document.body.removeEventListener("mouseup",o)};e.modules.select={selected:!1},r.classList.toggle("tabulator-selectable",n),r.classList.toggle("tabulator-unselectable",!n),i.checkRowSelectability(e)&&i.table.options.selectableRows&&i.table.options.selectableRows!="highlight"&&(i.table.options.selectableRowsRangeMode==="click"?r.addEventListener("click",this.handleComplexRowClick.bind(this,e)):(r.addEventListener("click",function(a){(!i.table.modExists("edit")||!i.table.modules.edit.getCurrentCell())&&i.table._clearSelection(),i.selecting||i.toggleRow(e)}),r.addEventListener("mousedown",function(a){if(a.shiftKey)return i.table._clearSelection(),i.selecting=!0,i.selectPrev=[],document.body.addEventListener("mouseup",o),document.body.addEventListener("keyup",o),i.toggleRow(e),!1}),r.addEventListener("mouseenter",function(a){i.selecting&&(i.table._clearSelection(),i.toggleRow(e),i.selectPrev[1]==e&&i.toggleRow(i.selectPrev[0]))}),r.addEventListener("mouseout",function(a){i.selecting&&(i.table._clearSelection(),i.selectPrev.unshift(e))})))}handleComplexRowClick(e,i){if(i.shiftKey){this.table._clearSelection(),this.lastClickedRow=this.lastClickedRow||e;var n=this.table.rowManager.getDisplayRowIndex(this.lastClickedRow),r=this.table.rowManager.getDisplayRowIndex(e),o=n<=r?n:r,a=n>=r?n:r,s=this.table.rowManager.getDisplayRows().slice(0),l=s.splice(o,a-o+1);i.ctrlKey||i.metaKey?(l.forEach(c=>{c!==this.lastClickedRow&&(this.table.options.selectableRows!==!0&&!this.isRowSelected(e)?this.selectedRows.length<this.table.options.selectableRows&&this.toggleRow(c):this.toggleRow(c))}),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.table.options.selectableRows!==!0&&l.length>this.table.options.selectableRows&&(l=l.slice(0,this.table.options.selectableRows)),this.selectRows(l)),this.table._clearSelection()}else i.ctrlKey||i.metaKey?(this.toggleRow(e),this.lastClickedRow=e):(this.deselectRows(void 0,!0),this.selectRows(e),this.lastClickedRow=e)}checkRowSelectability(e){return e&&e.type==="row"?this.table.options.selectableRowsCheck.call(this.table,e.getComponent()):!1}toggleRow(e){this.checkRowSelectability(e)&&(e.modules.select&&e.modules.select.selected?this._deselectRow(e):this._selectRow(e))}selectRows(e){var i=[],n,r;switch(typeof e){case"undefined":n=this.table.rowManager.rows;break;case"number":n=this.table.rowManager.findRow(e);break;case"string":n=this.table.rowManager.findRow(e),n||(n=this.table.rowManager.getRows(e));break;default:n=e;break}Array.isArray(n)?n.length&&(n.forEach(o=>{r=this._selectRow(o,!0,!0),r&&i.push(r)}),this._rowSelectionChanged(!1,i)):n&&this._selectRow(n,!1,!0)}_selectRow(e,i,n){if(!isNaN(this.table.options.selectableRows)&&this.table.options.selectableRows!==!0&&!n&&this.selectedRows.length>=this.table.options.selectableRows)if(this.table.options.selectableRowsRollingSelection)this._deselectRow(this.selectedRows[0]);else return!1;var r=this.table.rowManager.findRow(e);if(r){if(this.selectedRows.indexOf(r)==-1)return r.getElement().classList.add("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!0,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!0),this.selectedRows.push(r),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!0),this.dispatchExternal("rowSelected",r.getComponent()),this._rowSelectionChanged(i,r),r}else i||console.warn("Selection Error - No such row found, ignoring selection:"+e)}isRowSelected(e){return this.selectedRows.indexOf(e)!==-1}deselectRows(e,i){var n=[],r,o;switch(typeof e){case"undefined":r=Object.assign([],this.selectedRows);break;case"number":r=this.table.rowManager.findRow(e);break;case"string":r=this.table.rowManager.findRow(e),r||(r=this.table.rowManager.getRows(e));break;default:r=e;break}Array.isArray(r)?r.length&&(r.forEach(a=>{o=this._deselectRow(a,!0,!0),o&&n.push(o)}),this._rowSelectionChanged(i,[],n)):r&&this._deselectRow(r,i,!0)}_deselectRow(e,i){var n=this,r=n.table.rowManager.findRow(e),o,a;if(r){if(o=n.selectedRows.findIndex(function(s){return s==r}),o>-1)return a=r.getElement(),a&&a.classList.remove("tabulator-selected"),r.modules.select||(r.modules.select={}),r.modules.select.selected=!1,r.modules.select.checkboxEl&&(r.modules.select.checkboxEl.checked=!1),n.selectedRows.splice(o,1),this.table.options.dataTreeSelectPropagate&&this.childRowSelection(r,!1),this.dispatchExternal("rowDeselected",r.getComponent()),n._rowSelectionChanged(i,void 0,r),r}else i||console.warn("Deselection Error - No such row found, ignoring selection:"+e)}getSelectedData(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getData())}),e}getSelectedRows(){var e=[];return this.selectedRows.forEach(function(i){e.push(i.getComponent())}),e}_rowSelectionChanged(e,i=[],n=[]){this.headerCheckboxElement&&(this.selectedRows.length===0?(this.headerCheckboxElement.checked=!1,this.headerCheckboxElement.indeterminate=!1):this.table.rowManager.rows.length===this.selectedRows.length?(this.headerCheckboxElement.checked=!0,this.headerCheckboxElement.indeterminate=!1):(this.headerCheckboxElement.indeterminate=!0,this.headerCheckboxElement.checked=!1)),e||(Array.isArray(i)||(i=[i]),i=i.map(r=>r.getComponent()),Array.isArray(n)||(n=[n]),n=n.map(r=>r.getComponent()),this.dispatchExternal("rowSelectionChanged",this.getSelectedData(),this.getSelectedRows(),i,n))}registerRowSelectCheckbox(e,i){e._row.modules.select||(e._row.modules.select={}),e._row.modules.select.checkboxEl=i}registerHeaderSelectCheckbox(e){this.headerCheckboxElement=e}childRowSelection(e,i){var n=this.table.modules.dataTree.getChildren(e,!0);if(i)for(let r of n)this._selectRow(r,!0);else for(let r of n)this._deselectRow(r,!0)}}_ve.moduleName="selectRow";function nHe(t,e,i,n,r,o,a){var s=a.alignEmptyValues,l=a.decimalSeparator,c=a.thousandSeparator,u=0;if(t=String(t),e=String(e),c&&(t=t.split(c).join(""),e=e.split(c).join("")),l&&(t=t.split(l).join("."),e=e.split(l).join(".")),t=parseFloat(t),e=parseFloat(e),isNaN(t))u=isNaN(e)?0:-1;else if(isNaN(e))u=1;else return t-e;return(s==="top"&&o==="desc"||s==="bottom"&&o==="asc")&&(u*=-1),u}function rHe(t,e,i,n,r,o,a){var s=a.alignEmptyValues,l=0,c;if(!t)l=e?-1:0;else if(!e)l=1;else{switch(typeof a.locale){case"boolean":a.locale&&(c=this.langLocale());break;case"string":c=a.locale;break}return String(t).toLowerCase().localeCompare(String(e).toLowerCase(),c)}return(s==="top"&&o==="desc"||s==="bottom"&&o==="asc")&&(l*=-1),l}function w4(t,e,i,n,r,o,a){var s=window.DateTime||luxon.DateTime,l=a.format||"dd/MM/yyyy HH:mm:ss",c=a.alignEmptyValues,u=0;if(typeof s<"u"){if(s.isDateTime(t)||(l==="iso"?t=s.fromISO(String(t)):t=s.fromFormat(String(t),l)),s.isDateTime(e)||(l==="iso"?e=s.fromISO(String(e)):e=s.fromFormat(String(e),l)),!t.isValid)u=e.isValid?-1:0;else if(!e.isValid)u=1;else return t-e;return(c==="top"&&o==="desc"||c==="bottom"&&o==="asc")&&(u*=-1),u}else console.error("Sort Error - 'datetime' sorter is dependant on luxon.js")}function oHe(t,e,i,n,r,o,a){return a.format||(a.format="dd/MM/yyyy"),w4.call(this,t,e,i,n,r,o,a)}function aHe(t,e,i,n,r,o,a){return a.format||(a.format="HH:mm"),w4.call(this,t,e,i,n,r,o,a)}function sHe(t,e,i,n,r,o,a){var s=t===!0||t==="true"||t==="True"||t===1?1:0,l=e===!0||e==="true"||e==="True"||e===1?1:0;return s-l}function lHe(t,e,i,n,r,o,a){var s=a.type||"length",l=a.alignEmptyValues,c=0;function u(d){var p;switch(s){case"length":p=d.length;break;case"sum":p=d.reduce(function(h,f){return h+f});break;case"max":p=Math.max.apply(null,d);break;case"min":p=Math.min.apply(null,d);break;case"avg":p=d.reduce(function(h,f){return h+f})/d.length;break}return p}if(!Array.isArray(t))c=Array.isArray(e)?-1:0;else if(!Array.isArray(e))c=1;else return u(e)-u(t);return(l==="top"&&o==="desc"||l==="bottom"&&o==="asc")&&(c*=-1),c}function cHe(t,e,i,n,r,o,a){var s=typeof t>"u"?0:1,l=typeof e>"u"?0:1;return s-l}function uHe(t,e,i,n,r,o,a){var s,l,c,u,d=0,p,h=/(\d+)|(\D+)/g,f=/\d/,m=a.alignEmptyValues,g=0;if(!t&&t!==0)g=!e&&e!==0?0:-1;else if(!e&&e!==0)g=1;else{if(isFinite(t)&&isFinite(e))return t-e;if(s=String(t).toLowerCase(),l=String(e).toLowerCase(),s===l)return 0;if(!(f.test(s)&&f.test(l)))return s>l?1:-1;for(s=s.match(h),l=l.match(h),p=s.length>l.length?l.length:s.length;d<p;)if(c=s[d],u=l[d++],c!==u)return isFinite(c)&&isFinite(u)?(c.charAt(0)==="0"&&(c="."+c),u.charAt(0)==="0"&&(u="."+u),c-u):c>u?1:-1;return s.length>l.length}return(m==="top"&&o==="desc"||m==="bottom"&&o==="asc")&&(g*=-1),g}var dHe={number:nHe,string:rHe,date:oHe,time:aHe,datetime:w4,boolean:sHe,array:lHe,exists:cHe,alphanum:uHe};class Rv extends dn{constructor(e){super(e),this.sortList=[],this.changed=!1,this.registerTableOption("sortMode","local"),this.registerTableOption("initialSort",!1),this.registerTableOption("columnHeaderSortMulti",!0),this.registerTableOption("sortOrderReverse",!1),this.registerTableOption("headerSortElement","<div class='tabulator-arrow'></div>"),this.registerTableOption("headerSortClickElement","header"),this.registerColumnOption("sorter"),this.registerColumnOption("sorterParams"),this.registerColumnOption("headerSort",!0),this.registerColumnOption("headerSortStartingDir"),this.registerColumnOption("headerSortTristate")}initialize(){this.subscribe("column-layout",this.initializeColumn.bind(this)),this.subscribe("table-built",this.tableBuilt.bind(this)),this.registerDataHandler(this.sort.bind(this),20),this.registerTableFunction("setSort",this.userSetSort.bind(this)),this.registerTableFunction("getSorters",this.getSort.bind(this)),this.registerTableFunction("clearSort",this.clearSort.bind(this)),this.table.options.sortMode==="remote"&&this.subscribe("data-params",this.remoteSortParams.bind(this))}tableBuilt(){this.table.options.initialSort&&this.setSort(this.table.options.initialSort)}remoteSortParams(e,i,n,r){var o=this.getSort();return o.forEach(a=>{delete a.column}),r.sort=o,r}userSetSort(e,i){this.setSort(e,i),this.refreshSort()}clearSort(){this.clear(),this.refreshSort()}initializeColumn(e){var i=!1,n,r;switch(typeof e.definition.sorter){case"string":Rv.sorters[e.definition.sorter]?i=Rv.sorters[e.definition.sorter]:console.warn("Sort Error - No such sorter found: ",e.definition.sorter);break;case"function":i=e.definition.sorter;break}if(e.modules.sort={sorter:i,dir:"none",params:e.definition.sorterParams||{},startingDir:e.definition.headerSortStartingDir||"asc",tristate:e.definition.headerSortTristate},e.definition.headerSort!==!1){switch(n=e.getElement(),n.classList.add("tabulator-sortable"),r=document.createElement("div"),r.classList.add("tabulator-col-sorter"),this.table.options.headerSortClickElement){case"icon":r.classList.add("tabulator-col-sorter-element");break;case"header":n.classList.add("tabulator-col-sorter-element");break;default:n.classList.add("tabulator-col-sorter-element");break}switch(this.table.options.headerSortElement){case"function":break;case"object":r.appendChild(this.table.options.headerSortElement);break;default:r.innerHTML=this.table.options.headerSortElement}e.titleHolderElement.appendChild(r),e.modules.sort.element=r,this.setColumnHeaderSortIcon(e,"none"),this.table.options.headerSortClickElement==="icon"&&r.addEventListener("mousedown",o=>{o.stopPropagation()}),(this.table.options.headerSortClickElement==="icon"?r:n).addEventListener("click",o=>{var a="",s=[],l=!1;if(e.modules.sort){if(e.modules.sort.tristate)e.modules.sort.dir=="none"?a=e.modules.sort.startingDir:e.modules.sort.dir==e.modules.sort.startingDir?a=e.modules.sort.dir=="asc"?"desc":"asc":a="none";else switch(e.modules.sort.dir){case"asc":a="desc";break;case"desc":a="asc";break;default:a=e.modules.sort.startingDir}this.table.options.columnHeaderSortMulti&&(o.shiftKey||o.ctrlKey)?(s=this.getSort(),l=s.findIndex(c=>c.field===e.getField()),l>-1?(s[l].dir=a,l=s.splice(l,1)[0],a!="none"&&s.push(l)):a!="none"&&s.push({column:e,dir:a}),this.setSort(s)):a=="none"?this.clear():this.setSort(e,a),this.refreshSort()}})}}refreshSort(){this.table.options.sortMode==="remote"?this.reloadData(null,!1,!1):this.refreshData(!0)}hasChanged(){var e=this.changed;return this.changed=!1,e}getSort(){var e=this,i=[];return e.sortList.forEach(function(n){n.column&&i.push({column:n.column.getComponent(),field:n.column.getField(),dir:n.dir})}),i}setSort(e,i){var n=this,r=[];Array.isArray(e)||(e=[{column:e,dir:i}]),e.forEach(function(o){var a;a=n.table.columnManager.findColumn(o.column),a?(o.column=a,r.push(o),n.changed=!0):console.warn("Sort Warning - Sort field does not exist and is being ignored: ",o.column)}),n.sortList=r,this.dispatch("sort-changed")}clear(){this.setSort([])}findSorter(e){var i=this.table.rowManager.activeRows[0],n="string",r,o;if(i&&(i=i.getData(),r=e.getField(),r))switch(o=e.getFieldValue(i),typeof o){case"undefined":n="string";break;case"boolean":n="boolean";break;default:!isNaN(o)&&o!==""?n="number":o.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)&&(n="alphanum");break}return Rv.sorters[n]}sort(e){var i=this,n=this.table.options.sortOrderReverse?i.sortList.slice().reverse():i.sortList,r=[],o=[];return this.subscribedExternal("dataSorting")&&this.dispatchExternal("dataSorting",i.getSort()),i.clearColumnHeaders(),this.table.options.sortMode!=="remote"?(n.forEach(function(a,s){var l;a.column&&(l=a.column.modules.sort,l&&(l.sorter||(l.sorter=i.findSorter(a.column)),a.params=typeof l.params=="function"?l.params(a.column.getComponent(),a.dir):l.params,r.push(a)),i.setColumnHeader(a.column,a.dir))}),r.length&&i._sortItems(e,r)):n.forEach(function(a,s){i.setColumnHeader(a.column,a.dir)}),this.subscribedExternal("dataSorted")&&(e.forEach(a=>{o.push(a.getComponent())}),this.dispatchExternal("dataSorted",i.getSort(),o)),e}clearColumnHeaders(){this.table.columnManager.getRealColumns().forEach(e=>{e.modules.sort&&(e.modules.sort.dir="none",e.getElement().setAttribute("aria-sort","none"),this.setColumnHeaderSortIcon(e,"none"))})}setColumnHeader(e,i){e.modules.sort.dir=i,e.getElement().setAttribute("aria-sort",i==="asc"?"ascending":"descending"),this.setColumnHeaderSortIcon(e,i)}setColumnHeaderSortIcon(e,i){var n=e.modules.sort.element,r;if(e.definition.headerSort&&typeof this.table.options.headerSortElement=="function"){for(;n.firstChild;)n.removeChild(n.firstChild);r=this.table.options.headerSortElement.call(this.table,e.getComponent(),i),typeof r=="object"?n.appendChild(r):n.innerHTML=r}}_sortItems(e,i){var n=i.length-1;e.sort((r,o)=>{for(var a,s=n;s>=0;s--){let l=i[s];if(a=this._sortRow(r,o,l.column,l.dir,l.params),a!==0)break}return a})}_sortRow(e,i,n,r,o){var a,s,l=r=="asc"?e:i,c=r=="asc"?i:e;return e=n.getFieldValue(l.getData()),i=n.getFieldValue(c.getData()),e=typeof e<"u"?e:"",i=typeof i<"u"?i:"",a=l.getComponent(),s=c.getComponent(),n.modules.sort.sorter.call(this,e,i,a,s,n.getComponent(),r,o)}}Rv.moduleName="sort";Rv.sorters=dHe;class pHe{constructor(e){return this._range=e,new Proxy(this,{get:function(i,n,r){return typeof i[n]<"u"?i[n]:i._range.table.componentFunctionBinder.handle("range",i._range,n)}})}getElement(){return this._range.element}getData(){return this._range.getData()}getCells(){return this._range.getCells(!0)}getStructuredCells(){return this._range.getStructuredCells()}getRows(){return this._range.getRows().map(e=>e.getComponent())}getColumns(){return this._range.getColumns().map(e=>e.getComponent())}getBounds(){return this._range.getBounds()}getTopEdge(){return this._range.top}getBottomEdge(){return this._range.bottom}getLeftEdge(){return this._range.left}getRightEdge(){return this._range.right}setBounds(e,i){this._range.destroyedGuard("setBounds")&&this._range.setBounds(e&&e._cell,i&&i._cell)}setStartBound(e){this._range.destroyedGuard("setStartBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}setEndBound(e){this._range.destroyedGuard("setEndBound")&&(this._range.setEndBound(e&&e._cell),this._range.rangeManager.layoutElement())}clearValues(){this._range.destroyedGuard("clearValues")&&this._range.clearValues()}remove(){this._range.destroyedGuard("remove")&&this._range.destroy(!0)}}class hHe extends yl{constructor(e,i,n,r){super(e),this.rangeManager=i,this.element=null,this.initialized=!1,this.initializing={start:!1,end:!1},this.destroyed=!1,this.top=0,this.bottom=0,this.left=0,this.right=0,this.table=e,this.start={row:0,col:0},this.end={row:0,col:0},this.rangeManager.rowHeader&&(this.left=1,this.right=1,this.start.col=1,this.end.col=1),this.initElement(),setTimeout(()=>{this.initBounds(n,r)})}initElement(){this.element=document.createElement("div"),this.element.classList.add("tabulator-range")}initBounds(e,i){this._updateMinMax(),e&&this.setBounds(e,i||e)}setStart(e,i){(this.start.row!==e||this.start.col!==i)&&(this.start.row=e,this.start.col=i,this.initializing.start=!0,this._updateMinMax())}setEnd(e,i){(this.end.row!==e||this.end.col!==i)&&(this.end.row=e,this.end.col=i,this.initializing.end=!0,this._updateMinMax())}setBounds(e,i,n){e&&this.setStartBound(e),this.setEndBound(i||e),this.rangeManager.layoutElement(n)}setStartBound(e){var i,n;e.type==="column"?this.rangeManager.columnSelection&&this.setStart(0,e.getPosition()-1):(i=e.row.position-1,n=e.column.getPosition()-1,e.column===this.rangeManager.rowHeader?this.setStart(i,1):this.setStart(i,n))}setEndBound(e){var i=this._getTableRows().length,n,r,o;e.type==="column"?this.rangeManager.columnSelection&&(this.rangeManager.selecting==="column"?this.setEnd(i-1,e.getPosition()-1):this.rangeManager.selecting==="cell"&&this.setEnd(0,e.getPosition()-1)):(n=e.row.position-1,r=e.column.getPosition()-1,o=e.column===this.rangeManager.rowHeader,this.rangeManager.selecting==="row"?this.setEnd(n,this._getTableColumns().length-1):this.rangeManager.selecting!=="row"&&o?this.setEnd(n,0):this.rangeManager.selecting==="column"?this.setEnd(i-1,r):this.setEnd(n,r))}_updateMinMax(){this.top=Math.min(this.start.row,this.end.row),this.bottom=Math.max(this.start.row,this.end.row),this.left=Math.min(this.start.col,this.end.col),this.right=Math.max(this.start.col,this.end.col),this.initialized?this.dispatchExternal("rangeChanged",this.getComponent()):this.initializing.start&&this.initializing.end&&(this.initialized=!0,this.dispatchExternal("rangeAdded",this.getComponent()))}_getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}_getTableRows(){return this.table.rowManager.getDisplayRows()}layout(){var e=this.table.rowManager.renderer.vDomTop,i=this.table.rowManager.renderer.vDomBottom,n=this.table.columnManager.renderer.leftCol,r=this.table.columnManager.renderer.rightCol,o,a,s,l,c,u;e==null&&(e=0),i==null&&(i=1/0),n==null&&(n=0),r==null&&(r=1/0),this.overlaps(n,e,r,i)&&(o=Math.max(this.top,e),a=Math.min(this.bottom,i),s=Math.max(this.left,n),l=Math.min(this.right,r),c=this.rangeManager.getCell(o,s),u=this.rangeManager.getCell(a,l),this.element.classList.add("tabulator-range-active"),this.element.style.left=c.row.getElement().offsetLeft+c.getElement().offsetLeft+"px",this.element.style.top=c.row.getElement().offsetTop+"px",this.element.style.width=u.getElement().offsetLeft+u.getElement().offsetWidth-c.getElement().offsetLeft+"px",this.element.style.height=u.row.getElement().offsetTop+u.row.getElement().offsetHeight-c.row.getElement().offsetTop+"px")}atTopLeft(e){return e.row.position-1===this.top&&e.column.getPosition()-1===this.left}atBottomRight(e){return e.row.position-1===this.bottom&&e.column.getPosition()-1===this.right}occupies(e){return this.occupiesRow(e.row)&&this.occupiesColumn(e.column)}occupiesRow(e){return this.top<=e.position-1&&e.position-1<=this.bottom}occupiesColumn(e){return this.left<=e.getPosition()-1&&e.getPosition()-1<=this.right}overlaps(e,i,n,r){return!(this.left>n||e>this.right||this.top>r||i>this.bottom)}getData(){var e=[],i=this.getRows(),n=this.getColumns();return i.forEach(r=>{var o=r.getData(),a={};n.forEach(s=>{a[s.field]=o[s.field]}),e.push(a)}),e}getCells(e,i){var n=[],r=this.getRows(),o=this.getColumns();return e?n=r.map(a=>{var s=[];return a.getCells().forEach(l=>{o.includes(l.column)&&s.push(i?l.getComponent():l)}),s}):r.forEach(a=>{a.getCells().forEach(s=>{o.includes(s.column)&&n.push(i?s.getComponent():s)})}),n}getStructuredCells(){return this.getCells(!0,!0)}getRows(){return this._getTableRows().slice(this.top,this.bottom+1)}getColumns(){return this._getTableColumns().slice(this.left,this.right+1)}clearValues(){var e=this.getCells(),i=this.table.options.selectableRangeClearCellsValue;this.table.blockRedraw(),e.forEach(n=>{n.setValue(i)}),this.table.restoreRedraw()}getBounds(e){var i=this.getCells(!1,e),n={start:null,end:null};return i.length?(n.start=i[0],n.end=i[i.length-1]):console.warn("No bounds defined on range"),n}getComponent(){return this.component||(this.component=new pHe(this)),this.component}destroy(e){this.destroyed=!0,this.element.remove(),e&&this.rangeManager.rangeRemoved(this),this.initialized&&this.dispatchExternal("rangeRemoved",this.getComponent())}destroyedGuard(e){return this.destroyed&&console.warn("You cannot call the "+e+" function on a destroyed range"),!this.destroyed}}class kve extends dn{constructor(e){super(e),this.selecting="cell",this.mousedown=!1,this.ranges=[],this.overlay=null,this.rowHeader=null,this.layoutChangeTimeout=null,this.columnSelection=!1,this.rowSelection=!1,this.maxRanges=0,this.activeRange=!1,this.blockKeydown=!1,this.keyDownEvent=this._handleKeyDown.bind(this),this.mouseUpEvent=this._handleMouseUp.bind(this),this.registerTableOption("selectableRange",!1),this.registerTableOption("selectableRangeColumns",!1),this.registerTableOption("selectableRangeRows",!1),this.registerTableOption("selectableRangeClearCells",!1),this.registerTableOption("selectableRangeClearCellsValue",void 0),this.registerTableFunction("getRangesData",this.getRangesData.bind(this)),this.registerTableFunction("getRanges",this.getRanges.bind(this)),this.registerTableFunction("addRange",this.addRangeFromComponent.bind(this)),this.registerComponentFunction("cell","getRanges",this.cellGetRanges.bind(this)),this.registerComponentFunction("row","getRanges",this.rowGetRanges.bind(this)),this.registerComponentFunction("column","getRanges",this.colGetRanges.bind(this))}initialize(){this.options("selectableRange")&&(this.options("selectableRows")?console.warn("SelectRange functionality cannot be used in conjunction with row selection"):(this.maxRanges=this.options("selectableRange"),this.initializeTable(),this.initializeWatchers()))}initializeTable(){this.overlay=document.createElement("div"),this.overlay.classList.add("tabulator-range-overlay"),this.rangeContainer=document.createElement("div"),this.rangeContainer.classList.add("tabulator-range-container"),this.activeRangeCellElement=document.createElement("div"),this.activeRangeCellElement.classList.add("tabulator-range-cell-active"),this.overlay.appendChild(this.rangeContainer),this.overlay.appendChild(this.activeRangeCellElement),this.table.rowManager.element.addEventListener("keydown",this.keyDownEvent),this.resetRanges(),this.table.rowManager.element.appendChild(this.overlay),this.table.columnManager.element.setAttribute("tabindex",0),this.table.element.classList.add("tabulator-ranges")}initializeWatchers(){this.columnSelection=this.options("selectableRangeColumns"),this.rowSelection=this.options("selectableRangeRows"),this.subscribe("column-init",this.initializeColumn.bind(this)),this.subscribe("column-mousedown",this.handleColumnMouseDown.bind(this)),this.subscribe("column-mousemove",this.handleColumnMouseMove.bind(this)),this.subscribe("column-resized",this.handleColumnResized.bind(this)),this.subscribe("column-width",this.layoutChange.bind(this)),this.subscribe("column-height",this.layoutChange.bind(this)),this.subscribe("column-resized",this.layoutChange.bind(this)),this.subscribe("columns-loaded",this.updateHeaderColumn.bind(this)),this.subscribe("cell-height",this.layoutChange.bind(this)),this.subscribe("cell-rendered",this.renderCell.bind(this)),this.subscribe("cell-mousedown",this.handleCellMouseDown.bind(this)),this.subscribe("cell-mousemove",this.handleCellMouseMove.bind(this)),this.subscribe("cell-click",this.handleCellClick.bind(this)),this.subscribe("cell-editing",this.handleEditingCell.bind(this)),this.subscribe("page-changed",this.redraw.bind(this)),this.subscribe("scroll-vertical",this.layoutChange.bind(this)),this.subscribe("scroll-horizontal",this.layoutChange.bind(this)),this.subscribe("data-destroy",this.tableDestroyed.bind(this)),this.subscribe("data-processed",this.resetRanges.bind(this)),this.subscribe("table-layout",this.layoutElement.bind(this)),this.subscribe("table-redraw",this.redraw.bind(this)),this.subscribe("table-destroy",this.tableDestroyed.bind(this)),this.subscribe("edit-editor-clear",this.finishEditingCell.bind(this)),this.subscribe("edit-blur",this.restoreFocus.bind(this)),this.subscribe("keybinding-nav-prev",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-next",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-left",this.keyNavigate.bind(this,"left")),this.subscribe("keybinding-nav-right",this.keyNavigate.bind(this,"right")),this.subscribe("keybinding-nav-up",this.keyNavigate.bind(this,"up")),this.subscribe("keybinding-nav-down",this.keyNavigate.bind(this,"down")),this.subscribe("keybinding-nav-range",this.keyNavigateRange.bind(this))}initializeColumn(e){this.columnSelection&&e.definition.headerSort&&this.options("headerSortClickElement")!=="icon"&&console.warn("Using column headerSort with selectableRangeColumns option may result in unpredictable behavior. Consider using headerSortClickElement: 'icon'."),e.modules.edit}updateHeaderColumn(){this.rowSelection&&(this.rowHeader=this.table.columnManager.getVisibleColumnsByIndex()[0],this.rowHeader&&(this.rowHeader.definition.cssClass=this.rowHeader.definition.cssClass+" tabulator-range-row-header",this.rowHeader.definition.headerSort&&console.warn("Using column headerSort with selectableRangeRows option may result in unpredictable behavior"),this.rowHeader.definition.editor&&console.warn("Using column editor with selectableRangeRows option may result in unpredictable behavior")))}getRanges(){return this.ranges.map(e=>e.getComponent())}getRangesData(){return this.ranges.map(e=>e.getData())}addRangeFromComponent(e,i){return e=e?e._cell:null,i=i?i._cell:null,this.addRange(e,i)}cellGetRanges(e){var i=[];return e.column===this.rowHeader?i=this.ranges.filter(n=>n.occupiesRow(e.row)):i=this.ranges.filter(n=>n.occupies(e)),i.map(n=>n.getComponent())}rowGetRanges(e){var i=this.ranges.filter(n=>n.occupiesRow(e));return i.map(n=>n.getComponent())}colGetRanges(e){var i=this.ranges.filter(n=>n.occupiesColumn(e));return i.map(n=>n.getComponent())}_handleMouseUp(e){this.mousedown=!1,document.removeEventListener("mouseup",this.mouseUpEvent)}_handleKeyDown(e){if(!this.blockKeydown&&(!this.table.modules.edit||this.table.modules.edit&&!this.table.modules.edit.currentCell)){if(e.key==="Enter"){if(this.table.modules.edit&&this.table.modules.edit.currentCell)return;this.table.modules.edit.editCell(this.getActiveCell()),e.preventDefault()}(e.key==="Backspace"||e.key==="Delete")&&this.options("selectableRangeClearCells")&&this.activeRange&&this.activeRange.clearValues()}}initializeFocus(e){var i;try{document.selection?(i=document.body.createTextRange(),i.moveToElementText(e.getElement()),i.select()):window.getSelection&&(i=document.createRange(),i.selectNode(e.getElement()),window.getSelection().removeAllRanges(),window.getSelection().addRange(i))}catch{}}restoreFocus(e){return this.table.rowManager.element.focus(),!0}handleColumnResized(e){var i;this.selecting!=="column"&&this.selecting!=="all"||(i=this.ranges.some(n=>n.occupiesColumn(e)),i&&this.ranges.forEach(n=>{var r=n.getColumns(!0);r.forEach(o=>{o!==e&&o.setWidth(e.width)})}))}handleColumnMouseDown(e,i){e.button===2&&(this.selecting==="column"||this.selecting==="all")&&this.activeRange.occupiesColumn(i)||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleColumnMouseMove(e,i){i===this.rowHeader||!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}renderCell(e){var i=e.getElement(),n=this.ranges.findIndex(r=>r.occupies(e));i.classList.toggle("tabulator-range-selected",n!==-1),i.classList.toggle("tabulator-range-only-cell-selected",this.ranges.length===1&&this.ranges[0].atTopLeft(e)&&this.ranges[0].atBottomRight(e)),i.dataset.range=n}handleCellMouseDown(e,i){e.button===2&&(this.activeRange.occupies(i)||(this.selecting==="row"||this.selecting==="all")&&this.activeRange.occupiesRow(i.row))||(this.mousedown=!0,document.addEventListener("mouseup",this.mouseUpEvent),this.newSelection(e,i))}handleCellMouseMove(e,i){!this.mousedown||this.selecting==="all"||this.activeRange.setBounds(!1,i,!0)}handleCellClick(e,i){this.initializeFocus(i)}handleEditingCell(e){this.activeRange&&this.activeRange.setBounds(e)}finishEditingCell(){this.blockKeydown=!0,this.table.rowManager.element.focus(),setTimeout(()=>{this.blockKeydown=!1},10)}keyNavigate(e,i){this.navigate(!1,!1,e)&&i.preventDefault()}keyNavigateRange(e,i,n,r){this.navigate(n,r,i)&&e.preventDefault()}navigate(e,i,n){var r=!1,o,a,s,l,c,u;if(this.table.modules.edit&&this.table.modules.edit.currentCell)return!1;if(this.ranges.length>1&&(this.ranges=this.ranges.filter(d=>d===this.activeRange?(d.setEnd(d.start.row,d.start.col),!0):(d.destroy(),!1))),o=this.activeRange,a=i?o.end:o.start,s=a.row,l=a.col,e)switch(n){case"left":l=this.findJumpCellLeft(o.start.row,a.col);break;case"right":l=this.findJumpCellRight(o.start.row,a.col);break;case"up":s=this.findJumpCellUp(a.row,o.start.col);break;case"down":s=this.findJumpCellDown(a.row,o.start.col);break}else{if(i&&(this.selecting==="row"&&(n==="left"||n==="right")||this.selecting==="column"&&(n==="up"||n==="down")))return;switch(n){case"left":l=Math.max(l-1,0);break;case"right":l=Math.min(l+1,this.getTableColumns().length-1);break;case"up":s=Math.max(s-1,0);break;case"down":s=Math.min(s+1,this.getTableRows().length-1);break}}if(r=l!==a.col||s!==a.row,i||o.setStart(s,l),o.setEnd(s,l),i||(this.selecting="cell"),r)return c=this.getRowByRangePos(o.end.row),u=this.getColumnByRangePos(o.end.col),(n==="left"||n==="right")&&u.getElement().parentNode===null?u.getComponent().scrollTo(void 0,!1):(n==="up"||n==="down")&&c.getElement().parentNode===null?c.getComponent().scrollTo(void 0,!1):this.autoScroll(o,c.getElement(),u.getElement()),this.layoutElement(),!0}rangeRemoved(e){this.ranges=this.ranges.filter(i=>i!==e),this.activeRange===e&&(this.ranges.length?this.activeRange=this.ranges[this.ranges.length-1]:this.addRange()),this.layoutElement()}findJumpCell(e,i,n,r){var o;i&&(e=e.reverse());for(let a of e){let s=a.getValue();if(n){if(o=a,s)break}else if(r){if(o=a,s)break}else if(s)o=a;else break}return o}findJumpCellLeft(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(u=>u.column.visible),o=!r[i].getValue(),a=r[i]?!r[i].getValue():!1,s=i,l=this.rowHeader?r.slice(1,i):r.slice(0,i),c=this.findJumpCell(l,!0,o,a);return c&&(s=c.column.getPosition()-1),s}findJumpCellRight(e,i){var n=this.getRowByRangePos(e),r=n.cells.filter(c=>c.column.visible),o=!r[i].getValue(),a=r[i+1]?!r[i+1].getValue():!1,s=i,l=this.findJumpCell(r.slice(i+1,r.length),!1,o,a);return l&&(s=l.column.getPosition()-1),s}findJumpCellUp(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),o=!r[e].getValue(),a=r[e-1]?!r[e-1].getValue():!1,s=e,l=this.findJumpCell(r.slice(0,s),!0,o,a);return l&&(s=l.row.position-1),s}findJumpCellDown(e,i){var n=this.getColumnByRangePos(i),r=n.cells.filter(c=>this.table.rowManager.activeRows.includes(c.row)),o=!r[e].getValue(),a=r[e+1]?!r[e+1].getValue():!1,s=e,l=this.findJumpCell(r.slice(s+1,r.length),!1,o,a);return l&&(s=l.row.position-1),s}newSelection(e,i){var n;if(i.type==="column"){if(!this.columnSelection)return;if(i===this.rowHeader){n=this.resetRanges(),this.selecting="all";var r,o=this.getCell(-1,-1);this.rowHeader?r=this.getCell(0,1):r=this.getCell(0,0),n.setBounds(r,o);return}else this.selecting="column"}else i.column===this.rowHeader?this.selecting="row":this.selecting="cell";e.shiftKey?this.activeRange.setBounds(!1,i):e.ctrlKey?this.addRange().setBounds(i):this.resetRanges().setBounds(i)}autoScroll(e,i,n){var r=this.table.rowManager.element,o,a,s,l,c;typeof i>"u"&&(i=this.getRowByRangePos(e.end.row).getElement()),typeof n>"u"&&(n=this.getColumnByRangePos(e.end.col).getElement()),this.rowHeader&&(o=this.rowHeader.getElement()),a={left:n.offsetLeft,right:n.offsetLeft+n.offsetWidth,top:i.offsetTop,bottom:i.offsetTop+i.offsetHeight},s={left:r.scrollLeft,right:Math.ceil(r.scrollLeft+r.clientWidth),top:r.scrollTop,bottom:r.scrollTop+r.offsetHeight-this.table.rowManager.scrollbarWidth},o&&(s.left+=o.offsetWidth),l=s.left<a.left&&a.left<s.right&&s.left<a.right&&a.right<s.right,c=s.top<a.top&&a.top<s.bottom&&s.top<a.bottom&&a.bottom<s.bottom,l||(a.left<s.left?(r.scrollLeft=a.left,o&&(r.scrollLeft-=o.offsetWidth)):a.right>s.right&&(r.scrollLeft=a.right-r.clientWidth)),c||(a.top<s.top?r.scrollTop=a.top:a.bottom>s.bottom&&(r.scrollTop=a.bottom-r.clientHeight))}layoutChange(){this.overlay.style.visibility="hidden",clearTimeout(this.layoutChangeTimeout),this.layoutChangeTimeout=setTimeout(this.layoutRanges.bind(this),200)}redraw(e){e&&(this.selecting="cell",this.resetRanges(),this.layoutElement())}layoutElement(e){var i;e?i=this.table.rowManager.getVisibleRows(!0):i=this.table.rowManager.getRows(),i.forEach(n=>{n.type==="row"&&(this.layoutRow(n),n.cells.forEach(r=>this.renderCell(r)))}),this.getTableColumns().forEach(n=>{this.layoutColumn(n)}),this.layoutRanges()}layoutRow(e){var i=e.getElement(),n=!1,r=this.ranges.some(o=>o.occupiesRow(e));this.selecting==="row"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutColumn(e){var i=e.getElement(),n=!1,r=this.ranges.some(o=>o.occupiesColumn(e));this.selecting==="column"?n=r:this.selecting==="all"&&(n=!0),i.classList.toggle("tabulator-range-selected",n),i.classList.toggle("tabulator-range-highlight",r)}layoutRanges(){var e;this.table.initialized&&(e=this.getActiveCell(),e&&(this.activeRangeCellElement.style.left=e.row.getElement().offsetLeft+e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.top=e.row.getElement().offsetTop+"px",this.activeRangeCellElement.style.width=e.getElement().offsetLeft+e.getElement().offsetWidth-e.getElement().offsetLeft+"px",this.activeRangeCellElement.style.height=e.row.getElement().offsetTop+e.row.getElement().offsetHeight-e.row.getElement().offsetTop+"px",this.ranges.forEach(i=>i.layout()),this.overlay.style.visibility="visible"))}getCell(e,i){var n;return i<0&&(i=this.getTableColumns().length+i,i<0)?null:(e<0&&(e=this.getTableRows().length+e),n=this.table.rowManager.getRowFromPosition(e+1),n?n.getCells(!1,!0).filter(r=>r.column.visible)[i]:null)}getActiveCell(){return this.getCell(this.activeRange.start.row,this.activeRange.start.col)}getRowByRangePos(e){return this.getTableRows()[e]}getColumnByRangePos(e){return this.getTableColumns()[e]}getTableRows(){return this.table.rowManager.getDisplayRows()}getTableColumns(){return this.table.columnManager.getVisibleColumnsByIndex()}addRange(e,i){var n;return this.maxRanges!==!0&&this.ranges.length>=this.maxRanges&&this.ranges.shift().destroy(),n=new hHe(this.table,this,e,i),this.activeRange=n,this.ranges.push(n),this.rangeContainer.appendChild(n.element),n}resetRanges(){var e,i;return this.ranges.forEach(n=>n.destroy()),this.ranges=[],e=this.addRange(),this.table.rowManager.activeRows.length&&(i=this.table.rowManager.activeRows[0].cells[this.rowHeader?1:0],i&&(e.setBounds(i),this.initializeFocus(i))),e}tableDestroyed(){document.removeEventListener("mouseup",this.mouseUpEvent),this.table.rowManager.element.removeEventListener("keydown",this.keyDownEvent)}selectedRows(e){return e?this.activeRange.getRows().map(i=>i.getComponent()):this.activeRange.getRows()}selectedColumns(e){return e?this.activeRange.getColumns().map(i=>i.getComponent()):this.activeRange.getColumns()}}kve.moduleName="selectRange";class xve extends dn{constructor(e){super(e),this.tooltipSubscriber=null,this.headerSubscriber=null,this.timeout=null,this.popupInstance=null,this.registerTableOption("tooltipGenerationMode",void 0),this.registerTableOption("tooltipDelay",300),this.registerColumnOption("tooltip"),this.registerColumnOption("headerTooltip")}initialize(){this.deprecatedOptionsCheck(),this.subscribe("column-init",this.initializeColumn.bind(this))}deprecatedOptionsCheck(){this.deprecationCheckMsg("tooltipGenerationMode","This option is no longer needed as tooltips are always generated on hover now")}initializeColumn(e){e.definition.headerTooltip&&!this.headerSubscriber&&(this.headerSubscriber=!0,this.subscribe("column-mousemove",this.mousemoveCheck.bind(this,"headerTooltip")),this.subscribe("column-mouseout",this.mouseoutCheck.bind(this,"headerTooltip"))),e.definition.tooltip&&!this.tooltipSubscriber&&(this.tooltipSubscriber=!0,this.subscribe("cell-mousemove",this.mousemoveCheck.bind(this,"tooltip")),this.subscribe("cell-mouseout",this.mouseoutCheck.bind(this,"tooltip")))}mousemoveCheck(e,i,n){var r=e==="tooltip"?n.column.definition.tooltip:n.definition.headerTooltip;r&&(this.clearPopup(),this.timeout=setTimeout(this.loadTooltip.bind(this,i,n,r),this.table.options.tooltipDelay))}mouseoutCheck(e,i,n){this.popupInstance||this.clearPopup()}clearPopup(e,i,n){clearTimeout(this.timeout),this.timeout=null,this.popupInstance&&this.popupInstance.hide()}loadTooltip(e,i,n){var r,o,a;function s(l){o=l}typeof n=="function"&&(n=n(e,i.getComponent(),s)),n instanceof HTMLElement?r=n:(r=document.createElement("div"),n===!0&&(i instanceof jC?n=i.value:i.definition.field?this.langBind("columns|"+i.definition.field,l=>{r.innerHTML=n=l||i.definition.title}):n=i.definition.title),r.innerHTML=n),(n||n===0||n===!1)&&(r.classList.add("tabulator-tooltip"),r.addEventListener("mousemove",l=>l.preventDefault()),this.popupInstance=this.popup(r),typeof o=="function"&&this.popupInstance.renderCallback(o),a=this.popupInstance.containerEventCoords(e),this.popupInstance.show(a.x+15,a.y+15).hideOnBlur(()=>{this.dispatchExternal("TooltipClosed",i.getComponent()),this.popupInstance=null}),this.dispatchExternal("TooltipOpened",i.getComponent()))}}xve.moduleName="tooltip";var fHe={integer:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&Math.floor(e)===e)},float:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(e=Number(e),!isNaN(e)&&isFinite(e)&&e%1!==0)},numeric:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:!isNaN(e)},string:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:isNaN(e)},alphanumeric:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(/^[a-z0-9]+$/i);return n.test(e)},max:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)<=i},min:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:parseFloat(e)>=i},starts:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().startsWith(String(i).toLowerCase())},ends:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).toLowerCase().endsWith(String(i).toLowerCase())},minLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length>=i},maxLength:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:String(e).length<=i},in:function(t,e,i){return e===""||e===null||typeof e>"u"?!0:(typeof i=="string"&&(i=i.split("|")),i.indexOf(e)>-1)},regex:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=new RegExp(i);return n.test(e)},unique:function(t,e,i){if(e===""||e===null||typeof e>"u")return!0;var n=!0,r=t.getData(),o=t.getColumn()._getSelf();return this.table.rowManager.rows.forEach(function(a){var s=a.getData();s!==r&&e==o.getFieldValue(s)&&(n=!1)}),n},required:function(t,e,i){return e!==""&&e!==null&&typeof e<"u"}};class WC extends dn{constructor(e){super(e),this.invalidCells=[],this.registerTableOption("validationMode","blocking"),this.registerColumnOption("validator"),this.registerTableFunction("getInvalidCells",this.getInvalidCells.bind(this)),this.registerTableFunction("clearCellValidation",this.userClearCellValidation.bind(this)),this.registerTableFunction("validate",this.userValidate.bind(this)),this.registerComponentFunction("cell","isValid",this.cellIsValid.bind(this)),this.registerComponentFunction("cell","clearValidation",this.clearValidation.bind(this)),this.registerComponentFunction("cell","validate",this.cellValidate.bind(this)),this.registerComponentFunction("column","validate",this.columnValidate.bind(this)),this.registerComponentFunction("row","validate",this.rowValidate.bind(this))}initialize(){this.subscribe("cell-delete",this.clearValidation.bind(this)),this.subscribe("column-layout",this.initializeColumnCheck.bind(this)),this.subscribe("edit-success",this.editValidate.bind(this)),this.subscribe("edit-editor-clear",this.editorClear.bind(this)),this.subscribe("edit-edited-clear",this.editedClear.bind(this))}editValidate(e,i,n){var r=this.table.options.validationMode!=="manual"?this.validate(e.column.modules.validate,e,i):!0;return r!==!0&&setTimeout(()=>{e.getElement().classList.add("tabulator-validation-fail"),this.dispatchExternal("validationFailed",e.getComponent(),i,r)}),r}editorClear(e,i){i&&e.column.modules.validate&&this.cellValidate(e),e.getElement().classList.remove("tabulator-validation-fail")}editedClear(e){e.modules.validate&&(e.modules.validate.invalid=!1)}cellIsValid(e){return e.modules.validate&&e.modules.validate.invalid||!0}cellValidate(e){return this.validate(e.column.modules.validate,e,e.getValue())}columnValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}rowValidate(e){var i=[];return e.cells.forEach(n=>{this.cellValidate(n)!==!0&&i.push(n.getComponent())}),i.length?i:!0}userClearCellValidation(e){e||(e=this.getInvalidCells()),Array.isArray(e)||(e=[e]),e.forEach(i=>{this.clearValidation(i._getSelf())})}userValidate(e){var i=[];return this.table.rowManager.rows.forEach(n=>{n=n.getComponent();var r=n.validate();r!==!0&&(i=i.concat(r))}),i.length?i:!0}initializeColumnCheck(e){typeof e.definition.validator<"u"&&this.initializeColumn(e)}initializeColumn(e){var i=this,n=[],r;e.definition.validator&&(Array.isArray(e.definition.validator)?e.definition.validator.forEach(o=>{r=i._extractValidator(o),r&&n.push(r)}):(r=this._extractValidator(e.definition.validator),r&&n.push(r)),e.modules.validate=n.length?n:!1)}_extractValidator(e){var i,n,r;switch(typeof e){case"string":return r=e.indexOf(":"),r>-1?(i=e.substring(0,r),n=e.substring(r+1)):i=e,this._buildValidator(i,n);case"function":return this._buildValidator(e);case"object":return this._buildValidator(e.type,e.parameters)}}_buildValidator(e,i){var n=typeof e=="function"?e:WC.validators[e];return n?{type:typeof e=="function"?"function":e,func:n,params:i}:(console.warn("Validator Setup Error - No matching validator found:",e),!1)}validate(e,i,n){var r=this,o=[],a=this.invalidCells.indexOf(i);return e&&e.forEach(s=>{s.func.call(r,i.getComponent(),n,s.params)||o.push({type:s.type,parameters:s.params})}),i.modules.validate||(i.modules.validate={}),o.length?(i.modules.validate.invalid=o,this.table.options.validationMode!=="manual"&&i.getElement().classList.add("tabulator-validation-fail"),a==-1&&this.invalidCells.push(i)):(i.modules.validate.invalid=!1,i.getElement().classList.remove("tabulator-validation-fail"),a>-1&&this.invalidCells.splice(a,1)),o.length?o:!0}getInvalidCells(){var e=[];return this.invalidCells.forEach(i=>{e.push(i.getComponent())}),e}clearValidation(e){var i;e.modules.validate&&e.modules.validate.invalid&&(e.getElement().classList.remove("tabulator-validation-fail"),e.modules.validate.invalid=!1,i=this.invalidCells.indexOf(e),i>-1&&this.invalidCells.splice(i,1))}}WC.moduleName="validate";WC.validators=fHe;var mHe=Object.freeze({__proto__:null,AccessorModule:Rw,AjaxModule:td,ClipboardModule:cy,ColumnCalcsModule:pm,DataTreeModule:vve,DownloadModule:Nw,EditModule:HC,ExportModule:yve,FilterModule:Mh,FormatModule:nu,FrozenColumnsModule:bve,FrozenRowsModule:Ive,GroupRowsModule:wve,HistoryModule:uy,HtmlTableImportModule:Sve,ImportModule:GC,InteractionModule:Tve,KeybindingsModule:wm,MenuModule:Uve,MoveColumnsModule:Dve,MoveRowsModule:Bx,MutatorModule:Aw,PageModule:zC,PersistenceModule:Pl,PopupModule:Pve,PrintModule:Cve,ReactiveDataModule:Eve,ResizeColumnsModule:Mve,ResizeRowsModule:Rve,ResizeTableModule:Nve,ResponsiveLayoutModule:Ave,SelectRowModule:_ve,SortModule:Rv,SelectRangeModule:kve,TooltipModule:xve,ValidateModule:WC}),gHe={debugEventsExternal:!1,debugEventsInternal:!1,debugInvalidOptions:!0,debugInvalidComponentFuncs:!0,debugInitialization:!0,debugDeprecation:!0,height:!1,minHeight:!1,maxHeight:!1,columnHeaderVertAlign:"top",popupContainer:!1,columns:[],columnDefaults:{},data:!1,autoColumns:!1,autoColumnsDefinitions:!1,nestedFieldSeparator:".",footerElement:!1,index:"id",textDirection:"auto",addRowPos:"bottom",headerVisible:!0,renderVertical:"virtual",renderHorizontal:"basic",renderVerticalBuffer:0,scrollToRowPosition:"top",scrollToRowIfVisible:!0,scrollToColumnPosition:"left",scrollToColumnIfVisible:!0,rowFormatter:!1,rowFormatterPrint:null,rowFormatterClipboard:null,rowFormatterHtmlOutput:null,rowHeight:null,placeholder:!1,dataLoader:!0,dataLoaderLoading:!1,dataLoaderError:!1,dataLoaderErrorTimeout:3e3,dataSendParams:{},dataReceiveParams:{}};class Ove{constructor(e,i,n={}){this.table=e,this.msgType=i,this.registeredDefaults=Object.assign({},n)}register(e,i){this.registeredDefaults[e]=i}generate(e,i={}){var n=Object.assign({},this.registeredDefaults),r=this.table.options.debugInvalidOptions||i.debugInvalidOptions===!0;Object.assign(n,e);for(let o in i)n.hasOwnProperty(o)||(r&&console.warn("Invalid "+this.msgType+" option:",o),n[o]=i.key);for(let o in n)o in i?n[o]=i[o]:Array.isArray(n[o])?n[o]=Object.assign([],n[o]):typeof n[o]=="object"&&n[o]!==null?n[o]=Object.assign({},n[o]):typeof n[o]>"u"&&delete n[o];return n}}class $x extends yl{constructor(e){super(e),this.elementVertical=e.rowManager.element,this.elementHorizontal=e.columnManager.element,this.tableElement=e.rowManager.tableElement,this.verticalFillMode="fit"}initialize(){}clearRows(){}clearColumns(){}reinitializeColumnWidths(e){}renderRows(){}renderColumns(){}rerenderRows(e){e&&e()}rerenderColumns(e,i){}renderRowCells(e){}rerenderRowCells(e,i){}scrollColumns(e,i){}scrollRows(e,i){}resize(){}scrollToRow(e){}scrollToRowNearestTop(e){}visibleRows(e){return[]}rows(){return this.table.rowManager.getDisplayRows()}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}clear(){this.clearRows(),this.clearColumns()}render(){this.renderRows(),this.renderColumns()}rerender(e){this.rerenderRows(),this.rerenderColumns()}scrollToRowPosition(e,i,n){var r=this.rows().indexOf(e),o=e.getElement(),a=0;return new Promise((s,l)=>{if(r>-1){if(typeof n>"u"&&(n=this.table.options.scrollToRowIfVisible),!n&&Jr.elVisible(o)&&(a=Jr.elOffset(o).top-Jr.elOffset(this.elementVertical).top,a>0&&a<this.elementVertical.clientHeight-o.offsetHeight))return s(),!1;switch(typeof i>"u"&&(i=this.table.options.scrollToRowPosition),i==="nearest"&&(i=this.scrollToRowNearestTop(e)?"top":"bottom"),this.scrollToRow(e),i){case"middle":case"center":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop+(o.offsetTop-this.elementVertical.scrollTop)-(this.elementVertical.scrollHeight-o.offsetTop)/2:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight/2;break;case"bottom":this.elementVertical.scrollHeight-this.elementVertical.scrollTop==this.elementVertical.clientHeight?this.elementVertical.scrollTop=this.elementVertical.scrollTop-(this.elementVertical.scrollHeight-o.offsetTop)+o.offsetHeight:this.elementVertical.scrollTop=this.elementVertical.scrollTop-this.elementVertical.clientHeight+o.offsetHeight;break;case"top":this.elementVertical.scrollTop=o.offsetTop;break}s()}else console.warn("Scroll Error - Row not visible"),l("Scroll Error - Row not visible")})}}class vHe extends $x{constructor(e){super(e)}renderRowCells(e,i){const n=document.createDocumentFragment();e.cells.forEach(r=>{n.appendChild(r.getElement())}),e.element.appendChild(n),i||e.cells.forEach(r=>{r.cellRendered()})}reinitializeColumnWidths(e){e.forEach(function(i){i.reinitializeWidth()})}}class yHe extends $x{constructor(e){super(e),this.leftCol=0,this.rightCol=0,this.scrollLeft=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0,this.fitDataColAvg=0,this.windowBuffer=200,this.visibleRows=null,this.initialized=!1,this.isFitData=!1,this.columns=[]}initialize(){this.compatibilityCheck(),this.layoutCheck(),this.vertScrollListen()}compatibilityCheck(){this.options("layout")=="fitDataTable"&&console.warn("Horizontal Virtual DOM is not compatible with fitDataTable layout mode"),this.options("responsiveLayout")&&console.warn("Horizontal Virtual DOM is not compatible with responsive columns"),this.options("rtl")&&console.warn("Horizontal Virtual DOM is not currently compatible with RTL text direction")}layoutCheck(){this.isFitData=this.options("layout").startsWith("fitData")}vertScrollListen(){this.subscribe("scroll-vertical",this.clearVisRowCache.bind(this)),this.subscribe("data-refreshed",this.clearVisRowCache.bind(this))}clearVisRowCache(){this.visibleRows=null}renderColumns(e,i){this.dataChange()}scrollColumns(e,i){this.scrollLeft!=e&&(this.scrollLeft=e,this.scroll(e-(this.vDomScrollPosLeft+this.windowBuffer)))}calcWindowBuffer(){var e=this.elementVertical.clientWidth;this.table.columnManager.columnsByIndex.forEach(i=>{if(i.visible){var n=i.getWidth();n>e&&(e=n)}}),this.windowBuffer=e*2}rerenderColumns(e,i){var n={cols:this.columns,leftCol:this.leftCol,rightCol:this.rightCol},r=0;e&&!this.initialized||(this.clear(),this.calcWindowBuffer(),this.scrollLeft=this.elementVertical.scrollLeft,this.vDomScrollPosLeft=this.scrollLeft-this.windowBuffer,this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,this.table.columnManager.columnsByIndex.forEach(o=>{var a={},s;o.visible&&(o.modules.frozen||(s=o.getWidth(),a.leftPos=r,a.rightPos=r+s,a.width=s,this.isFitData&&(a.fitDataCheck=o.modules.vdomHoz?o.modules.vdomHoz.fitDataCheck:!0),r+s>this.vDomScrollPosLeft&&r<this.vDomScrollPosRight?(this.leftCol==-1&&(this.leftCol=this.columns.length,this.vDomPadLeft=r),this.rightCol=this.columns.length):this.leftCol!==-1&&(this.vDomPadRight+=s),this.columns.push(o),o.modules.vdomHoz=a,r+=s))}),this.tableElement.style.paddingLeft=this.vDomPadLeft+"px",this.tableElement.style.paddingRight=this.vDomPadRight+"px",this.initialized=!0,i||(!e||this.reinitChanged(n))&&this.reinitializeRows(),this.elementVertical.scrollLeft=this.scrollLeft)}renderRowCells(e){if(this.initialized)this.initializeRow(e);else{const i=document.createDocumentFragment();e.cells.forEach(n=>{i.appendChild(n.getElement())}),e.element.appendChild(i),e.cells.forEach(n=>{n.cellRendered()})}}rerenderRowCells(e,i){this.reinitializeRow(e,i)}reinitializeColumnWidths(e){for(let i=this.leftCol;i<=this.rightCol;i++)this.columns[i].reinitializeWidth()}deinitialize(){this.initialized=!1}clear(){this.columns=[],this.leftCol=-1,this.rightCol=0,this.vDomScrollPosLeft=0,this.vDomScrollPosRight=0,this.vDomPadLeft=0,this.vDomPadRight=0}dataChange(){var e=!1,i,n;if(this.isFitData){if(this.table.columnManager.columnsByIndex.forEach(r=>{!r.definition.width&&r.visible&&(e=!0)}),e&&this.table.rowManager.getDisplayRows().length&&(this.vDomScrollPosRight=this.scrollLeft+this.elementVertical.clientWidth+this.windowBuffer,i=this.chain("rows-sample",[1],[],()=>this.table.rowManager.getDisplayRows())[0],i)){n=i.getElement(),i.generateCells(),this.tableElement.appendChild(n);for(let r=0;r<i.cells.length;r++){let o=i.cells[r];n.appendChild(o.getElement()),o.column.reinitializeWidth()}n.parentNode.removeChild(n),this.rerenderColumns(!1,!0)}}else this.options("layout")==="fitColumns"&&(this.layoutRefresh(),this.rerenderColumns(!1,!0))}reinitChanged(e){var i=!0;return e.cols.length!==this.columns.length||e.leftCol!==this.leftCol||e.rightCol!==this.rightCol?!0:(e.cols.forEach((n,r)=>{n!==this.columns[r]&&(i=!1)}),!i)}reinitializeRows(){var e=this.getVisibleRows(),i=this.table.rowManager.getRows().filter(n=>!e.includes(n));e.forEach(n=>{this.reinitializeRow(n,!0)}),i.forEach(n=>{n.deinitialize()})}getVisibleRows(){return this.visibleRows||(this.visibleRows=this.table.rowManager.getVisibleRows()),this.visibleRows}scroll(e){this.vDomScrollPosLeft+=e,this.vDomScrollPosRight+=e,Math.abs(e)>this.windowBuffer/2?this.rerenderColumns():e>0?(this.addColRight(),this.removeColLeft()):(this.addColLeft(),this.removeColRight())}colPositionAdjust(e,i,n){for(let r=e;r<i;r++){let o=this.columns[r];o.modules.vdomHoz.leftPos+=n,o.modules.vdomHoz.rightPos+=n}}addColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol+1];n&&n.modules.vdomHoz.leftPos<=this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var o=r.getCell(n);r.getElement().insertBefore(o.getElement(),r.getCell(this.columns[this.rightCol]).getElement().nextSibling),o.cellRendered()}}),this.fitDataColActualWidthCheck(n),this.rightCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)}),this.rightCol>=this.columns.length-1?this.vDomPadRight=0:this.vDomPadRight-=n.getWidth()):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}addColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol-1];if(n)if(n.modules.vdomHoz.rightPos>=this.vDomScrollPosLeft){e=!0,this.getVisibleRows().forEach(o=>{if(o.type!=="group"){var a=o.getCell(n);o.getElement().insertBefore(a.getElement(),o.getCell(this.columns[this.leftCol]).getElement()),a.cellRendered()}}),this.leftCol--,this.getVisibleRows().forEach(o=>{o.type!=="group"&&(o.modules.vdomHoz.leftCol=this.leftCol)}),this.leftCol<=0?this.vDomPadLeft=0:this.vDomPadLeft-=n.getWidth();let r=this.fitDataColActualWidthCheck(n);r&&(this.scrollLeft=this.elementVertical.scrollLeft=this.elementVertical.scrollLeft+r,this.vDomPadRight-=r)}else i=!1;else i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}removeColRight(){for(var e=!1,i=!0;i;){let n=this.columns[this.rightCol];n&&n.modules.vdomHoz.leftPos>this.vDomScrollPosRight?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var o=r.getCell(n);try{r.getElement().removeChild(o.getElement())}catch(a){console.warn("Could not removeColRight",a.message)}}}),this.vDomPadRight+=n.getWidth(),this.rightCol--,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.rightCol=this.rightCol)})):i=!1}e&&(this.tableElement.style.paddingRight=this.vDomPadRight+"px")}removeColLeft(){for(var e=!1,i=!0;i;){let n=this.columns[this.leftCol];n&&n.modules.vdomHoz.rightPos<this.vDomScrollPosLeft?(e=!0,this.getVisibleRows().forEach(r=>{if(r.type!=="group"){var o=r.getCell(n);try{r.getElement().removeChild(o.getElement())}catch(a){console.warn("Could not removeColLeft",a.message)}}}),this.vDomPadLeft+=n.getWidth(),this.leftCol++,this.getVisibleRows().forEach(r=>{r.type!=="group"&&(r.modules.vdomHoz.leftCol=this.leftCol)})):i=!1}e&&(this.tableElement.style.paddingLeft=this.vDomPadLeft+"px")}fitDataColActualWidthCheck(e){var i,n;return e.modules.vdomHoz.fitDataCheck&&(e.reinitializeWidth(),i=e.getWidth(),n=i-e.modules.vdomHoz.width,n&&(e.modules.vdomHoz.rightPos+=n,e.modules.vdomHoz.width=i,this.colPositionAdjust(this.columns.indexOf(e)+1,this.columns.length,n)),e.modules.vdomHoz.fitDataCheck=!1),n}initializeRow(e){if(e.type!=="group"){e.modules.vdomHoz={leftCol:this.leftCol,rightCol:this.rightCol},this.table.modules.frozenColumns&&this.table.modules.frozenColumns.leftColumns.forEach(i=>{this.appendCell(e,i)});for(let i=this.leftCol;i<=this.rightCol;i++)this.appendCell(e,this.columns[i]);this.table.modules.frozenColumns&&this.table.modules.frozenColumns.rightColumns.forEach(i=>{this.appendCell(e,i)})}}appendCell(e,i){if(i&&i.visible){let n=e.getCell(i);e.getElement().appendChild(n.getElement()),n.cellRendered()}}reinitializeRow(e,i){if(e.type!=="group"&&(i||!e.modules.vdomHoz||e.modules.vdomHoz.leftCol!==this.leftCol||e.modules.vdomHoz.rightCol!==this.rightCol)){for(var n=e.getElement();n.firstChild;)n.removeChild(n.firstChild);this.initializeRow(e)}}}class bHe extends yl{constructor(e){super(e),this.blockHozScrollEvent=!1,this.headersElement=null,this.contentsElement=null,this.element=null,this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.scrollLeft=0,this.optionsList=new Ove(this.table,"column definition",gve),this.redrawBlock=!1,this.redrawBlockUpdate=null,this.renderer=null}initialize(){this.initializeRenderer(),this.headersElement=this.createHeadersElement(),this.contentsElement=this.createHeaderContentsElement(),this.element=this.createHeaderElement(),this.contentsElement.insertBefore(this.headersElement,this.contentsElement.firstChild),this.element.insertBefore(this.contentsElement,this.element.firstChild),this.initializeScrollWheelWatcher(),this.subscribe("scroll-horizontal",this.scrollHorizontal.bind(this)),this.subscribe("scrollbar-vertical",this.padVerticalScrollbar.bind(this))}padVerticalScrollbar(e){this.table.rtl?this.headersElement.style.marginLeft=e+"px":this.headersElement.style.marginRight=e+"px"}initializeRenderer(){var e,i={virtual:yHe,basic:vHe};typeof this.table.options.renderHorizontal=="string"?e=i[this.table.options.renderHorizontal]:e=this.table.options.renderHorizontal,e?(this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize()):console.error("Unable to find matching renderer:",this.table.options.renderHorizontal)}createHeadersElement(){var e=document.createElement("div");return e.classList.add("tabulator-headers"),e.setAttribute("role","row"),e}createHeaderContentsElement(){var e=document.createElement("div");return e.classList.add("tabulator-header-contents"),e.setAttribute("role","rowgroup"),e}createHeaderElement(){var e=document.createElement("div");return e.classList.add("tabulator-header"),e.setAttribute("role","rowgroup"),this.table.options.headerVisible||e.classList.add("tabulator-header-hidden"),e}getElement(){return this.element}getContentsElement(){return this.contentsElement}getHeadersElement(){return this.headersElement}scrollHorizontal(e){this.contentsElement.scrollLeft=e,this.scrollLeft=e,this.renderer.scrollColumns(e)}initializeScrollWheelWatcher(){this.contentsElement.addEventListener("wheel",e=>{var i;e.deltaX&&(i=this.contentsElement.scrollLeft+e.deltaX,this.table.rowManager.scrollHorizontal(i),this.table.columnManager.scrollHorizontal(i))})}generateColumnsFromRowData(e){var i=[],n=this.table.options.autoColumnsDefinitions,r,o;if(e&&e.length){r=e[0];for(var a in r){let s={field:a,title:a},l=r[a];switch(typeof l){case"undefined":o="string";break;case"boolean":o="boolean";break;case"object":Array.isArray(l)?o="array":o="string";break;default:!isNaN(l)&&l!==""?o="number":l.match(/((^[0-9]+[a-z]+)|(^[a-z]+[0-9]+))+$/i)?o="alphanum":o="string";break}s.sorter=o,i.push(s)}if(n)switch(typeof n){case"function":this.table.options.columns=n.call(this.table,i);break;case"object":Array.isArray(n)?i.forEach(s=>{var l=n.find(c=>c.field===s.field);l&&Object.assign(s,l)}):i.forEach(s=>{n[s.field]&&Object.assign(s,n[s.field])}),this.table.options.columns=i;break}else this.table.options.columns=i;this.setColumns(this.table.options.columns)}}setColumns(e,i){for(;this.headersElement.firstChild;)this.headersElement.removeChild(this.headersElement.firstChild);this.columns=[],this.columnsByIndex=[],this.columnsByField={},this.dispatch("columns-loading"),e.forEach((n,r)=>{this._addColumn(n)}),this._reIndexColumns(),this.dispatch("columns-loaded"),this.rerenderColumns(!1,!0),this.redraw(!0)}_addColumn(e,i,n){var r=new cp(e,this),o=r.getElement(),a=n&&this.findColumnIndex(n);if(n&&a>-1){var s=n.getTopColumn(),l=this.columns.indexOf(s),c=s.getElement();i?(this.columns.splice(l,0,r),c.parentNode.insertBefore(o,c)):(this.columns.splice(l+1,0,r),c.parentNode.insertBefore(o,c.nextSibling))}else i?(this.columns.unshift(r),this.headersElement.insertBefore(r.getElement(),this.headersElement.firstChild)):(this.columns.push(r),this.headersElement.appendChild(r.getElement()));return r.columnRendered(),r}registerColumnField(e){e.definition.field&&(this.columnsByField[e.definition.field]=e)}registerColumnPosition(e){this.columnsByIndex.push(e)}_reIndexColumns(){this.columnsByIndex=[],this.columns.forEach(function(e){e.reRegisterPosition()})}verticalAlignHeaders(){var e=0;this.redrawBlock||(this.headersElement.style.height="",this.columns.forEach(i=>{i.clearVerticalAlign()}),this.columns.forEach(i=>{var n=i.getHeight();n>e&&(e=n)}),this.headersElement.style.height=e+"px",this.columns.forEach(i=>{i.verticalAlign(this.table.options.columnHeaderVertAlign,e)}),this.table.rowManager.adjustTableSize())}findColumn(e){var i;if(typeof e=="object"){if(e instanceof cp)return e;if(e instanceof mve)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return i=[],this.columns.forEach(r=>{i.push(r),i=i.concat(r.getColumns(!0))}),i.find(r=>r.element===e)||!1}else return this.columnsByField[e]||!1;return!1}getColumnByField(e){return this.columnsByField[e]}getColumnsByFieldRoot(e){var i=[];return Object.keys(this.columnsByField).forEach(n=>{var r=this.table.options.nestedFieldSeparator?n.split(this.table.options.nestedFieldSeparator)[0]:n;r===e&&i.push(this.columnsByField[n])}),i}getColumnByIndex(e){return this.columnsByIndex[e]}getFirstVisibleColumn(){var e=this.columnsByIndex.findIndex(i=>i.visible);return e>-1?this.columnsByIndex[e]:!1}getVisibleColumnsByIndex(){return this.columnsByIndex.filter(e=>e.visible)}getColumns(){return this.columns}findColumnIndex(e){return this.columnsByIndex.findIndex(i=>e===i)}getRealColumns(){return this.columnsByIndex}traverse(e){this.columnsByIndex.forEach((i,n)=>{e(i,n)})}getDefinitions(e){var i=[];return this.columnsByIndex.forEach(n=>{(!e||e&&n.visible)&&i.push(n.getDefinition())}),i}getDefinitionTree(){var e=[];return this.columns.forEach(i=>{e.push(i.getDefinition(!0))}),e}getComponents(e){var i=[],n=e?this.columns:this.columnsByIndex;return n.forEach(r=>{i.push(r.getComponent())}),i}getWidth(){var e=0;return this.columnsByIndex.forEach(i=>{i.visible&&(e+=i.getWidth())}),e}moveColumn(e,i,n){i.element.parentNode.insertBefore(e.element,i.element),n&&i.element.parentNode.insertBefore(i.element,e.element),this.moveColumnActual(e,i,n),this.verticalAlignHeaders(),this.table.rowManager.reinitialize()}moveColumnActual(e,i,n){e.parent.isGroup?this._moveColumnInArray(e.parent.columns,e,i,n):this._moveColumnInArray(this.columns,e,i,n),this._moveColumnInArray(this.columnsByIndex,e,i,n,!0),this.rerenderColumns(!0),this.dispatch("column-moved",e,i,n),this.subscribedExternal("columnMoved")&&this.dispatchExternal("columnMoved",e.getComponent(),this.table.columnManager.getComponents())}_moveColumnInArray(e,i,n,r,o){var a=e.indexOf(i),s,l=[];a>-1&&(e.splice(a,1),s=e.indexOf(n),s>-1?r&&(s=s+1):s=a,e.splice(s,0,i),o&&(l=this.chain("column-moving-rows",[i,n,r],null,[])||[],l=l.concat(this.table.rowManager.rows),l.forEach(function(c){if(c.cells.length){var u=c.cells.splice(a,1)[0];c.cells.splice(s,0,u)}})))}scrollToColumn(e,i,n){var r=0,o=e.getLeftOffset(),a=0,s=e.getElement();return new Promise((l,c)=>{if(typeof i>"u"&&(i=this.table.options.scrollToColumnPosition),typeof n>"u"&&(n=this.table.options.scrollToColumnIfVisible),e.visible){switch(i){case"middle":case"center":a=-this.element.clientWidth/2;break;case"right":a=s.clientWidth-this.headersElement.clientWidth;break}if(!n&&o>0&&o+s.offsetWidth<this.element.clientWidth)return!1;r=o+a,r=Math.max(Math.min(r,this.table.rowManager.element.scrollWidth-this.table.rowManager.element.clientWidth),0),this.table.rowManager.scrollHorizontal(r),this.scrollHorizontal(r),l()}else console.warn("Scroll Error - Column not visible"),c("Scroll Error - Column not visible")})}generateCells(e){var i=[];return this.columnsByIndex.forEach(n=>{i.push(n.generateCell(e))}),i}getFlexBaseWidth(){var e=this.table.element.clientWidth,i=0;return this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(e-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),this.columnsByIndex.forEach(function(n){var r,o,a;n.visible&&(r=n.definition.width||0,o=parseInt(n.minWidth),typeof r=="string"?r.indexOf("%")>-1?a=e/100*parseInt(r):a=parseInt(r):a=r,i+=a>o?a:o)}),i}addColumn(e,i,n){return new Promise((r,o)=>{var a=this._addColumn(e,i,n);this._reIndexColumns(),this.dispatch("column-add",e,i,n),this.layoutMode()!="fitColumns"&&a.reinitializeWidth(),this.redraw(!0),this.table.rowManager.reinitialize(),this.rerenderColumns(),r(a)})}deregisterColumn(e){var i=e.getField(),n;i&&delete this.columnsByField[i],n=this.columnsByIndex.indexOf(e),n>-1&&this.columnsByIndex.splice(n,1),n=this.columns.indexOf(e),n>-1&&this.columns.splice(n,1),this.verticalAlignHeaders(),this.redraw()}rerenderColumns(e,i){this.redrawBlock?(e===!1||e===!0&&this.redrawBlockUpdate===null)&&(this.redrawBlockUpdate=e):this.renderer.rerenderColumns(e,i)}blockRedraw(){this.redrawBlock=!0,this.redrawBlockUpdate=null}restoreRedraw(){this.redrawBlock=!1,this.verticalAlignHeaders(),this.renderer.rerenderColumns(this.redrawBlockUpdate)}redraw(e){Jr.elVisible(this.element)&&this.verticalAlignHeaders(),e&&(this.table.rowManager.resetScroll(),this.table.rowManager.reinitialize()),this.confirm("table-redrawing",e)||this.layoutRefresh(e),this.dispatch("table-redraw",e),this.table.footerManager.redraw()}}class IHe extends $x{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.scrollTop=0,e.scrollLeft=0,e.style.minWidth="",e.style.minHeight="",e.style.display="",e.style.visibility=""}renderRows(){var e=this.tableElement,i=!0,n=document.createDocumentFragment(),r=this.rows();r.forEach((o,a)=>{this.styleRow(o,a),o.initialize(!1,!0),o.type!=="group"&&(i=!1),n.appendChild(o.getElement())}),e.appendChild(n),r.forEach(o=>{o.rendered(),o.heightInitialized||o.calcHeight(!0)}),r.forEach(o=>{o.heightInitialized||o.setCellHeight()}),i?e.style.minWidth=this.table.columnManager.getWidth()+"px":e.style.minWidth=""}rerenderRows(e){this.clearRows(),e&&e(),this.renderRows(),this.rows().length||this.table.rowManager.tableEmpty()}scrollToRowNearestTop(e){var i=Jr.elOffset(e.getElement()).top;return!(Math.abs(this.elementVertical.scrollTop-i)>Math.abs(this.elementVertical.scrollTop+this.elementVertical.clientHeight-i))}scrollToRow(e){var i=e.getElement();this.elementVertical.scrollTop=Jr.elOffset(i).top-Jr.elOffset(this.elementVertical).top+this.elementVertical.scrollTop}visibleRows(e){return this.rows()}}class wHe extends $x{constructor(e){super(e),this.verticalFillMode="fill",this.scrollTop=0,this.scrollLeft=0,this.vDomRowHeight=20,this.vDomTop=0,this.vDomBottom=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomMaxRenderChain=90,this.vDomWindowBuffer=0,this.vDomWindowMinTotalRows=20,this.vDomWindowMinMarginRows=5,this.vDomTopNewRows=[],this.vDomBottomNewRows=[]}clearRows(){for(var e=this.tableElement;e.firstChild;)e.removeChild(e.firstChild);e.style.paddingTop="",e.style.paddingBottom="",e.style.minHeight="",e.style.display="",e.style.visibility="",this.elementVertical.scrollTop=0,this.elementVertical.scrollLeft=0,this.scrollTop=0,this.scrollLeft=0,this.vDomTop=0,this.vDomBottom=0,this.vDomTopPad=0,this.vDomBottomPad=0,this.vDomScrollPosTop=0,this.vDomScrollPosBottom=0}renderRows(){this._virtualRenderFill()}rerenderRows(e){for(var i=this.elementVertical.scrollTop,n=!1,r=!1,o=this.table.rowManager.scrollLeft,a=this.rows(),s=this.vDomTop;s<=this.vDomBottom;s++)if(a[s]){var l=i-a[s].getElement().offsetTop;if(r===!1||Math.abs(l)<r)r=l,n=s;else break}a.forEach(c=>{c.deinitializeHeight()}),e&&e(),this.rows().length?this._virtualRenderFill(n===!1?this.rows.length-1:n,!0,r||0):(this.clear(),this.table.rowManager.tableEmpty()),this.scrollColumns(o)}scrollColumns(e){this.table.rowManager.scrollHorizontal(e)}scrollRows(e,i){var n=e-this.vDomScrollPosTop,r=e-this.vDomScrollPosBottom,o=this.vDomWindowBuffer*2,a=this.rows();if(this.scrollTop=e,-n>o||r>o){var s=this.table.rowManager.scrollLeft;this._virtualRenderFill(Math.floor(this.elementVertical.scrollTop/this.elementVertical.scrollHeight*a.length)),this.scrollColumns(s)}else i?(n<0&&this._addTopRow(a,-n),r<0&&(this.vDomScrollHeight-this.scrollTop>this.vDomWindowBuffer?this._removeBottomRow(a,-r):this.vDomScrollPosBottom=this.scrollTop)):(r>=0&&this._addBottomRow(a,r),n>=0&&(this.scrollTop>this.vDomWindowBuffer?this._removeTopRow(a,n):this.vDomScrollPosTop=this.scrollTop))}resize(){this.vDomWindowBuffer=this.table.options.renderVerticalBuffer||this.elementVertical.clientHeight}scrollToRowNearestTop(e){var i=this.rows().indexOf(e);return!(Math.abs(this.vDomTop-i)>Math.abs(this.vDomBottom-i))}scrollToRow(e){var i=this.rows().indexOf(e);i>-1&&this._virtualRenderFill(i,!0)}visibleRows(e){var i=this.elementVertical.scrollTop,n=this.elementVertical.clientHeight+i,r=!1,o=0,a=0,s=this.rows();if(e)o=this.vDomTop,a=this.vDomBottom;else for(var l=this.vDomTop;l<=this.vDomBottom;l++)if(s[l])if(r)if(n-s[l].getElement().offsetTop>=0)a=l;else break;else if(i-s[l].getElement().offsetTop>=0)o=l;else if(r=!0,n-s[l].getElement().offsetTop>=0)a=l;else break;return s.slice(o,a+1)}_virtualRenderFill(e,i,n){var r=this.tableElement,o=this.elementVertical,a=0,s=0,l=0,c=0,u=0,d=0,p=this.rows(),h=p.length,f=0,m,g,v=[],y=0,b=0,I=this.table.rowManager.fixedHeight,T=this.elementVertical.clientHeight,S=this.table.options.rowHeight,w=!0;if(e=e||0,n=n||0,!e)this.clear();else{for(;r.firstChild;)r.removeChild(r.firstChild);c=(h-e+1)*this.vDomRowHeight,c<T&&(e-=Math.ceil((T-c)/this.vDomRowHeight),e<0&&(e=0)),a=Math.min(Math.max(Math.floor(this.vDomWindowBuffer/this.vDomRowHeight),this.vDomWindowMinMarginRows),e),e-=a}if(h&&Jr.elVisible(this.elementVertical)){for(this.vDomTop=e,this.vDomBottom=e-1,I||this.table.options.maxHeight?(S&&(b=T/S+this.vDomWindowBuffer/S),b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(b))):b=h;(b==h||s<=T+this.vDomWindowBuffer||y<this.vDomWindowMinTotalRows)&&this.vDomBottom<h-1;){for(v=[],g=document.createDocumentFragment(),d=0;d<b&&this.vDomBottom<h-1;)f=this.vDomBottom+1,m=p[f],this.styleRow(m,f),m.initialize(!1,!0),!m.heightInitialized&&!this.table.options.rowHeight&&m.clearCellHeight(),g.appendChild(m.getElement()),v.push(m),this.vDomBottom++,d++;if(!v.length)break;r.appendChild(g),v.forEach(U=>{U.rendered(),U.heightInitialized||U.calcHeight(!0)}),v.forEach(U=>{U.heightInitialized||U.setCellHeight()}),v.forEach(U=>{l=U.getHeight(),y<a?u+=l:s+=l,l>this.vDomWindowBuffer&&(this.vDomWindowBuffer=l*2),y++}),w=this.table.rowManager.adjustTableSize(),T=this.elementVertical.clientHeight,w&&(I||this.table.options.maxHeight)&&(S=s/y,b=Math.max(this.vDomWindowMinTotalRows,Math.ceil(T/S+this.vDomWindowBuffer/S)))}e?(this.vDomTopPad=i?this.vDomRowHeight*this.vDomTop+n:this.scrollTop-u,this.vDomBottomPad=this.vDomBottom==h-1?0:Math.max(this.vDomScrollHeight-this.vDomTopPad-s-u,0)):(this.vDomTopPad=0,this.vDomRowHeight=Math.floor((s+u)/y),this.vDomBottomPad=this.vDomRowHeight*(h-this.vDomBottom-1),this.vDomScrollHeight=u+s+this.vDomBottomPad-T),r.style.paddingTop=this.vDomTopPad+"px",r.style.paddingBottom=this.vDomBottomPad+"px",i&&(this.scrollTop=this.vDomTopPad+u+n-(this.elementVertical.scrollWidth>this.elementVertical.clientWidth?this.elementVertical.offsetHeight-T:0)),this.scrollTop=Math.min(this.scrollTop,this.elementVertical.scrollHeight-T),this.elementVertical.scrollWidth>this.elementVertical.clientWidth&&i&&(this.scrollTop+=this.elementVertical.offsetHeight-T),this.vDomScrollPosTop=this.scrollTop,this.vDomScrollPosBottom=this.scrollTop,o.scrollTop=this.scrollTop,this.dispatch("render-virtual-fill")}}_addTopRow(e,i){for(var n=this.tableElement,r=[],o=0,a=this.vDomTop-1,s=0,l=!0;l;)if(this.vDomTop){let c=e[a],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,a),n.insertBefore(c.getElement(),n.firstChild),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,o+=u,this.vDomTop--,a--,s++):l=!1):l=!1}else l=!1;for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),o&&(this.vDomTopPad-=o,this.vDomTopPad<0&&(this.vDomTopPad=a*this.vDomRowHeight),a<1&&(this.vDomTopPad=0),n.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop-=o)}_removeTopRow(e,i){for(var n=[],r=0,o=0,a=!0;a;){let s=e[this.vDomTop],l;s&&o<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomTop++,i-=l,r+=l,n.push(s),o++):a=!1):a=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomTopPad+=r,this.tableElement.style.paddingTop=this.vDomTopPad+"px",this.vDomScrollPosTop+=this.vDomTop?r:r+this.vDomWindowBuffer)}_addBottomRow(e,i){for(var n=this.tableElement,r=[],o=0,a=this.vDomBottom+1,s=0,l=!0;l;){let c=e[a],u,d;c&&s<this.vDomMaxRenderChain?(u=c.getHeight()||this.vDomRowHeight,d=c.initialized,i>=u?(this.styleRow(c,a),n.appendChild(c.getElement()),(!c.initialized||!c.heightInitialized)&&r.push(c),c.initialize(),d||(u=c.getElement().offsetHeight,u>this.vDomWindowBuffer&&(this.vDomWindowBuffer=u*2)),i-=u,o+=u,this.vDomBottom++,a++,s++):l=!1):l=!1}for(let c of r)c.clearCellHeight();this._quickNormalizeRowHeight(r),o&&(this.vDomBottomPad-=o,(this.vDomBottomPad<0||a==e.length-1)&&(this.vDomBottomPad=0),n.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom+=o)}_removeBottomRow(e,i){for(var n=[],r=0,o=0,a=!0;a;){let s=e[this.vDomBottom],l;s&&o<this.vDomMaxRenderChain?(l=s.getHeight()||this.vDomRowHeight,i>=l?(this.vDomBottom--,i-=l,r+=l,n.push(s),o++):a=!1):a=!1}for(let s of n){let l=s.getElement();l.parentNode&&l.parentNode.removeChild(l)}r&&(this.vDomBottomPad+=r,this.vDomBottomPad<0&&(this.vDomBottomPad=0),this.tableElement.style.paddingBottom=this.vDomBottomPad+"px",this.vDomScrollPosBottom-=r)}_quickNormalizeRowHeight(e){for(let i of e)i.calcHeight();for(let i of e)i.setCellHeight()}}class SHe extends yl{constructor(e){super(e),this.element=this.createHolderElement(),this.tableElement=this.createTableElement(),this.heightFixer=this.createTableElement(),this.placeholder=null,this.placeholderContents=null,this.firstRender=!1,this.renderMode="virtual",this.fixedHeight=!1,this.rows=[],this.activeRowsPipeline=[],this.activeRows=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0,this.scrollTop=0,this.scrollLeft=0,this.redrawBlock=!1,this.redrawBlockRestoreConfig=!1,this.redrawBlockRenderInPosition=!1,this.dataPipeline=[],this.displayPipeline=[],this.scrollbarWidth=0,this.renderer=null}createHolderElement(){var e=document.createElement("div");return e.classList.add("tabulator-tableholder"),e.setAttribute("tabindex",0),e}createTableElement(){var e=document.createElement("div");return e.classList.add("tabulator-table"),e.setAttribute("role","rowgroup"),e}initializePlaceholder(){var e=this.table.options.placeholder;if(typeof e=="function"&&(e=e.call(this.table)),e=this.chain("placeholder",[e],e,e)||e,e){let i=document.createElement("div");if(i.classList.add("tabulator-placeholder"),typeof e=="string"){let n=document.createElement("div");n.classList.add("tabulator-placeholder-contents"),n.innerHTML=e,i.appendChild(n),this.placeholderContents=n}else typeof HTMLElement<"u"&&e instanceof HTMLElement?(i.appendChild(e),this.placeholderContents=e):(console.warn("Invalid placeholder provided, must be string or HTML Element",e),this.el=null);this.placeholder=i}}getElement(){return this.element}getTableElement(){return this.tableElement}initialize(){this.initializePlaceholder(),this.initializeRenderer(),this.element.appendChild(this.tableElement),this.firstRender=!0,this.element.addEventListener("scroll",()=>{var e=this.element.scrollLeft,i=this.scrollLeft>e,n=this.element.scrollTop,r=this.scrollTop>n;this.scrollLeft!=e&&(this.scrollLeft=e,this.dispatch("scroll-horizontal",e,i),this.dispatchExternal("scrollHorizontal",e,i),this._positionPlaceholder()),this.scrollTop!=n&&(this.scrollTop=n,this.renderer.scrollRows(n,r),this.dispatch("scroll-vertical",n,r),this.dispatchExternal("scrollVertical",n,r))})}findRow(e){if(typeof e=="object"){if(e instanceof Hs)return e;if(e instanceof Lx)return e._getSelf()||!1;if(typeof HTMLElement<"u"&&e instanceof HTMLElement)return this.rows.find(n=>n.getElement()===e)||!1;if(e===null)return!1}else return typeof e>"u"?!1:this.rows.find(n=>n.data[this.table.options.index]==e)||!1;return!1}getRowFromDataObject(e){var i=this.rows.find(n=>n.data===e);return i||!1}getRowFromPosition(e){return this.getDisplayRows().find(i=>i.getPosition()===e&&i.isDisplayed())}scrollToRow(e,i,n){return this.renderer.scrollToRowPosition(e,i,n)}setData(e,i,n){return new Promise((r,o)=>{i&&this.getDisplayRows().length?this.table.options.pagination?this._setDataActual(e,!0):this.reRenderInPosition(()=>{this._setDataActual(e)}):(this.table.options.autoColumns&&n&&this.table.initialized&&this.table.columnManager.generateColumnsFromRowData(e),this.resetScroll(),this._setDataActual(e)),r()})}_setDataActual(e,i){this.dispatchExternal("dataProcessing",e),this._wipeElements(),Array.isArray(e)?(this.dispatch("data-processing",e),e.forEach((n,r)=>{if(n&&typeof n=="object"){var o=new Hs(n,this);this.rows.push(o)}else console.warn("Data Loading Warning - Invalid row data detected and ignored, expecting object but received:",n)}),this.refreshActiveData(!1,!1,i),this.dispatch("data-processed",e),this.dispatchExternal("dataProcessed",e)):console.error(`Data Loading Error - Unable to process data due to invalid data type 
Expecting: array 
Received: `,typeof e,`
Data:     `,e)}_wipeElements(){this.dispatch("rows-wipe"),this.destroy(),this.adjustTableSize(),this.dispatch("rows-wiped")}destroy(){this.rows.forEach(e=>{e.wipe()}),this.rows=[],this.activeRows=[],this.activeRowsPipeline=[],this.activeRowsCount=0,this.displayRows=[],this.displayRowsCount=0}deleteRow(e,i){var n=this.rows.indexOf(e),r=this.activeRows.indexOf(e);r>-1&&this.activeRows.splice(r,1),n>-1&&this.rows.splice(n,1),this.setActiveRows(this.activeRows),this.displayRowIterator(o=>{var a=o.indexOf(e);a>-1&&o.splice(a,1)}),i||this.reRenderInPosition(),this.regenerateRowPositions(),this.dispatchExternal("rowDeleted",e.getComponent()),this.displayRowsCount||this.tableEmpty(),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.getData())}addRow(e,i,n,r){var o=this.addRowActual(e,i,n,r);return o}addRows(e,i,n,r){var o=[];return new Promise((a,s)=>{i=this.findAddRowPos(i),Array.isArray(e)||(e=[e]),(typeof n>"u"&&i||typeof n<"u"&&!i)&&e.reverse(),e.forEach((l,c)=>{var u=this.addRow(l,i,n,!0);o.push(u),this.dispatch("row-added",u,l,i,n)}),this.refreshActiveData(r?"displayPipeline":!1,!1,!0),this.regenerateRowPositions(),this.displayRowsCount&&this._clearPlaceholder(),a(o)})}findAddRowPos(e){return typeof e>"u"&&(e=this.table.options.addRowPos),e==="pos"&&(e=!0),e==="bottom"&&(e=!1),e}addRowActual(e,i,n,r){var o=e instanceof Hs?e:new Hs(e||{},this),a=this.findAddRowPos(i),s=-1,l,c;return n||(c=this.chain("row-adding-position",[o,a],null,{index:n,top:a}),n=c.index,a=c.top),typeof n<"u"&&(n=this.findRow(n)),n=this.chain("row-adding-index",[o,n,a],null,n),n&&(s=this.rows.indexOf(n)),n&&s>-1?(l=this.activeRows.indexOf(n),this.displayRowIterator(function(u){var d=u.indexOf(n);d>-1&&u.splice(a?d:d+1,0,o)}),l>-1&&this.activeRows.splice(a?l:l+1,0,o),this.rows.splice(a?s:s+1,0,o)):a?(this.displayRowIterator(function(u){u.unshift(o)}),this.activeRows.unshift(o),this.rows.unshift(o)):(this.displayRowIterator(function(u){u.push(o)}),this.activeRows.push(o),this.rows.push(o)),this.setActiveRows(this.activeRows),this.dispatchExternal("rowAdded",o.getComponent()),this.subscribedExternal("dataChanged")&&this.dispatchExternal("dataChanged",this.table.rowManager.getData()),r||this.reRenderInPosition(),o}moveRow(e,i,n){this.dispatch("row-move",e,i,n),this.moveRowActual(e,i,n),this.regenerateRowPositions(),this.dispatch("row-moved",e,i,n),this.dispatchExternal("rowMoved",e.getComponent())}moveRowActual(e,i,n){this.moveRowInArray(this.rows,e,i,n),this.moveRowInArray(this.activeRows,e,i,n),this.displayRowIterator(r=>{this.moveRowInArray(r,e,i,n)}),this.dispatch("row-moving",e,i,n)}moveRowInArray(e,i,n,r){var o,a,s,l;if(i!==n&&(o=e.indexOf(i),o>-1&&(e.splice(o,1),a=e.indexOf(n),a>-1?r?e.splice(a+1,0,i):e.splice(a,0,i):e.splice(o,0,i)),e===this.getDisplayRows())){s=o<a?o:a,l=a>o?a:o+1;for(let c=s;c<=l;c++)e[c]&&this.styleRow(e[c],c)}}clearData(){this.setData([])}getRowIndex(e){return this.findRowIndex(e,this.rows)}getDisplayRowIndex(e){var i=this.getDisplayRows().indexOf(e);return i>-1?i:!1}nextDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n!==!1&&n<this.displayRowsCount-1&&(r=this.getDisplayRows()[n+1]),r&&(!(r instanceof Hs)||r.type!="row")?this.nextDisplayRow(r,i):r}prevDisplayRow(e,i){var n=this.getDisplayRowIndex(e),r=!1;return n&&(r=this.getDisplayRows()[n-1]),i&&r&&(!(r instanceof Hs)||r.type!="row")?this.prevDisplayRow(r,i):r}findRowIndex(e,i){var n;return e=this.findRow(e),e&&(n=i.indexOf(e),n>-1)?n:!1}getData(e,i){var n=[],r=this.getRows(e);return r.forEach(function(o){o.type=="row"&&n.push(o.getData(i||"data"))}),n}getComponents(e){var i=[],n=this.getRows(e);return n.forEach(function(r){i.push(r.getComponent())}),i}getDataCount(e){var i=this.getRows(e);return i.length}scrollHorizontal(e){this.scrollLeft=e,this.element.scrollLeft=e,this.dispatch("scroll-horizontal",e)}registerDataPipelineHandler(e,i){typeof i<"u"?(this.dataPipeline.push({handler:e,priority:i}),this.dataPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Data pipeline handlers must have a priority in order to be registered")}registerDisplayPipelineHandler(e,i){typeof i<"u"?(this.displayPipeline.push({handler:e,priority:i}),this.displayPipeline.sort((n,r)=>n.priority-r.priority)):console.error("Display pipeline handlers must have a priority in order to be registered")}refreshActiveData(e,i,n){var r=this.table,o="",a=0,s=["all","dataPipeline","display","displayPipeline","end"];if(!this.table.destroyed){if(typeof e=="function")if(a=this.dataPipeline.findIndex(l=>l.handler===e),a>-1)o="dataPipeline",i&&(a==this.dataPipeline.length-1?o="display":a++);else if(a=this.displayPipeline.findIndex(l=>l.handler===e),a>-1)o="displayPipeline",i&&(a==this.displayPipeline.length-1?o="end":a++);else{console.error("Unable to refresh data, invalid handler provided",e);return}else o=e||"all",a=0;if(this.redrawBlock){(!this.redrawBlockRestoreConfig||this.redrawBlockRestoreConfig&&(this.redrawBlockRestoreConfig.stage===o&&a<this.redrawBlockRestoreConfig.index||s.indexOf(o)<s.indexOf(this.redrawBlockRestoreConfig.stage)))&&(this.redrawBlockRestoreConfig={handler:e,skipStage:i,renderInPosition:n,stage:o,index:a});return}else Jr.elVisible(this.element)?n?this.reRenderInPosition(this.refreshPipelines.bind(this,e,o,a,n)):(this.refreshPipelines(e,o,a,n),e||this.table.columnManager.renderer.renderColumns(),this.renderTable(),r.options.layoutColumnsOnNewData&&this.table.columnManager.redraw(!0)):this.refreshPipelines(e,o,a,n),this.dispatch("data-refreshed")}}refreshPipelines(e,i,n,r){switch(this.dispatch("data-refreshing"),(!e||!this.activeRowsPipeline[0])&&(this.activeRowsPipeline[0]=this.rows.slice(0)),i){case"all":case"dataPipeline":for(let o=n;o<this.dataPipeline.length;o++){let a=this.dataPipeline[o].handler(this.activeRowsPipeline[o].slice(0));this.activeRowsPipeline[o+1]=a||this.activeRowsPipeline[o].slice(0)}this.setActiveRows(this.activeRowsPipeline[this.dataPipeline.length]);case"display":n=0,this.resetDisplayRows();case"displayPipeline":for(let o=n;o<this.displayPipeline.length;o++){let a=this.displayPipeline[o].handler((o?this.getDisplayRows(o-1):this.activeRows).slice(0),r);this.setDisplayRows(a||this.getDisplayRows(o-1).slice(0),o)}case"end":this.regenerateRowPositions()}this.getDisplayRows().length&&this._clearPlaceholder()}regenerateRowPositions(){var e=this.getDisplayRows(),i=1;e.forEach(n=>{n.type==="row"&&(n.setPosition(i),i++)})}setActiveRows(e){this.activeRows=this.activeRows=Object.assign([],e),this.activeRowsCount=this.activeRows.length}resetDisplayRows(){this.displayRows=[],this.displayRows.push(this.activeRows.slice(0)),this.displayRowsCount=this.displayRows[0].length}setDisplayRows(e,i){this.displayRows[i]=e,i==this.displayRows.length-1&&(this.displayRowsCount=this.displayRows[this.displayRows.length-1].length)}getDisplayRows(e){return typeof e>"u"?this.displayRows.length?this.displayRows[this.displayRows.length-1]:[]:this.displayRows[e]||[]}getVisibleRows(e,i){var n=Object.assign([],this.renderer.visibleRows(!i));return e&&(n=this.chain("rows-visible",[i],n,n)),n}displayRowIterator(e){this.activeRowsPipeline.forEach(e),this.displayRows.forEach(e),this.displayRowsCount=this.displayRows[this.displayRows.length-1].length}getRows(e){var i=[];switch(e){case"active":i=this.activeRows;break;case"display":i=this.table.rowManager.getDisplayRows();break;case"visible":i=this.getVisibleRows(!1,!0);break;default:i=this.chain("rows-retrieve",e,null,this.rows)||this.rows}return i}reRenderInPosition(e){this.redrawBlock?e?e():this.redrawBlockRenderInPosition=!0:(this.dispatchExternal("renderStarted"),this.renderer.rerenderRows(e),this.fixedHeight||this.adjustTableSize(),this.scrollBarCheck(),this.dispatchExternal("renderComplete"))}scrollBarCheck(){var e=0;this.element.scrollHeight>this.element.clientHeight&&(e=this.element.offsetWidth-this.element.clientWidth),e!==this.scrollbarWidth&&(this.scrollbarWidth=e,this.dispatch("scrollbar-vertical",e))}initializeRenderer(){var e,i={virtual:wHe,basic:IHe};typeof this.table.options.renderVertical=="string"?e=i[this.table.options.renderVertical]:e=this.table.options.renderVertical,e?(this.renderMode=this.table.options.renderVertical,this.renderer=new e(this.table,this.element,this.tableElement),this.renderer.initialize(),(this.table.element.clientHeight||this.table.options.height)&&!(this.table.options.minHeight&&this.table.options.maxHeight)?this.fixedHeight=!0:this.fixedHeight=!1):console.error("Unable to find matching renderer:",this.table.options.renderVertical)}getRenderMode(){return this.renderMode}renderTable(){this.dispatchExternal("renderStarted"),this.element.scrollTop=0,this._clearTable(),this.displayRowsCount?(this.renderer.renderRows(),this.firstRender&&(this.firstRender=!1,this.fixedHeight||this.adjustTableSize(),this.layoutRefresh(!0))):this.renderEmptyScroll(),this.fixedHeight||this.adjustTableSize(),this.dispatch("table-layout"),this.displayRowsCount||this._showPlaceholder(),this.scrollBarCheck(),this.dispatchExternal("renderComplete")}renderEmptyScroll(){this.placeholder?this.tableElement.style.display="none":this.tableElement.style.minWidth=this.table.columnManager.getWidth()+"px"}_clearTable(){this._clearPlaceholder(),this.scrollTop=0,this.scrollLeft=0,this.renderer.clearRows()}tableEmpty(){this.renderEmptyScroll(),this._showPlaceholder()}checkPlaceholder(){this.displayRowsCount?this._clearPlaceholder():this.tableEmpty()}_showPlaceholder(){this.placeholder&&(this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.initializePlaceholder(),this.placeholder.setAttribute("tabulator-render-mode",this.renderMode),this.getElement().appendChild(this.placeholder),this._positionPlaceholder(),this.adjustTableSize())}_clearPlaceholder(){this.placeholder&&this.placeholder.parentNode&&this.placeholder.parentNode.removeChild(this.placeholder),this.tableElement.style.minWidth="",this.tableElement.style.display=""}_positionPlaceholder(){this.placeholder&&this.placeholder.parentNode&&(this.placeholder.style.width=this.table.columnManager.getWidth()+"px",this.placeholderContents.style.width=this.table.rowManager.element.clientWidth+"px",this.placeholderContents.style.marginLeft=this.scrollLeft+"px")}styleRow(e,i){var n=e.getElement();i%2?(n.classList.add("tabulator-row-even"),n.classList.remove("tabulator-row-odd")):(n.classList.add("tabulator-row-odd"),n.classList.remove("tabulator-row-even"))}normalizeHeight(){this.activeRows.forEach(function(e){e.normalizeHeight()})}adjustTableSize(){let e=this.element.clientHeight,i,n=!1;if(this.renderer.verticalFillMode==="fill"){let r=Math.floor(this.table.columnManager.getElement().getBoundingClientRect().height+(this.table.footerManager&&this.table.footerManager.active&&!this.table.footerManager.external?this.table.footerManager.getElement().getBoundingClientRect().height:0));if(this.fixedHeight){i=isNaN(this.table.options.minHeight)?this.table.options.minHeight:this.table.options.minHeight+"px";const o="calc(100% - "+r+"px)";this.element.style.minHeight=i||"calc(100% - "+r+"px)",this.element.style.height=o,this.element.style.maxHeight=o}else this.element.style.height="",this.element.style.height=this.table.element.clientHeight-r+"px",this.element.scrollTop=this.scrollTop;this.renderer.resize(),!this.fixedHeight&&e!=this.element.clientHeight&&(n=!0,this.subscribed("table-resize")?this.dispatch("table-resize"):this.redraw()),this.scrollBarCheck()}return this._positionPlaceholder(),n}reinitialize(){this.rows.forEach(function(e){e.reinitialize(!0)})}blockRedraw(){this.redrawBlock=!0,this.redrawBlockRestoreConfig=!1}restoreRedraw(){this.redrawBlock=!1,this.redrawBlockRestoreConfig?(this.refreshActiveData(this.redrawBlockRestoreConfig.handler,this.redrawBlockRestoreConfig.skipStage,this.redrawBlockRestoreConfig.renderInPosition),this.redrawBlockRestoreConfig=!1):this.redrawBlockRenderInPosition&&this.reRenderInPosition(),this.redrawBlockRenderInPosition=!1}redraw(e){this.adjustTableSize(),this.table.tableWidth=this.table.element.clientWidth,e?this.renderTable():(this.reRenderInPosition(),this.scrollHorizontal(this.scrollLeft))}resetScroll(){if(this.element.scrollLeft=0,this.element.scrollTop=0,this.table.browser==="ie"){var e=document.createEvent("Event");e.initEvent("scroll",!1,!0),this.element.dispatchEvent(e)}else this.element.dispatchEvent(new Event("scroll"))}}class THe extends yl{constructor(e){super(e),this.active=!1,this.element=this.createElement(),this.containerElement=this.createContainerElement(),this.external=!1}initialize(){this.initializeElement()}createElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer"),e}createContainerElement(){var e=document.createElement("div");return e.classList.add("tabulator-footer-contents"),this.element.appendChild(e),e}initializeElement(){if(this.table.options.footerElement)switch(typeof this.table.options.footerElement){case"string":this.table.options.footerElement[0]==="<"?this.containerElement.innerHTML=this.table.options.footerElement:(this.external=!0,this.containerElement=document.querySelector(this.table.options.footerElement));break;default:this.element=this.table.options.footerElement;break}}getElement(){return this.element}append(e){this.activate(),this.containerElement.appendChild(e),this.table.rowManager.adjustTableSize()}prepend(e){this.activate(),this.element.insertBefore(e,this.element.firstChild),this.table.rowManager.adjustTableSize()}remove(e){e.parentNode.removeChild(e),this.deactivate()}deactivate(e){(!this.element.firstChild||e)&&(this.external||this.element.parentNode.removeChild(this.element),this.active=!1)}activate(){this.active||(this.active=!0,this.external||(this.table.element.appendChild(this.getElement()),this.table.element.style.display=""))}redraw(){this.dispatch("footer-redraw")}}class UHe extends yl{constructor(e){super(e),this.el=null,this.abortClasses=["tabulator-headers","tabulator-table"],this.previousTargets={},this.listeners=["click","dblclick","contextmenu","mouseenter","mouseleave","mouseover","mouseout","mousemove","mouseup","mousedown","touchstart","touchend"],this.componentMap={"tabulator-cell":"cell","tabulator-row":"row","tabulator-group":"group","tabulator-col":"column"},this.pseudoTrackers={row:{subscriber:null,target:null},cell:{subscriber:null,target:null},group:{subscriber:null,target:null},column:{subscriber:null,target:null}},this.pseudoTracking=!1}initialize(){this.el=this.table.element,this.buildListenerMap(),this.bindSubscriptionWatchers()}buildListenerMap(){var e={};this.listeners.forEach(i=>{e[i]={handler:null,components:[]}}),this.listeners=e}bindPseudoEvents(){Object.keys(this.pseudoTrackers).forEach(e=>{this.pseudoTrackers[e].subscriber=this.pseudoMouseEnter.bind(this,e),this.subscribe(e+"-mouseover",this.pseudoTrackers[e].subscriber)}),this.pseudoTracking=!0}pseudoMouseEnter(e,i,n){this.pseudoTrackers[e].target!==n&&(this.pseudoTrackers[e].target&&this.dispatch(e+"-mouseleave",i,this.pseudoTrackers[e].target),this.pseudoMouseLeave(e,i),this.pseudoTrackers[e].target=n,this.dispatch(e+"-mouseenter",i,n))}pseudoMouseLeave(e,i){var n=Object.keys(this.pseudoTrackers),r={row:["cell"],cell:["row"]};n=n.filter(o=>{var a=r[e];return o!==e&&(!a||a&&!a.includes(o))}),n.forEach(o=>{var a=this.pseudoTrackers[o].target;this.pseudoTrackers[o].target&&(this.dispatch(o+"-mouseleave",i,a),this.pseudoTrackers[o].target=null)})}bindSubscriptionWatchers(){var e=Object.keys(this.listeners),i=Object.values(this.componentMap);for(let n of i)for(let r of e){let o=n+"-"+r;this.subscriptionChange(o,this.subscriptionChanged.bind(this,n,r))}this.subscribe("table-destroy",this.clearWatchers.bind(this))}subscriptionChanged(e,i,n){var r=this.listeners[i].components,o=r.indexOf(e),a=!1;n?o===-1&&(r.push(e),a=!0):this.subscribed(e+"-"+i)||o>-1&&(r.splice(o,1),a=!0),(i==="mouseenter"||i==="mouseleave")&&!this.pseudoTracking&&this.bindPseudoEvents(),a&&this.updateEventListeners()}updateEventListeners(){for(let e in this.listeners){let i=this.listeners[e];i.components.length?i.handler||(i.handler=this.track.bind(this,e),this.el.addEventListener(e,i.handler)):i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}track(e,i){var n=i.composedPath&&i.composedPath()||i.path,r=this.findTargets(n);r=this.bindComponents(e,r),this.triggerEvents(e,i,r),this.pseudoTracking&&(e=="mouseover"||e=="mouseleave")&&!Object.keys(r).length&&this.pseudoMouseLeave("none",i)}findTargets(e){var i={};let n=Object.keys(this.componentMap);for(let r of e){let o=r.classList?[...r.classList]:[];if(o.filter(l=>this.abortClasses.includes(l)).length)break;let s=o.filter(l=>n.includes(l));for(let l of s)i[this.componentMap[l]]||(i[this.componentMap[l]]=r)}return i.group&&i.group===i.row&&delete i.row,i}bindComponents(e,i){var n=Object.keys(i).reverse(),r=this.listeners[e],o={},a={};for(let s of n){let l,c=i[s],u=this.previousTargets[s];if(u&&u.target===c)l=u.component;else switch(s){case"row":case"group":(r.components.includes("row")||r.components.includes("cell")||r.components.includes("group"))&&(l=this.table.rowManager.getVisibleRows(!0).find(p=>p.getElement()===c),i.row&&i.row.parentNode&&i.row.parentNode.closest(".tabulator-row")&&(i[s]=!1));break;case"column":r.components.includes("column")&&(l=this.table.columnManager.findColumn(c));break;case"cell":r.components.includes("cell")&&(o.row instanceof Hs?l=o.row.findCell(c):i.row&&console.warn("Event Target Lookup Error - The row this cell is attached to cannot be found, has the table been reinitialized without being destroyed first?"));break}l&&(o[s]=l,a[s]={target:c,component:l})}return this.previousTargets=a,o}triggerEvents(e,i,n){var r=this.listeners[e];for(let o in n)n[o]&&r.components.includes(o)&&this.dispatch(o+"-"+e,i,n[o])}clearWatchers(){for(let e in this.listeners){let i=this.listeners[e];i.handler&&(this.el.removeEventListener(e,i.handler),i.handler=null)}}}class DHe{constructor(e){this.table=e,this.bindings={}}bind(e,i,n){this.bindings[e]||(this.bindings[e]={}),this.bindings[e][i]?console.warn("Unable to bind component handler, a matching function name is already bound",e,i,n):this.bindings[e][i]=n}handle(e,i,n){if(this.bindings[e]&&this.bindings[e][n]&&typeof this.bindings[e][n].bind=="function")return this.bindings[e][n].bind(null,i);n!=="then"&&typeof n=="string"&&!n.startsWith("_")&&this.table.options.debugInvalidComponentFuncs&&console.error("The "+e+" component does not have a "+n+" function, have you checked that you have the correct Tabulator module installed?")}}class PHe extends yl{constructor(e){super(e),this.requestOrder=0,this.loading=!1}initialize(){}load(e,i,n,r,o,a){var s=++this.requestOrder;if(this.table.destroyed)return Promise.resolve();if(this.dispatchExternal("dataLoading",e),e&&(e.indexOf("{")==0||e.indexOf("[")==0)&&(e=JSON.parse(e)),this.confirm("data-loading",[e,i,n,o])){this.loading=!0,o||this.alertLoader(),i=this.chain("data-params",[e,n,o],i||{},i||{}),i=this.mapParams(i,this.table.options.dataSendParams);var l=this.chain("data-load",[e,i,n,o],!1,Promise.resolve([]));return l.then(c=>{if(this.table.destroyed)console.warn("Data Load Response Blocked - Table has been destroyed");else{!Array.isArray(c)&&typeof c=="object"&&(c=this.mapParams(c,this.objectInvert(this.table.options.dataReceiveParams)));var u=this.chain("data-loaded",c,null,c);s==this.requestOrder?(this.clearAlert(),u!==!1&&(this.dispatchExternal("dataLoaded",u),this.table.rowManager.setData(u,r,typeof a>"u"?!r:a))):console.warn("Data Load Response Blocked - An active data load request was blocked by an attempt to change table data while the request was being made")}}).catch(c=>{console.error("Data Load Error: ",c),this.dispatchExternal("dataLoadError",c),o||this.alertError(),setTimeout(()=>{this.clearAlert()},this.table.options.dataLoaderErrorTimeout)}).finally(()=>{this.loading=!1})}else return this.dispatchExternal("dataLoaded",e),e||(e=[]),this.table.rowManager.setData(e,r,typeof a>"u"?!r:a),Promise.resolve()}mapParams(e,i){var n={};for(let r in e)n[i.hasOwnProperty(r)?i[r]:r]=e[r];return n}objectInvert(e){var i={};for(let n in e)i[e[n]]=n;return i}blockActiveLoad(){this.requestOrder++}alertLoader(){var e=typeof this.table.options.dataLoader=="function"?this.table.options.dataLoader():this.table.options.dataLoader;e&&this.table.alertManager.alert(this.table.options.dataLoaderLoading||this.langText("data|loading"))}alertError(){this.table.alertManager.alert(this.table.options.dataLoaderError||this.langText("data|error"),"error")}clearAlert(){this.table.alertManager.clear()}}class CHe{constructor(e,i,n){this.table=e,this.events={},this.optionsList=i||{},this.subscriptionNotifiers={},this.dispatch=n?this._debugDispatch.bind(this):this._dispatch.bind(this),this.debug=n}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i){this.events[e]||(this.events[e]=[]),this.events[e].push(i),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e])if(i)if(n=this.events[e].findIndex(r=>r===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}else delete this.events[e];else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift(),n;return this.events[i]&&this.events[i].forEach((r,o)=>{let a=r.apply(this.table,e);o||(n=a)}),n}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="ExternalEvent:"+e[0],(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}}class EHe{constructor(e){this.events={},this.subscriptionNotifiers={},this.dispatch=e?this._debugDispatch.bind(this):this._dispatch.bind(this),this.chain=e?this._debugChain.bind(this):this._chain.bind(this),this.confirm=e?this._debugConfirm.bind(this):this._confirm.bind(this),this.debug=e}subscriptionChange(e,i){this.subscriptionNotifiers[e]||(this.subscriptionNotifiers[e]=[]),this.subscriptionNotifiers[e].push(i),this.subscribed(e)&&this._notifySubscriptionChange(e,!0)}subscribe(e,i,n=1e4){this.events[e]||(this.events[e]=[]),this.events[e].push({callback:i,priority:n}),this.events[e].sort((r,o)=>r.priority-o.priority),this._notifySubscriptionChange(e,!0)}unsubscribe(e,i){var n;if(this.events[e]){if(i)if(n=this.events[e].findIndex(r=>r.callback===i),n>-1)this.events[e].splice(n,1);else{console.warn("Cannot remove event, no matching event found:",e,i);return}}else{console.warn("Cannot remove event, no events set on:",e);return}this._notifySubscriptionChange(e,!1)}subscribed(e){return this.events[e]&&this.events[e].length}_chain(e,i,n,r){var o=n;return Array.isArray(i)||(i=[i]),this.subscribed(e)?(this.events[e].forEach((a,s)=>{o=a.callback.apply(this,i.concat([o]))}),o):typeof r=="function"?r():r}_confirm(e,i){var n=!1;return Array.isArray(i)||(i=[i]),this.subscribed(e)&&this.events[e].forEach((r,o)=>{r.callback.apply(this,i)&&(n=!0)}),n}_notifySubscriptionChange(e,i){var n=this.subscriptionNotifiers[e];n&&n.forEach(r=>{r(i)})}_dispatch(){var e=Array.from(arguments),i=e.shift();this.events[i]&&this.events[i].forEach(n=>{n.callback.apply(this,e)})}_debugDispatch(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._dispatch(...arguments)}_debugChain(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._chain(...arguments)}_debugConfirm(){var e=Array.from(arguments),i=e[0];return e[0]="InternalEvent:"+i,(this.debug===!0||this.debug.includes(i))&&console.log(...e),this._confirm(...arguments)}}class MHe extends yl{constructor(e){super(e)}_warnUser(){this.options("debugDeprecation")&&console.warn(...arguments)}check(e,i,n){var r="";return typeof this.options(e)<"u"?(r="Deprecated Setup Option - Use of the %c"+e+"%c option is now deprecated",i?(r=r+", Please use the %c"+i+"%c option instead",this._warnUser(r,"font-weight: bold;","font-weight: normal;","font-weight: bold;","font-weight: normal;"),n&&(this.table.options[i]=this.table.options[e])):this._warnUser(r,"font-weight: bold;","font-weight: normal;"),!1):!0}checkMsg(e,i){return typeof this.options(e)<"u"?(this._warnUser("%cDeprecated Setup Option - Use of the %c"+e+" %c option is now deprecated, "+i,"font-weight: normal;","font-weight: bold;","font-weight: normal;"),!1):!0}msg(e){this._warnUser(e)}}class fc{static register(e){fc.tables.push(e)}static deregister(e){var i=fc.tables.indexOf(e);i>-1&&fc.tables.splice(i,1)}static lookupTable(e,i){var n=[],r,o;if(typeof e=="string"){if(r=document.querySelectorAll(e),r.length)for(var a=0;a<r.length;a++)o=fc.matchElement(r[a]),o&&n.push(o)}else typeof HTMLElement<"u"&&e instanceof HTMLElement||e instanceof dy?(o=fc.matchElement(e),o&&n.push(o)):Array.isArray(e)?e.forEach(function(s){n=n.concat(fc.lookupTable(s))}):i||console.warn("Table Connection Error - Invalid Selector",e);return n}static matchElement(e){return fc.tables.find(function(i){return e instanceof dy?i===e:i.element===e})}}fc.tables=[];function RHe(t,e){e&&this.table.columnManager.renderer.reinitializeColumnWidths(t),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function IK(t,e){t.forEach(function(i){i.reinitializeWidth()}),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function NHe(t,e){var i=0,n=this.table.rowManager.element.clientWidth,r=0,o=!1;t.forEach((a,s)=>{a.widthFixed||a.reinitializeWidth(),(this.table.options.responsiveLayout?a.modules.responsive.visible:a.visible)&&(o=a),a.visible&&(i+=a.getWidth())}),o?(r=n-i+o.getWidth(),this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&(o.setWidth(0),this.table.modules.responsiveLayout.update()),r>0?o.setWidth(r):o.reinitializeWidth()):this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update()}function AHe(t,e){var i=this.table.rowManager.element.getBoundingClientRect().width,n=0,r=0,o=0,a=0,s=[],l=[],c=0,u=0,d=0;function p(f){var m;return typeof f=="string"?f.indexOf("%")>-1?m=i/100*parseInt(f):m=parseInt(f):m=f,m}function h(f,m,g,v){var y=[],b=0,I=0,T=0,S=o,w=0,U=0,D=[];function E(M){return g*(M.column.definition.widthGrow||1)}function C(M){return p(M.width)-g*(M.column.definition.widthShrink||0)}return f.forEach(function(M,N){var R=v?C(M):E(M);M.column.minWidth>=R?y.push(M):M.column.maxWidth&&M.column.maxWidth<R?(M.width=M.column.maxWidth,m-=M.column.maxWidth,S-=v?M.column.definition.widthShrink||1:M.column.definition.widthGrow||1,S&&(g=Math.floor(m/S))):(D.push(M),U+=v?M.column.definition.widthShrink||1:M.column.definition.widthGrow||1)}),y.length?(y.forEach(function(M){b+=v?M.width-M.column.minWidth:M.column.minWidth,M.width=M.column.minWidth}),I=m-b,T=U?Math.floor(I/U):I,w=h(D,I,T,v)):(w=U?m-Math.floor(m/U)*U:m,D.forEach(function(M){M.width=v?C(M):E(M)})),w}this.table.options.responsiveLayout&&this.table.modExists("responsiveLayout",!0)&&this.table.modules.responsiveLayout.update(),this.table.rowManager.element.scrollHeight>this.table.rowManager.element.clientHeight&&(i-=this.table.rowManager.element.offsetWidth-this.table.rowManager.element.clientWidth),t.forEach(function(f){var m,g,v;f.visible&&(m=f.definition.width,g=parseInt(f.minWidth),m?(v=p(m),n+=v>g?v:g,f.definition.widthShrink&&(l.push({column:f,width:v>g?v:g}),c+=f.definition.widthShrink)):(s.push({column:f,width:0}),o+=f.definition.widthGrow||1))}),r=i-n,a=Math.floor(r/o),d=h(s,r,a,!1),s.length&&d>0&&(s[s.length-1].width+=d),s.forEach(function(f){r-=f.width}),u=Math.abs(d)+r,u>0&&c&&(d=h(l,u,Math.floor(u/c),!0)),d&&l.length&&(l[l.length-1].width-=d),s.forEach(function(f){f.column.setWidth(f.width)}),l.forEach(function(f){f.column.setWidth(f.width)})}var _He={fitData:RHe,fitDataFill:IK,fitDataTable:IK,fitDataStretch:NHe,fitColumns:AHe};class _w extends dn{constructor(e){super(e,"layout"),this.mode=null,this.registerTableOption("layout","fitData"),this.registerTableOption("layoutColumnsOnNewData",!1),this.registerColumnOption("widthGrow"),this.registerColumnOption("widthShrink")}initialize(){var e=this.table.options.layout;_w.modes[e]?this.mode=e:(console.warn("Layout Error - invalid mode set, defaulting to 'fitData' : "+e),this.mode="fitData"),this.table.element.setAttribute("tabulator-layout",this.mode),this.subscribe("column-init",this.initializeColumn.bind(this))}initializeColumn(e){e.definition.widthGrow&&(e.definition.widthGrow=Number(e.definition.widthGrow)),e.definition.widthShrink&&(e.definition.widthShrink=Number(e.definition.widthShrink))}getMode(){return this.mode}layout(e){this.dispatch("layout-refreshing"),_w.modes[this.mode].call(this,this.table.columnManager.columnsByIndex,e),this.dispatch("layout-refreshed")}}_w.moduleName="layout";_w.modes=_He;var kHe={default:{groups:{item:"item",items:"items"},columns:{},data:{loading:"Loading",error:"Error"},pagination:{page_size:"Page Size",page_title:"Show Page",first:"First",first_title:"First Page",last:"Last",last_title:"Last Page",prev:"Prev",prev_title:"Prev Page",next:"Next",next_title:"Next Page",all:"All",counter:{showing:"Showing",of:"of",rows:"rows",pages:"pages"}},headerFilters:{default:"filter column...",columns:{}}}};class qC extends dn{constructor(e){super(e),this.locale="default",this.lang=!1,this.bindings={},this.langList={},this.registerTableOption("locale",!1),this.registerTableOption("langs",{})}initialize(){this.langList=Jr.deepClone(qC.langs),this.table.options.columnDefaults.headerFilterPlaceholder!==!1&&this.setHeaderFilterPlaceholder(this.table.options.columnDefaults.headerFilterPlaceholder);for(let e in this.table.options.langs)this.installLang(e,this.table.options.langs[e]);this.setLocale(this.table.options.locale),this.registerTableFunction("setLocale",this.setLocale.bind(this)),this.registerTableFunction("getLocale",this.getLocale.bind(this)),this.registerTableFunction("getLang",this.getLang.bind(this))}setHeaderFilterPlaceholder(e){this.langList.default.headerFilters.default=e}installLang(e,i){this.langList[e]?this._setLangProp(this.langList[e],i):this.langList[e]=i}_setLangProp(e,i){for(let n in i)e[n]&&typeof e[n]=="object"?this._setLangProp(e[n],i[n]):e[n]=i[n]}setLocale(e){e=e||"default";function i(n,r){for(var o in n)typeof n[o]=="object"?(r[o]||(r[o]={}),i(n[o],r[o])):r[o]=n[o]}if(e===!0&&navigator.language&&(e=navigator.language.toLowerCase()),e&&!this.langList[e]){let n=e.split("-")[0];this.langList[n]?(console.warn("Localization Error - Exact matching locale not found, using closest match: ",e,n),e=n):(console.warn("Localization Error - Matching locale not found, using default: ",e),e="default")}this.locale=e,this.lang=Jr.deepClone(this.langList.default||{}),e!="default"&&i(this.langList[e],this.lang),this.dispatchExternal("localized",this.locale,this.lang),this._executeBindings()}getLocale(e){return this.locale}getLang(e){return e?this.langList[e]:this.lang}getText(e,i){var n=i?e+"|"+i:e,r=n.split("|"),o=this._getLangElement(r,this.locale);return o||""}_getLangElement(e,i){var n=this.lang;return e.forEach(function(r){var o;n&&(o=n[r],typeof o<"u"?n=o:n=!1)}),n}bind(e,i){this.bindings[e]||(this.bindings[e]=[]),this.bindings[e].push(i),i(this.getText(e),this.lang)}_executeBindings(){for(let e in this.bindings)this.bindings[e].forEach(i=>{i(this.getText(e),this.lang)})}}qC.moduleName="localize";qC.langs=kHe;class Lve extends dn{constructor(e){super(e)}initialize(){this.registerTableFunction("tableComms",this.receive.bind(this))}getConnections(e){var i=[],n;return n=fc.lookupTable(e),n.forEach(r=>{this.table!==r&&i.push(r)}),i}send(e,i,n,r){var o=this.getConnections(e);o.forEach(a=>{a.tableComms(this.table.element,i,n,r)}),!o.length&&e&&console.warn("Table Connection Error - No tables matching selector found",e)}receive(e,i,n,r){if(this.table.modExists(i))return this.table.modules[i].commsReceived(e,n,r);console.warn("Inter-table Comms Error - no such module:",i)}}Lve.moduleName="comms";var xHe=Object.freeze({__proto__:null,LayoutModule:_w,LocalizeModule:qC,CommsModule:Lve});class Fve{constructor(e,i){this.bindStaticFunctionality(e),this.bindModules(e,xHe,!0),i&&this.bindModules(e,i)}bindStaticFunctionality(e){e.moduleBindings={},e.extendModule=function(i,n,r){if(e.moduleBindings[i]){var o=e.moduleBindings[i][n];if(o)if(typeof r=="object")for(let a in r)o[a]=r[a];else console.warn("Module Error - Invalid value type, it must be an object");else console.warn("Module Error - property does not exist:",n)}else console.warn("Module Error - module does not exist:",i)},e.registerModule=function(i){Array.isArray(i)||(i=[i]),i.forEach(n=>{e.registerModuleBinding(n)})},e.registerModuleBinding=function(i){e.moduleBindings[i.moduleName]=i},e.findTable=function(i){var n=fc.lookupTable(i,!0);return Array.isArray(n)&&!n.length?!1:n},e.prototype.bindModules=function(){var i=[],n=[],r=[];this.modules={};for(var o in e.moduleBindings){let a=e.moduleBindings[o],s=new a(this);this.modules[o]=s,a.prototype.moduleCore?this.modulesCore.push(s):a.moduleInitOrder?a.moduleInitOrder<0?i.push(s):n.push(s):r.push(s)}i.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),n.sort((a,s)=>a.moduleInitOrder>s.moduleInitOrder?1:-1),this.modulesRegular=i.concat(r.concat(n))}}bindModules(e,i,n){var r=Object.values(i);n&&r.forEach(o=>{o.prototype.moduleCore=!0}),e.registerModule(r)}}class OHe extends yl{constructor(e){super(e),this.element=this._createAlertElement(),this.msgElement=this._createMsgElement(),this.type=null,this.element.appendChild(this.msgElement)}_createAlertElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert"),e}_createMsgElement(){var e=document.createElement("div");return e.classList.add("tabulator-alert-msg"),e.setAttribute("role","alert"),e}_typeClass(){return"tabulator-alert-state-"+this.type}alert(e,i="msg"){if(e){for(this.clear(),this.dispatch("alert-show",i),this.type=i;this.msgElement.firstChild;)this.msgElement.removeChild(this.msgElement.firstChild);this.msgElement.classList.add(this._typeClass()),typeof e=="function"&&(e=e()),e instanceof HTMLElement?this.msgElement.appendChild(e):this.msgElement.innerHTML=e,this.table.element.appendChild(this.element)}}clear(){this.dispatch("alert-hide",this.type),this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.msgElement.classList.remove(this._typeClass())}}class dy{constructor(e,i){this.options={},this.columnManager=null,this.rowManager=null,this.footerManager=null,this.alertManager=null,this.vdomHoz=null,this.externalEvents=null,this.eventBus=null,this.interactionMonitor=!1,this.browser="",this.browserSlow=!1,this.browserMobile=!1,this.rtl=!1,this.originalElement=null,this.componentFunctionBinder=new DHe(this),this.dataLoader=!1,this.modules={},this.modulesCore=[],this.modulesRegular=[],this.deprecationAdvisor=new MHe(this),this.optionsList=new Ove(this,"table constructor"),this.initialized=!1,this.destroyed=!1,this.initializeElement(e)&&(this.initializeCoreSystems(i),setTimeout(()=>{this._create()})),fc.register(this)}initializeElement(e){return typeof HTMLElement<"u"&&e instanceof HTMLElement?(this.element=e,!0):typeof e=="string"?(this.element=document.querySelector(e),this.element?!0:(console.error("Tabulator Creation Error - no element found matching selector: ",e),!1)):(console.error("Tabulator Creation Error - Invalid element provided:",e),!1)}initializeCoreSystems(e){this.columnManager=new bHe(this),this.rowManager=new SHe(this),this.footerManager=new THe(this),this.dataLoader=new PHe(this),this.alertManager=new OHe(this),this.bindModules(),this.options=this.optionsList.generate(dy.defaultOptions,e),this._clearObjectPointers(),this._mapDeprecatedFunctionality(),this.externalEvents=new CHe(this,this.options,this.options.debugEventsExternal),this.eventBus=new EHe(this.options.debugEventsInternal),this.interactionMonitor=new UHe(this),this.dataLoader.initialize(),this.footerManager.initialize()}_mapDeprecatedFunctionality(){}_clearSelection(){this.element.classList.add("tabulator-block-select"),window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty(),this.element.classList.remove("tabulator-block-select")}_create(){this.externalEvents.dispatch("tableBuilding"),this.eventBus.dispatch("table-building"),this._rtlCheck(),this._buildElement(),this._initializeTable(),this._loadInitialData(),this.initialized=!0,this.externalEvents.dispatch("tableBuilt")}_rtlCheck(){var e=window.getComputedStyle(this.element);switch(this.options.textDirection){case"auto":if(e.direction!=="rtl")break;case"rtl":this.element.classList.add("tabulator-rtl"),this.rtl=!0;break;case"ltr":this.element.classList.add("tabulator-ltr");default:this.rtl=!1}}_clearObjectPointers(){this.options.columns=this.options.columns.slice(0),Array.isArray(this.options.data)&&!this.options.reactiveData&&(this.options.data=this.options.data.slice(0))}_buildElement(){var e=this.element,i=this.options,n;if(e.tagName==="TABLE"){this.originalElement=this.element,n=document.createElement("div");var r=e.attributes;for(var o in r)typeof r[o]=="object"&&n.setAttribute(r[o].name,r[o].value);e.parentNode.replaceChild(n,e),this.element=e=n}for(e.classList.add("tabulator"),e.setAttribute("role","grid");e.firstChild;)e.removeChild(e.firstChild);i.height&&(i.height=isNaN(i.height)?i.height:i.height+"px",e.style.height=i.height),i.minHeight!==!1&&(i.minHeight=isNaN(i.minHeight)?i.minHeight:i.minHeight+"px",e.style.minHeight=i.minHeight),i.maxHeight!==!1&&(i.maxHeight=isNaN(i.maxHeight)?i.maxHeight:i.maxHeight+"px",e.style.maxHeight=i.maxHeight)}_initializeTable(){var e=this.element,i=this.options;this.interactionMonitor.initialize(),this.columnManager.initialize(),this.rowManager.initialize(),this._detectBrowser(),this.modulesCore.forEach(n=>{n.initialize()}),e.appendChild(this.columnManager.getElement()),e.appendChild(this.rowManager.getElement()),i.footerElement&&this.footerManager.activate(),i.autoColumns&&i.data&&this.columnManager.generateColumnsFromRowData(this.options.data),this.modulesRegular.forEach(n=>{n.initialize()}),this.columnManager.setColumns(i.columns),this.eventBus.dispatch("table-built")}_loadInitialData(){this.dataLoader.load(this.options.data),this.columnManager.verticalAlignHeaders()}destroy(){var e=this.element;for(this.destroyed=!0,fc.deregister(this),this.eventBus.dispatch("table-destroy"),this.rowManager.destroy();e.firstChild;)e.removeChild(e.firstChild);e.classList.remove("tabulator"),this.externalEvents.dispatch("tableDestroyed")}_detectBrowser(){var e=navigator.userAgent||navigator.vendor||window.opera;e.indexOf("Trident")>-1?(this.browser="ie",this.browserSlow=!0):e.indexOf("Edge")>-1?(this.browser="edge",this.browserSlow=!0):e.indexOf("Firefox")>-1?(this.browser="firefox",this.browserSlow=!1):e.indexOf("Mac OS")>-1?(this.browser="safari",this.browserSlow=!1):(this.browser="other",this.browserSlow=!1),this.browserMobile=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw-(n|u)|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do(c|p)o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(-|_)|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-(m|p|t)|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c(-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac( |-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c(-|0|1)|47|mc|nd|ri)|sgh-|shar|sie(-|m)|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel(i|m)|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.slice(0,4))}initGuard(e,i){var n,r;return this.options.debugInitialization&&!this.initialized&&(e||(n=new Error().stack.split(`
`),r=n[0]=="Error"?n[2]:n[1],r[0]==" "?e=r.trim().split(" ")[1].split(".")[1]:e=r.trim().split("@")[0]),console.warn("Table Not Initialized - Calling the "+e+" function before the table is initialized may result in inconsistent behavior, Please wait for the `tableBuilt` event before calling this function."+(i?" "+i:""))),this.initialized}blockRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-blocking"),this.rowManager.blockRedraw(),this.columnManager.blockRedraw(),this.eventBus.dispatch("redraw-blocked")}restoreRedraw(){this.initGuard(),this.eventBus.dispatch("redraw-restoring"),this.rowManager.restoreRedraw(),this.columnManager.restoreRedraw(),this.eventBus.dispatch("redraw-restored")}setData(e,i,n){return this.initGuard(!1,"To set initial data please use the 'data' property in the table constructor."),this.dataLoader.load(e,i,n,!1)}clearData(){this.initGuard(),this.dataLoader.blockActiveLoad(),this.rowManager.clearData()}getData(e){return this.rowManager.getData(e)}getDataCount(e){return this.rowManager.getDataCount(e)}replaceData(e,i,n){return this.initGuard(),this.dataLoader.load(e,i,n,!0,!0)}updateData(e){var i=0;return this.initGuard(),new Promise((n,r)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(o=>{var a=this.rowManager.findRow(o[this.options.index]);a?(i++,a.updateData(o).then(()=>{i--,i||n()}).catch(s=>{r("Update Error - Unable to update row",o,s)})):r("Update Error - Unable to find row",o)}):(console.warn("Update Error - No data provided"),r("Update Error - No data provided"))})}addData(e,i,n){return this.initGuard(),new Promise((r,o)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e?this.rowManager.addRows(e,i,n).then(a=>{var s=[];a.forEach(function(l){s.push(l.getComponent())}),r(s)}):(console.warn("Update Error - No data provided"),o("Update Error - No data provided"))})}updateOrAddData(e){var i=[],n=0;return this.initGuard(),new Promise((r,o)=>{this.dataLoader.blockActiveLoad(),typeof e=="string"&&(e=JSON.parse(e)),e&&e.length>0?e.forEach(a=>{var s=this.rowManager.findRow(a[this.options.index]);n++,s?s.updateData(a).then(()=>{n--,i.push(s.getComponent()),n||r(i)}):this.rowManager.addRows(a).then(l=>{n--,i.push(l[0].getComponent()),n||r(i)})}):(console.warn("Update Error - No data provided"),o("Update Error - No data provided"))})}getRow(e){var i=this.rowManager.findRow(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}getRowFromPosition(e){var i=this.rowManager.getRowFromPosition(e);return i?i.getComponent():(console.warn("Find Error - No matching row found:",e),!1)}deleteRow(e){var i=[];this.initGuard(),Array.isArray(e)||(e=[e]);for(let n of e){let r=this.rowManager.findRow(n,!0);if(r)i.push(r);else return console.error("Delete Error - No matching row found:",n),Promise.reject("Delete Error - No matching row found")}return i.sort((n,r)=>this.rowManager.rows.indexOf(n)>this.rowManager.rows.indexOf(r)?1:-1),i.forEach(n=>{n.delete()}),this.rowManager.reRenderInPosition(),Promise.resolve()}addRow(e,i,n){return this.initGuard(),typeof e=="string"&&(e=JSON.parse(e)),this.rowManager.addRows(e,i,n,!0).then(r=>r[0].getComponent())}updateOrAddRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>n.getComponent()):this.rowManager.addRows(i).then(r=>r[0].getComponent())}updateRow(e,i){var n=this.rowManager.findRow(e);return this.initGuard(),typeof i=="string"&&(i=JSON.parse(i)),n?n.updateData(i).then(()=>Promise.resolve(n.getComponent())):(console.warn("Update Error - No matching row found:",e),Promise.reject("Update Error - No matching row found"))}scrollToRow(e,i,n){var r=this.rowManager.findRow(e);return r?this.rowManager.scrollToRow(r,i,n):(console.warn("Scroll Error - No matching row found:",e),Promise.reject("Scroll Error - No matching row found"))}moveRow(e,i,n){var r=this.rowManager.findRow(e);this.initGuard(),r?r.moveToRow(i,n):console.warn("Move Error - No matching row found:",e)}getRows(e){return this.rowManager.getComponents(e)}getRowPosition(e){var i=this.rowManager.findRow(e);return i?i.getPosition():(console.warn("Position Error - No matching row found:",e),!1)}setColumns(e){this.initGuard(!1,"To set initial columns please use the 'columns' property in the table constructor"),this.columnManager.setColumns(e)}getColumns(e){return this.columnManager.getComponents(e)}getColumn(e){var i=this.columnManager.findColumn(e);return i?i.getComponent():(console.warn("Find Error - No matching column found:",e),!1)}getColumnDefinitions(){return this.columnManager.getDefinitionTree()}showColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.show();else return console.warn("Column Show Error - No matching column found:",e),!1}hideColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.hide();else return console.warn("Column Hide Error - No matching column found:",e),!1}toggleColumn(e){var i=this.columnManager.findColumn(e);if(this.initGuard(),i)i.visible?i.hide():i.show();else return console.warn("Column Visibility Toggle Error - No matching column found:",e),!1}addColumn(e,i,n){var r=this.columnManager.findColumn(n);return this.initGuard(),this.columnManager.addColumn(e,i,r).then(o=>o.getComponent())}deleteColumn(e){var i=this.columnManager.findColumn(e);return this.initGuard(),i?i.delete():(console.warn("Column Delete Error - No matching column found:",e),Promise.reject())}updateColumnDefinition(e,i){var n=this.columnManager.findColumn(e);return this.initGuard(),n?n.updateDefinition(i):(console.warn("Column Update Error - No matching column found:",e),Promise.reject())}moveColumn(e,i,n){var r=this.columnManager.findColumn(e),o=this.columnManager.findColumn(i);this.initGuard(),r?o?this.columnManager.moveColumn(r,o,n):console.warn("Move Error - No matching column found:",o):console.warn("Move Error - No matching column found:",e)}scrollToColumn(e,i,n){return new Promise((r,o)=>{var a=this.columnManager.findColumn(e);return a?this.columnManager.scrollToColumn(a,i,n):(console.warn("Scroll Error - No matching column found:",e),Promise.reject("Scroll Error - No matching column found"))})}redraw(e){this.initGuard(),this.columnManager.redraw(e),this.rowManager.redraw(e)}setHeight(e){this.options.height=isNaN(e)?e:e+"px",this.element.style.height=this.options.height,this.rowManager.initializeRenderer(),this.rowManager.redraw(!0)}on(e,i){this.externalEvents.subscribe(e,i)}off(e,i){this.externalEvents.unsubscribe(e,i)}dispatchEvent(){var e=Array.from(arguments);e.shift(),this.externalEvents.dispatch(...arguments)}alert(e,i){this.initGuard(),this.alertManager.alert(e,i)}clearAlert(){this.initGuard(),this.alertManager.clear()}modExists(e,i){return this.modules[e]?!0:(i&&console.error("Tabulator Module Not Installed: "+e),!1)}module(e){var i=this.modules[e];return i||console.error("Tabulator module not installed: "+e),i}}dy.defaultOptions=gHe;new Fve(dy);class bo extends dy{}new Fve(bo,mHe);const{MALE:LHe,FEMALE:FHe}=Lu;function BHe(t){var a;const e=t.getValue(),i=t.getRow().getData(),n=i.sex||((a=i.person)==null?void 0:a.sex),r=(n==null?void 0:n.toUpperCase())===LHe&&"#2E86C1"||(n==null?void 0:n.toUpperCase())===FHe&&"#AA336A"||"",o=document.createElement("div");return o.style.color=r,o.innerHTML=e,o}function $He(t){return[{visible:t.some(i=>i.drawPosition),field:"drawPosition",title:"Position",headerSort:!1,responsive:!1,editor:!1,maxWidth:100},{formatter:BHe,field:"participantName",title:"Participant",responsive:!1,minWidth:200,widthGrow:2}]}function Bve({selectedParticipantIds:t,selectionLimit:e=1,targetAttribute:i,placeholder:n,onSelected:r,data:o=[],anchorId:a}){o.some(d=>d.participant)&&(o=o.map(({participant:d,...p})=>({...p,participantName:"BYE",...d}))),o.forEach(d=>{var p;return d.searchText=(p=d.participantName)==null?void 0:p.toLowerCase()});const l=$He(o),c=document.getElementById(a),u=new bo(c,{placeholder:n||"No options",index:i,selectable:e,layout:"fitColumns",reactiveData:!0,maxHeight:350,columns:l,data:o});return Qe.tables||(Qe.tables={}),Qe.tables.selectionTable=u,u.on("tableBuilt",()=>{t!=null&&t.length&&u.selectRow(t)}),u.on("rowSelectionChanged",(d,p)=>{const h=p==null?void 0:p.map(f=>f.getData());vt(r)&&r(h)}),{table:u}}function $ve({title:t,placeholder:e,options:i,selectionLimit:n}){const r="selectionControl",o="selectionTable",a=[{label:"Cancel",intent:"is-none",close:!0}],s=()=>{const f=Qe.tables.selectionTable;f==null||f.destroy(),delete Qe.tables.selectionTable},l=`
    <div style='min-height: 420px'>
      <div id='${r}'></div>
      <div id='${o}'></div>
    </div>
  `;lr({title:t,content:l,buttons:a,onClose:s});const c=f=>{var m;(m=f==null?void 0:f[0])!=null&&m.onClick&&(f[0].onClick(),Dw())},{table:u}=Bve({targetAttribute:"participantid",selectionLimit:n,data:i,placeholder:e,onSelected:c,anchorId:o}),d=gb(u),p=[{onKeyDown:f=>f.keyCode===8&&f.target.value.length===1&&d(""),onChange:f=>d(f.target.value),onKeyUp:f=>d(f.target.value),clearSearch:()=>d(""),placeholder:"Search",location:Lt,search:!0}],h=document.getElementById(r);Da({table:u,target:h,items:p})}var Fl="top",_u="bottom",ku="right",Bl="left",S4="auto",YC=[Fl,_u,ku,Bl],kw="start",KU="end",VHe="clippingParents",Vve="viewport",yS="popper",jHe="reference",wK=YC.reduce(function(t,e){return t.concat([e+"-"+kw,e+"-"+KU])},[]),jve=[].concat(YC,[S4]).reduce(function(t,e){return t.concat([e,e+"-"+kw,e+"-"+KU])},[]),HHe="beforeRead",GHe="read",zHe="afterRead",WHe="beforeMain",qHe="main",YHe="afterMain",KHe="beforeWrite",ZHe="write",XHe="afterWrite",JHe=[HHe,GHe,zHe,WHe,qHe,YHe,KHe,ZHe,XHe];function _p(t){return t?(t.nodeName||"").toLowerCase():null}function Gc(t){if(t==null)return window;if(t.toString()!=="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function py(t){var e=Gc(t).Element;return t instanceof e||t instanceof Element}function gu(t){var e=Gc(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function T4(t){if(typeof ShadowRoot>"u")return!1;var e=Gc(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function QHe(t){var e=t.state;Object.keys(e.elements).forEach(function(i){var n=e.styles[i]||{},r=e.attributes[i]||{},o=e.elements[i];!gu(o)||!_p(o)||(Object.assign(o.style,n),Object.keys(r).forEach(function(a){var s=r[a];s===!1?o.removeAttribute(a):o.setAttribute(a,s===!0?"":s)}))})}function eGe(t){var e=t.state,i={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,i.popper),e.styles=i,e.elements.arrow&&Object.assign(e.elements.arrow.style,i.arrow),function(){Object.keys(e.elements).forEach(function(n){var r=e.elements[n],o=e.attributes[n]||{},a=Object.keys(e.styles.hasOwnProperty(n)?e.styles[n]:i[n]),s=a.reduce(function(l,c){return l[c]="",l},{});!gu(r)||!_p(r)||(Object.assign(r.style,s),Object.keys(o).forEach(function(l){r.removeAttribute(l)}))})}}const Hve={name:"applyStyles",enabled:!0,phase:"write",fn:QHe,effect:eGe,requires:["computeStyles"]};function up(t){return t.split("-")[0]}var Nv=Math.max,hN=Math.min,xw=Math.round;function n$(){var t=navigator.userAgentData;return t!=null&&t.brands&&Array.isArray(t.brands)?t.brands.map(function(e){return e.brand+"/"+e.version}).join(" "):navigator.userAgent}function Gve(){return!/^((?!chrome|android).)*safari/i.test(n$())}function Ow(t,e,i){e===void 0&&(e=!1),i===void 0&&(i=!1);var n=t.getBoundingClientRect(),r=1,o=1;e&&gu(t)&&(r=t.offsetWidth>0&&xw(n.width)/t.offsetWidth||1,o=t.offsetHeight>0&&xw(n.height)/t.offsetHeight||1);var a=py(t)?Gc(t):window,s=a.visualViewport,l=!Gve()&&i,c=(n.left+(l&&s?s.offsetLeft:0))/r,u=(n.top+(l&&s?s.offsetTop:0))/o,d=n.width/r,p=n.height/o;return{width:d,height:p,top:u,right:c+d,bottom:u+p,left:c,x:c,y:u}}function U4(t){var e=Ow(t),i=t.offsetWidth,n=t.offsetHeight;return Math.abs(e.width-i)<=1&&(i=e.width),Math.abs(e.height-n)<=1&&(n=e.height),{x:t.offsetLeft,y:t.offsetTop,width:i,height:n}}function zve(t,e){var i=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(i&&T4(i)){var n=e;do{if(n&&t.isSameNode(n))return!0;n=n.parentNode||n.host}while(n)}return!1}function hf(t){return Gc(t).getComputedStyle(t)}function tGe(t){return["table","td","th"].indexOf(_p(t))>=0}function Mg(t){return((py(t)?t.ownerDocument:t.document)||window.document).documentElement}function Vx(t){return _p(t)==="html"?t:t.assignedSlot||t.parentNode||(T4(t)?t.host:null)||Mg(t)}function SK(t){return!gu(t)||hf(t).position==="fixed"?null:t.offsetParent}function iGe(t){var e=/firefox/i.test(n$()),i=/Trident/i.test(n$());if(i&&gu(t)){var n=hf(t);if(n.position==="fixed")return null}var r=Vx(t);for(T4(r)&&(r=r.host);gu(r)&&["html","body"].indexOf(_p(r))<0;){var o=hf(r);if(o.transform!=="none"||o.perspective!=="none"||o.contain==="paint"||["transform","perspective"].indexOf(o.willChange)!==-1||e&&o.willChange==="filter"||e&&o.filter&&o.filter!=="none")return r;r=r.parentNode}return null}function KC(t){for(var e=Gc(t),i=SK(t);i&&tGe(i)&&hf(i).position==="static";)i=SK(i);return i&&(_p(i)==="html"||_p(i)==="body"&&hf(i).position==="static")?e:i||iGe(t)||e}function D4(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function IT(t,e,i){return Nv(t,hN(e,i))}function nGe(t,e,i){var n=IT(t,e,i);return n>i?i:n}function Wve(){return{top:0,right:0,bottom:0,left:0}}function qve(t){return Object.assign({},Wve(),t)}function Yve(t,e){return e.reduce(function(i,n){return i[n]=t,i},{})}var rGe=function(e,i){return e=typeof e=="function"?e(Object.assign({},i.rects,{placement:i.placement})):e,qve(typeof e!="number"?e:Yve(e,YC))};function oGe(t){var e,i=t.state,n=t.name,r=t.options,o=i.elements.arrow,a=i.modifiersData.popperOffsets,s=up(i.placement),l=D4(s),c=[Bl,ku].indexOf(s)>=0,u=c?"height":"width";if(!(!o||!a)){var d=rGe(r.padding,i),p=U4(o),h=l==="y"?Fl:Bl,f=l==="y"?_u:ku,m=i.rects.reference[u]+i.rects.reference[l]-a[l]-i.rects.popper[u],g=a[l]-i.rects.reference[l],v=KC(o),y=v?l==="y"?v.clientHeight||0:v.clientWidth||0:0,b=m/2-g/2,I=d[h],T=y-p[u]-d[f],S=y/2-p[u]/2+b,w=IT(I,S,T),U=l;i.modifiersData[n]=(e={},e[U]=w,e.centerOffset=w-S,e)}}function aGe(t){var e=t.state,i=t.options,n=i.element,r=n===void 0?"[data-popper-arrow]":n;r!=null&&(typeof r=="string"&&(r=e.elements.popper.querySelector(r),!r)||zve(e.elements.popper,r)&&(e.elements.arrow=r))}const sGe={name:"arrow",enabled:!0,phase:"main",fn:oGe,effect:aGe,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Lw(t){return t.split("-")[1]}var lGe={top:"auto",right:"auto",bottom:"auto",left:"auto"};function cGe(t,e){var i=t.x,n=t.y,r=e.devicePixelRatio||1;return{x:xw(i*r)/r||0,y:xw(n*r)/r||0}}function TK(t){var e,i=t.popper,n=t.popperRect,r=t.placement,o=t.variation,a=t.offsets,s=t.position,l=t.gpuAcceleration,c=t.adaptive,u=t.roundOffsets,d=t.isFixed,p=a.x,h=p===void 0?0:p,f=a.y,m=f===void 0?0:f,g=typeof u=="function"?u({x:h,y:m}):{x:h,y:m};h=g.x,m=g.y;var v=a.hasOwnProperty("x"),y=a.hasOwnProperty("y"),b=Bl,I=Fl,T=window;if(c){var S=KC(i),w="clientHeight",U="clientWidth";if(S===Gc(i)&&(S=Mg(i),hf(S).position!=="static"&&s==="absolute"&&(w="scrollHeight",U="scrollWidth")),S=S,r===Fl||(r===Bl||r===ku)&&o===KU){I=_u;var D=d&&S===T&&T.visualViewport?T.visualViewport.height:S[w];m-=D-n.height,m*=l?1:-1}if(r===Bl||(r===Fl||r===_u)&&o===KU){b=ku;var E=d&&S===T&&T.visualViewport?T.visualViewport.width:S[U];h-=E-n.width,h*=l?1:-1}}var C=Object.assign({position:s},c&&lGe),M=u===!0?cGe({x:h,y:m},Gc(i)):{x:h,y:m};if(h=M.x,m=M.y,l){var N;return Object.assign({},C,(N={},N[I]=y?"0":"",N[b]=v?"0":"",N.transform=(T.devicePixelRatio||1)<=1?"translate("+h+"px, "+m+"px)":"translate3d("+h+"px, "+m+"px, 0)",N))}return Object.assign({},C,(e={},e[I]=y?m+"px":"",e[b]=v?h+"px":"",e.transform="",e))}function uGe(t){var e=t.state,i=t.options,n=i.gpuAcceleration,r=n===void 0?!0:n,o=i.adaptive,a=o===void 0?!0:o,s=i.roundOffsets,l=s===void 0?!0:s,c={placement:up(e.placement),variation:Lw(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:r,isFixed:e.options.strategy==="fixed"};e.modifiersData.popperOffsets!=null&&(e.styles.popper=Object.assign({},e.styles.popper,TK(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:l})))),e.modifiersData.arrow!=null&&(e.styles.arrow=Object.assign({},e.styles.arrow,TK(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}const dGe={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:uGe,data:{}};var G1={passive:!0};function pGe(t){var e=t.state,i=t.instance,n=t.options,r=n.scroll,o=r===void 0?!0:r,a=n.resize,s=a===void 0?!0:a,l=Gc(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&c.forEach(function(u){u.addEventListener("scroll",i.update,G1)}),s&&l.addEventListener("resize",i.update,G1),function(){o&&c.forEach(function(u){u.removeEventListener("scroll",i.update,G1)}),s&&l.removeEventListener("resize",i.update,G1)}}const hGe={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:pGe,data:{}};var fGe={left:"right",right:"left",bottom:"top",top:"bottom"};function iM(t){return t.replace(/left|right|bottom|top/g,function(e){return fGe[e]})}var mGe={start:"end",end:"start"};function UK(t){return t.replace(/start|end/g,function(e){return mGe[e]})}function P4(t){var e=Gc(t),i=e.pageXOffset,n=e.pageYOffset;return{scrollLeft:i,scrollTop:n}}function C4(t){return Ow(Mg(t)).left+P4(t).scrollLeft}function gGe(t,e){var i=Gc(t),n=Mg(t),r=i.visualViewport,o=n.clientWidth,a=n.clientHeight,s=0,l=0;if(r){o=r.width,a=r.height;var c=Gve();(c||!c&&e==="fixed")&&(s=r.offsetLeft,l=r.offsetTop)}return{width:o,height:a,x:s+C4(t),y:l}}function vGe(t){var e,i=Mg(t),n=P4(t),r=(e=t.ownerDocument)==null?void 0:e.body,o=Nv(i.scrollWidth,i.clientWidth,r?r.scrollWidth:0,r?r.clientWidth:0),a=Nv(i.scrollHeight,i.clientHeight,r?r.scrollHeight:0,r?r.clientHeight:0),s=-n.scrollLeft+C4(t),l=-n.scrollTop;return hf(r||i).direction==="rtl"&&(s+=Nv(i.clientWidth,r?r.clientWidth:0)-o),{width:o,height:a,x:s,y:l}}function E4(t){var e=hf(t),i=e.overflow,n=e.overflowX,r=e.overflowY;return/auto|scroll|overlay|hidden/.test(i+r+n)}function Kve(t){return["html","body","#document"].indexOf(_p(t))>=0?t.ownerDocument.body:gu(t)&&E4(t)?t:Kve(Vx(t))}function wT(t,e){var i;e===void 0&&(e=[]);var n=Kve(t),r=n===((i=t.ownerDocument)==null?void 0:i.body),o=Gc(n),a=r?[o].concat(o.visualViewport||[],E4(n)?n:[]):n,s=e.concat(a);return r?s:s.concat(wT(Vx(a)))}function r$(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function yGe(t,e){var i=Ow(t,!1,e==="fixed");return i.top=i.top+t.clientTop,i.left=i.left+t.clientLeft,i.bottom=i.top+t.clientHeight,i.right=i.left+t.clientWidth,i.width=t.clientWidth,i.height=t.clientHeight,i.x=i.left,i.y=i.top,i}function DK(t,e,i){return e===Vve?r$(gGe(t,i)):py(e)?yGe(e,i):r$(vGe(Mg(t)))}function bGe(t){var e=wT(Vx(t)),i=["absolute","fixed"].indexOf(hf(t).position)>=0,n=i&&gu(t)?KC(t):t;return py(n)?e.filter(function(r){return py(r)&&zve(r,n)&&_p(r)!=="body"}):[]}function IGe(t,e,i,n){var r=e==="clippingParents"?bGe(t):[].concat(e),o=[].concat(r,[i]),a=o[0],s=o.reduce(function(l,c){var u=DK(t,c,n);return l.top=Nv(u.top,l.top),l.right=hN(u.right,l.right),l.bottom=hN(u.bottom,l.bottom),l.left=Nv(u.left,l.left),l},DK(t,a,n));return s.width=s.right-s.left,s.height=s.bottom-s.top,s.x=s.left,s.y=s.top,s}function Zve(t){var e=t.reference,i=t.element,n=t.placement,r=n?up(n):null,o=n?Lw(n):null,a=e.x+e.width/2-i.width/2,s=e.y+e.height/2-i.height/2,l;switch(r){case Fl:l={x:a,y:e.y-i.height};break;case _u:l={x:a,y:e.y+e.height};break;case ku:l={x:e.x+e.width,y:s};break;case Bl:l={x:e.x-i.width,y:s};break;default:l={x:e.x,y:e.y}}var c=r?D4(r):null;if(c!=null){var u=c==="y"?"height":"width";switch(o){case kw:l[c]=l[c]-(e[u]/2-i[u]/2);break;case KU:l[c]=l[c]+(e[u]/2-i[u]/2);break}}return l}function ZU(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=n===void 0?t.placement:n,o=i.strategy,a=o===void 0?t.strategy:o,s=i.boundary,l=s===void 0?VHe:s,c=i.rootBoundary,u=c===void 0?Vve:c,d=i.elementContext,p=d===void 0?yS:d,h=i.altBoundary,f=h===void 0?!1:h,m=i.padding,g=m===void 0?0:m,v=qve(typeof g!="number"?g:Yve(g,YC)),y=p===yS?jHe:yS,b=t.rects.popper,I=t.elements[f?y:p],T=IGe(py(I)?I:I.contextElement||Mg(t.elements.popper),l,u,a),S=Ow(t.elements.reference),w=Zve({reference:S,element:b,strategy:"absolute",placement:r}),U=r$(Object.assign({},b,w)),D=p===yS?U:S,E={top:T.top-D.top+v.top,bottom:D.bottom-T.bottom+v.bottom,left:T.left-D.left+v.left,right:D.right-T.right+v.right},C=t.modifiersData.offset;if(p===yS&&C){var M=C[r];Object.keys(E).forEach(function(N){var R=[ku,_u].indexOf(N)>=0?1:-1,A=[Fl,_u].indexOf(N)>=0?"y":"x";E[N]+=M[A]*R})}return E}function wGe(t,e){e===void 0&&(e={});var i=e,n=i.placement,r=i.boundary,o=i.rootBoundary,a=i.padding,s=i.flipVariations,l=i.allowedAutoPlacements,c=l===void 0?jve:l,u=Lw(n),d=u?s?wK:wK.filter(function(f){return Lw(f)===u}):YC,p=d.filter(function(f){return c.indexOf(f)>=0});p.length===0&&(p=d);var h=p.reduce(function(f,m){return f[m]=ZU(t,{placement:m,boundary:r,rootBoundary:o,padding:a})[up(m)],f},{});return Object.keys(h).sort(function(f,m){return h[f]-h[m]})}function SGe(t){if(up(t)===S4)return[];var e=iM(t);return[UK(t),e,UK(e)]}function TGe(t){var e=t.state,i=t.options,n=t.name;if(!e.modifiersData[n]._skip){for(var r=i.mainAxis,o=r===void 0?!0:r,a=i.altAxis,s=a===void 0?!0:a,l=i.fallbackPlacements,c=i.padding,u=i.boundary,d=i.rootBoundary,p=i.altBoundary,h=i.flipVariations,f=h===void 0?!0:h,m=i.allowedAutoPlacements,g=e.options.placement,v=up(g),y=v===g,b=l||(y||!f?[iM(g)]:SGe(g)),I=[g].concat(b).reduce(function(z,G){return z.concat(up(G)===S4?wGe(e,{placement:G,boundary:u,rootBoundary:d,padding:c,flipVariations:f,allowedAutoPlacements:m}):G)},[]),T=e.rects.reference,S=e.rects.popper,w=new Map,U=!0,D=I[0],E=0;E<I.length;E++){var C=I[E],M=up(C),N=Lw(C)===kw,R=[Fl,_u].indexOf(M)>=0,A=R?"width":"height",_=ZU(e,{placement:C,boundary:u,rootBoundary:d,altBoundary:p,padding:c}),k=R?N?ku:Bl:N?_u:Fl;T[A]>S[A]&&(k=iM(k));var O=iM(k),F=[];if(o&&F.push(_[M]<=0),s&&F.push(_[k]<=0,_[O]<=0),F.every(function(z){return z})){D=C,U=!1;break}w.set(C,F)}if(U)for(var B=f?3:1,$=function(G){var W=I.find(function(K){var Z=w.get(K);if(Z)return Z.slice(0,G).every(function(Y){return Y})});if(W)return D=W,"break"},V=B;V>0;V--){var H=$(V);if(H==="break")break}e.placement!==D&&(e.modifiersData[n]._skip=!0,e.placement=D,e.reset=!0)}}const UGe={name:"flip",enabled:!0,phase:"main",fn:TGe,requiresIfExists:["offset"],data:{_skip:!1}};function PK(t,e,i){return i===void 0&&(i={x:0,y:0}),{top:t.top-e.height-i.y,right:t.right-e.width+i.x,bottom:t.bottom-e.height+i.y,left:t.left-e.width-i.x}}function CK(t){return[Fl,ku,_u,Bl].some(function(e){return t[e]>=0})}function DGe(t){var e=t.state,i=t.name,n=e.rects.reference,r=e.rects.popper,o=e.modifiersData.preventOverflow,a=ZU(e,{elementContext:"reference"}),s=ZU(e,{altBoundary:!0}),l=PK(a,n),c=PK(s,r,o),u=CK(l),d=CK(c);e.modifiersData[i]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:u,hasPopperEscaped:d},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":u,"data-popper-escaped":d})}const PGe={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:DGe};function CGe(t,e,i){var n=up(t),r=[Bl,Fl].indexOf(n)>=0?-1:1,o=typeof i=="function"?i(Object.assign({},e,{placement:t})):i,a=o[0],s=o[1];return a=a||0,s=(s||0)*r,[Bl,ku].indexOf(n)>=0?{x:s,y:a}:{x:a,y:s}}function EGe(t){var e=t.state,i=t.options,n=t.name,r=i.offset,o=r===void 0?[0,0]:r,a=jve.reduce(function(u,d){return u[d]=CGe(d,e.rects,o),u},{}),s=a[e.placement],l=s.x,c=s.y;e.modifiersData.popperOffsets!=null&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[n]=a}const MGe={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:EGe};function RGe(t){var e=t.state,i=t.name;e.modifiersData[i]=Zve({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}const NGe={name:"popperOffsets",enabled:!0,phase:"read",fn:RGe,data:{}};function AGe(t){return t==="x"?"y":"x"}function _Ge(t){var e=t.state,i=t.options,n=t.name,r=i.mainAxis,o=r===void 0?!0:r,a=i.altAxis,s=a===void 0?!1:a,l=i.boundary,c=i.rootBoundary,u=i.altBoundary,d=i.padding,p=i.tether,h=p===void 0?!0:p,f=i.tetherOffset,m=f===void 0?0:f,g=ZU(e,{boundary:l,rootBoundary:c,padding:d,altBoundary:u}),v=up(e.placement),y=Lw(e.placement),b=!y,I=D4(v),T=AGe(I),S=e.modifiersData.popperOffsets,w=e.rects.reference,U=e.rects.popper,D=typeof m=="function"?m(Object.assign({},e.rects,{placement:e.placement})):m,E=typeof D=="number"?{mainAxis:D,altAxis:D}:Object.assign({mainAxis:0,altAxis:0},D),C=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,M={x:0,y:0};if(S){if(o){var N,R=I==="y"?Fl:Bl,A=I==="y"?_u:ku,_=I==="y"?"height":"width",k=S[I],O=k+g[R],F=k-g[A],B=h?-U[_]/2:0,$=y===kw?w[_]:U[_],V=y===kw?-U[_]:-w[_],H=e.elements.arrow,z=h&&H?U4(H):{width:0,height:0},G=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:Wve(),W=G[R],K=G[A],Z=IT(0,w[_],z[_]),Y=b?w[_]/2-B-Z-W-E.mainAxis:$-Z-W-E.mainAxis,X=b?-w[_]/2+B+Z+K+E.mainAxis:V+Z+K+E.mainAxis,Q=e.elements.arrow&&KC(e.elements.arrow),te=Q?I==="y"?Q.clientTop||0:Q.clientLeft||0:0,J=(N=C==null?void 0:C[I])!=null?N:0,ie=k+Y-J-te,oe=k+X-J,ne=IT(h?hN(O,ie):O,k,h?Nv(F,oe):F);S[I]=ne,M[I]=ne-k}if(s){var re,me=I==="x"?Fl:Bl,he=I==="x"?_u:ku,be=S[T],Se=T==="y"?"height":"width",De=be+g[me],Oe=be-g[he],xe=[Fl,Bl].indexOf(v)!==-1,$e=(re=C==null?void 0:C[T])!=null?re:0,Ae=xe?De:be-w[Se]-U[Se]-$e+E.altAxis,ve=xe?be+w[Se]+U[Se]-$e-E.altAxis:Oe,ke=h&&xe?nGe(Ae,be,ve):IT(h?Ae:De,be,h?ve:Oe);S[T]=ke,M[T]=ke-be}e.modifiersData[n]=M}}const kGe={name:"preventOverflow",enabled:!0,phase:"main",fn:_Ge,requiresIfExists:["offset"]};function xGe(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function OGe(t){return t===Gc(t)||!gu(t)?P4(t):xGe(t)}function LGe(t){var e=t.getBoundingClientRect(),i=xw(e.width)/t.offsetWidth||1,n=xw(e.height)/t.offsetHeight||1;return i!==1||n!==1}function FGe(t,e,i){i===void 0&&(i=!1);var n=gu(e),r=gu(e)&&LGe(e),o=Mg(e),a=Ow(t,r,i),s={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(n||!n&&!i)&&((_p(e)!=="body"||E4(o))&&(s=OGe(e)),gu(e)?(l=Ow(e,!0),l.x+=e.clientLeft,l.y+=e.clientTop):o&&(l.x=C4(o))),{x:a.left+s.scrollLeft-l.x,y:a.top+s.scrollTop-l.y,width:a.width,height:a.height}}function BGe(t){var e=new Map,i=new Set,n=[];t.forEach(function(o){e.set(o.name,o)});function r(o){i.add(o.name);var a=[].concat(o.requires||[],o.requiresIfExists||[]);a.forEach(function(s){if(!i.has(s)){var l=e.get(s);l&&r(l)}}),n.push(o)}return t.forEach(function(o){i.has(o.name)||r(o)}),n}function $Ge(t){var e=BGe(t);return JHe.reduce(function(i,n){return i.concat(e.filter(function(r){return r.phase===n}))},[])}function VGe(t){var e;return function(){return e||(e=new Promise(function(i){Promise.resolve().then(function(){e=void 0,i(t())})})),e}}function jGe(t){var e=t.reduce(function(i,n){var r=i[n.name];return i[n.name]=r?Object.assign({},r,n,{options:Object.assign({},r.options,n.options),data:Object.assign({},r.data,n.data)}):n,i},{});return Object.keys(e).map(function(i){return e[i]})}var EK={placement:"bottom",modifiers:[],strategy:"absolute"};function MK(){for(var t=arguments.length,e=new Array(t),i=0;i<t;i++)e[i]=arguments[i];return!e.some(function(n){return!(n&&typeof n.getBoundingClientRect=="function")})}function HGe(t){t===void 0&&(t={});var e=t,i=e.defaultModifiers,n=i===void 0?[]:i,r=e.defaultOptions,o=r===void 0?EK:r;return function(s,l,c){c===void 0&&(c=o);var u={placement:"bottom",orderedModifiers:[],options:Object.assign({},EK,o),modifiersData:{},elements:{reference:s,popper:l},attributes:{},styles:{}},d=[],p=!1,h={state:u,setOptions:function(v){var y=typeof v=="function"?v(u.options):v;m(),u.options=Object.assign({},o,u.options,y),u.scrollParents={reference:py(s)?wT(s):s.contextElement?wT(s.contextElement):[],popper:wT(l)};var b=$Ge(jGe([].concat(n,u.options.modifiers)));return u.orderedModifiers=b.filter(function(I){return I.enabled}),f(),h.update()},forceUpdate:function(){if(!p){var v=u.elements,y=v.reference,b=v.popper;if(MK(y,b)){u.rects={reference:FGe(y,KC(b),u.options.strategy==="fixed"),popper:U4(b)},u.reset=!1,u.placement=u.options.placement,u.orderedModifiers.forEach(function(E){return u.modifiersData[E.name]=Object.assign({},E.data)});for(var I=0;I<u.orderedModifiers.length;I++){if(u.reset===!0){u.reset=!1,I=-1;continue}var T=u.orderedModifiers[I],S=T.fn,w=T.options,U=w===void 0?{}:w,D=T.name;typeof S=="function"&&(u=S({state:u,options:U,name:D,instance:h})||u)}}}},update:VGe(function(){return new Promise(function(g){h.forceUpdate(),g(u)})}),destroy:function(){m(),p=!0}};if(!MK(s,l))return h;h.setOptions(c).then(function(g){!p&&c.onFirstUpdate&&c.onFirstUpdate(g)});function f(){u.orderedModifiers.forEach(function(g){var v=g.name,y=g.options,b=y===void 0?{}:y,I=g.effect;if(typeof I=="function"){var T=I({state:u,name:v,instance:h,options:b}),S=function(){};d.push(T||S)}})}function m(){d.forEach(function(g){return g()}),d=[]}return h}}var GGe=[hGe,NGe,dGe,Hve,MGe,UGe,kGe,sGe,PGe],zGe=HGe({defaultModifiers:GGe}),WGe="tippy-box",Xve="tippy-content",qGe="tippy-backdrop",Jve="tippy-arrow",Qve="tippy-svg-arrow",Wg={passive:!0,capture:!0},eye=function(){return document.body};function $L(t,e,i){if(Array.isArray(t)){var n=t[e];return n??(Array.isArray(i)?i[e]:i)}return t}function M4(t,e){var i={}.toString.call(t);return i.indexOf("[object")===0&&i.indexOf(e+"]")>-1}function tye(t,e){return typeof t=="function"?t.apply(void 0,e):t}function RK(t,e){if(e===0)return t;var i;return function(n){clearTimeout(i),i=setTimeout(function(){t(n)},e)}}function YGe(t){return t.split(/\s+/).filter(Boolean)}function nI(t){return[].concat(t)}function NK(t,e){t.indexOf(e)===-1&&t.push(e)}function KGe(t){return t.filter(function(e,i){return t.indexOf(e)===i})}function ZGe(t){return t.split("-")[0]}function fN(t){return[].slice.call(t)}function AK(t){return Object.keys(t).reduce(function(e,i){return t[i]!==void 0&&(e[i]=t[i]),e},{})}function ST(){return document.createElement("div")}function jx(t){return["Element","Fragment"].some(function(e){return M4(t,e)})}function XGe(t){return M4(t,"NodeList")}function JGe(t){return M4(t,"MouseEvent")}function QGe(t){return!!(t&&t._tippy&&t._tippy.reference===t)}function eze(t){return jx(t)?[t]:XGe(t)?fN(t):Array.isArray(t)?t:fN(document.querySelectorAll(t))}function VL(t,e){t.forEach(function(i){i&&(i.style.transitionDuration=e+"ms")})}function _K(t,e){t.forEach(function(i){i&&i.setAttribute("data-state",e)})}function tze(t){var e,i=nI(t),n=i[0];return n!=null&&(e=n.ownerDocument)!=null&&e.body?n.ownerDocument:document}function ize(t,e){var i=e.clientX,n=e.clientY;return t.every(function(r){var o=r.popperRect,a=r.popperState,s=r.props,l=s.interactiveBorder,c=ZGe(a.placement),u=a.modifiersData.offset;if(!u)return!0;var d=c==="bottom"?u.top.y:0,p=c==="top"?u.bottom.y:0,h=c==="right"?u.left.x:0,f=c==="left"?u.right.x:0,m=o.top-n+d>l,g=n-o.bottom-p>l,v=o.left-i+h>l,y=i-o.right-f>l;return m||g||v||y})}function jL(t,e,i){var n=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach(function(r){t[n](r,i)})}function kK(t,e){for(var i=e;i;){var n;if(t.contains(i))return!0;i=i.getRootNode==null||(n=i.getRootNode())==null?void 0:n.host}return!1}var qd={isTouch:!1},xK=0;function nze(){qd.isTouch||(qd.isTouch=!0,window.performance&&document.addEventListener("mousemove",iye))}function iye(){var t=performance.now();t-xK<20&&(qd.isTouch=!1,document.removeEventListener("mousemove",iye)),xK=t}function rze(){var t=document.activeElement;if(QGe(t)){var e=t._tippy;t.blur&&!e.state.isVisible&&t.blur()}}function oze(){document.addEventListener("touchstart",nze,Wg),window.addEventListener("blur",rze)}var aze=typeof window<"u"&&typeof document<"u",sze=aze?!!window.msCrypto:!1,lze={animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},cze={allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999},id=Object.assign({appendTo:eye,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},lze,cze),uze=Object.keys(id),dze=function(e){var i=Object.keys(e);i.forEach(function(n){id[n]=e[n]})};function nye(t){var e=t.plugins||[],i=e.reduce(function(n,r){var o=r.name,a=r.defaultValue;if(o){var s;n[o]=t[o]!==void 0?t[o]:(s=id[o])!=null?s:a}return n},{});return Object.assign({},t,i)}function pze(t,e){var i=e?Object.keys(nye(Object.assign({},id,{plugins:e}))):uze,n=i.reduce(function(r,o){var a=(t.getAttribute("data-tippy-"+o)||"").trim();if(!a)return r;if(o==="content")r[o]=a;else try{r[o]=JSON.parse(a)}catch{r[o]=a}return r},{});return n}function OK(t,e){var i=Object.assign({},e,{content:tye(e.content,[t])},e.ignoreAttributes?{}:pze(t,e.plugins));return i.aria=Object.assign({},id.aria,i.aria),i.aria={expanded:i.aria.expanded==="auto"?e.interactive:i.aria.expanded,content:i.aria.content==="auto"?e.interactive?null:"describedby":i.aria.content},i}var hze=function(){return"innerHTML"};function o$(t,e){t[hze()]=e}function LK(t){var e=ST();return t===!0?e.className=Jve:(e.className=Qve,jx(t)?e.appendChild(t):o$(e,t)),e}function FK(t,e){jx(e.content)?(o$(t,""),t.appendChild(e.content)):typeof e.content!="function"&&(e.allowHTML?o$(t,e.content):t.textContent=e.content)}function a$(t){var e=t.firstElementChild,i=fN(e.children);return{box:e,content:i.find(function(n){return n.classList.contains(Xve)}),arrow:i.find(function(n){return n.classList.contains(Jve)||n.classList.contains(Qve)}),backdrop:i.find(function(n){return n.classList.contains(qGe)})}}function rye(t){var e=ST(),i=ST();i.className=WGe,i.setAttribute("data-state","hidden"),i.setAttribute("tabindex","-1");var n=ST();n.className=Xve,n.setAttribute("data-state","hidden"),FK(n,t.props),e.appendChild(i),i.appendChild(n),r(t.props,t.props);function r(o,a){var s=a$(e),l=s.box,c=s.content,u=s.arrow;a.theme?l.setAttribute("data-theme",a.theme):l.removeAttribute("data-theme"),typeof a.animation=="string"?l.setAttribute("data-animation",a.animation):l.removeAttribute("data-animation"),a.inertia?l.setAttribute("data-inertia",""):l.removeAttribute("data-inertia"),l.style.maxWidth=typeof a.maxWidth=="number"?a.maxWidth+"px":a.maxWidth,a.role?l.setAttribute("role",a.role):l.removeAttribute("role"),(o.content!==a.content||o.allowHTML!==a.allowHTML)&&FK(c,t.props),a.arrow?u?o.arrow!==a.arrow&&(l.removeChild(u),l.appendChild(LK(a.arrow))):l.appendChild(LK(a.arrow)):u&&l.removeChild(u)}return{popper:e,onUpdate:r}}rye.$$tippy=!0;var fze=1,z1=[],HL=[];function mze(t,e){var i=OK(t,Object.assign({},id,nye(AK(e)))),n,r,o,a=!1,s=!1,l=!1,c=!1,u,d,p,h=[],f=RK(ie,i.interactiveDebounce),m,g=fze++,v=null,y=KGe(i.plugins),b={isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},I={id:g,reference:t,popper:ST(),popperInstance:v,props:i,state:b,plugins:y,clearDelayTimeouts:Ae,setProps:ve,setContent:ke,show:ye,hide:Ie,hideWithInteractivity:Ne,enable:xe,disable:$e,unmount:Fe,destroy:Le};if(!i.render)return I;var T=i.render(I),S=T.popper,w=T.onUpdate;S.setAttribute("data-tippy-root",""),S.id="tippy-"+I.id,I.popper=S,t._tippy=I,S._tippy=I;var U=y.map(function(ge){return ge.fn(I)}),D=t.hasAttribute("aria-expanded");return Q(),B(),k(),O("onCreate",[I]),i.showOnCreate&&De(),S.addEventListener("mouseenter",function(){I.props.interactive&&I.state.isVisible&&I.clearDelayTimeouts()}),S.addEventListener("mouseleave",function(){I.props.interactive&&I.props.trigger.indexOf("mouseenter")>=0&&R().addEventListener("mousemove",f)}),I;function E(){var ge=I.props.touch;return Array.isArray(ge)?ge:[ge,0]}function C(){return E()[0]==="hold"}function M(){var ge;return!!((ge=I.props.render)!=null&&ge.$$tippy)}function N(){return m||t}function R(){var ge=N().parentNode;return ge?tze(ge):document}function A(){return a$(S)}function _(ge){return I.state.isMounted&&!I.state.isVisible||qd.isTouch||u&&u.type==="focus"?0:$L(I.props.delay,ge?0:1,id.delay)}function k(ge){ge===void 0&&(ge=!1),S.style.pointerEvents=I.props.interactive&&!ge?"":"none",S.style.zIndex=""+I.props.zIndex}function O(ge,Ee,we){if(we===void 0&&(we=!0),U.forEach(function(Te){Te[ge]&&Te[ge].apply(Te,Ee)}),we){var fe;(fe=I.props)[ge].apply(fe,Ee)}}function F(){var ge=I.props.aria;if(ge.content){var Ee="aria-"+ge.content,we=S.id,fe=nI(I.props.triggerTarget||t);fe.forEach(function(Te){var ue=Te.getAttribute(Ee);if(I.state.isVisible)Te.setAttribute(Ee,ue?ue+" "+we:we);else{var de=ue&&ue.replace(we,"").trim();de?Te.setAttribute(Ee,de):Te.removeAttribute(Ee)}})}}function B(){if(!(D||!I.props.aria.expanded)){var ge=nI(I.props.triggerTarget||t);ge.forEach(function(Ee){I.props.interactive?Ee.setAttribute("aria-expanded",I.state.isVisible&&Ee===N()?"true":"false"):Ee.removeAttribute("aria-expanded")})}}function $(){R().removeEventListener("mousemove",f),z1=z1.filter(function(ge){return ge!==f})}function V(ge){if(!(qd.isTouch&&(l||ge.type==="mousedown"))){var Ee=ge.composedPath&&ge.composedPath()[0]||ge.target;if(!(I.props.interactive&&kK(S,Ee))){if(nI(I.props.triggerTarget||t).some(function(we){return kK(we,Ee)})){if(qd.isTouch||I.state.isVisible&&I.props.trigger.indexOf("click")>=0)return}else O("onClickOutside",[I,ge]);I.props.hideOnClick===!0&&(I.clearDelayTimeouts(),I.hide(),s=!0,setTimeout(function(){s=!1}),I.state.isMounted||W())}}}function H(){l=!0}function z(){l=!1}function G(){var ge=R();ge.addEventListener("mousedown",V,!0),ge.addEventListener("touchend",V,Wg),ge.addEventListener("touchstart",z,Wg),ge.addEventListener("touchmove",H,Wg)}function W(){var ge=R();ge.removeEventListener("mousedown",V,!0),ge.removeEventListener("touchend",V,Wg),ge.removeEventListener("touchstart",z,Wg),ge.removeEventListener("touchmove",H,Wg)}function K(ge,Ee){Y(ge,function(){!I.state.isVisible&&S.parentNode&&S.parentNode.contains(S)&&Ee()})}function Z(ge,Ee){Y(ge,Ee)}function Y(ge,Ee){var we=A().box;function fe(Te){Te.target===we&&(jL(we,"remove",fe),Ee())}if(ge===0)return Ee();jL(we,"remove",d),jL(we,"add",fe),d=fe}function X(ge,Ee,we){we===void 0&&(we=!1);var fe=nI(I.props.triggerTarget||t);fe.forEach(function(Te){Te.addEventListener(ge,Ee,we),h.push({node:Te,eventType:ge,handler:Ee,options:we})})}function Q(){C()&&(X("touchstart",J,{passive:!0}),X("touchend",oe,{passive:!0})),YGe(I.props.trigger).forEach(function(ge){if(ge!=="manual")switch(X(ge,J),ge){case"mouseenter":X("mouseleave",oe);break;case"focus":X(sze?"focusout":"blur",ne);break;case"focusin":X("focusout",ne);break}})}function te(){h.forEach(function(ge){var Ee=ge.node,we=ge.eventType,fe=ge.handler,Te=ge.options;Ee.removeEventListener(we,fe,Te)}),h=[]}function J(ge){var Ee,we=!1;if(!(!I.state.isEnabled||re(ge)||s)){var fe=((Ee=u)==null?void 0:Ee.type)==="focus";u=ge,m=ge.currentTarget,B(),!I.state.isVisible&&JGe(ge)&&z1.forEach(function(Te){return Te(ge)}),ge.type==="click"&&(I.props.trigger.indexOf("mouseenter")<0||a)&&I.props.hideOnClick!==!1&&I.state.isVisible?we=!0:De(ge),ge.type==="click"&&(a=!we),we&&!fe&&Oe(ge)}}function ie(ge){var Ee=ge.target,we=N().contains(Ee)||S.contains(Ee);if(!(ge.type==="mousemove"&&we)){var fe=Se().concat(S).map(function(Te){var ue,de=Te._tippy,_e=(ue=de.popperInstance)==null?void 0:ue.state;return _e?{popperRect:Te.getBoundingClientRect(),popperState:_e,props:i}:null}).filter(Boolean);ize(fe,ge)&&($(),Oe(ge))}}function oe(ge){var Ee=re(ge)||I.props.trigger.indexOf("click")>=0&&a;if(!Ee){if(I.props.interactive){I.hideWithInteractivity(ge);return}Oe(ge)}}function ne(ge){I.props.trigger.indexOf("focusin")<0&&ge.target!==N()||I.props.interactive&&ge.relatedTarget&&S.contains(ge.relatedTarget)||Oe(ge)}function re(ge){return qd.isTouch?C()!==ge.type.indexOf("touch")>=0:!1}function me(){he();var ge=I.props,Ee=ge.popperOptions,we=ge.placement,fe=ge.offset,Te=ge.getReferenceClientRect,ue=ge.moveTransition,de=M()?a$(S).arrow:null,_e=Te?{getBoundingClientRect:Te,contextElement:Te.contextElement||N()}:t,Ue={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(He){var Be=He.state;if(M()){var et=A(),ot=et.box;["placement","reference-hidden","escaped"].forEach(function(mt){mt==="placement"?ot.setAttribute("data-placement",Be.placement):Be.attributes.popper["data-popper-"+mt]?ot.setAttribute("data-"+mt,""):ot.removeAttribute("data-"+mt)}),Be.attributes.popper={}}}},Ce=[{name:"offset",options:{offset:fe}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!ue}},Ue];M()&&de&&Ce.push({name:"arrow",options:{element:de,padding:3}}),Ce.push.apply(Ce,(Ee==null?void 0:Ee.modifiers)||[]),I.popperInstance=zGe(_e,S,Object.assign({},Ee,{placement:we,onFirstUpdate:p,modifiers:Ce}))}function he(){I.popperInstance&&(I.popperInstance.destroy(),I.popperInstance=null)}function be(){var ge=I.props.appendTo,Ee,we=N();I.props.interactive&&ge===eye||ge==="parent"?Ee=we.parentNode:Ee=tye(ge,[we]),Ee.contains(S)||Ee.appendChild(S),I.state.isMounted=!0,me()}function Se(){return fN(S.querySelectorAll("[data-tippy-root]"))}function De(ge){I.clearDelayTimeouts(),ge&&O("onTrigger",[I,ge]),G();var Ee=_(!0),we=E(),fe=we[0],Te=we[1];qd.isTouch&&fe==="hold"&&Te&&(Ee=Te),Ee?n=setTimeout(function(){I.show()},Ee):I.show()}function Oe(ge){if(I.clearDelayTimeouts(),O("onUntrigger",[I,ge]),!I.state.isVisible){W();return}if(!(I.props.trigger.indexOf("mouseenter")>=0&&I.props.trigger.indexOf("click")>=0&&["mouseleave","mousemove"].indexOf(ge.type)>=0&&a)){var Ee=_(!1);Ee?r=setTimeout(function(){I.state.isVisible&&I.hide()},Ee):o=requestAnimationFrame(function(){I.hide()})}}function xe(){I.state.isEnabled=!0}function $e(){I.hide(),I.state.isEnabled=!1}function Ae(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(o)}function ve(ge){if(!I.state.isDestroyed){O("onBeforeUpdate",[I,ge]),te();var Ee=I.props,we=OK(t,Object.assign({},Ee,AK(ge),{ignoreAttributes:!0}));I.props=we,Q(),Ee.interactiveDebounce!==we.interactiveDebounce&&($(),f=RK(ie,we.interactiveDebounce)),Ee.triggerTarget&&!we.triggerTarget?nI(Ee.triggerTarget).forEach(function(fe){fe.removeAttribute("aria-expanded")}):we.triggerTarget&&t.removeAttribute("aria-expanded"),B(),k(),w&&w(Ee,we),I.popperInstance&&(me(),Se().forEach(function(fe){requestAnimationFrame(fe._tippy.popperInstance.forceUpdate)})),O("onAfterUpdate",[I,ge])}}function ke(ge){I.setProps({content:ge})}function ye(){var ge=I.state.isVisible,Ee=I.state.isDestroyed,we=!I.state.isEnabled,fe=qd.isTouch&&!I.props.touch,Te=$L(I.props.duration,0,id.duration);if(!(ge||Ee||we||fe)&&!N().hasAttribute("disabled")&&(O("onShow",[I],!1),I.props.onShow(I)!==!1)){if(I.state.isVisible=!0,M()&&(S.style.visibility="visible"),k(),G(),I.state.isMounted||(S.style.transition="none"),M()){var ue=A(),de=ue.box,_e=ue.content;VL([de,_e],0)}p=function(){var Ce;if(!(!I.state.isVisible||c)){if(c=!0,S.offsetHeight,S.style.transition=I.props.moveTransition,M()&&I.props.animation){var We=A(),He=We.box,Be=We.content;VL([He,Be],Te),_K([He,Be],"visible")}F(),B(),NK(HL,I),(Ce=I.popperInstance)==null||Ce.forceUpdate(),O("onMount",[I]),I.props.animation&&M()&&Z(Te,function(){I.state.isShown=!0,O("onShown",[I])})}},be()}}function Ie(){var ge=!I.state.isVisible,Ee=I.state.isDestroyed,we=!I.state.isEnabled,fe=$L(I.props.duration,1,id.duration);if(!(ge||Ee||we)&&(O("onHide",[I],!1),I.props.onHide(I)!==!1)){if(I.state.isVisible=!1,I.state.isShown=!1,c=!1,a=!1,M()&&(S.style.visibility="hidden"),$(),W(),k(!0),M()){var Te=A(),ue=Te.box,de=Te.content;I.props.animation&&(VL([ue,de],fe),_K([ue,de],"hidden"))}F(),B(),I.props.animation?M()&&K(fe,I.unmount):I.unmount()}}function Ne(ge){R().addEventListener("mousemove",f),NK(z1,f),f(ge)}function Fe(){I.state.isVisible&&I.hide(),I.state.isMounted&&(he(),Se().forEach(function(ge){ge._tippy.unmount()}),S.parentNode&&S.parentNode.removeChild(S),HL=HL.filter(function(ge){return ge!==I}),I.state.isMounted=!1,O("onHidden",[I]))}function Le(){I.state.isDestroyed||(I.clearDelayTimeouts(),I.unmount(),te(),delete t._tippy,I.state.isDestroyed=!0,O("onDestroy",[I]))}}function ff(t,e){e===void 0&&(e={});var i=id.plugins.concat(e.plugins||[]);oze();var n=Object.assign({},e,{plugins:i}),r=eze(t),o=r.reduce(function(a,s){var l=s&&mze(s,n);return l&&a.push(l),a},[]);return jx(t)?o[0]:o}ff.defaultProps=id;ff.setDefaultProps=dze;ff.currentInput=qd;Object.assign({},Hve,{effect:function(e){var i=e.state,n={popper:{position:i.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(i.elements.popper.style,n.popper),i.styles=n,i.elements.arrow&&Object.assign(i.elements.arrow.style,n.arrow)}});ff.setDefaultProps({render:rye});function BK(t){var i;const e=document.createElement("button");return e.className="button font-medium",t.disabled&&(e.disabled=!0),t.class&&e.classList.add(t.class),t.id&&(e.id=t.id),t.location===Ut?e.style="margin-left: 1em":e.style="margin-right: 1em",t.intent&&e.classList.add(t.intent),(i=t.toolTip)!=null&&i.content&&ff(e,t.toolTip),e.innerHTML=t.label,t.visible===!1&&(e.style.display=ht),e}const R4=({target:t})=>(e=[])=>{t.style.backgroundColor=e!=null&&e.length?"lightgray":nw;const i=(n,r,o)=>{const a=t.getElementsByClassName(`options_${n}`)[0];a&&(a.style.display=e!=null&&e.length?r:o)};i(Pr,T1,ht),i(Lt,ht,T1),i(Vt,ht,T1),i(Ut,ht,T1)};function Da({table:t,target:e,targetClassName:i,items:n=[],onSelection:r}){var g;const o=!!e;if(e=e||i&&((g=document.getElementsByClassName(i))==null?void 0:g[0]),!e)return;let a=0,s=0;const l={},c={};let u;if(o){Ua(e);const v=gze();Object.assign(l,v.elements),e.appendChild(v.anchor)}const d=Object.assign({},...[Pr,Lt,Vt,Ut,rR].map(v=>{var b;const y=(b=e.getElementsByClassName(`options_${v}`))==null?void 0:b[0];return Ua(y),{[v]:y}}).filter(Boolean)),p=R4({table:t,target:e}),h=(v,y)=>{vt(y.onClick)&&(v.stopPropagation(),!y.disabled&&y.onClick(v,t),y.stateChange&&p())},f={onClick:()=>{},location:Ut};for(const v of n){const y={...f};yu(v)&&Object.assign(y,v);const b=d[y.location];if(!b){console.log(y.location,d);continue}if(y.location===Pr&&(a+=1),y.location===rR){if(vt(y.headerClick)){const I=e.getElementsByClassName("panelHeader")[0];I&&(I.onclick=y.headerClick)}s+=1}if(!y.hide&&(y.input||y.placeholder||y.search)){const I=document.createElement("p");I.style="margin-right: 1em",I.className=`control ${y.search?"has-icons-left has-icons-right":""}`;const T=document.createElement("input");if(y.focus&&(u=T),T.className="input font-medium",T.setAttribute("type","text"),T.setAttribute("autocomplete","cc-number"),T.setAttribute("placeholder",v.placeholder||nw),y.id&&(c[y.id]=T),y.id&&T.setAttribute("id",y.id),y.onKeyDown&&T.addEventListener("keydown",S=>y.onKeyDown(S,y)),y.onChange&&T.addEventListener("change",S=>y.onChange(S,y)),y.onKeyUp&&T.addEventListener("keyup",S=>{y.clearSearch&&S.key==="Escape"&&(S.stopPropagation(),T.value="",y.clearSearch()),y.onKeyUp(S,y)}),y.class&&T.classList.add(y.class),y.visible===!1&&(I.style.display=ht),y.value&&(T.value=y.value),I.appendChild(T),y.search){const S=document.createElement("span");if(S.className="icon is-small is-left font-medium",S.innerHTML='<i class="fa-solid fa-magnifying-glass"></i>',I.appendChild(S),vt(y.clearSearch)){const w=document.createElement("span");w.className="icon is-small is-right font-medium",w.innerHTML='<i class="fa-solid fa-circle-xmark" style="color: #dddada; pointer-events: all; cursor: pointer"></i>',w.onclick=U=>{U.stopPropagation(),T.value="",y.clearSearch()},I.appendChild(w)}}if(v.validator){const S=document.createElement("p");S.className="help font-medium",I.appendChild(S),T.addEventListener("input",w=>dve(v,w,T,S,v.validator))}y.id&&(l[y.id]=I,I.id=y.id),b==null||b.appendChild(I);continue}if(!y.hide&&y.text){const I=document.createElement("div");I.className="font-medium",y.id&&(l[y.id]=I,I.id=y.id),I.innerHTML=y.text,I.onclick=T=>h(T,y),b==null||b.appendChild(I);continue}if(!(!y.id&&(!(y!=null&&y.label)||y.hide))){if(y.options){const I=e$({target:b,button:y,stateChange:p});y.visible===!1&&(I.style.display=ht),y.id&&(l[y.id]=I)}else if(yu(y.selection)){const{selection:{options:I,actions:T},actionPlacement:S,threshold:w=8,...U}=y;if((I==null?void 0:I.length)<w){I.length&&(S===c7?I.unshift({divider:!0}):I.push({divider:!0})),T.forEach(C=>{const{label:M,...N}=C,R={...N,label:`<p style="font-weight: bold">${M}</p>`};S===c7?I.unshift(R):I.push(R)});const D={...U,options:I},E=e$({target:b,button:D,stateChange:p});D.visible===!1&&(E.style.display=ht),D.id&&(l[y.id]=E)}else{const D=BK(y);D.onclick=E=>{E.stopPropagation(),$ve({title:"Select team",options:I})},y.id&&(l[y.id]=D),b==null||b.appendChild(D)}}else{const I=BK(y);I.onclick=T=>h(T,y),y.id&&(l[y.id]=I),b==null||b.appendChild(I)}(!(y!=null&&y.label)||y.hide)&&(l[y.id].style.display=ht)}}const m=e.getElementsByClassName("panelHeader")[0];return m&&(m.style.display=s?nw:ht),t==null||t.on("rowSelectionChanged",(v,y)=>{vt(r)&&r(y),a&&p(y)}),p(),u&&setTimeout(()=>u.focus(),200),{elements:l,inputs:c}}function gze(){const t=document.createElement("div");t.className="panel_container flexcol flexcenter";const e=document.createElement("div");e.className="panelHeader options_header",e.style.display=ht,t.appendChild(e);const i=document.createElement("div");i.className=Dle,i.style="flex-wrap: wrap-reverse;";const n={optionsOverlay:document.createElement("div"),optionsLeft:document.createElement("div"),optionsCenter:document.createElement("div"),optionsRight:document.createElement("div")};n.optionsOverlay.className="options_overlay",n.optionsCenter.className="options_center",n.optionsRight.className="options_right",n.optionsLeft.className="options_left";for(const r of Object.values(n))i.appendChild(r);return t.appendChild(i),{elements:n,anchor:t,header:e}}const oye="leaveTournament",aye="providerCalendar",vze="sendKey",yze="processDirective",bze="tmxDirective",Ize="tmxMessage",wze="add idiom";function Sze(){var i,n;const t=oc(),e=(n=(i=t==null?void 0:t.profile)==null?void 0:i.provider)==null?void 0:n.providerId;if(!e)return vi({message:"No associated provider"});XC({data:{action:aye,payload:{providerId:e}}})}const{FIRST_MATCH_LOSER_CONSOLATION:Tze,COMPASS:Uze,ROUND_ROBIN:Dze}=yr,{MALE:Pze,FEMALE:Cze}=Ca.genderConstants,{DOUBLES:$K}=Ca.eventConstants,{WTN:W1}=Ca.ratingConstants;function Eze(t){const e=t.getData().map(n=>n.tournamentId),i=Mze();for(const n of i)Rx({tournamentRecord:n,tournamentIds:e,table:t});return{...MP}}function Mze(){const e=[{venueName:"Super Fast Courts",venueAbbreviation:"SFC",startTime:"08:00",endTime:"20:00",courtsCount:8}];return[{tournamentAttributes:{tournamentId:"tournament-id-1"},tournamentName:"CourtHive Challenge",participantsProfile:{scaledParticipantsCount:200},drawProfiles:[{category:{categoryName:"U18"},eventName:"U18 Boys Doubles",eventType:$K,gender:Pze,seedsCount:4,drawSize:16},{drawType:Tze,category:{categoryName:"U16"},eventName:"U16 Girls Singles",gender:Cze,seedsCount:8,drawSize:32},{category:{ratingType:W1,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 SINGLES",scaledParticipantsCount:32,seedsCount:8,drawSize:32},{category:{ratingType:W1,ratingMin:18,ratingMax:24.99},eventName:"WTN 18-25 DOUBLES",scaledParticipantsCount:32,eventType:$K,seedsCount:8,drawSize:32}],venueProfiles:e},{tournamentAttributes:{tournamentId:"tournament-id-02"},tournamentName:"Level Based Play",drawProfiles:[{eventName:"WTN 14-19 SINGLES",category:{ratingType:W1,ratingMin:14,ratingMax:19.99},scaledParticipantsCount:32,drawType:Uze,seedsCount:8,drawSize:32},{eventName:"WTN 20-26 SINGLES",category:{ratingType:W1,ratingMin:20,ratingMax:25.99},scaledParticipantsCount:16,drawType:Dze,seedsCount:4,drawSize:16}],venueProfiles:e}].map(n=>$_.generateTournamentRecord(n).tournamentRecord)}function Rze(t){var s;const e=oc(),i=(s=e==null?void 0:e.roles)==null?void 0:s.includes(j_),n=[{label:"Create new tournament",onClick:()=>VVe({table:t})},{label:"Import tournament",onClick:()=>ABe(t)},i&&{label:"Load by ID",onClick:()=>jVe({table:t})},{divider:!0},{label:"Sync with Server",onClick:Sze,close:!0},{divider:!0},{label:"Example Tournaments",onClick:()=>Eze(t),close:!0}].filter(Boolean),r=gb(t),o=[{label:"Actions",options:n,align:Ut},{onKeyDown:l=>l.keyCode===8&&l.target.value.length===1&&r(""),onChange:l=>r(l.target.value),onKeyUp:l=>r(l.target.value),clearSearch:()=>r(""),placeholder:"Search tournaments",location:Lt,search:!0}],a=document.getElementById(Ule);Da({target:a,items:o})}function Nze(t){const e=document.createElement("span"),i=document.createElement("table"),n=t.getValue();i.style.width="400px";const r="4em",o=document.createElement("tr"),a=n.tournamentImageURL?`<img src='${n.tournamentImageURL}' style='width: ${r}' alt=''>`:"",s=`<td style='min-width: ${r}'>${a}</td><td><div style='margin-left: 1em'><strong style='font-size: 1.5em'>${n.tournamentName}</strong></div><div style='margin-left: 1em'>${n.startDate} / ${n.endDate}</div></td>`;return o.innerHTML=s,i.appendChild(o),e.appendChild(i),e}function Aze({providerId:t,tournamentId:e}){const i=()=>Qe.router.navigate(`/tournaments/${e}`),n=r=>{r&&(r.calendar=r.calendar.filter(o=>o.tournamentId!==e),No.addProvider(r).then(i))};No.findProvider(t).then(n)}function sye(t,e,i){if(!t)return;const n=document.createElement("aside");n.classList.add("menu");const r={},o=d=>i&&d.close!==!1?p=>{p.stopPropagation(),i(),d.onClick()}:p=>{p.stopPropagation(),d.onClick()};let a=0;const s=()=>(a+=1,a),l=d=>(d==null?void 0:d.heading)||(d==null?void 0:d.text)||(d==null?void 0:d.label)||`Item ${s()}`,c=d=>{const p=document.createElement("li");if(p.className="font-medium",d.style&&(p.style=d.style),d.onClick){const h=d.fontSize||"1em";if(d.divider){const f=document.createElement("hr");f.classList.add("dropdown-divider"),p.appendChild(f)}else{const f=document.createElement("a"),m=d.disabled?"0.4":"1";f.style=`text-decoration: none; opacity: ${m}; font-size: ${h}`,d.class&&f.classList.add(d.class),d.color&&(f.style.color=d.color),d.heading&&(f.style.fontWeight="bold"),d.disabled||(f.onclick=o(d)),f.innerHTML=l(d),p.appendChild(f)}}else p.innerHTML=l(d),d.disabled||(p.onclick=d.onClick);return p};let u;for(const d of e||[])if(!d.hide){if(d.items){if(d.text){const h=document.createElement("p");h.className="menu-label font-medium",h.innerHTML=d.text,n.appendChild(h)}const p=document.createElement("ul");p.className="menu-list";for(const h of d.items)h.hide||p.appendChild(c(h));n.appendChild(p)}else if(d.type==="input"){const{field:p,inputElement:h}=bT(d);d.focus&&(u=h),r[d.field]=h,n.appendChild(p)}else if(d.type==="divider"){const p=document.createElement("hr");p.classList.add("dropdown-divider"),n.appendChild(p)}}return t.appendChild(n),{focusElement:u}}let Zd;function Tc(t){Zd&&(Zd==null||Zd.destroy(!0),Zd=void 0),t!=null&&t.remove&&t.remove()}function bl({title:t,options:e,items:i,menuItems:n=[],target:r,coords:o,callback:a,config:s}){var u;if(!(e!=null&&e.length)&&!(i!=null&&i.length)&&!n)return;Tc();const l=document.createElement("div"),c=()=>{i=(i==null?void 0:i.filter(h=>!h.hide&&!h.disabled).map(h=>({...h,onClick:()=>{Tc(l),typeof h.onClick=="function"&&h.onClick()}})))||(e==null?void 0:e.filter(h=>!h.hide&&!h.disabled).map(h=>({text:typeof h=="object"?h.option:h,style:h.style,onClick:()=>{h.subMenu?Zd.setContent("IMPLEMENT SUB MENU"):typeof h.onClick=="function"?(Tc(l),h.onClick()):typeof a=="function"&&(Tc(l),a(typeof h=="object"?{...h,coords:o}:h))}})));const d=[{text:t,items:i},...n],{focusElement:p}=sye(l,d);return p&&p.focus(),l};return r=r||((u=o==null?void 0:o.evt)==null?void 0:u.target),r&&(Zd=ff(r,{content:c,theme:"light-border",trigger:"click",...s}),Zd.show(),Zd.setProps({interactive:!0})),Zd}function _ze(t){const e=document.createElement("span");e.style.width="100%";const i=t.getValue(),n=()=>{No.deleteTournament(i).then(s,l=>console.log(l));function s(){var u;t.getRow().delete();const c=(u=oc())==null?void 0:u.providerId;c&&Aze({tournamentId:i,providerId:c})}},r=()=>{const c=`<div style='font-size: 2em'>${t.getTable().getData().find(d=>d.tournamentId===i).tournament.tournamentName} will be deleted!</div>`,u=[{onClick:n,intent:"is-danger",label:"Delete",close:!0},{label:"Cancel"}];lr({title:Fn.tr("actions.delete_tournament"),buttons:u,content:c})},o=()=>{console.log("tournament Edit");const s=l=>{console.log("edit:",{tournamentRecord:l})};No.findTournament(i).then(s,l=>console.log(l))},a=document.createElement("span");return a.innerHTML="<i class='fa fa-ellipsis-vertical'></i>",e.onclick=s=>{s.stopPropagation(),bl({target:a,items:[{text:"Delete",onClick:r},{text:"Edit",onClick:o}],config:{placement:Rf}})},e.appendChild(a),e}function kze(){const t=(e,i)=>{const n=i.getRow().getData().tournamentId;if(n){Ye.reset();const r=`/${Xo}/${n}`;Qe.router.navigate(r)}};return[{formatter:"responsiveCollapse",hozAlign:Vt,headerSort:!1,resizable:!1,minWidth:50,width:50},{formatter:Nze,cellClick:t,field:"tournament",headerSort:!1,resizable:!0,minWidth:250,widthGrow:3},{title:"Open",vertAlign:"middle",formatter:()=>'<div class="button font-medium">Open</div>',cellClick:t,width:90},{formatter:_ze,field:"tournamentId",vertAlign:"middle",headerSort:!1,hozAlign:Ut,width:10}]}function rh({anchorId:t}){const e=bo.findTable(`#${t}`)[0];e&&e.destroy()}function Hx(){var t;if(Qe.tables)for(const e of Object.keys(Qe.tables))(t=Qe.tables[e])==null||t.destroy(),delete Qe.tables[e];for(;(Qe.collectionTables||[]).length;)Qe.collectionTables.pop().destroy()}function lye(){var d;const t=p=>console.log("db Error",{error:p});let e,i;const n=()=>{setTimeout(()=>{const h=f=>e.replaceData(f.map(Zm));No.findAllTournaments().then(h,t)},i?0:1e3)},r=kze(),o=p=>{rh({anchorId:N2});const h=document.getElementById(N2);e=new bo(h,{responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,placeholder:"No tournaments",responsiveLayout:"collapse",layout:"fitColumns",index:"tournamentId",headerVisible:!1,reactiveData:!0,data:p,columns:r}),e.on("scrollVertical",Tc),e.on("tableBuilt",()=>{Rze(e),i=!0})},a=p=>{p.sort((h,f)=>new Date(f.startDate||f.start)-new Date(h.startDate||h.start)),o(p.map(Zm))},s=p=>{p.sort((h,f)=>new Date(f.tournament.startDate)-new Date(h.tournament.startDate)),o(p)},l=oc(),c=((d=l==null?void 0:l.profile)==null?void 0:d.provider)||(Qe==null?void 0:Qe.provider),u=()=>No.findAllTournaments().then(a,t);if(c!=null&&c.organisationAbbreviation){const p=h=>{var f;(f=h==null?void 0:h.data)!=null&&f.calendar?s(h.data.calendar.tournaments):u()};tVe({providerAbbr:c.organisationAbbreviation}).then(p)}else u();return{table:e,replaceTableData:n}}const Fw=function(){const t={};return t.initDB=()=>new Promise((e,i)=>{const n="&puid, hash, cuid, &id, [last_name+first_name], last_name, birthdate",r="&muid, *puids, format, date, tournament.category, tournament.tuid",o="[puid+tuid+format+round], puid, tuid, muid, date",a="&tuid, name, start, end, category, cuid",s="&hash, date, type",l="&uuid, name",c="[hash+ioc]",u="&uuid, name",d="category",p="&id, &code",h="&alias",f="key",m="ioc",g={calculations:s,clubs:p,idioms:m,matches:r,players:n,points:o,rankings:d,settings:f,tournaments:a};t.db=new lp("CourtHiveTournaments",{autoOpen:!1}),t.db.version(1).stores({aliases:h,ignored:c,...g}),t.db.version(2).stores({aliases:h,ignored:c,...g,idioms:m}),t.db.version(3).stores({teams:u,themes:l,idioms:m,...g}),t.db.open().then(e,i)}),t.resetDB=e=>{t.db.close(),lp.delete("CourtHiveTournaments").then(e,()=>alert("Failed to Reset Database"))},t.findAll=e=>new Promise((i,n)=>{let r=t.db[e];return r?r.toArray(i,n).catch(n):i([])}),t.findAllTournaments=()=>t.findAll("tournaments"),t.findWhere=(e,i,n)=>new Promise((r,o)=>t.db[e].where(i).equals(n).toArray(r,o).catch(o)),t.deleteTournament=e=>new Promise((i,n)=>{t.db.tournaments.where("tuid").equals(e).delete().then(r,n);function r(){t.deleteTournamentMatches(e).then(o,n)}function o(){t.deleteTournamentPoints(e).then(i,n)}}),t.deleteAllTournamentAttr=e=>t.db.tournaments.toCollection().modify(i=>delete i[e]).then(()=>console.log("done")),t.findUnique=(e,i,n)=>new Promise((r,o)=>t.findWhere(e,i,n).then(a=>r(a&&a.length?a[0]:void 0),o)),t.findTournament=e=>t.findUnique("tournaments","tuid",e),t.addItem=(e,i)=>new Promise((n,r)=>t.db[e].put(i).then(n,r).catch(o=>{alert("try again:",o),r(o)})),t.modifyOrAddUnique=(e,i,n,r)=>new Promise((o,a)=>{t.db[e].where(i).equals(n).modify(s=>Object.assign(s,r)).then(s=>{if(s)return o("exists");t.addItem(e,r).then(o,a)},s=>{console.log({err:s}),a(s)})}),t.addTournament=e=>t.modifyOrAddUnique("tournaments","tuid",e.tuid,e),t.replaceOrAddUnique=(e,i,n,r)=>new Promise((o,a)=>{t.db[e].where(i).equals(n).delete().then(()=>{t.addItem(e,r).then(o,a)},s=>{console.log({err:s}),a(s)})}),t.modify=(e,i,n,r,o)=>new Promise((a,s)=>{t.db[e].where(i).equals(n).modify(l=>{Object.assign(o,{item:l}),r(o)}).then(a,l=>{console.log("error:",l),s()})}),t}();function cye(t){const e=z_({data:t}),{directive:i,content:n}=e||{};i&&(i===aye&&n.calendar&&vi({action:{onClick:()=>xze({providerId:n.providerId,calendar:n.calendar}),text:"Load"},message:"Calendar Received",duration:!1}),i.subKey&&Qe.ee.emit("sendKey",i.subKey),i===wze&&n&&(Fn.define(n),Fw.addIdiom(n).then(r,o=>console.log("error:",o))));function r(){Qe.ee.emit("changeIdiom",{ioc:n.ioc})}}function xze({providerId:t,calendar:e}){const i=()=>lye();t&&e&&No.addProvider({providerId:t,calendar:e}).then(i)}const N4="@VERSION@",kp=Object.create(null);kp.open="0";kp.close="1";kp.ping="2";kp.pong="3";kp.message="4";kp.upgrade="5";kp.noop="6";const nM=Object.create(null);Object.keys(kp).forEach(t=>{nM[kp[t]]=t});const s$={type:"error",data:"parser error"},uye=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",dye=typeof ArrayBuffer=="function",pye=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t&&t.buffer instanceof ArrayBuffer,A4=({type:t,data:e},i,n)=>uye&&e instanceof Blob?i?n(e):VK(e,n):dye&&(e instanceof ArrayBuffer||pye(e))?i?n(e):VK(new Blob([e]),n):n(kp[t]+(e||"")),VK=(t,e)=>{const i=new FileReader;return i.onload=function(){const n=i.result.split(",")[1];e("b"+(n||""))},i.readAsDataURL(t)};function jK(t){return t instanceof Uint8Array?t:t instanceof ArrayBuffer?new Uint8Array(t):new Uint8Array(t.buffer,t.byteOffset,t.byteLength)}let GL;function Oze(t,e){if(uye&&t.data instanceof Blob)return t.data.arrayBuffer().then(jK).then(e);if(dye&&(t.data instanceof ArrayBuffer||pye(t.data)))return e(jK(t.data));A4(t,!1,i=>{GL||(GL=new TextEncoder),e(GL.encode(i))})}const HK="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",$S=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let t=0;t<HK.length;t++)$S[HK.charCodeAt(t)]=t;const Lze=t=>{let e=t.length*.75,i=t.length,n,r=0,o,a,s,l;t[t.length-1]==="="&&(e--,t[t.length-2]==="="&&e--);const c=new ArrayBuffer(e),u=new Uint8Array(c);for(n=0;n<i;n+=4)o=$S[t.charCodeAt(n)],a=$S[t.charCodeAt(n+1)],s=$S[t.charCodeAt(n+2)],l=$S[t.charCodeAt(n+3)],u[r++]=o<<2|a>>4,u[r++]=(a&15)<<4|s>>2,u[r++]=(s&3)<<6|l&63;return c},Fze=typeof ArrayBuffer=="function",_4=(t,e)=>{if(typeof t!="string")return{type:"message",data:hye(t,e)};const i=t.charAt(0);return i==="b"?{type:"message",data:Bze(t.substring(1),e)}:nM[i]?t.length>1?{type:nM[i],data:t.substring(1)}:{type:nM[i]}:s$},Bze=(t,e)=>{if(Fze){const i=Lze(t);return hye(i,e)}else return{base64:!0,data:t}},hye=(t,e)=>{switch(e){case"blob":return t instanceof Blob?t:new Blob([t]);case"arraybuffer":default:return t instanceof ArrayBuffer?t:t.buffer}},fye="",$ze=(t,e)=>{const i=t.length,n=new Array(i);let r=0;t.forEach((o,a)=>{A4(o,!1,s=>{n[a]=s,++r===i&&e(n.join(fye))})})},Vze=(t,e)=>{const i=t.split(fye),n=[];for(let r=0;r<i.length;r++){const o=_4(i[r],e);if(n.push(o),o.type==="error")break}return n};function jze(){return new TransformStream({transform(t,e){Oze(t,i=>{const n=i.length;let r;if(n<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,n);else if(n<65536){r=new Uint8Array(3);const o=new DataView(r.buffer);o.setUint8(0,126),o.setUint16(1,n)}else{r=new Uint8Array(9);const o=new DataView(r.buffer);o.setUint8(0,127),o.setBigUint64(1,BigInt(n))}t.data&&typeof t.data!="string"&&(r[0]|=128),e.enqueue(r),e.enqueue(i)})}})}let zL;function q1(t){return t.reduce((e,i)=>e+i.length,0)}function Y1(t,e){if(t[0].length===e)return t.shift();const i=new Uint8Array(e);let n=0;for(let r=0;r<e;r++)i[r]=t[0][n++],n===t[0].length&&(t.shift(),n=0);return t.length&&n<t[0].length&&(t[0]=t[0].slice(n)),i}function Hze(t,e){zL||(zL=new TextDecoder);const i=[];let n=0,r=-1,o=!1;return new TransformStream({transform(a,s){for(i.push(a);;){if(n===0){if(q1(i)<1)break;const l=Y1(i,1);o=(l[0]&128)===128,r=l[0]&127,r<126?n=3:r===126?n=1:n=2}else if(n===1){if(q1(i)<2)break;const l=Y1(i,2);r=new DataView(l.buffer,l.byteOffset,l.length).getUint16(0),n=3}else if(n===2){if(q1(i)<8)break;const l=Y1(i,8),c=new DataView(l.buffer,l.byteOffset,l.length),u=c.getUint32(0);if(u>Math.pow(2,21)-1){s.enqueue(s$);break}r=u*Math.pow(2,32)+c.getUint32(4),n=3}else{if(q1(i)<r)break;const l=Y1(i,r);s.enqueue(_4(o?l:zL.decode(l),e)),n=0}if(r===0||r>t){s.enqueue(s$);break}}}})}const mye=4;function ea(t){if(t)return Gze(t)}function Gze(t){for(var e in ea.prototype)t[e]=ea.prototype[e];return t}ea.prototype.on=ea.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this};ea.prototype.once=function(t,e){function i(){this.off(t,i),e.apply(this,arguments)}return i.fn=e,this.on(t,i),this};ea.prototype.off=ea.prototype.removeListener=ea.prototype.removeAllListeners=ea.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var i=this._callbacks["$"+t];if(!i)return this;if(arguments.length==1)return delete this._callbacks["$"+t],this;for(var n,r=0;r<i.length;r++)if(n=i[r],n===e||n.fn===e){i.splice(r,1);break}return i.length===0&&delete this._callbacks["$"+t],this};ea.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),i=this._callbacks["$"+t],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(i){i=i.slice(0);for(var n=0,r=i.length;n<r;++n)i[n].apply(this,e)}return this};ea.prototype.emitReserved=ea.prototype.emit;ea.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]};ea.prototype.hasListeners=function(t){return!!this.listeners(t).length};const ou=typeof self<"u"?self:typeof window<"u"?window:Function("return this")();function gye(t,...e){return e.reduce((i,n)=>(t.hasOwnProperty(n)&&(i[n]=t[n]),i),{})}const zze=ou.setTimeout,Wze=ou.clearTimeout;function Gx(t,e){e.useNativeTimers?(t.setTimeoutFn=zze.bind(ou),t.clearTimeoutFn=Wze.bind(ou)):(t.setTimeoutFn=ou.setTimeout.bind(ou),t.clearTimeoutFn=ou.clearTimeout.bind(ou))}const qze=1.33;function Yze(t){return typeof t=="string"?Kze(t):Math.ceil((t.byteLength||t.size)*qze)}function Kze(t){let e=0,i=0;for(let n=0,r=t.length;n<r;n++)e=t.charCodeAt(n),e<128?i+=1:e<2048?i+=2:e<55296||e>=57344?i+=3:(n++,i+=4);return i}function Zze(t){let e="";for(let i in t)t.hasOwnProperty(i)&&(e.length&&(e+="&"),e+=encodeURIComponent(i)+"="+encodeURIComponent(t[i]));return e}function Xze(t){let e={},i=t.split("&");for(let n=0,r=i.length;n<r;n++){let o=i[n].split("=");e[decodeURIComponent(o[0])]=decodeURIComponent(o[1])}return e}class Jze extends Error{constructor(e,i,n){super(e),this.description=i,this.context=n,this.type="TransportError"}}class k4 extends ea{constructor(e){super(),this.writable=!1,Gx(this,e),this.opts=e,this.query=e.query,this.socket=e.socket}onError(e,i,n){return super.emitReserved("error",new Jze(e,i,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const i=_4(e,this.socket.binaryType);this.onPacket(i)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,i={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(i)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const i=Zze(e);return i.length?"?"+i:""}}const vye="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_".split(""),l$=64,Qze={};let GK=0,K1=0,zK;function WK(t){let e="";do e=vye[t%l$]+e,t=Math.floor(t/l$);while(t>0);return e}function yye(){const t=WK(+new Date);return t!==zK?(GK=0,zK=t):t+"."+WK(GK++)}for(;K1<l$;K1++)Qze[vye[K1]]=K1;let bye=!1;try{bye=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const eWe=bye;function Iye(t){const e=t.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||eWe))return new XMLHttpRequest}catch{}if(!e)try{return new ou[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}function tWe(){}const iWe=function(){return new Iye({xdomain:!1}).responseType!=null}();class nWe extends k4{constructor(e){if(super(e),this.polling=!1,typeof location<"u"){const n=location.protocol==="https:";let r=location.port;r||(r=n?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||r!==e.port}const i=e&&e.forceBase64;this.supportsBinary=iWe&&!i,this.opts.withCredentials&&(this.cookieJar=void 0)}get name(){return"polling"}doOpen(){this.poll()}pause(e){this.readyState="pausing";const i=()=>{this.readyState="paused",e()};if(this.polling||!this.writable){let n=0;this.polling&&(n++,this.once("pollComplete",function(){--n||i()})),this.writable||(n++,this.once("drain",function(){--n||i()}))}else i()}poll(){this.polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const i=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Vze(e,this.socket.binaryType).forEach(i),this.readyState!=="closed"&&(this.polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this.poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,$ze(e,i=>{this.doWrite(i,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",i=this.query||{};return this.opts.timestampRequests!==!1&&(i[this.opts.timestampParam]=yye()),!this.supportsBinary&&!i.sid&&(i.b64=1),this.createUri(e,i)}request(e={}){return Object.assign(e,{xd:this.xd,cookieJar:this.cookieJar},this.opts),new dp(this.uri(),e)}doWrite(e,i){const n=this.request({method:"POST",data:e});n.on("success",i),n.on("error",(r,o)=>{this.onError("xhr post error",r,o)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(i,n)=>{this.onError("xhr poll error",i,n)}),this.pollXhr=e}}class dp extends ea{constructor(e,i){super(),Gx(this,i),this.opts=i,this.method=i.method||"GET",this.uri=e,this.data=i.data!==void 0?i.data:null,this.create()}create(){var e;const i=gye(this.opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");i.xdomain=!!this.opts.xd;const n=this.xhr=new Iye(i);try{n.open(this.method,this.uri,!0);try{if(this.opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let r in this.opts.extraHeaders)this.opts.extraHeaders.hasOwnProperty(r)&&n.setRequestHeader(r,this.opts.extraHeaders[r])}}catch{}if(this.method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this.opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this.opts.withCredentials),this.opts.requestTimeout&&(n.timeout=this.opts.requestTimeout),n.onreadystatechange=()=>{var r;n.readyState===3&&((r=this.opts.cookieJar)===null||r===void 0||r.parseCookies(n)),n.readyState===4&&(n.status===200||n.status===1223?this.onLoad():this.setTimeoutFn(()=>{this.onError(typeof n.status=="number"?n.status:0)},0))},n.send(this.data)}catch(r){this.setTimeoutFn(()=>{this.onError(r)},0);return}typeof document<"u"&&(this.index=dp.requestsCount++,dp.requests[this.index]=this)}onError(e){this.emitReserved("error",e,this.xhr),this.cleanup(!0)}cleanup(e){if(!(typeof this.xhr>"u"||this.xhr===null)){if(this.xhr.onreadystatechange=tWe,e)try{this.xhr.abort()}catch{}typeof document<"u"&&delete dp.requests[this.index],this.xhr=null}}onLoad(){const e=this.xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this.cleanup())}abort(){this.cleanup()}}dp.requestsCount=0;dp.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",qK);else if(typeof addEventListener=="function"){const t="onpagehide"in ou?"pagehide":"unload";addEventListener(t,qK,!1)}}function qK(){for(let t in dp.requests)dp.requests.hasOwnProperty(t)&&dp.requests[t].abort()}const x4=typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,i)=>i(e,0),Z1=ou.WebSocket||ou.MozWebSocket,YK=!0,rWe="arraybuffer",KK=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class oWe extends k4{constructor(e){super(e),this.supportsBinary=!e.forceBase64}get name(){return"websocket"}doOpen(){if(!this.check())return;const e=this.uri(),i=this.opts.protocols,n=KK?{}:gye(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=YK&&!KK?i?new Z1(e,i):new Z1(e):new Z1(e,i,n)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;A4(n,this.supportsBinary,o=>{const a={};try{YK&&this.ws.send(o)}catch{}r&&x4(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",i=this.query||{};return this.opts.timestampRequests&&(i[this.opts.timestampParam]=yye()),this.supportsBinary||(i.b64=1),this.createUri(e,i)}check(){return!!Z1}}class aWe extends k4{get name(){return"webtransport"}doOpen(){typeof WebTransport=="function"&&(this.transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name]),this.transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this.transport.ready.then(()=>{this.transport.createBidirectionalStream().then(e=>{const i=Hze(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(i).getReader(),r=jze();r.readable.pipeTo(e.writable),this.writer=r.writable.getWriter();const o=()=>{n.read().then(({done:s,value:l})=>{s||(this.onPacket(l),o())}).catch(s=>{})};o();const a={type:"open"};this.query.sid&&(a.data=`{"sid":"${this.query.sid}"}`),this.writer.write(a).then(()=>this.onOpen())})}))}write(e){this.writable=!1;for(let i=0;i<e.length;i++){const n=e[i],r=i===e.length-1;this.writer.write(n).then(()=>{r&&x4(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this.transport)===null||e===void 0||e.close()}}const sWe={websocket:oWe,webtransport:aWe,polling:nWe},lWe=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,cWe=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function c$(t){if(t.length>2e3)throw"URI too long";const e=t,i=t.indexOf("["),n=t.indexOf("]");i!=-1&&n!=-1&&(t=t.substring(0,i)+t.substring(i,n).replace(/:/g,";")+t.substring(n,t.length));let r=lWe.exec(t||""),o={},a=14;for(;a--;)o[cWe[a]]=r[a]||"";return i!=-1&&n!=-1&&(o.source=e,o.host=o.host.substring(1,o.host.length-1).replace(/;/g,":"),o.authority=o.authority.replace("[","").replace("]","").replace(/;/g,":"),o.ipv6uri=!0),o.pathNames=uWe(o,o.path),o.queryKey=dWe(o,o.query),o}function uWe(t,e){const i=/\/{2,9}/g,n=e.replace(i,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function dWe(t,e){const i={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,r,o){r&&(i[r]=o)}),i}let wye=class rI extends ea{constructor(e,i={}){super(),this.binaryType=rWe,this.writeBuffer=[],e&&typeof e=="object"&&(i=e,e=null),e?(e=c$(e),i.hostname=e.host,i.secure=e.protocol==="https"||e.protocol==="wss",i.port=e.port,e.query&&(i.query=e.query)):i.host&&(i.hostname=c$(i.host).host),Gx(this,i),this.secure=i.secure!=null?i.secure:typeof location<"u"&&location.protocol==="https:",i.hostname&&!i.port&&(i.port=this.secure?"443":"80"),this.hostname=i.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=i.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=i.transports||["polling","websocket","webtransport"],this.writeBuffer=[],this.prevBufferLen=0,this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},i),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Xze(this.opts.query)),this.id=null,this.upgrades=null,this.pingInterval=null,this.pingTimeout=null,this.pingTimeoutTimer=null,typeof addEventListener=="function"&&(this.opts.closeOnBeforeunload&&(this.beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this.beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this.offlineEventListener=()=>{this.onClose("transport close",{description:"network connection lost"})},addEventListener("offline",this.offlineEventListener,!1))),this.open()}createTransport(e){const i=Object.assign({},this.opts.query);i.EIO=mye,i.transport=e,this.id&&(i.sid=this.id);const n=Object.assign({},this.opts,{query:i,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new sWe[e](n)}open(){let e;if(this.opts.rememberUpgrade&&rI.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1)e="websocket";else if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}else e=this.transports[0];this.readyState="opening";try{e=this.createTransport(e)}catch{this.transports.shift(),this.open();return}e.open(),this.setTransport(e)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this.onDrain.bind(this)).on("packet",this.onPacket.bind(this)).on("error",this.onError.bind(this)).on("close",i=>this.onClose("transport close",i))}probe(e){let i=this.createTransport(e),n=!1;rI.priorWebsocketSuccess=!1;const r=()=>{n||(i.send([{type:"ping",data:"probe"}]),i.once("packet",d=>{if(!n)if(d.type==="pong"&&d.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",i),!i)return;rI.priorWebsocketSuccess=i.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(u(),this.setTransport(i),i.send([{type:"upgrade"}]),this.emitReserved("upgrade",i),i=null,this.upgrading=!1,this.flush())})}else{const p=new Error("probe error");p.transport=i.name,this.emitReserved("upgradeError",p)}}))};function o(){n||(n=!0,u(),i.close(),i=null)}const a=d=>{const p=new Error("probe error: "+d);p.transport=i.name,o(),this.emitReserved("upgradeError",p)};function s(){a("transport closed")}function l(){a("socket closed")}function c(d){i&&d.name!==i.name&&o()}const u=()=>{i.removeListener("open",r),i.removeListener("error",a),i.removeListener("close",s),this.off("close",l),this.off("upgrading",c)};i.once("open",r),i.once("error",a),i.once("close",s),this.once("close",l),this.once("upgrading",c),this.upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||i.open()},200):i.open()}onOpen(){if(this.readyState="open",rI.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush(),this.readyState==="open"&&this.opts.upgrade){let e=0;const i=this.upgrades.length;for(;e<i;e++)this.probe(this.upgrades[e])}}onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),this.resetPingTimeout(),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this.sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong");break;case"error":const i=new Error("server error");i.code=e.data,this.onError(i);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this.upgrades=this.filterUpgrades(e.upgrades),this.pingInterval=e.pingInterval,this.pingTimeout=e.pingTimeout,this.maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this.resetPingTimeout()}resetPingTimeout(){this.clearTimeoutFn(this.pingTimeoutTimer),this.pingTimeoutTimer=this.setTimeoutFn(()=>{this.onClose("ping timeout")},this.pingInterval+this.pingTimeout),this.opts.autoUnref&&this.pingTimeoutTimer.unref()}onDrain(){this.writeBuffer.splice(0,this.prevBufferLen),this.prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this.getWritablePackets();this.transport.send(e),this.prevBufferLen=e.length,this.emitReserved("flush")}}getWritablePackets(){if(!(this.maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let i=1;for(let n=0;n<this.writeBuffer.length;n++){const r=this.writeBuffer[n].data;if(r&&(i+=Yze(r)),n>0&&i>this.maxPayload)return this.writeBuffer.slice(0,n);i+=2}return this.writeBuffer}write(e,i,n){return this.sendPacket("message",e,i,n),this}send(e,i,n){return this.sendPacket("message",e,i,n),this}sendPacket(e,i,n,r){if(typeof i=="function"&&(r=i,i=void 0),typeof n=="function"&&(r=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const o={type:e,data:i,options:n};this.emitReserved("packetCreate",o),this.writeBuffer.push(o),r&&this.once("flush",r),this.flush()}close(){const e=()=>{this.onClose("forced close"),this.transport.close()},i=()=>{this.off("upgrade",i),this.off("upgradeError",i),e()},n=()=>{this.once("upgrade",i),this.once("upgradeError",i)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}onError(e){rI.priorWebsocketSuccess=!1,this.emitReserved("error",e),this.onClose("transport error",e)}onClose(e,i){(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")&&(this.clearTimeoutFn(this.pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),typeof removeEventListener=="function"&&(removeEventListener("beforeunload",this.beforeunloadEventListener,!1),removeEventListener("offline",this.offlineEventListener,!1)),this.readyState="closed",this.id=null,this.emitReserved("close",e,i),this.writeBuffer=[],this.prevBufferLen=0)}filterUpgrades(e){const i=[];let n=0;const r=e.length;for(;n<r;n++)~this.transports.indexOf(e[n])&&i.push(e[n]);return i}};wye.protocol=mye;function pWe(t,e="",i){let n=t;i=i||typeof location<"u"&&location,t==null&&(t=i.protocol+"//"+i.host),typeof t=="string"&&(t.charAt(0)==="/"&&(t.charAt(1)==="/"?t=i.protocol+t:t=i.host+t),/^(https?|wss?):\/\//.test(t)||(typeof i<"u"?t=i.protocol+"//"+t:t="https://"+t),n=c$(t)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const o=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+o+":"+n.port+e,n.href=n.protocol+"://"+o+(i&&i.port===n.port?"":":"+n.port),n}const hWe=typeof ArrayBuffer=="function",fWe=t=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(t):t.buffer instanceof ArrayBuffer,Sye=Object.prototype.toString,mWe=typeof Blob=="function"||typeof Blob<"u"&&Sye.call(Blob)==="[object BlobConstructor]",gWe=typeof File=="function"||typeof File<"u"&&Sye.call(File)==="[object FileConstructor]";function O4(t){return hWe&&(t instanceof ArrayBuffer||fWe(t))||mWe&&t instanceof Blob||gWe&&t instanceof File}function rM(t,e){if(!t||typeof t!="object")return!1;if(Array.isArray(t)){for(let i=0,n=t.length;i<n;i++)if(rM(t[i]))return!0;return!1}if(O4(t))return!0;if(t.toJSON&&typeof t.toJSON=="function"&&arguments.length===1)return rM(t.toJSON(),!0);for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)&&rM(t[i]))return!0;return!1}function vWe(t){const e=[],i=t.data,n=t;return n.data=u$(i,e),n.attachments=e.length,{packet:n,buffers:e}}function u$(t,e){if(!t)return t;if(O4(t)){const i={_placeholder:!0,num:e.length};return e.push(t),i}else if(Array.isArray(t)){const i=new Array(t.length);for(let n=0;n<t.length;n++)i[n]=u$(t[n],e);return i}else if(typeof t=="object"&&!(t instanceof Date)){const i={};for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=u$(t[n],e));return i}return t}function yWe(t,e){return t.data=d$(t.data,e),delete t.attachments,t}function d$(t,e){if(!t)return t;if(t&&t._placeholder===!0){if(typeof t.num=="number"&&t.num>=0&&t.num<e.length)return e[t.num];throw new Error("illegal attachments")}else if(Array.isArray(t))for(let i=0;i<t.length;i++)t[i]=d$(t[i],e);else if(typeof t=="object")for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(t[i]=d$(t[i],e));return t}const bWe=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],IWe=5;var Sn;(function(t){t[t.CONNECT=0]="CONNECT",t[t.DISCONNECT=1]="DISCONNECT",t[t.EVENT=2]="EVENT",t[t.ACK=3]="ACK",t[t.CONNECT_ERROR=4]="CONNECT_ERROR",t[t.BINARY_EVENT=5]="BINARY_EVENT",t[t.BINARY_ACK=6]="BINARY_ACK"})(Sn||(Sn={}));class wWe{constructor(e){this.replacer=e}encode(e){return(e.type===Sn.EVENT||e.type===Sn.ACK)&&rM(e)?this.encodeAsBinary({type:e.type===Sn.EVENT?Sn.BINARY_EVENT:Sn.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let i=""+e.type;return(e.type===Sn.BINARY_EVENT||e.type===Sn.BINARY_ACK)&&(i+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(i+=e.nsp+","),e.id!=null&&(i+=e.id),e.data!=null&&(i+=JSON.stringify(e.data,this.replacer)),i}encodeAsBinary(e){const i=vWe(e),n=this.encodeAsString(i.packet),r=i.buffers;return r.unshift(n),r}}function ZK(t){return Object.prototype.toString.call(t)==="[object Object]"}class L4 extends ea{constructor(e){super(),this.reviver=e}add(e){let i;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");i=this.decodeString(e);const n=i.type===Sn.BINARY_EVENT;n||i.type===Sn.BINARY_ACK?(i.type=n?Sn.EVENT:Sn.ACK,this.reconstructor=new SWe(i),i.attachments===0&&super.emitReserved("decoded",i)):super.emitReserved("decoded",i)}else if(O4(e)||e.base64)if(this.reconstructor)i=this.reconstructor.takeBinaryData(e),i&&(this.reconstructor=null,super.emitReserved("decoded",i));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let i=0;const n={type:Number(e.charAt(0))};if(Sn[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===Sn.BINARY_EVENT||n.type===Sn.BINARY_ACK){const o=i+1;for(;e.charAt(++i)!=="-"&&i!=e.length;);const a=e.substring(o,i);if(a!=Number(a)||e.charAt(i)!=="-")throw new Error("Illegal attachments");n.attachments=Number(a)}if(e.charAt(i+1)==="/"){const o=i+1;for(;++i&&!(e.charAt(i)===","||i===e.length););n.nsp=e.substring(o,i)}else n.nsp="/";const r=e.charAt(i+1);if(r!==""&&Number(r)==r){const o=i+1;for(;++i;){const a=e.charAt(i);if(a==null||Number(a)!=a){--i;break}if(i===e.length)break}n.id=Number(e.substring(o,i+1))}if(e.charAt(++i)){const o=this.tryParse(e.substr(i));if(L4.isPayloadValid(n.type,o))n.data=o;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,i){switch(e){case Sn.CONNECT:return ZK(i);case Sn.DISCONNECT:return i===void 0;case Sn.CONNECT_ERROR:return typeof i=="string"||ZK(i);case Sn.EVENT:case Sn.BINARY_EVENT:return Array.isArray(i)&&(typeof i[0]=="number"||typeof i[0]=="string"&&bWe.indexOf(i[0])===-1);case Sn.ACK:case Sn.BINARY_ACK:return Array.isArray(i)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class SWe{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const i=yWe(this.reconPack,this.buffers);return this.finishedReconstruction(),i}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const TWe=Object.freeze(Object.defineProperty({__proto__:null,Decoder:L4,Encoder:wWe,get PacketType(){return Sn},protocol:IWe},Symbol.toStringTag,{value:"Module"}));function Ku(t,e,i){return t.on(e,i),function(){t.off(e,i)}}const UWe=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Tye extends ea{constructor(e,i,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=i,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ku(e,"open",this.onopen.bind(this)),Ku(e,"packet",this.onpacket.bind(this)),Ku(e,"error",this.onerror.bind(this)),Ku(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...i){if(UWe.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(i.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(i),this;const n={type:Sn.EVENT,data:i};if(n.options={},n.options.compress=this.flags.compress!==!1,typeof i[i.length-1]=="function"){const a=this.ids++,s=i.pop();this._registerAckCallback(a,s),n.id=a}const r=this.io.engine&&this.io.engine.transport&&this.io.engine.transport.writable;return this.flags.volatile&&(!r||!this.connected)||(this.connected?(this.notifyOutgoingListeners(n),this.packet(n)):this.sendBuffer.push(n)),this.flags={},this}_registerAckCallback(e,i){var n;const r=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(r===void 0){this.acks[e]=i;return}const o=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let a=0;a<this.sendBuffer.length;a++)this.sendBuffer[a].id===e&&this.sendBuffer.splice(a,1);i.call(this,new Error("operation has timed out"))},r);this.acks[e]=(...a)=>{this.io.clearTimeoutFn(o),i.apply(this,[null,...a])}}emitWithAck(e,...i){const n=this.flags.timeout!==void 0||this._opts.ackTimeout!==void 0;return new Promise((r,o)=>{i.push((a,s)=>n?a?o(a):r(s):r(a)),this.emit(e,...i)})}_addToQueue(e){let i;typeof e[e.length-1]=="function"&&(i=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((r,...o)=>n!==this._queue[0]?void 0:(r!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),i&&i(r)):(this._queue.shift(),i&&i(null,...o)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const i=this._queue[0];i.pending&&!e||(i.pending=!0,i.tryCount++,this.flags=i.flags,this.emit.apply(this,i.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:Sn.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,i){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,i)}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case Sn.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case Sn.EVENT:case Sn.BINARY_EVENT:this.onevent(e);break;case Sn.ACK:case Sn.BINARY_ACK:this.onack(e);break;case Sn.DISCONNECT:this.ondisconnect();break;case Sn.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const i=e.data||[];e.id!=null&&i.push(this.ack(e.id)),this.connected?this.emitEvent(i):this.receiveBuffer.push(Object.freeze(i))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const i=this._anyListeners.slice();for(const n of i)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const i=this;let n=!1;return function(...r){n||(n=!0,i.packet({type:Sn.ACK,id:e,data:r}))}}onack(e){const i=this.acks[e.id];typeof i=="function"&&(i.apply(this,e.data),delete this.acks[e.id])}onconnect(e,i){this.id=e,this.recovered=i&&this._pid===i,this._pid=i,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:Sn.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const i=this._anyListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const i=this._anyOutgoingListeners;for(let n=0;n<i.length;n++)if(e===i[n])return i.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const i=this._anyOutgoingListeners.slice();for(const n of i)n.apply(this,e.data)}}}function eS(t){t=t||{},this.ms=t.min||100,this.max=t.max||1e4,this.factor=t.factor||2,this.jitter=t.jitter>0&&t.jitter<=1?t.jitter:0,this.attempts=0}eS.prototype.duration=function(){var t=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),i=Math.floor(e*this.jitter*t);t=Math.floor(e*10)&1?t+i:t-i}return Math.min(t,this.max)|0};eS.prototype.reset=function(){this.attempts=0};eS.prototype.setMin=function(t){this.ms=t};eS.prototype.setMax=function(t){this.max=t};eS.prototype.setJitter=function(t){this.jitter=t};class p$ extends ea{constructor(e,i){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(i=e,e=void 0),i=i||{},i.path=i.path||"/socket.io",this.opts=i,Gx(this,i),this.reconnection(i.reconnection!==!1),this.reconnectionAttempts(i.reconnectionAttempts||1/0),this.reconnectionDelay(i.reconnectionDelay||1e3),this.reconnectionDelayMax(i.reconnectionDelayMax||5e3),this.randomizationFactor((n=i.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new eS({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(i.timeout==null?2e4:i.timeout),this._readyState="closed",this.uri=e;const r=i.parser||TWe;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=i.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var i;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(i=this.backoff)===null||i===void 0||i.setMin(e),this)}randomizationFactor(e){var i;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(i=this.backoff)===null||i===void 0||i.setJitter(e),this)}reconnectionDelayMax(e){var i;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(i=this.backoff)===null||i===void 0||i.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new wye(this.uri,this.opts);const i=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const r=Ku(i,"open",function(){n.onopen(),e&&e()}),o=s=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",s),e?e(s):this.maybeReconnectOnOpen()},a=Ku(i,"error",o);if(this._timeout!==!1){const s=this._timeout,l=this.setTimeoutFn(()=>{r(),o(new Error("timeout")),i.close()},s);this.opts.autoUnref&&l.unref(),this.subs.push(()=>{this.clearTimeoutFn(l)})}return this.subs.push(r),this.subs.push(a),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ku(e,"ping",this.onping.bind(this)),Ku(e,"data",this.ondata.bind(this)),Ku(e,"error",this.onerror.bind(this)),Ku(e,"close",this.onclose.bind(this)),Ku(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(i){this.onclose("parse error",i)}}ondecoded(e){x4(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,i){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Tye(this,e,i),this.nsps[e]=n),n}_destroy(e){const i=Object.keys(this.nsps);for(const n of i)if(this.nsps[n].active)return;this._close()}_packet(e){const i=this.encoder.encode(e);for(let n=0;n<i.length;n++)this.engine.write(i[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close"),this.engine&&this.engine.close()}disconnect(){return this._close()}onclose(e,i){this.cleanup(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,i),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const i=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(r=>{r?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",r)):e.onreconnect()}))},i);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const bS={};function oM(t,e){typeof t=="object"&&(e=t,t=void 0),e=e||{};const i=pWe(t,e.path||"/socket.io"),n=i.source,r=i.id,o=i.path,a=bS[r]&&o in bS[r].nsps,s=e.forceNew||e["force new connection"]||e.multiplex===!1||a;let l;return s?l=new p$(n,e):(bS[r]||(bS[r]=new p$(n,e)),l=bS[r]),i.query&&!e.query&&(e.query=i.queryKey),l.socket(i.path,e)}Object.assign(oM,{Manager:p$,Socket:Tye,io:oM,connect:oM});const ar={socketIo:{tmx:"/tmx"},activeScale:"wtn",hotkeys:!0,scales:{utr:{accessor:"utrRating",scaleType:"RATING",scaleColor:"blue",scaleName:"UTR",fallback:!0},wtn:{accessor:"wtnRating",scaleType:"RATING",scaleColor:"red",scaleName:"WTN",fallback:!0}},first_time_user:!1,version:N4,version_check:void 0,format_version:"1.2",ioc:"gbr",orientation:void 0,locations:{geolocate:!0,geoposition:void 0,map:void 0,map_view:"satellite",map_provider:"leaflet"},leaflet:{map:{tileLayer:"http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="http://openstreetmap.org">OpenStreetMap</a> Contributors',maxZoom:18},satellite:{tileLayer:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"Tiles &copy; Esri"}},calendar:{start:void 0,end:void 0,category:void 0,first_day:0},scoring:{delegationOfficial:!1,delegation:!0},scoreboard:{matchFormats:{categories:{},singles:"SET3-S:6/TB7",doubles:"SET3-S:6/TB7-F:TB10"},options:{bestof:[1,3,5],setsto:[4,6,8,9],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]},settings:{singles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!0,final_set_supertiebreak:!1},doubles:{max_sets:3,sets_to_win:2,games_for_set:6,tiebreak_to:7,tiebreaks_at:6,supertiebreak_to:10,final_set_tiebreak:!1,final_set_supertiebreak:!0}}},printing:{pageSize:"A4"},schedule:{teams:!0,clubs:!0,time24:!0,ioc_codes:!1,default_time:"9:00",scores_in_draw_order:!0,completed_matches_in_search:!1,max_matches_per_court:14,court_identifiers:!0},messages:[],device:{}};function DWe(){const t=xle();return t?{authorization:`Bearer ${t}`}:void 0}const $o={timestampOffset:0,socket:void 0},rm={},h$=[];function PWe(t){console.log("tmxMessage:",{data:t})}function F4(t){const e={transportOptions:{polling:{extraHeaders:DWe()}},"force new connection":!0,reconnectionDelay:1e3,reconnectionAttempts:"Infinity",timeout:2e4};if($o.socket)console.log("socket exists");else{const i=window.location.host.includes("localhost")||window.location.hostname==="127.0.0.1",r=`${ar.socketPath||i?"http://127.0.0.1:8383":"https://courthive.net"}/tmx`;$o.socket=oM.connect(r,e),$o.socket.on("ack",RWe),$o.socket.on(Ize,PWe),$o.socket.on(bze,cye),$o.socket.on("connect",()=>EWe(t)),$o.socket.on("disconnect",()=>console.log("disconnect")),$o.socket.on("timestamp",o=>{$o.timestampOffset=new Date().getTime()-o.timestamp}),$o.socket.on("connect_error",o=>{console.log("connection error:",{data:o}),ZC()})}}function CWe(){return!!$o.socket}function ZC(){$o!=null&&$o.socket&&$o.socket.disconnect(),setTimeout(()=>delete $o.socket,1e3)}function XC({data:t,ackCallback:e}){const i=oc(),{email:n}=i||{},r=t.type??"tmx",o=()=>{if(e&&typeof e=="function"){let s=Di.UUID();t.payload&&Object.assign(t.payload,{ackId:s}),MWe({ackId:s,callback:e})}const a=$o.timestampOffset?new Date().getTime()+$o.timestampOffset:new Date().getTime();Object.assign(t.payload||t,{factoryVersion:Yw(),tmxVersion:N4,timestamp:a,userId:n}),Uye(r,t)};if($o.socket)o();else try{F4(o)}catch{h$.push({header:r,data:t,ackCallback:e})}}function Uye(t,e){$o.socket.connected?$o.socket.emit(t,e):console.log("socket not connected")}function EWe(t){for(console.log("connected"),XC({data:{type:"timestamp"}});h$.length;){let e=h$.pop();Uye(e.header,e.data)}vt(t)&&t()}function MWe({ackId:t,uuid:e,callback:i}){t&&(rm[t]=i),e&&(rm[e]=i)}function RWe(t){console.log("receiveAcknowledgement:",{ack:t}),t.ackId&&rm[t.ackId]&&(rm[t.ackId](t),delete rm[t.ackId]),t.uuid&&rm[t.uuid]&&(rm[t.uuid](t),delete rm[t.uuid])}function Dye({tournamentRecord:t,callback:e}){var a;const i=(a=oc())==null?void 0:a.providerId,n=()=>vt(e)&&e(),r=()=>No.addTournament(t).then(n),o=s=>{var c;((c=s==null?void 0:s.calendar)==null?void 0:c.map(u=>u.tournamentId).includes(t.tournamentId))?r():(s.calendar||(s.calendar=[]),s.calendar.push(Zm(t)),NWe({provider:s,callback:r}))};if(i){const s=l=>{l?(t.parentOrganisation||(t.parentOrganisation={organisationAbbreviation:l.organisationAbbreviation,organisationName:l.organisationName,organisationId:i}),o(l)):r()};No.findProvider(i).then(s)}else r()}function NWe({provider:t,callback:e}){const i=()=>vt(e)&&e();No.addProvider(t).then(i)}function AWe(t){t.getElement().style.border="1px solid black";const e=t.getValue(),i=document.createElement("div");return i.innerHTML=e||"",i}function hy(t,e){return Array.from(t.classList).indexOf(e)>=0?t:As(t,e)}function As(t,e){if(!t)return null;if(t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;for(;t.parentNode;)if(t=t.parentNode,t.classList&&Array.from(t.classList).indexOf(e)>=0)return t;return null}function IS(t,e,i){const n=As(t,e);return n==null?void 0:n.getAttribute(i)}function mf(t,e){const i=[];function n(r){r.childNodes.forEach(o=>{o.childNodes.length>0&&n(o),o.classList&&Array.from(o.classList).indexOf(e)>=0&&i.push(o)})}return n(t),i}function zx({e:t,table:e,classNames:i,className:n,visible:r,columns:o}){const a=As(t.target,"options_right"),s=r?"":ht,l=r?ht:"";for(const c of a.children){const u=n?Array.from(c.classList).includes(n):Array.from(c.classList).some(d=>i.includes(d));c.style.display=u?s:l}for(const c of o)e.updateColumnDefinition(c,{formatter:r?AWe:void 0,editable:r})}function _We(t,e){zx({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!0,table:e,e:t})}const Pye=t=>{const e=document.createElement("ul");return t.forEach(i=>{let n=document.createElement("li");if(i.field==="sex")n.innerHTML="<strong>Gender:&nbsp;</strong>"+i.value;else if(yu(i.value)){if(i.value){let r=document.createElement("div");r.innerHTML=`<strong>${i.title}:&nbsp;</strong>`,n.appendChild(r),n.appendChild(i.value)}}else n.innerHTML="<strong>"+i.title+"</strong>:&nbsp;"+i.value;e.appendChild(n)}),Object.keys(t).length?e:""},kWe=(t,e)=>{var i,n;return(n=(i=t.groups)==null?void 0:i.find(r=>{var o;return(o=r.participantRoleResponsibilities)==null?void 0:o.includes(e)}))==null?void 0:n.participantName},xWe=t=>kWe(t,"CLUB"),Cye=(t,e)=>(t.events||[]).map(({eventId:i})=>e==null?void 0:e[i]),Eye=t=>{var e;return((e=iw.countries.find(i=>i.ioc===t||i.iso===t))==null?void 0:e.label)||""},OWe=/[\p{Lu}]/u,LWe=/[\p{Ll}]/u,XK=/^[\p{Lu}](?![\p{Lu}])/gu,Mye=/([\p{Alpha}\p{N}_]|$)/u,B4=/[_.\- ]+/,FWe=new RegExp("^"+B4.source),JK=new RegExp(B4.source+Mye.source,"gu"),QK=new RegExp("\\d+"+Mye.source,"gu"),BWe=(t,e,i,n)=>{let r=!1,o=!1,a=!1,s=!1;for(let l=0;l<t.length;l++){const c=t[l];s=l>2?t[l-3]==="-":!0,r&&OWe.test(c)?(t=t.slice(0,l)+"-"+t.slice(l),r=!1,a=o,o=!0,l++):o&&a&&LWe.test(c)&&(!s||n)?(t=t.slice(0,l-1)+"-"+t.slice(l-1),a=o,o=!1,r=!0):(r=e(c)===c&&i(c)!==c,a=o,o=i(c)===c&&e(c)!==c)}return t},$We=(t,e)=>(XK.lastIndex=0,t.replaceAll(XK,i=>e(i))),VWe=(t,e)=>(JK.lastIndex=0,QK.lastIndex=0,t.replaceAll(QK,(i,n,r)=>["_","-"].includes(t.charAt(r+i.length))?i:e(i)).replaceAll(JK,(i,n)=>e(n)));function jWe(t,e){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(e={pascalCase:!1,preserveConsecutiveUppercase:!1,...e},Array.isArray(t)?t=t.map(o=>o.trim()).filter(o=>o.length).join("-"):t=t.trim(),t.length===0)return"";const i=e.locale===!1?o=>o.toLowerCase():o=>o.toLocaleLowerCase(e.locale),n=e.locale===!1?o=>o.toUpperCase():o=>o.toLocaleUpperCase(e.locale);return t.length===1?B4.test(t)?"":e.pascalCase?n(t):i(t):(t!==i(t)&&(t=BWe(t,i,n,e.preserveConsecutiveUppercase)),t=t.replace(FWe,""),t=e.preserveConsecutiveUppercase?$We(t,i):i(t),e.pascalCase&&(t=n(t.charAt(0))+t.slice(1)),VWe(t,n))}const{WTN:HWe,UTR:GWe}=Ca.ratingConstants,{SINGLES:e9}=Ca.eventConstants,zWe=(t,e)=>{var h,f,m,g,v,y,b,I,T;const{participantId:i,participantName:n,participantType:r,person:o}=t,{standardFamilyName:a,standardGivenName:s}=o||{},l=(f=(h=t.person)==null?void 0:h.addresses)==null?void 0:f[0],c=l!=null&&l.city&&(l!=null&&l.state)?`${l.city}, ${l.state}`:void 0,u=(v=(g=(m=t.ratings)==null?void 0:m[e9])==null?void 0:g.find(S=>S.scaleName===GWe))==null?void 0:v.scaleValue,p={wtn:(I=(b=(y=t.ratings)==null?void 0:y[e9])==null?void 0:b.find(S=>S.scaleName===HWe))==null?void 0:I.scaleValue,utr:u};return{searchText:`${n} ${s} ${a}`.toLowerCase(),sex:jWe(t.person.sex||"",{pascalCase:!0}),eventIds:t.events.map(({eventId:S})=>S),ioc:Eye((T=t.person)==null?void 0:T.nationalityCode),events:Cye(t,e),penalties:t.penalties||[],tennisId:t.person.tennisId,signedIn:t.signedIn,lastName:a,firstName:s,club:xWe(t),teams:t.teams,participantName:n,participantType:r,participantId:i,participant:t,cityState:c,ratings:p}},oh=t=>(e,i)=>{const n=e.getDefinition();return t.includes(n.field)?"":i==="asc"&&"<div><i class='fas fa-sort-up'></div>"||i==="desc"&&"<div><i class=' fas fa-sort-down'></div>"||"<div><i class='fas fa-sort'></div>"},{MALE:WWe,FEMALE:qWe}=Lu,{PAIR:YWe}=Fo,Ib=t=>(e,i,n)=>{var d;const r=e.getColumn().getDefinition(),o=r.field==="side1"&&1||r.field==="side2"&&2,a=document.createElement("div"),s=e.getRow().getData(),l=s.winningSide,c=e.getValue(),u=s.participant||c.participant||s.person&&s;if(u){const p=ar.scales[ar.activeScale],h=m=>Ome({eventHandlers:{participantClick:g=>vt(t)&&t({...g,event:g.pointerEvent,cell:e})},composition:{configuration:{flag:!1,genderColor:!0,participantDetail:"TEAM",scaleAttributes:p}},matchUp:s.matchUp,participant:m,placeholder:i,sideNumber:o}),f=m=>{const g=document.createElement("div");return g.className="flexrow flexjustifystart",m.individualParticipants.forEach((v,y)=>{if(g.appendChild(h(v)),!y){const b=document.createElement("span");b.style.width="1em",b.innerHTML="&nbsp;",g.appendChild(b)}}),g};return n==="sideBySide"&&u.participantType===YWe?f(u):h(u)}if(l){const p=r.field===s.winningSide;a.style=p?"color: green":"color: red"}else{const p=(c==null?void 0:c.sex)||((d=s==null?void 0:s.person)==null?void 0:d.sex),h=p===WWe&&"#2E86C1"||p===qWe&&"#AA336A"||"";a.style.color=h}return a.innerHTML=(yu(c)?c.participantName:c)||"",a};function KWe(t){const e=t.getValue();return(e==null?void 0:e.length)||0}function Bw(t,e){var r,o,a,s;const i=(t==null?void 0:t.person)||((r=t==null?void 0:t.participant)==null?void 0:r.person),n=(e==null?void 0:e.person)||((o=e==null?void 0:e.participant)==null?void 0:o.person);return i||n?i!=null&&i.standardFamilyName&&!(n!=null&&n.standardFamilyName)||n!=null&&n.standardFamilyName&&!(i!=null&&i.standardFamilyName)||!(i!=null&&i.standardFamilyName)&&!(n!=null&&n.standardFamilyName)?1:(a=i.standardFamilyName)==null?void 0:a.localeCompare(n==null?void 0:n.standardFamilyName):t.participantName&&!e.participantName||e.participantName&&!t.participantName||!(t!=null&&t.participantName)&&!(e!=null&&e.participantName)?1:(s=t==null?void 0:t.participantName)==null?void 0:s.localeCompare(e==null?void 0:e.participantName)}function ZWe({callback:t}={}){const{tournamentRecord:e}=Ye.getTournament();No.addTournament(e).then(()=>vt(t)&&t())}function xt({methods:t,engine:e=jO,callback:i}){var u,d,p,h,f,m;const n=g=>vt(i)&&i(g);if(!Array.isArray(t))return n();const r=ole[e];if(!r)return n();const o=g=>{var v;return(v=g==null?void 0:g.parentOrganisation)==null?void 0:v.organisationId},a=((u=r.getState())==null?void 0:u.tournamentRecords)??{},s=e===jO?[r.getTournamentId()]:(d=Object.values(a))==null?void 0:d.map(g=>g.tournamentId),l=Di.unique(e===jO?[o(r.getTournament().tournamentRecord)]:(p=Object.values(a))==null?void 0:p.map(o)).filter(Boolean);if(l.length>1)return vi({message:"Multiple providers",intent:"is-danger"});const c=oc();if(l.length){if(!c)return vi({message:"Not logged in",intent:"is-warning"});const g=!!((h=c==null?void 0:c.providerIds)!=null&&h.includes(l[0])),v=(f=c==null?void 0:c.roles)==null?void 0:f.includes(j_);if(!g&&!v)return vi({message:"Not authorised",intent:"is-danger"});if(!g&&v&&!(((m=Qe.provider)==null?void 0:m.organisationId)===l[0]))return vi({action:{onClick:()=>(Qe.provider={organisationId:l[0]},t9({methods:t,factoryEngine:r,tournamentIds:s,completion:n})),text:"Impersonate?"},message:"Super Admin",intent:"is-danger"})}return t9({methods:t,factoryEngine:r,tournamentIds:s,completion:n})}function t9({methods:t,completion:e,factoryEngine:i,tournamentIds:n}){var o,a;if((o=window.dev)!=null&&o.params)for(const s of t)window.dev.params[s.method]&&(s.params={...s.params,...window.dev.params[s.method]});(a=window==null?void 0:window.dev)!=null&&a.getContext().internal&&console.log({methods:t});const r=i.executionQueue(t)||{};return r.error||r!=null&&r.success&&(XC({data:{type:"executionQueue",payload:{methods:t,tournamentIds:n}}}),ZWe()),e(r)}const XWe="addCourts",JWe="addFlight",QWe="addDrawDefinition",Rye="addAdHocMatchUps",e3e="addDrawEntries",t3e="addEvent",$4="addEventEntries",i3e="addEventEntryPairs",Nye="addIndividualParticipantIds",f$="addMatchUpScheduleItems",JC="addParticipants",i9="addParticipantTimeItem",Aye="addPlayoffStructures",n3e="addTournamentExtension",r3e="addVenue",o3e="attachQualifyingStructure",a3e="attachPolicies",s3e="automatedPlayoffPositioning",_ye="bulkScheduleMatchUps",kye="deleteAdHocMatchUps",xye="deleteFlightAndFlightDraw",l3e="deleteEvents",c3e="deleteParticipants",u3e="deleteVenues",d3e="destroyPairEntries",p3e="modifyCourt",h3e="modifyEvent",Oye="modifyEntriesStatus",n9="modifyParticipant",V4="modifyParticipantsSignInStatus",f3e="modifyVenue",m3e="proAutoSchedule",g3e="publishEvent",v3e="removeIndividualParticipantIds",y3e="removeStructure",b3e="renameStructures",I3e="resetDrawDefinition",Lye="resetScorecard",w3e="setMatchUpFormat",j4="setMatchUpStatus",S3e="setParticipantScaleItems",T3e="unPublishEvent",{COMPETITOR:U3e,OFFICIAL:r9}=Pf,{INDIVIDUAL:D3e}=Fo;function Fye({participant:t,view:e,refresh:i}){var p,h,f,m;const n=iw.countries.map(g=>({label:iw.countryToFlag(g.iso||"")+" "+g.label,value:g.ioc})),r={nationalityCode:(p=t==null?void 0:t.person)==null?void 0:p.nationalityCode,firstName:(h=t==null?void 0:t.person)==null?void 0:h.standardGivenName,lastName:(f=t==null?void 0:t.person)==null?void 0:f.standardFamilyName,sex:(m=t==null?void 0:t.person)==null?void 0:m.sex};let o;const a=g=>r.nationalityCode=g,s=(g,v)=>console.log(v.field,g.target.value),l=g=>{o=ro(g,[{placeholder:"Given name",value:r.firstName||"",label:"First name",field:"firstName",error:"Please enter a name of at least 3 characters",validator:Xl(3),onChange:s,focus:!0},{placeholder:"Family name",value:r.lastName||"",label:"Last name",field:"lastName",error:"Please enter a name of at least 3 characters",validator:Xl(3),onChange:s},{value:void 0,label:"Sex",field:"sex",options:[{label:"Unknown",value:void 0,selected:!r.sex},{label:"Male",value:"MALE",selected:r.sex==="MALE"},{label:"Female",value:"FEMALE",selected:r.sex==="FEMALE"}],onChange:s},{placeholder:"Birthday",value:r.birthDate||"",label:"Date of birth",onChange:s,field:"birthday",date:!0},{typeAhead:{list:n,callback:a},placeholder:"Country of origin",value:r.nationalityCode||"",field:"nationalityCode",label:"Country"}])},c=(g,v)=>yb(g,[{label:"Cancel",close:!0},{label:"Save",onClick:u,close:!0,intent:"is-info"}],v);Qe.drawer.open({title:"<b style='larger'>New participant</b>",callback:()=>console.log("drawer callback"),width:"300px",side:Ut,content:l,footer:c});function u(){t!=null&&t.participantId?console.log("update existing"):d()}function d(){const g=o.firstName.value,v=o.lastName.value,y=o.sex.value,b={participantType:D3e,participantRole:e===r9?r9:U3e,person:{nationalityCode:r.nationalityCode,standardGivenName:g,standardFamilyName:v,sex:y}};xt({methods:[{method:JC,params:{participants:[b]}}],callback:S=>{S.success?vt(i)&&i():console.log(S)}})}return{...MP}}function P3e({participantId:t}){var i;const e=(i=Ye.getParticipants({participantFilters:{participantIds:[t]},inContext:!1}).participants)==null?void 0:i[0];if(e)return Fye({participant:e})}function Bye({participantIds:t,participantId:e,callback:i}){(e||t)&&xt({methods:[{params:{participantIds:t||[e]},method:c3e}],callback:o=>{o.success?vt(i)&&i(o):console.log({result:o})}})}function aM(t,e){const i=Array.from(document.querySelectorAll(".tippy-content"));if(i.length){i.forEach(c=>c.remove());return}const n=t.target.getElementsByClassName("fa-ellipsis-vertical")[0],r=e.getRow(),o=r.getData(),{participantId:a,participantType:s}=o;bl({items:[{hide:s!=="INDIVIDUAL",text:"<i class='fas fa-address-card'></i> Participant profile",onClick:()=>{var c;return console.log("Participant profile",(c=e.getData())==null?void 0:c.participant)}},{hide:s!=="INDIVIDUAL",text:"<i class='fas fa-user'></i> Edit Participant",onClick:()=>{P3e({participantId:a,callback:u=>u.participantId&&r.update(u)})}},{text:"<div style='color: red'><i class='fas fa-check-square'></i> Delete participant</div>",onClick:()=>{Bye({participantId:a,callback:u=>{if(u.success)r.delete();else{const d=e.getTable();d.alert(u.error.message||"Cannot Remove Participant"),setTimeout(()=>d.clearAlert(),2500)}}})}}],target:n||t.target,config:{placement:Rf}})}const{SINGLES:C3e}=ps,$ye=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),o=e.getRow().getData(),{participantId:a}=o,s=(l,c)=>{var u;return(u=l==null?void 0:l.eventName)==null?void 0:u.localeCompare(c==null?void 0:c.eventName)};return r.sort(s).forEach(l=>{const c=Vye({def:i,participantId:a,event:l,eventClick:t});n.appendChild(c)}),n};function Vye({matchUpId:t,participantId:e,event:i,eventClick:n}){var o,a;const r=document.createElement("span");return vt(n)&&(r.onclick=()=>n({eventId:i.eventId,participantId:e,matchUpId:t})),r.className="tag event-pill",(o=i.gender)!=null&&o.toLowerCase().includes("female")?r.classList.add("is-danger"):(a=i.gender)!=null&&a.toLowerCase().includes("male")?r.classList.add("is-link"):r.classList.add("is-primary"),i.eventType===C3e&&r.classList.add("is-light"),r.innerHTML=i.eventName,r}const E3e=t=>e=>{const i=e.getColumn().getDefinition(),n=e.getRow().getData(),{matchUpId:r}=n,o=document.createElement("div");o.className="tags";const a=Vye({def:i,matchUpId:r,event:n,eventClick:t});return o.append(a),o},M3e=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=e.getValue(),o=(a,s)=>{var l;return(l=a==null?void 0:a.participantName)==null?void 0:l.localeCompare(s==null?void 0:s.participantName)};return r.sort(o).forEach(a=>{const s=R3e({def:i,team:a,teamClick:t});n.appendChild(s)}),n};function R3e({matchUpId:t,team:e,teamClick:i}){const n=document.createElement("span"),{participantId:r,participantName:o}=e;return vt(i)&&(n.onclick=()=>i({participantId:r,matchUpId:t})),n.className="tag event-pill",n.innerHTML=o,n}const m$=({maxValue:t,decimals:e,field:i})=>(n,r,o)=>{const a=e?/[^0-9.]/g:/[^0-9]/g,s=document.createElement("input");s.style.backgroundColor="lightyellow",s.style.boxSizing="border-box",s.style.textAlign="center",s.style.padding="3px",s.style.height="100%",s.style.width="100%",s.value=n.getValue()||"",r(()=>{s.focus(),s.select()});function l(){let c=s.value;e&&(c=parseFloat(c).toFixed(2)),o(isNaN(c)?void 0:c)}return s.addEventListener("keydown",c=>{c.key==="Tab"&&(c.preventDefault(),c.stopPropagation())}),s.addEventListener("keyup",c=>{const u=c.target.value.replace(a,"")||"";if(c.target.value=u>t?"":u,c.key==="Tab"&&c.shiftKey&&i){const p=As(c.target,"tabulator-row").previousSibling,h=p&&mf(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}else if((c.key==="Enter"||c.key==="Tab")&&i){const p=As(c.target,"tabulator-row").nextSibling,h=p&&mf(p,"tabulator-editable");if(h)for(n of h)n.getAttribute("tabulator-field")===i&&n.focus()}}),s.addEventListener("blur",l),s},o9=t=>Qe.columns[t]!==!1;function nr({eventId:t,drawId:e,structureId:i,renderDraw:n,participantId:r,matchUpId:o,view:a}){var d,p,h,f;const s=(p=(d=Ye.getTournament())==null?void 0:d.tournamentRecord)==null?void 0:p.tournamentId,l=t&&Ye.getEvent({eventId:t,drawId:e}).event,c=((h=l==null?void 0:l.drawDefinitions)==null?void 0:h.length)===1&&l.drawDefinitions[0];r&&c&&(e=c.drawId,n=!0),o&&(e=(f=l.drawDefinitions.find(({drawId:m})=>Ye.allDrawMatchUps({drawId:m,inContext:!1}).matchUps.find(v=>v.matchUpId===o)))==null?void 0:f.drawId,n=!!e);let u=`/${Xo}/${s}/${Gg}/${t}`;n&&e?(u+=`/${xS}/${e}`,i&&(u+=`/${M2}/${i}`),[A2,ow,rw].includes(a)&&(u+=`/${R2}/${a}`)):e&&(u+=`/${hle}/${e}`),Qe.router.navigate(u)}const Of=()=>"<i class='fa fa-ellipsis-vertical'></i>",{SIGNED_IN:N3e,SIGNED_OUT:A3e}=Fo;function _3e(t,e){const i=e.getRow().getData().participantId,n=!e.getValue();xt({methods:[{params:{signInState:n?N3e:A3e,participantIds:[i]},method:V4}],callback:s=>{s.success&&e.setValue(n)}})}const WL="fa-check-square",ah=t=>(e,i)=>{const n=i.getTable(),r=n.getColumns(),o=[];for(let a of r){const s=a.getDefinition();if(s.title){let l=document.createElement("i");l.classList.add("fas"),l.classList.add(a.isVisible()?WL:"fa-square");let c=document.createElement("span"),u=document.createElement("span");const d=(t==null?void 0:t[s.field])||s.displayTitle||s.title;u.textContent=" "+d,c.appendChild(l),c.appendChild(u),o.push({label:c,action:function(p){p.stopPropagation(),a.toggle(),Qe.columns[a.getField()]=a.isVisible(),n.redraw(),a.isVisible()?(l.classList.remove("fa-square"),l.classList.add(WL)):(l.classList.remove(WL),l.classList.add("fa-square"))}})}}return o},k3e=({field:t})=>(e,i,n)=>{const r=document.createElement("input");r.style.backgroundColor="lightyellow",r.style.boxSizing="border-box",r.style.textAlign="center",r.style.padding="3px",r.style.height="100%",r.style.width="100%",r.value=e.getValue()||"",i(()=>{r.focus(),r.select()});function o(){const a=r.value;n(a)}return r.addEventListener("keydown",a=>{a.key==="Tab"&&(a.preventDefault(),a.stopPropagation())}),r.addEventListener("keyup",a=>{if(a.key==="Tab"&&a.shiftKey&&t){const l=As(a.target,"tabulator-row").previousSibling,c=l&&mf(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}else if((a.key==="Enter"||a.key==="Tab")&&t){const l=As(a.target,"tabulator-row").nextSibling,c=l&&mf(l,"tabulator-editable");if(c)for(e of c)e.getAttribute("tabulator-field")===t&&e.focus()}}),r.addEventListener("blur",o),r},{WTN:x3e,UTR:O3e}=Ca.ratingConstants,{FEMALE:L3e,MALE:F3e}=Lu,a9="ratings.utr.utrRating",s9="ratings.wtn.wtnRating";function B3e(t){const e=t.some(o=>o.cityState),i=t.some(o=>o.tennisId),n=t.some(o=>{var a;return(a=o.ratings)==null?void 0:a.utr}),r=t.some(o=>{var a;return(a=o.ratings)==null?void 0:a.wtn});return[{cellClick:(o,a)=>a.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{headerMenu:ah({signedIn:"Sign In Status",sex:"Gender"}),formatter:"rownum",headerSort:!1,hozAlign:Lt,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,resizable:!1,hozAlign:Vt,width:50},{formatter:Ib(({event:o,cell:a,...s})=>aM(o,a)),cellClick:aM,sorter:Bw,field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:2,title:"Name"},{editor:k3e({field:"tennisId"}),visible:i,field:"tennisId",editable:!1,title:"WTID",width:120},{headerFilter:"input",title:"First Name",field:"firstName",visible:!1,width:150},{headerFilter:"input",title:"Last Name",field:"lastName",visible:!1,width:150},{title:'<i class="fa-solid fa-venus-mars" />',field:"sex",hozAlign:Lt,editor:"list",width:80,editorParams:{itemFormatter:(o,a)=>a,values:{Male:F3e,Female:L3e,"":"Unknown"}}},{title:"Country",field:"ioc",width:130,visible:!1,headerFilter:"input"},{title:"<div class='fa-solid fa-check' style='color: green' />",cellClick:_3e,formatter:"tickCross",resizable:!1,field:"signedIn",hozAlign:Lt,tooltip:!1,width:40},{sorter:(o,a)=>(o.length||0)-((a==null?void 0:a.length)||0),formatter:KWe,title:"Penalties",field:"penalties",hozAlign:Lt,visible:!1,width:130},{headerFilter:"input",title:"Club",field:"club",hozAlign:Lt,minWidth:70,editor:!1,visible:!1},{formatter:$ye(nr),visible:o9("events"),sorter:(o,a)=>o&&a,title:"Events",field:"events",hozAlign:Lt,minWidth:200,editor:!1,widthGrow:2},{formatter:M3e(()=>console.log("boo")),visible:o9("teams"),sorter:(o,a)=>o&&a,title:"Teams",field:"teams",hozAlign:Lt,minWidth:200,editor:!1,widthGrow:2},{visible:!!e,title:"City/State",field:"cityState",minWidth:110},{editor:m$({maxValue:40,decimals:!0,field:s9}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:s9,editable:!1,visible:!!r,title:x3e,width:70},{editor:m$({maxValue:16,decimals:!0,field:a9}),sorterParams:{alignEmptyValues:"bottom"},responsive:!0,resizable:!1,sorter:"number",field:a9,editable:!1,visible:!!n,title:O3e,width:70},{cellClick:aM,formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,maxWidth:40}]}const{INDIVIDUAL:$3e,GROUP:V3e,TEAM:j3e}=Fo,{OFFICIAL:l9,COMPETITOR:H3e}=Pf;function G3e({view:t}={}){let e,i,n,r,o,a;const s={participantRoles:[t===l9?l9:H3e]},l=()=>{({participants:i,derivedEventInfo:n}=Ye.getParticipants({withSignInStatus:!0,withScaleValues:!0,participantFilters:s,withEvents:!0,withISO2:!0}));const m=i.filter(({participantType:v})=>v===$3e);a=i.filter(({participantType:v})=>v===V3e),o=i.filter(({participantType:v})=>v===j3e);const g=Di.unique(m.flatMap(({ratings:v})=>{var y;return(y=v==null?void 0:v.SINGLES)==null?void 0:y.map(({scaleName:b})=>b)}).filter(Boolean));return ar.activeScale=g.includes("WTN")&&"wtn"||g.includes("UTR")&&"utr"||"wtn",(m==null?void 0:m.map(v=>zWe(v,n)))||[]},c=()=>{setTimeout(()=>e.replaceData(l()),r?0:1e3)},u=l(),d=B3e(u),p=(f,m)=>(Di.isNumeric(f)&&f||0)+(Di.isNumeric(m)&&m||0);return(f=>{var v;rh({anchorId:QM});const m=document.getElementById(QM),g=(v=As(m,"section"))==null?void 0:v.querySelector(".tabHeader");e=new bo(m,{headerSortElement:oh(["sex","signedIn","events","teams","cityState","tennisId","ratings.wtn.wtnRating","ratings.utr.utrRating"]),responsiveLayoutCollapseFormatter:Pye,responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.86,placeholder:"No participants",responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,columns:d,data:f}),e.on("dataChanged",y=>{g&&(g.innerHTML=`Participants (${y.length})`)}),e.on("dataFiltered",(y,b)=>{g&&(g.innerHTML=`Participants (${b.length})`);const I=[],T=[];for(const E of b){const C=E.getData(),{wtn:M,utr:N}=C.ratings;Di.isNumeric(N==null?void 0:N.utrRating)&&T.push(parseFloat(N.utrRating)),Di.isNumeric(M==null?void 0:M.wtnRating)&&I.push(parseFloat(M.wtnRating))}const S=T.reduce(p,0),w=I.reduce(p,0),U=(T.length?S/T.length:0).toFixed(2),D=(I.length?w/I.length:0).toFixed(2);console.log(`UTR ${U}x̄`),console.log(`WTN ${D}x̄`)}),e.on("scrollVertical",Tc),e.on("tableBuilt",()=>r=!0)})(u),{table:e,replaceTableData:c,teamParticipants:o,groupParticipants:a}}function z3e(t,e){zx({columns:["ratings.wtn.wtnRating","ratings.utr.utrRating"],className:"saveRatings",visible:!1,table:e,e:t});const n=e.getData().flatMap(o=>{var f,m,g;const a=(f=o.ratings)==null?void 0:f.wtn,s=a==null?void 0:a.wtnRating,l=a!=null&&a.confidence||s?50:0;let c=l?{...a,wtnRating:s,confidence:l}:void 0;const u={method:i9,params:{participantId:o.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.WTN",itemValue:c}}},d=(g=(m=o.ratings)==null?void 0:m.utr)==null?void 0:g.utrRating,p=d?50:0;c=p?{utrRating:d,confidence:p}:void 0;const h={method:i9,params:{participantId:o.participantId,removePriorValues:!0,timeItem:{itemType:"SCALE.RATING.SINGLES.UTR",itemValue:c}}};return[u,h]});xt({methods:n,callback:o=>{o.success||console.log(o)}})}const{COMPETITOR:W3e,OTHER:q3e}=Pf,{TEAM:c9}=Fo;function jye({individualParticipantIds:t,participantType:e=c9,title:i="Edit team",participant:n,refresh:r}){const o="participantName",a={[o]:n==null?void 0:n[o]};let s;const l=()=>{},c=h=>{s=ro(h,[{error:"Please enter a name of at least 3 characters",placeholder:"Participant name",value:a[o]||"",validator:Xl(3),field:o,onChange:l,label:"Name"}])},u=(h,f)=>yb(h,[{label:"Cancel",close:!0},{label:"Save",onClick:d,close:!0,intent:"is-info"}],f);Qe.drawer.open({title:`<b style='larger'>${i}</b>`,callback:()=>console.log("drawer callback"),width:"300px",side:Ut,content:c,footer:u});function d(){n!=null&&n.participantId?console.log("update existing"):p()}function p(){var v;const h=e===c9?W3e:q3e,f={individualParticipantIds:t||(n==null?void 0:n.individualParticipantIds)||[],participantName:(v=s[o])==null?void 0:v.value,participantRole:h,participantType:e};xt({methods:[{params:{participants:[f]},method:JC}],callback:y=>{y.success?vt(r)&&r():console.log({result:y})}})}return{...MP}}const{TEAM:qL}=Fo;function u9({participants:t,table:e,replaceTableData:i,participantType:n=qL}){const r=({team:s})=>{const c=e.getSelectedData().map(({participantId:p})=>p);e.deselectRow();const u=[{method:Nye,params:{groupingParticipantId:s.participantId,individualParticipantIds:c}}];xt({methods:u,callback:p=>{p.success&&i()}})},o=()=>{const s=n===qL?"New team":"New Group",c=e.getSelectedData().map(({participantId:u})=>u);e.deselectRow(),jye({refresh:i,individualParticipantIds:c,participantType:n,title:s})},a=n===qL?"Create new team":"Create new group";return{options:t.map(s=>({onClick:()=>r({team:s}),label:s.participantName,participant:s,close:!0})),actions:[{onClick:()=>o(),close:!0,label:a}]}}const Y3e=t=>e=>{if(e.key==="Enter"){const n=t.getSelectedData().map(({participantId:s})=>s),a=t.getData("active").map(({participantId:s})=>s).filter(s=>!n.includes(s));a.length===1&&(t.selectRow(a),e.target.value="",t.clearFilter())}};function Hye(t){let e;const i=s=>{var l;return(l=s==null?void 0:s.eventIds)==null?void 0:l.includes(e)},n=s=>{t.removeFilter(i),e=s,s&&t.addFilter(i)},r=Ye.getEvents().events||[];return{eventOptions:[{label:`<span style='font-weight: bold'>${zv}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(s=>({onClick:()=>n(s.eventId),label:s.eventName,close:!0}))),events:r}}const{WTN:K3e}=Ca.ratingConstants,{FEMALE:Z3e,MALE:X3e,MIXED:J3e,ANY:Q3e}=Lu;function eqe({callback:t}={}){let e;lr({title:"Generate mock players",content:o=>e=ro(o,[{options:[{label:"Any",value:Q3e,close:!0},{label:"Female",value:Z3e,close:!0},{label:"Male",value:X3e,close:!0}],label:"Participant gender",field:"gender",value:32},{options:[{label:"32",value:32,close:!0},{label:"64",value:64,close:!0},{label:"128",value:128,close:!0},{label:"256",value:256,close:!0}],label:"Participant count",field:"participantsCount",value:32}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Generate",intent:"is-info",close:!0,onClick:()=>{const o=e.participantsCount.value,a=e.gender.value,s=a===J3e?void 0:a,{participants:l}=$_.generateParticipants({category:{ratingType:K3e,ratingMin:14,ratingMax:19.99},participantsCount:parseInt(o),scaleAllParticipants:!0,sex:s});xt({methods:[{method:JC,params:{participants:l}}],callback:t})}}]})}function tqe({callback:t}){let e=r=>{let o=r==null?void 0:r.players;o!=null&&o.length?iqe(o):o&&!o.length&&Qe.modal.inform({message:"Sheet Empty: No Player Rows"}),vt(t)&&t()};const{extension:i}=Ye.findExtension({discover:!0,name:"REGISTRATION"});(i==null?void 0:i.value)||eqe({callback:e})}function iqe(t){console.log({registeredPlayers:t})}const Gye=t=>{const i=t.getSelectedData().filter(r=>{var o;return!((o=r.events)!=null&&o.length)}).map(({participantId:r})=>r),n=()=>{Bye({participantIds:i,callback:o=>o.success&&t.deleteRow(i)})};lr({title:"Delete participants",content:`Delete ${i.length} participants?`,buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Delete",id:"deleteDraw",intent:"is-danger",close:!0,onClick:n}]})},{FEMALE:d9,MALE:p9,ANY:h9}=Lu;function nqe(t){let e;const i=l=>{var c,u;return((u=(c=l.participant)==null?void 0:c.person)==null?void 0:u.sex)===e},n=l=>{t.removeFilter(i),e=l,l&&t.addFilter(i)},r=[p9,d9],o={[p9]:"Male",[d9]:"Female",[h9]:DNe};return{sexOptions:[{label:`<span style='font-weight: bold'>${o[h9]}</span>`,onClick:()=>n(),close:!0},{divider:!0}].concat(r.map(l=>({onClick:()=>n(l),label:o[l],close:!0}))),genders:o}}const{SIGNED_IN:rqe}=Fo;function oqe(t){const e=t.getSelectedData(),i=e.map(({participantId:o})=>o);xt({methods:[{params:{signInState:rqe,participantIds:i},method:V4}],callback:o=>{o.success&&(e.forEach(a=>a.signedIn=!0),t.updateData(e),t.deselectRow())}})}const{INDIVIDUAL:aqe,SIGNED_OUT:sqe}=Fo;function lqe(t){const i=Ye.getParticipants({participantFilters:{participantTypes:[aqe]},withSignInStatus:!0,withEvents:!0}).participants.filter(o=>o.signedIn&&!o.events.length).map(o=>o.participantId);xt({methods:[{params:{signInState:sqe,participantIds:i},method:V4}],callback:o=>{o.success&&t()}})}function cqe(t){let e=0;if(t.length===0)return e;for(let i=0;i<t.length;i++){let n=t.charCodeAt(i);e=(e<<5)-e+n,e=e&e}return e}const mh={participantName:["full name","name"],participantId:["id","participantid"],person:{address:{city:["city"],state:["state"]},standardFamilyName:["last","last name","last_name"],standardGivenName:["first","First Name","first_name"],nationalityCode:["ioc","country","nationality"],birthDate:["*birth"],sex:["gender","sex"]}};function uqe({data:t,sheetId:e,callback:i}){const r=Ye.getParticipants().participants.map(({participantId:c})=>c),o=iw.countries.map(c=>[c.ioc,c.iso]).flat().filter(Boolean),a=[],s=c=>c.map(u=>[u.toLowerCase(),u.toLowerCase().split(" ").join("")]).flat(),l=c=>(u=[])=>{const d=Object.keys(c),p=s(u),h=p.reduce((m,g)=>c[g]||m,void 0),f=!h&&d.filter(m=>p.find(g=>g.startsWith("*")&&m.toLowerCase().includes(g.slice(1))));return h||c[f]};for(const c of t||[]){const u=Object.assign({},...Object.keys(c).map(w=>({[w.toLowerCase()]:c[w]}))),d=l(u),p={participantType:"INDIVIDUAL",participantRole:"COMPETITOR",person:{}};p.participantName=d(mh.participantName);const h=d(mh.person.standardFamilyName),f=d(mh.person.standardGivenName);if(h&&f)p.person.standardFamilyName=h,p.person.standardGivenName=f,p.participantName=`${f} ${h}`;else continue;const m=d(mh.person.address.state),g=d(mh.person.address.city);(g||m)&&(p.person.addresses=[{city:g,state:m}]);const v=d(mh.person.nationalityCode);v&&o.includes(v.toUpperCase())&&(p.person.nationalityCode=v);const y=d(mh.person.birthDate);if(y!=null&&y.startsWith("Date")){const w=new RegExp(/Date\((\d+),(\d+),(\d+)\)/),U=y.match(w);if(U){const[D,E,C]=U.slice(1,4);p.person.birthDate=`${D}-${E+1}-${C}`}}const b=d(mh.person.sex);if(b){const w=b.toUpperCase();["MALE","FEMALE"].includes(w)?p.person.sex=w:["F","W","G"].includes(b[0])?p.person.sex="FEMALE":["M","B"].includes(b[0])&&(p.person.sex="MALE")}const I=d(["utr"]);if(I){p.timeItems||(p.timeItems=[]);const w={itemType:"SCALE.RATING.SINGLES.UTR",itemValue:{utrRating:I}};p.timeItems.push(w)}const T=d(["wtn"]);if(T){p.timeItems||(p.timeItems=[]);const w={itemType:"SCALE.RATING.SINGLES.WTN",itemValue:{wtnRating:T}};p.timeItems.push(w)}p.participantId=d(mh.participantId)||`XXX-${cqe(p.participantName)}`,r.includes(p.participantId)||a.push(Di.definedAttributes(p))}a.length?xt({methods:[{method:JC,params:{participants:a}},{method:n3e,params:{extension:{name:dle,value:e}}}],callback:d=>{d.success?(vi({message:`Added ${d.results[0].addedCount} participant(s)`,intent:"is-success"}),vt(i)&&i()):console.log(d)}}):vi({message:"No new participants found",intent:"is-primary"}),vt(i)&&i()}function dqe(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var g$={exports:{}},X1={exports:{}};const pqe={},hqe=Object.freeze(Object.defineProperty({__proto__:null,default:pqe},Symbol.toStringTag,{value:"Module"})),fqe=LVe(hqe);var f9;function mqe(){if(f9)return X1.exports;f9=1;const t=fqe,e=async i=>new Promise((n,r)=>{const o=t.request(i,a=>{const s=[];let l=!1;a.on("data",c=>{if(!l&&!String(c).startsWith("/*O_o*/"))return n(null);l=!0,s.push(c)}),a.on("end",()=>{n({ok:!0,text:()=>Buffer.concat(s).toString()})})});o.on("error",r),o.end()});return X1.exports=e,X1.exports.default=e,X1.exports}const zye=typeof dqe>"u",gqe=zye?window.fetch:mqe();class YL{constructor(e,i){this.id=e,this.parseSheetInfo(i)}parseSheetInfo(e){e&&(typeof e=="string"?(this.sheetName=e,this.sheetId=null):typeof e=="object"&&(this.sheetName=e.sheetName,this.sheetId=e.sheetId))}getSpreadsheetDataUsingFetch(){if(!this.id)return null;let e=`https://docs.google.com/spreadsheets/d/${this.id}/gviz/tq?`;return this.sheetId?e=e.concat(`gid=${this.sheetId}`):this.sheetName&&(e=e.concat(`sheet=${this.sheetName}`)),gqe(e).then(i=>i&&i.ok&&i.text?i.text():null).catch(i=>null)}normalizeRow(e){return e.map(i=>i&&i.v!==null&&i.v!==void 0?i:{})}applyHeaderIntoRows(e,i){return i.map(({c:n})=>this.normalizeRow(n)).map(n=>n.reduce((r,o,a)=>o.v?Object.assign(r,{[e[a]]:o.v}):r,{}))}getItems(e){let i=[];try{const n=JSON.parse(e.split(`
`)[1].replace(/google.visualization.Query.setResponse\(|\);/g,""));if(n.table.cols.some(({label:o})=>!!o)){const o=n.table.cols.map(({label:a})=>a);i=this.applyHeaderIntoRows(o,n.table.rows)}else{const[o,...a]=n.table.rows,s=this.normalizeRow(o.c).map(l=>l.v);i=this.applyHeaderIntoRows(s,a)}}catch{}return i}async parse(e,i){if(e&&(this.id=e),i&&this.parseSheetInfo(i),!this.id)throw new Error("SpreadsheetId is required.");const n=await this.getSpreadsheetDataUsingFetch();return n===null?[]:this.getItems(n)}}zye?window.PublicGoogleSheetsParser=YL:(g$.exports=YL,g$.exports.default=YL);var vqe=g$.exports;const yqe=y4(vqe);function bqe({callback:t}){const{extension:e}=Ye.findExtension({discover:!0,name:dle}),i=e==null?void 0:e.value;let n;lr({title:"Import participants",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Submit",intent:"is-primary",onClick:()=>{const s=n.url.value;if(s){const l=s.split("/"),c=l.reduce((h,f)=>!h||f.length>h.length?f:h,void 0),u=!i||i&&c!==i,d=i||l.indexOf("docs.google.com")>0&&l.indexOf("spreadsheets")>0,p=u?c:i;if(d)d?new yqe(p).parse().then(f=>uqe({data:f,sheetId:p,callback:t})):vi({message:"URL unchanged",intent:"is-info"});else{const h=Fn.tr("phrases.invalidsheeturl");vi({message:h,intent:"is-danger"}),n.url.value=""}}},close:!0}],content:s=>{n=ro(s,[{text:"Pull participants from a Google Sheet which has a shared link"},{placeholder:"URL of Google Sheet",value:i,label:"Sheet URL",field:"url"}])}})}const{ALTERNATE:Iqe,WILDCARD:wqe,DIRECT_ACCEPTANCE:m9,UNGROUPED:Sqe}=tc,{MAIN:g9,QUALIFYING:Tqe}=yr,{INDIVIDUAL:Uqe}=Fo,{TEAM:v9,DOUBLES:Dqe}=ps;function Pqe({callback:t,eventName:e,eventType:i,participantType:n,participantIds:r}={}){const o=[v9,Dqe].includes(i)&&n===Uqe;if(!(r!=null&&r.length)){vi({message:"Nothing to do",intent:"is-info"});return}const s=[{label:"Main",value:g9,selected:!0},{label:"Qualifying",value:Tqe}].map(({label:p,value:h,selected:f})=>({selected:f,label:p,value:h})),l=[{hide:o,label:"Direct Acceptance",value:m9,selected:!0},{hide:o,label:"Alternate",value:Iqe},{hide:o,label:"Wildcard",value:wqe},{hide:n===v9,label:"Ungrouped",value:Sqe,selected:o}];let c;lr({title:"Add to event",content:p=>c=ro(p,[{text:`Add ${r.length} participant to ${e}`},{options:s,label:"Event stage",field:"entryStage",value:g9},{options:l,value:m9,label:"Entry status",field:"entryStatus"}]),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Add",intent:"is-info",close:!0,onClick:()=>{const p=c.entryStatus.value,h=c.entryStage.value;vt(t)&&t({entryStatus:p,entryStage:h})}}]})}function Wye({event:t,participantType:e,table:i,callback:n}){const r=i.getSelectedData(),{eventId:o,eventName:a,eventType:s}=t,l=r.filter(u=>!u.events.map(d=>d.eventId).includes(o)).map(({participantId:u})=>u);Pqe({callback:({entryStatus:u,entryStage:d}={})=>{i.deselectRow(),xt({methods:[{params:{eventId:o,participantIds:l,entryStatus:u,entryStage:d},method:$4}],callback:f=>{f.success?vt(n)&&n():(console.log({result:f}),f.misMatchedGender&&vi({intent:"is-danger",message:"Invalid gender"}))}})},eventName:a,participantType:e,eventType:s,participantIds:l})}const{ALTERNATE:Cqe,DIRECT_ACCEPTANCE:Eqe,UNGROUPED:Mqe,STRUCTURE_SELECTED_STATUSES:Rqe}=tc,{ANY:Fg,FEMALE:Vb,MALE:jb,MIXED:Hb}=Lu,{DOUBLES:Wf,SINGLES:Gb,TEAM:qf}=ps,{INDIVIDUAL:J1,PAIR:y9}=Fo,{MAIN:Nqe}=yr;function Wx({event:t,participants:e,callback:i}={}){var v,y;const n=((v=Ye.getEvents().events)==null?void 0:v.length)||0,r={eventType:(t==null?void 0:t.eventType)||Gb,eventName:(t==null?void 0:t.eventName)||`Event ${n+1}`,gender:(t==null?void 0:t.gender)||Fg},o=(y=t==null?void 0:t.entries)==null?void 0:y.filter(({entryStatus:b})=>[...Rqe,Cqe].includes(b)).map(({participantId:b})=>b),a=o?Ye.getParticipants({participantFilters:{participantIds:o},withIndividualParticipants:!0}).participants:[],s=[],l=a.reduce((b,I)=>{var S,w;const T=(S=I.person)!=null&&S.sex?[I.person.sex]:((w=I.individualParticpants)==null?void 0:w.map(U=>{var D;return(D=U.person)==null?void 0:D.sex}))||[];return s.push(T),b.includes(I.participantType)?b:b.concat(I.participantType)},[]);let c,u;const d=e==null?void 0:e[0].participantType;if(e!=null&&e.length){r.eventType=d===J1&&Gb||d===y9&&Wf||qf,d===J1&&(c=[Gb,Wf,qf]),d===y9&&(c=[Wf]),d===qf&&(c=[qf]),u=[Fg];const b=d===J1&&Di.unique(e.map(I=>{var T,S;return(S=(T=I.participant)==null?void 0:T.person)==null?void 0:S.sex})).filter(Boolean);b.length===1&&(b[0]===Vb&&u.push(Vb),b[0]===jb&&u.push(jb),r.gender=b[0])}if(s.length){u=[Fg],t.gender&&!t.gender===Fg&&u.push(t.gender),t.eventType===Wf&&!u.includes(Hb)&&u.push(Hb);const b=Di.unique(...s);b.length===1&&!u.includes(b[0])&&u.push(...b)}else t&&(u=[Fg,jb,Hb,Vb]);const p=()=>{},h=b=>ro(b,[{error:"minimum of 5 characters",validator:Xl(5),placeholder:"Event name",value:r.eventName,onChange:p,selectOnFocus:!0,label:"Event name",field:"eventName",focus:!0},{disabled:l.length,value:r.eventType,field:"eventType",label:"Format",options:[{hide:c&&!c.includes(Gb),selected:r.eventType===Gb,label:"Singles",value:Gb},{hide:c&&!c.includes(Wf),selected:r.eventType===Wf,label:"Doubles",value:Wf},{hide:c&&!c.includes(qf),selected:r.eventType===qf,label:"Team",value:qf}],onChange:p},{value:r.gender,label:"Gender",field:"gender",options:[{hide:u&&!u.includes(jb),selected:r.gender===jb,label:"Male",value:jb},{hide:u&&!u.includes(Vb),selected:r.gender===Vb,label:"Female",value:Vb},{selected:r.gender===Fg,label:"Any",value:Fg},{hide:u&&!u.includes(Hb),selected:r.gender===Hb,label:"Mixed",value:Hb}],onChange:p},{hide:t||e,divider:!0}]),f=()=>{const b=Qe.drawer.attributes.content.eventName.value,I=Qe.drawer.attributes.content.eventType.value,T=Qe.drawer.attributes.content.gender.value,S={eventName:b,eventType:I,gender:T},w=U=>{var D,E;if(U.success){const C=(E=(D=U.results)==null?void 0:D[0])==null?void 0:E.event;vt(i)&&i({...U,event:C,eventUpdates:S})}else console.log({result:U})};if(t){const U=t.eventId;xt({methods:[{method:h3e,params:{eventId:U,eventUpdates:S}}],callback:w})}else{const U=Di.UUID(),D=[{method:t3e,params:{event:{eventId:U,eventName:b,eventType:I,gender:T}}}];if(e!=null&&e.length){const E=e.map(({participantId:N})=>N),C=d===J1&&[Wf,qf].includes(I)?Mqe:Eqe,M={params:{eventId:U,participantIds:E,entryStatus:C,entryStage:Nqe},method:$4};D.push(M)}xt({methods:D,callback:w})}},m=(b,I)=>yb(b,[{label:"Cancel",close:!0},{label:"Save",onClick:f,close:!0,intent:"is-info"}],I),g=t!=null&&t.eventId?"Edit event":"Add event";Qe.drawer.open({title:`<b style='larger'>${g}</b>`,width:"300px",side:Ut,content:h,footer:m})}const mN=(t,e)=>{const i=t.getSelectedData(),n=t.getData("active").map(a=>a.participantId),r=i.filter(a=>n.includes(a.participantId));Wx({callback:a=>{var s,l;if(t.deselectRow(),a!=null&&a.success){const c=(l=(s=a==null?void 0:a.results[0])==null?void 0:s.event)==null?void 0:l.eventId;vt(e)?e({eventId:c}):c&&nr({eventId:c})}},participants:r})},{INDIVIDUAL:b9,TEAM:I9,GROUP:w9}=Fo,{OFFICIAL:S9}=Pf,qye=t=>[{label:"Individuals",value:b9,isActive:t===b9,close:!0},{label:"Officials",value:S9,isActive:t===S9,close:!0},{label:"Groups",value:w9,isActive:t===w9,close:!0},{label:"Teams",value:I9,isActive:t===I9,close:!0}].map(e=>({...e,onClick:()=>{if(e.value!==t){const n=`/tournament/${Ye.getTournament().tournamentRecord.tournamentId}/${Dp}/${e.value}`;Qe.router.navigate(n)}}})),{INDIVIDUAL:Aqe,GROUP:_qe}=Fo,{OFFICIAL:kqe}=Pf,{MIXED:xqe}=Lu;function Oqe({view:t}){const{table:e,replaceTableData:i,teamParticipants:n,groupParticipants:r}=G3e({view:t}),o=gb(e),{eventOptions:a,events:s}=Hye(e),{sexOptions:l,genders:c}=nqe(e),u=()=>bqe({callback:i}),d=()=>{tqe({callback:i,showNotice:!0})},p=t===kqe?"Officials":"Individuals",h=[{onClick:()=>lqe(i),label:"Sign out players not approved for events",close:!0},{label:"Edit ratings",onClick:I=>_We(I,e),close:!0},{divider:!0},{heading:"Add participants"},{label:"Generate mock participants",onClick:d,close:!0},{label:"Import from Google sheet",onClick:u,close:!0},{onClick:()=>Fye({refresh:i,view:t}),label:"New participant",close:!0}],f=s.map(I=>({onClick:()=>Wye({event:I,participantType:Aqe,table:e,callback:i}),label:I.eventName,close:!0})).concat([{divider:!0},{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>mN(e,i),close:!0}]),m=u9({participants:r,participantType:_qe,replaceTableData:i,table:e}),g=u9({participants:n,table:e,replaceTableData:i}),v=Y3e(e),y=[{onKeyDown:I=>{I.keyCode===8&&I.target.value.length===1&&o(""),v(I)},onChange:I=>o(I.target.value),onKeyUp:I=>o(I.target.value),clearSearch:()=>o(""),placeholder:"Search participants",location:Pr,search:!0},{options:f,label:"Add to event",hide:!s.length,intent:"is-none",location:Pr},{onClick:()=>mN(e),label:"Create event",hide:s.length,intent:"is-info",location:Pr},{selection:g,label:"Add to team",intent:"is-none",location:Pr},{selection:m,label:"Add to group",intent:"is-none",location:Pr},{onClick:()=>oqe(e),intent:"is-primary",location:Pr,label:"Sign in"},{onClick:()=>Gye(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{onKeyDown:I=>{I.keyCode===8&&I.target.value.length===1&&o(""),v(I)},onChange:I=>o(I.target.value),onKeyUp:I=>o(I.target.value),clearSearch:()=>o(""),placeholder:"Search participants",location:Lt,search:!0},{hide:(s||[]).length<1,options:a,label:zv,modifyLabel:!0,location:Lt,selection:!0},{options:l,label:c[xqe],modifyLabel:!0,location:Lt,selection:!0},{options:qye(t),label:p,intent:"is-info",modifyLabel:!0,location:Ut,selection:!0,align:Ut},{options:h,label:"Actions",selection:!1,location:Ut,align:Ut},{onClick:I=>z3e(I,e),label:"Save ratings",intent:"is-primary",class:"saveRatings",location:Ut,visible:!1}],b=document.getElementById(Ez);Da({table:e,target:b,items:y})}function Lqe(t,e){const{individualParticipantIds:i,individualParticipants:n,participantName:r,participantType:o,participantId:a,representing:s}=t,l=(i==null?void 0:i.length)||0;return{events:Cye(t,e),eventIds:t.events.map(({eventId:c})=>c),searchText:r.toLowerCase(),representing:Eye(s),individualParticipants:n,participantName:r,participantType:o,participantId:a,membersCount:l}}function Fqe({table:t,team:e}){const n=t.getSelectedData().map(({participantId:a})=>a);t.deselectRow();const r=[{method:v3e,params:{groupingParticipantId:e.participantId,individualParticipantIds:n,suppressErrors:!0}}];xt({methods:r,callback:a=>{a.success&&t.deleteRow(n)}})}const{ALTERNATE_PARTICIPANT:Bqe,ASSIGN_PARTICIPANT:$qe,QUALIFYING_PARTICIPANT:Vqe,SWAP_PARTICIPANTS:jqe}=$y,Hqe={[Bqe]:{selections:"availableAlternates",targetAttribute:"participantId",param:"alternateParticipantId",title:"Assign alternate"},[$qe]:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participant"},[Vqe]:{selections:"qualifyingParticipants",targetAttribute:"participantId",param:"qualifyingParticipantId",title:"Assign qualifier"},[jqe]:{selections:"availableAssignments",targetAttribute:"drawPosition",title:"Swap draw positions",param:"drawPositions"},selectParticipants:{selections:"participantsAvailable",targetAttribute:"participantId",title:"Select participants"}};function QC({title:t="Select participant",selectedParticipantIds:e,selectionLimit:i,activeOnEnter:n,selectOnEnter:r,onSelection:o,update:a,action:s}){const l=Hqe[s.type];if(!(l!=null&&l.targetAttribute))return;let c,u;const d=()=>{var M;const D=l.targetAttribute,E=l.param||l.targetAttribute,C=Array.isArray(c)?(M=c[0])==null?void 0:M[D]:c==null?void 0:c[D];C&&(s.type==="SWAP"?(s.payload.drawPositions.push(C),o({[E]:s.payload.drawPositions})):o({[E]:C,selected:c}))},p="selectionControl",h="selectionTable",f=[{label:"Cancel",intent:"is-none",close:!0},{hide:i===1,label:"Select",intent:"is-info",onClick:d,close:!0}],m=()=>{const D=Qe.tables.selectionTable;D==null||D.destroy(),delete Qe.tables.selectionTable},g=`
    <div style='min-height: 420px'>
      <div id='${p}'></div>
      <div id='${h}'></div>
    </div>
  `;a?a({title:t,content:g,buttons:f,onClose:m}):lr({title:t,content:g,buttons:f,onClose:m});const v=D=>{c=D,i&&(c==null?void 0:c.length)===i&&(Dw(),d())},y=s[l.selections],{table:b}=Bve({selectedParticipantIds:e,targetAttribute:l.targetAttribute,selectionLimit:i,onSelected:v,anchorId:h,data:y}),I=gb(b),T=()=>{const D=b.getData("active");if(D.length===1){if(r)c=D[0],Dw(),d();else if(n){const E=(c==null?void 0:c.map(M=>M.participantId))||[],C=D[0].participantId;E.includes(C)||(Array.isArray(c)?c.push(D[0]):c=D,b.selectRow([C]),u.participantSearch.value="")}}},w=[{onKeyDown:D=>{D.keyCode===8&&D.target.value.length===1&&I(""),D.key==="Enter"&&T()},onChange:D=>I(D.target.value),onKeyUp:D=>I(D.target.value),clearSearch:()=>I(""),placeholder:"Search entries",id:"participantSearch",location:Lt,search:!0,focus:!0}],U=document.getElementById(p);u=Da({table:b,target:U,items:w}).inputs}const{ASSIGN_PARTICIPANT:Gqe}=$y,KL=Di.extractAttributes,zqe=t=>{const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em",e.appendChild(i);const n="1px solid #333",r=document.createElement("div");r.style.backgroundColor="white",r.style.border=n,r.style.width="99%",e.className=G_,e.style.display=ht,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=n,e.style.borderBotom=n,e.appendChild(r),t.getElement().appendChild(e);const o=t.getData(),a=d=>{const p={};return d==null?void 0:d.map(h=>{var m;const f=((m=h.person)==null?void 0:m.sex)||"OTHER";return p[f]||(p[f]=0),p[f]+=1,{...h,order:p[f]}})},s=a(o.individualParticipants),l=new bo(r,{placeholder:"No individual participants",index:"participantId",layout:"fitColumns",movableRows:!0,maxHeight:400,data:s,columns:[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{title:"Order",headerSort:!1,field:"order",width:70},{title:"Name",field:"participantName",formatter:Ib()},{title:"Gender",field:"person.sex",width:100}]});l.on("scrollVertical",Tc),l.on("rowMoved",d=>{const p=d.getTable(),f=p.getData().map((v,y)=>({...v,order:y+1})).map(({participantId:v})=>v),m=[{params:{participant:{participantId:o.participantId,individualParticipantIds:f}},method:n9}];xt({methods:m,callback:v=>{if(v.success){const y=p.getRows(),b=y.map(T=>T.getData()),I=a(b);y.forEach((T,S)=>T.update(I[S]))}}})}),Da({table:l,target:i,items:[{onClick:()=>Fqe({table:l,team:o}),label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{onClick:()=>{var g;const d=v=>{if(v.participantId){const y=v.selected,b=(v.selected?v.selected.map(KL("participantId")):[v.participantId]).filter(Boolean),I=(o.individualParticipants??[]).map(KL("participantId")).concat(b);if(b!=null&&b.length){const T=[{method:Nye,params:{groupingParticipantId:o.participantId,individualParticipantIds:b}},{params:{participant:{participantId:o.participantId,individualParticipantIds:I}},method:n9}];xt({methods:T,callback:w=>{w.success&&(o.individualParticipants=(o.individualParticipants??[]).concat(y),o.membersCount=o.individualParticipants.length,t.update(o),t.getTable().redraw(!0))}})}}},p=((g=o.individualParticipants)==null?void 0:g.map(KL("participantId")))||[],{participants:h}=Ye.getParticipants({participantFilters:{participantTypes:["INDIVIDUAL"]},withISO2:!0}),f=h.filter(({participantId:v})=>!p.includes(v));QC({title:"Select players to add",activeOnEnter:!0,selectionLimit:99,onSelection:d,action:{type:Gqe,participantsAvailable:f}})},label:"Add players",intent:"is-primary",location:Ut}]})},H4="&#9660;",Yye=" &#9654;",tp="&#8964;",Kye=` <span class='tabulator-responsive-collapse-toggle-close toggleCaret'> ${H4} </span>`,Zye=`<span class='tabulator-responsive-collapse-toggle-open toggleCaret'> ${Yye} </span>`,Xye=G_;function Av(t,e){const i=e.getRow(),n=i._row.element.getElementsByClassName(Xye)[0];if(n){const r=n.style.display!==ht;n.style.display=r?ht:"";const a=i.getCells().find(s=>s.getColumn().getDefinition().field===Ele)._cell.element;return a&&(a.innerHTML=r?Zye:Kye),{open:!r}}}function G4(t){const i=t.getRow()._row.element.getElementsByClassName(Xye)[0];return(i==null?void 0:i.style.display)!==ht?Zye:Kye}const{GROUP:Wqe}=Fo;function qqe({view:t}){const e=(i,n)=>{Av(i,n).open};return console.log({view:t}),[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,headerSort:!1,hozAlign:Lt,width:5},{formatter:"responsiveCollapse",width:50,minWidth:50,hozAlign:Vt,resizable:!1,headerSort:!1},{headerMenu:ah({matchUpsCount:"Total MatchUps",membersCount:"Individuals",winLoss:"Win/Loss"}),formatter:"rownum",headerSort:!1,hozAlign:Lt,width:55},{cellClick:(i,n)=>e(i,n),field:"participantName",title:"Name",minWidth:200,widthGrow:1},{sorter:(i,n)=>{var r,o,a;return(a=(r=i==null?void 0:i[0])==null?void 0:r.eventName)==null?void 0:a.localeCompare((o=n==null?void 0:n[0])==null?void 0:o.eventName)},formatter:$ye(nr),visible:t!==Wqe,hozAlign:Lt,field:"events",title:"Events",minWidth:300,editor:!1,widthGrow:2},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Individuals",headerHozAlign:Vt,field:"membersCount",hozAlign:Vt,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:Vt,field:"matchUpsCount",hozAlign:Vt,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon winloss_header" />',headerTooltip:"Win/Loss",headerHozAlign:Vt,field:"winLoss",hozAlign:Vt,headerSort:!0,visible:!0,width:50},{field:"representing",title:"Representing",visible:!1,minWidth:200},{cellClick:(i,n)=>e(i,n),formatter:G4,responsive:!1,headerSort:!1,hozAlign:Ut,field:Ele,width:20},{cellClick:aM,formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,width:20}]}const{TEAM:ZL}=Fo;function Yqe({view:t}={}){let e,i,n,r;const o=()=>({participants:i,derivedEventInfo:n}=Ye.getParticipants({participantFilters:{participantTypes:[t||ZL]},withIndividualParticipants:!0,withScaleValues:!0,withEvents:!0,withISO2:!0}),i.map(u=>Lqe(u,n))),a=()=>{setTimeout(()=>e.replaceData(o()),r?0:1e3)},s=qqe({view:t});return(c=>{var p;rh({anchorId:iR});const u=document.getElementById(iR),d=(p=As(u,"section"))==null?void 0:p.querySelector(".tabHeader");e=new bo(u,{headerSortElement:oh(["events","membersCount","matchUpsCount","winLoss"]),responsiveLayoutCollapseFormatter:Pye,responsiveLayoutCollapseStartOpen:!1,minHeight:window.innerHeight*.81,height:window.innerHeight*.86,placeholder:"No team participants",rowFormatter:zqe,responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,data:c,columns:s}),e.on("dataChanged",h=>{const f=t===ZL?"Teams":"Groups";d&&(d.innerHTML=`${f} (${h.length})`)}),e.on("dataFiltered",(h,f)=>{const m=t===ZL?"Teams":"Groups";d&&(d.innerHTML=`${m} (${f.length})`)}),e.on("scrollVertical",Tc),e.on("tableBuilt",()=>r=!0)})(o()),{table:e,replaceTableData:a}}const Kqe={country:{personAttribute:"nationalityCode"},city:{accessor:"person.addresses.city"}};function Zqe({callback:t}={}){const e=[{label:Fn.tr("cnt"),value:"country"},{label:"City",value:"city"}],i="-";lr({title:"Create Team",content:o=>ro(o,[{options:[{label:"Select attribute",value:i},...e],label:"Attribute",field:"selection",value:""}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Create",intent:"is-primary",onClick:({content:o})=>{const a=o==null?void 0:o.selection.value;if(!a||a===i)return;const s=Kqe[a],l=Ye.createTeamsFromParticipantAttributes({...s,addParticipants:!1});if(l.newParticipants){const c=[{params:{participants:l.newParticipants},method:JC}];xt({methods:c,callback:t})}},close:!0}],onClose:()=>{}})}const{TEAM:T9}=Fo;function Xqe({view:t}){const{table:e,replaceTableData:i}=Yqe({view:t}),n=gb(e),{eventOptions:r,events:o}=Hye(e),a=[{label:"New team",onClick:()=>jye({title:"New team",refresh:i})},{label:"Generate teams",onClick:()=>Zqe({callback:i})}],l=[{label:'<p style="font-weight: bold">Create new event</p>',onClick:()=>mN(e),close:!0},{divider:!0}].concat(o.filter(({eventType:p})=>p===T9).map(p=>({onClick:()=>Wye({event:p,participantType:T9,table:e,callback:i}),label:p.eventName,close:!0}))),c=t==="GROUP"?"Groups":"Teams",u=[{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:Pr,search:!0},{options:l,label:"Add to event",hide:!o.length,intent:"is-none",location:Pr},{onClick:()=>mN(e),label:"Create event",hide:o.length,intent:"is-info",location:Pr},{onClick:()=>Gye(e),label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{onKeyDown:p=>p.keyCode===8&&p.target.value.length===1&&n(""),onChange:p=>n(p.target.value),onKeyUp:p=>n(p.target.value),clearSearch:()=>n(""),placeholder:"Search teams",location:Lt,search:!0},{hide:r.length<2,options:r,modifyLabel:!0,label:zv,location:Lt,selection:!0},{options:qye(t),label:c,modifyLabel:!0,intent:"is-info",location:Ut,selection:!0,align:Ut},{options:a,label:"Actions",selection:!1,location:Ut,align:Ut}],d=document.getElementById(kz);Da({table:e,target:d,items:u})}const{INDIVIDUAL:Jqe,TEAM:Qqe,GROUP:e4e}=Fo;function t4e({participantView:t=Jqe}={}){const e=t.toUpperCase(),i=[Qqe,e4e].includes(e),n=document.getElementById("individuals"),r=document.getElementById("participantGroupings");i?(n.style.display=ht,r.style.display=""):(r.style.display=ht,n.style.display=""),i?Xqe({view:e}):Oqe({view:e})}const{TEAM:i4e}=ps,tS=t=>{var A,_,k,O,F;const{potentialParticipants:e,matchUpType:i,matchUpId:n,eventName:r,roundName:o,schedule:a,eventId:s,drawId:l,gender:c,sides:u,...d}=t,{scheduledDate:p,scheduledTime:h,courtName:f}=a||{},m=B=>{var $;return(($=B.person)==null?void 0:$.standardFamilyName)||B.participantName},g=(e==null?void 0:e.map(B=>({participantName:B.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((_=u==null?void 0:u[1])==null?void 0:_.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(k=v==null?void 0:v.person)==null?void 0:k.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(O=y==null?void 0:y.person)==null?void 0:O.sex,participant:y},T=u.flatMap(({participant:B})=>{var $;return($=B==null?void 0:B.individualParticipantIds)!=null&&$.length?B.individualParticipantIds:B==null?void 0:B.participantId}).filter(Boolean),S=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,w=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),D=(F=d.score)==null?void 0:F.scoreStringSide1,E=u.flatMap(B=>{var V,H,z;const $=(V=B.participant)==null?void 0:V.person;return $?[$.standardGivenName,$.standardFamilyName]:(z=(H=B.participant)==null?void 0:H.individualParticipants)==null?void 0:z.map(({person:G})=>[G.standardGivenName,G.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),C=Ole([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),M=t.collectionId?i4e:i,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,R={score:D,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:w,winningSide:S};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:N,scheduledDate:p,readyToScore:U,scheduledTime:h,matchUpType:i,scoreDetail:R,winningSide:S,searchText:C,courtName:f,eventName:r,eventType:M,matchUpId:n,roundName:o,complete:w,eventId:s,matchUp:t,gender:c,drawId:l,side1:b,side2:I,score:D}};function Jye(t,e){const i=t.target.id;t.dataTransfer.setData("itemid",i),e&&(t.dataTransfer.setData("itemtype",MNe),t.dataTransfer.setDragImage(Qe.dragMatch,10,10)),t.dataTransfer.effectAllowed="move"}const{MALE:n4e,FEMALE:r4e}=Lu;function o4e(t){function e(o){const a=document.createElement("div"),s=o.getValue(),l=yu(s)&&(s==null?void 0:s.sex)===n4e&&"#2E86C1"||(s==null?void 0:s.sex)===r4e&&"#AA336A"||"";return a.style.color=l,a.innerHTML=(yu(s)?s.participantName:s)||"",a}function i(o){const a=document.createElement("div");return a.innerHTML=o.getValue(),a}function n(o){const a=o.getElement();return a.classList.add("tag"),a.classList.add("is-info"),a.classList.add("is-light"),(t==null?void 0:t.length)||0}const r=(o,a)=>{var s;return o.participantName&&!a.participantName||a.participantName&&!o.participantName||!(o!=null&&o.participantName)&&!(a!=null&&a.participantName)?1:(s=o==null?void 0:o.participantName)==null?void 0:s.localeCompare(a==null?void 0:a.participantName)};return[{titleFormatter:n,formatter:"rownum",headerSort:!1,hozAlign:Vt,frozen:!0,width:55},{formatter:i,field:"eventName",resizable:!1,title:"Event",visible:!0,minWidth:250},{formatter:i,field:"roundName",resizable:!1,title:"Round",minWidth:90},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 1",minWidth:120,field:"side1"},{formatter:e,sorter:r,responsive:!1,resizable:!1,title:"Side 2",minWidth:120,field:"side2"},{field:"matchUp.matchUpFormat",title:"Scoring Format",formatter:i,responsive:!1,resizable:!1,minWidth:100}]}const U9=Object.keys(mle);function a4e(t,e){return U9.indexOf(t.issue)-U9.indexOf(e.issue)}function gN(t){var a;const e=t.getData(),i=e.flatMap(s=>Object.values(s).filter(yu)).filter(s=>s.matchUpId),{courtIssues:n,rowIssues:r}=yg.proConflicts({matchUps:i});n&&((a=Object.keys(n))!=null&&a.length),t.updateData(e);const o=t.getColumns()[0].getCells();r!=null&&r.length&&r.forEach((s,l)=>{const c=l+1,u=o.find(d=>d.getData().rowNumber===c);if(u){u.getElement().classList.forEach(p=>{p.startsWith("matchup")&&u.getElement().classList.remove(p)});const d=u.getData();if(s.length){const p=s.sort(a4e);d.issues=p;const h=mle[p[0].issue];u.getElement().classList.add(h)}else u.getElement().style.backgroundColor="white",d.issues=[]}else console.log("control cell not found",{rowNumber:c})})}function s4e(t,e){var m;t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=bo.findTable("#tournamentSchedule")[0],o=n.getData().flatMap(g=>Object.values(g).filter(v=>v.matchUpId)).find(g=>g.matchUpId===i)||{};if(!((m=o==null?void 0:o.schedule)!=null&&m.courtId))return;let a;const s=n.getData().find(g=>(a=Object.keys(g).find(v=>{if(yu(g[v]))return g[v].matchUpId===i}),a)),{courtId:l,courtOrder:c,venueId:u}=o.schedule;s[a]={schedule:{courtOrder:c,courtId:l,venueId:u}},n.updateData([s]),delete o.schedule.scheduledDate,delete o.schedule.scheduledTime,delete o.schedule.courtOrder,delete o.schedule.courtId,delete o.schedule.venueId;const d={scheduledTime:"",scheduledDate:"",courtOrder:"",venueId:"",courtId:""},p=[{method:f$,params:{tournamentId:o.tournamentId,matchUpId:o.matchUpId,schedule:d,drawId:o.drawId}}];xt({methods:p,engine:JM,callback:g=>!g.success&&console.log({result:g})}),o.schedule=d;const f=tS(o);e.addRow(f,!0),gN(n)}const{SINGLES:l4e,DOUBLES:c4e}=ps;function u4e({scheduledDate:t}={}){let e=t,i,n,r;function o(d){const p=d.getElement(),f=d.getData().matchUp.matchUpId;p.id=f,p.addEventListener("dragstart",m=>Jye(m,!0)),p.draggable=!0}function a({scheduledDate:d}){var m;const p=((m=yg.allCompetitionMatchUps({matchUpFilters:{matchUpStatuses:Ca.upcomingMatchUpStatuses,matchUpTypes:[l4e,c4e]},nextMatchUps:!0}).matchUps)==null?void 0:m.filter(g=>{var v,y;return!((v=g.schedule)!=null&&v.courtId)&&!((y=g.sides)!=null&&y.some(({bye:b})=>b))}))||[],h=d||e;return i=p.filter(g=>{var v;return!((v=g.schedule)!=null&&v.scheduledDate)||g.schedule.scheduledDate===h}),{rowMatchUps:i.map(tS)}}function s({scheduledDate:d}={}){return setTimeout(()=>{const{rowMatchUps:h=[]}=a({scheduledDate:d});r&&r.replaceData(h)},n?0:1e3),{unscheduledMatchUps:i}}const l=o4e(i);rh({anchorId:bv});const c=document.getElementById(bv),{rowMatchUps:u=[]}=a({scheduledDate:e});return r=new bo(c,{placeholder:"No unscheduled matches",rowFormatter:o,layout:"fitDataStretch",index:"matchUpId",data:u,height:250,columns:l}),r.on("tableBuilt",()=>{n=!0;const d=c.getElementsByClassName("tabulator-tableholder")[0];d.addEventListener("drop",p=>s4e(p,r)),d.ondragover=p=>p.preventDefault(),d.draggable=!0}),r.on("dataChanged",d=>{const p=r.getColumns()[0]._getSelf().titleElement;p.innerHTML=`${d.length}`}),r.on("dataFiltered",(d,p)=>{const h=r.getColumns()[0]._getSelf().titleElement;h.innerHTML=`${p.length}`}),r.on("rowClick",(d,p)=>{const h=p.getData();console.log({matchUp:h})}),{table:r,replaceTableData:s,unscheduledMatchUps:i}}function z4(t,e){return t?Di.dateTime.convertTime(t,e):""}function d4e(t){const e=z4(t,!0).split(":");return+e[0]*60*60+ +e[1]*60+(+e[2]||0)}function D9(t){return t.toString()[1]?t:"0"+t}function p4e(t,e){let i=Math.floor(t/3600),n=Math.floor((t-i*(60*60))/60);return e&&(n=0,i+=1,i>23&&(i=0)),`${D9(i)}:${D9(n)}`}function P9(t,e,i,n){return new(i||(i=Promise))(function(r,o){function a(c){try{l(n.next(c))}catch(u){o(u)}}function s(c){try{l(n.throw(c))}catch(u){o(u)}}function l(c){var u;c.done?r(c.value):(u=c.value,u instanceof i?u:new i(function(d){d(u)})).then(a,s)}l((n=n.apply(t,e||[])).next())})}const C9=(t,e)=>{const{touches:i}=t,{clientX:n,clientY:r}=t;if(!e)return;const{left:o,top:a}=e.getBoundingClientRect();let s={x:0,y:0};if(i===void 0)s={x:n-o,y:r-a};else if(i!==void 0&&i.length>0&&Object.keys(i).length>0){const{clientX:l,clientY:c}=i[0];s={x:l-o,y:c-a}}return Object.keys(s).length!==0||s.constructor!==Object?s:void 0},Wi=(t,e)=>!!t&&t.classList.contains(e),tu=(t,e,i)=>{if(!t)return;const n=new CustomEvent(e,{detail:i});t.dispatchEvent(n)},XL=(t,e,i)=>((n,r)=>Math.round(n/r)*r)(t,e*i),Q1=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(t)+n),JL=(t,e)=>Array.from({length:Number(e)-Number(t)+1},(i,n)=>Number(e)-n).reverse(),eE=t=>{t&&typeof t=="function"&&t()},QL=(t="")=>{const e=t.replace(/(AM|PM|am|pm)/,n=>` ${n}`),i=new Date(`September 20, 2000 ${e}`);return`${i.getHours().toString().padStart(2,"0")}:${i.getMinutes().toString().padStart(2,"0")}`},uc=(t,e,i,n)=>{if(!t)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const{value:r}=t;if(i){if(typeof i=="boolean"&&i){const[d,p]=new Date().toLocaleTimeString().split(":");if(/[a-z]/i.test(p)&&e==="12h"){const[h,f]=p.split(" ");return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:h,type:f}}return{hour:Number(d)<=9?`0${Number(d)}`:d,minutes:p,type:void 0}}{const{time:d,locales:p,preventClockType:h}=i;let f=d;if(d||(f=new Date),h&&n){const[v,y]=new Date(f).toLocaleTimeString().split(":");if(/[a-z]/i.test(y)){const[b,I]=y.split(" ");return{hour:v,minutes:b,type:I}}return{hour:Number(v)<=9?`0${Number(v)}`:v,minutes:y,type:void 0}}const[m,g]=new Date(f).toLocaleTimeString(p,{timeStyle:"short"}).split(":");if(/[a-z]/i.test(g)&&e==="12h"){const[v,y]=g.split(" ");return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:v,type:y}}if(e==="12h"){const[v,y]=new Date(`1970-01-01T${m}:${g}Z`).toLocaleTimeString("en-US",{timeZone:"UTC",hour12:!0,hour:"numeric",minute:"numeric"}).split(":"),[b,I]=y.split(" ");return{hour:Number(v)<=9?`0${Number(v)}`:m,minutes:b,type:I}}return{hour:Number(m)<=9?`0${Number(m)}`:m,minutes:g,type:void 0}}}if(r===""||!r)return{hour:"12",minutes:"00",type:e==="24h"?void 0:"PM"};const[o,a]=r.split(" "),[s,l]=o.split(":");if(/[a-z]/i.test(o))return{error:"The input contains invalid letters or whitespace."};if(r.includes(" ")){if(!a)return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 5), currentLength: ${r.length}.`,currentLength:r.length};if(r.length>8||a!=="AM"&&a!=="PM")return{error:`The input contains invalid letters or whitespace.
        Problem is with input length (max 8), currentLength: ${r.length} or invalid type (PM or AM), currentType: ${a}.`,currentLength:r.length,currentType:a}}let c=Number(l);const u=Number(s);return c<10?c=`0${c}`:c===0&&(c="00"),e==="12h"?u>12||c>59||c<0||u===0||a!=="AM"&&a!=="PM"?{error:`The input contains invalid letters or numbers. Problem is with hour which should be less than 13 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)} or invalid type (PM or AM), currentType: ${a}.`,currentHour:u,currentMin:c,currentType:a}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString(),type:a}:u<0||u>23||c>59?{error:`The input contains invalid numbers. Problem is with hour which should be less than 24 and higher or equal 0, currentHour: ${u}. Minutes should be less than 60 and higher or equal 0, currentMinutes: ${Number(c)}`,currentHour:u,currentMin:c}:{hour:u<10?`0${u}`:u.toString(),minutes:c.toString()}},om=(t,e,i)=>{const n=Number(t);return e==="hour"?i!=="24h"?n>0&&n<=12:n>=0&&n<=23:e==="minutes"?n>=0&&n<=59:void 0},tE=(t,e,i,n)=>{if(t){if(Array.isArray(t)&&t.length>0)return!t.map(r=>om(r,e,i)).some(r=>r===!1);if(typeof t=="string"||typeof t=="number"){const r=om(t,e,i),o=n==null?void 0:n.map(Number).includes(Number(t));return!(!r||o)}}};function qx(t,e){e===void 0&&(e={});var i=e.insertAt;if(t&&typeof document<"u"){var n=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",i==="top"&&n.firstChild?n.insertBefore(r,n.firstChild):n.appendChild(r),r.styleSheet?r.styleSheet.cssText=t:r.appendChild(document.createTextNode(t))}}qx(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui * {
  box-sizing: border-box !important;
}
.timepicker-ui-modal {
  font-family: "Roboto", sans-serif;
  position: fixed;
  opacity: 0;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
  background-color: rgba(156, 155, 155, 0.6);
  z-index: 5000;
  pointer-events: none;
}
.timepicker-ui-modal.show {
  pointer-events: auto;
}
.timepicker-ui-modal.removed {
  top: auto;
  bottom: auto;
  left: auto;
  right: auto;
  background-color: transparent;
}
.timepicker-ui-measure {
  position: absolute;
  top: -9999px;
  width: 3.125rem;
  height: 3.125rem;
  overflow: scroll;
}
.timepicker-ui-wrapper, .timepicker-ui-wrapper.mobile {
  position: fixed;
  z-index: 5001;
  width: 328px;
  height: 500px;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background-color: #fff;
  border-radius: 4px;
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
  display: flex;
  flex-direction: column;
  outline: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    flex-direction: row;
    height: 360px;
    width: 584px;
  }
}
@media screen and (max-width: 330px) and (orientation: portrait) {
  .timepicker-ui-wrapper:not(.timepicker-ui-wrapper + .mobile) {
    width: 315px;
  }
}
.timepicker-ui-wrapper.mobile {
  height: 218px;
}
@media screen and (max-width: 330px) {
  .timepicker-ui-wrapper.mobile {
    width: 315px;
  }
}
.timepicker-ui-header, .timepicker-ui-header.mobile {
  padding-top: 52px;
  padding-bottom: 36px;
  padding-right: 24px;
  padding-left: 24px;
  height: 104px;
  display: flex;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  position: relative;
  height: 100%;
}
.timepicker-ui-header.mobile {
  padding-bottom: 0;
  padding-top: 35px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-header:not(.timepicker-ui-header + .mobile) {
    height: auto;
    flex-direction: column;
  }
}
.timepicker-ui-select-time, .timepicker-ui-select-time.mobile {
  text-transform: uppercase;
  position: absolute;
  top: 16px;
  left: 24px;
  font-size: 12px;
  color: #a9a9a9;
}
.timepicker-ui-body {
  height: 256px;
  width: 256px;
  margin: 0 auto;
  position: relative;
  border-radius: 100%;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-body {
    padding-right: 0;
    padding-left: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    margin-top: 23px;
  }
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-landspace {
    display: flex;
    flex-direction: column;
    width: 100%;
  }
}
.timepicker-ui-footer, .timepicker-ui-footer-mobile {
  height: 76px;
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-footer:not(.timepicker-ui-footer + .mobile) {
    justify-content: flex-end;
  }
}
.timepicker-ui-footer.mobile {
  align-items: flex-start;
}
.timepicker-ui-clock-face {
  background-color: #e0e0e0;
  height: 100%;
  width: 100%;
  border-radius: 100%;
  position: relative;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-clock-face {
    height: 256px;
    width: 256px;
    top: 15px;
  }
}
.timepicker-ui-dot {
  position: absolute;
  top: 50%;
  left: 50%;
  user-select: none;
  touch-action: none;
  transform: translate(-50%, -50%);
  background-color: #6200ee;
  height: 8px;
  width: 8px;
  border-radius: 100%;
}
.timepicker-ui-tips-wrapper {
  height: 100%;
  width: 100%;
}
.timepicker-ui-tips-wrapper-24h {
  position: absolute;
  height: 160px;
  width: 160px;
  z-index: 0;
  transform: translate(-50%, -50%);
  left: 50%;
  top: 50%;
  border-radius: 50%;
}
.timepicker-ui-tips-wrapper-24h-disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12, .timepicker-ui-minutes-time, .timepicker-ui-hour-time-24 {
  position: absolute;
  width: 32px;
  height: 32px;
  text-align: center;
  cursor: pointer;
  font-size: 17.6px;
  display: flex;
  justify-content: center;
  align-items: center;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 span, .timepicker-ui-minutes-time span, .timepicker-ui-hour-time-24 span {
  touch-action: none;
  user-select: none;
}
.timepicker-ui-hour-time-12 {
  display: block;
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-wrapper-time, .timepicker-ui-wrapper-time.mobile {
  display: flex;
  margin-right: 10px;
  height: 100%;
  justify-content: center;
  align-items: center;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-time:not(.timepicker-ui-wrapper-time + .mobile) {
    margin-right: 0;
    height: auto;
  }
}
.timepicker-ui-wrapper-time-24h {
  margin-right: 0px;
}
.timepicker-ui-wrapper-time.mobile {
  position: relative;
}
.timepicker-ui-hour, .timepicker-ui-minutes, .timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 51.2px;
  background-color: #e4e4e4;
  border-radius: 7px;
  cursor: pointer;
  transition: all 0.3s ease;
  outline: none;
  border: 2px solid transparent;
  padding: 10px;
  width: 96px;
  text-align: center;
}
.timepicker-ui-hour:focus-visible, .timepicker-ui-minutes:focus-visible, .timepicker-ui-hour.mobile:focus-visible, .timepicker-ui-minutes.mobile:focus-visible {
  outline: auto;
}
.timepicker-ui-hour:hover, .timepicker-ui-hour.active, .timepicker-ui-minutes:hover, .timepicker-ui-minutes.active, .timepicker-ui-hour.mobile:hover, .timepicker-ui-hour.mobile.active, .timepicker-ui-minutes.mobile:hover, .timepicker-ui-minutes.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-hour::-webkit-outer-spin-button, .timepicker-ui-hour::-webkit-inner-spin-button, .timepicker-ui-minutes::-webkit-outer-spin-button, .timepicker-ui-minutes::-webkit-inner-spin-button, .timepicker-ui-hour.mobile::-webkit-outer-spin-button, .timepicker-ui-hour.mobile::-webkit-inner-spin-button, .timepicker-ui-minutes.mobile::-webkit-outer-spin-button, .timepicker-ui-minutes.mobile::-webkit-inner-spin-button {
  -webkit-appearance: none !important;
  margin: 0 !important;
}
.timepicker-ui-hour[type=number], .timepicker-ui-minutes[type=number], .timepicker-ui-hour.mobile[type=number], .timepicker-ui-minutes.mobile[type=number] {
  -moz-appearance: textfield !important;
}
.timepicker-ui-hour, .timepicker-ui-minutes {
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour[contenteditable=true]:focus, .timepicker-ui-hour[contenteditable=true]:active, .timepicker-ui-minutes[contenteditable=true]:focus, .timepicker-ui-minutes[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-hour.mobile, .timepicker-ui-minutes.mobile {
  height: 70px;
  outline: none;
  border: 2px solid transparent;
}
.timepicker-ui-hour.mobile[contenteditable=true]:focus, .timepicker-ui-hour.mobile[contenteditable=true]:active, .timepicker-ui-minutes.mobile[contenteditable=true]:focus, .timepicker-ui-minutes.mobile[contenteditable=true]:active {
  border: 2px solid #6200ee;
  outline-color: #6200ee;
  user-select: all;
}
.timepicker-ui-dots, .timepicker-ui-dots.mobile {
  padding-left: 5px;
  padding-right: 5px;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 57.6px;
  user-select: none;
  touch-action: none;
}
.timepicker-ui-wrapper-type-time, .timepicker-ui-wrapper-type-time.mobile {
  display: flex;
  flex-direction: column;
  height: 80px;
  justify-content: center;
  align-items: center;
  font-size: 16px;
  font-weight: 500;
  color: #787878;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-wrapper-type-time {
    flex-direction: row;
    width: 100%;
  }
}
.timepicker-ui-wrapper-type-time.mobile {
  height: 70px;
}
.timepicker-ui-am, .timepicker-ui-pm, .timepicker-ui-am.mobile, .timepicker-ui-pm.mobile {
  display: flex;
  justify-content: center;
  align-items: center;
  border: 2px solid #d6d6d6;
  transition: all 0.3s ease;
  cursor: pointer;
  width: 100%;
  height: 100%;
}
.timepicker-ui-am:hover, .timepicker-ui-am.active, .timepicker-ui-pm:hover, .timepicker-ui-pm.active, .timepicker-ui-am.mobile:hover, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile:hover, .timepicker-ui-pm.mobile.active {
  color: #6200ee;
  background-color: #ece0fd;
}
.timepicker-ui-am.active, .timepicker-ui-pm.active, .timepicker-ui-am.mobile.active, .timepicker-ui-pm.mobile.active {
  pointer-events: none;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile), .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-am, .timepicker-ui-am.mobile {
  border-top-left-radius: 7px;
  border-top-right-radius: 7px;
  border-bottom-width: 0.3752px;
}
.timepicker-ui-am.mobile {
  border-bottom-left-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile) {
    border-top-left-radius: 7px;
    border-bottom-left-radius: 7px;
    border-top-right-radius: 0;
    border-top-width: 1.5008px;
    border-right-width: 0.3752px;
  }
}
.timepicker-ui-pm, .timepicker-ui-pm.mobile {
  border-bottom-left-radius: 7px;
  border-bottom-right-radius: 7px;
  border-top-width: 0.3752px;
  width: 54px;
}
.timepicker-ui-pm.mobile {
  border-top-right-radius: 0;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile) {
    border-bottom-right-radius: 7px;
    border-top-right-radius: 7px;
    border-bottom-left-radius: 0;
    border-bottom-width: 1.5008px;
    border-left-width: 0.3752px;
    width: 50%;
    height: 44px;
  }
}
.timepicker-ui-cancel-btn, .timepicker-ui-ok-btn, .timepicker-ui-cancel-btn.mobile, .timepicker-ui-ok.btn-mobile {
  color: #6200ee;
  text-transform: uppercase;
  border-radius: 7px;
  background-color: transparent;
  text-align: center;
  font-size: 15.2px;
  padding-top: 9px;
  padding-bottom: 9px;
  font-weight: 500;
  transition: all 0.3s ease;
  cursor: pointer;
}
.timepicker-ui-cancel-btn:hover, .timepicker-ui-ok-btn:hover, .timepicker-ui-cancel-btn.mobile:hover, .timepicker-ui-ok.btn-mobile:hover {
  background-color: #d6d6d6;
}
.timepicker-ui-cancel-btn, .timepicker-ui-cancel-btn.mobile {
  width: 72px;
  margin-right: 4px;
}
.timepicker-ui-ok-btn, .timepicker-ui-ok-btn.mobile {
  width: 64px;
  margin-left: 4px;
}
.timepicker-ui-wrapper-btn, .timepicker-ui-keyboard-icon, .timepicker-ui-wrapper-btn-mobile, .timepicker-ui-keyboard-icon-mobile {
  display: flex;
  justify-content: center;
  align-items: center;
}
.timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
  width: 44px;
  height: 44px;
  position: relative;
  bottom: -26px;
  left: 12px;
  transition: all 0.3s ease;
}
.timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #d6d6d6;
  border-radius: 7px;
}
.timepicker-ui-keyboard-icon-wrapper.mobile {
  bottom: -5px;
}
.timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon.mobile {
  padding: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  color: #4e545a;
  height: 44px;
  width: 44px;
}
.timepicker-ui-keyboard-icon:hover, .timepicker-ui-keyboard-icon.mobile:hover {
  color: #6200ee;
}
@media screen and (min-width: 320px) and (max-width: 825px) and (orientation: landscape) {
  .timepicker-ui-keyboard-icon-wrapper, .timepicker-ui-keyboard-icon-wrapper.mobile {
    position: absolute;
    bottom: 8px;
  }
}
.timepicker-ui-wrapper-btn, .timepicker-ui-wrapper-btn.mobile {
  margin-right: 8px;
  position: relative;
  bottom: -14px;
}
.timepicker-ui-hour-text, .timepicker-ui-minute-text, .timepicker-ui-hour-text.mobile, .timepicker-ui-minute-text.mobile {
  position: absolute;
  bottom: 6px;
  font-size: 12.8px;
  color: #a9a9a9;
  left: 0;
}
.timepicker-ui-minute-text, .timepicker-ui-minute-text.mobile {
  left: 120px;
}
.timepicker-ui-clock-hand {
  position: absolute;
  background-color: #6200ee;
  bottom: 50%;
  height: 40%;
  left: calc(50% - 1px);
  transform-origin: center bottom 0;
  width: 2px;
}
.timepicker-ui-clock-hand-24h {
  height: 23%;
}
.timepicker-ui-circle-hand {
  position: absolute;
  transform: translate(-48%, -50%);
  width: 4px;
  height: 4px;
  border-radius: 100%;
  transition: all 0.2s ease;
  height: 46px;
  width: 46px;
  box-sizing: border-box !important;
  background-color: #6200ee;
}
.timepicker-ui-circle-hand.small-circle {
  height: 36px;
  width: 36px;
  box-sizing: border-box !important;
}
.timepicker-ui-circle-hand-24h {
  transform: translate(-50%, -50%);
  height: 32px;
  width: 32px;
  top: 4px;
  left: 1px;
}
.timepicker-ui-value-tips, .timepicker-ui-value-tips-24h {
  width: 100%;
  height: 100%;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: 0.3s ease color;
  border-radius: 50%;
  outline: none;
}
.timepicker-ui-value-tips:focus, .timepicker-ui-value-tips-24h:focus {
  background: rgba(143, 143, 143, 0.315);
  box-shadow: 0px 3px 5px -1px rgba(0, 0, 0, 0.2), 0px 5px 8px 0px rgba(0, 0, 0, 0.14), 0px 1px 14px 0px rgba(0, 0, 0, 0.12);
}
.timepicker-ui-value-tips.active, .timepicker-ui-value-tips-24h.active {
  color: #fff;
  transition: none;
}
.timepicker-ui-clock-animation {
  animation: clockanimation 350ms linear;
}
.timepicker-ui-open-element.disabled {
  pointer-events: none;
  touch-action: none;
  user-select: none;
}
.timepicker-ui-tips-animation {
  transition: transform 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms, height 400ms cubic-bezier(0.4, 0, 0.2, 1) 0ms;
}
.timepicker-ui-tips-disabled {
  color: rgba(156, 155, 155, 0.6);
  pointer-events: none;
}

.opacity {
  transition: opacity 0.15s linear;
}
.opacity.show {
  opacity: 1;
}

.invalid-value {
  border-color: #d50000 !important;
  color: #d50000 !important;
}
.invalid-value:hover, .invalid-value:focus, .invalid-value:active {
  border-color: #d50000 !important;
  color: #d50000 !important;
}

@keyframes clockanimation {
  0% {
    opacity: 0;
    transform: scale(0.8);
  }
  to {
    opacity: 1;
    transform: scale(1);
  }
}
.timepicker-ui-invalid-format {
  border: 2px solid red;
  color: red;
}

.timepicker-ui-invalid-text {
  color: red;
}`);qx(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-wrapper.crane-straight, .timepicker-ui-wrapper.mobile.crane-straight {
  border-radius: 0;
  background-color: #4e0d3a;
  color: #fff;
}
.timepicker-ui-wrapper.crane-straight.radius, .timepicker-ui-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-select-time.crane-straight, .timepicker-ui-select-time.mobile.crane-straight {
  color: #e5e5e5;
}
.timepicker-ui-clock-face.crane-straight, .timepicker-ui-clock-face.mobile.crane-straight {
  background-color: #71135c;
}
.timepicker-ui-dot.crane-straight, .timepicker-ui-dot.mobile.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-hour.crane-straight, .timepicker-ui-minutes.crane-straight, .timepicker-ui-hour.mobile.crane-straight, .timepicker-ui-minutes.mobile.crane-straight {
  background-color: #71135c;
  border-radius: 0;
  color: #fff;
}
.timepicker-ui-hour.crane-straight.radius, .timepicker-ui-minutes.crane-straight.radius, .timepicker-ui-hour.mobile.crane-straight.radius, .timepicker-ui-minutes.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-hour.crane-straight:hover, .timepicker-ui-hour.crane-straight.active, .timepicker-ui-minutes.crane-straight:hover, .timepicker-ui-minutes.crane-straight.active, .timepicker-ui-hour.mobile.crane-straight:hover, .timepicker-ui-hour.mobile.crane-straight.active, .timepicker-ui-minutes.mobile.crane-straight:hover, .timepicker-ui-minutes.mobile.crane-straight.active {
  background-color: #f7363e;
}
.timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-hour.mobile.crane-straight[contenteditable=true]:active, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:focus, .timepicker-ui-minutes.mobile.crane-straight[contenteditable=true]:active {
  border-color: #fff;
  outline-color: #fff;
}
.timepicker-ui-dots.crane-straight, .timepicker-ui-dots.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-wrapper-type-time.crane-straight, .timepicker-ui-wrapper-type-time.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-am.crane-straight, .timepicker-ui-pm.crane-straight, .timepicker-ui-am.mobile.crane-straight, .timepicker-ui-pm.mobile.crane-straight {
  border: 0.125rem solid transparent;
  border-radius: 0;
  background-color: #71135c;
}
.timepicker-ui-am:hover.crane-straight, .timepicker-ui-am.active.crane-straight, .timepicker-ui-pm:hover.crane-straight, .timepicker-ui-pm.active.crane-straight, .timepicker-ui-am.mobile:hover.crane-straight, .timepicker-ui-am.mobile.active.crane-straight, .timepicker-ui-pm.mobile:hover.crane-straight, .timepicker-ui-pm.mobile.active.crane-straight {
  color: #fff;
  background-color: #f7363e;
}
.timepicker-ui-am.crane-straight.radius {
  border-top-left-radius: 1.25rem;
  border-top-right-radius: 1.25rem;
}
.timepicker-ui-pm.crane-straight.radius {
  border-bottom-left-radius: 1.25rem;
  border-bottom-right-radius: 1.25rem;
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-am:not(.timepicker-ui-am + .mobile).crane-straight.radius {
    border-bottom-left-radius: 1.25rem;
    border-top-right-radius: 0;
    border-bottom-right-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 826px) and (orientation: landscape) {
  .timepicker-ui-pm:not(.timepicker-ui-pm + .mobile).crane-straight.radius {
    border-bottom-right-radius: 1.25rem;
    border-top-right-radius: 1.25rem;
    border-bottom-left-radius: 0;
    border-top-left-radius: 0;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-am.mobile.crane-straight.radius {
    border-bottom-left-radius: 0rem;
    border-bottom-right-radius: 0rem;
  }
}
@media screen and (min-width: 320px) and (max-width: 767px) and (orientation: landscape) {
  .timepicker-ui-pm.mobile.crane-straight.radius {
    border-top-left-radius: 0rem;
    border-top-right-radius: 0rem;
  }
}
.timepicker-ui-cancel-btn.crane-straight, .timepicker-ui-ok-btn.crane-straight, .timepicker-ui-cancel-btn.mobile.crane-straight, .timepicker-ui-ok-btn.mobile.crane-straight {
  color: #fff;
  border-radius: 0rem;
}
.timepicker-ui-cancel-btn.crane-straight.radius, .timepicker-ui-ok-btn.crane-straight.radius, .timepicker-ui-cancel-btn.mobile.crane-straight.radius, .timepicker-ui-ok-btn.mobile.crane-straight.radius {
  border-radius: 0.8125rem;
}
.timepicker-ui-cancel-btn:hover.crane-straight, .timepicker-ui-ok-btn:hover.crane-straight, .timepicker-ui-cancel-btn.mobile:hover.crane-straight, .timepicker-ui-ok-btn.mobile:hover.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight {
  color: #fff;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight:hover .timepicker-ui-keyboard-icon.mobile {
  background-color: #f7363e;
  color: #fff;
  border-radius: 0;
}
.timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon, .timepicker-ui-keyboard-icon-wrapper.mobile.crane-straight.radius:hover .timepicker-ui-keyboard-icon.mobile {
  border-radius: 0.875rem;
}
.timepicker-ui-keyboard-icon.crane-straight:hover, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover {
  color: #fff;
}
.timepicker-ui-keyboard-icon.crane-straight:hover.radius, .timepicker-ui-keyboard-icon.mobile.crane-straight:hover.radius {
  border-radius: 1.25rem;
}
.timepicker-ui-clock-hand.crane-straight {
  background-color: #f7363e;
}
.timepicker-ui-circle-hand.crane-straight {
  border-color: #f7363e;
  background-color: #f7363e;
}
.timepicker-ui-value-tips.crane-straight {
  color: #fff;
}`);qx(`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}

.timepicker-ui-hour-time-12.m3, .timepicker-ui-hour-time-24.m3 {
  color: #1a1c18;
}
.timepicker-ui-wrapper.m3 {
  border-radius: 35px;
  background-color: #e5eadc;
  box-shadow: unset;
}
.timepicker-ui-hour.active.m3, .timepicker-ui-minutes.active.m3 {
  background-color: #b8f397;
  color: #042100;
}
.timepicker-ui-minutes.m3, .timepicker-ui-hour.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-minutes:hover.m3, .timepicker-ui-hour:hover.m3 {
  color: #386a20;
}
.timepicker-ui-clock-face.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-clock-hand.m3, .timepicker-ui-dot.m3, .timepicker-ui-circle-hand.m3 {
  background-color: #386a20 !important;
}
.timepicker-ui-cancel-btn.m3, .timepicker-ui-ok-btn.m3 {
  color: #386a20;
}
.timepicker-ui-cancel-btn:hover.m3, .timepicker-ui-ok-btn:hover.m3 {
  background-color: #dfe4d6;
}
.timepicker-ui-wrapper-type-time.m3 {
  color: #6b7165;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3, .timepicker-ui-pm.m3, .timepicker-ui-pm.m3 {
  border-color: #74796e;
  border-width: 1px;
}
.timepicker-ui-am.m3, .timepicker-ui-am.m3 {
  border-bottom-width: 0px;
}
.timepicker-ui-am:hover.m3, .timepicker-ui-am.active.m3, .timepicker-ui-pm:hover.m3, .timepicker-ui-pm.active.m3 {
  background-color: #bbebeb;
  color: #002021;
}
.timepicker-ui-hour.mobile:hover.m3, .timepicker-ui-minutes.mobile:hover.m3 {
  background-color: #dfe4d6;
}`);var VS=`:export {
  cranepurple800: #5c1349;
  cranepurple900: #4e0d3a;
  cranepurple700: #71135c;
  cranered400: #f7363e;
  white: #fff;
  purple: #6200ee;
  opacity: opacity 0.15s linear;
}`;qx(VS);const h4e={amLabel:"AM",animation:!0,appendModalSelector:"",backdrop:!0,cancelLabel:"CANCEL",editable:!1,enableScrollbar:!1,enableSwitchIcon:!1,mobileTimeLabel:"Enter Time",focusInputAfterCloseModal:!1,hourMobileLabel:"Hour",iconTemplate:'<i class="material-icons timepicker-ui-keyboard-icon">keyboard</i>',iconTemplateMobile:'<i class="material-icons timepicker-ui-keyboard-icon">schedule</i>',incrementHours:1,incrementMinutes:1,minuteMobileLabel:"Minute",mobile:!1,okLabel:"OK",pmLabel:"PM",timeLabel:"Select Time",switchToMinutesAfterSelectHour:!1,theme:"basic",clockType:"12h",disabledTime:void 0,currentTime:void 0,focusTrap:!0,delayHandler:300},eF="mousedown mouseup mousemove mouseleave mouseover touchstart touchmove touchend",E9=["00","13","14","15","16","17","18","19","20","21","22","23"],zb=["12","1","2","3","4","5","6","7","8","9","10","11"],Bg=["00","05","10","15","20","25","30","35","40","45","50","55"];class gh{constructor(e){this.clean=()=>{var i,n;const r=(i=this.tipsWrapper)===null||i===void 0?void 0:i.querySelectorAll("span.timepicker-ui-hour-time-12"),o=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-minutes-time");this._removeClasses(r),this._removeClasses(o)},this.create=()=>{var i;if(!(this.clockFace&&this.array&&this.classToAdd&&this.tipsWrapper))return;const n=(this.clockFace.offsetWidth-32)/2,r=(this.clockFace.offsetHeight-32)/2,o=n-9;this.tipsWrapper.innerHTML="",(i=this.array)===null||i===void 0||i.forEach((a,s)=>{var l,c,u,d,p,h;const f=s*(360/this.array.length)*(Math.PI/180),m=document.createElement("span"),g=document.createElement("span");g.innerHTML=a,this.disabledTime&&(Array.isArray(this.disabledTime)&&(!((l=this.disabledTime)===null||l===void 0)&&l.includes(a))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled")),this.hour===this.disabledTime.removedStartedHour&&(!((u=(c=this.disabledTime)===null||c===void 0?void 0:c.startMinutes)===null||u===void 0)&&u.includes(a))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1),this.hour===this.disabledTime.removedEndHour&&(!((p=(d=this.disabledTime)===null||d===void 0?void 0:d.endMinutes)===null||p===void 0)&&p.includes(a))&&(g.classList.add("timepicker-ui-tips-disabled"),m.classList.add("timepicker-ui-tips-disabled"),g.tabIndex=-1)),this.clockType==="24h"?(g.classList.add("timepicker-ui-value-tips-24h"),Wi(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)):(g.classList.add("timepicker-ui-value-tips"),Wi(g,"timepicker-ui-tips-disabled")||(g.tabIndex=0)),m.classList.add(this.classToAdd),this.theme==="crane-straight"&&(m.classList.add("crane-straight"),g.classList.add("crane-straight")),this.theme==="m3"&&(m.classList.add("m3"),g.classList.add("m3")),m.style.left=n+Math.sin(f)*o-m.offsetWidth+"px",m.style.bottom=r+Math.cos(f)*o-m.offsetHeight+"px",m.appendChild(g),(h=this.tipsWrapper)===null||h===void 0||h.appendChild(m)})},this.updateDisable=i=>{var n,r;const o=(n=this.tipsWrapper)===null||n===void 0?void 0:n.querySelectorAll("span.timepicker-ui-hour-time-12"),a=(r=this.tipsWrapper)===null||r===void 0?void 0:r.querySelectorAll("span.timepicker-ui-minutes-time");if(this._removeClasses(o),this._removeClasses(a),i!=null&&i.hoursToUpdate&&o&&this._addClassesWithIncludes(o,i.hoursToUpdate),(i==null?void 0:i.minutesToUpdate)&&a){const{actualHour:s,removedEndHour:l,removedStartedHour:c,startMinutes:u,endMinutes:d}=i.minutesToUpdate;l===s&&d.length>0?this._addClassesWithIncludes(a,d):Number(s)>Number(c)&&Number(s)<Number(l)&&this._addClasses(a),c===s&&u.length>0?this._addClassesWithIncludes(a,u):Number(s)>Number(c)&&Number(s)<Number(l)&&this._addClasses(a)}if(i){const{amHours:s,pmHours:l,activeMode:c,startMinutes:u,endMinutes:d,removedAmHour:p,removedPmHour:h,actualHour:f}=i.minutesToUpdate;if(!s||!l)return;o&&(s&&c==="AM"&&this._addClassesWithIncludes(o,s),l&&c==="PM"&&this._addClassesWithIncludes(o,l)),a&&u&&d&&(c==="AM"&&(d[0]==="00"&&d.length===1&&u.length===0&&Number(f)>=Number(s[0])&&this._addClasses(a),u.length===0&&d.length>1&&Number(f)>=Number(p)&&this._addClasses(a),u.length>0&&d.length>1&&d[0]==="00"&&(Number(p)===Number(f)?this._addClassesWithIncludes(a,u):Number(f)>Number(p)&&this._addClasses(a)),d[0]==="00"&&d.length===1&&u.length>0&&(Number(p)===Number(f)?this._addClassesWithIncludes(a,u):Number(f)>Number(p)&&this._addClasses(a))),c==="PM"&&(f<Number(h)&&this._addClasses(a),f===h&&this._addClassesWithIncludes(a,d),d.length>0&&Number(f)===h-1&&this._addClassesWithIncludes(a,d)))}},this._removeClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.remove("timepicker-ui-tips-disabled"),r[0].classList.remove("timepicker-ui-tips-disabled"),r[0].tabIndex=0})},this._addClasses=i=>{i==null||i.forEach(({classList:n,children:r})=>{n.add("timepicker-ui-tips-disabled"),r[0].classList.add("timepicker-ui-tips-disabled"),r[0].tabIndex=-1})},this._addClassesWithIncludes=(i,n)=>{i==null||i.forEach(({classList:r,children:o,textContent:a})=>{n!=null&&n.includes(a)&&(r.add("timepicker-ui-tips-disabled"),o[0].classList.add("timepicker-ui-tips-disabled"),o[0].tabIndex=-1)})},this.array=e==null?void 0:e.array,this.classToAdd=e==null?void 0:e.classToAdd,this.clockFace=e==null?void 0:e.clockFace,this.tipsWrapper=e==null?void 0:e.tipsWrapper,this.theme=e==null?void 0:e.theme,this.clockType=e==null?void 0:e.clockType,this.disabledTime=e==null?void 0:e.disabledTime,this.hour=e==null?void 0:e.hour}}const M9=(t,e)=>{let i;return(...n)=>{clearTimeout(i),i=setTimeout(()=>{t(...n)},e)}};class f4e{constructor(e,i){var n,r,o;this.create=()=>{this._updateInputValueWithCurrentTimeOnStart(),this._checkDisabledValuesOnStart(),this._setTimepickerClassToElement(),this._setInputClassToInputElement(),this._setDataOpenToInputIfDosentExistInWrapper(),this._setClassTopOpenElement(),this._handleOpenOnEnterFocus(),this._handleOpenOnClick(),this._getDisableTime()},this.open=a=>{this.create(),this._eventsBundle(),eE(a)},this.close=()=>M9((...a)=>{var s;if(a.length>2||!this.modalElement)return;const[l]=a.filter(u=>typeof u=="boolean"),[c]=a.filter(u=>typeof u=="function");l&&(this._handleOkButton(),(s=this.okButton)===null||s===void 0||s.click()),this._isTouchMouseMove=!1,eF.split(" ").map(u=>document.removeEventListener(u,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),document.removeEventListener("keypress",this._handleEscClick),this.wrapper.removeEventListener("keydown",this._focusTrapHandler),this._options.enableSwitchIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._removeAnimationToClose(),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400),this.openElement.forEach(u=>u==null?void 0:u.classList.remove("disabled")),setTimeout(()=>{var u;this._options.focusInputAfterCloseModal&&((u=this.input)===null||u===void 0||u.focus()),this.modalElement!==null&&(this.modalElement.remove(),this._isModalRemove=!0)},300),eE(c)},this._options.delayHandler||300),this.destroy=a=>{eF.split(" ").map(s=>document.removeEventListener(s,this._mutliEventsMoveHandler,!1)),document.removeEventListener("mousedown",this._eventsClickMobileHandler),document.removeEventListener("touchstart",this._eventsClickMobileHandler),this._options.enableSwitchIcon&&this.keyboardClockIcon&&(this.keyboardClockIcon.removeEventListener("touchstart",this._handlerViewChange()),this.keyboardClockIcon.removeEventListener("mousedown",this._handlerViewChange())),this._cloned=this._element.cloneNode(!0),this._element.after(this._cloned),this._element.remove(),this._element=null,this._element===null&&eE(a),this._element=this._cloned},this.update=(a,s)=>{this._options=Object.assign(Object.assign({},this._options),a.options),this._checkMobileOption(),a.create&&this.create(),eE(s)},this._preventClockTypeByCurrentTime=()=>{var a,s,l,c,u;if(typeof((a=this._options)===null||a===void 0?void 0:a.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.preventClockType)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{currentTime:d,clockType:p}=this._options,{type:h}=uc(this.input,p,d,!0);this._options.clockType=h?"12h":"24h"}},this._updateInputValueWithCurrentTimeOnStart=()=>{var a,s,l,c,u;if(typeof((a=this._options)===null||a===void 0?void 0:a.currentTime)!="boolean"&&(!((l=(s=this._options)===null||s===void 0?void 0:s.currentTime)===null||l===void 0)&&l.updateInput)||typeof((c=this._options)===null||c===void 0?void 0:c.currentTime)=="boolean"&&(!((u=this._options)===null||u===void 0)&&u.currentTime)){const{hour:d,minutes:p,type:h}=uc(this.input,this._options.clockType,this._options.currentTime);this.input.value=h?`${d}:${p} ${h}`:`${d}:${p}`}},this._setTheme=()=>{var a,s;const l=(a=this.modalElement)===null||a===void 0?void 0:a.querySelectorAll("div"),c=[...(s=this.modalElement)===null||s===void 0?void 0:s.querySelectorAll("input"),...l],{theme:u}=this._options;u==="crane-straight"?c.forEach(d=>d.classList.add("crane-straight")):u==="crane-radius"?c.forEach(d=>d.classList.add("crane-straight","radius")):u==="m3"&&c.forEach(d=>d.classList.add("m3"))},this._setInputClassToInputElement=()=>{var a;Wi(this.input,"timepicker-ui-input")||(a=this.input)===null||a===void 0||a.classList.add("timepicker-ui-input")},this._setDataOpenToInputIfDosentExistInWrapper=()=>{var a;this.openElementData===null&&((a=this.input)===null||a===void 0||a.setAttribute("data-open","timepicker-ui-input"))},this._setClassTopOpenElement=()=>{this.openElement.forEach(a=>a==null?void 0:a.classList.add("timepicker-ui-open-element"))},this._removeBackdrop=()=>{var a;this._options.backdrop||((a=this.modalElement)===null||a===void 0||a.classList.add("removed"),this.openElement.forEach(s=>s==null?void 0:s.classList.add("disabled")))},this._setNormalizeClass=()=>{var a,s;const l=(a=this.modalElement)===null||a===void 0?void 0:a.querySelectorAll("div");(s=this.modalElement)===null||s===void 0||s.classList.add("timepicker-ui-normalize"),l==null||l.forEach(c=>c.classList.add("timepicker-ui-normalize"))},this._setFlexEndToFooterIfNoKeyboardIcon=()=>{!this._options.enableSwitchIcon&&this.footer&&(this.footer.style.justifyContent="flex-end")},this._eventsBundle=()=>{var a,s,l,c,u,d,p,h,f,m,g,v,y;if(this._isModalRemove){if(this._handleEscClick(),this._setErrorHandler(),this._removeErrorHandler(),this.openElement.forEach(b=>b==null?void 0:b.classList.add("disabled")),(a=this.input)===null||a===void 0||a.blur(),this._setScrollbarOrNot(),this._setModalTemplate(),this._setNormalizeClass(),this._removeBackdrop(),this._setBgColorToCirleWithHourTips(),this._setOnStartCSSClassesIfClockType24h(),this._setClassActiveToHourOnOpen(),this.clockFace!==null){const b=new gh({array:zb,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,clockType:"12h",hour:this.hour.value});b.create(),this._options.clockType==="24h"?new gh({array:E9,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:!((h=(p=this._disabledTime)===null||p===void 0?void 0:p.value)===null||h===void 0)&&h.isInterval?(f=this._disabledTime)===null||f===void 0?void 0:f.value.rangeArrHour:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.hours,hour:this.hour.value}).create():(((v=this._disabledTime)===null||v===void 0?void 0:v.value.startType)===((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)?setTimeout(()=>{var I,T,S,w,U,D,E,C;((I=this._disabledTime)===null||I===void 0?void 0:I.value.startType)===((T=this.activeTypeMode)===null||T===void 0?void 0:T.textContent)&&b.updateDisable({hoursToUpdate:(w=(S=this._disabledTime)===null||S===void 0?void 0:S.value)===null||w===void 0?void 0:w.rangeArrHour,minutesToUpdate:{endMinutes:(U=this._disabledTime)===null||U===void 0?void 0:U.value.endMinutes,removedEndHour:(D=this._disabledTime)===null||D===void 0?void 0:D.value.removedEndHour,removedStartedHour:(E=this._disabledTime)===null||E===void 0?void 0:E.value.removedStartedHour,actualHour:this.hour.value,startMinutes:(C=this._disabledTime)===null||C===void 0?void 0:C.value.startMinutes}})},300):setTimeout(()=>{var I,T,S;b.updateDisable({minutesToUpdate:{actualHour:this.hour.value,pmHours:(I=this._disabledTime)===null||I===void 0?void 0:I.value.pmHours,amHours:(T=this._disabledTime)===null||T===void 0?void 0:T.value.amHours,activeMode:(S=this.activeTypeMode)===null||S===void 0?void 0:S.textContent}})},300),b.updateDisable())}this._setFlexEndToFooterIfNoKeyboardIcon(),setTimeout(()=>{this._setTheme()},0),this._setAnimationToOpen(),this._getInputValueOnOpenAndSet(),this._toggleClassActiveToValueTips(this.hour.value),this._isMobileView||(this._setTransformToCircleWithSwitchesHour(this.hour.value),this._handleAnimationClock()),this._handleMinutesEvents(),this._handleHourEvents(),this._options.clockType!=="24h"&&(this._handleAmClick(),this._handlePmClick()),this.clockFace&&this._handleMoveHand(),this._handleCancelButton(),this._handleOkButton(),this.modalElement&&(this._setShowClassToBackdrop(),this._handleBackdropClick()),this._handleIconChangeView(),this._handleClickOnHourMobile(),this._options.focusTrap&&this._focusTrapHandler()}},this._handleOpenOnClick=()=>{this.openElement.forEach(a=>this._clickTouchEvents.forEach(s=>a==null?void 0:a.addEventListener(s,()=>this._eventsBundle())))},this._getInputValueOnOpenAndSet=()=>{var a,s;const l=uc(this.input,this._options.clockType,this._options.currentTime);if(l===void 0)return this.hour.value="12",this.minutes.value="00",tu(this._element,"show",{hour:this.hour.value,minutes:this.minutes.value,type:(a=this.activeTypeMode)===null||a===void 0?void 0:a.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),void(this._options.clockType!=="24h"&&this.AM.classList.add("active"));let[c,u,d]=this.input.value.split(":").join(" ").split(" ");this.input.value.length===0&&(c=l.hour,u=l.minutes,d=l.type),this.hour.value=c,this.minutes.value=u;const p=document.querySelector(`[data-type='${d}']`);this._options.clockType!=="24h"&&p&&p.classList.add("active"),tu(this._element,"show",Object.assign(Object.assign({},l),{type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}))},this._handleCancelButton=()=>{this._clickTouchEvents.forEach(a=>{this.cancelButton.addEventListener(a,()=>{var s;const l=uc(this.input,this._options.clockType);tu(this._element,"cancel",Object.assign(Object.assign({},l),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(s=this.activeTypeMode)===null||s===void 0?void 0:s.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})})},this._handleOkButton=()=>{this._clickTouchEvents.forEach(a=>{var s;(s=this.okButton)===null||s===void 0||s.addEventListener(a,()=>{var l,c,u;const{clockType:d,disabledTime:p}=this._options,h=om(this.hour.value,"hour",d),f=om(this.minutes.value,"minutes",d);let m;const g=tE(this.hour.value,"hour",d,p==null?void 0:p.hours),v=tE(this.minutes.value,"minutes",d,p==null?void 0:p.minutes);if(p!=null&&p.interval&&(m=((y,b,I,T)=>{const S=I?QL(`${y}:${b} ${I}`.trim()):`${y}:${b}`.trim();let w,U;if(I){const[D,E]=T.trim().split("-").map(C=>C.trim());w=QL(D),U=QL(E)}else{const[D,E]=T.trim().split("-"),C=M=>M.trim().split(":").map(N=>Number(N)<=9?`0${Number(N)}`:N).join(":");w=C(D),U=C(E)}return S<w||S>U})(this.hour.value,this.minutes.value,(l=this.activeTypeMode)===null||l===void 0?void 0:l.textContent,p.interval)),m===!1||h===!1||f===!1||g===!1||v===!1)return m!==!1&&f&&v||this.minutes.classList.add("invalid-value"),void(m!==!1&&h&&g||this.hour.classList.add("invalid-value"));this.input.value=`${this.hour.value}:${this.minutes.value} ${this._options.clockType==="24h"?"":(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type}`.trimEnd(),tu(this._element,"accept",{hour:this.hour.value,minutes:this.minutes.value,type:(u=this.activeTypeMode)===null||u===void 0?void 0:u.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.close()()})})},this._setShowClassToBackdrop=()=>{this._options.backdrop&&setTimeout(()=>{this.modalElement.classList.add("show")},300)},this._handleBackdropClick=()=>{var a;(a=this.modalElement)===null||a===void 0||a.addEventListener("click",s=>{var l;const c=s.target;if(!Wi(c,"timepicker-ui-modal"))return;const u=uc(this.input,this._options.clockType);tu(this._element,"cancel",Object.assign(Object.assign({},u),{hourNotAccepted:this.hour.value,minutesNotAccepted:this.minutes.value,type:(l=this.activeTypeMode)===null||l===void 0?void 0:l.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})),this.close()()})},this._setBgColorToCirleWithHourTips=()=>{if(!this._options)return;const{mobile:a,theme:s}=this._options;a||this.circle===null||(this.circle.style.backgroundColor=s==="crane-straight"||s==="crane-radius"?VS.cranered400:VS.purple)},this._setBgColorToCircleWithMinutesTips=()=>{const{theme:a}=this._options;this.minutes.value&&Bg.includes(this.minutes.value)&&(this.circle.style.backgroundColor=a==="crane-straight"||a==="crane-radius"?VS.cranered400:VS.purple,this.circle.classList.remove("small-circle"))},this._removeBgColorToCirleWithMinutesTips=()=>{this.minutes.value&&Bg.includes(this.minutes.value)||(this.circle.style.backgroundColor="",this.circle.classList.add("small-circle"))},this._setTimepickerClassToElement=()=>{var a;(a=this._element)===null||a===void 0||a.classList.add("timepicker-ui")},this._setClassActiveToHourOnOpen=()=>{var a;this._options.mobile||this._isMobileView||(a=this.hour)===null||a===void 0||a.classList.add("active")},this._setMinutesToClock=a=>{var s,l,c,u,d;this.clockFace!==null&&this._setTransformToCircleWithSwitchesMinutes(a),this._removeBgColorToCirleWithMinutesTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.minutes?(u=(c=this._disabledTime)===null||c===void 0?void 0:c.value)===null||u===void 0?void 0:u.minutes:(d=this._disabledTime)===null||d===void 0?void 0:d.value,h=new gh({array:Bg,classToAdd:"timepicker-ui-minutes-time",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,hour:this.hour.value,clockType:this._options.clockType});h.create(),this._options.clockType==="12h"&&h.updateDisable(),this._toggleClassActiveToValueTips(a),this._options.clockType==="24h"&&(this.tipsWrapperFor24h.innerHTML="")},this._setHoursToClock=a=>{var s,l,c,u,d;if(this.clockFace!==null){this._setTransformToCircleWithSwitchesHour(a),this._setBgColorToCirleWithHourTips();const p=!((l=(s=this._disabledTime)===null||s===void 0?void 0:s.value)===null||l===void 0)&&l.isInterval?(c=this._disabledTime)===null||c===void 0?void 0:c.value.rangeArrHour:(d=(u=this._disabledTime)===null||u===void 0?void 0:u.value)===null||d===void 0?void 0:d.hours,h=new gh({array:zb,classToAdd:"timepicker-ui-hour-time-12",clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,theme:this._options.theme,disabledTime:p,clockType:"12h",hour:this.hour.value});h.create(),this._options.clockType==="24h"?new gh({array:E9,classToAdd:"timepicker-ui-hour-time-24",clockFace:this.tipsWrapperFor24h,tipsWrapper:this.tipsWrapperFor24h,theme:this._options.theme,clockType:"24h",disabledTime:p,hour:this.hour.value}).create():h.updateDisable(),this._toggleClassActiveToValueTips(a)}},this._setTransformToCircleWithSwitchesHour=a=>{const s=Number(a);let l=s>12?30*s-360:30*s;l===360&&(l=0),l>360||(this.clockHand.style.transform=`rotateZ(${l}deg)`)},this._setTransformToCircleWithSwitchesMinutes=a=>{const s=6*Number(a);s>360||(this.clockHand.style.transform=`rotateZ(${s}deg)`)},this._handleAmClick=()=>{this._clickTouchEvents.forEach(a=>{this.AM.addEventListener(a,s=>{var l,c,u,d;if(s.target.classList.add("active"),this.PM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new gh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Wi(this.hour,"active")?zb:Bg});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300),p.updateDisable()}tu(this._element,"selectamtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handlePmClick=()=>{this._clickTouchEvents.forEach(a=>{this.PM.addEventListener(a,s=>{var l,c,u,d;if(s.target.classList.add("active"),this.AM.classList.remove("active"),this._options.clockType==="12h"&&((l=this._options.disabledTime)===null||l===void 0?void 0:l.interval)){const p=new gh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Wi(this.hour,"active")?zb:Bg});((c=this._disabledTime)===null||c===void 0?void 0:c.value.startType)===((u=this._disabledTime)===null||u===void 0?void 0:u.value.endType)?setTimeout(()=>{var h,f,m,g;((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this.activeTypeMode)===null||f===void 0?void 0:f.textContent)?p.updateDisable(Object.assign({hoursToUpdate:(g=(m=this._disabledTime)===null||m===void 0?void 0:m.value)===null||g===void 0?void 0:g.rangeArrHour},this._getDestructuringObj())):p.clean()},300):setTimeout(()=>{p.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}tu(this._element,"selectpmtypemode",{hour:this.hour.value,minutes:this.minutes.value,type:(d=this.activeTypeMode)===null||d===void 0?void 0:d.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})})},this._handleAnimationClock=()=>{this._options.animation&&setTimeout(()=>{var a;(a=this.clockFace)===null||a===void 0||a.classList.add("timepicker-ui-clock-animation"),setTimeout(()=>{var s;(s=this.clockFace)===null||s===void 0||s.classList.remove("timepicker-ui-clock-animation")},600)},150)},this._handleAnimationSwitchTipsMode=()=>{this.clockHand.classList.add("timepicker-ui-tips-animation"),setTimeout(()=>{var a;(a=this.clockHand)===null||a===void 0||a.classList.remove("timepicker-ui-tips-animation")},401)},this._handleClasses24h=(a,s)=>{var l;const c=a.target;this.hourTips&&this._options.clockType==="24h"&&(Number(c.textContent)>12||Number(c.textContent)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(l=this.tipsWrapperFor24h)===null||l===void 0||l.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),c&&s&&(s.value=c.value.replace(/\D+/g,""),s.click())},this._handleHourEvents=()=>{var a,s;this._inputEvents.forEach(l=>{var c;(c=this.hour)===null||c===void 0||c.addEventListener(l,u=>{var d,p,h,f,m;const g=u.target;if(this.clockFace!==null&&this._handleAnimationSwitchTipsMode(),this._options.clockType==="24h"&&(Number(g.value)>12||Number(g.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h(),this._options.mobile||(d=this.tipsWrapperFor24h)===null||d===void 0||d.classList.remove("timepicker-ui-tips-wrapper-24h-disabled")),this._setHoursToClock(g.value),g.classList.add("active"),this.minutes.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new gh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Wi(this.hour,"active")?zb:Bg});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,b,I,T;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}tu(this._element,"selecthourmode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes}),this.clockFace!==null&&this.circle.classList.remove("small-circle")})}),(a=this.hour)===null||a===void 0||a.addEventListener("blur",l=>this._handleClasses24h(l,this.hour)),(s=this.hour)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.hour))},this._handleMinutesEvents=()=>{var a,s;this._inputEvents.forEach(l=>{this.minutes.addEventListener(l,c=>{var u,d,p,h,f,m;const g=c.target;if(this.clockFace!==null&&(this._handleAnimationSwitchTipsMode(),this._setMinutesToClock(g.value)),this._options.clockType==="24h"&&(this._removeCircleClockClasses24h(),this._options.mobile||(u=this.tipsWrapperFor24h)===null||u===void 0||u.classList.add("timepicker-ui-tips-wrapper-24h-disabled")),g.classList.add("active"),(d=this.hour)===null||d===void 0||d.classList.remove("active"),this._options.clockType==="12h"&&((p=this._options.disabledTime)===null||p===void 0?void 0:p.interval)){const v=new gh({clockFace:this.clockFace,tipsWrapper:this.tipsWrapper,array:Wi(this.hour,"active")?zb:Bg});((h=this._disabledTime)===null||h===void 0?void 0:h.value.startType)===((f=this._disabledTime)===null||f===void 0?void 0:f.value.endType)?setTimeout(()=>{var y,b,I;((y=this._disabledTime)===null||y===void 0?void 0:y.value.startType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)?v.updateDisable(Object.assign({hoursToUpdate:(I=this._disabledTime)===null||I===void 0?void 0:I.value.rangeArrHour},this._getDestructuringObj())):v.clean()},300):setTimeout(()=>{v.updateDisable(Object.assign({},this._getDestructuringObj(!0)))},300)}tu(this._element,"selectminutemode",{hour:this.hour.value,minutes:this.minutes.value,type:(m=this.activeTypeMode)===null||m===void 0?void 0:m.dataset.type,degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes})})}),(a=this.minutes)===null||a===void 0||a.addEventListener("blur",l=>this._handleClasses24h(l,this.minutes)),(s=this.minutes)===null||s===void 0||s.addEventListener("focus",l=>this._handleClasses24h(l,this.minutes))},this._handleEventToMoveHand=a=>{var s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,S,w,U,D,E,C,M,N,R,A,_,k,O,F,B,$,V,H,z,G,W,K,Z,Y,X,Q,te,J,ie,oe,ne,re,me,he,be,Se,De,Oe,xe,$e,Ae,ve,ke,ye,Ie,Ne,Fe;const{target:Le,type:ge,touches:Ee}=a,we=Le,{incrementMinutes:fe,incrementHours:Te,switchToMinutesAfterSelectHour:ue}=this._options;if(!C9(a,this.clockFace))return;const de=C9(a,this.clockFace),_e=this.clockFace.offsetWidth/2,Ue=de&&Math.atan2(de.y-_e,de.x-_e);if(ge==="mouseup"||ge==="touchend")return this._isTouchMouseMove=!1,void(ue&&(Wi(we,"timepicker-ui-value-tips")||Wi(we,"timepicker-ui-value-tips-24h")||Wi(we,"timepicker-ui-tips-wrapper"))&&this.minutes.click());if(ge!=="mousedown"&&ge!=="mousemove"&&ge!=="touchmove"&&ge!=="touchstart"||ge!=="mousedown"&&ge!=="touchstart"&&ge!=="touchmove"||((Wi(we,"timepicker-ui-clock-face")||Wi(we,"timepicker-ui-circle-hand")||Wi(we,"timepicker-ui-hour-time-12")||Wi(we,"timepicker-ui-minutes-time")||Wi(we,"timepicker-ui-clock-hand")||Wi(we,"timepicker-ui-value-tips")||Wi(we,"timepicker-ui-value-tips-24h")||Wi(we,"timepicker-ui-tips-wrapper")||Wi(we,"timepicker-ui-tips-wrapper-24h"))&&!Wi(we,"timepicker-ui-tips-disabled")?(a.preventDefault(),this._isTouchMouseMove=!0):this._isTouchMouseMove=!1),!this._isTouchMouseMove)return;if(this.minutesTips!==null){this.minutes.classList.add("active");let He,Be=Ue&&XL(Math.trunc(180*Ue/Math.PI)+90,fe,6);if(Be===void 0)return;if(Be<0?(He=Math.round(360+Be/6)%60,Be=360+6*Math.round(Be/6)):(He=Math.round(Be/6)%60,Be=6*Math.round(Be/6)),(s=this._disabledTime)===null||s===void 0?void 0:s.value.isInterval){if(((d=this._disabledTime)===null||d===void 0?void 0:d.value.endType)===((p=this._disabledTime)===null||p===void 0?void 0:p.value.startType)){if(!((m=(f=(h=this._disabledTime)===null||h===void 0?void 0:h.value)===null||f===void 0?void 0:f.endMinutes)===null||m===void 0)&&m.includes(He<=9?`0${He}`:`${He}`)&&this.hour.value===((v=(g=this._disabledTime)===null||g===void 0?void 0:g.value)===null||v===void 0?void 0:v.removedEndHour)&&((y=this._disabledTime)===null||y===void 0?void 0:y.value.endType)===((b=this.activeTypeMode)===null||b===void 0?void 0:b.textContent)||!((S=(T=(I=this._disabledTime)===null||I===void 0?void 0:I.value)===null||T===void 0?void 0:T.startMinutes)===null||S===void 0)&&S.includes(He<=9?`0${He}`:`${He}`)&&this.hour.value===((U=(w=this._disabledTime)===null||w===void 0?void 0:w.value)===null||U===void 0?void 0:U.removedStartedHour)&&((D=this._disabledTime)===null||D===void 0?void 0:D.value.startType)===((E=this.activeTypeMode)===null||E===void 0?void 0:E.textContent))return}else if(((C=this.activeTypeMode)===null||C===void 0?void 0:C.textContent)===((M=this._disabledTime)===null||M===void 0?void 0:M.value.endType)&&(!((A=(R=(N=this._disabledTime)===null||N===void 0?void 0:N.value)===null||R===void 0?void 0:R.endMinutes)===null||A===void 0)&&A.includes(He<=9?`0${He}`:`${He}`)&&((_=this._disabledTime)===null||_===void 0?void 0:_.value.removedPmHour)===this.hour.value||!((k=this._disabledTime)===null||k===void 0)&&k.value.pmHours.map(Number).includes(Number(this.hour.value)))||((O=this.activeTypeMode)===null||O===void 0?void 0:O.textContent)===((F=this._disabledTime)===null||F===void 0?void 0:F.value.startType)&&(!((V=($=(B=this._disabledTime)===null||B===void 0?void 0:B.value)===null||$===void 0?void 0:$.startMinutes)===null||V===void 0)&&V.includes(He<=9?`0${He}`:`${He}`)&&((H=this._disabledTime)===null||H===void 0?void 0:H.value.removedAmHour)===this.hour.value||!((z=this._disabledTime)===null||z===void 0)&&z.value.amHours.map(Number).includes(Number(this.hour.value))))return}else if(!((u=(c=(l=this._disabledTime)===null||l===void 0?void 0:l.value)===null||c===void 0?void 0:c.minutes)===null||u===void 0)&&u.includes(He<=9?`0${He}`:`${He}`))return;this.minutes.value=He>=10?`${He}`:`0${He}`,this.clockHand.style.transform=`rotateZ(${Be}deg)`,this._degreesMinutes=Be,this._toggleClassActiveToValueTips(this.minutes.value),this._removeBgColorToCirleWithMinutesTips(),this._setBgColorToCircleWithMinutesTips(),tu(this._element,"update",Object.assign(Object.assign({},uc(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:ge,type:(G=this.activeTypeMode)===null||G===void 0?void 0:G.dataset.type}))}const Ce=Ee?Ee[0]:void 0,We=Ee&&Ce?document.elementFromPoint(Ce.clientX,Ce.clientY):null;if(this.hourTips!==null){if((W=this.hour)===null||W===void 0||W.classList.add("active"),!Wi(We||we,"timepicker-ui-value-tips-24h")&&!Wi(We||we,"timepicker-ui-tips-disabled")&&(Wi(We||we,"timepicker-ui-value-tips")||Wi(We||we,"timepicker-ui-tips-wrapper"))){let He,Be=Ue&&XL(Math.trunc(180*Ue/Math.PI)+90,Te,30);if(this._degreesHours=Be,Be===void 0)return;Be<0?(He=Math.round(360+Be/30)%12,Be=360+Be):(He=Math.round(Be/30)%12,(He===0||He>12)&&(He=12));const et=!((K=this._disabledTime)===null||K===void 0)&&K.value.isInterval?"rangeArrHour":"hours";if(((Z=this._disabledTime)===null||Z===void 0?void 0:Z.value.endType)===((X=(Y=this._disabledTime)===null||Y===void 0?void 0:Y.value)===null||X===void 0?void 0:X.startType)){if(typeof((te=(Q=this._disabledTime)===null||Q===void 0?void 0:Q.value)===null||te===void 0?void 0:te.endType)=="string"){if(((ie=(J=this._disabledTime)===null||J===void 0?void 0:J.value)===null||ie===void 0?void 0:ie.endType)===((oe=this.activeTypeMode)===null||oe===void 0?void 0:oe.textContent)&&((re=(ne=this._disabledTime)===null||ne===void 0?void 0:ne.value)===null||re===void 0?void 0:re.startType)===((me=this.activeTypeMode)===null||me===void 0?void 0:me.textContent)&&(!((be=(he=this._disabledTime)===null||he===void 0?void 0:he.value[et])===null||be===void 0)&&be.includes(He.toString())))return}else if(!((De=(Se=this._disabledTime)===null||Se===void 0?void 0:Se.value[et])===null||De===void 0)&&De.includes(He.toString()))return}else if(((Oe=this._disabledTime)===null||Oe===void 0?void 0:Oe.value.startType)===((xe=this.activeTypeMode)===null||xe===void 0?void 0:xe.textContent)&&(!(($e=this._disabledTime)===null||$e===void 0)&&$e.value.amHours.includes(He.toString()))||((Ae=this._disabledTime)===null||Ae===void 0?void 0:Ae.value.endType)===((ve=this.activeTypeMode)===null||ve===void 0?void 0:ve.textContent)&&(!((ke=this._disabledTime)===null||ke===void 0)&&ke.value.pmHours.includes(He.toString())))return;this.clockHand.style.transform=`rotateZ(${Be}deg)`,this.hour.value=He>9?`${He}`:`0${He}`,this._removeCircleClockClasses24h(),this._toggleClassActiveToValueTips(He)}if((Wi(We||we,"timepicker-ui-value-tips-24h")||Wi(We||we,"timepicker-ui-tips-wrapper-24h"))&&!Wi(We||we,"timepicker-ui-tips-disabled")){let He,Be=Ue&&XL(Math.trunc(180*Ue/Math.PI)+90,Te,30);if(this._degreesHours=Be,Be===void 0)return;Be<0?(He=Math.round(360+Be/30)%24,Be=360+Be):(He=Math.round(Be/30)+12,He===12&&(He="00"));const et=!((ye=this._disabledTime)===null||ye===void 0)&&ye.value.isInterval?"rangeArrHour":"hours";if(!((Ne=(Ie=this._disabledTime)===null||Ie===void 0?void 0:Ie.value[et])===null||Ne===void 0)&&Ne.includes(He.toString()))return;this._setCircleClockClasses24h(),this.clockHand.style.transform=`rotateZ(${Be}deg)`,this.hour.value=`${He}`,this._toggleClassActiveToValueTips(He)}tu(this._element,"update",Object.assign(Object.assign({},uc(this.input,this._options.clockType)),{degreesHours:this._degreesHours,degreesMinutes:this._degreesMinutes,eventType:ge,type:(Fe=this.activeTypeMode)===null||Fe===void 0?void 0:Fe.dataset.type}))}},this._toggleClassActiveToValueTips=a=>{const s=this.allValueTips.find(l=>Number(l.innerText)===Number(a));this.allValueTips.map(l=>l.classList.remove("active")),s!==void 0&&s.classList.add("active")},this._handleMoveHand=()=>{this._options.mobile||this._isMobileView||eF.split(" ").forEach(a=>{a==="touchstart"||a==="touchmove"||a==="touchend"?document.addEventListener(a,this._mutliEventsMoveHandler,{passive:!1}):document.addEventListener(a,this._mutliEventsMoveHandler,!1)})},this._setModalTemplate=()=>{if(!this._options)return;const{appendModalSelector:a}=this._options;if(a!==""&&a){const s=document==null?void 0:document.querySelector(a);s==null||s.insertAdjacentHTML("beforeend",this.modalTemplate)}else document.body.insertAdjacentHTML("afterend",this.modalTemplate)},this._setScrollbarOrNot=()=>{this._options.enableScrollbar?setTimeout(()=>{document.body.style.overflowY="",document.body.style.paddingRight=""},400):(document.body.style.paddingRight=`${(()=>{const a=document.createElement("div");a.className="timepicker-ui-measure",document.body.appendChild(a);const s=a.getBoundingClientRect().width-a.clientWidth;return document.body.removeChild(a),s})()}px`,document.body.style.overflowY="hidden")},this._setAnimationToOpen=()=>{var a,s;(a=this.modalElement)===null||a===void 0||a.classList.add("opacity"),this._options.animation?setTimeout(()=>{var l;(l=this.modalElement)===null||l===void 0||l.classList.add("show")},150):(s=this.modalElement)===null||s===void 0||s.classList.add("show")},this._removeAnimationToClose=()=>{var a;this.modalElement&&(this._options.animation?setTimeout(()=>{var s;(s=this.modalElement)===null||s===void 0||s.classList.remove("show")},150):(a=this.modalElement)===null||a===void 0||a.classList.remove("show"))},this._handlerViewChange=()=>M9(()=>{var a,s,l,c;const{clockType:u}=this._options;if(Wi(this.modalElement,"mobile")){const d=om(this.hour.value,"hour",u),p=om(this.minutes.value,"minutes",u);if(d===!1||p===!1)return p||this.minutes.classList.add("invalid-value"),void(d||(s=this.hour)===null||s===void 0||s.classList.add("invalid-value"));d===!0&&p===!0&&(p&&this.minutes.classList.remove("invalid-value"),d&&((l=this.hour)===null||l===void 0||l.classList.remove("invalid-value"))),this.close()(),this._isMobileView=!1,this._options.mobile=!1;const h=this.hour.value,f=this.minutes.value,m=(c=this.activeTypeMode)===null||c===void 0?void 0:c.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!1}}),setTimeout(()=>{if(this.open(),this.hour.value=h,this.minutes.value=f,this._options.clockType==="12h"){const g=m==="PM"?"AM":"PM";this[m==="PM"?"PM":"AM"].classList.add("active"),this[g].classList.remove("active")}this._setTransformToCircleWithSwitchesHour(this.hour.value),this._toggleClassActiveToValueTips(this.hour.value),Number(this.hour.value)>12||Number(this.hour.value)===0?this._setCircleClockClasses24h():this._removeCircleClockClasses24h()},300)},300)}else{this.close()(),this._isMobileView=!0,this._options.mobile=!0;const d=this.hour.value,p=this.minutes.value,h=(a=this.activeTypeMode)===null||a===void 0?void 0:a.dataset.type;setTimeout(()=>{this.destroy(),this.update({options:{mobile:!0}}),setTimeout(()=>{if(this.open(),this.hour.value=d,this.minutes.value=p,this._options.clockType==="12h"){const f=h==="PM"?"AM":"PM";this[h==="PM"?"PM":"AM"].classList.add("active"),this[f].classList.remove("active")}},300)},300)}},this._options.delayHandler||300),this._handleIconChangeView=()=>P9(this,void 0,void 0,function*(){this._options.enableSwitchIcon&&(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?this.keyboardClockIcon.addEventListener("touchstart",this._handlerViewChange()):this.keyboardClockIcon.addEventListener("click",this._handlerViewChange()))}),this._handlerClickHourMinutes=a=>P9(this,void 0,void 0,function*(){var s,l;if(!this.modalElement)return;const{clockType:c,editable:u}=this._options,d=a.target,p=om(this.hour.value,"hour",c),h=om(this.minutes.value,"minutes",c);u&&(Wi(d,"timepicker-ui-hour")||Wi(d,"timepicker-ui-minutes")?p!==!1&&h!==!1||(h||this.minutes.classList.add("invalid-value"),p||(l=this.hour)===null||l===void 0||l.classList.add("invalid-value")):p===!0&&h===!0&&(h&&this.minutes.classList.remove("invalid-value"),p&&((s=this.hour)===null||s===void 0||s.classList.remove("invalid-value"))))}),this._handleClickOnHourMobile=()=>{document.addEventListener("mousedown",this._eventsClickMobileHandler),document.addEventListener("touchstart",this._eventsClickMobileHandler)},this._handleKeyPress=a=>{a.key==="Escape"&&this.modalElement&&this.close()()},this._handleEscClick=()=>{document.addEventListener("keydown",this._handleKeyPress)},this._focusTrapHandler=()=>{setTimeout(()=>{var a,s;const l=(a=this.wrapper)===null||a===void 0?void 0:a.querySelectorAll('div[tabindex="0"]:not([disabled])'),c=(s=this.wrapper)===null||s===void 0?void 0:s.querySelectorAll('input[tabindex="0"]:not([disabled])');if(!l||l.length<=0||c.length<=0)return;const u=[...c,...l],d=u[0],p=u[u.length-1];this.wrapper.focus(),this.wrapper.addEventListener("keydown",({key:h,shiftKey:f,target:m})=>{const g=m;if(h==="Tab"&&(f?document.activeElement===d&&p.focus():document.activeElement===p&&d.focus()),h==="Enter"&&(Wi(g,"timepicker-ui-minutes")&&this.minutes.click(),Wi(g,"timepicker-ui-hour")&&this.hour.click(),Wi(g,"timepicker-ui-cancel-btn")&&this.cancelButton.click(),Wi(g,"timepicker-ui-ok-btn")&&this.okButton.click(),Wi(g,"timepicker-ui-keyboard-icon-wrapper")&&this.keyboardClockIcon.click(),Wi(g,"timepicker-ui-am")&&this.AM.click(),Wi(g,"timepicker-ui-pm")&&this.PM.click(),Wi(g,"timepicker-ui-value-tips")||Wi(g,"timepicker-ui-value-tips-24h"))){const{left:v,top:y,x:b,y:I,width:T,height:S}=g.getBoundingClientRect(),w=document.elementFromPoint(b,I);(()=>{var D;const E=new MouseEvent("mousedown",{clientX:v+T/2,clientY:y+S/2,cancelable:!0,bubbles:!0});Wi(w,"timepicker-ui-value-tips-24h")?w==null||w.dispatchEvent(E):(D=w==null?void 0:w.childNodes[0])===null||D===void 0||D.dispatchEvent(E),this._isTouchMouseMove=!1})()}setTimeout(()=>{this.wrapper.addEventListener("mousedown",()=>document.activeElement.blur())},100)})},301)},this._handleOpenOnEnterFocus=()=>{this.input.addEventListener("keydown",({target:a,key:s})=>{a.disabled||s==="Enter"&&this.open()})},this._element=e,this._cloned=null,this._options=((a,s)=>Object.assign(Object.assign({},s),a))(Object.assign(Object.assign({},i),(a=>{if(!a)return;const s=JSON.parse(JSON.stringify(a)),l=Object.keys(s);return Object.values(s).reduce((c,u,d)=>(Number(u)?c[l[d]]=Number(u):c[l[d]]=u==="true"||u==="false"?JSON.parse(u):u,c),{})})((n=this._element)===null||n===void 0?void 0:n.dataset)),h4e),this._isTouchMouseMove=!1,this._degreesHours=30*Number(uc((r=this._element)===null||r===void 0?void 0:r.querySelector("input"),this._options.clockType).hour),this._degreesMinutes=6*Number(uc((o=this._element)===null||o===void 0?void 0:o.querySelector("input"),this._options.clockType).minutes),this._isMobileView=!1,this._mutliEventsMove=a=>this._handleEventToMoveHand(a),this._mutliEventsMoveHandler=this._mutliEventsMove.bind(this),this._eventsClickMobile=a=>this._handlerClickHourMinutes(a),this._eventsClickMobileHandler=this._eventsClickMobile.bind(this),this._checkMobileOption(),this._clickTouchEvents=["click","mousedown","touchstart"],this._inputEvents=["change",...this._clickTouchEvents],this._disabledTime=null,this._preventClockTypeByCurrentTime(),this._isModalRemove=!0}get modalTemplate(){return this._options.mobile&&this._isMobileView?(e=>{const{mobileTimeLabel:i,amLabel:n,pmLabel:r,cancelLabel:o,okLabel:a,iconTemplateMobile:s,minuteMobileLabel:l,hourMobileLabel:c,enableSwitchIcon:u,animation:d,clockType:p}=e;return`
  <div class="timepicker-ui-modal normalize mobile" role="dialog" style='transition:${d?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper mobile" tabindex="0">
      <div class="timepicker-ui-header mobile">
        <div class="timepicker-ui-select-time mobile">${i}</div>
        <div class="timepicker-ui-wrapper-time mobile">
          <input class="timepicker-ui-hour mobile" tabindex="0" type="number" min="0" max="${p==="12h"?"12":"23"}" />
          <div class="timepicker-ui-hour-text mobile">${c}</div>
          <div class="timepicker-ui-dots mobile">:</div>  
          <div class="timepicker-ui-minute-text mobile">${l}</div>
          <input class="timepicker-ui-minutes mobile" tabindex="0" type="number" min="0" max="59" /> 
        </div>
  ${p!=="24h"?`<div class="timepicker-ui-wrapper-type-time mobile">
          <div class="timepicker-ui-type-mode timepicker-ui-am mobile" data-type="AM" tabindex="0">${n}</div>    
          <div class="timepicker-ui-type-mode timepicker-ui-pm mobile" data-type="PM" tabindex="0">${r}</div>    
        </div>`:""}
      </div>
      <div class="timepicker-ui-footer mobile" data-view="mobile">
      ${u?`
      <div class="timepicker-ui-keyboard-icon-wrapper mobile" role="button" aria-pressed="false" data-view="desktop" tabindex="0">
      ${s}
      </div>`:""}
      <div class="timepicker-ui-wrapper-btn mobile">
        <div class="timepicker-ui-cancel-btn mobile" role="button" aria-pressed="false" tabindex="0">${o}</div>
        <div class="timepicker-ui-ok-btn mobile" role="button" aria-pressed="false" tabindex="0">${a}</div>
      </div>
      </div>
    </div>  
  </div>`})(this._options):(e=>{const{iconTemplate:i,timeLabel:n,amLabel:r,pmLabel:o,cancelLabel:a,okLabel:s,enableSwitchIcon:l,animation:c,clockType:u,editable:d}=e;return`
  <div class="timepicker-ui-modal normalize" role="dialog" style='transition:${c?"opacity 0.15s linear":"none"}'>
    <div class="timepicker-ui-wrapper" tabindex="0">
      <div class="timepicker-ui-header">
        <div class="timepicker-ui-select-time">${n}</div>
        <div class="timepicker-ui-wrapper-time ${u==="24h"?"timepicker-ui-wrapper-time-24h":""}">
          <input ${d?"":"readonly"} class="timepicker-ui-hour" tabindex="0" type="number" min="0" max="${u==="12h"?"12":"23"}" />
          <div class="timepicker-ui-dots">:</div>    
          <input ${d?"":"readonly"} class="timepicker-ui-minutes" tabindex="0" type="number" min="0" max="59" /> 
        </div>
      ${u!=="24h"?`
      <div class="timepicker-ui-wrapper-type-time">
        <div class="timepicker-ui-type-mode timepicker-ui-am" tabindex="0" role="button" data-type="AM">${r}</div>    
        <div class="timepicker-ui-type-mode timepicker-ui-pm" tabindex="0" role="button" data-type="PM">${o}</div>    
      </div>
      `:""}
      </div>
      <div class="timepicker-ui-wrapper-landspace">
        <div class="timepicker-ui-body">
          <div class="timepicker-ui-clock-face">
            <div class="timepicker-ui-dot"></div>
            <div class="timepicker-ui-clock-hand">
              <div class="timepicker-ui-circle-hand"></div>
            </div>
            <div class="timepicker-ui-tips-wrapper"></div>
            ${u==="24h"?'<div class="timepicker-ui-tips-wrapper-24h"></div>':""}
          </div>
        </div>
        <div class="timepicker-ui-footer">
        ${l?`
      <div class="timepicker-ui-keyboard-icon-wrapper" tabindex="0" role="button" aria-pressed="false" data-view="desktop">
        ${i}
      </div>`:""}
        <div class="timepicker-ui-wrapper-btn" >
          <div class="timepicker-ui-cancel-btn" tabindex="0" role="button" aria-pressed="false">${a}</div>
          <div class="timepicker-ui-ok-btn" tabindex="0" role="button" aria-pressed="false">${s}</div>
        </div>
        </div>
      </div>
    </div>  
  </div>`})(this._options)}get modalElement(){return document.querySelector(".timepicker-ui-modal")}get clockFace(){return document.querySelector(".timepicker-ui-clock-face")}get input(){var e;return(e=this._element)===null||e===void 0?void 0:e.querySelector("input")}get clockHand(){return document.querySelector(".timepicker-ui-clock-hand")}get circle(){return document.querySelector(".timepicker-ui-circle-hand")}get tipsWrapper(){return document.querySelector(".timepicker-ui-tips-wrapper")}get tipsWrapperFor24h(){return document.querySelector(".timepicker-ui-tips-wrapper-24h")}get minutes(){return document.querySelector(".timepicker-ui-minutes")}get hour(){return document.querySelector(".timepicker-ui-hour")}get AM(){return document.querySelector(".timepicker-ui-am")}get PM(){return document.querySelector(".timepicker-ui-pm")}get minutesTips(){return document.querySelector(".timepicker-ui-minutes-time")}get hourTips(){return document.querySelector(".timepicker-ui-hour-time-12")}get allValueTips(){return[...document.querySelectorAll(".timepicker-ui-value-tips"),...document.querySelectorAll(".timepicker-ui-value-tips-24h")]}get openElementData(){var e;const i=(e=this._element)===null||e===void 0?void 0:e.querySelectorAll("[data-open]");if((i==null?void 0:i.length)>0){const n=[];return i.forEach(({dataset:r})=>{var o;return n.push((o=r.open)!==null&&o!==void 0?o:"")}),[...new Set(n)]}return null}get openElement(){var e,i;return this.openElementData===null?((e=this.input)===null||e===void 0||e.setAttribute("data-open","timepicker-ui-input"),[this.input]):(i=this.openElementData.map(n=>{var r;return(r=this._element)===null||r===void 0?void 0:r.querySelectorAll(`[data-open='${n}']`)})[0])!==null&&i!==void 0?i:""}get cancelButton(){return document.querySelector(".timepicker-ui-cancel-btn")}get okButton(){return document.querySelector(".timepicker-ui-ok-btn")}get activeTypeMode(){return document.querySelector(".timepicker-ui-type-mode.active")}get keyboardClockIcon(){return document.querySelector(".timepicker-ui-keyboard-icon-wrapper")}get footer(){return document.querySelector(".timepicker-ui-footer")}get wrapper(){return document.querySelector(".timepicker-ui-wrapper")}_checkDisabledValuesOnStart(){if(!this._options.disabledTime||this._options.disabledTime.interval)return;const{disabledTime:{hours:e,minutes:i},clockType:n}=this._options,r=!e||tE(e,"hour",n),o=!i||tE(i,"minutes",n);if(!r||!o)throw new Error("You set wrong hours or minutes in disabled option")}_checkMobileOption(){this._isMobileView=!!this._options.mobile,this._options.mobile&&(this._options.editable=!0)}_getDisableTime(){this._disabledTime=(e=>{if(!e)return;const{disabledTime:i,clockType:n}=e;if(!i||Object.keys(i).length<=0||i.constructor.name!=="Object")return;const{hours:r,interval:o,minutes:a}=i;if(o){delete i.hours,delete i.minutes;const[s,l]=o.toString().split("-"),{hour:c,minutes:u,type:d}=uc({value:s.trimEnd()},n),{hour:p,minutes:h,type:f}=uc({value:l.trimEnd().trimStart()},n);let m=Q1(c,p).map(b=>b==="00"||Number(b)===0?`0${Number(b)}`:`${Number(b)}`);const g=[],v=Number(u),y=Number(h);if(f===d)return v>0&&y<=0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y<59&&y>0&&v<=0?(g.push(void 0,m[m.length-1]),m=m.slice(0,-1)):y>0&&v>0?(g.push(m[0],m[m.length-1]),m=m.slice(1,-1)):y===0&&v===0&&(g.push(void 0,m[m.length-1]),m.pop()),{value:{removedStartedHour:Number(g[0])<=9?`0${g[0]}`:g[0],removedEndHour:Number(g[1])<=9?`0${g[1]}`:g[1],rangeArrHour:m,isInterval:!0,startMinutes:Q1(u,59).map(b=>Number(b)<=9?`0${b}`:`${b}`),endMinutes:JL(0,h).map(b=>Number(b)<=9?`0${b}`:`${b}`),endType:f,startType:d}};{const b=Q1(c,12).map(String),I=JL(1,p).map(String),T=[],S=[];return v>0&&y<=0?(T.push(I[I.length-1]),S.push(b[0]),I.splice(-1,1),b.splice(0,1)):y<59&&y>0&&v<=0?(S.push(b[0]),T.push(I[I.length-1]),I.splice(-1,1)):y>0&&v>0?(T.push(I[I.length-1]),S.push(b[0]),I.splice(-1,1),b.splice(0,1)):y===0&&v===0&&(T.push(I[I.length-1]),S.push(b[0]),I.pop()),{value:{isInterval:!0,endType:f,startType:d,pmHours:I,amHours:b,startMinutes:Number(u)===0?[]:Q1(u,59).map(w=>Number(w)<=9?`0${w}`:`${w}`),endMinutes:JL(0,h).map(w=>Number(w)<=9?`0${w}`:`${w}`),removedAmHour:Number(S[0])<=9?`0${S[0]}`:S[0],removedPmHour:Number(T[0])<=9?`0${T[0]}`:T[0]}}}}return r==null||r.forEach(s=>{if(n==="12h"&&Number(s)>12)throw new Error("The disabled hours value has to be less than 13");if(n==="24h"&&Number(s)>23)throw new Error("The disabled hours value has to be less than 24")}),a==null||a.forEach(s=>{if(Number(s)>59)throw new Error("The disabled minutes value has to be less than 60")}),{value:{hours:r==null?void 0:r.map(s=>s==="00"||Number(s)===0?`0${Number(s)}`:`${Number(s)}`),minutes:a==null?void 0:a.map(s=>Number(s)<=9?`0${s}`:`${s}`)}}})(this._options)}_removeCircleClockClasses24h(){var e,i;(e=this.circle)===null||e===void 0||e.classList.remove("timepicker-ui-circle-hand-24h"),(i=this.clockHand)===null||i===void 0||i.classList.remove("timepicker-ui-clock-hand-24h")}_setCircleClockClasses24h(){var e,i;this.circle&&((e=this.circle)===null||e===void 0||e.classList.add("timepicker-ui-circle-hand-24h")),this.clockHand&&((i=this.clockHand)===null||i===void 0||i.classList.add("timepicker-ui-clock-hand-24h"))}_setErrorHandler(){var e,i,n,r;const{error:o,currentHour:a,currentMin:s,currentType:l,currentLength:c}=uc(this.input,this._options.clockType);if(o){const u=document.createElement("div");throw(e=this.input)===null||e===void 0||e.classList.add("timepicker-ui-invalid-format"),u.classList.add("timepicker-ui-invalid-text"),u.innerHTML="<b>Invalid Time Format</b>",!((i=this.input)===null||i===void 0)&&i.parentElement&&((n=this.input)===null||n===void 0?void 0:n.parentElement.querySelector(".timepicker-ui-invalid-text"))===null&&((r=this.input)===null||r===void 0||r.after(u)),tu(this._element,"geterror",{error:o,currentHour:a,currentMin:s,currentType:l,currentLength:c}),new Error(`Invalid Time Format: ${o}`)}}_removeErrorHandler(){var e,i;(e=this.input)===null||e===void 0||e.classList.remove("timepicker-ui-invalid-format");const n=(i=this._element)===null||i===void 0?void 0:i.querySelector(".timepicker-ui-invalid-text");n&&n.remove()}_setOnStartCSSClassesIfClockType24h(){if(this._options.clockType==="24h"){let{hour:e}=uc(this.input,this._options.clockType,this._options.currentTime);this.input.value.length>0&&(e=this.input.value.split(":")[0]),(Number(e)>12||Number(e)===0)&&this._setCircleClockClasses24h()}}_getDestructuringObj(e){var i;const{endMinutes:n,removedEndHour:r,removedStartedHour:o,startMinutes:a,pmHours:s,amHours:l,removedAmHour:c,removedPmHour:u}=this._disabledTime.value;return e?{minutesToUpdate:{actualHour:this.hour.value,pmHours:s,amHours:l,activeMode:(i=this.activeTypeMode)===null||i===void 0?void 0:i.textContent,startMinutes:a,endMinutes:n,removedAmHour:c,removedPmHour:u}}:{minutesToUpdate:{endMinutes:n,removedEndHour:r,removedStartedHour:o,actualHour:this.hour.value,startMinutes:a}}}}function m4e({time:t,options:e,callback:i}={}){const n=document.getElementById("timepicker"),r=document.getElementById("timevalue");r.value=g4e(t);const o=new f4e(document.getElementById("timepicker"),{switchToMinutesAfterSelectHour:!0,clockType:"12h",...e});o.create(),o.open(),n.addEventListener("accept",()=>{const a=r.value;vt(i)&&i({time:a}),o.destroy()})}function g4e(t,e){var n;let i=v4e(t||((n=e==null?void 0:e.schedule)==null?void 0:n.default_time));return i.ampm?t:(i.hours>12?(i.hours-=12,i.ampm="PM"):i.hours==="12"?i.ampm="PM":(i.hours==="00"&&(i.hours="12"),i.ampm="AM"),`${i.hours||"12"}:${i.minutes||"00"} ${i.ampm}`)}function v4e(t){t=t||"00:00";let e={},i={};return{0:e.time,1:e.ampm}=t&&t.split(" ")||"",{0:i.hours,1:i.minutes}=e.time&&e.time.split(":")||"",i.ampm=e.ampm,i}const{AFTER_REST:R9,FOLLOWED_BY:N9,NEXT_AVAILABLE:A9,NOT_BEFORE:_9,TO_BE_ANNOUNCED:k9}=TA;function Qye({e:t,cell:e,callback:i,matchUpId:n}={}){const r=e.getRow().getData(),o=h=>{const f=Object.values(r).filter(y=>y==null?void 0:y.matchUpId),g=[{params:{matchUpIds:n?[n]:f.map(({matchUpId:y})=>y),schedule:h},method:_ye}];xt({methods:g,callback:y=>{y.success&&vt(i)&&i(h)}})},a=()=>o({scheduledTime:"",timeModifiers:[]}),s=({time:h})=>{const m=Di.dateTime.convertTime(h,!0);o({scheduledTime:m})},l=()=>{const f=e.getTable().getData();let m;const g=f.flatMap((I,T)=>{if(!m&&!(I.rowId===r.rowId&&(m=T+1,T)))return Object.values(I).flatMap(S=>{var w;return(w=S==null?void 0:S.schedule)==null?void 0:w.scheduledTime})}).filter(Boolean).map(d4e),v=Math.max(...g,0),y=m>1,b=v&&p4e(v,y)||"8:00 AM";m4e({time:b,callback:s})},c=h=>o({timeModifiers:[h]}),d=[{option:n?"Set match time":"Set match times",onClick:l},{option:pS[N9],onClick:()=>c(N9)},{option:pS[A9],onClick:()=>c(A9)},{option:pS[_9],onClick:()=>c(_9)},{option:pS[R9],onClick:()=>c(R9)},{option:pS[k9],onClick:()=>c(k9)},{option:"Clear time settings",onClick:a}],p=t.target;bl({options:d,target:p,config:{placement:Ut}})}function y4e({courtInfo:t}){lr({title:"Rename Court",content:n=>ro(n,[{value:t.courtName,label:"Court Name",field:"courtName"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Rename",intent:"is-primary",onClick:({content:n})=>{const r=n==null?void 0:n.courtName.value;r&&r!==t.courtName&&console.log({newValue:r})},close:!0}]})}function b4e(t,e,i){const r=[{option:`${Fn.tr("remove")} court identifiers`,onClick:a},{option:Fn.tr("rename"),onClick:()=>y4e({courtInfo:i})}],o=t.target;bl({options:r,target:o});function a(){console.log("toggle court identifiers",{cell:e})}}function I4e(t,e){t.preventDefault();const i=t.dataTransfer.getData("itemid"),n=e.getTable(),r=n.getData(),o=e.getRow().getData();let a=n.getData().flatMap(D=>Object.values(D).filter(E=>E.matchUpId)),s=a.find(D=>D.matchUpId===i);s||(s=bo.findTable(`#${bv}`)[0].getData().map(C=>C.matchUp).find(C=>C.matchUpId===i)||{});const l=document.getElementById(gle).value,{courtOrder:c,courtId:u,venueId:d}=s.schedule||{},p=t.currentTarget,h=p.id;if(i===h)return;const f=s.schedule,m=h&&a.find(D=>D.matchUpId===h),g=p.getAttribute("venueId"),v=p.getAttribute("courtId"),y=p.getAttribute("courtOrder"),b=Object.keys(o).find(D=>{var R;if(!yu(o[D]))return;const E=((R=o[D])==null?void 0:R.schedule)||{},{courtOrder:C,courtId:M,venueId:N}=E;return(C==null?void 0:C.toString())===y.toString()&&N===g&&M===v});let I;const T=r.find(D=>(I=Object.keys(D).find(E=>{var A;if(!yu(D[E]))return;const C=((A=D[E])==null?void 0:A.schedule)||{},{courtOrder:M,courtId:N,venueId:R}=C;return M===c&&R===d&&N===u}),I)),S=({scheduledTime:D="",timeModifiers:E=[]}={})=>{const C={courtOrder:y,scheduledDate:l,venueId:g,courtId:v,scheduledTime:D,timeModifiers:E},M=[{method:f$,params:{tournamentId:s==null?void 0:s.tournamentId,matchUpId:s==null?void 0:s.matchUpId,schedule:C,drawId:s==null?void 0:s.drawId}}];xt({methods:M,engine:JM,callback:R=>!R.success&&console.log({result:R})}),s.schedule=C},w={scheduledDate:f==null?void 0:f.scheduledDate,scheduledTime:f==null?void 0:f.scheduledTime,timeModifiers:f==null?void 0:f.timeModifiers,courtOrder:c,venueId:d,courtId:u},U=()=>{const D=[{method:f$,params:{tournamentId:m==null?void 0:m.tournamentId,matchUpId:m==null?void 0:m.matchUpId,schedule:w,drawId:m==null?void 0:m.drawId}}];xt({methods:D,engine:JM,callback:C=>!C.success&&console.log({result:C})}),m?m.schedule=w:console.log("missing targetMatchUp")};if(h==="")T?(S(),T[I]={schedule:{courtOrder:c,venueId:d,courtId:u}},T.rowId==o.rowId?(T[b]=s,n.updateData([T])):(o[b]=s,n.updateData([T,o]))):(bo.findTable(`#${bv}`)[0].deleteRow(i),S(),o[b]=s,n.updateData([o]));else if(!T&&m){const D=bo.findTable(`#${bv}`)[0];D.deleteRow(i),S(),o[b]=s,n.updateData([o]),D.addRow(tS(m),!0),U()}else{const D=m==null?void 0:m.schedule;S({scheduledTime:D==null?void 0:D.scheduledTime,timeModifiers:D==null?void 0:D.timeModifiers}),U(),T.rowId==o.rowId?(T[I]=m,T[b]=s,n.updateData([T])):(T[I]=m,o[b]=s,n.updateData([T,o]))}gN(n)}const{SCHEDULE_STATE:w4e,SCHEDULE_ERROR:S4e,SCHEDULE_WARNING:T4e,SCHEDULE_CONFLICT:U4e}=Ca.scheduleConstants;function ebe(t){var N;const e=document.createElement("span");if(!t.getColumn().getDefinition().field)return e.className="schedule-cell",e;const n=t.getValue(),{potentialParticipants:r,eventName:o="",roundName:a="",schedule:s={},matchUpStatus:l,winningSide:c,matchUpId:u,sides:d}=n||{},{courtOrder:p="",scheduledTime:h="",courtId:f="",timeModifiers:m,venueId:g=""}=s;if(e.setAttribute("courtOrder",p),e.setAttribute("courtId",f),e.setAttribute("venueId",g),e.className="schedule-cell dragdrop",e.ondragover=R=>R.preventDefault(),u)if(e.draggable=!0,e.id=u,c)e.classList.add("matchup-complete");else{const R=s[w4e];l==="IN_PROGRESS"?e.classList.add("matchup-inprogress"):R===U4e?e.classList.add("matchup-conflict"):R===fle?e.classList.add("matchup-issue"):R===T4e?e.classList.add("matchup-warning"):R===S4e&&e.classList.add("matchup-error")}if(e.addEventListener("drop",R=>I4e(R,t)),e.addEventListener("dragstart",Jye),!u)return e;const v=`${o} ${a}`,y=R=>{var A,_;return((_=(A=R.person)==null?void 0:A.standardFamilyName)==null?void 0:_.toUpperCase())||R.participantName},b=r==null?void 0:r.map(R=>R==null?void 0:R.map(A=>`<span class='potential nowrap'>${y(A)}</span>`).join('<span style="font-weight: bold">&nbsp;or&nbsp;</span>')),I=R=>{var _,k;const A=(k=(_=d==null?void 0:d.find(O=>R===O.sideNumber))==null?void 0:_.participant)==null?void 0:k.participantName;if(A)return c===R?`<span style='font-weight: bold'>${A}</span>`:A},T=I(1)||(b==null?void 0:b.shift())||"Unkown",S=I(2)||(b==null?void 0:b.shift())||"Unknown";e.id=u;const w=document.createElement("div");w.className="header flexrow",w.innerHTML=((m==null?void 0:m[0])&&_Ne[m[0]]+"&nbsp;"||"")+z4(h),e.appendChild(w);const U=document.createElement("div");U.className="catround",U.innerHTML=v,e.appendChild(U);const D=document.createElement("div");D.className="scheduled_teams";const E=document.createElement("div");E.className="scheduled_team",E.style="font-size: 1em",E.innerHTML=T,D.appendChild(E);const C=document.createElement("div");C.className="divider",C.innerHTML="vs.",D.appendChild(C);const M=document.createElement("div");if(M.className="scheduled_team",M.style="font-size: 1em",M.innerHTML=S,D.appendChild(M),c){const R=document.createElement("div");R.innerHTML=((N=n.score)==null?void 0:N.scoreStringSide1)||"",D.appendChild(R)}return e.appendChild(D),e}function D4e({values:t,valueChange:e,isValid:i}){const n=(a,s)=>l=>l.length>=a&&(!s||s&&l.length<=s),r=a=>!isNaN(a),o=a=>e(a);return[{placeholder:"Venue name",value:t.venueName||"",label:"Venue name",field:"venueName",error:"Please enter a name of at least 5 characters",validator:n(5),focus:!0,onChange:o},{value:t.venueAbbreviation||"",label:"Abbreviation",field:"venueAbbreviation",error:"Please enter an abbreviation of 2-6 characters",validator:n(2,6),onChange:o},{value:t.courtsCount||"",label:"Number of courts",field:"courtsCount",error:"Must be a whole number",validator:r,onChange:o}]}function P4e(t){return{venueAbbreviation:t==null?void 0:t.venueAbbreviation.value,courtsCount:t==null?void 0:t.courtsCount.value,venueName:t==null?void 0:t.venueName.value}}const C4e=t=>{const e=P4e(Qe.drawer.attributes.content),{venueName:i,venueAbbreviation:n,courtsCount:r}=e,o=Di.UUID();if(!i||!n||!r){vi({message:"Invalid values",intent:"is-danger"});return}const a=[{params:{venue:{venueName:i,venueAbbreviation:n,venueId:o},returnDetails:!0},method:r3e},{params:{courtsCount:parseInt(r),venueId:o,venueAbbreviationRoot:!0},method:XWe}];xt({methods:a,callback:l=>{if(l!=null&&l.success&&vt(t)){const{venue:c}=Ye.findVenue({venueId:o});c&&t({...l,venue:c})}}})};function tbe(t){const e=()=>{},i=r=>ro(r,D4e({values:{},valueChange:e})),n=(r,o)=>yb(r,[{label:"Cancel",close:!0},{label:"Save",onClick:()=>C4e(t),close:!0,intent:"is-info"}],o);Qe.drawer.open({title:"<b style='larger'>Add venue</b>",width:"300px",side:Ut,content:i,footer:n})}function E4e({courtsData:t,count:e}){const i=r=>{r.stopPropagation(),r.preventDefault(),tbe(nbe)},n=r=>{if(!r)return t.length?"<p style='font-weight: normal; color: lightblue'>Add venue</p>":"<button class='button is-danger'>Add venue</button>"};return e>0?Di.generateRange(0,e).map(r=>({headerClick:o=>r===0&&i(o),title:n(r),headerHozAlign:Vt,formatter:ebe,headerSort:!1,resizable:!1,minWidth:150})):[]}function M4e({notice:t,notes:e,callback:i}){let n;lr({title:"Order of play",buttons:[{label:"Cancel",intent:"is-nothing"},{label:"Save",intent:"is-info",onClick:()=>{const s=n.notice.value,l=n.notes.value;typeof i=="function"&&i({notice:s,notes:l})},close:!0}],content:s=>{n=ro(s,[{placeholder:"appears on PDF Header",value:t,label:"Schedule notice",field:"notice"},{placeholder:"appears on PDF Footer",value:e,label:"Umpire notes",field:"notes"}])}})}const{NOT_BEFORE:x9}=TA;function R4e(t,e){var r;const i=e.getRow().getData(),n=Object.values(i).filter(o=>o==null?void 0:o.matchUpId);(r=i.issues)!=null&&r.length&&console.log({issues:i.issues}),n.length&&Qye({e:t,cell:e,rowData:i,callback:a=>{if(yu(a)){const s=e.getTable(),l=s.getData().find(c=>c.rowId===i.rowId);Object.values(l).forEach(c=>{var u;c.matchUpId&&(a.scheduledTime&&(c.schedule.scheduledTime=z4(a.scheduledTime),((u=c.schedule.timeModifiers)==null?void 0:u[0])!==x9&&(c.schedule.timeModifiers=[])),a.timeModifiers&&(c.schedule.scheduledTime&&a.timeModifiers[0]!==x9&&(c.schedule.scheduledTime=""),c.schedule.timeModifiers=a.timeModifiers))}),s.updateData([l])}}})}function N4e(){function t(n){const r=n.getElement();return r.classList.add("tag"),r.classList.add("is-info"),r.classList.add("is-light"),'<i class="fa-regular fa-note-sticky"></i>'}function e(n){n.getElement().style.backgroundColor="white";const r=document.createElement("span"),o=n.getRow().getData();return r.innerHTML=o.rowNumber,r}return{titleFormatter:t,formatter:e,headerClick:()=>{M4e({notes:"",notice:"",callback:n});function n(r){console.log({result:r})}},cellClick:R4e,headerSort:!1,resizable:!1,hozAlign:Vt,frozen:!0,width:55}}function A4e({courtsData:t,courtPrefix:e}){const i=(l,c)=>{const u=c.getColumn().getDefinition().field,{drawId:d,matchUpId:p}=c.getData()[u];Qye({e:l,cell:c,matchUpId:p,callback:()=>{var v,y;const f=(y=(v=Ye.allTournamentMatchUps({matchUpFilters:{drawIds:[d],matchUpIds:[p]},nextMatchUps:!0}))==null?void 0:v.matchUps)==null?void 0:y[0],m=c.getRow().getData();m[u]=f,c.getTable().updateData([m])}})},n=RNe-t.length,r=n<=0?1:n,o=E4e({courtsData:t,count:r}),a=N4e(),s=(l,c)=>({headerClick:(u,d)=>b4e(u,d,l),cellClick:i,field:`${e}${c}`,title:l.courtName,headerHozAlign:Vt,formatter:ebe,headerSort:!1,resizable:!1,hozAlign:Vt,minWidth:150});return[a].concat(t.map(s),o)}function _4e({scheduledDate:t}={}){let e,i,n,r=[];const o=({scheduledDate:d})=>{const p={localPerspective:!0,scheduledDate:d},h=yg.competitionScheduleMatchUps({courtCompletedMatchUps:!0,withCourtGridRows:!0,minCourtGridRows:10,nextMatchUps:!0,matchUpFilters:p}),{dateMatchUps:f=[],completedMatchUps:m=[],courtsData:g,courtPrefix:v="C|",rows:y,groupInfo:b}=h,I=f.concat(...m),T=A4e({courtsData:g,courtPrefix:v});return y.forEach((S,w)=>{S.rowId=`rowId-${w+1}`,S.rowNumber=w+1}),{rows:y,columns:T,matchUps:I,courtsCount:g.length,courtsData:g,groupInfo:b}},a=({scheduledDate:d}={})=>{setTimeout(()=>{const{rows:h,matchUps:f,columns:m,courtsData:g}=o({scheduledDate:d}),v=g==null?void 0:g.map(b=>b.courtId);Di.intersection(r,v).length===(v==null?void 0:v.length)||(i.setColumns(m),r=v),n=!0,i==null||i.replaceData(h),i.matchUps=f},e?0:1e3)};rh({anchorId:tR});const s=document.getElementById(tR),{rows:l=[],columns:c=[],courtsCount:u}=o({scheduledDate:t});return r=c.map(({courtId:d})=>d).filter(Boolean),i=new bo(s,{height:window.innerHeight*.84,renderHorizontal:"virtual",placeholder:"No courts",index:"rowId",data:l,columns:c}),i.on("scrollVertical",Tc),i.on("tableBuilt",()=>{gN(i),e=!0}),i.on("dataProcessed",()=>{n&&(n=!1,gN(i))}),{table:i,replaceTableData:a,courtsCount:u}}function k4e({updateUnscheduledTable:t,updateScheduleTable:e,scheduledDate:i,table:n}){const o=[{params:{matchUps:n.getData("active").map(s=>s.matchUp),scheduledDate:i},method:m3e}];xt({methods:o,callback:s=>{s.success&&(t(),e())},engine:JM})}function x4e({scheduledDate:t,target:e,roundNameFilter:i,eventIdFilter:n,callback:r}){const o=yg.competitionScheduleMatchUps({courtCompletedMatchUps:!0}),{dateMatchUps:a=[],completedMatchUps:s=[]}=o,c=a.concat(...s).filter(({schedule:m})=>m.scheduledDate||m.scheduledTime||m.courtId),u=c.filter(({schedule:m})=>m.scheduledDate===t);let d=[{option:"Clear scheduled matches",disabled:!u.length,onClick:f},{option:"Clear all matches",disabled:!u.length,onClick:h},{option:"Clear all days",disabled:!c.length,onClick:p}];d.filter(m=>!m.disabled).length&&bl({target:e,options:d,config:{placement:Rf}});function p(){f({all:!0})}function h(){f({completed:!0})}function f({all:m,completed:g}={}){let v=c.filter(({schedule:S})=>S.scheduledDate===t).filter(({roundName:S})=>!i||i===S).filter(({eventId:S})=>!n||n===S);g||(v=v==null?void 0:v.filter(({matchUpStatus:S,winningSide:w})=>S!=="COMPLETED"&&!w));const b=(m?c:v).map(S=>S.matchUpId);xt({methods:[{method:_ye,params:{schedule:{courtId:"",scheduledDate:"",courtOrder:"",scheduledTime:"",venueId:""},matchUpIds:b}}],callback:S=>{S.success&&vt(r)&&r()}})}}const O9="All events",L9="All rounds";function O4e({updateUnscheduledTable:t,updateScheduleTable:e,toggleUnscheduled:i,roundNameFilter:n,controlAnchor:r,eventIdFilter:o,scheduledDate:a,matchUps:s=[],table:l}){const c=D=>D.eventId===o,u=D=>{l.removeFilter(c),o=D,D&&l.addFilter(c)},d=Ye.getEvents().events||[],h=[{label:O9,onClick:()=>u(),close:!0}].concat(d.map(D=>({onClick:()=>u(D.eventId),label:D.eventName,close:!0}))),f=D=>D.roundName===n,m=Di.unique(s.map(D=>D.roundName)),g=D=>{l.removeFilter(f),n=D,D&&l.addFilter(f)},y=[{label:L9,onClick:()=>g(),close:!0}].concat(m.map(D=>({onClick:()=>g(D),label:D,close:!0}))),b=()=>{t()&&e(),console.log("clear filters ?")},I=D=>{const E=As(D.target,"dropdown");x4e({target:E||(D==null?void 0:D.target),callback:b,roundNameFilter:n,eventIdFilter:o,scheduledDate:a,eventFilter:c,roundFilter:f})},T=gb(l),w=[{onClick:()=>k4e({scheduledDate:a,table:l,updateScheduleTable:e,updateUnscheduledTable:t}),label:"Auto schedule",intent:"is-primary",id:"autoSchedule",close:!0},{label:"Clear schedule",onClick:I,intent:"is-warning",id:"clearSchedule",close:!0}],U=[{onKeyDown:D=>D.keyCode===8&&D.target.value.length===1&&T(""),onChange:D=>T(D.target.value),onKeyUp:D=>T(D.target.value),clearSearch:()=>T(""),placeholder:"Search participants",location:Lt,search:!0},{hide:h.length<2,options:h,id:"eventOptions",label:O9,modifyLabel:!0,location:Lt,selection:!0},{hide:y.length<2,options:y,id:"roundOptions",label:L9,modifyLabel:!0,location:Lt,selection:!0},{options:w,label:"Actions",selection:!1,location:Ut,align:Ut},{onClick:i,id:"doneScheduling",intent:"is-info",label:"Done"}];Da({target:r,items:U}).elements}var ibe={exports:{}};(function(t,e){(function(i,n){t.exports=n()})(cve,function(){var i=1e3,n=6e4,r=36e5,o="millisecond",a="second",s="minute",l="hour",c="day",u="week",d="month",p="quarter",h="year",f="date",m="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,v=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,y={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(R){var A=["th","st","nd","rd"],_=R%100;return"["+R+(A[(_-20)%10]||A[_]||A[0])+"]"}},b=function(R,A,_){var k=String(R);return!k||k.length>=A?R:""+Array(A+1-k.length).join(_)+R},I={s:b,z:function(R){var A=-R.utcOffset(),_=Math.abs(A),k=Math.floor(_/60),O=_%60;return(A<=0?"+":"-")+b(k,2,"0")+":"+b(O,2,"0")},m:function R(A,_){if(A.date()<_.date())return-R(_,A);var k=12*(_.year()-A.year())+(_.month()-A.month()),O=A.clone().add(k,d),F=_-O<0,B=A.clone().add(k+(F?-1:1),d);return+(-(k+(_-O)/(F?O-B:B-O))||0)},a:function(R){return R<0?Math.ceil(R)||0:Math.floor(R)},p:function(R){return{M:d,y:h,w:u,d:c,D:f,h:l,m:s,s:a,ms:o,Q:p}[R]||String(R||"").toLowerCase().replace(/s$/,"")},u:function(R){return R===void 0}},T="en",S={};S[T]=y;var w="$isDayjsObject",U=function(R){return R instanceof M||!(!R||!R[w])},D=function R(A,_,k){var O;if(!A)return T;if(typeof A=="string"){var F=A.toLowerCase();S[F]&&(O=F),_&&(S[F]=_,O=F);var B=A.split("-");if(!O&&B.length>1)return R(B[0])}else{var $=A.name;S[$]=A,O=$}return!k&&O&&(T=O),O||!k&&T},E=function(R,A){if(U(R))return R.clone();var _=typeof A=="object"?A:{};return _.date=R,_.args=arguments,new M(_)},C=I;C.l=D,C.i=U,C.w=function(R,A){return E(R,{locale:A.$L,utc:A.$u,x:A.$x,$offset:A.$offset})};var M=function(){function R(_){this.$L=D(_.locale,null,!0),this.parse(_),this.$x=this.$x||_.x||{},this[w]=!0}var A=R.prototype;return A.parse=function(_){this.$d=function(k){var O=k.date,F=k.utc;if(O===null)return new Date(NaN);if(C.u(O))return new Date;if(O instanceof Date)return new Date(O);if(typeof O=="string"&&!/Z$/i.test(O)){var B=O.match(g);if(B){var $=B[2]-1||0,V=(B[7]||"0").substring(0,3);return F?new Date(Date.UTC(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)):new Date(B[1],$,B[3]||1,B[4]||0,B[5]||0,B[6]||0,V)}}return new Date(O)}(_),this.init()},A.init=function(){var _=this.$d;this.$y=_.getFullYear(),this.$M=_.getMonth(),this.$D=_.getDate(),this.$W=_.getDay(),this.$H=_.getHours(),this.$m=_.getMinutes(),this.$s=_.getSeconds(),this.$ms=_.getMilliseconds()},A.$utils=function(){return C},A.isValid=function(){return this.$d.toString()!==m},A.isSame=function(_,k){var O=E(_);return this.startOf(k)<=O&&O<=this.endOf(k)},A.isAfter=function(_,k){return E(_)<this.startOf(k)},A.isBefore=function(_,k){return this.endOf(k)<E(_)},A.$g=function(_,k,O){return C.u(_)?this[k]:this.set(O,_)},A.unix=function(){return Math.floor(this.valueOf()/1e3)},A.valueOf=function(){return this.$d.getTime()},A.startOf=function(_,k){var O=this,F=!!C.u(k)||k,B=C.p(_),$=function(Y,X){var Q=C.w(O.$u?Date.UTC(O.$y,X,Y):new Date(O.$y,X,Y),O);return F?Q:Q.endOf(c)},V=function(Y,X){return C.w(O.toDate()[Y].apply(O.toDate("s"),(F?[0,0,0,0]:[23,59,59,999]).slice(X)),O)},H=this.$W,z=this.$M,G=this.$D,W="set"+(this.$u?"UTC":"");switch(B){case h:return F?$(1,0):$(31,11);case d:return F?$(1,z):$(0,z+1);case u:var K=this.$locale().weekStart||0,Z=(H<K?H+7:H)-K;return $(F?G-Z:G+(6-Z),z);case c:case f:return V(W+"Hours",0);case l:return V(W+"Minutes",1);case s:return V(W+"Seconds",2);case a:return V(W+"Milliseconds",3);default:return this.clone()}},A.endOf=function(_){return this.startOf(_,!1)},A.$set=function(_,k){var O,F=C.p(_),B="set"+(this.$u?"UTC":""),$=(O={},O[c]=B+"Date",O[f]=B+"Date",O[d]=B+"Month",O[h]=B+"FullYear",O[l]=B+"Hours",O[s]=B+"Minutes",O[a]=B+"Seconds",O[o]=B+"Milliseconds",O)[F],V=F===c?this.$D+(k-this.$W):k;if(F===d||F===h){var H=this.clone().set(f,1);H.$d[$](V),H.init(),this.$d=H.set(f,Math.min(this.$D,H.daysInMonth())).$d}else $&&this.$d[$](V);return this.init(),this},A.set=function(_,k){return this.clone().$set(_,k)},A.get=function(_){return this[C.p(_)]()},A.add=function(_,k){var O,F=this;_=Number(_);var B=C.p(k),$=function(z){var G=E(F);return C.w(G.date(G.date()+Math.round(z*_)),F)};if(B===d)return this.set(d,this.$M+_);if(B===h)return this.set(h,this.$y+_);if(B===c)return $(1);if(B===u)return $(7);var V=(O={},O[s]=n,O[l]=r,O[a]=i,O)[B]||1,H=this.$d.getTime()+_*V;return C.w(H,this)},A.subtract=function(_,k){return this.add(-1*_,k)},A.format=function(_){var k=this,O=this.$locale();if(!this.isValid())return O.invalidDate||m;var F=_||"YYYY-MM-DDTHH:mm:ssZ",B=C.z(this),$=this.$H,V=this.$m,H=this.$M,z=O.weekdays,G=O.months,W=O.meridiem,K=function(X,Q,te,J){return X&&(X[Q]||X(k,F))||te[Q].slice(0,J)},Z=function(X){return C.s($%12||12,X,"0")},Y=W||function(X,Q,te){var J=X<12?"AM":"PM";return te?J.toLowerCase():J};return F.replace(v,function(X,Q){return Q||function(te){switch(te){case"YY":return String(k.$y).slice(-2);case"YYYY":return C.s(k.$y,4,"0");case"M":return H+1;case"MM":return C.s(H+1,2,"0");case"MMM":return K(O.monthsShort,H,G,3);case"MMMM":return K(G,H);case"D":return k.$D;case"DD":return C.s(k.$D,2,"0");case"d":return String(k.$W);case"dd":return K(O.weekdaysMin,k.$W,z,2);case"ddd":return K(O.weekdaysShort,k.$W,z,3);case"dddd":return z[k.$W];case"H":return String($);case"HH":return C.s($,2,"0");case"h":return Z(1);case"hh":return Z(2);case"a":return Y($,V,!0);case"A":return Y($,V,!1);case"m":return String(V);case"mm":return C.s(V,2,"0");case"s":return String(k.$s);case"ss":return C.s(k.$s,2,"0");case"SSS":return C.s(k.$ms,3,"0");case"Z":return B}return null}(X)||B.replace(":","")})},A.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},A.diff=function(_,k,O){var F,B=this,$=C.p(k),V=E(_),H=(V.utcOffset()-this.utcOffset())*n,z=this-V,G=function(){return C.m(B,V)};switch($){case h:F=G()/12;break;case d:F=G();break;case p:F=G()/3;break;case u:F=(z-H)/6048e5;break;case c:F=(z-H)/864e5;break;case l:F=z/r;break;case s:F=z/n;break;case a:F=z/i;break;default:F=z}return O?F:C.a(F)},A.daysInMonth=function(){return this.endOf(d).$D},A.$locale=function(){return S[this.$L]},A.locale=function(_,k){if(!_)return this.$L;var O=this.clone(),F=D(_,k,!0);return F&&(O.$L=F),O},A.clone=function(){return C.w(this.$d,this)},A.toDate=function(){return new Date(this.valueOf())},A.toJSON=function(){return this.isValid()?this.toISOString():null},A.toISOString=function(){return this.$d.toISOString()},A.toString=function(){return this.$d.toUTCString()},R}(),N=M.prototype;return E.prototype=N,[["$ms",o],["$s",a],["$m",s],["$H",l],["$W",c],["$M",d],["$y",h],["$D",f]].forEach(function(R){N[R[1]]=function(A){return this.$g(A,R[0],R[1])}}),E.extend=function(R,A){return R.$i||(R(A,M,E),R.$i=!0),E},E.locale=D,E.isDayjs=U,E.unix=function(R){return E(1e3*R)},E.en=S[T],E.Ls=S,E.p={},E})})(ibe);var L4e=ibe.exports;const F4e=y4(L4e);function B4e({toggleUnscheduled:t,schedulingActive:e,controlAnchor:i,scheduledDate:n,courtsCount:r,setDate:o}={}){if(!i)return;let a;const s=f=>F4e(f).format("dddd MMM D"),{startDate:l,endDate:c}=yg.getCompetitionDateRange(),d=Di.generateDateRange(l,c).map(f=>({onClick:()=>vt(o)&&o(f),isActive:f===n,label:s(f),value:f,close:!0})),p=()=>{},h=[{clearSearch:()=>p(),placeholder:"Search participants",id:"searchParticipants",visible:!!r,location:Lt,search:!0},{options:[{label:"Team ",onClick:()=>console.log("team clicked"),close:!0}],label:"Highlight team",visible:!!r,id:"highlightTeam",location:Lt,align:Lt},{visible:!!r&&!e,onClick:t,label:"Schedule matches",id:"scheduleMatchUps",intent:"is-primary",location:Ut},{label:s(n||l),value:n||l,id:gle,options:d,modifyLabel:!0,intent:"is-info",location:Ut,align:Ut}];return a=Da({target:i,items:h}).elements,{elements:a}}function nbe({scheduledDate:t}){let e;const i=document.getElementById(Tle),n=document.getElementById(Mz),r=document.getElementById(Rz);n.style.paddingBottom="1em",r.style.paddingBottom="1em";let o=Qe.state.schedulingActive;i.style.display=o?"":ht,t=t||yg.getCompetitionDateRange().startDate;const{replaceTableData:a,table:s,unscheduledMatchUps:l}=u4e({scheduledDate:t}),c=()=>{o=!o,Qe.state.schedulingActive=o,i.style.display=o?"":ht,e!=null&&e.scheduleMatchUps&&(e.scheduleMatchUps.style.display=o?ht:"")},{replaceTableData:u,table:d,courtsCount:p}=_4e({scheduledDate:t});O4e({controlAnchor:n,matchUps:l,table:s,updateUnscheduledTable:a,updateScheduleTable:u,toggleUnscheduled:c,scheduledDate:t}),e=B4e({table:d,unscheduledMatchUps:l,updateScheduleTable:u,toggleUnscheduled:c,schedulingActive:o,controlAnchor:r,scheduledDate:t,courtsCount:p,setDate:f=>{Qe.displayed.schedule_day=f,a({scheduledDate:f}),u({scheduledDate:f})}}).elements}const{SUBSTITUTION:F9,PENALTY:B9,REMOVE_PARTICIPANT:$9,REPLACE_PARTICIPANT:V9}=IH,{POLICY_TYPE_MATCHUP_ACTIONS:$4e}=rg,{ASSIGN_PARTICIPANT:v$}=$y,{TEAM:V4e,DOUBLES:rbe}=ps,j4e=Di.extractAttributes;function XU(t,e,i,n){var v;if(!e)return;const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(y=>y.remove());return}const a=e.getRow().getData(),s=e.getColumn().getDefinition(),l=a.matchUpType===rbe,c=a.eventType===V4e,{matchUpId:u,drawId:d}=a,p=s.field==="side1"&&1||s.field==="side2"&&2,{validActions:h}=Ye.matchUpActions({matchUpId:u,drawId:d,sideNumber:p,policyDefinitions:{[$4e]:{substituteAfterCompleted:!0,substituteWithoutScore:!0}}}),f=(v=n==null?void 0:n.individualParticipant)==null?void 0:v.participantId,m={[v$]:{params:{data:a,sideNumber:p,callback:i,isTeam:c,isDoubles:l},text:"Assign participant",method:tF},[B9]:{onClick:()=>console.log({data:a}),text:"Assess penalty"},[$9]:{params:{data:a,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Remove participant",method:H4e},[V9]:{params:{data:a,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},text:"Replace participant",method:tF},[F9]:{params:{data:a,sideNumber:p,callback:i,isTeam:c,isDoubles:l,clickedParticipantId:f},method:tF,text:"Substitution"}},g=h.filter(({type:y})=>[v$,B9,$9,V9,F9].includes(y)).map(y=>{const b=m[y.type];return{onClick:()=>{vt(b.method)?b.method({...b.params,action:y}):vt(b.onClick)&&b.onClick()},text:b.text}});g.length===1?g[0].onClick():g.length>0&&(t!=null&&t.target)&&bl({items:g,target:t.target,config:{placement:Rf}})}function H4e(t){const{action:e,callback:i,clickedParticipantId:n}=t;e.payload.participantId=n;const r=[{method:e.method,params:e.payload}];xt({methods:r,callback:a=>vt(i)&&i(a)})}function tF(t){var m;const{sideNumber:e,callback:i,isTeam:n,isDoubles:r,data:o}=t,a=t.action.availableParticipants,s=o.matchUp.matchUpType,l=o.matchUp.sides.find(g=>e===g.sideNumber),c=(m=l==null?void 0:l.participant)==null?void 0:m.individualParticipantIds,u=t.clickedParticipantId;QC({selectedParticipantIds:c,selectOnEnter:!0,selectionLimit:s===rbe&&!u?2:1,onSelection:g=>{if(g.participantId||g.selected){const v=[];(Array.isArray(g.selected)?g.selected.map(j4e("participantId")):[g.participantId]).filter(Boolean).forEach(I=>{v.push({params:{...t.action.payload,substituteParticipantId:I,newParticipantId:I,existingParticipantId:u,participantId:I},method:t.action.method})}),xt({methods:v,callback:I=>{vt(i)&&i(I)}})}},action:{type:v$,participantsAvailable:a},title:n&&r?"Doubles: Select participants":void 0})}function obe(t,e){return t.pctSpread&&!e.pctSpread?-1:e.pctSpread&&!t.pctSpread?1:!t.pctSpread&&!e.pctSpread?0:e.pctSpread-t.pctSpread}function abe(t){var a;const e=t.getRow().getData();if(!((a=e.competitiveProfile)!=null&&a.competitiveness))return;const{competitiveProfile:i,score:n}=e,r=document.createElement("span"),o={COMPETITIVE:"green",DECISIVE:"magenta",ROUTINE:"blue"};if(n){const{competitiveness:s}=i;r.style="font-size: smaller",r.style.color=o[s],r.innerHTML=s}return r}function W4(t){const e=t.getRow().getData();if(!e.readyToScore)return;const i=e.matchUp.matchUpStatus==="WALKOVER",n=document.createElement("span");return n.classList.add("scoreCell"),e.score?(n.style="font-size: smaller",n.innerHTML=e.score):i?n.innerHTML="WO":(n.style="color: blue; font-size: smaller",n.innerHTML="Enter score"),n}function j9(t){const e=document.createElement("div");return e.style="font-weight: bold",e.innerHTML=t.getValue(),e}function q4({pointerEvent:t,cell:e,matchUp:i,callback:n}){const r=Array.from(document.querySelectorAll(".tippy-content"));if(r.length){r.forEach(u=>u.remove());return}const o=!(i!=null&&i.roundPosition)&&!(i!=null&&i.drawPositions),a=e&&t.target.getElementsByClassName("fa-ellipsis-vertical")[0],s=(e==null?void 0:e.getRow().getData())||i,l=()=>{vt(n)&&n(s)},c=[{onClick:l,text:"Schedule"},{onClick:l,text:"Start time"},{onClick:l,text:"End time"},{onClick:l,text:"Set referee"}];o&&c.push({onClick:()=>G4e({...i,callback:l}),text:"Delete match",color:"red"}),bl({items:c,target:a||t.target,config:{placement:Rf}})}function G4e({drawId:t,structureId:e,matchUpId:i,callback:n}){xt({methods:[{method:kye,params:{matchUpIds:[i],removeIncomplete:!0,removeCompleted:!0,structureId:e,drawId:t}}],callback:a=>{a.success?vt(n)&&n():console.log({postMutationError:a.error})}})}const H9=t=>e=>{const i=document.createElement("div");return i.className="has-text-warning-dark",i.innerHTML="Select participant",(e.getValue().participantName&&Ib(t)(e,i))??i},iE=t=>({cell:e,event:i,...n})=>{XU(i,e,o=>{if(o.success){const a=e.getRow(),{drawId:s,matchUpId:l}=t,c=Ye.findMatchUp({drawId:s,matchUpId:l}).matchUp,u=a.getData().matchUp.collectionId,p=c.tieMatchUps.filter(f=>f.collectionId===u).map(f=>tS({...f,dualMatchUp:t})),h=e.getTable();h.updateData(p),h.redraw(!0)}},n)},vN=function(){let t,e={elapsed:1e5,held:void 0,touched:void 0,holdTime:800,holdAction:void 0,holdActions:{}};const i={};let n={};const r=(d,p)=>d.filter(h=>p.indexOf(h)!==-1).filter((h,f,m)=>m.indexOf(h)===f);e.reset=()=>(n={},e),e.register=(d,p,h,f)=>(typeof h=="function"&&(n[p]||(n[p]={},i[p]=[]),n[p][d]={fx:h,delay:f},i[p]=Object.keys(n[p])),e),e.deRegister=(d,p)=>(n[p]&&(delete n[p][d],i[p]=Object.keys(n[p])),e),e.call=(d,p,...h)=>{var f,m;return(m=(f=n==null?void 0:n[p])==null?void 0:f[d])==null?void 0:m.fx(...h)},e.trigger=(d,p,h,f)=>n[p][d].fx(h,f,p),e.list=()=>console.log(n);const o="ontouchstart"in document.documentElement?"touchstart":"click";document.addEventListener(o,d=>s({evt:d,evnt:"tap"})),document.addEventListener("change",d=>s({evt:d,evnt:"change"})),document.addEventListener("click",d=>s({evt:d,evnt:"click"})),document.addEventListener("mouseover",d=>s({evt:d,evnt:"mouseover",stopPropagation:!1})),document.addEventListener("mouseout",d=>s({evt:d,evnt:"mouseout",stopPropagation:!1})),document.addEventListener("keyup",d=>s({evt:d,evnt:"keyup",stopPropagation:!1}));let a=0;function s({evt:d,evnt:p,stopPropagation:h=!0}){h&&d.stopPropagation();const f={x:d.clientX,y:d.clientY,pageX:d.pageX,pageY:d.pageY};let m=Array.from(d.target.classList),g=m.length&&i[p]?r(m,i[p]):[];if(g.length){let v=new Date().getTime();e.elapsed=v-a,a=v,g.forEach(y=>{l({cls:y,evt:d,evnt:p,mouse:f})})}}function l({cls:d,evt:p,evnt:h,mouse:f}){let m=p.target;n[h][d].fx(m,f,h,p)}document.addEventListener("touchstart",d=>{e.touched=d.target,e.coords=[d.touches[0].clientX,d.touches[0].clientY],e.touched&&(t=setTimeout(function(){u()},e.holdTime))},!1),document.addEventListener("touchend",function(){c()},!1),document.addEventListener("touchmove",function(d){e.touched!==d.target&&c()},!1);function c(){clearTimeout(t)}function u(){typeof e.holdAction=="function"&&(e.held=e.touched,e.holdAction(e.held,e.coords))}return function(){let d=!1,p,h="";function f(){clearTimeout(p),d=!0,h!=="can-touch"&&(h="can-touch",document.documentElement.classList.add(h)),p=setTimeout(function(){d=!1},500)}function m(){!d&&h==="can-touch"&&(d=!1,h="",document.documentElement.classList.remove("can-touch"))}document.addEventListener("touchstart",f,!1),document.addEventListener("mouseover",m,!1)}(),e}(),z4e=""+new URL("completed-DD-jSIm6.png",import.meta.url).href;function sbe(t){return Object.assign({},...Object.keys(t).map(e=>({[e]:{id:t[e],element:document.getElementById(t[e])}})))}const W4e=function(){let t={};t.display=({muid:l,teams:c})=>{let u={scoreboard:"sbId"},{ids:d,html:p}=e({muid:l,teams:c});return lr({content:p,config:{maxWidth:450}}),Object.assign(d,u),sbe(d)};function e({muid:l,teams:c,round_name:u,match:d}){let p={root:"sb-root",actions:"sb-actions",favorite:"sb-favorite",scoring:"sb-scoring",delegate:"sb-delegate",docs:"sb-docs",clear:"sb-clear",cancel:"sb-cancel",accept:"sb-accept",p1action:"sb-p1action",p2action:"sb-p2action",p1scores:"sb-p1scores",p2scores:"sb-p2score",round_name:"sb-round-name",p1scores_e:"sb-p1scores-e",p2scores_e:"sb-p2scores-e",p1selector:"sb-p1selector",p2selector:"sb-p2selector",p1tiebreak:"sb-p1tiebreak",p2tiebreak:"sb-p2tiebreak",details:"sb-details"},h=i();Object.assign(p,h.ids);let f=`
         <div id="${p.root}" class="scoreboard noselect muid ${p.root}" muid='${l}'>
            <div class='scorebox'>
               <div class='info'>
                  <span class="info-text">
                     <span class="round_name" id='${p.round_name}'>${u||""}</span>
                  </span>
                  <div id='${p.favorite}' class='fav favoriteMatch' style='display: none'></div>
                  <div id='${p.scoring}' class='options' style='display: none'>-</div>
               </div>
               <div class='sbox'>
                  <div class='sbcol flexgrow'> 
                     <div class="opponent opponent0">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${a({team:c[0],index:0})}
                              ${a({team:c[0],index:1})}
                           </div>
                        </div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div class="opponent-name">
                           <div class="name-detail">
                              ${a({team:c[1],index:0})}
                              ${a({team:c[1],index:1})}
                           </div>
                        </div>
                     </div>
                  </div>

                  <div class='sbcol'> 
                     <div class="opponent opponent0">
                        <div id="${p.p1scores}" class="opponent-scores"></div>
                        <div id="${p.p1selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p1tiebreak}"> </div>
                        <div id="${p.p1scores_e}" class="opponent-scores"></div>
                     </div>
               
                     <div class="opponent opponent1">
                        <div id="${p.p2scores}" class="opponent-scores"></div>
                        <div id="${p.p2selector}" class="score-selector"></div>
                        <div class="score-selector tbinput"> <input id="${p.p2tiebreak}"> </div>
                        <div id="${p.p2scores_e}" class="opponent-scores"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">
                        <div id="${p.p1action}" class="score-action"></div>
                     </div>
                     <div class="opponent opponent1">
                        <div id="${p.p2action}" class="score-action"></div>
                     </div>
                  </div>

                  <div class='sbcol'>
                     <div class="opponent opponent0">&nbsp;</div>
                     <div class="opponent opponent1">&nbsp;</div>
                  </div>

               </div>
               <div class="info">
                  <span class="info-text"> <span id="${p.details}" class="court">${r(d)}</span> </span>
                  <div id='${p.delegate}' class='options' style='display: none'>&#x25B7;</div>
               </div>
            </div>

            ${h.html}

            <div id='${p.actions}' class="scoreboard-action">
               <div class="edit flexcol">
                  <div class="frame">
                     <div class="scoreboard-actions">
                        <button id='${p.cancel}' class='btn dismiss'>${Fn.tr("actions.cancel")}</button>
                        <button id='${p.clear}' class='btn dismiss'>${Fn.tr("clr")}</button>
                        <button id='${p.accept}' class='btn accept'>${Fn.tr("apt")}</button>
                     </div>
                  </div>
               </div>
            </div>

         </div>
      `;return{ids:p,html:f}}function i(){let l={edit_scoring:"sbcfg-edit",bestof:"sbcfg-bestof",setsto:"sbcfg-setsto",tiebreaksat:"sbcfg-tiebreasat",tiebreaksto:"sbcfg-tiebreaksto",finalset:"sbcfg-finalset",supertiebreakto:"sbcfg-supertbto",stb2:"sbcfg-stb2"},c=`
            <div id='${l.edit_scoring}' class="scoreboard-config scoreboard-action">
               <div class="edit configure sb_flexrow">
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Fn.tr("scoring_format.bestof")}</div>
                     <div style='text-align: right'>${Fn.tr("scoring_format.tbat")}</div>
                     <div style='text-align: right'>${Fn.tr("scoring_format.finalset")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.bestof}" class="score-selector"></div>
                     <div id="${l.tiebreaksat}" class="score-selector"></div>
                     <div id="${l.finalset}" class="score-selector"></div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div style='text-align: right'>${Fn.tr("scoring_format.setsto")}</div>
                     <div style='text-align: right'>${Fn.tr("scoring_format.tbto")}</div>
                     <div id='${l.stb2}' style='text-align: right'>${Fn.tr("scoring_format.superto")}</div>
                  </div>
                  <div class='flexcol' style='width: 25%'>
                     <div id="${l.setsto}" class="score-selector"></div>
                     <div id="${l.tiebreaksto}" class="score-selector"></div>
                     <div id="${l.supertiebreakto}" class="score-selector"></div>
                  </div>
               </div>
            </div>
      `;return{ids:l,html:c}}const n=(l,c)=>{let u=parseInt(l,10),d=Math.floor(u/3600),p=Math.floor((u-d*3600)/60),h=u-d*3600-p*60,f=!c||(c==null?void 0:c.display_seconds),m=!c||(c==null?void 0:c.pad_hours);return d<10&&m&&(d="0"+d),p<10&&(p="0"+p),h<10&&(h="0"+h),f?d+":"+p+":"+h:d+":"+p};function r(l){if(!l)return"";if(l.status)return l.status;if(!l.schedule)return"";let c=o(l.schedule);if(c)return`Duration ${c}`;let u=`${l.schedule.time_prefix||""}${l.schedule.time||""}`,d=`${l.schedule.court||""}${u?" / "+u:""}`;return l.winner_index===void 0?d:""}function o(l){if(!l.start||!l.end)return"";let c=s(l.end)-s(l.start);return n(c,{pad_hours:!1,display_seconds:!1})}function a({team:l,index:c=0}){var p,h;if(c===1)return"";const u=(p=l.person)==null?void 0:p.nationalityCode;return`
         <div class="team_player">
            <span class="pad">${u?(h=iw.countryToFlag(u))==null?void 0:h.slice(0,4):""}</span>
            <span class="pad">${l.participantName}</span>
            <span class="pad"></span>
         </div>
      `}function s(l){let c=l.split(":");return c[0]*60*60+c[1]*60}return t}();function lbe(t,e){if(!t||!e)return;let i=Object.keys(t),n=Object.keys(e);for(let r of i)if(n.indexOf(r)>=0){let o=e[r],a=t[r];typeof o=="object"&&typeof a!="function"&&o.constructor!==Array?lbe(t[r],e[r]):e[r]=t[r]}}function cbe(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function q4e(t){return t.length===1&&(t=Y4e(t)),{left:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var o=n+r>>>1;t(e[o],i)<0?n=o+1:r=o}return n},right:function(e,i,n,r){for(n==null&&(n=0),r==null&&(r=e.length);n<r;){var o=n+r>>>1;t(e[o],i)>0?r=o:n=o+1}return n}}}function Y4e(t){return function(e,i){return cbe(t(e),i)}}q4e(cbe);var K4e={value:function(){}};function ube(){for(var t=0,e=arguments.length,i={},n;t<e;++t){if(!(n=arguments[t]+"")||n in i||/[\s.]/.test(n))throw new Error("illegal type: "+n);i[n]=[]}return new sM(i)}function sM(t){this._=t}function Z4e(t,e){return t.trim().split(/^|\s+/).map(function(i){var n="",r=i.indexOf(".");if(r>=0&&(n=i.slice(r+1),i=i.slice(0,r)),i&&!e.hasOwnProperty(i))throw new Error("unknown type: "+i);return{type:i,name:n}})}sM.prototype=ube.prototype={constructor:sM,on:function(t,e){var i=this._,n=Z4e(t+"",i),r,o=-1,a=n.length;if(arguments.length<2){for(;++o<a;)if((r=(t=n[o]).type)&&(r=X4e(i[r],t.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<a;)if(r=(t=n[o]).type)i[r]=G9(i[r],t.name,e);else if(e==null)for(r in i)i[r]=G9(i[r],t.name,null);return this},copy:function(){var t={},e=this._;for(var i in e)t[i]=e[i].slice();return new sM(t)},call:function(t,e){if((r=arguments.length-2)>0)for(var i=new Array(r),n=0,r,o;n<r;++n)i[n]=arguments[n+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(o=this._[t],n=0,r=o.length;n<r;++n)o[n].value.apply(e,i)},apply:function(t,e,i){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var n=this._[t],r=0,o=n.length;r<o;++r)n[r].value.apply(e,i)}};function X4e(t,e){for(var i=0,n=t.length,r;i<n;++i)if((r=t[i]).name===e)return r.value}function G9(t,e,i){for(var n=0,r=t.length;n<r;++n)if(t[n].name===e){t[n]=K4e,t=t.slice(0,n).concat(t.slice(n+1));break}return i!=null&&t.push({name:e,value:i}),t}var y$="http://www.w3.org/1999/xhtml";const z9={svg:"http://www.w3.org/2000/svg",xhtml:y$,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Yx(t){var e=t+="",i=e.indexOf(":");return i>=0&&(e=t.slice(0,i))!=="xmlns"&&(t=t.slice(i+1)),z9.hasOwnProperty(e)?{space:z9[e],local:t}:t}function J4e(t){return function(){var e=this.ownerDocument,i=this.namespaceURI;return i===y$&&e.documentElement.namespaceURI===y$?e.createElement(t):e.createElementNS(i,t)}}function Q4e(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function dbe(t){var e=Yx(t);return(e.local?Q4e:J4e)(e)}function e5e(){}function Y4(t){return t==null?e5e:function(){return this.querySelector(t)}}function t5e(t){typeof t!="function"&&(t=Y4(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var o=e[r],a=o.length,s=n[r]=new Array(a),l,c,u=0;u<a;++u)(l=o[u])&&(c=t.call(l,l.__data__,u,o))&&("__data__"in l&&(c.__data__=l.__data__),s[u]=c);return new zc(n,this._parents)}function i5e(){return[]}function pbe(t){return t==null?i5e:function(){return this.querySelectorAll(t)}}function n5e(t){typeof t!="function"&&(t=pbe(t));for(var e=this._groups,i=e.length,n=[],r=[],o=0;o<i;++o)for(var a=e[o],s=a.length,l,c=0;c<s;++c)(l=a[c])&&(n.push(t.call(l,l.__data__,c,a)),r.push(l));return new zc(n,r)}function hbe(t){return function(){return this.matches(t)}}function r5e(t){typeof t!="function"&&(t=hbe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var o=e[r],a=o.length,s=n[r]=[],l,c=0;c<a;++c)(l=o[c])&&t.call(l,l.__data__,c,o)&&s.push(l);return new zc(n,this._parents)}function fbe(t){return new Array(t.length)}function o5e(){return new zc(this._enter||this._groups.map(fbe),this._parents)}function yN(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}yN.prototype={constructor:yN,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function a5e(t){return function(){return t}}var W9="$";function s5e(t,e,i,n,r,o){for(var a=0,s,l=e.length,c=o.length;a<c;++a)(s=e[a])?(s.__data__=o[a],n[a]=s):i[a]=new yN(t,o[a]);for(;a<l;++a)(s=e[a])&&(r[a]=s)}function l5e(t,e,i,n,r,o,a){var s,l,c={},u=e.length,d=o.length,p=new Array(u),h;for(s=0;s<u;++s)(l=e[s])&&(p[s]=h=W9+a.call(l,l.__data__,s,e),h in c?r[s]=l:c[h]=l);for(s=0;s<d;++s)h=W9+a.call(t,o[s],s,o),(l=c[h])?(n[s]=l,l.__data__=o[s],c[h]=null):i[s]=new yN(t,o[s]);for(s=0;s<u;++s)(l=e[s])&&c[p[s]]===l&&(r[s]=l)}function c5e(t,e){if(!t)return h=new Array(this.size()),c=-1,this.each(function(S){h[++c]=S}),h;var i=e?l5e:s5e,n=this._parents,r=this._groups;typeof t!="function"&&(t=a5e(t));for(var o=r.length,a=new Array(o),s=new Array(o),l=new Array(o),c=0;c<o;++c){var u=n[c],d=r[c],p=d.length,h=t.call(u,u&&u.__data__,c,n),f=h.length,m=s[c]=new Array(f),g=a[c]=new Array(f),v=l[c]=new Array(p);i(u,d,m,g,v,h,e);for(var y=0,b=0,I,T;y<f;++y)if(I=m[y]){for(y>=b&&(b=y+1);!(T=g[b])&&++b<f;);I._next=T||null}}return a=new zc(a,n),a._enter=s,a._exit=l,a}function u5e(){return new zc(this._exit||this._groups.map(fbe),this._parents)}function d5e(t,e,i){var n=this.enter(),r=this,o=this.exit();return n=typeof t=="function"?t(n):n.append(t+""),e!=null&&(r=e(r)),i==null?o.remove():i(o),n&&r?n.merge(r).order():r}function p5e(t){for(var e=this._groups,i=t._groups,n=e.length,r=i.length,o=Math.min(n,r),a=new Array(n),s=0;s<o;++s)for(var l=e[s],c=i[s],u=l.length,d=a[s]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;s<n;++s)a[s]=e[s];return new zc(a,this._parents)}function h5e(){for(var t=this._groups,e=-1,i=t.length;++e<i;)for(var n=t[e],r=n.length-1,o=n[r],a;--r>=0;)(a=n[r])&&(o&&a.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(a,o),o=a);return this}function f5e(t){t||(t=m5e);function e(d,p){return d&&p?t(d.__data__,p.__data__):!d-!p}for(var i=this._groups,n=i.length,r=new Array(n),o=0;o<n;++o){for(var a=i[o],s=a.length,l=r[o]=new Array(s),c,u=0;u<s;++u)(c=a[u])&&(l[u]=c);l.sort(e)}return new zc(r,this._parents).order()}function m5e(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function g5e(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function v5e(){var t=new Array(this.size()),e=-1;return this.each(function(){t[++e]=this}),t}function y5e(){for(var t=this._groups,e=0,i=t.length;e<i;++e)for(var n=t[e],r=0,o=n.length;r<o;++r){var a=n[r];if(a)return a}return null}function b5e(){var t=0;return this.each(function(){++t}),t}function I5e(){return!this.node()}function w5e(t){for(var e=this._groups,i=0,n=e.length;i<n;++i)for(var r=e[i],o=0,a=r.length,s;o<a;++o)(s=r[o])&&t.call(s,s.__data__,o,r);return this}function S5e(t){return function(){this.removeAttribute(t)}}function T5e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function U5e(t,e){return function(){this.setAttribute(t,e)}}function D5e(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function P5e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttribute(t):this.setAttribute(t,i)}}function C5e(t,e){return function(){var i=e.apply(this,arguments);i==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,i)}}function E5e(t,e){var i=Yx(t);if(arguments.length<2){var n=this.node();return i.local?n.getAttributeNS(i.space,i.local):n.getAttribute(i)}return this.each((e==null?i.local?T5e:S5e:typeof e=="function"?i.local?C5e:P5e:i.local?D5e:U5e)(i,e))}function mbe(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function M5e(t){return function(){this.style.removeProperty(t)}}function R5e(t,e,i){return function(){this.style.setProperty(t,e,i)}}function N5e(t,e,i){return function(){var n=e.apply(this,arguments);n==null?this.style.removeProperty(t):this.style.setProperty(t,n,i)}}function A5e(t,e,i){return arguments.length>1?this.each((e==null?M5e:typeof e=="function"?N5e:R5e)(t,e,i??"")):$w(this.node(),t)}function $w(t,e){return t.style.getPropertyValue(e)||mbe(t).getComputedStyle(t,null).getPropertyValue(e)}function _5e(t){return function(){delete this[t]}}function k5e(t,e){return function(){this[t]=e}}function x5e(t,e){return function(){var i=e.apply(this,arguments);i==null?delete this[t]:this[t]=i}}function O5e(t,e){return arguments.length>1?this.each((e==null?_5e:typeof e=="function"?x5e:k5e)(t,e)):this.node()[t]}function gbe(t){return t.trim().split(/^|\s+/)}function K4(t){return t.classList||new vbe(t)}function vbe(t){this._node=t,this._names=gbe(t.getAttribute("class")||"")}vbe.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function ybe(t,e){for(var i=K4(t),n=-1,r=e.length;++n<r;)i.add(e[n])}function bbe(t,e){for(var i=K4(t),n=-1,r=e.length;++n<r;)i.remove(e[n])}function L5e(t){return function(){ybe(this,t)}}function F5e(t){return function(){bbe(this,t)}}function B5e(t,e){return function(){(e.apply(this,arguments)?ybe:bbe)(this,t)}}function $5e(t,e){var i=gbe(t+"");if(arguments.length<2){for(var n=K4(this.node()),r=-1,o=i.length;++r<o;)if(!n.contains(i[r]))return!1;return!0}return this.each((typeof e=="function"?B5e:e?L5e:F5e)(i,e))}function V5e(){this.textContent=""}function j5e(t){return function(){this.textContent=t}}function H5e(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function G5e(t){return arguments.length?this.each(t==null?V5e:(typeof t=="function"?H5e:j5e)(t)):this.node().textContent}function z5e(){this.innerHTML=""}function W5e(t){return function(){this.innerHTML=t}}function q5e(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function Y5e(t){return arguments.length?this.each(t==null?z5e:(typeof t=="function"?q5e:W5e)(t)):this.node().innerHTML}function K5e(){this.nextSibling&&this.parentNode.appendChild(this)}function Z5e(){return this.each(K5e)}function X5e(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function J5e(){return this.each(X5e)}function Q5e(t){var e=typeof t=="function"?t:dbe(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function e6e(){return null}function t6e(t,e){var i=typeof t=="function"?t:dbe(t),n=e==null?e6e:typeof e=="function"?e:Y4(e);return this.select(function(){return this.insertBefore(i.apply(this,arguments),n.apply(this,arguments)||null)})}function i6e(){var t=this.parentNode;t&&t.removeChild(this)}function n6e(){return this.each(i6e)}function r6e(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function o6e(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function a6e(t){return this.select(t?o6e:r6e)}function s6e(t){return arguments.length?this.property("__data__",t):this.node().__data__}var Ibe={};if(typeof document<"u"){var l6e=document.documentElement;"onmouseenter"in l6e||(Ibe={mouseenter:"mouseover",mouseleave:"mouseout"})}function c6e(t,e,i){return t=wbe(t,e,i),function(n){var r=n.relatedTarget;(!r||r!==this&&!(r.compareDocumentPosition(this)&8))&&t.call(this,n)}}function wbe(t,e,i){return function(n){try{t.call(this,this.__data__,e,i)}finally{}}}function u6e(t){return t.trim().split(/^|\s+/).map(function(e){var i="",n=e.indexOf(".");return n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),{type:e,name:i}})}function d6e(t){return function(){var e=this.__on;if(e){for(var i=0,n=-1,r=e.length,o;i<r;++i)o=e[i],(!t.type||o.type===t.type)&&o.name===t.name?this.removeEventListener(o.type,o.listener,o.capture):e[++n]=o;++n?e.length=n:delete this.__on}}}function p6e(t,e,i){var n=Ibe.hasOwnProperty(t.type)?c6e:wbe;return function(r,o,a){var s=this.__on,l,c=n(e,o,a);if(s){for(var u=0,d=s.length;u<d;++u)if((l=s[u]).type===t.type&&l.name===t.name){this.removeEventListener(l.type,l.listener,l.capture),this.addEventListener(l.type,l.listener=c,l.capture=i),l.value=e;return}}this.addEventListener(t.type,c,i),l={type:t.type,name:t.name,value:e,listener:c,capture:i},s?s.push(l):this.__on=[l]}}function h6e(t,e,i){var n=u6e(t+""),r,o=n.length,a;if(arguments.length<2){var s=this.node().__on;if(s){for(var l=0,c=s.length,u;l<c;++l)for(r=0,u=s[l];r<o;++r)if((a=n[r]).type===u.type&&a.name===u.name)return u.value}return}for(s=e?p6e:d6e,i==null&&(i=!1),r=0;r<o;++r)this.each(s(n[r],e,i));return this}function Sbe(t,e,i){var n=mbe(t),r=n.CustomEvent;typeof r=="function"?r=new r(e,i):(r=n.document.createEvent("Event"),i?(r.initEvent(e,i.bubbles,i.cancelable),r.detail=i.detail):r.initEvent(e,!1,!1)),t.dispatchEvent(r)}function f6e(t,e){return function(){return Sbe(this,t,e)}}function m6e(t,e){return function(){return Sbe(this,t,e.apply(this,arguments))}}function g6e(t,e){return this.each((typeof e=="function"?m6e:f6e)(t,e))}var Tbe=[null];function zc(t,e){this._groups=t,this._parents=e}function e1(){return new zc([[document.documentElement]],Tbe)}zc.prototype=e1.prototype={constructor:zc,select:t5e,selectAll:n5e,filter:r5e,data:c5e,enter:o5e,exit:u5e,join:d5e,merge:p5e,order:h5e,sort:f5e,call:g5e,nodes:v5e,node:y5e,size:b5e,empty:I5e,each:w5e,attr:E5e,style:A5e,property:O5e,classed:$5e,text:G5e,html:Y5e,raise:Z5e,lower:J5e,append:Q5e,insert:t6e,remove:n6e,clone:a6e,datum:s6e,on:h6e,dispatch:g6e};function Ube(t){return typeof t=="string"?new zc([[document.querySelector(t)]],[document.documentElement]):new zc([[t]],Tbe)}function Z4(t,e,i){t.prototype=e.prototype=i,i.constructor=t}function Dbe(t,e){var i=Object.create(t.prototype);for(var n in e)i[n]=e[n];return i}function t1(){}var JU=.7,bN=1/JU,EI="\\s*([+-]?\\d+)\\s*",QU="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",pp="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",v6e=/^#([0-9a-f]{3,8})$/,y6e=new RegExp("^rgb\\("+[EI,EI,EI]+"\\)$"),b6e=new RegExp("^rgb\\("+[pp,pp,pp]+"\\)$"),I6e=new RegExp("^rgba\\("+[EI,EI,EI,QU]+"\\)$"),w6e=new RegExp("^rgba\\("+[pp,pp,pp,QU]+"\\)$"),S6e=new RegExp("^hsl\\("+[QU,pp,pp]+"\\)$"),T6e=new RegExp("^hsla\\("+[QU,pp,pp,QU]+"\\)$"),q9={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Z4(t1,eD,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:Y9,formatHex:Y9,formatHsl:U6e,formatRgb:K9,toString:K9});function Y9(){return this.rgb().formatHex()}function U6e(){return Pbe(this).formatHsl()}function K9(){return this.rgb().formatRgb()}function eD(t){var e,i;return t=(t+"").trim().toLowerCase(),(e=v6e.exec(t))?(i=e[1].length,e=parseInt(e[1],16),i===6?Z9(e):i===3?new Uc(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):i===8?nE(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):i===4?nE(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=y6e.exec(t))?new Uc(e[1],e[2],e[3],1):(e=b6e.exec(t))?new Uc(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=I6e.exec(t))?nE(e[1],e[2],e[3],e[4]):(e=w6e.exec(t))?nE(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=S6e.exec(t))?Q9(e[1],e[2]/100,e[3]/100,1):(e=T6e.exec(t))?Q9(e[1],e[2]/100,e[3]/100,e[4]):q9.hasOwnProperty(t)?Z9(q9[t]):t==="transparent"?new Uc(NaN,NaN,NaN,0):null}function Z9(t){return new Uc(t>>16&255,t>>8&255,t&255,1)}function nE(t,e,i,n){return n<=0&&(t=e=i=NaN),new Uc(t,e,i,n)}function D6e(t){return t instanceof t1||(t=eD(t)),t?(t=t.rgb(),new Uc(t.r,t.g,t.b,t.opacity)):new Uc}function b$(t,e,i,n){return arguments.length===1?D6e(t):new Uc(t,e,i,n??1)}function Uc(t,e,i,n){this.r=+t,this.g=+e,this.b=+i,this.opacity=+n}Z4(Uc,b$,Dbe(t1,{brighter:function(t){return t=t==null?bN:Math.pow(bN,t),new Uc(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=t==null?JU:Math.pow(JU,t),new Uc(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:X9,formatHex:X9,formatRgb:J9,toString:J9}));function X9(){return"#"+iF(this.r)+iF(this.g)+iF(this.b)}function J9(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(t===1?")":", "+t+")")}function iF(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function Q9(t,e,i,n){return n<=0?t=e=i=NaN:i<=0||i>=1?t=e=NaN:e<=0&&(t=NaN),new Xd(t,e,i,n)}function Pbe(t){if(t instanceof Xd)return new Xd(t.h,t.s,t.l,t.opacity);if(t instanceof t1||(t=eD(t)),!t)return new Xd;if(t instanceof Xd)return t;t=t.rgb();var e=t.r/255,i=t.g/255,n=t.b/255,r=Math.min(e,i,n),o=Math.max(e,i,n),a=NaN,s=o-r,l=(o+r)/2;return s?(e===o?a=(i-n)/s+(i<n)*6:i===o?a=(n-e)/s+2:a=(e-i)/s+4,s/=l<.5?o+r:2-o-r,a*=60):s=l>0&&l<1?0:a,new Xd(a,s,l,t.opacity)}function P6e(t,e,i,n){return arguments.length===1?Pbe(t):new Xd(t,e,i,n??1)}function Xd(t,e,i,n){this.h=+t,this.s=+e,this.l=+i,this.opacity=+n}Z4(Xd,P6e,Dbe(t1,{brighter:function(t){return t=t==null?bN:Math.pow(bN,t),new Xd(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=t==null?JU:Math.pow(JU,t),new Xd(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,i=this.l,n=i+(i<.5?i:1-i)*e,r=2*i-n;return new Uc(nF(t>=240?t-240:t+120,r,n),nF(t,r,n),nF(t<120?t+240:t-120,r,n),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(t===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(t===1?")":", "+t+")")}}));function nF(t,e,i){return(t<60?e+(i-e)*t/60:t<180?i:t<240?e+(i-e)*(240-t)/60:e)*255}function Cbe(t){return function(){return t}}function C6e(t,e){return function(i){return t+i*e}}function E6e(t,e,i){return t=Math.pow(t,i),e=Math.pow(e,i)-t,i=1/i,function(n){return Math.pow(t+n*e,i)}}function M6e(t){return(t=+t)==1?Ebe:function(e,i){return i-e?E6e(e,i,t):Cbe(isNaN(e)?i:e)}}function Ebe(t,e){var i=e-t;return i?C6e(t,i):Cbe(isNaN(t)?e:t)}const eZ=function t(e){var i=M6e(e);function n(r,o){var a=i((r=b$(r)).r,(o=b$(o)).r),s=i(r.g,o.g),l=i(r.b,o.b),c=Ebe(r.opacity,o.opacity);return function(u){return r.r=a(u),r.g=s(u),r.b=l(u),r.opacity=c(u),r+""}}return n.gamma=t,n}(1);function am(t,e){return t=+t,e=+e,function(i){return t*(1-i)+e*i}}var I$=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rF=new RegExp(I$.source,"g");function R6e(t){return function(){return t}}function N6e(t){return function(e){return t(e)+""}}function A6e(t,e){var i=I$.lastIndex=rF.lastIndex=0,n,r,o,a=-1,s=[],l=[];for(t=t+"",e=e+"";(n=I$.exec(t))&&(r=rF.exec(e));)(o=r.index)>i&&(o=e.slice(i,o),s[a]?s[a]+=o:s[++a]=o),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,l.push({i:a,x:am(n,r)})),i=rF.lastIndex;return i<e.length&&(o=e.slice(i),s[a]?s[a]+=o:s[++a]=o),s.length<2?l[0]?N6e(l[0].x):R6e(e):(e=l.length,function(c){for(var u=0,d;u<e;++u)s[(d=l[u]).i]=d.x(c);return s.join("")})}var tZ=180/Math.PI,w$={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Mbe(t,e,i,n,r,o){var a,s,l;return(a=Math.sqrt(t*t+e*e))&&(t/=a,e/=a),(l=t*i+e*n)&&(i-=t*l,n-=e*l),(s=Math.sqrt(i*i+n*n))&&(i/=s,n/=s,l/=s),t*n<e*i&&(t=-t,e=-e,l=-l,a=-a),{translateX:r,translateY:o,rotate:Math.atan2(e,t)*tZ,skewX:Math.atan(l)*tZ,scaleX:a,scaleY:s}}var wS,oF,iZ,rE;function _6e(t){return t==="none"?w$:(wS||(wS=document.createElement("DIV"),oF=document.documentElement,iZ=document.defaultView),wS.style.transform=t,t=iZ.getComputedStyle(oF.appendChild(wS),null).getPropertyValue("transform"),oF.removeChild(wS),t=t.slice(7,-1).split(","),Mbe(+t[0],+t[1],+t[2],+t[3],+t[4],+t[5]))}function k6e(t){return t==null||(rE||(rE=document.createElementNS("http://www.w3.org/2000/svg","g")),rE.setAttribute("transform",t),!(t=rE.transform.baseVal.consolidate()))?w$:(t=t.matrix,Mbe(t.a,t.b,t.c,t.d,t.e,t.f))}function Rbe(t,e,i,n){function r(c){return c.length?c.pop()+" ":""}function o(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push("translate(",null,e,null,i);f.push({i:m-4,x:am(c,d)},{i:m-2,x:am(u,p)})}else(d||p)&&h.push("translate("+d+e+p+i)}function a(c,u,d,p){c!==u?(c-u>180?u+=360:u-c>180&&(c+=360),p.push({i:d.push(r(d)+"rotate(",null,n)-2,x:am(c,u)})):u&&d.push(r(d)+"rotate("+u+n)}function s(c,u,d,p){c!==u?p.push({i:d.push(r(d)+"skewX(",null,n)-2,x:am(c,u)}):u&&d.push(r(d)+"skewX("+u+n)}function l(c,u,d,p,h,f){if(c!==d||u!==p){var m=h.push(r(h)+"scale(",null,",",null,")");f.push({i:m-4,x:am(c,d)},{i:m-2,x:am(u,p)})}else(d!==1||p!==1)&&h.push(r(h)+"scale("+d+","+p+")")}return function(c,u){var d=[],p=[];return c=t(c),u=t(u),o(c.translateX,c.translateY,u.translateX,u.translateY,d,p),a(c.rotate,u.rotate,d,p),s(c.skewX,u.skewX,d,p),l(c.scaleX,c.scaleY,u.scaleX,u.scaleY,d,p),c=u=null,function(h){for(var f=-1,m=p.length,g;++f<m;)d[(g=p[f]).i]=g.x(h);return d.join("")}}}var x6e=Rbe(_6e,"px, ","px)","deg)"),O6e=Rbe(k6e,", ",")",")"),Vw=0,jS=0,SS=0,Nbe=1e3,IN,HS,wN=0,fy=0,Kx=0,tD=typeof performance=="object"&&performance.now?performance:Date,Abe=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Zx(){return fy||(Abe(L6e),fy=tD.now()+Kx)}function L6e(){fy=0}function SN(){this._call=this._time=this._next=null}SN.prototype=_be.prototype={constructor:SN,restart:function(t,e,i){if(typeof t!="function")throw new TypeError("callback is not a function");i=(i==null?Zx():+i)+(e==null?0:+e),!this._next&&HS!==this&&(HS?HS._next=this:IN=this,HS=this),this._call=t,this._time=i,S$()},stop:function(){this._call&&(this._call=null,this._time=1/0,S$())}};function _be(t,e,i){var n=new SN;return n.restart(t,e,i),n}function F6e(){Zx(),++Vw;for(var t=IN,e;t;)(e=fy-t._time)>=0&&t._call.call(null,e),t=t._next;--Vw}function nZ(){fy=(wN=tD.now())+Kx,Vw=jS=0;try{F6e()}finally{Vw=0,$6e(),fy=0}}function B6e(){var t=tD.now(),e=t-wN;e>Nbe&&(Kx-=e,wN=t)}function $6e(){for(var t,e=IN,i,n=1/0;e;)e._call?(n>e._time&&(n=e._time),t=e,e=e._next):(i=e._next,e._next=null,e=t?t._next=i:IN=i);HS=t,S$(n)}function S$(t){if(!Vw){jS&&(jS=clearTimeout(jS));var e=t-fy;e>24?(t<1/0&&(jS=setTimeout(nZ,t-tD.now()-Kx)),SS&&(SS=clearInterval(SS))):(SS||(wN=tD.now(),SS=setInterval(B6e,Nbe)),Vw=1,Abe(nZ))}}function rZ(t,e,i){var n=new SN;return e=e==null?0:+e,n.restart(function(r){n.stop(),t(r+e)},e,i),n}var V6e=ube("start","end","cancel","interrupt"),j6e=[],kbe=0,oZ=1,T$=2,lM=3,aZ=4,U$=5,cM=6;function Xx(t,e,i,n,r,o){var a=t.__transition;if(!a)t.__transition={};else if(i in a)return;H6e(t,i,{name:e,index:n,group:r,on:V6e,tween:j6e,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:kbe})}function X4(t,e){var i=Ld(t,e);if(i.state>kbe)throw new Error("too late; already scheduled");return i}function Lf(t,e){var i=Ld(t,e);if(i.state>lM)throw new Error("too late; already running");return i}function Ld(t,e){var i=t.__transition;if(!i||!(i=i[e]))throw new Error("transition not found");return i}function H6e(t,e,i){var n=t.__transition,r;n[e]=i,i.timer=_be(o,0,i.time);function o(c){i.state=oZ,i.timer.restart(a,i.delay,i.time),i.delay<=c&&a(c-i.delay)}function a(c){var u,d,p,h;if(i.state!==oZ)return l();for(u in n)if(h=n[u],h.name===i.name){if(h.state===lM)return rZ(a);h.state===aZ?(h.state=cM,h.timer.stop(),h.on.call("interrupt",t,t.__data__,h.index,h.group),delete n[u]):+u<e&&(h.state=cM,h.timer.stop(),h.on.call("cancel",t,t.__data__,h.index,h.group),delete n[u])}if(rZ(function(){i.state===lM&&(i.state=aZ,i.timer.restart(s,i.delay,i.time),s(c))}),i.state=T$,i.on.call("start",t,t.__data__,i.index,i.group),i.state===T$){for(i.state=lM,r=new Array(p=i.tween.length),u=0,d=-1;u<p;++u)(h=i.tween[u].value.call(t,t.__data__,i.index,i.group))&&(r[++d]=h);r.length=d+1}}function s(c){for(var u=c<i.duration?i.ease.call(null,c/i.duration):(i.timer.restart(l),i.state=U$,1),d=-1,p=r.length;++d<p;)r[d].call(t,u);i.state===U$&&(i.on.call("end",t,t.__data__,i.index,i.group),l())}function l(){i.state=cM,i.timer.stop(),delete n[e];for(var c in n)return;delete t.__transition}}function G6e(t,e){var i=t.__transition,n,r,o=!0,a;if(i){e=e==null?null:e+"";for(a in i){if((n=i[a]).name!==e){o=!1;continue}r=n.state>T$&&n.state<U$,n.state=cM,n.timer.stop(),n.on.call(r?"interrupt":"cancel",t,t.__data__,n.index,n.group),delete i[a]}o&&delete t.__transition}}function z6e(t){return this.each(function(){G6e(this,t)})}function W6e(t,e){var i,n;return function(){var r=Lf(this,t),o=r.tween;if(o!==i){n=i=o;for(var a=0,s=n.length;a<s;++a)if(n[a].name===e){n=n.slice(),n.splice(a,1);break}}r.tween=n}}function q6e(t,e,i){var n,r;if(typeof i!="function")throw new Error;return function(){var o=Lf(this,t),a=o.tween;if(a!==n){r=(n=a).slice();for(var s={name:e,value:i},l=0,c=r.length;l<c;++l)if(r[l].name===e){r[l]=s;break}l===c&&r.push(s)}o.tween=r}}function Y6e(t,e){var i=this._id;if(t+="",arguments.length<2){for(var n=Ld(this.node(),i).tween,r=0,o=n.length,a;r<o;++r)if((a=n[r]).name===t)return a.value;return null}return this.each((e==null?W6e:q6e)(i,t,e))}function J4(t,e,i){var n=t._id;return t.each(function(){var r=Lf(this,n);(r.value||(r.value={}))[e]=i.apply(this,arguments)}),function(r){return Ld(r,n).value[e]}}function xbe(t,e){var i;return(typeof e=="number"?am:e instanceof eD?eZ:(i=eD(e))?(e=i,eZ):A6e)(t,e)}function K6e(t){return function(){this.removeAttribute(t)}}function Z6e(t){return function(){this.removeAttributeNS(t.space,t.local)}}function X6e(t,e,i){var n,r=i+"",o;return function(){var a=this.getAttribute(t);return a===r?null:a===n?o:o=e(n=a,i)}}function J6e(t,e,i){var n,r=i+"",o;return function(){var a=this.getAttributeNS(t.space,t.local);return a===r?null:a===n?o:o=e(n=a,i)}}function Q6e(t,e,i){var n,r,o;return function(){var a,s=i(this),l;return s==null?void this.removeAttribute(t):(a=this.getAttribute(t),l=s+"",a===l?null:a===n&&l===r?o:(r=l,o=e(n=a,s)))}}function e7e(t,e,i){var n,r,o;return function(){var a,s=i(this),l;return s==null?void this.removeAttributeNS(t.space,t.local):(a=this.getAttributeNS(t.space,t.local),l=s+"",a===l?null:a===n&&l===r?o:(r=l,o=e(n=a,s)))}}function t7e(t,e){var i=Yx(t),n=i==="transform"?O6e:xbe;return this.attrTween(t,typeof e=="function"?(i.local?e7e:Q6e)(i,n,J4(this,"attr."+t,e)):e==null?(i.local?Z6e:K6e)(i):(i.local?J6e:X6e)(i,n,e))}function i7e(t,e){return function(i){this.setAttribute(t,e.call(this,i))}}function n7e(t,e){return function(i){this.setAttributeNS(t.space,t.local,e.call(this,i))}}function r7e(t,e){var i,n;function r(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&n7e(t,o)),i}return r._value=e,r}function o7e(t,e){var i,n;function r(){var o=e.apply(this,arguments);return o!==n&&(i=(n=o)&&i7e(t,o)),i}return r._value=e,r}function a7e(t,e){var i="attr."+t;if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;var n=Yx(t);return this.tween(i,(n.local?r7e:o7e)(n,e))}function s7e(t,e){return function(){X4(this,t).delay=+e.apply(this,arguments)}}function l7e(t,e){return e=+e,function(){X4(this,t).delay=e}}function c7e(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?s7e:l7e)(e,t)):Ld(this.node(),e).delay}function u7e(t,e){return function(){Lf(this,t).duration=+e.apply(this,arguments)}}function d7e(t,e){return e=+e,function(){Lf(this,t).duration=e}}function p7e(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?u7e:d7e)(e,t)):Ld(this.node(),e).duration}function h7e(t,e){if(typeof e!="function")throw new Error;return function(){Lf(this,t).ease=e}}function f7e(t){var e=this._id;return arguments.length?this.each(h7e(e,t)):Ld(this.node(),e).ease}function m7e(t){typeof t!="function"&&(t=hbe(t));for(var e=this._groups,i=e.length,n=new Array(i),r=0;r<i;++r)for(var o=e[r],a=o.length,s=n[r]=[],l,c=0;c<a;++c)(l=o[c])&&t.call(l,l.__data__,c,o)&&s.push(l);return new gf(n,this._parents,this._name,this._id)}function g7e(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,i=t._groups,n=e.length,r=i.length,o=Math.min(n,r),a=new Array(n),s=0;s<o;++s)for(var l=e[s],c=i[s],u=l.length,d=a[s]=new Array(u),p,h=0;h<u;++h)(p=l[h]||c[h])&&(d[h]=p);for(;s<n;++s)a[s]=e[s];return new gf(a,this._parents,this._name,this._id)}function v7e(t){return(t+"").trim().split(/^|\s+/).every(function(e){var i=e.indexOf(".");return i>=0&&(e=e.slice(0,i)),!e||e==="start"})}function y7e(t,e,i){var n,r,o=v7e(e)?X4:Lf;return function(){var a=o(this,t),s=a.on;s!==n&&(r=(n=s).copy()).on(e,i),a.on=r}}function b7e(t,e){var i=this._id;return arguments.length<2?Ld(this.node(),i).on.on(t):this.each(y7e(i,t,e))}function I7e(t){return function(){var e=this.parentNode;for(var i in this.__transition)if(+i!==t)return;e&&e.removeChild(this)}}function w7e(){return this.on("end.remove",I7e(this._id))}function S7e(t){var e=this._name,i=this._id;typeof t!="function"&&(t=Y4(t));for(var n=this._groups,r=n.length,o=new Array(r),a=0;a<r;++a)for(var s=n[a],l=s.length,c=o[a]=new Array(l),u,d,p=0;p<l;++p)(u=s[p])&&(d=t.call(u,u.__data__,p,s))&&("__data__"in u&&(d.__data__=u.__data__),c[p]=d,Xx(c[p],e,i,p,c,Ld(u,i)));return new gf(o,this._parents,e,i)}function T7e(t){var e=this._name,i=this._id;typeof t!="function"&&(t=pbe(t));for(var n=this._groups,r=n.length,o=[],a=[],s=0;s<r;++s)for(var l=n[s],c=l.length,u,d=0;d<c;++d)if(u=l[d]){for(var p=t.call(u,u.__data__,d,l),h,f=Ld(u,i),m=0,g=p.length;m<g;++m)(h=p[m])&&Xx(h,e,i,m,p,f);o.push(p),a.push(u)}return new gf(o,a,e,i)}var U7e=e1.prototype.constructor;function D7e(){return new U7e(this._groups,this._parents)}function P7e(t,e){var i,n,r;return function(){var o=$w(this,t),a=(this.style.removeProperty(t),$w(this,t));return o===a?null:o===i&&a===n?r:r=e(i=o,n=a)}}function Obe(t){return function(){this.style.removeProperty(t)}}function C7e(t,e,i){var n,r=i+"",o;return function(){var a=$w(this,t);return a===r?null:a===n?o:o=e(n=a,i)}}function E7e(t,e,i){var n,r,o;return function(){var a=$w(this,t),s=i(this),l=s+"";return s==null&&(l=s=(this.style.removeProperty(t),$w(this,t))),a===l?null:a===n&&l===r?o:(r=l,o=e(n=a,s))}}function M7e(t,e){var i,n,r,o="style."+e,a="end."+o,s;return function(){var l=Lf(this,t),c=l.on,u=l.value[o]==null?s||(s=Obe(e)):void 0;(c!==i||r!==u)&&(n=(i=c).copy()).on(a,r=u),l.on=n}}function R7e(t,e,i){var n=(t+="")=="transform"?x6e:xbe;return e==null?this.styleTween(t,P7e(t,n)).on("end.style."+t,Obe(t)):typeof e=="function"?this.styleTween(t,E7e(t,n,J4(this,"style."+t,e))).each(M7e(this._id,t)):this.styleTween(t,C7e(t,n,e),i).on("end.style."+t,null)}function N7e(t,e,i){return function(n){this.style.setProperty(t,e.call(this,n),i)}}function A7e(t,e,i){var n,r;function o(){var a=e.apply(this,arguments);return a!==r&&(n=(r=a)&&N7e(t,a,i)),n}return o._value=e,o}function _7e(t,e,i){var n="style."+(t+="");if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;return this.tween(n,A7e(t,e,i??""))}function k7e(t){return function(){this.textContent=t}}function x7e(t){return function(){var e=t(this);this.textContent=e??""}}function O7e(t){return this.tween("text",typeof t=="function"?x7e(J4(this,"text",t)):k7e(t==null?"":t+""))}function L7e(t){return function(e){this.textContent=t.call(this,e)}}function F7e(t){var e,i;function n(){var r=t.apply(this,arguments);return r!==i&&(e=(i=r)&&L7e(r)),e}return n._value=t,n}function B7e(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,F7e(t))}function $7e(){for(var t=this._name,e=this._id,i=Lbe(),n=this._groups,r=n.length,o=0;o<r;++o)for(var a=n[o],s=a.length,l,c=0;c<s;++c)if(l=a[c]){var u=Ld(l,e);Xx(l,t,i,c,a,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new gf(n,this._parents,t,i)}function V7e(){var t,e,i=this,n=i._id,r=i.size();return new Promise(function(o,a){var s={value:a},l={value:function(){--r===0&&o()}};i.each(function(){var c=Lf(this,n),u=c.on;u!==t&&(e=(t=u).copy(),e._.cancel.push(s),e._.interrupt.push(s),e._.end.push(l)),c.on=e})})}var j7e=0;function gf(t,e,i,n){this._groups=t,this._parents=e,this._name=i,this._id=n}function Lbe(){return++j7e}var Wb=e1.prototype;gf.prototype={constructor:gf,select:S7e,selectAll:T7e,filter:m7e,merge:g7e,selection:D7e,transition:$7e,call:Wb.call,nodes:Wb.nodes,node:Wb.node,size:Wb.size,empty:Wb.empty,each:Wb.each,on:b7e,attr:t7e,attrTween:a7e,style:R7e,styleTween:_7e,text:O7e,textTween:B7e,remove:w7e,tween:Y6e,delay:c7e,duration:p7e,ease:f7e,end:V7e};function H7e(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var D$={time:null,delay:0,duration:250,ease:H7e};function G7e(t,e){for(var i;!(i=t.__transition)||!(i=i[e]);)if(!(t=t.parentNode))return D$.time=Zx(),D$;return i}function z7e(t){var e,i;t instanceof gf?(e=t._id,t=t._name):(e=Lbe(),(i=D$).time=Zx(),t=t==null?null:t+"");for(var n=this._groups,r=n.length,o=0;o<r;++o)for(var a=n[o],s=a.length,l,c=0;c<s;++c)(l=a[c])&&Xx(l,t,e,c,a,i||G7e(l,e));return new gf(n,this._parents,t,e)}e1.prototype.interrupt=z6e;e1.prototype.transition=z7e;var iu="$";function TN(){}TN.prototype=Fbe.prototype={constructor:TN,has:function(t){return iu+t in this},get:function(t){return this[iu+t]},set:function(t,e){return this[iu+t]=e,this},remove:function(t){var e=iu+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===iu&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===iu&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===iu&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===iu&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===iu&&++t;return t},empty:function(){for(var t in this)if(t[0]===iu)return!1;return!0},each:function(t){for(var e in this)e[0]===iu&&t(this[e],e.slice(1),this)}};function Fbe(t,e){var i=new TN;if(t instanceof TN)t.each(function(s,l){i.set(l,s)});else if(Array.isArray(t)){var n=-1,r=t.length,o;if(e==null)for(;++n<r;)i.set(n,t[n]);else for(;++n<r;)i.set(e(o=t[n],n,t),o)}else if(t)for(var a in t)i.set(a,t[a]);return i}function sZ(){}var $g=Fbe.prototype;sZ.prototype={constructor:sZ,has:$g.has,add:function(t){return t+="",this[iu+t]=t,this},remove:$g.remove,clear:$g.clear,values:$g.keys,size:$g.size,empty:$g.empty,each:$g.each};function iS(){return Math.random()}(function t(e){function i(n,r){return n=n==null?0:+n,r=r==null?1:+r,arguments.length===1?(r=n,n=0):r-=n,function(){return e()*r+n}}return i.source=t,i})(iS);const W7e=function t(e){function i(n,r){var o,a;return n=n==null?0:+n,r=r==null?1:+r,function(){var s;if(o!=null)s=o,o=null;else do o=e()*2-1,s=e()*2-1,a=o*o+s*s;while(!a||a>1);return n+r*s*Math.sqrt(-2*Math.log(a)/a)}}return i.source=t,i}(iS);(function t(e){function i(){var n=W7e.source(e).apply(this,arguments);return function(){return Math.exp(n())}}return i.source=t,i})(iS);const q7e=function t(e){function i(n){return function(){for(var r=0,o=0;o<n;++o)r+=e();return r}}return i.source=t,i}(iS);(function t(e){function i(n){var r=q7e.source(e)(n);return function(){return r()/n}}return i.source=t,i})(iS);(function t(e){function i(n){return function(){return-Math.log(1-e())/n}}return i.source=t,i})(iS);var aF=new Date,sF=new Date;function Ff(t,e,i,n){function r(o){return t(o=arguments.length===0?new Date:new Date(+o)),o}return r.floor=function(o){return t(o=new Date(+o)),o},r.ceil=function(o){return t(o=new Date(o-1)),e(o,1),t(o),o},r.round=function(o){var a=r(o),s=r.ceil(o);return o-a<s-o?a:s},r.offset=function(o,a){return e(o=new Date(+o),a==null?1:Math.floor(a)),o},r.range=function(o,a,s){var l=[],c;if(o=r.ceil(o),s=s==null?1:Math.floor(s),!(o<a)||!(s>0))return l;do l.push(c=new Date(+o)),e(o,s),t(o);while(c<o&&o<a);return l},r.filter=function(o){return Ff(function(a){if(a>=a)for(;t(a),!o(a);)a.setTime(a-1)},function(a,s){if(a>=a)if(s<0)for(;++s<=0;)for(;e(a,-1),!o(a););else for(;--s>=0;)for(;e(a,1),!o(a););})},i&&(r.count=function(o,a){return aF.setTime(+o),sF.setTime(+a),t(aF),t(sF),Math.floor(i(aF,sF))},r.every=function(o){return o=Math.floor(o),!isFinite(o)||!(o>0)?null:o>1?r.filter(n?function(a){return n(a)%o===0}:function(a){return r.count(0,a)%o===0}):r}),r}var Bbe=6e4,$be=864e5,Vbe=6048e5,Q4=Ff(function(t){t.setHours(0,0,0,0)},function(t,e){t.setDate(t.getDate()+e)},function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*Bbe)/$be},function(t){return t.getDate()-1});Q4.range;function wb(t){return Ff(function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)},function(e,i){e.setDate(e.getDate()+i*7)},function(e,i){return(i-e-(i.getTimezoneOffset()-e.getTimezoneOffset())*Bbe)/Vbe})}var jbe=wb(0),UN=wb(1),Y7e=wb(2),K7e=wb(3),jw=wb(4),Z7e=wb(5),X7e=wb(6);jbe.range;UN.range;Y7e.range;K7e.range;jw.range;Z7e.range;X7e.range;var my=Ff(function(t){t.setMonth(0,1),t.setHours(0,0,0,0)},function(t,e){t.setFullYear(t.getFullYear()+e)},function(t,e){return e.getFullYear()-t.getFullYear()},function(t){return t.getFullYear()});my.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:Ff(function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,i){e.setFullYear(e.getFullYear()+i*t)})};my.range;var e5=Ff(function(t){t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCDate(t.getUTCDate()+e)},function(t,e){return(e-t)/$be},function(t){return t.getUTCDate()-1});e5.range;function Sb(t){return Ff(function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCDate(e.getUTCDate()+i*7)},function(e,i){return(i-e)/Vbe})}var Hbe=Sb(0),DN=Sb(1),J7e=Sb(2),Q7e=Sb(3),Hw=Sb(4),eYe=Sb(5),tYe=Sb(6);Hbe.range;DN.range;J7e.range;Q7e.range;Hw.range;eYe.range;tYe.range;var gy=Ff(function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)},function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)},function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()},function(t){return t.getUTCFullYear()});gy.every=function(t){return!isFinite(t=Math.floor(t))||!(t>0)?null:Ff(function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,i){e.setUTCFullYear(e.getUTCFullYear()+i*t)})};gy.range;function lF(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function cF(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function TS(t,e,i){return{y:t,m:e,d:i,H:0,M:0,S:0,L:0}}function iYe(t){var e=t.dateTime,i=t.date,n=t.time,r=t.periods,o=t.days,a=t.shortDays,s=t.months,l=t.shortMonths,c=US(r),u=DS(r),d=US(o),p=DS(o),h=US(a),f=DS(a),m=US(s),g=DS(s),v=US(l),y=DS(l),b={a:k,A:O,b:F,B,c:null,d:hZ,e:hZ,f:DYe,g:xYe,G:LYe,H:SYe,I:TYe,j:UYe,L:Gbe,m:PYe,M:CYe,p:$,q:V,Q:gZ,s:vZ,S:EYe,u:MYe,U:RYe,V:NYe,w:AYe,W:_Ye,x:null,X:null,y:kYe,Y:OYe,Z:FYe,"%":mZ},I={a:H,A:z,b:G,B:W,c:null,d:fZ,e:fZ,f:jYe,g:JYe,G:e8e,H:BYe,I:$Ye,j:VYe,L:Wbe,m:HYe,M:GYe,p:K,q:Z,Q:gZ,s:vZ,S:zYe,u:WYe,U:qYe,V:YYe,w:KYe,W:ZYe,x:null,X:null,y:XYe,Y:QYe,Z:t8e,"%":mZ},T={a:E,A:C,b:M,B:N,c:R,d:dZ,e:dZ,f:yYe,g:uZ,G:cZ,H:pZ,I:pZ,j:fYe,L:vYe,m:hYe,M:mYe,p:D,q:pYe,Q:IYe,s:wYe,S:gYe,u:sYe,U:lYe,V:cYe,w:aYe,W:uYe,x:A,X:_,y:uZ,Y:cZ,Z:dYe,"%":bYe};b.x=S(i,b),b.X=S(n,b),b.c=S(e,b),I.x=S(i,I),I.X=S(n,I),I.c=S(e,I);function S(Y,X){return function(Q){var te=[],J=-1,ie=0,oe=Y.length,ne,re,me;for(Q instanceof Date||(Q=new Date(+Q));++J<oe;)Y.charCodeAt(J)===37&&(te.push(Y.slice(ie,J)),(re=lZ[ne=Y.charAt(++J)])!=null?ne=Y.charAt(++J):re=ne==="e"?" ":"0",(me=X[ne])&&(ne=me(Q,re)),te.push(ne),ie=J+1);return te.push(Y.slice(ie,J)),te.join("")}}function w(Y,X){return function(Q){var te=TS(1900,void 0,1),J=U(te,Y,Q+="",0),ie,oe;if(J!=Q.length)return null;if("Q"in te)return new Date(te.Q);if("s"in te)return new Date(te.s*1e3+("L"in te?te.L:0));if(X&&!("Z"in te)&&(te.Z=0),"p"in te&&(te.H=te.H%12+te.p*12),te.m===void 0&&(te.m="q"in te?te.q:0),"V"in te){if(te.V<1||te.V>53)return null;"w"in te||(te.w=1),"Z"in te?(ie=cF(TS(te.y,0,1)),oe=ie.getUTCDay(),ie=oe>4||oe===0?DN.ceil(ie):DN(ie),ie=e5.offset(ie,(te.V-1)*7),te.y=ie.getUTCFullYear(),te.m=ie.getUTCMonth(),te.d=ie.getUTCDate()+(te.w+6)%7):(ie=lF(TS(te.y,0,1)),oe=ie.getDay(),ie=oe>4||oe===0?UN.ceil(ie):UN(ie),ie=Q4.offset(ie,(te.V-1)*7),te.y=ie.getFullYear(),te.m=ie.getMonth(),te.d=ie.getDate()+(te.w+6)%7)}else("W"in te||"U"in te)&&("w"in te||(te.w="u"in te?te.u%7:"W"in te?1:0),oe="Z"in te?cF(TS(te.y,0,1)).getUTCDay():lF(TS(te.y,0,1)).getDay(),te.m=0,te.d="W"in te?(te.w+6)%7+te.W*7-(oe+5)%7:te.w+te.U*7-(oe+6)%7);return"Z"in te?(te.H+=te.Z/100|0,te.M+=te.Z%100,cF(te)):lF(te)}}function U(Y,X,Q,te){for(var J=0,ie=X.length,oe=Q.length,ne,re;J<ie;){if(te>=oe)return-1;if(ne=X.charCodeAt(J++),ne===37){if(ne=X.charAt(J++),re=T[ne in lZ?X.charAt(J++):ne],!re||(te=re(Y,Q,te))<0)return-1}else if(ne!=Q.charCodeAt(te++))return-1}return te}function D(Y,X,Q){var te=c.exec(X.slice(Q));return te?(Y.p=u[te[0].toLowerCase()],Q+te[0].length):-1}function E(Y,X,Q){var te=h.exec(X.slice(Q));return te?(Y.w=f[te[0].toLowerCase()],Q+te[0].length):-1}function C(Y,X,Q){var te=d.exec(X.slice(Q));return te?(Y.w=p[te[0].toLowerCase()],Q+te[0].length):-1}function M(Y,X,Q){var te=v.exec(X.slice(Q));return te?(Y.m=y[te[0].toLowerCase()],Q+te[0].length):-1}function N(Y,X,Q){var te=m.exec(X.slice(Q));return te?(Y.m=g[te[0].toLowerCase()],Q+te[0].length):-1}function R(Y,X,Q){return U(Y,e,X,Q)}function A(Y,X,Q){return U(Y,i,X,Q)}function _(Y,X,Q){return U(Y,n,X,Q)}function k(Y){return a[Y.getDay()]}function O(Y){return o[Y.getDay()]}function F(Y){return l[Y.getMonth()]}function B(Y){return s[Y.getMonth()]}function $(Y){return r[+(Y.getHours()>=12)]}function V(Y){return 1+~~(Y.getMonth()/3)}function H(Y){return a[Y.getUTCDay()]}function z(Y){return o[Y.getUTCDay()]}function G(Y){return l[Y.getUTCMonth()]}function W(Y){return s[Y.getUTCMonth()]}function K(Y){return r[+(Y.getUTCHours()>=12)]}function Z(Y){return 1+~~(Y.getUTCMonth()/3)}return{format:function(Y){var X=S(Y+="",b);return X.toString=function(){return Y},X},parse:function(Y){var X=w(Y+="",!1);return X.toString=function(){return Y},X},utcFormat:function(Y){var X=S(Y+="",I);return X.toString=function(){return Y},X},utcParse:function(Y){var X=w(Y+="",!0);return X.toString=function(){return Y},X}}}var lZ={"-":"",_:" ",0:"0"},Wa=/^\s*\d+/,nYe=/^%/,rYe=/[\\^$*+?|[\]().{}]/g;function Yn(t,e,i){var n=t<0?"-":"",r=(n?-t:t)+"",o=r.length;return n+(o<i?new Array(i-o+1).join(e)+r:r)}function oYe(t){return t.replace(rYe,"\\$&")}function US(t){return new RegExp("^(?:"+t.map(oYe).join("|")+")","i")}function DS(t){for(var e={},i=-1,n=t.length;++i<n;)e[t[i].toLowerCase()]=i;return e}function aYe(t,e,i){var n=Wa.exec(e.slice(i,i+1));return n?(t.w=+n[0],i+n[0].length):-1}function sYe(t,e,i){var n=Wa.exec(e.slice(i,i+1));return n?(t.u=+n[0],i+n[0].length):-1}function lYe(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.U=+n[0],i+n[0].length):-1}function cYe(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.V=+n[0],i+n[0].length):-1}function uYe(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.W=+n[0],i+n[0].length):-1}function cZ(t,e,i){var n=Wa.exec(e.slice(i,i+4));return n?(t.y=+n[0],i+n[0].length):-1}function uZ(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.y=+n[0]+(+n[0]>68?1900:2e3),i+n[0].length):-1}function dYe(t,e,i){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(i,i+6));return n?(t.Z=n[1]?0:-(n[2]+(n[3]||"00")),i+n[0].length):-1}function pYe(t,e,i){var n=Wa.exec(e.slice(i,i+1));return n?(t.q=n[0]*3-3,i+n[0].length):-1}function hYe(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.m=n[0]-1,i+n[0].length):-1}function dZ(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.d=+n[0],i+n[0].length):-1}function fYe(t,e,i){var n=Wa.exec(e.slice(i,i+3));return n?(t.m=0,t.d=+n[0],i+n[0].length):-1}function pZ(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.H=+n[0],i+n[0].length):-1}function mYe(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.M=+n[0],i+n[0].length):-1}function gYe(t,e,i){var n=Wa.exec(e.slice(i,i+2));return n?(t.S=+n[0],i+n[0].length):-1}function vYe(t,e,i){var n=Wa.exec(e.slice(i,i+3));return n?(t.L=+n[0],i+n[0].length):-1}function yYe(t,e,i){var n=Wa.exec(e.slice(i,i+6));return n?(t.L=Math.floor(n[0]/1e3),i+n[0].length):-1}function bYe(t,e,i){var n=nYe.exec(e.slice(i,i+1));return n?i+n[0].length:-1}function IYe(t,e,i){var n=Wa.exec(e.slice(i));return n?(t.Q=+n[0],i+n[0].length):-1}function wYe(t,e,i){var n=Wa.exec(e.slice(i));return n?(t.s=+n[0],i+n[0].length):-1}function hZ(t,e){return Yn(t.getDate(),e,2)}function SYe(t,e){return Yn(t.getHours(),e,2)}function TYe(t,e){return Yn(t.getHours()%12||12,e,2)}function UYe(t,e){return Yn(1+Q4.count(my(t),t),e,3)}function Gbe(t,e){return Yn(t.getMilliseconds(),e,3)}function DYe(t,e){return Gbe(t,e)+"000"}function PYe(t,e){return Yn(t.getMonth()+1,e,2)}function CYe(t,e){return Yn(t.getMinutes(),e,2)}function EYe(t,e){return Yn(t.getSeconds(),e,2)}function MYe(t){var e=t.getDay();return e===0?7:e}function RYe(t,e){return Yn(jbe.count(my(t)-1,t),e,2)}function zbe(t){var e=t.getDay();return e>=4||e===0?jw(t):jw.ceil(t)}function NYe(t,e){return t=zbe(t),Yn(jw.count(my(t),t)+(my(t).getDay()===4),e,2)}function AYe(t){return t.getDay()}function _Ye(t,e){return Yn(UN.count(my(t)-1,t),e,2)}function kYe(t,e){return Yn(t.getFullYear()%100,e,2)}function xYe(t,e){return t=zbe(t),Yn(t.getFullYear()%100,e,2)}function OYe(t,e){return Yn(t.getFullYear()%1e4,e,4)}function LYe(t,e){var i=t.getDay();return t=i>=4||i===0?jw(t):jw.ceil(t),Yn(t.getFullYear()%1e4,e,4)}function FYe(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+Yn(e/60|0,"0",2)+Yn(e%60,"0",2)}function fZ(t,e){return Yn(t.getUTCDate(),e,2)}function BYe(t,e){return Yn(t.getUTCHours(),e,2)}function $Ye(t,e){return Yn(t.getUTCHours()%12||12,e,2)}function VYe(t,e){return Yn(1+e5.count(gy(t),t),e,3)}function Wbe(t,e){return Yn(t.getUTCMilliseconds(),e,3)}function jYe(t,e){return Wbe(t,e)+"000"}function HYe(t,e){return Yn(t.getUTCMonth()+1,e,2)}function GYe(t,e){return Yn(t.getUTCMinutes(),e,2)}function zYe(t,e){return Yn(t.getUTCSeconds(),e,2)}function WYe(t){var e=t.getUTCDay();return e===0?7:e}function qYe(t,e){return Yn(Hbe.count(gy(t)-1,t),e,2)}function qbe(t){var e=t.getUTCDay();return e>=4||e===0?Hw(t):Hw.ceil(t)}function YYe(t,e){return t=qbe(t),Yn(Hw.count(gy(t),t)+(gy(t).getUTCDay()===4),e,2)}function KYe(t){return t.getUTCDay()}function ZYe(t,e){return Yn(DN.count(gy(t)-1,t),e,2)}function XYe(t,e){return Yn(t.getUTCFullYear()%100,e,2)}function JYe(t,e){return t=qbe(t),Yn(t.getUTCFullYear()%100,e,2)}function QYe(t,e){return Yn(t.getUTCFullYear()%1e4,e,4)}function e8e(t,e){var i=t.getUTCDay();return t=i>=4||i===0?Hw(t):Hw.ceil(t),Yn(t.getUTCFullYear()%1e4,e,4)}function t8e(){return"+0000"}function mZ(){return"%"}function gZ(t){return+t}function vZ(t){return Math.floor(+t/1e3)}var qb;Ybe({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Ybe(t){return qb=iYe(t),qb.format,qb.parse,qb.utcFormat,qb.utcParse,qb}function PN(){this._=null}function Jx(t){t.U=t.C=t.L=t.R=t.P=t.N=null}PN.prototype={constructor:PN,insert:function(t,e){var i,n,r;if(t){if(e.P=t,e.N=t.N,t.N&&(t.N.P=e),t.N=e,t.R){for(t=t.R;t.L;)t=t.L;t.L=e}else t.R=e;i=t}else this._?(t=yZ(this._),e.P=null,e.N=t,t.P=t.L=e,i=t):(e.P=e.N=null,this._=e,i=null);for(e.L=e.R=null,e.U=i,e.C=!0,t=e;i&&i.C;)n=i.U,i===n.L?(r=n.R,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.R&&(PS(this,i),t=i,i=t.U),i.C=!1,n.C=!0,CS(this,n))):(r=n.L,r&&r.C?(i.C=r.C=!1,n.C=!0,t=n):(t===i.L&&(CS(this,i),t=i,i=t.U),i.C=!1,n.C=!0,PS(this,n))),i=t.U;this._.C=!1},remove:function(t){t.N&&(t.N.P=t.P),t.P&&(t.P.N=t.N),t.N=t.P=null;var e=t.U,i,n=t.L,r=t.R,o,a;if(n?r?o=yZ(r):o=n:o=r,e?e.L===t?e.L=o:e.R=o:this._=o,n&&r?(a=o.C,o.C=t.C,o.L=n,n.U=o,o!==r?(e=o.U,o.U=t.U,t=o.R,e.L=t,o.R=r,r.U=o):(o.U=e,e=o,t=o.R)):(a=t.C,t=o),t&&(t.U=e),!a){if(t&&t.C){t.C=!1;return}do{if(t===this._)break;if(t===e.L){if(i=e.R,i.C&&(i.C=!1,e.C=!0,PS(this,e),i=e.R),i.L&&i.L.C||i.R&&i.R.C){(!i.R||!i.R.C)&&(i.L.C=!1,i.C=!0,CS(this,i),i=e.R),i.C=e.C,e.C=i.R.C=!1,PS(this,e),t=this._;break}}else if(i=e.L,i.C&&(i.C=!1,e.C=!0,CS(this,e),i=e.L),i.L&&i.L.C||i.R&&i.R.C){(!i.L||!i.L.C)&&(i.R.C=!1,i.C=!0,PS(this,i),i=e.L),i.C=e.C,e.C=i.L.C=!1,CS(this,e),t=this._;break}i.C=!0,t=e,e=e.U}while(!t.C);t&&(t.C=!1)}}};function PS(t,e){var i=e,n=e.R,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.R=n.L,i.R&&(i.R.U=i),n.L=i}function CS(t,e){var i=e,n=e.L,r=i.U;r?r.L===i?r.L=n:r.R=n:t._=n,n.U=r,i.U=n,i.L=n.R,i.L&&(i.L.U=i),n.R=i}function yZ(t){for(;t.L;)t=t.L;return t}function GS(t,e,i,n){var r=[null,null],o=gs.push(r)-1;return r.left=t,r.right=e,i&&CN(r,t,e,i),n&&CN(r,e,t,n),wc[t.index].halfedges.push(o),wc[e.index].halfedges.push(o),r}function ES(t,e,i){var n=[e,i];return n.left=t,n}function CN(t,e,i,n){!t[0]&&!t[1]?(t[0]=n,t.left=e,t.right=i):t.left===i?t[1]=n:t[0]=n}function i8e(t,e,i,n,r){var o=t[0],a=t[1],s=o[0],l=o[1],c=a[0],u=a[1],d=0,p=1,h=c-s,f=u-l,m;if(m=e-s,!(!h&&m>0)){if(m/=h,h<0){if(m<d)return;m<p&&(p=m)}else if(h>0){if(m>p)return;m>d&&(d=m)}if(m=n-s,!(!h&&m<0)){if(m/=h,h<0){if(m>p)return;m>d&&(d=m)}else if(h>0){if(m<d)return;m<p&&(p=m)}if(m=i-l,!(!f&&m>0)){if(m/=f,f<0){if(m<d)return;m<p&&(p=m)}else if(f>0){if(m>p)return;m>d&&(d=m)}if(m=r-l,!(!f&&m<0)){if(m/=f,f<0){if(m>p)return;m>d&&(d=m)}else if(f>0){if(m<d)return;m<p&&(p=m)}return!(d>0)&&!(p<1)||(d>0&&(t[0]=[s+d*h,l+d*f]),p<1&&(t[1]=[s+p*h,l+p*f])),!0}}}}}function n8e(t,e,i,n,r){var o=t[1];if(o)return!0;var a=t[0],s=t.left,l=t.right,c=s[0],u=s[1],d=l[0],p=l[1],h=(c+d)/2,f=(u+p)/2,m,g;if(p===u){if(h<e||h>=n)return;if(c>d){if(!a)a=[h,i];else if(a[1]>=r)return;o=[h,r]}else{if(!a)a=[h,r];else if(a[1]<i)return;o=[h,i]}}else if(m=(c-d)/(p-u),g=f-m*h,m<-1||m>1)if(c>d){if(!a)a=[(i-g)/m,i];else if(a[1]>=r)return;o=[(r-g)/m,r]}else{if(!a)a=[(r-g)/m,r];else if(a[1]<i)return;o=[(i-g)/m,i]}else if(u<p){if(!a)a=[e,m*e+g];else if(a[0]>=n)return;o=[n,m*n+g]}else{if(!a)a=[n,m*n+g];else if(a[0]<e)return;o=[e,m*e+g]}return t[0]=a,t[1]=o,!0}function r8e(t,e,i,n){for(var r=gs.length,o;r--;)(!n8e(o=gs[r],t,e,i,n)||!i8e(o,t,e,i,n)||!(Math.abs(o[0][0]-o[1][0])>oo||Math.abs(o[0][1]-o[1][1])>oo))&&delete gs[r]}function o8e(t){return wc[t.index]={site:t,halfedges:[]}}function a8e(t,e){var i=t.site,n=e.left,r=e.right;return i===r&&(r=n,n=i),r?Math.atan2(r[1]-n[1],r[0]-n[0]):(i===n?(n=e[1],r=e[0]):(n=e[0],r=e[1]),Math.atan2(n[0]-r[0],r[1]-n[1]))}function Kbe(t,e){return e[+(e.left!==t.site)]}function s8e(t,e){return e[+(e.left===t.site)]}function l8e(){for(var t=0,e=wc.length,i,n,r,o;t<e;++t)if((i=wc[t])&&(o=(n=i.halfedges).length)){var a=new Array(o),s=new Array(o);for(r=0;r<o;++r)a[r]=r,s[r]=a8e(i,gs[n[r]]);for(a.sort(function(l,c){return s[c]-s[l]}),r=0;r<o;++r)s[r]=n[a[r]];for(r=0;r<o;++r)n[r]=s[r]}}function c8e(t,e,i,n){var r=wc.length,o,a,s,l,c,u,d,p,h,f,m,g,v=!0;for(o=0;o<r;++o)if(a=wc[o]){for(s=a.site,c=a.halfedges,l=c.length;l--;)gs[c[l]]||c.splice(l,1);for(l=0,u=c.length;l<u;)f=s8e(a,gs[c[l]]),m=f[0],g=f[1],d=Kbe(a,gs[c[++l%u]]),p=d[0],h=d[1],(Math.abs(m-p)>oo||Math.abs(g-h)>oo)&&(c.splice(l,0,gs.push(ES(s,f,Math.abs(m-t)<oo&&n-g>oo?[t,Math.abs(p-t)<oo?h:n]:Math.abs(g-n)<oo&&i-m>oo?[Math.abs(h-n)<oo?p:i,n]:Math.abs(m-i)<oo&&g-e>oo?[i,Math.abs(p-i)<oo?h:e]:Math.abs(g-e)<oo&&m-t>oo?[Math.abs(h-e)<oo?p:t,e]:null))-1),++u);u&&(v=!1)}if(v){var y,b,I,T=1/0;for(o=0,v=null;o<r;++o)(a=wc[o])&&(s=a.site,y=s[0]-t,b=s[1]-e,I=y*y+b*b,I<T&&(T=I,v=a));if(v){var S=[t,e],w=[t,n],U=[i,n],D=[i,e];v.halfedges.push(gs.push(ES(s=v.site,S,w))-1,gs.push(ES(s,w,U))-1,gs.push(ES(s,U,D))-1,gs.push(ES(s,D,S))-1)}}for(o=0;o<r;++o)(a=wc[o])&&(a.halfedges.length||delete wc[o])}var Zbe=[],t5;function u8e(){Jx(this),this.x=this.y=this.arc=this.site=this.cy=null}function hI(t){var e=t.P,i=t.N;if(!(!e||!i)){var n=e.site,r=t.site,o=i.site;if(n!==o){var a=r[0],s=r[1],l=n[0]-a,c=n[1]-s,u=o[0]-a,d=o[1]-s,p=2*(l*d-c*u);if(!(p>=-m8e)){var h=l*l+c*c,f=u*u+d*d,m=(d*h-c*f)/p,g=(l*f-u*h)/p,v=Zbe.pop()||new u8e;v.arc=t,v.site=r,v.x=m+a,v.y=(v.cy=g+s)+Math.sqrt(m*m+g*g),t.circle=v;for(var y=null,b=iD._;b;)if(v.y<b.y||v.y===b.y&&v.x<=b.x)if(b.L)b=b.L;else{y=b.P;break}else if(b.R)b=b.R;else{y=b;break}iD.insert(y,v),y||(t5=v)}}}}function MI(t){var e=t.circle;e&&(e.P||(t5=e.N),iD.remove(e),Zbe.push(e),Jx(e),t.circle=null)}var Xbe=[];function d8e(){Jx(this),this.edge=this.site=this.circle=null}function bZ(t){var e=Xbe.pop()||new d8e;return e.site=t,e}function uF(t){MI(t),RI.remove(t),Xbe.push(t),Jx(t)}function p8e(t){var e=t.circle,i=e.x,n=e.cy,r=[i,n],o=t.P,a=t.N,s=[t];uF(t);for(var l=o;l.circle&&Math.abs(i-l.circle.x)<oo&&Math.abs(n-l.circle.cy)<oo;)o=l.P,s.unshift(l),uF(l),l=o;s.unshift(l),MI(l);for(var c=a;c.circle&&Math.abs(i-c.circle.x)<oo&&Math.abs(n-c.circle.cy)<oo;)a=c.N,s.push(c),uF(c),c=a;s.push(c),MI(c);var u=s.length,d;for(d=1;d<u;++d)c=s[d],l=s[d-1],CN(c.edge,l.site,c.site,r);l=s[0],c=s[u-1],c.edge=GS(l.site,c.site,null,r),hI(l),hI(c)}function h8e(t){for(var e=t[0],i=t[1],n,r,o,a,s=RI._;s;)if(o=Jbe(s,i)-e,o>oo)s=s.L;else if(a=e-f8e(s,i),a>oo){if(!s.R){n=s;break}s=s.R}else{o>-oo?(n=s.P,r=s):a>-oo?(n=s,r=s.N):n=r=s;break}o8e(t);var l=bZ(t);if(RI.insert(n,l),!(!n&&!r)){if(n===r){MI(n),r=bZ(n.site),RI.insert(l,r),l.edge=r.edge=GS(n.site,l.site),hI(n),hI(r);return}if(!r){l.edge=GS(n.site,l.site);return}MI(n),MI(r);var c=n.site,u=c[0],d=c[1],p=t[0]-u,h=t[1]-d,f=r.site,m=f[0]-u,g=f[1]-d,v=2*(p*g-h*m),y=p*p+h*h,b=m*m+g*g,I=[(g*y-h*b)/v+u,(p*b-m*y)/v+d];CN(r.edge,c,f,I),l.edge=GS(c,t,null,I),r.edge=GS(t,f,null,I),hI(n),hI(r)}}function Jbe(t,e){var i=t.site,n=i[0],r=i[1],o=r-e;if(!o)return n;var a=t.P;if(!a)return-1/0;i=a.site;var s=i[0],l=i[1],c=l-e;if(!c)return s;var u=s-n,d=1/o-1/c,p=u/c;return d?(-p+Math.sqrt(p*p-2*d*(u*u/(-2*c)-l+c/2+r-o/2)))/d+n:(n+s)/2}function f8e(t,e){var i=t.N;if(i)return Jbe(i,e);var n=t.site;return n[1]===e?n[0]:1/0}var oo=1e-6,m8e=1e-12,RI,wc,iD,gs;function g8e(t,e,i){return(t[0]-i[0])*(e[1]-t[1])-(t[0]-e[0])*(i[1]-t[1])}function v8e(t,e){return e[1]-t[1]||e[0]-t[0]}function IZ(t,e){var i=t.sort(v8e).pop(),n,r,o;for(gs=[],wc=new Array(t.length),RI=new PN,iD=new PN;;)if(o=t5,i&&(!o||i[1]<o.y||i[1]===o.y&&i[0]<o.x))(i[0]!==n||i[1]!==r)&&(h8e(i),n=i[0],r=i[1]),i=t.pop();else if(o)p8e(o.arc);else break;if(l8e(),e){var a=+e[0][0],s=+e[0][1],l=+e[1][0],c=+e[1][1];r8e(a,s,l,c),c8e(a,s,l,c)}this.edges=gs,this.cells=wc,RI=iD=gs=wc=null}IZ.prototype={constructor:IZ,polygons:function(){var t=this.edges;return this.cells.map(function(e){var i=e.halfedges.map(function(n){return Kbe(e,t[n])});return i.data=e.site.data,i})},triangles:function(){var t=[],e=this.edges;return this.cells.forEach(function(i,n){if(s=(o=i.halfedges).length)for(var r=i.site,o,a=-1,s,l,c=e[o[s-1]],u=c.left===r?c.right:c.left;++a<s;)l=u,c=e[o[a]],u=c.left===r?c.right:c.left,l&&u&&n<l.index&&n<u.index&&g8e(r,l,u)<0&&t.push([r.data,l.data,u.data])}),t},links:function(){return this.edges.filter(function(t){return t.right}).map(function(t){return{source:t.left.data,target:t.right.data}})},find:function(t,e,i){for(var n=this,r,o=n._found||0,a=n.cells.length,s;!(s=n.cells[o]);)if(++o>=a)return null;var l=t-s.site[0],c=e-s.site[1],u=l*l+c*c;do s=n.cells[r=o],o=null,s.halfedges.forEach(function(d){var p=n.edges[d],h=p.left;if(!((h===s.site||!h)&&!(h=p.right))){var f=t-h[0],m=e-h[1],g=f*f+m*m;g<u&&(u=g,o=h.index)}});while(o!==null);return n._found=r,i==null||u<=i*i?s.site:null}};function zS(t,e,i){this.k=t,this.x=e,this.y=i}zS.prototype={constructor:zS,scale:function(t){return t===1?this:new zS(this.k*t,this.x,this.y)},translate:function(t,e){return t===0&e===0?this:new zS(this.k,this.x+this.k*t,this.y+this.k*e)},apply:function(t){return[t[0]*this.k+this.x,t[1]*this.k+this.y]},applyX:function(t){return t*this.k+this.x},applyY:function(t){return t*this.k+this.y},invert:function(t){return[(t[0]-this.x)/this.k,(t[1]-this.y)/this.k]},invertX:function(t){return(t-this.x)/this.k},invertY:function(t){return(t-this.y)/this.k},rescaleX:function(t){return t.copy().domain(t.range().map(this.invertX,this).map(t.invert,t))},rescaleY:function(t){return t.copy().domain(t.range().map(this.invertY,this).map(t.invert,t))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};zS.prototype;const y8e=function(){let t={};t.jsonTODS=i=>{let n={bestOf:e(i.max_sets)};if(i.max_sets&&parseInt(i.max_sets)===1&&i.final_set_supertiebreak)n.setFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}};else{const r=e(i.games_for_set),o=e(i.tiereaks_at),a=o>r?r:o;n.setFormat={setTo:r,tiebreakAt:a,tiebreakFormat:{tiebreakTo:e(i.tiebreak_to)}},i.final_set_supertiebreak&&(n.finalSetFormat={tiebreakSet:{tiebreakTo:i.supertiebreak_to}})}return n};function e(i){return!isNaN(Number(i))&&Number(i)}return t}(),Qbe=function(){let t={};function e(a,s){let l=parseInt(a);return isNaN(l)?s:l}function i({source:a={},objects:s=[]}){let l=Object.assign({},a);return s&&!Array.isArray(s)&&(s=[s]),s=s.filter(c=>c),s.forEach(c=>{if(typeof c!="object")return;Object.keys(c).forEach(d=>l[d]=l[d]!==void 0?l[d]:c[d])}),l}t.setsToWin=a=>a&&Math.ceil(a/2)||1,t.tiebreakTo=(a,s)=>{var u,d,p,h;let l=(d=(u=a==null?void 0:a.setFormat)==null?void 0:u.tiebreakFormat)==null?void 0:d.tiebreakTo,c=(h=(p=a==null?void 0:a.finalSetFormat)==null?void 0:p.tiebreakFormat)==null?void 0:h.tiebreakTo;return s?c:l},t.matchFormat=n;function n(a){return(a||"SET3-S:6/TB7").slice(3)}t.getExistingScores=({match:a})=>{if(a!=null&&a.score)return r({string_score:a.score,winner_index:a.winner_index,matchFormat:a.matchFormat})},t.generateMatchFormat=({cfg_obj:a})=>{let s=a.bestof.ddlb.getValue(),l=e(s),c=Qbe.setsToWin(l),u={max_sets:l,sets_to_win:c,games_for_set:e(a.setsto.ddlb.getValue()),tiebreaks_at:e(a.tiebreaksat.ddlb.getValue())||"",tiebreak_to:e(a.tiebreaksto.ddlb.getValue()),supertiebreak_to:e(a.supertiebreakto.ddlb.getValue()),final_set_supertiebreak:a.finalset.ddlb.getValue()!=="N"};return{matchFormat:Tp.stringify(y8e.jsonTODS(u)),score_format:u}},t.getScoringFormat=({e:a,match:s})=>{var u,d;let l=(s==null?void 0:s.format)||((a==null?void 0:a.format)==="D"?"doubles":"singles"),c=[s==null?void 0:s.score_format,(u=s==null?void 0:s.match)==null?void 0:u.score_format,(d=a.scoring_format)==null?void 0:d[l],a.score_format];return i({objects:c})},t.defaultMatchFormat=({format:a,category:s,env:l})=>{let c=l.scoreboard.matchFormats,u={S:"singles",D:"doubles"};return Object.keys(u).indexOf(a)>=0&&(a=u[a]),a&&s&&c.categories[s]&&c.categories[s][a]?c.categories[s][a]:a&&c[a]?c[a]:c.singles},t.convertStringScore=r;function r({string_score:a,winner_index:s,split:l=" ",matchFormat:c}){if(!a)return[];a=s?o(a):a;let u=null,d=/(\d+)/,p=/(\d+)\((\d+)\)/,h=Tp.parse(c),f=a.split(l).filter(m=>m).map(m=>{if(m.indexOf("/")>0){let y=m.split("/").map(b=>d.exec(b)?{games:+d.exec(b)[1]}:void 0).filter(b=>b);if(y.length===2)return y}let g=null,v=m.split("-").map(y=>{let b;return p.test(y)?(g=+p.exec(y)[2],b={games:+p.exec(y)[1]}):d.test(y)?b={games:+d.exec(y)[1]}:u=y,b||void 0});if(v=v.filter(y=>y),g!==null){let y=Math.min(...v.map(b=>b.games));v.forEach(b=>{+b.games==+y?b.tiebreak=g:b.spacer=g})}return v});if(f=f.filter(m=>m&&m.length===2),f.forEach(m=>{var y;let g=h&&(h.finalSetFormat||h.setFormat),v=(y=g==null?void 0:g.tiebreakSet)==null?void 0:y.tiebreakTo;(m[0].games>=v||m[1].games>=v)&&(m[0].supertiebreak=m[0].games,m[1].supertiebreak=m[1].games,delete m[0].games,delete m[1].games)}),s!==void 0&&(f.winner_index=s),u){if(u==="Cancelled"&&(f.cancelled=!0),u==="Abandoned"&&(f.abandoned=!0),u==="INC."&&(f.incomplete=!0),u==="INT."&&(f.interrupted=!0),u==="LIVE"&&(f.live=!0),u==="TIME"&&(f.time=!0),u==="DEF."&&(f.default=!0),u==="W.O."&&(f.walkover=!0),!f.length)return f;s!==void 0&&(f[f.length-1][1-s].outcome=u,f[f.length-1].outcome=u,f.outome=u)}return f}t.reverseScore=o;function o(a,s=" "){let l=null;if(a){let d=a.split(s).map(c).join(s);return l?`${l} ${d}`:d}function c(d){let p=d.indexOf("/")>0?"/":"-",h=d.split(p).map(u).reverse().filter(y=>y),f=h.map(y=>y.games),m=h.map(y=>y.tiebreak).filter(y=>y),g=m.length===1?`(${m[0]})`:"";return`${m.length<2?f.join(p):f.map((y,b)=>`${y}(${m[b]})`).join(p)}${g}`}function u(d){let p=/(\d+)/,h=/(\d+)\((\d+)\)/;if(h.test(d))return{games:h.exec(d)[1],tiebreak:h.exec(d)[2]};if(p.test(d))return{games:p.exec(d)[1]};l=d}}return t}(),Ko=function(){let t={};function e(l,c){let u=1;if(Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};for(;l.parentNode;){if(l=l.parentNode,l.classList&&Array.from(l.classList).indexOf(c)>=0)return{elem:l,depth:u};u+=1}return{elem:null,depth:0}}const i="span:first-of-type";t.DropDown=n;function n({element:l,onChange:c,css_class:u,id:d,locked:p,max:h,maxFx:f,value_attribute:m=!0,background:g}){var v,y,b,I,T;!l&&d&&(l=document.getElementById(d)),this.id=d,this.val="",this.max=h,this.maxFx=f,this.el=l,this.locked=p,this.background=g||"",this.bordercolor="",this.labelcolor="#000",this.class=u,this.value_attribute=m,this.list=(v=this.el)==null?void 0:v.querySelector(".dd_state"),this.options=(y=this.el)==null?void 0:y.querySelector(".options"),this.label=(b=this.el)==null?void 0:b.querySelector("div:first-of-type"),this.opts=((I=this.list)==null?void 0:I.querySelectorAll("li"))||[],this.selection=((T=this.list)==null?void 0:T.querySelector(i))||void 0,typeof c=="function"&&(this.onChange=c),this.initEvents()}function r(l){l.el&&(l.el.ddclick||(l.el.ddclick=!0,l.el.addEventListener("click",c=>{if(l.locked)return;let{elem:u,depth:d}=e(c.target,"dd_state"),{elem:p,depth:h}=e(c.target,"dd_option"),f=u&&Array.from(u.classList).indexOf("active")>=0;if(l.max&&!p&&l.opts&&l.opts.length>l.max&&l.maxFx&&typeof l.maxFx=="function"){l.maxFx(l.options);return}t.closeAllDropDowns(l.class),u&&(!h||d<h)&&u.classList[f?"remove":"add"]("active"),c.stopPropagation()})))}function o(l){Array.from(l.opts).forEach(c=>{c.addEventListener("click",()=>{l.list.classList.remove("active");let u=c.querySelector(i),d=u.getAttribute("value");l.selection.innerHTML=u.innerHTML;let p=l.val!=d;l.val=d,p&&l.onChange&&(l.onChange(d),l.selectionBackground(),l.labelColor())})})}function a(l,c){return`<li class='dd_option' title='${l.title||""}'><span value="${l.value}" style="${c||""}">${l.key}</span></li>`}n.prototype={initEvents(){let l=this;r(l),o(l)},getLabel(){return this.selection.innerHTML},getValue(){return this.val},setId(l){this.id=l},getId(){return this.id},lock(){this.locked=!0},unlock(){this.locked=!1},setOptions(l,c=""){if(!Array.isArray(l)||!l.length||!this.list)return;let u=this.list.querySelector("ul");if(u)return this.max&&l&&l.length>this.max&&t.closeAllDropDowns(this.class),u.innerHTML=l.map(d=>a(d,c)).join(""),this.options=l,this.opts=this.list.querySelectorAll("li"),o(this),this},getOptions(){return Array.from(this.opts).map(l=>{let c=l.querySelector(i);return{key:c.innerHTML,value:c.getAttribute("value")}})},setLabel(l,c,u,d){this.selection&&(this.selection.innerHTML=l,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},setValue(l,c,u,d){let p=Array.from(this.opts).filter(f=>f.querySelector(i).getAttribute("value")==l),h=p.length?p[0].querySelector("span").innerHTML:l;this.val=l,this.selection&&(this.selection.innerHTML=h,this.selectionBackground(c),this.labelColor(u),this.borderColor(d))},selectionBackground(l){this.selection&&(l&&(this.background=l),this.background?(this.selection.classList.remove("novalue"),this.selection.classList.remove("hasvalue"),this.selection.style.background=this.background):this.locked?(this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):this.val?(this.selection.style.background="",this.value_attribute&&this.selection.classList.add("hasvalue"),this.selection.classList.remove("novalue")):(this.selection.style.background="",this.selection.classList.add("novalue"),this.selection.classList.remove("hasvalue")))},labelColor(l){l&&(this.labelcolor=l),this.label.style.color=this.labelcolor},borderColor(l){l&&(this.bordercolor=l),this.bordercolor&&this.options&&this.options.style&&(this.options.style.border=`1px solid ${this.bordercolor}`)}};let s=(l,c=[],u,d=!0,p,h)=>{let f=u!==void 0&&c[u]?c[u].key:"",m=d?"style='border: 1px solid #000;'":"",g=c.map(v=>a(v,p)).join("");return`
         <div class='dd-label'>${l}</div>
         <div class='options' ${m}>
            <ul>
               <li class='dd_state'>
                  <span class='active'>${f}</span>
                  <div>
                     <ul class='${h?"floatleft":""}'>
                     ${g}
                     </ul>
                  </div>
               </li>
            </ul>
         </div>`};return t.attachDropDown=({element:l,id:c,label:u="",options:d,selected:p=0,css_class:h,border:f,style:m,floatleft:g,display:v="flex"})=>{!c&&!l||(l=l||document.getElementById(c),l&&(l.style.display=v,l.classList.add(h||"dd"),l.innerHTML=s(u,d,p,f,m,g)))},t.closeAllDropDowns=()=>{let l=document.querySelectorAll("li.dd_state.active");Array.from(l).forEach(c=>{c.classList.remove("active")})},document.addEventListener("click",()=>t.closeAllDropDowns()),t}(),wZ=(t,e)=>{let i=parseInt(t);return isNaN(i)?e:i},SZ=1500;function TZ({elem:t,type:e,duration:i=800,height:n=80,visible:r}){let o=Ube(t);a();function a(){let s=o.select("."+e),l=s.style("display"),c=l==="none"?"flex":"none";r===!0&&l==="none"||r===void 0&&c==="flex"?(s.style("height","0px"),s.style("display",c).transition().duration(i).style("height",`${n}px`)):(r===!1&&l==="flex"||r===void 0&&c==="none")&&s.transition().duration(i).style("height","0px").transition().duration(0).style("display","none")}}const b8e=function(){let t={numericFx:void 0,enterFx:void 0};document.addEventListener("keyup",o=>{if(o.key&&o.key==="Enter"&&t.enterFx&&typeof t.enterFx=="function"&&t.enterFx(),o.key&&t.numericFx&&typeof t.numericFx=="function"){let a=["0","1","2","3","4","5","6","7","8","9"].indexOf(o.key),s=[")","!","@","#","$","%","^","&","*",")"].indexOf(o.key);a>=0?t.numericFx(a):s>=0&&t.numericFx(s,1)}});let e={};vN.register("setClick","tap",i);function i(o){let a=hy(o,"set_number");if(!a)return;let s=a.getAttribute("setnum"),l=hy(o,"muid").getAttribute("muid");e[l]&&typeof e[l]=="function"&&e[l](s)}let n={auto_score:!0},r={bestof:[1,3,5],setsto:[4,6,8],tiebreaksto:[5,7,12],supertiebreakto:[7,10,21]};return t.options=o=>{if(!o)return r;lbe(o,r)},t.setMatchScore=({muid:o,lock:a,match:s,teams:l,grouped:c,callback:u,round_name:d,matchFormat:p,existing_scores:h,auto_score:f=!0})=>{var Le,ge,Ee,we,fe,Te;n.auto_score=f;let m={...n},g=Tp.parse(p||"SET3-S:6/TB7");if(!g)return;let v=(Le=g==null?void 0:g.setFormat)==null?void 0:Le.tiebreakAt,y=(ge=g==null?void 0:g.setFormat)==null?void 0:ge.setTo,b=g.bestOf,I=Qbe.setsToWin(b),T=g.finalSetFormat||g.setFormat,S=(Ee=T==null?void 0:T.tiebreakSet)==null?void 0:Ee.tiebreakTo,w=(fe=(we=g==null?void 0:g.setFormat)==null?void 0:we.tiebreakFormat)==null?void 0:fe.tiebreakTo,U=(Te=g==null?void 0:g.finalSetFormat)==null?void 0:Te.tiebreakSet,D,E,C,M,N,R=W4e.display({muid:o,teams:l});R.details.element.style.display="none",d&&(R.round_name.element.innerHTML=d),R.details.element.innerHTML=I8e(s),R.scoring.element.style.display=a?"none":"inline",R.favorite.element.style.display=a?"inline":"none",o&&(e[o]=ue=>{a||(M.length-ue>1&&(M=M.slice(0,M.length-1),ue=M.length-1,be()),ve({selected_set:ue}),A(!0),O(),R.scoring.element.style.display="inline",R.edit_scoring.element.style.display="inline")});let A=ue=>{let de=ue&&!a;N=de,TZ({elem:R.actions.element,type:"edit",height:50,visible:de}),R.scoring.element.style.display=N||a?"none":"inline",R.edit_scoring.element.style.display=N?"none":"inline"};Fe({sobj:R,changeFx:B}),G(),H(),W(),k();function _(){return[]}function k(){if(M=h?_():[],N=!1,C=!1,t.enterFx=()=>{N&&V()},O(),z(),D=De(!c)!==void 0?M.length:Math.max(0,M.length-1),h&&(Object.keys(h).length||h.length||h.walkover||h.default)){let de=M.length?M[M.length-1]:void 0;if(M.interrupted)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("interrupted"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),de&&Q(de[0].games,de[1].games)&&(D+=1);else if(M.abandoned)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("abandoned"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0);else if(M.cancelled)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("cancelled"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0);else if(M.incomplete)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("incomplete"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),de&&Q(de[0].games,de[1].games)&&(D+=1);else if(M.live)R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue("live"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),de&&Q(de[0].games,de[1].games)&&(D+=1),m.auto_score=!1;else if(M.retired){let _e=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(_e===0?"retired":"winner"),R.p2action.ddlb.setValue(_e===1?"retired":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!1),F(1-_e)}else if(M.time){let _e=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(_e===0?"time":"winner"),R.p2action.ddlb.setValue(_e===1?"time":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!1),F(1-_e)}else if(M.default){let _e=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(_e===0?"defaulted":"winner"),R.p2action.ddlb.setValue(_e===1?"defaulted":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!1),F(1-_e)}else if(M.walkover){let _e=h.winner_index!==void 0?1-h.winner_index:void 0;R.p1action.ddlb.setValue(_e===0?"walkover":"winner"),R.p2action.ddlb.setValue(_e===1?"walkover":"winner"),R.p1action.ddlb.lock(),R.p2action.ddlb.lock(),A(!0),F(1-_e)}else A(!1)}else R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" ");(M.time||M.retired||M.default||M.walkover)&&(D=void 0),ve({selected_set:D,actions:!c})}function O(){Array.from(R.root.element.querySelectorAll(".victor")).forEach(de=>de.classList.remove("victor")),a||be()}function F(ue){Array.from(R.root.element.querySelectorAll(`.opponent${ue}`)).forEach(Ue=>Ue.classList.add("victor")),Array.from(R.root.element.querySelectorAll(`.opponent${ue} .hasvalue`)).forEach(Ue=>Ue.classList.add("victor"))}function B(){O(),D=0,M=[],Ie(),ye(),z(),t.enterFx=void 0,R.p2action.ddlb.setValue(" "),R.p1action.ddlb.setValue(" "),m.auto_score=n.auto_score,ve({selected_set:D})}function $(ue){let de={bestOf:b,setFormat:{setTo:y,tiebreakAt:v,tiebreakFormat:{tiebreakTo:w}}};U&&(de.finalSetFormat={tiebreakSet:{tiebreakTo:S}});const _e=Tp.stringify(de);if(ue){const Ue=M.map((Ce,We)=>Di.definedAttributes({side1TiebreakScore:Ce[0].supertiebreak,side2TiebreakScore:Ce[1].supertiebreak,side1score:Ce[0].games,side2score:Ce[1].games,setNumber:We+1}));ue.sets=Ue,ue.set_scores=M,ue.matchUpFormat=_e}ue&&typeof u=="function"&&u(ue),t.numericFx=void 0,t.enterFx=void 0,document.body.style.overflow=null,Ube(R.scoreboard.element).remove()}function V(){t.numericFx=void 0,t.enterFx=void 0,De(),$(ke())}function H(){R.cancel.element.addEventListener("click",()=>$(),!1),R.accept.element.addEventListener("click",V,!1),R.clear.element.addEventListener("click",B,!1),R.scoring.element.addEventListener("click",ue,!1);function ue(){let _e=R.scoring.element.innerHTML==="-";_e||(R.edit_scoring.element.style.overflow="hidden"),R.scoring.element.innerHTML=_e?"&#x25A2;":"-",de(R.edit_scoring.element,_e)}function de(_e,Ue){let Ce=800;TZ({elem:_e,type:"edit",height:100,visible:Ue,duration:Ce}),Ue&&setTimeout(function(){_e.style.overflow="visible"},Ce)}}function z(){let ue=[{key:"-",value:""}],de=y===v?y+2:y+1;Di.generateRange(0,de).forEach(He=>ue.push({key:He,value:He}));let _e=He=>J(0,He),Ue=He=>J(1,He);Ko.attachDropDown({id:R.p1selector.id,options:ue,border:!1}),Ko.attachDropDown({id:R.p2selector.id,options:ue,border:!1}),R.p1selector.ddlb=new Ko.DropDown({element:R.p1selector.element,onChange:_e,id:R.p1selector.id,value_attribute:!1}),R.p2selector.ddlb=new Ko.DropDown({element:R.p2selector.element,onChange:Ue,id:R.p2selector.id,value_attribute:!1}),a&&(R.p1selector.ddlb.lock(),R.p2selector.ddlb.lock()),R.p1selector.ddlb.selectionBackground(),R.p2selector.ddlb.selectionBackground();let Ce;t.numericFx=(He,Be=0)=>{Ce=new Date().getTime(),R.p1tiebreak.element.style.display==="none"&&He<de?(Be?R.p1selector.ddlb.setValue(He):R.p2selector.ddlb.setValue(He),J(1-Be,He)):setTimeout(function(){We()},SZ)};function We(){if(new Date().getTime()-Ce>SZ){let Be=+R.p1tiebreak.element.value,et=+R.p2tiebreak.element.value;(Be!=""||et!="")&&(E?Y(Be,et,!0):Z(Be,et,!0))}}}function G(){let ue=[{key:" ",value:""},{key:"-",value:" "},{key:"RET.",value:"retired"},{key:"TIME",value:"time"},{key:"W.O.",value:"walkover"},{key:"DEF.",value:"defaulted"},{key:"INT.",value:"interrupted"},{key:"INC.",value:"incomplete"},{key:"CCL",value:"cancelled"},{key:"ABD",value:"abandoned"},{key:"LIVE",value:"live"},{key:`<div class='link'><img src='${z4e}' class='completed_icon'></div>`,value:"winner"}],de=Ue=>Ne(0,Ue),_e=Ue=>Ne(1,Ue);Ko.attachDropDown({id:R.p1action.id,options:ue,border:!1,floatleft:!0}),Ko.attachDropDown({id:R.p2action.id,options:ue,border:!1,floatleft:!0}),R.p1action.ddlb=new Ko.DropDown({element:R.p1action.element,onChange:de,id:R.p1action.id}),R.p2action.ddlb=new Ko.DropDown({element:R.p2action.element,onChange:_e,id:R.p2action.id}),a&&(R.p1action.ddlb.lock(),R.p2action.ddlb.lock()),R.p1action.ddlb.selectionBackground(),R.p2action.ddlb.selectionBackground()}function W(){let ue=_e=>K(_e,0),de=_e=>K(_e,1);R.p1tiebreak.element.addEventListener("keyup",ue,!1),R.p2tiebreak.element.addEventListener("keyup",de,!1)}function K(ue,de,_e){let Ue=+R.p1tiebreak.element.value,Ce=+R.p2tiebreak.element.value;(ue.which===13||_e)&&(Ue!=""||Ce!="")&&(E?Y(Ue,Ce,!0):Z(Ue,Ce,!0));let We=R[de?"p2tiebreak":"p1tiebreak"].element.value.match(/-?\d+\.?\d*/),He=We&&!isNaN(We[0])?parseInt(We[0].toString().slice(-2)):void 0,Be=E?S:w,et=He===void 0||He==""||He+2<Be?Be:He+2;R[de?"p2tiebreak":"p1tiebreak"].element.value=He!==void 0?He:"",m.auto_score&&!re()&&(R[de?"p1tiebreak":"p2tiebreak"].element.value=et)}function Z(ue,de,_e){let Ue=M.length,Ce=Ue>D?Ue-1:D-1;M!=null&&M[Ce]&&(M[Ce][0][ue<de?"tiebreak":"spacer"]=ue<de?ue:de,M[Ce][1][de<ue?"tiebreak":"spacer"]=de<ue?de:ue,_e&&X())}function Y(ue,de,_e){if(ue<S&&de<S)return;let Ue=[{supertiebreak:ue},{supertiebreak:de}],Ce=M.length;Ce&&M[Ce-1][0].supertiebreak!==void 0?M[Ce-1]=Ue:M.push(Ue),_e&&X()}function X(){Ie(),De()!==void 0&&A(!0),ve({selected_set:D})}function Q(ue,de){let _e=Math.abs(ue-de);return!v&&(+ue===y||+de===y)?!0:_e>=2&&(+ue>=y||+de>=y)}function te(ue,de){return v?+ue===v+1&&+de===v||+ue===v&&+de===v+1:!1}function J(ue,de){if(de===""){R.p1selector.ddlb.setValue(""),R.p2selector.ddlb.setValue(""),M[D]=[{games:0},{games:0}];return}me()&&be();let _e=!1;Ie(),oe()&&(D=M.length-1,R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" "),ye());let Ue=R.p1selector.ddlb.getValue(),Ce=R.p2selector.ddlb.getValue();m.auto_score?ue===0&&Ce===""?(Ce=He(de),R.p2selector.ddlb.setValue(Ce)):ue===1&&Ue===""?(Ue=He(de),R.p1selector.ddlb.setValue(Ue)):v?(+Ue===v+1&&+Ce===v+1&&We(v),+Ue===v+1&&+Ce<v-1&&We(v),+Ce===v+1&&+Ue<v-1&&We(v)):+Ue===y&&+Ce===y&&We(y-1):ue===0&&!Ce?(Ce=0,R.p2selector.ddlb.setValue(Ce)):ue===1&&!Ue&&(Ue=0,R.p1selector.ddlb.setValue(Ue)),M[D]=[{games:wZ(Ue)||0},{games:wZ(Ce)||0}],!Q(Ue,Ce)&&!te(Ue,Ce)?(M=M.slice(0,D+1),ve({selected_set:D})):(te(Ue,Ce)&&(_e=!0),De(),ie(Ue,Ce,_e));function We(Be){ue?(Ue=Be,R.p1selector.ddlb.setValue(Ue)):(Ce=Be,R.p2selector.ddlb.setValue(Ce))}function He(Be){return Be===""?"":v?((+Be===v||+Be===v+1)&&(_e=!0),+Be===v-1||+Be===v?parseInt(v||0)+1:+Be<v?y:v):+Be===y?y-1:(+Be===y-1,y)}}function ie(ue,de,_e){_e&&!a&&(R.p1tiebreak.element.style.display="inline",R.p2tiebreak.element.style.display="inline",R[ue>de?"p1tiebreak":"p2tiebreak"].element.disabled=!0,R[ue>de?"p2tiebreak":"p1tiebreak"].element.disabled=!1,R[ue>de?"p2tiebreak":"p1tiebreak"].element.focus(),A(!1));let Ue=ue!==""&&de!=="",Ce=De()===void 0&&re()===void 0;Ue&&Ce&&D+1<b&&(D+=1),ve({selected_set:D,tiebreak:_e})}function oe(){let ue=R.p1action.ddlb.getValue(),de=R.p2action.ddlb.getValue();return ue==="winner"||de==="winner"}function ne(){let ue=R.p1action.ddlb.getValue(),de=R.p2action.ddlb.getValue();if(["cancelled","incomplete","abandoned"].indexOf(ue)>=0||["cancelled","incomplete","abandoned"].indexOf(de)>=0)return!1}function re(){let ue=R.p1action.ddlb.getValue(),de=R.p2action.ddlb.getValue();if(["time","retired","defaulted","walkover"].indexOf(ue)>=0)return 0;if(["time","retired","defaulted","walkover"].indexOf(de)>=0)return 1}function me(){let ue=R.p1action.ddlb.getValue(),de=R.p2action.ddlb.getValue();return["interrupted"].indexOf(ue)>=0||["interrupted"].indexOf(de)>=0}function he(){let ue=R.p1action.ddlb.getValue(),de=R.p2action.ddlb.getValue();return["live"].indexOf(ue)>=0||["live"].indexOf(de)>=0}function be(){he()||(R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" ")),R.p1action.ddlb.unlock(),R.p2action.ddlb.unlock()}function Se(){return M.length?M.map(de=>{let _e=isNaN(de[0].games)?de[0].games:+de[0].games,Ue=isNaN(de[1].games)?de[1].games:+de[1].games;if(_e!==void 0&&Ue!==void 0&&_e!==""&&Ue!==""){if(te(_e,Ue)&&de[0].tiebreak===void 0&&de[1].tiebreak===void 0)return[0,0];const Ce=+_e===y&&+_e==+Ue+1,We=+Ue===y&&+Ue==+_e+1;if(v)if(!v||y===v){if(Ce)return[0,0];if(+Ue===y&&+Ue==+_e+1)return[0,0]}else{if(Ce)return[1,0];if(We)return[0,1]}else{if(+_e===y&&+_e==+Ue+1)return[1,0];if(+Ue===y&&+Ue==+_e+1)return[0,1]}if(_e>Ue&&_e>=y)return[1,0];if(Ue>_e&&Ue>=y)return[0,1]}else if(de[0].supertiebreak!==void 0&&de[1].supertiebreak!==void 0){if(de[0].supertiebreak>de[1].supertiebreak+1&&de[0].supertiebreak>=S)return[1,0];if(de[1].supertiebreak>de[0].supertiebreak+1&&de[1].supertiebreak>=S)return[0,1]}return[0,0]}).reduce((de,_e)=>[de[0]+_e[0],de[1]+_e[1]]):[0,0]}function De(ue=!0){if(!M.length)return;let de=Se();if(+de[0]==+de[1]&&!he()&&!me()&&!ne()&&re()===void 0)return;let _e=Math.max(...de),Ue=Math.max(I,Math.floor(M.length/2)+1);if(_e<Ue)return;const Ce=de[0]>=Ue&&1||(de[1]>=Ue?2:void 0);if(Ce===void 0&&!he()&&!me()&&!ne()&&re()===void 0){A(!1);return}return R.p1tiebreak.element.style.display!=="inline"&&ue&&A(!0),R[Ce===1?"p1action":"p2action"].ddlb.setValue("winner"),R[Ce===2?"p1action":"p2action"].ddlb.setValue(""),R[Ce===2?"p1action":"p2action"].ddlb.lock(),F(Ce-1),D=M.length,Ce-1}function Oe(ue){let de=M.length;return+ue===M.length-1&&de&&M[de-1][0].supertiebreak!==void 0?M[de-1]:!1}function xe(ue,de){return U?De(de)!==void 0&&Oe(ue)?!0:$e(ue):!1}function $e(ue){let de=Se();if(+de[0]==+de[1]&&+de[0]+1===I&&+ue==+M.length)return!0}function Ae(ue,de,_e){return de||C||ue===void 0?!1:M.length===0?!0:!((De(_e)!==void 0||re()!==void 0)&&(ue===void 0||+ue===M.length))}function ve({selected_set:ue,tiebreak:de,actions:_e}){E=xe(ue,_e);let Ue=Ae(ue,de||E,_e);if(!Ue&&!E&&(ue=M.length),D=Math.min(b-1,+ue),Ue&&Ie(),E&&!a){let ot=$e(ue);R.p1tiebreak.element.style.display="inline",R.p2tiebreak.element.style.display="inline",R.p1tiebreak.element.disabled=!1,R.p2tiebreak.element.disabled=!1,ot||(R.p1action.ddlb.setValue(" "),R.p2action.ddlb.setValue(" "),A(!1));let mt=Oe(ue);mt&&(R.p1tiebreak.element.value=mt[0].supertiebreak,R.p2tiebreak.element.value=mt[1].supertiebreak)}let Ce=M[ue],We=a?M:M.slice(0,+ue),He=M.slice(+ue+1);a&&!M.length&&(We=[[{games:0},{games:0}]]);let Be=We.map((ot,mt)=>oE({setnum:mt,score:ot[0]})).join(""),et=We.map((ot,mt)=>oE({setnum:mt,score:ot[1]})).join("");R.p1scores.element.innerHTML=Be,R.p2scores.element.innerHTML=et,R.p1selector.ddlb.setValue(Ce?Ce[0].games+"":""),R.p2selector.ddlb.setValue(Ce?Ce[1].games+"":""),R.p1selector.element.style.display=Ue&&!C&&!a?"flex":"none",R.p2selector.element.style.display=Ue&&!C&&!a?"flex":"none",Be=He.map((ot,mt)=>oE({setnum:+ue+1+mt,score:ot[0]})).join(""),et=He.map((ot,mt)=>oE({setnum:+ue+1+mt,score:ot[1]})).join(""),R.p1scores_e.element.innerHTML=Be,R.p2scores_e.element.innerHTML=et}function ke(){const ue=R.p1action.ddlb.getValue(),de=R.p2action.ddlb.getValue(),_e=ue==="winner"&&1||de==="winner"&&2||void 0;let Ue=[1,2].includes(_e),Ce=M.map(He=>{if(He[0].supertiebreak)return`[${He[0].supertiebreak}-${He[1].supertiebreak}]`;let Be=He[0].tiebreak,et=He[1].tiebreak,ot=Be!==void 0||et!==void 0?`(${[Be,et].filter(mt=>mt>=0).join("-")})`:"";return`${He[0].games}-${He[1].games}${ot}`}).join(" "),We;return[1,2].includes(_e)&&(We="COMPLETED"),(ue==="retired"||de==="retired")&&(We="RETIRED"),(ue==="time"||de==="time")&&(Ce+=" TIME"),(ue==="walkover"||de==="walkover")&&(We="WALKOVER",Ue=!0),(ue==="defaulted"||de==="defaulted")&&(We="DEFAULTED",Ue=!0),(ue==="abandoned"||de==="abandoned")&&(We="ABANDONED",Ue=!0,Ce=""),(ue==="interrupted"||de==="interrupted")&&(We="SUSPENDED",Ue=!1),(ue==="live"||de==="live")&&(We="IN_PROGRESS",Ue=!1),(ue==="cancelled"||de==="cancelled")&&(We="CANCELLED",Ue=!1),(ue==="incomplete"||de==="incomplete")&&(We="ABANDONED",Ue=!1),{matchUpStatus:We,winningSide:_e,complete:Ue,score:Ce}}function ye(){C=!1,R.p1selector.ddlb.unlock(),R.p2selector.ddlb.unlock(),R.p1action.ddlb.unlock(),R.p2action.ddlb.unlock()}function Ie(){R.p1tiebreak.element.value="",R.p2tiebreak.element.value="",R.p1tiebreak.element.style.display="none",R.p2tiebreak.element.style.display="none"}function Ne(ue,de){let _e=R.p1action.ddlb.getValue(),Ue=R.p2action.ddlb.getValue(),Ce=De(),We=ue?_e:Ue;if(m.auto_score=n.auto_score,de===""){Ce!==void 0&&(M=[],D=0,R[ue?"p2action":"p1action"].ddlb.setValue(" ")),R[ue?"p1action":"p2action"].ddlb.setValue(" "),ye();let He=M.length;if(He){let Be=M[He-1];!te(Be[0].games,Be[1].games)&&!Q(Be[0].games,Be[1].games)&&(D=He-1)}ve({selected_set:D})}else["interrupted","cancelled","incomplete","abandoned"].indexOf(de)>=0?(R[ue?"p1action":"p2action"].ddlb.setValue(" "),ve({selected_set:D}),A(!0)):de==="live"?(m.auto_score=!1,R[ue?"p1action":"p2action"].ddlb.setValue(" "),ve({selected_set:D}),A(!0)):de==="winner"&&We==="winner"?(Ce===void 0&&R[ue?"p1action":"p2action"].ddlb.setValue("retired"),ve({selected_set:D}),A(!0)):["time","retired","walkover","defaulted"].indexOf(de)>=0?(A(!0),Ce!==void 0?(R[Ce?"p2action":"p1action"].ddlb.setValue("winner"),R[Ce?"p1action":"p2action"].ddlb.setValue(" "),R[Ce?"p2action":"p1action"].ddlb.unlock(),R[Ce?"p1action":"p2action"].ddlb.lock()):(R.p1tiebreak.element.disabled=!1,R.p2tiebreak.element.disabled=!1,R[ue?"p1action":"p2action"].ddlb.setValue("winner"),R[ue?"p1action":"p2action"].ddlb.unlock(),R[ue?"p2action":"p1action"].ddlb.lock(),(de==="time"||de==="retired"||de==="defaulted")&&(Ce!==void 0&&R[ue?"p2action":"p1action"].ddlb.setValue(" "),D=M.length),(de==="time"||de==="retired")&&!M.length&&R[ue?"p2action":"p1action"].ddlb.setValue("walkover"),de==="walkover"&&(M=[],D=0),ve({selected_set:D}))):de==="winner"&&(Ce===void 0?R[ue?"p1action":"p2action"].ddlb.setValue(M.length?"retired":"walkover"):R[ue?"p1action":"p2action"].ddlb.setValue(" "),R[ue?"p1action":"p2action"].ddlb.lock(),C=!0,R.p1selector.ddlb.lock(),R.p2selector.ddlb.lock(),ve({selected_set:D}))}function Fe({sobj:ue,changeFx:de}){Ko.attachDropDown({id:ue.bestof.id,options:Ce(r.bestof)}),ue.bestof.ddlb=new Ko.DropDown({element:ue.bestof.element,id:ue.bestof.id,onChange:We}),ue.bestof.ddlb.setValue(b,"white"),Ko.attachDropDown({id:ue.setsto.id,options:Ce(r.setsto)}),ue.setsto.ddlb=new Ko.DropDown({element:ue.setsto.element,id:ue.setsto.id,onChange:et}),ue.setsto.ddlb.setValue(y,"white");let _e=y,Ue=Be(_e);Ko.attachDropDown({id:ue.tiebreaksat.id,options:Ue}),ue.tiebreaksat.ddlb=new Ko.DropDown({element:ue.tiebreaksat.element,id:ue.tiebreaksat.id,onChange:ot}),ue.tiebreaksat.ddlb.setValue(v&&v<_e?v:_e,"white"),ue.tiebreaksat.ddlb.setValue(v||"","white"),Ko.attachDropDown({id:ue.tiebreaksto.id,options:Ce(r.tiebreaksto)}),ue.tiebreaksto.ddlb=new Ko.DropDown({element:ue.tiebreaksto.element,id:ue.tiebreaksto.id,onChange:mt}),ue.tiebreaksto.ddlb.setValue(w,"white"),Ko.attachDropDown({id:ue.finalset.id,options:[{key:Fn.tr("scoring.normal"),value:"N"},{key:Fn.tr("scoring.supertiebreak"),value:"S"}]}),ue.finalset.ddlb=new Ko.DropDown({element:ue.finalset.element,id:ue.finalset.id,onChange:Rt}),ue.finalset.ddlb.selectionBackground(),ue.finalset.ddlb.setValue(U?"S":"N","white"),Ko.attachDropDown({id:ue.supertiebreakto.id,options:Ce(r.supertiebreakto)}),ue.supertiebreakto.ddlb=new Ko.DropDown({element:ue.supertiebreakto.element,id:ue.supertiebreakto.id,onChange:Ft}),ue.supertiebreakto.ddlb.selectionBackground(),ue.supertiebreakto.ddlb.setValue(S||10,"white"),He(U);function Ce(Je){return!Je||!Array.isArray(Je)?{}:Je.map(_t=>({key:_t,value:_t}))}function We(Je){b=parseInt(Je),I=Math.ceil(Je/2),U=!1,ue.finalset.ddlb.setValue("N","white"),He(U),typeof de=="function"&&de()}function He(Je){ue.stb2.element.style.opacity=Je?1:0,ue.supertiebreakto.element.style.opacity=Je?1:0}function Be(Je){return[{key:Fn.tr("none"),value:""},{key:`${Je-1}-${Je-1}`,value:Je-1},{key:`${Je}-${Je}`,value:Je}]}function et(Je){y=parseInt(Je),v=parseInt(Je);let _t=Be(Je);ue.tiebreaksat.ddlb.setOptions(_t),ue.tiebreaksat.ddlb.setValue(Je,"white"),typeof de=="function"&&de()}function ot(Je){v=parseInt(Je),typeof de=="function"&&de()}function mt(Je){w=parseInt(Je),typeof de=="function"&&de()}function Rt(Je){S=ue.supertiebreakto.ddlb.getValue()||10,U=Je==="S"?{tiebreakTo:S}:!1,He(U),typeof de=="function"&&de()}function Ft(Je){S=parseInt(Je),typeof de=="function"&&de()}}},t}();function oE({setnum:t,score:e={games:0}}){let i=e.tiebreak!==void 0&&e.tiebreak||e.spacer!==void 0&&e.spacer||"",n=e.supertiebreak!==void 0?e.supertiebreak:e.games;return`
      <div class="set score set_number setClick" setnum="${t!==void 0?t:""}">
         <div class="setscore setClick">${n}</div>
         <div class="tbscore" ${e.spacer!==void 0?'style="opacity: 0"':""}>${i}</div>
      </div>
   `}function I8e(t){if(!t)return"";if(t.status)return t.status;if(!t.schedule)return"";let e=S8e(t.schedule);if(e)return`Duration ${e}`;let i=`${t.schedule.time_prefix||""}${t.schedule.time||""}`,n=`${t.schedule.court||""}${i?" / "+i:""}`;return t.winner_index===void 0?n:""}const w8e=(t,e)=>{let i=parseInt(t,10),n=Math.floor(i/3600),r=Math.floor((i-n*3600)/60),o=i-n*3600-r*60,a=!e||(e==null?void 0:e.display_seconds),s=!e||(e==null?void 0:e.pad_hours);return n<10&&s&&(n="0"+n),r<10&&(r="0"+r),o<10&&(o="0"+o),a?n+":"+r+":"+o:n+":"+r};function S8e(t){if(!t.start||!t.end)return"";let e=UZ(t.end)-UZ(t.start);return w8e(e,{pad_hours:!1,display_seconds:!1})}function UZ(t){let e=t.split(":");return e[0]*60*60+e[1]*60}function Qx({matchUpId:t,callback:e}){var a;const{matchUp:i}=Ye.findMatchUp({matchUpId:t}),n=s=>{const{matchUpStatus:l,winningSide:c,score:u}=s,d=u&&Ye.parseScoreString({scoreString:u}),p=[{method:j4,params:{drawId:i.drawId,outcome:{score:{sets:d},matchUpStatus:l,winningSide:c},matchUpId:t}}];xt({methods:p,callback:f=>{Dw(),vt(e)&&e({...f,outcome:s})}})},r=i.sides.map(s=>s.participant),o=((a=i.score)==null?void 0:a.sets)||[];b8e.setMatchScore({delegation:ar.scoring.delegation,round_name:i.roundName||"",matchFormat:i.matchUpFormat,callback:n,muid:i.matchUpId,existing_scores:o,teams:r})}function T8e(t,e){const i=e.getRow(),n=i.getData(),{matchUpId:r,readyToScore:o}=n;o&&Qx({matchUpId:r,callback:s=>{var l;if(s.success){const{matchUpStatus:c,sets:u,matchUpFormat:d,score:p,winningSide:h}=s.outcome;Object.assign(n,{matchUpStatus:c,sets:u,matchUpFormat:d,score:p}),n.winningSide=h&&`side${h}`,i.update(n),e.getTable().redraw(!0);const m=(l=s.results.find(({methodName:g})=>g===j4))==null?void 0:l.tieMatchUpResult;O8e(m)}else console.log({result:s})}})}function U8e({matchUp:t}){var r,o,a,s,l,c;const e=((a=(o=(r=t.sides)==null?void 0:r.find(u=>u.sideNumber===1))==null?void 0:o.participant)==null?void 0:a.participantName)||"Side 1",i=((c=(l=(s=t.sides)==null?void 0:s.find(u=>u.sideNumber===2))==null?void 0:l.participant)==null?void 0:c.participantName)||"Side 2",n=(u,d)=>{var p;return(p=u==null?void 0:u.participantName)==null?void 0:p.localeCompare(d==null?void 0:d.participantName)};return[{formatter:H9(iE(t)),cellClick:(u,d)=>iE(t)({event:u,cell:d}),sorter:n,title:e,responsive:!1,minWidth:100,field:"side1",widthGrow:2},{formatter:H9(iE(t)),cellClick:(u,d)=>iE(t)({event:u,cell:d}),sorter:n,title:i,responsive:!1,minWidth:100,field:"side2",widthGrow:2},{formatter:W4,cellClick:T8e,responsive:!1,title:"Score",field:"score",width:140},{field:"matchUpStatus",title:"Status",width:150}]}function D8e({matchUp:t,tableElement:e,collectionMatchUps:i}){const n=i.map(a=>tS({...a,dualMatchUp:t})),r=U8e({matchUp:t});return{table:new bo(e,{responsiveLayoutCollapseStartOpen:!1,responsiveLayout:"collapse",placeholder:"No matches",reactiveData:!0,layout:"fitColumns",index:"matchUpId",columns:r,data:n})}}function eIe({side1:t,side2:e,side1Score:i,side2Score:n}){const r=document.createElement("div");r.className="overlay-content-overview";const o=document.createElement("div");o.className="overlay-content-body";const a=P8e({side1Score:i,side2Score:n});return o.appendChild(t),o.appendChild(a),o.appendChild(e),r.appendChild(o),r}function EN({participantName:t,justify:e="start"}){const i=document.createElement("div");i.className=`matchup-side justify-${e}`;const n=document.createElement("div");return n.className="side-name",n.innerHTML=t,i.appendChild(n),i}function P8e({side1Score:t,side2Score:e}){const i=document.createElement("div");i.className="score-box";const n=document.createElement("div");n.className="score-flex";const r=document.createElement("div");return r.className="score-vs",r.innerHTML="vs",n.appendChild(t),n.appendChild(r),n.appendChild(e),i.appendChild(n),i}function MN({winningSide:t,sets:e,sideNumber:i,id:n}){var l;const r=`side${i}Score`,o=((l=e==null?void 0:e[0])==null?void 0:l[r])||0,a=document.createElement("span");return n&&(a.id=n),a.className="side-score",i===1?a.style.paddingLeft="1rem":a.style.paddingRight="1rem",i===t&&a.classList.add("has-text-success"),a.innerHTML=o,a}let tIe;function iIe({title:t,content:e,footer:i}={}){if(!e||!i)return;const n=document.getElementById(oU);n&&Ua(n);const r=document.createElement("div");r.className="overlay noselect",r.id=oU;const o=document.createElement("div");o.className="overlay-center-align",r.appendChild(o);const a=document.createElement("div");if(a.className="overlay-root",o.appendChild(a),t){const u=E8e({title:t});a.appendChild(u)}const s=document.createElement("div");s.className="overlay-content",typeof e=="string"?s.innerHTML=e:e&&s.appendChild(e),a.appendChild(s);const l=document.createElement("div");l.className="overlay-footer",typeof i=="string"?l.innerHTML=i:i&&l.appendChild(i),a.appendChild(l),document.body.appendChild(r),tIe=window.scrollY||document.documentElement.scrollTop;const c=document.getElementById("root");c.style.display=ht}function C8e({content:t}){var i,n;const e=(n=(i=document.getElementById(oU))==null?void 0:i.getElementsByClassName("overlay-content"))==null?void 0:n[0];e&&(Ua(e),typeof t=="string"?e.innerHTML=t:t&&e.appendChild(t))}function E8e({title:t}){const e=document.createElement("h2");return e.className="overlay-header",e.innerHTML=`
    <div class="overlay-header-content">
      <h1 class="overlay-title">${t}</h1> 
    </div>
  `,e}function nIe(){const t=document.getElementById("root");t.style.display="inline",window.scrollTo({top:tIe});let e=document.getElementById(oU);Ua(e);let i=0;for(;i<5&&e;)e.remove(),i+=1,e=document.getElementById(oU)}const rIe=[{key:"custom",name:"Custom",desc:""},{key:"standard",name:"Standard Advantage",format:"SET3-S:6/TB7",desc:"Best of 3 Sets to 6 with Advantage"},{key:"atpd",name:"Standard Doubles",format:"SET3-S:6/TB7-F:TB10",desc:"Best of 3 Sets to 6, no Ad",desc2:"Final Set Tiebreak to 10"},{key:"standard1",name:"One Standard Set",format:"SET1-S:6/TB7",desc:"1 Set to 6 Games, Tiebreak to 7"},{key:"wimbledon2018",name:"Wimbledon 2018",format:"SET5-S:6/TB7-F:6",desc:"Best of 5 tiebreak sets, final set no tiebreak"},{key:"wimbledon2019",name:"Wimbledon 2019",format:"SET5-S:6/TB7-F:6/TB7@12",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"Aus2019",name:"Australian Open 2019",format:"SET5-S:6/TB7-F:6/TB10",desc:"Best of 5 tiebreak sets, final set tiebreak at 12"},{key:"short",name:"Short Sets TB7@4",format:"SET3-S:4/TB7",desc:"Best of 3 Sets to 4, tiebreak to 7 at 4-4"},{key:"short1",name:"Fast 4",format:"SET3-S:4/TB5@3",desc:"Best of 3 Sets to 4, tiebreak to 5 at 3-3"},{key:"short2",name:"One Short Set TB7",format:"SET1-S:4/TB7",desc:"One Set to 4, tiebreak to 7 at 4-4"},{key:"short3",name:"One Short Set TB5",format:"SET1-S:4/TB5@3",desc:"One Set to 4, tiebreak to 5 at 3-3"},{key:"short4",name:"Short Sets w/ 3rd TB10",format:"SET3-S:4/TB7-F:TB10",desc:"Best of 3 Sets to 4 Games, tiebreak to 10",desc2:"3rd Set Tiebreak to 7"},{key:"short5",name:"Short Sets w/ 3rd TB7",format:"SET3-S:4/TB7-F:TB7",desc:"Best of 3 Sets to 4 Games, tiebreak to 7",desc2:"3rd Set Tiebreak to 7"},{key:"pro",name:"Pro Set",format:"SET1-S:8/TB7",desc:"One Set to 8 with Advantage, tiebreak at 8-8"},{key:"cps",name:"College Pro Set",format:"SET1-S:8/TB7@7"},{key:"tbsets1",name:"Best of 3 TB7",format:"SET3-S:TB7",desc:"Two tiebreak sets",desc2:"7-point match tiebreak at one set all"},{key:"tbsets2",name:"Best of 3 TB10",format:"SET3-S:TB10",desc:"Best of 3 tiebreaks to 10"},{key:"tbsets3",name:"One Tiebreak to 10",format:"SET1-S:TB10",desc:"One Match Tiebreak to 10 with Advantage"},{key:"tbsets4",name:"Two TB7 w/ 3rd TB10",format:"SET3-S:TB7-F:TB10",desc:"Two 7 point tiebreak sets",desc2:"10 point tiebreak at one set all"},{key:"timed10",name:"Timed 10 minute game - game based",format:"SET1-S:T10"}];let Vg,Co;const uM="Timed set",WS="Tiebreak",P$="No-Ad",Cl="Set",TT="Ad",ms={setFormat:{descriptor:"Best of",bestOf:3,advantage:TT,what:Cl,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10},finalSetFormat:{descriptor:"Final set",advantage:TT,what:Cl,setTo:6,tiebreakAt:6,tiebreakTo:7,winBy:2,minutes:10}};function DZ(t){var o;const e=t?"finalSetFormat":"setFormat",i=ms[e].what,n={setTo:ms[e].setTo};return i===Cl&&ms[e].advantage===P$&&(n.NoAD=!0),i===Cl&&((o=document.getElementById(t?"finalSetTiebreak":"setTiebreak"))==null?void 0:o.checked)&&(n.tiebreakAt=ms[e].tiebreakAt,n.tiebreakFormat={tiebreakTo:ms[e].tiebreakTo},i===Cl&&ms[e].winBy===1&&(n.tiebreakFormat.NoAD=!0)),i===uM&&(n.minutes=ms[e].minutes,n.timed=!0),i===WS&&(n.tiebreakSet={tiebreakTo:ms[e].tiebreakTo},ms[e].winBy===1&&(n.tiebreakSet.NoAD=!0)),n}function oIe(){var a;const t=DZ();Co={bestOf:ms.setFormat.bestOf,setFormat:t},((a=document.getElementById("finalSetOption"))==null?void 0:a.checked)&&(Co.finalSetFormat=DZ(1));const i=HN.scoreGovernor.stringifyMatchUpFormat(Co),n=!!rIe.find(s=>s.format===i),r=document.getElementById("matchUpFormatSelector"),o=r==null?void 0:r.querySelectorAll("option");return Array.from(o).forEach(s=>{s.selected=!n&&s.value==="Custom"||s.value===i}),i}function qS(t){const e=t||oIe(),i=document.getElementById("matchUpFormatString");i.innerHTML=e}const jg=(t,e)=>e&&t.finalSetFormat||t.setFormat,oI=[{getValue:t=>t.bestOf>1?"Best of":"Exactly",options:["Best of","Exactly"],id:"descriptor",value:"Best of",finalSet:!1},{getValue:t=>t.bestOf,finalSet:!1,id:"bestOf",options:[1,3,5],onChange:"pluralize",value:3},{getValue:(t,e)=>{const i=jg(t,e),n=i!=null&&i.NoAD?P$:TT;return i!=null&&i.timed||i!=null&&i.tiebreakSet?void 0:n},options:[TT,P$],defaultValue:TT,id:"advantage",whats:[Cl]},{getValue:(t,e)=>{const i=jg(t,e);return i||console.log({pmf:t}),i!=null&&i.timed?uM:i!=null&&i.tiebreakSet?WS:Cl},options:[Cl,WS,uM],finalSetLabel:`${Cl}${tp}`,onChange:"changeWhat",pluralize:!0,id:"what"},{getValue:(t,e)=>jg(t,e).setTo,options:[1,2,3,4,5,6,7,8,9],onChange:"changeCount",defaultValue:6,whats:[Cl],prefix:"to ",id:"setTo"},{getValue:(t,e)=>{var n,r;const i=jg(t,e);return((n=i.tiebreakFormat)==null?void 0:n.tiebreakTo)||((r=i.tiebreakSet)==null?void 0:r.tiebreakTo)},options:[5,7,9,10,12],whats:[Cl,WS],id:"tiebreakTo",defaultValue:7,prefix:"TB to ",tbSet:!0,value:7,tb:!0},{getValue:(t,e)=>jg(t,e).tiebreakAt,options:t=>{const e=ms[t?"finalSetFormat":"setFormat"].setTo;return e>1?[e-1,e]:[]},id:"tiebreakAt",defaultValue:6,whats:[Cl],prefix:"@",value:6,tb:!0},{getValue:(t,e)=>{var n;const i=jg(t,e);if(i.tiebreakFormat)return(n=i.tiebreakFormat)!=null&&n.NoAD?1:2},whats:[Cl,WS],prefix:"Win by ",options:[1,2],defaultValue:2,tbSet:!0,id:"winBy",tb:!0},{getValue:(t,e)=>{const i=jg(t,e);return i.timed&&i.minutes||void 0},options:[10,15,20,25,30,45,60,90],whats:[uM],suffix:" Minutes",defaultValue:10,id:"minutes",timed:!0}],PZ={changeWhat:(t,e,i)=>{const n=i===Cl,r=e?"finalSetTiebreakToggle":"setTiebreakToggle",o=document.getElementById(r);o.style.display=n?"":ht,oI.forEach(a=>{if(a.whats){const{prefix:s="",suffix:l="",pluralize:c}=a,u=a.whats.includes(i),d=e?`${a.id}-${e}`:a.id,p=document.getElementById(d);if(p.style.display===ht&&u){const h=Co.bestOf,f=!e&&c&&h>1?"s":"",m=a.defaultValue;p.innerHTML=`${s}${m}${f}${l}${tp}`}p.style.display=u?"":ht}})},changeCount:(t,e,i)=>{const n=e?`tiebreakAt-${e}`:"tiebreakAt";ms[e?"finalSetFormat":"setFormat"].tiebreakAt=i;const r=document.getElementById(n);r.innerHTML=`@${i}${tp}`},pluralize:(t,e,i)=>{const n=ms[e?"finalSetFormat":"setFormat"].what,r=e?`what-${e}`:"what",o=document.getElementById(r),a=i>1?"s":"";o.innerHTML=`${n}${a}${tp}`}};function i5({existingMatchUpFormat:t="SET3-S:6/TB7",callback:e}={}){var T;Vg=t,Co=Tp.parse(Vg),console.log({parsedMatchUpFormat:Co});const i=()=>{const S=oIe();vt(e)&&e(S)};let n,r,o,a,s;const l=[{onClick:()=>e(),label:"Cancel",intent:"none",close:!0},{label:"Select",intent:"is-info",close:!0,onClick:i}],c="switch is-rounded is-danger",u=document.createElement("div"),d=document.createElement("div");d.id="matchUpFormatString",d.innerHTML=Vg,d.style.fontSize="1.5em",d.style.color="blue",d.style.marginBottom="1em",u.appendChild(d);const p=document.createElement("div");p.style.marginBlockEnd="1em";const h={id:"matchUpFormatSelector",options:rIe.map(S=>({selected:S.format===Vg,value:S.format,label:S.name}))},{field:f,inputElement:m}=bT(h);m.onchange=S=>{Vg=S.target.value,qS(Vg),Co=Tp.parse(Vg);const w=Co.finalSetFormat;n.style.display=w?"":ht,r.style.display=w?"":ht,o.checked=w,s.checked=!!(w!=null&&w.tiebreakFormat),a.checked=Co.setFormat.tiebreakFormat,oI.forEach(U=>{if(U.getValue){const D=U.getValue(Co),E=document.getElementById(U.id);if(E&&D){const{prefix:C="",suffix:M="",pluralize:N}=U,R=Co.bestOf,A=N&&R>1?"s":"";E.innerHTML=`${C}${D}${A}${M}${tp}`,E.style.display=""}else E&&(E.style.display=ht);if(w){const C=U.getValue(Co,!0),M=document.getElementById(`${U.id}-1`);if(M&&C){const{prefix:N="",suffix:R="",pluralize:A}=U,_=Co.bestOf,k=A&&_>1?"s":"";M.innerHTML=`${N}${C}${k}${R}${tp}`,M.style.display=""}else M&&(M.style.display=ht)}}})},p.appendChild(f),u.appendChild(p);const g=document.createElement("div");oI.map(S=>{const w=S.getValue(Co);return CZ({...S,value:w})}).forEach(S=>g.appendChild(S)),g.id="setFormat",u.appendChild(g);const v=document.createElement("div");v.className="field",v.style.fontSize="1em",a=document.createElement("input"),a.className=c,a.name="setTiebreak",a.id="setTiebreak",a.type="checkbox",a.checked=Co.tiebreakFormat,a.onchange=S=>{const w=S.target.checked;oI.filter(({tb:U})=>U).forEach(U=>{const D=document.getElementById(U.id);if(D.style.display===ht&&w){const{prefix:E="",suffix:C="",pluralize:M,defaultValue:N}=U,R=Co.bestOf,A=M&&R>1?"s":"";D.innerHTML=`${E}${N}${A}${C}${tp}`}D.style.display=w?"":ht}),qS()},v.appendChild(a);const y=document.createElement("label");y.setAttribute("for","setTiebreak"),y.id="setTiebreakToggle",y.innerHTML="Tiebreak",y.style.marginRight="1em",v.appendChild(y),o=document.createElement("input"),o.className="switch is-rounded is-info",o.type="checkbox",o.name="finalSetOption",o.checked=!!Co.finalSetFormat,o.id="finalSetOption",o.onchange=S=>{const w=S.target.checked;n.style.display=w?"":ht,r.style.display=w?"":ht,qS()},v.appendChild(o);const b=document.createElement("label");b.setAttribute("for","finalSetOption"),b.innerHTML="Final set",v.appendChild(b),u.appendChild(v),n=document.createElement("div"),n.style.display=Co.finalSetFormat?"":ht,n.id="finalSetFormat",[{label:"<div style='font-weight: bold'>Final set</div>",options:[]}].concat(oI.map(S=>{const w=S.getValue(Co,!0);return{...S,value:w}})).filter(S=>S.finalSet!==!1).map(S=>CZ({...S,index:1})).forEach(S=>n.appendChild(S)),u.appendChild(n),r=document.createElement("div"),r.style.display=Co.finalSetFormat?"":ht,r.className="field",r.style.fontSize="1em",s=document.createElement("input"),s.className=c,s.name="finalSetTiebreak",s.id="finalSetTiebreak",s.type="checkbox",s.checked=(T=Co.finalSetFormat)==null?void 0:T.tiebreakFormat,r.onchange=S=>{const w=S.target.checked;oI.filter(({tb:U})=>U).forEach(U=>{const D=document.getElementById(`${U.id}-1`);if(D.style.display===ht&&w){const{prefix:E="",suffix:C="",pluralize:M,defaultValue:N}=U,R=Co.bestOf,A=M&&R>1?"s":"";D.innerHTML=`${E}${N}${A}${C}${tp}`}D.style.display=w?"":ht}),qS()},r.appendChild(s);const I=document.createElement("label");I.setAttribute("for","finalSetTiebreak"),I.id="finalSetTiebreakToggle",I.innerHTML="Tiebreak",I.style.marginRight="1em",r.appendChild(I),u.appendChild(r),lr({title:"Score format",content:u,buttons:l})}function M8e({index:t,finalSetLabel:e,label:i,prefix:n="",suffix:r="",value:o,pluralize:a}){const s=!t&&a&&ms.setFormat.bestOf>1?"s":"";return i||t&&e||`${n}${o}${s}${r}${tp}`}function CZ(t){const{id:e,initiallyHidden:i,index:n,value:r}=t,o=document.createElement("button");return o.className="mfcButton",o.id=n?`${e}-${n}`:e,o.innerHTML=M8e(t),o.onclick=a=>R8e({e:a,button:o,...t}),o.style.display=r||t.label?"":ht,i&&(o.style.display=ht),o}function R8e(t){const{e,id:i,button:n,pluralize:r,options:o,onChange:a,index:s,prefix:l="",suffix:c=""}=t,u=ms.setFormat.bestOf,d=!s&&r&&u>1?"s":"",h=(vt(o)?o(s):o).map(f=>({text:`${f}${d}`,onClick:()=>{n.innerHTML=`${l}${f}${d}${c}${tp}`,a&&vt(PZ[a])&&PZ[a](e,s,f),ms[s?"finalSetFormat":"setFormat"][i]=f,qS()}}));bl({items:h,target:e.target,config:{arrow:!1,offset:[0,0]}})}function N8e(){return[{rowHandle:!0,formatter:"handle",width:30,minWidth:30},{cellClick:(e,i)=>i.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",responsive:!1,hozAlign:Lt,width:5},{formatter:"responsiveCollapse",responsive:!1,resizable:!1,hozAlign:Vt,width:50},{editorParams:{selectContents:!0},field:"collectionName",minWidth:200,title:"Name",editor:!0},{field:"matchUpCount",editor:"number",title:"#",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:20,min:0}},{field:"matchUpType",editor:"list",title:"Type",width:100,editorParams:{values:["Singles","Doubles"]}},{title:"Gender",field:"gender",editor:"list",width:100,editorParams:{values:["Male","Female","Any"]}},{cellClick:(e,i)=>{const n=i.getRow(),r=n.getData();i5({callback:a=>{a&&(Object.assign(r,{matchUpFormat:a}),n.update(r),i.getTable().redraw(!0))},existingMatchUpFormat:r.matchUpFormat})},title:"Score format",field:Bz,minWidth:150},{title:"Award type",field:"awardType",editor:"list",width:150,editorParams:{values:[xz,Oz,Fz,Lz]}},{field:"awardValue",editor:"number",title:"Value",width:70,editorParams:{elementAttributes:{maxlength:2},selectContents:!0,mask:"99",step:1,max:99,min:0}}]}function EZ(t){return(t==null?void 0:t[0].toUpperCase())+(t==null?void 0:t.substring(1).toLowerCase())||""}function A8e({tableElement:t,tieFormat:e}){const i=((e==null?void 0:e.collectionDefinitions)||[]).map(o=>{const{collectionValue:a,matchUpValue:s,scoreValue:l,setValue:c,matchUpType:u,gender:d}=o,p=Di.isConvertableInteger(a)&&xz||Di.isConvertableInteger(l)&&Lz||Di.isConvertableInteger(c)&&Fz||Oz,h=a??l??c??s;return{...o,matchUpType:EZ(u),gender:EZ(d),awardValue:h,awardType:p}}),n=N8e();return{table:new bo(t,{responsiveLayoutCollapseStartOpen:!1,columnDefaults:{headerSort:!1},placeholder:"No collections",responsiveLayout:"collapse",index:"collectionId",reactiveData:!0,layout:"fitColumns",movableRows:!0,minHeight:200,columns:n,data:i})}}function aIe(t){var r,o,a;const e=(r=t==null?void 0:t.winCriteria)==null?void 0:r.valueGoal,i=(o=t==null?void 0:t.collectionDefinitions)!=null&&o.length?((a=t==null?void 0:t.winCriteria)==null?void 0:a.aggregateValue)&&"Aggregate value":"none";return`<div style="font-weight: bold">Win criteria: <span class="has-text-success">${e||i}</span></div>`}function sIe({title:t,tieFormat:e,onClose:i}){const{content:n,inputs:r,elements:o,table:a}=_8e({tieFormat:e}),s=u=>{const d=r.tieFormatName.value,p=u.map(f=>Di.definedAttributes({collectionValue:f.awardType===xz?f.awardValue:void 0,matchUpValue:f.awardType===Oz?f.awardValue:void 0,scoreValue:f.awardType===Lz?f.awardValue:void 0,setValue:f.awardType===Fz?f.awardValue:void 0,matchUpType:f.matchUpType.toUpperCase(),collectionName:f.collectionName,matchUpFormat:f.matchUpFormat,gender:f.gender.toUpperCase(),collectionId:f.collectionId,matchUpCount:f.matchUpCount})),h=Ye.calculateWinCriteria({collectionDefinitions:p});return{collectionDefinitions:p,tieFormatName:d,winCriteria:h}};a.on("dataChanged",()=>{const u=s(a.getData());o.winCriteria.innerHTML=aIe(u)});const c=x8e({table:a,onClose:u=>{var p;const d=s(u);vt(i)&&i(((p=d==null?void 0:d.collectionDefinitions)==null?void 0:p.length)&&d)}});return iIe({title:t,content:n,footer:c})}function _8e({tieFormat:t}){const e=document.createElement("div");e.className="overlay-content-container",e.style.backgroundColor="white";const i=document.createElement("div"),{table:n}=A8e({tieFormat:t,tableElement:i}),r=k8e();e.appendChild(r);const o=document.createElement("div");e.appendChild(o),e.appendChild(i);const a=()=>{const u=n==null?void 0:n.getSelectedData().map(({collectionId:d})=>d);n==null||n.deleteRow(u)},s=[{value:(t==null?void 0:t.tieFormatName)||"Custom scorecard",error:"minimum of 5 characters",placeholder:"Scorecard name",validator:Xl(5),field:"tieFormatName",id:"tieFormatName",location:Lt},{text:aIe(t),id:"winCriteria",location:Lt},{onClick:a,label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{onClick:()=>{const d={collectionName:`Collection ${n.getData().length+1}`,collectionId:Di.UUID(),awardType:"Match value",matchUpFormat:"SET3-S:6/TB7",matchUpType:"Singles",matchUpCount:1,gender:"Any",awardValue:1};n.addRow(d)},label:"Add collection",intent:"is-info",location:Ut}],{elements:l,inputs:c}=Da({table:n,target:o,items:s});return{content:e,table:n,elements:l,inputs:c}}function k8e(t){const e=document.createElement("div");e.className="overlay-content-overview";const i=document.createElement("div");return i.className="overlay-content-body",e.appendChild(i),e}function x8e({table:t,onClose:e}){const i=()=>{t.destroy(),nIe()},n=document.createElement("button");n.className="button is-warning is-light",n.onclick=i,n.innerHTML="Cancel";const r=document.createElement("button");r.className="button is-info button-spacer",r.onclick=a=>{a.preventDefault(),a.stopPropagation();const s=t.getData();i(),vt(e)&&e(s)},r.innerHTML="Done";const o=document.createElement("div");return o.className="overlay-footer-wrap",o.appendChild(n),o.appendChild(r),o}function lIe({matchUpId:t,structureId:e,eventId:i,drawId:n,callback:r}){const{tieFormat:o}=Ye.getTieFormat({structureId:e,matchUpId:t,eventId:i,drawId:n});sIe({title:"Edit scorecard",tieFormat:o,onClose:s=>{var l,c;if(s){if((l=s.collectionDefinitions)==null||l.forEach((h,f)=>h.collectionOrder=f+1),!((c=Di.compareTieFormats({considerations:{collectionName:!0,collectionOrder:!0},descendant:s,ancestor:o}))==null?void 0:c.different)){vi({intent:"is-info",message:"No changes"});return}xt({methods:[{method:"modifyTieFormat",params:{modifiedTieFormat:s,structureId:e,matchUpId:t,drawId:n}}],callback:h=>{var f;h.success?(vi({intent:"is-success",message:"Scorecard updated"}),vt(r)&&r()):vi({intent:"is-danger",message:((f=h.error)==null?void 0:f.message)||"Error"})}})}}})}const aE="has-text-success",cIe="tieSide1",uIe="tieSide2";function eO({title:t,drawId:e,matchUpId:i,onClose:n}){var l;const r=Ye.findMatchUp({drawId:e,matchUpId:i,participantsProfile:{withISO2:!0}}),o=r.matchUp;if(!o||r.error||!t||!Array.isArray((l=o==null?void 0:o.tieFormat)==null?void 0:l.collectionDefinitions))return;const a=tO({matchUp:o}),s=L8e({title:t,drawId:e,matchUpId:i,onClose:n});return iIe({title:t,content:a,footer:s})}function tO({matchUp:t}){const e=document.createElement("div");e.className="overlay-content-container";const i=EN({participantName:MZ({matchUp:t,sideNumber:1}),justify:"end"}),n=EN({participantName:MZ({matchUp:t,sideNumber:2}),justify:"start"}),{winningSide:r,sets:o}=t,a=MN({winningSide:r,sets:o,sideNumber:1,id:cIe}),s=MN({winningSide:r,sets:o,sideNumber:2,id:uIe}),l=eIe({side1:i,side2:n,side1Score:a,side2Score:s});e.appendChild(l),Qe.collectionTables||(Qe.collectionTables=[]);const c=t.tieFormat.collectionDefinitions;for(const u of c){const d=t.tieMatchUps.filter(g=>g.collectionId===u.collectionId),p=document.createElement("div");p.className="collection";const h=document.createElement("div");h.className="title is-4",h.innerHTML=u.collectionName,p.appendChild(h);const f=document.createElement("div");p.appendChild(f);const{table:m}=D8e({matchUp:t,tableElement:f,collectionMatchUps:d});Qe.collectionTables.push(m),e.appendChild(p)}return e}function O8e(t){var r,o;const e=(o=(r=t==null?void 0:t.score)==null?void 0:r.sets)==null?void 0:o[0];if(!e)return;const i=document.getElementById(cIe),n=document.getElementById(uIe);i.classList.remove(aE),n.classList.remove(aE),i.innerHTML=e.side1Score,n.innerHTML=e.side2Score,t.winningSide===1&&i.classList.add(aE),t.winningSide===2&&n.classList.add(aE)}function MZ({matchUp:t,sideNumber:e}){var i,n;return(n=(i=t.sides.find(r=>r.sideNumber===e))==null?void 0:i.participant)==null?void 0:n.participantName}function L8e({title:t,drawId:e,matchUpId:i,onClose:n}){const r=document.createElement("button");r.className="button is-warning is-light",r.onclick=()=>{lIe({matchUpId:i,drawId:e,callback:()=>{eO({title:t,drawId:e,matchUpId:i})}})},r.innerHTML="Edit scorecard";const o=u=>{var d;if(u.success){const p=(d=Ye.findMatchUp({drawId:e,matchUpId:i}))==null?void 0:d.matchUp,h=tO({matchUp:p});C8e({content:h})}},a=document.createElement("button");a.className="button is-warning is-light button-spacer",a.innerHTML="Remove players",a.onclick=()=>{xt({methods:[{params:{drawId:e,matchUpId:i,inheritance:!1},method:"resetMatchUpLineUps"}],callback:o})};const s=document.createElement("button");s.className="button is-info is-light button-spacer",s.innerHTML="Clear results",s.onclick=()=>{xt({methods:[{params:{drawId:e,matchUpId:i},method:Lye}],callback:o})};const l=document.createElement("button");l.className="button is-info button-spacer",l.onclick=u=>{for(u.preventDefault(),u.stopPropagation();Qe.collectionTables.length;)Qe.collectionTables.pop().destroy();nIe(),vt(n)&&n()},l.innerHTML="Done";const c=document.createElement("div");return c.className="overlay-footer-wrap",c.appendChild(r),c.appendChild(a),c.appendChild(s),c.appendChild(l),c}const{TEAM:F8e}=Fo,B8e=(t,e)=>(i,n)=>{var u;const r=n.getRow().getData(),{matchUpId:o,readyToScore:a,matchUpType:s,drawId:l,eventName:c}=r.matchUp;if(s===F8e)eO({title:c,matchUpId:o,drawId:l,onClose:()=>t()});else if(a||(u=r.matchUp.score)!=null&&u.scoreStringSide1)if(ar.hotkeys){e({e:i,cell:n,replaceTableData:t});const d=document.querySelectorAll(".activeScoreCell");for(const p of Array.from(d))p.classList.remove("activeScoreCell");i.target.classList.contains("tabulator-cell")?i.target.firstChild.classList.add("activeScoreCell"):i.target.classList.add("activeScoreCell")}else Qx({matchUpId:o,callback:t})};function dIe(t,e){if(!t.score&&!e.score){if(t.readyToScore&&!e.readyToScore)return-1;if(e.readyToScore&&!t.readyToScore)return 1}return t.score&&!e.score?-1:e.score&&!t.score?1:0}function $8e({data:t,replaceTableData:e,setFocusData:i}){const n=(l,c)=>{var f,m;const d=c.getRow().getData(),{courtName:p,scheduledDate:h}=d;if(p&&h){const g=(m=(f=Ye.getTournament())==null?void 0:f.tournamentRecord)==null?void 0:m.tournamentId,v=`/${Xo}/${g}/${Wv}/${h}`;Qe.router.navigate(v)}},r=()=>e(),o=t.some(l=>l.courtName),a=(l,c)=>XU(l,c,r),s=l=>{const c=document.createElement("div");c.className="has-text-warning-dark",c.innerHTML="Select participant";const u=({event:p,...h})=>{XU(p,l,r,h)};return l.getValue().participantName&&Ib(u)(l,c)};return[{cellClick:(l,c)=>c.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Vt,minWidth:50,width:50},{headerMenu:ah({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:Lt,width:55},{formatter:E3e(nr),field:"eventId",title:"Event",visible:!0,minWidth:200,widthGrow:1},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{field:"matchUpType",titleFormatter:j9,title:"Type",minWidth:90},{field:"roundName",title:"Round",titleFormatter:j9,minWidth:90},{cellClick:n,field:"scheduledDate",title:"Date",width:110},{cellClick:n,visible:!!o,field:"courtName",title:"Court",width:100},{cellClick:n,field:"scheduledTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:s,cellClick:a,sorter:Bw,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:s,cellClick:a,sorter:Bw,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:B8e(e,i),formatter:W4,sorter:dIe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:obe,formatter:abe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Lt,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(l,c)=>q4({pointerEvent:l,...c.getData()}),formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,widthGrow:0,width:50}]}const dF=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function pF(t,e,i,n){t.addEventListener?t.addEventListener(e,i,n):t.attachEvent&&t.attachEvent("on".concat(e),i)}function MS(t,e,i,n){t.removeEventListener?t.removeEventListener(e,i,n):t.detachEvent&&t.detachEvent("on".concat(e),i)}function pIe(t,e){const i=e.slice(0,e.length-1);for(let n=0;n<i.length;n++)i[n]=t[i[n].toLowerCase()];return i}function hIe(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let i=e.lastIndexOf("");for(;i>=0;)e[i-1]+=",",e.splice(i,1),i=e.lastIndexOf("");return e}function V8e(t,e){const i=t.length>=e.length?t:e,n=t.length>=e.length?e:t;let r=!0;for(let o=0;o<i.length;o++)n.indexOf(i[o])===-1&&(r=!1);return r}const nD={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":dF?173:189,"=":dF?61:187,";":dF?59:186,"'":222,"[":219,"]":221,"\\":220},xp={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},C$={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Za={16:!1,18:!1,17:!1,91:!1},mo={};for(let t=1;t<20;t++)nD["f".concat(t)]=111+t;let xr=[],UT=null,fIe="all";const Sh=new Map,i1=t=>nD[t.toLowerCase()]||xp[t.toLowerCase()]||t.toUpperCase().charCodeAt(0),j8e=t=>Object.keys(nD).find(e=>nD[e]===t),H8e=t=>Object.keys(xp).find(e=>xp[e]===t);function mIe(t){fIe=t||"all"}function rD(){return fIe||"all"}function G8e(){return xr.slice(0)}function z8e(){return xr.map(t=>j8e(t)||H8e(t)||String.fromCharCode(t))}function W8e(){const t=[];return Object.keys(mo).forEach(e=>{mo[e].forEach(i=>{let{key:n,scope:r,mods:o,shortcut:a}=i;t.push({scope:r,shortcut:a,mods:o,keys:n.split("+").map(s=>i1(s))})})}),t}function q8e(t){const e=t.target||t.srcElement,{tagName:i}=e;let n=!0;const r=i==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(r||i==="TEXTAREA"||i==="SELECT")&&!e.readOnly)&&(n=!1),n}function Y8e(t){return typeof t=="string"&&(t=i1(t)),xr.indexOf(t)!==-1}function K8e(t,e){let i,n;t||(t=rD());for(const r in mo)if(Object.prototype.hasOwnProperty.call(mo,r))for(i=mo[r],n=0;n<i.length;)i[n].scope===t?i.splice(n,1).forEach(a=>{let{element:s}=a;return n5(s)}):n++;rD()===t&&mIe(e||"all")}function Z8e(t){let e=t.keyCode||t.which||t.charCode;const i=xr.indexOf(e);if(i>=0&&xr.splice(i,1),t.key&&t.key.toLowerCase()==="meta"&&xr.splice(0,xr.length),(e===93||e===224)&&(e=91),e in Za){Za[e]=!1;for(const n in xp)xp[n]===e&&(ip[n]=!1)}}function gIe(t){if(typeof t>"u")Object.keys(mo).forEach(r=>{Array.isArray(mo[r])&&mo[r].forEach(o=>sE(o)),delete mo[r]}),n5(null);else if(Array.isArray(t))t.forEach(r=>{r.key&&sE(r)});else if(typeof t=="object")t.key&&sE(t);else if(typeof t=="string"){for(var e=arguments.length,i=new Array(e>1?e-1:0),n=1;n<e;n++)i[n-1]=arguments[n];let[r,o]=i;typeof r=="function"&&(o=r,r=""),sE({key:t,scope:r,method:o,splitKey:"+"})}}const sE=t=>{let{key:e,scope:i,method:n,splitKey:r="+"}=t;hIe(e).forEach(a=>{const s=a.split(r),l=s.length,c=s[l-1],u=c==="*"?"*":i1(c);if(!mo[u])return;i||(i=rD());const d=l>1?pIe(xp,s):[],p=[];mo[u]=mo[u].filter(h=>{const m=(n?h.method===n:!0)&&h.scope===i&&V8e(h.mods,d);return m&&p.push(h.element),!m}),p.forEach(h=>n5(h))})};function RZ(t,e,i,n){if(e.element!==n)return;let r;if(e.scope===i||e.scope==="all"){r=e.mods.length>0;for(const o in Za)Object.prototype.hasOwnProperty.call(Za,o)&&(!Za[o]&&e.mods.indexOf(+o)>-1||Za[o]&&e.mods.indexOf(+o)===-1)&&(r=!1);(e.mods.length===0&&!Za[16]&&!Za[18]&&!Za[17]&&!Za[91]||r||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(xr),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}function NZ(t,e){const i=mo["*"];let n=t.keyCode||t.which||t.charCode;if(!ip.filter.call(this,t))return;if((n===93||n===224)&&(n=91),xr.indexOf(n)===-1&&n!==229&&xr.push(n),["ctrlKey","altKey","shiftKey","metaKey"].forEach(s=>{const l=C$[s];t[s]&&xr.indexOf(l)===-1?xr.push(l):!t[s]&&xr.indexOf(l)>-1?xr.splice(xr.indexOf(l),1):s==="metaKey"&&t[s]&&xr.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(xr=xr.slice(xr.indexOf(l))))}),n in Za){Za[n]=!0;for(const s in xp)xp[s]===n&&(ip[s]=!0);if(!i)return}for(const s in Za)Object.prototype.hasOwnProperty.call(Za,s)&&(Za[s]=t[C$[s]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(xr.indexOf(17)===-1&&xr.push(17),xr.indexOf(18)===-1&&xr.push(18),Za[17]=!0,Za[18]=!0);const r=rD();if(i)for(let s=0;s<i.length;s++)i[s].scope===r&&(t.type==="keydown"&&i[s].keydown||t.type==="keyup"&&i[s].keyup)&&RZ(t,i[s],r,e);if(!(n in mo))return;const o=mo[n],a=o.length;for(let s=0;s<a;s++)if((t.type==="keydown"&&o[s].keydown||t.type==="keyup"&&o[s].keyup)&&o[s].key){const l=o[s],{splitKey:c}=l,u=l.key.split(c),d=[];for(let p=0;p<u.length;p++)d.push(i1(u[p]));d.sort().join("")===xr.sort().join("")&&RZ(t,l,r,e)}}function ip(t,e,i){xr=[];const n=hIe(t);let r=[],o="all",a=document,s=0,l=!1,c=!0,u="+",d=!1,p=!1;for(i===void 0&&typeof e=="function"&&(i=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(a=e.element),e.keyup&&(l=e.keyup),e.keydown!==void 0&&(c=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(o=e),p&&gIe(t,o);s<n.length;s++)t=n[s].split(u),r=[],t.length>1&&(r=pIe(xp,t)),t=t[t.length-1],t=t==="*"?"*":i1(t),t in mo||(mo[t]=[]),mo[t].push({keyup:l,keydown:c,scope:o,mods:r,shortcut:n[s],method:i,key:n[s],splitKey:u,element:a});if(typeof a<"u"&&window){if(!Sh.has(a)){const h=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return NZ(m,a)},f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;NZ(m,a),Z8e(m)};Sh.set(a,{keydownListener:h,keyupListenr:f,capture:d}),pF(a,"keydown",h,d),pF(a,"keyup",f,d)}if(!UT){const h=()=>{xr=[]};UT={listener:h,capture:d},pF(window,"focus",h,d)}}}function X8e(t){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(mo).forEach(i=>{mo[i].filter(r=>r.scope===e&&r.shortcut===t).forEach(r=>{r&&r.method&&r.method()})})}function n5(t){const e=Object.values(mo).flat();if(e.findIndex(n=>{let{element:r}=n;return r===t})<0){const{keydownListener:n,keyupListenr:r,capture:o}=Sh.get(t)||{};n&&r&&(MS(t,"keyup",r,o),MS(t,"keydown",n,o),Sh.delete(t))}if((e.length<=0||Sh.size<=0)&&(Object.keys(Sh).forEach(r=>{const{keydownListener:o,keyupListenr:a,capture:s}=Sh.get(r)||{};o&&a&&(MS(r,"keyup",a,s),MS(r,"keydown",o,s),Sh.delete(r))}),Sh.clear(),Object.keys(mo).forEach(r=>delete mo[r]),UT)){const{listener:r,capture:o}=UT;MS(window,"focus",r,o),UT=null}}const hF={getPressedKeyString:z8e,setScope:mIe,getScope:rD,deleteScope:K8e,getPressedKeyCodes:G8e,getAllKeyCodes:W8e,isPressed:Y8e,filter:q8e,trigger:X8e,unbind:gIe,keyMap:nD,modifier:xp,modifierMap:C$};for(const t in hF)Object.prototype.hasOwnProperty.call(hF,t)&&(ip[t]=hF[t]);if(typeof window<"u"){const t=window.hotkeys;ip.noConflict=e=>(e&&window.hotkeys===ip&&(window.hotkeys=t),ip),window.hotkeys=ip}const{HOTKEYS:J8e,SIDE1KEYS:Q8e,MODIFIERS:eKe}=RH;function tKe(){let t,e;const i=n=>{e=void 0,t=n};return ip(J8e+",esc",(n,r)=>{if(t){const o=t.cell.getElement(),a=o.classList.contains("tabulator-cell")?o.firstChild:o;n.preventDefault();const s=t.cell.getRow().getData();e||(e=s.matchUp);const l=ip.shift,c=l?r.key.split(r.splitKey)[1]:r.key;c==="esc"&&(t.replaceTableData(),t=void 0);const u=Q8e.some(d=>d===c)&&(l?2:1)||void 0;if(u||eKe.includes(c)){const{matchUpFormat:d,matchUpStatus:p,score:h,sets:f,winningSide:m}=e,{matchUpStatus:g,scoreString:v,winningSide:y,sets:b,updated:I}=mv.keyValueScore({scoreString:h==null?void 0:h.scoreStringSide1,shiftFirst:!0,sets:f||[],matchUpStatus:p,matchUpFormat:d,winningSide:m,lowSide:u,value:c});I&&(e=Object.assign({},s.matchUp,{score:{scoreStringSide1:v},matchUpStatus:g,winningSide:y,sets:b,matchUpFormat:d,updated:I}),a.innerText=v||"Enter score")}}if(t&&r.key==="enter"){const o=mv.generateScoreString({sets:e.sets,reversed:!0}),a=mv.generateScoreString({sets:e.sets}),s={matchUpStatus:e.matchUpStatus,winningSide:e.winningSide,score:{sets:e.sets,scoreStringSide1:a,scoreStringSide2:o}};iKe({callback:t.replaceTableData,matchUpId:e.matchUpId,drawId:e.drawId,outcome:s}),t=void 0}}),{setFocusData:i}}function iKe({outcome:t,callback:e,matchUpId:i,drawId:n}){const{matchUpStatus:r,winningSide:o,score:a}=t;xt({methods:[{method:j4,params:{outcome:{matchUpStatus:r,winningSide:o,score:a},matchUpId:i,drawId:n}}],callback:c=>{vt(e)&&e({...c,outcome:t})}})}function nKe(){let t;const{setFocusData:e}=tKe(),i=()=>(Ye.allTournamentMatchUps({participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:l})=>l!=="BYE").map(tS),n=()=>{t.replaceData(i())},r=i(),o=$8e({data:r,replaceTableData:n,setFocusData:e});return(s=>{var u;rh({anchorId:eR});const l=document.getElementById(eR),c=(u=As(l,"section"))==null?void 0:u.querySelector(".tabHeader");t=new bo(l,{headerSortElement:oh(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",columns:o,data:s}),t.on("dataFiltered",(d,p)=>{var y,b;const h=p.map(I=>I.getData().matchUp);c&&(c.innerHTML=`Matches (${h.length})`);const f=document.getElementById("wtnPredictiveAccuracy"),m=Ye.getPredictiveAccuracy({valueAccessor:"wtnRating",scaleName:"WTN",zoneMargin:2.5,matchUps:h});(y=m==null?void 0:m.accuracy)!=null&&y.percent?(f.style.display="",f.innerHTML=`WTN ${m.accuracy.percent}%`):f.style.display=ht;const g=document.getElementById("utrPredictiveAccuracy"),v=Ye.getPredictiveAccuracy({valueAccessor:"utrRating",singlesForDoubles:!0,scaleName:"UTR",zoneMargin:1,matchUps:h});(b=v==null?void 0:v.accuracy)!=null&&b.percent?(g.style.display="",g.innerHTML=`UTR ${v.accuracy.percent}%`):g.style.display=ht})})(r),{table:t,replaceTableData:n}}const{TEAM:rKe}=Fo;function oKe(){let t,e,i,n,r;const{table:o,replaceTableData:a}=nKe(),s=Ye.getEvents().events||[],l=document.getElementById(wz);l.style.display=ht;const c=k=>k.drawId===e,u=k=>{o==null||o.removeFilter(c),e=k,k&&(o==null||o.addFilter(c))},d={label:`<span style='font-weight: bold'>${VO}</span>`,onClick:()=>u(),close:!0},p=k=>{var O;return(O=k.drawDefinitions)==null?void 0:O.map(({drawId:F,drawName:B})=>({onClick:()=>u(F),label:B,close:!0}))},h=[d,{divider:!0}].concat(s.flatMap(p)).filter(Boolean),f=k=>k.eventId===t,m=k=>{if(o==null||o.removeFilter(f),t=k,o==null||o.removeFilter(c),e=void 0,k){o==null||o.addFilter(f);const F={options:[d,{divider:!0}].concat(p(s.find($=>k===$.eventId))).filter(Boolean),label:VO,id:"flightOptions",modifyLabel:!0,selection:!0,location:Lt},B=e$({button:F});r.flightOptions.replaceWith(B),r.flightOptions=B}else r.flightOptions.style.display=ht},v=[{label:`<span style='font-weight: bold'>${zv}</span>`,onClick:()=>m(),close:!0},{divider:!0}].concat(s.map(k=>({onClick:()=>m(k.eventId),label:k.eventName,close:!0}))),y=k=>{if(n==="readyToScore")return k.scoreDetail.readyToScore&&!k.scoreDetail.score&&!k.scoreDetail.winningSide;if(n==="complete")return k.scoreDetail.winningSide||["DOUBLE_WALKOVER","DOUBLE_DEFAULT","CANCELLED","ABANDONED"].includes(k.scoreDetail.matchUpStatus)},b=k=>{o==null||o.removeFilter(y),n=k,n&&(o==null||o.addFilter(y))},T=[{label:`<span style='font-weight: bold'>${s7}</span>`,onClick:()=>b(),close:!0},{divider:!0},{label:"Ready to score",close:!0,onClick:()=>b("readyToScore")},{label:"Complete",close:!0,onClick:()=>b("complete")}];let S;const w=k=>{var O;return(O=k.searchText)==null?void 0:O.includes(S)},U=k=>{k||o==null||o.removeFilter(w),S=k,k&&(o==null||o.addFilter(w))},D=Ye.getParticipants({participantFilters:{participantTypes:[rKe]}}).participants||[],E=Object.assign({},...D.map(k=>({[k.participantId]:k.individualParticipantIds}))),C=k=>k.individualParticipantIds.some(O=>{var F;return(F=E[i])==null?void 0:F.includes(O)}),M=k=>{if(i&&(o==null||o.removeFilter(C)),i=k,k){o==null||o.addFilter(C);const{teamStats:O}=Ye.getParticipantStats({teamParticipantId:k});if(O!=null&&O.participantName){l.style.display="";const F=EN({participantName:O.participantName,justify:"end"}),B=EN({participantName:"Opponents",justify:"start"}),$=[{side1Score:O.matchUps[0],side2Score:O.matchUps[1]}],V=MN({sets:$,sideNumber:1}),H=MN({sets:$,sideNumber:2});Ua(l),l.appendChild(eIe({side1:F,side2:B,side1Score:V,side2Score:H}))}}else l.style.display=ht},R=[{label:`<span style='font-weight: bold'>${l7}</span>`,onClick:()=>M(),close:!0},{divider:!0}].concat(D.sort((k,O)=>{var F;return(F=k==null?void 0:k.participantName)==null?void 0:F.localeCompare(O==null?void 0:O.participantName)}).map(k=>({onClick:()=>M(k.participantId),label:k.participantName,close:!0}))),A=[{onClick:()=>o==null?void 0:o.deselectRow(),label:"Schedule",stateChange:!0,location:Pr},{onKeyDown:k=>k.keyCode===8&&k.target.value.length===1&&U(""),onKeyUp:k=>U(k.target.value),clearSearch:()=>{o==null||o.removeFilter(w),S="",o==null||o.removeFilter()},placeholder:"Search matches",location:Lt,search:!0},{hide:v.length<3,options:v,id:"eventOptions",label:zv,modifyLabel:!0,selection:!0,location:Lt},{options:h,label:VO,id:"flightOptions",modifyLabel:!0,selection:!0,location:Lt,hide:!0},{hide:R.length<3,options:R,modifyLabel:!0,label:l7,location:Lt,selection:!0},{options:T,label:s7,modifyLabel:!0,selection:!0,location:Lt},{onClick:()=>{ar.activeScale="wtn",a()},id:"wtnPredictiveAccuracy",intent:"is-danger",location:Ut,text:"WTN %",hide:!0},{onClick:()=>{ar.activeScale="utr",a()},id:"utrPredictiveAccuracy",intent:"is-info",location:Ut,text:"UTR %",hide:!0}],_=document.getElementById(Nz);r=Da({table:o,target:_,items:A}).elements}async function aKe(t,e){return Eg.post("/auth/login",{password:e,email:t})}async function sKe(t,e,i,n,r){return Eg.post("/auth/register",{preferredFamilyName:t,preferredGivenName:e,inviteKey:i,password:r,email:n})}function r5(t){let e;lr({title:"Login",content:r=>e=ro(r,[{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Login",intent:"is-primary",onClick:()=>{const r=e.email.value,o=e.password.value,a=s=>{!s&&oO(),(s==null?void 0:s.status)===200&&EXe({data:s.data,callback:t})};aKe(r,o).then(a,s=>console.log({err:s}))},close:!0}]})}const lKe=(t,e,i)=>{const n=oc(),r=CWe();sye(t,[{text:"Server connection",items:[{hide:r,text:"Connect",onClick:F4},{hide:!r,text:"Disconnect",onClick:ZC},{hide:n,text:"Log in",onClick:r5},{hide:!n,text:"Log out",onClick:oO}]}],e)};function cKe(){const{tournamentInfo:t}=Ye.getTournamentInfo(),e=oc(),i=document.getElementById("mainMenu");i&&(i.onclick=o=>{var a;o.stopPropagation(),Qe.drawer.open({title:((a=e==null?void 0:e.provider)==null?void 0:a.providerName)||"TMX",content:lKe,width:"200px",side:Ut})});const n=document.getElementById("provider");n&&(n.onclick=()=>Qe.router.navigate("/tournaments"));const r=document.getElementById("pageTitle");r&&(Ua(r),r.innerHTML=`<div class='tmx-title'>${t==null?void 0:t.tournamentName}</div>`)}function vIe(t){var a;const{venueName:e,venueAbbreviation:i,addresses:n,venueId:r,courts:o}=t;return{hasLocation:(a=n==null?void 0:n[0])==null?void 0:a.longitude,courtsCount:(o==null?void 0:o.length)||0,scheduledMatchUpsCount:0,address:n==null?void 0:n[0],availableTime:"",venueAbbreviation:i,venueName:e,venueId:r,courts:o,venue:t}}function uKe(){function t(i){return i.getValue()?'<i class="fa-solid fa-check" style="color: green"></i>':'<i class="fa-solid fa-xmark"></i>'}const e=()=>console.log("Court actions");return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{headerMenu:ah({floodlit:"Lights"}),formatter:"rownum",headerSort:!1,hozAlign:Vt,width:55},{title:"Court Name",field:"courtName",editor:!0},{title:"Scheduled Time",field:"scheduledTime"},{title:"Unscheduled Time",field:"unscheduledTime"},{title:"In/Out",field:"indoorOutdoor"},{title:"Surface",field:"surfaceType"},{title:'<i class="fa-regular fa-lightbulb"></i>',formatter:t,headerTooltip:"Lights",field:"floodlit",width:50},{cellClick:e,formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,width:50}]}function dKe(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=[{label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{label:"Add courts",location:Ut,align:Ut}];e.appendChild(i);const r="1px solid #333",o=document.createElement("div");o.style.backgroundColor="white",o.style.border=r,o.style.width="99%",e.className=G_,e.style.display=ht,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(o),t.getElement().appendChild(e);const a=uKe(),s=new bo(o,{headerSortElement:oh(["courtName","scheduledTime","unscheduledTime","floodlit","surfaceType","indoorOutdoor"]),data:t.getData().courts,placeholder:"No courts",layout:"fitColumns",index:"courtId",maxHeight:400,columns:a});Da({table:s,target:i,items:n}),s.on("scrollVertical",Tc),s.on("cellEdited",l=>{const c=l.getRow().getData(),u=l.getValue();if(u.length){const d=h=>{h.success?console.log("success",{result:h}):console.log({result:h})},p=[{method:p3e,params:{courtId:c.courtId,modifications:{courtName:u}}}];xt({methods:p,callback:d})}else console.log("INVALID VALUE")})}const o5=/[-+]?([1-8]?\d(\.\d+)?|90(\.0+)?)\s*,\s*[-+]?(180(\.0+)?|((1[0-7]\d)|([1-9]?\d))(\.\d+)?)$/;function pKe(t){let e=t.split("/");if(e[2]==="www.openstreetmap.org"){let i=e.slice(4).join(",");return o5.test(i)?{latitude:e[4],longitude:e[5]}:{}}return{}}function hKe(t){const i=t.split("/").reduce((a,s)=>s&&s[0]==="@"?s:a,void 0),n=i==null?void 0:i.split(","),r=n==null?void 0:n[0].slice(1),o=n==null?void 0:n[1];return{latitude:r,longitude:o}}function fKe(t){let e=t.split(",");return o5.test(t)?{latitude:e[0],longitude:e[1]}:{}}function mKe(t){let e=t.split("=");if(e.length>1){let i=e[1].split(","),n=[i[0],i[1]].join(",");return o5.test(n)?{latitude:i[0],longitude:i[1]}:{}}return{}}var E$={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */(function(t,e){(function(i,n){n(e)})(cve,function(i){var n="1.9.4";function r(P){var x,j,q,ee;for(j=1,q=arguments.length;j<q;j++){ee=arguments[j];for(x in ee)P[x]=ee[x]}return P}var o=Object.create||function(){function P(){}return function(x){return P.prototype=x,new P}}();function a(P,x){var j=Array.prototype.slice;if(P.bind)return P.bind.apply(P,j.call(arguments,1));var q=j.call(arguments,2);return function(){return P.apply(x,q.length?q.concat(j.call(arguments)):arguments)}}var s=0;function l(P){return"_leaflet_id"in P||(P._leaflet_id=++s),P._leaflet_id}function c(P,x,j){var q,ee,pe,Me;return Me=function(){q=!1,ee&&(pe.apply(j,ee),ee=!1)},pe=function(){q?ee=arguments:(P.apply(j,arguments),setTimeout(Me,x),q=!0)},pe}function u(P,x,j){var q=x[1],ee=x[0],pe=q-ee;return P===q&&j?P:((P-ee)%pe+pe)%pe+ee}function d(){return!1}function p(P,x){if(x===!1)return P;var j=Math.pow(10,x===void 0?6:x);return Math.round(P*j)/j}function h(P){return P.trim?P.trim():P.replace(/^\s+|\s+$/g,"")}function f(P){return h(P).split(/\s+/)}function m(P,x){Object.prototype.hasOwnProperty.call(P,"options")||(P.options=P.options?o(P.options):{});for(var j in x)P.options[j]=x[j];return P.options}function g(P,x,j){var q=[];for(var ee in P)q.push(encodeURIComponent(j?ee.toUpperCase():ee)+"="+encodeURIComponent(P[ee]));return(!x||x.indexOf("?")===-1?"?":"&")+q.join("&")}var v=/\{ *([\w_ -]+) *\}/g;function y(P,x){return P.replace(v,function(j,q){var ee=x[q];if(ee===void 0)throw new Error("No value provided for variable "+j);return typeof ee=="function"&&(ee=ee(x)),ee})}var b=Array.isArray||function(P){return Object.prototype.toString.call(P)==="[object Array]"};function I(P,x){for(var j=0;j<P.length;j++)if(P[j]===x)return j;return-1}var T="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function S(P){return window["webkit"+P]||window["moz"+P]||window["ms"+P]}var w=0;function U(P){var x=+new Date,j=Math.max(0,16-(x-w));return w=x+j,window.setTimeout(P,j)}var D=window.requestAnimationFrame||S("RequestAnimationFrame")||U,E=window.cancelAnimationFrame||S("CancelAnimationFrame")||S("CancelRequestAnimationFrame")||function(P){window.clearTimeout(P)};function C(P,x,j){if(j&&D===U)P.call(x);else return D.call(window,a(P,x))}function M(P){P&&E.call(window,P)}var N={__proto__:null,extend:r,create:o,bind:a,get lastId(){return s},stamp:l,throttle:c,wrapNum:u,falseFn:d,formatNum:p,trim:h,splitWords:f,setOptions:m,getParamString:g,template:y,isArray:b,indexOf:I,emptyImageUrl:T,requestFn:D,cancelFn:E,requestAnimFrame:C,cancelAnimFrame:M};function R(){}R.extend=function(P){var x=function(){m(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},j=x.__super__=this.prototype,q=o(j);q.constructor=x,x.prototype=q;for(var ee in this)Object.prototype.hasOwnProperty.call(this,ee)&&ee!=="prototype"&&ee!=="__super__"&&(x[ee]=this[ee]);return P.statics&&r(x,P.statics),P.includes&&(A(P.includes),r.apply(null,[q].concat(P.includes))),r(q,P),delete q.statics,delete q.includes,q.options&&(q.options=j.options?o(j.options):{},r(q.options,P.options)),q._initHooks=[],q.callInitHooks=function(){if(!this._initHooksCalled){j.callInitHooks&&j.callInitHooks.call(this),this._initHooksCalled=!0;for(var pe=0,Me=q._initHooks.length;pe<Me;pe++)q._initHooks[pe].call(this)}},x},R.include=function(P){var x=this.prototype.options;return r(this.prototype,P),P.options&&(this.prototype.options=x,this.mergeOptions(P.options)),this},R.mergeOptions=function(P){return r(this.prototype.options,P),this},R.addInitHook=function(P){var x=Array.prototype.slice.call(arguments,1),j=typeof P=="function"?P:function(){this[P].apply(this,x)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(j),this};function A(P){if(!(typeof L>"u"||!L||!L.Mixin)){P=b(P)?P:[P];for(var x=0;x<P.length;x++)P[x]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var _={on:function(P,x,j){if(typeof P=="object")for(var q in P)this._on(q,P[q],x);else{P=f(P);for(var ee=0,pe=P.length;ee<pe;ee++)this._on(P[ee],x,j)}return this},off:function(P,x,j){if(!arguments.length)delete this._events;else if(typeof P=="object")for(var q in P)this._off(q,P[q],x);else{P=f(P);for(var ee=arguments.length===1,pe=0,Me=P.length;pe<Me;pe++)ee?this._off(P[pe]):this._off(P[pe],x,j)}return this},_on:function(P,x,j,q){if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}if(this._listens(P,x,j)===!1){j===this&&(j=void 0);var ee={fn:x,ctx:j};q&&(ee.once=!0),this._events=this._events||{},this._events[P]=this._events[P]||[],this._events[P].push(ee)}},_off:function(P,x,j){var q,ee,pe;if(this._events&&(q=this._events[P],!!q)){if(arguments.length===1){if(this._firingCount)for(ee=0,pe=q.length;ee<pe;ee++)q[ee].fn=d;delete this._events[P];return}if(typeof x!="function"){console.warn("wrong listener type: "+typeof x);return}var Me=this._listens(P,x,j);if(Me!==!1){var Ve=q[Me];this._firingCount&&(Ve.fn=d,this._events[P]=q=q.slice()),q.splice(Me,1)}}},fire:function(P,x,j){if(!this.listens(P,j))return this;var q=r({},x,{type:P,target:this,sourceTarget:x&&x.sourceTarget||this});if(this._events){var ee=this._events[P];if(ee){this._firingCount=this._firingCount+1||1;for(var pe=0,Me=ee.length;pe<Me;pe++){var Ve=ee[pe],ze=Ve.fn;Ve.once&&this.off(P,ze,Ve.ctx),ze.call(Ve.ctx||this,q)}this._firingCount--}}return j&&this._propagateEvent(q),this},listens:function(P,x,j,q){typeof P!="string"&&console.warn('"string" type argument expected');var ee=x;typeof x!="function"&&(q=!!x,ee=void 0,j=void 0);var pe=this._events&&this._events[P];if(pe&&pe.length&&this._listens(P,ee,j)!==!1)return!0;if(q){for(var Me in this._eventParents)if(this._eventParents[Me].listens(P,x,j,q))return!0}return!1},_listens:function(P,x,j){if(!this._events)return!1;var q=this._events[P]||[];if(!x)return!!q.length;j===this&&(j=void 0);for(var ee=0,pe=q.length;ee<pe;ee++)if(q[ee].fn===x&&q[ee].ctx===j)return ee;return!1},once:function(P,x,j){if(typeof P=="object")for(var q in P)this._on(q,P[q],x,!0);else{P=f(P);for(var ee=0,pe=P.length;ee<pe;ee++)this._on(P[ee],x,j,!0)}return this},addEventParent:function(P){return this._eventParents=this._eventParents||{},this._eventParents[l(P)]=P,this},removeEventParent:function(P){return this._eventParents&&delete this._eventParents[l(P)],this},_propagateEvent:function(P){for(var x in this._eventParents)this._eventParents[x].fire(P.type,r({layer:P.target,propagatedFrom:P.target},P),!0)}};_.addEventListener=_.on,_.removeEventListener=_.clearAllEventListeners=_.off,_.addOneTimeEventListener=_.once,_.fireEvent=_.fire,_.hasEventListeners=_.listens;var k=R.extend(_);function O(P,x,j){this.x=j?Math.round(P):P,this.y=j?Math.round(x):x}var F=Math.trunc||function(P){return P>0?Math.floor(P):Math.ceil(P)};O.prototype={clone:function(){return new O(this.x,this.y)},add:function(P){return this.clone()._add(B(P))},_add:function(P){return this.x+=P.x,this.y+=P.y,this},subtract:function(P){return this.clone()._subtract(B(P))},_subtract:function(P){return this.x-=P.x,this.y-=P.y,this},divideBy:function(P){return this.clone()._divideBy(P)},_divideBy:function(P){return this.x/=P,this.y/=P,this},multiplyBy:function(P){return this.clone()._multiplyBy(P)},_multiplyBy:function(P){return this.x*=P,this.y*=P,this},scaleBy:function(P){return new O(this.x*P.x,this.y*P.y)},unscaleBy:function(P){return new O(this.x/P.x,this.y/P.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=F(this.x),this.y=F(this.y),this},distanceTo:function(P){P=B(P);var x=P.x-this.x,j=P.y-this.y;return Math.sqrt(x*x+j*j)},equals:function(P){return P=B(P),P.x===this.x&&P.y===this.y},contains:function(P){return P=B(P),Math.abs(P.x)<=Math.abs(this.x)&&Math.abs(P.y)<=Math.abs(this.y)},toString:function(){return"Point("+p(this.x)+", "+p(this.y)+")"}};function B(P,x,j){return P instanceof O?P:b(P)?new O(P[0],P[1]):P==null?P:typeof P=="object"&&"x"in P&&"y"in P?new O(P.x,P.y):new O(P,x,j)}function $(P,x){if(P)for(var j=x?[P,x]:P,q=0,ee=j.length;q<ee;q++)this.extend(j[q])}$.prototype={extend:function(P){var x,j;if(!P)return this;if(P instanceof O||typeof P[0]=="number"||"x"in P)x=j=B(P);else if(P=V(P),x=P.min,j=P.max,!x||!j)return this;return!this.min&&!this.max?(this.min=x.clone(),this.max=j.clone()):(this.min.x=Math.min(x.x,this.min.x),this.max.x=Math.max(j.x,this.max.x),this.min.y=Math.min(x.y,this.min.y),this.max.y=Math.max(j.y,this.max.y)),this},getCenter:function(P){return B((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,P)},getBottomLeft:function(){return B(this.min.x,this.max.y)},getTopRight:function(){return B(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(P){var x,j;return typeof P[0]=="number"||P instanceof O?P=B(P):P=V(P),P instanceof $?(x=P.min,j=P.max):x=j=P,x.x>=this.min.x&&j.x<=this.max.x&&x.y>=this.min.y&&j.y<=this.max.y},intersects:function(P){P=V(P);var x=this.min,j=this.max,q=P.min,ee=P.max,pe=ee.x>=x.x&&q.x<=j.x,Me=ee.y>=x.y&&q.y<=j.y;return pe&&Me},overlaps:function(P){P=V(P);var x=this.min,j=this.max,q=P.min,ee=P.max,pe=ee.x>x.x&&q.x<j.x,Me=ee.y>x.y&&q.y<j.y;return pe&&Me},isValid:function(){return!!(this.min&&this.max)},pad:function(P){var x=this.min,j=this.max,q=Math.abs(x.x-j.x)*P,ee=Math.abs(x.y-j.y)*P;return V(B(x.x-q,x.y-ee),B(j.x+q,j.y+ee))},equals:function(P){return P?(P=V(P),this.min.equals(P.getTopLeft())&&this.max.equals(P.getBottomRight())):!1}};function V(P,x){return!P||P instanceof $?P:new $(P,x)}function H(P,x){if(P)for(var j=x?[P,x]:P,q=0,ee=j.length;q<ee;q++)this.extend(j[q])}H.prototype={extend:function(P){var x=this._southWest,j=this._northEast,q,ee;if(P instanceof G)q=P,ee=P;else if(P instanceof H){if(q=P._southWest,ee=P._northEast,!q||!ee)return this}else return P?this.extend(W(P)||z(P)):this;return!x&&!j?(this._southWest=new G(q.lat,q.lng),this._northEast=new G(ee.lat,ee.lng)):(x.lat=Math.min(q.lat,x.lat),x.lng=Math.min(q.lng,x.lng),j.lat=Math.max(ee.lat,j.lat),j.lng=Math.max(ee.lng,j.lng)),this},pad:function(P){var x=this._southWest,j=this._northEast,q=Math.abs(x.lat-j.lat)*P,ee=Math.abs(x.lng-j.lng)*P;return new H(new G(x.lat-q,x.lng-ee),new G(j.lat+q,j.lng+ee))},getCenter:function(){return new G((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new G(this.getNorth(),this.getWest())},getSouthEast:function(){return new G(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(P){typeof P[0]=="number"||P instanceof G||"lat"in P?P=W(P):P=z(P);var x=this._southWest,j=this._northEast,q,ee;return P instanceof H?(q=P.getSouthWest(),ee=P.getNorthEast()):q=ee=P,q.lat>=x.lat&&ee.lat<=j.lat&&q.lng>=x.lng&&ee.lng<=j.lng},intersects:function(P){P=z(P);var x=this._southWest,j=this._northEast,q=P.getSouthWest(),ee=P.getNorthEast(),pe=ee.lat>=x.lat&&q.lat<=j.lat,Me=ee.lng>=x.lng&&q.lng<=j.lng;return pe&&Me},overlaps:function(P){P=z(P);var x=this._southWest,j=this._northEast,q=P.getSouthWest(),ee=P.getNorthEast(),pe=ee.lat>x.lat&&q.lat<j.lat,Me=ee.lng>x.lng&&q.lng<j.lng;return pe&&Me},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(P,x){return P?(P=z(P),this._southWest.equals(P.getSouthWest(),x)&&this._northEast.equals(P.getNorthEast(),x)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function z(P,x){return P instanceof H?P:new H(P,x)}function G(P,x,j){if(isNaN(P)||isNaN(x))throw new Error("Invalid LatLng object: ("+P+", "+x+")");this.lat=+P,this.lng=+x,j!==void 0&&(this.alt=+j)}G.prototype={equals:function(P,x){if(!P)return!1;P=W(P);var j=Math.max(Math.abs(this.lat-P.lat),Math.abs(this.lng-P.lng));return j<=(x===void 0?1e-9:x)},toString:function(P){return"LatLng("+p(this.lat,P)+", "+p(this.lng,P)+")"},distanceTo:function(P){return Z.distance(this,W(P))},wrap:function(){return Z.wrapLatLng(this)},toBounds:function(P){var x=180*P/40075017,j=x/Math.cos(Math.PI/180*this.lat);return z([this.lat-x,this.lng-j],[this.lat+x,this.lng+j])},clone:function(){return new G(this.lat,this.lng,this.alt)}};function W(P,x,j){return P instanceof G?P:b(P)&&typeof P[0]!="object"?P.length===3?new G(P[0],P[1],P[2]):P.length===2?new G(P[0],P[1]):null:P==null?P:typeof P=="object"&&"lat"in P?new G(P.lat,"lng"in P?P.lng:P.lon,P.alt):x===void 0?null:new G(P,x,j)}var K={latLngToPoint:function(P,x){var j=this.projection.project(P),q=this.scale(x);return this.transformation._transform(j,q)},pointToLatLng:function(P,x){var j=this.scale(x),q=this.transformation.untransform(P,j);return this.projection.unproject(q)},project:function(P){return this.projection.project(P)},unproject:function(P){return this.projection.unproject(P)},scale:function(P){return 256*Math.pow(2,P)},zoom:function(P){return Math.log(P/256)/Math.LN2},getProjectedBounds:function(P){if(this.infinite)return null;var x=this.projection.bounds,j=this.scale(P),q=this.transformation.transform(x.min,j),ee=this.transformation.transform(x.max,j);return new $(q,ee)},infinite:!1,wrapLatLng:function(P){var x=this.wrapLng?u(P.lng,this.wrapLng,!0):P.lng,j=this.wrapLat?u(P.lat,this.wrapLat,!0):P.lat,q=P.alt;return new G(j,x,q)},wrapLatLngBounds:function(P){var x=P.getCenter(),j=this.wrapLatLng(x),q=x.lat-j.lat,ee=x.lng-j.lng;if(q===0&&ee===0)return P;var pe=P.getSouthWest(),Me=P.getNorthEast(),Ve=new G(pe.lat-q,pe.lng-ee),ze=new G(Me.lat-q,Me.lng-ee);return new H(Ve,ze)}},Z=r({},K,{wrapLng:[-180,180],R:6371e3,distance:function(P,x){var j=Math.PI/180,q=P.lat*j,ee=x.lat*j,pe=Math.sin((x.lat-P.lat)*j/2),Me=Math.sin((x.lng-P.lng)*j/2),Ve=pe*pe+Math.cos(q)*Math.cos(ee)*Me*Me,ze=2*Math.atan2(Math.sqrt(Ve),Math.sqrt(1-Ve));return this.R*ze}}),Y=6378137,X={R:Y,MAX_LATITUDE:85.0511287798,project:function(P){var x=Math.PI/180,j=this.MAX_LATITUDE,q=Math.max(Math.min(j,P.lat),-j),ee=Math.sin(q*x);return new O(this.R*P.lng*x,this.R*Math.log((1+ee)/(1-ee))/2)},unproject:function(P){var x=180/Math.PI;return new G((2*Math.atan(Math.exp(P.y/this.R))-Math.PI/2)*x,P.x*x/this.R)},bounds:function(){var P=Y*Math.PI;return new $([-P,-P],[P,P])}()};function Q(P,x,j,q){if(b(P)){this._a=P[0],this._b=P[1],this._c=P[2],this._d=P[3];return}this._a=P,this._b=x,this._c=j,this._d=q}Q.prototype={transform:function(P,x){return this._transform(P.clone(),x)},_transform:function(P,x){return x=x||1,P.x=x*(this._a*P.x+this._b),P.y=x*(this._c*P.y+this._d),P},untransform:function(P,x){return x=x||1,new O((P.x/x-this._b)/this._a,(P.y/x-this._d)/this._c)}};function te(P,x,j,q){return new Q(P,x,j,q)}var J=r({},Z,{code:"EPSG:3857",projection:X,transformation:function(){var P=.5/(Math.PI*X.R);return te(P,.5,-P,.5)}()}),ie=r({},J,{code:"EPSG:900913"});function oe(P){return document.createElementNS("http://www.w3.org/2000/svg",P)}function ne(P,x){var j="",q,ee,pe,Me,Ve,ze;for(q=0,pe=P.length;q<pe;q++){for(Ve=P[q],ee=0,Me=Ve.length;ee<Me;ee++)ze=Ve[ee],j+=(ee?"L":"M")+ze.x+" "+ze.y;j+=x?Ke.svg?"z":"x":""}return j||"M0 0"}var re=document.documentElement.style,me="ActiveXObject"in window,he=me&&!document.addEventListener,be="msLaunchUri"in navigator&&!("documentMode"in document),Se=pt("webkit"),De=pt("android"),Oe=pt("android 2")||pt("android 3"),xe=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),$e=De&&pt("Google")&&xe<537&&!("AudioNode"in window),Ae=!!window.opera,ve=!be&&pt("chrome"),ke=pt("gecko")&&!Se&&!Ae&&!me,ye=!ve&&pt("safari"),Ie=pt("phantom"),Ne="OTransition"in re,Fe=navigator.platform.indexOf("Win")===0,Le=me&&"transition"in re,ge="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Oe,Ee="MozPerspective"in re,we=!window.L_DISABLE_3D&&(Le||ge||Ee)&&!Ne&&!Ie,fe=typeof orientation<"u"||pt("mobile"),Te=fe&&Se,ue=fe&&ge,de=!window.PointerEvent&&window.MSPointerEvent,_e=!!(window.PointerEvent||de),Ue="ontouchstart"in window||!!window.TouchEvent,Ce=!window.L_NO_TOUCH&&(Ue||_e),We=fe&&Ae,He=fe&&ke,Be=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,et=function(){var P=!1;try{var x=Object.defineProperty({},"passive",{get:function(){P=!0}});window.addEventListener("testPassiveEventSupport",d,x),window.removeEventListener("testPassiveEventSupport",d,x)}catch{}return P}(),ot=function(){return!!document.createElement("canvas").getContext}(),mt=!!(document.createElementNS&&oe("svg").createSVGRect),Rt=!!mt&&function(){var P=document.createElement("div");return P.innerHTML="<svg/>",(P.firstChild&&P.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),Ft=!mt&&function(){try{var P=document.createElement("div");P.innerHTML='<v:shape adj="1"/>';var x=P.firstChild;return x.style.behavior="url(#default#VML)",x&&typeof x.adj=="object"}catch{return!1}}(),Je=navigator.platform.indexOf("Mac")===0,_t=navigator.platform.indexOf("Linux")===0;function pt(P){return navigator.userAgent.toLowerCase().indexOf(P)>=0}var Ke={ie:me,ielt9:he,edge:be,webkit:Se,android:De,android23:Oe,androidStock:$e,opera:Ae,chrome:ve,gecko:ke,safari:ye,phantom:Ie,opera12:Ne,win:Fe,ie3d:Le,webkit3d:ge,gecko3d:Ee,any3d:we,mobile:fe,mobileWebkit:Te,mobileWebkit3d:ue,msPointer:de,pointer:_e,touch:Ce,touchNative:Ue,mobileOpera:We,mobileGecko:He,retina:Be,passiveEvents:et,canvas:ot,svg:mt,vml:Ft,inlineSvg:Rt,mac:Je,linux:_t},ci=Ke.msPointer?"MSPointerDown":"pointerdown",ni=Ke.msPointer?"MSPointerMove":"pointermove",Ht=Ke.msPointer?"MSPointerUp":"pointerup",Zi=Ke.msPointer?"MSPointerCancel":"pointercancel",Xi={touchstart:ci,touchmove:ni,touchend:Ht,touchcancel:Zi},wi={touchstart:Gt,touchmove:er,touchend:er,touchcancel:er},Ji={},Yt=!1;function _n(P,x,j){return x==="touchstart"&&Ma(),wi[x]?(j=wi[x].bind(this,j),P.addEventListener(Xi[x],j,!1),j):(console.warn("wrong event specified:",x),d)}function Gr(P,x,j){if(!Xi[x]){console.warn("wrong event specified:",x);return}P.removeEventListener(Xi[x],j,!1)}function qo(P){Ji[P.pointerId]=P}function Ea(P){Ji[P.pointerId]&&(Ji[P.pointerId]=P)}function ga(P){delete Ji[P.pointerId]}function Ma(){Yt||(document.addEventListener(ci,qo,!0),document.addEventListener(ni,Ea,!0),document.addEventListener(Ht,ga,!0),document.addEventListener(Zi,ga,!0),Yt=!0)}function er(P,x){if(x.pointerType!==(x.MSPOINTER_TYPE_MOUSE||"mouse")){x.touches=[];for(var j in Ji)x.touches.push(Ji[j]);x.changedTouches=[x],P(x)}}function Gt(P,x){x.MSPOINTER_TYPE_TOUCH&&x.pointerType===x.MSPOINTER_TYPE_TOUCH&&Ka(x),er(P,x)}function Jc(P){var x={},j,q;for(q in P)j=P[q],x[q]=j&&j.bind?j.bind(P):j;return P=x,x.type="dblclick",x.detail=2,x.isTrusted=!1,x._simulated=!0,x}var sc=200;function Ls(P,x){P.addEventListener("dblclick",x);var j=0,q;function ee(pe){if(pe.detail!==1){q=pe.detail;return}if(!(pe.pointerType==="mouse"||pe.sourceCapabilities&&!pe.sourceCapabilities.firesTouchEvents)){var Me=y5(pe);if(!(Me.some(function(ze){return ze instanceof HTMLLabelElement&&ze.attributes.for})&&!Me.some(function(ze){return ze instanceof HTMLInputElement||ze instanceof HTMLSelectElement}))){var Ve=Date.now();Ve-j<=sc?(q++,q===2&&x(Jc(pe))):q=1,j=Ve}}}return P.addEventListener("click",ee),{dblclick:x,simDblclick:ee}}function Ze(P,x){P.removeEventListener("dblclick",x.dblclick),P.removeEventListener("click",x.simDblclick)}var yt=Kt(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),pi=Kt(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),cr=pi==="webkitTransition"||pi==="OTransition"?pi+"End":"transitionend";function va(P){return typeof P=="string"?document.getElementById(P):P}function Ur(P,x){var j=P.style[x]||P.currentStyle&&P.currentStyle[x];if((!j||j==="auto")&&document.defaultView){var q=document.defaultView.getComputedStyle(P,null);j=q?q[x]:null}return j==="auto"?null:j}function tn(P,x,j){var q=document.createElement(P);return q.className=x||"",j&&j.appendChild(q),q}function Xn(P){var x=P.parentNode;x&&x.removeChild(P)}function Do(P){for(;P.firstChild;)P.removeChild(P.firstChild)}function Tl(P){var x=P.parentNode;x&&x.lastChild!==P&&x.appendChild(P)}function qa(P){var x=P.parentNode;x&&x.firstChild!==P&&x.insertBefore(P,x.firstChild)}function Qi(P,x){if(P.classList!==void 0)return P.classList.contains(x);var j=yn(P);return j.length>0&&new RegExp("(^|\\s)"+x+"(\\s|$)").test(j)}function hi(P,x){if(P.classList!==void 0)for(var j=f(x),q=0,ee=j.length;q<ee;q++)P.classList.add(j[q]);else if(!Qi(P,x)){var pe=yn(P);Xt(P,(pe?pe+" ":"")+x)}}function ur(P,x){P.classList!==void 0?P.classList.remove(x):Xt(P,h((" "+yn(P)+" ").replace(" "+x+" "," ")))}function Xt(P,x){P.className.baseVal===void 0?P.className=x:P.className.baseVal=x}function yn(P){return P.correspondingElement&&(P=P.correspondingElement),P.className.baseVal===void 0?P.className:P.className.baseVal}function at(P,x){"opacity"in P.style?P.style.opacity=x:"filter"in P.style&&Mt(P,x)}function Mt(P,x){var j=!1,q="DXImageTransform.Microsoft.Alpha";try{j=P.filters.item(q)}catch{if(x===1)return}x=Math.round(x*100),j?(j.Enabled=x!==100,j.Opacity=x):P.style.filter+=" progid:"+q+"(opacity="+x+")"}function Kt(P){for(var x=document.documentElement.style,j=0;j<P.length;j++)if(P[j]in x)return P[j];return!1}function Si(P,x,j){var q=x||new O(0,0);P.style[yt]=(Ke.ie3d?"translate("+q.x+"px,"+q.y+"px)":"translate3d("+q.x+"px,"+q.y+"px,0)")+(j?" scale("+j+")":"")}function Pt(P,x){P._leaflet_pos=x,Ke.any3d?Si(P,x):(P.style.left=x.x+"px",P.style.top=x.y+"px")}function ri(P){return P._leaflet_pos||new O(0,0)}var br,Bo,Ra;if("onselectstart"in document)br=function(){xi(window,"selectstart",Ka)},Bo=function(){kr(window,"selectstart",Ka)};else{var _r=Kt(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);br=function(){if(_r){var P=document.documentElement.style;Ra=P[_r],P[_r]="none"}},Bo=function(){_r&&(document.documentElement.style[_r]=Ra,Ra=void 0)}}function Na(){xi(window,"dragstart",Ka)}function zr(){kr(window,"dragstart",Ka)}var Ya,lc;function cc(P){for(;P.tabIndex===-1;)P=P.parentNode;P.style&&(hs(),Ya=P,lc=P.style.outlineStyle,P.style.outlineStyle="none",xi(window,"keydown",hs))}function hs(){Ya&&(Ya.style.outlineStyle=lc,Ya=void 0,lc=void 0,kr(window,"keydown",hs))}function Bf(P){do P=P.parentNode;while((!P.offsetWidth||!P.offsetHeight)&&P!==document.body);return P}function fs(P){var x=P.getBoundingClientRect();return{x:x.width/P.offsetWidth||1,y:x.height/P.offsetHeight||1,boundingClientRect:x}}var r1={__proto__:null,TRANSFORM:yt,TRANSITION:pi,TRANSITION_END:cr,get:va,getStyle:Ur,create:tn,remove:Xn,empty:Do,toFront:Tl,toBack:qa,hasClass:Qi,addClass:hi,removeClass:ur,setClass:Xt,getClass:yn,setOpacity:at,testProp:Kt,setTransform:Si,setPosition:Pt,getPosition:ri,get disableTextSelection(){return br},get enableTextSelection(){return Bo},disableImageDrag:Na,enableImageDrag:zr,preventOutline:cc,restoreOutline:hs,getSizedParentNode:Bf,getScale:fs};function xi(P,x,j,q){if(x&&typeof x=="object")for(var ee in x)cO(P,ee,x[ee],j);else{x=f(x);for(var pe=0,Me=x.length;pe<Me;pe++)cO(P,x[pe],j,q)}return this}var Bd="_leaflet_events";function kr(P,x,j,q){if(arguments.length===1)v5(P),delete P[Bd];else if(x&&typeof x=="object")for(var ee in x)uO(P,ee,x[ee],j);else if(x=f(x),arguments.length===2)v5(P,function(Ve){return I(x,Ve)!==-1});else for(var pe=0,Me=x.length;pe<Me;pe++)uO(P,x[pe],j,q);return this}function v5(P,x){for(var j in P[Bd]){var q=j.split(/\d/)[0];(!x||x(q))&&uO(P,q,null,null,j)}}var lO={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function cO(P,x,j,q){var ee=x+l(j)+(q?"_"+l(q):"");if(P[Bd]&&P[Bd][ee])return this;var pe=function(Ve){return j.call(q||P,Ve||window.event)},Me=pe;!Ke.touchNative&&Ke.pointer&&x.indexOf("touch")===0?pe=_n(P,x,pe):Ke.touch&&x==="dblclick"?pe=Ls(P,pe):"addEventListener"in P?x==="touchstart"||x==="touchmove"||x==="wheel"||x==="mousewheel"?P.addEventListener(lO[x]||x,pe,Ke.passiveEvents?{passive:!1}:!1):x==="mouseenter"||x==="mouseleave"?(pe=function(Ve){Ve=Ve||window.event,pO(P,Ve)&&Me(Ve)},P.addEventListener(lO[x],pe,!1)):P.addEventListener(x,Me,!1):P.attachEvent("on"+x,pe),P[Bd]=P[Bd]||{},P[Bd][ee]=pe}function uO(P,x,j,q,ee){ee=ee||x+l(j)+(q?"_"+l(q):"");var pe=P[Bd]&&P[Bd][ee];if(!pe)return this;!Ke.touchNative&&Ke.pointer&&x.indexOf("touch")===0?Gr(P,x,pe):Ke.touch&&x==="dblclick"?Ze(P,pe):"removeEventListener"in P?P.removeEventListener(lO[x]||x,pe,!1):P.detachEvent("on"+x,pe),P[Bd][ee]=null}function Rg(P){return P.stopPropagation?P.stopPropagation():P.originalEvent?P.originalEvent._stopped=!0:P.cancelBubble=!0,this}function dO(P){return cO(P,"wheel",Rg),this}function oS(P){return xi(P,"mousedown touchstart dblclick contextmenu",Rg),P._leaflet_disable_click=!0,this}function Ka(P){return P.preventDefault?P.preventDefault():P.returnValue=!1,this}function Ng(P){return Ka(P),Rg(P),this}function y5(P){if(P.composedPath)return P.composedPath();for(var x=[],j=P.target;j;)x.push(j),j=j.parentNode;return x}function b5(P,x){if(!x)return new O(P.clientX,P.clientY);var j=fs(x),q=j.boundingClientRect;return new O((P.clientX-q.left)/j.x-x.clientLeft,(P.clientY-q.top)/j.y-x.clientTop)}var Dwe=Ke.linux&&Ke.chrome?window.devicePixelRatio:Ke.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function I5(P){return Ke.edge?P.wheelDeltaY/2:P.deltaY&&P.deltaMode===0?-P.deltaY/Dwe:P.deltaY&&P.deltaMode===1?-P.deltaY*20:P.deltaY&&P.deltaMode===2?-P.deltaY*60:P.deltaX||P.deltaZ?0:P.wheelDelta?(P.wheelDeltaY||P.wheelDelta)/2:P.detail&&Math.abs(P.detail)<32765?-P.detail*20:P.detail?P.detail/-32765*60:0}function pO(P,x){var j=x.relatedTarget;if(!j)return!0;try{for(;j&&j!==P;)j=j.parentNode}catch{return!1}return j!==P}var Pwe={__proto__:null,on:xi,off:kr,stopPropagation:Rg,disableScrollPropagation:dO,disableClickPropagation:oS,preventDefault:Ka,stop:Ng,getPropagationPath:y5,getMousePosition:b5,getWheelDelta:I5,isExternalTarget:pO,addListener:xi,removeListener:kr},w5=k.extend({run:function(P,x,j,q){this.stop(),this._el=P,this._inProgress=!0,this._duration=j||.25,this._easeOutPower=1/Math.max(q||.5,.2),this._startPos=ri(P),this._offset=x.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=C(this._animate,this),this._step()},_step:function(P){var x=+new Date-this._startTime,j=this._duration*1e3;x<j?this._runFrame(this._easeOut(x/j),P):(this._runFrame(1),this._complete())},_runFrame:function(P,x){var j=this._startPos.add(this._offset.multiplyBy(P));x&&j._round(),Pt(this._el,j),this.fire("step")},_complete:function(){M(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(P){return 1-Math.pow(1-P,this._easeOutPower)}}),En=k.extend({options:{crs:J,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(P,x){x=m(this,x),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(P),this._initLayout(),this._onResize=a(this._onResize,this),this._initEvents(),x.maxBounds&&this.setMaxBounds(x.maxBounds),x.zoom!==void 0&&(this._zoom=this._limitZoom(x.zoom)),x.center&&x.zoom!==void 0&&this.setView(W(x.center),x.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=pi&&Ke.any3d&&!Ke.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),xi(this._proxy,cr,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(P,x,j){if(x=x===void 0?this._zoom:this._limitZoom(x),P=this._limitCenter(W(P),x,this.options.maxBounds),j=j||{},this._stop(),this._loaded&&!j.reset&&j!==!0){j.animate!==void 0&&(j.zoom=r({animate:j.animate},j.zoom),j.pan=r({animate:j.animate,duration:j.duration},j.pan));var q=this._zoom!==x?this._tryAnimatedZoom&&this._tryAnimatedZoom(P,x,j.zoom):this._tryAnimatedPan(P,j.pan);if(q)return clearTimeout(this._sizeTimer),this}return this._resetView(P,x,j.pan&&j.pan.noMoveStart),this},setZoom:function(P,x){return this._loaded?this.setView(this.getCenter(),P,{zoom:x}):(this._zoom=P,this)},zoomIn:function(P,x){return P=P||(Ke.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+P,x)},zoomOut:function(P,x){return P=P||(Ke.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-P,x)},setZoomAround:function(P,x,j){var q=this.getZoomScale(x),ee=this.getSize().divideBy(2),pe=P instanceof O?P:this.latLngToContainerPoint(P),Me=pe.subtract(ee).multiplyBy(1-1/q),Ve=this.containerPointToLatLng(ee.add(Me));return this.setView(Ve,x,{zoom:j})},_getBoundsCenterZoom:function(P,x){x=x||{},P=P.getBounds?P.getBounds():z(P);var j=B(x.paddingTopLeft||x.padding||[0,0]),q=B(x.paddingBottomRight||x.padding||[0,0]),ee=this.getBoundsZoom(P,!1,j.add(q));if(ee=typeof x.maxZoom=="number"?Math.min(x.maxZoom,ee):ee,ee===1/0)return{center:P.getCenter(),zoom:ee};var pe=q.subtract(j).divideBy(2),Me=this.project(P.getSouthWest(),ee),Ve=this.project(P.getNorthEast(),ee),ze=this.unproject(Me.add(Ve).divideBy(2).add(pe),ee);return{center:ze,zoom:ee}},fitBounds:function(P,x){if(P=z(P),!P.isValid())throw new Error("Bounds are not valid.");var j=this._getBoundsCenterZoom(P,x);return this.setView(j.center,j.zoom,x)},fitWorld:function(P){return this.fitBounds([[-90,-180],[90,180]],P)},panTo:function(P,x){return this.setView(P,this._zoom,{pan:x})},panBy:function(P,x){if(P=B(P).round(),x=x||{},!P.x&&!P.y)return this.fire("moveend");if(x.animate!==!0&&!this.getSize().contains(P))return this._resetView(this.unproject(this.project(this.getCenter()).add(P)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new w5,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),x.noMoveStart||this.fire("movestart"),x.animate!==!1){hi(this._mapPane,"leaflet-pan-anim");var j=this._getMapPanePos().subtract(P).round();this._panAnim.run(this._mapPane,j,x.duration||.25,x.easeLinearity)}else this._rawPanBy(P),this.fire("move").fire("moveend");return this},flyTo:function(P,x,j){if(j=j||{},j.animate===!1||!Ke.any3d)return this.setView(P,x,j);this._stop();var q=this.project(this.getCenter()),ee=this.project(P),pe=this.getSize(),Me=this._zoom;P=W(P),x=x===void 0?Me:x;var Ve=Math.max(pe.x,pe.y),ze=Ve*this.getZoomScale(Me,x),tt=ee.distanceTo(q)||1,Dt=1.42,fi=Dt*Dt;function pn(Yo){var g1=Yo?-1:1,f0e=Yo?ze:Ve,m0e=ze*ze-Ve*Ve+g1*fi*fi*tt*tt,g0e=2*f0e*fi*tt,TO=m0e/g0e,t6=Math.sqrt(TO*TO+1)-TO,v0e=t6<1e-9?-18:Math.log(t6);return v0e}function Fs(Yo){return(Math.exp(Yo)-Math.exp(-Yo))/2}function Aa(Yo){return(Math.exp(Yo)+Math.exp(-Yo))/2}function eu(Yo){return Fs(Yo)/Aa(Yo)}var Ul=pn(0);function Nb(Yo){return Ve*(Aa(Ul)/Aa(Ul+Dt*Yo))}function u0e(Yo){return Ve*(Aa(Ul)*eu(Ul+Dt*Yo)-Fs(Ul))/fi}function d0e(Yo){return 1-Math.pow(1-Yo,1.5)}var p0e=Date.now(),Q5=(pn(1)-Ul)/Dt,h0e=j.duration?1e3*j.duration:1e3*Q5*.8;function e6(){var Yo=(Date.now()-p0e)/h0e,g1=d0e(Yo)*Q5;Yo<=1?(this._flyToFrame=C(e6,this),this._move(this.unproject(q.add(ee.subtract(q).multiplyBy(u0e(g1)/tt)),Me),this.getScaleZoom(Ve/Nb(g1),Me),{flyTo:!0})):this._move(P,x)._moveEnd(!0)}return this._moveStart(!0,j.noMoveStart),e6.call(this),this},flyToBounds:function(P,x){var j=this._getBoundsCenterZoom(P,x);return this.flyTo(j.center,j.zoom,x)},setMaxBounds:function(P){return P=z(P),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),P.isValid()?(this.options.maxBounds=P,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(P){var x=this.options.minZoom;return this.options.minZoom=P,this._loaded&&x!==P&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(P):this},setMaxZoom:function(P){var x=this.options.maxZoom;return this.options.maxZoom=P,this._loaded&&x!==P&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(P):this},panInsideBounds:function(P,x){this._enforcingBounds=!0;var j=this.getCenter(),q=this._limitCenter(j,this._zoom,z(P));return j.equals(q)||this.panTo(q,x),this._enforcingBounds=!1,this},panInside:function(P,x){x=x||{};var j=B(x.paddingTopLeft||x.padding||[0,0]),q=B(x.paddingBottomRight||x.padding||[0,0]),ee=this.project(this.getCenter()),pe=this.project(P),Me=this.getPixelBounds(),Ve=V([Me.min.add(j),Me.max.subtract(q)]),ze=Ve.getSize();if(!Ve.contains(pe)){this._enforcingBounds=!0;var tt=pe.subtract(Ve.getCenter()),Dt=Ve.extend(pe).getSize().subtract(ze);ee.x+=tt.x<0?-Dt.x:Dt.x,ee.y+=tt.y<0?-Dt.y:Dt.y,this.panTo(this.unproject(ee),x),this._enforcingBounds=!1}return this},invalidateSize:function(P){if(!this._loaded)return this;P=r({animate:!1,pan:!0},P===!0?{animate:!0}:P);var x=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var j=this.getSize(),q=x.divideBy(2).round(),ee=j.divideBy(2).round(),pe=q.subtract(ee);return!pe.x&&!pe.y?this:(P.animate&&P.pan?this.panBy(pe):(P.pan&&this._rawPanBy(pe),this.fire("move"),P.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(a(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:x,newSize:j}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(P){if(P=this._locateOptions=r({timeout:1e4,watch:!1},P),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var x=a(this._handleGeolocationResponse,this),j=a(this._handleGeolocationError,this);return P.watch?this._locationWatchId=navigator.geolocation.watchPosition(x,j,P):navigator.geolocation.getCurrentPosition(x,j,P),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(P){if(this._container._leaflet_id){var x=P.code,j=P.message||(x===1?"permission denied":x===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:x,message:"Geolocation error: "+j+"."})}},_handleGeolocationResponse:function(P){if(this._container._leaflet_id){var x=P.coords.latitude,j=P.coords.longitude,q=new G(x,j),ee=q.toBounds(P.coords.accuracy*2),pe=this._locateOptions;if(pe.setView){var Me=this.getBoundsZoom(ee);this.setView(q,pe.maxZoom?Math.min(Me,pe.maxZoom):Me)}var Ve={latlng:q,bounds:ee,timestamp:P.timestamp};for(var ze in P.coords)typeof P.coords[ze]=="number"&&(Ve[ze]=P.coords[ze]);this.fire("locationfound",Ve)}},addHandler:function(P,x){if(!x)return this;var j=this[P]=new x(this);return this._handlers.push(j),this.options[P]&&j.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),Xn(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(M(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var P;for(P in this._layers)this._layers[P].remove();for(P in this._panes)Xn(this._panes[P]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(P,x){var j="leaflet-pane"+(P?" leaflet-"+P.replace("Pane","")+"-pane":""),q=tn("div",j,x||this._mapPane);return P&&(this._panes[P]=q),q},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var P=this.getPixelBounds(),x=this.unproject(P.getBottomLeft()),j=this.unproject(P.getTopRight());return new H(x,j)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(P,x,j){P=z(P),j=B(j||[0,0]);var q=this.getZoom()||0,ee=this.getMinZoom(),pe=this.getMaxZoom(),Me=P.getNorthWest(),Ve=P.getSouthEast(),ze=this.getSize().subtract(j),tt=V(this.project(Ve,q),this.project(Me,q)).getSize(),Dt=Ke.any3d?this.options.zoomSnap:1,fi=ze.x/tt.x,pn=ze.y/tt.y,Fs=x?Math.max(fi,pn):Math.min(fi,pn);return q=this.getScaleZoom(Fs,q),Dt&&(q=Math.round(q/(Dt/100))*(Dt/100),q=x?Math.ceil(q/Dt)*Dt:Math.floor(q/Dt)*Dt),Math.max(ee,Math.min(pe,q))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new O(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(P,x){var j=this._getTopLeftPoint(P,x);return new $(j,j.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(P){return this.options.crs.getProjectedBounds(P===void 0?this.getZoom():P)},getPane:function(P){return typeof P=="string"?this._panes[P]:P},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(P,x){var j=this.options.crs;return x=x===void 0?this._zoom:x,j.scale(P)/j.scale(x)},getScaleZoom:function(P,x){var j=this.options.crs;x=x===void 0?this._zoom:x;var q=j.zoom(P*j.scale(x));return isNaN(q)?1/0:q},project:function(P,x){return x=x===void 0?this._zoom:x,this.options.crs.latLngToPoint(W(P),x)},unproject:function(P,x){return x=x===void 0?this._zoom:x,this.options.crs.pointToLatLng(B(P),x)},layerPointToLatLng:function(P){var x=B(P).add(this.getPixelOrigin());return this.unproject(x)},latLngToLayerPoint:function(P){var x=this.project(W(P))._round();return x._subtract(this.getPixelOrigin())},wrapLatLng:function(P){return this.options.crs.wrapLatLng(W(P))},wrapLatLngBounds:function(P){return this.options.crs.wrapLatLngBounds(z(P))},distance:function(P,x){return this.options.crs.distance(W(P),W(x))},containerPointToLayerPoint:function(P){return B(P).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(P){return B(P).add(this._getMapPanePos())},containerPointToLatLng:function(P){var x=this.containerPointToLayerPoint(B(P));return this.layerPointToLatLng(x)},latLngToContainerPoint:function(P){return this.layerPointToContainerPoint(this.latLngToLayerPoint(W(P)))},mouseEventToContainerPoint:function(P){return b5(P,this._container)},mouseEventToLayerPoint:function(P){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(P))},mouseEventToLatLng:function(P){return this.layerPointToLatLng(this.mouseEventToLayerPoint(P))},_initContainer:function(P){var x=this._container=va(P);if(x){if(x._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");xi(x,"scroll",this._onScroll,this),this._containerId=l(x)},_initLayout:function(){var P=this._container;this._fadeAnimated=this.options.fadeAnimation&&Ke.any3d,hi(P,"leaflet-container"+(Ke.touch?" leaflet-touch":"")+(Ke.retina?" leaflet-retina":"")+(Ke.ielt9?" leaflet-oldie":"")+(Ke.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var x=Ur(P,"position");x!=="absolute"&&x!=="relative"&&x!=="fixed"&&x!=="sticky"&&(P.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var P=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),Pt(this._mapPane,new O(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(hi(P.markerPane,"leaflet-zoom-hide"),hi(P.shadowPane,"leaflet-zoom-hide"))},_resetView:function(P,x,j){Pt(this._mapPane,new O(0,0));var q=!this._loaded;this._loaded=!0,x=this._limitZoom(x),this.fire("viewprereset");var ee=this._zoom!==x;this._moveStart(ee,j)._move(P,x)._moveEnd(ee),this.fire("viewreset"),q&&this.fire("load")},_moveStart:function(P,x){return P&&this.fire("zoomstart"),x||this.fire("movestart"),this},_move:function(P,x,j,q){x===void 0&&(x=this._zoom);var ee=this._zoom!==x;return this._zoom=x,this._lastCenter=P,this._pixelOrigin=this._getNewPixelOrigin(P),q?j&&j.pinch&&this.fire("zoom",j):((ee||j&&j.pinch)&&this.fire("zoom",j),this.fire("move",j)),this},_moveEnd:function(P){return P&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return M(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(P){Pt(this._mapPane,this._getMapPanePos().subtract(P))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(P){this._targets={},this._targets[l(this._container)]=this;var x=P?kr:xi;x(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&x(window,"resize",this._onResize,this),Ke.any3d&&this.options.transform3DLimit&&(P?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){M(this._resizeRequest),this._resizeRequest=C(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var P=this._getMapPanePos();Math.max(Math.abs(P.x),Math.abs(P.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(P,x){for(var j=[],q,ee=x==="mouseout"||x==="mouseover",pe=P.target||P.srcElement,Me=!1;pe;){if(q=this._targets[l(pe)],q&&(x==="click"||x==="preclick")&&this._draggableMoved(q)){Me=!0;break}if(q&&q.listens(x,!0)&&(ee&&!pO(pe,P)||(j.push(q),ee))||pe===this._container)break;pe=pe.parentNode}return!j.length&&!Me&&!ee&&this.listens(x,!0)&&(j=[this]),j},_isClickDisabled:function(P){for(;P&&P!==this._container;){if(P._leaflet_disable_click)return!0;P=P.parentNode}},_handleDOMEvent:function(P){var x=P.target||P.srcElement;if(!(!this._loaded||x._leaflet_disable_events||P.type==="click"&&this._isClickDisabled(x))){var j=P.type;j==="mousedown"&&cc(x),this._fireDOMEvent(P,j)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(P,x,j){if(P.type==="click"){var q=r({},P);q.type="preclick",this._fireDOMEvent(q,q.type,j)}var ee=this._findEventTargets(P,x);if(j){for(var pe=[],Me=0;Me<j.length;Me++)j[Me].listens(x,!0)&&pe.push(j[Me]);ee=pe.concat(ee)}if(ee.length){x==="contextmenu"&&Ka(P);var Ve=ee[0],ze={originalEvent:P};if(P.type!=="keypress"&&P.type!=="keydown"&&P.type!=="keyup"){var tt=Ve.getLatLng&&(!Ve._radius||Ve._radius<=10);ze.containerPoint=tt?this.latLngToContainerPoint(Ve.getLatLng()):this.mouseEventToContainerPoint(P),ze.layerPoint=this.containerPointToLayerPoint(ze.containerPoint),ze.latlng=tt?Ve.getLatLng():this.layerPointToLatLng(ze.layerPoint)}for(Me=0;Me<ee.length;Me++)if(ee[Me].fire(x,ze,!0),ze.originalEvent._stopped||ee[Me].options.bubblingMouseEvents===!1&&I(this._mouseEvents,x)!==-1)return}},_draggableMoved:function(P){return P=P.dragging&&P.dragging.enabled()?P:this,P.dragging&&P.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var P=0,x=this._handlers.length;P<x;P++)this._handlers[P].disable()},whenReady:function(P,x){return this._loaded?P.call(x||this,{target:this}):this.on("load",P,x),this},_getMapPanePos:function(){return ri(this._mapPane)||new O(0,0)},_moved:function(){var P=this._getMapPanePos();return P&&!P.equals([0,0])},_getTopLeftPoint:function(P,x){var j=P&&x!==void 0?this._getNewPixelOrigin(P,x):this.getPixelOrigin();return j.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(P,x){var j=this.getSize()._divideBy(2);return this.project(P,x)._subtract(j)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(P,x,j){var q=this._getNewPixelOrigin(j,x);return this.project(P,x)._subtract(q)},_latLngBoundsToNewLayerBounds:function(P,x,j){var q=this._getNewPixelOrigin(j,x);return V([this.project(P.getSouthWest(),x)._subtract(q),this.project(P.getNorthWest(),x)._subtract(q),this.project(P.getSouthEast(),x)._subtract(q),this.project(P.getNorthEast(),x)._subtract(q)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(P){return this.latLngToLayerPoint(P).subtract(this._getCenterLayerPoint())},_limitCenter:function(P,x,j){if(!j)return P;var q=this.project(P,x),ee=this.getSize().divideBy(2),pe=new $(q.subtract(ee),q.add(ee)),Me=this._getBoundsOffset(pe,j,x);return Math.abs(Me.x)<=1&&Math.abs(Me.y)<=1?P:this.unproject(q.add(Me),x)},_limitOffset:function(P,x){if(!x)return P;var j=this.getPixelBounds(),q=new $(j.min.add(P),j.max.add(P));return P.add(this._getBoundsOffset(q,x))},_getBoundsOffset:function(P,x,j){var q=V(this.project(x.getNorthEast(),j),this.project(x.getSouthWest(),j)),ee=q.min.subtract(P.min),pe=q.max.subtract(P.max),Me=this._rebound(ee.x,-pe.x),Ve=this._rebound(ee.y,-pe.y);return new O(Me,Ve)},_rebound:function(P,x){return P+x>0?Math.round(P-x)/2:Math.max(0,Math.ceil(P))-Math.max(0,Math.floor(x))},_limitZoom:function(P){var x=this.getMinZoom(),j=this.getMaxZoom(),q=Ke.any3d?this.options.zoomSnap:1;return q&&(P=Math.round(P/q)*q),Math.max(x,Math.min(j,P))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){ur(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(P,x){var j=this._getCenterOffset(P)._trunc();return(x&&x.animate)!==!0&&!this.getSize().contains(j)?!1:(this.panBy(j,x),!0)},_createAnimProxy:function(){var P=this._proxy=tn("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(P),this.on("zoomanim",function(x){var j=yt,q=this._proxy.style[j];Si(this._proxy,this.project(x.center,x.zoom),this.getZoomScale(x.zoom,1)),q===this._proxy.style[j]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){Xn(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var P=this.getCenter(),x=this.getZoom();Si(this._proxy,this.project(P,x),this.getZoomScale(x,1))},_catchTransitionEnd:function(P){this._animatingZoom&&P.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(P,x,j){if(this._animatingZoom)return!0;if(j=j||{},!this._zoomAnimated||j.animate===!1||this._nothingToAnimate()||Math.abs(x-this._zoom)>this.options.zoomAnimationThreshold)return!1;var q=this.getZoomScale(x),ee=this._getCenterOffset(P)._divideBy(1-1/q);return j.animate!==!0&&!this.getSize().contains(ee)?!1:(C(function(){this._moveStart(!0,j.noMoveStart||!1)._animateZoom(P,x,!0)},this),!0)},_animateZoom:function(P,x,j,q){this._mapPane&&(j&&(this._animatingZoom=!0,this._animateToCenter=P,this._animateToZoom=x,hi(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:P,zoom:x,noUpdate:q}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(a(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&ur(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function Cwe(P,x){return new En(P,x)}var Gu=R.extend({options:{position:"topright"},initialize:function(P){m(this,P)},getPosition:function(){return this.options.position},setPosition:function(P){var x=this._map;return x&&x.removeControl(this),this.options.position=P,x&&x.addControl(this),this},getContainer:function(){return this._container},addTo:function(P){this.remove(),this._map=P;var x=this._container=this.onAdd(P),j=this.getPosition(),q=P._controlCorners[j];return hi(x,"leaflet-control"),j.indexOf("bottom")!==-1?q.insertBefore(x,q.firstChild):q.appendChild(x),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(Xn(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(P){this._map&&P&&P.screenX>0&&P.screenY>0&&this._map.getContainer().focus()}}),aS=function(P){return new Gu(P)};En.include({addControl:function(P){return P.addTo(this),this},removeControl:function(P){return P.remove(),this},_initControlPos:function(){var P=this._controlCorners={},x="leaflet-",j=this._controlContainer=tn("div",x+"control-container",this._container);function q(ee,pe){var Me=x+ee+" "+x+pe;P[ee+pe]=tn("div",Me,j)}q("top","left"),q("top","right"),q("bottom","left"),q("bottom","right")},_clearControlPos:function(){for(var P in this._controlCorners)Xn(this._controlCorners[P]);Xn(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var S5=Gu.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(P,x,j,q){return j<q?-1:q<j?1:0}},initialize:function(P,x,j){m(this,j),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var q in P)this._addLayer(P[q],q);for(q in x)this._addLayer(x[q],q,!0)},onAdd:function(P){this._initLayout(),this._update(),this._map=P,P.on("zoomend",this._checkDisabledLayers,this);for(var x=0;x<this._layers.length;x++)this._layers[x].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(P){return Gu.prototype.addTo.call(this,P),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var P=0;P<this._layers.length;P++)this._layers[P].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(P,x){return this._addLayer(P,x),this._map?this._update():this},addOverlay:function(P,x){return this._addLayer(P,x,!0),this._map?this._update():this},removeLayer:function(P){P.off("add remove",this._onLayerChange,this);var x=this._getLayer(l(P));return x&&this._layers.splice(this._layers.indexOf(x),1),this._map?this._update():this},expand:function(){hi(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var P=this._map.getSize().y-(this._container.offsetTop+50);return P<this._section.clientHeight?(hi(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=P+"px"):ur(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return ur(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var P="leaflet-control-layers",x=this._container=tn("div",P),j=this.options.collapsed;x.setAttribute("aria-haspopup",!0),oS(x),dO(x);var q=this._section=tn("section",P+"-list");j&&(this._map.on("click",this.collapse,this),xi(x,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var ee=this._layersLink=tn("a",P+"-toggle",x);ee.href="#",ee.title="Layers",ee.setAttribute("role","button"),xi(ee,{keydown:function(pe){pe.keyCode===13&&this._expandSafely()},click:function(pe){Ka(pe),this._expandSafely()}},this),j||this.expand(),this._baseLayersList=tn("div",P+"-base",q),this._separator=tn("div",P+"-separator",q),this._overlaysList=tn("div",P+"-overlays",q),x.appendChild(q)},_getLayer:function(P){for(var x=0;x<this._layers.length;x++)if(this._layers[x]&&l(this._layers[x].layer)===P)return this._layers[x]},_addLayer:function(P,x,j){this._map&&P.on("add remove",this._onLayerChange,this),this._layers.push({layer:P,name:x,overlay:j}),this.options.sortLayers&&this._layers.sort(a(function(q,ee){return this.options.sortFunction(q.layer,ee.layer,q.name,ee.name)},this)),this.options.autoZIndex&&P.setZIndex&&(this._lastZIndex++,P.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Do(this._baseLayersList),Do(this._overlaysList),this._layerControlInputs=[];var P,x,j,q,ee=0;for(j=0;j<this._layers.length;j++)q=this._layers[j],this._addItem(q),x=x||q.overlay,P=P||!q.overlay,ee+=q.overlay?0:1;return this.options.hideSingleBase&&(P=P&&ee>1,this._baseLayersList.style.display=P?"":"none"),this._separator.style.display=x&&P?"":"none",this},_onLayerChange:function(P){this._handlingClick||this._update();var x=this._getLayer(l(P.target)),j=x.overlay?P.type==="add"?"overlayadd":"overlayremove":P.type==="add"?"baselayerchange":null;j&&this._map.fire(j,x)},_createRadioElement:function(P,x){var j='<input type="radio" class="leaflet-control-layers-selector" name="'+P+'"'+(x?' checked="checked"':"")+"/>",q=document.createElement("div");return q.innerHTML=j,q.firstChild},_addItem:function(P){var x=document.createElement("label"),j=this._map.hasLayer(P.layer),q;P.overlay?(q=document.createElement("input"),q.type="checkbox",q.className="leaflet-control-layers-selector",q.defaultChecked=j):q=this._createRadioElement("leaflet-base-layers_"+l(this),j),this._layerControlInputs.push(q),q.layerId=l(P.layer),xi(q,"click",this._onInputClick,this);var ee=document.createElement("span");ee.innerHTML=" "+P.name;var pe=document.createElement("span");x.appendChild(pe),pe.appendChild(q),pe.appendChild(ee);var Me=P.overlay?this._overlaysList:this._baseLayersList;return Me.appendChild(x),this._checkDisabledLayers(),x},_onInputClick:function(){if(!this._preventClick){var P=this._layerControlInputs,x,j,q=[],ee=[];this._handlingClick=!0;for(var pe=P.length-1;pe>=0;pe--)x=P[pe],j=this._getLayer(x.layerId).layer,x.checked?q.push(j):x.checked||ee.push(j);for(pe=0;pe<ee.length;pe++)this._map.hasLayer(ee[pe])&&this._map.removeLayer(ee[pe]);for(pe=0;pe<q.length;pe++)this._map.hasLayer(q[pe])||this._map.addLayer(q[pe]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var P=this._layerControlInputs,x,j,q=this._map.getZoom(),ee=P.length-1;ee>=0;ee--)x=P[ee],j=this._getLayer(x.layerId).layer,x.disabled=j.options.minZoom!==void 0&&q<j.options.minZoom||j.options.maxZoom!==void 0&&q>j.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var P=this._section;this._preventClick=!0,xi(P,"click",Ka),this.expand();var x=this;setTimeout(function(){kr(P,"click",Ka),x._preventClick=!1})}}),Ewe=function(P,x,j){return new S5(P,x,j)},hO=Gu.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(P){var x="leaflet-control-zoom",j=tn("div",x+" leaflet-bar"),q=this.options;return this._zoomInButton=this._createButton(q.zoomInText,q.zoomInTitle,x+"-in",j,this._zoomIn),this._zoomOutButton=this._createButton(q.zoomOutText,q.zoomOutTitle,x+"-out",j,this._zoomOut),this._updateDisabled(),P.on("zoomend zoomlevelschange",this._updateDisabled,this),j},onRemove:function(P){P.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(P){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(P.shiftKey?3:1))},_zoomOut:function(P){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(P.shiftKey?3:1))},_createButton:function(P,x,j,q,ee){var pe=tn("a",j,q);return pe.innerHTML=P,pe.href="#",pe.title=x,pe.setAttribute("role","button"),pe.setAttribute("aria-label",x),oS(pe),xi(pe,"click",Ng),xi(pe,"click",ee,this),xi(pe,"click",this._refocusOnMap,this),pe},_updateDisabled:function(){var P=this._map,x="leaflet-disabled";ur(this._zoomInButton,x),ur(this._zoomOutButton,x),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||P._zoom===P.getMinZoom())&&(hi(this._zoomOutButton,x),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||P._zoom===P.getMaxZoom())&&(hi(this._zoomInButton,x),this._zoomInButton.setAttribute("aria-disabled","true"))}});En.mergeOptions({zoomControl:!0}),En.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new hO,this.addControl(this.zoomControl))});var Mwe=function(P){return new hO(P)},T5=Gu.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(P){var x="leaflet-control-scale",j=tn("div",x),q=this.options;return this._addScales(q,x+"-line",j),P.on(q.updateWhenIdle?"moveend":"move",this._update,this),P.whenReady(this._update,this),j},onRemove:function(P){P.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(P,x,j){P.metric&&(this._mScale=tn("div",x,j)),P.imperial&&(this._iScale=tn("div",x,j))},_update:function(){var P=this._map,x=P.getSize().y/2,j=P.distance(P.containerPointToLatLng([0,x]),P.containerPointToLatLng([this.options.maxWidth,x]));this._updateScales(j)},_updateScales:function(P){this.options.metric&&P&&this._updateMetric(P),this.options.imperial&&P&&this._updateImperial(P)},_updateMetric:function(P){var x=this._getRoundNum(P),j=x<1e3?x+" m":x/1e3+" km";this._updateScale(this._mScale,j,x/P)},_updateImperial:function(P){var x=P*3.2808399,j,q,ee;x>5280?(j=x/5280,q=this._getRoundNum(j),this._updateScale(this._iScale,q+" mi",q/j)):(ee=this._getRoundNum(x),this._updateScale(this._iScale,ee+" ft",ee/x))},_updateScale:function(P,x,j){P.style.width=Math.round(this.options.maxWidth*j)+"px",P.innerHTML=x},_getRoundNum:function(P){var x=Math.pow(10,(Math.floor(P)+"").length-1),j=P/x;return j=j>=10?10:j>=5?5:j>=3?3:j>=2?2:1,x*j}}),Rwe=function(P){return new T5(P)},Nwe='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',fO=Gu.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(Ke.inlineSvg?Nwe+" ":"")+"Leaflet</a>"},initialize:function(P){m(this,P),this._attributions={}},onAdd:function(P){P.attributionControl=this,this._container=tn("div","leaflet-control-attribution"),oS(this._container);for(var x in P._layers)P._layers[x].getAttribution&&this.addAttribution(P._layers[x].getAttribution());return this._update(),P.on("layeradd",this._addAttribution,this),this._container},onRemove:function(P){P.off("layeradd",this._addAttribution,this)},_addAttribution:function(P){P.layer.getAttribution&&(this.addAttribution(P.layer.getAttribution()),P.layer.once("remove",function(){this.removeAttribution(P.layer.getAttribution())},this))},setPrefix:function(P){return this.options.prefix=P,this._update(),this},addAttribution:function(P){return P?(this._attributions[P]||(this._attributions[P]=0),this._attributions[P]++,this._update(),this):this},removeAttribution:function(P){return P?(this._attributions[P]&&(this._attributions[P]--,this._update()),this):this},_update:function(){if(this._map){var P=[];for(var x in this._attributions)this._attributions[x]&&P.push(x);var j=[];this.options.prefix&&j.push(this.options.prefix),P.length&&j.push(P.join(", ")),this._container.innerHTML=j.join(' <span aria-hidden="true">|</span> ')}}});En.mergeOptions({attributionControl:!0}),En.addInitHook(function(){this.options.attributionControl&&new fO().addTo(this)});var Awe=function(P){return new fO(P)};Gu.Layers=S5,Gu.Zoom=hO,Gu.Scale=T5,Gu.Attribution=fO,aS.layers=Ewe,aS.zoom=Mwe,aS.scale=Rwe,aS.attribution=Awe;var $d=R.extend({initialize:function(P){this._map=P},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});$d.addTo=function(P,x){return P.addHandler(x,this),this};var _we={Events:_},U5=Ke.touch?"touchstart mousedown":"mousedown",$f=k.extend({options:{clickTolerance:3},initialize:function(P,x,j,q){m(this,q),this._element=P,this._dragStartTarget=x||P,this._preventOutline=j},enable:function(){this._enabled||(xi(this._dragStartTarget,U5,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&($f._dragging===this&&this.finishDrag(!0),kr(this._dragStartTarget,U5,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(P){if(this._enabled&&(this._moved=!1,!Qi(this._element,"leaflet-zoom-anim"))){if(P.touches&&P.touches.length!==1){$f._dragging===this&&this.finishDrag();return}if(!($f._dragging||P.shiftKey||P.which!==1&&P.button!==1&&!P.touches)&&($f._dragging=this,this._preventOutline&&cc(this._element),Na(),br(),!this._moving)){this.fire("down");var x=P.touches?P.touches[0]:P,j=Bf(this._element);this._startPoint=new O(x.clientX,x.clientY),this._startPos=ri(this._element),this._parentScale=fs(j);var q=P.type==="mousedown";xi(document,q?"mousemove":"touchmove",this._onMove,this),xi(document,q?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(P){if(this._enabled){if(P.touches&&P.touches.length>1){this._moved=!0;return}var x=P.touches&&P.touches.length===1?P.touches[0]:P,j=new O(x.clientX,x.clientY)._subtract(this._startPoint);!j.x&&!j.y||Math.abs(j.x)+Math.abs(j.y)<this.options.clickTolerance||(j.x/=this._parentScale.x,j.y/=this._parentScale.y,Ka(P),this._moved||(this.fire("dragstart"),this._moved=!0,hi(document.body,"leaflet-dragging"),this._lastTarget=P.target||P.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),hi(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(j),this._moving=!0,this._lastEvent=P,this._updatePosition())}},_updatePosition:function(){var P={originalEvent:this._lastEvent};this.fire("predrag",P),Pt(this._element,this._newPos),this.fire("drag",P)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(P){ur(document.body,"leaflet-dragging"),this._lastTarget&&(ur(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),kr(document,"mousemove touchmove",this._onMove,this),kr(document,"mouseup touchend touchcancel",this._onUp,this),zr(),Bo();var x=this._moved&&this._moving;this._moving=!1,$f._dragging=!1,x&&this.fire("dragend",{noInertia:P,distance:this._newPos.distanceTo(this._startPos)})}});function D5(P,x,j){var q,ee=[1,4,2,8],pe,Me,Ve,ze,tt,Dt,fi,pn;for(pe=0,Dt=P.length;pe<Dt;pe++)P[pe]._code=Ag(P[pe],x);for(Ve=0;Ve<4;Ve++){for(fi=ee[Ve],q=[],pe=0,Dt=P.length,Me=Dt-1;pe<Dt;Me=pe++)ze=P[pe],tt=P[Me],ze._code&fi?tt._code&fi||(pn=o1(tt,ze,fi,x,j),pn._code=Ag(pn,x),q.push(pn)):(tt._code&fi&&(pn=o1(tt,ze,fi,x,j),pn._code=Ag(pn,x),q.push(pn)),q.push(ze));P=q}return P}function P5(P,x){var j,q,ee,pe,Me,Ve,ze,tt,Dt;if(!P||P.length===0)throw new Error("latlngs not passed");Qc(P)||(console.warn("latlngs are not flat! Only the first ring will be used"),P=P[0]);var fi=W([0,0]),pn=z(P),Fs=pn.getNorthWest().distanceTo(pn.getSouthWest())*pn.getNorthEast().distanceTo(pn.getNorthWest());Fs<1700&&(fi=mO(P));var Aa=P.length,eu=[];for(j=0;j<Aa;j++){var Ul=W(P[j]);eu.push(x.project(W([Ul.lat-fi.lat,Ul.lng-fi.lng])))}for(Ve=ze=tt=0,j=0,q=Aa-1;j<Aa;q=j++)ee=eu[j],pe=eu[q],Me=ee.y*pe.x-pe.y*ee.x,ze+=(ee.x+pe.x)*Me,tt+=(ee.y+pe.y)*Me,Ve+=Me*3;Ve===0?Dt=eu[0]:Dt=[ze/Ve,tt/Ve];var Nb=x.unproject(B(Dt));return W([Nb.lat+fi.lat,Nb.lng+fi.lng])}function mO(P){for(var x=0,j=0,q=0,ee=0;ee<P.length;ee++){var pe=W(P[ee]);x+=pe.lat,j+=pe.lng,q++}return W([x/q,j/q])}var kwe={__proto__:null,clipPolygon:D5,polygonCenter:P5,centroid:mO};function C5(P,x){if(!x||!P.length)return P.slice();var j=x*x;return P=Lwe(P,j),P=Owe(P,j),P}function E5(P,x,j){return Math.sqrt(sS(P,x,j,!0))}function xwe(P,x,j){return sS(P,x,j)}function Owe(P,x){var j=P.length,q=typeof Uint8Array<"u"?Uint8Array:Array,ee=new q(j);ee[0]=ee[j-1]=1,gO(P,ee,x,0,j-1);var pe,Me=[];for(pe=0;pe<j;pe++)ee[pe]&&Me.push(P[pe]);return Me}function gO(P,x,j,q,ee){var pe=0,Me,Ve,ze;for(Ve=q+1;Ve<=ee-1;Ve++)ze=sS(P[Ve],P[q],P[ee],!0),ze>pe&&(Me=Ve,pe=ze);pe>j&&(x[Me]=1,gO(P,x,j,q,Me),gO(P,x,j,Me,ee))}function Lwe(P,x){for(var j=[P[0]],q=1,ee=0,pe=P.length;q<pe;q++)Fwe(P[q],P[ee])>x&&(j.push(P[q]),ee=q);return ee<pe-1&&j.push(P[pe-1]),j}var M5;function R5(P,x,j,q,ee){var pe=q?M5:Ag(P,j),Me=Ag(x,j),Ve,ze,tt;for(M5=Me;;){if(!(pe|Me))return[P,x];if(pe&Me)return!1;Ve=pe||Me,ze=o1(P,x,Ve,j,ee),tt=Ag(ze,j),Ve===pe?(P=ze,pe=tt):(x=ze,Me=tt)}}function o1(P,x,j,q,ee){var pe=x.x-P.x,Me=x.y-P.y,Ve=q.min,ze=q.max,tt,Dt;return j&8?(tt=P.x+pe*(ze.y-P.y)/Me,Dt=ze.y):j&4?(tt=P.x+pe*(Ve.y-P.y)/Me,Dt=Ve.y):j&2?(tt=ze.x,Dt=P.y+Me*(ze.x-P.x)/pe):j&1&&(tt=Ve.x,Dt=P.y+Me*(Ve.x-P.x)/pe),new O(tt,Dt,ee)}function Ag(P,x){var j=0;return P.x<x.min.x?j|=1:P.x>x.max.x&&(j|=2),P.y<x.min.y?j|=4:P.y>x.max.y&&(j|=8),j}function Fwe(P,x){var j=x.x-P.x,q=x.y-P.y;return j*j+q*q}function sS(P,x,j,q){var ee=x.x,pe=x.y,Me=j.x-ee,Ve=j.y-pe,ze=Me*Me+Ve*Ve,tt;return ze>0&&(tt=((P.x-ee)*Me+(P.y-pe)*Ve)/ze,tt>1?(ee=j.x,pe=j.y):tt>0&&(ee+=Me*tt,pe+=Ve*tt)),Me=P.x-ee,Ve=P.y-pe,q?Me*Me+Ve*Ve:new O(ee,pe)}function Qc(P){return!b(P[0])||typeof P[0][0]!="object"&&typeof P[0][0]<"u"}function N5(P){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),Qc(P)}function A5(P,x){var j,q,ee,pe,Me,Ve,ze,tt;if(!P||P.length===0)throw new Error("latlngs not passed");Qc(P)||(console.warn("latlngs are not flat! Only the first ring will be used"),P=P[0]);var Dt=W([0,0]),fi=z(P),pn=fi.getNorthWest().distanceTo(fi.getSouthWest())*fi.getNorthEast().distanceTo(fi.getNorthWest());pn<1700&&(Dt=mO(P));var Fs=P.length,Aa=[];for(j=0;j<Fs;j++){var eu=W(P[j]);Aa.push(x.project(W([eu.lat-Dt.lat,eu.lng-Dt.lng])))}for(j=0,q=0;j<Fs-1;j++)q+=Aa[j].distanceTo(Aa[j+1])/2;if(q===0)tt=Aa[0];else for(j=0,pe=0;j<Fs-1;j++)if(Me=Aa[j],Ve=Aa[j+1],ee=Me.distanceTo(Ve),pe+=ee,pe>q){ze=(pe-q)/ee,tt=[Ve.x-ze*(Ve.x-Me.x),Ve.y-ze*(Ve.y-Me.y)];break}var Ul=x.unproject(B(tt));return W([Ul.lat+Dt.lat,Ul.lng+Dt.lng])}var Bwe={__proto__:null,simplify:C5,pointToSegmentDistance:E5,closestPointOnSegment:xwe,clipSegment:R5,_getEdgeIntersection:o1,_getBitCode:Ag,_sqClosestPointOnSegment:sS,isFlat:Qc,_flat:N5,polylineCenter:A5},vO={project:function(P){return new O(P.lng,P.lat)},unproject:function(P){return new G(P.y,P.x)},bounds:new $([-180,-90],[180,90])},yO={R:6378137,R_MINOR:6356752314245179e-9,bounds:new $([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(P){var x=Math.PI/180,j=this.R,q=P.lat*x,ee=this.R_MINOR/j,pe=Math.sqrt(1-ee*ee),Me=pe*Math.sin(q),Ve=Math.tan(Math.PI/4-q/2)/Math.pow((1-Me)/(1+Me),pe/2);return q=-j*Math.log(Math.max(Ve,1e-10)),new O(P.lng*x*j,q)},unproject:function(P){for(var x=180/Math.PI,j=this.R,q=this.R_MINOR/j,ee=Math.sqrt(1-q*q),pe=Math.exp(-P.y/j),Me=Math.PI/2-2*Math.atan(pe),Ve=0,ze=.1,tt;Ve<15&&Math.abs(ze)>1e-7;Ve++)tt=ee*Math.sin(Me),tt=Math.pow((1-tt)/(1+tt),ee/2),ze=Math.PI/2-2*Math.atan(pe*tt)-Me,Me+=ze;return new G(Me*x,P.x*x/j)}},$we={__proto__:null,LonLat:vO,Mercator:yO,SphericalMercator:X},Vwe=r({},Z,{code:"EPSG:3395",projection:yO,transformation:function(){var P=.5/(Math.PI*yO.R);return te(P,.5,-P,.5)}()}),_5=r({},Z,{code:"EPSG:4326",projection:vO,transformation:te(1/180,1,-1/180,.5)}),jwe=r({},K,{projection:vO,transformation:te(1,0,-1,0),scale:function(P){return Math.pow(2,P)},zoom:function(P){return Math.log(P)/Math.LN2},distance:function(P,x){var j=x.lng-P.lng,q=x.lat-P.lat;return Math.sqrt(j*j+q*q)},infinite:!0});K.Earth=Z,K.EPSG3395=Vwe,K.EPSG3857=J,K.EPSG900913=ie,K.EPSG4326=_5,K.Simple=jwe;var zu=k.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(P){return P.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(P){return P&&P.removeLayer(this),this},getPane:function(P){return this._map.getPane(P?this.options[P]||P:this.options.pane)},addInteractiveTarget:function(P){return this._map._targets[l(P)]=this,this},removeInteractiveTarget:function(P){return delete this._map._targets[l(P)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(P){var x=P.target;if(x.hasLayer(this)){if(this._map=x,this._zoomAnimated=x._zoomAnimated,this.getEvents){var j=this.getEvents();x.on(j,this),this.once("remove",function(){x.off(j,this)},this)}this.onAdd(x),this.fire("add"),x.fire("layeradd",{layer:this})}}});En.include({addLayer:function(P){if(!P._layerAdd)throw new Error("The provided object is not a Layer.");var x=l(P);return this._layers[x]?this:(this._layers[x]=P,P._mapToAdd=this,P.beforeAdd&&P.beforeAdd(this),this.whenReady(P._layerAdd,P),this)},removeLayer:function(P){var x=l(P);return this._layers[x]?(this._loaded&&P.onRemove(this),delete this._layers[x],this._loaded&&(this.fire("layerremove",{layer:P}),P.fire("remove")),P._map=P._mapToAdd=null,this):this},hasLayer:function(P){return l(P)in this._layers},eachLayer:function(P,x){for(var j in this._layers)P.call(x,this._layers[j]);return this},_addLayers:function(P){P=P?b(P)?P:[P]:[];for(var x=0,j=P.length;x<j;x++)this.addLayer(P[x])},_addZoomLimit:function(P){(!isNaN(P.options.maxZoom)||!isNaN(P.options.minZoom))&&(this._zoomBoundLayers[l(P)]=P,this._updateZoomLevels())},_removeZoomLimit:function(P){var x=l(P);this._zoomBoundLayers[x]&&(delete this._zoomBoundLayers[x],this._updateZoomLevels())},_updateZoomLevels:function(){var P=1/0,x=-1/0,j=this._getZoomSpan();for(var q in this._zoomBoundLayers){var ee=this._zoomBoundLayers[q].options;P=ee.minZoom===void 0?P:Math.min(P,ee.minZoom),x=ee.maxZoom===void 0?x:Math.max(x,ee.maxZoom)}this._layersMaxZoom=x===-1/0?void 0:x,this._layersMinZoom=P===1/0?void 0:P,j!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var Pb=zu.extend({initialize:function(P,x){m(this,x),this._layers={};var j,q;if(P)for(j=0,q=P.length;j<q;j++)this.addLayer(P[j])},addLayer:function(P){var x=this.getLayerId(P);return this._layers[x]=P,this._map&&this._map.addLayer(P),this},removeLayer:function(P){var x=P in this._layers?P:this.getLayerId(P);return this._map&&this._layers[x]&&this._map.removeLayer(this._layers[x]),delete this._layers[x],this},hasLayer:function(P){var x=typeof P=="number"?P:this.getLayerId(P);return x in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(P){var x=Array.prototype.slice.call(arguments,1),j,q;for(j in this._layers)q=this._layers[j],q[P]&&q[P].apply(q,x);return this},onAdd:function(P){this.eachLayer(P.addLayer,P)},onRemove:function(P){this.eachLayer(P.removeLayer,P)},eachLayer:function(P,x){for(var j in this._layers)P.call(x,this._layers[j]);return this},getLayer:function(P){return this._layers[P]},getLayers:function(){var P=[];return this.eachLayer(P.push,P),P},setZIndex:function(P){return this.invoke("setZIndex",P)},getLayerId:function(P){return l(P)}}),Hwe=function(P,x){return new Pb(P,x)},lh=Pb.extend({addLayer:function(P){return this.hasLayer(P)?this:(P.addEventParent(this),Pb.prototype.addLayer.call(this,P),this.fire("layeradd",{layer:P}))},removeLayer:function(P){return this.hasLayer(P)?(P in this._layers&&(P=this._layers[P]),P.removeEventParent(this),Pb.prototype.removeLayer.call(this,P),this.fire("layerremove",{layer:P})):this},setStyle:function(P){return this.invoke("setStyle",P)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var P=new H;for(var x in this._layers){var j=this._layers[x];P.extend(j.getBounds?j.getBounds():j.getLatLng())}return P}}),Gwe=function(P,x){return new lh(P,x)},Cb=R.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(P){m(this,P)},createIcon:function(P){return this._createIcon("icon",P)},createShadow:function(P){return this._createIcon("shadow",P)},_createIcon:function(P,x){var j=this._getIconUrl(P);if(!j){if(P==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var q=this._createImg(j,x&&x.tagName==="IMG"?x:null);return this._setIconStyles(q,P),(this.options.crossOrigin||this.options.crossOrigin==="")&&(q.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),q},_setIconStyles:function(P,x){var j=this.options,q=j[x+"Size"];typeof q=="number"&&(q=[q,q]);var ee=B(q),pe=B(x==="shadow"&&j.shadowAnchor||j.iconAnchor||ee&&ee.divideBy(2,!0));P.className="leaflet-marker-"+x+" "+(j.className||""),pe&&(P.style.marginLeft=-pe.x+"px",P.style.marginTop=-pe.y+"px"),ee&&(P.style.width=ee.x+"px",P.style.height=ee.y+"px")},_createImg:function(P,x){return x=x||document.createElement("img"),x.src=P,x},_getIconUrl:function(P){return Ke.retina&&this.options[P+"RetinaUrl"]||this.options[P+"Url"]}});function zwe(P){return new Cb(P)}var lS=Cb.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(P){return typeof lS.imagePath!="string"&&(lS.imagePath=this._detectIconPath()),(this.options.imagePath||lS.imagePath)+Cb.prototype._getIconUrl.call(this,P)},_stripUrl:function(P){var x=function(j,q,ee){var pe=q.exec(j);return pe&&pe[ee]};return P=x(P,/^url\((['"])?(.+)\1\)$/,2),P&&x(P,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var P=tn("div","leaflet-default-icon-path",document.body),x=Ur(P,"background-image")||Ur(P,"backgroundImage");if(document.body.removeChild(P),x=this._stripUrl(x),x)return x;var j=document.querySelector('link[href$="leaflet.css"]');return j?j.href.substring(0,j.href.length-11-1):""}}),k5=$d.extend({initialize:function(P){this._marker=P},addHooks:function(){var P=this._marker._icon;this._draggable||(this._draggable=new $f(P,P,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),hi(P,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&ur(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(P){var x=this._marker,j=x._map,q=this._marker.options.autoPanSpeed,ee=this._marker.options.autoPanPadding,pe=ri(x._icon),Me=j.getPixelBounds(),Ve=j.getPixelOrigin(),ze=V(Me.min._subtract(Ve).add(ee),Me.max._subtract(Ve).subtract(ee));if(!ze.contains(pe)){var tt=B((Math.max(ze.max.x,pe.x)-ze.max.x)/(Me.max.x-ze.max.x)-(Math.min(ze.min.x,pe.x)-ze.min.x)/(Me.min.x-ze.min.x),(Math.max(ze.max.y,pe.y)-ze.max.y)/(Me.max.y-ze.max.y)-(Math.min(ze.min.y,pe.y)-ze.min.y)/(Me.min.y-ze.min.y)).multiplyBy(q);j.panBy(tt,{animate:!1}),this._draggable._newPos._add(tt),this._draggable._startPos._add(tt),Pt(x._icon,this._draggable._newPos),this._onDrag(P),this._panRequest=C(this._adjustPan.bind(this,P))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(P){this._marker.options.autoPan&&(M(this._panRequest),this._panRequest=C(this._adjustPan.bind(this,P)))},_onDrag:function(P){var x=this._marker,j=x._shadow,q=ri(x._icon),ee=x._map.layerPointToLatLng(q);j&&Pt(j,q),x._latlng=ee,P.latlng=ee,P.oldLatLng=this._oldLatLng,x.fire("move",P).fire("drag",P)},_onDragEnd:function(P){M(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",P)}}),a1=zu.extend({options:{icon:new lS,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(P,x){m(this,x),this._latlng=W(P)},onAdd:function(P){this._zoomAnimated=this._zoomAnimated&&P.options.markerZoomAnimation,this._zoomAnimated&&P.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(P){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&P.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(P){var x=this._latlng;return this._latlng=W(P),this.update(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},setZIndexOffset:function(P){return this.options.zIndexOffset=P,this.update()},getIcon:function(){return this.options.icon},setIcon:function(P){return this.options.icon=P,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var P=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(P)}return this},_initIcon:function(){var P=this.options,x="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),j=P.icon.createIcon(this._icon),q=!1;j!==this._icon&&(this._icon&&this._removeIcon(),q=!0,P.title&&(j.title=P.title),j.tagName==="IMG"&&(j.alt=P.alt||"")),hi(j,x),P.keyboard&&(j.tabIndex="0",j.setAttribute("role","button")),this._icon=j,P.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&xi(j,"focus",this._panOnFocus,this);var ee=P.icon.createShadow(this._shadow),pe=!1;ee!==this._shadow&&(this._removeShadow(),pe=!0),ee&&(hi(ee,x),ee.alt=""),this._shadow=ee,P.opacity<1&&this._updateOpacity(),q&&this.getPane().appendChild(this._icon),this._initInteraction(),ee&&pe&&this.getPane(P.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&kr(this._icon,"focus",this._panOnFocus,this),Xn(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&Xn(this._shadow),this._shadow=null},_setPos:function(P){this._icon&&Pt(this._icon,P),this._shadow&&Pt(this._shadow,P),this._zIndex=P.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(P){this._icon&&(this._icon.style.zIndex=this._zIndex+P)},_animateZoom:function(P){var x=this._map._latLngToNewLayerPoint(this._latlng,P.zoom,P.center).round();this._setPos(x)},_initInteraction:function(){if(this.options.interactive&&(hi(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),k5)){var P=this.options.draggable;this.dragging&&(P=this.dragging.enabled(),this.dragging.disable()),this.dragging=new k5(this),P&&this.dragging.enable()}},setOpacity:function(P){return this.options.opacity=P,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var P=this.options.opacity;this._icon&&at(this._icon,P),this._shadow&&at(this._shadow,P)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var P=this._map;if(P){var x=this.options.icon.options,j=x.iconSize?B(x.iconSize):B(0,0),q=x.iconAnchor?B(x.iconAnchor):B(0,0);P.panInside(this._latlng,{paddingTopLeft:q,paddingBottomRight:j.subtract(q)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Wwe(P,x){return new a1(P,x)}var Vf=zu.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(P){this._renderer=P.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(P){return m(this,P),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&P&&Object.prototype.hasOwnProperty.call(P,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),s1=Vf.extend({options:{fill:!0,radius:10},initialize:function(P,x){m(this,x),this._latlng=W(P),this._radius=this.options.radius},setLatLng:function(P){var x=this._latlng;return this._latlng=W(P),this.redraw(),this.fire("move",{oldLatLng:x,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(P){return this.options.radius=this._radius=P,this.redraw()},getRadius:function(){return this._radius},setStyle:function(P){var x=P&&P.radius||this._radius;return Vf.prototype.setStyle.call(this,P),this.setRadius(x),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var P=this._radius,x=this._radiusY||P,j=this._clickTolerance(),q=[P+j,x+j];this._pxBounds=new $(this._point.subtract(q),this._point.add(q))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(P){return P.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function qwe(P,x){return new s1(P,x)}var bO=s1.extend({initialize:function(P,x,j){if(typeof x=="number"&&(x=r({},j,{radius:x})),m(this,x),this._latlng=W(P),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(P){return this._mRadius=P,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var P=[this._radius,this._radiusY||this._radius];return new H(this._map.layerPointToLatLng(this._point.subtract(P)),this._map.layerPointToLatLng(this._point.add(P)))},setStyle:Vf.prototype.setStyle,_project:function(){var P=this._latlng.lng,x=this._latlng.lat,j=this._map,q=j.options.crs;if(q.distance===Z.distance){var ee=Math.PI/180,pe=this._mRadius/Z.R/ee,Me=j.project([x+pe,P]),Ve=j.project([x-pe,P]),ze=Me.add(Ve).divideBy(2),tt=j.unproject(ze).lat,Dt=Math.acos((Math.cos(pe*ee)-Math.sin(x*ee)*Math.sin(tt*ee))/(Math.cos(x*ee)*Math.cos(tt*ee)))/ee;(isNaN(Dt)||Dt===0)&&(Dt=pe/Math.cos(Math.PI/180*x)),this._point=ze.subtract(j.getPixelOrigin()),this._radius=isNaN(Dt)?0:ze.x-j.project([tt,P-Dt]).x,this._radiusY=ze.y-Me.y}else{var fi=q.unproject(q.project(this._latlng).subtract([this._mRadius,0]));this._point=j.latLngToLayerPoint(this._latlng),this._radius=this._point.x-j.latLngToLayerPoint(fi).x}this._updateBounds()}});function Ywe(P,x,j){return new bO(P,x,j)}var ch=Vf.extend({options:{smoothFactor:1,noClip:!1},initialize:function(P,x){m(this,x),this._setLatLngs(P)},getLatLngs:function(){return this._latlngs},setLatLngs:function(P){return this._setLatLngs(P),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(P){for(var x=1/0,j=null,q=sS,ee,pe,Me=0,Ve=this._parts.length;Me<Ve;Me++)for(var ze=this._parts[Me],tt=1,Dt=ze.length;tt<Dt;tt++){ee=ze[tt-1],pe=ze[tt];var fi=q(P,ee,pe,!0);fi<x&&(x=fi,j=q(P,ee,pe))}return j&&(j.distance=Math.sqrt(x)),j},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return A5(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(P,x){return x=x||this._defaultShape(),P=W(P),x.push(P),this._bounds.extend(P),this.redraw()},_setLatLngs:function(P){this._bounds=new H,this._latlngs=this._convertLatLngs(P)},_defaultShape:function(){return Qc(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(P){for(var x=[],j=Qc(P),q=0,ee=P.length;q<ee;q++)j?(x[q]=W(P[q]),this._bounds.extend(x[q])):x[q]=this._convertLatLngs(P[q]);return x},_project:function(){var P=new $;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,P),this._bounds.isValid()&&P.isValid()&&(this._rawPxBounds=P,this._updateBounds())},_updateBounds:function(){var P=this._clickTolerance(),x=new O(P,P);this._rawPxBounds&&(this._pxBounds=new $([this._rawPxBounds.min.subtract(x),this._rawPxBounds.max.add(x)]))},_projectLatlngs:function(P,x,j){var q=P[0]instanceof G,ee=P.length,pe,Me;if(q){for(Me=[],pe=0;pe<ee;pe++)Me[pe]=this._map.latLngToLayerPoint(P[pe]),j.extend(Me[pe]);x.push(Me)}else for(pe=0;pe<ee;pe++)this._projectLatlngs(P[pe],x,j)},_clipPoints:function(){var P=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(P))){if(this.options.noClip){this._parts=this._rings;return}var x=this._parts,j,q,ee,pe,Me,Ve,ze;for(j=0,ee=0,pe=this._rings.length;j<pe;j++)for(ze=this._rings[j],q=0,Me=ze.length;q<Me-1;q++)Ve=R5(ze[q],ze[q+1],P,q,!0),Ve&&(x[ee]=x[ee]||[],x[ee].push(Ve[0]),(Ve[1]!==ze[q+1]||q===Me-2)&&(x[ee].push(Ve[1]),ee++))}},_simplifyPoints:function(){for(var P=this._parts,x=this.options.smoothFactor,j=0,q=P.length;j<q;j++)P[j]=C5(P[j],x)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(P,x){var j,q,ee,pe,Me,Ve,ze=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(P))return!1;for(j=0,pe=this._parts.length;j<pe;j++)for(Ve=this._parts[j],q=0,Me=Ve.length,ee=Me-1;q<Me;ee=q++)if(!(!x&&q===0)&&E5(P,Ve[ee],Ve[q])<=ze)return!0;return!1}});function Kwe(P,x){return new ch(P,x)}ch._flat=N5;var Eb=ch.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return P5(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(P){var x=ch.prototype._convertLatLngs.call(this,P),j=x.length;return j>=2&&x[0]instanceof G&&x[0].equals(x[j-1])&&x.pop(),x},_setLatLngs:function(P){ch.prototype._setLatLngs.call(this,P),Qc(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return Qc(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var P=this._renderer._bounds,x=this.options.weight,j=new O(x,x);if(P=new $(P.min.subtract(j),P.max.add(j)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(P))){if(this.options.noClip){this._parts=this._rings;return}for(var q=0,ee=this._rings.length,pe;q<ee;q++)pe=D5(this._rings[q],P,!0),pe.length&&this._parts.push(pe)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(P){var x=!1,j,q,ee,pe,Me,Ve,ze,tt;if(!this._pxBounds||!this._pxBounds.contains(P))return!1;for(pe=0,ze=this._parts.length;pe<ze;pe++)for(j=this._parts[pe],Me=0,tt=j.length,Ve=tt-1;Me<tt;Ve=Me++)q=j[Me],ee=j[Ve],q.y>P.y!=ee.y>P.y&&P.x<(ee.x-q.x)*(P.y-q.y)/(ee.y-q.y)+q.x&&(x=!x);return x||ch.prototype._containsPoint.call(this,P,!0)}});function Zwe(P,x){return new Eb(P,x)}var uh=lh.extend({initialize:function(P,x){m(this,x),this._layers={},P&&this.addData(P)},addData:function(P){var x=b(P)?P:P.features,j,q,ee;if(x){for(j=0,q=x.length;j<q;j++)ee=x[j],(ee.geometries||ee.geometry||ee.features||ee.coordinates)&&this.addData(ee);return this}var pe=this.options;if(pe.filter&&!pe.filter(P))return this;var Me=l1(P,pe);return Me?(Me.feature=d1(P),Me.defaultOptions=Me.options,this.resetStyle(Me),pe.onEachFeature&&pe.onEachFeature(P,Me),this.addLayer(Me)):this},resetStyle:function(P){return P===void 0?this.eachLayer(this.resetStyle,this):(P.options=r({},P.defaultOptions),this._setLayerStyle(P,this.options.style),this)},setStyle:function(P){return this.eachLayer(function(x){this._setLayerStyle(x,P)},this)},_setLayerStyle:function(P,x){P.setStyle&&(typeof x=="function"&&(x=x(P.feature)),P.setStyle(x))}});function l1(P,x){var j=P.type==="Feature"?P.geometry:P,q=j?j.coordinates:null,ee=[],pe=x&&x.pointToLayer,Me=x&&x.coordsToLatLng||IO,Ve,ze,tt,Dt;if(!q&&!j)return null;switch(j.type){case"Point":return Ve=Me(q),x5(pe,P,Ve,x);case"MultiPoint":for(tt=0,Dt=q.length;tt<Dt;tt++)Ve=Me(q[tt]),ee.push(x5(pe,P,Ve,x));return new lh(ee);case"LineString":case"MultiLineString":return ze=c1(q,j.type==="LineString"?0:1,Me),new ch(ze,x);case"Polygon":case"MultiPolygon":return ze=c1(q,j.type==="Polygon"?1:2,Me),new Eb(ze,x);case"GeometryCollection":for(tt=0,Dt=j.geometries.length;tt<Dt;tt++){var fi=l1({geometry:j.geometries[tt],type:"Feature",properties:P.properties},x);fi&&ee.push(fi)}return new lh(ee);case"FeatureCollection":for(tt=0,Dt=j.features.length;tt<Dt;tt++){var pn=l1(j.features[tt],x);pn&&ee.push(pn)}return new lh(ee);default:throw new Error("Invalid GeoJSON object.")}}function x5(P,x,j,q){return P?P(x,j):new a1(j,q&&q.markersInheritOptions&&q)}function IO(P){return new G(P[1],P[0],P[2])}function c1(P,x,j){for(var q=[],ee=0,pe=P.length,Me;ee<pe;ee++)Me=x?c1(P[ee],x-1,j):(j||IO)(P[ee]),q.push(Me);return q}function wO(P,x){return P=W(P),P.alt!==void 0?[p(P.lng,x),p(P.lat,x),p(P.alt,x)]:[p(P.lng,x),p(P.lat,x)]}function u1(P,x,j,q){for(var ee=[],pe=0,Me=P.length;pe<Me;pe++)ee.push(x?u1(P[pe],Qc(P[pe])?0:x-1,j,q):wO(P[pe],q));return!x&&j&&ee.length>0&&ee.push(ee[0].slice()),ee}function Mb(P,x){return P.feature?r({},P.feature,{geometry:x}):d1(x)}function d1(P){return P.type==="Feature"||P.type==="FeatureCollection"?P:{type:"Feature",properties:{},geometry:P}}var SO={toGeoJSON:function(P){return Mb(this,{type:"Point",coordinates:wO(this.getLatLng(),P)})}};a1.include(SO),bO.include(SO),s1.include(SO),ch.include({toGeoJSON:function(P){var x=!Qc(this._latlngs),j=u1(this._latlngs,x?1:0,!1,P);return Mb(this,{type:(x?"Multi":"")+"LineString",coordinates:j})}}),Eb.include({toGeoJSON:function(P){var x=!Qc(this._latlngs),j=x&&!Qc(this._latlngs[0]),q=u1(this._latlngs,j?2:x?1:0,!0,P);return x||(q=[q]),Mb(this,{type:(j?"Multi":"")+"Polygon",coordinates:q})}}),Pb.include({toMultiPoint:function(P){var x=[];return this.eachLayer(function(j){x.push(j.toGeoJSON(P).geometry.coordinates)}),Mb(this,{type:"MultiPoint",coordinates:x})},toGeoJSON:function(P){var x=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(x==="MultiPoint")return this.toMultiPoint(P);var j=x==="GeometryCollection",q=[];return this.eachLayer(function(ee){if(ee.toGeoJSON){var pe=ee.toGeoJSON(P);if(j)q.push(pe.geometry);else{var Me=d1(pe);Me.type==="FeatureCollection"?q.push.apply(q,Me.features):q.push(Me)}}}),j?Mb(this,{geometries:q,type:"GeometryCollection"}):{type:"FeatureCollection",features:q}}});function O5(P,x){return new uh(P,x)}var Xwe=O5,p1=zu.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(P,x,j){this._url=P,this._bounds=z(x),m(this,j)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(hi(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){Xn(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(P){return this.options.opacity=P,this._image&&this._updateOpacity(),this},setStyle:function(P){return P.opacity&&this.setOpacity(P.opacity),this},bringToFront:function(){return this._map&&Tl(this._image),this},bringToBack:function(){return this._map&&qa(this._image),this},setUrl:function(P){return this._url=P,this._image&&(this._image.src=P),this},setBounds:function(P){return this._bounds=z(P),this._map&&this._reset(),this},getEvents:function(){var P={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(P.zoomanim=this._animateZoom),P},setZIndex:function(P){return this.options.zIndex=P,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var P=this._url.tagName==="IMG",x=this._image=P?this._url:tn("img");if(hi(x,"leaflet-image-layer"),this._zoomAnimated&&hi(x,"leaflet-zoom-animated"),this.options.className&&hi(x,this.options.className),x.onselectstart=d,x.onmousemove=d,x.onload=a(this.fire,this,"load"),x.onerror=a(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(x.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),P){this._url=x.src;return}x.src=this._url,x.alt=this.options.alt},_animateZoom:function(P){var x=this._map.getZoomScale(P.zoom),j=this._map._latLngBoundsToNewLayerBounds(this._bounds,P.zoom,P.center).min;Si(this._image,j,x)},_reset:function(){var P=this._image,x=new $(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),j=x.getSize();Pt(P,x.min),P.style.width=j.x+"px",P.style.height=j.y+"px"},_updateOpacity:function(){at(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var P=this.options.errorOverlayUrl;P&&this._url!==P&&(this._url=P,this._image.src=P)},getCenter:function(){return this._bounds.getCenter()}}),Jwe=function(P,x,j){return new p1(P,x,j)},L5=p1.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var P=this._url.tagName==="VIDEO",x=this._image=P?this._url:tn("video");if(hi(x,"leaflet-image-layer"),this._zoomAnimated&&hi(x,"leaflet-zoom-animated"),this.options.className&&hi(x,this.options.className),x.onselectstart=d,x.onmousemove=d,x.onloadeddata=a(this.fire,this,"load"),P){for(var j=x.getElementsByTagName("source"),q=[],ee=0;ee<j.length;ee++)q.push(j[ee].src);this._url=j.length>0?q:[x.src];return}b(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(x.style,"objectFit")&&(x.style.objectFit="fill"),x.autoplay=!!this.options.autoplay,x.loop=!!this.options.loop,x.muted=!!this.options.muted,x.playsInline=!!this.options.playsInline;for(var pe=0;pe<this._url.length;pe++){var Me=tn("source");Me.src=this._url[pe],x.appendChild(Me)}}});function Qwe(P,x,j){return new L5(P,x,j)}var F5=p1.extend({_initImage:function(){var P=this._image=this._url;hi(P,"leaflet-image-layer"),this._zoomAnimated&&hi(P,"leaflet-zoom-animated"),this.options.className&&hi(P,this.options.className),P.onselectstart=d,P.onmousemove=d}});function e0e(P,x,j){return new F5(P,x,j)}var Vd=zu.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(P,x){P&&(P instanceof G||b(P))?(this._latlng=W(P),m(this,x)):(m(this,P),this._source=x),this.options.content&&(this._content=this.options.content)},openOn:function(P){return P=arguments.length?P:this._source._map,P.hasLayer(this)||P.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(P){return this._map?this.close():(arguments.length?this._source=P:P=this._source,this._prepareOpen(),this.openOn(P._map)),this},onAdd:function(P){this._zoomAnimated=P._zoomAnimated,this._container||this._initLayout(),P._fadeAnimated&&at(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),P._fadeAnimated&&at(this._container,1),this.bringToFront(),this.options.interactive&&(hi(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(P){P._fadeAnimated?(at(this._container,0),this._removeTimeout=setTimeout(a(Xn,void 0,this._container),200)):Xn(this._container),this.options.interactive&&(ur(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(P){return this._latlng=W(P),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(P){return this._content=P,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var P={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(P.zoomanim=this._animateZoom),P},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&Tl(this._container),this},bringToBack:function(){return this._map&&qa(this._container),this},_prepareOpen:function(P){var x=this._source;if(!x._map)return!1;if(x instanceof lh){x=null;var j=this._source._layers;for(var q in j)if(j[q]._map){x=j[q];break}if(!x)return!1;this._source=x}if(!P)if(x.getCenter)P=x.getCenter();else if(x.getLatLng)P=x.getLatLng();else if(x.getBounds)P=x.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(P),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var P=this._contentNode,x=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof x=="string")P.innerHTML=x;else{for(;P.hasChildNodes();)P.removeChild(P.firstChild);P.appendChild(x)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var P=this._map.latLngToLayerPoint(this._latlng),x=B(this.options.offset),j=this._getAnchor();this._zoomAnimated?Pt(this._container,P.add(j)):x=x.add(P).add(j);var q=this._containerBottom=-x.y,ee=this._containerLeft=-Math.round(this._containerWidth/2)+x.x;this._container.style.bottom=q+"px",this._container.style.left=ee+"px"}},_getAnchor:function(){return[0,0]}});En.include({_initOverlay:function(P,x,j,q){var ee=x;return ee instanceof P||(ee=new P(q).setContent(x)),j&&ee.setLatLng(j),ee}}),zu.include({_initOverlay:function(P,x,j,q){var ee=j;return ee instanceof P?(m(ee,q),ee._source=this):(ee=x&&!q?x:new P(q,this),ee.setContent(j)),ee}});var h1=Vd.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(P){return P=arguments.length?P:this._source._map,!P.hasLayer(this)&&P._popup&&P._popup.options.autoClose&&P.removeLayer(P._popup),P._popup=this,Vd.prototype.openOn.call(this,P)},onAdd:function(P){Vd.prototype.onAdd.call(this,P),P.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Vf||this._source.on("preclick",Rg))},onRemove:function(P){Vd.prototype.onRemove.call(this,P),P.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Vf||this._source.off("preclick",Rg))},getEvents:function(){var P=Vd.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(P.preclick=this.close),this.options.keepInView&&(P.moveend=this._adjustPan),P},_initLayout:function(){var P="leaflet-popup",x=this._container=tn("div",P+" "+(this.options.className||"")+" leaflet-zoom-animated"),j=this._wrapper=tn("div",P+"-content-wrapper",x);if(this._contentNode=tn("div",P+"-content",j),oS(x),dO(this._contentNode),xi(x,"contextmenu",Rg),this._tipContainer=tn("div",P+"-tip-container",x),this._tip=tn("div",P+"-tip",this._tipContainer),this.options.closeButton){var q=this._closeButton=tn("a",P+"-close-button",x);q.setAttribute("role","button"),q.setAttribute("aria-label","Close popup"),q.href="#close",q.innerHTML='<span aria-hidden="true">&#215;</span>',xi(q,"click",function(ee){Ka(ee),this.close()},this)}},_updateLayout:function(){var P=this._contentNode,x=P.style;x.width="",x.whiteSpace="nowrap";var j=P.offsetWidth;j=Math.min(j,this.options.maxWidth),j=Math.max(j,this.options.minWidth),x.width=j+1+"px",x.whiteSpace="",x.height="";var q=P.offsetHeight,ee=this.options.maxHeight,pe="leaflet-popup-scrolled";ee&&q>ee?(x.height=ee+"px",hi(P,pe)):ur(P,pe),this._containerWidth=this._container.offsetWidth},_animateZoom:function(P){var x=this._map._latLngToNewLayerPoint(this._latlng,P.zoom,P.center),j=this._getAnchor();Pt(this._container,x.add(j))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var P=this._map,x=parseInt(Ur(this._container,"marginBottom"),10)||0,j=this._container.offsetHeight+x,q=this._containerWidth,ee=new O(this._containerLeft,-j-this._containerBottom);ee._add(ri(this._container));var pe=P.layerPointToContainerPoint(ee),Me=B(this.options.autoPanPadding),Ve=B(this.options.autoPanPaddingTopLeft||Me),ze=B(this.options.autoPanPaddingBottomRight||Me),tt=P.getSize(),Dt=0,fi=0;pe.x+q+ze.x>tt.x&&(Dt=pe.x+q-tt.x+ze.x),pe.x-Dt-Ve.x<0&&(Dt=pe.x-Ve.x),pe.y+j+ze.y>tt.y&&(fi=pe.y+j-tt.y+ze.y),pe.y-fi-Ve.y<0&&(fi=pe.y-Ve.y),(Dt||fi)&&(this.options.keepInView&&(this._autopanning=!0),P.fire("autopanstart").panBy([Dt,fi]))}},_getAnchor:function(){return B(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),t0e=function(P,x){return new h1(P,x)};En.mergeOptions({closePopupOnClick:!0}),En.include({openPopup:function(P,x,j){return this._initOverlay(h1,P,x,j).openOn(this),this},closePopup:function(P){return P=arguments.length?P:this._popup,P&&P.close(),this}}),zu.include({bindPopup:function(P,x){return this._popup=this._initOverlay(h1,this._popup,P,x),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(P){return this._popup&&(this instanceof lh||(this._popup._source=this),this._popup._prepareOpen(P||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(P){return this._popup&&this._popup.setContent(P),this},getPopup:function(){return this._popup},_openPopup:function(P){if(!(!this._popup||!this._map)){Ng(P);var x=P.layer||P.target;if(this._popup._source===x&&!(x instanceof Vf)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(P.latlng);return}this._popup._source=x,this.openPopup(P.latlng)}},_movePopup:function(P){this._popup.setLatLng(P.latlng)},_onKeyPress:function(P){P.originalEvent.keyCode===13&&this._openPopup(P)}});var f1=Vd.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(P){Vd.prototype.onAdd.call(this,P),this.setOpacity(this.options.opacity),P.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(P){Vd.prototype.onRemove.call(this,P),P.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var P=Vd.prototype.getEvents.call(this);return this.options.permanent||(P.preclick=this.close),P},_initLayout:function(){var P="leaflet-tooltip",x=P+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=tn("div",x),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+l(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(P){var x,j,q=this._map,ee=this._container,pe=q.latLngToContainerPoint(q.getCenter()),Me=q.layerPointToContainerPoint(P),Ve=this.options.direction,ze=ee.offsetWidth,tt=ee.offsetHeight,Dt=B(this.options.offset),fi=this._getAnchor();Ve==="top"?(x=ze/2,j=tt):Ve==="bottom"?(x=ze/2,j=0):Ve==="center"?(x=ze/2,j=tt/2):Ve==="right"?(x=0,j=tt/2):Ve==="left"?(x=ze,j=tt/2):Me.x<pe.x?(Ve="right",x=0,j=tt/2):(Ve="left",x=ze+(Dt.x+fi.x)*2,j=tt/2),P=P.subtract(B(x,j,!0)).add(Dt).add(fi),ur(ee,"leaflet-tooltip-right"),ur(ee,"leaflet-tooltip-left"),ur(ee,"leaflet-tooltip-top"),ur(ee,"leaflet-tooltip-bottom"),hi(ee,"leaflet-tooltip-"+Ve),Pt(ee,P)},_updatePosition:function(){var P=this._map.latLngToLayerPoint(this._latlng);this._setPosition(P)},setOpacity:function(P){this.options.opacity=P,this._container&&at(this._container,P)},_animateZoom:function(P){var x=this._map._latLngToNewLayerPoint(this._latlng,P.zoom,P.center);this._setPosition(x)},_getAnchor:function(){return B(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),i0e=function(P,x){return new f1(P,x)};En.include({openTooltip:function(P,x,j){return this._initOverlay(f1,P,x,j).openOn(this),this},closeTooltip:function(P){return P.close(),this}}),zu.include({bindTooltip:function(P,x){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(f1,this._tooltip,P,x),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(P){if(!(!P&&this._tooltipHandlersAdded)){var x=P?"off":"on",j={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?j.add=this._openTooltip:(j.mouseover=this._openTooltip,j.mouseout=this.closeTooltip,j.click=this._openTooltip,this._map?this._addFocusListeners():j.add=this._addFocusListeners),this._tooltip.options.sticky&&(j.mousemove=this._moveTooltip),this[x](j),this._tooltipHandlersAdded=!P}},openTooltip:function(P){return this._tooltip&&(this instanceof lh||(this._tooltip._source=this),this._tooltip._prepareOpen(P)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(P){return this._tooltip&&this._tooltip.setContent(P),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(P){var x=typeof P.getElement=="function"&&P.getElement();x&&(xi(x,"focus",function(){this._tooltip._source=P,this.openTooltip()},this),xi(x,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(P){var x=typeof P.getElement=="function"&&P.getElement();x&&x.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(P){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var x=this;this._map.once("moveend",function(){x._openOnceFlag=!1,x._openTooltip(P)});return}this._tooltip._source=P.layer||P.target,this.openTooltip(this._tooltip.options.sticky?P.latlng:void 0)}},_moveTooltip:function(P){var x=P.latlng,j,q;this._tooltip.options.sticky&&P.originalEvent&&(j=this._map.mouseEventToContainerPoint(P.originalEvent),q=this._map.containerPointToLayerPoint(j),x=this._map.layerPointToLatLng(q)),this._tooltip.setLatLng(x)}});var B5=Cb.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(P){var x=P&&P.tagName==="DIV"?P:document.createElement("div"),j=this.options;if(j.html instanceof Element?(Do(x),x.appendChild(j.html)):x.innerHTML=j.html!==!1?j.html:"",j.bgPos){var q=B(j.bgPos);x.style.backgroundPosition=-q.x+"px "+-q.y+"px"}return this._setIconStyles(x,"icon"),x},createShadow:function(){return null}});function n0e(P){return new B5(P)}Cb.Default=lS;var cS=zu.extend({options:{tileSize:256,opacity:1,updateWhenIdle:Ke.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(P){m(this,P)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(P){P._addZoomLimit(this)},onRemove:function(P){this._removeAllTiles(),Xn(this._container),P._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(Tl(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(qa(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(P){return this.options.opacity=P,this._updateOpacity(),this},setZIndex:function(P){return this.options.zIndex=P,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var P=this._clampZoom(this._map.getZoom());P!==this._tileZoom&&(this._tileZoom=P,this._updateLevels()),this._update()}return this},getEvents:function(){var P={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=c(this._onMoveEnd,this.options.updateInterval,this)),P.move=this._onMove),this._zoomAnimated&&(P.zoomanim=this._animateZoom),P},createTile:function(){return document.createElement("div")},getTileSize:function(){var P=this.options.tileSize;return P instanceof O?P:new O(P,P)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(P){for(var x=this.getPane().children,j=-P(-1/0,1/0),q=0,ee=x.length,pe;q<ee;q++)pe=x[q].style.zIndex,x[q]!==this._container&&pe&&(j=P(j,+pe));isFinite(j)&&(this.options.zIndex=j+P(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!Ke.ielt9){at(this._container,this.options.opacity);var P=+new Date,x=!1,j=!1;for(var q in this._tiles){var ee=this._tiles[q];if(!(!ee.current||!ee.loaded)){var pe=Math.min(1,(P-ee.loaded)/200);at(ee.el,pe),pe<1?x=!0:(ee.active?j=!0:this._onOpaqueTile(ee),ee.active=!0)}}j&&!this._noPrune&&this._pruneTiles(),x&&(M(this._fadeFrame),this._fadeFrame=C(this._updateOpacity,this))}},_onOpaqueTile:d,_initContainer:function(){this._container||(this._container=tn("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var P=this._tileZoom,x=this.options.maxZoom;if(P!==void 0){for(var j in this._levels)j=Number(j),this._levels[j].el.children.length||j===P?(this._levels[j].el.style.zIndex=x-Math.abs(P-j),this._onUpdateLevel(j)):(Xn(this._levels[j].el),this._removeTilesAtZoom(j),this._onRemoveLevel(j),delete this._levels[j]);var q=this._levels[P],ee=this._map;return q||(q=this._levels[P]={},q.el=tn("div","leaflet-tile-container leaflet-zoom-animated",this._container),q.el.style.zIndex=x,q.origin=ee.project(ee.unproject(ee.getPixelOrigin()),P).round(),q.zoom=P,this._setZoomTransform(q,ee.getCenter(),ee.getZoom()),d(q.el.offsetWidth),this._onCreateLevel(q)),this._level=q,q}},_onUpdateLevel:d,_onRemoveLevel:d,_onCreateLevel:d,_pruneTiles:function(){if(this._map){var P,x,j=this._map.getZoom();if(j>this.options.maxZoom||j<this.options.minZoom){this._removeAllTiles();return}for(P in this._tiles)x=this._tiles[P],x.retain=x.current;for(P in this._tiles)if(x=this._tiles[P],x.current&&!x.active){var q=x.coords;this._retainParent(q.x,q.y,q.z,q.z-5)||this._retainChildren(q.x,q.y,q.z,q.z+2)}for(P in this._tiles)this._tiles[P].retain||this._removeTile(P)}},_removeTilesAtZoom:function(P){for(var x in this._tiles)this._tiles[x].coords.z===P&&this._removeTile(x)},_removeAllTiles:function(){for(var P in this._tiles)this._removeTile(P)},_invalidateAll:function(){for(var P in this._levels)Xn(this._levels[P].el),this._onRemoveLevel(Number(P)),delete this._levels[P];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(P,x,j,q){var ee=Math.floor(P/2),pe=Math.floor(x/2),Me=j-1,Ve=new O(+ee,+pe);Ve.z=+Me;var ze=this._tileCoordsToKey(Ve),tt=this._tiles[ze];return tt&&tt.active?(tt.retain=!0,!0):(tt&&tt.loaded&&(tt.retain=!0),Me>q?this._retainParent(ee,pe,Me,q):!1)},_retainChildren:function(P,x,j,q){for(var ee=2*P;ee<2*P+2;ee++)for(var pe=2*x;pe<2*x+2;pe++){var Me=new O(ee,pe);Me.z=j+1;var Ve=this._tileCoordsToKey(Me),ze=this._tiles[Ve];if(ze&&ze.active){ze.retain=!0;continue}else ze&&ze.loaded&&(ze.retain=!0);j+1<q&&this._retainChildren(ee,pe,j+1,q)}},_resetView:function(P){var x=P&&(P.pinch||P.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),x,x)},_animateZoom:function(P){this._setView(P.center,P.zoom,!0,P.noUpdate)},_clampZoom:function(P){var x=this.options;return x.minNativeZoom!==void 0&&P<x.minNativeZoom?x.minNativeZoom:x.maxNativeZoom!==void 0&&x.maxNativeZoom<P?x.maxNativeZoom:P},_setView:function(P,x,j,q){var ee=Math.round(x);this.options.maxZoom!==void 0&&ee>this.options.maxZoom||this.options.minZoom!==void 0&&ee<this.options.minZoom?ee=void 0:ee=this._clampZoom(ee);var pe=this.options.updateWhenZooming&&ee!==this._tileZoom;(!q||pe)&&(this._tileZoom=ee,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),ee!==void 0&&this._update(P),j||this._pruneTiles(),this._noPrune=!!j),this._setZoomTransforms(P,x)},_setZoomTransforms:function(P,x){for(var j in this._levels)this._setZoomTransform(this._levels[j],P,x)},_setZoomTransform:function(P,x,j){var q=this._map.getZoomScale(j,P.zoom),ee=P.origin.multiplyBy(q).subtract(this._map._getNewPixelOrigin(x,j)).round();Ke.any3d?Si(P.el,ee,q):Pt(P.el,ee)},_resetGrid:function(){var P=this._map,x=P.options.crs,j=this._tileSize=this.getTileSize(),q=this._tileZoom,ee=this._map.getPixelWorldBounds(this._tileZoom);ee&&(this._globalTileRange=this._pxBoundsToTileRange(ee)),this._wrapX=x.wrapLng&&!this.options.noWrap&&[Math.floor(P.project([0,x.wrapLng[0]],q).x/j.x),Math.ceil(P.project([0,x.wrapLng[1]],q).x/j.y)],this._wrapY=x.wrapLat&&!this.options.noWrap&&[Math.floor(P.project([x.wrapLat[0],0],q).y/j.x),Math.ceil(P.project([x.wrapLat[1],0],q).y/j.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(P){var x=this._map,j=x._animatingZoom?Math.max(x._animateToZoom,x.getZoom()):x.getZoom(),q=x.getZoomScale(j,this._tileZoom),ee=x.project(P,this._tileZoom).floor(),pe=x.getSize().divideBy(q*2);return new $(ee.subtract(pe),ee.add(pe))},_update:function(P){var x=this._map;if(x){var j=this._clampZoom(x.getZoom());if(P===void 0&&(P=x.getCenter()),this._tileZoom!==void 0){var q=this._getTiledPixelBounds(P),ee=this._pxBoundsToTileRange(q),pe=ee.getCenter(),Me=[],Ve=this.options.keepBuffer,ze=new $(ee.getBottomLeft().subtract([Ve,-Ve]),ee.getTopRight().add([Ve,-Ve]));if(!(isFinite(ee.min.x)&&isFinite(ee.min.y)&&isFinite(ee.max.x)&&isFinite(ee.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var tt in this._tiles){var Dt=this._tiles[tt].coords;(Dt.z!==this._tileZoom||!ze.contains(new O(Dt.x,Dt.y)))&&(this._tiles[tt].current=!1)}if(Math.abs(j-this._tileZoom)>1){this._setView(P,j);return}for(var fi=ee.min.y;fi<=ee.max.y;fi++)for(var pn=ee.min.x;pn<=ee.max.x;pn++){var Fs=new O(pn,fi);if(Fs.z=this._tileZoom,!!this._isValidTile(Fs)){var Aa=this._tiles[this._tileCoordsToKey(Fs)];Aa?Aa.current=!0:Me.push(Fs)}}if(Me.sort(function(Ul,Nb){return Ul.distanceTo(pe)-Nb.distanceTo(pe)}),Me.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var eu=document.createDocumentFragment();for(pn=0;pn<Me.length;pn++)this._addTile(Me[pn],eu);this._level.el.appendChild(eu)}}}},_isValidTile:function(P){var x=this._map.options.crs;if(!x.infinite){var j=this._globalTileRange;if(!x.wrapLng&&(P.x<j.min.x||P.x>j.max.x)||!x.wrapLat&&(P.y<j.min.y||P.y>j.max.y))return!1}if(!this.options.bounds)return!0;var q=this._tileCoordsToBounds(P);return z(this.options.bounds).overlaps(q)},_keyToBounds:function(P){return this._tileCoordsToBounds(this._keyToTileCoords(P))},_tileCoordsToNwSe:function(P){var x=this._map,j=this.getTileSize(),q=P.scaleBy(j),ee=q.add(j),pe=x.unproject(q,P.z),Me=x.unproject(ee,P.z);return[pe,Me]},_tileCoordsToBounds:function(P){var x=this._tileCoordsToNwSe(P),j=new H(x[0],x[1]);return this.options.noWrap||(j=this._map.wrapLatLngBounds(j)),j},_tileCoordsToKey:function(P){return P.x+":"+P.y+":"+P.z},_keyToTileCoords:function(P){var x=P.split(":"),j=new O(+x[0],+x[1]);return j.z=+x[2],j},_removeTile:function(P){var x=this._tiles[P];x&&(Xn(x.el),delete this._tiles[P],this.fire("tileunload",{tile:x.el,coords:this._keyToTileCoords(P)}))},_initTile:function(P){hi(P,"leaflet-tile");var x=this.getTileSize();P.style.width=x.x+"px",P.style.height=x.y+"px",P.onselectstart=d,P.onmousemove=d,Ke.ielt9&&this.options.opacity<1&&at(P,this.options.opacity)},_addTile:function(P,x){var j=this._getTilePos(P),q=this._tileCoordsToKey(P),ee=this.createTile(this._wrapCoords(P),a(this._tileReady,this,P));this._initTile(ee),this.createTile.length<2&&C(a(this._tileReady,this,P,null,ee)),Pt(ee,j),this._tiles[q]={el:ee,coords:P,current:!0},x.appendChild(ee),this.fire("tileloadstart",{tile:ee,coords:P})},_tileReady:function(P,x,j){x&&this.fire("tileerror",{error:x,tile:j,coords:P});var q=this._tileCoordsToKey(P);j=this._tiles[q],j&&(j.loaded=+new Date,this._map._fadeAnimated?(at(j.el,0),M(this._fadeFrame),this._fadeFrame=C(this._updateOpacity,this)):(j.active=!0,this._pruneTiles()),x||(hi(j.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:j.el,coords:P})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),Ke.ielt9||!this._map._fadeAnimated?C(this._pruneTiles,this):setTimeout(a(this._pruneTiles,this),250)))},_getTilePos:function(P){return P.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(P){var x=new O(this._wrapX?u(P.x,this._wrapX):P.x,this._wrapY?u(P.y,this._wrapY):P.y);return x.z=P.z,x},_pxBoundsToTileRange:function(P){var x=this.getTileSize();return new $(P.min.unscaleBy(x).floor(),P.max.unscaleBy(x).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var P in this._tiles)if(!this._tiles[P].loaded)return!1;return!0}});function r0e(P){return new cS(P)}var Rb=cS.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(P,x){this._url=P,x=m(this,x),x.detectRetina&&Ke.retina&&x.maxZoom>0?(x.tileSize=Math.floor(x.tileSize/2),x.zoomReverse?(x.zoomOffset--,x.minZoom=Math.min(x.maxZoom,x.minZoom+1)):(x.zoomOffset++,x.maxZoom=Math.max(x.minZoom,x.maxZoom-1)),x.minZoom=Math.max(0,x.minZoom)):x.zoomReverse?x.minZoom=Math.min(x.maxZoom,x.minZoom):x.maxZoom=Math.max(x.minZoom,x.maxZoom),typeof x.subdomains=="string"&&(x.subdomains=x.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(P,x){return this._url===P&&x===void 0&&(x=!0),this._url=P,x||this.redraw(),this},createTile:function(P,x){var j=document.createElement("img");return xi(j,"load",a(this._tileOnLoad,this,x,j)),xi(j,"error",a(this._tileOnError,this,x,j)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(j.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(j.referrerPolicy=this.options.referrerPolicy),j.alt="",j.src=this.getTileUrl(P),j},getTileUrl:function(P){var x={r:Ke.retina?"@2x":"",s:this._getSubdomain(P),x:P.x,y:P.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var j=this._globalTileRange.max.y-P.y;this.options.tms&&(x.y=j),x["-y"]=j}return y(this._url,r(x,this.options))},_tileOnLoad:function(P,x){Ke.ielt9?setTimeout(a(P,this,null,x),0):P(null,x)},_tileOnError:function(P,x,j){var q=this.options.errorTileUrl;q&&x.getAttribute("src")!==q&&(x.src=q),P(j,x)},_onTileRemove:function(P){P.tile.onload=null},_getZoomForUrl:function(){var P=this._tileZoom,x=this.options.maxZoom,j=this.options.zoomReverse,q=this.options.zoomOffset;return j&&(P=x-P),P+q},_getSubdomain:function(P){var x=Math.abs(P.x+P.y)%this.options.subdomains.length;return this.options.subdomains[x]},_abortLoading:function(){var P,x;for(P in this._tiles)if(this._tiles[P].coords.z!==this._tileZoom&&(x=this._tiles[P].el,x.onload=d,x.onerror=d,!x.complete)){x.src=T;var j=this._tiles[P].coords;Xn(x),delete this._tiles[P],this.fire("tileabort",{tile:x,coords:j})}},_removeTile:function(P){var x=this._tiles[P];if(x)return x.el.setAttribute("src",T),cS.prototype._removeTile.call(this,P)},_tileReady:function(P,x,j){if(!(!this._map||j&&j.getAttribute("src")===T))return cS.prototype._tileReady.call(this,P,x,j)}});function $5(P,x){return new Rb(P,x)}var V5=Rb.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(P,x){this._url=P;var j=r({},this.defaultWmsParams);for(var q in x)q in this.options||(j[q]=x[q]);x=m(this,x);var ee=x.detectRetina&&Ke.retina?2:1,pe=this.getTileSize();j.width=pe.x*ee,j.height=pe.y*ee,this.wmsParams=j},onAdd:function(P){this._crs=this.options.crs||P.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var x=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[x]=this._crs.code,Rb.prototype.onAdd.call(this,P)},getTileUrl:function(P){var x=this._tileCoordsToNwSe(P),j=this._crs,q=V(j.project(x[0]),j.project(x[1])),ee=q.min,pe=q.max,Me=(this._wmsVersion>=1.3&&this._crs===_5?[ee.y,ee.x,pe.y,pe.x]:[ee.x,ee.y,pe.x,pe.y]).join(","),Ve=Rb.prototype.getTileUrl.call(this,P);return Ve+g(this.wmsParams,Ve,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+Me},setParams:function(P,x){return r(this.wmsParams,P),x||this.redraw(),this}});function o0e(P,x){return new V5(P,x)}Rb.WMS=V5,$5.wms=o0e;var dh=zu.extend({options:{padding:.1},initialize:function(P){m(this,P),l(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),hi(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var P={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(P.zoomanim=this._onAnimZoom),P},_onAnimZoom:function(P){this._updateTransform(P.center,P.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(P,x){var j=this._map.getZoomScale(x,this._zoom),q=this._map.getSize().multiplyBy(.5+this.options.padding),ee=this._map.project(this._center,x),pe=q.multiplyBy(-j).add(ee).subtract(this._map._getNewPixelOrigin(P,x));Ke.any3d?Si(this._container,pe,j):Pt(this._container,pe)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var P in this._layers)this._layers[P]._reset()},_onZoomEnd:function(){for(var P in this._layers)this._layers[P]._project()},_updatePaths:function(){for(var P in this._layers)this._layers[P]._update()},_update:function(){var P=this.options.padding,x=this._map.getSize(),j=this._map.containerPointToLayerPoint(x.multiplyBy(-P)).round();this._bounds=new $(j,j.add(x.multiplyBy(1+P*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),j5=dh.extend({options:{tolerance:0},getEvents:function(){var P=dh.prototype.getEvents.call(this);return P.viewprereset=this._onViewPreReset,P},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){dh.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var P=this._container=document.createElement("canvas");xi(P,"mousemove",this._onMouseMove,this),xi(P,"click dblclick mousedown mouseup contextmenu",this._onClick,this),xi(P,"mouseout",this._handleMouseOut,this),P._leaflet_disable_events=!0,this._ctx=P.getContext("2d")},_destroyContainer:function(){M(this._redrawRequest),delete this._ctx,Xn(this._container),kr(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var P;this._redrawBounds=null;for(var x in this._layers)P=this._layers[x],P._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){dh.prototype._update.call(this);var P=this._bounds,x=this._container,j=P.getSize(),q=Ke.retina?2:1;Pt(x,P.min),x.width=q*j.x,x.height=q*j.y,x.style.width=j.x+"px",x.style.height=j.y+"px",Ke.retina&&this._ctx.scale(2,2),this._ctx.translate(-P.min.x,-P.min.y),this.fire("update")}},_reset:function(){dh.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(P){this._updateDashArray(P),this._layers[l(P)]=P;var x=P._order={layer:P,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=x),this._drawLast=x,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(P){this._requestRedraw(P)},_removePath:function(P){var x=P._order,j=x.next,q=x.prev;j?j.prev=q:this._drawLast=q,q?q.next=j:this._drawFirst=j,delete P._order,delete this._layers[l(P)],this._requestRedraw(P)},_updatePath:function(P){this._extendRedrawBounds(P),P._project(),P._update(),this._requestRedraw(P)},_updateStyle:function(P){this._updateDashArray(P),this._requestRedraw(P)},_updateDashArray:function(P){if(typeof P.options.dashArray=="string"){var x=P.options.dashArray.split(/[, ]+/),j=[],q,ee;for(ee=0;ee<x.length;ee++){if(q=Number(x[ee]),isNaN(q))return;j.push(q)}P.options._dashArray=j}else P.options._dashArray=P.options.dashArray},_requestRedraw:function(P){this._map&&(this._extendRedrawBounds(P),this._redrawRequest=this._redrawRequest||C(this._redraw,this))},_extendRedrawBounds:function(P){if(P._pxBounds){var x=(P.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new $,this._redrawBounds.extend(P._pxBounds.min.subtract([x,x])),this._redrawBounds.extend(P._pxBounds.max.add([x,x]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var P=this._redrawBounds;if(P){var x=P.getSize();this._ctx.clearRect(P.min.x,P.min.y,x.x,x.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var P,x=this._redrawBounds;if(this._ctx.save(),x){var j=x.getSize();this._ctx.beginPath(),this._ctx.rect(x.min.x,x.min.y,j.x,j.y),this._ctx.clip()}this._drawing=!0;for(var q=this._drawFirst;q;q=q.next)P=q.layer,(!x||P._pxBounds&&P._pxBounds.intersects(x))&&P._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(P,x){if(this._drawing){var j,q,ee,pe,Me=P._parts,Ve=Me.length,ze=this._ctx;if(Ve){for(ze.beginPath(),j=0;j<Ve;j++){for(q=0,ee=Me[j].length;q<ee;q++)pe=Me[j][q],ze[q?"lineTo":"moveTo"](pe.x,pe.y);x&&ze.closePath()}this._fillStroke(ze,P)}}},_updateCircle:function(P){if(!(!this._drawing||P._empty())){var x=P._point,j=this._ctx,q=Math.max(Math.round(P._radius),1),ee=(Math.max(Math.round(P._radiusY),1)||q)/q;ee!==1&&(j.save(),j.scale(1,ee)),j.beginPath(),j.arc(x.x,x.y/ee,q,0,Math.PI*2,!1),ee!==1&&j.restore(),this._fillStroke(j,P)}},_fillStroke:function(P,x){var j=x.options;j.fill&&(P.globalAlpha=j.fillOpacity,P.fillStyle=j.fillColor||j.color,P.fill(j.fillRule||"evenodd")),j.stroke&&j.weight!==0&&(P.setLineDash&&P.setLineDash(x.options&&x.options._dashArray||[]),P.globalAlpha=j.opacity,P.lineWidth=j.weight,P.strokeStyle=j.color,P.lineCap=j.lineCap,P.lineJoin=j.lineJoin,P.stroke())},_onClick:function(P){for(var x=this._map.mouseEventToLayerPoint(P),j,q,ee=this._drawFirst;ee;ee=ee.next)j=ee.layer,j.options.interactive&&j._containsPoint(x)&&(!(P.type==="click"||P.type==="preclick")||!this._map._draggableMoved(j))&&(q=j);this._fireEvent(q?[q]:!1,P)},_onMouseMove:function(P){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var x=this._map.mouseEventToLayerPoint(P);this._handleMouseHover(P,x)}},_handleMouseOut:function(P){var x=this._hoveredLayer;x&&(ur(this._container,"leaflet-interactive"),this._fireEvent([x],P,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(P,x){if(!this._mouseHoverThrottled){for(var j,q,ee=this._drawFirst;ee;ee=ee.next)j=ee.layer,j.options.interactive&&j._containsPoint(x)&&(q=j);q!==this._hoveredLayer&&(this._handleMouseOut(P),q&&(hi(this._container,"leaflet-interactive"),this._fireEvent([q],P,"mouseover"),this._hoveredLayer=q)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,P),this._mouseHoverThrottled=!0,setTimeout(a(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(P,x,j){this._map._fireDOMEvent(x,j||x.type,P)},_bringToFront:function(P){var x=P._order;if(x){var j=x.next,q=x.prev;if(j)j.prev=q;else return;q?q.next=j:j&&(this._drawFirst=j),x.prev=this._drawLast,this._drawLast.next=x,x.next=null,this._drawLast=x,this._requestRedraw(P)}},_bringToBack:function(P){var x=P._order;if(x){var j=x.next,q=x.prev;if(q)q.next=j;else return;j?j.prev=q:q&&(this._drawLast=q),x.prev=null,x.next=this._drawFirst,this._drawFirst.prev=x,this._drawFirst=x,this._requestRedraw(P)}}});function H5(P){return Ke.canvas?new j5(P):null}var uS=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(P){return document.createElement("<lvml:"+P+' class="lvml">')}}catch{}return function(P){return document.createElement("<"+P+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),a0e={_initContainer:function(){this._container=tn("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(dh.prototype._update.call(this),this.fire("update"))},_initPath:function(P){var x=P._container=uS("shape");hi(x,"leaflet-vml-shape "+(this.options.className||"")),x.coordsize="1 1",P._path=uS("path"),x.appendChild(P._path),this._updateStyle(P),this._layers[l(P)]=P},_addPath:function(P){var x=P._container;this._container.appendChild(x),P.options.interactive&&P.addInteractiveTarget(x)},_removePath:function(P){var x=P._container;Xn(x),P.removeInteractiveTarget(x),delete this._layers[l(P)]},_updateStyle:function(P){var x=P._stroke,j=P._fill,q=P.options,ee=P._container;ee.stroked=!!q.stroke,ee.filled=!!q.fill,q.stroke?(x||(x=P._stroke=uS("stroke")),ee.appendChild(x),x.weight=q.weight+"px",x.color=q.color,x.opacity=q.opacity,q.dashArray?x.dashStyle=b(q.dashArray)?q.dashArray.join(" "):q.dashArray.replace(/( *, *)/g," "):x.dashStyle="",x.endcap=q.lineCap.replace("butt","flat"),x.joinstyle=q.lineJoin):x&&(ee.removeChild(x),P._stroke=null),q.fill?(j||(j=P._fill=uS("fill")),ee.appendChild(j),j.color=q.fillColor||q.color,j.opacity=q.fillOpacity):j&&(ee.removeChild(j),P._fill=null)},_updateCircle:function(P){var x=P._point.round(),j=Math.round(P._radius),q=Math.round(P._radiusY||j);this._setPath(P,P._empty()?"M0 0":"AL "+x.x+","+x.y+" "+j+","+q+" 0,"+65535*360)},_setPath:function(P,x){P._path.v=x},_bringToFront:function(P){Tl(P._container)},_bringToBack:function(P){qa(P._container)}},m1=Ke.vml?uS:oe,dS=dh.extend({_initContainer:function(){this._container=m1("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=m1("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){Xn(this._container),kr(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){dh.prototype._update.call(this);var P=this._bounds,x=P.getSize(),j=this._container;(!this._svgSize||!this._svgSize.equals(x))&&(this._svgSize=x,j.setAttribute("width",x.x),j.setAttribute("height",x.y)),Pt(j,P.min),j.setAttribute("viewBox",[P.min.x,P.min.y,x.x,x.y].join(" ")),this.fire("update")}},_initPath:function(P){var x=P._path=m1("path");P.options.className&&hi(x,P.options.className),P.options.interactive&&hi(x,"leaflet-interactive"),this._updateStyle(P),this._layers[l(P)]=P},_addPath:function(P){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(P._path),P.addInteractiveTarget(P._path)},_removePath:function(P){Xn(P._path),P.removeInteractiveTarget(P._path),delete this._layers[l(P)]},_updatePath:function(P){P._project(),P._update()},_updateStyle:function(P){var x=P._path,j=P.options;x&&(j.stroke?(x.setAttribute("stroke",j.color),x.setAttribute("stroke-opacity",j.opacity),x.setAttribute("stroke-width",j.weight),x.setAttribute("stroke-linecap",j.lineCap),x.setAttribute("stroke-linejoin",j.lineJoin),j.dashArray?x.setAttribute("stroke-dasharray",j.dashArray):x.removeAttribute("stroke-dasharray"),j.dashOffset?x.setAttribute("stroke-dashoffset",j.dashOffset):x.removeAttribute("stroke-dashoffset")):x.setAttribute("stroke","none"),j.fill?(x.setAttribute("fill",j.fillColor||j.color),x.setAttribute("fill-opacity",j.fillOpacity),x.setAttribute("fill-rule",j.fillRule||"evenodd")):x.setAttribute("fill","none"))},_updatePoly:function(P,x){this._setPath(P,ne(P._parts,x))},_updateCircle:function(P){var x=P._point,j=Math.max(Math.round(P._radius),1),q=Math.max(Math.round(P._radiusY),1)||j,ee="a"+j+","+q+" 0 1,0 ",pe=P._empty()?"M0 0":"M"+(x.x-j)+","+x.y+ee+j*2+",0 "+ee+-j*2+",0 ";this._setPath(P,pe)},_setPath:function(P,x){P._path.setAttribute("d",x)},_bringToFront:function(P){Tl(P._path)},_bringToBack:function(P){qa(P._path)}});Ke.vml&&dS.include(a0e);function G5(P){return Ke.svg||Ke.vml?new dS(P):null}En.include({getRenderer:function(P){var x=P.options.renderer||this._getPaneRenderer(P.options.pane)||this.options.renderer||this._renderer;return x||(x=this._renderer=this._createRenderer()),this.hasLayer(x)||this.addLayer(x),x},_getPaneRenderer:function(P){if(P==="overlayPane"||P===void 0)return!1;var x=this._paneRenderers[P];return x===void 0&&(x=this._createRenderer({pane:P}),this._paneRenderers[P]=x),x},_createRenderer:function(P){return this.options.preferCanvas&&H5(P)||G5(P)}});var z5=Eb.extend({initialize:function(P,x){Eb.prototype.initialize.call(this,this._boundsToLatLngs(P),x)},setBounds:function(P){return this.setLatLngs(this._boundsToLatLngs(P))},_boundsToLatLngs:function(P){return P=z(P),[P.getSouthWest(),P.getNorthWest(),P.getNorthEast(),P.getSouthEast()]}});function s0e(P,x){return new z5(P,x)}dS.create=m1,dS.pointsToPath=ne,uh.geometryToLayer=l1,uh.coordsToLatLng=IO,uh.coordsToLatLngs=c1,uh.latLngToCoords=wO,uh.latLngsToCoords=u1,uh.getFeature=Mb,uh.asFeature=d1,En.mergeOptions({boxZoom:!0});var W5=$d.extend({initialize:function(P){this._map=P,this._container=P._container,this._pane=P._panes.overlayPane,this._resetStateTimeout=0,P.on("unload",this._destroy,this)},addHooks:function(){xi(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){kr(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){Xn(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(P){if(!P.shiftKey||P.which!==1&&P.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),br(),Na(),this._startPoint=this._map.mouseEventToContainerPoint(P),xi(document,{contextmenu:Ng,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(P){this._moved||(this._moved=!0,this._box=tn("div","leaflet-zoom-box",this._container),hi(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(P);var x=new $(this._point,this._startPoint),j=x.getSize();Pt(this._box,x.min),this._box.style.width=j.x+"px",this._box.style.height=j.y+"px"},_finish:function(){this._moved&&(Xn(this._box),ur(this._container,"leaflet-crosshair")),Bo(),zr(),kr(document,{contextmenu:Ng,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(P){if(!(P.which!==1&&P.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(a(this._resetState,this),0);var x=new H(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(x).fire("boxzoomend",{boxZoomBounds:x})}},_onKeyDown:function(P){P.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});En.addInitHook("addHandler","boxZoom",W5),En.mergeOptions({doubleClickZoom:!0});var q5=$d.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(P){var x=this._map,j=x.getZoom(),q=x.options.zoomDelta,ee=P.originalEvent.shiftKey?j-q:j+q;x.options.doubleClickZoom==="center"?x.setZoom(ee):x.setZoomAround(P.containerPoint,ee)}});En.addInitHook("addHandler","doubleClickZoom",q5),En.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var Y5=$d.extend({addHooks:function(){if(!this._draggable){var P=this._map;this._draggable=new $f(P._mapPane,P._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),P.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),P.on("zoomend",this._onZoomEnd,this),P.whenReady(this._onZoomEnd,this))}hi(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){ur(this._map._container,"leaflet-grab"),ur(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var P=this._map;if(P._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var x=z(this._map.options.maxBounds);this._offsetLimit=V(this._map.latLngToContainerPoint(x.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(x.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;P.fire("movestart").fire("dragstart"),P.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(P){if(this._map.options.inertia){var x=this._lastTime=+new Date,j=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(j),this._times.push(x),this._prunePositions(x)}this._map.fire("move",P).fire("drag",P)},_prunePositions:function(P){for(;this._positions.length>1&&P-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var P=this._map.getSize().divideBy(2),x=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=x.subtract(P).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(P,x){return P-(P-x)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var P=this._draggable._newPos.subtract(this._draggable._startPos),x=this._offsetLimit;P.x<x.min.x&&(P.x=this._viscousLimit(P.x,x.min.x)),P.y<x.min.y&&(P.y=this._viscousLimit(P.y,x.min.y)),P.x>x.max.x&&(P.x=this._viscousLimit(P.x,x.max.x)),P.y>x.max.y&&(P.y=this._viscousLimit(P.y,x.max.y)),this._draggable._newPos=this._draggable._startPos.add(P)}},_onPreDragWrap:function(){var P=this._worldWidth,x=Math.round(P/2),j=this._initialWorldOffset,q=this._draggable._newPos.x,ee=(q-x+j)%P+x-j,pe=(q+x+j)%P-x-j,Me=Math.abs(ee+j)<Math.abs(pe+j)?ee:pe;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=Me},_onDragEnd:function(P){var x=this._map,j=x.options,q=!j.inertia||P.noInertia||this._times.length<2;if(x.fire("dragend",P),q)x.fire("moveend");else{this._prunePositions(+new Date);var ee=this._lastPos.subtract(this._positions[0]),pe=(this._lastTime-this._times[0])/1e3,Me=j.easeLinearity,Ve=ee.multiplyBy(Me/pe),ze=Ve.distanceTo([0,0]),tt=Math.min(j.inertiaMaxSpeed,ze),Dt=Ve.multiplyBy(tt/ze),fi=tt/(j.inertiaDeceleration*Me),pn=Dt.multiplyBy(-fi/2).round();!pn.x&&!pn.y?x.fire("moveend"):(pn=x._limitOffset(pn,x.options.maxBounds),C(function(){x.panBy(pn,{duration:fi,easeLinearity:Me,noMoveStart:!0,animate:!0})}))}}});En.addInitHook("addHandler","dragging",Y5),En.mergeOptions({keyboard:!0,keyboardPanDelta:80});var K5=$d.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(P){this._map=P,this._setPanDelta(P.options.keyboardPanDelta),this._setZoomDelta(P.options.zoomDelta)},addHooks:function(){var P=this._map._container;P.tabIndex<=0&&(P.tabIndex="0"),xi(P,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),kr(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var P=document.body,x=document.documentElement,j=P.scrollTop||x.scrollTop,q=P.scrollLeft||x.scrollLeft;this._map._container.focus(),window.scrollTo(q,j)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(P){var x=this._panKeys={},j=this.keyCodes,q,ee;for(q=0,ee=j.left.length;q<ee;q++)x[j.left[q]]=[-1*P,0];for(q=0,ee=j.right.length;q<ee;q++)x[j.right[q]]=[P,0];for(q=0,ee=j.down.length;q<ee;q++)x[j.down[q]]=[0,P];for(q=0,ee=j.up.length;q<ee;q++)x[j.up[q]]=[0,-1*P]},_setZoomDelta:function(P){var x=this._zoomKeys={},j=this.keyCodes,q,ee;for(q=0,ee=j.zoomIn.length;q<ee;q++)x[j.zoomIn[q]]=P;for(q=0,ee=j.zoomOut.length;q<ee;q++)x[j.zoomOut[q]]=-P},_addHooks:function(){xi(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){kr(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(P){if(!(P.altKey||P.ctrlKey||P.metaKey)){var x=P.keyCode,j=this._map,q;if(x in this._panKeys){if(!j._panAnim||!j._panAnim._inProgress)if(q=this._panKeys[x],P.shiftKey&&(q=B(q).multiplyBy(3)),j.options.maxBounds&&(q=j._limitOffset(B(q),j.options.maxBounds)),j.options.worldCopyJump){var ee=j.wrapLatLng(j.unproject(j.project(j.getCenter()).add(q)));j.panTo(ee)}else j.panBy(q)}else if(x in this._zoomKeys)j.setZoom(j.getZoom()+(P.shiftKey?3:1)*this._zoomKeys[x]);else if(x===27&&j._popup&&j._popup.options.closeOnEscapeKey)j.closePopup();else return;Ng(P)}}});En.addInitHook("addHandler","keyboard",K5),En.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var Z5=$d.extend({addHooks:function(){xi(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){kr(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(P){var x=I5(P),j=this._map.options.wheelDebounceTime;this._delta+=x,this._lastMousePos=this._map.mouseEventToContainerPoint(P),this._startTime||(this._startTime=+new Date);var q=Math.max(j-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(a(this._performZoom,this),q),Ng(P)},_performZoom:function(){var P=this._map,x=P.getZoom(),j=this._map.options.zoomSnap||0;P._stop();var q=this._delta/(this._map.options.wheelPxPerZoomLevel*4),ee=4*Math.log(2/(1+Math.exp(-Math.abs(q))))/Math.LN2,pe=j?Math.ceil(ee/j)*j:ee,Me=P._limitZoom(x+(this._delta>0?pe:-pe))-x;this._delta=0,this._startTime=null,Me&&(P.options.scrollWheelZoom==="center"?P.setZoom(x+Me):P.setZoomAround(this._lastMousePos,x+Me))}});En.addInitHook("addHandler","scrollWheelZoom",Z5);var l0e=600;En.mergeOptions({tapHold:Ke.touchNative&&Ke.safari&&Ke.mobile,tapTolerance:15});var X5=$d.extend({addHooks:function(){xi(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){kr(this._map._container,"touchstart",this._onDown,this)},_onDown:function(P){if(clearTimeout(this._holdTimeout),P.touches.length===1){var x=P.touches[0];this._startPos=this._newPos=new O(x.clientX,x.clientY),this._holdTimeout=setTimeout(a(function(){this._cancel(),this._isTapValid()&&(xi(document,"touchend",Ka),xi(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",x))},this),l0e),xi(document,"touchend touchcancel contextmenu",this._cancel,this),xi(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function P(){kr(document,"touchend",Ka),kr(document,"touchend touchcancel",P)},_cancel:function(){clearTimeout(this._holdTimeout),kr(document,"touchend touchcancel contextmenu",this._cancel,this),kr(document,"touchmove",this._onMove,this)},_onMove:function(P){var x=P.touches[0];this._newPos=new O(x.clientX,x.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(P,x){var j=new MouseEvent(P,{bubbles:!0,cancelable:!0,view:window,screenX:x.screenX,screenY:x.screenY,clientX:x.clientX,clientY:x.clientY});j._simulated=!0,x.target.dispatchEvent(j)}});En.addInitHook("addHandler","tapHold",X5),En.mergeOptions({touchZoom:Ke.touch,bounceAtZoomLimits:!0});var J5=$d.extend({addHooks:function(){hi(this._map._container,"leaflet-touch-zoom"),xi(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){ur(this._map._container,"leaflet-touch-zoom"),kr(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(P){var x=this._map;if(!(!P.touches||P.touches.length!==2||x._animatingZoom||this._zooming)){var j=x.mouseEventToContainerPoint(P.touches[0]),q=x.mouseEventToContainerPoint(P.touches[1]);this._centerPoint=x.getSize()._divideBy(2),this._startLatLng=x.containerPointToLatLng(this._centerPoint),x.options.touchZoom!=="center"&&(this._pinchStartLatLng=x.containerPointToLatLng(j.add(q)._divideBy(2))),this._startDist=j.distanceTo(q),this._startZoom=x.getZoom(),this._moved=!1,this._zooming=!0,x._stop(),xi(document,"touchmove",this._onTouchMove,this),xi(document,"touchend touchcancel",this._onTouchEnd,this),Ka(P)}},_onTouchMove:function(P){if(!(!P.touches||P.touches.length!==2||!this._zooming)){var x=this._map,j=x.mouseEventToContainerPoint(P.touches[0]),q=x.mouseEventToContainerPoint(P.touches[1]),ee=j.distanceTo(q)/this._startDist;if(this._zoom=x.getScaleZoom(ee,this._startZoom),!x.options.bounceAtZoomLimits&&(this._zoom<x.getMinZoom()&&ee<1||this._zoom>x.getMaxZoom()&&ee>1)&&(this._zoom=x._limitZoom(this._zoom)),x.options.touchZoom==="center"){if(this._center=this._startLatLng,ee===1)return}else{var pe=j._add(q)._divideBy(2)._subtract(this._centerPoint);if(ee===1&&pe.x===0&&pe.y===0)return;this._center=x.unproject(x.project(this._pinchStartLatLng,this._zoom).subtract(pe),this._zoom)}this._moved||(x._moveStart(!0,!1),this._moved=!0),M(this._animRequest);var Me=a(x._move,x,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=C(Me,this,!0),Ka(P)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,M(this._animRequest),kr(document,"touchmove",this._onTouchMove,this),kr(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});En.addInitHook("addHandler","touchZoom",J5),En.BoxZoom=W5,En.DoubleClickZoom=q5,En.Drag=Y5,En.Keyboard=K5,En.ScrollWheelZoom=Z5,En.TapHold=X5,En.TouchZoom=J5,i.Bounds=$,i.Browser=Ke,i.CRS=K,i.Canvas=j5,i.Circle=bO,i.CircleMarker=s1,i.Class=R,i.Control=Gu,i.DivIcon=B5,i.DivOverlay=Vd,i.DomEvent=Pwe,i.DomUtil=r1,i.Draggable=$f,i.Evented=k,i.FeatureGroup=lh,i.GeoJSON=uh,i.GridLayer=cS,i.Handler=$d,i.Icon=Cb,i.ImageOverlay=p1,i.LatLng=G,i.LatLngBounds=H,i.Layer=zu,i.LayerGroup=Pb,i.LineUtil=Bwe,i.Map=En,i.Marker=a1,i.Mixin=_we,i.Path=Vf,i.Point=O,i.PolyUtil=kwe,i.Polygon=Eb,i.Polyline=ch,i.Popup=h1,i.PosAnimation=w5,i.Projection=$we,i.Rectangle=z5,i.Renderer=dh,i.SVG=dS,i.SVGOverlay=F5,i.TileLayer=Rb,i.Tooltip=f1,i.Transformation=Q,i.Util=N,i.VideoOverlay=L5,i.bind=a,i.bounds=V,i.canvas=H5,i.circle=Ywe,i.circleMarker=qwe,i.control=aS,i.divIcon=n0e,i.extend=r,i.featureGroup=Gwe,i.geoJSON=O5,i.geoJson=Xwe,i.gridLayer=r0e,i.icon=zwe,i.imageOverlay=Jwe,i.latLng=W,i.latLngBounds=z,i.layerGroup=Hwe,i.map=Cwe,i.marker=Wwe,i.point=B,i.polygon=Zwe,i.polyline=Kwe,i.popup=t0e,i.rectangle=s0e,i.setOptions=m,i.stamp=l,i.svg=G5,i.svgOverlay=e0e,i.tileLayer=$5,i.tooltip=i0e,i.transformation=te,i.version=n,i.videoOverlay=Qwe;var c0e=window.L;i.noConflict=function(){return window.L=c0e,this},window.L=i})})(E$,E$.exports);var dM=E$.exports;function gKe(){try{return navigator||window.navigator}catch{return}}function vKe({coords:t,callback:e}){let i=16;(!(t!=null&&t.latitude)||!(t!=null&&t.longitude))&&(t={latitude:0,longitude:0},i=2);let n={map:"latLongMap",link:"latLonglink"},o=`
         <div style='min-height: 150px'>
         <h2 class='tmx-title'>Enter map URL</h2>
         <div class='flexcenter'>${Fn.tr("phrases.addgooglemap")}</div>
         <div class='flexcenter flexcol'>
            <input id='${n.link}' value='' style='text-align: center; width: 25em; margin: 1em;'>
            <div class='flexrow' style='margin-top: 1em; margin-bottom: 1em;'>
            </div>
         </div>
         <div class='location_detail_body' style='min-width: 350px; min-height: 350px;'>
            <div id='${n.map}' class='location_map' style='width: 100%; height: 100%; min-width: 350px; min-height: 350px;'>
         </div>
      `;lr({content:o,buttons:[{label:"Cancel",intent:"none",close:!0},{onClick:m,intent:"is-warning",label:"Clear"},{onClick:()=>{!t.latitude||!t.longitude?u():m(t)},intent:"is-primary",label:"View",close:!1},{onClick:()=>{(!t.latitude||!t.longitude)&&u(),vt(e)&&e(t)},intent:"is-info",label:"Submit",close:!0}]});const c=sbe(n),u=()=>{const g=c.link.element.value,v=hKe(g)||fKe(g)||pKe(g)||mKe(g);v.latitude?m(v):g&&v.latitude===void 0&&vi({message:"Invalid URL"})},d=g=>{g.which===13&&u()};let{map:p,marker:h}=yKe({successElement:c.map.element,mapElementId:c.map.id,coords:t,zoom:i});c.link.element.value="",c.link.element.focus(),c.link.element.addEventListener("keyup",d),p&&(p.on("click",g=>f({latitude:g.latlng.lat,longitude:g.latlng.lng})),p.on("contextmenu",g=>console.log("Coordinates: "+g.latlng.toString())));function f({latitude:g,longitude:v}){t={latitude:g,longitude:v};let y=new dM.LatLng(g,v);h.setLatLng(y)}function m({latitude:g=0,longitude:v=0}={}){if(g&&v)return t={latitude:+g,longitude:+v},p.setView([+g,+v],16),!0;t={latitude:0,longitude:0},p.fitWorld()}}function yKe({successElement:t,mapElementId:e,coords:i,zoom:n}){let r=gKe();if(!(r!=null&&r.onLine))return{};if(n=n===void 0?16:n,i.latitude!==void 0&&i.longitude!==void 0)return t&&(t.style.display="inline"),o(i.latitude,i.longitude,n);return{};function o(a,s,l){if(isNaN(a)||isNaN(s))return{};let c=ar.locations.map_view||"map",u=dM.tileLayer(ar.leaflet[c].tileLayer,{attribution:ar.leaflet[c].attribution,maxZoom:ar.leaflet[c].maxZoom}),d=dM.map(e).fitWorld().addLayer(u);a&&s&&d.setView([+a,+s],l);let p=dM.marker([+a,+s]).addTo(d);return setTimeout(function(){d.invalidateSize()},300),{map:d,marker:p}}}function bKe(t,e){const i=e.getRow().getData(),{latitude:n,longitude:r}=(i==null?void 0:i.address)||{};vKe({coords:{latitude:n,longitude:r},callback:(a={})=>{i.address||(i.address={});const s=i.venue;s.addresses||(s.addresses=[]),s.addresses.length?Object.assign(s.addresses[0],{latitude:a.latitude,longitude:a.longitude}):s.addresses.push({latitude:a.latitude,longitude:a.longitude});const l=u=>{var d,p;if(console.log({result:u}),(p=(d=u.results)==null?void 0:d[0])!=null&&p.success){const h=e.getTable();i.address.latitude=a.latitude,i.address.longitude=a.longitude,i.hasLocation=a.latitude&&a.longitude,h.updateData([i])}},c=[{method:f3e,params:{venueId:i.venueId,modifications:{addresses:s.addresses}}}];console.log({methods:c}),xt({methods:c,callback:l})}})}function IKe(){const t=()=>console.log("Venue actions"),e=i=>i.getValue()?'<i class="fa-sharp fa-solid fa-location-dot" style="color: blue"></i>':"?";return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{headerMenu:ah({scheduledMatchUpsCount:"Scheduled matches",availableTime:"Time Available",courtsCount:"Number of courts",hasLocation:"Location"}),formatter:"rownum",headerSort:!1,hozAlign:Vt,width:55},{cellClick:Av,field:"venueAbbreviation",title:"Abbr",visible:!0,width:120},{cellClick:Av,field:"venueName",title:"Venue",visible:!0,minWidth:200,widthGrow:3},{title:'<div class="event_icon surface_header"></div>',headerTooltip:"Number of courts",headerHozAlign:Vt,field:"courtsCount",hozAlign:Vt,headerSort:!0,visible:!0,width:50},{title:"Scheduled",headerTooltip:"Scheduled matches",field:"scheduledMatchUpsCount",headerHozAlign:Vt,headerSort:!0,hozAlign:Vt,visible:!0,minWidth:120},{title:"Time",headerHozAlign:Vt,field:"availableTime",headerSort:!0,hozAlign:Vt,visible:!0,minWidth:120},{title:'<i class="fa-sharp fa-solid fa-location-dot"></i>',formatter:e,headerTooltip:"Location",headerHozAlign:Vt,cellClick:bKe,field:"hasLocation",headerSort:!1,hozAlign:Vt,visible:!0,width:50},{cellClick:Av,formatter:G4,responsive:!1,headerSort:!1,hozAlign:Ut,field:"isOpen",width:20},{cellClick:t,formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,width:50}]}function wKe({table:t}={}){const e=()=>{const{venues:r}=yg.getVenuesAndCourts();return{rows:r.map(vIe)}},i=()=>{const{rows:r}=e();t==null||t.replaceData(r)},n=IKe();if(t)i();else{rh({anchorId:nR});const r=document.getElementById(nR),{rows:o}=e();t=new bo(r,{headerSortElement:oh(["scheduledMatchUpsCount","venueAbbreviation","availableTime","courtsCount","venueName"]),minHeight:window.innerHeight*.81,rowFormatter:dKe,placeholder:"No venues",layout:"fitColumns",reactiveData:!0,index:"venueId",columns:n,data:o}),t.on("scrollVertical",Tc),t.on("cellEdited",a=>{const s=a.getColumn().getDefinition(),l=a.getRow().getData(),c=a.getValue();console.log({cell:a,row:l,value:c,def:s})})}return{table:t,replaceTableData:i}}function SKe({table:t,updateVenueRow:e,controlAnchor:i}={}){return i?Da({table:t,target:i,items:[{onClick:()=>{const o=t.getSelectedData().map(({venueId:l})=>l);xt({methods:[{method:u3e,params:{venueIds:o,force:!0}}],callback:l=>l.success&&t.deleteRow(o)})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{label:"Add venue",onClick:()=>tbe(e),location:Ut,id:"addVenue",intent:"none"}]}).elements:void 0}function TKe(){const t=document.getElementById(Az),{table:e}=wKe();SKe({table:e,controlAnchor:t,updateVenueRow:({venue:n})=>{e.updateOrAddData([vIe(n)])}})}const{POLICY_TYPE_AVOIDANCE:AZ}=rg;function yIe({eventId:t,drawId:e}){var i,n,r;return(r=(n=(i=Ye.getPolicyDefinitions({policyTypes:[AZ],eventId:t,drawId:e}))==null?void 0:i.policyDefinitions)==null?void 0:n[AZ])==null?void 0:r.policyAttributes}const M$={city:[{key:"person.addresses.city"},{key:"individualParticipants.person.addresses.city"}],state:[{key:"person.addresses.state"},{key:"individualParticipants.person.addresses.state"}],postal:[{key:"person.addresses.postalCode",significantCharacters:5},{key:"individualParticipants.person.addresses.postalCode",significantCharacters:5}],iso:[{key:"person.addresses.country"},{key:"individualParticipants.person.addresses.country"}],groups:[{directive:"groupParticipants"}],pairs:[{directive:"pairParticipants"}],teams:[{directive:"teamParticipants"}]};function UKe({event:t}){const e=yIe({eventId:t.eventId}),i=(e==null?void 0:e.map(r=>Object.keys(M$).find(o=>M$[o].some(s=>s.directive&&s.directive===r.directive||s.key&&s.key===r.key))).filter(Boolean))??[];return{items:[{text:"Select rules"},{checked:i.includes("pairs"),label:"Doubles pairs",id:"avoidancePairs",checkbox:!0,field:"pairs"},{checked:i.includes("groups"),id:"avoidanceGroups",checkbox:!0,label:"Groups",field:"groups"},{checked:i.includes("teams"),id:"avoidanceTeams",checkbox:!0,label:"Teams",field:"teams"},{checked:i.includes("iso"),id:"avoidanceCountry",label:"Country",checkbox:!0,field:"iso"},{checked:i==null?void 0:i.includes("city"),id:"avoidancedCity",checkbox:!0,label:"City",field:"city"},{checked:i.includes("state"),id:"avoidancedState",checkbox:!0,label:"State",field:"state"},{checked:i.includes("zip"),id:"avoidancedPostal",label:"Postal code",checkbox:!0,field:"zip"},{label:"Postal code digits",visible:!1,field:"zip"}]}}function bIe({eventId:t}){const e=Ye.getEvent({eventId:t}).event;if(!e)return;const{items:i}=UKe({event:e});let n;const r=!0,o=u=>n=ro(u,i),s=[{label:"Cancel",intent:ht,close:!0},{label:"Save",id:"setAvoidances",intent:"is-info",onClick:()=>{const d=Object.keys(n).filter(f=>n[f].checked).flatMap(f=>M$[f]).filter(Boolean);xt({methods:[{method:a3e,params:{policyDefinitions:{avoidance:{policyAttributes:d}},allowReplacement:!0,eventId:t}}],callback:f=>{if(f.success){const m="is-success",g=document.getElementById("editAvoidances");g&&(d.length?g.classList.add(m):g.classList.remove(m))}else vi({message:"Error",intent:"is-danger"})}})},close:r}],l="Set avoidances",c=(u,d)=>yb(u,s,d);Qe.drawer.open({title:l,content:o,footer:c,side:Ut,width:"300px"})}const{WTN:DKe,UTR:PKe}=Ca.ratingConstants,{TEAM:CKe}=Ca.eventConstants,{QUALIFYING:_Z}=yr;function iO({entry:t,derivedDrawInfo:e,participants:i,participant:n,eventType:r,eventId:o}){var g,v,y,b,I,T,S,w,U,D,E,C;n=n||(i==null?void 0:i.find(M=>M.participantId===t.participantId));const a=(g=n==null?void 0:n.draws)==null?void 0:g.filter(M=>M.eventId===o).map(M=>({...M,drawName:e[M.drawId].drawName})),s=(y=(v=n==null?void 0:n.person)==null?void 0:v.addresses)==null?void 0:y[0],l=s?`${s.city}, ${s.state}`:void 0,c=r===CKe?"AVERAGE":r,u=(T=(I=(b=n==null?void 0:n.ratings)==null?void 0:b[c])==null?void 0:I.find(M=>M.scaleName===DKe))==null?void 0:T.scaleValue,d=(U=(w=(S=n==null?void 0:n.ratings)==null?void 0:S[c])==null?void 0:w.find(M=>M.scaleName===PKe))==null?void 0:U.scaleValue,p={wtn:u,utr:d},h=t.entryStage===_Z?`${o}${_Z}`:o,f=(C=(E=(D=n==null?void 0:n.seedings)==null?void 0:D[r])==null?void 0:E.find(M=>M.scaleName===h))==null?void 0:C.scaleValue,m=Mle[t.entryStatus];return{searchText:n==null?void 0:n.participantName.toLowerCase(),participant:n,seedNumber:f,cityState:l,...t,ratings:p,flights:a,status:m}}function Zu(t){return Di.isConvertableInteger(t)&&parseInt(t)>=0}const IIe=(t,e)=>i=>Zu(i)&&i>=t&&i<=e,{ORGANISER_ACCEPTANCE:EKe,DIRECT_ACCEPTANCE:MKe,SPECIAL_EXEMPT:RKe,JUNIOR_EXEMPT:NKe,WILDCARD:AKe}=tc,{MAIN:_Ke}=yr,RN=(t=_Ke)=>[`${t}.${MKe}`,`${t}.${EKe}`,`${t}.${RKe}`,`${t}.${NKe}`,`${t}.${AKe}`],{MAIN:kZ}=yr;function R$(t,e=kZ){return t.entries.filter(({entryStage:i=kZ,entryStatus:n})=>RN(e).includes(`${i}.${n}`)).length}const{FEED_IN:kKe,LUCKY_DRAW:xKe,MAIN:OKe,QUALIFYING:LKe,ROUND_ROBIN:xZ,ROUND_ROBIN_WITH_PLAYOFF:lE}=yr;function FKe({event:t,isQualifying:e,maxQualifiers:i}){const n=e?LKe:OKe,r=({fields:p,inputs:h})=>{var T;const f=h[tm].value||0,m=Zu(f)?parseInt(f):0,g=R$(t,n),v=h.qualifiersCount.value||0,y=Zu(v)?parseInt(v):0,b=i||e&&m<g||m<g+y;b&&(h[Vs].value=Iz);const I=(T=mf(p[Vs],"help"))==null?void 0:T[0];I.style.display=b?"":ht;for(const S of h[Vs].options)S.label===Vs&&(S.disabled=b)},o=({drawType:p,fields:h,inputs:f})=>{const m=i?f[tm].value:R$(t,n),g=f.qualifiersCount.value||1,v=Zu(g)&&parseInt(g)||i?1:0,y=e&&!i?m:parseInt(m)+v,b=(i||[xKe,kKe,xZ,lE].includes(p))&&y||Di.nextPowerOf2(y);return f[tm].value=b,r({fields:h,inputs:f}),b},a=({fields:p,inputs:h})=>{let f=parseInt(h[tm].value);const m=h.qualifiersCount.value;Zu(m)&&parseInt(m)<1&&(h.qualifiersCount.value=i?1:0);const g=document.getElementById("generateDraw");let v=h.qualifiersCount.value;if(g.disabled=!1,i&&Zu(v)&&parseInt(v)>i)h.qualifiersCount.value=i;else if(!i){const y=h[ed].value;f=o({drawType:y,fields:p,inputs:h})}v=h.qualifiersCount.value,g&&(!Zu(v)||f<=parseInt(v))&&(g.disabled=!0)},s=({e:p,fields:h,inputs:f})=>{const m=f[iT].value,g=p.target.value;i||o({drawType:g,fields:h,inputs:f}),r({fields:h,inputs:f}),h[Qb].style.display=g===lE&&m===nT?"":ht,h[iT].style.display=g===lE?"":ht;const v=[xZ,lE].includes(g);h[Qd].style.display=v?"":ht},l=({fields:p,inputs:h})=>{const f=document.getElementById("generateDraw"),m=h[tm].value||0,g=IIe(2,128)(m);f.disabled=!g;const v=Zu(m)?parseInt(m):0,{validGroupSizes:y}=Ye.getValidGroupSizes({drawSize:v,groupSizeLimit:8}),b=y.map(S=>({label:S,value:S})),I=h[Qd],T=y.includes(v)?4:y[0];Ua(I),b4(I,{options:b,value:T}),r({fields:p,inputs:h})},c=({e:p,fields:h})=>{const f=p.target.value;h[Qb].style.display=f===nT?"":ht,h[lR].style.display=f===nT?"":ht},u=({inputs:p})=>{const h=parseInt(p[Qd].value),f=p[Qb].options,m=Array.from(f).map(v=>parseInt(v.value)),g=Math.max(...m);g>h?Di.generateRange(h+1,g+1).reverse().forEach(v=>{p[Qb].remove(v-2)}):g<h&&Di.generateRange(g+1,h+1).forEach(v=>p[Qb].add(new Option(v,v)))},d=({inputs:p,name:h})=>{const f=p[h].value,m=document.getElementById("generateDraw"),g=Xl(4)(f);m.disabled=!g};return[{onInput:({inputs:p})=>d({inputs:p,name:qv}),control:qv},{onInput:({inputs:p})=>d({inputs:p,name:aU}),control:aU},{onChange:u,control:Qd},{onChange:s,control:ed},{onChange:c,control:iT},{onInput:l,control:tm},{onInput:a,control:sR}]}const{AD_HOC:BKe,COMPASS:$Ke,CURTIS:VKe,DOUBLE_ELIMINATION:jKe,FEED_IN_CHAMPIONSHIP:HKe,FEED_IN:GKe,FIRST_MATCH_LOSER_CONSOLATION:zKe,FIRST_ROUND_LOSER_CONSOLATION:WKe,LUCKY_DRAW:qKe,OLYMPIC:YKe,PLAY_OFF:KKe,ROUND_ROBIN:ZKe,ROUND_ROBIN_WITH_PLAYOFF:XKe,SINGLE_ELIMINATION:JKe}=yr;function wIe({isPlayoff:t,isQualifying:e}={}){return[{label:"Ad-hoc",value:BKe,hide:e},{label:"Compass",value:$Ke,hide:e},{label:"Curtis consolation",value:VKe,hide:e},{label:"Double elimination",value:jKe,hide:t||e},{label:"Elimination: fed consolation",value:HKe,hide:e},{label:"First match loser consolation",value:zKe,hide:e},{label:"First round loser consolation",value:WKe,hide:e},{label:"Lucky",value:qKe,hide:t||e},{label:"Olympic",value:YKe,hide:e},{label:"Playoff",value:KKe,hide:e},{label:"Round robin w/ playoff",value:XKe,hide:t||e},{label:"Round robin",value:ZKe},{label:"Single elimination",value:JKe},{label:"Staggered Entry",value:GKe,hide:t||e}]}const{POLICY_TYPE_SCORING:QKe}=rg,{MAIN:e9e}=yr,t9e={[QKe]:{requireAllPositionsAssigned:!1,stage:{[e9e]:{stageSequence:{1:{requireAllPositionsAssigned:!0}}}},defaultMatchUpFormat:"SET3-S:6/TB7",matchUpFormats:[{categoryNames:[],categoryTypes:[],description:"Best of 3 sets with 7-point tiebreak at 6-6",matchUpFormat:"SET3-S:6/TB7"},{description:"Two tiebreak sets, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB7"},{description:"Two tiebreak sets, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:6/TB7-F:TB10"},{description:"One set set to 6, 7-point tiebreak at 6-6",matchUpFormat:"SET1-S:6/TB7"},{description:"Best of 3 sets to 4",matchUpFormat:"SET3-S:4/TB7"},{description:"Two out of three sets to 4 with 5-point tiebreak at 3-3",matchUpFormat:"SET3-S:4/TB5@3"},{description:"One set to 4, 7-point tiebreak at 4-4",matchUpFormat:"SET1-S:4/TB7"},{description:"One set to 4, 5-point tiebreak at 3-3",matchUpFormat:"SET1-S:4/TB5@3"},{description:"Two sets to 4, 10-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB10"},{description:"Two sets to 4, 7-point match tiebreak at one set all",matchUpFormat:"SET3-S:4/TB7-F:TB7"},{description:"One set to 5, tiebreak to 9 at 4-4",matchUpFormat:"SET1-S:5/TB9@4"},{description:"One set to 6 with deciding game at 5-5",matchUpFormat:"SET1-S:6NOAD"},{description:"One set to 4, deciding game is played at 3-3",matchUpFormat:"SET1-S:4NOAD"},{description:"8 game pro-set with 7 point tiebreak at 8-8",matchUpFormat:"SET1-S:8/TB7"},{description:"8 game pro-set with 7 point tiebreak at 7-7",matchUpFormat:"SET1-S:8/TB7@7"},{description:"Best of 3 10-point tiebreak games",matchUpFormat:"SET3-S:TB10"},{description:"Timed 20 minute game - game based",matchUpFormat:"SET1-S:T20G"},{description:"Timed 20 minute game - point based",matchUpFormat:"SET1-S:T20P"}]}},{ROUND_ROBIN:i9e,ROUND_ROBIN_WITH_PLAYOFF:OZ,SINGLE_ELIMINATION:n9e,QUALIFYING:r9e,MAIN:LZ}=yr,{DOMINANT_DUO:o9e,TIME_TENNIS_DUAL:a9e,TIME_TENNIS_PRO_CIRCUIT:s9e}=Ca.tieFormatConstants,{POLICY_TYPE_SCORING:l9e}=rg,{TEAM:FZ}=ps,{ENTRY_PROFILE:c9e}=Ca.extensionConstants;function u9e({event:t,drawId:e,isQualifying:i,structureId:n}){var S,w,U,D,E,C;const r=i?r9e:LZ,o=((S=t.drawDefinitions)==null?void 0:S.length)||0;let a=n9e;const s=e&&((w=t.drawDefinitions)==null?void 0:w.find(M=>M.drawId===e)),l=n&&((U=Ye.getPositionAssignments({drawId:e,structureId:n}))==null?void 0:U.positionAssignments),c=(E=(D=Ye.findExtension({element:s,name:c9e}))==null?void 0:D.extension)==null?void 0:E.value,u=n?1:0,d=!n&&((C=c==null?void 0:c[LZ])==null?void 0:C.qualifiersCount)||u,p="Qualifying",h=(l==null?void 0:l.length)||Di.nextPowerOf2(R$(t,r)),f=[{label:"Custom",value:aR}].concat(t9e[l9e].matchUpFormats.map(({matchUpFormat:M,description:N})=>({selected:M==="SET3-S:6/TB7",value:M,label:N}))),m=[{label:"Time Tennis Pro Circuit",value:s9e},{label:"Time Tennis",value:a9e},{label:"Dominant Duo",value:o9e,selected:!0},{label:"Custom",value:aR}],{validGroupSizes:g}=Ye.getValidGroupSizes({drawSize:32,groupSizeLimit:8}),v=g.map(M=>({label:M,value:M})),y=[{label:"Group winners",value:kNe},{label:"Group positions",value:Rle},{label:"Top finishers",value:nT}],b=[{label:"2",value:2},{label:"3",value:3},{label:"4",value:4}],I=[{label:Vs,value:Vs,selected:!n,disabled:!!n},{label:Iz,value:!1,selected:n}];return{items:[{error:"minimum of 4 characters",placeholder:"Display name of the structure",validator:Xl(4),label:"Structure name",value:p,field:aU,selectOnFocus:!0,hide:!i},{error:"minimum of 4 characters",placeholder:"Display name of the draw",value:`Draw ${o+1}`,validator:Xl(4),selectOnFocus:!0,hide:i,label:"Draw name",field:qv,focus:!0},{options:wIe({isQualifying:i}),label:"Draw Type",field:ed,value:a},{error:"Must be in range 2-128",validator:IIe(2,128),selectOnFocus:!0,label:"Draw size",value:h,field:tm},{visible:[i9e,OZ].includes(a),options:v,label:"Group size",field:Qd,value:4},{visible:[OZ].includes(a),options:y,label:"Playoff Type",field:iT},{label:"Advance per group",options:b,field:Qb,visible:!1},{label:"2nd playoff from remaining",field:lR,id:lR,checkbox:!0,visible:!1},{help:{text:"Automation disabled",visible:!1},options:I,label:"Creation",field:Vs,value:""},{hide:t.eventType===FZ,options:f,field:Bz,label:"Score format",value:""},{hide:t.eventType!==FZ,options:m,field:"tieFormatName",label:"Scorecard",value:""},{disabled:i&&!n,validator:Zu,field:sR,value:d,selectOnFocus:!0,label:"Qualifiers"}],structurePositionAssignments:l}}function BZ({eventId:t,drawOptions:e,callback:i}){var o;const n={scaleAccessor:"wtnRating",scaleName:"WTN"},r=Ye.generateDrawDefinition({...e,...n,ignoreStageSpace:!0});if(r.success){const a=r.drawDefinition;xt({methods:[{method:QWe,params:{eventId:t,drawDefinition:a,allowReplacement:!0}}],callback:c=>vt(i)&&i({drawDefinition:a,...c})})}else r.error&&vi({message:((o=r.error)==null?void 0:o.message)||"Error",intent:"is-warning",pauseOnHover:!0})}const{POLICY_TYPE_SEEDING:d9e}=rg,{SEPARATE:p9e}=yr,{SEEDING:h9e}=r0,SIe={[d9e]:{validSeedPositions:{ignore:!0},duplicateSeedNumbers:!0,drawSizeProgression:!0,seedingProfile:p9e,policyName:h9e,seedsCountThresholds:[{drawSize:4,minimumParticipantCount:3,seedsCount:2},{drawSize:16,minimumParticipantCount:12,seedsCount:4},{drawSize:32,minimumParticipantCount:24,seedsCount:8},{drawSize:64,minimumParticipantCount:48,seedsCount:16},{drawSize:128,minimumParticipantCount:96,seedsCount:32},{drawSize:256,minimumParticipantCount:192,seedsCount:64}]}},{AD_HOC:f9e,FEED_IN:m9e,LUCKY_DRAW:g9e,MAIN:v9e,QUALIFYING:y9e,ROUND_ROBIN:$Z,ROUND_ROBIN_WITH_PLAYOFF:VZ}=yr,{TIME_TENNIS_PRO_CIRCUIT:b9e}=Ca.tieFormatConstants,{DIRECT_ENTRY_STATUSES:jZ}=tc,{POLICY_TYPE_ROUND_NAMING:I9e}=rg;function HZ({drawName:t,matchUpFormat:e,isQualifying:i,structureId:n,callback:r,inputs:o,drawId:a,event:s}){var C,M,N,R,A,_,k,O,F;const l=o[ed].options[o[ed].selectedIndex].getAttribute("value");e=e||((C=o[Bz])==null?void 0:C.value);const c=(M=o[aU])==null?void 0:M.value,u=(N=o.tieFormatName)==null?void 0:N.value,d=(R=o[qv])==null?void 0:R.value,p=o[tm].value||0,h=parseInt(o[Qd].value),f=Di.isConvertableInteger(p)&&parseInt(p),m=[g9e,m9e,$Z,VZ].includes(l)&&f||Di.nextPowerOf2(f),g=s.entries.filter(({entryStage:B,entryStatus:$})=>B===y9e&&jZ.includes($)),v=i&&g.length?g:s.entries.filter(({entryStage:B,entryStatus:$})=>(!B||B===v9e)&&jZ.includes($)),y=m<v.length?!1:o[Vs].value===Vs,b=s.eventId,I={drawEntries:v,automated:y,eventId:b,drawId:a},T=parseInt(((A=o.advancePerGroup)==null?void 0:A.value)||0),S=(_=o[lR])==null?void 0:_.checked,w=(k=o[iT])==null?void 0:k.value;let U;if(l===VZ){const B=[];if(w===nT){const $=[Di.generateRange(1,T+1)];if(S){const V=Di.generateRange(T+1,h+1);V.length&&$.push(V)}$.forEach((V,H)=>{B.push({structureName:`Playoff ${H+1}`,finishingPositions:V})})}else w===Rle&&Di.generateRange(1,h+1).forEach($=>{B.push({structureName:`Playoff ${$}`,finishingPositions:[$]})});U={groupSize:h},B.length&&(U.playoffGroups=B)}else l===$Z?U={groupSize:h}:l===f9e&&Object.assign(I,{roundsCount:1});const D=(O=Ye.getSeedsCount({participantsCount:v==null?void 0:v.length,policyDefinitions:SIe,drawSizeProgression:!0}))==null?void 0:O.seedsCount,E=Zu(o[sR].value)&&parseInt((F=o[sR])==null?void 0:F.value)||0;if(n){const B=Ye.generateQualifyingStructure({qualifyingPositions:E,targetStructureId:n,structureOptions:U,matchUpFormat:e,structureName:c,automated:y,drawSize:m,drawType:l,drawId:a});if(B.success){const $=[{method:o3e,params:{structure:B.structure,link:B.link,eventId:b,drawId:a}}];xt({methods:$,callback:H=>{var z;return vt(r)&&r({...B,...(z=H.results)==null?void 0:z[0]})}})}return}if(i?(I.drawName=t,I.qualifyingProfiles=[{structureProfiles:[{qualifyingPositions:E,structureOptions:U,matchUpFormat:e,structureName:c,seedsCount:D,drawSize:m,drawType:l}]}]):(E&&(I.qualifiersCount=E,I.qualifyingPlaceholder=!0),Object.assign(I,{seedingScaleName:b,structureOptions:U,matchUpFormat:e,seedsCount:D,drawName:d,drawSize:m,drawType:l})),f)if(u===aR)sIe({title:"Custom scorecard",onClose:$=>{$&&(I.tieFormat=$,BZ({drawOptions:I,eventId:b,callback:r}))}});else{if(I.tieFormatName=u,u===b9e){const B={[I9e]:{namingConventions:{round:"Day"},affixes:{roundNumber:"D"},policyName:"TTPro 4 Day"}};I.policyDefinitions={...B}}BZ({drawOptions:I,eventId:b,callback:r})}else vi({message:"Invalid draw size",intent:"is-warning",pauseOnHover:!0})}function Gw({eventId:t,callback:e,drawId:i,drawName:n,structureId:r,isQualifying:o}){const a=Ye.getEvent({eventId:t}).event;if(!a)return;const{items:s,structurePositionAssignments:l}=u9e({event:a,drawId:i,isQualifying:o,structureId:r}),c=FKe({maxQualifiers:l==null?void 0:l.length,isQualifying:o,event:a});let u;const d=v=>{u=ro(v,s,c)},p=()=>o?Xl(4)(u[aU].value):Xl(4)(u[qv].value),f=[{label:"Cancel",intent:ht,close:!0},{label:"Generate",id:"generateDraw",intent:"is-primary",onClick:()=>{var v;p()?((v=u.matchUpFormat)==null?void 0:v.value)===aR?i5({callback:b=>{b&&HZ({event:a,inputs:u,callback:e,structureId:r,matchUpFormat:b,drawId:i,drawName:n,isQualifying:o})}}):HZ({event:a,inputs:u,callback:e,structureId:r,drawId:i,drawName:n,isQualifying:o}):vi({message:"Missing Draw name",intent:"is-danger"})},close:p}],m="Configure draw",g=(v,y)=>yb(v,f,y);Qe.drawer.open({title:m,content:d,footer:g,side:Ut,width:"300px"})}const{SINGLES:w9e}=ps,S9e=t=>e=>{const i=e.getColumn().getDefinition(),n=document.createElement("div");n.className="tags";const r=l=>t({...l,renderDraw:!0}),o=e.getValue(),a=e.getRow().getData(),{participantId:s}=a;return o==null||o.forEach(l=>{const c=T9e({def:i,participantId:s,flight:l,flightClick:r});n.appendChild(c)}),n};function T9e({flight:t,flightClick:e}){var n,r;const i=document.createElement("span");return vt(e)&&(i.onclick=()=>e(t)),i.className="tag event-pill",(n=t.gender)!=null&&n.toLowerCase().includes("female")?i.classList.add("is-danger"):(r=t.gender)!=null&&r.toLowerCase().includes("male")?i.classList.add("is-link"):i.classList.add("is-primary"),t.eventType===w9e&&i.classList.add("is-light"),i.innerHTML=t.drawName,i}const{MAIN:U9e,QUALIFYING:fF}=yr,{DIRECT_ACCEPTANCE:GZ}=tc;function TIe({participantIds:t,group:e,eventId:i,drawId:n,callback:r}){xt({methods:[{method:Oye,params:{autoEntryPositions:!0,participantIds:t,entryStatus:e===pc&&GZ||e===fF&&GZ||e,entryStage:e===fF?fF:U9e,eventId:i,drawId:n}}],callback:r})}const{ALTERNATE:zZ,DIRECT_ACCEPTANCE:WZ,WITHDRAWN:qZ,UNGROUPED:D9e}=tc,{QUALIFYING:YZ}=yr,P9e=(t,e,i)=>(n,r)=>{const{participant:o}=r.getRow().getData(),a=c=>()=>{const u=p=>{var h;if(p.success){const f=r.getRow(),m=c===pc?WZ:c;(h=Qe.tables[m])==null||h.addRow(f.getData()),f.delete()}else console.log({result:p})},d=[o.participantId];TIe({participantIds:d,callback:u,eventId:e,drawId:i,group:c})},s=()=>{const c=Ye.destroyPairEntry({participantIds:[o.participantId],autoEntryPositions:!0,eventId:e,drawId:i});console.log({result:c})};let l=[{onClick:a(WZ),option:"Move to accepted",action:pc},{onClick:a(YZ),option:"Move to qualifying",action:YZ},{onClick:a(zZ),option:"Move to alternates",action:zZ},{onClick:s,option:"Unpair players",action:D9e},{onClick:a(qZ),option:"Withdraw participant",action:qZ}].filter(c=>t.includes(c.action));if(l.length){const c=n.target;bl({options:l,target:c,config:{placement:Rf}})}},{WTN:C9e,UTR:E9e}=Ca.ratingConstants;function M9e({entries:t,exclude:e=[],eventId:i,drawId:n,actions:r=[],drawCreated:o}={}){const a=t.find(d=>{var p;return(p=d.ratings)==null?void 0:p.utr}),s=t.find(d=>{var p;return(p=d.ratings)==null?void 0:p.wtn}),l=t.find(d=>d.cityState),c=t.find(d=>d.seedNumber),u=t.find(d=>d.ranking);return[{cellClick:(d,p)=>p.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",visible:!o,headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{headerMenu:ah(),formatter:"rownum",headerSort:!1,hozAlign:Lt,width:55},{formatter:"responsiveCollapse",responsive:!1,headerSort:!1,hozAlign:Vt,resizable:!1,width:50},{formatter:d=>Ib()(d,void 0,"sideBySide"),field:"participant",responsive:!1,resizable:!1,minWidth:200,widthGrow:1,title:"Name"},{sorterParams:{alignEmptyValues:"bottom"},visible:!!u,resizable:!1,sorter:"number",field:"ranking",title:"Rank",width:70},{sorterParams:{alignEmptyValues:"bottom"},field:"ratings.wtn.wtnRating",visible:!!s,resizable:!1,sorter:"number",title:C9e,width:70},{sorterParams:{alignEmptyValues:"bottom"},field:"ratings.utr.utrRating",visible:!!a,resizable:!1,sorter:"number",title:E9e,width:70},{visible:!!l,title:"City/State",field:"cityState",responsive:!1,resizable:!1,minWidth:100},{editor:m$({maxValue:(t==null?void 0:t.length)||0,field:"seedNumber"}),sorterParams:{alignEmptyValues:"bottom"},visible:!!c,field:"seedNumber",hozAlign:Vt,resizable:!1,sorter:"number",editable:!1,title:"Seed",maxWidth:70},{formatter:S9e(nr),title:"Flights",responsive:!0,field:"flights",minWidth:100,widthGrow:1},{responsive:!1,resizable:!1,title:"Status",field:"status",maxWidth:80},{cellClick:P9e(r,i,n),formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,maxWidth:40}].filter(({field:d})=>Array.isArray(e)&&!(e!=null&&e.includes(d)))}function UIe(){const t=Ye.getTournament().tournamentRecord.tournamentId,e=`/${Xo}/${t}/${Xu}`;Qe.router.navigate(e)}function DIe(t,e){zx({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!1,table:e,e:t})}const{SEEDING:R9e}=r0;function PIe({scaleItemsWithParticipantIds:t,scaleBasis:e,eventId:i,callback:n}){xt({methods:[{method:S3e,params:{scaleItemsWithParticipantIds:t,removePriorValues:!0,context:{scaleAttributes:{scaleType:R9e},scaleBasis:{scaleType:e},eventId:i}}}],callback:a=>{a.success&&vt(n)&&n()}})}const{QUALIFYING:KZ}=yr,{SEEDING:N9e,MANUAL:A9e}=r0;function CIe({event:t,rows:e,callback:i}){const{eventId:n,eventType:r}=t,o=e.map(({entryStage:a,participantId:s,seedNumber:l})=>{const c=a===KZ?`${n}${KZ}`:n;return{participantId:s,scaleItems:[{scaleValue:l,scaleType:N9e,scaleName:c,eventType:r}]}});PIe({scaleItemsWithParticipantIds:o,scaleBasis:A9e,eventId:n,callback:i})}function EIe({table:t}){const e=t.getRows();let i;for(const n of e){const r=n.getData();i=r.entryStage,r.seedNumber=void 0,n.update(r)}return i}function _9e({event:t,table:e}){EIe({table:e});const i=e.getData();CIe({event:t,rows:i})}const{DIRECT_ACCEPTANCE:k9e}=tc,{QUALIFYING:ZZ}=yr,XZ=t=>e=>{const i=t==null?void 0:t.eventId;return{class:"cancelManualSeeding",intent:"is-warning",location:Ut,label:"Cancel",visible:!1,onClick:r=>{var f,m;DIe(r,e);const o=EIe({table:e}),a=(f=Ye.getEvent({eventId:i}))==null?void 0:f.event,l=((m=a.entries)==null?void 0:m.filter(g=>g.entryStage===o&&g.entryStatus===k9e)).map(({participantId:g})=>g),{participants:c}=Ye.getParticipants({participantFilters:{participantIds:l},withScaleValues:!0}),u=o===ZZ?`${i}${ZZ}`:i,d=c.map(g=>{var y,b,I;const v=(I=(b=(y=g==null?void 0:g.seedings)==null?void 0:y[a.eventType])==null?void 0:b.find(T=>T.scaleName===u))==null?void 0:I.scaleValue;if(v)return{participantId:g.participantId,seedNumber:v}}).filter(Boolean),p=Object.assign({},...d.map(g=>({[g.participantId]:g}))),h=e.getRows();for(const g of h){const v=g.getData(),y=v.participantId;p[y]&&(v.seedNumber=p[y].seedNumber,g.update(v))}}}};function x9e(t,e){zx({classNames:["saveSeeding","cancelManualSeeding"],columns:["seedNumber"],visible:!0,table:e,e:t})}const{QUALIFYING:cE,MAIN:O9e}=yr,{SEEDING:L9e,RATING:F9e}=r0,RS={high:[80,100],medium:[60,80],low:[40,60]};function B9e({event:t,group:e,table:i,field:n}){const{eventId:r,eventType:o}=t,{seedsCount:a,stageEntries:s}=Ye.getEntriesAndSeedsCount({stage:e===cE?cE:O9e,policyDefinitions:SIe,eventId:r}),c=n==="ratings.wtn.wtnRating"&&((b,I)=>mF(b).wtnRating-mF(I).wtnRating),u=i.getData(),d={high:[],medium:[],low:[]};let p=0;for(const b of u){const I=mF(b);I.wtnRating&&(p+=1),I.confidence>=RS.high[0]?d.high.push(b):I.confidence>=RS.medium[0]&&I.confidence<RS.medium[1]?d.medium.push(b):I.confidence>=RS.low[0]&&I.confidence<RS.low[1]&&d.low.push(b)}const f=(vt(c)&&[].concat(d.high.sort(c),d.medium.sort(c),d.low.sort(c))).slice(0,Math.min(p,a)),m=e===cE?`${r}${cE}`:r,g={scaleType:L9e,scaleName:m,eventType:o},{scaleItemsWithParticipantIds:v}=Ye.generateSeedingScaleItems({scaleAttributes:g,scaledEntries:f,stageEntries:s,seedsCount:a,scaleName:m});PIe({scaleItemsWithParticipantIds:v,scaleBasis:F9e,eventId:r,callback:()=>{const b=Object.assign({},...f.map((T,S)=>({[T.participantId]:S+1}))),I=i.getRows();for(const T of I){const S=T.getData(),w=b[S.participantId];w&&(S.seedNumber=w,T.update(S))}}})}function mF(t){var e;return((e=t.ratings)==null?void 0:e.wtn)||{confidence:0,wtnRating:1/0}}const JZ=(t,e)=>i=>{const n={ranking:"Seed by ranking","ratings.wtn.wtnRating":"Seed by WTN"},r=i.getColumns().map(a=>a.getDefinition()).filter(a=>["ranking","ratings.wtn.wtnRating"].includes(a.field)),o=[{label:"Manual seeding",onClick:a=>x9e(a,i),close:!0},{label:"Clear seeding",onClick:()=>_9e({event:t,table:i}),close:!0}].concat(...r.map(a=>({onClick:()=>B9e({event:t,group:e,table:i,field:a.field}),label:n[a.field],value:a.field,close:!0})));return{class:"seedingOptions",label:"Seeding",selection:!1,location:Ut,align:Ut,options:o}},$9e=(t,e,i,n)=>{const o=t.getSelectedData().filter(u=>{var d;return!((d=u.events)!=null&&d.length)}).map(({participantId:u})=>u),[a,s]=e.split(".");xt({methods:[{method:Oye,params:{ignoreAssignment:!0,participantIds:o,entryStatus:s,entryStage:a,eventId:i,drawId:n}}],callback:u=>{if(t.deselectRow(),u.success){const d=t.getRows();for(const p of d){const h=p.getData();o.includes(h.participantId)&&(h.status=Mle[s],p.update(h))}}else console.log(u.error)}})},V9e=(t,e,i)=>n=>{const r=t.map(o=>({onClick:()=>$9e(n,o,e,i),label:o,value:o,close:!0}));return{location:Pr,label:"Change status",options:r}},j9e=(t,e=0)=>{const i=`${t} <span class='${vle}'>${e}</span>`;return{location:rR,text:i}},aI=({target:t,table:e,close:i})=>{var r,o,a;if(!t)return;const n=As(t,qg);if(n){const s=(r=n.getElementsByClassName("toggle"))==null?void 0:r[0],l=(o=n.getElementsByClassName(Dle))==null?void 0:o[0],c=(a=n.getElementsByClassName(Ple))==null?void 0:a[0];if(s){const u=i||s.innerHTML.charCodeAt(0)===9660;l.style.display=u?ht:nw,c.style.display=u?ht:nw,s.parentNode.innerHTML=`<span class='toggle' style='color: white'>${u?Yye:H4}</span>`,u||e.redraw(!0)}}},H9e=t=>{const e=i=>aI({target:i.target,table:t});return{headerClick:e,text:`<span class='toggle' style='color: white'>${H4}</span>`,location:rR,onClick:e}},NS=({heading:t,count:e})=>[j9e(t,e),i=>H9e(i)],G9e=(t,e,i)=>(n,r="Search participants")=>{let o,a;const s=l=>{var u;const c=e&&hy(n.element,"tableClass");if(c){const d=(u=mf(c,"controlBar"))==null?void 0:u[0];if(d){const p=mf(d,"search");Array.from(p).forEach(h=>h.value=l)}}o=e&&n.getSelectedData().map(d=>d[e]),n.removeFilter(a),a=d=>{var p;return((p=d.searchText)==null?void 0:p.includes(l==null?void 0:l.toLowerCase()))||(o==null?void 0:o.length)&&o.includes(d[e])},l&&n.addFilter(a)};return{onKeyDown:l=>{l.keyCode===8&&l.target.value.length===1&&s(""),(l.key==="Enter"||l.keyCode===13)&&vt(i)&&i(n)&&s("")},onChange:l=>s(l.target.value),onKeyUp:l=>s(l.target.value),location:t||Lt,class:"search",search:!0,placeholder:r}},QZ=t=>e=>({label:"Save seeding",class:"saveSeeding",intent:"is-info",location:Ut,visible:!1,onClick:n=>{DIe(n,e);const r=e.getData();CIe({event:t,rows:r})}}),{UNGROUPED:eX}=tc,{DOUBLES:z9e}=ps,W9e=(t,e)=>i=>{const n=r=>{const o=r.getSelectedData(),a=o.filter(c=>{var u;return!((u=c.events)!=null&&u.length)}).map(({participantId:c})=>c);xt({methods:[{method:d3e,params:{removeGroupParticipant:!0,participantIds:a,eventId:t,drawId:e}}],callback:c=>{var u;if(c!=null&&c.error)r.deselectRow();else{r.deleteRow(a);const p=(u=hy(r.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:u[0];p&&setTimeout(()=>R4({table:r,target:p})(),100);const h=o.flatMap(({participant:g})=>g==null?void 0:g.individualParticipantIds),{participants:f}=Ye.getParticipants({participantFilters:{participantIds:h}}),m=f.map(g=>iO({entry:{participantId:g.participantId,entryStatus:eX},eventType:z9e,participant:g}));Qe.tables[eX].updateOrAddData(m)}}})};return{onClick:()=>n(i),label:"Destroy pairs",intent:"is-danger",location:Pr}},q9e=(t,e)=>{const n=t.getSelectedData().map(({participantId:s})=>s),r=e.entries.filter(({participantId:s})=>n.includes(s)),o=[{method:JWe,params:{eventId:e.eventId,drawName:"Flight",drawEntries:r}}];xt({methods:o,callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},Y9e=(t,e)=>i=>({onClick:()=>q9e(i,t),label:"Add flight",location:Pr,hide:e}),K9e=(t,e,i,n)=>{const o=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);TIe({participantIds:o,group:e,eventId:i,drawId:n,callback:s=>{if(s!=null&&s.success){const c=t.getData().filter(({participantId:u})=>o.includes(u));Qe.tables[e].updateOrAddData(c),t.deleteRow(o)}else t.deselectRow()}})},uE=(t,e,i)=>n=>{const r=t.map(o=>({onClick:()=>K9e(n,o,e,i),stateChange:!0,label:o,value:o,close:!0}));return{label:"Move participants",location:Pr,options:r}},{ASSIGN_PARTICIPANT:Z9e}=$y,gF=(t,e)=>i=>({label:"Add entries",class:"addEntries",location:Ut,onClick:()=>{const{entries:r=[],eventId:o,eventType:a}=t,s=(r||[]).map(({participantId:p})=>p),l=t.eventType==="TEAM"&&"TEAM"||t.eventType==="DOUBLES"&&"PAIR"||"INDIVIDUAL",c=Ye.getParticipants({inContext:!0,participantFilters:{participantTypes:[l]},withISO2:!0}).participants.filter(p=>!s.includes(p.participantId));QC({title:"Select participants to add",activeOnEnter:!0,selectionLimit:99,onSelection:({selected:p})=>{if(!(p!=null&&p.length))return;const h=p.map(({participantId:y})=>y),f=e===RP?"QUALIFYING":"MAIN",m="DIRECT_ACCEPTANCE";xt({methods:[{params:{eventId:o,participantIds:h,entryStatus:m,entryStage:f},method:$4}],callback:y=>{if(y.success){const{participants:b,derivedDrawInfo:I}=Ye.getParticipants({participantFilters:{participantIds:h},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0}),T=h.map(S=>iO({entry:{participantId:S,entryStage:f,entryStatus:m},derivedDrawInfo:I,participants:b,eventType:a,eventId:o}));i.addRow(T)}}})},action:{type:Z9e,participantsAvailable:c}})}}),{ALTERNATE:vF,UNGROUPED:X9e}=tc,{MAIN:J9e}=yr,{DOUBLES:tX}=ps,Q9e=(t,e=!0)=>{const{eventId:i,eventType:n}=t,r=(s,l)=>{const c=l.getSelectedData().map(p=>p.participantId);if(c.length!==2)return;const u=[{method:i3e,params:{participantIdPairs:[c],entryStatus:vF,entryStage:J9e,eventId:i}}];xt({methods:u,callback:p=>{var h,f;if(p.success){l.deleteRow(c),l.clearFilter();const m=hy(l.element,"tableClass");if(m){const y=(h=mf(m,"controlBar"))==null?void 0:h[0];if(y){const b=mf(y,"search");Array.from(b).forEach(I=>I.value="")}}const g=p.results[0].newParticipantIds,{participants:[v]}=Ye.getParticipants({participantFilters:{participantIds:g},withISO2:!0});if(v){const y=iO({entry:{participantId:v.participantId,entryStatus:vF},eventType:tX,participant:v});Qe.tables[vF].updateOrAddData([y]),a();const I=(f=hy(s.target,"tableClass").getElementsByClassName("controlBar"))==null?void 0:f[0];I&&setTimeout(()=>R4({table:l,target:I})(),100)}else console.log("participant not found",{participantIds:g,methods:u,result:p})}else console.log({methods:u,result:p})}})},o={hide:n!==tX,label:"Create pair",onClick:r,intent:"is-info",location:Pr,id:"create-pair",visible:!1},a=s=>{const l=(s==null?void 0:s.length)===2;if(l&&e){const c=Qe.tables[X9e];r({target:c.element},c)}else{const c=document.getElementById("create-pair");c&&(c.style.display=l?"":ht)}};return{createPairButton:o,createPairFromSelected:a}},{DIRECT_ACCEPTANCE:eZe}=tc,{MAIN:tZe}=yr,iZe=(t,e,i)=>{const r=t.getSelectedData().filter(s=>{var l;return!((l=s.events)!=null&&l.length)}).map(({participantId:s})=>s);xt({methods:[{method:e3e,params:{entryStatus:eZe,ignoreStageSpace:!0,entryStage:tZe,participantIds:r,eventId:e,drawId:i}}],callback:s=>{s.success?t.deselectRow():console.log(s.error)}})},nZe=(t,e)=>i=>{var r;const n=(t.drawDefinitions||[]).filter(Boolean).map(({drawName:o,drawId:a})=>({onClick:()=>iZe(i,t.eventId,a),stateChange:!0,label:o,value:a,close:!0}));return{hide:!((r=t.drawDefinitions)!=null&&r.length)||e,label:"Add to draw",location:Pr,options:n}},{DIRECT_ACCEPTANCE:rZe,ALTERNATE:jd,UNGROUPED:iX,WITHDRAWN:Hd}=tc,{MAIN:Yb,QUALIFYING:Yf}=yr,{SINGLES:oZe,DOUBLES:nX}=ps;function aZe({drawDefinition:t,event:e,entryData:i,hasFlights:n}){const r=v=>i.filter(({entryStage:y=Yb,entryStatus:b})=>v.includes(`${y}.${b}`)),o=!!t,a=t==null?void 0:t.drawId,s=e==null?void 0:e.eventId,l={[pc]:[jd,Hd],[Yf]:[pc,jd,Hd],[jd]:[pc,Yf,Hd],[Hd]:[jd]},{createPairFromSelected:c}=Q9e(e),u=n?[]:["flights"],d=v=>{const y=v.getData("active"),b=y.map(({participantId:I})=>I);if(y.length===1)return v.selectRow(b),!0;y.length===2&&v.selectRow(b)},p=r(RN(Yb)),h=r([`${Yf}.${rZe}`]),f=r([`${Yb}.${jd}`]),m=r([`${Yb}.${iX}`]),g=r([`${Yb}.${Hd}`]);return[{placeholder:"No accepted participants",items:[uE(l[pc],s,a),V9e(RN(Yb),s,a),nZe(e,a),Y9e(e,a),...NS({heading:"Accepted",count:p.length}),!o&&JZ(e,pc),XZ(e),QZ(e),!o&&gF(e,pc)],actions:l[pc],anchorId:Tz,entries:p,group:pc,excludeColumns:u,drawCreated:o,togglePanel:aI},{placeholder:"No qualifying participants",items:[...NS({heading:"Qualifying",count:h.length}),uE(l[Yf],s,a),!o&&JZ(e,Yf),XZ(e),QZ(e),!o&&gF(e,Yf)],actions:[pc,jd,Hd],anchorId:Dz,entries:h,group:Yf,excludeColumns:u,drawCreated:o,togglePanel:aI},{items:[...NS({heading:"Alternates",count:f.length}),uE(l[jd],s,a),(e==null?void 0:e.eventType)===nX&&W9e(s,a),!o&&gF(e,jd)],actions:[pc,Yf,Hd],excludeColumns:["seedNumber","flights"],placeholder:"No alternates",anchorId:Uz,entries:f,group:jd,drawCreated:o,togglePanel:aI},{hide:!!([oZe].includes(e==null?void 0:e.eventType)||o),items:[...NS({heading:"Ungrouped",count:m.length}),G9e(Lt,"participantId",d)],placeholder:"No ungrouped participants",excludeColumns:["seedNumber","flights"],onSelection:(e==null?void 0:e.eventType)===nX&&c,anchorId:Pz,entries:m,actions:[Hd],group:iX,drawCreated:o,togglePanel:aI},{items:[...NS({heading:"Withdrawn",count:g.length}),!o&&uE(l[Hd],s,a)],placeholder:"No withdrawn participants",excludeColumns:["seedNumber","flights"],anchorId:Cz,entries:g,actions:[jd],hide:o,group:Hd,collapsed:!0,drawCreated:o,togglePanel:aI}]}function rX({eventId:t,drawId:e,headerElement:i}){var l,c,u,d,p;(!t||t==="undefined")&&Qe.router.navigate("/");let n;const r=h=>{n&&Object.values(Qe.tables).forEach(m=>m.removeFilter(n));const f=h==null?void 0:h.toLowerCase();n=m=>{var g;return(g=m.searchText)==null?void 0:g.includes(f)},h?Object.values(Qe.tables).forEach(m=>m.addFilter(n)):n=void 0},o=()=>{var I;const{event:h,drawDefinition:f}=Ye.getEvent({eventId:t,drawId:e});if(i.innerHTML=h==null?void 0:h.eventName,!h)return{error:"EVENT_NOT_FOUND"};const{participants:m,derivedDrawInfo:g}=Ye.getParticipants({participantFilters:{eventIds:[t]},withIndividualParticipants:!0,withScaleValues:!0,withDraws:!0,withISO2:!0})??{},v=((I=h==null?void 0:h.drawDefinitions)==null?void 0:I.length)>1,y=((f==null?void 0:f.entries)||(h==null?void 0:h.entries)||[]).map(T=>iO({entry:T,derivedDrawInfo:g,participants:m,eventType:h.eventType,eventId:t})),{events:b}=Ye.getEvents();return{tableData:aZe({event:h,drawDefinition:f,participants:m,entryData:y,hasFlights:v}),events:b,event:h}},a=h=>{for(const f of h){const{entries:m,group:g,anchorId:v,placeholder:y,excludeColumns:b,actions:I,drawCreated:T}=f,S=document.getElementById(v);if(S){S.style.display=f.hide?ht:nw,Ua(S);const w=document.createElement("div");w.className=`${ANe} flexcol flexcenter`,S.appendChild(w);const U=document.createElement("div");U.className=`${Ple} flexcol flexcenter`,S.appendChild(U);const D=new bo(U,{headerSortElement:oh(["ratings.utr.utrRating","ratings.wtn.wtnRating","seedNumber","ranking","cityState","status","flights"]),columns:M9e({actions:I,exclude:b,entries:m,eventId:t,drawId:e,drawCreated:T}),responsiveLayout:"collapse",index:"participantId",layout:"fitColumns",reactiveData:!0,height:"400px",data:m,placeholder:y});Qe.tables[g]=D;const E=As(S,qg);D.on("tableBuilt",()=>{var M;const C=(M=f.items)==null?void 0:M.map(N=>vt(N)?N(D):N);Da({target:w,table:D,items:C,onSelection:f.onSelection}),!m.length&&f.togglePanel&&f.togglePanel({target:E,table:D,close:!0})}),D.on("dataChanged",()=>{var A,_;const N=(_=((A=hy(D.element,"tableClass").getElementsByClassName("controlBar"))==null?void 0:A[0]).getElementsByClassName(vle))==null?void 0:_[0],R=D.getData().length;f.togglePanel&&!R&&f.togglePanel({target:E,table:D,close:!0}),N&&(N.innerHTML=R||0)})}}},s=o();if(!s.error){const h="All entries",f=document.getElementById(NP),m={label:h,onClick:()=>nr({eventId:t}),close:!0},g=(s.event.drawDefinitions||[]).map(E=>({onClick:()=>nr({eventId:t,drawId:E.drawId}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},m]),v={label:zv,onClick:UIe,close:!0},y=s.events.map(E=>({onClick:()=>nr({eventId:E.eventId}),label:E.eventName,close:!0})).concat([{divider:!0},v]),b=E=>{var C;E.success&&nr({eventId:t,drawId:(C=E.drawDefinition)==null?void 0:C.drawId,renderDraw:!0})},I={label:"<div style='font-weight: bold'>Add draw</div>",onClick:()=>Gw({eventId:t,callback:b})},T=(l=s.event.drawDefinitions)==null?void 0:l.map(E=>({onClick:()=>nr({eventId:t,drawId:E==null?void 0:E.drawId,renderDraw:!0}),label:E==null?void 0:E.drawName,close:!0})).concat([{divider:!0},I]),S=(d=(u=(c=s.event)==null?void 0:c.drawDefinitions)==null?void 0:u.find(E=>(E==null?void 0:E.drawId)===e))==null?void 0:d.drawName,w=({eventId:E})=>{console.log("generateFlights",{eventId:E})},U=(p=yIe({eventId:t}))!=null&&p.length?"is-success":ht,D=[{onKeyDown:E=>E.keyCode===8&&E.target.value.length===1&&r(""),onChange:E=>r(E.target.value),onKeyUp:E=>r(E.target.value),clearSearch:()=>r(""),placeholder:"Search entries",location:Lt,search:!0},{label:s.event.eventName,options:y.length>1&&y,location:Lt},{label:S||h,options:g,location:Lt},{onClick:()=>nr({eventId:t,drawId:e,renderDraw:!0}),label:"View draw",intent:"is-info",location:Ut,hide:!e},{onClick:()=>bIe({eventId:t}),intent:U,id:"editAvoidances",label:"Avoidances",location:Ut},{onClick:()=>w({eventId:t,callback:()=>{}}),label:"Flights",location:Ut,hide:e,intent:ht},{options:(T==null?void 0:T.length)>2&&T,hide:((T==null?void 0:T.length)||0)<3||e,intent:"is-info",location:Ut,label:"Draws",align:Ut},{onClick:()=>Gw({eventId:t,callback:b}),hide:(T==null?void 0:T.length)>2||e,intent:"is-info",label:"Add draw",location:Ut}];Da({target:f,items:D}),a(s.tableData)}}function sZe({drawId:t,callback:e}){var c,u;const i=(u=(c=Ye.getEvent({drawId:t}))==null?void 0:c.drawDefinition)==null?void 0:u.structures;if(!(i!=null&&i.length))return;const n=i.map(({structureName:d,structureId:p})=>({text:`${d}:`,fieldPair:{error:"minimum 4 characters",validator:Xl(4),placeholder:d,field:p,id:p}}));let r;const o=()=>{const d=i.map(({structureId:f})=>{var m;return((m=r[f])==null?void 0:m.value)&&{structureId:f,structureName:r[f].value.trim()}}).filter(Boolean);xt({methods:[{params:{drawId:t,structureDetails:d},method:b3e}],callback:f=>{f.success&&(vi({message:"Structure renamed",intent:"is-success"}),vt(e)&&e())}})},a=()=>{const d=i.map(({structureId:m})=>{var g;return(g=r[m])==null?void 0:g.value}).filter(Boolean),p=d.every(Xl(4)),h=document.getElementById("renameStructures"),f=d.length&&p;h&&(h.disabled=!f)},s=i.map(({structureId:d})=>({control:d,onInput:a}));lr({title:"Edit structure names",content:d=>r=ro(d,n,s),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Rename",id:"renameStructures",disabled:!0,intent:"is-info",close:!0,onClick:o}]})}const{ROUND_ROBIN:oX,SINGLE_ELIMINATION:lZe}=yr;function cZe({callback:t,drawId:e,structureId:i,playoffFinishingPositionRanges:n}){const r=w=>`finishingPosition-${w}`,o=n.map(({finishingPosition:w,finishingPositionRange:U})=>({field:r(w),id:r(w),label:w,checkbox:!0,fieldPair:{text:`Creates playoff for positions ${U}`,width:"400px"}}));if(!o||o.length<1){vi({message:"No playoff positions available",intent:"is-danger"});return}const a={value:oR,label:"Playoff name",field:"structureName",id:"structureName"},s=wIe({isPlayoff:!0}),l={value:lZe,options:s,label:"Draw type",field:ed,id:ed},{validGroupSizes:c}=Ye.getValidGroupSizes({drawSize:4,groupSizeLimit:8}),d={options:c.map(w=>({label:w,value:w})),label:"Group size",field:Qd,visible:!1,value:4},p="Positions to be played off:",h={text:`${p} None`,id:"selectedPlayoffRange"},m=[a,l,d,h,{text:"Select group finishing positions. Selections must be sequential"}].concat(o);let g;const v=()=>{const U=n.filter(({finishingPosition:R})=>{var A;return(A=g[r(R)])==null?void 0:A.checked}).map(({finishingPosition:R})=>R),D=g.structureName.value,E=g[ed].value,C={finishingPositions:U,structureName:D,drawType:E};if(E===oX){const R=parseInt(g[Qd].value);C.structureOptions={groupSize:R}}xt({methods:[{params:{drawId:e,structureId:i,playoffGroups:[C],playoffStructureNameBase:oR},method:Aye}],callback:R=>{var A;R.success?(vi({message:"Structure added",intent:"is-success"}),vt(t)&&t()):(console.log({result:R}),vi({message:((A=R.error)==null?void 0:A.message)||"Error",intent:"is-danger"}))}})},y=w=>`${Math.min(...w)}-${Math.max(...w)}`,b=()=>{const w=n.filter(({finishingPosition:F})=>{var B;return(B=g[r(F)])==null?void 0:B.checked}).map(({finishingPositions:F})=>F).flat(),U=n.map(({finishingPosition:F})=>g[r(F)].checked),D=n.map(({finishingPosition:F})=>g[r(F)].checked&&F).filter(Boolean),E=D.map((F,B)=>(D[B+1]||F)-F).every(F=>F<2),C=U.filter(Boolean).length,M=document.getElementById("addStructure"),N=C&&E;M&&(M.disabled=!N);const R=document.getElementById("selectedPlayoffRange");if(R){const F=N?y(w):"None";R.innerHTML=`${p} ${F}`}const{validGroupSizes:A}=Ye.getValidGroupSizes({drawSize:(w==null?void 0:w.length)||4,groupSizeLimit:8}),_=A.map(F=>({label:F,value:F})),k=g[Qd],O=A.includes(4)?4:A[0];Ua(k),b4(k,{options:_,value:O})},I=({e:w,fields:U})=>{const D=w.target.value,E=[oX].includes(D);U[Qd].style.display=E?"":ht},T=n.map(({finishingPosition:w})=>({control:r(w),onChange:b})).concat([{onChange:I,control:ed}]);lr({title:"Add playoff structure",content:w=>g=ro(w,m,T),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Add",id:"addStructure",intent:"is-info",disabled:!0,close:!0,onClick:v}]})}function uZe({drawId:t,structureId:e,callback:i}){var f,m;const n=Ye.getAvailablePlayoffProfiles({drawId:t,structureId:e}),r=g=>g.finishingPositions.reduce((v,y)=>(v||0)+(y||0));if(!n.playoffRoundsRanges&&((f=n.finishingPositionsAvailable)!=null&&f.length))return cZe({...n,drawId:t,structureId:e,callback:i});const o=(m=n.playoffRoundsRanges)==null?void 0:m.sort((g,v)=>r(g)-r(v)).map(({finishingPositionRange:g})=>({label:g,field:g,id:g,checkbox:!0,fieldPair:{field:`${g}-name`,placeholder:`${oR} ${g}`,id:`${g}-name`,width:"350px"}}));if(!o||o.length<1){vi({message:"No playoff positions available",intent:"is-danger"});return}const a=g=>{o.forEach(({label:v,fieldPair:y})=>{const b=document.getElementById(y.id);b&&(b.placeholder=`${g} ${v}`)})},l=[{onChange:g=>a(g.target.value),onKeyDown:g=>g.key==="Tab"&&a(g.target.value),value:oR,label:"Name base",field:"nameBase",id:"nameBase"}].concat(o);let c;const u=()=>{const g=n.playoffRoundsRanges.filter(S=>{var w;return(w=c[S.finishingPositionRange])==null?void 0:w.checked}),v=c.nameBase.value,y={},b=g.map(({roundNumber:S,finishingPositionRange:w})=>{var D;const U=(D=c[`${w}-name`])==null?void 0:D.value;return U&&(y[`0-${S}`]={name:U}),{[S]:1}});xt({methods:[{params:{drawId:t,structureId:e,playoffAttributes:y,roundProfiles:b,playoffStructureNameBase:v},method:Aye}],callback:S=>{var w;S.success?(vi({message:"Structure(s) added",intent:"is-success"}),vt(i)&&i()):vi({message:((w=S.error)==null?void 0:w.message)||"Error",intent:"is-danger"})}})},d=()=>{const g=n.playoffRoundsRanges.filter(y=>{var b;return(b=c[y.finishingPositionRange])==null?void 0:b.checked}),v=document.getElementById("addStructure");v&&(v.disabled=!g.length)},p=n.playoffRoundsRanges.map(({finishingPositionRange:g})=>({control:g,onChange:d}));lr({title:"Add playoff structures",content:g=>c=ro(g,l,p),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Add",id:"addStructure",disabled:!0,intent:"is-info",close:!0,onClick:u}]})}const{FINISHING_POSITIONS:dZe}=yr;function pZe({drawData:t,eventId:e,structureId:i,updateControlBar:n}){var l,c,u;const r=t.drawId,o=(c=(l=Ye.getAvailablePlayoffProfiles({drawId:r,structureId:i}))==null?void 0:l.playoffRounds)==null?void 0:c.length,a=(u=Ye.isValidForQualifying({drawId:r,structureId:i}))==null?void 0:u.valid,s=()=>{Gw({callback:d=>{if(d.success){const p=d.structure.structureId;nr({eventId:e,drawId:r,structureId:p,renderDraw:!0})}},drawName:"Qualifying",isQualifying:!0,structureId:i,eventId:e,drawId:r})};return t.structures.sort((d,p)=>Di.structureSort(d,p,{mode:dZe})).map(d=>({onClick:()=>{nr({eventId:e,drawId:r,structureId:d.structureId,renderDraw:!0})},label:d.structureName,close:!0})).concat([{divider:!0},{onClick:()=>sZe({drawId:r,callback:()=>n(!0)}),label:"Edit structure names",modifyLabel:!1,close:!0},{onClick:()=>s(),hide:!a,label:"Add qualifying",modifyLabel:!1,close:!0},{onClick:()=>uZe({drawId:r,structureId:i,callback:()=>n(!0)}),hide:!o,label:"Add playoffs",modifyLabel:!1,close:!0}])}const NN=(t,e)=>i=>{const n=(i||"").trim().split(" ").length;return n>=t&&(!e||e&&n<=e)};function MIe({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let o;const a=()=>{const p={auditReason:o.drawDeletionReason.value},h=e.map(m=>({params:{eventId:i,drawId:m,auditData:p,force:!0},method:xye}));xt({methods:h,callback:m=>m.success&&nr({eventId:i})})},s=[{text:"Please provide a reason for draw deletion."},{placeholder:"Explanation",field:"drawDeletionReason",validator:NN(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],c=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const h=p.drawDeletionReason.value,f=NN(5)(h),m=document.getElementById("deleteDraw");m&&(m.disabled=!f)}}];lr({title:r,content:p=>o=ro(p,s,c),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}function hZe({eventData:t,drawIds:e}){var d;const i=t.eventInfo.eventId,n=e.length===1&&((d=t==null?void 0:t.drawsData)==null?void 0:d.find(p=>e.includes(p.drawId)).drawName),r=n?`Delete ${n}`:"Delete flights";let o;const a=()=>{const p={auditReason:o.drawDeletionReason.value},h=e.map(m=>({params:{eventId:i,drawId:m,auditData:p},method:I3e}));xt({methods:h,callback:m=>m.success&&nr({eventId:i,drawId:e[0]})})},s=[{text:"Please provide a reason for resetting draws."},{placeholder:"Explanation",field:"drawDeletionReason",validator:NN(5),error:"Five word minimum",autocomplete:"on",focus:!0},{text:"This action cannot be undone!"}],c=[{control:"drawDeletionReason",onInput:({inputs:p})=>{const h=p.drawDeletionReason.value,f=NN(5)(h),m=document.getElementById("deleteDraw");m&&(m.disabled=!f)}}];lr({title:r,content:p=>o=ro(p,s,c),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Delete",id:"deleteDraw",disabled:!0,intent:"is-danger",close:!0,onClick:a}]})}function fZe({structureId:t,drawId:e}){const i=Ye.getMatchUpFormat({drawId:e,structureId:t}).matchUpFormat;i5({callback:r=>{r&&(r===i?vi({message:"No changes",intent:"is-warning"}):xt({methods:[{params:{matchUpFormat:r,structureId:t,drawId:e},method:w3e}],callback:s=>s.success&&vi({message:"Scoring changed"})}))},existingMatchUpFormat:i})}function mZe({drawId:t,eventId:e,structureId:i}){const n=[{params:{drawId:t,structureId:i,force:!0},method:y3e}],r=l=>{var c;l.success?nr({eventId:e,drawId:t,renderDraw:!0}):vi({message:((c=l.error)==null?void 0:c.message)||"Error",intent:"is-danger "})};lr({title:"Remove structure",buttons:[{intent:"is-danger",onClick:()=>xt({methods:n,callback:r}),label:"Remove",close:!0},{label:"Cancel"}],content:"<div style='font-size: 2em'>Structure will be removed!</div>"})}const{TEAM:aX}=ps;function gZe({eventData:t,drawData:e,drawId:i,structureId:n,structureName:r,dualMatchUp:o}){var u,d;const a=(u=e.structures)==null?void 0:u.find(p=>p.stage===RP),s=(d=e.structures)==null?void 0:d.find(p=>p.structureId===n),l=t.eventInfo.eventId,c=[{hide:t.eventInfo.eventType!==aX,onClick:()=>lIe({structureId:n,eventId:l,drawId:i}),label:"Edit scorecard",close:!0},{hide:t.eventInfo.eventType===aX,onClick:()=>fZe({structureId:n,eventId:l,drawId:i}),label:`Edit ${r} scoring`,close:!0},{hide:(s==null?void 0:s.stage)==="MAIN"&&s.stageSequence===1&&!a,onClick:()=>mZe({drawId:i,eventId:l,structureId:n}),label:"Remove structure",close:!0},{onClick:()=>MIe({eventData:t,drawIds:[i]}),label:"Delete draw"},{onClick:()=>hZe({eventData:t,drawIds:[i]}),label:"Reset draw"}];if(o){const p=o.matchUpId;c.push({divider:!0});const h=y=>{var b;if(y.success){const I=(b=Ye.findMatchUp({drawId:i,matchUpId:p}))==null?void 0:b.matchUp,T=tO({matchUp:I}),S=document.getElementById(Ud);Ua(S),S.appendChild(T)}},m={label:"Remove players",onClick:()=>{var I;((I=Ye.findMatchUp({matchUpId:p,drawId:i}).matchUp.tieMatchUps)==null?void 0:I.some(Ye.checkScoreHasValue))?vi({message:"Cannot remove when scores are present",intent:"is-warning",pauseOnHover:!0}):xt({methods:[{params:{drawId:i,matchUpId:p,inheritance:!1},method:"resetMatchUpLineUps"}],callback:h})},close:!0};c.push(m);const v={label:"Clear results",onClick:()=>{xt({methods:[{params:{drawId:i,matchUpId:p},method:Lye}],callback:h})},close:!0};c.push(v)}return c}function vZe({eventData:t}){const e=t.drawsData.map(({drawId:s,drawName:l})=>({label:l,checkbox:!0,field:s,id:s}));let i;const n=()=>{const s=t.drawsData.filter(({drawId:l})=>{var c;return(c=i[l])==null?void 0:c.checked}).map(({drawId:l})=>l);setTimeout(()=>MIe({eventData:t,drawIds:s}),200)},r=()=>{const s=t.drawsData.filter(({drawId:c})=>{var u;return(u=i[c])==null?void 0:u.checked}).length,l=document.getElementById("deleteSelected");l&&(l.disabled=!s)},o=t.drawsData.map(({drawId:s})=>({onChange:r,control:s}));lr({title:"Delete flights",content:s=>i=ro(s,e,o),buttons:[{label:"Cancel",intent:ht,close:!0},{label:"Delete",id:"deleteSelected",intent:"is-danger",disabled:!0,close:!0,onClick:n}]})}function yZe({eventData:t,drawId:e}){const i=()=>{const a=s=>{var l,c;if(s.drawDefinition){const u=(c=(l=s.drawDefinition.structures)==null?void 0:l[0])==null?void 0:c.structureId,d=t.eventInfo.eventId,p=s.drawDefinition.drawId;nr({eventId:d,drawId:p,structureId:u,renderDraw:!0})}};Gw({eventId:t.eventInfo.eventId,callback:a})},n=()=>vZe({eventData:t}),r=t.drawsData.length>1&&{onClick:n,label:"Delete flights",modifyLabel:!1,close:!0},o=t.drawsData.length&&{onClick:()=>nr({eventId:t.eventInfo.eventId,drawId:e}),label:"View entries",modifyLabel:!1,close:!0};return t.drawsData.map(a=>({onClick:()=>{var u,d;const s=(d=(u=a.structures)==null?void 0:u[0])==null?void 0:d.structureId,l=t.eventInfo.eventId,c=a.drawId;nr({eventId:l,drawId:c,structureId:s,renderDraw:!0})},label:a.drawName,close:!0})).concat([{divider:!0},o,r,{label:"Add flight",modifyLabel:!1,onClick:i}]).filter(Boolean)}function bZe(){return{eventOptions:(Ye.getEvents().events??[]).map(i=>({onClick:()=>{var r,o,a,s;const n=Ye.getEventData({eventId:i.eventId});if(!((o=(r=n==null?void 0:n.eventData)==null?void 0:r.drawsData)!=null&&o.length))nr({eventId:i.eventId});else{const l=(s=(a=n.eventData.drawsData)==null?void 0:a[0])==null?void 0:s.drawId;nr({eventId:n.eventData.eventInfo.eventId,drawId:l,renderDraw:!0})}},label:i.eventName,close:!0})).concat([{divider:!0},{label:`<div style='font-weight: bold'>${zv}</div>`,onClick:UIe,close:!0}])}}const{TEAM:IZe}=ps;function RIe({updateParticipantFilter:t,updateControlBar:e,structureId:i,eventData:n,matchUps:r,eventId:o,drawId:a}){var f,m,g;const{eventOptions:s}=bZe(),l=yZe({eventData:n,drawId:a}),c=(f=n==null?void 0:n.drawsData)==null?void 0:f.find(v=>v.drawId===a),u=(g=(m=c==null?void 0:c.structures)==null?void 0:m.find(v=>v.structureId===i))==null?void 0:g.structureName,d=(r==null?void 0:r.length)===1&&n.eventInfo.eventType===IZe,p=pZe({updateControlBar:e,structureId:i,drawData:c,eventId:o}),h=gZe({dualMatchUp:d&&r[0],structureName:u,structureId:i,eventData:n,drawData:c,drawId:a});return[{onKeyDown:v=>v.keyCode===8&&v.target.value.length===1&&t(""),onChange:v=>t(v.target.value),onKeyUp:v=>t(v.target.value),clearSearch:()=>t(""),placeholder:"Participant name",location:Lt,search:!0},{options:s.length>1?s:void 0,label:n.eventInfo.eventName,modifyLabel:!0,location:Lt},{options:l.length>1?l:void 0,label:c.drawName,modifyLabel:!0,location:Lt},{options:p.length>1?p:void 0,label:u,modifyLabel:!0,location:Lt},{options:h,intent:"is-info",label:"Actions",location:Ut,align:Ut}]}function a5({eventId:t,drawId:e,structureId:i,updateDisplay:n}){var m,g;const r=Ye.getEventData({eventId:t}).eventData,o=(m=r==null?void 0:r.drawsData)==null?void 0:m.find(v=>v.drawId===e),a=(o==null?void 0:o.structures)||[];i=i||((g=a==null?void 0:a[0])==null?void 0:g.structureId);const s=a.find(v=>v.structureId===i),{roundMatchUps:l}=Di.makeDeepCopy(s||{}),c=Object.values(l||{}).flat();let u;const d=v=>{var y;return(y=v.searchText)==null?void 0:y.includes(u)},h=RIe({updateControlBar:a5,updateParticipantFilter:v=>{v||Object.values(Qe.tables).filter(Boolean).forEach(y=>y.clearFilter()),u=v==null?void 0:v.toLowerCase(),v&&Object.values(Qe.tables).filter(Boolean).forEach(y=>y.addFilter(d)),typeof n=="function"&&n({participantFilter:u})},structureId:i,eventData:r,drawData:o,matchUps:c,eventId:t,drawId:e}),f=document.getElementById(NP);Da({target:f,items:h})}function wZe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="bold",e.style.color="#ed0c76"}function SZe(t){for(const e of Array.from(document.querySelectorAll(".tmx-tm")).filter(i=>i.innerHTML===t.innerHTML))e.style.fontWeight="",e.style.color=""}const{CONTAINER:TZe}=yr;function UZe({callback:t,structure:e,existingView:i}){const n=s=>i!==s&&t({refresh:!0,view:s}),r=(e==null?void 0:e.structureType)===TZe,o=Ye.isAdHoc({structure:e}),a=[];return i!==A2&&a.push({onClick:()=>n(A2),label:o?"Columns":"Draw",close:!0}),i!==ow&&a.push({onClick:()=>n(ow),label:"Table view",close:!0}),(o||r)&&i!==rw&&a.push({onClick:()=>n(rw),label:"Statistics",close:!0}),{label:"Display",options:a,selection:!1,location:Ut,align:Ut}}function NIe({drawId:t,roundNumber:e,structure:i,structureId:n,callback:r}={}){n=n||(i==null?void 0:i.structureId);const o=Ye.allDrawMatchUps({matchUpFilters:{structureIds:[n]},drawId:t}).matchUps||[],a=o.reduce((f,m)=>{const g=m.roundNumber;return g&&!f.includes(g)&&f.push(g),f},[]);if(e=e||a.length&&a[a.length-1],!e)return;let s;const c=[{label:"Cancel",intent:"none",close:!0},{label:"Delete",intent:"is-danger",close:!0,onClick:()=>{const f=o.filter(v=>{if(v.roundNumber===e)return v.winningSide&&s.completed.checked||v.sides.some(({participantId:y})=>y)&&!v.winningSide&&s.unscored.checked?!0:v.sides.every(({participantId:y})=>!y)&&s.empties.checked}).map(({matchUpId:v})=>v),m=[{params:{removeCompleted:s.completed.checked,removeIncomplete:s.unscored.checked,removeUnassigned:s.empties.checked,structureId:n,matchUpIds:f,drawId:t},method:kye}],g=v=>{v.success?vt(r)&&r({refresh:!0}):console.log({postMutationError:v.error})};f.length&&xt({methods:m,callback:g})}}],p=[{text:"Round number",fieldPair:{options:a.map(f=>({label:f,value:f})),field:"roundNumber",value:e,id:"roundNumber"}},{spacer:!0},{label:"Remove empty (TBD) matches",intent:"is-success",checkbox:!0,field:"empties",checked:!0,id:"empties"},{label:"Remove incomplete/unscored matches",intent:"is-danger",field:"unscored",checkbox:!0,id:"unscored"},{label:"Remove completed matches",intent:"is-danger",field:"completed",id:"completed",checkbox:!0,color:"red"}];lr({title:"Delete matches",content:f=>s=ro(f,p),buttons:c})}function AIe({drawId:t,structure:e,structureId:i,roundNumber:n,callback:r}={}){i=i||(e==null?void 0:e.structureId);const o=Ye.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],a=o.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),s=Math.max(...a,1);o.length?a.push(s+1):a.length||a.push(1);let l;const u=[{label:"Cancel",intent:"none",close:!0},{label:"Add",intent:"is-success",close:!0,onClick:()=>{var S;const v=parseInt(l.roundNumber.value),y=l.matchUpsCount.value==="Auto"?void 0:parseInt(l.matchUpsCount.value),b=Ye.generateAdHocMatchUps({roundNumber:v,matchUpsCount:y,structureId:i,drawId:t});if(!((S=b.matchUps)!=null&&S.length))return;const I=[{method:Rye,params:{matchUps:b.matchUps,structureId:i,drawId:t}}];xt({methods:I,callback:w=>{w.success?vt(r)&&r({refresh:!0}):console.log(w.error)}})}}],p={text:"Round number:",fieldPair:{options:a.map(v=>({label:v,value:v})),field:"roundNumber",value:n,id:"roundNumber"}},f={text:"Number to add:",fieldPair:{options:["Auto",1,5,10].map(v=>({label:v,value:v})),field:"matchUpsCount",id:"matchUpsCount",value:"Auto"}},m=[p,{spacer:!0},f];lr({title:"Add matches",content:v=>l=ro(v,m),buttons:u})}const{ASSIGN_PARTICIPANT:DZe}=$y;function s5({drawId:t,structure:e,structureId:i,callback:n}={}){i=i||(e==null?void 0:e.structureId);let r,o;const a=Ye.allDrawMatchUps({matchUpFilters:{structureIds:[i]},drawId:t}).matchUps||[],s=a.reduce((v,y)=>{const b=y.roundNumber;return b&&!v.includes(b)&&v.push(b),v},[]),l=s[s.length-1],c=Math.max(...s,1);a.length&&s.push(c+1);const u=v=>{xt({methods:[{method:Rye,params:{structureId:i,matchUps:v,drawId:t}}],callback:I=>{I.success?vt(n)&&n({refresh:!0}):console.log(I.error)}})},d=v=>{var T;const{scaleAccessor:y,scaleName:b}=ar.scales[ar.activeScale],I=Ye.drawMatic({participantIds:v,scaleAccessor:y,scaleName:b,drawId:t});(T=I.matchUps)!=null&&T.length&&u(I.matchUps)},p=({participantIds:v})=>{const y=Ye.getParticipants({participantFilters:{participantIds:v}}).participants,b=l?a.filter(({roundNumber:w,sides:U})=>w===l&&(U==null?void 0:U.some(({participantId:D})=>D))).map(({sides:w})=>w.map(({participantId:U})=>U)).flat():[],I=b.length?b:v;QC({title:"Confirm player selection",selectedParticipantIds:I,activeOnEnter:!0,selectionLimit:99,onSelection:w=>{var D;const U=(D=w.selected)==null?void 0:D.map(({participantId:E})=>E);d(U)},action:{type:DZe,participantsAvailable:y},update:r})},f=[{label:"Cancel",intent:"none",close:!0},{label:"Add round",intent:"is-success",close:!1,onClick:()=>{var v;if(o[Vs].value===Vs){const{drawDefinition:y}=Ye.getEvent({drawId:t}),b=y.entries.filter(({entryStatus:I,entryStage:T})=>!["WITHDRAWN","UNGROUPED"].includes(I)&&(!T||T===e.stage)).map(({participantId:I})=>I);p({participantIds:b})}else{Dw();const y=Ye.generateAdHocMatchUps({newRound:!0,structureId:i,drawId:t});if(console.log({result:y}),!((v=y.matchUps)!=null&&v.length))return;u(y.matchUps)}}}],m=[{field:Vs,value:Vs,options:[{label:Vs,value:Vs,selected:!0},{label:Iz,value:!1}]}];r=lr({title:"Add round",content:v=>o=ro(v,m),buttons:f}).update}const _Ie="Delete matches",kIe="Add matches",xIe="Add round";function PZe({structure:t,drawId:e,callback:i}){if(!Ye.isAdHoc({structure:t}))return{};const n=()=>i({refresh:!0});return{label:"Round actions",options:[{onClick:()=>AIe({drawId:e,structure:t,callback:n}),label:kIe,color:"blue"},{onClick:()=>s5({drawId:e,structure:t,newRound:!0,callback:n}),label:xIe,color:"blue"},{label:_Ie,color:"red",onClick:()=>NIe({drawId:e,structure:t,callback:n})}],selection:!1,location:Ut,align:Ut}}const{MAIN:CZe,QUALIFYING:EZe,VOLUNTARY_CONSOLATION:MZe}=yr;function l5({updateDisplay:t,callback:e,structure:i,drawId:n,existingView:r}){var h;const o=document.getElementById(Sz),{sourceStructuresComplete:a,hasDrawFeedProfile:s}=i??{},l=!((i==null?void 0:i.stage)===CZe&&(i==null?void 0:i.stageSequence)===1)&&(i==null?void 0:i.stage)!==EZe&&s,c=Ye.isAdHoc({structure:i}),u=[];if(l){const f=()=>{const g={params:{structureId:i.sourceStructureIds[0],drawId:n},method:s3e};xt({methods:[g],callback:y=>{y.success&&typeof t=="function"&&t()}})},m=(h=i.positionAssignments)==null?void 0:h.filter(({participantId:g})=>g).length;u.push({intent:a?"is-primary":ht,disabled:a!==!0,visible:!m,onClick:f,label:"Auto position",location:Ut})}const p=UZe({structure:i,drawId:n,existingView:r,callback:({refresh:f,view:m})=>typeof e=="function"&&e({refresh:f,view:m})});if(p!=null&&p.options.length&&u.push(p),c){const f=PZe({structure:i,drawId:n,callback:e});u.push(f)}(i==null?void 0:i.stage)===MZe&&console.log("voluntary controlBar with [View participants]"),u.length&&Da({target:o,items:u})}function nO(){[Sz,ble,Ile].forEach(t=>{const e=document.getElementById(t);e&&Ua(e)})}function sX({participantResult:t,drawPosition:e,participantId:i,participantMap:n}={}){const r=`${(t==null?void 0:t.setsWon)||0}/${(t==null?void 0:t.setsLost)||0}`,o=`${(t==null?void 0:t.gamesWon)||0}/${(t==null?void 0:t.gamesLost)||0}`,a=(t==null?void 0:t.groupOrder)||(t==null?void 0:t.provisionalOrder),s=n[i];return{participantName:s.participantName,groupName:s.groupName,...t,participantId:i,drawPosition:e,participant:s,gamesResult:o,setsResult:r,order:a}}function yF(t){const e=t.getValue();return e&&`${(parseFloat(e)*100).toFixed(0)}%`}function RZe(){return[{cellClick:(t,e)=>e.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{headerMenu:ah({}),field:"drawPosition",headerSort:!1,hozAlign:Lt,width:55},{formatter:"responsiveCollapse",hozAlign:Vt,responsive:!1,headerSort:!1,resizable:!1,width:50},{formatter:Ib(({event:t,cell:e,...i})=>console.log("cell clicked",{event:t,cell:e,undefined:void 0,params:i})),sorter:Bw,field:"participantName",responsive:!1,resizable:!1,maxWidth:400,minWidth:200,widthGrow:2,title:"Name"},{headerHozAlign:Vt,headerWordWrap:!0,title:"Match W/L",hozAlign:Vt,maxWidth:80,field:"result"},{formatter:yF,headerHozAlign:Vt,headerWordWrap:!0,field:"matchUpsPct",title:"Match Win%",hozAlign:Vt,maxWidth:80},{headerHozAlign:Vt,headerWordWrap:!0,field:"setsResult",title:"Sets W/L",hozAlign:Vt,maxWidth:80},{formatter:yF,headerHozAlign:Vt,headerWordWrap:!0,title:"Set Win%",hozAlign:Vt,field:"setsPct",maxWidth:80},{headerHozAlign:Vt,headerWordWrap:!0,field:"gamesResult",title:"Games W/L",hozAlign:Vt,maxWidth:80},{formatter:yF,headerHozAlign:Vt,headerWordWrap:!0,title:"Game Win%",hozAlign:Vt,field:"gamesPct",maxWidth:80},{headerHozAlign:Vt,hozAlign:Vt,title:"Order",field:"order",maxWidth:80},{title:"Group",field:"groupName",visible:!1}]}async function OIe({eventId:t,drawId:e,structureId:i}){let n,r,o,a;const s=y=>(y??[]).reduce((b,I)=>(b[I.participantId]=I,b),{}),l={},c=()=>{var S,w;const{participants:y,eventData:b}=Ye.getEventData({eventId:t,allParticipantResults:!0}),I=(S=b==null?void 0:b.drawsData)==null?void 0:S.find(U=>U.drawId===e);return r=(w=I==null?void 0:I.structures)==null?void 0:w.find(U=>U.structureId===i),a||(a=s(y)),(r!=null&&r.roundMatchUps?Object.values(r.roundMatchUps).flat():[]).forEach(({sides:U,structureName:D,structureId:E})=>{l[E]=D,U.forEach(C=>{C.participantId&&(a[C.participantId].groupName=D)})}),((r==null?void 0:r.participantResults)??[]).filter(U=>{var E;const D=a[U.participantId];return!o||((E=D==null?void 0:D.participantName)==null?void 0:E.toLowerCase().includes(o==null?void 0:o.toLowerCase()))})},u=c(),d=()=>u==null?void 0:u.map(y=>sX({...y,participantMap:a})),p=()=>c().map(sX),h=y=>{y.participantFilter&&(o=y.participantFilter),n.replaceData(p())},f=d(),m=RZe();return(y=>{rh({anchorId:Ud});const b=document.getElementById(Ud),I=Object.values(l).length>1?["groupName"]:void 0;n=new bo(b,{headerSortElement:oh(["participantName","gamesResult","matchUpsPct","setsResult","gamesPct","setsPct","result","order"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,groupHeader:[T=>T],placeholder:"No participants",responsiveLayout:"collapse",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:I,columns:m,data:y})})(f),l5({structure:r,drawId:e,existingView:rw,callback:({refresh:y,view:b}={})=>{nO(),b?nr({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):oD({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),a5({eventId:t,drawId:e,structureId:i,updateDisplay:h}),{table:n,replaceTableData:h}}function NZe({structure:t,drawId:e,callback:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=a=>{a.stopPropagation(),a.preventDefault(),s5({newRound:!0,structure:t,callback:i,drawId:e})},r.className="button is-info",r.innerHTML="Generate round",n.appendChild(r);const o=document.getElementById(Ud);o&&o.appendChild(n)}function AZe({drawData:t,eventId:e,drawId:i}){const n=document.createElement("div");n.className="flexcol flexcenter",n.style.width="100%",n.style.height="300px";const r=document.createElement("button");r.onclick=a=>{a.stopPropagation(),a.preventDefault();const s=t.drawName;Gw({callback:l=>{var u,d,p;const c=(p=(d=(u=l.drawDefinition)==null?void 0:u.structures)==null?void 0:d.find(({stage:h})=>h===RP))==null?void 0:p.structureId;nr({eventId:e,drawId:i,structureId:c,renderDraw:!0})},isQualifying:!0,drawName:s,eventId:e,drawId:i})},r.className="button is-info",r.innerHTML="Generate qualifying",n.appendChild(r);const o=document.getElementById(Ud);o&&o.appendChild(n)}const lX={ALTERNATE:"Assign alternate",ASSIGN:"Assign participant",BYE:"Assign BYE",REMOVE_PARTICIPANT:"Remove assignment",REMOVE:"Remove assignment",QUALIFIER:"Assign qualifier",SEED_VALUE:"Assign seed",SWAP:"Swap draw positions",WITHDRAW:"Withdraw participant"};function _Ze({pointerEvent:t,actions:e,callback:i}){const n=t.target,r=a=>{["WITHDRAW","BYE","REMOVE","REMOVE_PARTICIPANT"].includes(a.type)&&kZe({action:a,callback:i}),["ASSIGN","ALTERNATE","SWAP","QUALIFIER"].includes(a.type)&&xZe({action:a,callback:i}),["SEED_VALUE"].includes(a.type)&&OZe({target:n,action:a,callback:i})},o=e==null?void 0:e.filter(({type:a})=>lX[a]).map(a=>({option:lX[a.type]||a.type,onClick:()=>r(a)}));o!=null&&o.length&&bl({options:o,target:n,config:{arrow:!1,offset:[0,0]}})}function kZe({action:t,callback:e}){const i=r=>r.success?e():console.log({result:r}),n=[{method:t.method,params:t.payload}];xt({methods:n,callback:i})}function xZe({action:t,callback:e}){QC({action:t,onSelection:n=>{const r=a=>a.success?e():console.log({result:a}),o=[{params:{...t.payload,...n},method:t.method}];xt({methods:o,callback:r})},selectOnEnter:!0})}function OZe({target:t,action:e,callback:i}){let n;function r(a){if((a==null?void 0:a.key)==="Enter"){const s=a.target.value;if(Di.isConvertableInteger(s)){const l=u=>u.success?i():console.log({result:u}),c=[{params:{...e.payload,seedValue:s},method:e.method}];xt({methods:c,callback:l})}n.destroy()}}n=bl({menuItems:[{label:"Assign seed number ",validator:Zu,placeholder:"Seed number",field:"seedNumber",id:"seedNumber",type:"input",focus:!0,onKeyDown:r}],target:t,config:{arrow:!1,offset:[0,0]}})}function LZe(t){var o,a,s,l;const{structureId:e,drawId:i}=(t==null?void 0:t.context)??t,n=(l=(s=(a=(o=t.eventData)==null?void 0:o.drawsData)==null?void 0:a.find(c=>c.drawId===i))==null?void 0:s.structures)==null?void 0:l.find(c=>c.structureId===e),r=[];if(Ye.isAdHoc({structure:n})){const c=[{onClick:()=>AIe({...t}),text:kIe,color:"blue"},{onClick:()=>s5({...t,roundNumber:void 0,newRound:!0}),text:xIe,color:"blue"},{onClick:()=>NIe({...t}),text:_Ie,color:"red"}];r.push(...c)}t!=null&&t.pointerEvent&&r.length&&bl({items:r,target:t.pointerEvent.target,config:{placement:Rf}})}const{TEAM:FZe}=Fo;function BZe({callback:t,drawId:e,eventData:i}){var u;const n=(u=i==null?void 0:i.drawsData)==null?void 0:u.flatMap(({structures:d})=>d.flatMap(p=>{var h;return[(h=p.structures)==null?void 0:h.flatMap(f=>Object.values(f.roundMatchUps||{}).flat()),...Object.values(p.roundMatchUps||{}).flat()]}).filter(Boolean)),r=Di.createMap(n,"matchUpId"),o=d=>{const p=IS(d.pointerEvent.target,"tmx-m","id");return r[p]},a=d=>parseInt(IS(d.pointerEvent.target,"tmx-sd","sideNumber")),s=d=>IS(d.pointerEvent.target,"tmx-str","id"),l=d=>parseInt(IS(d.pointerEvent.target,"tmx-rd","roundNumber"));return{centerInfoClick:()=>console.log("centerInfo click"),roundHeaderClick:d=>{const p=l(d),h=s(d);return LZe({pointerEvent:d.pointerEvent,roundNumber:p,structureId:h,eventData:i,callback:t,drawId:e})},scheduleClick:d=>{if(d!=null&&d.pointerEvent){d.pointerEvent.stopPropagation();const p=IS(d.pointerEvent.target,"tmx-m","id"),h=r[p];q4({pointerEvent:d.pointerEvent,matchUp:h,callback:t})}},venueClick:d=>{var h,f,m,g;const p=o(d);if(d!=null&&d.pointerEvent&&((h=p==null?void 0:p.schedule)!=null&&h.venueId)){const v=p.schedule.venueId,y=(g=(m=(f=Ye.findVenue({venueId:v}))==null?void 0:f.venue)==null?void 0:m.addresses)==null?void 0:g[0],{latitude:b,longitude:I}=y||{};if(!b||!I)return;const T=`https://www.google.com/maps/@?api=1&map_action=map&center=${b}%2C${I}&zoom=18&basemap=satellite`,S=`https://bing.com/maps/default.aspx?cp=${b}~${I}&lvl=17&style=h`,w=D=>{const E=D&&b&&I&&(D==="google"&&T||S);E&&window.open(E,"_blank")};bl({items:[{heading:"Venue Location"},{divider:"divider"},{onClick:()=>w("google"),hide:!b||!I,text:"Open in Google Maps"},{onClick:()=>w("bing"),hide:!b||!I,text:"Open in Bing Maps"}],target:d.pointerEvent.target,config:{placement:Rf}})}},matchUpClick:d=>console.log("matchUpClick",d),scoreClick:d=>{var g;const p=a(d),h=o(d),{validActions:f}=Ye.matchUpActions({matchUpId:h.matchUpId,drawId:h.drawId,sideNumber:p})||{},m=f==null?void 0:f.find(({type:v})=>v==="SCORE");if(m)if(h.matchUpType===FZe){const v=()=>t(),y=(g=i==null?void 0:i.eventInfo)==null?void 0:g.eventName,{matchUpId:b,drawId:I}=h;eO({title:y,drawId:I,matchUpId:b,onClose:v})}else Qx({matchUpId:m.payload.matchUpId,callback:t})},participantClick:d=>{var g;const p=o(d),h=a(d),f=d.side||((g=p.sides)==null?void 0:g.find(v=>v.sideNumber===h)),{validActions:m}=p.drawId&&Ye.positionActions({sideNumber:h||(f==null?void 0:f.sideNumber),structureId:p==null?void 0:p.structureId,drawPosition:f==null?void 0:f.drawPosition,matchUpId:p==null?void 0:p.matchUpId,drawId:p==null?void 0:p.drawId,policyDefinitions:{positionActions:{}}})||{};_Ze({...d,actions:m,callback:t})}}}var cX=11;function $Ze(t,e){var i=e.attributes,n,r,o,a,s;if(!(e.nodeType===cX||t.nodeType===cX)){for(var l=i.length-1;l>=0;l--)n=i[l],r=n.name,o=n.namespaceURI,a=n.value,o?(r=n.localName||r,s=t.getAttributeNS(o,r),s!==a&&(n.prefix==="xmlns"&&(r=n.name),t.setAttributeNS(o,r,a))):(s=t.getAttribute(r),s!==a&&t.setAttribute(r,a));for(var c=t.attributes,u=c.length-1;u>=0;u--)n=c[u],r=n.name,o=n.namespaceURI,o?(r=n.localName||r,e.hasAttributeNS(o,r)||t.removeAttributeNS(o,r)):e.hasAttribute(r)||t.removeAttribute(r)}}var dE,VZe="http://www.w3.org/1999/xhtml",$l=typeof document>"u"?void 0:document,jZe=!!$l&&"content"in $l.createElement("template"),HZe=!!$l&&$l.createRange&&"createContextualFragment"in $l.createRange();function GZe(t){var e=$l.createElement("template");return e.innerHTML=t,e.content.childNodes[0]}function zZe(t){dE||(dE=$l.createRange(),dE.selectNode($l.body));var e=dE.createContextualFragment(t);return e.childNodes[0]}function WZe(t){var e=$l.createElement("body");return e.innerHTML=t,e.childNodes[0]}function qZe(t){return t=t.trim(),jZe?GZe(t):HZe?zZe(t):WZe(t)}function pE(t,e){var i=t.nodeName,n=e.nodeName,r,o;return i===n?!0:(r=i.charCodeAt(0),o=n.charCodeAt(0),r<=90&&o>=97?i===n.toUpperCase():o<=90&&r>=97?n===i.toUpperCase():!1)}function YZe(t,e){return!e||e===VZe?$l.createElement(t):$l.createElementNS(e,t)}function KZe(t,e){for(var i=t.firstChild;i;){var n=i.nextSibling;e.appendChild(i),i=n}return e}function bF(t,e,i){t[i]!==e[i]&&(t[i]=e[i],t[i]?t.setAttribute(i,""):t.removeAttribute(i))}var uX={OPTION:function(t,e){var i=t.parentNode;if(i){var n=i.nodeName.toUpperCase();n==="OPTGROUP"&&(i=i.parentNode,n=i&&i.nodeName.toUpperCase()),n==="SELECT"&&!i.hasAttribute("multiple")&&(t.hasAttribute("selected")&&!e.selected&&(t.setAttribute("selected","selected"),t.removeAttribute("selected")),i.selectedIndex=-1)}bF(t,e,"selected")},INPUT:function(t,e){bF(t,e,"checked"),bF(t,e,"disabled"),t.value!==e.value&&(t.value=e.value),e.hasAttribute("value")||t.removeAttribute("value")},TEXTAREA:function(t,e){var i=e.value;t.value!==i&&(t.value=i);var n=t.firstChild;if(n){var r=n.nodeValue;if(r==i||!i&&r==t.placeholder)return;n.nodeValue=i}},SELECT:function(t,e){if(!e.hasAttribute("multiple")){for(var i=-1,n=0,r=t.firstChild,o,a;r;)if(a=r.nodeName&&r.nodeName.toUpperCase(),a==="OPTGROUP")o=r,r=o.firstChild;else{if(a==="OPTION"){if(r.hasAttribute("selected")){i=n;break}n++}r=r.nextSibling,!r&&o&&(r=o.nextSibling,o=null)}t.selectedIndex=i}}},AS=1,dX=11,pX=3,hX=8;function Kf(){}function ZZe(t){if(t)return t.getAttribute&&t.getAttribute("id")||t.id}function XZe(t){return function(i,n,r){if(r||(r={}),typeof n=="string")if(i.nodeName==="#document"||i.nodeName==="HTML"||i.nodeName==="BODY"){var o=n;n=$l.createElement("html"),n.innerHTML=o}else n=qZe(n);else n.nodeType===dX&&(n=n.firstElementChild);var a=r.getNodeKey||ZZe,s=r.onBeforeNodeAdded||Kf,l=r.onNodeAdded||Kf,c=r.onBeforeElUpdated||Kf,u=r.onElUpdated||Kf,d=r.onBeforeNodeDiscarded||Kf,p=r.onNodeDiscarded||Kf,h=r.onBeforeElChildrenUpdated||Kf,f=r.skipFromChildren||Kf,m=r.addChild||function(k,O){return k.appendChild(O)},g=r.childrenOnly===!0,v=Object.create(null),y=[];function b(k){y.push(k)}function I(k,O){if(k.nodeType===AS)for(var F=k.firstChild;F;){var B=void 0;O&&(B=a(F))?b(B):(p(F),F.firstChild&&I(F,O)),F=F.nextSibling}}function T(k,O,F){d(k)!==!1&&(O&&O.removeChild(k),p(k),I(k,F))}function S(k){if(k.nodeType===AS||k.nodeType===dX)for(var O=k.firstChild;O;){var F=a(O);F&&(v[F]=O),S(O),O=O.nextSibling}}S(i);function w(k){l(k);for(var O=k.firstChild;O;){var F=O.nextSibling,B=a(O);if(B){var $=v[B];$&&pE(O,$)?(O.parentNode.replaceChild($,O),D($,O)):w(O)}else w(O);O=F}}function U(k,O,F){for(;O;){var B=O.nextSibling;(F=a(O))?b(F):T(O,k,!0),O=B}}function D(k,O,F){var B=a(O);B&&delete v[B],!(!F&&(c(k,O)===!1||(t(k,O),u(k),h(k,O)===!1)))&&(k.nodeName!=="TEXTAREA"?E(k,O):uX.TEXTAREA(k,O))}function E(k,O){var F=f(k,O),B=O.firstChild,$=k.firstChild,V,H,z,G,W;e:for(;B;){for(G=B.nextSibling,V=a(B);!F&&$;){if(z=$.nextSibling,B.isSameNode&&B.isSameNode($)){B=G,$=z;continue e}H=a($);var K=$.nodeType,Z=void 0;if(K===B.nodeType&&(K===AS?(V?V!==H&&((W=v[V])?z===W?Z=!1:(k.insertBefore(W,$),H?b(H):T($,k,!0),$=W,H=a($)):Z=!1):H&&(Z=!1),Z=Z!==!1&&pE($,B),Z&&D($,B)):(K===pX||K==hX)&&(Z=!0,$.nodeValue!==B.nodeValue&&($.nodeValue=B.nodeValue))),Z){B=G,$=z;continue e}H?b(H):T($,k,!0),$=z}if(V&&(W=v[V])&&pE(W,B))F||m(k,W),D(W,B);else{var Y=s(B);Y!==!1&&(Y&&(B=Y),B.actualize&&(B=B.actualize(k.ownerDocument||$l)),m(k,B),w(B))}B=G,$=z}U(k,$,H);var X=uX[k.nodeName];X&&X(k,O)}var C=i,M=C.nodeType,N=n.nodeType;if(!g){if(M===AS)N===AS?pE(i,n)||(p(i),C=KZe(i,YZe(n.nodeName,n.namespaceURI))):C=n;else if(M===pX||M===hX){if(N===M)return C.nodeValue!==n.nodeValue&&(C.nodeValue=n.nodeValue),C;C=n}}if(C===n)p(i);else{if(n.isSameNode&&n.isSameNode(C))return;if(D(C,n,g),y)for(var R=0,A=y.length;R<A;R++){var _=v[y[R]];_&&T(_,_.parentNode,!1)}}return!g&&C!==i&&i.parentNode&&(C.actualize&&(C=C.actualize(i.ownerDocument||$l)),i.parentNode.replaceChild(C,i)),C}}var JZe=XZe($Ze);const{DOUBLES:QZe,TEAM:fX}=ps;function oD({eventId:t,drawId:e,structureId:i,compositionName:n,roundsView:r,redraw:o}){var E,C;const a=Ye.getEvents().events;if(!(a!=null&&a.length))return;vN.register("tmx-tm","mouseover",wZe),vN.register("tmx-tm","mouseout",SZe);let s,l,c,u,d,p,h,f,m;const g=()=>{var M,N,R,A;l=(M=Ye.getEventData({participantsProfile:{convertExtensions:!0,withScaleValues:!0,withGroupings:!0,withISO2:!0,withIOC:!0},includePositionAssignments:!0,eventId:t}))==null?void 0:M.eventData,c=(N=l==null?void 0:l.eventInfo)==null?void 0:N.eventType,u=(R=l==null?void 0:l.drawsData)==null?void 0:R.find(_=>_.drawId===e),d=(u==null?void 0:u.structures)||[],i=i||((A=d==null?void 0:d[0])==null?void 0:A.structureId),p=d.find(_=>_.structureId===i),{roundMatchUps:f,stage:h}=Di.makeDeepCopy(p||{}),m=Object.values(f||{}).flat()};Hx(),g();const v=({refresh:M,view:N}={})=>{const R=M||s;nO(),N?nr({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:N}):oD({eventId:t,drawId:e,structureId:i,redraw:R,roundsView:N})},y=(m==null?void 0:m.length)===1&&l.eventInfo.eventType===fX,b=BZe({eventData:l,callback:v,drawId:e}),I=(k1==null?void 0:k1[n])||k1[c===QZe&&"National"||c===fX&&"Basic"||"National"];I.configuration.scaleAttributes&&(I.configuration.scaleAttributes=ar.scales[ar.activeScale]),I.configuration.showAddress=void 0,I.configuration.participantDetail="_ustaSection.name",I.configuration.allDrawPositions=!0,I.configuration.drawPositions=!0,I.configuration.roundHeader=!0;const T=document.getElementById(Ud);o&&Ua(T);const S=Ye.isAdHoc({structure:p}),w=()=>{var N,R;if(y)return;l5({updateDisplay:()=>{g(),w()},drawId:e,structure:p,existingView:r,callback:v});for(const A of Object.keys((p==null?void 0:p.roundMatchUps)??{}))p.roundMatchUps[A]=(N=f==null?void 0:f[A])==null?void 0:N.filter(({sides:_})=>(_==null?void 0:_.some(({participant:O})=>O==null?void 0:O.participantName.toLowerCase().includes(s)))||!s);if(m.length)if(r===ow)LIe({matchUps:m,eventData:l});else if(r===rw)OIe({eventId:t,drawId:e,structureId:i,eventData:l});else{const A=Object.values(p.roundMatchUps||{}).flat(),_=_2e({content:A2e({context:{drawId:e,structureId:i},searchActive:s,matchUps:A,eventHandlers:b,composition:I,structure:p}),theme:I.theme}),k=F=>{var B;return(B=F==null?void 0:F.classList)!=null&&B.contains("tmx-p")?F:As(F,"tmx-p")},O=T.firstChild;O?JZe(O,_,{addChild:function(F,B){var $,V,H,z,G,W,K;if(B.classList){const Z=F.firstChild,Y=B.getAttribute("id"),X=![null,"undefined",void 0].includes(Y),Q=(V=($=F.firstChild)==null?void 0:$.getAttribute)==null?void 0:V.call($,"id"),te=![null,"undefined",void 0].includes(Q);try{if(!X&&!te){console.log("condition 0");const J=(H=k(Z))==null?void 0:H.nextSibling;J!=null&&J.getAttribute("id")&&((z=k(Z))!=null&&z.getAttribute("id"))&&J.parentElement.removeChild(J)}else X&&te&&Y&&Q&&Y!==Q?(console.log("condition 1"),F.removeChild(F.firstChild)):(G=B.classList)!=null&&G.contains("tmx-p")&&!te?(console.log("condition 2"),F.removeChild(F.firstChild)):(K=(W=F.firstChild)==null?void 0:W.classList)!=null&&K.contains("tmx-p")&&F.firstChild.getAttribute("id")!=="undefined"&&B.getAttribute("id")==="undefined"?(console.log("condition 3"),F.removeChild(F.firstChild)):console.log(!X&&te?"condition 4":{incomingId:X,existingId:te,incomingIdValue:Y,existingIdValue:Q})}catch(J){console.log({err:J})}}F.appendChild(B)}}):T.appendChild(_)}else if(h===RP)AZe({drawData:u,drawId:e,eventId:t});else if(S)NZe({structure:p,drawId:e,callback:v});else{const A=(R=d==null?void 0:d[0])==null?void 0:R.structureId;return oD({eventId:t,drawId:e,structureId:A,redraw:!0})}},U=document.getElementById(NP),D=M=>{M&&g();const N=_=>{var k;return(k=_.searchText)==null?void 0:k.includes(s)},A=RIe({updateParticipantFilter:_=>{_||Object.values(Qe.tables).filter(Boolean).forEach(k=>k.clearFilter()),s=_==null?void 0:_.toLowerCase(),_&&Object.values(Qe.tables).filter(Boolean).forEach(k=>k.addFilter(N)),Ua(T),w()},updateControlBar:D,structureId:i,eventData:l,drawData:u,matchUps:m,eventId:t,drawId:e});Da({target:U,items:A})};if(!u){console.log("no draw data",{eventData:l,drawData:u});return}if(i=i||((C=(E=u.structures)==null?void 0:E[0])==null?void 0:C.structureId),!i){console.log("structure not found");return}if(y){const M=tO({matchUp:m[0],participantFilter:s});M&&T.appendChild(M)}else w();D()}function eXe(t,e,i,n){const r=e>1?"items":"item";return t+`<span style='color:blue; margin-left:10px;'>(${e} ${r})</span>`}const{TEAM:tXe}=Fo,iXe=t=>(e,i)=>{var c;const n=i.getRow().getData(),{matchUpId:r,readyToScore:o,matchUpType:a,drawId:s,eventName:l}=n.matchUp;a===tXe?eO({title:l,matchUpId:r,drawId:s,onClose:()=>t()}):(o||(c=n.matchUp.score)!=null&&c.scoreStringSide1)&&Qx({matchUpId:r,callback:t})};function nXe({data:t,replaceTableData:e}){const i=(s,l)=>{var h,f;const u=l.getRow().getData(),{courtName:d,scheduledDate:p}=u;if(d&&p){const m=(f=(h=Ye.getTournament())==null?void 0:h.tournamentRecord)==null?void 0:f.tournamentId,g=`/${Xo}/${m}/${Wv}/${p}`;Qe.router.navigate(g)}},n=()=>e(),r=t.some(s=>s.courtName),o=(s,l)=>XU(s,l,n),a=s=>{const l=document.createElement("div");l.className="has-text-warning-dark",l.innerHTML="Select participant";const c=({event:d,...p})=>{XU(d,s,n,p)};return s.getValue().participantName&&Ib(c)(s,l)};return[{cellClick:(s,l)=>l.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{formatter:"responsiveCollapse",headerSort:!1,resizable:!1,hozAlign:Vt,minWidth:50,width:50},{headerMenu:ah({duration:"Duration",complete:"Complete"}),formatter:"rownum",headerSort:!1,hozAlign:Lt,width:55},{title:"Flight",visible:!1,minWidth:150,field:"flight",widthGrow:1},{cellClick:i,field:"scheduledDate",title:"Date",width:110},{cellClick:i,visible:!!r,field:"courtName",title:"Court",width:100},{cellClick:i,field:"scheduleTime",headerSort:!1,visible:!1,title:"Time",width:70},{formatter:a,cellClick:o,sorter:Bw,responsive:!1,title:"Side 1",minWidth:180,field:"side1",widthGrow:1},{formatter:a,cellClick:o,sorter:Bw,responsive:!1,title:"Side 2",minWidth:180,field:"side2",widthGrow:1},{cellClick:iXe(e),formatter:W4,sorter:dIe,field:"scoreDetail",responsive:!1,title:"Score",width:140},{sorter:obe,formatter:abe,field:"competitiveProfile",responsive:!1,title:"Profile",visible:!1,width:140},{title:"<div class='fa-solid fa-check' style='color: green' />",formatter:"tickCross",field:"complete",hozAlign:Lt,tooltip:!1,width:40},{field:"matchUp.matchUpStatus",title:"Status",width:150},{title:"<div class='fa-solid fa-clock' style='color: blue' />",headerSort:!1,field:"duration",visible:!1,width:70},{cellClick:(s,l)=>q4({pointerEvent:s,...l.getData()}),formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,widthGrow:0,width:50}]}const{TEAM:rXe}=ps,mX=t=>{var A,_,k,O,F;const{potentialParticipants:e,structureName:i,matchUpType:n,roundNumber:r,matchUpId:o,roundName:a,schedule:s,eventId:l,drawId:c,sides:u,...d}=t,{scheduledDate:p,scheduleTime:h,courtName:f}=s||{},m=B=>{var $;return(($=B.person)==null?void 0:$.standardFamilyName)||B.participantName},g=(e==null?void 0:e.map(B=>({participantName:B.map(m).filter(Boolean).join(" or ")})))||[],v=((A=u==null?void 0:u[0])==null?void 0:A.participant)||g.shift(),y=((_=u==null?void 0:u[1])==null?void 0:_.participant)||g.shift(),b={participantName:v==null?void 0:v.participantName,sex:(k=v==null?void 0:v.person)==null?void 0:k.sex,participant:v},I={participantName:y==null?void 0:y.participantName,sex:(O=y==null?void 0:y.person)==null?void 0:O.sex,participant:y},T=u.flatMap(({participant:B})=>{var $;return($=B==null?void 0:B.individualParticipantIds)!=null&&$.length?B.individualParticipantIds:B==null?void 0:B.participantId}).filter(Boolean),S=d.winningSide===1&&"side1"||d.winningSide===2&&"side2"||void 0,w=!!d.winningSide,U=!!(d.winningSide||d.readyToScore),D=(F=d.score)==null?void 0:F.scoreStringSide1,E=u.flatMap(B=>{var V,H,z;const $=(V=B.participant)==null?void 0:V.person;return $?[$.standardGivenName,$.standardFamilyName]:(z=(H=B.participant)==null?void 0:H.individualParticipants)==null?void 0:z.map(({person:G})=>[G.standardGivenName,G.standardFamilyName])}).filter(Boolean).join(" ").toLowerCase(),C=Ole([E,v==null?void 0:v.participantName,y==null?void 0:y.participantName].filter(Boolean).join(" ")).toLowerCase(),M=t.collectionId?rXe:n,N=t.competitiveness?{competitiveness:t.competitiveness}:t.competitiveProfile,R={score:D,matchUpStatus:t.matchUpStatus,readyToScore:U,complete:w,winningSide:S};return{matchUpStatus:t.matchUpStatus,individualParticipantIds:T,flight:t.drawName,competitiveProfile:N,structureName:i,scheduledDate:p,readyToScore:U,scheduleTime:h,matchUpType:n,scoreDetail:R,winningSide:S,roundNumber:r,searchText:C,courtName:f,eventType:M,matchUpId:o,roundName:a,complete:w,eventId:l,matchUp:t,drawId:c,side1:b,side2:I,score:D}},{CONTAINER:oXe}=yr;async function LIe({eventId:t,drawId:e,structureId:i,matchUps:n,eventData:r}){let o,a,s,l;const c=()=>{var I,T;const y=Ye.getEventData({eventId:t}).eventData,b=(I=y==null?void 0:y.drawsData)==null?void 0:I.find(S=>S.drawId===e);return a=(T=b==null?void 0:b.structures)==null?void 0:T.find(S=>S.structureId===i),l=(a==null?void 0:a.structureType)===oXe,(Ye.allTournamentMatchUps({matchUpFilters:{drawIds:[e],structureIds:[i]},participantsProfile:{withISO2:!0,withScaleValues:!0},contextProfile:{withCompetitiveness:!0}}).matchUps||[]).filter(({matchUpStatus:S})=>S!=="BYE").filter(({sides:S})=>!s||S.find(w=>{var U,D;return(D=(U=w.participant)==null?void 0:U.participantName)==null?void 0:D.toLowerCase().includes(s==null?void 0:s.toLowerCase())}))};n||(n=await c()),r&&n.forEach(y=>y.eventName=r.eventInfo.eventName);const u=()=>n.map(mX),d=()=>c().map(mX),p=y=>{y.participantFilter&&(s=y.participantFilter),o.replaceData(d())},h=u(),f=nXe({data:h,replaceTableData:p}),m=l?["roundName","structureName"]:["roundName"];return(y=>{rh({anchorId:Ud});const b=document.getElementById(Ud);o=new bo(b,{groupHeader:[eXe,I=>I],headerSortElement:oh(["complete","duration","score"]),responsiveLayoutCollapseStartOpen:!1,height:window.innerHeight*.85,responsiveLayout:"collapse",placeholder:"No matches",layout:"fitColumns",reactiveData:!0,index:"matchUpId",groupBy:m,columns:f,data:y})})(h),l5({structure:a,drawId:e,existingView:ow,callback:({refresh:y,view:b}={})=>{nO(),b?nr({eventId:t,drawId:e,structureId:i,renderDraw:!0,view:b}):oD({eventId:t,drawId:e,structureId:i,redraw:y,roundsView:b})}}),a5({eventId:t,drawId:e,structureId:i,updateDisplay:p}),{table:o,replaceTableData:p}}function hE({eventId:t,renderDraw:e}={}){const i=document.getElementById(wle),n=document.getElementById(yle),r=document.getElementById(Ud),o=document.getElementById(Sle);o&&(o.style.display=t||e?"":ht),i&&(i.style.display=t&&!e?"":ht),n&&(n.style.display=t||e?ht:""),r&&(r.style.display=e?"":ht)}function aXe({eventId:t,drawId:e,headerElement:i}){const{event:n,drawDefinition:r}=Ye.getEvent({eventId:t,drawId:e});return n&&r?(i.innerHTML=n.eventName,{success:!0}):{}}const gX={fn:t=>({name:"dynamicContent",default:!0,onShow(){typeof t.props.dynContent=="function"&&t.setContent(t.props.dynContent(t.reference))}})},FIe=""+new URL("dragmatch-Va2U120p.png",import.meta.url).href,ov={"o-route":EP,"p-route":Dp,"e-route":Xu,"m-route":yz,"s-route":Wv,"v-route":bz},vX={"o-route":"Overview","p-route":"Participants","e-route":"Events","m-route":"MatchUps","s-route":"Schedule","v-route":"Venues"};function sXe(){var s,l,c,u;const e=`
  <div class="side-bar collapse">
    <ul class="features-list">
      <li id='o-route' class="features-item tournaments">
        <i class="nav-icon fa-solid fa-trophy" style="font-size: larger"> <span class="status"></span> </i>
          <span class="features-item-text">Overview</span>
      </li>
      <li id='p-route' class="features-item participants">
        <i class="nav-icon fa-solid fa-user-group" style="font-size: larger"></i>
        <span class="features-item-text">Participants</span>
      </li>
      <li id='e-route' class="features-item events">
        <i class="nav-icon fa-solid fa-diagram-project" style='font-size: larger'></i>
        <span class="features-item-text">Events</span>
      </li>
      <li id='m-route' class="features-item matches">
        <img src="${FIe}" class='nav-image' srcset=""/>
        <span class="features-item-text">Matches</span>
      </li>
      <li id='s-route' class="features-item schedule">
        <i class="nav-icon fa-solid fa-clock" style='font-size: larger'></i>
        <span class="features-item-text">Schedule</span>
      </li>
      <li id='v-route' class="features-item venues">
        <i class="nav-icon fa-solid fa-location-dot" style='font-size: larger'></i>
        <span class="features-item-text">Venues</span>
      </li>
    </ul>
  </div>
`,i=document.getElementById("sideNav");i.innerHTML=e;const n=Object.keys(ov),r=(u=(c=(l=(s=Qe.router)==null?void 0:s.current)==null?void 0:l[0])==null?void 0:c.data)==null?void 0:u.selectedTab,o=d=>document.querySelector(".side-bar").classList.contains("collapse")?d:"",a=document.getElementById("o-route");a.onclick=()=>{console.log("tournament information")},ff(a,{dynContent:()=>o(vX["o-route"]),onShow:d=>!!d.props.content,plugins:[gX],placement:Ut,arrow:!1}),n.forEach(d=>{const p=document.getElementById(d);ff(p,{dynContent:()=>o(vX[d]),onShow:h=>!!h.props.content,plugins:[gX],placement:Ut,arrow:!1}),(r===ov[d]||!r&&ov[d]===Dp)&&p.classList.add("active"),p.onclick=()=>{var m;document.querySelectorAll(".features-item").forEach(g=>g.classList.remove("active")),p.classList.add("active");const h=(m=Ye.getTournament())==null?void 0:m.tournamentRecord.tournamentId,f=`/${Xo}/${h}/${ov[d]}`;Qe.router.navigate(f)}})}function BIe(t){document.querySelectorAll(".features-item").forEach(i=>i.classList.remove("active")),Object.keys(ov).forEach(i=>{const n=document.getElementById(i);(t===ov[i]||!t&&ov[i]===Dp)&&n.classList.add("active")})}const $Ie=t=>({drawDefinition:e,scaleValues:i})=>{var d,p,h,f,m,g;const{drawId:n,drawName:r,drawType:o,entries:a,matchUpFormat:s,tieFormat:l}=e,c=(d=a==null?void 0:a.filter(({entryStatus:v})=>v!=="WITHDRAWN"))==null?void 0:d.length,u=(p=Ye.getAssignedParticipantIds({drawDefinition:e}).assignedParticipantIds)==null?void 0:p.filter(Boolean);return{entries:(u==null?void 0:u.length)??c??0,matchUpFormat:s,tieFormat:l,utrAvg:(f=(h=i==null?void 0:i.ratingsStats)==null?void 0:h.UTR)==null?void 0:f.avg,wtnAvg:(g=(m=i==null?void 0:i.ratingsStats)==null?void 0:m.WTN)==null?void 0:g.avg,drawName:r,drawType:o,eventId:t,drawId:n}},{MAIN:yX}=yr;function VIe({event:t,scaleValues:e}){var m,g,v;const{drawDefinitions:i=[],eventName:n,entries:r,eventId:o}=t,a=Ye.allEventMatchUps({inContext:!0,eventId:o}).matchUps,s=x_.getPublishState({event:t}).publishState,l=i.length,c=((m=r.filter(({entryStage:y=yX,entryStatus:b})=>RN(yX).includes(`${y}.${b}`)))==null?void 0:m.length)||0,u=(a==null?void 0:a.length)||0,d=((g=a==null?void 0:a.filter(({winningSide:y,schedule:b})=>!y&&(b==null?void 0:b.scheduledTime)))==null?void 0:g.length)||0,p=((v=a.filter(({winningSide:y})=>y))==null?void 0:v.length)||0,h=i.map(y=>{var b;return $Ie(o)({drawDefinition:y,scaleValues:(b=e==null?void 0:e.draws)==null?void 0:b[y.drawId]})}),f=[n].concat(i.map(({drawName:y})=>y||"")).join(" ").toLowerCase();return{published:s==null?void 0:s.status.published,scheduledMatchUpsCount:d,completedMatchUpsCount:p,matchUpsCount:u,entriesCount:c,drawsCount:l,searchText:f,drawDefs:h,eventId:o,event:t}}function lXe(t){const e=()=>{console.log("drawActions")},i=(o,a)=>{const{eventId:s,drawId:l}=a.getRow().getData();nr({eventId:s,drawId:l,renderDraw:!0})},n=t.find(o=>o.utrAvg),r=t.find(o=>o.wtnAvg);return[{cellClick:(o,a)=>a.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,responsive:!1,hozAlign:Lt,width:5},{headerMenu:ah({entries:"Entries",wtnAvg:"WTN avg",utrAvg:"UTR avg"}),headerSort:!1,formatter:"rownum",hozAlign:Vt,width:55},{title:"Draw Name",field:qv,cellClick:i},{title:"Draw Type",field:ed,cellClick:i},{title:'<div class="event_icon opponents_header" />',field:"entries",width:50},{visible:!!r,field:"wtnAvg",title:xNe,width:80},{visible:!!n,field:"utrAvg",title:$z,width:80},{cellClick:e,formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut}]}function cXe(t){const e=document.createElement("div"),i=document.createElement("div");i.className="tableControl",i.style.marginBottom="1em";const n=t.getData().drawDefs;e.appendChild(i);const r="1px solid #333",o=document.createElement("div");o.style.display=n.length?"":ht,o.style.backgroundColor="white",o.style.border=r,o.style.width="99%",e.className=G_,e.style.display=ht,e.style.boxSizing="border-box",e.style.paddingLeft="10px",e.style.borderTop=r,e.style.borderBotom=r,e.appendChild(o),t.getElement().appendChild(e);const a=lXe(n),s=new bo(o,{headerSortElement:oh(["entries"]),placeholder:"No draws",layout:"fitColumns",index:"drawId",maxHeight:400,columns:a,data:n});s.on("scrollVertical",Tc);const l=t.getData().event,c=l.eventId,u=()=>{const m=s.getSelectedData().map(({drawId:y})=>y),g=m.map(y=>({method:xye,params:{eventId:c,drawId:y}}));xt({methods:g,callback:y=>{y.success&&s.deleteRow(m);const b=t==null?void 0:t.getData();if(b){const I=Ye.allEventMatchUps({inContext:!1,eventId:c}).matchUps;b.drawDefs=b.drawDefs.filter(T=>!m.includes(T.drawId)),b.matchUpsCount=(I==null?void 0:I.length)||0,b.drawsCount-=1}s.getData().length||(o.style.display=ht)}})},d=f=>{var m;if(f.success){s==null||s.addRow($Ie(c)({drawDefinition:f.drawDefinition}));const g=t==null?void 0:t.getData();if(o.style.display="",g)if(!g.matchUpsCount)nr({eventId:c,drawId:(m=f.drawDefinition)==null?void 0:m.drawId,renderDraw:!0});else{const v=Ye.allDrawMatchUps({drawId:f.drawDefinition.drawId,inContext:!1,eventId:c}).matchUps;g.matchUpsCount+=(v==null?void 0:v.length)||0,g.drawsCount+=1}}},p=({success:f,eventUpdates:m})=>{if(f){const g=t==null?void 0:t.getData();Object.assign(g.event,m),t.update(g)}};Da({table:s,target:i,items:[{onClick:u,label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{onClick:()=>nr({eventId:c}),label:"View entries",intent:"is-info",location:Lt},{onClick:()=>bIe({eventId:c}),id:"editAvoidances",label:"Avoidances",location:Lt},{onClick:()=>Wx({event:l,callback:p}),label:"Edit event",location:Ut},{onClick:()=>Gw({eventId:c,callback:d}),intent:"is-primary",label:"Add draw",location:Ut}]})}function uXe(t,e){const i=e.getRow().getData(),r=[{method:i.published?T3e:g3e,params:{eventId:i.eventId}}];xt({methods:r,callback:a=>{a!=null&&a.success?e.getRow().update({published:!i.published}):vi({message:a.error.message,intent:"is-danger"})}})}const dXe=t=>t.getValue()?'<i class="fa-solid fa-eye" style="color: blue">':'<i class="fa-solid fa-eye-slash" style="color: red">';function pXe(t,e){const i=Array.from(document.querySelectorAll(".tippy-content"));if(i.length){i.forEach(s=>s.remove());return}const n=t.target.getElementsByClassName("fa-ellipsis-vertical")[0],r=e.getRow().getData(),o=({success:s,eventUpdates:l})=>{if(s){const c=e.getRow(),u=c==null?void 0:c.getData();Object.assign(u.event,l),c.update(u)}};bl({items:[{onClick:()=>console.log("Delete",r),text:"Delete"},{onClick:()=>Wx({event:r.event,callback:o}),text:"Edit"}],target:n||t.target,config:{placement:Rf}})}function hXe(){const t=(i,n)=>{i.stopPropagation();const r=n.getRow().getData().eventId;nr({eventId:r})},e=(i,n)=>{const r=n.getRow().getData();if(r.drawDefs.length===1){const o=r.eventId,a=r.drawDefs[0].drawId;nr({eventId:o,drawId:a,renderDraw:!0})}else Av(i,n)};return[{cellClick:(i,n)=>n.getRow().toggleSelect(),titleFormatter:"rowSelection",formatter:"rowSelection",headerSort:!1,hozAlign:Lt,width:5},{headerMenu:ah({completedMatchUpsCount:"Completed MatchUps",scheduledMatchUpsCount:"Scheduled MatchUps",entriesCount:"Accepted entries",matchUpsCount:"Total matches",drawsCount:"Number of draws",published:"Published"}),formatter:"rownum",headerSort:!1,hozAlign:Vt,width:55},{title:'<i class="fa-solid fa-eye"></i>',formatter:dXe,cellClick:uXe,headerSort:!1,field:"published",width:55},{field:"event.eventName",cellClick:e,title:"Event",minWidth:200,visible:!0,widthGrow:3},{field:"event.eventType",title:"Type",visible:!0},{field:"event.gender",title:"Gender",visible:!0},{title:'<div class="event_icon drawsize_header" />',headerTooltip:"Number of Draws",cellClick:Av,headerHozAlign:Vt,field:"drawsCount",hozAlign:Vt,headerSort:!0,visible:!0,width:45},{title:'<div class="event_icon opponents_header" />',headerTooltip:"Accepted Entries",headerHozAlign:Vt,field:"entriesCount",cellClick:t,hozAlign:Vt,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon matches_header" />',headerTooltip:"Total MatchUps",headerHozAlign:Vt,field:"matchUpsCount",hozAlign:Vt,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon time_header" />',headerTooltip:"Scheduled MatchUps",field:"scheduledMatchUpsCount",headerHozAlign:Vt,hozAlign:Vt,headerSort:!0,visible:!0,width:50},{title:'<div class="event_icon rank_header" />',headerTooltip:"Completed MatchUps",field:"completedMatchUpsCount",headerHozAlign:Vt,hozAlign:Vt,headerSort:!0,visible:!0,width:50},{cellClick:Av,formatter:G4,responsive:!1,headerSort:!1,hozAlign:Ut,field:"isOpen",width:20},{cellClick:pXe,formatter:Of,responsive:!1,headerSort:!1,hozAlign:Ut,width:20}]}function fXe(){let t;const e=()=>{var a;const o=Ye.getEvents({withScaleValues:!0});return(a=o==null?void 0:o.events)==null?void 0:a.map(s=>{var l;return VIe({event:s,scaleValues:(l=o.eventScaleValues)==null?void 0:l[s.eventId]})})},i=()=>{t.replaceData(e())},n=hXe();return(o=>{var l;rh({anchorId:rU});const a=document.getElementById(rU),s=(l=As(a,"section"))==null?void 0:l.querySelector(".tabHeader");s&&(s.innerHTML=`Events (${o.length})`),t=new bo(a,{columnDefaults:{},headerSortElement:oh(["scheduledMatchUpsCount","completedMatchUpsCount","matchUpsCount","entriesCount","drawsCount"]),responsiveLayoutCollapseStartOpen:!1,rowFormatter:cXe,height:window.innerHeight*.8,responsiveLayout:"collapse",placeholder:"No events",layout:"fitColumns",reactiveData:!0,index:"eventId",columns:n,data:o}),t.on("scrollVertical",Tc),t.on("dataChanged",c=>{s&&(s.innerHTML=`Events (${c.length})`)}),t.on("dataFiltered",(c,u)=>{s&&(s.innerHTML=`Events (${u.length})`)})})(e()),{table:t,replaceTableData:i}}function mXe(){const{table:t}=fXe(),e=a=>{if(a!=null&&a.event){const s=VIe({event:a.event});t==null||t.updateOrAddData([s])}},i=gb(t),r=[{onClick:()=>{const a=t==null?void 0:t.getSelectedData().map(({eventId:l})=>l);xt({methods:[{method:l3e,params:{eventIds:a}}],callback:l=>l.success&&(t==null?void 0:t.deleteRow(a))})},label:"Delete selected",intent:"is-danger",stateChange:!0,location:Pr},{onKeyDown:a=>a.keyCode===8&&a.target.value.length===1&&i(""),onChange:a=>i(a.target.value),onKeyUp:a=>i(a.target.value),clearSearch:()=>i(""),placeholder:"Search events",location:Lt,search:!0},{onClick:()=>Wx({callback:e}),label:"Add event",location:Ut}],o=document.getElementById(_z);Da({table:t,target:o,items:r})}function gXe({eventId:t,drawId:e,structureId:i,renderDraw:n,roundsView:r}={}){var o;if(BIe(Xu),Hx(),nO(),t||e){const a=document.getElementById(rU),s=(o=As(a,"section"))==null?void 0:o.querySelector(".tabHeader");e&&n?aXe({eventId:t,drawId:e,headerElement:s}).success?(r===ow?LIe({eventId:t,drawId:e,structureId:i}):r===rw?OIe({eventId:t,drawId:e,structureId:i}):oD({eventId:t,drawId:e,structureId:i,redraw:!0,roundsView:r}),hE({renderDraw:n})):(rX({eventId:t,drawId:e}),hE({eventId:t})):(rX({eventId:t,drawId:e,headerElement:s}),hE({eventId:t}))}else mXe(),hE({eventId:t})}function vXe(){var n;const t=document.getElementById(EP);t.style.minHeight=`${window.innerHeight*.9}px`,Ua(t);const e=document.createElement("div");e.style.fontWeight="bold",e.className="block",e.innerHTML="Tournament Overview",t.appendChild(e);const i=(n=Ye.getTournament().tournamentRecord)==null?void 0:n.notes;if(i){const r=document.createElement("div");r.innerHTML=i,t.appendChild(r)}}let eg;function rO(t){fE(XM,t),fE(nU,t),fE(Up,t),fE(H_,t);const e=document.getElementById("sideNav");t===XM?e.style.display="":e.style.display=ht}function fE(t,e){const i=t===e,n=document.getElementById(t);n&&(n.style.display=i?"flex":"none")}const yXe=t=>t?t===eg:eg,IF=()=>{const t=document.getElementById(V_);t.style.display=ht,eg=nU,rO(nU)},bXe=t=>{const e=document.getElementById(V_);e.style.display="",eg=t,rO(XM)},IXe=()=>{const t=document.getElementById("pageTitle");t&&(t.innerHTML="<div class='tmx-title'>Tournaments</div>");const e=document.getElementById(V_);e.style.display="",eg=Up,rO(eg)},wXe=()=>{eg=H_,rO(eg)};function jIe({config:t}={}){const{tournamentRecord:e}=Ye.getTournament();(e==null?void 0:e.tournamentId)===t.tournamentId?HIe(t):(Qe.ee.emit(oye,Qe.tournamentId),No.findTournament(t.tournamentId).then(i=>GIe({tournamentRecord:i,config:t})))}function bX({config:t}){bXe(Xo),cKe(),BIe(t.selectedTab),HIe(t)}function HIe(t){const{selectedTab:e=Dp}=t;Nle(e)&&(e===Dp&&t4e({participantView:t.participantView}),e===Wv&&nbe({scheduledDate:t.scheduledDate}),e===EP&&vXe(),e===Xu&&gXe(t),e===yz&&oKe(),e===bz&&TKe())}function GIe({tournamentRecord:t,config:e}){var i;if(t)Ye.setState(t),bX({config:e});else{const n=oc(),r=((i=n==null?void 0:n.profile)==null?void 0:i.provider)||(Qe==null?void 0:Qe.provider),o=()=>{vi({message:"Tournament not found",onClose:()=>{Qe.router.navigate("/tournaments")},intent:"is-warning",pauseOnHover:!0})};if(r){const a=s=>{var c,u;const l=(u=(c=s==null?void 0:s.data)==null?void 0:c.tournamentRecords)==null?void 0:u[e.tournamentId];l?(Ye.setState(l),bX({config:e})):o()};p4({tournamentId:e.tournamentId}).then(a,o)}else console.log("no provider"),o()}}function Po(t,e){return typeof window.dev[t]=="function"?window.dev[t](e):(window.dev.allSubscriptions||window.dev[t])&&console.log(t,e)}const SXe={addDrawDefinition:t=>Po("addDrawDefinition",t),addMatchUps:t=>Po("addMatchUps",t),addParticipants:t=>Po("addParticipants",t),addVenue:t=>Po("addVenue",t),deletedDrawIds:t=>Po("deletedDrawIds",t),deletedMatchUpIds:t=>Po("deletedMatchUpIds",t),deleteVenue:t=>Po("deleteVenue",t),modifyDrawDefinition:t=>Po("modifyDrawDefinition",t),modifyDrawEntries:t=>Po("modifyDrawEntries",t),modifyEventEntries:t=>Po("modifyEventEntries",t),modifyMatchUp:t=>Po("modifyMatchUp",t),modifyParticipants:t=>Po("modifyParticipants",t),modifyPositionAssignments:t=>Po("modifyPositionAssignments",t),modifySeedAssignments:t=>Po("modifySeedAssignments",t),modifyVenue:t=>Po("modifyVenue",t),publishEvent:t=>Po("publishEvent",t),publishEventSeeding:t=>Po("publishEventSeeding",t),publishOrderOfPlay:t=>Po("publishOrderOfPlay",t),unPublishEvent:t=>Po("unPublishEvent",t),unPublishEventSeeding:t=>Po("unPublishEventSeeding",t),unPublishOrderOfPlay:t=>Po("unPublishOrderOfPlay",t),updateInContextMatchUp:t=>Po("updateInContextMatchUp",t)};function zIe(){if(!window.dev)console.log("%c dev initialized","color: yellow"),window.dev={};else return;const t=()=>console.log("set window.socketURL for messaging"),e=n=>{var o;if(!Array.isArray(n)){vi({message:"missing methods array",intent:"is-danger"});return}((o=Ye.getTournament().tournamentRecord)==null?void 0:o.tournamentId)?xt({methods:n,callback:s=>{var l;if(s!=null&&s.success){vi({message:"success",intent:"is-success"});const c=Ye.getTournament().tournamentRecord;Dye({tournamentRecord:c,callback:()=>GIe({tournamentRecord:c,config:{selectedTab:Xo}})})}else vi({message:((l=s==null?void 0:s.error)==null?void 0:l.message)??"error",intent:"is-danger"}),console.log({result:s})}}):vi({message:"missing tournament",intent:"is-danger"})},i=n=>{p4({tournamentId:n}).then(r=>{var o,a;if(r!=null&&r.error)console.log({error:r.error});else{const s=(a=(o=r==null?void 0:r.data)==null?void 0:o.tournamentRecords)==null?void 0:a[n];s&&c5(s)}})};mE({getTournament:()=>{var n;return(n=Ye.getTournament())==null?void 0:n.tournamentRecord},getContext:ZS.getDevContext,tournamentEngine:Ye,context:ZS.setDevContext,generateMockTournament:UXe,modifyTournament:e,fetchTournament:i,getLoginState:oc,getProviders:Hge,factory:ole,baseApi:Eg,help:t}),mE({connectSocket:F4,disconnectSocket:ZC,emitTmx:XC}),mE({tmx2db:No,load:TXe,exportTournamentRecord:B2e}),mE({env:ar,tournamentContext:Qe}),ZS.setSubscriptions({subscriptions:SXe})}function mE(t){if(yu(window.dev))try{Object.keys(t).forEach(e=>window.dev[e]=t[e])}catch{console.log("production environment")}}function TXe(t){if(typeof t=="object"){const e=t.tournamentRecord||t;(e==null?void 0:e.tournamentId)&&c5(e)}}function UXe(t){const{tournamentRecord:e,error:i}=$_.generateTournamentRecord(t);i?console.log({error:i}):c5(e)}function c5(t){const e=t==null?void 0:t.tournamentId;Dye({tournamentRecord:t,callback:()=>Qe.router.navigate(`/${Xo}/${e}`)})}class YS extends Error{}YS.prototype.name="InvalidTokenError";function DXe(t){return decodeURIComponent(atob(t).replace(/(.)/g,(e,i)=>{let n=i.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n}))}function PXe(t){let e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return DXe(e)}catch{return atob(e)}}function CXe(t,e){if(typeof t!="string")throw new YS("Invalid token specified: must be a string");e||(e={});const i=e.header===!0?0:1,n=t.split(".")[i];if(typeof n!="string")throw new YS(`Invalid token specified: missing part #${i+1}`);let r;try{r=PXe(n)}catch(o){throw new YS(`Invalid token specified: invalid base64 for part #${i+1} (${o.message})`)}try{return JSON.parse(r)}catch(o){throw new YS(`Invalid token specified: invalid json for part #${i+1} (${o.message})`)}}function WIe(t){var r,o;if(!t||t==="undefined"){Ale();return}let e;try{e=CXe(t)}catch{kle();return}const i=new Date;return(e==null?void 0:e.exp)<i.getTime()/1e3?oO():(((r=e==null?void 0:e.permissions)!=null&&r.includes("devMode")||(o=e==null?void 0:e.roles)!=null&&o.includes("develope"))&&zIe(),e)}function qIe(t){var r;const e=document.getElementById("login"),i=Qe==null?void 0:Qe.provider,n=(r=t==null?void 0:t.roles)==null?void 0:r.includes(j_);e.style.color=i&&"red"||n&&"green"||"blue"}function oc(){const t=xle(),e=WIe(t);return e&&qIe(e),e}function oO(){kle(),Ale(),ZC(),Qe.provider=void 0,Qe.router.navigate(`/${Up}`);const t=document.getElementById("login");t.style.color=""}function EXe({data:t,callback:e}){const i=WIe(t.token);i&&(JNe(t.token),vi({intent:"is-success",message:"Login successful"}),ZC(),Ye.reset(),qIe(i),vt(e)&&e(),Qe.router.navigate(`/${Up}`))}function MXe(){Hge().then(({data:t})=>{var i;const e=(i=t==null?void 0:t.providers)==null?void 0:i.map(({value:n})=>({onClick:()=>{Qe.provider=n,Qe.router.navigate(`/${Up}/${n.organisationAbbreviation}`)},participantName:n.organisationName}));e&&$ve({title:"Select Provider",options:e,selectionLimit:1})})}function RXe(){Qe.provider=void 0,Qe.router.navigate(`/${Up}/superadmin`)}function NXe(){const t=document.getElementById("login");t&&t.addEventListener("click",()=>{var o;const e=oc(),i=(o=e==null?void 0:e.roles)==null?void 0:o.includes(j_),n=Qe==null?void 0:Qe.provider;bl({target:t,title:"Authorization",items:[{text:"Log in",hide:e,onClick:()=>r5()},{style:"text-decoration: line-through;",onClick:RXe,text:"Impersonate",hide:!i||!n},{onClick:MXe,text:"Impersonate",hide:!i||n},{text:"Log out",hide:!e,onClick:oO}]})})}/*!
 * EventEmitter v5.2.6 - git.io/ee
 * Unlicense - http://unlicense.org/
 * Oliver Caldwell - https://oli.me.uk/
 * @preserve
 */const AXe=function(){function t(){}let e=t.prototype;function i(o,a){let s=o.length;for(;s--;)if(o[s].listener===a)return s;return-1}function n(o){return function(){return this[o].apply(this,arguments)}}e.getListeners=function(a){let s=this._getEvents(),l,c;if(a instanceof RegExp){l={};for(c in s)s.hasOwnProperty(c)&&a.test(c)&&(l[c]=s[c])}else l=s[a]||(s[a]=[]);return l},e.flattenListeners=function(a){let s=[],l;for(l=0;l<a.length;l+=1)s.push(a[l].listener);return s},e.getListenersAsObject=function(a){let s=this.getListeners(a),l;return s instanceof Array&&(l={},l[a]=s),l||s};function r(o){return typeof o=="function"||o instanceof RegExp?!0:o&&typeof o=="object"?r(o.listener):!1}return e.addListener=function(a,s){if(!r(s))throw new TypeError("listener must be a function");let l=this.getListenersAsObject(a),c=typeof s=="object",u;for(u in l)l.hasOwnProperty(u)&&i(l[u],s)===-1&&l[u].push(c?s:{listener:s,once:!1});return this},e.on=n("addListener"),e.addOnceListener=function(a,s){return this.addListener(a,{listener:s,once:!0})},e.once=n("addOnceListener"),e.defineEvent=function(a){return this.getListeners(a),this},e.defineEvents=function(a){for(let s=0;s<a.length;s+=1)this.defineEvent(a[s]);return this},e.removeListener=function(a,s){let l=this.getListenersAsObject(a),c,u;for(u in l)l.hasOwnProperty(u)&&(c=i(l[u],s),c!==-1&&l[u].splice(c,1));return this},e.off=n("removeListener"),e.addListeners=function(a,s){return this.manipulateListeners(!1,a,s)},e.removeListeners=function(a,s){return this.manipulateListeners(!0,a,s)},e.manipulateListeners=function(a,s,l){let c,u,d=a?this.removeListener:this.addListener,p=a?this.removeListeners:this.addListeners;if(typeof s=="object"&&!(s instanceof RegExp))for(c in s)s.hasOwnProperty(c)&&(u=s[c])&&(typeof u=="function"?d.call(this,c,u):p.call(this,c,u));else for(c=l.length;c--;)d.call(this,s,l[c]);return this},e.removeEvent=function(a){let s=typeof a,l=this._getEvents(),c;if(s==="string")delete l[a];else if(a instanceof RegExp)for(c in l)l.hasOwnProperty(c)&&a.test(c)&&delete l[c];else delete this._events;return this},e.removeAllListeners=n("removeEvent"),e.emitEvent=function(a,s){let l=this.getListenersAsObject(a),c,u,d,p,h;for(p in l)if(l.hasOwnProperty(p))for(c=l[p].slice(0),d=0;d<c.length;d++)u=c[d],u.once===!0&&this.removeListener(a,u.listener),h=u.listener.apply(this,s||[]),h===this._getOnceReturnValue()&&this.removeListener(a,u.listener);return this},e.trigger=n("emitEvent"),e.emit=function(a){let s=Array.prototype.slice.call(arguments,1);return this.emitEvent(a,s)},e.setOnceReturnValue=function(a){return this._onceReturnValue=a,this},e._getOnceReturnValue=function(){return this.hasOwnProperty("_onceReturnValue")?this._onceReturnValue:!0},e._getEvents=function(){return this._events||(this._events={})},t}();function IX(){try{return window}catch{return}}const YIe=()=>IX().dev&&typeof IX().dev=="object";function _Xe(){document.oncontextmenu=()=>!1,window.addEventListener("contextmenu",t=>{t.preventDefault()},!1),window.packageEntry={updateReady:VNe},window.onunhandledrejection=t=>{if(YIe())return;t.preventDefault();const e=t.reason,i=e&&(e.stack||e);i&&i.indexOf("blocked")>0?(jNe(),console.warn("popup blocked")):console.warn("Unhandled rejection:",e&&(e.stack||e))}}/*!
* tabbable 6.2.0
* @license MIT, https://github.com/focus-trap/tabbable/blob/master/LICENSE
*/var KIe=["input:not([inert])","select:not([inert])","textarea:not([inert])","a[href]:not([inert])","button:not([inert])","[tabindex]:not(slot):not([inert])","audio[controls]:not([inert])","video[controls]:not([inert])",'[contenteditable]:not([contenteditable="false"]):not([inert])',"details>summary:first-of-type:not([inert])","details:not([inert])"],AN=KIe.join(","),ZIe=typeof Element>"u",vy=ZIe?function(){}:Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector,_N=!ZIe&&Element.prototype.getRootNode?function(t){var e;return t==null||(e=t.getRootNode)===null||e===void 0?void 0:e.call(t)}:function(t){return t==null?void 0:t.ownerDocument},kN=function t(e,i){var n;i===void 0&&(i=!0);var r=e==null||(n=e.getAttribute)===null||n===void 0?void 0:n.call(e,"inert"),o=r===""||r==="true",a=o||i&&e&&t(e.parentNode);return a},kXe=function(e){var i,n=e==null||(i=e.getAttribute)===null||i===void 0?void 0:i.call(e,"contenteditable");return n===""||n==="true"},XIe=function(e,i,n){if(kN(e))return[];var r=Array.prototype.slice.apply(e.querySelectorAll(AN));return i&&vy.call(e,AN)&&r.unshift(e),r=r.filter(n),r},JIe=function t(e,i,n){for(var r=[],o=Array.from(e);o.length;){var a=o.shift();if(!kN(a,!1))if(a.tagName==="SLOT"){var s=a.assignedElements(),l=s.length?s:a.children,c=t(l,!0,n);n.flatten?r.push.apply(r,c):r.push({scopeParent:a,candidates:c})}else{var u=vy.call(a,AN);u&&n.filter(a)&&(i||!e.includes(a))&&r.push(a);var d=a.shadowRoot||typeof n.getShadowRoot=="function"&&n.getShadowRoot(a),p=!kN(d,!1)&&(!n.shadowRootFilter||n.shadowRootFilter(a));if(d&&p){var h=t(d===!0?a.children:d.children,!0,n);n.flatten?r.push.apply(r,h):r.push({scopeParent:a,candidates:h})}else o.unshift.apply(o,a.children)}}return r},QIe=function(e){return!isNaN(parseInt(e.getAttribute("tabindex"),10))},Zg=function(e){if(!e)throw new Error("No node provided");return e.tabIndex<0&&(/^(AUDIO|VIDEO|DETAILS)$/.test(e.tagName)||kXe(e))&&!QIe(e)?0:e.tabIndex},xXe=function(e,i){var n=Zg(e);return n<0&&i&&!QIe(e)?0:n},OXe=function(e,i){return e.tabIndex===i.tabIndex?e.documentOrder-i.documentOrder:e.tabIndex-i.tabIndex},ewe=function(e){return e.tagName==="INPUT"},LXe=function(e){return ewe(e)&&e.type==="hidden"},FXe=function(e){var i=e.tagName==="DETAILS"&&Array.prototype.slice.apply(e.children).some(function(n){return n.tagName==="SUMMARY"});return i},BXe=function(e,i){for(var n=0;n<e.length;n++)if(e[n].checked&&e[n].form===i)return e[n]},$Xe=function(e){if(!e.name)return!0;var i=e.form||_N(e),n=function(s){return i.querySelectorAll('input[type="radio"][name="'+s+'"]')},r;if(typeof window<"u"&&typeof window.CSS<"u"&&typeof window.CSS.escape=="function")r=n(window.CSS.escape(e.name));else try{r=n(e.name)}catch(a){return console.error("Looks like you have a radio button with a name attribute containing invalid CSS selector characters and need the CSS.escape polyfill: %s",a.message),!1}var o=BXe(r,e.form);return!o||o===e},VXe=function(e){return ewe(e)&&e.type==="radio"},jXe=function(e){return VXe(e)&&!$Xe(e)},HXe=function(e){var i,n=e&&_N(e),r=(i=n)===null||i===void 0?void 0:i.host,o=!1;if(n&&n!==e){var a,s,l;for(o=!!((a=r)!==null&&a!==void 0&&(s=a.ownerDocument)!==null&&s!==void 0&&s.contains(r)||e!=null&&(l=e.ownerDocument)!==null&&l!==void 0&&l.contains(e));!o&&r;){var c,u,d;n=_N(r),r=(c=n)===null||c===void 0?void 0:c.host,o=!!((u=r)!==null&&u!==void 0&&(d=u.ownerDocument)!==null&&d!==void 0&&d.contains(r))}}return o},wX=function(e){var i=e.getBoundingClientRect(),n=i.width,r=i.height;return n===0&&r===0},GXe=function(e,i){var n=i.displayCheck,r=i.getShadowRoot;if(getComputedStyle(e).visibility==="hidden")return!0;var o=vy.call(e,"details>summary:first-of-type"),a=o?e.parentElement:e;if(vy.call(a,"details:not([open]) *"))return!0;if(!n||n==="full"||n==="legacy-full"){if(typeof r=="function"){for(var s=e;e;){var l=e.parentElement,c=_N(e);if(l&&!l.shadowRoot&&r(l)===!0)return wX(e);e.assignedSlot?e=e.assignedSlot:!l&&c!==e.ownerDocument?e=c.host:e=l}e=s}if(HXe(e))return!e.getClientRects().length;if(n!=="legacy-full")return!0}else if(n==="non-zero-area")return wX(e);return!1},zXe=function(e){if(/^(INPUT|BUTTON|SELECT|TEXTAREA)$/.test(e.tagName))for(var i=e.parentElement;i;){if(i.tagName==="FIELDSET"&&i.disabled){for(var n=0;n<i.children.length;n++){var r=i.children.item(n);if(r.tagName==="LEGEND")return vy.call(i,"fieldset[disabled] *")?!0:!r.contains(e)}return!0}i=i.parentElement}return!1},xN=function(e,i){return!(i.disabled||kN(i)||LXe(i)||GXe(i,e)||FXe(i)||zXe(i))},N$=function(e,i){return!(jXe(i)||Zg(i)<0||!xN(e,i))},WXe=function(e){var i=parseInt(e.getAttribute("tabindex"),10);return!!(isNaN(i)||i>=0)},qXe=function t(e){var i=[],n=[];return e.forEach(function(r,o){var a=!!r.scopeParent,s=a?r.scopeParent:r,l=xXe(s,a),c=a?t(r.candidates):s;l===0?a?i.push.apply(i,c):i.push(s):n.push({documentOrder:o,tabIndex:l,item:r,isScope:a,content:c})}),n.sort(OXe).reduce(function(r,o){return o.isScope?r.push.apply(r,o.content):r.push(o.content),r},[]).concat(i)},YXe=function(e,i){i=i||{};var n;return i.getShadowRoot?n=JIe([e],i.includeContainer,{filter:N$.bind(null,i),flatten:!1,getShadowRoot:i.getShadowRoot,shadowRootFilter:WXe}):n=XIe(e,i.includeContainer,N$.bind(null,i)),qXe(n)},KXe=function(e,i){i=i||{};var n;return i.getShadowRoot?n=JIe([e],i.includeContainer,{filter:xN.bind(null,i),flatten:!0,getShadowRoot:i.getShadowRoot}):n=XIe(e,i.includeContainer,xN.bind(null,i)),n},Kb=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return vy.call(e,AN)===!1?!1:N$(i,e)},ZXe=KIe.concat("iframe").join(","),wF=function(e,i){if(i=i||{},!e)throw new Error("No node provided");return vy.call(e,ZXe)===!1?!1:xN(i,e)};/*!
* focus-trap 7.5.4
* @license MIT, https://github.com/focus-trap/focus-trap/blob/master/LICENSE
*/function SX(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),i.push.apply(i,n)}return i}function TX(t){for(var e=1;e<arguments.length;e++){var i=arguments[e]!=null?arguments[e]:{};e%2?SX(Object(i),!0).forEach(function(n){XXe(t,n,i[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):SX(Object(i)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(i,n))})}return t}function XXe(t,e,i){return e=QXe(e),e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function JXe(t,e){if(typeof t!="object"||t===null)return t;var i=t[Symbol.toPrimitive];if(i!==void 0){var n=i.call(t,e||"default");if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function QXe(t){var e=JXe(t,"string");return typeof e=="symbol"?e:String(e)}var UX={activateTrap:function(e,i){if(e.length>0){var n=e[e.length-1];n!==i&&n.pause()}var r=e.indexOf(i);r===-1||e.splice(r,1),e.push(i)},deactivateTrap:function(e,i){var n=e.indexOf(i);n!==-1&&e.splice(n,1),e.length>0&&e[e.length-1].unpause()}},eJe=function(e){return e.tagName&&e.tagName.toLowerCase()==="input"&&typeof e.select=="function"},tJe=function(e){return(e==null?void 0:e.key)==="Escape"||(e==null?void 0:e.key)==="Esc"||(e==null?void 0:e.keyCode)===27},DT=function(e){return(e==null?void 0:e.key)==="Tab"||(e==null?void 0:e.keyCode)===9},iJe=function(e){return DT(e)&&!e.shiftKey},nJe=function(e){return DT(e)&&e.shiftKey},DX=function(e){return setTimeout(e,0)},PX=function(e,i){var n=-1;return e.every(function(r,o){return i(r)?(n=o,!1):!0}),n},_S=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return typeof e=="function"?e.apply(void 0,n):e},gE=function(e){return e.target.shadowRoot&&typeof e.composedPath=="function"?e.composedPath()[0]:e.target},rJe=[],oJe=function(e,i){var n=(i==null?void 0:i.document)||document,r=(i==null?void 0:i.trapStack)||rJe,o=TX({returnFocusOnDeactivate:!0,escapeDeactivates:!0,delayInitialFocus:!0,isKeyForward:iJe,isKeyBackward:nJe},i),a={containers:[],containerGroups:[],tabbableGroups:[],nodeFocusedBeforeActivation:null,mostRecentlyFocusedNode:null,active:!1,paused:!1,delayInitialFocusTimer:void 0,recentNavEvent:void 0},s,l=function(M,N,R){return M&&M[N]!==void 0?M[N]:o[R||N]},c=function(M,N){var R=typeof(N==null?void 0:N.composedPath)=="function"?N.composedPath():void 0;return a.containerGroups.findIndex(function(A){var _=A.container,k=A.tabbableNodes;return _.contains(M)||(R==null?void 0:R.includes(_))||k.find(function(O){return O===M})})},u=function(M){var N=o[M];if(typeof N=="function"){for(var R=arguments.length,A=new Array(R>1?R-1:0),_=1;_<R;_++)A[_-1]=arguments[_];N=N.apply(void 0,A)}if(N===!0&&(N=void 0),!N){if(N===void 0||N===!1)return N;throw new Error("`".concat(M,"` was specified but was not a node, or did not return a node"))}var k=N;if(typeof N=="string"&&(k=n.querySelector(N),!k))throw new Error("`".concat(M,"` as selector refers to no known node"));return k},d=function(){var M=u("initialFocus");if(M===!1)return!1;if(M===void 0||!wF(M,o.tabbableOptions))if(c(n.activeElement)>=0)M=n.activeElement;else{var N=a.tabbableGroups[0],R=N&&N.firstTabbableNode;M=R||u("fallbackFocus")}if(!M)throw new Error("Your focus-trap needs to have at least one focusable element");return M},p=function(){if(a.containerGroups=a.containers.map(function(M){var N=YXe(M,o.tabbableOptions),R=KXe(M,o.tabbableOptions),A=N.length>0?N[0]:void 0,_=N.length>0?N[N.length-1]:void 0,k=R.find(function(B){return Kb(B)}),O=R.slice().reverse().find(function(B){return Kb(B)}),F=!!N.find(function(B){return Zg(B)>0});return{container:M,tabbableNodes:N,focusableNodes:R,posTabIndexesFound:F,firstTabbableNode:A,lastTabbableNode:_,firstDomTabbableNode:k,lastDomTabbableNode:O,nextTabbableNode:function($){var V=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,H=N.indexOf($);return H<0?V?R.slice(R.indexOf($)+1).find(function(z){return Kb(z)}):R.slice(0,R.indexOf($)).reverse().find(function(z){return Kb(z)}):N[H+(V?1:-1)]}}}),a.tabbableGroups=a.containerGroups.filter(function(M){return M.tabbableNodes.length>0}),a.tabbableGroups.length<=0&&!u("fallbackFocus"))throw new Error("Your focus-trap must have at least one container with at least one tabbable node in it at all times");if(a.containerGroups.find(function(M){return M.posTabIndexesFound})&&a.containerGroups.length>1)throw new Error("At least one node with a positive tabindex was found in one of your focus-trap's multiple containers. Positive tabindexes are only supported in single-container focus-traps.")},h=function C(M){var N=M.activeElement;if(N)return N.shadowRoot&&N.shadowRoot.activeElement!==null?C(N.shadowRoot):N},f=function C(M){if(M!==!1&&M!==h(document)){if(!M||!M.focus){C(d());return}M.focus({preventScroll:!!o.preventScroll}),a.mostRecentlyFocusedNode=M,eJe(M)&&M.select()}},m=function(M){var N=u("setReturnFocus",M);return N||(N===!1?!1:M)},g=function(M){var N=M.target,R=M.event,A=M.isBackward,_=A===void 0?!1:A;N=N||gE(R),p();var k=null;if(a.tabbableGroups.length>0){var O=c(N,R),F=O>=0?a.containerGroups[O]:void 0;if(O<0)_?k=a.tabbableGroups[a.tabbableGroups.length-1].lastTabbableNode:k=a.tabbableGroups[0].firstTabbableNode;else if(_){var B=PX(a.tabbableGroups,function(W){var K=W.firstTabbableNode;return N===K});if(B<0&&(F.container===N||wF(N,o.tabbableOptions)&&!Kb(N,o.tabbableOptions)&&!F.nextTabbableNode(N,!1))&&(B=O),B>=0){var $=B===0?a.tabbableGroups.length-1:B-1,V=a.tabbableGroups[$];k=Zg(N)>=0?V.lastTabbableNode:V.lastDomTabbableNode}else DT(R)||(k=F.nextTabbableNode(N,!1))}else{var H=PX(a.tabbableGroups,function(W){var K=W.lastTabbableNode;return N===K});if(H<0&&(F.container===N||wF(N,o.tabbableOptions)&&!Kb(N,o.tabbableOptions)&&!F.nextTabbableNode(N))&&(H=O),H>=0){var z=H===a.tabbableGroups.length-1?0:H+1,G=a.tabbableGroups[z];k=Zg(N)>=0?G.firstTabbableNode:G.firstDomTabbableNode}else DT(R)||(k=F.nextTabbableNode(N))}}else k=u("fallbackFocus");return k},v=function(M){var N=gE(M);if(!(c(N,M)>=0)){if(_S(o.clickOutsideDeactivates,M)){s.deactivate({returnFocus:o.returnFocusOnDeactivate});return}_S(o.allowOutsideClick,M)||M.preventDefault()}},y=function(M){var N=gE(M),R=c(N,M)>=0;if(R||N instanceof Document)R&&(a.mostRecentlyFocusedNode=N);else{M.stopImmediatePropagation();var A,_=!0;if(a.mostRecentlyFocusedNode)if(Zg(a.mostRecentlyFocusedNode)>0){var k=c(a.mostRecentlyFocusedNode),O=a.containerGroups[k].tabbableNodes;if(O.length>0){var F=O.findIndex(function(B){return B===a.mostRecentlyFocusedNode});F>=0&&(o.isKeyForward(a.recentNavEvent)?F+1<O.length&&(A=O[F+1],_=!1):F-1>=0&&(A=O[F-1],_=!1))}}else a.containerGroups.some(function(B){return B.tabbableNodes.some(function($){return Zg($)>0})})||(_=!1);else _=!1;_&&(A=g({target:a.mostRecentlyFocusedNode,isBackward:o.isKeyBackward(a.recentNavEvent)})),f(A||a.mostRecentlyFocusedNode||d())}a.recentNavEvent=void 0},b=function(M){var N=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;a.recentNavEvent=M;var R=g({event:M,isBackward:N});R&&(DT(M)&&M.preventDefault(),f(R))},I=function(M){if(tJe(M)&&_S(o.escapeDeactivates,M)!==!1){M.preventDefault(),s.deactivate();return}(o.isKeyForward(M)||o.isKeyBackward(M))&&b(M,o.isKeyBackward(M))},T=function(M){var N=gE(M);c(N,M)>=0||_S(o.clickOutsideDeactivates,M)||_S(o.allowOutsideClick,M)||(M.preventDefault(),M.stopImmediatePropagation())},S=function(){if(a.active)return UX.activateTrap(r,s),a.delayInitialFocusTimer=o.delayInitialFocus?DX(function(){f(d())}):f(d()),n.addEventListener("focusin",y,!0),n.addEventListener("mousedown",v,{capture:!0,passive:!1}),n.addEventListener("touchstart",v,{capture:!0,passive:!1}),n.addEventListener("click",T,{capture:!0,passive:!1}),n.addEventListener("keydown",I,{capture:!0,passive:!1}),s},w=function(){if(a.active)return n.removeEventListener("focusin",y,!0),n.removeEventListener("mousedown",v,!0),n.removeEventListener("touchstart",v,!0),n.removeEventListener("click",T,!0),n.removeEventListener("keydown",I,!0),s},U=function(M){var N=M.some(function(R){var A=Array.from(R.removedNodes);return A.some(function(_){return _===a.mostRecentlyFocusedNode})});N&&f(d())},D=typeof window<"u"&&"MutationObserver"in window?new MutationObserver(U):void 0,E=function(){D&&(D.disconnect(),a.active&&!a.paused&&a.containers.map(function(M){D.observe(M,{subtree:!0,childList:!0})}))};return s={get active(){return a.active},get paused(){return a.paused},activate:function(M){if(a.active)return this;var N=l(M,"onActivate"),R=l(M,"onPostActivate"),A=l(M,"checkCanFocusTrap");A||p(),a.active=!0,a.paused=!1,a.nodeFocusedBeforeActivation=n.activeElement,N==null||N();var _=function(){A&&p(),S(),E(),R==null||R()};return A?(A(a.containers.concat()).then(_,_),this):(_(),this)},deactivate:function(M){if(!a.active)return this;var N=TX({onDeactivate:o.onDeactivate,onPostDeactivate:o.onPostDeactivate,checkCanReturnFocus:o.checkCanReturnFocus},M);clearTimeout(a.delayInitialFocusTimer),a.delayInitialFocusTimer=void 0,w(),a.active=!1,a.paused=!1,E(),UX.deactivateTrap(r,s);var R=l(N,"onDeactivate"),A=l(N,"onPostDeactivate"),_=l(N,"checkCanReturnFocus"),k=l(N,"returnFocus","returnFocusOnDeactivate");R==null||R();var O=function(){DX(function(){k&&f(m(a.nodeFocusedBeforeActivation)),A==null||A()})};return k&&_?(_(m(a.nodeFocusedBeforeActivation)).then(O,O),this):(O(),this)},pause:function(M){if(a.paused||!a.active)return this;var N=l(M,"onPause"),R=l(M,"onPostPause");return a.paused=!0,N==null||N(),w(),E(),R==null||R(),this},unpause:function(M){if(!a.paused||!a.active)return this;var N=l(M,"onUnpause"),R=l(M,"onPostUnpause");return a.paused=!1,N==null||N(),p(),S(),E(),R==null||R(),this},updateContainerElements:function(M){var N=[].concat(M).filter(Boolean);return a.containers=N.map(function(R){return typeof R=="string"?n.querySelector(R):R}),a.active&&p(),E(),this}},s.updateContainerElements(e),s};const aJe=()=>{const t={selectorTrigger:"[data-drawer-trigger]",selectorTarget:"[data-drawer-target]",selectorClose:"[data-drawer-close]",leftAlignment:"drawer--left",visibleClass:"is-visible",activeClass:"is-active",speedClose:350,speedOpen:50},e={};let i=!1,n,r;const o=ple;let a;const s=I=>r=I,l=()=>{vt(r)&&r()&&(r=void 0);const I=document.getElementById(o);I.classList.remove(t.visibleClass),document.documentElement.style.overflow="",setTimeout(function(){n?(I.classList.add(t.visibleClass),document.documentElement.style.overflow="hidden",vt(n==null?void 0:n.callback)&&n.callback()):(I.classList.remove(t.activeClass),i=!1),n=!1,a==null||a.deactivate()},t.speedClose)},c=I=>{const T=document.getElementById(o);T.classList.contains(t.leftAlignment)||T.classList.add(t.leftAlignment),m(T,!1,I)},u=I=>{const T=document.getElementById(o);T.classList.remove(t.leftAlignment),m(T,!1,I)},d=I=>{const S=document.getElementById(o).querySelector(".drawer__title");S&&(S.innerHTML=I)},p=I=>{const S=document.getElementById(o).querySelector(".drawer__footer");S&&(Ua(S),vt(I)?e.footer=I(S,l):S.innerHTML=I||"")},h=I=>{const S=document.getElementById(o).querySelector(".drawer__content");S&&(Ua(S),vt(I)?e.content=I(S,l):S.innerHTML=I)},f=I=>{const S=document.getElementById(o).querySelector(".drawer__wrapper");S.style.width=I},m=(I,T,S)=>{i=!0,I.classList.add(t.activeClass),document.documentElement.style.overflow="hidden",T&&(a=oJe(I),a.activate()),vt(S)&&S(),setTimeout(function(){I.classList.add(t.visibleClass)},t.speedOpen)},g=({title:I,content:T,side:S,width:w,footer:U,callback:D,onClose:E}={})=>{if(T&&h(T),E&&s(E),I&&d(I),w&&f(w),p(U),i)n={callback:D};else if(S){if(S===Ut)return u(D);if(S===Lt)return c(D)}else{const C=document.getElementById(o);m(C,U,D)}},v=function(I,T){let S=T.parentNode;for(;S;){if(S===I)return!0;S=S.parentNode}return!1},y=function(I){const T=I.target,S=document.querySelector(".drawer__wrapper");(!v(S,T)||T.classList.contains("drawer__close"))&&l()},b=I=>{(I.key==="Escape"||I.keyCode===27)&&l()};return document.addEventListener("click",y,!1),document.addEventListener("keydown",b,!1),{settings:t,open:g,close:l,setTitle:d,setContent:h,setFooter:p,attributes:e}};function sJe({data:t}={}){const e=t==null?void 0:t.inviteKey;let i;lr({title:"New User",content:o=>i=ro(o,[{iconLeft:"fa-regular fa-user",placeholder:"First name",autocomplete:"firstName",label:"First Name",field:"firstName"},{iconLeft:"fa-solid fa-house",placeholder:"Last name",autocomplete:"lastName",label:"Last Name",field:"lastName"},{iconLeft:"fa-regular fa-envelope",placeholder:"valid@email.com",autocomplete:"email",label:"Email",field:"email"},{placeholder:"minimum 8 characters",autocomplete:"current-password",iconLeft:"fa-solid fa-lock",label:"Password",field:"password",type:"password"}]),buttons:[{label:"Cancel",intent:"none",close:!0},{label:"Register",intent:"is-primary",onClick:()=>{const o=i.lastName.value,a=i.firstName.value,s=i.password.value,l=i.email.value,c=()=>{vi({message:"Success",intent:"is-success "}),r5()},u=d=>{var p;return(d==null?void 0:d.status)===200&&((p=d==null?void 0:d.data)==null?void 0:p.success)&&c()};sKe(o,a,e,l,s).then(u,d=>console.log({err:d}))},close:!0}]})}function lJe(){const{tournamentRecord:t}=Ye.getTournament();t&&(Qe.ee.emit(oye,t.tournamentId),Ye.reset())}function CX(){Hx(),IXe(),XNe(),lJe(),lye()}function Fr(){}const cJe=t=>t;function uJe(t,e){for(const i in e)t[i]=e[i];return t}function twe(t){return t()}function EX(){return Object.create(null)}function Il(t){t.forEach(twe)}function $i(t){return typeof t=="function"}function Os(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function dJe(t){return Object.keys(t).length===0}function u5(t,...e){if(t==null){for(const n of e)n(void 0);return Fr}const i=t.subscribe(...e);return i.unsubscribe?()=>i.unsubscribe():i}function ON(t){let e;return u5(t,i=>e=i)(),e}function qe(t,e,i){t.$$.on_destroy.push(u5(e,i))}function pJe(t,e,i,n){if(t){const r=iwe(t,e,i,n);return t[0](r)}}function iwe(t,e,i,n){return t[1]&&n?uJe(i.ctx.slice(),t[1](n(e))):i.ctx}function hJe(t,e,i,n){if(t[2]&&n){const r=t[2](n(i));if(e.dirty===void 0)return r;if(typeof r=="object"){const o=[],a=Math.max(e.dirty.length,r.length);for(let s=0;s<a;s+=1)o[s]=e.dirty[s]|r[s];return o}return e.dirty|r}return e.dirty}function fJe(t,e,i,n,r,o){if(r){const a=iwe(e,i,n,o);t.p(a,r)}}function mJe(t){if(t.ctx.length>32){const e=[],i=t.ctx.length/32;for(let n=0;n<i;n++)e[n]=-1;return e}return-1}function tr(t,e,i){return t.set(i),e}function yy(t){return t&&$i(t.destroy)?t.destroy:Fr}const gJe=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function dr(t,e){t.appendChild(e)}function xn(t,e,i){t.insertBefore(e,i||null)}function An(t){t.parentNode&&t.parentNode.removeChild(t)}function Tb(t,e){for(let i=0;i<t.length;i+=1)t[i]&&t[i].d(e)}function Rn(t){return document.createElement(t)}function n1(t){return document.createTextNode(t)}function Ws(){return n1(" ")}function sh(){return n1("")}function In(t,e,i,n){return t.addEventListener(e,i,n),()=>t.removeEventListener(e,i,n)}function LN(t){return function(e){return e.stopPropagation(),t.call(this,e)}}function st(t,e,i){i==null?t.removeAttribute(e):t.getAttribute(e)!==i&&t.setAttribute(e,i)}function vJe(t){return Array.from(t.childNodes)}function nwe(t,e){e=""+e,t.data!==e&&(t.data=e)}function MX(t,e,i,n){i==null?t.style.removeProperty(e):t.style.setProperty(e,i,n?"important":"")}function zw(t,e){return new t(e)}let aD;function PT(t){aD=t}function nS(){if(!aD)throw new Error("Function called outside component initialization");return aD}function yJe(t){nS().$$.before_update.push(t)}function bJe(t){nS().$$.on_mount.push(t)}function rwe(t){nS().$$.after_update.push(t)}function IJe(t,e){return nS().$$.context.set(t,e),e}function ac(t){return nS().$$.context.get(t)}function aO(t,e){const i=t.$$.callbacks[e.type];i&&i.slice().forEach(n=>n.call(this,e))}const sI=[],Op=[];let NI=[];const RX=[],owe=Promise.resolve();let A$=!1;function awe(){A$||(A$=!0,owe.then(swe))}function d5(){return awe(),owe}function _$(t){NI.push(t)}const SF=new Set;let Zb=0;function swe(){if(Zb!==0)return;const t=aD;do{try{for(;Zb<sI.length;){const e=sI[Zb];Zb++,PT(e),wJe(e.$$)}}catch(e){throw sI.length=0,Zb=0,e}for(PT(null),sI.length=0,Zb=0;Op.length;)Op.pop()();for(let e=0;e<NI.length;e+=1){const i=NI[e];SF.has(i)||(SF.add(i),i())}NI.length=0}while(sI.length);for(;RX.length;)RX.pop()();A$=!1,SF.clear(),PT(t)}function wJe(t){if(t.fragment!==null){t.update(),Il(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(_$)}}function SJe(t){const e=[],i=[];NI.forEach(n=>t.indexOf(n)===-1?e.push(n):i.push(n)),i.forEach(n=>n()),NI=e}const pM=new Set;let av;function Js(){av={r:0,c:[],p:av}}function Qs(){av.r||Il(av.c),av=av.p}function Jt(t,e){t&&t.i&&(pM.delete(t),t.i(e))}function Ai(t,e,i,n){if(t&&t.o){if(pM.has(t))return;pM.add(t),av.c.push(()=>{pM.delete(t),n&&(i&&t.d(1),n())}),t.o(e)}else n&&n()}function za(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function lwe(t,e){Ai(t,1,1,()=>{e.delete(t.key)})}function cwe(t,e,i,n,r,o,a,s,l,c,u,d){let p=t.length,h=o.length,f=p;const m={};for(;f--;)m[t[f].key]=f;const g=[],v=new Map,y=new Map,b=[];for(f=h;f--;){const w=d(r,o,f),U=i(w);let D=a.get(U);D?n&&b.push(()=>D.p(w,e)):(D=c(U,w),D.c()),v.set(U,g[f]=D),U in m&&y.set(U,Math.abs(f-m[U]))}const I=new Set,T=new Set;function S(w){Jt(w,1),w.m(s,u),a.set(w.key,w),u=w.first,h--}for(;p&&h;){const w=g[h-1],U=t[p-1],D=w.key,E=U.key;w===U?(u=w.first,p--,h--):v.has(E)?!a.has(D)||I.has(D)?S(w):T.has(E)?p--:y.get(D)>y.get(E)?(T.add(D),S(w)):(I.add(E),p--):(l(U,a),p--)}for(;p--;){const w=t[p];v.has(w.key)||l(w,a)}for(;h;)S(g[h-1]);return Il(b),g}function Ho(t){t&&t.c()}function Eo(t,e,i){const{fragment:n,after_update:r}=t.$$;n&&n.m(e,i),_$(()=>{const o=t.$$.on_mount.map(twe).filter($i);t.$$.on_destroy?t.$$.on_destroy.push(...o):Il(o),t.$$.on_mount=[]}),r.forEach(_$)}function go(t,e){const i=t.$$;i.fragment!==null&&(SJe(i.after_update),Il(i.on_destroy),i.fragment&&i.fragment.d(e),i.on_destroy=i.fragment=null,i.ctx=[])}function TJe(t,e){t.$$.dirty[0]===-1&&(sI.push(t),awe(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function wl(t,e,i,n,r,o,a=null,s=[-1]){const l=aD;PT(t);const c=t.$$={fragment:null,ctx:[],props:o,update:Fr,not_equal:r,bound:EX(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(l?l.$$.context:[])),callbacks:EX(),dirty:s,skip_bound:!1,root:e.target||l.$$.root};a&&a(c.root);let u=!1;if(c.ctx=i?i(t,e.props||{},(d,p,...h)=>{const f=h.length?h[0]:p;return c.ctx&&r(c.ctx[d],c.ctx[d]=f)&&(!c.skip_bound&&c.bound[d]&&c.bound[d](f),u&&TJe(t,d)),p}):[],c.update(),u=!0,Il(c.before_update),c.fragment=n?n(c.ctx):!1,e.target){if(e.hydrate){const d=vJe(e.target);c.fragment&&c.fragment.l(d),d.forEach(An)}else c.fragment&&c.fragment.c();e.intro&&Jt(t.$$.fragment),Eo(t,e.target,e.anchor),swe()}PT(l)}class Sl{constructor(){UO(this,"$$");UO(this,"$$set")}$destroy(){go(this,1),this.$destroy=Fr}$on(e,i){if(!$i(i))return Fr;const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(i),()=>{const r=n.indexOf(i);r!==-1&&n.splice(r,1)}}$set(e){this.$$set&&!dJe(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Xb=[];function uwe(t,e){return{subscribe:Zo(t,e).subscribe}}function Zo(t,e=Fr){let i;const n=new Set;function r(s){if(Os(t,s)&&(t=s,i)){const l=!Xb.length;for(const c of n)c[1](),Xb.push(c,t);if(l){for(let c=0;c<Xb.length;c+=2)Xb[c][0](Xb[c+1]);Xb.length=0}}}function o(s){r(s(t))}function a(s,l=Fr){const c=[s,l];return n.add(c),n.size===1&&(i=e(r,o)||Fr),s(t),()=>{n.delete(c),n.size===0&&i&&(i(),i=null)}}return{set:r,update:o,subscribe:a}}function Fd(t,e,i){const n=!Array.isArray(t),r=n?[t]:t;if(!r.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return uwe(i,(a,s)=>{let l=!1;const c=[];let u=0,d=Fr;const p=()=>{if(u)return;d();const f=e(n?c[0]:c,a,s);o?a(f):d=$i(f)?f:Fr},h=r.map((f,m)=>u5(f,g=>{c[m]=g,u&=~(1<<m),l&&p()},()=>{u|=1<<m}));return l=!0,p(),function(){Il(h),d(),l=!1}})}function FN(t){return function(e){return e.key==="Enter"||e.key===" "&&!e.preventDefault()?t.call(this,e):void 0}}function rS(t,e){let i={update(n){typeof n=="string"?t.innerText=n:n!=null&&n.domNodes?t.replaceChildren(...n.domNodes):n!=null&&n.html&&(t.innerHTML=n.html)}};return i.update(e),i}function UJe(t,e){const i=n=>{t&&!t.contains(n.target)&&t.dispatchEvent(new CustomEvent(e+"outside",{detail:{jsEvent:n}}))};return document.addEventListener(e,i,!0),{destroy(){document.removeEventListener(e,i,!0)}}}const DJe=86400;function by(t=void 0){return t!==void 0?t instanceof Date?AX(t):EJe(t):AX(new Date)}function Xg(t){if(typeof t=="number")t={seconds:t};else if(typeof t=="string"){let i=0,n=2;for(let r of t.split(":",3))i+=parseInt(r,10)*Math.pow(60,n--);t={seconds:i}}else t instanceof Date&&(t={hours:t.getUTCHours(),minutes:t.getUTCMinutes(),seconds:t.getUTCSeconds()});let e=t.weeks||t.week||0;return{years:t.years||t.year||0,months:t.months||t.month||0,days:e*7+(t.days||t.day||0),seconds:(t.hours||t.hour||0)*60*60+(t.minutes||t.minute||0)*60+(t.seconds||t.second||0),inWeeks:!!e}}function Cr(t){return new Date(t.getTime())}function nd(t,e,i=1){t.setUTCFullYear(t.getUTCFullYear()+i*e.years);let n=t.getUTCMonth()+i*e.months;for(t.setUTCMonth(n),n%=12,n<0&&(n+=12);t.getUTCMonth()!==n;)Ww(t);return t.setUTCDate(t.getUTCDate()+i*e.days),t.setUTCSeconds(t.getUTCSeconds()+i*e.seconds),t}function dwe(t,e,i=1){return nd(t,e,-i)}function tg(t,e=1){return t.setUTCDate(t.getUTCDate()+e),t}function Ww(t,e=1){return tg(t,-e)}function Sm(t){return t.setUTCHours(0,0,0,0),t}function kl(t){return new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds())}function vu(t,e=19){return t.toISOString().substring(0,e)}function np(t,...e){return e.every(i=>t.getTime()===i.getTime())}function PJe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i>=0?i:i+7)),t}function pwe(t,e){let i=e-t.getUTCDay();return t.setUTCDate(t.getUTCDate()+(i<=0?i:i-7)),t}function NX(t){return typeof t=="string"&&t.length<=10}function CJe(t,e){return t.setUTCHours(e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds(),0),t}function AX(t){return new Date(Date.UTC(t.getFullYear(),t.getMonth(),t.getDate(),t.getHours(),t.getMinutes(),t.getSeconds()))}function EJe(t){const e=t.match(/\d+/g);return new Date(Date.UTC(Number(e[0]),Number(e[1])-1,Number(e[2]),Number(e[3]||0),Number(e[4]||0),Number(e[5]||0)))}function p5(t,e,i){i.update(n=>n.set(e,t))}function _X(t){Il(t),t.clear()}function hwe(t,e,i){e??(e=t),i.has(e)||i.set(e,setTimeout(()=>{i.delete(e),t()}))}function Ub(...t){return Object.assign(...t)}function hm(t){return Object.keys(t)}function MJe(t){return Math.floor(t)}function KS(...t){return Math.min(...t)}function fI(...t){return Math.max(...t)}function RJe(){return Symbol("ec")}function fwe(t,e,i,n=[]){let r=document.createElement(t);r.className=e,typeof i=="string"?r.innerText=i:i.domNodes?r.replaceChildren(...i.domNodes):i.html&&(r.innerHTML=i.html);for(let o of n)r.setAttribute(...o);return r}function NJe(t){return t.scrollHeight>t.clientHeight}function Tm(t){return t.getBoundingClientRect()}function sD(t,e){for(;e--;)t=t.parentElement;return t}function vE(t){return Tm(t).height}let h5=RJe();function AJe(t,e){t[h5]=e}function _Je(t){return!!(t!=null&&t[h5])}function hM(t){return t[h5]}function CT(t,e,i=document){for(let n of i.elementsFromPoint(t,e)){if(_Je(n))return n;if(n.shadowRoot){let r=CT(t,e,n.shadowRoot);if(r)return r}}return null}function kJe(t,e,i,n){return{type:t,title:e,currentStart:i.start,currentEnd:i.end,activeStart:n.start,activeEnd:n.end,calendar:void 0}}function vc(t){return t=Ub({},t),t.currentStart=kl(t.currentStart),t.currentEnd=kl(t.currentEnd),t.activeStart=kl(t.activeStart),t.activeEnd=kl(t.activeEnd),t}function k$(t){return t.startsWith("list")}let xJe=1;function BN(t){return t.map(e=>({id:"id"in e?String(e.id):`{generated-${xJe++}}`,resourceIds:Array.isArray(e.resourceIds)?e.resourceIds.map(String):"resourceId"in e?[String(e.resourceId)]:[],allDay:e.allDay??(NX(e.start)&&NX(e.end)),start:by(e.start),end:by(e.end),title:e.title||"",titleHTML:e.titleHTML||"",editable:e.editable,startEditable:e.startEditable,durationEditable:e.durationEditable,display:e.display||"auto",extendedProps:e.extendedProps||{},backgroundColor:e.backgroundColor||e.color,textColor:e.textColor}))}function OJe(t){return t.map(e=>({events:e.events,url:e.url&&e.url.trimEnd("&")||"",method:e.method&&e.method.toUpperCase()||"GET",extraParams:e.extraParams||{}}))}function x$(t,e,i){return{start:t.start>e?t.start:e,end:t.end<i?t.end:i,event:t}}function LJe(t){t.sort((e,i)=>e.start-i.start||i.event.allDay-e.event.allDay)}function FJe(t,e,i,n,r,o){let a=r.formatRange(t.start,e&&t.event.display!=="pointer"?CJe(Cr(t.start),t.end):t.start),s;if(i)s=$i(i)?i({event:Qu(t.event),timeText:a,view:vc(o)}):i;else{let l;switch(t.event.display){case"background":l=[];break;case"pointer":l=[kX(a,t,n)];break;default:l=[...t.event.allDay?[]:[kX(a,t,n)],fwe("h4",n.eventTitle,t.event.title)]}s={domNodes:l}}return[a,s]}function kX(t,e,i){return fwe("time",i.eventTime,t,[["datetime",vu(e.start)]])}function BJe(t,e,i){return t?($i(t)&&(t=t({event:Qu(e),view:vc(i)})),Array.isArray(t)?t:[t]):[]}function Qu(t){return mwe(t,kl)}function xX(t){return mwe(t,Cr)}function mwe(t,e){return t=Ub({},t),t.start=e(t.start),t.end=e(t.end),t}function OX(t,e){let i={};if(t.length){LJe(t);let n;for(let r of t){let o=[],a=Sm(Cr(r.start));for(;r.end>a;){if(!e.includes(a.getUTCDay())&&(o.push(Cr(a)),o.length>1)){let s=a.getTime();i[s]?i[s].chunks.push(r):i[s]={sorted:!1,chunks:[r]}}tg(a)}o.length?(r.date=o[0],r.days=o.length,r.dates=o,r.start<o[0]&&(r.start=o[0]),Sm(Cr(r.end))>o[o.length-1]&&(r.end=o[o.length-1])):(r.date=Sm(Cr(r.start)),r.days=1,r.dates=[r.date]),n&&np(n.date,r.date)&&(r.prev=n),n=r}}return i}function $Je(t,e,i){var o,a;t.top=0,t.prev&&(t.top=t.prev.bottom+1),t.bottom=t.top+i;let n=1,r=t.date.getTime();if((o=e[r])!=null&&o.sorted||(a=e[r])!=null&&a.chunks.every(s=>"top"in s)){e[r].sorted||(e[r].chunks.sort((s,l)=>s.top-l.top),e[r].sorted=!0);for(let s of e[r].chunks)if(t.top<s.bottom&&t.bottom>s.top){let l=s.bottom-t.top+1;n+=l,t.top+=l,t.bottom+=l}}return n}function gwe(t,e){var i;t.length=e.length;for(let n of t)(i=n==null?void 0:n.reposition)==null||i.call(n)}function LX(t,e,i,n,r){return(t.start<i&&t.end>e||!r&&np(t.start,t.end,e))&&(n===void 0||t.resourceIds.includes(n.id))}function qw(t){return VJe(t)||jJe(t)||HJe(t)}function f5(t){return t==="background"}function VJe(t){return t==="preview"}function jJe(t){return t==="ghost"}function HJe(t){return t==="pointer"}function GJe(t){return zJe(t,"month")}function zJe(t,e){return{...t,next:"Next "+e,prev:"Previous "+e}}function WJe(t){return e=>({...e,view:t})}function ET(t,e){return Fd([t,e],([i,n])=>{let r=$i(n)?{format:n}:new Intl.DateTimeFormat(i,n);return{format:o=>r.format(kl(o))}})}function FX(t,e){return Fd([t,e],([i,n])=>{let r;if($i(n))r=n;else{let o=new Intl.DateTimeFormat(i,n);r=(a,s)=>{if(a<=s)return o.formatRange(a,s);{let l=o.formatRangeToParts(s,a),c="",u=["startRange","endRange"],d=[!1,!1];for(let p of l){let h=u.indexOf(p.source);h>=0?d[h]||(c+=qJe(u[1-h],l),d[h]=!0):c+=p.value}return c}}}return{formatRange:(o,a)=>r(kl(o),kl(a))}})}function qJe(t,e){let i="";for(let n of e)n.source==t&&(i+=n.value);return i}function YJe(t){var i;let e={allDayContent:void 0,allDaySlot:!0,buttonText:{today:"today"},date:new Date,datesSet:void 0,dayHeaderFormat:{weekday:"short",month:"numeric",day:"numeric"},dayHeaderAriaLabelFormat:{dateStyle:"long"},displayEventEnd:!0,duration:{weeks:1},events:[],eventAllUpdated:void 0,eventBackgroundColor:void 0,eventTextColor:void 0,eventClassNames:void 0,eventClick:void 0,eventColor:void 0,eventContent:void 0,eventDidMount:void 0,eventMouseEnter:void 0,eventMouseLeave:void 0,eventSources:[],eventTimeFormat:{hour:"numeric",minute:"2-digit"},firstDay:0,flexibleSlotTimeLimits:!1,headerToolbar:{start:"title",center:"",end:"today prev,next"},height:void 0,hiddenDays:[],highlightedDates:[],lazyFetching:!0,loading:void 0,locale:void 0,nowIndicator:!1,selectable:!1,scrollTime:"06:00:00",slotDuration:"00:30:00",slotEventOverlap:!0,slotHeight:24,slotLabelFormat:{hour:"numeric",minute:"2-digit"},slotMaxTime:"24:00:00",slotMinTime:"00:00:00",theme:{allDay:"ec-all-day",active:"ec-active",bgEvent:"ec-bg-event",bgEvents:"ec-bg-events",body:"ec-body",button:"ec-button",buttonGroup:"ec-button-group",calendar:"ec",compact:"ec-compact",content:"ec-content",day:"ec-day",dayHead:"ec-day-head",days:"ec-days",event:"ec-event",eventBody:"ec-event-body",eventTime:"ec-event-time",eventTitle:"ec-event-title",events:"ec-events",extra:"ec-extra",handle:"ec-handle",header:"ec-header",hiddenScroll:"ec-hidden-scroll",highlight:"ec-highlight",icon:"ec-icon",line:"ec-line",lines:"ec-lines",nowIndicator:"ec-now-indicator",otherMonth:"ec-other-month",sidebar:"ec-sidebar",sidebarTitle:"ec-sidebar-title",today:"ec-today",time:"ec-time",title:"ec-title",toolbar:"ec-toolbar",view:"",weekdays:["ec-sun","ec-mon","ec-tue","ec-wed","ec-thu","ec-fri","ec-sat"],withScroll:"ec-with-scroll"},titleFormat:{year:"numeric",month:"short",day:"numeric"},view:void 0,viewDidMount:void 0,views:{}};for(let n of t)(i=n.createOptions)==null||i.call(n,e);return e}function KJe(t){var i;let e={date:n=>Sm(by(n)),duration:Xg,events:BN,eventSources:OJe,hiddenDays:n=>[...new Set(n)],highlightedDates:n=>n.map(by),scrollTime:Xg,slotDuration:Xg,slotMaxTime:Xg,slotMinTime:Xg};for(let n of t)(i=n.createParsers)==null||i.call(n,e);return e}function ZJe(t,e){let i=[];for(let n of hm(t))t[n]!==e[n]&&i.push([n,t[n]]);return Ub(e,t),i}function XJe(t){return Fd(t.view,e=>e==null?void 0:e.startsWith("dayGrid"))}function JJe(t){return Fd([t._currentRange,t.firstDay,t.slotMaxTime,t._dayGrid],([e,i,n,r])=>{let o=Cr(e.start),a=Cr(e.end);if(r)pwe(o,i),PJe(a,i);else if(n.days||n.seconds>DJe){nd(Ww(a),n);let s=Ww(Cr(a));s<o&&(o=s)}return{start:o,end:a}})}function QJe(t){return Fd([t.date,t.duration,t.firstDay,t._dayGrid],([e,i,n,r])=>{let o=Cr(e),a;return r?o.setUTCDate(1):i.inWeeks&&pwe(o,n),a=nd(Cr(o),i),{start:o,end:a}})}function eQe(t){return Fd([t._activeRange,t.hiddenDays],([e,i])=>{let n=[],r=Sm(Cr(e.start)),o=Sm(Cr(e.end));for(;r<o;)i.includes(r.getUTCDay())||n.push(Cr(r)),tg(r);return!n.length&&i.length&&i.length<7&&(t.date.update(a=>{for(;i.includes(a.getUTCDay());)tg(a);return a}),n=ON(t._viewDates)),n})}function tQe(t){return Fd([t.date,t._activeRange,t._intlTitle,t._dayGrid],([e,i,n,r])=>r?n.formatRange(e,e):n.formatRange(i.start,Ww(Cr(i.end))))}function iQe(t){return Fd([t.view,t._viewTitle,t._currentRange,t._activeRange],e=>kJe(...e))}function nQe(t){let e=Zo([]),i,n=0,r={};return Fd([t.events,t.eventSources,t._activeRange,t._fetchedRange,t.lazyFetching,t.loading],(o,a)=>p5(()=>{let[s,l,c,u,d,p]=o;if(!l.length){a(s);return}if(!u.start||u.start>c.start||u.end<c.end||!d){i&&i.abort(),i=new AbortController,$i(p)&&!n&&p(!0);let h=()=>{--n===0&&$i(p)&&p(!1)},f=[],m=b=>h(),g=b=>{f=f.concat(BN(b)),a(f),h()},v=vu(c.start),y=vu(c.end);for(let b of l){if($i(b.events)){let I=b.events({start:kl(c.start),end:kl(c.end),startStr:v,endStr:y},g,m);I!==void 0&&Promise.resolve(I).then(g,m)}else{let I=$i(b.extraParams)?b.extraParams():Ub({},b.extraParams);I.start=v,I.end=y,I=new URLSearchParams(I);let T=b.url,S={},w;["GET","HEAD"].includes(b.method)?T+=(T.includes("?")?"&":"?")+I:(S["content-type"]="application/x-www-form-urlencoded;charset=UTF-8",w=String(I)),fetch(T,{method:b.method,headers:S,body:w,signal:i.signal,credentials:"same-origin"}).then(U=>U.json()).then(g).catch(m)}++n}u.start=c.start,u.end=c.end}},r,t._queue),[]).subscribe(e.set),e}function rQe(){return uwe(by(),t=>{let e=setInterval(()=>{t(by())},1e3);return()=>clearInterval(e)})}function oQe(t){return Fd(t._now,e=>Sm(Cr(e)))}class aQe{constructor(e,i){var a,s;e=e||[];let n=YJe(e),r=KJe(e);n=O$(n,r),i=O$(i,r);for(let[l,c]of Object.entries(n))this[l]=Zo(c);this._queue=Zo(new Map),this._queue2=Zo(new Map),this._tasks=new Map,this._auxiliary=Zo([]),this._dayGrid=XJe(this),this._currentRange=QJe(this),this._activeRange=JJe(this),this._fetchedRange=Zo({start:void 0,end:void 0}),this._events=nQe(this),this._now=rQe(),this._today=oQe(this),this._intlEventTime=FX(this.locale,this.eventTimeFormat),this._intlSlotLabel=ET(this.locale,this.slotLabelFormat),this._intlDayHeader=ET(this.locale,this.dayHeaderFormat),this._intlDayHeaderAL=ET(this.locale,this.dayHeaderAriaLabelFormat),this._intlTitle=FX(this.locale,this.titleFormat),this._bodyEl=Zo(void 0),this._scrollable=Zo(!1),this._viewTitle=tQe(this),this._viewDates=eQe(this),this._view=iQe(this),this._viewComponent=Zo(void 0),this._resBgColor=Zo(Fr),this._resTxtColor=Zo(Fr),this._interaction=Zo({}),this._iEvents=Zo([null,null]),this._iClasses=Zo(cJe),this._iClass=Zo(void 0),this._set=(l,c)=>{L$(l,this)&&(r[l]&&(c=r[l](c)),this[l].set(c))},this._get=l=>L$(l,this)?ON(this[l]):void 0;for(let l of e)(a=l.createStores)==null||a.call(l,this);i.view&&this.view.set(i.view);let o=new Set([...hm(n.views),...hm(i.views??{})]);for(let l of o){let c=BX(n,n.views[l]??{}),u=BX(c,i,((s=i.views)==null?void 0:s[l])??{}),d=u.component;sQe(u,this);for(let p of hm(u)){let{set:h,_set:f=h,...m}=this[p];this[p]={set:["buttonText","theme"].includes(p)?g=>{if($i(g)){let v=g(c[p]);u[p]=v,h(h===f?v:g)}else u[p]=g,h(g)}:g=>{u[p]=g,h(g)},_set:f,...m}}this.view.subscribe(p=>{if(p===l){this._viewComponent.set(d),$i(u.viewDidMount)&&d5().then(()=>u.viewDidMount(ON(this._view)));for(let h of hm(u))this[h]._set(u[h])}})}}}function O$(t,e){let i={...t};for(let n of hm(e))n in i&&(i[n]=e[n](i[n]));if(t.views){i.views={};for(let n of hm(t.views))i.views[n]=O$(t.views[n],e)}return i}function BX(...t){let e={};for(let i of t){let n={};for(let r of["buttonText","theme"])$i(i[r])&&(n[r]=i[r](e[r]));e={...e,...i,...n}}return e}function sQe(t,e){hm(t).filter(i=>!L$(i,e)||i=="view").forEach(i=>delete t[i])}function L$(t,e){return e.hasOwnProperty(t)&&t[0]!=="_"}function $X(t,e,i){const n=t.slice();return n[23]=e[i],n}function lQe(t){let e,i=t[5][t[23]]+"",n,r,o,a;function s(){return t[20](t[23])}return{c(){e=Rn("button"),n=n1(i),st(e,"class",r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])},m(l,c){xn(l,e,c),dr(e,n),o||(a=In(e,"click",s),o=!0)},p(l,c){t=l,c&33&&i!==(i=t[5][t[23]]+"")&&nwe(n,i),c&73&&r!==(r=t[3].button+(t[6]===t[23]?" "+t[3].active:"")+" ec-"+t[23])&&st(e,"class",r)},d(l){l&&An(e),o=!1,a()}}}function cQe(t){let e,i=t[5][t[23]]+"",n,r,o,a;return{c(){e=Rn("button"),n=n1(i),st(e,"class",r=t[3].button+" ec-"+t[23]),e.disabled=t[1]},m(s,l){xn(s,e,l),dr(e,n),o||(a=In(e,"click",t[19]),o=!0)},p(s,l){l&33&&i!==(i=s[5][s[23]]+"")&&nwe(n,i),l&9&&r!==(r=s[3].button+" ec-"+s[23])&&st(e,"class",r),l&2&&(e.disabled=s[1])},d(s){s&&An(e),o=!1,a()}}}function uQe(t){let e,i,n,r,o,a,s,l;return{c(){e=Rn("button"),i=Rn("i"),st(i,"class",n=t[3].icon+" ec-"+t[23]),st(e,"class",r=t[3].button+" ec-"+t[23]),st(e,"aria-label",o=t[5].next),st(e,"title",a=t[5].next)},m(c,u){xn(c,e,u),dr(e,i),s||(l=In(e,"click",t[17]),s=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[23])&&st(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[23])&&st(e,"class",r),u&32&&o!==(o=c[5].next)&&st(e,"aria-label",o),u&32&&a!==(a=c[5].next)&&st(e,"title",a)},d(c){c&&An(e),s=!1,l()}}}function dQe(t){let e,i,n,r,o,a,s,l;return{c(){e=Rn("button"),i=Rn("i"),st(i,"class",n=t[3].icon+" ec-"+t[23]),st(e,"class",r=t[3].button+" ec-"+t[23]),st(e,"aria-label",o=t[5].prev),st(e,"title",a=t[5].prev)},m(c,u){xn(c,e,u),dr(e,i),s||(l=In(e,"click",t[16]),s=!0)},p(c,u){u&9&&n!==(n=c[3].icon+" ec-"+c[23])&&st(i,"class",n),u&9&&r!==(r=c[3].button+" ec-"+c[23])&&st(e,"class",r),u&32&&o!==(o=c[5].prev)&&st(e,"aria-label",o),u&32&&a!==(a=c[5].prev)&&st(e,"title",a)},d(c){c&&An(e),s=!1,l()}}}function pQe(t){let e,i,n,r,o;return{c(){e=Rn("h2"),st(e,"class",i=t[3].title)},m(a,s){xn(a,e,s),r||(o=yy(n=rS.call(null,e,t[4])),r=!0)},p(a,s){s&8&&i!==(i=a[3].title)&&st(e,"class",i),n&&$i(n.update)&&s&16&&n.update.call(null,a[4])},d(a){a&&An(e),r=!1,o()}}}function VX(t){let e;function i(o,a){if(o[23]=="title")return pQe;if(o[23]=="prev")return dQe;if(o[23]=="next")return uQe;if(o[23]=="today")return cQe;if(o[23]!="")return lQe}let n=i(t),r=n&&n(t);return{c(){r&&r.c(),e=sh()},m(o,a){r&&r.m(o,a),xn(o,e,a)},p(o,a){n===(n=i(o))&&r?r.p(o,a):(r&&r.d(1),r=n&&n(o),r&&(r.c(),r.m(e.parentNode,e)))},d(o){o&&An(e),r&&r.d(o)}}}function hQe(t){let e,i=za(t[0]),n=[];for(let r=0;r<i.length;r+=1)n[r]=VX($X(t,i,r));return{c(){for(let r=0;r<n.length;r+=1)n[r].c();e=sh()},m(r,o){for(let a=0;a<n.length;a+=1)n[a]&&n[a].m(r,o);xn(r,e,o)},p(r,[o]){if(o&229503){i=za(r[0]);let a;for(a=0;a<i.length;a+=1){const s=$X(r,i,a);n[a]?n[a].p(s,o):(n[a]=VX(s),n[a].c(),n[a].m(e.parentNode,e))}for(;a<n.length;a+=1)n[a].d(1);n.length=i.length}},i:Fr,o:Fr,d(r){r&&An(e),Tb(n,r)}}}function fQe(t,e,i){let n,r,o,a,s,l,c,u,{buttons:d}=e,{_currentRange:p,_viewTitle:h,buttonText:f,date:m,duration:g,hiddenDays:v,theme:y,view:b}=ac("state");qe(t,p,E=>i(18,a=E)),qe(t,h,E=>i(4,l=E)),qe(t,f,E=>i(5,c=E)),qe(t,m,E=>i(2,r=E)),qe(t,g,E=>i(21,n=E)),qe(t,v,E=>i(22,o=E)),qe(t,y,E=>i(3,s=E)),qe(t,b,E=>i(6,u=E));let I=Sm(by()),T;function S(){let E=dwe(r,n);if(o.length&&o.length<7)for(;o.includes(E.getUTCDay());)Ww(E);tr(m,r=E,r)}function w(){tr(m,r=nd(r,n),r)}const U=()=>tr(m,r=Cr(I),r),D=E=>tr(b,u=E,u);return t.$$set=E=>{"buttons"in E&&i(0,d=E.buttons)},t.$$.update=()=>{t.$$.dirty&262144&&i(1,T=I>=a.start&&I<a.end||null)},[d,T,r,s,l,c,u,p,h,f,m,g,v,y,b,I,S,w,a,U,D]}class vwe extends Sl{constructor(e){super(),wl(this,e,fQe,hQe,Os,{buttons:0})}}function jX(t,e,i){const n=t.slice();return n[5]=e[i],n}function HX(t,e,i){const n=t.slice();return n[8]=e[i],n}function mQe(t){let e,i;return e=new vwe({props:{buttons:t[8]}}),{c(){Ho(e.$$.fragment)},m(n,r){Eo(e,n,r),i=!0},p(n,r){const o={};r&1&&(o.buttons=n[8]),e.$set(o)},i(n){i||(Jt(e.$$.fragment,n),i=!0)},o(n){Ai(e.$$.fragment,n),i=!1},d(n){go(e,n)}}}function gQe(t){let e,i,n,r;return i=new vwe({props:{buttons:t[8]}}),{c(){e=Rn("div"),Ho(i.$$.fragment),st(e,"class",n=t[1].buttonGroup)},m(o,a){xn(o,e,a),Eo(i,e,null),r=!0},p(o,a){const s={};a&1&&(s.buttons=o[8]),i.$set(s),(!r||a&2&&n!==(n=o[1].buttonGroup))&&st(e,"class",n)},i(o){r||(Jt(i.$$.fragment,o),r=!0)},o(o){Ai(i.$$.fragment,o),r=!1},d(o){o&&An(e),go(i)}}}function GX(t){let e,i,n,r;const o=[gQe,mQe],a=[];function s(l,c){return l[8].length>1?0:1}return e=s(t),i=a[e]=o[e](t),{c(){i.c(),n=sh()},m(l,c){a[e].m(l,c),xn(l,n,c),r=!0},p(l,c){let u=e;e=s(l),e===u?a[e].p(l,c):(Js(),Ai(a[u],1,1,()=>{a[u]=null}),Qs(),i=a[e],i?i.p(l,c):(i=a[e]=o[e](l),i.c()),Jt(i,1),i.m(n.parentNode,n))},i(l){r||(Jt(i),r=!0)},o(l){Ai(i),r=!1},d(l){l&&An(n),a[e].d(l)}}}function zX(t){let e,i,n,r=za(t[0][t[5]]),o=[];for(let s=0;s<r.length;s+=1)o[s]=GX(HX(t,r,s));const a=s=>Ai(o[s],1,1,()=>{o[s]=null});return{c(){e=Rn("div");for(let s=0;s<o.length;s+=1)o[s].c();i=Ws()},m(s,l){xn(s,e,l);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);dr(e,i),n=!0},p(s,l){if(l&3){r=za(s[0][s[5]]);let c;for(c=0;c<r.length;c+=1){const u=HX(s,r,c);o[c]?(o[c].p(u,l),Jt(o[c],1)):(o[c]=GX(u),o[c].c(),Jt(o[c],1),o[c].m(e,i))}for(Js(),c=r.length;c<o.length;c+=1)a(c);Qs()}},i(s){if(!n){for(let l=0;l<r.length;l+=1)Jt(o[l]);n=!0}},o(s){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)Ai(o[l]);n=!1},d(s){s&&An(e),Tb(o,s)}}}function vQe(t){let e,i,n,r=za(Object.keys(t[0])),o=[];for(let s=0;s<r.length;s+=1)o[s]=zX(jX(t,r,s));const a=s=>Ai(o[s],1,1,()=>{o[s]=null});return{c(){e=Rn("nav");for(let s=0;s<o.length;s+=1)o[s].c();st(e,"class",i=t[1].toolbar)},m(s,l){xn(s,e,l);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(e,null);n=!0},p(s,[l]){if(l&3){r=za(Object.keys(s[0]));let c;for(c=0;c<r.length;c+=1){const u=jX(s,r,c);o[c]?(o[c].p(u,l),Jt(o[c],1)):(o[c]=zX(u),o[c].c(),Jt(o[c],1),o[c].m(e,null))}for(Js(),c=r.length;c<o.length;c+=1)a(c);Qs()}(!n||l&2&&i!==(i=s[1].toolbar))&&st(e,"class",i)},i(s){if(!n){for(let l=0;l<r.length;l+=1)Jt(o[l]);n=!0}},o(s){o=o.filter(Boolean);for(let l=0;l<o.length;l+=1)Ai(o[l]);n=!1},d(s){s&&An(e),Tb(o,s)}}}function yQe(t,e,i){let n,r,{headerToolbar:o,theme:a}=ac("state");qe(t,o,l=>i(4,n=l)),qe(t,a,l=>i(1,r=l));let s={start:[],center:[],end:[]};return t.$$.update=()=>{if(t.$$.dirty&17)for(let l of Object.keys(s))i(0,s[l]=n[l].split(" ").map(c=>c.split(",")),s)},[s,r,o,a,n]}class bQe extends Sl{constructor(e){super(),wl(this,e,yQe,vQe,Os,{})}}function WX(t,e,i){const n=t.slice();return n[11]=e[i],n}function qX(t){let e,i,n;var r=t[11];function o(a,s){return{}}return r&&(e=zw(r,o())),{c(){e&&Ho(e.$$.fragment),i=sh()},m(a,s){e&&Eo(e,a,s),xn(a,i,s),n=!0},p(a,s){if(s&1&&r!==(r=a[11])){if(e){Js();const l=e;Ai(l.$$.fragment,1,0,()=>{go(l,1)}),Qs()}r?(e=zw(r,o()),Ho(e.$$.fragment),Jt(e.$$.fragment,1),Eo(e,i.parentNode,i)):e=null}},i(a){n||(e&&Jt(e.$$.fragment,a),n=!0)},o(a){e&&Ai(e.$$.fragment,a),n=!1},d(a){a&&An(i),e&&go(e,a)}}}function IQe(t){let e,i,n=za(t[0]),r=[];for(let a=0;a<n.length;a+=1)r[a]=qX(WX(t,n,a));const o=a=>Ai(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=sh()},m(a,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(a,s);xn(a,e,s),i=!0},p(a,[s]){if(s&1){n=za(a[0]);let l;for(l=0;l<n.length;l+=1){const c=WX(a,n,l);r[l]?(r[l].p(c,s),Jt(r[l],1)):(r[l]=qX(c),r[l].c(),Jt(r[l],1),r[l].m(e.parentNode,e))}for(Js(),l=n.length;l<r.length;l+=1)o(l);Qs()}},i(a){if(!i){for(let s=0;s<n.length;s+=1)Jt(r[s]);i=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Ai(r[s]);i=!1},d(a){a&&An(e),Tb(r,a)}}}function wQe(t,e,i){let n,r,o,a,{datesSet:s,_auxiliary:l,_activeRange:c,_queue:u,_view:d}=ac("state");qe(t,s,f=>i(7,r=f)),qe(t,l,f=>i(0,a=f)),qe(t,c,f=>i(5,o=f)),qe(t,d,f=>i(6,n=f));let p={};function h(f){$i(r)&&p5(()=>r({start:kl(f.start),end:kl(f.end),startStr:vu(f.start),endStr:vu(f.end),view:vc(n)}),p,u)}return t.$$.update=()=>{t.$$.dirty&32&&h(o)},[a,s,l,c,d,o]}let SQe=class extends Sl{constructor(e){super(),wl(this,e,wQe,IQe,Os,{})}};function TQe(t){let e,i,n,r,o,a,s,l,c,u,d;i=new bQe({});var p=t[5];function h(f,m){return{}}return p&&(r=zw(p,h())),l=new SQe({}),{c(){e=Rn("div"),Ho(i.$$.fragment),n=Ws(),r&&Ho(r.$$.fragment),s=Ws(),Ho(l.$$.fragment),st(e,"class",o=t[1].calendar+" "+t[1].view+(t[0]?" "+t[1].withScroll:"")+(t[2]?" "+t[1][t[2]]:"")),st(e,"role",a=k$(t[4])?"list":"table"),MX(e,"height",t[3])},m(f,m){xn(f,e,m),Eo(i,e,null),dr(e,n),r&&Eo(r,e,null),xn(f,s,m),Eo(l,f,m),c=!0,u||(d=In(window,"resize",t[17]),u=!0)},p(f,m){if(m[0]&32&&p!==(p=f[5])){if(r){Js();const g=r;Ai(g.$$.fragment,1,0,()=>{go(g,1)}),Qs()}p?(r=zw(p,h()),Ho(r.$$.fragment),Jt(r.$$.fragment,1),Eo(r,e,null)):r=null}(!c||m[0]&7&&o!==(o=f[1].calendar+" "+f[1].view+(f[0]?" "+f[1].withScroll:"")+(f[2]?" "+f[1][f[2]]:"")))&&st(e,"class",o),(!c||m[0]&16&&a!==(a=k$(f[4])?"list":"table"))&&st(e,"role",a),m[0]&8&&MX(e,"height",f[3])},i(f){c||(Jt(i.$$.fragment,f),r&&Jt(r.$$.fragment,f),Jt(l.$$.fragment,f),c=!0)},o(f){Ai(i.$$.fragment,f),r&&Ai(r.$$.fragment,f),Ai(l.$$.fragment,f),c=!1},d(f){f&&(An(e),An(s)),go(i),r&&go(r),go(l,f),u=!1,d()}}}function UQe(t,e,i){let n,r,o,a,s,l,c,u,d,p,h,{plugins:f=[]}=e,{options:m={}}=e,g=nS(),v=new aQe(f,m);IJe("state",v);let{_viewComponent:y,_bodyEl:b,_interaction:I,_iClass:T,_events:S,_queue:w,_queue2:U,_tasks:D,_scrollable:E,height:C,theme:M,view:N}=v;qe(t,y,Z=>i(5,h=Z)),qe(t,b,Z=>i(32,n=Z)),qe(t,I,Z=>i(35,s=Z)),qe(t,T,Z=>i(2,u=Z)),qe(t,S,Z=>i(36,l=Z)),qe(t,w,Z=>i(34,a=Z)),qe(t,U,Z=>i(33,o=Z)),qe(t,E,Z=>i(0,r=Z)),qe(t,C,Z=>i(3,d=Z)),qe(t,M,Z=>i(1,c=Z)),qe(t,N,Z=>i(4,p=Z));let R={...m};function A(Z,Y){return v._set(Z,Y),this}function _(Z){let Y=v._get(Z);return Y instanceof Date?kl(Y):Y}function k(){return v._fetchedRange.set({start:void 0,end:void 0}),this}function O(){return l.map(Qu)}function F(Z){for(let Y of l)if(Y.id==Z)return Qu(Y);return null}function B(Z){return l.push(BN([Z])[0]),S.set(l),this}function $(Z){for(let Y of l)if(Y.id==Z.id){Ub(Y,BN([Z])[0]),S.set(l);break}return this}function V(Z){let Y=l.findIndex(X=>X.id==Z);return Y>=0&&(l.splice(Y,1),S.set(l)),this}function H(){return vc(ON(v._view))}function z(){return s.action&&s.action.unselect(),this}function G(Z,Y){let X=CT(Z,Y);return X?hM(X)(Y):null}function W(){go(g,!0)}yJe(()=>{_X(a)}),rwe(()=>{_X(o),hwe(K,null,D)});function K(){n&&tr(E,r=NJe(n),r)}return t.$$set=Z=>{"plugins"in Z&&i(18,f=Z.plugins),"options"in Z&&i(19,m=Z.options)},t.$$.update=()=>{if(t.$$.dirty[0]&524288)for(let[Z,Y]of ZJe(m,R))A(Z,Y)},[r,c,u,d,p,h,y,b,I,T,S,w,U,E,C,M,N,K,f,m,A,_,k,O,F,B,$,V,H,z,G,W]}class DQe extends Sl{constructor(e){super(),wl(this,e,UQe,TQe,Os,{plugins:18,options:19,setOption:20,getOption:21,refetchEvents:22,getEvents:23,getEventById:24,addEvent:25,updateEvent:26,removeEventById:27,getView:28,unselect:29,dateFromPoint:30,destroy:31},null,[-1,-1])}get setOption(){return this.$$.ctx[20]}get getOption(){return this.$$.ctx[21]}get refetchEvents(){return this.$$.ctx[22]}get getEvents(){return this.$$.ctx[23]}get getEventById(){return this.$$.ctx[24]}get addEvent(){return this.$$.ctx[25]}get updateEvent(){return this.$$.ctx[26]}get removeEventById(){return this.$$.ctx[27]}get getView(){return this.$$.ctx[28]}get unselect(){return this.$$.ctx[29]}get dateFromPoint(){return this.$$.ctx[30]}get destroy(){return this.$$.ctx[31]}}let TF=!1;function PQe(t){TF||(TF=!0,window.requestAnimationFrame(()=>{t(),TF=!1}))}function YX(t,e,i){return fI(e,KS(i,t))}const{window:Zf}=gJe;function CQe(t){let e,i;return{c:Fr,m(n,r){e||(i=[In(Zf,"pointermove",t[31]),In(Zf,"pointerup",t[32]),In(Zf,"pointercancel",t[32]),In(Zf,"scroll",t[0]),In(Zf,"selectstart",fM(t[33])),In(Zf,"contextmenu",function(){$i(fM(t[41]))&&fM(t[41]).apply(this,arguments)}),In(Zf,"touchstart",t[34]),In(Zf,"touchmove",t[40],{passive:!1})],e=!0)},p(n,r){t=n},i:Fr,o:Fr,d(n){e=!1,Il(i)}}}const KX=1,ZX=2,XX=3,UF=4,yE=5;function JX(t){return t.isPrimary&&(t.pointerType!=="mouse"||t.buttons&1)}function fM(t){return e=>{t()&&e.preventDefault()}}function EQe(t,e,i){let n,r,o,a,s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,S,w,U,D,E,C,M,N,R,A,{_iEvents:_,_iClass:k,_events:O,_view:F,_dayGrid:B,_draggable:$,dateClick:V,dragScroll:H,datesAboveResources:z,eventDragMinDistance:G,eventDragStart:W,eventDragStop:K,eventDrop:Z,eventLongPressDelay:Y,eventResizeStart:X,eventResizeStop:Q,eventResize:te,longPressDelay:J,selectable:ie,select:oe,selectBackgroundColor:ne,selectLongPressDelay:re,selectMinDistance:me,slotDuration:he,slotHeight:be,unselect:Se,unselectAuto:De,unselectCancel:Oe,view:xe}=ac("state");qe(t,_,Ze=>i(69,a=Ze)),qe(t,k,Ze=>i(72,c=Ze)),qe(t,O,Ze=>i(68,o=Ze)),qe(t,F,Ze=>i(66,n=Ze)),qe(t,B,Ze=>i(71,l=Ze)),qe(t,$,Ze=>i(94,A=Ze)),qe(t,V,Ze=>i(73,u=Ze)),qe(t,H,Ze=>i(82,b=Ze)),qe(t,z,Ze=>i(90,C=Ze)),qe(t,G,Ze=>i(85,S=Ze)),qe(t,W,Ze=>i(83,I=Ze)),qe(t,K,Ze=>i(76,h=Ze)),qe(t,Z,Ze=>i(74,d=Ze)),qe(t,Y,Ze=>i(88,D=Ze)),qe(t,X,Ze=>i(84,T=Ze)),qe(t,Q,Ze=>i(77,f=Ze)),qe(t,te,Ze=>i(75,p=Ze)),qe(t,J,Ze=>i(87,U=Ze)),qe(t,ie,Ze=>i(93,R=Ze)),qe(t,oe,Ze=>i(78,m=Ze)),qe(t,ne,Ze=>i(70,s=Ze)),qe(t,re,Ze=>i(89,E=Ze)),qe(t,me,Ze=>i(86,w=Ze)),qe(t,he,Ze=>i(91,M=Ze)),qe(t,be,Ze=>i(81,y=Ze)),qe(t,Se,Ze=>i(67,r=Ze)),qe(t,De,Ze=>i(80,v=Ze)),qe(t,Oe,Ze=>i(79,g=Ze)),qe(t,xe,Ze=>i(92,N=Ze));let $e,Ae,ve,ke,ye,Ie,Ne,Fe,Le,ge,Ee,we,fe,Te,ue,de,_e,Ue,Ce,We,He,Be,et,ot,mt;function Rt(Ze,yt,pi,cr){$e||($e=JX(yt)?pi?ZX:A(Ze)?KX:yE:yE,Ma()&&(ve=Ze,_t(yt),cr&&(ye=cr),Ce=pi?Ue?"resizingX":"resizingY":"dragging",pi&&(We=Cr(ve.start),Ue?(We.setUTCHours(ve.end.getUTCHours(),ve.end.getUTCMinutes(),ve.end.getUTCSeconds(),0),We<ve.start&&tg(We)):nd(We,M)),pt(yt)))}function Ft(Ze){$e||($e=JX(Ze)?R&&!k$(N)?XX:UF:yE,Ma()&&(_t(Ze),Ce="selecting",He=Ue?Xg({day:1}):M,ve={allDay:Ue,start:ye,end:nd(Cr(ye),He),resourceIds:Ne?[Ne.id]:[]},pt(Ze)))}function Je(){$e||($e=yE)}function _t(Ze){window.getSelection().removeAllRanges(),Le=Ee=Ze.clientX,ge=we=Ze.clientY;let yt=CT(Ee,we);({allDay:Ue,date:ye,resource:Ne}=hM(yt)(we)),fe=sD(yt,Ne?4:3),ue=sD(yt,Ne&&(Gr()||C)?2:1),Zi(),Ze.pointerType!=="mouse"&&i(1,ot=setTimeout(()=>{$e&&(Ae=!0,pt(Ze))},(ga()?E:D)??U))}function pt(Ze){if(Ae||Ze&&Ze.pointerType==="mouse"&&_n()>=(ga()?w:S)){Ae=!0,er(Ze),tr(k,c=Ce,c),a[0]||(ga()?wi():Xi(Ze,qo()?T:I));let yt=Ht();if(yt){let pi;({allDay:pi,date:Ie,resource:Fe}=hM(yt)(we)),pi===Ue&&(_e=Xg((Ie-ye)/1e3),tr(_,a[0].end=nd(Cr(ve.end),_e),a),qo()?a[0].end<We&&tr(_,a[0].end=We,a):ga()?a[0].end<ve.end?(tr(_,a[0].start=dwe(a[0].end,He),a),tr(_,a[0].end=ve.end,a)):tr(_,a[0].start=ve.start,a):(tr(_,a[0].start=nd(Cr(ve.start),_e),a),Ne&&(tr(_,a[0].resourceIds=ve.resourceIds.filter(cr=>cr!==Ne.id),a),a[0].resourceIds.push(Fe.id))))}}if(b){let yt=y*2;PQe(()=>{fe&&(we<yt&&window.scrollBy(0,fI(-10,(we-yt)/3)),we<Te.top+yt&&(fe.scrollTop+=fI(-10,(we-Te.top-yt)/3)),we>window.innerHeight-yt&&window.scrollBy(0,KS(10,(we-window.innerHeight+yt)/3)),we>Te.bottom-yt&&(fe.scrollTop+=KS(10,(we-Te.bottom+yt)/3)))})}}function Ke(){Ma()&&(Zi(),pt())}function ci(Ze){Ma()&&Ze.isPrimary&&(Ee=Ze.clientX,we=Ze.clientY,pt(Ze))}function ni(Ze){if(Be&&v&&!(g&&Ze.target.closest(g))&&er(Ze),$e&&Ze.isPrimary){if(Ae)if(ga()){if(Be=!0,$i(m)){let{start:yt,end:pi}=Qu(a[0]);m({start:yt,end:pi,startStr:vu(a[0].start),endStr:vu(a[0].end),allDay:Ue,jsEvent:Ze,view:vc(n),resource:Ne})}}else{ve.display=ke;let yt=qo()?f:h;$i(yt)&&yt({event:Qu(ve),jsEvent:Ze,view:vc(n)});let pi=xX(ve);if(Yt(ve,a[0]),Ji(),yt=qo()?p:d,$i(yt)){let cr=ve,va;qo()?va={endDelta:_e}:va={delta:_e,oldResource:Ne!==Fe?Ne:void 0,newResource:Ne!==Fe?Fe:void 0},yt(Ub(va,{event:Qu(ve),oldEvent:Qu(pi),jsEvent:Ze,view:vc(n),revert(){Yt(cr,pi)}}))}}else if((Ea()||ga())&&$i(u)&&!et){Ee=Ze.clientX,we=Ze.clientY;let yt=CT(Ee,we);if(yt){let{allDay:pi,date:cr,resource:va}=hM(yt)(we);u({allDay:pi,date:kl(cr),dateStr:vu(cr),dayEl:yt,jsEvent:Ze,view:vc(n),resource:va})}}Ae=!1,$e=Le=ge=Ee=we=ve=ke=ye=Ie=Ne=Fe=_e=Ue=tr(k,c=We=He=void 0,c),fe=ue=Te=de=void 0,ot&&(clearTimeout(ot),i(1,ot=void 0))}et=!1}function Ht(){return CT(YX(Ee,mt[0],mt[1]),YX(we,mt[2],mt[3]))}function Zi(){Te=Tm(fe),de=Tm(ue),mt=[fI(0,de.left+(l?0:8)),KS(document.documentElement.clientWidth,de.right)-2,fI(0,Te.top),KS(document.documentElement.clientHeight,Te.bottom)-2]}function Xi(Ze,yt){$i(yt)&&yt({event:Qu(ve),jsEvent:Ze,view:vc(n)}),ke=ve.display,ve.display="preview",tr(_,a[0]=xX(ve),a),ve.display="ghost",O.set(o)}function wi(){tr(_,a[0]={id:"{select}",allDay:ve.allDay,start:ve.start,title:"",display:"preview",extendedProps:{},backgroundColor:s,resourceIds:ve.resourceIds},a)}function Ji(){tr(_,a[0]=null,a)}function Yt(Ze,yt){Ze.start=yt.start,Ze.end=yt.end,Ze.resourceIds=yt.resourceIds,O.set(o)}function _n(){return Math.sqrt(Math.pow(Ee-Le,2)+Math.pow(we-ge,2))}function Gr(){return $e===KX}function qo(){return $e===ZX}function Ea(){return $e===UF}function ga(){return $e===XX}function Ma(){return $e&&$e<UF}function er(Ze){Be&&(Be=!1,Ji(),$i(r)&&r({jsEvent:Ze,view:vc(n)}))}function Gt(){et=!0}F.subscribe(er);function Jc(Ze){if(Ma()){let yt=Ze.target,pi=[],cr=()=>Il(pi);pi.push(In(yt,"touchmove",fM(()=>Ae))),pi.push(In(yt,"touchend",cr)),pi.push(In(yt,"touchcancel",cr))}}function sc(Ze){aO.call(this,t,Ze)}return[Ke,ot,_,k,O,F,B,$,V,H,z,G,W,K,Z,Y,X,Q,te,J,ie,oe,ne,re,me,he,be,Se,De,Oe,xe,ci,ni,Ma,Jc,Rt,Ft,Je,er,Gt,sc,()=>ot]}class MQe extends Sl{constructor(e){super(),wl(this,e,EQe,CQe,Os,{drag:35,select:36,noAction:37,handleScroll:0,unselect:38,noClick:39},null,[-1,-1,-1,-1])}get drag(){return this.$$.ctx[35]}get select(){return this.$$.ctx[36]}get noAction(){return this.$$.ctx[37]}get handleScroll(){return this.$$.ctx[0]}get unselect(){return this.$$.ctx[38]}get noClick(){return this.$$.ctx[39]}}function RQe(t){let e,i;return{c:Fr,m(n,r){e||(i=[In(window,"pointermove",t[5]),In(window,"scroll",t[0])],e=!0)},p:Fr,i:Fr,o:Fr,d(n){e=!1,Il(i)}}}function bE(t){return t.isPrimary&&t.pointerType==="mouse"}function NQe(t,e,i){let n,r,o,a,{_iEvents:s,_events:l,_viewDates:c,_slotTimeLimits:u,slotDuration:d,slotHeight:p,hiddenDays:h,_view:f,datesAboveResources:m,theme:g}=ac("state");qe(t,s,A=>i(9,n=A)),qe(t,u,A=>i(18,a=A)),qe(t,d,A=>i(16,r=A)),qe(t,p,A=>i(17,o=A));let v,y,b,I,T,S;function w(A,_,k,O){bE(k)&&(y=A,b=_,I=Tm(b),v=k.clientY,T=O)}function U(A,_){bE(_)&&(y=A,b=null,v=T=void 0)}function D(A){bE(A)&&R()}function E(){if(y){if(b){let A=v-I.top;S=nd(nd(Cr(y),a.min),r,MJe(A/o))}else S=y;n[1]||N(),tr(s,n[1].start=S,n),tr(s,n[1].end=nd(Cr(S),r),n),tr(s,n[1].resourceIds=T?[T.id]:[],n)}}function C(){b&&(I=Tm(b),E())}function M(A){bE(A)&&(v=A.clientY,E())}function N(){tr(s,n[1]={id:"{pointer}",title:"",display:"pointer",extendedProps:{},backgroundColor:"transparent"},n)}function R(){y=b=tr(s,n[1]=null,n)}return t.$$.update=()=>{t.$$.dirty&512&&n[0]&&R()},[C,s,u,d,p,M,w,U,D,n]}class AQe extends Sl{constructor(e){super(),wl(this,e,NQe,RQe,Os,{enterTimeGrid:6,enterDayGrid:7,leave:8,handleScroll:0})}get enterTimeGrid(){return this.$$.ctx[6]}get enterDayGrid(){return this.$$.ctx[7]}get leave(){return this.$$.ctx[8]}get handleScroll(){return this.$$.ctx[0]}}function QX(t){let e,i,n,r;return{c(){e=Rn("div"),st(e,"class",i=t[1].resizer)},m(o,a){xn(o,e,a),n||(r=In(e,"pointerdown",t[8]),n=!0)},p(o,a){a&2&&i!==(i=o[1].resizer)&&st(e,"class",i)},d(o){o&&An(e),n=!1,r()}}}function _Qe(t){let e,i=t[0]&&QX(t);return{c(){i&&i.c(),e=sh()},m(n,r){i&&i.m(n,r),xn(n,e,r)},p(n,[r]){n[0]?i?i.p(n,r):(i=QX(n),i.c(),i.m(e.parentNode,e)):i&&(i.d(1),i=null)},i:Fr,o:Fr,d(n){n&&An(e),i&&i.d(n)}}}function kQe(t,e,i){let n,r,o,{event:a}=e,{theme:s,eventDurationEditable:l,editable:c}=ac("state");qe(t,s,p=>i(1,o=p)),qe(t,l,p=>i(7,r=p)),qe(t,c,p=>i(6,n=p));let u;function d(p){aO.call(this,t,p)}return t.$$set=p=>{"event"in p&&i(5,a=p.event)},t.$$.update=()=>{t.$$.dirty&224&&i(0,u=!f5(a.display)&&!qw(a.display)&&((a.durationEditable??r)||(a.editable??n)))},[u,o,s,l,c,a,n,r,d]}class xQe extends Sl{constructor(e){super(),wl(this,e,kQe,_Qe,Os,{event:5})}}function eJ(t){let e,i,n={};return e=new AQe({props:n}),t[16](e),{c(){Ho(e.$$.fragment)},m(r,o){Eo(e,r,o),i=!0},p(r,o){const a={};e.$set(a)},i(r){i||(Jt(e.$$.fragment,r),i=!0)},o(r){Ai(e.$$.fragment,r),i=!1},d(r){t[16](null),go(e,r)}}}function OQe(t){let e,i,n,r,o={};e=new MQe({props:o}),t[15](e);let a=t[1]&&eJ(t);return{c(){Ho(e.$$.fragment),i=Ws(),a&&a.c(),n=sh()},m(s,l){Eo(e,s,l),xn(s,i,l),a&&a.m(s,l),xn(s,n,l),r=!0},p(s,[l]){const c={};e.$set(c),s[1]?a?(a.p(s,l),l&2&&Jt(a,1)):(a=eJ(s),a.c(),Jt(a,1),a.m(n.parentNode,n)):a&&(Js(),Ai(a,1,1,()=>{a=null}),Qs())},i(s){r||(Jt(e.$$.fragment,s),Jt(a),r=!0)},o(s){Ai(e.$$.fragment,s),Ai(a),r=!1},d(s){s&&(An(i),An(n)),t[15](null),go(e,s),a&&a.d(s)}}}function LQe(t,e,i){let n,r,o,a,s,l,c,u,{theme:d,editable:p,eventStartEditable:h,eventDurationEditable:f,pointer:m,_bodyEl:g,_interaction:v,_iClasses:y,_draggable:b}=ac("state");qe(t,d,w=>i(11,o=w)),qe(t,p,w=>i(13,l=w)),qe(t,h,w=>i(14,c=w)),qe(t,m,w=>i(1,u=w)),qe(t,g,w=>i(10,r=w)),qe(t,v,w=>i(0,n=w)),qe(t,y,w=>i(17,s=w)),qe(t,b,w=>i(12,a=w)),tr(v,n.resizer=xQe,n);function I(){var w;for(let U of Object.values(n))(w=U==null?void 0:U.handleScroll)==null||w.call(U)}function T(w){Op[w?"unshift":"push"](()=>{n.action=w,v.set(n)})}function S(w){Op[w?"unshift":"push"](()=>{n.pointer=w,v.set(n)})}return t.$$.update=()=>{t.$$.dirty&24576&&tr(b,a=w=>(w.startEditable??c)||(w.editable??l),a),t.$$.dirty&6144&&tr(y,s=(w,U)=>{let{display:D}=U;return qw(D)?[o[D]]:!f5(D)&&a(U)?[o.draggable]:[]},s),t.$$.dirty&1024&&r&&In(r,"scroll",I)},[n,u,d,p,h,m,g,v,y,b,r,o,a,l,c,T,S]}class FQe extends Sl{constructor(e){super(),wl(this,e,LQe,OQe,Os,{})}}var BQe={createOptions(t){t.dateClick=void 0,t.dragScroll=!0,t.editable=!1,t.eventDragMinDistance=5,t.eventDragStart=void 0,t.eventDragStop=void 0,t.eventDrop=void 0,t.eventDurationEditable=!0,t.eventLongPressDelay=void 0,t.eventResizeStart=void 0,t.eventResizeStop=void 0,t.eventResize=void 0,t.eventStartEditable=!0,t.longPressDelay=1e3,t.pointer=!1,t.select=void 0,t.selectBackgroundColor=void 0,t.selectLongPressDelay=void 0,t.selectMinDistance=5,t.unselect=void 0,t.unselectAuto=!0,t.unselectCancel="",t.theme.draggable="ec-draggable",t.theme.ghost="ec-ghost",t.theme.preview="ec-preview",t.theme.pointer="ec-pointer",t.theme.resizer="ec-resizer",t.theme.dragging="ec-dragging",t.theme.resizingY="ec-resizing-y",t.theme.resizingX="ec-resizing-x",t.theme.selecting="ec-selecting"},createStores(t){t._draggable=Zo(Fr),t._auxiliary.update(e=>[...e,FQe])}};function $Qe(t){return Fd([t.date,t.firstDay,t.hiddenDays],([e,i,n])=>{let r=[],o=Cr(e),a=7;for(;o.getUTCDay()!==i&&a;)Ww(o),--a;for(let s=0;s<7;++s)n.includes(o.getUTCDay())||r.push(Cr(o)),tg(o);return r})}function tJ(t,e,i){const n=t.slice();return n[8]=e[i],n}function iJ(t){let e,i,n,r,o,a,s,l;return{c(){var c;e=Rn("div"),i=Rn("span"),o=Ws(),st(i,"aria-label",n=t[2].format(t[8])),st(e,"class",a=t[0].day+" "+((c=t[0].weekdays)==null?void 0:c[t[8].getUTCDay()])),st(e,"role","columnheader")},m(c,u){xn(c,e,u),dr(e,i),dr(e,o),s||(l=yy(r=rS.call(null,i,t[3].format(t[8]))),s=!0)},p(c,u){var d;t=c,u&6&&n!==(n=t[2].format(t[8]))&&st(i,"aria-label",n),r&&$i(r.update)&&u&10&&r.update.call(null,t[3].format(t[8])),u&3&&a!==(a=t[0].day+" "+((d=t[0].weekdays)==null?void 0:d[t[8].getUTCDay()]))&&st(e,"class",a)},d(c){c&&An(e),s=!1,l()}}}function VQe(t){let e,i,n,r,o,a,s,l=za(t[1]),c=[];for(let u=0;u<l.length;u+=1)c[u]=iJ(tJ(t,l,u));return{c(){e=Rn("div"),i=Rn("div");for(let u=0;u<c.length;u+=1)c[u].c();r=Ws(),o=Rn("div"),st(i,"class",n=t[0].days),st(i,"role","row"),st(o,"class",a=t[0].hiddenScroll),st(e,"class",s=t[0].header)},m(u,d){xn(u,e,d),dr(e,i);for(let p=0;p<c.length;p+=1)c[p]&&c[p].m(i,null);dr(e,r),dr(e,o)},p(u,[d]){if(d&15){l=za(u[1]);let p;for(p=0;p<l.length;p+=1){const h=tJ(u,l,p);c[p]?c[p].p(h,d):(c[p]=iJ(h),c[p].c(),c[p].m(i,null))}for(;p<c.length;p+=1)c[p].d(1);c.length=l.length}d&1&&n!==(n=u[0].days)&&st(i,"class",n),d&1&&a!==(a=u[0].hiddenScroll)&&st(o,"class",a),d&1&&s!==(s=u[0].header)&&st(e,"class",s)},i:Fr,o:Fr,d(u){u&&An(e),Tb(c,u)}}}function jQe(t,e,i){let n,r,o,a,{theme:s,_intlDayHeader:l,_intlDayHeaderAL:c,_days:u}=ac("state");return qe(t,s,d=>i(0,n=d)),qe(t,l,d=>i(3,a=d)),qe(t,c,d=>i(2,o=d)),qe(t,u,d=>i(1,r=d)),[n,r,o,a,s,l,c,u]}class HQe extends Sl{constructor(e){super(),wl(this,e,jQe,VQe,Os,{})}}function GQe(t){let e,i,n,r,o;const a=t[7].default,s=pJe(a,t,t[6],null);return{c(){e=Rn("div"),i=Rn("div"),s&&s.c(),st(i,"class",n=t[0].content),st(e,"class",r=t[0].body+(t[1]===!0?" "+t[0].uniform:""))},m(l,c){xn(l,e,c),dr(e,i),s&&s.m(i,null),t[8](e),o=!0},p(l,[c]){s&&s.p&&(!o||c&64)&&fJe(s,a,l,l[6],o?hJe(a,l[6],c,null):mJe(l[6]),null),(!o||c&1&&n!==(n=l[0].content))&&st(i,"class",n),(!o||c&3&&r!==(r=l[0].body+(l[1]===!0?" "+l[0].uniform:"")))&&st(e,"class",r)},i(l){o||(Jt(s,l),o=!0)},o(l){Ai(s,l),o=!1},d(l){l&&An(e),s&&s.d(l),t[8](null)}}}function zQe(t,e,i){let n,r,o,{$$slots:a={},$$scope:s}=e,{dayMaxEvents:l,_bodyEl:c,theme:u}=ac("state");qe(t,l,p=>i(1,r=p)),qe(t,c,p=>i(2,o=p)),qe(t,u,p=>i(0,n=p));function d(p){Op[p?"unshift":"push"](()=>{o=p,c.set(o)})}return t.$$set=p=>{"$$scope"in p&&i(6,s=p.$$scope)},[n,r,o,l,c,u,s,a,d]}class WQe extends Sl{constructor(e){super(),wl(this,e,zQe,GQe,Os,{})}}function qQe(t){let e,i,n,r,o,a,s,l,c,u,d;var p=t[8].resizer;function h(f,m){return{props:{event:f[0]}}}return p&&(a=zw(p,h(t)),a.$on("pointerdown",function(){$i(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)})),{c(){e=Rn("article"),i=Rn("div"),o=Ws(),a&&Ho(a.$$.fragment),st(i,"class",n=t[2].eventBody),st(e,"class",t[4]),st(e,"style",t[5]),st(e,"role",s=t[7]?"button":void 0),st(e,"tabindex",l=t[7]?0:void 0)},m(f,m){xn(f,e,m),dr(e,i),dr(e,o),a&&Eo(a,e,null),t[52](e),c=!0,u||(d=[yy(r=rS.call(null,i,t[6])),In(e,"click",function(){$i(t[7]||void 0)&&(t[7]||void 0).apply(this,arguments)}),In(e,"keydown",function(){$i(t[7]&&FN(t[7]))&&(t[7]&&FN(t[7])).apply(this,arguments)}),In(e,"mouseenter",function(){$i(t[32](t[9],t[1]))&&t[32](t[9],t[1]).apply(this,arguments)}),In(e,"mouseleave",function(){$i(t[32](t[10],t[1]))&&t[32](t[10],t[1]).apply(this,arguments)}),In(e,"pointerdown",function(){$i(!qw(t[1])&&t[33](t[8]))&&(!qw(t[1])&&t[33](t[8])).apply(this,arguments)})],u=!0)},p(f,m){if(t=f,(!c||m[0]&4&&n!==(n=t[2].eventBody))&&st(i,"class",n),r&&$i(r.update)&&m[0]&64&&r.update.call(null,t[6]),m[0]&256&&p!==(p=t[8].resizer)){if(a){Js();const g=a;Ai(g.$$.fragment,1,0,()=>{go(g,1)}),Qs()}p?(a=zw(p,h(t)),a.$on("pointerdown",function(){$i(t[33](t[8],!0))&&t[33](t[8],!0).apply(this,arguments)}),Ho(a.$$.fragment),Jt(a.$$.fragment,1),Eo(a,e,null)):a=null}else if(p){const g={};m[0]&1&&(g.event=t[0]),a.$set(g)}(!c||m[0]&16)&&st(e,"class",t[4]),(!c||m[0]&32)&&st(e,"style",t[5]),(!c||m[0]&128&&s!==(s=t[7]?"button":void 0))&&st(e,"role",s),(!c||m[0]&128&&l!==(l=t[7]?0:void 0))&&st(e,"tabindex",l)},i(f){c||(a&&Jt(a.$$.fragment,f),c=!0)},o(f){a&&Ai(a.$$.fragment,f),c=!1},d(f){f&&An(e),a&&go(a),t[52](null),u=!1,Il(d)}}}function YQe(t,e,i){let n,r,o,a,s,l,c,u,d,p,h,f,m,g,v,y,b,I,T,S,w,{chunk:U}=e,{longChunks:D={}}=e,{inPopup:E=!1}=e,{dayMaxEvents:C,displayEventEnd:M,eventAllUpdated:N,eventBackgroundColor:R,eventTextColor:A,eventClick:_,eventColor:k,eventContent:O,eventClassNames:F,eventDidMount:B,eventMouseEnter:$,eventMouseLeave:V,theme:H,_view:z,_intlEventTime:G,_interaction:W,_iClasses:K,_resBgColor:Z,_resTxtColor:Y,_hiddenEvents:X,_popupDate:Q,_tasks:te}=ac("state");qe(t,C,ye=>i(55,o=ye)),qe(t,M,ye=>i(44,f=ye)),qe(t,N,ye=>i(57,c=ye)),qe(t,R,ye=>i(50,I=ye)),qe(t,A,ye=>i(47,v=ye)),qe(t,_,ye=>i(40,n=ye)),qe(t,k,ye=>i(49,b=ye)),qe(t,O,ye=>i(43,h=ye)),qe(t,F,ye=>i(45,m=ye)),qe(t,B,ye=>i(58,u=ye)),qe(t,$,ye=>i(9,S=ye)),qe(t,V,ye=>i(10,w=ye)),qe(t,H,ye=>i(2,p=ye)),qe(t,z,ye=>i(41,l=ye)),qe(t,G,ye=>i(42,d=ye)),qe(t,W,ye=>i(8,s=ye)),qe(t,K,ye=>i(46,g=ye)),qe(t,Z,ye=>i(51,T=ye)),qe(t,Y,ye=>i(48,y=ye)),qe(t,X,ye=>i(54,r=ye)),qe(t,Q,ye=>i(56,a=ye));let J,ie,oe,ne,re,me,he=1,be=!1,Se,De;bJe(()=>{$i(u)&&u({event:Qu(ie),timeText:me,el:J,view:vc(l)})}),rwe(()=>{$i(c)&&!qw(Se)&&hwe(()=>c({view:vc(l)}),"eau",te)});function Oe(ye,Ie){return!qw(Ie)&&$i(ye)?Ne=>ye({event:Qu(ie),el:J,jsEvent:Ne,view:vc(l)}):void 0}function xe(ye,Ie){return ye.action?Ne=>s.action.drag(ie,Ne,Ie,E?a:void 0):void 0}function $e(){J&&(i(38,he=$Je(U,D,vE(J))),o===!0?Ae():i(39,be=!1))}function Ae(){let ye=sD(J,2),Ie=vE(ye)-vE(ye.firstElementChild)-ve(ye);i(39,be=U.bottom>Ie);let Ne=!1;for(let Fe of U.dates){let Le=r[Fe.getTime()];if(Le){let ge=Le.size;be?Le.add(U.event):Le.delete(U.event),ge!==Le.size&&(Ne=!0)}}Ne&&X.set(r)}function ve(ye){let Ie=0;for(let Ne=0;Ne<U.days&&(Ie=fI(Ie,vE(ye.lastElementChild)),ye=ye.nextElementSibling,!!ye);++Ne);return Ie}function ke(ye){Op[ye?"unshift":"push"](()=>{J=ye,i(3,J)})}return t.$$set=ye=>{"chunk"in ye&&i(34,U=ye.chunk),"longChunks"in ye&&i(35,D=ye.longChunks),"inPopup"in ye&&i(36,E=ye.inPopup)},t.$$.update=()=>{if(t.$$.dirty[1]&8&&i(0,ie=U.event),t.$$.dirty[0]&37|t.$$.dirty[1]&2082184){i(1,Se=ie.display);let ye=ie.backgroundColor||T(ie)||I||b,Ie=ie.textColor||y(ie)||v;i(5,ne=`width:calc(${U.days*100}% + ${(U.days-1)*7}px);margin-top:${he}px;`),ye&&i(5,ne+=`background-color:${ye};`),Ie&&i(5,ne+=`color:${Ie};`),be&&i(5,ne+="visibility:hidden;"),i(4,oe=[p.event,...g([],ie),...BJe(m,ie,l)].join(" "))}t.$$.dirty[0]&4|t.$$.dirty[1]&15368&&i(6,[me,re]=FJe(U,f,h,p,d,l),re),t.$$.dirty[0]&2|t.$$.dirty[1]&512&&i(7,De=Oe(n,Se))},[ie,Se,p,J,oe,ne,re,De,s,S,w,C,M,N,R,A,_,k,O,F,B,$,V,H,z,G,W,K,Z,Y,X,Q,Oe,xe,U,D,E,$e,he,be,n,l,d,h,f,m,g,v,y,b,I,T,ke]}let sO=class extends Sl{constructor(e){super(),wl(this,e,YQe,qQe,Os,{chunk:34,longChunks:35,inPopup:36,reposition:37},null,[-1,-1])}get reposition(){return this.$$.ctx[37]}};function nJ(t,e,i){const n=t.slice();return n[20]=e[i],n}function rJ(t,e){let i,n,r;return n=new sO({props:{chunk:e[20],inPopup:!0}}),{key:t,first:null,c(){i=sh(),Ho(n.$$.fragment),this.first=i},m(o,a){xn(o,i,a),Eo(n,o,a),r=!0},p(o,a){e=o;const s={};a&1&&(s.chunk=e[20]),n.$set(s)},i(o){r||(Jt(n.$$.fragment,o),r=!0)},o(o){Ai(n.$$.fragment,o),r=!1},d(o){o&&An(i),go(n,o)}}}function KQe(t){let e,i,n,r,o,a,s,l,c,u,d,p,h=[],f=new Map,m,g,v,y,b,I=za(t[0]);const T=S=>S[20].event;for(let S=0;S<I.length;S+=1){let w=nJ(t,I,S),U=T(w);f.set(U,h[S]=rJ(U,w))}return{c(){e=Rn("div"),i=Rn("div"),n=Rn("time"),a=Ws(),s=Rn("a"),l=n1("×"),d=Ws(),p=Rn("div");for(let S=0;S<h.length;S+=1)h[S].c();st(n,"datetime",r=vu(t[3],10)),st(s,"role","button"),st(s,"tabindex","0"),st(s,"aria-label",c=t[6].close),st(i,"class",u=t[4].dayHead),st(p,"class",m=t[4].events),st(e,"class",g=t[4].popup),st(e,"style",t[2])},m(S,w){xn(S,e,w),dr(e,i),dr(i,n),dr(i,a),dr(i,s),dr(s,l),dr(e,d),dr(e,p);for(let U=0;U<h.length;U+=1)h[U]&&h[U].m(p,null);t[16](e),v=!0,y||(b=[yy(o=rS.call(null,n,t[5].format(t[3]))),In(s,"click",LN(t[13])),In(s,"keydown",FN(t[13])),yy(UJe.call(null,e,"pointerdown")),In(e,"pointerdown",LN(t[15])),In(e,"pointerdownoutside",t[14])],y=!0)},p(S,[w]){(!v||w&8&&r!==(r=vu(S[3],10)))&&st(n,"datetime",r),o&&$i(o.update)&&w&40&&o.update.call(null,S[5].format(S[3])),(!v||w&64&&c!==(c=S[6].close))&&st(s,"aria-label",c),(!v||w&16&&u!==(u=S[4].dayHead))&&st(i,"class",u),w&1&&(I=za(S[0]),Js(),h=cwe(h,w,T,1,S,I,f,p,lwe,rJ,null,nJ),Qs()),(!v||w&16&&m!==(m=S[4].events))&&st(p,"class",m),(!v||w&16&&g!==(g=S[4].popup))&&st(e,"class",g),(!v||w&4)&&st(e,"style",S[2])},i(S){if(!v){for(let w=0;w<I.length;w+=1)Jt(h[w]);v=!0}},o(S){for(let w=0;w<h.length;w+=1)Ai(h[w]);v=!1},d(S){S&&An(e);for(let w=0;w<h.length;w+=1)h[w].d();t[16](null),y=!1,Il(b)}}}function ZQe(t,e,i){let n,r,o,a,s,l,{buttonText:c,theme:u,_interaction:d,_intlDayPopover:p,_popupDate:h,_popupChunks:f}=ac("state");qe(t,c,w=>i(6,l=w)),qe(t,u,w=>i(4,a=w)),qe(t,d,w=>i(17,n=w)),qe(t,p,w=>i(5,s=w)),qe(t,h,w=>i(3,r=w)),qe(t,f,w=>i(0,o=w));let m,g="";function v(){let w=sD(m,1),U=sD(w,3),D=Tm(m),E=Tm(w),C=Tm(U);i(2,g="");let M;if(D.width>=C.width){M=C.left-E.left;let R=E.right-C.right;i(2,g+=`right:${R}px;`)}else M=(E.width-D.width)/2,E.left+M<C.left?M=C.left-E.left:E.left+M+D.width>C.right&&(M=C.right-E.left-D.width);i(2,g+=`left:${M}px;`);let N;if(D.height>=C.height){N=C.top-E.top;let R=E.bottom-C.bottom;i(2,g+=`bottom:${R}px;`)}else N=(E.height-D.height)/2,E.top+N<C.top?N=C.top-E.top:E.top+N+D.height>C.bottom&&(N=C.bottom-E.top-D.height);i(2,g+=`top:${N}px;`)}function y(){m&&(i(2,g=""),d5().then(()=>{o.length?v():b()}))}function b(w){tr(h,r=null,r)}function I(w){var U;b(),(U=n.action)==null||U.noClick()}function T(w){aO.call(this,t,w)}function S(w){Op[w?"unshift":"push"](()=>{m=w,i(1,m)})}return t.$$.update=()=>{t.$$.dirty&1&&o&&y()},[o,m,g,r,a,s,l,c,u,d,p,h,f,b,I,T,S]}class XQe extends Sl{constructor(e){super(),wl(this,e,ZQe,KQe,Os,{})}}function oJ(t,e,i){const n=t.slice();return n[42]=e[i],n[43]=e,n[44]=i,n}function aJ(t){let e,i,n,r;return i=new sO({props:{chunk:t[2][1]}}),{c(){e=Rn("div"),Ho(i.$$.fragment),st(e,"class",n=t[12].events)},m(o,a){xn(o,e,a),Eo(i,e,null),r=!0},p(o,a){const s={};a[0]&4&&(s.chunk=o[2][1]),i.$set(s),(!r||a[0]&4096&&n!==(n=o[12].events))&&st(e,"class",n)},i(o){r||(Jt(i.$$.fragment,o),r=!0)},o(o){Ai(i.$$.fragment,o),r=!1},d(o){o&&An(e),go(i)}}}function sJ(t){let e,i,n,r;return i=new sO({props:{chunk:t[2][0]}}),{c(){e=Rn("div"),Ho(i.$$.fragment),st(e,"class",n=t[12].events+" "+t[12].preview)},m(o,a){xn(o,e,a),Eo(i,e,null),r=!0},p(o,a){const s={};a[0]&4&&(s.chunk=o[2][0]),i.$set(s),(!r||a[0]&4096&&n!==(n=o[12].events+" "+o[12].preview))&&st(e,"class",n)},i(o){r||(Jt(i.$$.fragment,o),r=!0)},o(o){Ai(i.$$.fragment,o),r=!1},d(o){o&&An(e),go(i)}}}function lJ(t,e){let i,n,r=e[44],o;const a=()=>e[36](n,r),s=()=>e[36](null,r);let l={chunk:e[42],longChunks:e[1]};return n=new sO({props:l}),a(),{key:t,first:null,c(){i=sh(),Ho(n.$$.fragment),this.first=i},m(c,u){xn(c,i,u),Eo(n,c,u),o=!0},p(c,u){e=c,r!==e[44]&&(s(),r=e[44],a());const d={};u[0]&16&&(d.chunk=e[42]),u[0]&2&&(d.longChunks=e[1]),n.$set(d)},i(c){o||(Jt(n.$$.fragment,c),o=!0)},o(c){Ai(n.$$.fragment,c),o=!1},d(c){c&&An(i),s(),go(n,c)}}}function cJ(t){let e,i;return e=new XQe({}),{c(){Ho(e.$$.fragment)},m(n,r){Eo(e,n,r),i=!0},i(n){i||(Jt(e.$$.fragment,n),i=!0)},o(n){Ai(e.$$.fragment,n),i=!1},d(n){go(e,n)}}}function uJ(t){let e,i,n,r;return{c(){e=Rn("a"),st(e,"role","button"),st(e,"tabindex","0"),st(e,"aria-haspopup","true")},m(o,a){xn(o,e,a),n||(r=[In(e,"click",LN(t[26])),In(e,"keydown",FN(t[26])),In(e,"pointerdown",LN(t[35])),yy(i=rS.call(null,e,t[10]))],n=!0)},p(o,a){i&&$i(i.update)&&a[0]&1024&&i.update.call(null,o[10])},d(o){o&&An(e),n=!1,Il(r)}}}function JQe(t){let e,i,n,r,o,a,s=t[2][1]&&np(t[2][1].date,t[0]),l,c=t[2][0]&&np(t[2][0].date,t[0]),u,d,p=[],h=new Map,f,m,g,v,y,b,I,T,S,w=s&&aJ(t),U=c&&sJ(t),D=za(t[4]);const E=N=>N[42].event;for(let N=0;N<D.length;N+=1){let R=oJ(t,D,N),A=E(R);h.set(A,p[N]=lJ(A,R))}let C=t[6]&&cJ(),M=t[5].size&&uJ(t);return{c(){var N;e=Rn("div"),i=Rn("time"),a=Ws(),w&&w.c(),l=Ws(),U&&U.c(),u=Ws(),d=Rn("div");for(let R=0;R<p.length;R+=1)p[R].c();m=Ws(),C&&C.c(),g=Ws(),v=Rn("div"),M&&M.c(),st(i,"class",n=t[12].dayHead),st(i,"datetime",r=vu(t[0],10)),st(d,"class",f=t[12].events),st(v,"class",y=t[12].dayFoot),st(e,"class",b=t[12].day+" "+((N=t[12].weekdays)==null?void 0:N[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")),st(e,"role","cell")},m(N,R){xn(N,e,R),dr(e,i),dr(e,a),w&&w.m(e,null),dr(e,l),U&&U.m(e,null),dr(e,u),dr(e,d);for(let A=0;A<p.length;A+=1)p[A]&&p[A].m(d,null);dr(e,m),C&&C.m(e,null),dr(e,g),dr(e,v),M&&M.m(v,null),t[37](e),I=!0,T||(S=[yy(o=rS.call(null,i,t[14].format(t[0]))),In(e,"pointerenter",function(){$i(t[25](t[13]))&&t[25](t[13]).apply(this,arguments)}),In(e,"pointerleave",function(){var A,_;$i((A=t[13].pointer)==null?void 0:A.leave)&&((_=t[13].pointer)==null||_.leave.apply(this,arguments))}),In(e,"pointerdown",function(){var A,_;$i((A=t[13].action)==null?void 0:A.select)&&((_=t[13].action)==null||_.select.apply(this,arguments))})],T=!0)},p(N,R){var A;t=N,(!I||R[0]&4096&&n!==(n=t[12].dayHead))&&st(i,"class",n),(!I||R[0]&1&&r!==(r=vu(t[0],10)))&&st(i,"datetime",r),o&&$i(o.update)&&R[0]&16385&&o.update.call(null,t[14].format(t[0])),R[0]&5&&(s=t[2][1]&&np(t[2][1].date,t[0])),s?w?(w.p(t,R),R[0]&5&&Jt(w,1)):(w=aJ(t),w.c(),Jt(w,1),w.m(e,l)):w&&(Js(),Ai(w,1,1,()=>{w=null}),Qs()),R[0]&5&&(c=t[2][0]&&np(t[2][0].date,t[0])),c?U?(U.p(t,R),R[0]&5&&Jt(U,1)):(U=sJ(t),U.c(),Jt(U,1),U.m(e,u)):U&&(Js(),Ai(U,1,1,()=>{U=null}),Qs()),R[0]&2066&&(D=za(t[4]),Js(),p=cwe(p,R,E,1,t,D,h,d,lwe,lJ,null,oJ),Qs()),(!I||R[0]&4096&&f!==(f=t[12].events))&&st(d,"class",f),t[6]?C?R[0]&64&&Jt(C,1):(C=cJ(),C.c(),Jt(C,1),C.m(e,g)):C&&(Js(),Ai(C,1,1,()=>{C=null}),Qs()),t[5].size?M?M.p(t,R):(M=uJ(t),M.c(),M.m(v,null)):M&&(M.d(1),M=null),(!I||R[0]&4096&&y!==(y=t[12].dayFoot))&&st(v,"class",y),(!I||R[0]&4993&&b!==(b=t[12].day+" "+((A=t[12].weekdays)==null?void 0:A[t[0].getUTCDay()])+(t[7]?" "+t[12].today:"")+(t[8]?" "+t[12].otherMonth:"")+(t[9]?" "+t[12].highlight:"")))&&st(e,"class",b)},i(N){if(!I){Jt(w),Jt(U);for(let R=0;R<D.length;R+=1)Jt(p[R]);Jt(C),I=!0}},o(N){Ai(w),Ai(U);for(let R=0;R<p.length;R+=1)Ai(p[R]);Ai(C),I=!1},d(N){N&&An(e),w&&w.d(),U&&U.d();for(let R=0;R<p.length;R+=1)p[R].d();C&&C.d(),M&&M.d(),t[37](null),T=!1,Il(S)}}}function QQe(t,e,i){let n,r,o,a,s,l,c,u,d,p,{date:h}=e,{chunks:f}=e,{longChunks:m}=e,{iChunks:g=[]}=e,{date:v,dayMaxEvents:y,highlightedDates:b,moreLinkContent:I,theme:T,_hiddenEvents:S,_intlDayCell:w,_popupDate:U,_popupChunks:D,_today:E,_interaction:C,_queue:M}=ac("state");qe(t,v,Y=>i(33,l=Y)),qe(t,b,Y=>i(32,s=Y)),qe(t,I,Y=>i(30,o=Y)),qe(t,T,Y=>i(12,u=Y)),qe(t,S,Y=>i(31,a=Y)),qe(t,w,Y=>i(14,p=Y)),qe(t,U,Y=>i(29,r=Y)),qe(t,D,Y=>i(38,n=Y)),qe(t,E,Y=>i(34,c=Y)),qe(t,C,Y=>i(13,d=Y));let N,R,A,_,k,O=new Set,F="",B,$=[];function V(Y){return Y.pointer?X=>Y.pointer.enterDayGrid(h,X):void 0}function H(){tr(U,r=h,r)}function z(){var Q;let Y=tg(Cr(h)),X=R.concat(((Q=m[h.getTime()])==null?void 0:Q.chunks)||[]);tr(D,n=X.map(te=>Ub({},te,x$(te.event,h,Y),{days:1,dates:[h]})).sort((te,J)=>te.top-J.top),n)}function G(){gwe($,R)}function W(Y){aO.call(this,t,Y)}function K(Y,X){Op[Y?"unshift":"push"](()=>{$[X]=Y,i(11,$)})}function Z(Y){Op[Y?"unshift":"push"](()=>{N=Y,i(3,N)})}return t.$$set=Y=>{"date"in Y&&i(0,h=Y.date),"chunks"in Y&&i(27,f=Y.chunks),"longChunks"in Y&&i(1,m=Y.longChunks),"iChunks"in Y&&i(2,g=Y.iChunks)},t.$$.update=()=>{if(t.$$.dirty[0]&134217777){i(4,R=[]),O.clear(),i(5,O),i(27,f),i(0,h),i(4,R);for(let Y of f)np(Y.date,h)&&R.push(Y)}if(t.$$.dirty[0]&33&&tr(S,a[h.getTime()]=O,a),t.$$.dirty[0]&1|t.$$.dirty[1]&8&&i(7,A=np(h,c)),t.$$.dirty[0]&1|t.$$.dirty[1]&6&&(i(8,_=h.getUTCMonth()!==l.getUTCMonth()),i(9,k=s.some(Y=>np(Y,h)))),t.$$.dirty[0]&1073741856|t.$$.dirty[1]&1&&a&&O.size){let Y="+"+O.size+" more";o?i(10,F=$i(o)?o({num:O.size,text:Y}):o):i(10,F=Y)}t.$$.dirty[0]&536870913&&i(6,B=r&&np(h,r)),t.$$.dirty[0]&82&&B&&m&&R&&d5().then(z),t.$$.dirty[0]&9&&N&&AJe(N,()=>({allDay:!0,date:h,resource:void 0,dayEl:N}))},[h,m,g,N,R,O,B,A,_,k,F,$,u,d,p,v,b,I,T,S,w,U,D,E,C,V,H,f,G,r,o,a,s,l,c,W,K,Z]}class eet extends Sl{constructor(e){super(),wl(this,e,QQe,JQe,Os,{date:0,chunks:27,longChunks:1,iChunks:2,reposition:28},null,[-1,-1])}get reposition(){return this.$$.ctx[28]}}function dJ(t,e,i){const n=t.slice();return n[21]=e[i],n[22]=e,n[23]=i,n}function pJ(t){let e,i=t[23],n;const r=()=>t[18](e,i),o=()=>t[18](null,i);let a={date:t[21],chunks:t[1],longChunks:t[2],iChunks:t[3]};return e=new eet({props:a}),r(),{c(){Ho(e.$$.fragment)},m(s,l){Eo(e,s,l),n=!0},p(s,l){i!==s[23]&&(o(),i=s[23],r());const c={};l&1&&(c.date=s[21]),l&2&&(c.chunks=s[1]),l&4&&(c.longChunks=s[2]),l&8&&(c.iChunks=s[3]),e.$set(c)},i(s){n||(Jt(e.$$.fragment,s),n=!0)},o(s){Ai(e.$$.fragment,s),n=!1},d(s){o(),go(e,s)}}}function tet(t){let e,i,n,r,o,a=za(t[0]),s=[];for(let c=0;c<a.length;c+=1)s[c]=pJ(dJ(t,a,c));const l=c=>Ai(s[c],1,1,()=>{s[c]=null});return{c(){e=Rn("div");for(let c=0;c<s.length;c+=1)s[c].c();st(e,"class",i=t[5].days),st(e,"role","row")},m(c,u){xn(c,e,u);for(let d=0;d<s.length;d+=1)s[d]&&s[d].m(e,null);n=!0,r||(o=In(window,"resize",t[11]),r=!0)},p(c,[u]){if(u&31){a=za(c[0]);let d;for(d=0;d<a.length;d+=1){const p=dJ(c,a,d);s[d]?(s[d].p(p,u),Jt(s[d],1)):(s[d]=pJ(p),s[d].c(),Jt(s[d],1),s[d].m(e,null))}for(Js(),d=a.length;d<s.length;d+=1)l(d);Qs()}(!n||u&32&&i!==(i=c[5].days))&&st(e,"class",i)},i(c){if(!n){for(let u=0;u<a.length;u+=1)Jt(s[u]);n=!0}},o(c){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)Ai(s[u]);n=!1},d(c){c&&An(e),Tb(s,c),r=!1,o()}}}function iet(t,e,i){let n,r,o,a,s,{dates:l}=e,{_events:c,_iEvents:u,_queue2:d,_hiddenEvents:p,hiddenDays:h,theme:f}=ac("state");qe(t,c,U=>i(17,a=U)),qe(t,u,U=>i(16,o=U)),qe(t,p,U=>i(14,n=U)),qe(t,h,U=>i(15,r=U)),qe(t,f,U=>i(5,s=U));let m,g,v=[],y,b,I=[],T={};function S(){p5(()=>gwe(I,l),T,d)}function w(U,D){Op[U?"unshift":"push"](()=>{I[D]=U,i(4,I)})}return t.$$set=U=>{"dates"in U&&i(0,l=U.dates)},t.$$.update=()=>{if(t.$$.dirty&1&&(i(12,y=l[0]),i(13,b=tg(Cr(l[l.length-1])))),t.$$.dirty&176130){i(1,m=[]);for(let U of a)if(!f5(U.display)&&LX(U,y,b)){let D=x$(U,y,b);m.push(D)}i(2,g=OX(m,r)),S()}t.$$.dirty&110592&&i(3,v=o.map(U=>{let D;return U&&LX(U,y,b)?(D=x$(U,y,b),OX([D],r)):D=null,D})),t.$$.dirty&16384&&n&&S()},[l,m,g,v,I,s,c,u,p,h,f,S,y,b,n,r,o,a,w]}class net extends Sl{constructor(e){super(),wl(this,e,iet,tet,Os,{dates:0})}}function hJ(t,e,i){const n=t.slice();return n[10]=e[i],n}function fJ(t){let e,i;return e=new net({props:{dates:t[10]}}),{c(){Ho(e.$$.fragment)},m(n,r){Eo(e,n,r),i=!0},p(n,r){const o={};r&1&&(o.dates=n[10]),e.$set(o)},i(n){i||(Jt(e.$$.fragment,n),i=!0)},o(n){Ai(e.$$.fragment,n),i=!1},d(n){go(e,n)}}}function ret(t){let e,i,n=za(t[0]),r=[];for(let a=0;a<n.length;a+=1)r[a]=fJ(hJ(t,n,a));const o=a=>Ai(r[a],1,1,()=>{r[a]=null});return{c(){for(let a=0;a<r.length;a+=1)r[a].c();e=sh()},m(a,s){for(let l=0;l<r.length;l+=1)r[l]&&r[l].m(a,s);xn(a,e,s),i=!0},p(a,s){if(s&1){n=za(a[0]);let l;for(l=0;l<n.length;l+=1){const c=hJ(a,n,l);r[l]?(r[l].p(c,s),Jt(r[l],1)):(r[l]=fJ(c),r[l].c(),Jt(r[l],1),r[l].m(e.parentNode,e))}for(Js(),l=n.length;l<r.length;l+=1)o(l);Qs()}},i(a){if(!i){for(let s=0;s<n.length;s+=1)Jt(r[s]);i=!0}},o(a){r=r.filter(Boolean);for(let s=0;s<r.length;s+=1)Ai(r[s]);i=!1},d(a){a&&An(e),Tb(r,a)}}}function oet(t){let e,i,n,r;return e=new HQe({}),n=new WQe({props:{$$slots:{default:[ret]},$$scope:{ctx:t}}}),{c(){Ho(e.$$.fragment),i=Ws(),Ho(n.$$.fragment)},m(o,a){Eo(e,o,a),xn(o,i,a),Eo(n,o,a),r=!0},p(o,[a]){const s={};a&8193&&(s.$$scope={dirty:a,ctx:o}),n.$set(s)},i(o){r||(Jt(e.$$.fragment,o),Jt(n.$$.fragment,o),r=!0)},o(o){Ai(e.$$.fragment,o),Ai(n.$$.fragment,o),r=!1},d(o){o&&An(i),go(e,o),go(n,o)}}}function aet(t,e,i){let n,r,o,a,{_viewDates:s,_hiddenEvents:l,dayMaxEvents:c,hiddenDays:u}=ac("state");qe(t,s,h=>i(6,n=h)),qe(t,l,h=>i(9,o=h)),qe(t,c,h=>i(7,r=h)),qe(t,u,h=>i(8,a=h));let d,p;return t.$$.update=()=>{if(t.$$.dirty&481){i(0,d=[]),i(5,p=7-a.length),tr(l,o={},o);for(let h=0;h<n.length/p;++h){let f=[];for(let m=0;m<p;++m)f.push(n[h*p+m]);d.push(f)}}},[d,s,l,c,u,p,n,r,a]}class set extends Sl{constructor(e){super(),wl(this,e,aet,oet,Os,{})}}var cet={createOptions(t){t.dayMaxEvents=!1,t.dayCellFormat={day:"numeric"},t.dayPopoverFormat={month:"long",day:"numeric",year:"numeric"},t.moreLinkContent=void 0,t.buttonText.dayGridMonth="month",t.buttonText.close="Close",t.theme.uniform="ec-uniform",t.theme.dayFoot="ec-day-foot",t.theme.popup="ec-popup",t.view="dayGridMonth",t.views.dayGridMonth={buttonText:GJe,component:set,dayHeaderFormat:{weekday:"short"},dayHeaderAriaLabelFormat:{weekday:"long"},displayEventEnd:!1,duration:{months:1},theme:WJe("ec-day-grid ec-month-view"),titleFormat:{year:"numeric",month:"long"}}},createStores(t){t._days=$Qe(t),t._intlDayCell=ET(t.locale,t.dayCellFormat),t._intlDayPopover=ET(t.locale,t.dayPopoverFormat),t._hiddenEvents=Zo({}),t._popupDate=Zo(null),t._popupChunks=Zo([])}};let mM;function uet(){var i,n;const t=oc(),e=(n=(i=t==null?void 0:t.profile)==null?void 0:i.provider)==null?void 0:n.providerId;if(e){const r=o=>{o!=null&&o.calendar?DF(o.calendar):No.findAllTournaments().then(DF)};No.findProvider(e).then(r)}else No.findAllTournaments().then(DF)}function DF(t){const e=document.getElementById(H_);return mM&&Ua(e),wXe(),mM=new DQe({target:e,props:{plugins:[cet,BQe],options:{view:"dayGridMonth",height:"800px",headerToolbar:{start:"prev,next",center:"title",end:""},buttonText:i=>(i.resourceTimeGridWeek="resources",i),resources:[{id:1,title:"Resource A"},{id:2,title:"Resource B"}],scrollTime:"09:00:00",events:pet(t),eventClick:det,eventMouseEnter:het,views:{},dayMaxEvents:!0,nowIndicator:!0,selectable:!0}}}),{...MP,calendar:mM}}function det({event:t}){if(t.id){mM.destroy();const e=t.id;Ye.reset();const i=`/${Xo}/${e}`;Qe.router.navigate(i)}}function pet(t){const e=i=>i==null?void 0:i.split("T")[0];return t.map(i=>({title:i.tournamentName,start:e(i.startDate),end:e(i.endDate),extendedProps:{tournamentId:i.tournamentId},resourceIds:[i.tournamentId],id:i.tournamentId,color:"#FE6B64"}))}function het({event:t,jsEvent:e}){ff(e.target,{content:t.title,showOnCreate:!0,arrow:!0})}var fet=/([:*])(\w+)/g,met="([^/]+)",get=/\*/g,vet="?(?:.*)",yet=/\/\?/g,bet="/?([^/]+|)",Iet="(?:/^|^)",wet="";function ywe(t){return t===void 0&&(t="/"),g5()?location.pathname+location.search+location.hash:t}function uo(t){return t.replace(/\/+$/,"").replace(/^\/+/,"")}function $N(t){return typeof t=="string"}function Tet(t){return typeof t=="function"}function VN(t){return t&&t.indexOf("#")>=0&&t.split("#").pop()||""}function Uet(t,e){return e.length===0||!t?null:t.slice(1,t.length).reduce(function(i,n,r){return i===null&&(i={}),i[e[r]]=decodeURIComponent(n),i},null)}function jN(t){var e=uo(t).split(/\?(.*)?$/);return[uo(e[0]),e.slice(1).join("")]}function m5(t){for(var e={},i=t.split("&"),n=0;n<i.length;n++){var r=i[n].split("=");if(r[0]!==""){var o=decodeURIComponent(r[0]);e[o]?(Array.isArray(e[o])||(e[o]=[e[o]]),e[o].push(decodeURIComponent(r[1]||""))):e[o]=decodeURIComponent(r[1]||"")}}return e}function bwe(t,e){var i=jN(uo(t.currentLocationPath)),n=i[0],r=i[1],o=r===""?null:m5(r),a=[],s;if($N(e.path)){if(s=Iet+uo(e.path).replace(fet,function(d,p,h){return a.push(h),met}).replace(get,vet).replace(yet,bet)+"$",uo(e.path)===""&&uo(n)==="")return{url:n,queryString:r,hashString:VN(t.to),route:e,data:null,params:o}}else s=e.path;var l=new RegExp(s,wet),c=n.match(l);if(c){var u=$N(e.path)?Uet(c,a):c.groups?c.groups:c.slice(1);return{url:uo(n.replace(new RegExp("^"+t.instance.root),"")),queryString:r,hashString:VN(t.to),route:e,data:u,params:o}}return!1}function Iwe(){return!!(typeof window<"u"&&window.history&&window.history.pushState)}function Db(t,e){return typeof t[e]>"u"||t[e]===!0}function Det(t){if(!t)return{};var e=t.split(","),i={},n;return e.forEach(function(r){var o=r.split(":").map(function(a){return a.replace(/(^ +| +$)/g,"")});switch(o[0]){case"historyAPIMethod":i.historyAPIMethod=o[1];break;case"resolveOptionsStrategy":n||(n={}),n.strategy=o[1];break;case"resolveOptionsHash":n||(n={}),n.hash=o[1]==="true";break;case"updateBrowserURL":case"callHandler":case"updateState":case"force":i[o[0]]=o[1]==="true";break}}),n&&(i.resolveOptions=n),i}function g5(){return typeof window<"u"}function Pet(t,e){return t===void 0&&(t=[]),e===void 0&&(e={}),t.filter(function(i){return i}).forEach(function(i){["before","after","already","leave"].forEach(function(n){i[n]&&(e[n]||(e[n]=[]),e[n].push(i[n]))})}),e}function rp(t,e,i){var n=e||{},r=0;(function o(){if(!t[r]){i&&i(n);return}Array.isArray(t[r])?(t.splice.apply(t,[r,1].concat(t[r][0](n)?t[r][1]:t[r][2])),o()):t[r](n,function(a){typeof a>"u"||a===!0?(r+=1,o()):i&&i(n)})})()}rp.if=function(t,e,i){return Array.isArray(e)||(e=[e]),Array.isArray(i)||(i=[i]),[t,e,i]};function mJ(t,e){typeof t.currentLocationPath>"u"&&(t.currentLocationPath=t.to=ywe(t.instance.root)),t.currentLocationPath=t.instance._checkForAHash(t.currentLocationPath),e()}function PF(t,e){for(var i=0;i<t.instance.routes.length;i++){var n=t.instance.routes[i],r=bwe(t,n);if(r&&(t.matches||(t.matches=[]),t.matches.push(r),t.resolveOptions.strategy==="ONE")){e();return}}e()}function Cet(t,e){t.navigateOptions&&(typeof t.navigateOptions.shouldResolve<"u"&&console.warn('"shouldResolve" is deprecated. Please check the documentation.'),typeof t.navigateOptions.silent<"u"&&console.warn('"silent" is deprecated. Please check the documentation.')),e()}function Eet(t,e){t.navigateOptions.force===!0?(t.instance._setCurrent([t.instance._pathToMatchObject(t.to)]),e(!1)):e()}var gJ=g5(),Met=Iwe();function Ret(t,e){if(Db(t.navigateOptions,"updateBrowserURL")){var i=("/"+t.to).replace(/\/\//g,"/"),n=gJ&&t.resolveOptions&&t.resolveOptions.hash===!0;Met?(history[t.navigateOptions.historyAPIMethod||"pushState"](t.navigateOptions.stateObj||{},t.navigateOptions.title||"",n?"#"+i:i),location&&location.hash&&(t.instance.__freezeListening=!0,setTimeout(function(){if(!n){var r=location.hash;location.hash="",location.hash=r}t.instance.__freezeListening=!1},1))):gJ&&(window.location.href=t.to)}e()}function wwe(t,e){var i=t.instance;if(!i.lastResolved()){e();return}rp(i.lastResolved().map(function(n){return function(r,o){if(!n.route.hooks||!n.route.hooks.leave){o();return}var a=!1,s=t.instance.matchLocation(n.route.path,t.currentLocationPath,!1);if(n.route.path!=="*")a=!s;else{var l=t.matches?t.matches.find(function(c){return n.route.path===c.route.path}):!1;a=!l}if(Db(t.navigateOptions,"callHooks")&&a){rp(n.route.hooks.leave.map(function(c){return function(u,d){return c(function(p){p===!1?t.instance.__markAsClean(t):d()},t.matches&&t.matches.length>0?t.matches.length===1?t.matches[0]:t.matches:void 0)}}).concat([function(){return o()}]));return}else o()}}),{},function(){return e()})}function Net(t,e){t.match.route.hooks&&t.match.route.hooks.before&&Db(t.navigateOptions,"callHooks")?rp(t.match.route.hooks.before.map(function(i){return function(r,o){return i(function(a){a===!1?t.instance.__markAsClean(t):o()},t.match)}}).concat([function(){return e()}])):e()}function Aet(t,e){Db(t.navigateOptions,"callHandler")&&t.match.route.handler(t.match),t.instance.updatePageLinks(),e()}function _et(t,e){t.match.route.hooks&&t.match.route.hooks.after&&Db(t.navigateOptions,"callHooks")&&t.match.route.hooks.after.forEach(function(i){return i(t.match)}),e()}function ket(t,e){var i=t.instance.lastResolved();if(i&&i[0]&&i[0].route===t.match.route&&i[0].url===t.match.url&&i[0].queryString===t.match.queryString){i.forEach(function(n){n.route.hooks&&n.route.hooks.already&&Db(t.navigateOptions,"callHooks")&&n.route.hooks.already.forEach(function(r){return r(t.match)})}),e(!1);return}e()}function xet(t,e){var i=t.instance._notFoundRoute;if(i){t.notFoundHandled=!0;var n=jN(t.currentLocationPath),r=n[0],o=n[1],a=VN(t.to);i.path=uo(r);var s={url:i.path,queryString:o,hashString:a,data:null,route:i,params:o!==""?m5(o):null};t.matches=[s],t.match=s}e()}function Oet(t,e){(!t.resolveOptions||t.resolveOptions.noMatchWarning===!1||typeof t.resolveOptions.noMatchWarning>"u")&&console.warn('Navigo: "'+t.currentLocationPath+`" didn't match any of the registered routes.`),e()}function Let(t,e){t.instance._setCurrent(null),e()}function Swe(t,e){Db(t.navigateOptions,"updateState")&&t.instance._setCurrent(t.matches),e()}var Twe=[ket,Net,Aet,_et],vJ=[wwe,xet,rp.if(function(t){var e=t.notFoundHandled;return e},Twe.concat([Swe]),[Oet,Let])];function F$(){return F$=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},F$.apply(this,arguments)}function yJ(t,e){var i=0;function n(){if(i===t.matches.length){Swe(t,e);return}rp(Twe,F$({},t,{match:t.matches[i]}),function(){i+=1,n()})}wwe(t,n)}function CF(t){t.instance.__markAsClean(t)}function B$(){return B$=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t},B$.apply(this,arguments)}var bJ="[data-navigo]";function Fet(t,e){var i=e||{strategy:"ONE",hash:!1,noMatchWarning:!1,linksSelector:bJ},n=this,r="/",o=null,a=[],s=!1,l,c=Iwe(),u=g5();t?r=uo(t):console.warn('Navigo requires a root path in its constructor. If not provided will use "/" as default.');function d(B){return B.indexOf("#")>=0&&(i.hash===!0?B=B.split("#")[1]||"/":B=B.split("#")[0]),B}function p(B){return uo(r+"/"+uo(B))}function h(B,$,V,H){return B=$N(B)?p(B):B,{name:H||uo(String(B)),path:B,handler:$,hooks:Pet(V)}}function f(B,$,V){var H=this;return typeof B=="object"&&!(B instanceof RegExp)?(Object.keys(B).forEach(function(z){if(typeof B[z]=="function")H.on(z,B[z]);else{var G=B[z],W=G.uses,K=G.as,Z=G.hooks;a.push(h(z,W,[l,Z],K))}}),this):(typeof B=="function"&&(V=$,$=B,B=r),a.push(h(B,$,[l,V])),this)}function m(B,$){if(n.__dirty){n.__waiting.push(function(){return n.resolve(B,$)});return}else n.__dirty=!0;B=B?uo(r)+"/"+uo(B):void 0;var V={instance:n,to:B,currentLocationPath:B,navigateOptions:{},resolveOptions:B$({},i,$)};return rp([mJ,PF,rp.if(function(H){var z=H.matches;return z&&z.length>0},yJ,vJ)],V,CF),V.matches?V.matches:!1}function g(B,$){if(n.__dirty){n.__waiting.push(function(){return n.navigate(B,$)});return}else n.__dirty=!0;B=uo(r)+"/"+uo(B);var V={instance:n,to:B,navigateOptions:$||{},resolveOptions:$&&$.resolveOptions?$.resolveOptions:i,currentLocationPath:d(B)};rp([Cet,Eet,PF,rp.if(function(H){var z=H.matches;return z&&z.length>0},yJ,vJ),Ret,CF],V,CF)}function v(B,$,V){var H=C(B,$);return H!==null?(g(H.replace(new RegExp("^/?"+r),""),V),!0):!1}function y(B){return this.routes=a=a.filter(function($){return $N(B)?uo($.path)!==uo(B):Tet(B)?B!==$.handler:String($.path)!==String(B)}),this}function b(){c&&(this.__popstateListener=function(){n.__freezeListening||m()},window.addEventListener("popstate",this.__popstateListener))}function I(){this.routes=a=[],c&&window.removeEventListener("popstate",this.__popstateListener),this.destroyed=s=!0}function T(B,$){return n._notFoundRoute=h("*",B,[l,$],"__NOT_FOUND__"),this}function S(){if(u)return w().forEach(function(B){if(B.getAttribute("data-navigo")==="false"||B.getAttribute("target")==="_blank"){B.hasListenerAttached&&B.removeEventListener("click",B.navigoHandler);return}B.hasListenerAttached||(B.hasListenerAttached=!0,B.navigoHandler=function($){if(($.ctrlKey||$.metaKey)&&$.target.tagName.toLowerCase()==="a")return!1;var V=B.getAttribute("href");if(typeof V>"u"||V===null)return!1;if(V.match(/^(http|https)/)&&typeof URL<"u")try{var H=new URL(V);V=H.pathname+H.search}catch{}var z=Det(B.getAttribute("data-navigo-options"));s||($.preventDefault(),$.stopPropagation(),n.navigate(uo(V),z))},B.addEventListener("click",B.navigoHandler))}),n}function w(){return u?[].slice.call(document.querySelectorAll(i.linksSelector||bJ)):[]}function U(B){return"/"+r+"/"+uo(B)}function D(B){return l=B,this}function E(){return o}function C(B,$,V){var H=a.find(function(W){return W.name===B}),z=null;if(H){if(z=H.path,$)for(var G in $)z=z.replace(":"+G,$[G]);z=z.match(/^\//)?z:"/"+z}return z&&V&&!V.includeRoot&&(z=z.replace(new RegExp("^/"+r),"")),z}function M(B){return B.getAttribute("href")}function N(B){var $=jN(uo(B)),V=$[0],H=$[1],z=H===""?null:m5(H),G=VN(B),W=h(V,function(){},[l],V);return{url:V,queryString:H,hashString:G,route:W,data:null,params:z}}function R(){return N(uo(ywe(r)).replace(new RegExp("^"+r),""))}function A(B){var $={instance:n,currentLocationPath:B,to:B,navigateOptions:{},resolveOptions:i};return PF($,function(){}),$.matches?$.matches:!1}function _(B,$,V){typeof $<"u"&&(typeof V>"u"||V)&&($=p($));var H={instance:n,to:$,currentLocationPath:$};mJ(H,function(){}),typeof B=="string"&&(B=typeof V>"u"||V?p(B):B);var z=bwe(H,{name:String(B),path:B,handler:function(){},hooks:{}});return z||!1}function k(B,$,V){return typeof $=="string"&&($=O($)),$?($.hooks[B]||($.hooks[B]=[]),$.hooks[B].push(V),function(){$.hooks[B]=$.hooks[B].filter(function(H){return H!==V})}):(console.warn("Route doesn't exists: "+$),function(){})}function O(B){return typeof B=="string"?a.find(function($){return $.name===p(B)}):a.find(function($){return $.handler===B})}function F(B){B.instance.__dirty=!1,B.instance.__waiting.length>0&&B.instance.__waiting.shift()()}this.root=r,this.routes=a,this.destroyed=s,this.current=o,this.__freezeListening=!1,this.__waiting=[],this.__dirty=!1,this.__markAsClean=F,this.on=f,this.off=y,this.resolve=m,this.navigate=g,this.navigateByName=v,this.destroy=I,this.notFound=T,this.updatePageLinks=S,this.link=U,this.hooks=D,this.extractGETParameters=function(B){return jN(d(B))},this.lastResolved=E,this.generate=C,this.getLinkPath=M,this.match=A,this.matchLocation=_,this.getCurrentLocation=R,this.addBeforeHook=k.bind(this,"before"),this.addAfterHook=k.bind(this,"after"),this.addAlreadyHook=k.bind(this,"already"),this.addLeaveHook=k.bind(this,"leave"),this.getRoute=O,this._pathToMatchObject=N,this._clean=uo,this._checkForAHash=d,this._setCurrent=function(B){return o=n.current=B},b.call(this),S.call(this)}function Bet(){const e=new Fet("/",{hash:!0});Qe.router=e;const i=({selectedTab:n,renderDraw:r,data:o})=>{Hx(),jIe({config:{selectedTab:n,renderDraw:r,...o}})};return e.on(`/${Xo}/:tournamentId`,({data:n})=>{i({data:n})}),e.on(`/${Xo}/:tournamentId/${Gg}/:eventId`,({data:n})=>{i({selectedTab:Xu,data:n})}),e.on(`/${Xo}/:tournamentId/${Gg}/:eventId/${xS}/:drawId`,({data:n})=>{i({selectedTab:Xu,renderDraw:!0,data:n})}),e.on(`/${Xo}/:tournamentId/${Gg}/:eventId/${xS}/:drawId/${R2}/:roundsView`,({data:n})=>{i({selectedTab:Xu,renderDraw:!0,data:n})}),e.on(`/${Xo}/:tournamentId/${Gg}/:eventId/${xS}/:drawId/${M2}/:structureId`,({data:n})=>{i({selectedTab:Xu,renderDraw:!0,data:n})}),e.on(`/${Xo}/:tournamentId/${Gg}/:eventId/${xS}/:drawId/${M2}/:structureId/${R2}/:roundsView`,({data:n})=>{i({selectedTab:Xu,renderDraw:!0,data:n})}),e.on(`/${Xo}/:tournamentId/${Gg}/:eventId/${hle}/:drawId`,({data:n})=>{i({selectedTab:Xu,data:n})}),e.on(`/${Xo}/:tournamentId/${Dp}/:participantView`,({data:n})=>{i({selectedTab:Dp,data:n})}),e.on(`/${Xo}/:tournamentId/${Wv}/:scheduledDate`,({data:n})=>{i({selectedTab:Wv,data:n})}),e.on(`/${Xo}/:tournamentId/:selectedTab`,({data:n})=>{i({data:n})}),e.on(`/${Up}/:uuid`,CX),e.on(`/${Up}`,CX),e.on(`/${ENe}/:inviteKey`,sJe),e.on("/calendar",uet),e.on("/actionKey/:key",({data:n})=>{n.key,e.navigate("/"),IF()}),e.on("/",()=>{IF()}),e.notFound(()=>{e.navigate("/"),IF()}),e.resolve(),{success:!0}}function $et({record:t}){let e=z_({data:t,maxTilde:5});if(e){let r=`<div>
          <h4 class="subtitle is-5">
            <b>${e.name}</b>
          </h4>
          <h5>${Fn.tr("tournaments.publishtime")}:</h5>
        </div>`,o=[{label:Fn.tr("tournaments.replacelocal"),intent:"is-warning",onClick:i},{label:Fn.tr("tournaments.close")}];lr({title:Fn.tr("tournaments.received"),content:r,buttons:o})}function i(){e.received=new Date().getTime();let r=e;No.addTournament(r).then(n,o=>console.log({err:o}))}function n(){jIe({tournamentId:e.tournamentId})}}function Vet(t){console.log({msg:t}),No.findTournament(t.tournamentId).then(e,i=>console.log({err:i}));function e(i){vN.call("tournamentAuthorization","tap",i),i&&t.tournament&&t.send_auth?lr({title:"Save tournament",content:`
        <div class="content">
          <p>Choose to keep the existing tournament or replace the local copy with the incoming tournament</p>
        </div>
        `,buttons:[{label:"Save Received",onClick:()=>n(t.tournament),close:!0},{label:"Keep Existing",onClick:()=>r(i),close:!0},{label:"Cancel",close:!0}]}):!i&&t.tournament?n(t.tournament):i?r(i):a(),t.referee_key&&Qe.ee.emit("sendKey",t.referee_key),t.tournament_key&&jet(t.tournament_key,t.tuid);function n(s){let l=z_({data:s,maxTilde:5});l&&(Qe.ee.emit("updateTournament",l),l.start&&(l.start=new Date(l.start).getTime()),l.end&&(l.end=new Date(l.end).getTime()),Fw.addTournament(l).then(()=>r(l),a))}function r(s){t.inDB=!0,t.notice=`${s.name}`;let l=`${Fn.tr(t.title)}: ${t.notice}`,c=yXe("tournament")&&{text:Fn.tr("tournaments.edit"),onClick:o};vi({intent:"is-success",message:l,action:c})}function o(){console.log("display tournament")}function a(){t.notice="Not Found in Calendar",ar.messages.push(t)}}}function jet(t,e){const i=()=>console.log("added tournament key");Fw.findSetting("tournamentKeys").then(n,n);function n(r={key:"tournamentKeys",ring:[]}){var o;r.ring=r.ring.filter(a=>a.key!==t),t&&e&&(r.ring.push({key:t,tuid:e,ouid:(o=ar.org)==null?void 0:o.ouid}),Fw.addSetting(r).then(i,i))}}function Het({ioc:t,initialization:e}){if(!t||typeof t!="string")return;t=t==null?void 0:t.toLowerCase();let i=Fn.set(t);if(i){let o=ar.ioc!==t&&!e;ar.ioc=t,o&&(IJ(t),Qe.ee.emit("showSplash",{source:"change idiom"})),i.locale&&Ybe(i.locale)}else Fw.findIdiom(t).then(r,n);function n(){t&&t.length===3&&XC({data:{action:vze,payload:{key:`${t}.idiom`}}})}function r(o){if(!o)return n();Fn.define(o),ar.ioc=t,Fn.set(t),IJ(t),ar.ioc!==t&&!e&&Qe.ee.emit("showSplash",{source:"change idiom"})}}function IJ(t){let e={key:"defaultIdiom",class:"userInterface",ioc:t};return Fw.addSetting(e),!0}function Get(){return new Promise((t,e)=>{Ket();const i=()=>{ar.first_time_user=ar.first_time_user&&Qe.ee.emit("sendKey","players")?!1:ar.first_time_user,t()};Wet().then(i,e)})}const zet=t=>(...e)=>YIe()?t(...e):t(...e).catch(i=>console.log(i));function Wet(){return new Promise((t,e)=>{new Promise((n,r)=>zet(No.initDB)().then(t,qet).then(n,r)).then(t,e)})}function qet(){Qe.modal.inform({message:'<h2>Database Upgraded</h2><div style="margin: 1em;">Please Close Browser and Re-launch</div>'})}function Uwe(t){const e=r=>Object.keys(r).map(o=>r[o]).join(""),i=e(t);ar.messages.reduce((r,o)=>e(o)===i?!0:r,!1)||ar.messages.push(t)}function Yet(t){console.log({tmxMessage:t}),t.authorized&&(t.tuid||t.tournamentId)?Vet(t):(t.notice=t.notice||t.tournament,t.notice&&Uwe(t))}function Ket(){Qe.ee.addListener("receiveTournamentRecord",$et),Qe.ee.addListener(yze,cye),Qe.ee.addListener("changeIdiom",Het),Qe.ee.addListener("tmxMessage",Yet),Qe.ee.addListener("addMessage",Uwe)}function EF(){ett(),_Xe(),Xet(),ZNe(),NXe(),Qe.drawer=aJe(),Get().then(Zet,t=>console.log({err:t}))}function Zet(){console.log("%c TMX ready","color: lightgreen"),zIe(),document.getElementById(nU).onclick=()=>Qe.router.navigate(`/${Up}`),Bet(),sXe()}function Xet(){Qe.dragMatch=new Image,Qe.dragMatch.src=FIe,Qe.ee=new AXe}const Jet="ResizeObserver loop limit exceeded",Qet="ResizeObserver loop completed with undelivered notifications.";function ett(){ar.device=itt(),ar.version_check=new Date().getTime();const t=Ye.version();console.log(`%cversion: ${N4}`,"color: lightblue"),console.log(`%cfactory: ${t}`,"color: lightblue"),ttt()}function ttt(){window.addEventListener("error",t=>{if([Jet,Qet].includes(t.message)){const e=document.getElementById("webpack-dev-server-client-overlay-div"),i=document.getElementById("webpack-dev-server-client-overlay");i&&i.setAttribute("style","display: none"),e&&e.setAttribute("style","display: none")}})}function itt(){let t=ntt();return{isStandalone:t&&"standalone"in t&&t.standalone,isIDevice:t&&/iphone|ipod|ipad/i.test(t.userAgent),isIpad:t&&/iPad/i.test(t.userAgent),isWindows:t&&/indows/i.test(t.userAgent),isMobile:t&&/Mobi/.test(t.userAgent)}}function ntt(){try{return navigator||window.navigator}catch{return}}if(window.attachEvent)window.attachEvent("onload",EF);else if(window.onload){const t=window.onload,e=i=>{t(i),EF()};window.onload=e}else window.onload=EF;YNe();KNe();
//# sourceMappingURL=index-DNbyble5.js.map
